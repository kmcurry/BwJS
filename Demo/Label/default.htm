<html>
  <head>
    <title>BWJS Demo</title>
    <script type="text/javascript" src="../../Common/Base.js"></script>
    <script type="text/javascript" src="../../Common/Util.js"></script>
    <script type="text/javascript" src="../../Common/BaseTypes.js"></script>
    <script type="text/javascript" src="../../Common/Stack.js"></script> 
    <script type="text/javascript" src="../../Common/Serialization.js"></script>
    <script type="text/javascript" src="../../Common/xmlsax.js"></script>
    <script type="text/javascript" src="../../Common/Timer.js"></script>  
    <script type="text/javascript" src="../../Common/DomAbsPos.js"></script>   
    <script type="text/javascript" src="../../Common/Enums.js"></script>     
    <script type="text/javascript" src="../../Math/MathUtil.js"></script>
    <script type="text/javascript" src="../../Math/Vector2D.js"></script>
    <script type="text/javascript" src="../../Math/Vector3D.js"></script>
    <script type="text/javascript" src="../../Math/Vector4D.js"></script>
    <script type="text/javascript" src="../../Math/Matrix4x4.js"></script>
    <script type="text/javascript" src="../../Math/MatrixStack.js"></script>
    <script type="text/javascript" src="../../Math/Quaternion.js"></script>
    <script type="text/javascript" src="../../Math/Line.js"></script>
    <script type="text/javascript" src="../../Math/Plane.js"></script>    
    <script type="text/javascript" src="../../Math/ViewVolume.js"></script>    
    <script type="text/javascript" src="../../Math/CompGeom.js"></script>     
    <script type="text/javascript" src="../../Attribute/AttributeType.js"></script>
    <script type="text/javascript" src="../../Attribute/Attribute.js"></script>
    <script type="text/javascript" src="../../Attribute/AttributeContainer.js"></script>
    <script type="text/javascript" src="../../Attribute/AttributeRegistry.js"></script>
    <script type="text/javascript" src="../../Attribute/BaseAttrs.js"></script>
    <script type="text/javascript" src="../../Attribute/AttributeVector.js"></script>  
    <script type="text/javascript" src="../../Attribute/StyleAttr.js"></script>      
    <script type="text/javascript" src="../../Attribute/ContainerAttrs.js"></script>
    <script type="text/javascript" src="../../Attribute/AttributeUtil.js"></script>
    <script type="text/javascript" src="../../Common/Agent.js"></script>
    <script type="text/javascript" src="../../Common/Spatial.js"></script>    
    <script type="text/javascript" src="../../RenderContext/RenderContext.js"></script>
    <script type="text/javascript" src="../../RenderContext/RenderState.js"></script>
    <script type="text/javascript" src="../../RenderContext/VertexBuffer.js"></script> 
    <script type="text/javascript" src="../../RenderContext/TextureObject.js"></script>
    <script type="text/javascript" src="../../RenderContext/Plugins/webgl/webgl-debug.js"></script>
    <script type="text/javascript" src="../../RenderContext/Plugins/webgl/webglRC.js"></script>
    <script type="text/javascript" src="../../RenderContext/Plugins/webgl/webglVB.js"></script>
    <script type="text/javascript" src="../../RenderContext/Plugins/webgl/webglTO.js"></script>
    <script type="text/javascript" src="../../RenderContext/Plugins/webgl/shaders.js"></script>
    <script type="text/javascript" src="../../ContentHandler/ContentHandler.js"></script>
    <script type="text/javascript" src="../../ContentHandler/ContentBuilder.js"></script>
    <script type="text/javascript" src="../../ContentHandler/BinaryParser.js"></script> 
    <script type="text/javascript" src="../../ContentHandler/TextParser.js"></script>     
    <script type="text/javascript" src="../../ContentHandler/XMLParser.js"></script>
    <script type="text/javascript" src="../../Image/PixelFormat.js"></script>  
    <script type="text/javascript" src="../../Image/ImageManip.js"></script>  
    <script type="text/javascript" src="../../Image/MediaPlayback.js"></script>
    <script type="text/javascript" src="../../SceneGraph/SceneGraph.js"></script>
    <script type="text/javascript" src="../../SceneGraph/StyleMgr.js"></script> 
    <script type="text/javascript" src="../../SceneGraph/GraphMgr.js"></script>   
    <script type="text/javascript" src="../../SceneGraph/Node.js"></script>  
    <script type="text/javascript" src="../../SceneGraph/SGNode.js"></script>
    <script type="text/javascript" src="../../SceneGraph/RenderableElement.js"></script>
    <script type="text/javascript" src="../../SceneGraph/ParentableMotionElement.js"></script>
    <script type="text/javascript" src="../../SceneGraph/Directive.js"></script>
    <script type="text/javascript" src="../../SceneGraph/SGDirective.js"></script>
    <script type="text/javascript" src="../../SceneGraph/UpdateDirective.js"></script>
    <script type="text/javascript" src="../../SceneGraph/Camera.js"></script>
    <script type="text/javascript" src="../../SceneGraph/OrthographicCamera.js"></script>
    <script type="text/javascript" src="../../SceneGraph/PerspectiveCamera.js"></script>
    <script type="text/javascript" src="../../SceneGraph/Light.js"></script>
    <script type="text/javascript" src="../../SceneGraph/DirectionalLight.js"></script>
    <script type="text/javascript" src="../../SceneGraph/PointLight.js"></script>
    <script type="text/javascript" src="../../SceneGraph/GlobalIllumination.js"></script>
    <script type="text/javascript" src="../../SceneGraph/Group.js"></script>
    <script type="text/javascript" src="../../SceneGraph/Isolator.js"></script>
    <script type="text/javascript" src="../../SceneGraph/Dissolve.js"></script>
    <script type="text/javascript" src="../../SceneGraph/RenderDirective.js"></script>
    <script type="text/javascript" src="../../SceneGraph/RayPickDirective.js"></script> 
    <script type="text/javascript" src="../../SceneGraph/BBoxDirective.js"></script>        
    <script type="text/javascript" src="../../SceneGraph/Geometry.js"></script>
    <script type="text/javascript" src="../../SceneGraph/VertexGeometry.js"></script>
    <script type="text/javascript" src="../../SceneGraph/TriList.js"></script>
    <script type="text/javascript" src="../../SceneGraph/Material.js"></script>
    <script type="text/javascript" src="../../SceneGraph/Surface.js"></script>
    <script type="text/javascript" src="../../SceneGraph/Model.js"></script>
    <script type="text/javascript" src="../../SceneGraph/Texture.js"></script>
    <script type="text/javascript" src="../../SceneGraph/MediaTexture.js"></script>
    <script type="text/javascript" src="../../SceneGraph/Evaluator.js"></script>
    <script type="text/javascript" src="../../SceneGraph/SceneInspector.js"></script>
    <script type="text/javascript" src="../../SceneGraph/ArcballInspector.js"></script>    
    <script type="text/javascript" src="../../SceneGraph/KeyframeInterpolator.js"></script> 
    <script type="text/javascript" src="../../SceneGraph/BBoxLocator.js"></script>     
    <script type="text/javascript" src="../../SceneGraph/SceneGraphUtil.js"></script>
    <script type="text/javascript" src="../../SceneGraph/RasterComponent.js"></script>    
    <script type="text/javascript" src="../../SceneGraph/Label.js"></script>
    <script type="text/javascript" src="../../SceneGraph/LineList.js"></script>
    <script type="text/javascript" src="../../SceneGraph/PointList.js"></script>
    <script type="text/javascript" src="../../SceneGraph/Interpolate.js"></script>
    <script type="text/javascript" src="../../SceneGraph/State.js"></script>              
    <script type="text/javascript" src="../../SceneGraph/DistanceSortAgent.js"></script> 
    <script type="text/javascript" src="../../SceneGraph/MapProjectionCalculator.js"></script>   
    <script type="text/javascript" src="../../SceneGraph/NullObject.js"></script>                        
    <script type="text/javascript" src="../../SceneGraph/Transform.js"></script>
    <script type="text/javascript" src="../../SceneGraph/QuaternionRotate.js"></script>
    <script type="text/javascript" src="../../SceneGraph/Rotate.js"></script>
    <script type="text/javascript" src="../../SceneGraph/Scale.js"></script>
    <script type="text/javascript" src="../../SceneGraph/Translate.js"></script>
    <script type="text/javascript" src="../../Event/EventType.js"></script>
    <script type="text/javascript" src="../../Event/Event.js"></script> 
    <script type="text/javascript" src="../../Event/InputEvent.js"></script>
    <script type="text/javascript" src="../../Event/MouseEvent.js"></script>
    <script type="text/javascript" src="../../Event/EventAdapter.js"></script>
    <script type="text/javascript" src="../../Event/EventListener.js"></script>
    <script type="text/javascript" src="../../Event/EventMgr.js"></script>
    <script type="text/javascript" src="../../Device/DeviceHandler.js"></script>
    <script type="text/javascript" src="../../Device/MouseHandler.js"></script>
    <script type="text/javascript" src="../../BwCore/Command.js"></script>
    <script type="text/javascript" src="../../BwCore/Set.js"></script>
    <script type="text/javascript" src="../../BwCore/ConnectAttributes.js"></script>
    <script type="text/javascript" src="../../BwCore/AutoInterpolate.js"></script>  
    <script type="text/javascript" src="../../BwCore/MotionInterpolate.js"></script>  
    <script type="text/javascript" src="../../BwCore/Locate.js"></script>
    <script type="text/javascript" src="../../BwCore/Play.js"></script>  
    <script type="text/javascript" src="../../BwCore/Remove.js"></script>                  
    <script type="text/javascript" src="../../BwCore/Stop.js"></script>  
    <script type="text/javascript" src="../../BwCore/CommandSequence.js"></script>
    <script type="text/javascript" src="../../BwCore/CommandMgr.js"></script>
    <script type="text/javascript" src="../../BwCore/BwRegistry.js"></script>
    <script type="text/javascript" src="../../BwCore/BwSceneInspector.js"></script>
    <script type="text/javascript" src="../../BwCore/ObjectInspector.js"></script>
    <script type="text/javascript" src="../../BwCore/ConnectionMgr.js"></script>
    <script type="text/javascript" src="../../BwCore/RenderAgent.js"></script>
    <script type="text/javascript" src="../../BwCore/RenderController.js"></script>
    <script type="text/javascript" src="../../BwCore/SelectionListener.js"></script>    
    <script type="text/javascript" src="../../BwCore/ViewportLayout.js"></script>
    <script type="text/javascript" src="../../BwCore/GridLayout.js"></script>
    <script type="text/javascript" src="../../BwCore/ViewportMgr.js"></script>
    <script type="text/javascript" src="../../BwCore/RasterComponentEventListener.js"></script>
    <script type="text/javascript" src="../../BwCore/ParentableMotionUtil.js"></script>
    <script type="text/javascript" src="../../ContentHandler/LWObjectHandler.js"></script>
    <script type="text/javascript" src="../../ContentHandler/LWObjectBuilder.js"></script>
    <script type="text/javascript" src="../../ContentHandler/LWSceneHandler.js"></script>
    <script type="text/javascript" src="../../ContentHandler/LWSceneBuilder.js"></script>
    <script type="text/javascript" src="../../Attribute/AttributeFactory.js"></script>
    <script type="text/javascript" src="../../BwCore/bridgeworks.js"></script>
      <script type="text/javascript" src="./scripts/editor.js"></script>
    
    <link type="text/css" rel="stylesheet" href="style.css" />
    <!-- jquery stuff -->
    <link type="text/css" rel="stylesheet" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css"/>
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="http:////code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <script src="../../Libs/jquery/jquery.hoverIntent.minified.js" type="text/javascript" charset="utf-8"></script> 
	<script src="../../Libs/jquery/jquery.bgiframe.min.js" type="text/javascript" charset="utf-8"></script> 
    <script src="../../Libs/jquery/bt/jquery.bt.min.js" type="text/javascript" ></script>
    <script src="../../Libs/jquery/bootstrap-wysiwyg.js" type="text/javascript" ></script>
    <script src="../BwHelper.js"></script>
    
    <!-- application scripts -->
    <script type="text/javascript" src="./scripts/crossbrowser.js"></script>
    <script type="text/javascript" src="./scripts/controls.js"></script>

    <script type="text/javascript" src="../Bootstrap/js/bootstrap.min.js"></script>
    <link type="text/css" rel="StyleSheet" href="../../bridgeworks.css"/>
    <link type="text/css" rel="StyleSheet" href="../Bootstrap/css/bootstrap.min.css"/>
    
  </head> 
  <body onresize="resize();">
      
      <script type="text/javascript">
          var bridgeworks = null;
          var count = 0;
          var g_labelCount = 0;
          var g_labelName = null;
          var g_countStr = "";
          var selected;
          var url = document.location.href + "/../BwContent/objects/Cube.lwo";
          var motion = document.location.href + "/../BwContent/motions/spin-y.mot";
          var selectedId;
          
          var selectedModel = null;
          
          var capture = false;
          
            function addRecord()
            {
                var title = $( "#title" ).val();
                //var title = "Hello I am a cube. A mighty mighty cube!";
                if (title != "") {
                    var update = "\<Set target='Label_" + g_labelName + "' text='" + title + "' show='true'/>";
                    console.debug(update);
                    bridgeworks.updateScene(update);

                    // This flag is checked on dialog close. If true on close
                    // then there are some things to undo.
                    // If we made it this far then there is nothing to undo.
                    adding = false;
                }

                 $( "#dialog").dialog("close");
            }
            
          function createRecord()
          {
              $( "#dialog").dialog("open");
              
              adding = true;
              
              
              var pointWorld = bridgeworks.selector.pointWorld.getValueDirect();
                          
              g_labelCount = g_labelCount + 1;
              g_countStr = g_labelCount.toString();
              
              g_labelName = "L-" + g_countStr;
              
              var xml = loadXMLFile("bwcontent/label.xml");
              
              var name = xml.getElementsByTagName("Model")[0].attributes[0];
              name.value = g_labelName;
              
              var pos = xml.getElementsByTagName("position")[0];
              pos.attributes["x"].value = pointWorld.x.toString();
              pos.attributes["y"].value = pointWorld.y.toString();
              pos.attributes["z"].value = pointWorld.z.toString();
              
              var label = xml.getElementsByTagName("Label")[0];
              label.attributes["name"].value = "Label_" + name.value;
              label.attributes["parent"].value = name.value;
              
              name = xml.getElementsByTagName("Group")[0].attributes[0];
              name.value = "Group_" + g_labelName;
              
              
              var xstr = (new XMLSerializer()).serializeToString(xml);
              console.debug(xstr);
              //console.debug(g_labelCount);
              bridgeworks.updateScene(xstr);

              //Runs add record which adds the text to the screen and the end of creating the record
              //addRecord();
          }

          //On click is called to reposition the camera.
          function reposition(){

              adding = true;

              var name = "Camera";
              var comd = "";

              switch(count) {

                  case 0:
                      comd = "\<AutoInterpolate target='" + name + "'>";
                      comd += "\<position x='" + 8 + "' y='" + 3 + "' z='" + -5 + "'/>";
                      comd += "\<rotation x='" + 15 + "' y='" + -55 + "' z='" + 0 + "'/>";
                      comd += "\</AutoInterpolate>";
                      count = count + 1;
                      break;
                  case 1:
                      comd = "\<AutoInterpolate target='" + name + "'>";
                      comd += "\<position x='" + 8 + "' y='" + 3 + "' z='" + 0 + "'/>";
                      comd += "\<rotation x='" + 15 + "' y='" + -90 + "' z='" + 0 + "'/>";
                      comd += "\</AutoInterpolate>";
                      count = count + 1;
                      break;

                  case 2:
                      comd = "\<AutoInterpolate target='" + name + "'>";
                      comd += "\<position x='" + 8 + "' y='" + 3 + "' z='" + 5 + "'/>";
                      comd += "\<rotation x='" + 15 + "' y='" + -120 + "' z='" + 0 + "'/>";
                      comd += "\</AutoInterpolate>";
                      count = count + 1;
                      break;

                  case 3:
                      comd = "\<AutoInterpolate target='" + name + "'>";
                      comd += "\<position x='" + 0 + "' y='" + 3 + "' z='" + 8 + "'/>";
                      comd += "\<rotation x='" + 15 + "' y='" + -180 + "' z='" + 0 + "'/>";
                      comd += "\</AutoInterpolate>";
                      count = count + 1;
                      break;
              }

              console.debug(comd);
              bridgeworks.updateScene(comd);
          }
          
          
          // This function makes it so that mouse interaction with the scene
          // continues when the cursor moves out of the Bridgeworks frame.
          function handleDocMove(event)
          {
              if (capture) bridgeworks.handleEvent(event);
          }

          function handleEvent(e)
          {
              bridgeworks.handleEvent(e);
              
              switch(e.type) {
                case "mousedown": {
                    capture = true;
                    if (e.shiftKey) {
                        console.debug("SHIFTY");
                        bridgeworks.updateScene("ObjectInspection.xml");
                    }
                }
                    break;
                case "mouseup":
                    capture = false;
                    if (!e.shiftKey) {
                        console.debug("NOT SHIFTY");
                        bridgeworks.updateScene("SceneInspection.xml");
                    }
                    break;
                case "click": {
                    /*if (!e.metaKey && !e.ctrlKey) {
                        selectedModel = bridgeworks.selector.selections.models[0];
                        if (selectedModel) {
                            var pos = selectedModel.position.getValueDirect();
                            $("#positionX").spinner("value", pos.x);
                            $("#positionY").spinner("value", pos.y);
                            $("#positionZ").spinner("value", pos.z);
                            
                            var rot = selectedModel.rotation.getValueDirect();
                            $("#rotationX").spinner("value", rot.x);
                            $("#rotationY").spinner("value", rot.y);
                            $("#rotationZ").spinner("value", rot.z);
                            
                            $("#scale").spinner("value", selectedModel.scale.getValueDirect().x);
                            $('#objectname').val(selectedModel.name.getValueDirect().join(""));
                            
                        }
                    }*/
                    selected = bridgeworks.selector.selectedName.getValueDirect().join("");
                    console.log(selected);
                    selectedId = bridgeworks.selector.getAttribute("Selected").id;
                    
                    capture = false;
                }
                break;
                case "dblclick": {
                    var name = selectedModel.name.getValueDirect().join("");
                    var pointWorld = bridgeworks.selector.pointWorld.getValueDirect();
                    var cmd = "";
                    if (e.metaKey || e.ctrlKey) {
                        cmd = "\<AutoInterpolate target='" + name + "'>";
                        cmd += "\<position x='" + pointWorld.x + "' y='" + pointWorld.y + "' z='" + pointWorld.z + "'/>"
                        cmd += "\</AutoInterpolate>";
                    }
                    else {
                        cmd = "\<Locate target='" + name + "'/>";
                    }
                    bridgeworks.updateScene(cmd);
                }
                break;
              }
              
          }
          
          function handleKey(e)
          {
              switch(e.keyCode) {
                case 'C'.charCodeAt(0): {
                    var cmd = "\<Remove target='"+selected+"'/>";
                    var div = document.getElementById(selectedId);
                    bridgeworks.updateScene(cmd);
                    div.parentNode.removeChild(div);
                    //console.log(cmd);
                }
                break;
                case 'V'.charCodeAt(0): {      // v
                    var scene = bridgeworks.getRegistry().find("SceneInspector");
                    scene.panDelta.values[2] += 10;
                    scene.evaluate();
                    console.log(scene);
                    bridgeworks.updateScene();
                    //console.log(scene.panDelta);
                }
                break;
                case 'X'.charCodeAt(0): {      // x
                        bridgeworks.onLoadModified();
                        bridgeworks.updateScene("grid-100.xml");
                }
                break;
                
              }
          }
          
      </script>
      
            <img id="BackgroundImage" style="position: absolute;" src="bwcontent/images/white.png"/>

      
    <div id="ControlPanel" class="container container-fluid">
        <div class="row" style="border:1px none;">
            <div id="PanelSceneControllers" class="col-sm-2">


                <!--Changed locate to add motion for testing purposes-->
                <input id="objectname"/><button onclick="loadMotion(motion);;">Add Motion</button>


                <!--Changed the home button to put a label on the screen for the time being-->
                    <button onclick="createRecord();">Create Label</button>
                    <br/>

                    <br/>
                    <button onclick="bridgeworks.renderController.pause();">Pause</button>
                    <button onclick="bridgeworks.renderController.play();">Play</button>
                    <button onclick="bridgeworks.renderController.stop();">Stop</button>
            </div>
            <div id="PanelObjectControllers" class="col-sm-4">
                <table>
                        <tr>
                            <td>rotate it</td>
                            <td><input class="spin" id="rotationX" name="rotationX"></input></td>
                            <td><input class="spin" id="rotationY" name="rotationY"></input></td>
                            <td><input class="spin" id="rotationZ" name="rotationZ"></input></td>
                            
                        </tr>
                        <tr>
                            <td>move it</td>
                            <td><input class="spin" id="positionX" name="positionX"></input></td>
                            <td><input class="spin" id="positionY" name="positionY"></input></td>
                            <td><input class="spin" id="positionZ" name="positionZ"></input></td>
                        </tr>
                        <tr>
                            <td>size it</td>
                            <td><input class="spin" id="scale" name="scale"></input></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <!--
                        <tr>
                            <td>global light</td>
                            <td><input class="spin" id="ambientR" name="ambientR"></input></td>
                            <td><input class="spin" id="ambientG" name="ambientG"></input></td>
                            <td><input class="spin" id="ambientB" name="ambientB"></input></td>
                        </tr>
                        <tr>
                            <td>model color</td>
                            <td><input class="spin" id="modelR" name="modelR"></input></td>
                            <td><input class="spin" id="modelG" name="modelG"></input></td>
                            <td><input class="spin" id="modelB" name="modelB"></input></td>
                        </tr>
                        -->
                    </table>

            </div>
            <div id="panel-lib-objects" class="col-sm-2">
                <h4>Models</h4>
            </div>
            <div id="panel-lib-motions" class="col-sm-2">
                <h4>Motions</h4>
            </div>
            <div id="panel-curr-scene" class="col-sm-2">
                <h4>Current Scene</h4>
            </div>
        </div>
        <div class="row" style="border:1px none;">
            <div class="col-sm-6">


                <!--Manually set load to load a cube so I can put motion to it-->
                <input id="url" size="60"/><button onclick="load(url);">Load</button>


            </div>
            <div class="col-sm-6">
            </div>
        </div>
    </div>
    <center>
    <div class="slide"><a href="#" class="btn-slide">Tools</a></div>
    </center>


    <!--Changed what was being called on doubleclick to create a label and onclick to reposition the camera to certain camera cords-->
    <div id="BwContainer" ondblclick="reposition();" onclick="handleEvent(event);" onmousedown="handleEvent(event);" onmouseup="handleEvent(event);" onmousemove="handleEvent(event);">
      <canvas id="Canvas">
      </canvas>     
    </div>

      <!--ondblclick="handleEvent(event);" onclick="handleEvent(event);" onmousedown="createRecord();"-->
<div id="dialog" title="Please enter your description for this item below">
    <form id="my-form" enctype="multipart/form-data" method="post">
        <p>Title: <input type="text" id="title"></p>
        <p><input type="button" value="Submit" onclick="addRecord()"></p>
    </form>
</div>

    
    <!--<video controls="controls" src="http://localhost/bwjs/bwcontent/images/quake.mpg">
    Your browser does not support the video tag.
    </video>-->
        
        <script type="text/javascript">
        document.onreadystatechange = function () {
            if (document.readyState == "complete") {
                
                bridgeworks = init("grid-100.xml", document.getElementById("BwContainer"));
                
                listLibrary();
                
                
                $('html').bind('keypress', function(e)
                {
                   if(e.keyCode == 13)
                   {
                       if ($("#dialog").dialog( "isOpen" )===true) {
                           addRecord();
                       }
                       return false;
                   }
                });

                
                $( "#dialog" ).dialog({ autoOpen: false });
            
                $( "#dialog" ).dialog({ show: { effect: "blind", duration: 200 } });
            
                $( "#dialog" ).dialog({ hide: { effect: "blind", duration: 200 } });
          
                $( "#dialog" ).dialog({
                  close: function( event, ui ) {
                      if (adding) {
                          // if in the middle of adding and closed w/o submitting
                          bridgeworks.updateScene("\<Remove target='" + "Group_L-" + g_countStr + "'/>");
                      }
                      adding = false;
                  }
                });
                
                
                $(".btn-slide").click(function(){
                		$("#ControlPanel").slideToggle("medium");
                		$(this).toggleClass("active"); return false;
                	});
                
                window.onkeydown = handleKey;
                //window.onkeyup = handleKey;
                
                $('.ui-spinner-button').click(function() { $(this).siblings('input').change(); });
                
                
            }
        }
        </script>

  </body>
</html>
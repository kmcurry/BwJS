<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	 "http://www.w3.org/TR/html4/strict.dtd">

<html>

<head>
	<meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7;" > 
	<meta http-equiv="content-type" content="text/html;charset=utf-8">
<!-- JSModeler includes start -->
	<script type="text/javascript" src="../src/core/jsm.js"></script>
	<script type="text/javascript" src="../src/core/timer.js"></script>
	<script type="text/javascript" src="../src/core/algorithm.js"></script>
	<script type="text/javascript" src="../src/core/async.js"></script>
	<script type="text/javascript" src="../src/geometry/coord.js"></script>
	<script type="text/javascript" src="../src/geometry/determinant.js"></script>
	<script type="text/javascript" src="../src/geometry/coordutils.js"></script>
	<script type="text/javascript" src="../src/geometry/matrix.js"></script>
	<script type="text/javascript" src="../src/geometry/coordsystem.js"></script>
	<script type="text/javascript" src="../src/geometry/coordsystemutils.js"></script>
	<script type="text/javascript" src="../src/geometry/sector.js"></script>
	<script type="text/javascript" src="../src/geometry/sectorutils.js"></script>
	<script type="text/javascript" src="../src/geometry/line.js"></script>
	<script type="text/javascript" src="../src/geometry/lineutils.js"></script>
	<script type="text/javascript" src="../src/geometry/transformation.js"></script>
	<script type="text/javascript" src="../src/geometry/transformationutils.js"></script>
	<script type="text/javascript" src="../src/geometry/plane.js"></script>
	<script type="text/javascript" src="../src/geometry/planeutils.js"></script>
	<script type="text/javascript" src="../src/geometry/projection.js"></script>
	<script type="text/javascript" src="../src/geometry/convexhull.js"></script>
	<script type="text/javascript" src="../src/geometry/polygon.js"></script>
	<script type="text/javascript" src="../src/geometry/polygonutils.js"></script>
	<script type="text/javascript" src="../src/geometry/bsptree.js"></script>
	<script type="text/javascript" src="../src/geometry/utilities.js"></script>
	<script type="text/javascript" src="../src/modeler/body.js"></script>
	<script type="text/javascript" src="../src/modeler/model.js"></script>
	<script type="text/javascript" src="../src/modeler/color.js"></script>
	<script type="text/javascript" src="../src/modeler/light.js"></script>
	<script type="text/javascript" src="../src/modeler/material.js"></script>
	<script type="text/javascript" src="../src/modeler/bodyutils.js"></script>
	<script type="text/javascript" src="../src/modeler/adjacencylist.js"></script>
	<script type="text/javascript" src="../src/modeler/textureutils.js"></script>
	<script type="text/javascript" src="../src/modeler/cututils.js"></script>
	<script type="text/javascript" src="../src/modeler/generator.js"></script>
	<script type="text/javascript" src="../src/modeler/camera.js"></script>
	<script type="text/javascript" src="../src/modeler/explode.js"></script>
	<script type="text/javascript" src="../src/modeler/exporter.js"></script>
	<script type="text/javascript" src="../src/import/trianglemodel.js"></script>
	<script type="text/javascript" src="../src/import/binaryreader.js"></script>
	<script type="text/javascript" src="../src/import/importer.js"></script>
	<script type="text/javascript" src="../src/import/importer3ds.js"></script>
	<script type="text/javascript" src="../src/import/importerobj.js"></script>
	<script type="text/javascript" src="../src/import/importerstl.js"></script>
	<script type="text/javascript" src="../src/import/importercommon.js"></script>
	<script type="text/javascript" src="../src/extras/solidgenerator.js"></script>
	<script type="text/javascript" src="../src/extras/extgenerator.js"></script>
	<script type="text/javascript" src="../src/extras/painter.js"></script>
	<script type="text/javascript" src="../src/extras/drawing.js"></script>
	<script type="text/javascript" src="../src/extras/subdivision.js"></script>
	<script type="text/javascript" src="../src/extras/svgtomodel.js"></script>
	<script type="text/javascript" src="../src/extras/csg.js"></script>
	<script type="text/javascript" src="../src/extras/surfaces.js"></script>
	<script type="text/javascript" src="../src/renderer/renderer.js"></script>
	<script type="text/javascript" src="../src/renderer/pointcloudrenderer.js"></script>
	<script type="text/javascript" src="../src/renderer/converter.js"></script>
	<script type="text/javascript" src="../src/viewer/jsonfileloader.js"></script>
	<script type="text/javascript" src="../src/viewer/mouse.js"></script>
	<script type="text/javascript" src="../src/viewer/touch.js"></script>
	<script type="text/javascript" src="../src/viewer/navigation.js"></script>
	<script type="text/javascript" src="../src/viewer/softwareviewer.js"></script>
	<script type="text/javascript" src="../src/viewer/spriteviewer.js"></script>
	<script type="text/javascript" src="../src/viewer/viewer.js"></script>
	<script type="text/javascript" src="../src/viewer/pointcloudviewer.js"></script>
	<script type="text/javascript" src="../src/three/threeconverter.js"></script>
	<script type="text/javascript" src="../src/three/threeviewer.js"></script>
<!-- JSModeler includes end -->
	<script type="text/javascript" src="../documentation/examples/tictactoe.js"></script>
	<style>
		html, body
		{
			margin : 0px;
			padding : 0px;
			width : 100%;
			height : 100%;
		}

		canvas
		{
			display : block;
		}
	</style>
	
	<title>Example</title>

	<script type="text/javascript">
		var viewer = null;
		var tictactoe = null;
		
		var mouseMoved = null;
		var hasWinner = null;
		var error = null;
		
		function OnDrawStart (canvas)
		{
			var context = canvas.getContext ('2d');
			context.clearRect (0, 0, canvas.width, canvas.height);
		}
		
		function OnPointDraw (canvas, index, projected)
		{
			var context = canvas.getContext ('2d');
			var x = projected.x;
			var y = projected.y;
			
			var radius = 10;
			var fromColor = '#eeeeee';
			var toColor = '#bbbbbb';
			
			var player = ticTacToe.GetPlayerWithIndex (index);
			if (player == 1) {
				radius = 30;
				fromColor = '#0000ff';
				toColor = '#0000aa';
			} else if (player == 2) {
				radius = 30;
				fromColor = '#ff0000';
				toColor = '#aa0000';
			}
			
			context.beginPath ();
			radialGradient = context.createRadialGradient (x, y, 0, x, y, radius);
			radialGradient.addColorStop (0, fromColor);
			radialGradient.addColorStop (1, toColor);
			context.fillStyle = radialGradient;
			context.arc (x, y, radius, 0.0, 2.0 * Math.PI, false);
			
			context.fill ();
		}
	
		function OnDrawEnd (canvas)
		{
		}

		function OnMouseDown (event)
		{
			mouseMoved = false;
		}
		
		function OnMouseMove (event)
		{
			mouseMoved = true;
		}

		function OnMouseUp (event)
		{
			if (!mouseMoved) {
				var index = viewer.NearestPointUnderMouse (50);
				if (index != -1) {
					UserStep (index);
				}
			}
			
			mouseMoved = false;
		}

		function Reset (difficulty)
		{
			if (error) {
				return;
			}
			
			if (difficulty == -1) {
				difficulty = 1;
				if (ticTacToe !== null) {
					difficulty = ticTacToe.GetDifficulty ();
				}
			}
			ticTacToe.Initialize (3, difficulty);
			
			viewer.RemovePoints ();
			
			var offset = ticTacToe.shapeSize * 1.5;
			var i, j, k;
			for (k = 0; k < ticTacToe.zSize; k++) {
				for (j = 0; j < ticTacToe.ySize; j++) {
					for (i = 0; i < ticTacToe.xSize; i++) {
						viewer.AddPoint (new JSM.Coord (offset * i, offset * j, offset * k));
					}
				}
			}
			
			hasWinner = false;
			viewer.Draw ();
		}

		function UserStep (index)
		{
			if (hasWinner) {
				return;
			}		
		
			if (ticTacToe.GetPlayerWithIndex (index) != 0) {
				return;
			}

			var player, step;
			for (player = 1; player <= 2; player++) {
				if (player == 1) {
					step = index;
				} else if (player == 2) {
					step = ticTacToe.CalculateComputerStep ();
				}
				ticTacToe.StepWithIndex (player, step);
				winner = ticTacToe.GetWinner ()
				if (winner != -1) {
					hasWinner = true;
					break;
				}
			}
			viewer.Draw ();
		}
		
		function Resize ()
		{
			var canvas = document.getElementById ('example');
			canvas.width = document.body.clientWidth;
			canvas.height = document.body.clientHeight;
			if (viewer !== null) {
				viewer.Draw ();
			}
		}

		function Load ()
		{
			window.onresize = Resize;
			Resize ();

			ticTacToe = new TicTacToe ();

			var viewerCallbacks = {
				onDrawStart : OnDrawStart,
				onPointDraw : OnPointDraw,
				onDrawEnd : OnDrawEnd
			};

			var canvasName = 'example';
			var canvas = document.getElementById (canvasName);
			if (canvas.addEventListener) {
				canvas.addEventListener ('mousedown', function (event) {OnMouseDown (event);}, false);
				canvas.addEventListener ('mousemove', function (event) {OnMouseMove (event);}, false);
				canvas.addEventListener ('mouseup', function (event) {OnMouseUp (event);}, false);
				//canvas.addEventListener ('touchstart', function (event) {OnTouchStart (event);}, false);
				//canvas.addEventListener ('touchmove', function (event) {OnTouchMove (event);}, false);
				//canvas.addEventListener ('touchend', function (event) {OnTouchEnd (event);}, false);
			}

			mouseMoved = false;
			error = false;

			var camera = new JSM.Camera (
				new JSM.Coord (14.0, -14.0, 16.0),
				new JSM.Coord (3.0, 3.0, 3.0),
				new JSM.Vector (0.0, 0.0, 1.0)
			);

			viewer = new JSM.SpriteViewer ();
			if (!viewer.Start (canvasName, camera, viewerCallbacks)) {
				error = true;
				return;
			}
			
			Reset (1);
		}
		
		window.onload = function ()
		{
			Load ();			
		}
	</script>

</head>

<body>
	<canvas id="example" width="800" height="500"></canvas>
</body>

</html>

function Base() 
{
    this.userData = "";
    this.className = "";
}

Base.prototype.destroy = function()
{
    delete this;
}

function Allocator()
{
}
//These are created in global scope that way 3Scape can access them
var message = "";
var imgeData = "";
var cimageData = "";
var serializedScene = "";

Allocator.prototype.allocate = function()
{
    return null;
}
function loadBinaryResource(url)
{
    var req = new XMLHttpRequest();
    
    req.open('GET', url, false);
    req.overrideMimeType('text/plain; charset=x-user-defined');
    req.send();
    
    if (req.status != 200)
    {
        return null;
    }
    
    return req.responseText;
}

function loadXMLResource(url)
{
    var req = new XMLHttpRequest();
 
    req.open('GET', url, false);
    req.overrideMimeType('text/plain; charset=x-user-defined');    
    req.send();
    
    if (req.status != 200)
    {
        return null;
    }
    
    return req.responseText;
}

function loadTextResource(url)
{
    var req = new XMLHttpRequest();
 
    req.open('GET', url, false);
    req.overrideMimeType('text/plain; charset=x-user-defined');    
    req.send();
    
    if (req.status != 200)
    {
        return null;
    }
    
    return req.responseText;
}

function isLower(c)
{
    var ascii = c.charCodeAt(0);
    return (ascii > 96 && ascii < 123);
}

function isUpper(c)
{
    var ascii = c.charCodeAt(0);
    return (ascii > 64 && ascii < 91);
}

function isSpace(c)
{
    if (c == ' '  || 
        c == '\f' ||
        c == '\n' ||
        c == '\r' ||
        c == '\t' ||
        c == '\v')
        return true;
        
    return false;
}

// From: http://blog.magnetiq.com/post/514962277/finding-out-class-names-of-javascript-objects
/* Returns the class name of the argument or undefined if
   it's not a valid JavaScript object.
*/
function getObjectClassName(obj) {
    if (obj && obj.constructor && obj.constructor.toString) {
        var arr = obj.constructor.toString().match(
            /function\s*(\w+)/);

        if (arr && arr.length == 2) {
            return arr[1];
        }
        
        // match [method name]
        arr = obj.constructor.toString().split(" ");
        
        if (arr && arr.length == 2) {
            return arr[1].substring(0, arr[1].length-1);
        }
    }

    return undefined;
}

/*  takes string to an absolute or relative URL 
    returns an array containing a valid Bw path
    and the expected content directory.
    DOES NOT ENSURE CONTENT EXISTS
    Treat is like our best guess
*/
function formatPath(url)
{
    var result = [];
    
    var validPath = "";
    var validDir  = "";
    
    try {
        $.ajax({
            url: url,
            type:'HEAD',
            async: false,
            error: function()
            {
                console.debug(url + " does not exist.");
                // could be a relative path
                var href = document.location.href;
                
                validPath = href.substring(0, href.lastIndexOf("/")) + "/" + bridgeworks.contentDir + "/" + url;
                
                console.debug("Trying: " + validPath);
                
                var ndx = validPath.lastIndexOf("objects/");
                if (ndx == -1) ndx = validPath.lastIndexOf("motions/");
                if (ndx == -1) ndx = validPath.lastIndexOf("envelopes/");
                if (ndx == -1) ndx = validPath.lastIndexOf("scenes/");
                
                validDir = validPath.substring(0, ndx);
                
                console.debug("With contentDir: " + validDir);  
            },
            success: function()
            {
                var href = document.location.href;
                
                validPath = url;
                
                var ndx = validPath.lastIndexOf("objects/");
                if (ndx == -1) ndx = validPath.lastIndexOf("motions/");
                if (ndx == -1) ndx = validPath.lastIndexOf("envelopes/");
                if (ndx == -1) ndx = validPath.lastIndexOf("scenes/");
                
                //validDir = validPath.substring(0, ndx);
                validDir = href.substring(0, href.lastIndexOf("/")) + "/" + bridgeworks.contentDir;
                
                console.debug("File found: " + validPath);
            }
        });
        
        result[0] = validPath;
        result[1] = validDir;
    } catch (e) {
        
    }
    
    return result;
}

/**
 * Determine if the filename represents a full path.
 * @params filePath     - the filename [path] string.
 * @return bool         - boolean indicating if the filename represents a full path.
 */
function isFullPath(filePath)
{
    // check for // or \\ in beginning of pathname (UNC filename)
    var unc = false;
    var filePathLen = filePath.length;
    if (filePathLen >= 2)
    {
        if ((filePath[0] == '\\' || filePath[0] == '/') &&
            (filePath[1] == '\\' || filePath[1] == '/'))
        {
            unc = true;
        }
    }       

    // check if file path is a full path
    if (unc || filePath.indexOf(':') >= 0)
    {
        return true;
    }

    return false;
}

/**
 * Form a full path string by appending a filename [path] to a directory path.
 * @params filePath     - the filename [path] string.
 * @params dirPath      - the directory path string.
 * @return string       - the output string.
 */
function formFullPath(filePath, dirPath)
{
    var fullPath = new String();

    if (!filePath || !dirPath)
    {
        return null;
    }      

    // check if file path is already a full path
    if (isFullPath(filePath))
    {
        fullPath = filePath;
    }
    else // file path is relative, formulate full path
    {
        fullPath = dirPath;
        if (fullPath.length > 0)
        {
            var last = fullPath.charAt(fullPath.length - 1);
            if (last != '/' && last != '\\')
            {
                fullPath += '/';
            }
        }
        
        // don't allow "//" in the filepath (Minefield doesn't like that)
        if (filePath[0] == '/' || filePath[0] == "\\")
        {
            fullPath += filePath.slice(1);
        }
        else
        {
            fullPath += filePath;
        }
    }

    return fullPath;
}

function getFileExtension(filename)
{
    var ext = null;
    var lastDot = filename.lastIndexOf(".");
    if (lastDot != -1)
    {
        var ext = "";
        ext = filename.substr(lastDot+1)
        return ext;
    }

    return ext;    
}

function getBrowserName()
{
    var browser = new String(navigator.userAgent);
    
    // chrome
    if (browser.indexOf("Chrome") >= 0) return "Chrome";

    // firefox
    if (browser.indexOf("Firefox") >= 0) return "Firefox";

    return undefined;
}

function OutputDebugMsg(msg)
{
    var innerHTML = document.getElementById("DebugOutput").innerHTML;
    innerHTML += "&gt; " + msg + "<br>";
    document.getElementById("DebugOutput").innerHTML = innerHTML;
}

function addSlashAfterDriveSpecifier(filename)
{
    var index = filename.indexOf(":");
    if (index == -1) return filename;
    
    filename = filename.slice(0, index+1) + "\\" + filename.slice(index+1);
    return filename;
}

function hexStrToULong(string)
{
    // find end of string
    var i = string.length - 1;

    var value = 0;
    var digit = 0;
    var position = 0;
    for ( ; i >= 0; i--, position++)
    {
        switch (string.charAt(i))
        {
        case '0': digit = 0;  break;
        case '1': digit = 1;  break;
        case '2': digit = 2;  break;
        case '3': digit = 3;  break;
        case '4': digit = 4;  break;
        case '5': digit = 5;  break;
        case '6': digit = 6;  break;
        case '7': digit = 7;  break;
        case '8': digit = 8;  break;
        case '9': digit = 9;  break;

        case 'a':
        case 'A': digit = 10; break;

        case 'b':
        case 'B': digit = 11; break;

        case 'c':
        case 'C': digit = 12; break;

        case 'd':
        case 'D': digit = 13; break;

        case 'e':
        case 'E': digit = 14; break;

        case 'f':
        case 'F': digit = 15; break;

        default:  digit = 0;  break;
        }

        value += (digit * Math.pow(16, position));
    }

    return value;
}

function Color(r, g, b, a)
{
    this.r = r || 0;
    this.g = g || 0;
    this.b = b || 0;
    this.a = a || 0;
}

Color.prototype.v = function()
{
    var values = [ this.r, this.g, this.b, this.a ];
    return values; 
}

Color.prototype.load = function(r, g, b, a)
{
    this.r = r;
    this.g = g;
    this.b = b;
    this.a = a;
}

Color.prototype.copy = function(color)
{
    if (color)
    {
        this.r = color.r;
        this.g = color.g;
        this.b = color.b;
        this.a = color.a;
    }
}

function Pair(first, second)
{
    this.first = first;
    this.second = second;
}

function Rect(left, top, right, bottom)
{
    this.left = left || 0;
    this.top = top || 0;
    this.right = right || 0;
    this.bottom = bottom || 0;
}

Rect.prototype.load = function(left, top, right, bottom)
{
    this.left = left;
    this.top = top;
    this.right = right;
    this.bottom = bottom;
}

Rect.prototype.loadRect = function(rect)
{
    this.left = rect.left;
    this.top = rect.top;
    this.right = rect.right;
    this.bottom = rect.bottom;
}

function Viewport(x, y, width, height)
{
    this.x = x || 0;
    this.y = y || 0;
    this.width = width || 0;
    this.height = height || 0;
    
    this.equals = function(rhs)
    {
        return (this.x == rhs.x &&
                this.y == rhs.y &&
                this.width == rhs.width &&
                this.height == rhs.height); 
    }
}

Viewport.prototype.load = function(x, y, width, height)
{
    this.x = x;
    this.y = y;
    this.width = width;
    this.height = height;
}

Viewport.prototype.loadViewport = function(vp)
{
    this.x = vp.x;
    this.y = vp.y;
    this.width = vp.width;
    this.height = vp.height;
}

Viewport.prototype.containsPoint = function(x, y)
{
    if (x >= this.x &&
        y >= this.y &&
        x <= (this.x + this.width) &&
        y <= (this.y + this.height))
        return true;

    return false;
}
function Stack(element)
{
    this.stack = new Array();
    this.maxLength = 0;

    if (element)
    {
        this.stack.push(element);
    }
}

Stack.prototype.push = function(element)
{
    if (this.maxLength > 0 && this.stack.length >= this.maxLength)
    {
        this.pop();
    }

    this.stack.push(element);
}

Stack.prototype.pop = function()
{
    if (this.stack.length > 0)
    {
        this.stack.pop();
    }
}

Stack.prototype.load = function(element)
{
    this.pop(); // does nothing if empty
    this.push(element);
}

Stack.prototype.top = function()
{
    if (this.stack.length > 0)
    {
        return this.stack[this.stack.length - 1];
    }

    return null;
}

Stack.prototype.getAt = function(index)
{
    if (this.stack.length > index)
    {
        return this.stack[index];
    }

    return null;
}

Stack.prototype.length = function()
{
    return this.stack.length;
}

Stack.prototype.empty = function()
{
    return this.stack.length == 0;
}

Stack.prototype.clear = function()
{
    this.stack.length = 0;
}

Stack.prototype.copy = function()
{
    return this.stack.slice();
}
function Queue(element)
{
	this.queue = new Array();
    this.maxLength = 0;
    
    if (element)
    {
        this.queue.push(element);
    }
}

Queue.prototype.push = function(element)
{
	if (this.maxLength > 0 && this.queue.length >= this.maxLength)
	{
		this.pop();
	}
	
    this.queue.push(element);
}

Queue.prototype.pop = function()
{
    if (this.queue.length > 0)
    {
        this.queue.shift();
    }
}

Queue.prototype.load = function(element)
{
    this.pop(); // does nothing if empty
    this.push(element);
}

Queue.prototype.front = function()
{
    if (this.queue.length > 0)
    {
        return this.queue[0];
    }
    
    return null;
}

Queue.prototype.getAt = function(index)
{
    if (this.queue.length > index)
    {
        return this.queue[index];
    }
    
    return null;
}

Queue.prototype.length = function()
{
    return this.queue.length;
}

Queue.prototype.empty = function()
{
    return this.queue.length == 0;
}

Queue.prototype.clear = function()
{
    this.queue.length = 0;
}

Queue.prototype.copy = function()
{
    return this.queue.slice();
}

var gAttributeBin = null;
var gAttributePairs = null;

function setAttributeBin(bin)
{
    gAttributeBin = bin;
}

function setAttributePairs(pairs)
{
    gAttributePairs = pairs;
}

function deserializeAttributeContainer(container, atts)
{
    for (var i=0; i < atts.length; i++)
    {
        var attribute = container.getAttribute(atts[i][0]);
        if (attribute)
        {
            deserializeAttribute(attribute, atts[i][1]);
        }
    }
    
    container.flagDeserializedFromXML();
}

function deserializeComplexAttribute(attribute, atts)
{
    var values = [];
    for (var i=0; i < atts.length; i++)
    {
        values.push(atts[i][1]);
    }
    if (values.length > 0) 
    {
        if (!gAttributeBin)
        {
            setAttributeValue(attribute, values);
        }
        else // gAttributeBin != null
        {
            gAttributeBin.push(new Pair(attribute, values));
        }
    }
    
    attribute.flagDeserializedFromXML();
}

function deserializeAttribute(attribute, value)
{
    // TODO: search value for operators
    
    if (!gAttributeBin)
    {
        setAttributeValue(attribute, value);
    }
    else // gAttributeBin != null
    {
        gAttributeBin.push(new Pair(attribute, value));
    }
    
    attribute.flagDeserializedFromXML();
}

function resolveAttributeContainerReference(container, atts, registry)
{
    if (atts.length > 0)
    {
        if (atts[0][0] == "ref")
        {
            var resource = registry.find(atts[0][1]);
            if (resource)
            {
                container.synchronize(resource, true);
                return true;
            } 
        }
    }
    
    return false;
}

function resolveComplexAttributeReference(attribute, atts)
{
    if (atts.length > 0)
    {
        if (atts[0][0] == "ref")
        {
            return resolvePrimitiveAttributeReference(attribute, atts[0][1]);
        }
    }

    return false;
}

function resolvePrimitiveAttributeReference(attribute, value)
{
    // TODO
    return false;
}

function resolveAttributeReference(source, target)
{
    if (!gAttributePairs)
    {
        target.copyValue(source);
    }
    else // gAttributePairs != null
    {
        gAttributePairs.push(new Pair(source, target));
    }
}
// =========================================================================
//
// xmlsax.js - an XML SAX parser in JavaScript.
//
// version 3.1
//
// =========================================================================
//
// Copyright (C) 2001 - 2002 David Joham (djoham@yahoo.com) and Scott Severtson
//
// This library is free software; you can redistribute it and/or
// modify it under the terms of the GNU Lesser General Public
// License as published by the Free Software Foundation; either
// version 2.1 of the License, or (at your option) any later version.

// This library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
// Lesser General Public License for more details.

// You should have received a copy of the GNU Lesser General Public
// License along with this library; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
//
//
// Visit the XML for <SCRIPT> home page at http://xmljs.sourceforge.net
//

// CONSTANTS

// =========================================================================
// =========================================================================
// =========================================================================
var whitespace = "\n\r\t ";


/***************************************************************************************************************
XMLP is a pull-based parser. The calling application passes in a XML string
to the constructor, then repeatedly calls .next() to parse the next segment.
.next() returns a flag indicating what type of segment was found, and stores
data temporarily in couple member variables (name, content, array of
attributes), which can be accessed by several .get____() methods.

Basically, XMLP is the lowest common denominator parser - an very simple
API which other wrappers can be built against.
*****************************************************************************************************************/


XMLP = function(strXML) {
    /*******************************************************************************************************************
    function:   this is the constructor to the XMLP Object

    Author:   Scott Severtson

    Description:
        Instantiates and initializes the object
    *********************************************************************************************************************/
    // Normalize line breaks
    strXML = SAXStrings.replace(strXML, null, null, "\r\n", "\n");
    strXML = SAXStrings.replace(strXML, null, null, "\r", "\n");

    this.m_xml = strXML;
    this.m_iP = 0;
    this.m_iState = XMLP._STATE_PROLOG;
    this.m_stack = new saxStack();
    this._clearAttributes();

}  // end XMLP constructor


// CONSTANTS    (these must be below the constructor)

// =========================================================================
// =========================================================================
// =========================================================================

XMLP._NONE    = 0;
XMLP._ELM_B   = 1;
XMLP._ELM_E   = 2;
XMLP._ELM_EMP = 3;
XMLP._ATT     = 4;
XMLP._TEXT    = 5;
XMLP._ENTITY  = 6;
XMLP._PI      = 7;
XMLP._CDATA   = 8;
XMLP._COMMENT = 9;
XMLP._DTD     = 10;
XMLP._ERROR   = 11;

XMLP._CONT_XML = 0;
XMLP._CONT_ALT = 1;

XMLP._ATT_NAME = 0;
XMLP._ATT_VAL  = 1;

XMLP._STATE_PROLOG = 1;
XMLP._STATE_DOCUMENT = 2;
XMLP._STATE_MISC = 3;

XMLP._errs = new Array();
XMLP._errs[XMLP.ERR_CLOSE_PI       = 0 ] = "PI: missing closing sequence";
XMLP._errs[XMLP.ERR_CLOSE_DTD      = 1 ] = "DTD: missing closing sequence";
XMLP._errs[XMLP.ERR_CLOSE_COMMENT  = 2 ] = "Comment: missing closing sequence";
XMLP._errs[XMLP.ERR_CLOSE_CDATA    = 3 ] = "CDATA: missing closing sequence";
XMLP._errs[XMLP.ERR_CLOSE_ELM      = 4 ] = "Element: missing closing sequence";
XMLP._errs[XMLP.ERR_CLOSE_ENTITY   = 5 ] = "Entity: missing closing sequence";
XMLP._errs[XMLP.ERR_PI_TARGET      = 6 ] = "PI: target is required";
XMLP._errs[XMLP.ERR_ELM_EMPTY      = 7 ] = "Element: cannot be both empty and closing";
XMLP._errs[XMLP.ERR_ELM_NAME       = 8 ] = "Element: name must immediatly follow \"<\"";
XMLP._errs[XMLP.ERR_ELM_LT_NAME    = 9 ] = "Element: \"<\" not allowed in element names";
XMLP._errs[XMLP.ERR_ATT_VALUES     = 10] = "Attribute: values are required and must be in quotes";
XMLP._errs[XMLP.ERR_ATT_LT_NAME    = 11] = "Element: \"<\" not allowed in attribute names";
XMLP._errs[XMLP.ERR_ATT_LT_VALUE   = 12] = "Attribute: \"<\" not allowed in attribute values";
XMLP._errs[XMLP.ERR_ATT_DUP        = 13] = "Attribute: duplicate attributes not allowed";
XMLP._errs[XMLP.ERR_ENTITY_UNKNOWN = 14] = "Entity: unknown entity";
XMLP._errs[XMLP.ERR_INFINITELOOP   = 15] = "Infininte loop";
XMLP._errs[XMLP.ERR_DOC_STRUCTURE  = 16] = "Document: only comments, processing instructions, or whitespace allowed outside of document element";
XMLP._errs[XMLP.ERR_ELM_NESTING    = 17] = "Element: must be nested correctly";

// =========================================================================
// =========================================================================
// =========================================================================


XMLP.prototype._addAttribute = function(name, value) {
    /*******************************************************************************************************************
    function:   _addAttribute

    Author:   Scott Severtson
    *********************************************************************************************************************/
    this.m_atts[this.m_atts.length] = new Array(name, value);
}  // end function _addAttribute


XMLP.prototype._checkStructure = function(iEvent) {
    /*******************************************************************************************************************
    function:   _checkStructure

    Author:   Scott Severtson
    *********************************************************************************************************************/
  
	if(XMLP._STATE_PROLOG == this.m_iState) {
		if((XMLP._TEXT == iEvent) || (XMLP._ENTITY == iEvent)) {
            if(SAXStrings.indexOfNonWhitespace(this.getContent(), this.getContentBegin(), this.getContentEnd()) != -1) {
				return this._setErr(XMLP.ERR_DOC_STRUCTURE);
            }
        }

        if((XMLP._ELM_B == iEvent) || (XMLP._ELM_EMP == iEvent)) {
            this.m_iState = XMLP._STATE_DOCUMENT;
            // Don't return - fall through to next state
        }
    }
    if(XMLP._STATE_DOCUMENT == this.m_iState) {
        if((XMLP._ELM_B == iEvent) || (XMLP._ELM_EMP == iEvent)) {
            this.m_stack.push(this.getName());
        }

        if((XMLP._ELM_E == iEvent) || (XMLP._ELM_EMP == iEvent)) {
            var strTop = this.m_stack.pop();
            if((strTop == null) || (strTop != this.getName())) {
                return this._setErr(XMLP.ERR_ELM_NESTING);
            }
        }

        if(this.m_stack.count() == 0) {
            this.m_iState = XMLP._STATE_MISC;
            return iEvent;
        }
    }
    if(XMLP._STATE_MISC == this.m_iState) {
		if((XMLP._ELM_B == iEvent) || (XMLP._ELM_E == iEvent) || (XMLP._ELM_EMP == iEvent) || (XMLP.EVT_DTD == iEvent)) {
			return this._setErr(XMLP.ERR_DOC_STRUCTURE);
        }

        if((XMLP._TEXT == iEvent) || (XMLP._ENTITY == iEvent)) {
			if(SAXStrings.indexOfNonWhitespace(this.getContent(), this.getContentBegin(), this.getContentEnd()) != -1) {
				return this._setErr(XMLP.ERR_DOC_STRUCTURE);
            }
        }
    }

    return iEvent;

}  // end function _checkStructure


XMLP.prototype._clearAttributes = function() {
    /*******************************************************************************************************************
    function:   _clearAttributes

    Author:   Scott Severtson
    *********************************************************************************************************************/
    this.m_atts = new Array();
}  // end function _clearAttributes


XMLP.prototype._findAttributeIndex = function(name) {
    /*******************************************************************************************************************
    function:   findAttributeIndex

    Author:   Scott Severtson
    *********************************************************************************************************************/
    for(var i = 0; i < this.m_atts.length; i++) {
        if(this.m_atts[i][XMLP._ATT_NAME] == name) {
            return i;
        }
    }
    return -1;

}  // end function _findAttributeIndex


XMLP.prototype.getAttributeCount = function() {
    /*******************************************************************************************************************
    function:   getAttributeCount

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_atts ? this.m_atts.length : 0;

}  // end function getAttributeCount()


XMLP.prototype.getAttributeName = function(index) {
    /*******************************************************************************************************************
    function:   getAttributeName

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return ((index < 0) || (index >= this.m_atts.length)) ? null : this.m_atts[index][XMLP._ATT_NAME];

}  //end function getAttributeName


XMLP.prototype.getAttributeValue = function(index) {
    /*******************************************************************************************************************
    function:   getAttributeValue

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return ((index < 0) || (index >= this.m_atts.length)) ? null : __unescapeString(this.m_atts[index][XMLP._ATT_VAL]);

} // end function getAttributeValue


XMLP.prototype.getAttributeValueByName = function(name) {
    /*******************************************************************************************************************
    function:   getAttributeValueByName

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.getAttributeValue(this._findAttributeIndex(name));

}  // end function getAttributeValueByName


XMLP.prototype.getColumnNumber = function() {
    /*******************************************************************************************************************
    function:   getColumnNumber

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return SAXStrings.getColumnNumber(this.m_xml, this.m_iP);

}  // end function getColumnNumber


XMLP.prototype.getContent = function() {
    /*******************************************************************************************************************
    function:   getContent

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return (this.m_cSrc == XMLP._CONT_XML) ? this.m_xml : this.m_cAlt;

}  //end function getContent


XMLP.prototype.getContentBegin = function() {
    /*******************************************************************************************************************
    function:   getContentBegin

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_cB;

}  //end function getContentBegin


XMLP.prototype.getContentEnd = function() {
    /*******************************************************************************************************************
    function:   getContentEnd

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_cE;

}  // end function getContentEnd


XMLP.prototype.getLineNumber = function() {
    /*******************************************************************************************************************
    function:   getLineNumber

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return SAXStrings.getLineNumber(this.m_xml, this.m_iP);

}  // end function getLineNumber


XMLP.prototype.getName = function() {
    /*******************************************************************************************************************
    function:   getName

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_name;

}  // end function getName()


XMLP.prototype.next = function() {
    /*******************************************************************************************************************
    function:   next

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this._checkStructure(this._parse());

}  // end function next()


XMLP.prototype._parse = function() {
    /*******************************************************************************************************************
    function:   _parse

    Author:   Scott Severtson
    *********************************************************************************************************************/

	if(this.m_iP == this.m_xml.length) {
        return XMLP._NONE;
    }

    if(this.m_iP == this.m_xml.indexOf("<?",        this.m_iP)) {
        return this._parsePI     (this.m_iP + 2);
    }
    else if(this.m_iP == this.m_xml.indexOf("<!DOCTYPE", this.m_iP)) {
        return this._parseDTD    (this.m_iP + 9);
    }
    else if(this.m_iP == this.m_xml.indexOf("<!--",      this.m_iP)) {
        return this._parseComment(this.m_iP + 4);
    }
    else if(this.m_iP == this.m_xml.indexOf("<![CDATA[", this.m_iP)) {
        return this._parseCDATA  (this.m_iP + 9);
    }
    else if(this.m_iP == this.m_xml.indexOf("<",         this.m_iP)) {
        return this._parseElement(this.m_iP + 1);
    }
    else if(this.m_iP == this.m_xml.indexOf("&",         this.m_iP)) {
        return this._parseEntity (this.m_iP + 1);
    }
    else{
        return this._parseText   (this.m_iP);
    }
	

}  // end function _parse


XMLP.prototype._parseAttribute = function(iB, iE) {
    /*******************************************************************************************************************
    function:   _parseAttribute

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var iNB, iNE, iEq, iVB, iVE;
    var cQuote, strN, strV;

	this.m_cAlt = ""; //resets the value so we don't use an old one by accident (see testAttribute7 in the test suite)
    
	iNB = SAXStrings.indexOfNonWhitespace(this.m_xml, iB, iE);
    if((iNB == -1) ||(iNB >= iE)) {
        return iNB;
    }

    iEq = this.m_xml.indexOf("=", iNB);
    if((iEq == -1) || (iEq > iE)) {
        return this._setErr(XMLP.ERR_ATT_VALUES);
    }

    iNE = SAXStrings.lastIndexOfNonWhitespace(this.m_xml, iNB, iEq);

    iVB = SAXStrings.indexOfNonWhitespace(this.m_xml, iEq + 1, iE);
    if((iVB == -1) ||(iVB > iE)) {
        return this._setErr(XMLP.ERR_ATT_VALUES);
    }

    cQuote = this.m_xml.charAt(iVB);
    if(SAXStrings.QUOTES.indexOf(cQuote) == -1) {
        return this._setErr(XMLP.ERR_ATT_VALUES);
    }

    iVE = this.m_xml.indexOf(cQuote, iVB + 1);
    if((iVE == -1) ||(iVE > iE)) {
        return this._setErr(XMLP.ERR_ATT_VALUES);
    }

    strN = this.m_xml.substring(iNB, iNE + 1);
    strV = this.m_xml.substring(iVB + 1, iVE);

    if(strN.indexOf("<") != -1) {
        return this._setErr(XMLP.ERR_ATT_LT_NAME);
    }

    if(strV.indexOf("<") != -1) {
        return this._setErr(XMLP.ERR_ATT_LT_VALUE);
    }

    strV = SAXStrings.replace(strV, null, null, "\n", " ");
    strV = SAXStrings.replace(strV, null, null, "\t", " ");
	iRet = this._replaceEntities(strV);
    if(iRet == XMLP._ERROR) {
        return iRet;
    }

    strV = this.m_cAlt;

    if(this._findAttributeIndex(strN) == -1) {
        this._addAttribute(strN, strV);
    }
    else {
        return this._setErr(XMLP.ERR_ATT_DUP);
    }

    this.m_iP = iVE + 2;

    return XMLP._ATT;

}  // end function _parseAttribute


XMLP.prototype._parseCDATA = function(iB) {
    /*******************************************************************************************************************
    function:   _parseCDATA

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var iE = this.m_xml.indexOf("]]>", iB);
    if (iE == -1) {
        return this._setErr(XMLP.ERR_CLOSE_CDATA);
    }

    this._setContent(XMLP._CONT_XML, iB, iE);

    this.m_iP = iE + 3;

    return XMLP._CDATA;

}  // end function _parseCDATA


XMLP.prototype._parseComment = function(iB) {
    /*******************************************************************************************************************
    function:   _parseComment

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var iE = this.m_xml.indexOf("-" + "->", iB);
    if (iE == -1) {
        return this._setErr(XMLP.ERR_CLOSE_COMMENT);
    }

    this._setContent(XMLP._CONT_XML, iB, iE);

    this.m_iP = iE + 3;

    return XMLP._COMMENT;

}  // end function _parseComment


XMLP.prototype._parseDTD = function(iB) {
    /*******************************************************************************************************************
    function:  _parseDTD

    Author:   Scott Severtson
    *********************************************************************************************************************/

    // Eat DTD

    var iE, strClose, iInt, iLast;

    iE = this.m_xml.indexOf(">", iB);
    if(iE == -1) {
        return this._setErr(XMLP.ERR_CLOSE_DTD);
    }

    iInt = this.m_xml.indexOf("[", iB);
    strClose = ((iInt != -1) && (iInt < iE)) ? "]>" : ">";

    while(true) {
        // DEBUG: Remove
        if(iE == iLast) {
            return this._setErr(XMLP.ERR_INFINITELOOP);
        }

        iLast = iE;
        // DEBUG: Remove End

        iE = this.m_xml.indexOf(strClose, iB);
        if(iE == -1) {
            return this._setErr(XMLP.ERR_CLOSE_DTD);
        }

        // Make sure it is not the end of a CDATA section
        if (this.m_xml.substring(iE - 1, iE + 2) != "]]>") {
            break;
        }
    }

    this.m_iP = iE + strClose.length;

    return XMLP._DTD;

}  // end function _parseDTD


XMLP.prototype._parseElement = function(iB) {
    /*******************************************************************************************************************
    function:   _parseElement

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var iE, iDE, iNE, iRet;
    var iType, strN, iLast;

    iDE = iE = this.m_xml.indexOf(">", iB);
    if(iE == -1) {
        return this._setErr(XMLP.ERR_CLOSE_ELM);
    }

    if(this.m_xml.charAt(iB) == "/") {
        iType = XMLP._ELM_E;
        iB++;
    } else {
        iType = XMLP._ELM_B;
    }

    if(this.m_xml.charAt(iE - 1) == "/") {
        if(iType == XMLP._ELM_E) {
            return this._setErr(XMLP.ERR_ELM_EMPTY);
        }
        iType = XMLP._ELM_EMP;
        iDE--;
    }

    iDE = SAXStrings.lastIndexOfNonWhitespace(this.m_xml, iB, iDE);

    //djohack
    //hack to allow for elements with single character names to be recognized

    if (iE - iB != 1 ) {
        if(SAXStrings.indexOfNonWhitespace(this.m_xml, iB, iDE) != iB) {
            return this._setErr(XMLP.ERR_ELM_NAME);
        }
    }
    // end hack -- original code below

    /*
    if(SAXStrings.indexOfNonWhitespace(this.m_xml, iB, iDE) != iB)
        return this._setErr(XMLP.ERR_ELM_NAME);
    */
    this._clearAttributes();

    iNE = SAXStrings.indexOfWhitespace(this.m_xml, iB, iDE);
    if(iNE == -1) {
        iNE = iDE + 1;
    }
    else {
        this.m_iP = iNE;
        while(this.m_iP < iDE) {
            // DEBUG: Remove
            if(this.m_iP == iLast) return this._setErr(XMLP.ERR_INFINITELOOP);
            iLast = this.m_iP;
            // DEBUG: Remove End


            iRet = this._parseAttribute(this.m_iP, iDE);
            if(iRet == XMLP._ERROR) return iRet;
        }
    }

    strN = this.m_xml.substring(iB, iNE);

    if(strN.indexOf("<") != -1) {
        return this._setErr(XMLP.ERR_ELM_LT_NAME);
    }

    this.m_name = strN;
    this.m_iP = iE + 1;

    return iType;

}  // end function _parseElement


XMLP.prototype._parseEntity = function(iB) {
    /*******************************************************************************************************************
    function:   _parseEntity

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var iE = this.m_xml.indexOf(";", iB);
    if(iE == -1) {
        return this._setErr(XMLP.ERR_CLOSE_ENTITY);
    }

    this.m_iP = iE + 1;

    return this._replaceEntity(this.m_xml, iB, iE);

}  // end function _parseEntity


XMLP.prototype._parsePI = function(iB) {
    /*******************************************************************************************************************
    function:   _parsePI

    Author:   Scott Severtson
    *********************************************************************************************************************/

    var iE, iTB, iTE, iCB, iCE;

    iE = this.m_xml.indexOf("?>", iB);
    if(iE   == -1) {
        return this._setErr(XMLP.ERR_CLOSE_PI);
    }

    iTB = SAXStrings.indexOfNonWhitespace(this.m_xml, iB, iE);
    if(iTB == -1) {
        return this._setErr(XMLP.ERR_PI_TARGET);
    }

    iTE = SAXStrings.indexOfWhitespace(this.m_xml, iTB, iE);
    if(iTE  == -1) {
        iTE = iE;
    }

    iCB = SAXStrings.indexOfNonWhitespace(this.m_xml, iTE, iE);
    if(iCB == -1) {
        iCB = iE;
    }

    iCE = SAXStrings.lastIndexOfNonWhitespace(this.m_xml, iCB, iE);
    if(iCE  == -1) {
        iCE = iE - 1;
    }

    this.m_name = this.m_xml.substring(iTB, iTE);
    this._setContent(XMLP._CONT_XML, iCB, iCE + 1);
    this.m_iP = iE + 2;

    return XMLP._PI;

}  // end function _parsePI


XMLP.prototype._parseText = function(iB) {
    /*******************************************************************************************************************
    function:   _parseText

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var iE, iEE;

    iE = this.m_xml.indexOf("<", iB);
    if(iE == -1) {
        iE = this.m_xml.length;
    }

    iEE = this.m_xml.indexOf("&", iB);
    if((iEE != -1) && (iEE <= iE)) {
        iE = iEE;
    }

    this._setContent(XMLP._CONT_XML, iB, iE);

    this.m_iP = iE;

    return XMLP._TEXT;

} // end function _parseText


XMLP.prototype._replaceEntities = function(strD, iB, iE) {
    /*******************************************************************************************************************
    function:   _replaceEntities

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(SAXStrings.isEmpty(strD)) return "";
    iB = iB || 0;
    iE = iE || strD.length;


    var iEB, iEE, strRet = "";

    iEB = strD.indexOf("&", iB);
    iEE = iB;

    while((iEB > 0) && (iEB < iE)) {
        strRet += strD.substring(iEE, iEB);

        iEE = strD.indexOf(";", iEB) + 1;

        if((iEE == 0) || (iEE > iE)) {
            return this._setErr(XMLP.ERR_CLOSE_ENTITY);
        }

        iRet = this._replaceEntity(strD, iEB + 1, iEE - 1);
        if(iRet == XMLP._ERROR) {
            return iRet;
        }

        strRet += this.m_cAlt;

        iEB = strD.indexOf("&", iEE);
    }

    if(iEE != iE) {
        strRet += strD.substring(iEE, iE);
    }

    this._setContent(XMLP._CONT_ALT, strRet);

    return XMLP._ENTITY;

}  // end function _replaceEntities


XMLP.prototype._replaceEntity = function(strD, iB, iE) {
    /*******************************************************************************************************************
    function:   _replaceEntity

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(SAXStrings.isEmpty(strD)) return -1;
    iB = iB || 0;
    iE = iE || strD.length;

    switch(strD.substring(iB, iE)) {
        case "amp":  strEnt = "&";  break;
        case "lt":   strEnt = "<";  break;
        case "gt":   strEnt = ">";  break;
        case "apos": strEnt = "'";  break;
        case "quot": strEnt = "\""; break;
        default:
            if(strD.charAt(iB) == "#") {
                strEnt = String.fromCharCode(parseInt(strD.substring(iB + 1, iE)));
            } else {
                return this._setErr(XMLP.ERR_ENTITY_UNKNOWN);
            }
        break;
    }
    this._setContent(XMLP._CONT_ALT, strEnt);

    return XMLP._ENTITY;
}  // end function _replaceEntity


XMLP.prototype._setContent = function(iSrc) {
    /*******************************************************************************************************************
    function:   _setContent

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var args = arguments;

    if(XMLP._CONT_XML == iSrc) {
        this.m_cAlt = null;
        this.m_cB = args[1];
        this.m_cE = args[2];
    } else {
        this.m_cAlt = args[1];
        this.m_cB = 0;
        this.m_cE = args[1].length;
    }
    this.m_cSrc = iSrc;

}  // end function _setContent


XMLP.prototype._setErr = function(iErr) {
    /*******************************************************************************************************************
    function:   _setErr

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var strErr = XMLP._errs[iErr];

    this.m_cAlt = strErr;
    this.m_cB = 0;
    this.m_cE = strErr.length;
    this.m_cSrc = XMLP._CONT_ALT;

    return XMLP._ERROR;

}  // end function _setErr






/***************************************************************************************************************
SAXDriver is an object that basically wraps an XMLP instance, and provides an
event-based interface for parsing. This is the object users interact with when coding
with XML for <SCRIPT>
*****************************************************************************************************************/


SAXDriver = function() {
    /*******************************************************************************************************************
    function:   SAXDriver

    Author:   Scott Severtson

    Description:
        This is the constructor for the SAXDriver Object
    *********************************************************************************************************************/
    this.m_hndDoc = null;
    this.m_hndErr = null;
    this.m_hndLex = null;
}


// CONSTANTS    (these must be below the constructor)

// =========================================================================
// =========================================================================
// =========================================================================
SAXDriver.DOC_B = 1;
SAXDriver.DOC_E = 2;
SAXDriver.ELM_B = 3;
SAXDriver.ELM_E = 4;
SAXDriver.CHARS = 5;
SAXDriver.PI    = 6;
SAXDriver.CD_B  = 7;
SAXDriver.CD_E  = 8;
SAXDriver.CMNT  = 9;
SAXDriver.DTD_B = 10;
SAXDriver.DTD_E = 11;
// =========================================================================
// =========================================================================
// =========================================================================



SAXDriver.prototype.parse = function(strD) {
    /*******************************************************************************************************************
    function:   parse

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var parser = new XMLP(strD);

    if(this.m_hndDoc && this.m_hndDoc.setDocumentLocator) {
        this.m_hndDoc.setDocumentLocator(this);
    }

    this.m_parser = parser;
    this.m_bErr = false;

    if(!this.m_bErr) {
        this._fireEvent(SAXDriver.DOC_B);
    }
    this._parseLoop();
    if(!this.m_bErr) {
        this._fireEvent(SAXDriver.DOC_E);
    }

    this.m_xml = null;
    this.m_iP = 0;

}  // end function parse


SAXDriver.prototype.setDocumentHandler = function(hnd) {
    /*******************************************************************************************************************
    function:   setDocumentHandler

    Author:   Scott Severtson
    *********************************************************************************************************************/

    this.m_hndDoc = hnd;

}   // end function setDocumentHandler


SAXDriver.prototype.setErrorHandler = function(hnd) {
    /*******************************************************************************************************************
    function:   setErrorHandler

    Author:   Scott Severtson
    *********************************************************************************************************************/

    this.m_hndErr = hnd;

}  // end function setErrorHandler


SAXDriver.prototype.setLexicalHandler = function(hnd) {
    /*******************************************************************************************************************
    function:   setLexicalHandler

    Author:   Scott Severtson
    *********************************************************************************************************************/

    this.m_hndLex = hnd;

}  // end function setLexicalHandler


    /*******************************************************************************************************************
                                                LOCATOR/PARSE EXCEPTION INTERFACE
    *********************************************************************************************************************/

SAXDriver.prototype.getColumnNumber = function() {
    /*******************************************************************************************************************
    function:   getSystemId

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_parser.getColumnNumber();

}  // end function getColumnNumber


SAXDriver.prototype.getLineNumber = function() {
    /*******************************************************************************************************************
    function:   getLineNumber

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_parser.getLineNumber();

}  // end function getLineNumber


SAXDriver.prototype.getMessage = function() {
    /*******************************************************************************************************************
    function:   getMessage

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_strErrMsg;

}  // end function getMessage


SAXDriver.prototype.getPublicId = function() {
    /*******************************************************************************************************************
    function:   getPublicID

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return null;

}  // end function getPublicID


SAXDriver.prototype.getSystemId = function() {
    /*******************************************************************************************************************
    function:   getSystemId

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return null;

}  // end function getSystemId


    /*******************************************************************************************************************
                                                Attribute List Interface
    *********************************************************************************************************************/

SAXDriver.prototype.getLength = function() {
    /*******************************************************************************************************************
    function:   getLength

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_parser.getAttributeCount();

}  // end function getAttributeCount


SAXDriver.prototype.getName = function(index) {
    /*******************************************************************************************************************
    function:   getName

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_parser.getAttributeName(index);

} // end function getAttributeName


SAXDriver.prototype.getValue = function(index) {
    /*******************************************************************************************************************
    function:   getValue

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_parser.getAttributeValue(index);

}  // end function getAttributeValue


SAXDriver.prototype.getValueByName = function(name) {
    /*******************************************************************************************************************
    function:   getValueByName

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_parser.getAttributeValueByName(name);

} // end function getAttributeValueByName


    /*******************************************************************************************************************
                                                                Private functions
    *********************************************************************************************************************/

SAXDriver.prototype._fireError = function(strMsg) {
    /*******************************************************************************************************************
    function:   _fireError

    Author:   Scott Severtson
    *********************************************************************************************************************/
    this.m_strErrMsg = strMsg;
    this.m_bErr = true;

    if(this.m_hndErr && this.m_hndErr.fatalError) {
        this.m_hndErr.fatalError(this);
    }

}   // end function _fireError


SAXDriver.prototype._fireEvent = function(iEvt) {
    /*******************************************************************************************************************
    function:   _fireEvent

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var hnd, func, args = arguments, iLen = args.length - 1;

    if(this.m_bErr) return;

    if(SAXDriver.DOC_B == iEvt) {
        func = "startDocument";         hnd = this.m_hndDoc;
    }
    else if (SAXDriver.DOC_E == iEvt) {
        func = "endDocument";           hnd = this.m_hndDoc;
    }
    else if (SAXDriver.ELM_B == iEvt) {
        func = "startElement";          hnd = this.m_hndDoc;
    }
    else if (SAXDriver.ELM_E == iEvt) {
        func = "endElement";            hnd = this.m_hndDoc;
    }
    else if (SAXDriver.CHARS == iEvt) {
        func = "characters";            hnd = this.m_hndDoc;
    }
    else if (SAXDriver.PI    == iEvt) {
        func = "processingInstruction"; hnd = this.m_hndDoc;
    }
    else if (SAXDriver.CD_B  == iEvt) {
        func = "startCDATA";            hnd = this.m_hndLex;
    }
    else if (SAXDriver.CD_E  == iEvt) {
        func = "endCDATA";              hnd = this.m_hndLex;
    }
    else if (SAXDriver.CMNT  == iEvt) {
        func = "comment";               hnd = this.m_hndLex;
    }

    if(hnd && hnd[func]) {
        if(0 == iLen) {
            hnd[func]();
        }
        else if (1 == iLen) {
            hnd[func](args[1]);
        }
        else if (2 == iLen) {
            hnd[func](args[1], args[2]);
        }
        else if (3 == iLen) {
            hnd[func](args[1], args[2], args[3]);
        }
    }

}  // end function _fireEvent


SAXDriver.prototype._parseLoop = function(parser) {
    /*******************************************************************************************************************
    function:   _parseLoop

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var iEvent, parser;

    parser = this.m_parser;
    while(!this.m_bErr) {
        iEvent = parser.next();

        if(iEvent == XMLP._ELM_B) {
            this._fireEvent(SAXDriver.ELM_B, parser.getName(), this);
        }
        else if(iEvent == XMLP._ELM_E) {
            this._fireEvent(SAXDriver.ELM_E, parser.getName());
        }
        else if(iEvent == XMLP._ELM_EMP) {
            this._fireEvent(SAXDriver.ELM_B, parser.getName(), this);
            this._fireEvent(SAXDriver.ELM_E, parser.getName());
        }
        else if(iEvent == XMLP._TEXT) {
            this._fireEvent(SAXDriver.CHARS, parser.getContent(), parser.getContentBegin(), parser.getContentEnd() - parser.getContentBegin());
        }
        else if(iEvent == XMLP._ENTITY) {
            this._fireEvent(SAXDriver.CHARS, parser.getContent(), parser.getContentBegin(), parser.getContentEnd() - parser.getContentBegin());
        }
        else if(iEvent == XMLP._PI) {
            this._fireEvent(SAXDriver.PI, parser.getName(), parser.getContent().substring(parser.getContentBegin(), parser.getContentEnd()));
        }
        else if(iEvent == XMLP._CDATA) {
            this._fireEvent(SAXDriver.CD_B);
            this._fireEvent(SAXDriver.CHARS, parser.getContent(), parser.getContentBegin(), parser.getContentEnd() - parser.getContentBegin());
            this._fireEvent(SAXDriver.CD_E);
        }
        else if(iEvent == XMLP._COMMENT) {
            this._fireEvent(SAXDriver.CMNT, parser.getContent(), parser.getContentBegin(), parser.getContentEnd() - parser.getContentBegin());
        }
        else if(iEvent == XMLP._DTD) {
        }
        else if(iEvent == XMLP._ERROR) {
            this._fireError(parser.getContent());
        }
        else if(iEvent == XMLP._NONE) {
            return;
        }
    }

}  // end function _parseLoop



/***************************************************************************************************************
SAXStrings: a useful object containing string manipulation functions
*****************************************************************************************************************/


SAXStrings = function() {
    /*******************************************************************************************************************
    function:   SAXStrings

    Author:   Scott Severtson

    Description:
        This is the constructor of the SAXStrings object
    *********************************************************************************************************************/
}  // end function SAXStrings


// CONSTANTS    (these must be below the constructor)

// =========================================================================
// =========================================================================
// =========================================================================
SAXStrings.WHITESPACE = " \t\n\r";
SAXStrings.QUOTES = "\"'";
// =========================================================================
// =========================================================================
// =========================================================================


SAXStrings.getColumnNumber = function(strD, iP) {
    /*******************************************************************************************************************
    function:   replace

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(SAXStrings.isEmpty(strD)) {
        return -1;
    }
    iP = iP || strD.length;

    var arrD = strD.substring(0, iP).split("\n");
    var strLine = arrD[arrD.length - 1];
    arrD.length--;
    var iLinePos = arrD.join("\n").length;

    return iP - iLinePos;

}  // end function getColumnNumber


SAXStrings.getLineNumber = function(strD, iP) {
    /*******************************************************************************************************************
    function:   getLineNumber

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(SAXStrings.isEmpty(strD)) {
        return -1;
    }
    iP = iP || strD.length;

    return strD.substring(0, iP).split("\n").length
}  // end function getLineNumber


SAXStrings.indexOfNonWhitespace = function(strD, iB, iE) {
    /*******************************************************************************************************************
    function:   indexOfNonWhitespace

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(SAXStrings.isEmpty(strD)) {
        return -1;
    }
    iB = iB || 0;
    iE = iE || strD.length;

    for(var i = iB; i < iE; i++){
        if(SAXStrings.WHITESPACE.indexOf(strD.charAt(i)) == -1) {
            return i;
        }
    }
    return -1;

}  // end function indexOfNonWhitespace


SAXStrings.indexOfWhitespace = function(strD, iB, iE) {
    /*******************************************************************************************************************
    function:   indexOfWhitespace

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(SAXStrings.isEmpty(strD)) {
        return -1;
    }
    iB = iB || 0;
    iE = iE || strD.length;

    for(var i = iB; i < iE; i++) {
        if(SAXStrings.WHITESPACE.indexOf(strD.charAt(i)) != -1) {
            return i;
        }
    }
    return -1;
}  // end function indexOfWhitespace


SAXStrings.isEmpty = function(strD) {
    /*******************************************************************************************************************
    function:   isEmpty

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return (strD == null) || (strD.length == 0);

}  // end function isEmpty


SAXStrings.lastIndexOfNonWhitespace = function(strD, iB, iE) {
    /*******************************************************************************************************************
    function:   lastIndexOfNonWhiteSpace

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(SAXStrings.isEmpty(strD)) {
        return -1;
    }
    iB = iB || 0;
    iE = iE || strD.length;

    for(var i = iE - 1; i >= iB; i--){
        if(SAXStrings.WHITESPACE.indexOf(strD.charAt(i)) == -1){
            return i;
        }
    }
    return -1;
}  // end function lastIndexOfNonWhitespace


SAXStrings.replace = function(strD, iB, iE, strF, strR) {
    /*******************************************************************************************************************
    function:   replace

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(SAXStrings.isEmpty(strD)) {
        return "";
    }
    iB = iB || 0;
    iE = iE || strD.length;

    return strD.substring(iB, iE).split(strF).join(strR);

}  // end function replace



/***************************************************************************************************************
saxStack: A simple stack class, used for verifying document structure.
*****************************************************************************************************************/

saxStack = function() {
    /*******************************************************************************************************************
    function:   saxStack

    Author:   Scott Severtson

    Description:
        Constructor of the saxStack Object
    *********************************************************************************************************************/
    this.m_arr = new Array();

}  // end function saxStack


saxStack.prototype.clear = function() {
    /*******************************************************************************************************************
    function:   clear

    Author:   Scott Severtson
    *********************************************************************************************************************/

    this.m_arr = new Array();

}  // end function clear


saxStack.prototype.count = function() {
    /*******************************************************************************************************************
    function:   count

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_arr.length;

}  // end function count


saxStack.prototype.destroy = function() {
    /*******************************************************************************************************************
    function:   destroy

    Author:   Scott Severtson
    *********************************************************************************************************************/

    this.m_arr = null;

}   // end function destroy


saxStack.prototype.peek = function() {
    /*******************************************************************************************************************
    function:   peek

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(this.m_arr.length == 0) {
        return null;
    }

    return this.m_arr[this.m_arr.length - 1];

}  // end function peek


saxStack.prototype.pop = function() {
    /*******************************************************************************************************************
    function:   pop

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(this.m_arr.length == 0) {
        return null;
    }

    var o = this.m_arr[this.m_arr.length - 1];
    this.m_arr.length--;
    return o;

}  // end function pop


saxStack.prototype.push = function(o) {
    /*******************************************************************************************************************
    function:   push

    Author:   Scott Severtson
    *********************************************************************************************************************/

    this.m_arr[this.m_arr.length] = o;

}  // end function push



// =========================================================================
// =========================================================================
// =========================================================================

// CONVENIENCE FUNCTIONS

// =========================================================================
// =========================================================================
// =========================================================================

function isEmpty(str) {
    /*******************************************************************************************************************
    function: isEmpty

    Author: mike@idle.org

    Description:
        convenience function to identify an empty string

    *********************************************************************************************************************/
    return (str==null) || (str.length==0);

} // end function isEmpty



function trim(trimString, leftTrim, rightTrim) {
    /*******************************************************************************************************************
    function: trim

    Author: may106@psu.edu

    Description:
        helper function to trip a string (trimString) of leading (leftTrim)
        and trailing (rightTrim) whitespace

    *********************************************************************************************************************/
    if (isEmpty(trimString)) {
        return "";
    }

    // the general focus here is on minimal method calls - hence only one
    // substring is done to complete the trim.

    if (leftTrim == null) {
        leftTrim = true;
    }

    if (rightTrim == null) {
        rightTrim = true;
    }

    var left=0;
    var right=0;
    var i=0;
    var k=0;


    // modified to properly handle strings that are all whitespace
    if (leftTrim == true) {
        while ((i<trimString.length) && (whitespace.indexOf(trimString.charAt(i++))!=-1)) {
            left++;
        }
    }
    if (rightTrim == true) {
        k=trimString.length-1;
        while((k>=left) && (whitespace.indexOf(trimString.charAt(k--))!=-1)) {
            right++;
        }
    }
    return trimString.substring(left, trimString.length - right);
} // end function trim

/**
 * function __escapeString
 *
 * author: David Joham djoham@yahoo.com
 *
 * @param  str : string - The string to be escaped
 *
 * @return : string - The escaped string
 */
function __escapeString(str) {

    var escAmpRegEx = /&/g;
    var escLtRegEx = /</g;
    var escGtRegEx = />/g;
    var quotRegEx = /"/g;
    var aposRegEx = /'/g;

    str = str.replace(escAmpRegEx, "&amp;");
    str = str.replace(escLtRegEx, "&lt;");
    str = str.replace(escGtRegEx, "&gt;");
    str = str.replace(quotRegEx, "&quot;");
    str = str.replace(aposRegEx, "&apos;");

  return str;
}

/**
 * function __unescapeString 
 *
 * author: David Joham djoham@yahoo.com
 *
 * @param  str : string - The string to be unescaped
 *
 * @return : string - The unescaped string
 */
function __unescapeString(str) {

    var escAmpRegEx = /&amp;/g;
    var escLtRegEx = /&lt;/g;
    var escGtRegEx = /&gt;/g;
    var quotRegEx = /&quot;/g;
    var aposRegEx = /&apos;/g;

    str = str.replace(escAmpRegEx, "&");
    str = str.replace(escLtRegEx, "<");
    str = str.replace(escGtRegEx, ">");
    str = str.replace(quotRegEx, "\"");
    str = str.replace(aposRegEx, "'");

  return str;
}

// =========================================================================
//
// scripts.js- sample code for the SAX Parser in XML for <SCRIPT>
//
// =========================================================================
//
// Copyright (C) 2001, 2002 - David Joham (djoham@yahoo.com)
//
// This library is free software; you can redistribute it and/or
// modify it under the terms of the GNU Lesser General Public
// License as published by the Free Software Foundation; eithere
// version 2.1 of the License, or (at your option) any later version.

// This library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
// Lesser General Public License for more details.

// You should have received a copy of the GNU Lesser General Public
// License along with this library; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA


/**************************************************************************************
                                        GLOBALS
***************************************************************************************/

var xmlTextArray
var xmlCDataArray
var xmlAttrArray


/**************************************************************************************
                                        FUNCTIONS
***************************************************************************************/

function showTagInfo(xpath){
    /*************************************************************************************
    Function:       void showTagInfo(xpath)

    author:         xwisdom@yahoo.com

    description:
        displays information about a node. Uses the node's xpath info

    ************************************************************************************/

    var textValue;
    var cdataValue;

    textValue = trim(xmlTextArray[xpath]);

    if (textValue == "" || textValue == null) {
        textValue = "No text value for this node";
    }

    cdataValue = trim(xmlCDataArray[xpath]);


    if (cdataValue == "" || cdataValue == null) {
        cdataValue = "No CDATA value for this node";
    }

    var src='Text:\n '+textValue+'\n\n' +'CDATA:\n '+cdataValue +'\n\n'

    if(xmlAttrArray[xpath]){
        var arr=xmlAttrArray[xpath]
        var atts=''
        for (i in arr){
            // name = value
            atts+=i+'='+arr[i]+'\n';
        }
        src+='Attributes:\n '+atts
    }

    alert(xpath+'\n\n'+src)

} // end function showTagInfo


function startParser() {
    /*************************************************************************************
    Function:       void startParser(xmldata)

    author:         xwisdom@yahoo.com

    description:
        starts the sax2 parser

    ************************************************************************************/

    var ixml = document.getElementById("xmldata").value;

    var arr,src='' ,parser = new SAXDriver();
    var handler = new xmlHandler();


    // pass handlers to the sax2 parser
    parser.setDocumentHandler(handler);
    parser.setErrorHandler(handler);
    parser.setLexicalHandler(handler);

    parser.parse(ixml);// start parsing

    // get errors from sax2 parser
    var err='\n'+handler.getError();

    xmlTextArray=handler.getText_Array()
    xmlCDataArray=handler.getCDATA_Array()
    xmlAttrArray=handler.getAttr_Array()

    arr=handler.getPath_Array();
    for (i=0;i<arr.length;i++){
        src+='<a href="javascript:void(null)" onclick="showTagInfo(\''+arr[i]+'\')">'+arr[i]+'</a>\n'
    }

    if(document.all){
        document.all.divout.innerHTML='Parsing completed  | Click on the links below for more info:<br><pre>'+src+'</pre>'
    }else if(document.getElementById){
        document.getElementById('divout').innerHTML='Parsing completed | Click on the links below for more info:<br><pre>'+src+'</pre>'
    }else{
        alert('Requires a DOM compatible browser for this test')
    }

}// end function startParser



/***************************************************************************************
                                        SAX EVENT HANDLER
***************************************************************************************/


xmlHandler = function() {
    /*************************************************************************************
    Function:       xmlHandler

    author:         xwisdom@yahoo.com

    description:
    	constructor for the xmlHandler object

    ************************************************************************************/
    this.m_strError=''
    this.m_treePath=[]
    this.m_xPath=[''] // stores current path info
    this.m_text=['']
    this.m_cdata=['']
    this.m_attr=['']
    this.m_pi=['']
    this.cdata=false

} // end function xmlHandler


xmlHandler.prototype.characters = function(data, start, length) {
    /*************************************************************************************
    Function:       object.characters(String data, Int start, Int length)
					-> data: xml data
					-> start of text/cdata entity
					-> length of text/cdata entity

    author:         xwisdom@yahoo.com

    description:
    	this event is triggered whenever a text/cdata entity is encounter by the sax2 parser

    ************************************************************************************/

    // capture characters from CDATA and Text entities
    var text=data.substr(start, length);
    if (text=='\n' ) return null // get ride of blank text lines
    if (this.m_treePath.length>0){
        if(this.cdata==false){
            if (!this.m_text[this.m_xPath.join('/')]) {
                this.m_text[this.m_xPath.join('/')]='';
            }
            this.m_text[this.m_xPath.join('/')]+=text;
        }
        else {
            if (!this.m_cdata[this.m_xPath.join('/')]) {
                this.m_cdata[this.m_xPath.join('/')]='';
            }
            this.m_cdata[this.m_xPath.join('/')]+=text;
        }
    }

} // end function characters


xmlHandler.prototype.comment = function(data, start, length) {
    /*************************************************************************************
    Function:       object.comment(String data, Int start, Int length)

    author:         xwisdom@yahoo.com

    description:
		triggered whenever a comment <!-- text --> is found. Same as the character event

    ************************************************************************************/

    var comment=data.substr(start, length)

} // end function comment


xmlHandler.prototype.endCDATA = function() {
    /*************************************************************************************
    Function:       object.endCDATA()

    author:         xwisdom@yahoo.com

    description:
    	triggered at the end of cdata entity

    ************************************************************************************/

    // end of CDATA entity
    this.cdata=false

} // end function endCDATA


xmlHandler.prototype.endDocument = function() {
    /*************************************************************************************
    Function:       object.endDocument()

    author:         xwisdom@yahoo.com

    description:
    	end of document parsing - last event triggered by the sax2 parser

    ************************************************************************************/

} // end function end Document


xmlHandler.prototype.endElement = function(name) {
    /*************************************************************************************
    Function:       object.endElement(String tagname)
					-> tagname: name of tag

    author:         xwisdom@yahoo.com

    description:
    	last event trigger when a node is encounter by the sax2 parser

    ************************************************************************************/

    this.m_xPath=this.m_xPath.slice(0,-1);

} // end function endElement

xmlHandler.prototype.error = function(exception) {
    /*************************************************************************************
    Function:       object.error(String exception)

    author:         xwisdom@yahoo.com

    description:
		triggered whenever an error is encounter by the sax2 parser

    ************************************************************************************/

    this.m_strError+='Error:'+exception.getMessage()+'\n'

} // end function error


xmlHandler.prototype.fatalError = function(exception) {
    /*************************************************************************************
    Function:       object.fatalError(String exception)

    author:         xwisdom@yahoo.com

    description:
		triggered whenever an error is encounter by the sax2 parser

    ************************************************************************************/

    this.m_strError+='fatal error:'+exception.getMessage()+'\n'

} // end function fatalError


xmlHandler.prototype.getAttr_Array= function() {
    /*************************************************************************************
    Function:       getAttr_Array

    author:         xwisdom@yahoo.com
    ************************************************************************************/

    return this.m_attr;

}   // end function getAttr_Array


xmlHandler.prototype.getCDATA_Array= function() {
    /*************************************************************************************
    Function:       getCDATA_Array

    author:         xwisdom@yahoo.com
    ************************************************************************************/
    return this.m_cdata;

}  // end function getCDATA_Array


xmlHandler.prototype.getError = function() {
    /*************************************************************************************
    Function:       getError

    author:         xwisdom@yahoo.com
    ************************************************************************************/

    return this.m_strError;

}  // end function getError


xmlHandler.prototype.getPath_Array = function() {
    /*************************************************************************************
    Function:       getError

    author:         xwisdom@yahoo.com
    ************************************************************************************/
	return this.m_treePath;
}  // end function getPath_Array


xmlHandler.prototype.getText_Array = function() {
    /*************************************************************************************
    Function:       getText_Array

    author:         xwisdom@yahoo.com
    ************************************************************************************/
    return this.m_text;

} // getTextArray


xmlHandler.prototype.processingInstruction = function(target, data) {
    /*************************************************************************************
    Function:       object.processingInstruction(String target, String data)
						-> target: is tagname of the pi
						-> data: is the content of the pi

    author:         xwisdom@yahoo.com

    description:
    	capture PI data here

    ************************************************************************************/

} // end function processingInstruction


xmlHandler.prototype.setDocumentLocator = function(locator) {
    /*************************************************************************************
    Function:       object.setDocumentLocator(SAXDriver locator)

    author:         xwisdom@yahoo.com

    description:
		passes an instance of the SAXDriver to the handler

    ************************************************************************************/

    this.m_locator = locator;

}  // end function setDocumentLocator


xmlHandler.prototype.startCDATA = function() {
    /*************************************************************************************
    Function:       object.startCDATA()

    author:         xwisdom@yahoo.com

    description:
    	triggered whenever a cdata entity is encounter by the sax2 parser

    ************************************************************************************/


    // start of CDATA entity
    this.cdata=true

} // end function startCDATA


xmlHandler.prototype.startDocument = function() {
    /*************************************************************************************
    Function:       object.startDocument()

    author:         xwisdom@yahoo.com

    description:
    	start of document - first event triggered by the sax2 parser

    ************************************************************************************/

} // end function startDocument


xmlHandler.prototype.startElement = function(name, atts) {
    /*************************************************************************************
    Function:       object.startElement(String tagname,Array content)
					-> tagname: name of tag
					-> content: [["attribute1", "value1"], ["attribute2", "value2"],....,n]

    author:         xwisdom@yahoo.com

    description:
    	First event trigger when a node is encounter by the sax2 parser
    	the name and attribute contents are passed to this event

    ************************************************************************************/
alert(name);
    // Note: the following code is used to store info about the node
    // into arrays for use the xpath layout

    var cpath,att_count=atts.getLength()
    this.m_xPath[this.m_xPath.length]=name
    cpath=this.m_xPath.join('/')
    this.m_treePath[this.m_treePath.length]=cpath

    if (att_count) {
        var attr=[]
        for (i=0;i<att_count;i++){
            attr[atts.getName(i)]=atts.getValue(i)
        }
        this.m_attr[this.m_xPath.join('/')]=attr;
    }

} // end function startElement


xmlHandler.prototype.warning = function(exception) {
    /*************************************************************************************
    Function:       object.warninng(String exception)

    author:         xwisdom@yahoo.com

    description:
		triggered whenever an error is encounter by the sax2 parser

    ************************************************************************************/

    this.m_strError+='Warning:'+exception.getMessage()+'\n'

} // end function warning


function Timer()
{
    this.startTime = null;
    this.stopTime = null;
}

Timer.prototype.start = function()
{
    var date = new Date();
    
    this.startTime = date.getTime();
}

Timer.prototype.stop = function()
{
    var date = new Date();
    
    this.stopTime = date.getTime();
}

Timer.prototype.getTime = function()
{
    if (this.startTime && this.stopTime)
    {
        return (this.stopTime - this.startTime) / 1000;
    }
        
    return 0;
}
// From: http://www.codeproject.com/KB/scripting/dom-element-abs-pos.aspx

function __getIEVersion()
{
    var rv = -1; // Return value assumes failure.
    if (navigator.appName == 'Microsoft Internet Explorer')
    {
        var ua = navigator.userAgent;
        var re = new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");
        if (re.exec(ua) != null)
            rv = parseFloat(RegExp.$1);
    }
    return rv;
}

function __getOperaVersion()
{
    var rv = 0; // Default value
    if (window.opera)
    {
        var sver = window.opera.version();
        rv = parseFloat(sver);
    }
    return rv;
}

var __userAgent = navigator.userAgent;
var __isIE = navigator.appVersion.match(/MSIE/) != null;
var __IEVersion = __getIEVersion();
var __isIENew = __isIE && __IEVersion >= 8;
var __isIEOld = __isIE && !__isIENew;

var __isFireFox = __userAgent.match(/firefox/i) != null;
var __isFireFoxOld = __isFireFox && ((__userAgent.match(/firefox\/2./i) != null) ||
	(__userAgent.match(/firefox\/1./i) != null));
var __isFireFoxNew = __isFireFox && !__isFireFoxOld;

var __isWebKit = navigator.appVersion.match(/WebKit/) != null;
var __isChrome = navigator.appVersion.match(/Chrome/) != null;
var __isOpera = window.opera != null;
var __operaVersion = __getOperaVersion();
var __isOperaOld = __isOpera && (__operaVersion < 10);

function __parseBorderWidth(width)
{
    var res = 0;
    if (typeof (width) == "string" && width != null && width != "")
    {
        var p = width.indexOf("px");
        if (p >= 0)
        {
            res = parseInt(width.substring(0, p));
        }
        else
        {
            //do not know how to calculate other values 
            //(such as 0.5em or 0.1cm) correctly now
            //so just set the width to 1 pixel
            res = 1;
        }
    }
    return res;
}

//returns border width for some element
function __getBorderWidth(element)
{
    var res = new Object();
    res.left = 0; res.top = 0; res.right = 0; res.bottom = 0;
    if (window.getComputedStyle)
    {
        //for Firefox
        var elStyle = window.getComputedStyle(element, null);
        res.left = parseInt(elStyle.borderLeftWidth.slice(0, -2));
        res.top = parseInt(elStyle.borderTopWidth.slice(0, -2));
        res.right = parseInt(elStyle.borderRightWidth.slice(0, -2));
        res.bottom = parseInt(elStyle.borderBottomWidth.slice(0, -2));
    }
    else
    {
        //for other browsers
        res.left = __parseBorderWidth(element.style.borderLeftWidth);
        res.top = __parseBorderWidth(element.style.borderTopWidth);
        res.right = __parseBorderWidth(element.style.borderRightWidth);
        res.bottom = __parseBorderWidth(element.style.borderBottomWidth);
    }

    return res;
}

//returns the absolute position of some element within document
function getElementAbsolutePos(element)
{
    var res = new Object();
    res.x = 0; res.y = 0;
    if (element !== null)
    {
        if (element.getBoundingClientRect)
        {
            var viewportElement = document.documentElement;
            var box = element.getBoundingClientRect();
            var scrollLeft = viewportElement.scrollLeft;
            var scrollTop = viewportElement.scrollTop;

            res.x = box.left + scrollLeft;
            res.y = box.top + scrollTop;

        }
        else
        { //for old browsers
            res.x = element.offsetLeft;
            res.y = element.offsetTop;

            var parentNode = element.parentNode;
            var borderWidth = null;

            while (offsetParent != null)
            {
                res.x += offsetParent.offsetLeft;
                res.y += offsetParent.offsetTop;

                var parentTagName =
					offsetParent.tagName.toLowerCase();

                if ((__isIEOld && parentTagName != "table") ||
					((__isFireFoxNew || __isChrome) &&
						parentTagName == "td"))
                {
                    borderWidth = kGetBorderWidth
							(offsetParent);
                    res.x += borderWidth.left;
                    res.y += borderWidth.top;
                }

                if (offsetParent != document.body &&
				offsetParent != document.documentElement)
                {
                    res.x -= offsetParent.scrollLeft;
                    res.y -= offsetParent.scrollTop;
                }


                //next lines are necessary to fix the problem 
                //with offsetParent
                if (!__isIE && !__isOperaOld || __isIENew)
                {
                    while (offsetParent != parentNode &&
						parentNode !== null)
                    {
                        res.x -= parentNode.scrollLeft;
                        res.y -= parentNode.scrollTop;
                        if (__isFireFoxOld || __isWebKit)
                        {
                            borderWidth =
						     kGetBorderWidth(parentNode);
                            res.x += borderWidth.left;
                            res.y += borderWidth.top;
                        }
                        parentNode = parentNode.parentNode;
                    }
                }

                parentNode = offsetParent.parentNode;
                offsetParent = offsetParent.offsetParent;
            }
        }
    }
    
    return res;
}
/**
*	The end behavior enumeration
*/
var eEndBehavior =
{
    Reset: 0,
    Constant: 1,
    Repeat: 2,
    Oscillate: 3,
    OffsetRepeat: 4,
    Linear: 5
};

var eImageAntialiasOp =
{
    None: 0,
    TwoPass: 1,
    FourPass: 2,
    EightPass: 3,
    EnumCount: 4
};

/**
 * The key frame shape enumeration
 */
var eKeyframeShape =
{
    Linear: 0,
    Stepped: 1,
    TCB: 2,
    Bezier1D: 3,
    Bezier2D: 4,
    Hermite: 5
};

var eTextureType =
{
    // color textures
    Color: 0,
    // diffuse textures
    Diffuse: 1,
    // luminosity (emissive) textures
    Luminosity: 2,
    // reflection textures
    Reflection: 3,
    // specularity textures
    Specularity: 4,
    // transparency textures
    Transparency: 5,
    // clip textures
    Clip: 6,
    // bump textures
    Bump: 7,
    // number of texture types
    EnumCount: 8
};

var eTextureWrap =
{
    // no texture wrapping
    None: 0,
    // clamp texture wrapping
    Clamp: 1,
    // repeat texture wrapping
    Repeat: 2,
    // mirror texture wrapping
    Mirror: 3,
    // number of texture wraps
    EnumCount: 4
};

var eHighlightType =
{
    // disable highlights
    None: 0,
    // 4-pass
    FourPass: 1,
    // 8-pass
    EightPass: 2  
};

var eBoneFalloffType =
{
    InverseDistance: 0,
    // inverse distance / 2
    InverseDistance_2: 1,
    // inverse distance / 4
    InverseDistance_4: 2,
    // inverse distance / 8
    InverseDistance_8: 3,
    // inverse distance / 16
    InverseDistance_16: 4  
};

var eCullResult =
{
    Outside     :0,
    Inside      :1,
    Intersects  :2
};

var FLT_EPSILON = 1.192092896e-07;
var FLT_MAX     = 3.402823466e+38;

var TWOPI     = Math.PI * 2;
var HALFPI    = Math.PI / 2;
var QUARTERPI = Math.PI / 4;

function min3(x, y, z)
{
    return Math.min(x, Math.min(y, z));
}

function max3(x, y, z)
{
    return Math.max(x, Math.max(y, z));
}

function toRadians(degrees)
{
    return degrees * Math.PI / 180;
}

function toDegrees(radians)
{
    return radians * 180 / Math.PI;
}

function magnitude(x, y, z)
{
    return Math.sqrt(((x) * (x)) + ((y) * (y)) + ((z) * (z)));
}

function magnitude4(w, x, y, z)
{
    return Math.sqrt(((w) * (w)) + ((x) * (x)) + ((y) * (y)) + ((z) * (z)));
}

function clamp(value, min, max)
{
    if (value < min) return min;
    if (value > max) return max;
    return value;
}

/*
 * Normalize a degree value so that it falls between [0, 360)
 * @params deg the degree value to normalize
 * @return T the normalized value
 */
function degreeNormalize(deg)
{
    while (deg < 0)
    {
        deg += 360;
    }

    while (deg >=360)
    {
        deg -= 360;
    }

    return deg;
}

function epsilonEqual(value1, value2, epsilon)
{
    if (Math.abs(value1 - value2) < epsilon)
    {
        return true;
    }
    
    return false;
}

function determinant2x2(_11, _12, 
                        _21, _23)
{
    return (_11 * _23) - (_12 * _21);
}

function determinant3x3(_11, _12, _13, 
                        _21, _22, _23,
                        _31, _32, _33)
{
    var a = determinant2x2(_22, _23, _32, _33);
    var b = determinant2x2(_21, _23, _31, _33);
    var c = determinant2x2(_21, _22, _31, _32);
    
    return (_11 * a) - (_12 * b) + (_13 * c);
}
        
function determinant4x4(_11, _12, _13, _14,
                        _21, _22, _23, _24,
                        _31, _32, _33, _34,
                        _41, _42, _43, _44)
{
    var a = determinant3x3(_22, _23, _24, _32, _33, _34, _42, _43, _44);
    var b = determinant3x3(_21, _23, _24, _31, _33, _34, _41, _43, _44);
    var c = determinant3x3(_21, _22, _24, _31, _32, _34, _41, _42, _44);
    var d = determinant3x3(_21, _22, _23, _31, _32, _33, _41, _42, _43);
    
    return (_11 * a) - (_12 * b) + (_13 * c) - (_14 * d);  
}        

function modf(x)
{
    var integerPart = (x < 0 ? Math.ceil(x) : Math.floor(x));
    var fractionalPart = x - integerPart;
    
    return { integerPart: integerPart, fractionalPart: fractionalPart };
}

function XYZtoH(x, y, z)
{
    var heading = 0;
    
    if (x == 0)
    {
        if (z >= 0)
        {
            heading = 0.0;
        }
        else
        {
            heading = Math.PI;
        }
    }
    else if (z == 0)
    {
        if (x >= 0)
        {
            heading = 3 * HALFPI;
        }
        else
        {
            heading = HALFPI;
        }
    }
    else
    {
        if (x > 0 && z > 0) // I
        {
            heading = TWOPI - Math.atan(x / z);
        }
        else if (x < 0 && z > 0) // II
        {
            heading = -Math.atan(x / z);
        }
        else if (x < 0 && z < 0)  // III
        {
            heading = HALFPI + Math.atan(z / x);
        }
        else // (x > 0 && z < 0)  // IV
        {
            heading = 3 * HALFPI + Math.atan(z / x);
        }
    }
    
    return heading;
}

function XYZtoHP(x, y, z)
{
    var heading = 0;
    var pitch = 0;
    
    if (x == 0 && z == 0) 
    {
        heading = 0;
        if (y != 0)
        {
            pitch = (y < 0 ? -HALFPI : HALFPI);
        }
        else
        {
            pitch = 0;
        }
    }
    else 
    {
        if (z == 0)
        {
            heading = (x > 0 ? HALFPI : -HALFPI);
        }
        else if (z < 0)
        {
            heading = -Math.atan(x / z) + Math.PI;
        }
        else
        {
            heading = -Math.atan(x / z);
        }

        x = Math.sqrt(x * x + z * z);

        if (x == 0)
        {
            pitch = (y < 0 ? -HALFPI : HALFPI);
        }
        else
        {
            pitch = Math.atan(y / x);
        }
    }
    
    return { heading: heading, pitch: pitch };
}

function rectContainsPoint(x, y, rect)
{
    if (x >= rect.left &&
        y >= rect.top &&
        x <= rect.right &&
        y <= rect.bottom)
        return true;
        
    return false;
}
function Vector2D(x, y)
{
    this.x = x || 0;
    this.y = y || 0;
}

Vector2D.prototype.v = function()
{
    var values = [ this.x, this.y ];
    return values;
}

Vector2D.prototype.load = function(x, y)
{
    this.x = x;
    this.y = y;
}

Vector2D.prototype.copy = function(vector)
{
    if (vector)
    {
        this.x = vector.x;
        this.y = vector.y;
    }
}
function Vector3D(x, y, z)
{
    this.x = x || 0;
    this.y = y || 0;
    this.z = z || 0;

    this.equals = function(rhs)
    {
        return (this.x == rhs.x &&
                this.y == rhs.y &&
                this.z == rhs.z);
    }
}

Vector3D.prototype.alert = function()
{
    var msg  = "x: " + this.x + "\n";
        msg += "y: " + this.y + "\n";
        msg += "z: " + this.z + "\n";
    alert(msg);
}

Vector3D.prototype.v = function()
{
    var values = [ this.x, this.y, this.z ];
    return values;
}

Vector3D.prototype.load = function(x, y, z)
{
    this.x = x;
    this.y = y;
    this.z = z;
}

Vector3D.prototype.copy = function(vector)
{
    if (vector)
    {
        this.x = vector.x;
        this.y = vector.y;
        this.z = vector.z;
    }
}

Vector3D.prototype.multiplyScalar = function(scalar)
{
    this.x *= scalar;
    this.y *= scalar;
    this.z *= scalar;
}

Vector3D.prototype.multiplyVector = function(vector)
{
    this.x *= vector.x;
    this.y *= vector.y;
    this.z *= vector.z;
}

Vector3D.prototype.addVector = function(vector)
{
    this.x += vector.x;
    this.y += vector.y;
    this.z += vector.z;
}

Vector3D.prototype.subtractVector = function(vector)
{
    this.x -= vector.x;
    this.y -= vector.y;
    this.z -= vector.z;
}

Vector3D.prototype.normalize = function()
{
    var mag = magnitude(this.x, this.y, this.z);
    if (mag != 0)
    {
        this.x /= mag;
        this.y /= mag;
        this.z /= mag;
    }
}

Vector3D.prototype.length = function()
{
    return magnitude(this.x, this.y, this.z);
}
    
function dotProduct(v1, v2)
{
    return ((v1.x * v2.x) + (v1.y * v2.y) + (v1.z * v2.z));
}

function crossProduct(v1, v2)
{
    var result = new Vector3D();
    
    result.x = (v1.y * v2.z) - (v1.z * v2.y);
    result.y = (v1.z * v2.x) - (v1.x * v2.z);
    result.z = (v1.x * v2.y) - (v1.y * v2.x);
    
    return result;
}

function cosineAngleBetween(v1, v2)
{
    var mag = magnitude(v1.x, v1.y, v1.z) * magnitude(v2.x, v2.y, v2.z);
    if (mag != 0)
    {
        var cosAngle = dotProduct(v1, v2) / mag;

        // clamp values between -1 and 1
        if (cosAngle > 1) cosAngle = 1;
        else if (cosAngle < -1) cosAngle = -1;

        return cosAngle;
    }

    return 1;
}

function midpoint(v1, v2)
{
    var result = new Vector3D();
    
    result.x = (v1.x + v2.x) / 2;
    result.y = (v1.y + v2.y) / 2;
    result.z = (v1.z + v2.z) / 2;
    
    return result;
}

function distanceBetween(v1, v2)
{
    return Math.sqrt((v1.x - v2.x) * (v1.x - v2.x) + 
                     (v1.y - v2.y) * (v1.y - v2.y) +
                     (v1.z - v2.z) * (v1.z - v2.z));
}

function subtract3D(v1, v2)
{
    var result = new Vector3D(v1.x, v1.y, v1.z);
    result.subtractVector(v2);
    return result;
}
function Vector4D(x, y, z, w)
{
    this.x = x || 0;
    this.y = y || 0;
    this.z = z || 0;
    this.w = w || 0;
}

Vector4D.prototype.v = function()
{
    var values = [ this.x, this.y, this.z, this.w ];
    return values;
}

Vector4D.prototype.load = function(x, y, z, w)
{
    if (Vector4D)
    {
        this.x = x;
        this.y = y;
        this.z = z;
        this.w = w;
    }
}

Vector4D.prototype.copy = function(vector)
{
    this.x = vector.x;
    this.y = vector.y;
    this.z = vector.z;
    this.w = vector.w;
}
function Matrix4x4(_11, _12, _13, _14,
                   _21, _22, _23, _24,
                   _31, _32, _33, _34,
                   _41, _42, _43, _44)
{
    this._11 = _11 || 1;
    this._12 = _12 || 0;
    this._13 = _13 || 0;
    this._14 = _14 || 0;

    this._21 = _21 || 0;
    this._22 = _22 || 1;
    this._23 = _23 || 0;
    this._24 = _24 || 0;

    this._31 = _31 || 0;
    this._32 = _32 || 0;
    this._33 = _33 || 1;
    this._34 = _34 || 0;

    this._41 = _41 || 0;
    this._42 = _42 || 0;
    this._43 = _43 || 0;
    this._44 = _44 || 1;
}

Matrix4x4.prototype.alert = function()
{
    alert([[this._11, this._12, this._13, this._14].join(" "),
           [this._21, this._22, this._23, this._24].join(" "),
           [this._31, this._32, this._33, this._34].join(" "),
           [this._41, this._42, this._43, this._44].join(" ")].join("\n") 
    );
}

Matrix4x4.prototype.flatten = function()
{
    var v = [
        this._11, this._12, this._13, this._14,
        this._21, this._22, this._23, this._24,
        this._31, this._32, this._33, this._34,
        this._41, this._42, this._43, this._44
    ];
    
    return v;
}

Matrix4x4.prototype.getAt = function(row, col)
{
    switch (row)
    {
    case 0:
        {
            switch (col)
            {
            case 0: return this._11;
            case 1: return this._12;
            case 2: return this._13;
            case 3: return this._14;
            }
        }
        break;
     
    case 1:
        {
            switch (col)
            {
            case 0: return this._21;
            case 1: return this._22;
            case 2: return this._23;
            case 3: return this._24;
            }
        }
        break;
        
    case 2:
        {
            switch (col)
            {
            case 0: return this._31;
            case 1: return this._32;
            case 2: return this._33;
            case 3: return this._34;
            }
        }
        break;
        
    case 3:
        {
            switch (col)
            {
            case 0: return this._41;
            case 1: return this._42;
            case 2: return this._43;
            case 3: return this._44;
            }
        }
        break;
    }
}

Matrix4x4.prototype.setAt = function(row, col, value)
{
    switch (row)
    {
    case 0:
        {
            switch (col)
            {
            case 0: this._11 = value; break;
            case 1: this._12 = value; break;
            case 2: this._13 = value; break;
            case 3: this._14 = value; break;
            }
        }
        break;
     
    case 1:
        {
            switch (col)
            {
            case 0: this._21 = value; break;
            case 1: this._22 = value; break;
            case 2: this._23 = value; break;
            case 3: this._24 = value; break;
            }
        }
        break;
        
    case 2:
        {
            switch (col)
            {
            case 0: this._31 = value; break;
            case 1: this._32 = value; break;
            case 2: this._33 = value; break;
            case 3: this._34 = value; break;
            }
        }
        break;
        
    case 3:
        {
            switch (col)
            {
            case 0: this._41 = value; break;
            case 1: this._42 = value; break;
            case 2: this._43 = value; break;
            case 3: this._44 = value; break;
            }
        }
        break;
    }
}

Matrix4x4.prototype.load = function(_11, _12, _13, _14,
                                    _21, _22, _23, _24,
                                    _31, _32, _33, _34,
                                    _41, _42, _43, _44)
{
    this._11 = _11;
    this._12 = _12;
    this._13 = _13;
    this._14 = _14;
    
    this._21 = _21;
    this._22 = _22;
    this._23 = _23;
    this._24 = _24;
    
    this._31 = _31;
    this._32 = _32;
    this._33 = _33;
    this._34 = _34;
    
    this._41 = _41;
    this._42 = _42;
    this._43 = _43;
    this._44 = _44;
}

Matrix4x4.prototype.loadMatrix = function(matrix)
{
    this._11 = matrix._11;
    this._12 = matrix._12;
    this._13 = matrix._13;
    this._14 = matrix._14;
    
    this._21 = matrix._21;
    this._22 = matrix._22;
    this._23 = matrix._23;
    this._24 = matrix._24;
    
    this._31 = matrix._31;
    this._32 = matrix._32;
    this._33 = matrix._33;
    this._34 = matrix._34;
    
    this._41 = matrix._41;
    this._42 = matrix._42;
    this._43 = matrix._43;
    this._44 = matrix._44;
}

Matrix4x4.prototype.loadArray = function(array)
{
    this._11 = array[0];
    this._12 = array[1];
    this._13 = array[2];
    this._14 = array[3];

    this._21 = array[4];
    this._22 = array[5];
    this._23 = array[6];
    this._24 = array[7];

    this._31 = array[8];
    this._32 = array[9];
    this._33 = array[10];
    this._34 = array[11];

    this._41 = array[12];
    this._42 = array[13];
    this._43 = array[14];
    this._44 = array[15];
}

Matrix4x4.prototype.loadIdentity = function()
{
    this._11 = 1;
    this._12 = 0;
    this._13 = 0;
    this._14 = 0;
        
    this._21 = 0;
    this._22 = 1;
    this._23 = 0;
    this._24 = 0;
    
    this._31 = 0;
    this._32 = 0;
    this._33 = 1;
    this._34 = 0;
    
    this._41 = 0;
    this._42 = 0;
    this._43 = 0;
    this._44 = 1;
}

Matrix4x4.prototype.loadTranslation = function(x, y, z)
{
    this.loadIdentity();
    
    this._41 = x;
    this._42 = y;
    this._43 = z;
}

Matrix4x4.prototype.loadRotation = function(x, y, z, degrees)
{
    // build rotation (and inverse rotation) matrix to rotate space 
    // about the X axis so that the rotation axis lies in the XZ plane
    var mX = new Matrix4x4();
    var mXinv = new Matrix4x4();
    var v = Math.sqrt(y * y + z * z);
    if (v != 0)
    {
        var y_v = y / v;
        var z_v = z / v;

        mX._22 =  z_v;
        mX._23 =  y_v;
        mX._32 = -y_v;
        mX._33 =  z_v;

        mXinv._22 =  z_v;
        mXinv._23 = -y_v;
        mXinv._32 =  y_v;
        mXinv._33 =  z_v;
    }

    // build rotation (and inverse rotation) matrix to rotate space 
    // about the Y axis so that the rotation axis is aligned with the Z axis
    var mY = new Matrix4x4();
    var mYinv = new Matrix4x4();
    var v2 = magnitude(x, y, z);
    if (v2 != 0)
    {
        var v_v2 = v / v2;
        var x_v2 = x / v2;

        mY._11 =  v_v2;
        mY._13 =  x_v2;
        mY._31 = -x_v2;
        mY._33 =  v_v2;

        mYinv._11 =  v_v2;
        mYinv._13 = -x_v2;
        mYinv._31 =  x_v2;
        mYinv._33 =  v_v2;
    }

    // build rotation matrix to rotate about the Z axis
    var mZ = new Matrix4x4();
    var cosAngle = Math.cos(toRadians(degrees));
    var sinAngle = Math.sin(toRadians(degrees));
    mZ._11 =  cosAngle;
    mZ._12 =  sinAngle;
    mZ._21 = -sinAngle;
    mZ._22 =  cosAngle;

    // sum rotations
    var result = mX.multiply(mY.multiply(mZ.multiply(mYinv.multiply(mXinv))));
    this.loadMatrix(result);
}

Matrix4x4.prototype.loadXAxisRotation = function(degrees)
{
    this.loadIdentity();

    var cosAngle = Math.cos(toRadians(degrees));
    var sinAngle = Math.sin(toRadians(degrees));

    this._22 =  cosAngle;
    this._23 =  sinAngle;
    this._32 = -sinAngle;
    this._33 =  cosAngle;
}

Matrix4x4.prototype.loadYAxisRotation = function(degrees)
{
    this.loadIdentity();

    var cosAngle = Math.cos(toRadians(degrees));
    var sinAngle = Math.sin(toRadians(degrees));

    this._11 =  cosAngle;
    this._13 = -sinAngle;
    this._31 =  sinAngle;
    this._33 =  cosAngle;
}

Matrix4x4.prototype.loadZAxisRotation = function(degrees)
{
    this.loadIdentity();

    var cosAngle = Math.cos(toRadians(degrees));
    var sinAngle = Math.sin(toRadians(degrees));

    this._11 =  cosAngle;
    this._12 =  sinAngle;
    this._21 = -sinAngle;
    this._22 =  cosAngle;
}

Matrix4x4.prototype.loadXYZAxisRotation = function(degreesX, degreesY, degreesZ)
{
    var mX = new Matrix4x4();
    var mY = new Matrix4x4();
    var mZ = new Matrix4x4();

    mX.loadXAxisRotation(degreesX);
    mY.loadYAxisRotation(degreesY);
    mZ.loadZAxisRotation(degreesZ);

    // sum rotations
    var result = mY.multiply(mX.multiply(mZ));
    this.loadMatrix(result);
}

Matrix4x4.prototype.getTranslation = function()
{
    return { x: this._41, y: this._42, z: this._43 }
}

Matrix4x4.prototype.getRotationAngles = function()
{
    var x, y, z;
    
    x = Math.asin(clamp(this._23, -1, 1));
    var cosx = Math.cos(x);
    
    if (!epsilonEqual(cosx, 0, FLT_EPSILON))
    {
        y = Math.atan2(-(this._13) / cosx, this._33 / cosx);
        z = Math.atan2(-(this._21) / cosx, this._22 / cosx); 
    }
    else // cosx == 0
    {
        // remove x-axis rotation to obtain z-axis rotation by 
        // multiplying this matrix with inverse of x-axis rotation
        var zAxisRot = new Matrix4x4();
        zAxisRot.loadXAxisRotation(toDegrees(x));
        zAxisRot.transpose(); // invert rotation
        zAxisRot.loadMatrix(zAxisRot.multiply(this));
        
        y = 0;
        z = Math.atan2(-(zAxisRot._21), zAxisRot._22);
    }
    
    return { x: toDegrees(x), y: toDegrees(y), z: toDegrees(z) };
}

Matrix4x4.prototype.getQuaternion = function()
{
    var m = new Matrix4x4();
    m.loadMatrix(this);
    
    // remove scale
    var scalingFactors = m.getScalingFactors();
    var scale = new Matrix4x4();
    scale.loadScale(1 / scalingFactors.x, 1 / scalingFactors.y, 1 / scalingFactors.z);
    m = m.multiply(scale);
    
    m.transpose();
    
    var q = new Quaternion();
    
    q.w = Math.sqrt( Math.max( 0, 1 + m._11 + m._22 + m._33 ) ) / 2; 
    q.x = Math.sqrt( Math.max( 0, 1 + m._11 - m._22 - m._33 ) ) / 2; 
    q.y = Math.sqrt( Math.max( 0, 1 - m._11 + m._22 - m._33 ) ) / 2; 
    q.z = Math.sqrt( Math.max( 0, 1 - m._11 - m._22 + m._33 ) ) / 2; 
    
    q.x *= SIGN( m._32 - m._23 );
    q.y *= SIGN( m._13 - m._31 );
    q.z *= SIGN( m._21 - m._12 );
    
    return q;
}

Matrix4x4.prototype.loadScale = function(x, y, z)
{
    this.loadIdentity();

    this._11 = x;
    this._22 = y;
    this._33 = z;
}

Matrix4x4.prototype.getScalingFactors = function()
{
    var a, b;
    
    // x
    a = this.transform(1, 0, 0, 0);
    b = this.transform(2, 0, 0, 0);
    var scalingX = magnitude(b.x, b.y, b.z) - magnitude(a.x, a.y, a.z);
    
    // y
    a = this.transform(0, 1, 0, 0);
    b = this.transform(0, 2, 0, 0);
    var scalingY = magnitude(b.x, b.y, b.z) - magnitude(a.x, a.y, a.z);
    
    // z
    a = this.transform(0, 0, 1, 0);
    b = this.transform(0, 0, 2, 0);
    var scalingZ = magnitude(b.x, b.y, b.z) - magnitude(a.x, a.y, a.z);
    
    return { x: scalingX, y: scalingY, z: scalingZ };
}

Matrix4x4.prototype.multiply = function(rhs)
{
    var result = new Matrix4x4();
    
    if (!rhs)
    {
        return null;    
    }
    
    result.load
    (
        this._11 * rhs._11 + this._12 * rhs._21 + this._13 * rhs._31 + this._14 * rhs._41,
        this._11 * rhs._12 + this._12 * rhs._22 + this._13 * rhs._32 + this._14 * rhs._42,
        this._11 * rhs._13 + this._12 * rhs._23 + this._13 * rhs._33 + this._14 * rhs._43,
        this._11 * rhs._14 + this._12 * rhs._24 + this._13 * rhs._34 + this._14 * rhs._44,
        this._21 * rhs._11 + this._22 * rhs._21 + this._23 * rhs._31 + this._24 * rhs._41,
        this._21 * rhs._12 + this._22 * rhs._22 + this._23 * rhs._32 + this._24 * rhs._42,
        this._21 * rhs._13 + this._22 * rhs._23 + this._23 * rhs._33 + this._24 * rhs._43,
        this._21 * rhs._14 + this._22 * rhs._24 + this._23 * rhs._34 + this._24 * rhs._44,
        this._31 * rhs._11 + this._32 * rhs._21 + this._33 * rhs._31 + this._34 * rhs._41,
        this._31 * rhs._12 + this._32 * rhs._22 + this._33 * rhs._32 + this._34 * rhs._42,
        this._31 * rhs._13 + this._32 * rhs._23 + this._33 * rhs._33 + this._34 * rhs._43,
        this._31 * rhs._14 + this._32 * rhs._24 + this._33 * rhs._34 + this._34 * rhs._44,
        this._41 * rhs._11 + this._42 * rhs._21 + this._43 * rhs._31 + this._44 * rhs._41,
        this._41 * rhs._12 + this._42 * rhs._22 + this._43 * rhs._32 + this._44 * rhs._42,
        this._41 * rhs._13 + this._42 * rhs._23 + this._43 * rhs._33 + this._44 * rhs._43,  
        this._41 * rhs._14 + this._42 * rhs._24 + this._43 * rhs._34 + this._44 * rhs._44
     );
     
     return result; 
}

Matrix4x4.prototype.leftMultiply = function(lhs)
{
    var result = lhs.multiply(this);
    
    return result;
}

Matrix4x4.prototype.transpose = function()
{
    var temp = new Matrix4x4();
    temp.loadMatrix(this);
    
    this._11 = temp._11;
    this._12 = temp._21;
    this._13 = temp._31;
    this._14 = temp._41;

    this._21 = temp._12;
    this._22 = temp._22;
    this._23 = temp._32;
    this._24 = temp._42;

    this._31 = temp._13;
    this._32 = temp._23;
    this._33 = temp._33;
    this._34 = temp._43;

    this._41 = temp._14;
    this._42 = temp._24;
    this._43 = temp._34;
    this._44 = temp._44;
}

Matrix4x4.prototype.invert = function(transpose)
{
    var det = determinant4x4(this._11, this._12, this._13, this._14,
                             this._21, this._22, this._23, this._24,
                             this._31, this._32, this._33, this._34,
                             this._41, this._42, this._43, this._44);
    if (det == 0)
    {
        // no inverse
        return;
    }
    
    var inverse  = new Matrix4x4();
    
    var i, j, i2, j2, k;
    
    for (i=0; i < 4; i++)
    {
        for (j=0; j < 4; j++)
        {
            var sub = [];

            for (i2=0, k=0; i2 < 4; i2++)
            {
                if (i2 == i) continue;

                for (j2=0; j2 < 4; j2++)
                {
                    if (j2 == j) continue;

                    sub[k++] = this.getAt(i2, j2);
                }
            }

            inverse.setAt(i, j, determinant3x3(sub[0], sub[1], sub[2], sub[3], sub[4], sub[5], sub[6], sub[7], sub[8]) / det * (i+j & 1 ? -1 : 1));
        }
    }

    // if transpose requested, don't transpose (because inverse is already transposed at this point)
    if (!transpose)
    {
        inverse.transpose();
    }

    this.loadMatrix(inverse);
}

Matrix4x4.prototype.transform = function(x, y, z, w)
{
    var tx, ty, tz;
    
    if (w == 0)
    {
        tx = this._11 * x + this._21 * y + this._31 * z;
        ty = this._12 * x + this._22 * y + this._32 * z;
        tz = this._13 * x + this._23 * y + this._33 * z;
    }
    else if (w == 1)
    {
        tx = this._11 * x + this._21 * y + this._31 * z + this._41;
        ty = this._12 * x + this._22 * y + this._32 * z + this._42;
        tz = this._13 * x + this._23 * y + this._33 * z + this._43;
    }
    else
    {
        tx = this._11 * x + this._21 * y + this._31 * z + this._41 * w;
        ty = this._12 * x + this._22 * y + this._32 * z + this._42 * w;
        tz = this._13 * x + this._23 * y + this._33 * z + this._43 * w;
    } 
    
    return { x: tx, y: ty, z: tz };
}

Matrix4x4.prototype.transformw = function(x, y, z, w)
{
    var tx, ty, tz, tw;
    
    if (w == 0)
    {
        tx = this._11 * x + this._21 * y + this._31 * z;
        ty = this._12 * x + this._22 * y + this._32 * z;
        tz = this._13 * x + this._23 * y + this._33 * z;
        tw = this._14 * x + this._24 * y + this._34 * z;
    }
    else if (w == 1)
    {
        tx = this._11 * x + this._21 * y + this._31 * z + this._41;
        ty = this._12 * x + this._22 * y + this._32 * z + this._42;
        tz = this._13 * x + this._23 * y + this._33 * z + this._43;
        tw = this._14 * x + this._24 * y + this._34 * z + this._44;
    }
    else
    {
        tx = this._11 * x + this._21 * y + this._31 * z + this._41 * w;
        ty = this._12 * x + this._22 * y + this._32 * z + this._42 * w;
        tz = this._13 * x + this._23 * y + this._33 * z + this._43 * w;
        tw = this._14 * x + this._24 * y + this._34 * z + this._44 * w;
    } 
    
    return { x: tx, y: ty, z: tz, w: tw };
}

Matrix4x4.prototype.transformVector3D = function(vector, w)
{
    return this.transform(vector.x, vector.y, vector.z, w);
}
MatrixStack.prototype = new Stack();
MatrixStack.prototype.constructor = MatrixStack;

function MatrixStack(element)
{
    Stack.call(this, element);
}

MatrixStack.prototype.push = function(element)
{
    if (element)
    {
        this.stack.push(element);
    }
    else
    {
        this.stack.push(this.top());
    }
}

MatrixStack.prototype.loadMatrix = function(matrix)
{
    this.load(matrix);
}

MatrixStack.prototype.leftMultiply = function(lhs)
{
    var result = lhs.multiply(this.top());
    this.pop();
    Stack.prototype.push.call(this, result);
}

MatrixStack.prototype.rightMultiply = function(rhs)
{
    var result = this.top().multiply(rhs);
    this.pop();
    Stack.prototype.push.call(this, result);
}

function Quaternion(w, x, y, z)
{
    this.w = w || 1;
    this.x = x || 0;
    this.y = y || 0;
    this.z = z || 0;
}

Quaternion.prototype.load = function(w, x, y, z)
{
    this.w = w;
    this.x = x;
    this.y = y;
    this.z = z;
}

Quaternion.prototype.loadQuaternion = function(quaternion)
{
    this.w = quaternion.w;
    this.x = quaternion.x;
    this.y = quaternion.y;
    this.z = quaternion.z;
}

Quaternion.prototype.loadArray = function(array)
{
    this.w = array[0];
    this.x = array[1];
    this.y = array[2];
    this.z = array[3];
}

Quaternion.prototype.loadIdentity = function()
{
    this.w = 1;
    this.x = 0;
    this.y = 0;
    this.z = 0;
}

Quaternion.prototype.magnitude = function()
{
    return Math.sqrt(this.w * this.w + this.x * this.x + this.y * this.y + this.z * this.z);
}

Quaternion.prototype.normalize = function()
{
    var magnitude = this.magnitude();
    
    this.w /= magnitude;
    this.x /= magnitude;
    this.y /= magnitude;
    this.z /= magnitude; 
}

Quaternion.prototype.loadRotation = function(x, y, z, degrees)
{
    var radians = toRadians(degrees) / 2;
    
    var sinAngle = Math.sin(radians);
    var cosAngle = Math.cos(radians);
    
    this.w = cosAngle;
    this.x = x * sinAngle;
    this.y = y * sinAngle;
    this.z = z * sinAngle;
    
    this.normalize();
}

Quaternion.prototype.loadXAxisRotation = function(degrees)
{
    var radians = toRadians(degrees) / 2;
    
    this.w = Math.cos(radians);
    this.x = Math.sin(radians);
    this.y = 0;
    this.z = 0;
}

Quaternion.prototype.loadYAxisRotation = function(degrees)
{
    var radians = toRadians(degrees) / 2;
    
    this.w = Math.cos(radians);
    this.x = 0
    this.y = Math.sin(radians);;
    this.z = 0;
}

Quaternion.prototype.loadZAxisRotation = function(degrees)
{
    var radians = toRadians(degrees) / 2;
    
    this.w = Math.cos(radians);
    this.x = 0;
    this.y = 0;
    this.z = Math.sin(radians);
}

Quaternion.prototype.loadXYZAxisRotation = function(degreesX, degreesY, degreesZ)
{
    var radiansX = toRadians(degreesX) / 2;
    var radiansY = toRadians(degreesY) / 2;
    var radiansZ = toRadians(degreesZ) / 2;
    
    var qX = new Quaternion();
    qX.load(Math.cos(radiansX), Math.sin(radiansX), 0, 0);
    
    var qY = new Quaternion();
    qY.load(Math.cos(radiansY), 0, Math.sin(radiansY), 0);
    
    var qZ = new Quaternion();
    qZ.load(Math.cos(radiansZ), 0, 0, Math.sin(radiansZ));
    
    // sum rotations
    var result = qY.multiply(qX.multiply(qZ));
    this.loadQuaternion(result);
}

Quaternion.prototype.multiply = function(rhs)
{
    var result = new Quaternion();
    
    result.load
    (
        this.w * rhs.w - this.x * rhs.x - this.y * rhs.y - this.z * rhs.z,
        this.w * rhs.x + this.x * rhs.w + this.y * rhs.z - this.z * rhs.y,
        this.w * rhs.y + this.y * rhs.w + this.z * rhs.x - this.x * rhs.z,
        this.w * rhs.z + this.z * rhs.w + this.x * rhs.y - this.y * rhs.x    
    );
    
    return result;
}

Quaternion.prototype.getMatrix = function()
{
    var matrix = new Matrix4x4();
    
    var x2 = this.x + this.x;
    var y2 = this.y + this.y;
    var z2 = this.z + this.z;
    var xx = this.x * x2;
    var xy = this.x * y2;
    var xz = this.x * z2;
    var yy = this.y * y2;
    var yz = this.y * z2;
    var zz = this.z * z2;
    var wx = this.w * x2;
    var wy = this.w * y2;
    var wz = this.w * z2;

    matrix._11 = 1 - (yy + zz);
    matrix._21 = xy - wz;
    matrix._31 = xz + wy;
    matrix._41 = 0;

    matrix._12 = xy + wz;
    matrix._22 = 1 - (xx + zz);
    matrix._32 = yz - wx;
    matrix._42 = 0;

    matrix._13 = xz - wy;
    matrix._23 = yz + wx;
    matrix._33 = 1 - (xx + yy);
    matrix._43 = 0;

    matrix._14 = 0;
    matrix._24 = 0;
    matrix._34 = 0;
    matrix._44 = 1;
    
    return matrix;
}

Quaternion.prototype.getRotationAngles = function()
{
    var x2 = this.x * this.x;
    var y2 = this.y * this.y;
    var z2 = this.z * this.z;
    var xy = this.x * this.y;
    var xz = this.x * this.z
    var yz = this.y * this.z;
    var wx = this.w * this.x;
    var wy = this.w * this.y;
    var wz = this.w * this.z;   
    var yz = this.y * this.z;
    
    var x = Math.atan2(2 * (wx + yz), 1 - 2 * (x2 + y2));
    var y = Math.asin(2 * (wy - xz));
    var z = Math.atan2(2 * (wz + xy), 1 - 2 * (y2 + z2));
    
    return { x: toDegrees(x), y: toDegrees(y), z: toDegrees(z) }
}


function Line(point, dir)
{
    this.point = new Vector3D(point.x, point.y, point.z);
    this.dir = new Vector3D(dir.x, dir.y, dir.z);
}
function Plane(point, normal)
{
    this.point = new Vector3D();
    this.normal = new Vector3D();
    this.dot = 0;
    
    if (point && normal)
    {
        this.point.copy(point);
        this.normal.copy(normal);
        this.dot = dotProduct(this.point, this.normal);
    }
}

Plane2.prototype = new Plane();
Plane2.prototype.constructor = Plane2;

function Plane2(v0, v1, v2)
{
    var normal;

    if (v0 && v1 && v2)
    {
        var leg1 = new Vector3D(v2.x - v1.x, v2.y - v1.y, v2.z - v1.z);
        var leg2 = new Vector3D(v0.x - v1.x, v0.y - v1.y, v0.z - v1.z);
        normal = crossProduct(leg1, leg2);
        normal.normalize();
    }
    
    Plane.call(this, v0, normal);
}

/**
 * Determine if a point lies on the plane.
 * @param point     - the point.
 * @param plane     - the plane.
 * @param tolerance - tolerance amount.
 * @return bool     - true if the point lies on the plane, false if it does not.
 */
function pointOnPlane(point, plane, tolerance)
{
    return (Math.abs(dotProduct(point, plane.normal) - plane.dot) < tolerance ? true : false);
}

/**
 * Determine if a point lies on the positive side of the plane; i.e., determine if the 
 * point lies in the half-space on the side of the plane in the direction of the normal.
 * @param point     - the point.
 * @param plane     - the plane.
 * @return bool     - true if the point lies on the positive side of the plane, false if 
 *                    it does not.
 */
function pointOnPositiveSideOfPlane(point, plane)
{
    return (dotProduct(point, plane.normal) - plane.dot > 0 ? true : false);
}

/**
 * Determine if a point lies on the negative side of the plane; i.e., determine if the 
 * point lies in the half-space on the side of the plane in the opposite direction of the 
 * normal.
 * @param point     - the point.
 * @param plane     - the plane.
 * @return bool     - true if the point lies on the negative side of the plane, false if 
 *                    it does not.
 */
function pointOnNegativeSideOfPlane(point, plane)
{
    return (dotProduct(point, plane.normal) - plane.dot < 0 ? true : false);
}

/**
 * Determine if a line intersects the plane.  If it does, find the point of intersection.
 * @param line  - the line.
 * @param plane - the plane.
 * @param point - the point of intersection (if line intersects plane).
 * @return int  - returns:
 *                  0 if line does not intersect plane
 *                  1 if line intersects plane at one point
 *                  2 if line intersects plane at infinite points (line lies on plane)
 */
function lineIntersectsPlane(line, plane)
{
    var point = new Vector3D();
    var result;
    
    // solve for t in terms of plane equation Ax + By + Cz = D
    var lhs = plane.normal.x * line.dir.x + plane.normal.y * line.dir.y + plane.normal.z * line.dir.z;
    if (lhs == 0)  // plane and line are parallel
    {
        // if line point lies on the plane, consider this an intersection
        if (pointOnPlane(line.point, plane, FLT_EPSILON))
        {
            point.copy(line.point);
            result = 2;
        }

        result = 0;
    }
    else
    {
        var rhs = plane.dot - (plane.normal.x * line.point.x + plane.normal.y * line.point.y + plane.normal.z * line.point.z);
        var t = rhs / lhs;

        // calculate point of intersection
        point.x = t * line.dir.x + line.point.x;
        point.y = t * line.dir.y + line.point.y;
        point.z = t * line.dir.z + line.point.z;

        result = 1;
    }

    return { result: result, point: point };
}

/**
 * Determine if a line segment intersects the plane.  If it does, find the point of intersection.
 * @param a      - one endpoint of the line segment.
 * @param b      - other endpoint of the line segment.
 * @param plane  - the plane.
 * @return point - the point of intersection (if line segment intersects plane).
 * @return count - returns:
 *                  0 if line segment does not intersect plane
 *                  1 if line segment intersects plane at one point
 *                  2 if line segment intersects plane at infinite points (line segment lies on plane)
 */
function lineSegmentPlaneIntersection(a, b, plane)
{
    // represent line segment in parametric line equation form;
    // line through P0(x0, y0, z0) parallel to v = Ai + Bj + Ck =>
    // x = x0 + tA, y = y0 + tB, z = z0 + tC
    var ab = new Vector3D(b.x - a.x, b.y - a.y, b.z - a.z);
    var x0 = a.x;
    var y0 = a.y;
    var z0 = a.z;
    var tA = ab.x;
    var tB = ab.y;
    var tC = ab.z;

    // solve for t in terms of plane equation Ax + By + Cz = D
    var lhs = plane.normal.x * tA + plane.normal.y * tB + plane.normal.z * tC;
    if (lhs == 0)  // plane and line segment are parallel
    {
        // if a lies on the plane, consider this an intersection
        if (pointOnPlane(a, plane, FLT_EPSILON))
        {
            var point = new Vector3D(a);
            return { count: 2, point: point };
        }

        return { count: 0 };
    }

    var rhs = plane.dot - (plane.normal.x * x0 + plane.normal.y * y0 + plane.normal.z * z0);
    var t = rhs / lhs;

    // if t is not in range [0, 1], then point of intersection is not
    // within line segment
    if (t < 0 || t > 1) 
    {
        return { count: 0 };
    }

    // point of intersection is within line segment; calculate point
    var point = new Vector3D();
    point.x = t * tA + x0;
    point.y = t * tB + y0;
    point.z = t * tC + z0;

    return { count: 1, point: point };
}

/**
 * Determine if planes are coplanar.
 * @param plane1 - the first plane.
 * @param plane2 - the second plane.
 * @return bool  - true if the planes are coplanar, false if they are not.
 */
function coplanar(plane1, plane2)
{
    return (((plane1.normal == plane2.normal || plane1.normal == -plane2.normal) &&
              pointOnPlane(plane1.point, plane2)) ? true: false);
}

/**
 * Determine if planes intersect.
 * @param plane1 - the first plane.
 * @param plane2 - the second plane.
 * @return bool  - true if the planes intersect, false if they do not.
 */
function planesIntersect(plane1, plane2)
{
    // if planes are parallel (normal cross product == 0),
    // planes don't intersect (or they are coplanar)
    var zero = new Vector3D(0, 0, 0);
    if (crossProduct(plane1.normal, plane2.normal).equals(zero))
    {
        return false;
    }
 
    return true;
}

/**
 * Determine the distance between 2 parallel planes.  If planes are not parallel, 0 is returned.
 * @param plane1 - the first plane.
 * @param plane2 - the second plane.
 * @return float - the distance between the planes.
 */
function distanceBetweenPlanes(plane1, plane2)
{
    if (coplanar(plane1, plane2))
    {
        return 0;
    }

    if (!planesIntersect(plane1, plane2))
    {
        var intersection = lineIntersectsPlane(new Line(plane1.point, plane1.normal), plane2);
        if (intersection.result)
        {
            return distanceBetween(plane1.point, plane2.point);
        }
        else
        {
            return 0;
        }
    }

    // planes intersect
    return 0;
}
var EPSILON = 0.00000001;

function SIGN(x)
{
    return ((x >= 0) ? 1 : -1);
}

function SIGN3(v) 
{
    (((v).x < 0 ) ? 4 : 0 | ((v).y < 0) ? 2 : 0 | ((v).z < 0) ? 1 : 0);
}

/**
 * Solve quadratic equation with term coefficients a (2nd degree term), 
 * b (1st degree term), and c (constant term); return number of real roots; 
 * if 1 root exists, it is set to root1, if 2 roots exist, they are set to 
 * root1 and root2.
 * @param a      - 2nd degree term coefficient.
 * @param b      - 1st degree term coefficient.
 * @param c      - constant term.
 * @return root1 - first real root.
 * @return root2 - second real root.
 * @return count - 0: no real roots exist
 *                 1: 1 real root exists
 *                 2: 2 real roots exist
 */
function solveQuadraticEquation(a, b, c)
{
   if (a == 0) 
   {
       return { count: 0 };
   }

   var sqrt_term = b * b - 4 * a * c;
   if (sqrt_term < 0) 
   {
       return { count: 0 };
   }

   if (sqrt_term == 0)
   {
      var root1 = -b / (2 * a);
      return { count: 1, root1: root1 };
   }

   sqrt_term = Math.sqrt(sqrt_term);

   var root1 = (-b + sqrt_term) / (2 * a);
   var root2 = (-b - sqrt_term) / (2 * a);

   return { count: 2, root1: root1, root2: root2 };
}

/** 
 * Determine if a ray intersects a triangle. 
 *
 * Given a ray defined by an origin and a direction, and a triangle,
 * determine if the ray intersects the triangle; if an intersection exists, 
 * determine the distance t from the ray origin to the point of intersection, and the 
 * barycentric coordinates (u, v) inside the triangle;
 *
 * Algorithm adapted from:
 *    Tomas Moller and Ben Trumbore, "Fast, Minimum Storage Ray/Triangle 
 *    Intersection", journal of graphics tool, vol. 2, no. 1, pp. 21-28, 1997.
 *    http://www.ce.chalmers.se/staff/tomasm
 *
 * @param rayOrig    - ray origination point.
 * @param rayDir     - ray direction.
 * @param v0         - first triangle vertex.
 * @param v1         - second triangle vertex.
 * @param v2         - third triangle vertex.
 * @param skipPosDet - if true, skip intersection test (return false) if the triangle's determinate 
 *                     is positive.
 * @param skipNegDet - if true, skip intersection test (return false) if the triangle's determinate 
 *                     is negative.
 * @return t         - distance from ray origin to intersection point (if ray intersects triangle).
 * @return u         - barycentric coordinate u of intersection point (if ray intersects triangle).
 * @return v         - barycentric coordinate v of intersection point (if ray intersects triangle).
 * @return result    - true if the ray intersects the triangle, false if not.
 */
function rayTriangleIntersection(rayOrig, rayDir, v0, v1, v2, skipPosDet, skipNegDet)
{
    // normalize ray direction vector
    var dir = new Vector3D(rayDir.x, rayDir.y, rayDir.z);
    dir.normalize();

    // find vectors for two edges sharing v0
    var edge1 = new Vector3D(v1.x - v0.x, v1.y - v0.y, v1.z - v0.z);
    var edge2 = new Vector3D(v2.x - v0.x, v2.y - v0.y, v2.z - v0.z);
   
    // calculate determinant
    var pvec = crossProduct(dir, edge2);
    var det = dotProduct(edge1, pvec);

    // if determinant is near zero, ray lies in plane of triangle
    if (-EPSILON < det && det < EPSILON) 
    {
        return { result: false };
    }

    // if requested, skip triangles with negative/positive determinates
    if (skipPosDet && det > 0) 
    {
        return { result: false };
    }
    if (skipNegDet && det < 0) 
    {
        return { result: false };
    }

    var inv_det = 1 / det;

    // calculate distance from v0 to ray origin
    var tvec = new Vector3D(rayOrig.x - v0.x, rayOrig.y - v0.y, rayOrig.z - v0.z);

    // calculate u parameter and test bounds
    var u = dotProduct(tvec, pvec) * inv_det;
    if (u < 0 || u > 1)
    {
        return { result: false };
    }

    var qvec = crossProduct(tvec, edge1);

    // calculate v parameter and test bounds
    var v = dotProduct(dir, qvec) * inv_det;
    if (v < 0 || u + v > 1) 
    {
        return { result: false };
    }

    // ray intersects triangle, calculate t
    var t = dotProduct(edge2, qvec) * inv_det;

    return { result: true, t: t, u: u, v: v };
}

/**
 * Determine if a ray intersects a sphere.
 *
 * Given a ray defined by an origination point (x0, y0, z0), and
 * destination point (x1, y1, z1), and represented by the parametric equations: 
 * x = x0 + t(x1 - x0), y = y0 + t(y1 - y0), z = z0 + t(z1 - z0),
 * determine if the ray intersects the sphere defined by center (a, b, c) and
 * radius r, and represented by the equation (x - a) + (y - b) + (z - c) = r;
 *
 * For convenience, define dx = x1 - x0, dy = y1 - y0, dz = z1 - z0;
 *
 * The intersection is found by substituting x, y, and z from the ray equations
 * into the sphere equation, and solving for t (after term collection):
 * 
 * (dx + dy + dz)t + 2[dx(x0 - a) + dy(y0 - b) + dz(z0 - c)]t
 *    + (x0 - a) + (y0 - b) + (z0 - c) - r = 0
 *
 * Algorithm adapted from:
 *    Computer Graphics: Principles and Practice, 2nd Edition, Foley, et al., pp. 702-703
 *
 * @param rayOrig - ray origination point.
 * @param rayDir  - ray direction.
 * @param center  - sphere center point.
 * @param radius  - sphere radius.
 * @return root1  - root 1 from solving quadratic equation (if ray intersects sphere).
 * @return root2  - root 2 from solving quadratic equation (if ray intersects sphere).
 * @return count  - 0: ray does not intersect sphere
 *                  1: ray grazes sphere - root1 will contain the one real root
 *                  2: ray intersects sphere - root1 and root2 will contain both real roots
 */
function raySphereIntersection(rayOrig, rayDir, center, radius)
{
    // normalize ray direction vector
    var dir = new Vector3D(rayDir.x, rayDir.y, rayDir.z);
    dir.normalize();
    
    var rayDest = new Vector3D(rayOrig.x + dir.x, rayOrig.y + dir.y, rayOrig.z + dir.z);

    var dx = rayDest.x - rayOrig.x;
    var dy = rayDest.y - rayOrig.y;
    var dz = rayDest.z - rayOrig.z;

    // a = dx * dx + dy * dy + dz * dz == 1
    // because distance from rayOrig to rayDest is 1

    var b = 2 * (dx * (rayOrig.x - center.x) + 
                 dy * (rayOrig.y - center.y) + 
                 dz * (rayOrig.z - center.z));

    var c = (rayOrig.x - center.x) * (rayOrig.x - center.x) +
            (rayOrig.y - center.y) * (rayOrig.x - center.y) +
            (rayOrig.z - center.z) * (rayOrig.z - center.z) -
            radius * radius;

    return solveQuadraticEquation(1, b, c);
}

/**
 * Determine if the triangle contains a point which is known to lie in the plane of the triangle.  
 * Adapted from "Triangle-Cube Intersection", Graphics Gems III, pp.236-239.
 * @param v0      - first triangle vertex.
 * @param v1      - second triangle vertex.
 * @param v2      - third triangle vertex.
 * @param point   - the point.
 * @return result - true if the triangle contains the point, false if not. 
 */
function triangleContainsPoint(v0, v1, v2, point)
{
    // for each triangle side, make a vector out of it by subtracting vertices; 
    // make another vector from one vertex to the point; the cross-product of these 
    // two vectors is orthogonal to both and the signs of its components indicate 
    // whether the point was on the inside or on the outside of this triangle side
    var sign12 = SIGN3(crossProduct(subtract3D(v0, v1), subtract3D(v0, point))); 
    var sign23 = SIGN3(crossProduct(subtract3D(v1, v2), subtract3D(v1, point))); 
    var sign31 = SIGN3(crossProduct(subtract3D(v2, v0), subtract3D(v2, point))); 

    // if all three cross-product vectors agree in their component signs,
    // then the point must be inside all three; the point cannot be outside all 
    // three sides simultaneously.
    if ((sign12 == sign23) && (sign23 == sign31))
    {
        return true;
    }

    return false;
}

/**
 * Determine if a triangle lies on the positive side of the plane (the side in the direction of
 * the plane normal).
 * @param v0    - first vertex of triangle.
 * @param v1    - second vertex of triangle.
 * @param v2    - third vertex of triangle.
 * @return bool - true if the triangle lies on the positive side of the plane, false if not.
 */
function triangleOnPositiveSideOfPlane(v0, v1, v2, plane)
{
    return pointOnPositiveSideOfPlane(v0, plane) &&
           pointOnPositiveSideOfPlane(v1, plane) &&
           pointOnPositiveSideOfPlane(v2, plane);
}

/**
 * Determine if a triangle lies on the positive side of the plane (the side in the direction of
 * the plane normal).
 * @param v0    - first vertex of triangle.
 * @param v1    - second vertex of triangle.
 * @param v2    - third vertex of triangle.
 * @return bool - true if the triangle lies on the positive side of the plane, false if not.
 */
function triangleOnNegativeSideOfPlane(v0, v1, v2, plane)
{
    return pointOnNegativeSideOfPlane(v0, plane) &&
           pointOnNegativeSideOfPlane(v1, plane) &&
           pointOnNegativeSideOfPlane(v2, plane);
}

/**
 * Determine if a triangle spans the plane.
 * @param v0    - first vertex of triangle.
 * @param v1    - second vertex of triangle.
 * @param v2    - third vertex of triangle.
 * @return bool - true if the triangle spans the plane, false if not.
 */
function triangleSpansPlane(v0, v1, v2, plane)
{
    return !triangleOnPositiveSideOfPlane(v0, v1, v2, plane) &&
           !triangleOnNegativeSideOfPlane(v0, v1, v2, plane);
}

/**
 * Determine if the line segment intersects the triangle.  If so, find the point
 * of intersection.
 * @param a       - one endpoint of the line segment.
 * @param b       - other endpoint of the line segment.
 * @param v0      - first triangle vertex. 
 * @param v1      - second triangle vertex.
 * @param v2      - third triangle vertex.
 * @return point  - the point of intersection (if line segment intersects triangle). 
 * @return result - true if the line segment intersects the triangle, false if not.
 */
function lineSegmentTriangleIntersection(a, b, v0, v1, v2)
{
    // first check that line segment intersects plane of triangle
    var result = lineSegmentPlaneIntersection(a, b, new Plane2(v0, v1, v2));
    if (result.count == 0)
    {
        return { result: false, point: null };
    }

    // check that point is within triangle bounding box
    if (result.point.x < min3(v0.x, v1.x, v2.x) ||
        result.point.y < min3(v0.y, v1.y, v2.y) ||
        result.point.z < min3(v0.z, v1.z, v2.z) ||
        result.point.x > max3(v0.x, v1.x, v2.x) ||
        result.point.y > max3(v0.y, v1.y, v2.y) ||
        result.point.z > max3(v0.z, v1.z, v2.z))
    {
        return { result: false, point: null };
    }

    // check that point is within triangle
    if (triangleContainsPoint(v0, v1, v2, result.point))
    {
        return { result: true, point: result.point };
    }
    
    return { result: false, point: null };
}

/**
 * Determine if two triangles intersect.
 * @param t1v0  - first triangle's first vertex. 
 * @param t1v1  - first triangle's second vertex.
 * @param t1v2  - first triangle's third vertex.
 * @param t2v0  - second triangle's first vertex. 
 * @param t2v1  - second triangle's second vertex.
 * @param t2v2  - second triangle's third vertex.
 * @return bool - true if the triangles intersect, false if not.
 */
function triangleTriangleIntersection(t1v0, t1v1, t1v2,
                                      t2v0, t2v1, t2v2)
{
    if (!triangleSpansPlane(t1v0, t1v1, t1v2, new Plane(t2v0, t2v1, t2v2)) ||
        !triangleSpansPlane(t2v0, t2v1, t2v2, new Plane(t1v0, t1v1, t1v2)))
    {
        return false;
    }
 
    if (lineSegmentTriangleIntersection(t1v0, t1v1, t2v0, t2v1, t2v2).result ||
        lineSegmentTriangleIntersection(t1v1, t1v2, t2v0, t2v1, t2v2).result ||
        lineSegmentTriangleIntersection(t1v2, t1v0, t2v0, t2v1, t2v2).result ||

        lineSegmentTriangleIntersection(t2v0, t2v1, t1v0, t1v1, t1v2).result ||
        lineSegmentTriangleIntersection(t2v1, t2v2, t1v0, t1v1, t1v2).result ||
        lineSegmentTriangleIntersection(t2v2, t2v0, t1v0, t1v1, t1v2).result)
    {
        return true;
    }

    return false;
}

function planeProject(v, plane)
{
    return crossProduct(plane.normal, crossProduct(v, plane.normal));
}

function distanceBetweenLineSegmentAndPoint(a, b, point)
{
    // if segment points are coincident, return
    if (a.equals(b))
    {
        return distanceBetween(a, point);
    }

    var mag = magnitude(b.x - a.x, 
                        b.y - a.y, 
                        b.z - a.z);

    var u = (((point.x - a.x) * (b.x - a.x)) +
             ((point.y - a.y) * (b.y - a.y)) +
             ((point.z - a.z) * (b.z - a.z))) / (mag * mag);

    // if u is not in range [0, 1], shortest distance lies on line outside of segment -- chose closest endpoint
    if (u < 0)
    {
        return distanceBetween(a, point);
    }
    else if (u > 1)
    {
        return distanceBetween(b, point);
    }
    else // u E [0, 1]
    {
        return distanceBetween(new Vector3D(a.x + (b.x - a.x) * u,
                                            a.y + (b.y - a.y) * u,
                                            a.z + (b.z - a.z) * u), point);
    }
}

var eAttrType = {
    Unknown                     :-1,
    
    Attribute                   :0,
    
    AttributeContainer          :1,
    
    AttributeVector             :2,
    
    AttributeFactory            :3,
    
    AttributeRegistry           :4,
    
    BalloonTipLabelStyleAttr    :5,
    BBoxAttr                    :6,
    BooleanAttr                 :7,
    ColorAttr                   :8,
    FontStyleAttr               :9,
    IconStyleAttr               :10,
    ImageAttr                   :11,
    KeyframeAttr                :12,
    KeyframesAttr               :13,
    LabelStyleAttr              :14,
    HTMLLabelStyleAttr          :15,
    NumberArrayAttr             :16,
    NumberAttr                  :17,
    Matrix4x4Attr               :18,
    PlaneAttr                   :19,
    PulseAttr                   :20,
    RectAttr                    :21,
    ReferenceAttr               :22,
    StringAttr                  :23,
    StyleAttr                   :24,
    StylesAttr                  :25,
    StyleMapAttr                :26,
    StylesMapAttr               :27,
    Vector2DAttr                :28,
    Vector3DAttr                :29,
    ViewportAttr                :30,
    ViewVolumeAttr              :31,
    RenderableElementStyleAttr  :32,
    Bone                        :33,
    SnapConnector               :34,
    GenericConnector            :36,
    GenericConnectors           :37,
    SocketConnector             :38,
    SocketConnectors            :39,
    PlugConnector               :40,
    PlugConnectors              :41,
    SphereAttr                  :42,
    PhysicalPropertiesAttr      :43,
    SnapModelDescriptor         :44,
    SnapModelDescriptors        :45,
    
    Node                        :1000,
       
    ParentableMotionElement     :1001,
    Camera                      :1002,
    PerspectiveCamera           :1003,
    OrthographicCamera          :1004,
    Light                       :1005,
    DirectionalLight            :1006,
    PointLight                  :1007,
    SpotLight                   :1008, 
    GlobalIllumination          :1009,           
    Material                    :1010,
    Texture                     :1011, 
    RenderableElement           :1012,
    Geometry                    :1013,
    VertexGeoemtry              :1014,
    TriList                     :1015, 
    Group                       :1016,
    Isolator                    :1017,
    Dissolve                    :1018,  
    Transform                   :1019,   
    QuaternionRotate            :1020,
    Scale                       :1021,
    Rotate                      :1022,
    Translate                   :1023,   
    Model                       :1024,
    Surface                     :1025,
    MediaTexture                :1026,
    NullObject                  :1027,   
    Label                       :1028,
    HTMLLabel                   :1029,
    BalloonTipLabel             :1030, 
    PathTrace                   :1031,
    Bone                        :1032,
    Selector                    :1033,
    ScreenRect                  :1034,
    SnapModel                   :1035,
    Ball                        :1036,
    Beam                        :1037,
    Box                         :1038,
    Elbow                       :1039,
    Gear                        :1040,
    Plank                       :1041,
    Pyramid                     :1042,
    Ring                        :1043,   
    Tube                        :1044,
    Wall                        :1045,
    Wedge                       :1046,
    
    Evaluator                   :1100,
    SceneInspector              :1101,
    KeyframeInterpolator        :1102,
    BBoxLocator                 :1103,
    ArcballInspector            :1104,
    MapProjectionCalculator     :1105,
    ObjectInspector             :1106,
    MultiTargetObserver		:1107,
    ObjectMover	 		:1108,
    AnimalMover			:1109, 
    WalkSimulator               :1110,
    MorphEffector               :1111,
    BoneEffector                :1112,
    PhysicsSimulator            :1113,
    GoblinPhysicsSimulator      :1114,
    CannonPhysicsSimulator      :1115,
    Animator                    :1116,
    Spinner                     :1117,
    Evaluator_End               :1199, // all evaluator types must be given a type between Evaluator and Evaluator_End

    Node_End                    :1999,

    Directive                   :2000,
    UpdateDirective             :2001,
    RenderDirective             :2002,
    RayPickDirective            :2003,
    BBoxDirective               :2004,
    SerializeDirective          :2005,
    CollideDirective            :2006,
    HighlightDirective          :2007,
    ShadowDirective             :2008,
    Directive_End               :2999,
    
    Command                     :3000,
    CommandSequence             :3001,
    AppendNode                  :3002,
    AttributeTrigger            :3003,
    AutoInterpolate             :3004,
    Locate                      :3005,
    Play                        :3006,
    Pause                       :3007,
    Remove                      :3008,
    ScreenCapture               :3009,
    Serialize                   :3010,
    Set                         :3011,
    Stop                        :3012,
    ConnectAttributes           :3013,
    DisconnectAttributes        :3014,
    Export                      :3015,
    Morph                       :3016,
    SnapTo                      :3017,
    Command_End                 :3999,

    DeviceHandler               :4000,
    MouseHandler                :4001,
    KeyboardHandler             :4002,
    DeviceHandler_End           :4999,
    
    UserDefined                 :5000
};

var eAttrElemType = {
    // unknown
    Unknown                     :-1,

    // attribute
    Attribute                   :0,
    
    // standard C-types
    Int                         :1,
    UnsignedInt                 :2,
    Char                        :3,
    UnsignedChar                :4,
    Float                       :5,
    Double                      :6,

    // user-defined
    UserDefined                 :100
};

function enumerateAttributeTypes()
{
    var count = 0; 
    for (var i in eAttrType)
    {
        if (eAttrType[i] == 0)
            eAttrType[i] = count++;
    }
}

function enumerateAttributeElementTypes()
{
    var count = 0;
    for (var i in eAttrElemType)
    {
        if (eAttrElemType[i] == 0)
            eAttrElemType[i] = count++;
    }
}
var eAttrSetOp = {
    Replace     :0,  
    Add		:1,
    Subtract	:2,
    Multiply	:3,
    Divide	:4,
    Append	:5,
    AND		:6,
    OR		:7,
    XOR         :8,
    NAND	:9,
    NOR		:10
};

function AttributeTargetDesc(target, 
                             sourceElementIndex, 
                             targetElementIndex,
                             op,
                             converter)
{
    if (sourceElementIndex == undefined) sourceElementIndex = -1;
    if (targetElementIndex == undefined) targetElementIndex = -1;
    
    this.target = target || null;
    this.sourceElementIndex = sourceElementIndex;
    this.targetElementIndex = targetElementIndex;
    this.op = op || eAttrSetOp.Replace;
    this.converter = converter || null;
}

function AttributeSourceDesc(source,
                             sourceElementIndex,
                             targetElementIndex,
                             op,
                             converter)
{
    if (sourceElementIndex == undefined) sourceElementIndex = -1;
    if (targetElementIndex == undefined) targetElementIndex = -1;
    
    this.source = source || null;
    this.sourceElementIndex = sourceElementIndex;
    this.targetElementIndex = targetElementIndex;
    this.op = op || eAttrSetOp.Replace;
    this.converter = converter || null;
}

function AttributeGetParams(elementIndex,
                            valueElementIndex)
{
    if (elementIndex == undefined) elementIndex = -1;
    if (valueElementIndex == undefined) valueElementIndex = -1;
    
    this.elementIndex = elementIndex;
    this.valueElementIndex = valueElementIndex;
}

function AttributeSetParams(elementIndex,
                            valueElementIndex,
                            op,
                            updateTargets,
                            alertModifiedCBs,
                            caller)
{
    if (elementIndex == undefined) elementIndex = -1;
    if (valueElementIndex == undefined) valueElementIndex = -1;
    
    this.elementIndex = elementIndex;
    this.valueElementIndex = valueElementIndex;
    this.op = op || eAttrSetOp.Replace;
    this.updateTargets = updateTargets != undefined ? updateTargets : true;
    this.alertModifiedCBs = alertModifiedCBs != undefined ? alertModifiedCBs : true;
    this.caller = caller != undefined ? caller : null;
}
                            
Attribute.prototype = new Base();
Attribute.prototype.constructor = Attribute;

function Attribute() 
{
    Base.call(this);
    this.className = "Attribute";
    this.attrType = eAttrType.Attribute;
    this.attrElemType = eAttrElemType.Attribute;
    
    this.native = true;
    this.transient = false;
    this.persistent = false;
    this.deserialized = false;
    this.modificationCount = -1;
    
    this.values = [];
    this.lastValues = [];
    this.modifiedCBs = [];
    this.modifiedCBsData = [];
    this.targets = [];
    this.sources = [];
    this.container = null;
    this.registry = null;
}

Attribute.prototype.destroy = function()
{
    // remove all targeting associated with this
    this.removeAllSources();
    this.removeAllTargets();
    
    // call base-class implementation
    Base.prototype.destroy.call(this);
}

Attribute.prototype.clone = function()
{
    return null;
}

Attribute.prototype.getValue = function(values, params)
{
    var elementIndex = (params ? params.elementIndex : -1);
    
    if (elementIndex < 0)
    {
        if (this.values == null)
        {
            values[0] = null;
        }
        else if (this.values.length == undefined)
        {
            values[0] = this.values;
        }
        else // this.values.length > 0
        {
            for (var i=0; i < this.values.length; i++)
            {
                values[i] = this.values[i];
            }
        }
    }
    else // elementIndex >= 0
    {
        var valueElementIndex = Math.max(0, params ? params.valueElementIndex : 0);
            
        values[valueElementIndex] = this.values[elementIndex];
    }
}

Attribute.prototype.getLastValue = function(values, params)
{
    var elementIndex = (params ? params.elementIndex : -1);
    
    if (elementIndex < 0)
    {
        if (this.lastValues == null)
        {
            values[0] = null;
        }
        else if (this.lastValues.length == undefined)
        {
            values[0] = this.lastValues;
        }
        else // this.values.length > 0
        {
            for (var i=0; i < this.lastValues.length; i++)
            {
                values[i] = this.lastValues[i];
            }
        }
    }
    else // elementIndex >= 0
    {
        var valueElementIndex = Math.max(0, params ? params.valueElementIndex : 0);
            
        values[valueElementIndex] = this.lastValues[elementIndex];
    }
}

Attribute.prototype.setValue = function(values, params)
{
    this.lastValues = this.values.slice();
    
    var elementIndex = (params ? params.elementIndex : -1);
    var op = (params ? params.op : eAttrSetOp.Replace);

    if (elementIndex < 0)
    {
        if (values == null)
        {
            this.values[0] = null;
        }
        else if (values.length == undefined)
        {
            switch (op)
            {
                case eAttrSetOp.Add: this.values[0] += values; break;
                case eAttrSetOp.Replace: this.values[0] = values; break;
                case eAttrSetOp.AND: this.values[0] &= values; break;
                default: alert("unsupported operation passed to Attribute::setValue"); break; // TODO: add support
            }
        }
        else // values.length > 0
        {
            this.values.length = values.length;
            for (var i = 0; i < values.length; i++)
            {
                switch (op)
                {
                    case eAttrSetOp.Add: this.values[i] += values[i]; break;
                    case eAttrSetOp.Replace: this.values[i] = values[i]; break;
                    case eAttrSetOp.AND: this.values[i] &= values[i]; break;
                    default: alert("unsupported operation passed to Attribute::setValue"); break; // TODO: add support
                }
            }
        }
    }
    else // elementIndex >= 0
    {
        if (values == null)
        {
            this.values[elementIndex] = null;
        }
        else if (values.length == undefined)
        {
            this.values[elementIndex] = values;
        }
        else // values.length > 0
        {
            var valueElementIndex = Math.max(0, params ? params.valueElementIndex : 0);
            this.values[elementIndex] = values[valueElementIndex];
        }
    }

    // alert modified CBs
    var alertModifiedCBs = (params ? params.alertModifiedCBs : true);
    if (alertModifiedCBs)
    {
        for (var i = 0; i < this.modifiedCBs.length; i++)
        {
            this.modifiedCBs[i](this, this.modifiedCBsData[i]);
        }
    }

    // update targets
    var updateTargets = (params ? params.updateTargets : true);
    if (updateTargets)
    {
        var caller = (params ? params.caller : null);
        for (var i = 0; i < this.targets.length; i++)
        {
            var targetDesc = this.targets[i];
            if (caller == targetDesc.target) continue;
            var params = new AttributeSetParams(targetDesc.targetElementIndex, targetDesc.sourceElementIndex,
                                                targetDesc.op, true, true, this);
            targetDesc.target.setValue(this.values, params);
        }
    }
    
    this.modificationCount++;
}

Attribute.prototype.revertValues = function()
{
    this.setValue(this.lastValues, null);
}

Attribute.prototype.getElement = function(index)
{
    if (this.values.length > index)
    {
        return this.values[index];
    }

    return undefined;
}

Attribute.prototype.setElement = function(index, value, op, updateTargets)
{
    console.debug("TODO: " + arguments.callee.name);
}

Attribute.prototype.getLength = function()
{
    if (this.values.length == undefined)
    {
        return (this.values == undefined ? 0 : 1);
    }   
    
    return this.values.length; 
}

Attribute.prototype.setLength = function(length)
{
    this.values.length = length;
}

Attribute.prototype.addModifiedCB = function(callback, data)
{
    // don't add dups
    var indexCB = this.modifiedCBs.indexOf(callback);
    var indexData = this.modifiedCBsData.indexOf(data);
    if (indexCB >= 0 && indexCB == indexData) 
    {
        return;
    }
        
    this.modifiedCBs.push(callback);
    this.modifiedCBsData.push(data);
}

Attribute.prototype.removeModifiedCB = function(callback, data)
{   
    var index = this.modifiedCBsData.indexOf(data);
    if (index >= 0)
    {
        this.modifiedCBs.splice(index, 1);
        this.modifiedCBsData.splice(index, 1);
    }
}

Attribute.prototype.addTarget = function(target, op, converter, setValueOnTargeting)
{
    if (op == undefined) op = eAttrSetOp.Replace;
    if (converter == undefined) converter = null;
    if (setValueOnTargeting == undefined) setValueOnTargeting = true;
    
    this.addElementTarget(target, -1, -1, op, converter, setValueOnTargeting);
}

Attribute.prototype.addSource = function(source, op, converter, setValueOnTargeting)
{
    source.addTarget(this, op, converter, setValueOnTargeting);
}

Attribute.prototype.removeTarget = function(target)
{
    this.removeElementTarget(target, -1, -1);
}

Attribute.prototype.removeSource = function(source)
{
    source.removeTarget(this);
}

Attribute.prototype.removeAllTargets = function()
{
    while (this.targets.length > 0)
    {
        this.removeElementTarget(this.targets[0].target,
                                 this.targets[0].sourceElementIndex,
                                 this.targets[0].targetElementIndex);
    }
}

Attribute.prototype.removeAllSources = function()
{
    while (this.sources.length > 0)
    {
        this.sources[0].source.removeElementTarget(this,
                                                   this.sources[0].sourceElementIndex,
                                                   this.sources[0].targetElementIndex);
    }
}

Attribute.prototype.addElementTarget = function(target, sourceElementIndex, targetElementIndex, op, converter, setValueOnTargeting)
{
    if (target)
    {
        if (sourceElementIndex == undefined) sourceElementIndex = -1;
        if (targetElementIndex == undefined) targetElementIndex = -1;
        if (op == undefined) op = eAttrSetOp.Replace;
        if (converter == undefined) converter = null;
        if (setValueOnTargeting == undefined) setValueOnTargeting = true;

        this.createTarget(new AttributeTargetDesc(target, sourceElementIndex, targetElementIndex, op, converter));

        // set this as a source of target
        target.createSource(new AttributeSourceDesc(this, sourceElementIndex, targetElementIndex, op, converter));

        if (setValueOnTargeting)
        {
            var params = new AttributeSetParams(targetElementIndex, sourceElementIndex, op, true, true);
            target.setValue(this.values, params);
        }
    }
}

Attribute.prototype.addElementSource = function(source, sourceElementIndex, targetElementIndex, op, converter, setValueOnTargeting)
{
    source.addElementTarget(this, sourceElementIndex, targetElementIndex, op, converter, setValueOnTargeting);
}

Attribute.prototype.removeElementTarget = function(target, sourceElementIndex, targetElementIndex)
{
    if (target)
    {
        this.deleteTarget(new AttributeTargetDesc(target, sourceElementIndex, targetElementIndex));

        // remove this as a source of target 
        target.deleteSource(new AttributeSourceDesc(this, sourceElementIndex, targetElementIndex));
    }
}

Attribute.prototype.removeElementSource = function(source, sourceElementIndex, targetElementIndex)
{
    source.removeElementTarget(this, sourceElementIndex, targetElementIndex);
}

Attribute.prototype.createTarget = function(targetDesc)
{
    this.targets.push(targetDesc);
}

Attribute.prototype.createSource = function(sourceDesc)
{
    this.sources.push(sourceDesc);
}

Attribute.prototype.deleteTarget = function(targetDesc)
{
    for (var i = 0; i < this.targets.length; i++)
    {
        var desc = this.targets[i];
        if (desc.target == targetDesc.target &&
            desc.sourceElementIndex == targetDesc.sourceElementIndex &&
            desc.targetElementIndex == targetDesc.targetElementIndex)
        {
            this.targets.splice(i, 1);
            break;
        }
    }
}

Attribute.prototype.deleteSource = function(sourceDesc)
{
    for (var i = 0; i < this.sources.length; i++)
    {
        var desc = this.sources[i];
        if (desc.source == sourceDesc.source &&
            desc.sourceElementIndex == sourceDesc.sourceElementIndex &&
            desc.targetElementIndex == sourceDesc.targetElementIndex)
        {
            this.sources.splice(i, 1);
            break;
        }
    }
}

Attribute.prototype.copyValue = function(source, op)
{
    source.addTarget(this, op);
    source.removeTarget(this);
}

Attribute.prototype.isContainer = function()
{
    return false;
}

Attribute.prototype.isCollection = function()
{
    return false;
}

Attribute.prototype.isNode = function()
{
    return false;
}

Attribute.prototype.getContainer = function()
{
    return this.container;
}

Attribute.prototype.setContainer = function(container)
{
    this.container = container;
}

Attribute.prototype.setNative = function(native)
{
    this.native = native;
}

Attribute.prototype.isNative = function()
{
    return this.native;    
}

Attribute.prototype.setTransient = function(transient)
{
    this.transient = transient;
}

Attribute.prototype.isTransient = function()
{
    return this.transient;    
}

Attribute.prototype.setPersistent = function(persistent)
{
    this.persistent = persistent;
}

Attribute.prototype.isPersistent = function()
{
    return this.persistent;    
}

Attribute.prototype.getRegistry = function()
{
    return this.registry;
}

Attribute.prototype.setRegistry = function(registry)
{
    this.registry = registry;
}

Attribute.prototype.onRegister = function(registry)
{
    
}

Attribute.prototype.onUnregister = function(registry)
{
    
}

Attribute.prototype.flagDeserializedFromXML = function()
{
    this.deserialized = true;

    if (this.attrContainer) // also flag container if present, otherwise serialization won't occur
    {
        this.attrContainer.flagDeserializedFromXML();
    }
}
Attribute.prototype.isDeserializedFromXML = function()
{
    return this.deserialized;
}
AttributeContainer.prototype = new Attribute();
AttributeContainer.prototype.constructor = AttributeContainer;

function AttributeContainer()
{
    Attribute.call(this);
    this.className = "AttributeContainer";
    this.attrType = eAttrType.AttributeContainer;

    this.attrNameMap = [];
    this.attrModifiedCBsEnabled = false;
}

AttributeContainer.prototype.clone = function()
{
    var factory = this.registry.find("AttributeFactory");
    var clone = factory.create(this.className);
    if (clone)
    {
        clone.synchronize(this, true);
    }
    
    return clone;
}

AttributeContainer.prototype.destroy = function()
{
    // destroy all registered attributes with this as the container
    for (var i in this.attrNameMap)
    {
        for (var j=0; j < this.attrNameMap[i].length; j++)
        {
            var attr = this.attrNameMap[i][j];
            if (attr.getContainer() == this)
            {
                attr.destroy();
            }
        }
    }

    // call base-class implementation
    Attribute.prototype.destroy.call(this);
}

AttributeContainer.prototype.isContainer = function()
{
    return true;
}

AttributeContainer.prototype.registerAttribute = function(attribute, name)
{
    if (!attribute) return;
	
    if (this.attrNameMap[name] == undefined)
    {
        this.attrNameMap[name] = new Array();
    }
    this.attrNameMap[name].push(attribute);

    // set the container if null
    if (!attribute.getContainer())
    {
        attribute.setContainer(this);
    }

    if (this.attrModifiedCBsEnabled)
    {
        attribute.addModifiedCB(AttributeContainer_AttributeModifiedCB, this);
    }
}

AttributeContainer.prototype.unregisterAttribute = function(attribute)
{
    if (!attribute) return;
	
    for (var i in this.attrNameMap)
    {
        for (var j=0; j < this.attrNameMap[i].length; j++)
        {
            if (this.attrNameMap[i][j] == attribute)
            {
                if (this.attrModifiedCBsEnabled)
                {
                    attribute.removeModifiedCB(AttributeContainer_AttributeModifiedCB, this);
                }
                delete this.attrNameMap[i][j];
                this.attrNameMap[i].splice(j, 1);
                break;
            }
        }
    }
}

AttributeContainer.prototype.getAttribute = function(name)
{
    if (this.attrNameMap[name] == undefined)
    {
        return null;
    }
    
    return this.attrNameMap[name][0];
}

AttributeContainer.prototype.getAttributeAt = function(index)
{
    var count = 0;
    for (var i in this.attrNameMap)
    {
        for (var j=0; j < this.attrNameMap[i].length; j++)
        {
            if (count == index)
            {
                return this.attrNameMap[i][j];
            }
            count++;
        }
    }
    
    return null;
}

AttributeContainer.prototype.getAttributeName = function(attribute)
{
    var count = 0;
    for (var i in this.attrNameMap)
    {
        for (var j=0; j < this.attrNameMap[i].length; j++)
        {
            if (this.attrNameMap[i][j] == attribute)
            {
                return i;
            }
            count++;
        }
    }

    return null;
}

AttributeContainer.prototype.getAttributeNameAt = function(index)
{
    var count = 0;
    for (var i in this.attrNameMap)
    {
        for (var j=0; j < this.attrNameMap[i].length; j++)
        {
            if (count == index)
            {
                return i;
            }
            count++;
        }
    }
    
    return null;
}

AttributeContainer.prototype.getAttributeCount = function()
{
    var count = 0;
    for (var i in this.attrNameMap) count += this.attrNameMap[i].length;
    return count;
}

AttributeContainer.prototype.addTarget = function(target, op, converter, setValueOnTargeting)
{
    if (target)
    {
        if (op == undefined) op = null;
        if (converter == undefined) converter = null;
        if (setValueOnTargeting == undefined) setValueOnTargeting = true;
        
        var numAttributesToConnect = Math.max(this.getAttributeCount(), target.getAttributeCount());
        if (numAttributesToConnect == 0)
        {
            return;
        }

        var sourceAttr = null;
        var targetAttr = null;
        for (var i = 0; i < numAttributesToConnect; i++)
        {
            sourceAttr = this.getAttributeAt(i);
            targetAttr = target.getAttribute(this.getAttributeNameAt(i));
            if (!sourceAttr || !targetAttr)
            {
                continue;
            }

            sourceAttr.addTarget(targetAttr, op, converter, setValueOnTargeting);
        }
    }
}

AttributeContainer.prototype.removeTarget = function(target)
{
    if (target)
    {
        var numAttributesToConnect = Math.max(this.getAttributeCount(), target.getAttributeCount());
        if (numAttributesToConnect == 0)
        {
            return;
        }

        var sourceAttr = null;
        var targetAttr = null;
        for (var i = 0; i < numAttributesToConnect; i++)
        {
            sourceAttr = this.getAttributeAt(i);
            targetAttr = target.getAttribute(this.getAttributeNameAt(i));
            if (!sourceAttr || !targetAttr)
            {
                continue;
            }

            sourceAttr.removeTarget(targetAttr);
        }
    }
}

AttributeContainer.prototype.synchronize = function(src, syncValues)
{
    if (syncValues == undefined) syncValues = true;

    for (var i in src.attrNameMap)
    {
        for (var j=0; j < src.attrNameMap[i].length; j++)
        {
            if (!this.attrNameMap[i] || this.attrNameMap[i].length <= j) continue;
            var attr = this.attrNameMap[i][j];
            if (!attr)
            {
                attr = src.attrNameMap[i].clone();
                if (!attr) continue;
                attr.setContainer(this);
                this.registerAttribute(attr, i);
            }
    
            if (attr && syncValues)
            {
                attr.copyValue(src.attrNameMap[i][j]);
            }
        }
    }
}

AttributeContainer.prototype.addModifiedCB = function(callback, data)
{
    if (!this.attrModifiedCBsEnabled)
    {
        this.attrModifiedCBsEnabled = true;
        
        for (var i in this.attrNameMap)
        {
            for (var j=0; j < this.attrNameMap[i].length; j++)
            {
                this.attrNameMap[i][j].addModifiedCB(AttributeContainer_AttributeModifiedCB, this);
            }
        }
    }
    
    // call base-class implementation
    Attribute.prototype.addModifiedCB.call(this, callback, data);
}
    
function AttributeContainer_AttributeModifiedCB(attribute, container)
{
    for (var i=0; i < container.modifiedCBs.length; i++)
    {
        container.modifiedCBs[i](container, container.modifiedCBsData[i]);
    }
}

AttributeRegistry.prototype = new AttributeContainer();
AttributeRegistry.prototype.constructor = AttributeRegistry;

function AttributeRegistry()
{
    AttributeContainer.call(this);
    this.className = "AttributeRegistry";
    this.attrType = eAttrType.AttributeRegistry;

    this.objectCount = 0;

    this.typeRegistry = [];
    this.nameRegistry = [];

    this.uniqueAttributes = [];
}

AttributeRegistry.prototype.addUnique = function(attribute)
{
    for (var i = 0; i < this.uniqueAttributes.length; i++)
    {
        if (this.uniqueAttributes[i] == attribute)
            return;
    }

    this.uniqueAttributes.push(attribute);
}

AttributeRegistry.prototype.removeUnique = function(attribute)
{
    for (var i = 0; i < this.uniqueAttributes.length; i++)
    {
        if (this.uniqueAttributes[i] == attribute)
        {
            this.uniqueAttributes.splice(i, 1);
            return;
        }
    }
}

AttributeRegistry.prototype.registerByType = function(attribute, type)
{
    if (this.typeRegistry[type] == undefined)
    {
        this.typeRegistry[type] = new Array();
    }

    this.typeRegistry[type].push(attribute);
}

AttributeRegistry.prototype.registerByName = function(attribute, name)
{
    if (name.length == 0)
    {
        name = "unnamed";
    }

    if (this.nameRegistry[name] == undefined)
    {
        this.nameRegistry[name] = new Array();
    }

    this.nameRegistry[name].push(attribute);
}

AttributeRegistry.prototype.register = function(attribute)
{
    // register using type
    this.registerByType(attribute, attribute.attrType);

    // register using name attribute if container
    if (attribute.isContainer())
    {
        var name = attribute.getAttribute("name") || attribute.getAttribute("id");
        if (name)
        {
            this.registerByName(attribute, name.getValueDirect().join(""));
            name.addModifiedCB(AttributeRegistry_AttributeContainerNameModifiedCB, this);
        }
    }

    this.addUnique(attribute);
    this.objectCount++;

    attribute.onRegister(this);
}

AttributeRegistry.prototype.unregisterByType = function(attribute, type)
{
    if (this.typeRegistry[type])
    {
        this.typeRegistry[type].splice(this.typeRegistry[type].indexOf(attribute), 1);
    }
}

AttributeRegistry.prototype.unregisterByName = function(attribute, name)
{
    if (name.length == 0)
    {
        name = "unnamed";
    }

    if (this.nameRegistry[name])
    {
        this.nameRegistry[name].splice(this.nameRegistry[name].indexOf(attribute), 1);
    }
}

AttributeRegistry.prototype.unregister = function(attribute)
{
    // register using type
    this.unregisterByType(attribute, attribute.attrType);

    // register using name attribute if container
    if (attribute.isContainer())
    {
        var name = attribute.getAttribute("name") ||
                attribute.getAttribute("id");
        if (name)
        {
            this.unregisterByName(attribute, name.getValueDirect().join(""));
            name.removeModifiedCB(AttributeRegistry_AttributeContainerNameModifiedCB, this);
        }
    }

    this.removeUnique(attribute);
    this.objectCount--;

    attribute.onUnregister(this);
}

AttributeRegistry.prototype.getByType = function(type)
{
    switch (type)
    {
        case eAttrType.Camera:
            {
                var result = [];
                var perspectives = this.getByType(eAttrType.PerspectiveCamera);
                if (perspectives)
                {
                    for (var j = 0; j < perspectives.length; j++)
                    {
                        result.push(perspectives[j]);
                    }
                }
                var orthographics = this.getByType(eAttrType.OrthographicCamera);
                if (orthographics)
                {
                    for (var j = 0; j < orthographics.length; j++)
                    {
                        result.push(orthographics[j]);
                    }
                }
                return result;
            }
            break;

        case eAttrType.Evaluator:
            {
                var result = [];
                for (var i = eAttrType.Evaluator + 1; i != eAttrType.Evaluator_End; i++)
                {
                    var evaluators = this.getByType(i);
                    if (evaluators)
                    {
                        for (var j = 0; j < evaluators.length; j++)
                        {
                            result.push(evaluators[j]);
                        }
                    }
                }
                return result;
            }
            break;

        default:
            {
                return this.typeRegistry[type];
            }
            break;
    }
}

AttributeRegistry.prototype.getByName = function(name)
{
    return this.nameRegistry[name];
}

AttributeRegistry.prototype.updateName = function(container, name)
{
    for (var i in this.nameRegistry)
    {
        for (var j = 0; j < this.nameRegistry[i].length; j++)
        {
            if (this.nameRegistry[i][j] == container)
            {
                this.nameRegistry[i].splice(j, 1);
                this.registerByName(container, name);
                return;
            }
        }
    }
}

AttributeRegistry.prototype.clear = function()
{
    for (var i in this.typeRegistry)
    {
        this.typeRegistry[i] = [];
    }
    this.typeRegistry = [];

    for (var i in this.nameRegistry)
    {
        this.nameRegistry[i] = [];
    }
    this.nameRegistry = [];

    this.uniqueAttributes = [];

    this.objectCount = 0;
}

AttributeRegistry.prototype.getObjectCount = function()
{
    return this.uniqueAttributes.length;
}

AttributeRegistry.prototype.getObject = function(num)
{
    if (num < this.uniqueAttributes.length)
    {
        return this.uniqueAttributes[num];
    }

    return null;
}

function AttributeRegistry_AttributeContainerNameModifiedCB(attribute, container)
{
    container.updateName(attribute.getContainer(), attribute.getValueDirect().join(""));
}
BooleanAttr.prototype = new Attribute();
BooleanAttr.prototype.constructor = BooleanAttr;

function BooleanAttr(value)
{
    Attribute.call(this);
    this.className = "BooleanAttr";
    this.attrType = eAttrType.BooleanAttr;
    this.setValue(value || false);
}

BooleanAttr.prototype.clone = function()
{
    var attr = new BooleanAttr();
    attr.setValue(this.values);
    return attr;
}

BooleanAttr.prototype.getValueDirect = function()
{
    //var values = [];
    //this.getValue(values);
    return this.values[0];
}

BooleanAttr.prototype.getLastValueDirect = function()
{
    var lastValues = [];
    this.getLastValue(lastValues);
    return lastValues;
}

BooleanAttr.prototype.setValueDirect = function(value, params)
{
    var values = [value];
    this.setValue(value, params);
}

ColorAttr.prototype = new Attribute();
ColorAttr.prototype.constructor = ColorAttr;

function ColorAttr(r, g, b, a)
{
    Attribute.call(this);
    this.className = "ColorAttr";
    this.attrType = eAttrType.ColorAttr;
    var values = [ r || 0, g || 0, b || 0, a || 0 ];
    this.setValue(values);
}

ColorAttr.prototype.clone = function()
{
    var attr = new ColorAttr();
    attr.setValue(this.values);
    return attr;
}

ColorAttr.prototype.getValueDirect = function()
{
    //var values = [];
    //this.getValue(values);
    return { r: this.values[0], g: this.values[1], b: this.values[2], a: this.values[3] };
}

ColorAttr.prototype.setValueDirect = function(r, g, b, a, params)
{
    var values = [ r, g, b, a ];
    this.setValue(values, params);
}

Matrix4x4Attr.prototype = new Attribute();
Matrix4x4Attr.prototype.constructor = Matrix4x4Attr;

function Matrix4x4Attr(_11, _12, _13, _14,
                       _21, _22, _23, _24,
                       _31, _32, _33, _34,
                       _41, _42, _43, _44)
{
    Attribute.call(this);
    this.className = "Matrix4x4Attr";
    this.attrType = eAttrType.Matrix4x4Attr;
    var values = [ _11 || 1, _12 || 0, _13 || 0, _14 || 0,
                   _21 || 0, _22 || 1, _23 || 0, _24 || 0,
                   _31 || 0, _32 || 0, _33 || 1, _34 || 0,
                   _41 || 0, _42 || 0, _43 || 0, _44 || 1 ];
    this.setValue(values);
}

Matrix4x4Attr.prototype.clone = function()
{
    var attr = new Matrix4x4Attr();
    attr.setValue(this.values);
    return attr;
}

Matrix4x4Attr.prototype.getValueDirect = function()
{
    //var values = [];
    //this.getValue(values);
    var result = new Matrix4x4();
    result.loadArray(this.values);
    return result;
}

Matrix4x4Attr.prototype.setValueDirect = function(matrix, params)
{
    var values = [ matrix._11, matrix._12, matrix._13, matrix._14,
                   matrix._21, matrix._22, matrix._23, matrix._24,
                   matrix._31, matrix._32, matrix._33, matrix._34,
                   matrix._41, matrix._42, matrix._43, matrix._44 ];
    this.setValue(values, params);
}

NumberArrayAttr.prototype = new Attribute();
NumberArrayAttr.prototype.constructor = NumberArrayAttr;

function NumberArrayAttr()
{
    Attribute.call(this);
    this.className = "NumberArrayAttr";
    this.attrType = eAttrType.NumberArrayAttr;
}

NumberArrayAttr.prototype.clone = function()
{
    var attr = new NumberArrayAttr();
    attr.setValue(this.values);
    return attr;
}

NumberArrayAttr.prototype.getValueDirect = function()
{
    //var values = [];
    //this.getValue(values);
    return this.values;
}

NumberArrayAttr.prototype.setValueDirect = function(values, params)
{
    this.setValue(values, params);
}

NumberAttr.prototype = new Attribute();
NumberAttr.prototype.constructor = NumberAttr;

function NumberAttr(value)
{
    Attribute.call(this);
    this.className = "NumberAttr";
    this.attrType = eAttrType.NumberAttr;
    this.setValue(value || 0);
}

NumberAttr.prototype.clone = function()
{
    var attr = new NumberAttr();
    attr.setValue(this.values);
    return attr;
}

NumberAttr.prototype.getValueDirect = function()
{
    //var values = [];
    //this.getValue(values);
    return this.values[0];
}

NumberAttr.prototype.setValueDirect = function(value, params)
{
    var values = [value];
    this.setValue(values, params);
}

PulseAttr.prototype = new BooleanAttr();
PulseAttr.prototype.constructor = PulseAttr;

function PulseAttr()
{
    BooleanAttr.call(this);
    this.className = "PulseAttr";
    this.attrType = eAttrType.PulseAttr;
    
    this.setTransient(true); // don't serialize because by definition this attribute doesn't hold "true" (it pulses)
}

PulseAttr.prototype.clone = function()
{
    var attr = new PulseAttr();
    attr.setValue(this.values);
    return attr;
}

PulseAttr.prototype.pulse = function()
{
    this.setValueDirect(true);
    this.setValueDirect(false);
}

QuaternionAttr.prototype = new Attribute();
QuaternionAttr.prototype.constructor = QuaternionAttr;

function QuaternionAttr(w, x, y, z)
{
    Attribute.call(this);
    this.className = "QuaternionAttr";
    this.attrType = eAttrType.QuaternionAttr;
    var values = [ w || 1, x || 0, y || 0, z || 0 ];
    this.setValue(values);
}

QuaternionAttr.prototype.clone = function()
{
    var attr = new QuaternionAttr();
    attr.setValue(this.values);
    return attr;
}

QuaternionAttr.prototype.getValueDirect = function()
{
    //var values = [];
    //this.getValue(values);
    var result = new Quaternion();
    result.loadArray(this.values);
    return result;
}

QuaternionAttr.prototype.setValueDirect = function(quaternion, params)
{
    var values = [ quaternion.w, quaternion.x, quaternion.y, quaternion.z ];
    this.setValue(values, params);
}

ReferenceAttr.prototype = new Attribute();
ReferenceAttr.prototype.constructor = ReferenceAttr;

function ReferenceAttr(value)
{
    Attribute.call(this);
    this.className = "ReferenceAttr";
    this.attrType = eAttrType.ReferenceAttr;
    this.setValue(value || null);
}

ReferenceAttr.prototype.clone = function()
{
    var attr = new ReferenceAttr();
    attr.setValue(this.values);
    return attr;
}

ReferenceAttr.prototype.getValueDirect = function()
{
    //var values = [];
    //this.getValue(values);
    return this.values[0];
}

ReferenceAttr.prototype.setValueDirect = function(value, params)
{
    var values = [value];
    this.setValue(value, params);
}

StringAttr.prototype = new Attribute();
StringAttr.prototype.constructor = StringAttr;

function StringAttr(value)
{
    Attribute.call(this);
    this.className = "StringAttr";
    this.attrType = eAttrType.StringAttr;
    this.setValue(value || "");
}

StringAttr.prototype.clone = function()
{
    var attr = new StringAttr();
    attr.setValue(this.values);
    return attr;
}

StringAttr.prototype.getValueDirect = function()
{
    //var values = [];
    //this.getValue(values);
    return this.values;
}

StringAttr.prototype.getLastValueDirect = function()
{
    var lastValues = [];
    this.getLastValue(lastValues);
    return lastValues;
}

StringAttr.prototype.setValueDirect = function(value, params)
{
    this.setValue(value, params);
}

StringAttr.prototype.setValue = function(values, params)
{
    this.values = [];
    
    // call base-class implementation
    Attribute.prototype.setValue.call(this, values, params);
}

StringAttrAllocator.prototype = new Allocator();
StringAttrAllocator.prototype.constructor = StringAttrAllocator;

function StringAttrAllocator()
{
}

StringAttrAllocator.prototype.allocate = function()
{
    return new StringAttr();
}

TernaryAttr.prototype = new NumberAttr();
TernaryAttr.prototype.constructor = TernaryAttr;

function TernaryAttr(value)
{
    NumberAttr.call(this, value);
    this.className = "TernaryAttr";
    this.attrType = eAttrType.TernaryAttr;
    
    // TODO: this.setRange(-1, 1);
}

TernaryAttr.prototype.clone = function()
{
    var attr = new TernaryAttr();
    attr.setValue(this.values);
    return attr;
}

Vector2DAttr.prototype = new Attribute();
Vector2DAttr.prototype.constructor = Vector2DAttr;

function Vector2DAttr(x, y)
{
    Attribute.call(this);
    this.className = "Vector2DAttr";
    this.attrType = eAttrType.Vector2DAttr;
    var values = [ x || 0, y || 0 ];
    this.setValue(values);
}

Vector2DAttr.prototype.clone = function()
{
    var attr = new Vector2DAttr();
    attr.setValue(this.values);
    return attr;
}

Vector2DAttr.prototype.getValueDirect = function()
{
    //var values = [];
    //this.getValue(values);
    return { x: this.values[0], y: this.values[1] };
}

Vector2DAttr.prototype.setValueDirect = function(x, y, params)
{
    var values = [ x, y ];
    this.setValue(values, params);
}

Vector3DAttr.prototype = new Attribute();
Vector3DAttr.prototype.constructor = Vector3DAttr;

function Vector3DAttr(x, y, z)
{
    Attribute.call(this);
    this.className = "Vector3DAttr";
    this.attrType = eAttrType.Vector3DAttr;
    var values = [ x || 0, y || 0, z || 0 ];
    this.setValue(values);
}

Vector3DAttr.prototype.clone = function()
{
    var attr = new Vector3DAttr();
    attr.setValue(this.values);
    return attr;
}

Vector3DAttr.prototype.getVector3D = function()
{
    return new Vector3D(this.values[0], this.values[1], this.values[2]);
}
    
Vector3DAttr.prototype.getValueDirect = function()
{
    //var values = [];
    //this.getValue(values);
    return { x: this.values[0], y: this.values[1], z: this.values[2] };
}

Vector3DAttr.prototype.setValueDirect = function(x, y, z, params)
{
    var values = [ x, y, z ];
    this.setValue(values, params);
}

Vector3DAttr.prototype.isZero = function()
{
	var values = [];
    this.getValue(values);
    return (values[0] == 0 && values[1] == 0 && values[2] == 0) ? true : false;
}

ViewportAttr.prototype = new Attribute();
ViewportAttr.prototype.constructor = ViewportAttr;

function ViewportAttr(x, y, width, height)
{
    Attribute.call(this);
    this.className = "ViewportAttr";
    this.attrType = eAttrType.ViewportAttr;
    var values = [ x || 0, y || 0, width || 0, height || 0 ];
    this.setValue(values);
}

ViewportAttr.prototype.clone = function()
{
    var attr = new ViewportAttr();
    attr.setValue(this.values);
    return attr;
}

ViewportAttr.prototype.getValueDirect = function()
{
    //var values = [];
    //this.getValue(values);
    return { x: this.values[0], y: this.values[1], width: this.values[2], height: this.values[3] };
}

ViewportAttr.prototype.setValueDirect = function(x, y, width, height, params)
{
    var values = [ x, y, width, height ];
    this.setValue(values, params);
}

AttributeVector.prototype = new AttributeContainer();
AttributeVector.prototype.constructor = AttributeVector;

function AttributeVector(allocator) // TODO: not sure if allocator is needed
{
    AttributeContainer.call(this);
    this.className = "AttributeVector";
    this.attrType = eAttrType.AttributeVector;
    
    this.vector = [];
    
    this.allocator = allocator;
    
    this.size = new NumberAttr(0);
    this.baseName = new StringAttr("item");
    this.appendParsedElements = new BooleanAttr(false);
    this.elementModified = new PulseAttr();
    
    this.size.addModifiedCB(AttributeVector_SizeModifiedCB, this);
    this.baseName.addModifiedCB(AttributeVector_BaseNameModifiedCB, this);
    
    this.registerAttribute(this.size, "size");
    this.registerAttribute(this.baseName, "baseName");
    this.registerAttribute(this.appendParsedElements, "appendParsedElements");
    this.registerAttribute(this.elementModified, "elementModified");
}

AttributeVector.prototype.allocatesElements = function() // TODO: necessary (?)
{
    return (this.allocator ? true : false);
}

AttributeVector.prototype.push_back = function(item)
{
    this.addElement(this.vector.length, item);
}

AttributeVector.prototype.erase = function(item)
{
    for (var i=0; i < this.vector.length; i++)
    {
        if (this.vector[i] == item)
        { 
            this.removeElement(i);
            return;
        }
    }
}

AttributeVector.prototype.resize = function(size)
{
    this.size.setValueDirect(size);
}

AttributeVector.prototype.clear = function()
{
    this.resize(0);
}

AttributeVector.prototype.indexOf = function(item)
{
    for (var i = 0; i < this.vector.length; i++)
    {
        if (this.vector[i] == item)
        {
            return i;
        }
    }
    
    return -1;
}

AttributeVector.prototype.getAt = function(index)
{
    if (this.vector.length > index)
    {
        return this.vector[index];
    }
    
    return null;
}

AttributeVector.prototype.setAt = function(index, item)
{
    if (this.vector.length > index)
    {
        this.vector[index] = item;
    }
}

AttributeVector.prototype.prev = function(element)
{
    for (var i = 0; i < this.vector.length; i++)
    {
        if (this.vector[i] == element)
        {
            if (i > 0) return this.vector[i-1];
            break;
        }        
    }
    
    return null;
}

AttributeVector.prototype.next = function(element)
{
    for (var i = 0; i < this.vector.length; i++)
    {
        if (this.vector[i] == element)
        {
            if (i < (this.vector.length - 1)) return this.vector[i+1];
            break;
        }        
    }
    
    return null;
}

AttributeVector.prototype.addElement = function(index, element)
{
    this.vector.splice(index, 0, element);
    this.size.setValueDirect(this.vector.length);
}

AttributeVector.prototype.removeElement = function(index)
{
    this.vector.splice(index, 1);
    this.size.setValueDirect(this.vector.length);
}

AttributeVector.prototype.Size = function()
{
    return this.size.getValueDirect();
}

AttributeVector.prototype.AppendParsedElements = function()
{
    return this.appendParsedElements.getValueDirect();
}

AttributeVector.prototype.setElementName = function(element, name)
{
    this.unregisterAttribute(element); // don't allow registration under multiple names
    this.registerAttribute(element, name);
    
    // TODO: add to element name map
    console.debug("TODO: add to element name map");
}

AttributeVector.prototype.synchronize = function(src, syncValues)
{
    var length = this.Size();
    var srcLength = src.Size();
    
    while (srcLength > length)
    {
        this.push_back(src.getAt(length));
        length++;
    }
    
    while (srcLength < length)
    {
        this.removeElement(length-1);
        length--;
    }
    
    if (syncValues)
    {
        for (var i = 0; i < length; i++)
        {
            if (src.getAt(i).getValueDirect() != this.getAt(i).getValueDirect())
            {
                this.getAt(i).copyValue(src.getAt(i));
            }
        }
    }
}

AttributeVector.prototype.isCollection = function()
{
    return true;
}

AttributeVector.prototype.sizeModified = function()
{
    var lastSize = this.vector.length;
    var nextSize = this.size.getValueDirect();
    var start, end;

    if (nextSize > lastSize)
    {
        start = lastSize;
        end = start + (nextSize - lastSize);

        for (var i = start; i < end; i++)
        {
            this.addElement(i, this.allocator ? this.allocator.allocate() : null);
        }
    }
    else if (nextSize < lastSize)
    {
        start = lastSize;
        end = start - (lastSize - nextSize);

        for (var i = start - 1; i >= end; i--)
        {
            this.removeElement(i);
        }
    }
}

function AttributeVector_SizeModifiedCB(attribute, container)
{
    container.sizeModified();
}

function AttributeVector_BaseNameModifiedCB(attribute, container)
{
}

StyleAttr.prototype = new AttributeContainer();
StyleAttr.prototype.constructor = StyleAttr;

function StyleAttr()
{
    AttributeContainer.call(this);
    this.className = "StyleAttr";
    this.attrType = eAttrType.StyleAttr;

    this.setOp = new NumberAttr(eAttrSetOp.Replace);
    this.styleUrl = new StringAttr();

    this.styleUrl.addModifiedCB(StyleAttr_StyleUrlModifiedCB, this);
    
    this.registerAttribute(this.setOp, "setOp");
    this.registerAttribute(this.styleUrl, "styleUrl");
}

StyleAttr.prototype.updateStyle = function(style)
{
    // implemented by derived classes
}

StyleAttr.prototype.styleUrlModified = function()
{
    var styleUrl = this.styleUrl.getValueDirect().join("");
    if (this.registry)
    {
        this.updateStyle(this.registry.find(styleUrl));
    }
}

function StyleAttr_StyleUrlModifiedCB(attribute, container)
{
    container.styleUrlModified();
}

StylesAttr.prototype = new AttributeVector();
StylesAttr.prototype.constructor = StylesAttr;

function StylesAttr()
{
    AttributeVector.call(this);
    this.className = "StylesAttr";
    this.attrType = eAttrType.StylesAttr;

    this.registeredCBs = [];
    this.registeredCBsData = [];
    
    this.enabled = new BooleanAttr(true);

    this.registerAttribute(this.enabled, "enabled");
}

StylesAttr.prototype.updateStyle = function(style)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        return;
    }

    for (var i = 0; i < style.Size(); i++)
    {
        for (var j = 0; j < this.Size(); j++)
        {
            if (this.vector[j].attrType == style.vector[i].attrType)
            {
                this.vector[j].updateStyle(style.vector[i]);
                break;
            }
        }
    }
}

StylesAttr.prototype.registerStyle = function(style, name)
{
    this.push_back(style);
    this.setElementName(style, name);
    this.alertRegisteredCBs(style, true);
}

StylesAttr.prototype.unregisterStyle = function(style)
{
    for (var i in this.vector)
    {
        if (this.vector[i] == style)
        {
            this.alertRegisteredCBs(style, false);
            delete this.vector[i];
            break;
        }
    }
}

StylesAttr.prototype.addRegisteredCB = function(callback, data)
{
    this.registeredCBs.push(callback);
    this.registeredCBsData.push(data);
}

StylesAttr.prototype.alertRegisteredCBs = function(style, registered)
{
    for (var i = 0; i < this.registeredCBs.length; i++)
    {
        this.registeredCBs[i](style, this.registeredCBs[i]);
    }
}

StylesAttr.prototype.push_back = function(item)
{
    // call base-class implementation
    AttributeVector.prototype.push_back.call(this, item);

    this.alertRegisteredCBs(item, true);
}

StylesAttr.prototype.getStyle = function(type)
{
    for (var i = 0; i < this.Size(); i++)
    {
        if (this.vector[i].attrType == type)
        {
            return this.vector[i];
        }
    }

    return undefined;
}

StyleMapAttr.prototype = new AttributeContainer();
StyleMapAttr.prototype.constructor = StyleMapAttr;

function StyleMapAttr()
{
    AttributeContainer.call(this);
    this.className = "StyleMapAttr";
    this.attrType = eAttrType.StyleMapAttr;

    this.eventType = eEventType.Unknown;
    this.targetContainer = null;
    
    this.event = new StringAttr();
    this.styles = new StylesAttr();
    this.styleUrl = new StringAttr();
    this.target = new StringAttr();

    this.event.addModifiedCB(StyleMapAttr_EventModifiedCB, this);
    this.styleUrl.addModifiedCB(StyleMapAttr_styleUrlModifiedCB, this);
    this.target.addModifiedCB(StyleMapAttr_TargetModifiedCB, this);

    this.registerAttribute(this.event, "event");
    this.registerAttribute(this.styleUrl, "styleUrl");
    this.registerAttribute(this.target, "target");
}

StyleMapAttr.prototype.getStyles = function(eventType)
{
    var styles = null;
    var target = null;

    if (this.eventType == eventType)
    {
        styles = this.styles;
        target = this.targetContainer;
    }

    return { styles: styles, target: target };
}

StyleMapAttr.prototype.setStyles = function(styles)
{
    this.styles = styles;
}

StyleMapAttr.prototype.setTargetContainer = function(targetContainer)
{
    this.targetContainer = targetContainer;
}

StyleMapAttr.prototype.eventModified = function()
{
    var eventName = this.event.getValueDirect().join("");

    this.eventType = eEventNameMap[eventName];
}

StyleMapAttr.prototype.styleUrlModified = function()
{
    var styleUrl = this.styleUrl.getValueDirect();
    if (styleUrl[0] == '#')
    {
        styleUrl.splice(0, 1);
    }
    styleUrl = styleUrl.join("");

    var styles = this.registry.find(styleUrl);
    if (styles)
    {
        this.styles = styles;
    }
}

StyleMapAttr.prototype.targetModified = function()
{
    var target = this.target.getValueDirect().join("");

    this.targetContainer = this.registry.find(target);
}

function StyleMapAttr_EventModifiedCB(attribute, container)
{
    container.eventModified();
}

function StyleMapAttr_styleUrlModifiedCB(attribute, container)
{
    container.styleUrlModified();
}

function StyleMapAttr_TargetModifiedCB(attribute, container)
{
    container.targetModified();
}

StyleMapAttrAllocator.prototype = new Allocator();
StyleMapAttrAllocator.prototype.constructor = StyleMapAttrAllocator;

function StyleMapAttrAllocator()
{
}

StyleMapAttrAllocator.prototype.allocate = function()
{
    return new StyleMapAttr();
}

StylesMapAttr.prototype = new AttributeVector();
StylesMapAttr.prototype.constructor = StylesMapAttr;

function StylesMapAttr()
{
    AttributeVector.call(this, new StyleMapAttrAllocator());
    this.className = "StylesMapAttr";
    this.attrType = eAttrType.StylesMapAttr;

    this.stylesEnabledMap = [];

    this.size.addModifiedCB(StylesMapAttr_SizeModifiedCB, this);

    this.appendParsedElements.setValueDirect(true);
}

StylesMapAttr.prototype.getStyles = function(eventType)
{
    var styles = null;
    var enabled = false;
    var target = null;

    for (var i = 0; i < this.Size(); i++)
    {
        var result = this.vector[i].getStyles(eventType);
        if (result.styles)
        {
            styles = result.styles;
            target = result.target;
            if (this.stylesEnabledMap[result.styles])
            {
                enabled = this.stylesEnabledMap[result.styles];
            }
        }
    }

    return { styles: styles, target: target, enabled: enabled };
}

StylesMapAttr.prototype.StylesMapAttr_SizeModified = function()
{
    for (var i = 0; i < this.Size(); i++)
    {
        if (!(this.vector[i].registry))
        {
            this.vector[i].setRegistry(this.registry);
        }

        if (!(this.stylesEnabledMap[this.vector[i].styles]))
        {
            this.stylesEnabledMap[this.vector[i].styles] = new BooleanAttr(true);
        }
    }
}

function StylesMapAttr_SizeModifiedCB(attribute, container)
{
    container.StylesMapAttr_SizeModified();
}
KeyframeAttr.prototype = new AttributeContainer();
KeyframeAttr.prototype.constructor = KeyframeAttr;

function KeyframeAttr()
{
    AttributeContainer.call(this);
    this.className = "KeyframeAttr";
    this.attrType = eAttrType.KeyframeAttr;

    this.time = new NumberAttr();
    this.value = new NumberAttr();
    this.shape = new NumberAttr();
    this.params = new AttributeVector();

    for (var i = 0; i < 6; i++)
    {
        this.params.push_back(new NumberAttr(0));
    }

    this.registerAttribute(this.time, "time");
    this.registerAttribute(this.value, "value");
    this.registerAttribute(this.shape, "shape");
    this.registerAttribute(this.params, "params");

    this.getTime = function () {
        return this.time.getValueDirect();
    }
    this.getValue = function () {
        return this.value.getValueDirect();
    }
    this.getShape = function () {
        return this.shape.getValueDirect();
    }
    this.getParams = function (i) {
        return this.params.getAt(i).getValueDirect();
    }
}

KeyframesAttr.prototype = new AttributeVector();
KeyframesAttr.prototype.constructor = KeyframesAttr;

function KeyframesAttr()
{
    AttributeVector.call(this);
    this.className = "KeyframesAttr";
    this.attrType = eAttrType.KeyframesAttr;
}

BBoxAttr.prototype = new AttributeContainer();
BBoxAttr.prototype.constructor = BBoxAttr;

function BBoxAttr()
{
    AttributeContainer.call(this);
    this.className = "BBoxAttr";
    this.attrType = eAttrType.BBoxAttr;

    this.min = new Vector3DAttr();
    this.max = new Vector3DAttr();

    this.registerAttribute(this.min, "min");
    this.registerAttribute(this.max, "max");
}

BBoxAttr.prototype.setValueDirect = function (min, max)
{
    this.min.setValueDirect(min.x, min.y, min.z);
    this.max.setValueDirect(max.x, max.y, max.z);
}

ImageAttr.prototype = new AttributeContainer();
ImageAttr.prototype.constructor = ImageAttr;

function ImageAttr()
{
    AttributeContainer.call(this);
    this.className = "ImageAttr";
    this.attrType = eAttrType.ImageAttr;

    this.width = new NumberAttr(0);
    this.height = new NumberAttr(0);
    this.byteAlignment = new NumberAttr(0);
    this.pixelFormat = new NumberAttr(ePixelFormat.Unknown);
    this.pixels = new NumberArrayAttr();

    this.registerAttribute(this.width, "width");
    this.registerAttribute(this.height, "height");
    this.registerAttribute(this.byteAlignment, "byteAlignment");
    this.registerAttribute(this.pixelFormat, "pixelFormat");
    this.registerAttribute(this.pixels, "pixels");
}

RectAttr.prototype = new AttributeContainer();
RectAttr.prototype.constructor = RectAttr;

function RectAttr()
{
    AttributeContainer.call(this);
    this.className = "RectAttr";
    this.attrType = eAttrType.RectAttr;

    this.left = new NumberAttr(0);
    this.top = new NumberAttr(0);
    this.right = new NumberAttr(0);
    this.bottom = new NumberAttr(0);

    this.registerAttribute(this.left, "left");
    this.registerAttribute(this.top, "top");
    this.registerAttribute(this.right, "right");
    this.registerAttribute(this.bottom, "bottom");
}

RectAttr.prototype.getValueDirect = function ()
{
    var rect = new Rect();
    rect.left = this.left.getValueDirect();
    rect.top = this.top.getValueDirect();
    rect.right = this.right.getValueDirect();
    rect.bottom = this.bottom.getValueDirect();
    return rect;
}

RectAttr.prototype.setValueDirect = function (rect)
{
    this.left.setValueDirect(rect.left);
    this.top.setValueDirect(rect.top);
    this.right.setValueDirect(rect.right);
    this.bottom.setValueDirect(rect.bottom);
}

RectAttr.prototype.containsPoint = function (x, y)
{
    if (x >= this.left.getValueDirect() &&
            y >= this.top.getValueDirect() &&
            x <= this.right.getValueDirect() &&
            y <= this.bottom.getValueDirect())
        return true;

    return false;
}

FontStyleAttr.prototype = new StyleAttr();
FontStyleAttr.prototype.constructor = FontStyleAttr;

function FontStyleAttr()
{
    StyleAttr.call(this);
    this.className = "FontStyleAttr";
    this.attrType = eAttrType.FontStyleAttr;

    this.antialiasType = new NumberAttr(eImageAntialiasOp.EightPass);
    this.borderColor = new ColorAttr(0, 0, 0, 1);
    this.borderWidth = new NumberAttr(2);
    this.color = new ColorAttr(1, 1, 1, 1);
    this.effects = new StringAttr();
    this.font = new StringAttr("Arial");
    this.opacity = new NumberAttr(1);
    this.size = new NumberAttr(18);
    this.style = new StringAttr("Bold");

    this.registerAttribute(this.antialiasType, "antialiasType");
    this.registerAttribute(this.borderColor, "borderColor");
    this.registerAttribute(this.borderWidth, "borderWidth");
    this.registerAttribute(this.color, "color");
    this.registerAttribute(this.effects, "effects");
    this.registerAttribute(this.font, "font");
    this.registerAttribute(this.opacity, "opacity");
    this.registerAttribute(this.size, "size");
    this.registerAttribute(this.style, "style");
}

FontStyleAttr.prototype.updateStyle = function (style)
{
    var setOp = style.setOp.getValueDirect();

    // antialiasType
    if (style.antialiasType.modificationCount > 0)
    {
        this.antialiasType.copyValue(style.antialiasType, setOp);
    }

    // borderColor
    if (style.borderColor.modificationCount > 0)
    {
        this.borderColor.copyValue(style.borderColor, setOp);
    }

    // borderWidth
    if (style.borderWidth.modificationCount > 0)
    {
        this.borderWidth.copyValue(style.borderWidth, setOp);
    }

    // color
    if (style.color.modificationCount > 0)
    {
        this.color.copyValue(style.color, setOp);
    }

    // effects
    if (style.effects.modificationCount > 0)
    {
        this.effects.copyValue(style.effects, setOp);
    }

    // font
    if (style.font.modificationCount > 0)
    {
        this.font.copyValue(style.font, setOp);
    }

    // opacity
    if (style.opacity.modificationCount > 0)
    {
        this.opacity.copyValue(style.opacity, setOp);
    }

    // size
    if (style.size.modificationCount > 0)
    {
        this.size.copyValue(style.size, setOp);
    }

    // style
    if (style.style.modificationCount > 0)
    {
        this.style.copyValue(style.style, setOp);
    }
}

LabelStyleAttr.prototype = new StyleAttr();
LabelStyleAttr.prototype.constructor = LabelStyleAttr;

function LabelStyleAttr()
{
    StyleAttr.call(this);
    this.className = "LabelStyleAttr";
    this.attrType = eAttrType.LabelStyleAttr;

    this.angle = new NumberAttr(0);
    this.backgroundColor = new ColorAttr(0, 0, 0, 1);
    this.backgroundOpacity = new NumberAttr(0);
    this.fontStyle = new FontStyleAttr();
    this.format = new StringAttr("left");
    this.height = new NumberAttr(0);
    this.offset = new Vector2DAttr(0, 0);
    this.padding = new NumberAttr(0);
    this.scale = new Vector3DAttr(1, 1, 1);
    this.textAlign = new StringAttr("middleRight");
    this.width = new NumberAttr(0);

    this.registerAttribute(this.angle, "angle");
    this.registerAttribute(this.backgroundColor, "backgroundColor");
    this.registerAttribute(this.backgroundOpacity, "backgroundOpacity");
    this.registerAttribute(this.fontStyle, "fontStyle");
    this.registerAttribute(this.format, "format");
    this.registerAttribute(this.height, "height");
    this.registerAttribute(this.offset, "offset");
    this.registerAttribute(this.padding, "padding");
    this.registerAttribute(this.scale, "scale");
    this.registerAttribute(this.textAlign, "textAlign");
    this.registerAttribute(this.width, "width");
}

LabelStyleAttr.prototype.updateStyle = function (style)
{
    var setOp = style.setOp.getValueDirect();

    // angle
    if (style.angle.modificationCount > 0)
    {
        this.angle.copyValue(style.angle, setOp);
    }

    // backgroundColor
    if (style.backgroundColor.modificationCount > 0)
    {
        this.backgroundColor.copyValue(style.backgroundColor, setOp);
    }

    // backgroundOpacity
    if (style.backgroundOpacity.modificationCount > 0)
    {
        this.backgroundOpacity.copyValue(style.backgroundOpacity, setOp);
    }

    // fontStyle
    this.fontStyle.updateStyle(style.fontStyle);

    // format
    if (style.format.modificationCount > 0)
    {
        this.format.copyValue(style.format, setOp);
    }

    // height
    if (style.height.modificationCount > 0)
    {
        this.height.copyValue(style.height, setOp);
    }

    // offset
    if (style.offset.modificationCount > 0)
    {
        this.offset.copyValue(style.offset, setOp);
    }

    // padding
    if (style.padding.modificationCount > 0)
    {
        this.padding.copyValue(style.padding, setOp);
    }

    // scale
    if (style.scale.modificationCount > 0)
    {
        this.scale.copyValue(style.scale, setOp);
    }

    // textAlign
    if (style.textAlign.modificationCount > 0)
    {
        this.textAlign.copyValue(style.textAlign, setOp);
    }

    // width
    if (style.width.modificationCount > 0)
    {
        this.width.copyValue(style.width, setOp);
    }
}

IconStyleAttr.prototype = new StyleAttr();
IconStyleAttr.prototype.constructor = IconStyleAttr;

function IconStyleAttr()
{
    StyleAttr.call(this);
    this.className = "IconStyleAttr";
    this.attrType = eAttrType.IconStyleAttr;

    this.alphaUrl = new StringAttr("");
    this.color = new ColorAttr(1, 1, 1, 1);
    this.opacity = new NumberAttr(1);
    this.scale = new Vector3DAttr(1, 1, 1);
    this.url = new StringAttr("");

    this.registerAttribute(this.alphaUrl, "alphaUrl");
    this.registerAttribute(this.color, "color");
    this.registerAttribute(this.opacity, "opacity");
    this.registerAttribute(this.scale, "scale");
    this.registerAttribute(this.url, "url");
}

IconStyleAttr.prototype.updateStyle = function (style)
{
    var setOp = style.setOp.getValueDirect();

    // alphaUrl
    if (style.alphaUrl.modificationCount > 0)
    {
        this.alphaUrl.copyValue(style.alphaUrl, setOp);
    }

    // color
    if (style.color.modificationCount > 0)
    {
        this.color.copyValue(style.color, setOp);
    }

    // opacity
    if (style.opacity.modificationCount > 0)
    {
        this.opacity.copyValue(style.opacity, setOp);
    }

    // scale
    if (style.scale.modificationCount > 0)
    {
        this.scale.copyValue(style.scale, setOp);
    }

    // url
    if (style.url.modificationCount > 0)
    {
        this.url.copyValue(style.url, setOp);
    }
}

HTMLLabelStyleAttr.prototype = new StyleAttr();
HTMLLabelStyleAttr.prototype.constructor = HTMLLabelStyleAttr;

function HTMLLabelStyleAttr()
{
    StyleAttr.call(this);
    this.className = "HTMLLabelStyleAttr";
    this.attrType = eAttrType.HTMLLabelStyleAttr;

    this.bgColor = new ColorAttr(1, 1, 1, 1); // white
    this.height = new NumberAttr(0); // 0 (auto-calculate)
    this.html = new StringAttr(); // empty string
    this.left = new NumberAttr(0);
    //if (!(this.scrollBarLabelStyle = New<ScrollBarLabelStyleAttr>())) return;
    this.top = new NumberAttr(0);
    this.url = new StringAttr(); // empty string
    this.width = new NumberAttr(0); // 0 (auto-calculate)

    this.registerAttribute(this.bgColor, "bgColor");
    this.registerAttribute(this.height, "height");
    this.registerAttribute(this.html, "html");
    this.registerAttribute(this.html, "userData");          // for CDATA
    this.registerAttribute(this.left, "left");
    //this.registerAttribute(this.scrollBarLabelStyle, "scrollBarLabelStyle");
    this.registerAttribute(this.top, "top");
    this.registerAttribute(this.url, "url");
    this.registerAttribute(this.width, "width");
}

BalloonTipLabelStyleAttr.prototype = new StyleAttr();
BalloonTipLabelStyleAttr.prototype.constructor = BalloonTipLabelStyleAttr;

function BalloonTipLabelStyleAttr()
{
    StyleAttr.call(this);
    this.className = "BalloonTipLabelStyleAttr";
    this.attrType = eAttrType.BalloonTipLabelStyleAttr;

    this.balloonOffset = new NumberAttr(100);
    this.bgColor = new ColorAttr(1, 1, 1, 1);
    this.displayMode = new StringAttr("default");
    this.htmlLabelStyle = new HTMLLabelStyleAttr();
    this.text = new StringAttr();
    this.textColor = new ColorAttr(0, 0, 0, 1);

    this.registerAttribute(this.balloonOffset, "balloonOffset");
    this.registerAttribute(this.bgColor, "bgColor");
    this.registerAttribute(this.displayMode, "displayMode");
    this.registerAttribute(this.htmlLabelStyle, "htmlLabelStyle");
    this.registerAttribute(this.text, "text");
    this.registerAttribute(this.textColor, "textColor");
}

BalloonTipLabelStyleAttr.prototype.updateStyle = function (style)
{
    var setOp = style.setOp.getValueDirect();

    // balloonOffset
    if (style.balloonOffset.modificationCount > 0)
    {
        this.balloonOffset.copyValue(style.balloonOffset, setOp);
    }

    // bgColor
    if (style.bgColor.modificationCount > 0)
    {
        this.bgColor.copyValue(style.bgColor, setOp);
    }

    // displayMode
    if (style.displayMode.modificationCount > 0)
    {
        this.displayMode.copyValue(style.displayMode, setOp);
    }

    // htmlLabelStyle
    this.htmlLabelStyle.updateStyle(style.htmlLabelStyle);

    // text
    if (style.text.modificationCount > 0)
    {
        this.text.copyValue(style.text, setOp);
    }

    // textColor
    if (style.textColor.modificationCount > 0)
    {
        this.textColor.copyValue(style.textColor, setOp);
    }
}

RenderableElementStyleAttr.prototype = new StyleAttr();
RenderableElementStyleAttr.prototype.constructor = RenderableElementStyleAttr;

function RenderableElementStyleAttr()
{
    StyleAttr.call(this);
    this.className = "RenderableElementStyleAttr";
    this.attrType = eAttrType.RenderableElementStyleAttr;

    this.hasFocus = new TernaryAttr(0);
    this.selected = new TernaryAttr(0);

    this.registerAttribute(this.hasFocus, "hasFocus");
    this.registerAttribute(this.selected, "selected");
}

RenderableElementStyleAttr.prototype.updateStyle = function (style)
{
    var setOp = style.setOp.getValueDirect();

    // hasFocus
    if (style.hasFocus.modificationCount > 0)
    {
        this.hasFocus.copyValue(style.hasFocus, setOp);
    }

    // selected
    if (style.selected.modificationCount > 0)
    {
        this.selected.copyValue(style.selected, setOp);
    }
}

PlaneAttr.prototype = new AttributeContainer();
PlaneAttr.prototype.constructor = PlaneAttr;

function PlaneAttr()
{
    AttributeContainer.call(this);
    this.className = "PlaneAttr";
    this.attrType = eAttrType.PlaneAttr;

    this.point = new Vector3DAttr(0, 0, 0);
    this.normal = new Vector3DAttr(0, 0, 1);
    this.dot = new NumberAttr(0);

    this.registerAttribute(this.point, "point");
    this.registerAttribute(this.normal, "normal");
    this.registerAttribute(this.dot, "dot");
}

PlaneAttr.prototype.getValueDirect = function ()
{
    var point = this.point.getValueDirect();
    var normal = this.normal.getValueDirect();
    var plane = new Plane(new Vector3D(point.x, point.y, point.z), new Vector3D(normal.x, normal.y, normal.z));
    return plane;
}

PlaneAttr.prototype.setValueDirect = function (plane)
{
    this.point.setValueDirect(plane.point.x, plane.point.y, plane.point.z);
    this.normal.setValueDirect(plane.normal.x, plane.normal.y, plane.normal.z);
    this.dot.setValueDirect(plane.dot);
}

ViewVolumeAttr.prototype = new AttributeContainer();
ViewVolumeAttr.prototype.constructor = ViewVolumeAttr;

function ViewVolumeAttr()
{
    AttributeContainer.call(this);
    this.className = "ViewVolumeAttr";
    this.attrType = eAttrType.ViewVolumeAttr;

    this.left = new PlaneAttr();
    this.right = new PlaneAttr();
    this.top = new PlaneAttr();
    this.bottom = new PlaneAttr();
    this.near = new PlaneAttr();
    this.far = new PlaneAttr();

    this.registerAttribute(this.left, "left");
    this.registerAttribute(this.right, "right");
    this.registerAttribute(this.top, "top");
    this.registerAttribute(this.bottom, "bottom");
    this.registerAttribute(this.near, "near");
    this.registerAttribute(this.far, "far");
}

ViewVolumeAttr.prototype.setValueDirect = function (left, right, top, bottom, near, far)
{
    this.left.setValueDirect(left);
    this.right.setValueDirect(right);
    this.top.setValueDirect(top);
    this.bottom.setValueDirect(bottom);
    this.near.setValueDirect(near);
    this.far.setValueDirect(far);
}

SphereAttr.prototype = new AttributeContainer();
SphereAttr.prototype.constructor = SphereAttr;

function SphereAttr()
{
    AttributeContainer.call(this);
    this.className = "SphereAttr";
    this.attrType = eAttrType.SphereAttr;

    this.sphere = new Sphere();

    this.center = new Vector3DAttr(0, 0, 0);
    this.radius = new NumberAttr(0);

    this.center.addModifiedCB(SphereAttr_CenterModifiedCB, this);
    this.radius.addModifiedCB(SphereAttr_RadiusModifiedCB, this);
    
    this.registerAttribute(this.center, "center");
    this.registerAttribute(this.radius, "radius");
}

function SphereAttr_CenterModifiedCB(attribute, container)
{
    container.sphere.center = attribute.getValueDirect();
}

function SphereAttr_RadiusModifiedCB(attribute, container)
{
    container.sphere.radius = attribute.getValueDirect();
}

PhysicalPropertiesAttr.prototype = new AttributeContainer();
PhysicalPropertiesAttr.prototype.constructor = PhysicalPropertiesAttr;

function PhysicalPropertiesAttr()
{
    AttributeContainer.call(this);
    this.className = "PhysicalPropertiesAttr";
    this.attrType = eAttrType.PhysicalPropertiesAttr;

    this.mass = new NumberAttr(0);
    this.radius = new NumberAttr(0);
    this.friction = new NumberAttr(0);
    this.restitution = new NumberAttr(0);
    this.linearDamping = new NumberAttr(0);
    this.angularDamping = new NumberAttr(0);
    this.rollingFriction = new NumberAttr(0);

    this.registerAttribute(this.mass, "mass");
    this.registerAttribute(this.radius, "radius");
    this.registerAttribute(this.friction, "friction");
    this.registerAttribute(this.restitution, "restitution");
    this.registerAttribute(this.linearDamping, "linearDamping");
    this.registerAttribute(this.angularDamping, "angularDamping");
    this.registerAttribute(this.rollingFriction, "rollingFriction");
}

function setAttributeValue(attribute, value)
{
    switch (attribute.attrType)
    {
    case eAttrType.BooleanAttr:
        {
            if (value == "false" || value == "0")
                attribute.setValueDirect(false);
            else 
                attribute.setValueDirect(true);
        }
        break;

    case eAttrType.ColorAttr:
    case eAttrType.Matrix4x4Attr:
    case eAttrType.NumberArrayAttr:
    case eAttrType.QuaternionAttr:
    case eAttrType.Vector2DAttr:
    case eAttrType.Vector3DAttr:
    case eAttrType.ViewportAttr:
        {
            // convert from string to numeric
            for (var i = 0; i < value.length; i++)
            {
                value[i] = parseFloat(value[i]);
            }
            attribute.setValue(value);
        }
        break;   
    
    case eAttrType.NumberAttr:
        {
            // convert from string to numeric
            attribute.setValueDirect(parseFloat(value));
        }
        break;

    default:
        {
            attribute.setValue(value);
        }
        break;
    }
}
Agent.prototype = new AttributeContainer();
Agent.prototype.constructor = Agent;

function Agent()
{
    AttributeContainer.call(this);
    this.className = "Agent";
    
    this.running = false;
    
    this.name = new StringAttr("");
    this.enabled = new BooleanAttr(true);
    
    this.registerAttribute(this.name, "name");
    this.registerAttribute(this.enabled, "enabled");
}

Agent.prototype.start = function()
{
    this.running = true;
}

Agent.prototype.stop = function()
{
    this.running = false;
}

Agent.prototype.pause = function()
{
    this.running = false;
}



function RayIntersectRecord()
{
    this.distance = Infinity;
    this.pointModel = new Vector3D();
    this.pointWorld = new Vector3D();
    this.pointView = new Vector3D();
    this.normalModel = new Vector3D();
    this.normalWorld = new Vector3D();
    this.normalView = new Vector3D();
    this.triIndex = 0;
}

function RayIntersectParams(rayOrigin,
                            rayDir,
                            nearDistance,
                            farDistance,
                            worldMatrix,
                            viewMatrix,
                            scale,
                            doubleSided,
                            clipPlanes,
                            farthest)
{
    this.rayOrigin = rayOrigin || new Vector3D();
    this.rayDir = rayDir || new Vector3D();
    this.nearDistance = nearDistance || 0;
    this.farDistance = farDistance || 0;
    this.worldMatrix = worldMatrix || new Matrix4x4();
    this.viewMatrix = viewMatrix || new Matrix4x4();
    this.worldViewMatrix = this.worldMatrix.multiply(this.viewMatrix);
    this.scale = scale || 0;
    this.doubleSided = doubleSided || false;
    this.clipPlanes = clipPlanes || new Array();
    this.farthest = farthest || false;
    this.intersects = false;
    this.intersectRecord = new RayIntersectRecord();
    
    if (farthest)
    {
        this.intersectRecord.distance = 0;
    }
}

function Triangle(x0, y0, z0, x1, y1, z1, x2, y2, z2)
{
    this.v0 = new Vector3D(x0, y0, z0);
    this.v1 = new Vector3D(x1, y1, z1);
    this.v2 = new Vector3D(x2, y2, z2);
}

function Sphere()
{
    this.center = new Vector3D();
    this.radius = 0;
    this.xcenter = new Vector3D(); // transformed center
    this.xradius = 0;              // transformed (scaled) radius
}

Sphere.prototype.setTransform = function(matrix)
{
    var result = matrix.transform(this.center.x, this.center.y, this.center.z, 1);
    this.xcenter.x = result.x;
    this.xcenter.y = result.y;
    this.xcenter.z = result.z;

    var scale = matrix.getScalingFactors();
    this.xradius = this.radius * max3(scale.x, scale.y, scale.z);
}

Sphere.prototype.intersects = function(sphere)
{
    // compare squared distances to keep from calling sqrt
    /*return (((this.xcenter.x - sphere.xcenter.x) * (this.xcenter.x - sphere.xcenter.x) + 
     (this.xcenter.y - sphere.xcenter.y) * (this.xcenter.y - sphere.xcenter.y) +
     (this.xcenter.z - sphere.xcenter.z) * (this.xcenter.z - sphere.xcenter.z)) < ((this.xradius + sphere.xradius) * (this.xradius + sphere.xradius)) ? true : false);
     */
    var distanceBetweenCenters = distanceBetween(this.xcenter, sphere.xcenter);
    var combinedRadii = this.xradius + sphere.xradius;

    if (distanceBetweenCenters < combinedRadii)
        return true;

    return false;
}

function Region(minX, minY, minZ, maxX, maxY, maxZ)
{
    this.min = new Vector3D(minX, minY, minZ);
    this.max = new Vector3D(maxX, maxY, maxZ);

    this.xpos = new Plane();
    this.xneg = new Plane();
    this.ypos = new Plane();
    this.yneg = new Plane();
    this.zpos = new Plane();
    this.zneg = new Plane();

    this.xpos_ypos_zpos = new Plane();
    this.xpos_ypos_zneg = new Plane();
    this.xpos_yneg_zpos = new Plane();
    this.xpos_yneg_zneg = new Plane();
    this.xneg_ypos_zpos = new Plane();
    this.xneg_ypos_zneg = new Plane();
    this.xneg_yneg_zpos = new Plane();
    this.xneg_yneg_zneg = new Plane();

    this.setPlanes();
}

Region.prototype.setPlanes = function()
{
    // generate axis planes
    this.xpos = new Plane(this.max, new Vector3D(1, 0, 0));
    this.xneg = new Plane(this.min, new Vector3D(-1, 0, 0));
    this.ypos = new Plane(this.max, new Vector3D(0, 1, 0));
    this.yneg = new Plane(this.min, new Vector3D(0, -1, 0));
    this.zpos = new Plane(this.max, new Vector3D(0, 0, 1));
    this.zneg = new Plane(this.min, new Vector3D(0, 0, -1));

    // define corner points of region
    var xp_yp_zp = new Vector3D(this.max.x, this.max.y, this.max.z);
    var xp_yp_zn = new Vector3D(this.max.x, this.max.y, this.min.z);
    var xp_yn_zp = new Vector3D(this.max.x, this.min.y, this.max.z);
    var xp_yn_zn = new Vector3D(this.max.x, this.min.y, this.min.z);
    var xn_yp_zp = new Vector3D(this.min.x, this.max.y, this.max.z);
    var xn_yp_zn = new Vector3D(this.min.x, this.max.y, this.min.z);
    var xn_yn_zp = new Vector3D(this.min.x, this.min.y, this.max.z);
    var xn_yn_zn = new Vector3D(this.min.x, this.min.y, this.min.z);

    // generate corner planes
    this.xpos_ypos_zpos = new Plane(xp_yp_zp, xp_yp_zp - xn_yn_zn);
    this.xpos_ypos_zneg = new Plane(xp_yp_zn, xp_yp_zn - xn_yn_zp);
    this.xpos_yneg_zpos = new Plane(xp_yn_zp, xp_yn_zp - xn_yp_zn);
    this.xpos_yneg_zneg = new Plane(xp_yn_zn, xp_yn_zn - xn_yp_zp);
    this.xneg_ypos_zpos = new Plane(xn_yp_zp, xn_yp_zp - xp_yn_zn);
    this.xneg_ypos_zneg = new Plane(xn_yp_zn, xn_yp_zn - xp_yn_zp);
    this.xneg_yneg_zpos = new Plane(xn_yn_zp, xn_yn_zp - xp_yp_zn);
    this.xneg_yneg_zneg = new Plane(xn_yn_zn, xn_yn_zn - xp_yp_zp);
}

Region.prototype.containsGeometry = function(tris, triIndices)
{
    var result = [];

    for (var i = 0; i < triIndices.length; i++)
    {
        if (this.containsTriangle(tris[triIndices[i]]))
        {
            result.push(triIndices[i]);
        }
    }

    return result;
}

Region.prototype.containsTriangle = function(tri)
{
    var verts = new Array(3);
    verts[0] = tri.v0;
    verts[1] = tri.v1;
    verts[2] = tri.v2;

    // check if any vertices are within the region bounds (quick accept)
    for (var i = 0; i < 3; i++)
    {
        if (verts[i].x >= this.min.x &&
            verts[i].y >= this.min.y &&
            verts[i].z >= this.min.z &&
            verts[i].x <= this.max.x &&
            verts[i].y <= this.max.y &&
            verts[i].z <= this.max.z)
        {
            return true;
        }
    }

    // check if all vertices are outside a region plane (quick reject)
    if (triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xpos) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xneg) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.ypos) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.yneg) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.zpos) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.zneg) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xpos_ypos_zpos) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xpos_ypos_zneg) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xpos_yneg_zpos) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xpos_yneg_zneg) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xneg_ypos_zpos) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xneg_ypos_zneg) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xneg_yneg_zpos) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xneg_yneg_zneg))
    {
        return false;
    }

    // triangle has survived trivial acceptance/rejection tests...

    // test triangle line segments for cube face penetration
    // (only test segments if they span the face plane)
    var result;
    for (var i = 0; i < 3; i++)
    {
        var a = verts[i];
        var b = verts[(i + 1) % 3];

        // +X face
        result = lineSegmentPlaneIntersection(a, b, this.xpos);
        if (result.count > 0)
        {
            // if point lies within region face, triangle intersects region
            if (result.point.y >= this.min.y && result.point.y <= this.max.y &&
                result.point.z >= this.min.z && result.point.z <= this.max.z)
            {
                return true;
            }
        }

        // -X face
        result = lineSegmentPlaneIntersection(a, b, this.xneg);
        if (result.count > 0)
        {
            if (result.point.y >= this.min.y && result.point.y <= this.max.y &&
                result.point.z >= this.min.z && result.point.z <= this.max.z)
            {
                return true;
            }
        }

        // +Y face
        result = lineSegmentPlaneIntersection(a, b, this.ypos);
        if (result.count > 0)
        {
            if (result.point.x >= this.min.x && result.point.x <= this.max.x &&
                result.point.z >= this.min.z && result.point.z <= this.max.z)
            {
                return true;
            }
        }

        // -Y face
        result = lineSegmentPlaneIntersection(a, b, this.yneg);
        if (result.count > 0)
        {
            if (result.point.x >= this.min.x && result.point.x <= this.max.x &&
                result.point.z >= this.min.z && result.point.z <= this.max.z)
            {
                return true;
            }
        }

        // +Z face
        result = lineSegmentPlaneIntersection(a, b, this.zpos);
        if (result.count > 0)
        {
            if (result.point.x >= this.min.x && result.point.x <= this.max.x &&
                result.point.y >= this.min.y && result.point.y <= this.max.y)
            {
                return true;
            }
        }

        // -Z face
        result = lineSegmentPlaneIntersection(a, b, this.zneg);
        if (result.count > 0)
        {
            if (result.point.x >= this.min.x && result.point.x <= this.max.x &&
                result.point.y >= this.min.y && result.point.y <= this.max.y)
            {
                return true;
            }
        }
    }

    // triangle and region may still intersect if a region corner is poking
    // through the interior of the triangle; check for this case by
    // determining if any of the four region diagonals intersect the triangle
    // 0
    result = lineSegmentTriangleIntersection(this.min,
            this.max,
            verts[0], verts[1], verts[2]);
    if (result.count > 0)
        return true;
    // 1
    result = lineSegmentTriangleIntersection(new Vector3D(this.min.x, this.max.y, this.min.z),
            new Vector3D(this.max.x, this.min.y, this.max.z),
            verts[0], verts[1], verts[2]);
    if (result.count > 0)
        return true;
    // 2
    result = lineSegmentTriangleIntersection(new Vector3D(this.max.x, this.min.y, this.min.z),
            new Vector3D(this.min.x, this.max.y, this.max.z),
            verts[0], verts[1], verts[2]);
    if (result.count > 0)
        return true;
    // 3                                        
    result = lineSegmentTriangleIntersection(new Vector3D(this.min.x, this.min.y, this.max.z),
            new Vector3D(this.max.x, this.max.y, this.min.z),
            verts[0], verts[1], verts[2]);
    if (result.count > 0)
        return true;

    // triangle and region do not intersect
    return false;
}

function SphereTreeNode(tree)
{
    this.tree = tree;
    this.sphere = new Sphere();
    this.level = 0;
    this.parent = null;
    this.children = [];
    this.triIndices = [];
}

SphereTreeNode.prototype.isLeaf = function()
{
    return this.children.length == 0 ? true : false;
}

SphereTreeNode.prototype.addChild = function(child)
{
    this.children.push(child);
    child.parent = this;
}

SphereTreeNode.prototype.intersects = function(sphereTreeNode)
{
    return (this.sphere.intersects(sphereTreeNode.sphere));
}

SphereTreeNode.prototype.trisIntersect = function(sphereTreeNode)
{
    return true;
    /*
     var triVerts1 = [];
     for (var i = 0; i < this.triIndices.length; i++)
     {
     var index = this.triIndices[i];
     var tri = this.tree.tris[index];
     
     triVerts1.push(this.tree.xform.transform(tri.v0.x, tri.v0.y, tri.v0.z, 1));
     triVerts1.push(this.tree.xform.transform(tri.v1.x, tri.v1.y, tri.v1.z, 1));
     triVerts1.push(this.tree.xform.transform(tri.v2.x, tri.v2.y, tri.v2.z, 1));
     }   
     
     var triVerts2 = [];
     for (var i = 0; i < sphereTreeNode.triIndices.length; i++)
     {
     var index = sphereTreeNode.triIndices[i];
     var tri = sphereTreeNode.tree.tris[index];
     
     triVerts2.push(sphereTreeNode.tree.xform.transform(tri.v0.x, tri.v0.y, tri.v0.z, 1));
     triVerts2.push(sphereTreeNode.tree.xform.transform(tri.v1.x, tri.v1.y, tri.v1.z, 1));
     triVerts2.push(sphereTreeNode.tree.xform.transform(tri.v2.x, tri.v2.y, tri.v2.z, 1));
     } 
     
     for (var i = 0; i < triVerts1.length; i += 3)
     {
     for (var j = 0; j < triVerts2.length; j += 3)
     {
     if (triangleTriangleIntersection(triVerts1[i], triVerts1[i+1], triVerts1[i+2],
     triVerts2[j], triVerts2[j+1], triVerts2[j+2]))
     return true;
     }    
     }
     
     return false;*/
}

function SphereHitRec()
{
    this.target = null;
    this.testList = [];
}
;

function BoundingTree()
{
    this.root = null;
    this.min = new Vector3D();
    this.max = new Vector3D();
    this.tris = [];
    this.visited = [];
    this.xform = new Matrix4x4();
}

BoundingTree.prototype.setTriangles = function(tris, min, max)
{
    this.tris = tris.slice();
    this.min.copy(min);
    this.max.copy(max);
}

BoundingTree.prototype.setTransform = function(matrix)
{
    this.xform.loadMatrix(matrix);
}

SphereTree.prototype = new BoundingTree();
SphereTree.prototype.constructor = SphereTree;

function SphereTree()
{
    BoundingTree.call(this);
}

SphereTree.prototype.setTransform = function(matrix)
{
    if (this.root)
        this.transformNode(matrix, this.root);

    // call base-class implementation
    BoundingTree.prototype.setTransform.call(this, matrix);
}

SphereTree.prototype.transformNode = function(matrix, node)
{
    node.sphere.setTransform(matrix);

    // recurse on node children
    for (var i = 0; i < node.children.length; i++)
    {
        this.transformNode(matrix, node.children[i]);
    }
}

SphereTree.prototype.collides = function(tree)
{
    if (!this.root || !tree.root) // must be non-NULL
    {
        return false;
    }

    // check root nodes for collision
    if (this.nodesCollide(this.root, tree.root))
    {
        // if both root nodes are leaves, and node's triangle(s) intersect, return true
        if (this.root.isLeaf() && tree.root.isLeaf())
        {
            return this.root.trisIntersect(tree.root);
        }

        // recursively check child nodes
        var sphereHit = new SphereHitRec();
        var sphereHits = [];
        if (tree.root.isLeaf())
        {
            sphereHit.target = tree.root;
            sphereHit.testList = this.root.children;
        }
        else
        {
            sphereHit.target = this.root;
            sphereHit.testList = tree.root.children;
        }
        sphereHits.push(sphereHit);

        return this.testSphereHits(sphereHits);
    }

    // root nodes do not collide
    return false;
}

SphereTree.prototype.obstructs = function(tree, forward)
{
    if (!this.root || !tree.root) // must be non-NULL
    {
        return 0; // indicates no obstruction
    }

    // construct cylinder representing tree's root sphere extruded along the forward vector
    var cylA = tree.root.sphere.xcenter;
    var cylB = new Vector3D(cylA.x + forward.x,
            cylA.y + forward.y,
            cylA.z + forward.z);
    var cylRadius = tree.root.sphere.xradius;

    // find distance between cylinder center segment and this' center
    var distance = distanceBetweenLineSegmentAndPoint(cylA, cylB, this.root.sphere.xcenter);

    if (distance < (this.root.sphere.xradius + cylRadius))
    {
        return distance;
    }

    return 0; // indicates no obstruction
}

SphereTree.prototype.nodesCollide = function(node1, node2)
{
    return (node1.intersects(node2));
}

SphereTree.prototype.testSphereHits = function(sphereHits)
{
    while (sphereHits.length > 0)
    {
        if (this.testSphereHit(sphereHits[0], sphereHits))
        {
            return true;
        }

        sphereHits.splice(0, 1);
    }

    return false;
}

SphereTree.prototype.testSphereHit = function(sphereHit, sphereHits)
{
    for (var i = 0; i < sphereHit.testList.length; i++)
    {
        if (this.nodesCollide(sphereHit.target, sphereHit.testList[i]))
        {
            var nextSphereHit = new SphereHitRec();
            nextSphereHit.target = sphereHit.testList[i];
            if (sphereHit.target.isLeaf())
            {
                nextSphereHit.testList.push(sphereHit.target);
            }
            else
            {
                nextSphereHit.testList = sphereHit.target.children;
            }
            sphereHits.push(nextSphereHit);

            // check for leaf collision
            if (sphereHit.target.isLeaf() && sphereHit.testList[i].isLeaf())
            {
                return sphereHit.target.trisIntersect(sphereHit.testList[i]);
            }
        }
    }

    // no leaf collisions
    return false;
}

SphereTree.prototype.rayIntersectsTree = function(params)
{
    if (this.root)
    {
        this.visited.length = this.tris.length;
        for (var i = 0; i < this.visited.length; i++)
        {
            this.visited[i] = false;
        }

        return this.rayIntersectsTreeNode(this.root, params);
    }

    return false;
}

SphereTree.prototype.rayIntersectsTreeNode = function(root, params)
{
    // if this sphere tree node has children, and it is intersected by the ray, 
    // recurse on all sphere tree nodes in the next level, saving the smallest positive 
    // t value; if ray does not intersect this sphere tree node, or if no intersections 
    // are found for the next level, return false
    if (root.children.length > 0)
    {
        // check if this sphere tree node is intersected by the ray
        if (this.rayIntersectsSphere(root, params) == false)
        {
            return false;
        }

        // sphere tree node is intersected by the ray, recurse on children nodes
        var childIntersects = false;
        for (var i = 0; i < root.children.length; i++)
        {
            if (this.rayIntersectsTreeNode(root.children[i], params) == true)
            {
                childIntersects = true;
            }
        }

        if (childIntersects)
        {
            return true;
        }
        else // !childIntersects
        {
            return false;
        }
    }
    else // root.children.empty()
    {
        // lowest sphere tree node level (no children); check against tris
        return this.rayIntersectsTriangleList(root.triIndices, params);
    }
}

SphereTree.prototype.rayIntersectsSphere = function(node, params)
{
    // transform sphere center by world-view transform
    var center = params.worldViewMatrix.transform(node.sphere.center.x, node.sphere.center.y, node.sphere.center.z, 1);

    // adjust sphere radius by scale factor
    var radius = node.sphere.radius * max3(params.scale.x, params.scale.y, params.scale.z);

    // test for ray-sphere intersection
    var roots = raySphereIntersection(params.rayOrigin, params.rayDir, center, radius);
    switch (roots.count)
    {
        case 2:
            // two intersection points; accept if one root is positive
            if (roots.root1 <= 0 && roots.root2 <= 0)
            {
                return false;
            }
            break;

        case 1:
            // one intersection point (ray grazes sphere); accept if root is positive
            if (roots.root1 <= 0)
            {
                return false;
            }
            break;

        case 0:
        default:
            // no intersection
            return false;
    }

    return true;
}

SphereTree.prototype.rayIntersectsTriangleList = function(triIndices, params)
{
    var distance, u, v;

    // determine closest triangle intersected by ray (closest to ray origin)
    for (var i = 0; i < triIndices.length; i++)
    {
        var index = triIndices[i];

        // skip triangle if already tested
        if (this.visited[index] == true)
        {
            continue;
        }

        var tri = this.tris[index];

        // transform triangle vertices by world-view transform
        var v0 = params.worldViewMatrix.transform(tri.v0.x, tri.v0.y, tri.v0.z, 1);
        var v1 = params.worldViewMatrix.transform(tri.v1.x, tri.v1.y, tri.v1.z, 1);
        var v2 = params.worldViewMatrix.transform(tri.v2.x, tri.v2.y, tri.v2.z, 1);

        var result = rayTriangleIntersection(params.rayOrigin, params.rayDir, v0, v1, v2, false,
                (params.doubleSided ? false : true));
        if (result.result)
        {
            if (result.t >= params.nearDistance && result.t <= params.farDistance)
            {
                if (!params.farthest)
                {
                    if (result.t >= params.intersectRecord.distance) continue;
                }
                else // params.farthest
                {
                    if (result.t <= params.intersectRecord.distance) continue;
                }
                
                var pointModel = new Vector3D(tri.v0.x * (1 - result.u - result.v) + tri.v1.x * result.u + tri.v2.x * result.v,
                        tri.v0.y * (1 - result.u - result.v) + tri.v1.y * result.u + tri.v2.y * result.v,
                        tri.v0.z * (1 - result.u - result.v) + tri.v1.z * result.u + tri.v2.z * result.v);
                var pointWorld = params.worldMatrix.transform(pointModel.x, pointModel.y, pointModel.z, 1);
                var pointView = params.worldViewMatrix.transform(pointModel.x, pointModel.y, pointModel.z, 1);

                // test for intersection point on negative side of clip plane(s), if any (would hence be clipped)
                for (var c = 0; c < params.clipPlanes.length; c++)
                {
                    if (pointOnNegativeSideOfPlane(pointWorld, params.clipPlanes[c]))
                    {
                        // mark triangle as tested
                        this.visited[index] = true;
                        break;
                    }
                }
                if (this.visited[index]) // clipped by clip plane(s)
                {
                    continue;
                }

                // calculate polygon normal
                var leg1 = new Vector3D();
                var leg2 = new Vector3D();     
                leg1.load(tri.v1.x - tri.v0.x,
                          tri.v1.y - tri.v0.y,
                          tri.v1.z - tri.v0.z);
                leg2.load(tri.v2.x - tri.v0.x,
                          tri.v2.y - tri.v0.y,
                          tri.v2.z - tri.v0.z);
                var normalModel = crossProduct(leg1, leg2);
                normalModel.normalize();
                var normalWorld = params.worldMatrix.transform(normalModel.x, normalModel.y, normalModel.z, 0);
                normalWorld = new Vector3D(normalWorld.x, normalWorld.y, normalWorld.z);
                normalWorld.normalize();
                var normalView = params.worldViewMatrix.transform(normalModel.x, normalModel.y, normalModel.z, 0);
                normalView = new Vector3D(normalView.x, normalView.y, normalView.z);
                normalView.normalize();
            
                params.intersectRecord.distance = result.t;
                params.intersectRecord.pointModel.copy(pointModel);
                params.intersectRecord.pointWorld.copy(pointWorld);
                params.intersectRecord.pointView.copy(pointView);
                params.intersectRecord.normalModel.copy(normalModel);
                params.intersectRecord.normalWorld.copy(normalWorld);
                params.intersectRecord.normalView.copy(normalView);
                params.intersectRecord.triIndex = index;
                params.intersects = true;
            }
        }

        // mark triangle as tested
        this.visited[index] = true;
    }

    return params.intersects;
}

Octree.prototype = new SphereTree();
Octree.prototype.constructor = Octree;

function Octree()
{
    SphereTree.call(this);
}

Octree.prototype.buildTree = function(levels)
{
    if (levels < 0)
        return;

    // define root sphere
    var root = new SphereTreeNode(this);

    // sphere center is the midpoint of min/max extents
    root.sphere.center.copy(midpoint(this.min, this.max));
    root.sphere.xcenter.copy(root.sphere.center);

    // sphere radius is the distance between the midpoint of min/max extents and min/max extent
    root.sphere.radius = distanceBetween(root.sphere.center, this.max);
    root.sphere.xradius = root.sphere.radius;

    // set triIndices
    root.triIndices.length = this.tris.length;
    for (var i = 0; i < this.tris.length; i++)
    {
        root.triIndices[i] = i;
    }

    // build subsequent levels (if requested) 
    if (levels > 0)
    {
        this.buildTreeLevels(levels, this.min, this.max, root, root.triIndices);
    }

    this.root = root;
}

Octree.prototype.buildTreeLevels = function(levels, min, max, root, triIndices)
{
    if (root.level == levels || triIndices.length == 1)
    {
        // requested levels have been generated
        return;
    }

    // define 8 equal sub-regions occupying the span from min to max
    var mid = new Vector3D(min.x + ((max.x - min.x) / 2),
            min.y + ((max.y - min.y) / 2),
            min.z + ((max.z - min.z) / 2));

    var regions = new Array(8);
    regions[0] = new Region(min.x, min.y, min.z, mid.x, mid.y, mid.z);
    regions[1] = new Region(mid.x, min.y, min.z, max.x, mid.y, mid.z);
    regions[2] = new Region(min.x, min.y, mid.z, mid.x, mid.y, max.z);
    regions[3] = new Region(mid.x, min.y, mid.z, max.x, mid.y, max.z);
    regions[4] = new Region(min.x, mid.y, min.z, mid.x, max.y, mid.z);
    regions[5] = new Region(mid.x, mid.y, min.z, max.x, max.y, mid.z);
    regions[6] = new Region(min.x, mid.y, mid.z, mid.x, max.y, max.z);
    regions[7] = new Region(mid.x, mid.y, mid.z, max.x, max.y, max.z);

    // for each sub-region containing geometry, create a bounding sphere for the sub-region, 
    // add to the list of the root sphere node's children, and recursively call for the child 
    // sub-region
    for (var i = 0; i < 8; i++)
    {
        var triIndicesContainedByRegion = regions[i].containsGeometry(this.tris, triIndices);
        if (triIndicesContainedByRegion.length > 0)
        {
            // create sphere node
            var node = new SphereTreeNode(this);

            // set level
            node.level = root.level + 1;

            // set center
            node.sphere.center.copy(midpoint(regions[i].min, regions[i].max));
            node.sphere.xcenter.copy(node.sphere.center);

            // set radius
            node.sphere.radius = distanceBetween(node.sphere.center, regions[i].max);
            node.sphere.xradius = node.sphere.radius;

            // set triIndices
            node.triIndices = triIndicesContainedByRegion.slice();

            // add to root sphere node
            root.addChild(node);

            // recurse on sub-region
            this.buildTreeLevels(levels, regions[i].min, regions[i].max, node, node.triIndices);
        }
    }
}

function rayPick(tree,
                 rayOrigin,
                 rayDir,
                 nearDistance,
                 farDistance,
                 worldMatrix,
                 viewMatrix,
                 scale,
                 doubleSided,
                 clipPlanes,
                 farthest)
{
    var params = new RayIntersectParams(rayOrigin, rayDir, nearDistance, farDistance, worldMatrix, viewMatrix, scale, doubleSided, clipPlanes, farthest);
    tree.rayIntersectsTree(params);
    if (params.intersects == true)
    {
        return params.intersectRecord;
    }

    return null;
}
function Context()
{
    this.clear();
}

Context.prototype.clear = function()
{
    this.container = null;
    this.attribute = null;
    this.item = 0;
    this.containerName = "";
    this.attributeName = "";
}
var eViewVolumePlane = {
    Unknown                     :-1,
    
    Left                        :0,
    Right                       :1,
    Top                         :2,
    Bottom                      :3,
    Near                        :4,
    Far                         :5
};

function ViewVolume()
{
    var left = null;
    var right = null;
    var top = null;
    var bottom = null;
    var near = null;
    var far = null;
}

ViewVolume.prototype.setPerspective = function(fovyRadians, aspectRatio, near, far)
{
    // calculate the front and back frustum plane quadrilateral endpoints
    // for a symmetric frustum volume

    // front quad
   
    // derive 1/2 quad height from y-FOV and distance from origin
    var height = near * Math.tan(0.5 * fovyRadians);

    // derive 1/2 quad width from aspect ratio
    var width = height * aspectRatio;

    // set front quad endpoints
    var frontTopLeft  = new Vector3D(-width, height, near);
    var frontTopRight = new Vector3D( width, height, near);
    var frontBotLeft  = new Vector3D(-width,-height, near);
    var frontBotRight = new Vector3D( width,-height, near);

    // back quad
    height = far * Math.tan(0.5 * fovyRadians);
    width = height * aspectRatio;

    var backTopLeft  = new Vector3D(-width, height, far);
    var backTopRight = new Vector3D( width, height, far);
    var backBotLeft  = new Vector3D(-width,-height, far);
    var backBotRight = new Vector3D( width,-height, far);

    // derive planes from frustum endpoints (specify points in 
    // clockwise order so that plane normals point out of frustum)
    this.left   = new Plane2(frontTopLeft,  frontBotLeft,  backBotLeft);
    this.right  = new Plane2(frontBotRight, frontTopRight, backTopRight);
    this.top    = new Plane2(frontTopLeft,  backTopLeft,   backTopRight);
    this.bottom = new Plane2(frontBotLeft,  frontBotRight, backBotRight);
    this.near  = new Plane2(frontBotLeft,  frontTopLeft,  frontTopRight);
    this.far   = new Plane2(backBotRight,  backTopRight,  backTopLeft);
}

ViewVolume.prototype.setOrthographic = function(left, right, top, bottom, near, far)
{
    // calculate the front and back frustum plane quadrilateral endpoints
    // for a symmetric frustum volume

    // set front quad endpoints
    var frontTopLeft  = new Vector3D(left,  top,    near);
    var frontTopRight = new Vector3D(right, top,    near);
    var frontBotLeft  = new Vector3D(left,  bottom, near);
    var frontBotRight = new Vector3D(right, bottom, near);

    // back quad
    var backTopLeft   = new Vector3D(left,  top,    far);
    var backTopRight  = new Vector3D(right, top,    far);
    var backBotLeft   = new Vector3D(left,  bottom, far);
    var backBotRight  = new Vector3D(right, bottom, far);

    // derive planes from frustum endpoints (specify points in 
    // clockwise order so that plane normals point out of frustum)
    this.left   = new Plane2(backBotLeft,   backTopLeft,   frontTopLeft);
    this.right  = new Plane2(frontBotRight, frontTopRight, backTopRight);
    this.top    = new Plane2(frontTopLeft,  backTopLeft,   backTopRight);
    this.bottom = new Plane2(backBotRight,  backBotLeft,   frontBotLeft);
    this.near   = new Plane2(frontBotLeft,  frontTopLeft,  frontTopRight);
    this.far    = new Plane2(backBotRight,  backTopRight,  backTopLeft);
}

ViewVolume.prototype.getPlane = function(planeEnum)
{
    switch (planeEnum)
    {
    case eViewVolumePlane.Left:
        return left;

    case eViewVolumePlane.Right:
        return right;

    case eViewVolumePlane.Top:
        return top;

    case eViewVolumePlane.Bottom:
        return bottom;

    case eViewVolumePlane.Near:
        return near;

    case eViewVolumePlane.Far:
        return far;
    }
    
    return null;
}

function viewVolumeCull(viewVolume, sphere, scale, worldView)
{
    // get frustum planes
    var left   = viewVolume.left;
    var right  = viewVolume.right;
    var top    = viewVolume.top;
    var bottom = viewVolume.bottom;
    var near   = viewVolume.near;
    var far    = viewVolume.far;

    // transform sphere center by world-view transformation (put into view-space)
    var center = worldView.transform(sphere.center.x, sphere.center.y, sphere.center.z, 1);   

    // adjust sphere radius by scale factor
    var radius = sphere.radius * scale;

    // test center against frustum planes; 
    // if (Ncenter > d + radius) for a given frustum plane, then the sphere is outside 
    //    the plane (on the side of the plane in the direction of the normal), 
    //    and is thus outside of the frustum;
    // if (Ncenter < d - radius) for a given frustum plane, then the sphere is inside 
    //    the plane (on the side of the plane in the opposite direction of the normal);
    // if the sphere is inside all frustum planes, then it is inside the frustum
    // if the sphere is neither inside nor outside the frustum, then it is partially
    // contained by the frustum, and thus intersects the frustum.
    if (dotProduct(left.normal, center)  > (left.dot + radius)   ||
        dotProduct(right.normal, center) > (right.dot + radius)  ||
        dotProduct(top.normal, center)   > (top.dot + radius)    ||
        dotProduct(bottom.normal, center)> (bottom.dot + radius) ||
        // near and far planes (in view-space) always have normal (0, 0, +/-1), 
        // so just use the properly signed center z component for comparison
        (near.normal.z > 0 ? center.z : -center.z) > (near.dot + radius) ||
        (far.normal.z > 0 ? center.z : -center.z)  > (far.dot + radius))
    {
        return eCullResult.Outside;
    }

    if (dotProduct(left.normal, center)  < (left.dot - radius)   &&
        dotProduct(right.normal, center) < (right.dot - radius)  &&
        dotProduct(top.normal, center)   < (top.dot - radius)    &&
        dotProduct(bottom.normal, center)< (bottom.dot - radius) &&
        // near and far planes (in view-space) always have normal (0, 0, +/-1), 
        // so just use the properly signed center z component for comparison
        (near.normal.z > 0 ? center.z : -center.z) < (near.dot - radius) &&
        (far.normal.z > 0 ? center.z : -center.z)  < (far.dot - radius))
    {
        return eCullResult.Inside;
    }
    
    return eCullResult.Intersects;
}

function insideViewVolume(viewVolume, point)
{
    return (pointOnNegativeSideOfPlane(point, viewVolume.left) &&
            pointOnNegativeSideOfPlane(point, viewVolume.right) &&
            pointOnNegativeSideOfPlane(point, viewVolume.top) &&
            pointOnNegativeSideOfPlane(point, viewVolume.bottom) &&
            pointOnNegativeSideOfPlane(point, viewVolume.near) &&
            pointOnNegativeSideOfPlane(point, viewVolume.far));
}


var eRenderContextMethod =
{
    Unknown:                        0,
    ApplyProjectionTransform:       1,
    ApplyViewTransform:             2,
    ApplyWorldTransform:            3,
    Clear:                          4,
    ClearColor:                     5,
    ClearDepth:                     6,
    ClearStencil:                   7,
    CreateProgram:                  8,
    CreateTextureObject:            9,
    CreateVertexBuffer:             10,
    CullFace:                       11,
    Disable:                        12,
    Enable:                         13,
    EnableClipPlane:                14,
    Enabled:                        15,
    EnableLight:                    16,
    EnableTextureStage:             17,
    Finish:                         18,
    GetClipPlane:                   19,
    GetEnabledClipPlanes:           20,
    GetEnabledLights:               21,
    GetGlobalIllumination:          22,
    GetLight:                       23,
    GetMaxLightCount:               24,
    GetMaxTextureStages:            25,
    GetProgram:                     26,
    PerspectiveMatrixLH:            27,
    OrthographicMatrixLH:           28,
    SetBlendColor:                  29,
    SetBlendFactor:                 30,
    SetClipPlane:                   31,
    SetDepthFunc:                   32,
    SetEnabledClipPlanes:           33,
    SetEnabledLights:               34,
    SetFrontMaterial:               35,
    SetGlobalIllumination:          36,
    SetLight:                       37,
    SetShadeModel:                  38,
    SetStencilFunc:                 39,
    SetStencilMask:                 40,
    SetStencilOp:                   41,
    SetTextureBlendFactor:          42,
    SetTextureBlendOp:              43,
    SetTextureColorMask:            44,
    SetViewport:                    45,
    VB_SetPrimitiveType:            46,
    VB_SetVertices:                 47,
    VB_SetNormals:                  48,
    VB_SetColors:                   49,
    VB_SetUVCoords:                 50,
    VB_SetTextureStage:             51,
    VB_Draw:                        52,
    TO_SetImage:                    53,
    TO_SetImageData:                54,
    TO_SetVideo:                    55,
    SetMatrixMode:                  56,
    PushMatrix:                     57,
    PopMatrix:                      58,
    LoadMatrix:                     59,
    LeftMultMatrix:                 60,
    RightMultMatrix:                61,
    UseProgram:                     62,
    SetModelID:                     63
}

function RenderContextMethodDesc(method, params)
{
    this.method = method;
    this.params = params;
}

function DisplayListObj(renderContext)
{
    this.renderContext = renderContext;
    this.displayList = [];
}

DisplayListObj.prototype.record_begin = function()
{
    this.clear();
    this.renderContext.setDisplayList(this);
}

DisplayListObj.prototype.record_end = function()
{
    this.renderContext.setDisplayList(null);
}

DisplayListObj.prototype.play = function()
{
    for (var i = 0; i < this.displayList.length; i++)
    {
        this.invokeMethod(this.displayList[i]);
    }
}

DisplayListObj.prototype.addMethodDesc = function(desc)
{
    this.displayList.push(desc);
}

DisplayListObj.prototype.clear = function()
{
    this.displayList = [];
}

DisplayListObj.prototype.invokeMethod = function(desc)
{
    switch (desc.method)
    {
        case eRenderContextMethod.ApplyProjectionTransform:
            {
                this.renderContext.applyProjectionTransform();
            }
            break;

        case eRenderContextMethod.ApplyViewTransform:
            {
                this.renderContext.applyViewTransform();
            }
            break;
            
        case eRenderContextMethod.ApplyWorldTransform:
            {
                this.renderContext.applyWorldTransform();
            }
            break;
            
        case eRenderContextMethod.Clear:
            {
                return this.renderContext.clear(desc.params[0]);
            }
            break;

        case eRenderContextMethod.ClearColor:
            {
                this.renderContext.clearColor(desc.params[0], desc.params[1], desc.params[2], desc.params[3]);
            }
            break;

        case eRenderContextMethod.ClearDepth:
            {
                this.renderContext.clearDepth(desc.params[0]);
            }
            break;

        case eRenderContextMethod.ClearStencil:
            {
                this.renderContext.clearStencil(desc.params[0]);
            }
            break;

        case eRenderContextMethod.CreateProgram:
            {
                return this.renderContext.createProgram();
            }
            break;
            
        case eRenderContextMethod.CreateTextureObject:
            {
                return this.renderContext.createTextureObject();
            }
            break;
            
        case eRenderContextMethod.CreateVertexBuffer:
            {
                return this.renderContext.createVertexBuffer(desc.params[0]);
            }
            break;

        case eRenderContextMethod.CullFace:
            {
                return this.renderContext.cullFace(desc.params[0]);
            }
            break;
            
        case eRenderContextMethod.Disable:
            {
                this.renderContext.disable(desc.params[0]);
            }
            break;

        case eRenderContextMethod.Enable:
            {
                this.renderContext.enable(desc.params[0]);
            }
            break;

        case eRenderContextMethod.EnableClipPlane:
            {
                this.renderContext.enableClipPlane(desc.params[0], desc.params[1]);
            }
            break;

        case eRenderContextMethod.Enabled:
            {
                return this.renderContext.enabled(desc.params[0]);
            }
            break;

        case eRenderContextMethod.EnableLight:
            {
                this.renderContext.enableLight(desc.params[0], desc.params[1]);
            }
            break;

        case eRenderContextMethod.EnableTextureStage:
            {
                this.renderContext.enableTextureStage(desc.params[0], desc.params[1]);
            }
            break;

        case eRenderContextMethod.Finish:
            {
                this.renderContext.finish();
            }
            break;

        case eRenderContextMethod.GetClipPlane:
            {
                return this.renderContext.getClipPlane(desc.params[0]);
            }
            break;

        case eRenderContextMethod.GetEnabledClipPlanes:
            {
                return this.renderContext.getEnabledClipPlanes();
            }
            break;

        case eRenderContextMethod.GetEnabledLights:
            {
                return this.renderContext.getEnabledLights();
            }
            break;

        case eRenderContextMethod.GetGlobalIllumination:
            {
                return this.renderContext.getGlobalIllumination();
            }
            break;

        case eRenderContextMethod.GetLight:
            {
                return this.renderContext.getLight(desc.params[0]);
            }
            break;

        case eRenderContextMethod.GetMaxLightCount:
            {
                return this.renderContext.getMaxLightCount();
            }
            break;

        case eRenderContextMethod.GetMaxTextureStages:
            {
                return this.renderContext.getMaxTextureStages();
            }
            break;

        case eRenderContextMethod.GetProgram:
            {
                return this.renderContext.getProgram();
            }
            break;
            
        case eRenderContextMethod.PerspectiveMatrixLH:
            {
                this.renderContext.perspectiveMatrixLH(desc.params[0], desc.params[1], desc.params[2],
                        desc.params[3], desc.params[4], desc.params[5]);
            }
            break;

        case eRenderContextMethod.OrthographicMatrixLH:
            {
                this.renderContext.orthographicMatrixLH(desc.params[0], desc.params[1], desc.params[2],
                        desc.params[3], desc.params[4], desc.params[5]);
            }
            break;

        case eRenderContextMethod.SetBlendColor:
            {
                this.renderContext.setBlendColor(desc.params[0], desc.params[1], desc.params[2], desc.params[3]);
            }
            break;

        case eRenderContextMethod.SetBlendFactor:
            {
                this.renderContext.setBlendFactor(desc.params[0], desc.params[1]);
            }
            break;

        case eRenderContextMethod.SetClipPlane:
            {
                this.renderContext.setClipPlane(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetDepthFunc:
            {
                this.renderContext.setDepthFunc(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetEnabledClipPlanes:
            {
                this.renderContext.setEnabledClipPlanes(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetEnabledLights:
            {
                this.renderContext.setEnabledLights(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetFrontMaterial:
            {
                this.renderContext.setFrontMaterial(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetGlobalIllumination:
            {
                this.renderContext.setGlobalIllumination(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetLight:
            {
                this.renderContext.setLight(desc.params[0], desc.params[1]);
            }
            break;

        case eRenderContextMethod.SetModelID:
            {
                this.renderContext.setModelID(desc.params[0]);
            }
            break;
            
        case eRenderContextMethod.SetShadeModel:
            {
                this.renderContext.setShadeModel(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetStencilFunc:
            {
                this.renderContext.setStencilFunc(desc.params[0], desc.params[1], desc.params[2]);
            }
            break;

        case eRenderContextMethod.SetStencilMask:
            {
                this.renderContext.setStencilMask(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetStencilOp:
            {
                this.renderContext.setStencilOp(desc.params[0], desc.params[1], desc.params[2]);
            }
            break;

        case eRenderContextMethod.SetTextureBlendFactor:
            {
                this.renderContext.setTextureBlendFactor(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetTextureBlendOp:
            {
                this.renderContext.setTextureBlendOp(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetTextureColorMask:
            {
                this.renderContext.setTextureColorMask(desc.params[0], desc.params[1], desc.params[2], desc.params[3]);
            }
            break;

        case eRenderContextMethod.SetViewport:
            {
                this.renderContext.setViewport(desc.params[0], desc.params[1], desc.params[2],
                        desc.params[3]);
            }
            break;

        case eRenderContextMethod.VB_SetPrimitiveType:
            {
                desc.params[0].setPrimitiveType(desc.params[1]);
            }
            break;

        case eRenderContextMethod.VB_SetVertices:
            {
                desc.params[0].setVertices(desc.params[1]);
            }
            break;

        case eRenderContextMethod.VB_SetNormals:
            {
                desc.params[0].setNormals(desc.params[1]);
            }
            break;

        case eRenderContextMethod.VB_SetColors:
            {
                desc.params[0].setColors(desc.params[1]);
            }
            break;

        case eRenderContextMethod.VB_SetUVCoords:
            {
                desc.params[0].setUVCoords(desc.params[1], desc.params[2]);
            }
            break;

        case eRenderContextMethod.VB_SetTextureStage:
            {
                desc.params[0].setTextureStage(desc.params[1], desc.params[2], desc.params[3],
                        desc.params[4], desc.params[5], desc.params[6]);
            }
            break;

        case eRenderContextMethod.VB_Draw:
            {
                desc.params[0].draw();
            }
            break;

        case eRenderContextMethod.TO_SetImage:
            {
                desc.params[0].setImage(desc.params[1], desc.params[2], desc.params[3]);
            }
            break;

        case eRenderContextMethod.TO_SetImageData:
            {
                desc.params[0].setImageData(desc.params[1], desc.params[2], desc.params[3],
                        desc.params[4], desc.params[5]);
            }
            break;

        case eRenderContextMethod.TO_SetVideo:
            {
                desc.params[0].setVideo(desc.params[1]);
            }
            break;

        case eRenderContextMethod.SetMatrixMode:
            {
                this.renderContext.setMatrixMode(desc.params[0]);
            }
            break;

        case eRenderContextMethod.PushMatrix:
            {
                this.renderContext.pushMatrix();
            }
            break;

        case eRenderContextMethod.PopMatrix:
            {
                this.renderContext.popMatrix();
            }
            break;

        case eRenderContextMethod.LoadMatrix:
            {
                this.renderContext.loadMatrix(desc.params[0]);
            }
            break;

        case eRenderContextMethod.LeftMultMatrix:
            {
                this.renderContext.leftMultMatrix(desc.params[0]);
            }
            break;

        case eRenderContextMethod.RightMultMatrix:
            {
                this.renderContext.rightMultMatrix(desc.params[0]);
            }
            break;
            
        case eRenderContextMethod.UseProgram:
            {
                this.renderContext.useProgram(desc.params[0]);
            }
            break;
    }
}

function DL_ADD_METHOD_DESC(dlObj, method, params)
{
    if (dlObj)
    {
        dlObj.addMethodDesc(new RenderContextMethodDesc(method, params));
    }
}

/* 
 * enable caps 
 */
var eRenderMode =
{
    AlphaBlend              : 1,
    CullBackFace            : 2,
    DepthTest               : 3,
    DepthBufferWrite        : 4,
    Lighting                : 5,
    NormalizeNormals        : 6,
    Fog                     : 7,
    StencilTest             : 8,
    PolygonOffset_Fill      : 9,
    PolygonOffset_Line      : 10,
    PolygonOffset_Point     : 11
}
 
/*
 * depth func
 */
var eDepthFunc =
{
    Never                   : 1,
    Less                    : 2,
    LessEqual               : 3,
    Equal                   : 4,
    NotEqual                : 5,
    GreaterEqual            : 6,
    Greater                 : 7,
    Always                  : 8 
}

/*
 * stencil func
 */
var eStencilFunc =
{
    Never                   : 1,
    Less                    : 2,
    LessEqual               : 3,
    Equal                   : 4,
    NotEqual                : 5,
    GreaterEqual            : 6,
    Greater                 : 7,
    Always                  : 8 
}

/*
 * stencil op
 */
var eStencilOp = 
{
    Keep                    : 0,
    Replace                 : 1,
    Increment               : 2,
    Decrement               : 3,
    Invert                  : 4,
    Zero                    : 5    
}

/*
 * shade model
 */
var eShadeModel =
{
    Flat                    : 1,
    Gouraud                 : 2
}

var RC_BLEND            = 0x0001;
var RC_CULL_FACE        = 0x0B44;

var RC_FRONT            = 0x0010;
var RC_BACK             = 0x0020;

/*
 * light desc
 */
var LIGHTDESC_POSITION_BIT          = 0x001;
var LIGHTDESC_DIRECTION_BIT         = 0x002;
var LIGHTDESC_AMBIENT_BIT           = 0x004;
var LIGHTDESC_DIFFUSE_BIT           = 0x008;
var LIGHTDESC_SPECULAR_BIT          = 0x010;
var LIGHTDESC_CONSTANT_ATT_BIT      = 0x020;
var LIGHTDESC_LINEAR_ATT_BIT        = 0x040;
var LIGHTDESC_QUADRATIC_ATT_BIT     = 0x080;
var LIGHTDESC_RANGE_BIT             = 0x100;
var LIGHTDESC_OUTER_CONE_DEG_BIT    = 0x200;
var LIGHTDESC_INNER_CONE_DEG_BIT    = 0x400;
var LIGHTDESC_CONE_FALLOFF_BIT      = 0x800;

function LightDesc()
{
    this.type = "";                     // required: "directional", "point", "spot"
    this.validMembersMask = 0;
    this.position = new Vector3D();     // point, spot
    this.direction = new Vector3D();    // directional, spot
    this.ambient = new Color();         // all types
    this.diffuse = new Color();         // all types
    this.specular = new Color();        // all types
    this.constantAttenuation = 0;       // all types
    this.linearAttenuation = 0;         // all types
    this.quadraticAttenuation = 0;      // all types
    this.range = 0;                     // point, spot
    this.outerConeDegrees = 0;          // spot
    this.innerConeDegrees = 0;          // spot
    this.coneFalloff = 0;               // spot
}

/* 
 * material desc 
 */
var MATERIALDESC_AMBIENT_BIT        = 0x001;
var MATERIALDESC_DIFFUSE_BIT        = 0x002;
var MATERIALDESC_SPECULAR_BIT       = 0x004;
var MATERIALDESC_EMISSIVE_BIT       = 0x008;
var MATERIALDESC_GLOSSINESS_BIT     = 0x010;
var MATERIALDESC_ALL_BITS           = 0x01F;

function MaterialDesc()
{
    this.validMembersMask = 0;
    this.ambient = new Color();
    this.diffuse = new Color();
    this.specular = new Color();
    this.emissive = new Color();
    this.glossiness = 0;

    this.copy = function(materialDesc)
    {
        if (materialDesc)
        {
            this.validMembersMask = materialDesc.validMembersMask;
            this.ambient.copy(materialDesc.ambient);
            this.diffuse.copy(materialDesc.diffuse);
            this.specular.copy(materialDesc.specular);
            this.emissive.copy(materialDesc.emissive);
            this.glossiness = materialDesc.glossiness;
        }
    }
}

/*
 * clear mask
 */
var RC_COLOR_BUFFER_BIT             = 0x001;
var RC_DEPTH_BUFFER_BIT             = 0x002;
var RC_STENCIL_BUFFER_BIT           = 0x004;

/*
 * blend factor
 */
var RC_ZERO                         = 0x001;    
var RC_ONE                          = 0x002;
var RC_SRC_COLOR                    = 0x004;
var RC_SRC_ALPHA                    = 0x008;
var RC_ONE_MINUS_SRC_COLOR          = 0x010;
var RC_ONE_MINUS_SRC_ALPHA          = 0x020;
var RC_DEST_COLOR                   = 0x040;
var RC_DEST_ALPHA                   = 0x080;
var RC_ONE_MINUS_DEST_COLOR         = 0x100;
var RC_ONE_MINUS_DEST_ALPHA         = 0x200;

/*
 * blend op
 */
var RC_MODULATE                     = 0x001;
var RC_REPLACE                      = 0x002;
var RC_BLEND                        = 0x004;
var RC_DECAL                        = 0x008;

/*
 * texture unit
 */
var eTextureUnit =
{
    Color0                          : 0,
    Color1                          : 1,
    ShadowMap                       : 2
}

/*
 * texture coordinate source
 */
var eTextureCoordSrc = 
{
    VertexUVs                       : 1,
    ViewSpaceVertexPosition         : 2,
    ViewSpaceReflectionVector       : 3
}
 
/*
 * texture wrap
 */
var RC_REPEAT                      = 0x2901;
var RC_CLAMP_TO_EDGE               = 0x812F;
var RC_MIRRORED_REPEAT             = 0x8370;

/*
 * matrix mode
 */
var RC_WORLD			   = 0x001;
var RC_VIEW                        = 0x002;
var RC_PROJECTION		   = 0x004;
var RC_TEXTURE                     = 0x008;

/*
 * cube map face
 */
var eCubeMapFace =
{
    Positive_X                      : 0,
    Negative_X                      : 1,
    Positive_Y                      : 2,
    Negative_Y                      : 3,
    Positive_Z                      : 4,
    Negative_Z                      : 5
}

function EnabledCaps()
{
    this.alphaBlend = false;
    this.cullBackFace = false;
    this.depthBufferWrite = false;
    this.depthTest = false;
    this.lighting = false;
    this.stencilTest = false;
}
    
/*
 * render context
 */
function RenderContext(canvas, background)
{
    this.valid = false;
    
    this.canvas = canvas;
    this.background = background;
    
    this.projectionMatrixStack = new MatrixStack(new Matrix4x4());
    this.viewMatrixStack = new MatrixStack(new Matrix4x4());
    this.worldMatrixStack = new MatrixStack(new Matrix4x4());
    this.matrixMode = RC_WORLD;
    this.globalIllumination = new Color();
    this.frontMaterial = new MaterialDesc();
    
    this.displayListObj = null;
    
    this.getDisplayList = function()
    {
        return this.displayListObj;    
    }
    
    this.setDisplayList = function(displayListObj)
    {
        this.displayListObj = displayListObj;
    }
    
    this.getFrontMaterial = function()
    {
        var material = new MaterialDesc();
        material.copy(this.frontMaterial); 
        return material;             
    }

    this.setBackgroundImage = function(url, width, height)
    {
        if (this.background)
        {
            this.background.src = url;
            this.background.width = width;
            this.background.height = height;
        }
    }
    
    this.setMatrixMode = function(mode) 
    { 
    	if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetMatrixMode, [mode]);
    	
    	this.matrixMode = mode; 
    }
    
    this.pushMatrix = function()
    {
    	if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.PushMatrix, null);
    	
    	switch (this.matrixMode)
    	{
            case RC_WORLD:
            {
                this.worldMatrixStack.push();
            }
            break;

            case RC_VIEW:
            {
                this.viewMatrixStack.push();
            }
            break;

            case RC_PROJECTION:
            {
                this.projectionMatrixStack.push();
            }
            break;
    	}	
    }
    
    this.popMatrix = function()
    {
    	if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.PopMatrix, null);
    	
    	switch (this.matrixMode)
    	{
            case RC_WORLD:
            {
                this.worldMatrixStack.pop();
            }
            break;

            case RC_VIEW:
            {
                this.viewMatrixStack.pop();
            }
            break;

            case RC_PROJECTION:
            {
                this.projectionMatrixStack.pop();
            }
            break;
    	}
    }
    
    this.loadMatrix = function(matrix)
    {
    	if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.LoadMatrix, [matrix]);
    	
    	switch (this.matrixMode)
    	{
            case RC_WORLD:
            {
                this.worldMatrixStack.loadMatrix(matrix);
            }
            break;

            case RC_VIEW:
            {
                this.viewMatrixStack.loadMatrix(matrix);
            }
            break;

            case RC_PROJECTION:
            {
                this.projectionMatrixStack.loadMatrix(matrix);
            }
            break;
    	}	
    }
    
    this.leftMultMatrix = function(matrix)
    {
    	if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.LeftMultMatrix, [matrix]);
    	
    	switch (this.matrixMode)
    	{
            case RC_WORLD:
            {
                this.worldMatrixStack.leftMultiply(matrix);
            }
            break;

            case RC_VIEW:
            {
                this.viewMatrixStack.leftMultiply(matrix);
            }
            break;

            case RC_PROJECTION:
            {
                this.projectionMatrixStack.leftMultiply(matrix);
            }
            break;
    	}
    }
    
    this.rightMultMatrix = function(matrix)
    {
    	if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.RightMultMatrix, [matrix]);
    	
    	switch (this.matrixMode)
    	{
            case RC_WORLD:
            {
                this.worldMatrixStack.rightMultiply(matrix);
            }
            break;

            case RC_VIEW:
            {
                this.viewMatrixStack.rightMultiply(matrix);
            }
            break;

            case RC_PROJECTION:
            {
                this.projectionMatrixStack.rightMultiply(matrix);
            }
            break;
    	}	
    }
    
    this.setEnabled = function(cap, enabled)
    {
        if (enabled)
        {
            this.enable(cap);    
        }
        else
        {
            this.disable(cap);
        }
    }
}

function newRenderContext(api, canvas, background)
{
    var rc = null;
    
    switch (api)
    {
    case "webgl":
        {
            rc = new webglRC(canvas, background);
            // load default program
            if (rc.valid)
            {
                var program = rc.createProgram(default_vertex_lighting_vs, default_vertex_lighting_fs);
                rc.useProgram(program);
            }
        }
        break;
    }

    // return rc if valid    
    return rc.valid ? rc : null;
}

var RENDERSTATE_TRANSFORM_BIT      = 0x001;
var RENDERSTATE_LIGHTING_BIT       = 0x002;
var RENDERSTATE_MATERIAL_BIT       = 0x004;
var RENDERSTATE_FOG_BIT            = 0x008;
var RENDERSTATE_CLIP_PLANE_BIT     = 0x010;
var RENDERSTATE_ZBUFFER_BIT        = 0x020;
var RENDERSTATE_ALL_BITS           = 0x03F;

function RenderStateRec()
{
    this.projMatrix = new Matrix4x4();
    this.viewMatrix = new Matrix4x4();
    this.worldViewMatrix = new Matrix4x4();
    // TODO: textureMatrices
    this.lightIndices = [];
    this.lightStates = [];
    this.lightMatrices = [];
    this.lightingEnabled = false;
    this.materialDesc = new MaterialDesc();
    // TODO: fogParams
    this.fogEnabled = false;
    this.clipPlaneIndices = [];
    this.clipPlanes = [];
    this.clipPlaneMatrices = [];
    this.zBufferEnabled = false;
    this.zBufferWriteEnabled = false;
}

function RenderState(rc)
{
    this.renderContext = rc;

    this.stateStack = new Stack();
    
    this.push = function(mask)
    {
        var rec = this.getState(mask);
        this.stateStack.push(rec);
    }

    this.pop = function(mask)
    {
        if (this.stateStack.empty()) return;

        var rec = this.stateStack.top();
        this.setState(mask, rec);
        this.stateStack.pop();
    }

    this.getState = function(mask)
    {
        var rec = new RenderStateRec();

        if (mask & RENDERSTATE_TRANSFORM_BIT)
        {
            rec.projMatrix = this.renderContext.projectionMatrixStack.top();
            rec.viewMatrix = this.renderContext.viewMatrixStack.top();
            rec.worldViewMatrix = this.renderContext.worldMatrixStack.top();
        }

        if (mask & RENDERSTATE_LIGHTING_BIT)
        {
            rec.lightIndices = this.renderContext.getEnabledLights();
            for (var i = 0; i < rec.lightIndices.length; i++)
            {
                var light = this.renderContext.getLight(rec.lightIndices[i]);
                rec.lightStates[i] = light.desc;
                rec.lightMatrices[i] = light.matrix;
            }
            rec.lightingEnabled = this.renderContext.enabled(eRenderMode.Lighting);
        }

        if (mask & RENDERSTATE_MATERIAL_BIT)
        {
            rec.materialDesc = this.renderContext.getFrontMaterial();
        }

        if (mask & RENDERSTATE_FOG_BIT)
        {
        }

        if (mask & RENDERSTATE_CLIP_PLANE_BIT)
        {
        }

        if (mask & RENDERSTATE_ZBUFFER_BIT)
        {
            rec.zBufferEnabled = this.renderContext.enabled(eRenderMode.DepthTest);
            rec.zBufferWriteEnabled = this.renderContext.enabled(eRenderMode.DepthBufferWrite);
        }

        return rec;
    }

    this.setState = function(mask, rec)
    {
        if (mask & RENDERSTATE_TRANSFORM_BIT)
        {
            this.renderContext.projectionMatrixStack.loadMatrix(rec.projMatrix);
            this.renderContext.applyProjectionTransform();
            this.renderContext.viewMatrixStack.loadMatrix(rec.viewMatrix);
            this.renderContext.applyViewTransform();
            this.renderContext.worldMatrixStack.loadMatrix(rec.worldViewMatrix);
            this.renderContext.applyWorldTransform();
        }

        if (mask & RENDERSTATE_LIGHTING_BIT)
        {
            // set light state for each set light within this state block
            for (var i = 0; i < rec.lightIndices.length; i++)
            {
                this.renderContext.worldMatrixStack.push(rec.lightMatrices[i]);
                this.renderContext.setLight(rec.lightIndices[i], rec.lightStates[i]);
                this.renderContext.worldMatrixStack.pop();
            }

            // set light state to disabled for lights set outside this state block
            this.renderContext.setEnabledLights(rec.lightIndices);

            // set current lighting enabled
            if (rec.lightingEnabled)
            {
                this.renderContext.enable(eRenderMode.Lighting);
            }
            else
            {
                this.renderContext.disable(eRenderMode.Lighting);
            }
        }

        if (mask & RENDERSTATE_MATERIAL_BIT)
        {
            this.renderContext.setFrontMaterial(rec.materialDesc);
        }

        if (mask & RENDERSTATE_FOG_BIT)
        {
        }

        if (mask & RENDERSTATE_CLIP_PLANE_BIT)
        {
        }

        if (mask & RENDERSTATE_ZBUFFER_BIT)
        {
            if (rec.zBufferEnabled)
            {
                this.renderContext.enable(eRenderMode.DepthTest);
            }
            else
            {
                this.renderContext.disable(eRenderMode.depthTest);
            }

            if (rec.zBufferWriteEnabled)
            {
                this.renderContext.enable(eRenderMode.DepthBufferWrite);
            }
            else
            {
                this.renderContext.disable(eRenderMode.DepthBufferWrite);
            }
        }
    }
}
var RC_POINTS                       = 0x0000;
var RC_LINES                        = 0x0001;
var RC_LINE_LOOP                    = 0x0002;
var RC_LINE_STRIP                   = 0x0003;
var RC_TRIANGLES                    = 0x0004;
var RC_TRIANGLE_STRIP               = 0x0005;
var RC_TRIANGLE_FAN                 = 0x0006;
    
function VertexBuffer()
{
    this.vertices = new Array();
    this.normals = new Array();
    this.colors = new Array();
    this.vertexCount = 0;
    this.numVerticesPerPrimitive = 0;
}
function TextureObject()
{
}
//Copyright (c) 2009 The Chromium Authors. All rights reserved.
//Use of this source code is governed by a BSD-style license that can be
//found in the LICENSE file.

// Various functions for helping debug WebGL apps.

WebGLDebugUtils = function() {

/**
 * Wrapped logging function.
 * @param {string} msg Message to log.
 */
var log = function(msg) {
  if (window.console && window.console.log) {
    window.console.log(msg);
  }
};

/**
 * Which arguements are enums.
 * @type {!Object.<number, string>}
 */
var glValidEnumContexts = {

  // Generic setters and getters

  'enable': { 0:true },
  'disable': { 0:true },
  'getParameter': { 0:true },

  // Rendering

  'drawArrays': { 0:true },
  'drawElements': { 0:true, 2:true },

  // Shaders

  'createShader': { 0:true },
  'getShaderParameter': { 1:true },
  'getProgramParameter': { 1:true },

  // Vertex attributes

  'getVertexAttrib': { 1:true },
  'vertexAttribPointer': { 2:true },

  // Textures

  'bindTexture': { 0:true },
  'activeTexture': { 0:true },
  'getTexParameter': { 0:true, 1:true },
  'texParameterf': { 0:true, 1:true },
  'texParameteri': { 0:true, 1:true, 2:true },
  'texImage2D': { 0:true, 2:true, 6:true, 7:true },
  'texSubImage2D': { 0:true, 6:true, 7:true },
  'copyTexImage2D': { 0:true, 2:true },
  'copyTexSubImage2D': { 0:true },
  'generateMipmap': { 0:true },

  // Buffer objects

  'bindBuffer': { 0:true },
  'bufferData': { 0:true, 2:true },
  'bufferSubData': { 0:true },
  'getBufferParameter': { 0:true, 1:true },

  // Renderbuffers and framebuffers

  'pixelStorei': { 0:true, 1:true },
  'readPixels': { 4:true, 5:true },
  'bindRenderbuffer': { 0:true },
  'bindFramebuffer': { 0:true },
  'checkFramebufferStatus': { 0:true },
  'framebufferRenderbuffer': { 0:true, 1:true, 2:true },
  'framebufferTexture2D': { 0:true, 1:true, 2:true },
  'getFramebufferAttachmentParameter': { 0:true, 1:true, 2:true },
  'getRenderbufferParameter': { 0:true, 1:true },
  'renderbufferStorage': { 0:true, 1:true },

  // Frame buffer operations (clear, blend, depth test, stencil)

  'clear': { 0:true },
  'depthFunc': { 0:true },
  'blendFunc': { 0:true, 1:true },
  'blendFuncSeparate': { 0:true, 1:true, 2:true, 3:true },
  'blendEquation': { 0:true },
  'blendEquationSeparate': { 0:true, 1:true },
  'stencilFunc': { 0:true },
  'stencilFuncSeparate': { 0:true, 1:true },
  'stencilMaskSeparate': { 0:true },
  'stencilOp': { 0:true, 1:true, 2:true },
  'stencilOpSeparate': { 0:true, 1:true, 2:true, 3:true },

  // Culling

  'cullFace': { 0:true },
  'frontFace': { 0:true },
};

/**
 * Map of numbers to names.
 * @type {Object}
 */
var glEnums = null;

/**
 * Initializes this module. Safe to call more than once.
 * @param {!WebGLRenderingContext} ctx A WebGL context. If
 *    you have more than one context it doesn't matter which one
 *    you pass in, it is only used to pull out constants.
 */
function init(ctx) {
  if (glEnums == null) {
    glEnums = { };
    for (var propertyName in ctx) {
      if (typeof ctx[propertyName] == 'number') {
        glEnums[ctx[propertyName]] = propertyName;
      }
    }
  }
}

/**
 * Checks the utils have been initialized.
 */
function checkInit() {
  if (glEnums == null) {
    throw 'WebGLDebugUtils.init(ctx) not called';
  }
}

/**
 * Returns true or false if value matches any WebGL enum
 * @param {*} value Value to check if it might be an enum.
 * @return {boolean} True if value matches one of the WebGL defined enums
 */
function mightBeEnum(value) {
  checkInit();
  return (glEnums[value] !== undefined);
}

/**
 * Gets an string version of an WebGL enum.
 *
 * Example:
 *   var str = WebGLDebugUtil.glEnumToString(ctx.getError());
 *
 * @param {number} value Value to return an enum for
 * @return {string} The string version of the enum.
 */
function glEnumToString(value) {
  checkInit();
  var name = glEnums[value];
  return (name !== undefined) ? name :
      ("*UNKNOWN WebGL ENUM");// (0x" + value.toString(16) + ")");
}

/**
 * Returns the string version of a WebGL argument.
 * Attempts to convert enum arguments to strings.
 * @param {string} functionName the name of the WebGL function.
 * @param {number} argumentIndx the index of the argument.
 * @param {*} value The value of the argument.
 * @return {string} The value as a string.
 */ 
function glFunctionArgToString(functionName, argumentIndex, value) {
  var funcInfo = glValidEnumContexts[functionName];
  if (funcInfo !== undefined) {
    if (funcInfo[argumentIndex]) {
      return glEnumToString(value);
    }
  }
  return value.toString();
}

/**
 * Given a WebGL context returns a wrapped context that calls
 * gl.getError after every command and calls a function if the
 * result is not gl.NO_ERROR.
 *
 * @param {!WebGLRenderingContext} ctx The webgl context to
 *        wrap.
 * @param {!function(err, funcName, args): void} opt_onErrorFunc
 *        The function to call when gl.getError returns an
 *        error. If not specified the default function calls
 *        console.log with a message.
 */
function makeDebugContext(ctx, opt_onErrorFunc) {
  init(ctx);
  opt_onErrorFunc = opt_onErrorFunc || function(err, functionName, args) {
        // apparently we can't do args.join(",");
        var argStr = "";
        for (var ii = 0; ii < args.length; ++ii) {
          argStr += ((ii == 0) ? '' : ', ') + 
              glFunctionArgToString(functionName, ii, args[ii]);
        }
        log("WebGL error "+ glEnumToString(err) + " in "+ functionName +
            "(" + argStr + ")");
      };

  // Holds booleans for each GL error so after we get the error ourselves
  // we can still return it to the client app.
  var glErrorShadow = { };

  // Makes a function that calls a WebGL function and then calls getError.
  function makeErrorWrapper(ctx, functionName) {
    return function() {
      var result = ctx[functionName].apply(ctx, arguments);
      var err = ctx.getError();
      if (err != 0) {
        glErrorShadow[err] = true;
        opt_onErrorFunc(err, functionName, arguments);
      }
      return result;
    };
  }

  // Make a an object that has a copy of every property of the WebGL context
  // but wraps all functions.
  var wrapper = {};
  for (var propertyName in ctx) {
    if (typeof ctx[propertyName] == 'function') {
      wrapper[propertyName] = makeErrorWrapper(ctx, propertyName);
     } else {
       wrapper[propertyName] = ctx[propertyName];
     }
  }

  // Override the getError function with one that returns our saved results.
  wrapper.getError = function() {
    for (var err in glErrorShadow) {
      if (glErrorShadow[err]) {
        glErrorShadow[err] = false;
        return err;
      }
    }
    return ctx.NO_ERROR;
  };

  return wrapper;
}

return {
  /**
   * Initializes this module. Safe to call more than once.
   * @param {!WebGLRenderingContext} ctx A WebGL context. If
   *    you have more than one context it doesn't matter which one
   *    you pass in, it is only used to pull out constants.
   */
  'init': init,

  /**
   * Returns true or false if value matches any WebGL enum
   * @param {*} value Value to check if it might be an enum.
   * @return {boolean} True if value matches one of the WebGL defined enums
   */
  'mightBeEnum': mightBeEnum,

  /**
   * Gets an string version of an WebGL enum.
   *
   * Example:
   *   WebGLDebugUtil.init(ctx);
   *   var str = WebGLDebugUtil.glEnumToString(ctx.getError());
   *
   * @param {number} value Value to return an enum for
   * @return {string} The string version of the enum.
   */
  'glEnumToString': glEnumToString,

  /**
   * Converts the argument of a WebGL function to a string.
   * Attempts to convert enum arguments to strings.
   *
   * Example:
   *   WebGLDebugUtil.init(ctx);
   *   var str = WebGLDebugUtil.glFunctionArgToString('bindTexture', 0, gl.TEXTURE_2D);
   *   
   * would return 'TEXTURE_2D'
   *
   * @param {string} functionName the name of the WebGL function.
   * @param {number} argumentIndx the index of the argument.
   * @param {*} value The value of the argument.
   * @return {string} The value as a string.
   */
  'glFunctionArgToString': glFunctionArgToString,

  /**
   * Given a WebGL context returns a wrapped context that calls
   * gl.getError after every command and calls a function if the
   * result is not NO_ERROR.
   *
   * You can supply your own function if you want. For example, if you'd like
   * an exception thrown on any GL error you could do this
   *
   *    function throwOnGLError(err, funcName, args) {
   *      throw WebGLDebugUtils.glEnumToString(err) + " was caused by call to" +
   *            funcName;
   *    };
   *
   *    ctx = WebGLDebugUtils.makeDebugContext(
   *        canvas.getContext("webgl"), throwOnGLError);
   *
   * @param {!WebGLRenderingContext} ctx The webgl context to wrap.
   * @param {!function(err, funcName, args): void} opt_onErrorFunc The function
   *     to call when gl.getError returns an error. If not specified the default
   *     function calls console.log with a message.
   */
  'makeDebugContext': makeDebugContext
};

}();


(function() {
  var checkColorBuffer, checkFloatLinear, checkSupport, checkTexture, createSourceCanvas, getExtension, getSupportedExtensions, name, shimExtensions, shimLookup, unshimExtensions, unshimLookup, _i, _len,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  createSourceCanvas = function() {
    var canvas, ctx, imageData;
    canvas = document.createElement('canvas');
    canvas.width = 2;
    canvas.height = 2;
    ctx = canvas.getContext('2d');
    imageData = ctx.getImageData(0, 0, 2, 2);
    imageData.data.set(new Uint8ClampedArray([0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 255, 255, 255, 255]));
    ctx.putImageData(imageData, 0, 0);
    return canvas;
  };

  createSourceCanvas();

  checkFloatLinear = function(gl, sourceType) {
    var buffer, cleanup, fragmentShader, framebuffer, positionLoc, program, readBuffer, result, source, sourceCanvas, sourceLoc, target, vertexShader, vertices;
    program = gl.createProgram();
    vertexShader = gl.createShader(gl.VERTEX_SHADER);
    gl.attachShader(program, vertexShader);
    gl.shaderSource(vertexShader, 'attribute vec2 position;\nvoid main(){\n    gl_Position = vec4(position, 0.0, 1.0);\n}');
    gl.compileShader(vertexShader);
    if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {
      throw gl.getShaderInfoLog(vertexShader);
    }
    fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
    gl.attachShader(program, fragmentShader);
    gl.shaderSource(fragmentShader, 'uniform sampler2D source;\nvoid main(){\n    gl_FragColor = texture2D(source, vec2(1.0, 1.0));\n}');
    gl.compileShader(fragmentShader);
    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {
      throw gl.getShaderInfoLog(fragmentShader);
    }
    gl.linkProgram(program);
    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
      throw gl.getProgramInfoLog(program);
    }
    gl.useProgram(program);
    cleanup = function() {
      gl.deleteShader(fragmentShader);
      gl.deleteShader(vertexShader);
      gl.deleteProgram(program);
      gl.deleteBuffer(buffer);
      gl.deleteTexture(source);
      gl.deleteTexture(target);
      gl.deleteFramebuffer(framebuffer);
      gl.bindBuffer(gl.ARRAY_BUFFER, null);
      gl.useProgram(null);
      gl.bindTexture(gl.TEXTURE_2D, null);
      return gl.bindFramebuffer(gl.FRAMEBUFFER, null);
    };
    target = gl.createTexture();
    gl.bindTexture(gl.TEXTURE_2D, target);
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 2, 2, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
    framebuffer = gl.createFramebuffer();
    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);
    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, target, 0);
    sourceCanvas = createSourceCanvas();
    source = gl.createTexture();
    gl.bindTexture(gl.TEXTURE_2D, source);
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, sourceType, sourceCanvas);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
    vertices = new Float32Array([1, 1, -1, 1, -1, -1, 1, 1, -1, -1, 1, -1]);
    buffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
    positionLoc = gl.getAttribLocation(program, 'position');
    sourceLoc = gl.getUniformLocation(program, 'source');
    gl.enableVertexAttribArray(positionLoc);
    gl.vertexAttribPointer(positionLoc, 2, gl.FLOAT, false, 0, 0);
    gl.uniform1i(sourceLoc, 0);
    gl.drawArrays(gl.TRIANGLES, 0, 6);
    readBuffer = new Uint8Array(4 * 4);
    gl.readPixels(0, 0, 2, 2, gl.RGBA, gl.UNSIGNED_BYTE, readBuffer);
    result = Math.abs(readBuffer[0] - 127) < 10;
    cleanup();
    return result;
  };

  checkTexture = function(gl, targetType) {
    var target;
    target = gl.createTexture();
    gl.bindTexture(gl.TEXTURE_2D, target);
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 2, 2, 0, gl.RGBA, targetType, null);
    if (gl.getError() === 0) {
      gl.deleteTexture(target);
      return true;
    } else {
      gl.deleteTexture(target);
      return false;
    }
  };

  checkColorBuffer = function(gl, targetType) {
    var check, framebuffer, target;
    target = gl.createTexture();
    gl.bindTexture(gl.TEXTURE_2D, target);
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 2, 2, 0, gl.RGBA, targetType, null);
    framebuffer = gl.createFramebuffer();
    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);
    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, target, 0);
    check = gl.checkFramebufferStatus(gl.FRAMEBUFFER);
    gl.deleteTexture(target);
    gl.deleteFramebuffer(framebuffer);
    gl.bindTexture(gl.TEXTURE_2D, null);
    gl.bindFramebuffer(gl.FRAMEBUFFER, null);
    if (check === gl.FRAMEBUFFER_COMPLETE) {
      return true;
    } else {
      return false;
    }
  };

  shimExtensions = [];

  shimLookup = {};

  unshimExtensions = [];

  checkSupport = function() {
    var canvas, extobj, gl, halfFloatExt, halfFloatTexturing, singleFloatExt, singleFloatTexturing;
    canvas = document.createElement('canvas');
    gl = null;
    try {
      gl = canvas.getContext('experimental-webgl');
      if (gl === null) {
        gl = canvas.getContext('webgl');
      }
    } catch (_error) {}
    if (gl != null) {
      singleFloatExt = gl.getExtension('OES_texture_float');
      if (singleFloatExt === null) {
        if (checkTexture(gl, gl.FLOAT)) {
          singleFloatTexturing = true;
          shimExtensions.push('OES_texture_float');
          shimLookup.OES_texture_float = {
            shim: true
          };
        } else {
          singleFloatTexturing = false;
          unshimExtensions.push('OES_texture_float');
        }
      } else {
        if (checkTexture(gl, gl.FLOAT)) {
          singleFloatTexturing = true;
          shimExtensions.push('OES_texture_float');
        } else {
          singleFloatTexturing = false;
          unshimExtensions.push('OES_texture_float');
        }
      }
      if (singleFloatTexturing) {
        extobj = gl.getExtension('WEBGL_color_buffer_float');
        if (extobj === null) {
          if (checkColorBuffer(gl, gl.FLOAT)) {
            shimExtensions.push('WEBGL_color_buffer_float');
            shimLookup.WEBGL_color_buffer_float = {
              shim: true,
              RGBA32F_EXT: 0x8814,
              RGB32F_EXT: 0x8815,
              FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT: 0x8211,
              UNSIGNED_NORMALIZED_EXT: 0x8C17
            };
          } else {
            unshimExtensions.push('WEBGL_color_buffer_float');
          }
        } else {
          if (checkColorBuffer(gl, gl.FLOAT)) {
            shimExtensions.push('WEBGL_color_buffer_float');
          } else {
            unshimExtensions.push('WEBGL_color_buffer_float');
          }
        }
        extobj = gl.getExtension('OES_texture_float_linear');
        if (extobj === null) {
          if (checkFloatLinear(gl, gl.FLOAT)) {
            shimExtensions.push('OES_texture_float_linear');
            shimLookup.OES_texture_float_linear = {
              shim: true
            };
          } else {
            unshimExtensions.push('OES_texture_float_linear');
          }
        } else {
          if (checkFloatLinear(gl, gl.FLOAT)) {
            shimExtensions.push('OES_texture_float_linear');
          } else {
            unshimExtensions.push('OES_texture_float_linear');
          }
        }
      }
      halfFloatExt = gl.getExtension('OES_texture_half_float');
      if (halfFloatExt === null) {
        if (checkTexture(gl, 0x8D61)) {
          halfFloatTexturing = true;
          shimExtensions.push('OES_texture_half_float');
          halfFloatExt = shimLookup.OES_texture_half_float = {
            HALF_FLOAT_OES: 0x8D61,
            shim: true
          };
        } else {
          halfFloatTexturing = false;
          unshimExtensions.push('OES_texture_half_float');
        }
      } else {
        if (checkTexture(gl, halfFloatExt.HALF_FLOAT_OES)) {
          halfFloatTexturing = true;
          shimExtensions.push('OES_texture_half_float');
        } else {
          halfFloatTexturing = false;
          unshimExtensions.push('OES_texture_half_float');
        }
      }
      if (halfFloatTexturing) {
        extobj = gl.getExtension('EXT_color_buffer_half_float');
        if (extobj === null) {
          if (checkColorBuffer(gl, halfFloatExt.HALF_FLOAT_OES)) {
            shimExtensions.push('EXT_color_buffer_half_float');
            shimLookup.EXT_color_buffer_half_float = {
              shim: true,
              RGBA16F_EXT: 0x881A,
              RGB16F_EXT: 0x881B,
              FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT: 0x8211,
              UNSIGNED_NORMALIZED_EXT: 0x8C17
            };
          } else {
            unshimExtensions.push('EXT_color_buffer_half_float');
          }
        } else {
          if (checkColorBuffer(gl, halfFloatExt.HALF_FLOAT_OES)) {
            shimExtensions.push('EXT_color_buffer_half_float');
          } else {
            unshimExtensions.push('EXT_color_buffer_half_float');
          }
        }
        extobj = gl.getExtension('OES_texture_half_float_linear');
        if (extobj === null) {
          if (checkFloatLinear(gl, halfFloatExt.HALF_FLOAT_OES)) {
            shimExtensions.push('OES_texture_half_float_linear');
            return shimLookup.OES_texture_half_float_linear = {
              shim: true
            };
          } else {
            return unshimExtensions.push('OES_texture_half_float_linear');
          }
        } else {
          if (checkFloatLinear(gl, halfFloatExt.HALF_FLOAT_OES)) {
            return shimExtensions.push('OES_texture_half_float_linear');
          } else {
            return unshimExtensions.push('OES_texture_half_float_linear');
          }
        }
      }
    }
  };

  if (window.WebGLRenderingContext != null) {
    checkSupport();
    unshimLookup = {};
    for (_i = 0, _len = unshimExtensions.length; _i < _len; _i++) {
      name = unshimExtensions[_i];
      unshimLookup[name] = true;
    }
    getExtension = WebGLRenderingContext.prototype.getExtension;
    WebGLRenderingContext.prototype.getExtension = function(name) {
      var extobj;
      extobj = shimLookup[name];
      if (extobj === void 0) {
        if (unshimLookup[name]) {
          return null;
        } else {
          return getExtension.call(this, name);
        }
      } else {
        return extobj;
      }
    };
    getSupportedExtensions = WebGLRenderingContext.prototype.getSupportedExtensions;
    WebGLRenderingContext.prototype.getSupportedExtensions = function() {
      var extension, result, supported, _j, _k, _len1, _len2;
      supported = getSupportedExtensions.call(this);
      result = [];
      for (_j = 0, _len1 = supported.length; _j < _len1; _j++) {
        extension = supported[_j];
        if (unshimLookup[extension] === void 0) {
          result.push(extension);
        }
      }
      for (_k = 0, _len2 = shimExtensions.length; _k < _len2; _k++) {
        extension = shimExtensions[_k];
        if (__indexOf.call(result, extension) < 0) {
          result.push(extension);
        }
      }
      return result;
    };
    WebGLRenderingContext.prototype.getFloatExtension = function(spec) {
      var candidate, candidates, half, halfFramebuffer, halfLinear, halfTexture, i, importance, preference, result, single, singleFramebuffer, singleLinear, singleTexture, use, _j, _k, _l, _len1, _len2, _len3, _len4, _m, _ref, _ref1, _ref2, _ref3, _ref4, _ref5;
      if ((_ref = spec.prefer) == null) {
        spec.prefer = ['half'];
      }
      if ((_ref1 = spec.require) == null) {
        spec.require = [];
      }
      if ((_ref2 = spec.throws) == null) {
        spec.throws = true;
      }
      singleTexture = this.getExtension('OES_texture_float');
      halfTexture = this.getExtension('OES_texture_half_float');
      singleFramebuffer = this.getExtension('WEBGL_color_buffer_float');
      halfFramebuffer = this.getExtension('EXT_color_buffer_half_float');
      singleLinear = this.getExtension('OES_texture_float_linear');
      halfLinear = this.getExtension('OES_texture_half_float_linear');
      single = {
        texture: singleTexture !== null,
        filterable: singleLinear !== null,
        renderable: singleFramebuffer !== null,
        score: 0,
        precision: 'single',
        half: false,
        single: true,
        type: this.FLOAT
      };
      half = {
        texture: halfTexture !== null,
        filterable: halfLinear !== null,
        renderable: halfFramebuffer !== null,
        score: 0,
        precision: 'half',
        half: true,
        single: false,
        type: (_ref3 = halfTexture != null ? halfTexture.HALF_FLOAT_OES : void 0) != null ? _ref3 : null
      };
      candidates = [];
      if (single.texture) {
        candidates.push(single);
      }
      if (half.texture) {
        candidates.push(half);
      }
      result = [];
      for (_j = 0, _len1 = candidates.length; _j < _len1; _j++) {
        candidate = candidates[_j];
        use = true;
        _ref4 = spec.require;
        for (_k = 0, _len2 = _ref4.length; _k < _len2; _k++) {
          name = _ref4[_k];
          if (candidate[name] === false) {
            use = false;
          }
        }
        if (use) {
          result.push(candidate);
        }
      }
      for (_l = 0, _len3 = result.length; _l < _len3; _l++) {
        candidate = result[_l];
        _ref5 = spec.prefer;
        for (i = _m = 0, _len4 = _ref5.length; _m < _len4; i = ++_m) {
          preference = _ref5[i];
          importance = Math.pow(2, spec.prefer.length - i - 1);
          if (candidate[preference]) {
            candidate.score += importance;
          }
        }
      }
      result.sort(function(a, b) {
        if (a.score === b.score) {
          return 0;
        } else if (a.score < b.score) {
          return 1;
        } else if (a.score > b.score) {
          return -1;
        }
      });
      if (result.length === 0) {
        if (spec.throws) {
          throw 'No floating point texture support that is ' + spec.require.join(', ');
        } else {
          return null;
        }
      } else {
        result = result[0];
        return {
          filterable: result.filterable,
          renderable: result.renderable,
          type: result.type,
          precision: result.precision
        };
      }
    };
  }

}).call(this);

function webglProgram(rc, gl, source_vs, source_fs)
{
    var rc = rc;
    var gl = gl;

    // create vertex shader
    var vs = gl.createShader(gl.VERTEX_SHADER);
    if (vs)
    {
        gl.shaderSource(vs, source_vs);
        gl.compileShader(vs);

        if (!gl.getShaderParameter(vs, gl.COMPILE_STATUS))
        {
            alert(gl.getShaderInfoLog(vs));
            return;
        }
    }

    // create fragment shader
    var fs = gl.createShader(gl.FRAGMENT_SHADER);
    if (fs)
    {
        gl.shaderSource(fs, source_fs);
        gl.compileShader(fs);
        if (!gl.getShaderParameter(fs, gl.COMPILE_STATUS))
        {
            alert(gl.getShaderInfoLog(fs));
            return;
        }
    }

    // create program
    var program = gl.createProgram();
    if (!program)
        return;

    gl.attachShader(program, vs);
    gl.attachShader(program, fs);
    gl.linkProgram(program);

    if (!gl.getProgramParameter(program, gl.LINK_STATUS))
    {
        alert(gl.getProgramInfoLog(program));
        return;
    }
    
    gl.useProgram(program);

    // get attributes
    var _attributeCount = 0;
    this.vertexPositionAttribute = gl.getAttribLocation(program, "aVertexPosition");
    if (this.vertexPositionAttribute >= 0) _attributeCount++;
    this.vertexNormalAttribute = gl.getAttribLocation(program, "aVertexNormal");
    if (this.vertexNormalAttribute >= 0) _attributeCount++;
    this.vertexColorAttribute = gl.getAttribLocation(program, "aVertexColor");
    if (this.vertexColorAttribute >= 0) _attributeCount++;
    this.textureCoordAttribute = new Array(gl_MaxTextureStages);
    for (var i = 0; i < gl_MaxTextureStages; i++)
    {
        this.textureCoordAttribute[i] = gl.getAttribLocation(program, "aTextureCoord" + i);
        if (this.textureCoordAttribute[i] >= 0) _attributeCount++;
    }

    // get uniforms

    // matrices
    this.projectionMatrix = gl.getUniformLocation(program, "uProjectionMatrix");
    this.viewMatrix = gl.getUniformLocation(program, "uViewMatrix");
    this.worldMatrix = gl.getUniformLocation(program, "uWorldMatrix");
    this.normalMatrix = gl.getUniformLocation(program, "uNormalMatrix");

    // lights
    this.globalAmbientLight = gl.getUniformLocation(program, "uGlobalAmbientLight");
    this.lightSource = new Array(gl_MaxLights);
    for (var i = 0; i < gl_MaxLights; i++)
    {
        this.lightSource[i] = new gl_LightSourceParameters();

        this.lightSource[i].enabled = gl.getUniformLocation(program, "uLightSource[" + i + "].enabled");
        this.lightSource[i].ambient = gl.getUniformLocation(program, "uLightSource[" + i + "].ambient");
        this.lightSource[i].diffuse = gl.getUniformLocation(program, "uLightSource[" + i + "].diffuse");
        this.lightSource[i].specular = gl.getUniformLocation(program, "uLightSource[" + i + "].specular");
        this.lightSource[i].position = gl.getUniformLocation(program, "uLightSource[" + i + "].position");
        this.lightSource[i].spotDirection = gl.getUniformLocation(program, "uLightSource[" + i + "].spotDirection");
        this.lightSource[i].spotExponent = gl.getUniformLocation(program, "uLightSource[" + i + "].spotExponent");
        this.lightSource[i].spotCutoff = gl.getUniformLocation(program, "uLightSource[" + i + "].spotCutoff");
        this.lightSource[i].constantAttenuation = gl.getUniformLocation(program, "uLightSource[" + i + "].constantAttenuation");
        this.lightSource[i].linearAttenuation = gl.getUniformLocation(program, "uLightSource[" + i + "].linearAttenuation");
        this.lightSource[i].quadraticAttenuation = gl.getUniformLocation(program, "uLightSource[" + i + "].quadraticAttenuation");
        this.lightSource[i].range = gl.getUniformLocation(program, "uLightSource[" + i + "].range");

        // set initially disabled
        gl.uniform1i(this.lightSource[i].enabled, 0);
    }

    // materials
    this.frontMaterial = new gl_MaterialParameters();
    this.frontMaterial.ambient = gl.getUniformLocation(program, "uFrontMaterial.ambient");
    this.frontMaterial.diffuse = gl.getUniformLocation(program, "uFrontMaterial.diffuse");
    this.frontMaterial.specular = gl.getUniformLocation(program, "uFrontMaterial.specular");
    this.frontMaterial.emissive = gl.getUniformLocation(program, "uFrontMaterial.emissive");
    this.frontMaterial.shininess = gl.getUniformLocation(program, "uFrontMaterial.shininess");

    // textures
    this.textureSamplerColor = new Array(gl_MaxTextureStages);
    this.textureSamplerAlpha = new Array(gl_MaxTextureStages);
    this.textureStageEnabled = new Array(gl_MaxTextureStages)
    for (var i = 0; i < gl_MaxTextureStages; i++)
    {
        this.textureSamplerColor[i] = gl.getUniformLocation(program, "uTextureSamplerColor[" + i + "]");
        this.textureSamplerAlpha[i] = gl.getUniformLocation(program, "uTextureSamplerAlpha[" + i + "]");
        this.textureStageEnabled[i] = gl.getUniformLocation(program, "uTextureStageEnabled[" + i + "]");
    }
    this.textureSamplerShadowMap = gl.getUniformLocation(program, "uTextureSamplerShadowMap");
    this.textureBlendOp = gl.getUniformLocation(program, "uTextureBlendOp");
    this.textureColorMask = gl.getUniformLocation(program, "uTextureColorMask");

    // clip planes
    this.clipPlane = new Array(gl_MaxClipPlanes);
    this.clipPlaneEnabled = new Array(gl_MaxClipPlanes);
    for (var i = 0; i < gl_MaxClipPlanes; i++)
    {
        this.clipPlane[i] = gl.getUniformLocation(program, "uClipPlane[" + i + "]");
        this.clipPlaneEnabled[i] = gl.getUniformLocation(program, "uClipPlaneEnabled[" + i + "]");
    }

    // enabled
    this.lightingEnabled = gl.getUniformLocation(program, "uLightingEnabled");
    this.texturesEnabled = gl.getUniformLocation(program, "uTexturesEnabled");

    // misc
    this.shadowCasterWorldPosition = gl.getUniformLocation(program, "uShadowCasterWorldPosition");
    this.modelID = gl.getUniformLocation(program, "uModelID");
    
    // set initially enabled/disabled
    gl.uniform1i(this.lightingEnabled, 1);
    gl.uniform1i(this.texturesEnabled, 1);
    gl.uniform1i(this.textureStageEnabled[0], 0);
    gl.uniform1i(this.textureStageEnabled[1], 0);
    
    this.getGLProgram = function()
    {
        return program;
    }
    
    this.enableVertexAttribArrays = function()
    {
        for (var i = 0; i < _attributeCount; i++)
        {
            gl.enableVertexAttribArray(i);
        }
    }
    
    this.disableVertexAttribArrays = function()
    {
        for (var i = 0; i < _attributeCount; i++)
        {
            gl.disableVertexAttribArray(i);
        }
    }
    
    this.vertexAttribPointer = function(index, size, type, normalized, stride, offset)
    {
        if (index >= 0)
        {
            gl.vertexAttribPointer(index, size, type, normalized, stride, offset);
        }
    }
}





function gl_LightSourceParameters()
{
    var enabled;
    var ambient;
    var diffuse;
    var specular;
    var position;
    var spotDirection;
    var spotExponent;
    var spotCutoff;
    var constantAttenuation;
    var linearAttenuation;
    var quadraticAttenuation;
}

function gl_MaterialParameters()
{
    var ambient;
    var diffuse;
    var specular;
    var emissive;
    var shininess; 
}

var gl_MaxLights = 4;
var gl_MaxTextureStages = 2;
var gl_MaxClipPlanes = 4;

webglRC.prototype = new RenderContext();
webglRC.prototype.constructor = webglRC;

function webglRC(canvas, background)
{
    //
    // initialization
    //
    
    RenderContext.call(this, canvas, background);
    
    var _gl = getWebGLContext(canvas, false /*set to true for debug context*/);
    if (!_gl) return;

    _gl.clearColor(0, 0, 0, background ? 0 : 1);
    _gl.clearDepth(1);
    _gl.clearStencil(0);
    _gl.enable(_gl.DEPTH_TEST);
    _gl.depthFunc(_gl.LEQUAL);
    _gl.disable(_gl.STENCIL_TEST);
    _gl.frontFace(_gl.CW);
    _gl.viewport(0, 0, canvas.width, canvas.height);
    _gl.enable(_gl.CULL_FACE);
    _gl.cullFace(_gl.BACK);
    _gl.enable(_gl.BLEND);
    _gl.blendFunc(_gl.SRC_ALPHA, _gl.ONE_MINUS_SRC_ALPHA);
   
    // extensions
    var OES_standard_derivatives_extension = _gl.getExtension('OES_standard_derivatives');
    var FRAGMENT_SHADER_DERIVATIVE_HINT_OES = 0x8B8B;
    _gl.hint(FRAGMENT_SHADER_DERIVATIVE_HINT_OES, _gl.NICEST);
    
    // set valid flag
    this.valid = true;

    // private members
    var _program = null;
    var _vLights = [];
    var _vLightMatrices = [];
    var _vLightEnabledStates = [];
    var _vClipPlanes = [];
    var _vClipPlaneMatrices = [];
    var _vClipPlaneEnabledStates = [];
    var _viewport = new Viewport(0, 0, canvas.width, canvas.height);
    var _clearColor = new Color(0, 0, 0, background ? 0 : 1);
    var _enabledCaps = new EnabledCaps();
    
    //
    // methods
    //
    
    this.applyProjectionTransform = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.ApplyProjectionTransform, null);
        
        _gl.uniformMatrix4fv(_program.projectionMatrix, false, new Float32Array(this.projectionMatrixStack.top().flatten()));
    }
    
    this.applyViewTransform = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.ApplyViewTransform, null);
        
        _gl.uniformMatrix4fv(_program.viewMatrix, false, new Float32Array(this.viewMatrixStack.top().flatten()));
    }
    
    this.applyWorldTransform = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.ApplyWorldTransform, null);
        
        _gl.uniformMatrix4fv(_program.worldMatrix, false, new Float32Array(this.worldMatrixStack.top().flatten()));

        var normalMatrix = new Matrix4x4();
        normalMatrix.loadMatrix(this.worldMatrixStack.top());
        normalMatrix.invert(true);
        _gl.uniformMatrix4fv(_program.normalMatrix, false, new Float32Array(normalMatrix.flatten()));
    }
    
    this.clear = function(mask)
    {
        mask = mask || (RC_COLOR_BUFFER_BIT | RC_DEPTH_BUFFER_BIT);
        
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.Clear, [mask]);
        
        _gl.clear((mask & RC_COLOR_BUFFER_BIT   ? _gl.COLOR_BUFFER_BIT   : 0) |
                  (mask & RC_DEPTH_BUFFER_BIT   ? _gl.DEPTH_BUFFER_BIT   : 0) |
                  (mask & RC_STENCIL_BUFFER_BIT ? _gl.STENCIL_BUFFER_BIT : 0));
    }

    this.clearColor = function(r, g, b, a)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.ClearColor, [r, g, b, a]);
        
        _gl.clearColor(r, g, b, a);
        _clearColor.load(r, g, b, a);
    }
    
    this.clearDepth = function(d)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.ClearDepth, [d]);
        
        _gl.clearDepth(d);
    }
    
    this.clearStencil = function(s)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.ClearStencil, [s]);
        
        _gl.clearStencil(s);  
    }
    
    this.createProgram = function(vs, fs)
    {
        //if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.createProgram, [vs, fs]);
        
        return new webglProgram(this, _gl, vs, fs);
    }
    
    this.createShadowFramebufferObject = function()
    {
        return new webglShadowFBO(this, _gl);
    }
    
    this.createTextureObject = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.CreateTextureObject, null);
        
        return new webglTO(this, _gl);
    }
    
    this.createVertexBuffer = function(numVerticesPerPrimitive)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.CreateVertexBuffer, [numVerticesPerPrimitive]);
        
        return new webglVB(this, _gl, numVerticesPerPrimitive);
    }
    
    this.cullFace = function(face)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.CullFace, [face]);
        
        switch (face)
        {
            case RC_FRONT:
                _gl.cullFace(_gl.FRONT);
                break;
                
            case RC_BACK:
                _gl.cullFace(_gl.BACK);
                break;
        }
    }
    
    this.disable = function(cap)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.Disable, [cap]);
        
        switch (cap)
        {
            case eRenderMode.AlphaBlend:
                _gl.disable(_gl.BLEND);
                _enabledCaps.alphaBlend = false;
                break;

            case eRenderMode.CullBackFace:
                _gl.disable(_gl.CULL_FACE);
                _enabledCaps.cullBackFace = false;
                break;

            case eRenderMode.DepthBufferWrite:
                _gl.depthMask(false);
                _enabledCaps.depthBufferWrite = false;
                break;

            case eRenderMode.DepthTest:
                _gl.disable(_gl.DEPTH_TEST);
                _enabledCaps.depthTest = false;
                break;

            case eRenderMode.Lighting:
                _gl.uniform1i(_program.lightingEnabled, false);
                _enabledCaps.lighting = false;
                break;
                
            case eRenderMode.StencilTest:
                _gl.disable(_gl.STENCIL_TEST);
                _enabledCaps.stencilTest = false;
                break;
        }
    }

    this.enable = function(cap)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.Enable, [cap]);
        
        switch (cap)
        {
            case eRenderMode.AlphaBlend:
                _gl.enable(_gl.BLEND);
                _enabledCaps.alphaBlend = true;
                break;

            case eRenderMode.CullBackFace:
                _gl.enable(_gl.CULL_FACE);
                _enabledCaps.cullBackFace = true;
                break;

            case eRenderMode.DepthBufferWrite:
                _gl.depthMask(true);
                _enabledCaps.depthBufferWrite = true;
                break;

            case eRenderMode.DepthTest:
                _gl.enable(_gl.DEPTH_TEST);
                _enabledCaps.depthTest = true;
                break;

            case eRenderMode.Lighting:
                _gl.uniform1i(_program.lightingEnabled, true);
                _enabledCaps.lighting = true;
                break;
                
            case eRenderMode.StencilTest:
                _gl.enable(_gl.STENCIL_TEST);
                _enabledCaps.stencilTest = true;
                break;
        }
    }
    
    this.enableClipPlane = function(index, enable)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.EnableClipPlane, [index, enable]);
        
        _gl.uniform1i(_program.clipPlaneEnabled[index], enable);

        _vClipPlaneEnabledStates[index] = enable;
    }

    this.enabled = function(cap)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.Enabled, [cap]);
        
        var e = false;

        switch (cap)
        {
            case eRenderMode.AlphaBlend:
                e = _enabledCaps.alphaBlend;
                break;

            case eRenderMode.CullBackFace:
                e = _enabledCaps.cullBackFace;
                break;
                
            case eRenderMode.DepthBufferWrite:
                e = _enabledCaps.depthBufferWrite;
                break;

            case eRenderMode.DepthTest:
                e = _enabledCaps.depthTest;
                break;

            case eRenderMode.Lighting:
                e = _enabledCaps.lighting;
                break;
                
            case eRenderMode.StencilTest:
                e = _enabledCaps.stencilTest;
                break;
        }

        return e;
    }
    
    this.enableLight = function(index, enable)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.EnableLight, [index, enable]);
        
        _gl.uniform1i(_program.lightSource[index].enabled, enable);

        _vLightEnabledStates[index] = enable;
    }
    
    this.enableTextureStage = function(stage, enable)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.EnableTextureStage, [stage, enable]);
        
        _gl.uniform1i(_program.textureStageEnabled[stage], enable);
    }
    
    this.finish = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.Finish, null);
        
        _gl.finish();
    }
    
    this.getClearColor = function()
    {
        return _clearColor;
    }
    
    this.getClipPlane = function(index)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.GetClipPlane, [index]);
        
        return { equation: _vClipPlanes[index], matrix: _vClipPlaneMatrices[index] };
    }
    
    this.getEnabledClipPlanes = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.GetEnabledClipPlanes, null);
        
        var indices = [];

        for (var i = 0; i < _vClipPlaneEnabledStates.length; i++)
        {
            if (_vClipPlaneEnabledStates[i])
            {
                indices.push(i);
            }
        }

        return indices;
    }
    
    this.getEnabledLights = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.GetEnabledLights, null);
        
        var indices = [];

        for (var i = 0; i < _vLightEnabledStates.length; i++)
        {
            if (_vLightEnabledStates[i])
            {
                indices.push(i);
            }
        }

        return indices;
    }

    this.getGlobalIllumination = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.GetGlobalIllumination, null);
        
        var values = this.globalIllumination.v();//_gl.getUniform(_program.getGLProgram(), _program.globalAmbientLight);

        return { r: values[0], g: values[1], b: values[2], a: values[3] };
    }
    
    this.getLight = function(index)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.GetLight, [index]);
        
        return { desc: _vLights[index], matrix: _vLightMatrices[index] };
    }
    
    this.getMaxLightCount = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.GetMaxLightCount, null);
        
        return gl_MaxLights;
    }
    
    this.getMaxTextureStages = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.GetMaxTextureStages, null);
        
        return gl_MaxTextureStages;
    }
    
    this.getProgram = function()
    {
        //if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.GetProgram, null);
        
        return _program;
    }
    
    this.getViewport = function()
    {
        return _viewport;
    }
    
    this.perspectiveMatrixLH = function(left, right, top, bottom, near, far)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.PerspectiveMatrixLH, [left, right, top, bottom, near, far]);
        
        var p = new Matrix4x4();
        
        var a = (right + left) / (right - left);
        var b = (top + bottom) / (top - bottom);
        var c = (far + near) / (far - near);
        var d = (2 * far * near) / (far - near);
        
        p._11 = (2 * near) / (right - left);
        p._13 = a;
        p._22 = (2 * near) / (top - bottom);
        p._23 = b;
        p._33 = c;
        p._34 = 1;
        p._43 = -d;
        p._44 = 0;
        
        return p;
    }
    
    this.orthographicMatrixLH = function(left, right, top, bottom, near, far)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.OrthographicMatrixLH, [left, right, top, bottom, near, far]);
        
        var p = new Matrix4x4();
        
        p._11 =  2 / (right - left);
        p._22 =  2 / (top - bottom);
        p._33 = -2 / (far - near);
        p._41 = -((right + left) / (right - left));
        p._42 = -((top + bottom) / (top - bottom));
        p._43 = -((far + near) / (far - near)) / 2;
              
        return p;
    }
    
    this.readFrameBuffer = function(x, y, width, height)
    {
        var pixels = new Uint8Array(width * height * 4);
        
        _gl.readPixels(x, y, width, height, _gl.RGBA, _gl.UNSIGNED_BYTE, pixels);
        
        return pixels;
    }
    
    this.setBlendColor = function(r, g, b, a)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetBlendColor, [r, g, b, a]);
        
        _gl.blendColor(r, g, b, a);
    }
    
    this.setBlendFactor = function(sfactor, dfactor)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetBlendFactor, [sfactor, dfactor]);
        
        var gl_SrcFactor;
        switch (sfactor)
        {
        case RC_ZERO:                   gl_SrcFactor = _gl.ZERO; break;
        case RC_ONE:                    gl_SrcFactor = _gl.ONE; break;
        case RC_SRC_COLOR:              gl_SrcFactor = _gl.SRC_COLOR; break;
        case RC_SRC_ALPHA:              gl_SrcFactor = _gl.SRC_ALPHA; break;        
        case RC_ONE_MINUS_SRC_COLOR:    gl_SrcFactor = _gl.ONE_MINUS_SRC_COLOR; break;
        case RC_ONE_MINUS_SRC_ALPHA:    gl_SrcFactor = _gl.ONE_MINUS_SRC_ALPHA; break;
        case RC_DEST_COLOR:             gl_SrcFactor = _gl.DEST_COLOR; break;
        case RC_DEST_ALPHA:             gl_SrcFactor = _gl.DEST_ALPHA; break;        
        case RC_ONE_MINUS_DEST_COLOR:   gl_SrcFactor = _gl.ONE_MINUS_DEST_COLOR; break;
        case RC_ONE_MINUS_DEST_ALPHA:   gl_SrcFactor = _gl.ONE_MINUS_DEST_ALPHA; break;
        }     
        
        var gl_DestFactor;
        switch (dfactor)
        {
        case RC_ZERO:                   gl_DestFactor = _gl.ZERO; break;
        case RC_ONE:                    gl_DestFactor = _gl.ONE; break;
        case RC_SRC_COLOR:              gl_DestFactor = _gl.SRC_COLOR; break;
        case RC_SRC_ALPHA:              gl_DestFactor = _gl.SRC_ALPHA; break;        
        case RC_ONE_MINUS_SRC_COLOR:    gl_DestFactor = _gl.ONE_MINUS_SRC_COLOR; break;
        case RC_ONE_MINUS_SRC_ALPHA:    gl_DestFactor = _gl.ONE_MINUS_SRC_ALPHA; break;
        case RC_DEST_COLOR:             gl_DestFactor = _gl.DEST_COLOR; break;
        case RC_DEST_ALPHA:             gl_DestFactor = _gl.DEST_ALPHA; break;        
        case RC_ONE_MINUS_DEST_COLOR:   gl_DestFactor = _gl.ONE_MINUS_DEST_COLOR; break;
        case RC_ONE_MINUS_DEST_ALPHA:   gl_DestFactor = _gl.ONE_MINUS_DEST_ALPHA; break;
        }
        
        _gl.blendFunc(gl_SrcFactor, gl_DestFactor);  
    }

    this.setClipPlane = function(index, equation)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetClipPlane, [index, equation]);
        
        // get current world transform
        var worldMatrix = this.worldMatrixStack.top();

        var values = [ equation[0], equation[1], equation[2], equation[3] ];
        
        _gl.uniform4fv(_program.textureColorMask, new Float32Array(values));
        
        _vClipPlanes[index] = equation;
        _vClipPlaneMatrices[index] = worldMatrix;          
    }
    
    this.setDepthFunc = function(func)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetDepthFunc, [func]);
        
        var gl_DepthFunc;
        switch (func)
        {
        case eDepthFunc.Never:          gl_DepthFunc = _gl.NEVER; break;
        case eDepthFunc.Less:           gl_DepthFunc = _gl.LESS; break;
        case eDepthFunc.LessEqual:      gl_DepthFunc = _gl.LEQUAL; break;
        case eDepthFunc.Equal:          gl_DepthFunc = _gl.EQUAL; break;
        case eDepthFunc.NotEqual:       gl_DepthFunc = _gl.NOTEQUAL; break;
        case eDepthFunc.GreaterEqual:   gl_DepthFunc = _gl.GEQUAL; break;
        case eDepthFunc.Greater:        gl_DepthFunc = _gl.GREATER; break;
        case eDepthFunc.Always:         gl_DepthFunc = _gl.ALWAYS; break;
        }
        
        _gl.depthFunc(gl_DepthFunc);
           
    }
    
    this.setEnabledClipPlanes = function(indices)
    {
        if (this.displayListObj) if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetEnabledClipPlanes, [indices]);
        
        // disable all previously enabled clip planes
        for (var i = 0; i < _vClipPlaneEnabledStates.length; i++)
        {
            if (_vClipPlaneEnabledStates[i])
            {
                this.enableClipPlane(i, false);
            }
        }

        // enable specified clip planes
        for (var i = 0; i < indices.length; i++)
        {
            this.enableClipPlane(indices[i], true);
        }
    }
    
    this.setEnabledLights = function(indices)
    {
        if (this.displayListObj) if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetEnabledLights, [indices]);
        
        // disable all previously enabled lights
        for (var i = 0; i < _vLightEnabledStates.length; i++)
        {
            if (_vLightEnabledStates[i])
            {
                this.enableLight(i, false);
            }
        }

        // enable specified lights
        for (var i = 0; i < indices.length; i++)
        {
            this.enableLight(indices[i], true);
        }
    }
    
    this.setFrontMaterial = function(desc)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetFrontMaterial, [desc]);
        
        // ambient
        if (desc.validMembersMask & MATERIALDESC_AMBIENT_BIT)
        {
            _gl.uniform4fv(_program.frontMaterial.ambient, new Float32Array(desc.ambient.v()));
            
            this.frontMaterial.ambient = desc.ambient;
        }
        
        // diffuse
        if (desc.validMembersMask & MATERIALDESC_DIFFUSE_BIT)
        {
            _gl.uniform4fv(_program.frontMaterial.diffuse, new Float32Array(desc.diffuse.v()));
            
            this.frontMaterial.diffuse = desc.diffuse;
        }
        
        // specular
        if (desc.validMembersMask & MATERIALDESC_SPECULAR_BIT)
        {
            _gl.uniform4fv(_program.frontMaterial.specular, new Float32Array(desc.specular.v()));
            
            this.frontMaterial.specular = desc.specular;
        }
        
        // emissive
        if (desc.validMembersMask & MATERIALDESC_EMISSIVE_BIT)
        {
            // TODO
            _gl.uniform4fv(_program.frontMaterial.emissive, new Float32Array(desc.emissive.v()));
            
            this.frontMaterial.emissive = desc.emissive;
        }
        
        // glossiness
        if (desc.validMembersMask & MATERIALDESC_GLOSSINESS_BIT)
        {
            // glossiness - OpenGL accepts values in the range [0, 128].
            // use the range [5, 128], because values below 5 result in wash-out
            _gl.uniform1f(_program.frontMaterial.shininess, clamp(desc.glossiness * 128, 5, 128));
            
            this.frontMaterial.glossiness = desc.glossiness;
        }
        
        this.frontMaterial.validMembersMask |= desc.validMembersMask;
    }

    this.setGlobalIllumination = function(ambient)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetGlobalIllumination, [ambient]);
        
        var values = [ ambient.r, ambient.g, ambient.b, ambient.a ];

        _gl.uniform4fv(_program.globalAmbientLight, new Float32Array(values));
        
        this.globalIllumination.load(ambient.r, ambient.g, ambient.b, ambient.a);
    }

    this.setLight = function(index, desc)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetLight, [index, desc]);

        // position
        if (desc.validMembersMask & LIGHTDESC_POSITION_BIT)
        {
            var values = [desc.position.x, desc.position.y, desc.position.z, 1];
            _gl.uniform4fv(_program.lightSource[index].position, new Float32Array(values));
        }

        // direction
        if (desc.validMembersMask & LIGHTDESC_DIRECTION_BIT)
        {
            var values = [desc.direction.x, desc.direction.y, desc.direction.z, 0];

            switch (desc.type)
            {
                case "directional":
                    {
                        values[0] *= -1;
                        values[1] *= -1;
                        values[2] *= -1;

                        // OpenGL gets a directional light's direction from position member                
                        _gl.uniform4fv(_program.lightSource[index].position, new Float32Array(values));
                    }
                    break;

                case "spot":
                    {
                        _gl.uniform4fv(_program.lightSource[index].spotDirection, new Float32Array(values));
                    }
                    break;
            }
        }

        // ambient
        if (desc.validMembersMask & LIGHTDESC_AMBIENT_BIT)
        {
            _gl.uniform4fv(_program.lightSource[index].ambient, new Float32Array(desc.ambient.v()));
        }

        // diffuse
        if (desc.validMembersMask & LIGHTDESC_DIFFUSE_BIT)
        {
            _gl.uniform4fv(_program.lightSource[index].diffuse, new Float32Array(desc.diffuse.v()));
        }

        // specular
        if (desc.validMembersMask & LIGHTDESC_SPECULAR_BIT)
        {
            _gl.uniform4fv(_program.lightSource[index].specular, new Float32Array(desc.specular.v()));
        }

        // constant attenuation
        if (desc.validMembersMask & LIGHTDESC_CONSTANT_ATT_BIT)
        {
            _gl.uniform1f(_program.lightSource[index].constantAttenuation, desc.constantAttenuation);
        }

        // linear attenuation
        if (desc.validMembersMask & LIGHTDESC_LINEAR_ATT_BIT)
        {
            _gl.uniform1f(_program.lightSource[index].linearAttenuation, desc.linearAttenuation);
        }

        // quadratic attenuation
        if (desc.validMembersMask & LIGHTDESC_QUADRATIC_ATT_BIT)
        {
            _gl.uniform1f(_program.lightSource[index].quadraticAttenuation, desc.quadraticAttenuation);
        }

        // range
        if (desc.validMembersMask & LIGHTDESC_RANGE_BIT)
        {
            // TODO
            _gl.uniform1f(_program.lightSource[index].range, desc.range);
        }

        // outer cone angle
        if (desc.validMembersMask & LIGHTDESC_OUTER_CONE_DEG_BIT)
        {
            var outerConeDegrees = desc.outerConeDegrees;

            // OpenGL accepts cone degrees in the range [0, 90] or 180
            if (outerConeDegrees > 90)
            {
                outerConeDegrees = 180;
            }

            _gl.uniform1f(_program.lightSource[index].spotCutoff, outerConeDegrees);

            _gl.uniform1f(_program.lightSource[index].spotExponent, 0);
        }

        // inner cone angle
        if (desc.validMembersMask & LIGHTDESC_INNER_CONE_DEG_BIT)
        {
            // TODO
        }

        // cone falloff
        if (desc.validMembersMask & LIGHTDESC_CONE_FALLOFF_BIT)
        {
            // TODO
        }

        _vLights[index] = desc;
        _vLightMatrices[index] = worldMatrix;
    }

    this.setModelID = function(id)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetModelID, [id]);
        
        _gl.uniform1i(_program.modelID, id);
    }
    
    this.setShadeModel = function(model)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetShadeModel, [model]);
        
        // TODO
    }
    
    this.setShadowCasterWorldPosition = function(x, y, z)
    {
        _gl.uniform3fv(_program.shadowCasterWorldPosition, new Float32Array([x, y, z]));
    }
    
    this.setStencilFunc = function(func, ref, mask)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetStencilFunc, [func, ref, mask]);
        
        var gl_StencilFunc;
        switch (func)
        {
        case eDepthFunc.Never:          gl_StencilFunc = _gl.NEVER; break;
        case eDepthFunc.Less:           gl_StencilFunc = _gl.LESS; break;
        case eDepthFunc.LessEqual:      gl_StencilFunc = _gl.LEQUAL; break;
        case eDepthFunc.Equal:          gl_StencilFunc = _gl.EQUAL; break;
        case eDepthFunc.NotEqual:       gl_StencilFunc = _gl.NOTEQUAL; break;
        case eDepthFunc.GreaterEqual:   gl_StencilFunc = _gl.GEQUAL; break;
        case eDepthFunc.Greater:        gl_StencilFunc = _gl.GREATER; break;
        case eDepthFunc.Always:         gl_StencilFunc = _gl.ALWAYS; break;
        }
        
        _gl.stencilFunc(gl_StencilFunc, ref, mask);
    }
            
    this.setStencilMask = function(mask)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetStencilMask, [mask]);
        
        _gl.stencilMask(mask);
    } 
    
    this.setStencilOp = function(fail, zFail, zPass)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetStencilOp, [fail, zFail, zPass]);
       
        var gl_Fail;
        switch (fail)
        {
        case eStencilOp.Keep:           gl_Fail = _gl.KEEP; break;
        case eStencilOp.Replace:        gl_Fail = _gl.REPLACE; break;
        case eStencilOp.Increment:      gl_Fail = _gl.INCR; break;
        case eStencilOp.Decrement:      gl_Fail = _gl.DECR; break;
        case eStencilOp.Invert:         gl_Fail = _gl.INVERT; break;
        case eStencilOp.Zero:           gl_Fail = _gl.ZERO; break;
        }
        
        switch (zFail)
        {
        case eStencilOp.Keep:           gl_ZFail = _gl.KEEP; break;
        case eStencilOp.Replace:        gl_ZFail = _gl.REPLACE; break;
        case eStencilOp.Increment:      gl_ZFail = _gl.INCR; break;
        case eStencilOp.Decrement:      gl_ZFail = _gl.DECR; break;
        case eStencilOp.Invert:         gl_ZFail = _gl.INVERT; break;
        case eStencilOp.Zero:           gl_ZFail = _gl.ZERO; break;
        }
        
        switch (zPass)
        {
        case eStencilOp.Keep:           gl_ZPass = _gl.KEEP; break;
        case eStencilOp.Replace:        gl_ZPass = _gl.REPLACE; break;
        case eStencilOp.Increment:      gl_ZPass = _gl.INCR; break;
        case eStencilOp.Decrement:      gl_ZPass = _gl.DECR; break;
        case eStencilOp.Invert:         gl_ZPass = _gl.INVERT; break;
        case eStencilOp.Zero:           gl_ZPass = _gl.ZERO; break;
        }
        
        _gl.stencilOp(gl_Fail, gl_ZFail, gl_ZPass);
    }
    
    this.setTextureBlendFactor = function(factor)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetTextureBlendFactor, [factor]);
        
        // update material diffuse component alpha to blend factor
        var diffuse = [ this.frontMaterial.diffuse.r, this.frontMaterial.diffuse.g, this.frontMaterial.diffuse.b, factor ];
        _gl.uniform4fv(_program.frontMaterial.diffuse, new Float32Array(diffuse));
    }
    
    this.setTextureBlendOp = function(op)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetTextureBlendOp, [op]);
        
        _gl.uniform1i(_program.textureBlendOp, op);
    }
    
    this.setTextureColorMask = function(r, g, b, a)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetTextureColorMask, [r, g, b, a]);
        
        var values = [ r, g, b, a ];
        
        _gl.uniform4fv(_program.textureColorMask, new Float32Array(values));   
    }
    
    this.setViewport = function(x, y, width, height)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetViewport, [x, y, width, height]);
        
        _gl.viewport(x, y, width, height);
        _viewport.load(x, y, width, height);
    }
    
    this.useProgram = function(program)
    {
        //if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.UseProgram, [_program]);
        
        if (_program != program)
        {
            if (_program)
            {
                _program.disableVertexAttribArrays();
            }
            
            _gl.useProgram(program.getGLProgram());
            _program = program;
            
            if (_program)
            {
                _program.enableVertexAttribArrays();
                
                // restore states that don't translate between program switches
                this.setGlobalIllumination(this.globalIllumination);
                
                // get enabled states
                _enabledCaps.alphaBlend = _gl.getParameter(_gl.BLEND);
                _enabledCaps.cullBackFace = _gl.getParameter(_gl.CULL_FACE);
                _enabledCaps.depthTest = _gl.getParameter(_gl.DEPTH_TEST);
                _enabledCaps.depthBufferWrite = _gl.getParameter(_gl.DEPTH_WRITEMASK);
                _enabledCaps.lighting = _gl.getUniform(_program.getGLProgram(), _program.lightingEnabled);
                _enabledCaps.stencilTest = _gl.getParameter(_gl.STENCIL_TEST);  
            }
        }
    }
}

function getWebGLContext(canvas, debug) 
{
    var _gl = null;
    try 
    {
        if (debug)
        {
            _gl = WebGLDebugUtils.makeDebugContext(canvas.getContext("experimental-webgl", { stencil: true, antialias: false, preserveDrawingBuffer: true }));
        }
        else // !debug
        {
            _gl = (canvas.getContext("webgl", { stencil: true, antialias: true, preserveDrawingBuffer: true }) || 
                  canvas.getContext("experimental-webgl", { stencil: true, antialias: true, preserveDrawingBuffer: true }));
        }
    }    
    catch (e) 
    {
    }
    if (!_gl) 
    {
        var div = document.createElement("div");
        div.innerHTML = "This demo requires a WebGL-enabled browser.";
        var canvasParent = canvas.parentNode;
        canvasParent.replaceChild(div, canvas);
    }

    var stencilBits = _gl.getParameter(_gl.STENCIL_BITS);

    return _gl;
}

function webglVB_uvb(buffer, coords)
{
    this.buffer = buffer;
    this.coords = coords;
}

webglVB.prototype = new VertexBuffer();
webglVB.prototype.constructor = webglVB;

function webglVB(rc, gl, numVerticesPerPrimitive)
{
    //
    // initialization
    //

    VertexBuffer.call(this);

    this.numVerticesPerPrimitive = numVerticesPerPrimitive;

    var rc = rc;
    var gl = gl;
    var vb = gl.createBuffer();
    var nb = null;
    var cb = null;
    var cEmpty = gl.createBuffer(); // for VBs with no color coordinates (see below)
    var uvb = new Array(gl_MaxTextureStages);
    var uvEmpty = gl.createBuffer(); // for VBs with no texture coordinates (see below)
    var uvCoords = []; // indexed by texture
    var primitiveType = 0;

    //
    // methods
    //

    this.setPrimitiveType = function(type)
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.VB_SetPrimitiveType, [this, type]);

        switch (type)
        {
            case RC_POINTS:
                primitiveType = gl.POINTS;
                break;
            case RC_LINES:
                primitiveType = gl.LINES;
                break;
            case RC_LINE_LOOP:
                primitiveType = gl.LINE_LOOP;
                break;
            case RC_LINE_STRIP:
                primitiveType = gl.LINE_STRIP;
                break;
            case RC_TRIANGLES:
                primitiveType = gl.TRIANGLES;
                break;
            case RC_TRIANGLE_STRIP:
                primitiveType = gl.TRIANGLE_STRIP;
                break;
            case RC_TRIANGLE_FAN:
                primitiveType = gl.TRIANGLE_FAN;
                break;
        }
    }

    this.setVertices = function(vertices)
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.VB_SetVertices, [this, vertices]);

        if (vertices.length)
        {
            gl.bindBuffer(gl.ARRAY_BUFFER, vb);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);

            this.vertexCount = vertices.length / this.numVerticesPerPrimitive;

            // create empty color array for vb's with no colors specified (see below)
            gl.bindBuffer(gl.ARRAY_BUFFER, cEmpty);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(this.vertexCount * 4), gl.STATIC_DRAW);

            // create empty texture coordinate arrays for vb's with no textures (see below)
            gl.bindBuffer(gl.ARRAY_BUFFER, uvEmpty);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(new Array(this.vertexCount * 2)), gl.STATIC_DRAW);
        }

        this.vertices = vertices;
    }

    this.setNormals = function(normals)
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.VB_SetNormals, [this, normals]);

        if (normals.length)
        {
            if (nb == null)
            {
                nb = gl.createBuffer();
            }
            gl.bindBuffer(gl.ARRAY_BUFFER, nb);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(normals), gl.STATIC_DRAW);
        }

        this.normals = normals;
    }

    this.setColors = function(colors)
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.VB_SetColors, [this, colors]);

        if (colors.length)
        {
            if (cb == null)
            {
                cb = gl.createBuffer();
            }
            gl.bindBuffer(gl.ARRAY_BUFFER, cb);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(colors), gl.STATIC_DRAW);
        }

        this.colors = colors;
    }

    this.setUVCoords = function(texture, coords)
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.VB_SetUVCoords, [this, texture, coords]);

        uvCoords[texture] = new webglVB_uvb(gl.createBuffer(), coords.slice());

        // flip y
        for (var i = 1; i < uvCoords[texture].coords.length; i += 2)
        {
            uvCoords[texture].coords[i] = 1 - uvCoords[texture].coords[i];
        }
    }

    this.setTextureStage = function(stage, textureObj, widthWrap, heightWrap, textureCoordSrc, planeCoefficients)
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.VB_SetTextureStage, [this, stage, textureObj, widthWrap, heightWrap, textureCoordSrc, planeCoefficients]);

        switch (stage)
        {
            case 0:
                {
                    gl.activeTexture(gl.TEXTURE0 + eTextureUnit.Color0);
                    gl.uniform1i(rc.getProgram().textureSamplerColor[stage], eTextureUnit.Color0);
                }
                break;

            case 1:
                {
                    gl.activeTexture(gl.TEXTURE0 + eTextureUnit.Color1);
                    gl.uniform1i(rc.getProgram().textureSamplerColor[stage], eTextureUnit.Color1);
                }
                break;
        }

        gl.bindTexture(gl.TEXTURE_2D, textureObj.texture);     
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, widthWrap);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, heightWrap);

        if (uvCoords[textureObj])
        {
            gl.bindBuffer(gl.ARRAY_BUFFER, uvCoords[textureObj].buffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(uvCoords[textureObj].coords), gl.STATIC_DRAW);
            uvb[stage] = uvCoords[textureObj].buffer;
        }
    }

    this.draw = function()
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.VB_Draw, [this]);

        var program = rc.getProgram();
        
        if (this.vertices.length)
        {
            // vertices
            gl.bindBuffer(gl.ARRAY_BUFFER, vb);
            program.vertexAttribPointer(program.vertexPositionAttribute, this.numVerticesPerPrimitive, gl.FLOAT, false, 0, 0);

            // normals
            if (nb)
            {
                gl.bindBuffer(gl.ARRAY_BUFFER, nb);
                program.vertexAttribPointer(program.vertexNormalAttribute, 3, gl.FLOAT, false, 0, 0);
            }

            // colors
            if (program.vertexColorAttribute >= 0)
            {
                if (cb)
                    gl.bindBuffer(gl.ARRAY_BUFFER, cb);
                else
                    gl.bindBuffer(gl.ARRAY_BUFFER, cEmpty);
                program.vertexAttribPointer(program.vertexColorAttribute, 4, gl.FLOAT, false, 0, 0);
            }
            
            // texture coords
            // NOTE: vertex shader silently fails if nothing is specified for a given rc.getProgram() attribute, so if 
            // no texture coords are specified, use the vertex uv buffer.
            for (var i = 0; i < gl_MaxTextureStages; i++)
            {
                if (program.textureCoordAttribute[i] >= 0)
                {
                    if (uvb[i])
                        gl.bindBuffer(gl.ARRAY_BUFFER, uvb[i]);
                    else
                        gl.bindBuffer(gl.ARRAY_BUFFER, uvEmpty);
                    program.vertexAttribPointer(program.textureCoordAttribute[i], 2, gl.FLOAT, false, 0, 0);
                }
            }

            gl.drawArrays(primitiveType, 0, this.vertexCount);
        }
    }
}
webglTO.prototype = new TextureObject();
webglTO.prototype.constructor = webglTO;

function webglTO(rc, gl)
{
    //
    // initialization
    //
    
    TextureObject.call(this);
    
    var rc = rc;
    var gl = gl;
    
    this.texture = gl.createTexture();
    
    //
    // methods
    //

    this.setImage = function(image, pixelFormat, imageFormat)
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.TO_SetImage, [this, image, pixelFormat, imageFormat]);

        var intFormat;
        switch (pixelFormat)
        {
            case ePixelFormat.R8G8B8:
            case ePixelFormat.B8G8R8:
            case ePixelFormat.X8G8R8:
                intFormat = gl.RGB;
                break;

            case ePixelFormat.R8G8B8A8:
            case ePixelFormat.B8G8R8A8:
            case ePixelFormat.A8R8G8B8:
            case ePixelFormat.A8B8G8R8:
            case ePixelFormat.X8X8X8X8:
                intFormat = gl.RGBA;
                break;

            case ePixelFormat.A8:
                intFormat = gl.ALPHA;
                break;

            default: // unsupported format
                return;
                break;
        }

        var format;
        switch (imageFormat)
        {
            case eImageFormat.RGB:
                format = gl.RGB;
                break;

            case eImageFormat.RGBA:
                format = gl.RGBA;
                break;

            case eImageFormat.Alpha:
                format = gl.ALPHA;
                break;

            case eImageFormat.Luminance:
                format = gl.LUMINANCE;
                break;

            case eImageFormat.Luminance_Alpha:
                format = gl.LUMINANCE_ALPHA;
                break;

            default: // unsupported format
                return;
                break;
        }

        // following taken from:
        // http://www.khronos.org/webgl/wiki/WebGL_and_OpenGL_Differences
        if (!isPowerOfTwo(image.width) || !isPowerOfTwo(image.height))
        {
            // Scale up the texture to the next highest power of two dimensions.
            var canvas = document.createElement("canvas");
            canvas.width = nextHighestPowerOfTwo(image.width);
            canvas.height = nextHighestPowerOfTwo(image.height);
            var ctx = canvas.getContext("2d");
            ctx.drawImage(image,
                0, 0, image.width, image.height,
                0, 0, canvas.width, canvas.height);
            image = canvas;
        }

        gl.bindTexture(gl.TEXTURE_2D, this.texture);

        gl.texImage2D(gl.TEXTURE_2D, 0, intFormat, format, gl.UNSIGNED_BYTE, image);

        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
    
        gl.generateMipmap(gl.TEXTURE_2D);

        gl.bindTexture(gl.TEXTURE_2D, null);
    }

    this.setImageData = function(width, height, pixelFormat, imageFormat, pixels)
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.TO_SetImageData, [this, width, height, pixelFormat, imageFormat, pixels]);

        var intFormat;
        switch (pixelFormat)
        {
            case ePixelFormat.R8G8B8:
            case ePixelFormat.B8G8R8:
            case ePixelFormat.X8G8R8:
                intFormat = gl.RGB;
                break;

            case ePixelFormat.R8G8B8A8:
            case ePixelFormat.B8G8R8A8:
            case ePixelFormat.A8R8G8B8:
            case ePixelFormat.A8B8G8R8:
            case ePixelFormat.X8X8X8X8:
                intFormat = gl.RGBA;
                break;

            case ePixelFormat.A8:
                intFormat = gl.ALPHA;
                break;

            default: // unsupported format
                return;
                break;
        }

        var format;
        switch (imageFormat)
        {
            case eImageFormat.RGB:
                format = gl.RGB;
                break;

            case eImageFormat.RGBA:
                format = gl.RGBA;
                break;

            case eImageFormat.Alpha:
                format = gl.ALPHA;
                break;

            case eImageFormat.Luminance:
                format = gl.LUMINANCE;
                break;

            case eImageFormat.Luminance_Alpha:
                format = gl.LUMINANCE_ALPHA;
                break;

            default: // unsupported format
                return;
                break;
        }
        
        gl.bindTexture(gl.TEXTURE_2D, this.texture);

        gl.texImage2D(gl.TEXTURE_2D, 0, intFormat, width, height, 0, format, gl.UNSIGNED_BYTE,
            new Uint8Array(pixels));

        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
    	
        gl.generateMipmap(gl.TEXTURE_2D);

        gl.bindTexture(gl.TEXTURE_2D, null);
    }

    //texImage2D(GLenum target, GLint level, GLenum internalformat,
    //           GLenum format, GLenum type, HTMLCanvasElement canvas)
    // gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, gl.canvas);
    
    this.setImageWithCanvas = function(canvas)
    {
        // following taken from:
        // http://www.khronos.org/webgl/wiki/WebGL_and_OpenGL_Differences
        var canvasPOT = canvas;
        if (!isPowerOfTwo(canvas.width) || !isPowerOfTwo(canvas.height))
        {
            // Scale up the texture to the next highest power of two dimensions.
            canvasPOT = document.createElement("canvas");
            canvasPOT.width = nextHighestPowerOfTwo(canvas.width);
            canvasPOT.height = nextHighestPowerOfTwo(canvas.height);
            var ctx = canvasPOT.getContext("2d");
            ctx.drawImage(canvas,
                0, 0, canvas.width, canvas.height,
                0, 0, canvasPOT.width, canvasPOT.height);
        }
        
        gl.bindTexture(gl.TEXTURE_2D, this.texture);

        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, canvasPOT);

        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);//LINEAR_MIPMAP_LINEAR);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);//LINEAR);
        
        gl.generateMipmap(gl.TEXTURE_2D);
        
        gl.bindTexture(gl.TEXTURE_2D, null);   
    }   
                 
    this.setVideo = function(video)
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.TO_SetVideo, [this, video]);

        gl.bindTexture(gl.TEXTURE_2D, this.texture);

        // different browsers require calls to different versions of texImage2D; possibly because 
        // complete webGL implementations are not yet available
        switch (getBrowserName())
        {
            case "Chrome":
            //gl.texImage2D(gl.TEXTURE_2D, 0, video, false);
            //break;

            case "Firefox":
                gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, video);
                break;

            default:
                gl.texImage2D(gl.TEXTURE_2D, 0, video, false);
                break;
        }

        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
        gl.bindTexture(gl.TEXTURE_2D, null);
    }
}

function isPowerOfTwo(x)
{
    return (x & (x - 1)) == 0;
}

function nextHighestPowerOfTwo(x)
{
    --x;
    for (var i = 1; i < 32; i <<= 1)
    {
        x = x | x >> i;
    }
    return x + 1;
}
function webglShadowFBO(rc, gl)
{
    var rc = rc;
    var gl = gl;
    var width = 1024;
    var height = 1024;
    
    // create frame buffer
    var fbo = gl.createFramebuffer();
    gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);
    
    // create depth texture
    var depth = gl.createRenderbuffer();
    gl.bindRenderbuffer(gl.RENDERBUFFER, depth);
    gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, width, height);
    gl.bindRenderbuffer(gl.RENDERBUFFER, null);
    gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, depth);
   
    var floatExt = gl.getFloatExtension({
        require: ['renderable'],
        prefer:  ['filterable', 'half']
    });
    
    // create shadow map
    var shadowMap = gl.createTexture();
    gl.bindTexture(gl.TEXTURE_CUBE_MAP, shadowMap);
    for (var i = 0; i < 6; i++)
    {
        var target = gl.TEXTURE_CUBE_MAP_POSITIVE_X + i;
        gl.texImage2D(target, 0, gl.RGBA, width, height, 0, gl.RGBA, floatExt.type, null);  
    }
    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
    //gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
    //gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
    gl.bindTexture(gl.TEXTURE_CUBE_MAP, null);
    
    gl.bindFramebuffer(gl.FRAMEBUFFER, null);
    
    this.bindForWriting = function(face)
    {
        var glFace = 0;
        switch (face)
        {
            case eCubeMapFace.Positive_X: glFace = gl.TEXTURE_CUBE_MAP_POSITIVE_X; break;
            case eCubeMapFace.Negative_X: glFace = gl.TEXTURE_CUBE_MAP_NEGATIVE_X; break;
            case eCubeMapFace.Positive_Y: glFace = gl.TEXTURE_CUBE_MAP_POSITIVE_Y; break;
            case eCubeMapFace.Negative_Y: glFace = gl.TEXTURE_CUBE_MAP_NEGATIVE_Y; break;
            case eCubeMapFace.Positive_Z: glFace = gl.TEXTURE_CUBE_MAP_POSITIVE_Z; break;
            case eCubeMapFace.Negative_Z: glFace = gl.TEXTURE_CUBE_MAP_NEGATIVE_Z; break;
            default: return false;
        }
        
        gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);
        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, glFace, shadowMap, 0);
        /*
        var status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);
        if (status != gl.FRAMEBUFFER_COMPLETE)
        {
            gl.bindFramebuffer(gl.FRAMEBUFFER, null);
            return false;
        }
        */
        gl.viewport(0, 0, width, height);
        gl.clearColor(FLT_MAX, 0, 0, 0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
        
        return true;
    }
    
    this.bindForReading = function()
    {
        gl.bindFramebuffer(gl.FRAMEBUFFER, null);
        gl.activeTexture(gl.TEXTURE0 + eTextureUnit.ShadowMap);
        gl.uniform1i(rc.getProgram().textureSamplerShadowMap, eTextureUnit.ShadowMap);
        gl.bindTexture(gl.TEXTURE_CUBE_MAP, shadowMap);
        //gl.generateMipmap(gl.TEXTURE_CUBE_MAP);
        //gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);
        //gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, gl.LINEAR_MIPMAP_LINEAR);
        //gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
        //gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE); 
    }
}


var default_fragment_lighting_vs = [
"attribute vec3 aVertexPosition;",
"attribute vec3 aVertexNormal;",
"attribute vec4 aVertexColor;",
"attribute vec2 aTextureCoord0;",   // attributes cannot be arrays and must be specified
"attribute vec2 aTextureCoord1;",   // attributes cannot be arrays and must be specified      
"", 
"uniform mat4 uProjectionMatrix;",
"uniform mat4 uViewMatrix;",
"uniform mat4 uWorldMatrix;",
"uniform mat4 uNormalMatrix;",
"",
"varying vec4 vVertexPosition;",
"varying vec4 vTransformedNormal;",
"varying vec4 vVertexColor;",
"varying vec4 vViewPosition;",
"varying vec4 vViewDirection;",
"varying vec2 vTextureCoord[" + gl_MaxTextureStages + "];",
"",
"void main()",
"{",

"   vVertexPosition = uWorldMatrix * vec4(aVertexPosition, 1);",
"   vTransformedNormal = normalize(uNormalMatrix * vec4(aVertexNormal, 0));",
"   vVertexColor = aVertexColor;",
"   vViewPosition = uViewMatrix * vec4(0, 0, 0, 1);",
"   vViewDirection = normalize(-vViewPosition);",
"   vTextureCoord[0] = aTextureCoord0;",
"   vTextureCoord[1] = aTextureCoord1;",        
"   gl_Position = uProjectionMatrix * uViewMatrix * vVertexPosition;",
"}"
].join("\n");

var default_fragment_lighting_fs = [
"#ifdef GL_ES",
"precision highp float;",
"#endif",
"",
"vec4 gAmbient;",
"vec4 gDiffuse;",
"vec4 gSpecular;",
"",
"uniform vec4 uGlobalAmbientLight;",                    
"",
"struct lightSource",
"{",
"   int enabled;",
"   vec4 ambient;",
"   vec4 diffuse;",
"   vec4 specular;",
"   vec4 position;",
"   vec4 spotDirection;",
"   float spotExponent;",
"   float spotCutoff;",
"   float constantAttenuation;",
"   float linearAttenuation;",
"   float quadraticAttenuation;",
"   float range;",
"};",
"uniform lightSource uLightSource[" + gl_MaxLights + "];",
"",
"struct material",
"{",
"   vec4 ambient;",
"   vec4 diffuse;",
"   vec4 specular;",
"   vec4 emissive;",
"   float shininess;",
"};",
"uniform material uFrontMaterial;",
"",
"uniform int uLightingEnabled;",
"uniform int uTexturesEnabled;",
"uniform int uTextureStageEnabled[" + gl_MaxTextureStages + "];",       
"uniform sampler2D uTextureSamplerColor[" + gl_MaxTextureStages + "];",
"uniform sampler2D uTextureSamplerAlpha[" + gl_MaxTextureStages + "];",
"uniform int uTextureBlendOp;",
"uniform vec4 uTextureColorMask;",
"uniform vec4 uClipPlane[" + gl_MaxClipPlanes + "];",
"uniform int uClipPlaneEnabled[" + gl_MaxClipPlanes + "];",
"",
"varying vec4 vVertexPosition;",
"varying vec4 vTransformedNormal;",
"varying vec4 vVertexColor;",
"varying vec4 vViewPosition;",
"varying vec4 vViewDirection;",
"varying vec2 vTextureCoord[" + gl_MaxTextureStages + "];",
"",
"void directionalLight(vec4 position, vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 halfVector)",
"{",
"   vec3 lightDir;",
"   float nDotL;",      // normal . light direction
"   float nDotHV;",     // normal . half-vector
"   float pf;",         // power factor
"",
"   lightDir = normalize(vec3(position));",
"",	
"   nDotL = max(dot(normal, lightDir), 0.0);",
"   if (nDotL == 0.0)",
"   {",
"       pf = 0.0;",
"   }",
"   else",
"   {",
"       nDotHV = max(0.0, dot(normal, halfVector));",
"       pf = pow(nDotHV, uFrontMaterial.shininess);",
"   }",
"",
"   gAmbient  += ambient * uFrontMaterial.ambient;",
"   gDiffuse  += diffuse * uFrontMaterial.diffuse * nDotL;",
"   gSpecular += specular * uFrontMaterial.specular * pf;",
"}",
"",
"void pointLight(vec4 position, float constantAttenuation, float linearAttenuation, float quadraticAttenuation, float range,",
"                vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 eye, vec3 vPosition)",
"{",
"   float nDotL;",      // normal . light direction
"   float nDotHV;",     // normal . light half vector
"   float pf;",         // power factor
"   float attenuation;",// computed attenuation factor
"   float d;",          // distance from surface to light source
"   vec3  L;",          // direction from surface to light position
"   vec3  halfVector;", //
"",
"", // Compute vector from surface to light position
"   L = vec3(position) - vPosition;",
"",
"", // Compute distance between surface and light position; if greater than range, return
"   d = length(L); if (d > range) return;",
"",
"", // Normalize the vector from surface to light position,
"   L = normalize(L);",
"",
"", // Compute attenuation,
"   attenuation = 1.0 / (constantAttenuation +",
"      linearAttenuation * d +",
"      quadraticAttenuation * d * d);",
"",
"   nDotL = max(0.0, dot(normal, L));",
"   nDotHV = max(0.0, dot(normal, normalize(L + eye)));",
"",
"   if (nDotL == 0.0)",
"   {",
"       pf = 0.0;",
"   }",
"   else",
"   {",
"       pf = pow(nDotHV, uFrontMaterial.shininess);",
"   }",
"",    
"   gAmbient  += ambient * uFrontMaterial.ambient * attenuation;",
"   gDiffuse  += diffuse * uFrontMaterial.diffuse * nDotL * attenuation;",
"   gSpecular += specular * uFrontMaterial.specular * pf * attenuation;",
"}",
"",
"void main()",
"{",
"   vec4 lightingFactor;",
"   if (uLightingEnabled != 0)",
"   {",
"       gAmbient = vec4(0, 0, 0, 0);",
"       gDiffuse = vec4(0, 0, 0, 0);",
"       gSpecular = vec4(0, 0, 0, 0);",
"",
"       for (int i=0; i < " + gl_MaxLights + "; i++)",
"       {",
"           if (uLightSource[i].enabled != 0)",
"           {",
"               if (uLightSource[i].position[3] == 0.0)", // directional light
"               {",
"                   directionalLight(uLightSource[i].position, uLightSource[i].ambient,",
"                       uLightSource[i].diffuse, uLightSource[i].specular,",
"                       normalize(vec3(vTransformedNormal)),",
"                       normalize(vec3(vViewDirection) + vec3(uLightSource[i].position)));",
"               }",
"               else if (uLightSource[i].spotCutoff > 90.0)", // point light
"               {",
"                   pointLight(uLightSource[i].position, uLightSource[i].constantAttenuation,",
"                       uLightSource[i].linearAttenuation, uLightSource[i].quadraticAttenuation, uLightSource[i].range,",
"                       uLightSource[i].ambient, uLightSource[i].diffuse, uLightSource[i].specular,",
"                       normalize(vec3(vTransformedNormal)),",
"                       vec3(vViewDirection), vec3(vVertexPosition));",
"               }",
"               else", // spotlight
"               {",
"               }",   
"           }",
"       }",
"",
"       lightingFactor  = uFrontMaterial.emissive;",
"       lightingFactor += uGlobalAmbientLight * uFrontMaterial.ambient;", // global ambient contribution
"       lightingFactor += gAmbient + gDiffuse + gSpecular;", // light contribution(s)
"       lightingFactor.a = uFrontMaterial.diffuse.a;",
"       lightingFactor = clamp(lightingFactor, 0.0, 1.0);",
"   }",
"   else", // uLightingEnabled == 0
"   {",
"       lightingFactor = vVertexColor;",
"   }",
"",
"   vec4 fragmentColor;",
"   vec4 fragmentColor1;",
"   vec4 fragmentColor2;",
"",
"   for (int i=0; i < " + gl_MaxClipPlanes + "; i++)",
"   {",
"       if (uClipPlaneEnabled[i] != 0)",
"       {",
"           if (dot(vVertexPosition.xyz, uClipPlane[i].xyz) - uClipPlane[i].w >= 0.0) discard;",    
"       }",
"   }",
"",
"   if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 0)",
"   {",
"       fragmentColor = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));",
"       if (fragmentColor.r == uTextureColorMask.r && fragmentColor.g == uTextureColorMask.g && fragmentColor.b == uTextureColorMask.b && fragmentColor.a == uTextureColorMask.a) discard;",
"       if (uTextureBlendOp == " + RC_MODULATE + ")",
"       {",
"           if (fragmentColor.a == 0.0) discard;",
"           else gl_FragColor = fragmentColor * lightingFactor;",
"       }",
"       else if (uTextureBlendOp == " + RC_REPLACE + ")",
"       {",
"           gl_FragColor = fragmentColor;",
"       }",
"       else",
"       {",
"           gl_FragColor = lightingFactor;",
"       }",
"   }",
"   else if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 1)",
"   {",
"       fragmentColor1 = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));",
"       fragmentColor2 = texture2D(uTextureSamplerColor[1], vec2(vTextureCoord[1].s, vTextureCoord[1].t));",
"       if (uTextureBlendOp == " + RC_MODULATE + ")",
"       {",
"           fragmentColor1.a = fragmentColor2.a;",
"           if (fragmentColor1.a == 0.0) discard;",
"           else gl_FragColor = fragmentColor1 * lightingFactor;",
"       }",
"       else if (uTextureBlendOp == " + RC_REPLACE + ")",
"       {",
"           gl_FragColor = fragmentColor1 * fragmentColor2;",
"       }",
"       else",
"       {",
"           gl_FragColor = lightingFactor;",
"       }",
"   }",
"   else", // uTexturesEnabled == 0 || (uTextureStageEnabled[0] == 0 && uTextureStageEnabled[1] == 1)
"   {",
"       gl_FragColor = lightingFactor;",
"   }",
"}"
].join("\n");


var default_vertex_lighting_vs = [
"#ifdef GL_ES",
"precision highp float;",
"#endif",
"",
"vec4 gAmbient;",
"vec4 gDiffuse;",
"vec4 gSpecular;",
"",
"attribute vec3 aVertexPosition;",
"attribute vec3 aVertexNormal;",
"attribute vec4 aVertexColor;",
"attribute vec2 aTextureCoord0;",   // attributes cannot be arrays and must be specified
"attribute vec2 aTextureCoord1;",   // attributes cannot be arrays and must be specified      
"", 
"uniform mat4 uProjectionMatrix;",
"uniform mat4 uViewMatrix;",
"uniform mat4 uWorldMatrix;",
"uniform mat4 uNormalMatrix;",
"",
"uniform vec4 uGlobalAmbientLight;",
"",
"struct lightSource",
"{",
"   int enabled;",
"   vec4 ambient;",
"   vec4 diffuse;",
"   vec4 specular;",
"   vec4 position;",
"   vec4 spotDirection;",
"   float spotExponent;",
"   float spotCutoff;",
"   float constantAttenuation;",
"   float linearAttenuation;",
"   float quadraticAttenuation;",
"   float range;",
"};",
"uniform lightSource uLightSource[" + gl_MaxLights + "];",
"",
"struct material",
"{",
"   vec4 ambient;",
"   vec4 diffuse;",
"   vec4 specular;",
"   vec4 emissive;",
"   float shininess;",
"};",
"uniform material uFrontMaterial;",
"",
"uniform int uLightingEnabled;",
"",
"varying vec4 vVertexPosition;",
"varying vec4 vLightingFactor;",
"varying vec2 vTextureCoord[" + gl_MaxTextureStages + "];",
"",
"void directionalLight(vec4 position, vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 halfVector)",
"{",
"   vec3 lightDir;",
"   float nDotL;",      // normal . light direction
"   float nDotHV;",     // normal . half-vector
"   float pf;",         // power factor
"",
"   lightDir = normalize(vec3(position));",
"",	
"   nDotL = max(dot(normal, lightDir), 0.0);",
"   if (nDotL == 0.0)",
"   {",
"       pf = 0.0;",
"   }",
"   else",
"   {",
"       nDotHV = max(0.0, dot(normal, halfVector));",
"       pf = pow(nDotHV, uFrontMaterial.shininess);",
"   }",
"",
"   gAmbient  += ambient * uFrontMaterial.ambient;",
"   gDiffuse  += diffuse * uFrontMaterial.diffuse * nDotL;",
"   gSpecular += specular * uFrontMaterial.specular * pf;",
"}",
"",
"void pointLight(vec4 position, float constantAttenuation, float linearAttenuation, float quadraticAttenuation, float range,",
"                vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 eye, vec3 vPosition)",
"{",
"   float nDotL;",      // normal . light direction
"   float nDotHV;",     // normal . light half vector
"   float pf;",         // power factor
"   float attenuation;",// computed attenuation factor
"   float d;",          // distance from surface to light source
"   vec3  L;",          // direction from surface to light position
"   vec3  halfVector;", //
"",
"", // Compute vector from surface to light position
"   L = vec3(position) - vPosition;",
"",
"", // Compute distance between surface and light position; if greater than range, return
"   d = length(L); if (d > range) return;",
"",
"", // Normalize the vector from surface to light position,
"   L = normalize(L);",
"",
"", // Compute attenuation,
"   attenuation = 1.0 / (constantAttenuation +",
"      linearAttenuation * d +",
"      quadraticAttenuation * d * d);",
"",
"   nDotL = max(0.0, dot(normal, L));",
"   nDotHV = max(0.0, dot(normal, normalize(L + eye)));",
"",
"   if (nDotL == 0.0)",
"   {",
"       pf = 0.0;",
"   }",
"   else",
"   {",
"       pf = pow(nDotHV, uFrontMaterial.shininess);",
"   }",
"",    
"   gAmbient  += ambient * uFrontMaterial.ambient * attenuation;",
"   gDiffuse  += diffuse * uFrontMaterial.diffuse * nDotL * attenuation;",
"   gSpecular += specular * uFrontMaterial.specular * pf * attenuation;",
"}",
"",
"void main()",
"{",
"   vec4 transformedNormal;",
"   vec4 viewPosition;",
"   vec4 viewDirection;",
"",
"   vVertexPosition = uWorldMatrix * vec4(aVertexPosition, 1);",
"",
"   if (uLightingEnabled != 0)",
"   {",                    
"       transformedNormal = normalize(uNormalMatrix * vec4(aVertexNormal, 0));",
"       viewPosition = uViewMatrix * vec4(0, 0, 0, 1);",
"       viewDirection = normalize(-viewPosition);",

"       gAmbient = vec4(0, 0, 0, 0);",
"       gDiffuse = vec4(0, 0, 0, 0);",
"       gSpecular = vec4(0, 0, 0, 0);",
"",
"       for (int i=0; i < " + gl_MaxLights + "; i++)",
"       {",
"           if (uLightSource[i].enabled != 0)",
"           {",
"               if (uLightSource[i].position[3] == 0.0)", // directional light
"               {",
"                   directionalLight(uLightSource[i].position, uLightSource[i].ambient,",
"                       uLightSource[i].diffuse, uLightSource[i].specular,",
"                       normalize(vec3(transformedNormal)),",
"                       normalize(vec3(viewDirection) + vec3(uLightSource[i].position)));",
"               }",
"               else if (uLightSource[i].spotCutoff > 90.0)", // point light
"               {",
"                   pointLight(uLightSource[i].position, uLightSource[i].constantAttenuation,",
"                       uLightSource[i].linearAttenuation, uLightSource[i].quadraticAttenuation, uLightSource[i].range,",
"                       uLightSource[i].ambient, uLightSource[i].diffuse, uLightSource[i].specular,",
"                       normalize(vec3(transformedNormal)),",
"                       vec3(viewDirection), vec3(vVertexPosition));",
"               }",
"               else", // spotlight
"               {",
"               }",   
"           }",
"       }",
"",
"       vLightingFactor  = uFrontMaterial.emissive;",
"       vLightingFactor += uGlobalAmbientLight * uFrontMaterial.ambient;", // global ambient contribution
"       vLightingFactor += gAmbient + gDiffuse + gSpecular;", // light contribution(s)
"       vLightingFactor.a = uFrontMaterial.diffuse.a;",
"       vLightingFactor = clamp(vLightingFactor, 0.0, 1.0);",
"",
"   }",
"   else", // uLightingEnabled == 0
"   {",  
"       vLightingFactor = aVertexColor;",
"   }",
"",
"   vTextureCoord[0] = aTextureCoord0;",
"   vTextureCoord[1] = aTextureCoord1;",        
"   gl_Position = uProjectionMatrix * uViewMatrix * vVertexPosition;",
"}"
].join("\n");
    
var default_vertex_lighting_fs = [
"#ifdef GL_ES",
"precision highp float;",
"#endif",
"",
"uniform int uTexturesEnabled;",
"uniform int uTextureStageEnabled[" + gl_MaxTextureStages + "];",       
"uniform sampler2D uTextureSamplerColor[" + gl_MaxTextureStages + "];",
"uniform sampler2D uTextureSamplerAlpha[" + gl_MaxTextureStages + "];",
"uniform int uTextureBlendOp;",
"uniform vec4 uTextureColorMask;",
"uniform vec4 uClipPlane[" + gl_MaxClipPlanes + "];",
"uniform int uClipPlaneEnabled[" + gl_MaxClipPlanes + "];",
"",
"varying vec4 vVertexPosition;",
"varying vec4 vLightingFactor;",
"varying vec2 vTextureCoord[" + gl_MaxTextureStages + "];",
"",
"void main()",
"{",
"   vec4 fragmentColor;",
"   vec4 fragmentColor1;",
"   vec4 fragmentColor2;",
"",
"   for (int i=0; i < " + gl_MaxClipPlanes + "; i++)",
"   {",
"       if (uClipPlaneEnabled[i] != 0)",
"       {",
"           if (dot(vVertexPosition.xyz, uClipPlane[i].xyz) - uClipPlane[i].w >= 0.0) discard;",    
"       }",
"   }",
"",
"   if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 0)",
"   {",
"       fragmentColor = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));",
"       if (fragmentColor.r == uTextureColorMask.r && fragmentColor.g == uTextureColorMask.g && fragmentColor.b == uTextureColorMask.b && fragmentColor.a == uTextureColorMask.a) discard;",
"       if (uTextureBlendOp == " + RC_MODULATE + ")",
"       {",
"           if (fragmentColor.a == 0.0) discard;",
"           else gl_FragColor = fragmentColor * vLightingFactor;",
"       }",
"       else if (uTextureBlendOp == " + RC_REPLACE + ")",
"       {",
"           gl_FragColor = fragmentColor;",
"       }",
"       else",
"       {",
"           gl_FragColor = vLightingFactor;",
"       }",
"   }",
"   else if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 1)",
"   {",
"       fragmentColor1 = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));",
"       fragmentColor2 = texture2D(uTextureSamplerColor[1], vec2(vTextureCoord[1].s, vTextureCoord[1].t));",
"       if (uTextureBlendOp == " + RC_MODULATE + ")",
"       {",
"           fragmentColor1.a = fragmentColor2.a;",
"           if (fragmentColor1.a == 0.0) discard;",
"           else gl_FragColor = fragmentColor1 * vLightingFactor;",
"       }",
"       else if (uTextureBlendOp == " + RC_REPLACE + ")",
"       {",
"           gl_FragColor = fragmentColor1 * fragmentColor2;",
"       }",
"       else",
"       {",
"           gl_FragColor = vLightingFactor;",
"       }",
"   }",
"   else", // uTexturesEnabled == 0 || (uTextureStageEnabled[0] == 0 && uTextureStageEnabled[1] == 0)
"   {",
"       gl_FragColor = vLightingFactor;",
"   }",
"}"
].join("\n");
var pcf_shadow_mapping_depth_pass_vs = [
"#ifdef GL_ES",
"precision highp float;",
"#endif",
"",
"attribute vec3 aVertexPosition;",
"attribute vec3 aVertexNormal;", 
"", 
"uniform mat4 uProjectionMatrix;",
"uniform mat4 uViewMatrix;",
"uniform mat4 uWorldMatrix;",
"uniform mat4 uNormalMatrix;",
"",
"varying vec4 vVertexPosition;",
"varying vec4 vTransformedNormal;",
"",
"void main()",
"{",
"   vVertexPosition = uWorldMatrix * vec4(aVertexPosition, 1);",
"   vTransformedNormal = normalize(uNormalMatrix * vec4(aVertexNormal, 0));",
"   gl_Position = uProjectionMatrix * uViewMatrix * vVertexPosition;",
"}"
].join("\n");

var pcf_shadow_mapping_depth_pass_fs = [
"#ifdef GL_ES",
"precision highp float;",
"#endif",
//"#extension GL_OES_standard_derivatives : enable",
"",
"uniform vec3 uShadowCasterWorldPosition;",
"uniform int uModelID;",
"",
"varying vec4 vVertexPosition;",
"varying vec4 vTransformedNormal;",
"",
"void main()",
"{",
"   float depth = length(vVertexPosition.xyz - uShadowCasterWorldPosition);",
//"   float moment1 = depth;",
//"   float moment2 = depth * depth;",
//"   float dx = dFdx(depth);",
//"   float dy = dFdy(depth);",
//"   moment2 += 0.25*(dx*dx+dy*dy);", 
//"   gl_FragColor = vec4(moment1, moment2, 0, 0);",
"   gl_FragColor = vec4(depth, uModelID, 0, 0);",
"}"
].join("\n");
var pcf_shadow_mapping_render_pass_vs = [
"attribute vec3 aVertexPosition;",
"attribute vec3 aVertexNormal;",
"attribute vec4 aVertexColor;",
"attribute vec2 aTextureCoord0;",   // attributes cannot be arrays and must be specified
"attribute vec2 aTextureCoord1;",   // attributes cannot be arrays and must be specified      
"", 
"uniform mat4 uProjectionMatrix;",
"uniform mat4 uViewMatrix;",
"uniform mat4 uWorldMatrix;",
"uniform mat4 uNormalMatrix;",
"",
"varying vec4 vVertexPosition;",
"varying vec4 vTransformedNormal;",
"varying vec4 vVertexColor;",
"varying vec4 vViewPosition;",
"varying vec4 vViewDirection;",
"varying vec2 vTextureCoord[" + gl_MaxTextureStages + "];",
"",
"void main()",
"{",
"   vVertexPosition = uWorldMatrix * vec4(aVertexPosition, 1);",
"   vTransformedNormal = normalize(uNormalMatrix * vec4(aVertexNormal, 0));",
"   vVertexColor = aVertexColor;",
"   vViewPosition = uViewMatrix * vec4(0, 0, 0, 1);",
"   vViewDirection = normalize(-vViewPosition);",
"   vTextureCoord[0] = aTextureCoord0;",
"   vTextureCoord[1] = aTextureCoord1;",        
"   gl_Position = uProjectionMatrix * uViewMatrix * vVertexPosition;",
"}"
].join("\n");

var pcf_shadow_mapping_render_pass_fs = [
"#ifdef GL_ES",
"precision highp float;",
"#endif",
"",
"#define EPSILON 0.1",
"",
"vec4 gAmbient;",
"vec4 gDiffuse;",
"vec4 gSpecular;",
"",
"uniform vec4 uGlobalAmbientLight;",                    
"",
"struct lightSource",
"{",
"   int enabled;",
"   vec4 ambient;",
"   vec4 diffuse;",
"   vec4 specular;",
"   vec4 position;",
"   vec4 spotDirection;",
"   float spotExponent;",
"   float spotCutoff;",
"   float constantAttenuation;",
"   float linearAttenuation;",
"   float quadraticAttenuation;",
"   float range;",
"};",
"uniform lightSource uLightSource[" + gl_MaxLights + "];",
"",
"struct material",
"{",
"   vec4 ambient;",
"   vec4 diffuse;",
"   vec4 specular;",
"   vec4 emissive;",
"   float shininess;",
"};",
"uniform material uFrontMaterial;",
"",
"uniform int uLightingEnabled;",
"uniform int uTexturesEnabled;",
"uniform int uTextureStageEnabled[" + gl_MaxTextureStages + "];",       
"uniform sampler2D uTextureSamplerColor[" + gl_MaxTextureStages + "];",
"uniform sampler2D uTextureSamplerAlpha[" + gl_MaxTextureStages + "];",
"uniform samplerCube uTextureSamplerShadowMap;",
"uniform int uTextureBlendOp;",
"uniform vec4 uTextureColorMask;",
"uniform vec4 uClipPlane[" + gl_MaxClipPlanes + "];",
"uniform int uClipPlaneEnabled[" + gl_MaxClipPlanes + "];",
"uniform vec3 uShadowCasterWorldPosition;",
"uniform int uModelID;",
"",
"varying vec4 vVertexPosition;",
"varying vec4 vTransformedNormal;",
"varying vec4 vVertexColor;",
"varying vec4 vViewPosition;",
"varying vec4 vViewDirection;",
"varying vec2 vTextureCoord[" + gl_MaxTextureStages + "];",
"",
"float shadowFactor(vec3 lightDirection, float cosTheta)",
"{",
"   float distance = length(lightDirection);",
"   lightDirection.y = -lightDirection.y;",
"   vec2 moments = textureCube(uTextureSamplerShadowMap, lightDirection).rg;", 
//"   float moment = textureCube(uTextureSamplerShadowMap, lightDirection).r;",
"",
"   float bias = EPSILON * tan(acos(cosTheta));",
"   if (distance <= moments.x + bias)",
//"   if (distance <= moment + bias)",
"       return 1.0;",
"   else if (abs(float(uModelID) - moments.y) >= 1.0)",
"   {",
//"       float variance = moments.y - (moments.x * moments.x);",
//"       variance = max(variance, 0.07);",
//"",
//"       float d = distance - moments.x;",
//"       float p_max = variance / (variance + d * d);",
//"", 
"       return 0.25;//p_max;",
"   }",
"   else return 1.0;",
"}",
"",
"void directionalLight(vec4 position, vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 halfVector)",
"{",
"   vec3 lightDir;",
"   float nDotL;",      // normal . light direction
"   float nDotHV;",     // normal . half-vector
"   float pf;",         // power factor
"",
"   lightDir = normalize(vec3(position));",
"",	
"   nDotL = max(dot(normal, lightDir), 0.0);",
"   if (nDotL == 0.0)",
"   {",
"       pf = 0.0;",
"   }",
"   else",
"   {",
"       nDotHV = max(0.0, dot(normal, halfVector));",
"       pf = pow(nDotHV, uFrontMaterial.shininess);",
"   }",
"",
"   gAmbient  += ambient * uFrontMaterial.ambient;",
"   gDiffuse  += diffuse * uFrontMaterial.diffuse * nDotL;",
"   gSpecular += specular * uFrontMaterial.specular * pf;",
"}",
"",
"void pointLight(vec4 position, float constantAttenuation, float linearAttenuation, float quadraticAttenuation, float range,",
"                vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 eye, vec3 vPosition)",
"{",
"   float nDotL;",      // normal . light direction
"   float nDotHV;",     // normal . light half vector
"   float pf;",         // power factor
"   float attenuation;",// computed attenuation factor
"   float d;",          // distance from surface to light source
"   vec3  L;",          // direction from surface to light position
"   vec3  halfVector;", //
"",
"", // Compute vector from surface to light position
"   L = vec3(position) - vPosition;",
"",
"", // Compute distance between surface and light position; if greater than range, return
"   d = length(L); if (d > range) return;",
"",
"", // Normalize the vector from surface to light position,
"   L = normalize(L);",
"",
"", // Compute attenuation,
"   attenuation = 1.0 / (constantAttenuation +",
"      linearAttenuation * d +",
"      quadraticAttenuation * d * d) *",
"      shadowFactor(vPosition - uShadowCasterWorldPosition, max(0.0, dot(normal, L)));",
"",
"   nDotL = max(0.0, dot(normal, L));",
"   nDotHV = max(0.0, dot(normal, normalize(L + eye)));",
"",
"   if (nDotL == 0.0)",
"   {",
"       pf = 0.0;",
"   }",
"   else",
"   {",
"       pf = pow(nDotHV, uFrontMaterial.shininess);",
"   }",
"",    
"   gAmbient  += ambient * uFrontMaterial.ambient * attenuation;",
"   gDiffuse  += diffuse * uFrontMaterial.diffuse * nDotL * attenuation;",
"   gSpecular += specular * uFrontMaterial.specular * pf * attenuation;",
"}",
"",
"void main()",
"{",
"   vec4 lightingFactor;",
"   if (uLightingEnabled != 0)",
"   {",
"       gAmbient = vec4(0, 0, 0, 0);",
"       gDiffuse = vec4(0, 0, 0, 0);",
"       gSpecular = vec4(0, 0, 0, 0);",
"",
"       for (int i=0; i < " + gl_MaxLights + "; i++)",
"       {",
"           if (uLightSource[i].enabled != 0)",
"           {",
"               if (uLightSource[i].position[3] == 0.0)", // directional light
"               {",
"                   directionalLight(uLightSource[i].position, uLightSource[i].ambient,",
"                       uLightSource[i].diffuse, uLightSource[i].specular,",
"                       normalize(vec3(vTransformedNormal)),",
"                       normalize(vec3(vViewDirection) + vec3(uLightSource[i].position)));",
"               }",
"               else if (uLightSource[i].spotCutoff > 90.0)", // point light
"               {",
"                   pointLight(uLightSource[i].position, uLightSource[i].constantAttenuation,",
"                       uLightSource[i].linearAttenuation, uLightSource[i].quadraticAttenuation, uLightSource[i].range,",
"                       uLightSource[i].ambient, uLightSource[i].diffuse, uLightSource[i].specular,",
"                       normalize(vec3(vTransformedNormal)),",
"                       vec3(vViewDirection), vec3(vVertexPosition));",
"               }",
"               else", // spotlight
"               {",
"               }",   
"           }",
"       }",
"",
"       lightingFactor  = uGlobalAmbientLight * uFrontMaterial.ambient;", // global ambient contribution
"       lightingFactor += gAmbient + gDiffuse + gSpecular;", // light contribution(s)
"       lightingFactor.a  = uFrontMaterial.ambient.a / 3.0 + ",
"                           uFrontMaterial.diffuse.a / 3.0 + ",
"                           uFrontMaterial.specular.a / 3.0;",
"   }",
"   else", // uLightingEnabled == 0
"   {",
"       lightingFactor = vVertexColor;",
"   }",
"",
"   vec4 fragmentColor;",
"   vec4 fragmentColor1;",
"   vec4 fragmentColor2;",
"",
"   for (int i=0; i < " + gl_MaxClipPlanes + "; i++)",
"   {",
"       if (uClipPlaneEnabled[i] != 0)",
"       {",
"           if (dot(vVertexPosition.xyz, uClipPlane[i].xyz) - uClipPlane[i].w >= 0.0) discard;",    
"       }",
"   }",
"",
"   if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 0)",
"   {",
"       fragmentColor = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));",
"       if (fragmentColor.r == uTextureColorMask.r && fragmentColor.g == uTextureColorMask.g && fragmentColor.b == uTextureColorMask.b && fragmentColor.a == uTextureColorMask.a) discard;",
"       if (uTextureBlendOp == " + RC_MODULATE + ")",
"       {",
"           if (fragmentColor.a == 0.0) discard;",
"           else gl_FragColor = fragmentColor * lightingFactor;",
"       }",
"       else if (uTextureBlendOp == " + RC_REPLACE + ")",
"       {",
"           gl_FragColor = fragmentColor;",
"       }",
"       else",
"       {",
"           gl_FragColor = lightingFactor;",
"       }",
"   }",
"   else if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 1)",
"   {",
"       fragmentColor1 = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));",
"       fragmentColor2 = texture2D(uTextureSamplerColor[1], vec2(vTextureCoord[1].s, vTextureCoord[1].t));",
"       if (uTextureBlendOp == " + RC_MODULATE + ")",
"       {",
"           fragmentColor1.a = fragmentColor2.a;",
"           if (fragmentColor1.a == 0.0) discard;",
"           else gl_FragColor = fragmentColor1 * lightingFactor;",
"       }",
"       else if (uTextureBlendOp == " + RC_REPLACE + ")",
"       {",
"           gl_FragColor = fragmentColor1 * fragmentColor2;",
"       }",
"       else",
"       {",
"           gl_FragColor = lightingFactor;",
"       }",
"   }",
"   else", // uTexturesEnabled == 0 || (uTextureStageEnabled[0] == 0 && uTextureStageEnabled[1] == 1)
"   {",
"       gl_FragColor = lightingFactor;",
"   }",
"}"
].join("\n");


ContentHandler.prototype = new AttributeContainer();
ContentHandler.prototype.constructor = ContentHandler;

function ContentHandler()
{
    AttributeContainer.call(this);
    this.className = "ContentHandler";
    
    this.contentDirectory = new StringAttr("");
    this.url = new StringAttr("");
    
    this.registerAttribute(this.contentDirectory, "contentDirectory");
    this.registerAttribute(this.url, "url");
}

ContentHandler.prototype.parseFileStream = function(file)
{
}

ContentHandler.prototype.matchesType = function(type)
{
}

ContentBuilder.prototype = new AttributeContainer();
ContentBuilder.prototype.constructor = ContentBuilder;

function ContentBuilder()
{
    AttributeContainer.call(this);
    this.className = "ContentBuilder";
    
    this.factory = null;
    
    this.cameras = [];
    this.lights = [];
    this.models = [];
    this.evaluators = [];
    
    this.layer = 0;
    this.invertAlpha = new BooleanAttr(false);
    
    this.registerAttribute(this.invertAlpha, "invertAlpha");
}

ContentBuilder.prototype.setRegistry = function(registry)
{
    AttributeContainer.prototype.setRegistry.call(this, registry); 
    
    this.factory = this.registry.find("AttributeFactory");   
}

ContentBuilder.prototype.visitHandler = function(handler)
{
}
/*
ContentBuilder.prototype.configure = function(models, evaluators)
{
    this.models = models;
    this.evaluators = evaluators;
}
*/
ContentBuilder.prototype.finalize = function()
{
}

ContentBuilder.prototype.matchesType = function(type)
{
}

function BinaryParser(stream, bigEndian)
{
    this.stream = stream;
    this.bigEndian = bigEndian;
    
    this.readUInt8  = function() { return this.decodeInt(8, false); }
    this.readUInt16 = function() { return this.decodeInt(16, false); }
    this.readUInt32 = function() { return this.decodeInt(32, false); }
    this.readInt8   = function() { return this.decodeInt(8, true); }
    this.readInt16  = function() { return this.decodeInt(16, true); }
    this.readInt32  = function() { return this.decodeInt(32, true); }
    this.readFloat32 = function(){ return this.decodeFloat32(); }
   
    var pos = 0;
     
    this.decodeInt = function(bits, signed)
    {
        var sum = 0;
        var bytes = bits / 8;
        var byteValue = 0;
        
        // sum bytes
        for (var B=0; B < bytes; B++)
        {
            byteValue = this.bigEndian ? this.stream.charCodeAt(pos+B) 
                                       : this.stream.charCodeAt(pos+(bytes-B-1));
            // sum bits
            for (var b=7; b >= 0; b--)
            {
                sum = sum * 2 + ((1 << b) & byteValue ? 1 : 0);
            }
        }
        
        // account for sign
        if (signed)
        {
            max = Math.pow(2, bits);
            sum = sum >= max / 2 ? sum - max : sum;
        }
        
        // advance stream position
        pos += bytes;
        
        return sum;
	}
	
	// based upon example from: http://en.wikipedia.org/wiki/Binary32
	this.decodeFloat32 = function()
	{
	    var sum = 0;
	    var bytes = 4;
	    var byteValue = new Array(bytes);
	    
	    // read the bytes representing the float
	    for (var B=0; B < bytes; B++)
	    {
	        this.bigEndian ? byteValue[B] = this.stream.charCodeAt(pos+B)
	                       : byteValue[B] = this.stream.charCodeAt(pos+(bytes-B-1));
	    }
	    
	    // read sign bit (bit 31)
	    var negative = byteValue[0] & 0x80;

	    // read exponent bits (bits 30-23)
	    var exponent = 0; 
	    for (var e=6; e >= 0; e--)
        {
            exponent = exponent * 2 + ((1 << e) & byteValue[0] ? 1 : 0);
        }
        exponent = exponent * 2 + (0x80 & byteValue[1] ? 1 : 0);
	    
	    // read significand bits (bits 22-0)
	    var significand = 0;
	    // byte 1
	    for (var s=6; s >= 0; s--)
	    {
	        significand = significand * 2 + ((1 << s) & byteValue[1] ? 1 : 0);
	    }
	    // byte 2, 3
	    for (var B=2; B <= 3; B++)
	    {
	        for (var s=7; s >= 0; s--)
	        {
	            significand = significand * 2 + ((1 << s) & byteValue[B] ? 1 : 0);
	        }
	    }

        // decode exponent by subtracting 127
        var decodedExponent = exponent - 127;
        
        // decode the significand using:
        // each of the 24 bits of the significand, bit 23 to bit 0, represents a value, 
        // starting at 1 and halves for each bit:
        // bit 23 = 1
        // bit 22 = 0.5
        // bit 21 = 0.25
        // bit 20 = 0.125
        // bit 19 = 0.0625
        // .
        // .
        // bit  0 = 0.00000011920928955078125
        var decodedSignificand = 1; // implicit 24th bit set to 1
        var bitvalue = 1;
        for (var s=23; s >= 0; s--)
        {
            decodedSignificand = decodedSignificand + ((1 << s) & significand ? bitvalue : 0);
            bitvalue /= 2;
        }
        
        // multiply significand with the base, 2, to the power of the exponent to get the final result
        sum = decodedSignificand * Math.pow(2, decodedExponent) * (negative ? -1 : 1);
        
	    // advance stream position
	    pos += bytes;
	    
	    return sum;
	}
}
function TextParser(stream)
{
    this.stream = stream;

    var pos = 0;

    this.readCharacter = function ()
    {
        if (pos >= this.stream.length)
            return null;

        return this.stream[pos++];
    }

    this.readToken = function ()
    {
        var c;
        var token = "";

        if (pos >= this.stream.length)
            return null;

        // read leading whitespace
        do
        {
            c = this.stream[pos++];
        }
        while (pos <= this.stream.length && isSpace(c));

        // read token
        do
        {
            token += c;
            c = this.stream[pos++];
        }
        while (pos <= this.stream.length && !isSpace(c));

        return (token.length > 0 ? token : null);
    }

    this.readLine = function ()
    {
        var line = "";

        if (pos >= this.stream.length)
            return null;

        while (pos < this.stream.length && this.stream[pos] != '\n')
        {
            line += this.stream[pos++];
        }
        pos++;

        return line;
    }

    this.readLineTokens = function ()
    {
        var c;
        var p = 0;
        var token = "";
        var tokens = [];

        var line = this.readLine();
        if (line == null)
            return null;

        while (p < line.length)
        {
            // read leading whitespace
            do
            {
                c = line[p++];
            }
            while (p <= line.length && isSpace(c));

            // read token
            do
            {
                token += c;
                c = line[p++];
            }
            while (p <= line.length && !isSpace(c));

            tokens.push(token);
            token = "";
        }

        return tokens;
    }
}
function XMLParser(factory, registry, contentDir)
{
    this.factory = factory;
    this.registry = registry;
    this.contentDir = contentDir;
    this.attributeStack = new Stack();
    this.collectionCountStack = new Stack();
}

XMLParser.prototype.parse = function(xml)
{
    parser = new SAXDriver();
   
    parser.setDocumentHandler(this);
    parser.setErrorHandler(this);
    parser.setLexicalHandler(this);

    parser.parse(xml);
}

XMLParser.prototype.processingInstruction = function(target, data)
{
    switch (target)
    {
        case "bw":
            {
                // TODO
                console.debug("TODO: " + target.toString());
            }
            break;

        case "bwinclude":
            {
                var dataString = new String(data);

                // url
                var url = this.parseTokenValue(dataString, "url=\"", "\"");
                if (url)
                {
                    console.debug("Processing Instruction for: " + url);
                    var ext = getFileExtension(url);
                    switch (ext) {
                    case "xml":
                        {
                            var xml = loadXMLResource(this.contentDir + "/" + url);
                            this.parse(xml);
                        }
                        break;
                        // TODO: abstract this dependency away from here
                    case "lws":
                        {
                            var pathInfo = formatPath(url);
                            console.debug("Include instruction for path: " + pathInfo[0]);
                            console.debug("Include content dir: " + pathInfo[1]);
            
                            var contentHandler = new LWSceneHandler();
                            contentHandler.getAttribute("contentDirectory").setValueDirect(pathInfo[1]);
            
                            var contentBuilder = new LWSceneBuilder(); 
                            contentBuilder.setRegistry(this.factory.registry);
                            contentBuilder.visitHandler(contentHandler);
            
                            contentHandler.parseFileStream(pathInfo[0]); 
                        }
                        break;
                    }
                }
            }
            break;
    }
}

XMLParser.prototype.startElement = function(name, atts) 
{
    // by convention, AttributeContainers start with capital letters, and 
    // complex attributes do not.
    if (isUpper(name[0]))
    {
        this.parseAttributeContainer(name, atts);
    }
    else 
    {
        this.parseComplexAttribute(name, atts);
    }
}

XMLParser.prototype.endElement = function(name) 
{
    // by convention, AttributeContainers start with capital letters, and 
    // complex attributes do not.
    if (isUpper(name[0]))
    {
        this.parseAttributeContainer(name);
    }
    else 
    {
        this.parseComplexAttribute(name);
    }
}

XMLParser.prototype.startCDATA = function()
{
}

XMLParser.prototype.endCDATA = function()
{
}

XMLParser.prototype.characters = function(data, start, length)
{
    var value = "";
    for (var i = 0; i < length; i++)
    {
        value += data[start + i];
    }
    if (value.length && !isSpace(value[0]))
    {
        var attribute = this.attributeStack.top();
        if (attribute)
        {
            // TODO: resolve reference
            deserializeAttribute(attribute, value);
        }
    }
}

XMLParser.prototype.error = function(exception) 
{
    alert('Error: ' + exception.getMessage());
}

XMLParser.prototype.fatalError = function(exception) 
{
    alert('Fatal Error: ' + exception.getMessage());
}

XMLParser.prototype.parseAttributeContainer = function(name, atts)
{
    if (atts) // element start
    {
        var attribute = this.factory.create(name);
        if (!attribute)
        {
            this.attributeStack.push(null); // for corresponding pop at closing tag
            return;
        }
        attribute.flagDeserializedFromXML();

        if (!resolveAttributeContainerReference(attribute, atts.m_parser.m_atts, this.registry))
        {
            deserializeAttributeContainer(attribute, atts.m_parser.m_atts);
        }

        this.registry.registerResource(attribute);
        
        // if a collection is at the top of the attribute stack which does not allocate its elements,
        // add the attribute it to the collection
        var container = this.attributeStack.top();
        if (container && container.isCollection())
        {
            if (!container.allocatesElements())
            {
                container.push_back(attribute);
                container.setElementName(attribute, name);

                var count = this.collectionCountStack.top();
                count++;
                this.collectionCountStack.pop();
                this.collectionCountStack.push(count);
            }
            else
            {
                container.setElementName(container.getAt(container.Size() - 1), name);
            }
        }

        this.attributeStack.push(attribute);

        if (attribute.isCollection())
        {
            this.collectionCountStack.push(0);
        }
    }
    else // element end
    {
        var attribute = this.attributeStack.top();

        this.attributeStack.pop();

        if (attribute && attribute.isCollection())
        {
            this.collectionCountStack.pop();
        }

        if (attribute)
        {
            this.factory.finalize(name, attribute);
            this.registry.finalizeResource(attribute);
        }
    }
}

XMLParser.prototype.parseComplexAttribute = function(name, atts)
{
    if (atts) // element start
    {
        var container = this.attributeStack.top();
        if (!container) return;

        var attribute = container.getAttribute(name);
        if (!attribute)
        {
            // check for collections here... if a collection is at the top of 
            // the attribute stack, resize the collection (if necessary) to accomodate
            // the current attribute being deserialized
            if (container.isCollection())
            {
                var count = this.collectionCountStack.top();
                count++;

                var size = container.Size();

                if (container.AppendParsedElements())
                {
                    container.resize(size + 1);
                    count = size;
                }
                else if (size <= count)
                {
                    container.resize(count + 1);
                }

                attribute = container.getAt(count);
            }
            else
            {
                this.attributeStack.push(container); // for corresponding pop at closing tag (push container so that child complex attributes can access)
                return;
            }
        }

        this.attributeStack.push(attribute);

        if (attribute && attribute.isContainer())
        {
            if (!resolveAttributeContainerReference(attribute, atts.m_parser.m_atts, this.registry))
            {
                deserializeAttributeContainer(attribute, atts.m_parser.m_atts);
            }

            if (attribute.isCollection())
            {
                this.collectionCountStack.push(0);
            }
        }
        else if (attribute)
        {
            if (!resolveComplexAttributeReference(attribute, atts.m_parser.m_atts))
            {
                deserializeComplexAttribute(attribute, atts.m_parser.m_atts);
            }
        }
    }
    else // element end
    {
        this.attributeStack.pop();

        if (container && container.isCollection())
        {
            this.collectionCountStack.pop();
        }
    }
}

XMLParser.prototype.parsePrimitiveAttribute = function()
{

}

XMLParser.prototype.parseTokenValue = function(string, delim_begin, delim_end)
{
    var begin = string.indexOf(delim_begin);
    if (begin == -1)
    {
        return undefined;
    }
    begin += delim_begin.length;

    var end = string.indexOf(delim_end, begin);
    if (end == -1)
    {
        return undefined;
    }

    return string.substring(begin, end);
}


Serializer.prototype = new AttributeContainer();
Serializer.prototype.constructor = Serializer;

function Serializer()
{
    AttributeContainer.call(this);
    this.className = "Serializer";

    this.pbMixed = null;
    this.bMixed = false;
    this.DOM  = null;
    this.RootElement = null;
    this.elementStack = new Stack();
    
    this.format = new StringAttr("xml");
    this.serializeMinimum = new BooleanAttr(false);
    this.serializeChildren = new BooleanAttr(false);
    
    this.registerAttribute(this.format, "format");
    this.registerAttribute(this.serializeMinimum, "serializeMinimum");
    this.registerAttribute(this.serializeChildren, "serializeChildren");
}

Serializer.prototype.serialize = function(attribute, item, attributeName, container)
{
	this.RootElement = null;
    this.DOM  = document.implementation.createDocument("", "__InitialRoot", null); 
    if (this.DOM)
    {
        if (this.RootElement)
        {
            this.DOM.removeChild(this.RootElement);
            this.RootElement = null;

            this.mixedModifiedCB(attr,data);
        }
        if (attribute)
        {
            this.serializeAttribute(attribute, item, attributeName);
        }
        else
        {
            this.serializeAttribute(container, 0, "");
        }
    }
}

Serializer.prototype.serializeAttribute = function(attribute, item, attrName)
{
    if (attribute)
    {
        if (attribute.isTransient()) // don't serialize transient attributes
        {
            return;
        }
        
        if (this.serializeMinimum.getValueDirect() == true &&
            !attribute.isDeserializedFromXML()) // if requested, don't serialize defaults
        {
            return;
        }
        
        if (attribute.attrType == eAttrType.Model)
        {
            var model = attribute;
            this.serializeModel(model);
        }
        else if (attribute.attrType == eAttrType.PerspectiveCamera)
        {
            var ctr = attribute;
            this.serializeAttributeContainer(ctr);
        }
        else if (attribute.attrType > eAttrType.Command &&
                 attribute.attrType < eAttrType.Command_End)
        {
            var cmd = attribute;
            this.serializeCommand(cmd);
        }
        else if (attribute.isCollection())
        {
            var ctr = attribute;
            this.serializeAttributeCollection(ctr, attrName);
        }
        else if (attribute.isContainer())
        {
            var ctr = attribute;
            this.serializeAttributeContainer(ctr, attrName);
        }
        else if (attrName && this.DOM)
        {
            var aType = attribute.attrType;
            var element = null;
            var itemElement = null;
            var itemAttr = null;
            var attrMap = null;
            var strItemAttr;
            var vecVal;
            var varVal;

            var len = attribute.getLength();
            if (attrName)
            {
                // serializer cannot put "(" or ")" in the XML tag name,
                // so convert parentheses to a string that is value,
                // which is then converted back to parentheses in the result
                // of serialization
                
                var index = 0;
                while (true)
                {
                    /* Locate the substring to replace. */
                    index = attrName.indexOf("(");
                    if (index == -1) break;

                    /* Make the replacement. */
                    attrName.replace(index, 1, "_x0028");
                }
                while (true)
                {
                    /* Locate the substring to replace. */
                    index = attrName.indexOf(")");
                    if (index == -1) break;

                    /* Make the replacement. */
                    attrName.replace(index, 1, "_x0029");
                }
                var bstr = attrName;
                if (bstr)
                {
                    element = this.DOM.createElement(bstr);
                    if (element)
                    {
                        var strValue;
                        strValue = this.getAttributeStringValue(attribute, item);
                        if (strValue == "") return;

                        if (item >= 0 || len == 1 || aType == eAttrType.StringAttr)
                        {
                            // Check for a CDATA section:
                            // CDATA sections are used for CStringAttrs
                            // containing special characters, including XML.
                            // CDATA behaves as it does in SAX, i.e., it
                            // is not parsed.  It is instead passed directly
                            // to the Attribute as a string literal.

                            // TODO:  Move this "constant" to a shared location.
                            // It is also used by XMLTokenizer
                            var strCdataStart = "<![CDATA[";
                            var strCdataEnd = "]]>";

                            var nStartPos = 0;
                            var nEndPos = strValue.indexOf(strCdataEnd);
                            if (nStartPos != -1 && nEndPos != -1)
                            {

                                nStartPos += strCdataStart.length;

                                strValue = strValue.substr(nStartPos, strValue.length-nStartPos-strCdataEnd.length);
                                var cdata = null;
                                bstr = strValue;
                                if (bstr)
                                {
                                    cdata = this.DOM.createCDATASection(bstr);
                                }
                                element.appendChild(cdata);
                            }
                            else
                            {
                                element.textContent = strValue;
                            }
                        }
                        else
                        {
                            var sv;
                            var startNdx = 0;
                            var endNdx = 0;
                            for (var i = 0; i < len; ++i)	// len - 1 = # of commas
                            {
                                strItemAttr = "item" + i.toString();

                                endNdx = (i == len-1) ? strValue.length : strValue.indexOf(",", startNdx);
                                sv = strValue.substr(startNdx, endNdx-startNdx);

                                startNdx = endNdx+1;

                                if (this.bMixed)
                                {
                                    itemElement = this.DOM.createElement(strItemAttr);
                                    itemElement.textValue = sv;
                                    element.appendChild(itemElement);
                                }
                                else
                                {
                                    itemAttr = this.DOM.createAttribute(strItemAttr);
                                    itemAttr.value = sv;
                                    element.setAttributeNode(itemAttr);
                                }
                            }
                        }

                        this.pushElement(element);
                        this.popElement();
                    }
                }
            }
        }
    }
}
Serializer.prototype.serializeAttributeReference = function(attribute, reference)
{
    if (attribute && reference && this.DOM)
    {
        var container = null;
        var element = null;
        var itemAttr = null;
        var attrMap = null;
        var pOldChild = null;

        container = attribute.getContainer();
        if (container)
        {
            var bstr = container.getAttributeName(attribute);
            if (bstr)
            {
                element = this.DOM.createElement(bstr);
            }
        }
        if (element)
        {
            if (element.attributes.length > 0)
            {
                itemAttr = this.DOM.createAttribute("ref");

                if (itemAttr)
                {
                    var refName = "";
                    var tmpName = "";
                    var nameAttr = null;
                    container = reference.getContainer();
                    if (container)
                    {
                        refName = container.getAttributeName(reference);
                        if (nameAttr = container.getAttribute("name"))
                        {
                            var s;
                            tmpName = nameAttr.getValueDirect().join("");
                            tmpName += "/";
                            tmpName += refName;
                            refName = tmpName;
                        }
                    }
                    itemAttr.textContent = refName;
                    attrMap.setNamedItem(itemAttr, pOldChild);
                }
            }

            this.pushElement(element);
            this.popElement();
        }
    }
}

Serializer.prototype.serializeModel = function(Model)
{
    // surround <Model> and <Set> tags so that both will serialize (previously the
    // <Set> was overwriting the <Model> as the root)
    var bstr = null;
    var element = null;
    if (this.DOM)
    {
        bstr = "ModelRoot";
        if (bstr)
        {
            element = this.DOM.createElement(bstr);
            if (element)
            {
                this.pushElement(element);
            }
        }
    }

    if (Model)
    {
        // serialize Model
        this.serializeAttributeContainer(Model);

        // add set command for rotation group's quaternion rotation, to retain rotation caused by object inspection
        var RotGroup = null;
        if (RotGroup = getInspectionGroup(Model))
        {
            var container = Model;
            var attr = RotGroup.getChild(2).getAttribute("rotationQuat");

            var containerName;
            var containerNameAttr = container.getAttribute("name");
            containerName = containerNameAttr.getValueDirect().join("");

            var command = null;
            var factory = this.registry.find("AttributeFactory");
            command = factory.create("Set");
            if (command)
            {
                command.getAttribute("target").setValueDirect(containerName);
                command.getAttribute("target").flagDeserializedFromXML();

                var values = [];
                attr.getValue(values);

                command.attributeValuePairs.push(new Pair(attr, values));
                
                this.serializeCommand(command);
                
                // setting the target on the SetCommand sets the attribute bin, which is normally
                // cleared by adding the command to the CommandMgr, but this doesn't occur here, because
                // it is only being serialized, not executed
                setAttributeBin(null);
                setAttributePairs(null);
            }
        }
    }

    if (element)
    {
        this.popElement();
    }
}

Serializer.prototype.serializeCommand = function(command)
{
    var i;
    // 1. create the start tag.

    if (command && this.DOM)
    {
        var element = null;
        var pcszType = command.className;
               
        // don't serialize SerializeCommand
        if (pcszType == "Serialize") return;
        
        var bstr = pcszType;
        if (bstr)
        {
            //this.DOM.createElement(bstr, element); Can only pass in a string value for this and only has 1 parameter
            element = this.DOM.createElement(bstr);
            if (element) {
                this.pushElement(element);

                // 2. serialize the native attributes (except "sourceContainer", "sourceEvaluator",
                //    "sourceAttribute", "sourceOutput", "source", "targetContainer", "targetAttribute", "target")
                var i;
                var attribute = null;
                var pcszName = null;
                var uiAttrCount = command.getAttributeCount();
                for (i = 0; i < uiAttrCount; ++i) {
                    attribute = command.getAttributeAt(i);
                    pcszName = command.getAttributeName(attribute);
                    if (!command.isBorrowed(attribute) &&
                        (pcszName != "sourceContainer") &&
                        (pcszName != "sourceEvaluator") &&
                        (pcszName != "sourceAttribute") &&
                        (pcszName != "sourceOutput") &&
                        (pcszName != "source") &&
                        (pcszName != "targetContainer") &&
                        (pcszName != "targetAttribute") &&
                        (pcszName != "target")) {
                        this.serializeAttribute(attribute, -1, pcszName);
                    }
                }

                // 3. serialize "sourceContainer", "targetContainer"
                attribute = command.getAttribute("sourceContainer");
                if (attribute) {
                    this.serializeAttribute(attribute, -1, "sourceContainer");
                }
                attribute = command.getAttribute("targetContainer");
                if (attribute) {
                    this.serializeAttribute(attribute, -1, "targetContainer");
                }

                // 4. serialize "sourceAttribute", "targetAttribute", "target" (may be multiple source/target pairs)
                var sources = [];
                var targets = [];
                for (i = 0; i < uiAttrCount; ++i) 
                {
                    //attribute = command.getAttribute(i, pcszName);
                    var attr = command.getAttributeAt(i);
                    var attrName = command.getAttributeName(attr);
                    if (attrName == "sourceAttribute") 
                    {
                        sources.push(attr);
                    }
                    else if (attrName == "targetAttribute") 
                    {
                        targets.push(attr);
                    }
                }
                
                // source/target pairs must be serialized together
                for (i = 0; i < sources.length && i < targets.length; i++) 
                {
                    this.serializeAttribute(sources[i], -1, "sourceAttribute");
                    this.serializeAttribute(targets[i], -1, "targetAttribute");
                }
                // if "targetAttribute" specified, don't serialize "target"
                if (targets.length == 0) 
                {
                    attribute = command.getAttribute("target");
                    if (attribute) 
                    {
                        this.serializeAttribute(attribute, -1, "target");
                    }
                }

                // 5. serialize the borrowed attributes that were modified by the command
                var vNewVal;
                var pRef;
                for (i = 0; i < uiAttrCount; ++i) 
                {
                    attribute = command.getAttributeAt(i);
                    var attrName = command.getAttributeName(attribute);
                    var borrowed = command.isBorrowedAndValueModified(attribute);
                    if (borrowed.borrowed)
                    {
                        var pNewAttribute = newAttribute(attribute.className);
                        if (pNewAttribute) 
                        {
                            setAttributeValue(pNewAttribute, borrowed.value);
                            pNewAttribute.flagDeserializedFromXML();
                            this.serializeAttribute(pNewAttribute, -1, attrName);
                        }
                    }
                    else 
                    {
                    	var borrowed = command.isBorrowedAndReferenceModified(attribute);
                    	if (borrowed.borrowed) 
                    	{
                        	this.serializeAttributeReference(attribute, borrowed.reference);
                        }
                    }
                }

                this.popElement();
            }
        }
    }
}

Serializer.prototype.serializeAttributeContainer = function(container, name)
{
    // 1. create the start tag.

    if (container && this.DOM)
    {
        var element = null;
        var pcszType = name || container.className;
        // TODO: is this the right way to do this?
        if (pcszType == "BwSceneInspector")
        {
            pcszType = "SceneInspector";
        }
        else if (pcszType == "GenericConnector")
        {
            pcszType = "genericConnector";
        }
        else if (pcszType == "PhysicalPropertiesAttr") 
        {
            pcszType = "physicalProperties";
        }
        else if (pcszType == "PlugConnector")
        {
            pcszType = "plugConnector";
        }
        else if (pcszType == "SocketConnector")
        {
            pcszType = "socketConnector";
        }

        var bstr = pcszType;
        if (bstr)
        {
            element = this.DOM.createElement(bstr);
            if (element)
            {
                this.pushElement(element);

                var attribute = null;
                var pcszName = null;
                var uiAttrCount = container.getAttributeCount();

                // 0. serialize any native attributes first
                for (var i = 0; i < uiAttrCount; ++i)
                {
                    attribute = container.getAttributeAt(i);
                    var attrName = container.getAttributeName(attribute);
                    if (attribute.isNative() == true)
                    {
                        this.serializeAttribute(attribute, -1, attrName);
                    }
                }

                // 1. if serialization of children is requested, serialize children
                if (this.serializeChildren.getValueDirect())
                {
                    this.doSerializeChildren(container);
                }

                // 2. serialize the non-native attributes
                for (var i = 0; i < uiAttrCount; ++i)
                {
                    attribute = container.getAttributeAt(i);
                    if (attribute.modificationCount == 0) continue;
                    var attrName = container.getAttributeName(attribute);
                    if (attribute.isNative() == false)
                    {
                        this.serializeAttribute(attribute, -1, attrName);
                    }
                }
                this.popElement();
            }
        }
    }

    // 3. create the end tag.
}

Serializer.prototype.serializeAttributeCollection = function(collection, name)
{
    if (collection && this.DOM)
    {
        var element = null;
        var pcszType = name;//collection.className;

        var bstr = pcszType;
        if (bstr)
        {
            element = this.DOM.createElement(bstr);
            if (element)
            {
                this.pushElement(element);

                // vector
                var attrVec = collection;
                {
                    var elementName;
                    var baseName = attrVec.baseName.getValueDirect().join("");

                    var size = attrVec.Size();
                    for (var i=0; i < size; i++)
                    {
                        elementName = baseName;
                        //elementName += "[";
                        elementName += i.toString();
                        //elementName += "]";

                        this.serializeAttribute(attrVec.getAt(i), 0, elementName);
                    }
                }

                this.popElement();
            }
        }
    }
}

Serializer.prototype.doSerializeChildren = function(root)
{
    if (root.attrType < eAttrType.Node ||
        root.attrType > eAttrType.Node_End)
    {
        return;
    }
    
    for (var i=0; i < root.getChildCount(); i++)
    {
        this.serializeAttribute(root.getChild(i), 0, null);
    }
}

Serializer.prototype.pushElement = function(element)
{
	this.elementStack.push(element);
	    
    if (this.RootElement)
    {
        this.RootElement.appendChild(element);
    }
    else // !this.RootElement
    {
        this.DOM.replaceChild(element, this.DOM.documentElement);
    }

    this.RootElement = element;
}

Serializer.prototype.popElement = function()
{
    this.elementStack.pop();

    if (this.elementStack.length() > 0)
    {
        this.RootElement = this.elementStack.top();
    }
}

Serializer.prototype.getAttributeStringValue = function(attr, item)
{
    strValue = "";

    var e = attr.attrType;

    var index = -1;

    switch (e)
    {
        case eAttrType.NumberAttr:
        {
            var i = attr.getValueDirect();
            strValue = i.toString();
        }
            break;
        case eAttrType.BooleanAttr:
        {
            var b = attr.getValueDirect();
            if (b == true)
            {
            	strValue = "true";
            }
            else
            {
            	strValue = "false";
            }
        }
            break;
        case eAttrType.StringAttr:
        {
            var len = attr.getLength();
            strValue = attr.getValueDirect().join("");
        }
            break;
        case eAttrType.ColorAttr:
        case eAttrType.Vector2DAttr:
        case eAttrType.Vector3DAttr:
        case eAttrType.Matrix4x4Attr:
        case eAttrType.QuaternionAttr:
        {
            var vecVal_F = [];
            attr.getValue(vecVal_F);
            if (item == -1)
            {
                for (var i = 0; i < vecVal_F.length; ++i)
                {
                    strValue += vecVal_F[i].toString();
                    if (i < vecVal_F.length - 1)
                    {
                        strValue += ",";
                    }
                }
            }
            else
            {
                strValue += vecVal_F[item].toString();
            }
        }
            break;
        case eAttrType.NumberArrayAttr:
        case eAttrType.ViewportAttr:
        {
            var vecVal_I = [];
            attr.getValue(vecVal_I);
            if (item == -1)
            {
                for (var i = 0; i < vecVal_I.length; ++i)
                {
                    strValue += vecVal_I[i].toString();
                    if (i < vecVal_I.length - 1)
                    {
                        strValue += ",";
                    }
                }
            }
            else
            {
                strValue += vecVal_I[item].toString();
            }
        }
            break;
        default:
        {
        }
            break;
    }
    
    return strValue;
}

Serializer.prototype.mixedModifiedCB = function(attr,data)
{
    var v = [];
    attr.getValue(v);
    var pSerializer = data;
    if (pSerializer != 0xffffffff)
    {
        pSerializer.bMixed = v[0]; //ASK MICHAEL
    }
}


/**
 *
 */
var ePixelFormat =
{
    Unknown             :-1,
    R8G8B8              : 0,  // 24-bit RGB
    B8G8R8              : 1,  // 24-bit BGR
    X8X8X8              : 2,  // 24-bit RGB (unspecified component order)
    R8G8B8A8            : 3,  // 32-bit RGB Alpha
    B8G8R8A8            : 4,  // 32-bit BGR Alpha
    A8R8G8B8            : 5,  // 32-bit Alpha RGB
    A8B8G8R8            : 6,  // 32-bit Alpha BGR
    X8X8X8X8            : 7,  // 32-bit RGB Alpha (unspecified component order)
    A8                  : 8   //  8-bit Alpha
};

var ePixelMap =
{
    Default             : 0,  // default mapping -- R to R, G to G, B to B, Alpha to Alpha
    RGBToAlpha          : 1   // average RGB components and map to Alpha component
};

function BytesPerPixel(pixelFormat)
{
    switch (pixelFormat)
    {
    case ePixelFormat.R8G8B8:
    case ePixelFormat.B8G8R8:
    case ePixelFormat.X8X8X8:
        return 3;

    case ePixelFormat.R8G8B8A8:
    case ePixelFormat.B8G8R8A8:
    case ePixelFormat.A8R8G8B8:
    case ePixelFormat.A8B8G8R8:
    case ePixelFormat.X8X8X8X8:
        return 4;

    case ePixelFormat.A8:
        return 1;

    default:
        return 0;
    }
}

function TPixel(r, g, b, a)
{
    var red = r || 0;
    var green = g || 0;
    var blue = b || 0;
    var alpha = a || 0;
}

/**
 *
 */
var eImageFormat =
{
    Unknown             :-1,
    RGB                 : 0,
    RGBA                : 1,
    Alpha               : 2,
    Luminance           : 3,
    Luminance_Alpha     : 4
}
function ScaleImage(pixelFormat, widthIn, heightIn, byteAlignmentIn, dataIn, widthOut, heightOut, byteAlignmentOut, dataOut)
{
    // currently supporting image pixel formats: RGBA
    if (pixelFormat != ePixelFormat.R8G8B8A8)
    {
        return false;
    }

    var canvasIn = document.createElement("canvas");
    canvasIn.width = widthIn;
    canvasIn.height = heightIn;
    
    var ctxIn = canvasIn.getContext("2d");
    var imageDataIn = ctxIn.createImageData(widthIn, heightIn);

    var i = 0;
    for (var row = 0; row < heightIn; row++)
    {
        for (var col = 0; col < widthIn; col++)
        {
            for (var component = 0; component < 4; component++, i++)
            {
                imageDataIn.data[i] = dataIn[i];
            }
        }
    }

    ctxIn.putImageData(imageDataIn, 0, 0);

    var canvasOut = document.createElement("canvas");
    canvasOut.width = widthOut;
    canvasOut.height = heightOut;

    var ctxOut = canvasOut.getContext("2d");
    
    ctxOut.drawImage(canvasIn,
                     0, 0, canvasIn.width, canvasIn.height,
                     0, 0, canvasOut.width, canvasOut.height);
               
    var imageDataOut = ctxOut.getImageData(0, 0, widthOut, heightOut);

    i = 0;
    for (var row = 0; row < heightOut; row++)
    {
        for (var col = 0; col < widthOut; col++)
        {
            for (var component = 0; component < 4; component++, i++)
            {
                dataOut[i] = imageDataOut.data[i];
            }
        }
    }

    return true;
}
// filter flags for GetFrameData() filterMask parameter
var FRAME_FILTER_SCALE_FRAME_BIT    = 0x001;    // scale frame to size of incoming buffer before copying
var FRAME_FILTER_INVERT_FRAME_BIT   = 0x002;    // invert frame
var FRAME_FILTER_NEGATE_COLOR_BIT   = 0x004;    // invert rgb pixel data (subtract from 255)
var FRAME_FILTER_NEGATE_ALPHA_BIT   = 0x008;    // invert alpha pixel data (subtract from 255)
var FRAME_FILTER_ALPHA_ONOFF_BIT    = 0x010;    // set alpha pixel to 0 or 255; alpha values in the range
                                                // [0, 127] are set to 0, [128, 255] are set to 255
                                                
function MediaPlayback(container, onload)
{
    this.container = container;
    this.onload = onload;

    this.url = null;
    this.video = false;
    this.ready = false;
    this.alphaPlayback = null;
    this.frameRetrieved = false;
    this.htmlImageElement = null;
    this.imageWidth = 0;
    this.imageHeight = 0;
    this.imagePitch = 0;
    this.imagePixels = null;
}

MediaPlayback.prototype.loadImage = function(url)
{
    this.ready = false;
    this.frameRetrieved = false;
    this.htmlImageElement = null;
    this.imageWidth = 0;
    this.imageHeight = 0;
    this.imagePitch = 0;
    this.imagePixels = null;

    var extension = getFileExtension(url);

    switch (extension)
    {
        case "avi":
        case "mpg":
        case "ogg":
            {

                this.htmlImageElement = document.createElement("video");
                this.htmlImageElement.container = this;
                this.htmlImageElement.controls = "controls";
                //this.htmlImageElement.preload = "auto";
                //this.htmlImageElement.autoplay = "autoplay";
                //this.htmlImageElement.setAttribute("controls", "controls");
                //this.htmlImageElement.setAttribute("preload", "preload");
                //this.htmlImageElement.setAttribute("autoplay", "autoplay");

                //this.htmlImageElement.canvas = document.createElement("canvas");
                //this.htmlImageElement.canvasContext = this.htmlImageElement.canvas.getContext("2d");

                //this.htmlImageElement.addEventListener("play", MediaTexture_OnVideoPlay, false);
                //this.htmlImageElement.onload = MediaTexture_OnVideoLoad;

                //this.onVideoPlay();
                this.htmlImageElement.src = "http://localhost/bwjs/BwContent/images/Bear.ogg"; //url;

                this.video = true;
                this.onVideoLoad();

                /*
                this.htmlImageElement = document.createElement("video"); //new Image();
                this.htmlImageElement.container = this;
                this.htmlImageElement.preload = "auto";
                this.htmlImageElement.autoplay = "autoplay";
                this.htmlImageElement.onload = MediaPlayback_OnVideoLoad;
                this.htmlImageElement.src = imageFilename;
                //this.imageSet = true;
                //this.video = true;
                */
                //var resource = loadBinaryResource(imageFilename);
                //alert(resource);
            }
            break;

        default:
            {
                this.htmlImageElement = new Image(); //document.createElement("img");
                this.htmlImageElement.container = this;
                this.htmlImageElement.onload = MediaPlayback_OnImageLoad;
                this.htmlImageElement.src = url;
            }
            break;
    }

    this.url = url;
}

MediaPlayback.prototype.onImageLoad = function()
{
    var image = this.htmlImageElement;
    this.imageWidth = image.width;
    this.imageHeight = image.height;
    this.imagePitch = image.width * 4; // rgba
    var canvas = document.createElement("canvas");
    var canvasContext = canvas.getContext("2d");
    canvas.width = image.width;
    canvas.height = image.height;
    canvasContext.drawImage(image, 0, 0);
    var imageData = canvasContext.getImageData(0, 0, image.width, image.height);
    this.imagePixels = imageData.data;

    this.ready = true;

    if (this.onload)
    {
        this.onload.call(this);
    }
}

MediaPlayback.prototype.onVideoLoad = function()
{
    this.ready = true;
}

MediaPlayback.prototype.getFrameDimensions = function()
{
    return { width: this.imageWidth, height: this.imageHeight, pitch: this.imagePitch };
}

MediaPlayback.prototype.getPixelFormat = function()
{
    return ePixelFormat.R8G8B8A8;
}

MediaPlayback.prototype.getPixelByteAlignment = function()
{
    return 4;
}

MediaPlayback.prototype.getBytesPerPixel = function()
{
    return BytesPerPixel(this.getPixelFormat());
}

/**
 * Retrieve the pixels for the current frame.
 * @param buffer        - incoming buffer to receive pixel data.
 * @param frame         - optional parameter specifying the frame number to retrieve.
 * @return number       - the frame number retrieved, -1 for single-frame images, or undefined on failure.
 */
MediaPlayback.prototype.getFramePixels = function(buffer, frame)
{
    // verify validity of image data
    if (!this.ready ||
        this.imageWidth == 0 ||
        this.imageHeight == 0 ||
        !this.imagePixels)
    {
        return undefined;
    }

    buffer.length = this.imagePixels.length;
    for (var i = 0; i < this.imagePixels.length; i++)
    {
        buffer[i] = this.imagePixels[i];
    }

    return -1; // single-frame image
}

MediaPlayback.prototype.newFrameDataAvailable = function()
{
    return this.ready && !this.frameRetrieved;
}

/**
 * Retrieve the pixels for the current frame in the specified pixel format and dimensions.
 * @param width         - width of the incoming buffer in pixels.
 * @param height        - height of the incoming buffer in pixels.
 * @param pitch         - width of a scan line of pixels in bytes; may differ from width * bytes
 *                        per pixel if pixels are padded to 2- or 4-byte boundaries.
 * @param pixelFormat   - pixel format of the incoming buffer.
 * @param buffer        - incoming buffer to receive pixel data.
 * @param filterMask    - zero or more OR'd filtering flags controlling how the image is filtered:
 *
 *                        FRAME_FILTER_SCALE_FRAME_BIT  - the frame is first scaled to the size 
 *                                                        of the incoming buffer before copying
 *                        FRAME_FILTER_INVERT_FRAME_BIT - the frame is inverted before copying
 *                        FRAME_FILTER_NEGATE_COLOR_BIT - the rgb pixel data is inverted (subtracted from 255) 
 *                        FRAME_FILTER_NEGATE_ALPHA_BIT - the alpha pixel data is inverted (subtracted from 255)
 *                        FRAME_FILTER_ALPHA_ONOFF_BIT  - set alpha pixel to 0 or 255; alpha values in the range
 *                                                        [0, 127] are set to 0, [128, 255] are set to 255
 *
 * @param pixelMap      - pixel mapping to perform; default: PixelMap_Default.
 * @param frame         - optional parameter specifying the frame number to retrieve.
 * @return number       - the frame number retrieved, -1 for single-frame images, or undefined on failure.
 */
MediaPlayback.prototype.getFrameData = function(width, height, pitch, pixelFormat, buffer, filterMask, pixelMap, frame)
{
    // verify validity of image data
    if (!this.ready ||
        this.imageWidth == 0 ||
        this.imageHeight == 0 ||
        !this.imagePixels)
    {
        return undefined;
    }

    // check params
    if (width == 0 ||
        height == 0 ||
        pitch < width ||
        pixelFormat == ePixelFormat.Unknown ||
        !buffer)
    {
        return undefined;
    }

    var frameRetrieved = -1;

    // get filter flags
    var scaleFrame = filterMask & FRAME_FILTER_SCALE_FRAME_BIT ? true : false;
    var invertFrame = filterMask & FRAME_FILTER_INVERT_FRAME_BIT ? true : false;
    var negateColor = filterMask & FRAME_FILTER_NEGATE_COLOR_BIT ? true : false;
    var negateAlpha = filterMask & FRAME_FILTER_NEGATE_ALPHA_BIT ? true : false;
    var alphaOnOff = filterMask & FRAME_FILTER_ALPHA_ONOFF_BIT ? true : false;

    // get image dimensions
    var dims = this.getFrameDimensions();
    var imageWidth = dims.width;
    var imageHeight = dims.height;
    var imagePitch = dims.pitch;

    // get image pixel format
    var imagePixelFormat = this.getPixelFormat();

    // currently supporting image pixel formats: RGBA
    if (imagePixelFormat != ePixelFormat.R8G8B8A8)
    {
        return undefined;
    }

    // get image pixels
    var pixels = [];
    var imageFrameRetrieved = this.getFramePixels(pixels, frame);
    if (imageFrameRetrieved == undefined)
    {
        return undefined;
    }

    // scale pixels if necessary
    if (scaleFrame && (width != imageWidth || height != imageHeight))
	{
		var imageBytesPerPixel = this.getBytesPerPixel();

		// calculate pitch (using byte aligment of "4")
		imagePitch = width * imageBytesPerPixel;
		imagePitch += (4 - imagePitch % 4) % 4;

		var scaledPixels = [];
		if (!ScaleImage(imagePixelFormat, imageWidth, imageHeight, this.getPixelByteAlignment(), pixels, 
			width, height, 4, scaledPixels))
		{
			return undefined;
		}

		pixels = scaledPixels;
		imageWidth = width;
		imageHeight = height;
	}

    // if no alpha channel, rgb pixel data is not to be negated, frame is not to be inverted,
    // and incoming buffer has same parameters as pixel buffer, copy bits
    if (!this.alphaPlayback &&
		!negateColor &&
		!invertFrame &&
		imagePitch == pitch &&
		imageHeight == height &&
		imagePixelFormat == pixelFormat)
    {
        for (var i = 0; i < buffer.length; i++)
        {
            buffer[i] = pixels[i];
        }
        
        this.frameRetrieved = true;
        return frameRetrieved;
    }

    // get alpha data
    var alphaWidth = 0;
	var alphaHeight = 0;
	var alphaPitch = 0;
	var alphaPixelFormat;
	var alphaPixels = null;
	if (this.alphaChannel)
	{
		// get alpha dimensions
		dims = this.alphaChannel.getFrameDimensions();
		alphaWidth = dims.width;
		alphaHeight = dims.height;
		alphaPitch = dims.pitch;

		// get alpha pixel format
		alphaPixelFormat = this.alphaChannel.getPixelFormat();
    
		// currently only supporting alpha pixel formats: RGBA
		if (alphaPixelFormat != ePixelFormat.R8G8B8A8)
		{
			return undefined;
		}

		// get alpha pixels
		var alphaFramePixels = [];
		var alphaFrameRetrieved = this.alphaChannel.getFramePixels(alphaFramePixels, imageFrameRetrieved);
		if (alphaFrameRetrieved != undefined)
		{
		    // scale alpha pixels to match frame data
		    if (alphaWidth != imageWidth ||
			    alphaHeight != imageHeight)
		    {
			    var alphaBytesPerPixel = this.alphaChannel.getBytesPerPixel();

			    // calculate pitch (using byte aligment of "4")
			    alphaPitch = imageWidth * alphaBytesPerPixel;
			    alphaPitch += (4 - alphaPitch % 4) % 4;

			    var scaledAlphaPixels = [];
			    if (ScaleImage(alphaPixelFormat, alphaWidth, alphaHeight, 
				    this.alphaChannel.getPixelByteAlignment(), alphaPixels, imageWidth, 
				    imageHeight, 4, scaledAlphaPixels))
			    {
			        alphaPixels = scaledAlphaPixels;
			        alphaWidth = imageWidth;
			        alphaHeight = imageHeight;
			    }
		    }
		    else
		    {
		        alphaPixels = alphaFramePixels;
		    }
		}
	}
	
    // determine dimensions to copy
    var copyWidth = Math.min(width, imageWidth);
    var copyHeight = Math.min(height, imageHeight);

    // set component positions for buffer pixel format
    var rPos = 0, gPos = 0, bPos = 0, aPos = 0;
    switch (pixelFormat)
    {
        case ePixelFormat.R8G8B8: rPos = 0; gPos = 1; bPos = 2; break;
        case ePixelFormat.B8G8R8: rPos = 2; gPos = 1; bPos = 0; break;
        case ePixelFormat.R8G8B8A8: rPos = 0; gPos = 1; bPos = 2; aPos = 3; break;
        case ePixelFormat.B8G8R8A8: rPos = 2; gPos = 1; bPos = 0; aPos = 3; break;
        case ePixelFormat.A8R8G8B8: rPos = 1; gPos = 2; bPos = 3; aPos = 0; break;
        case ePixelFormat.A8B8G8R8: rPos = 3; gPos = 2; bPos = 1; aPos = 0; break;
    }

    // if frame is to be inverted, start copying from last row of data
    var fromImage = 0, fromAlpha = 0, to = 0;
    if (invertFrame)
    {
        fromImage += imagePitch * (copyHeight - 1);

        if (alphaPixels)
        {
            fromAlpha += alphaPitch * (copyHeight - 1);
        }
    }

    // copy pixel data to buffer
    var pixel = new TPixel(0, 0, 0, 255);
    var alphaPixel = new TPixel(0, 0, 0, 255);
    for (var row = 0; row < copyHeight; row++)
    {
        for (var col = 0; col < copyWidth; col++)
        {
            // get image pixel
            /*
            switch (imagePixelFormat)
            {
            case ePixelFormat.R8G8B8:
            pixel.red = pixels[fromImage];
            pixel.green = pixels[fromImage + 1];
            pixel.blue = pixels[fromImage + 2];
            fromImage += 3;
            break;

                case ePixelFormat.B8G8R8:
            pixel.red = pixels[fromImage + 2];
            pixel.green = pixels[fromImage + 1];
            pixel.blue = pixels[fromImage];
            fromImage += 3;
            break;

                case ePixelFormat.R8G8B8A8:
            pixel.red = pixels[fromImage];
            pixel.green = pixels[fromImage + 1];
            pixel.blue = pixels[fromImage + 2];
            pixel.alpha = pixels[fromImage + 3];
            fromImage += 4;
            break;

                case ePixelFormat.B8G8R8A8:
            pixel.red = pixels[fromImage + 2];
            pixel.green = pixels[fromImage + 1];
            pixel.blue = pixels[fromImage];
            pixel.alpha = pixels[fromImage + 3];
            fromImage += 4;
            break;

                case ePixelFormat.A8B8G8R8:
            pixel.red = pixels[fromImage + 3];
            pixel.green = pixels[fromImage + 2];
            pixel.blue = pixels[fromImage + 1];
            pixel.alpha = pixels[fromImage];
            fromImage += 4;
            break;
            }
            */
            pixel.red = pixels[fromImage];
            pixel.green = pixels[fromImage + 1];
            pixel.blue = pixels[fromImage + 2];
            pixel.alpha = pixels[fromImage + 3];
            fromImage += 4;

            // negate rgb data if requested
            if (negateColor)
            {
                pixel.red = 255 - pixel.red;
                pixel.green = 255 - pixel.green;
                pixel.blue = 255 - pixel.blue;
                pixel.alpha = 255 - pixel.alpha;
            }

            // get alpha pixel
            if (alphaPixels)
            {
                /*
                switch (alphaPixelFormat)
                {
                case ePixelFormat.R8G8B8:
                alphaPixel.red = alphaPixels[fromAlpha];
                alphaPixel.green = alphaPixels[fromAlpha + 1];
                alphaPixel.blue = alphaPixels[fromAlpha + 2];
                fromAlpha += 3;
                break;

                    case ePixelFormat.B8G8R8:
                alphaPixel.red = alphaPixels[fromAlpha + 2];
                alphaPixel.green = alphaPixels[fromAlpha + 1];
                alphaPixel.blue = alphaPixels[fromAlpha];
                fromAlpha += 3;
                break;

                    case ePixelFormat.R8G8B8A8:
                alphaPixel.red = alphaPixels[fromAlpha];
                alphaPixel.green = alphaPixels[fromAlpha + 1];
                alphaPixel.blue = alphaPixels[fromAlpha + 2];
                alphaPixel.alpha = alphaPixels[fromAlpha + 3];
                fromAlpha += 4;
                break;

                    case ePixelFormat.B8G8R8A8:
                alphaPixel.red = alphaPixels[fromAlpha + 2];
                alphaPixel.green = alphaPixels[fromAlpha + 1];
                alphaPixel.blue = alphaPixels[fromAlpha];
                alphaPixel.alpha = alphaPixels[fromAlpha + 3];
                fromAlpha += 4;
                break;
                }
                */
                alphaPixel.red = alphaPixels[fromAlpha];
                alphaPixel.green = alphaPixels[fromAlpha + 1];
                alphaPixel.blue = alphaPixels[fromAlpha + 2];
                alphaPixel.alpha = alphaPixels[fromAlpha + 3];
                fromAlpha += 4;
            }

            // negate alpha data if requested
            if (negateAlpha)
            {
                alphaPixel.red = 255 - alphaPixel.red;
                alphaPixel.green = 255 - alphaPixel.green;
                alphaPixel.blue = 255 - alphaPixel.blue;
                alphaPixel.alpha = 255 - alphaPixel.alpha;
            }

            // copy to buffer
            switch (pixelFormat)
            {
                case ePixelFormat.R8G8B8:
                case ePixelFormat.B8G8R8:
                    buffer[to + rPos] = pixel.red;
                    buffer[to + gPos] = pixel.green;
                    buffer[to + bPos] = pixel.blue;
                    to += 3;
                    break;

                case ePixelFormat.R8G8B8A8:
                case ePixelFormat.B8G8R8A8:
                case ePixelFormat.A8R8G8B8:
                case ePixelFormat.A8B8G8R8:
                    switch (pixelMap)
                    {
                        case ePixelMap.RGBToAlpha:
                            buffer[to + rPos] = 0;
                            buffer[to + gPos] = 255;
                            buffer[to + bPos] = 0;
                            if (alphaPixels)
                            {
                                buffer[to + aPos] =
								((pixel.red + pixel.green + pixel.blue) / 3) &
								((alphaPixel.red + alphaPixel.green + alphaPixel.blue) / 3);
                            }
                            else
                            {
                                buffer[to + aPos] = (pixel.red + pixel.green + pixel.blue) / 3;
                            }
                            if (alphaOnOff)
                            {
                                buffer[to + aPos] = (buffer[to + aPos] <= 127 ? 0 : 255);
                            }
                            to += 4;
                            break;

                        case ePixelMap.Default:
                        default:
                            buffer[to + rPos] = pixel.red;
                            buffer[to + gPos] = pixel.green;
                            buffer[to + bPos] = pixel.blue;
                            if (alphaPixels)
                            {
                                buffer[to + aPos] = (alphaPixel.red + alphaPixel.green + alphaPixel.blue) / 3;
                            }
                            else
                            {
                                buffer[to + aPos] = pixel.alpha;
                            }
                            if (alphaOnOff)
                            {
                                buffer[to + aPos] = (buffer[to + aPos] <= 127 ? 0 : 255);
                            }
                            to += 4;
                            break;
                    }
                    break;

                case ePixelFormat.A8:
                    if (alphaPixels)
                    {
                        buffer[to] = (alphaPixel.red + alphaPixel.green + alphaPixel.blue) / 3;
                    }
                    else // !alphaPixels
                    {
                        buffer[to] = (pixel.red + pixel.green + pixel.blue) / 3;
                    }
                    if (alphaOnOff)
                    {
                        buffer[to] = (buffer[to] <= 127 ? 0 : 255);
                    }
                    to += 1;
                    break;
            }
        }

        if (invertFrame) fromImage -= (2 * imagePitch);
        if (alphaPixels)
        {
            if (invertFrame) fromAlpha -= (2 * alphaPitch);
        }
    }

    this.frameRetrieved = true;

    return frameRetrieved;
}

MediaPlayback.prototype.setAlphaChannel = function(playback)
{
    this.alphaPlayback = playback;
}

function MediaPlayback_OnImageLoad()
{
    this.container.onImageLoad();
}
// TODO: consider moving to a more appropriate file
function TextureArray(textureArray)
{
    this.textures = new Array(eTextureType.EnumCount);

    for (var i=0; i < this.textures.length; i++)
    {
        if (textureArray)
        {
            this.textures[i] = textureArray.textures[i].slice();
        }
        else
        {
            this.textures[i] = [];
        }
    }
}


StyleMgr.prototype = new AttributeContainer();
StyleMgr.prototype.constructor = StyleMgr;

function StyleMgr()
{
    AttributeContainer.call(this);
    this.className = "StyleMgr";
}

StyleMgr.prototype.eventPerformed = function(event, node)
{
    var result = node.stylesMap.getStyles(event.type);
    if (result.styles && result.enabled)
    {
        this.applyStyle(result.styles, result.target ? result.target : node);
    }
}

StyleMgr.prototype.applyStyle = function(style, node)
{
    node.styles.updateStyle(style);
}
GraphMgr.prototype = new AttributeContainer();
GraphMgr.prototype.constructor = GraphMgr;

function GraphMgr()
{
    AttributeContainer.call(this);
    this.className = "GraphMgr";
    
    this.renderContext = null;
    this.renderState = null;
    this.lightIndex = 0;
    this.material = null;
    this.dissolve = null;
    this.balloonTipLabel = null;
    this.drawTextures = true;
    this.textureArrayStack = new Stack(new TextureArray());
    this.projectionTextureArrayStack = new Stack(new TextureArray());
    this.labelIndex = 1;
    this.balloonTipLabelIndex = 1;
    this.styleMgr = new StyleMgr();
    this.updateRegistry = new NodeRegistry();
    
    this.name = new StringAttr("GraphMgr");
    
    this.registerAttribute(this.name, "name");
}

GraphMgr.prototype.setRenderContext = function(rc)
{
    this.renderContext = rc;
    this.renderState = new RenderState(rc);
}

GraphMgr.prototype.getAvailableLightIndex = function()
{
    return this.lightIndex++;
}

GraphMgr.prototype.getCurrentMaterial = function()
{
    return this.material;
}

GraphMgr.prototype.setCurrentMaterial = function(material)
{
    this.material = material;
}

GraphMgr.prototype.getCurrentDissolve = function()
{
    return this.dissolve;
}

GraphMgr.prototype.setCurrentDissolve = function(dissolve)
{
    this.dissolve = dissolve;
}

GraphMgr.prototype.getCurrentBalloonTipLabel = function()
{
    return this.balloonTipLabel;
}

GraphMgr.prototype.setCurrentBalloonTipLabel = function(balloonTipLabel)
{
    this.balloonTipLabel = balloonTipLabel;
}

GraphMgr.prototype.getDrawTextures = function()
{
    return this.drawTextures;
}

GraphMgr.prototype.setDrawTextures = function(drawTextures)
{
    this.drawTextures = drawTextures;
}

GraphMgr.prototype.getNextLabelIndex = function()
{
    return this.labelIndex++;
}

GraphMgr.prototype.getNextBalloonTipLabelIndex = function()
{
    return this.balloonTipLabelIndex++;    
}

GraphMgr.prototype.reset = function ()
{
    this.lightIndex = 0;
    this.labelIndex = 1;
    this.balloonTipLabelIndex = 1;
    this.setCurrentDissolve(null);
    this.setCurrentMaterial(null);
    this.setCurrentBalloonTipLabel(null);
    this.setDrawTextures(true);
    this.collisions = new Array;

    for (var i=0; i < gl_MaxLights; i++)
    {
        this.renderContext.enableLight(i, false);
    }
}
NodeRegistry.prototype = new AttributeContainer();
NodeRegistry.prototype.constructor = NodeRegistry;

function NodeRegistry()
{
    AttributeContainer.call(this);
    this.className = "NodeRegistry";
    
    this.nodes = [];
}

NodeRegistry.prototype.register = function(node)
{
    this.nodes[node.__nodeId__] = node;
}

NodeRegistry.prototype.unregister = function(node)
{
    // TODO
}

NodeRegistry.prototype.clear = function()
{
    this.nodes = [];
}

var g__nodeId__ = 0;

Node.prototype = new AttributeContainer();
Node.prototype.constructor = Node;

function Node()
{
    AttributeContainer.call(this);
    this.className = "Node";
    this.attrType = eAttrType.Node;

    this.__nodeId__ = g__nodeId__++;
    this.enabled_ = true;
    this.children = [];
    this.parents = [];

    this.name = new StringAttr("");
    this.enabled = new BooleanAttr(true);
    this.orphan = new BooleanAttr(false);
    this.modified = new PulseAttr();

    this.enabled.addModifiedCB(Node_EnabledModifiedCB, this);
    
    this.registerAttribute(this.name, "name");
    this.registerAttribute(this.enabled, "enabled");
    this.registerAttribute(this.orphan, "orphan");
    this.registerAttribute(this.modified, "modified");
}

Node.prototype.copyNode = function(clone, cloneChildren, pathSrc, pathClone)
{
    var clonedByThis = false;
    if (!clone)
    {
        if (!( clone = new Node()))
        {
            return -1;
        }

        clonedByThis = true;
    }

    // synchronize attributes
    clone.synchronize(this, false);

    // add source to path
    //pathSrc.addNode(this);
    pathSrc.push(this);

    // add clone to path
    // pathClone.AddNode(clone);
    pathClone.push(this);

    // if requested, clone children
    if (cloneChildren)
    {
        var pos;
        for (var i in this.children)
        {
            //pos = it - m_children.begin();
            pos = i - this.children.start();

            var childClone = null;
            if (!(i.getCreatedByParent()))
            {
                if (i.copyNode(childClone, cloneChildren, pathSrc, pathClone))
                {
                    if (clonedByThis)
                    {
                    }
                    return -1;
                }

                if (clone.getChildCount() > pos)
                {
                    clone.insertChild(childClone, pos);
                }
                else
                {
                    clone.addChild(childClone);
                }

                i.postCloneChild(childClone, pathSrc, pathClone);
            }
            else// created by parent -- clone child's children without allocating child
            {
                //childClone = clone.getChild(i - m_children.begin());
                childClone = clone.getChild(i - this.children.start());

                if (i.copyNode(childClone, cloneChildren, pathSrc, pathClone))
                {
                    if (clonedByThis)
                    {
                    }
                    return -1;
                }
            }
        }
    }

    this.postClone(clone, pathSrc, pathClone);

}
Node.prototype.searchTree = function(name, type, searchName, searchType, searchPredecessors, skipChild, skipParent, stopAt, matches)
{
    var names = [];
    var types = [];

    if (!(names.push(name)))
        return;
    if (!(types.push(type)))
        return;

    this.searchesTree(names, types, searchName, searchType, searchPredecessors, skipChild, skipParent, stopAt, matches);
}

Node.prototype.searchesTree = function(names, types, searchNames, searchTypes, searchPredecessors, skipChild, skipParent, stopAt, matches)
{
    // if this node matches any of the names and/or types, add it to the list
    var match = false;
    var nameMatch = false;
    var typeMatch = false;
    if (searchNames)
    {
        for (var i = 0; i < names.size(); i++)
        {
            if (!(this.name == names[i]))
            {
                nameMatch = true;
                break;
            }
        }
    }
    if (searchTypes)
    {
        for (var i = 0; i < types.size(); i++)
        {
            if (this.attrType == types[i])
            {
                typeMatch = true;
                break;
            }
        }
    }
    if (searchNames && searchTypes)
    {
        match = nameMatch && typeMatch;
    }
    else
    if (searchNames)
    {
        match = nameMatch;
    }
    else// searchTypes
    {
        match = typeMatch;
    }
    if (match)
    {
        if (!(matches.push(this)))
            return;
    }

    if (this == stopAt)
    {
        return;
    }

    // recurse on parent(s) if requested (with this set to skipChild)
    if (searchPredecessors)
    {
        for (var i = 0; i < this.parents.size(); i++)
        {
            if (this.parents[i] != skipParent)
            {
                this.parents[i].searchesTree(names, types, searchNames, searchTypes, searchPredecessors, this, null, stopAt, matches);
            }
        }
    }

    // recurse on children (with searchPredecessors set to false)
    for (var i = 0; i < this.children.size(); i++)
    {
        if (this.children[i] != skipChild)
        {
            this.children[i].searchesTree(names, types, searchNames, searchTypes, false, null, null, stopAt, matches);
        }
    }
}
Node.prototype.setCreatedByParent = function(createdByParent)
{
    this.createdByParent = createdByParent;
}
Node.prototype.getCreatedByParent = function()
{
    return this.createdByParent;
}

Node.prototype.isNode = function()
{
    return true;
}

Node.prototype.addChild = function(child)
{
    this.children.push(child);

    this.setModified();

    child.addParent(this);
}

Node.prototype.insertChild = function(child, at)
{
    this.children.splice(at, 0, child);

    this.setModified();

    child.addParent(this);
}

Node.prototype.removeChild = function(child)
{
    this.children.splice(this.children.indexOf(child), 1);

    this.setModified();

    child.removeParent(this);
}

Node.prototype.replaceChild = function(replacement, replacee)
{
    this.children.splice(this.children.indexOf(replacement), 1, replacee);
    replacement.removeParent(this);
    replacee.addParent(this);
}

Node.prototype.getChild = function(n)
{
    if (this.children.length > n)
    {
        return this.children[n];
    }

    return null;
}

Node.prototype.getNamedChild = function(name)
{
    for (var i = 0; i < this.children.length; i++)
    {
        if (this.children[i].name.getValueDirect().join("") == name)
        {
            return this.children[i];
        }
    }

    return null;
}

Node.prototype.getChildCount = function()
{
    return this.children.length;
}

Node.prototype.getParent = function(n)
{
    if (this.parents.length > n)
    {
        return this.parents[n];
    }

    return null;
}

Node.prototype.getParentCount = function()
{
    return this.parents.length;
}

Node.prototype.addParent = function(parent)
{
    this.parents.push(parent);
}

Node.prototype.removeParent = function(parent)
{
    this.parents.splice(this.parents.indexOf(parent), 1);
}

Node.prototype.update = function(params, visitChildren)
{
    params.visited.push(this);

    if (visitChildren)
    {
        // call for all children
        for (var i = 0; i < this.children.length; i++)
        {
            this.children[i].update(params, visitChildren);
        }
    }
}

Node.prototype.apply = function(directive, params, visitChildren)
{
    // commented this out because if an evaluator (e.g., WalkSimulator)
    // happens to be the root node of a subtree and is currently disabled, its subtree will not be visited.
    /*
     var enabled = this.enabled.getValueDirect();
     if (!enabled)
     {
     if (directive != "serialize")
     {
     return;
     }
     }
     */
    switch (directive)
    {
        case "serialize":
            {
                var context = new Context();
                context.attribute = this;

                var factory = this.registry.find("AttributeFactory");
                var serializer = factory.create("Serializer");
                var xmlSerializer = new XMLSerializer();

                // added required format setting - need to revisit to reduce number of required steps
                serializer.getAttribute("format").setValueDirect("xml");
                // set minimum flag so that only the minimum required for recreation is serialized
                serializer.getAttribute("serializeMinimum").setValueDirect(true);
                // set children flag so that child nodes are serialized
                serializer.getAttribute("serializeChildren").setValueDirect(true);
                // serialize
                serializer.serialize(context.attribute, context.item, context.attributeName, context.container);
                var serialized = xmlSerializer.serializeToString(serializer.DOM);
                if (serialized != "<__InitialRoot/>")
                {
                    params.serialized += serialized;
                }

                // do not visit children, as they were serialized by this
                visitChildren = false;
            }
            break;
    }

    if (visitChildren)
    {
        if (params.path)
        {
            // call for next node in path if next node in path is a child of this node
            if (params.path.length > params.pathIndex)
            {
                for (var i = 0; i < this.children.length; i++)
                {
                    var next = params.path[params.pathIndex];

                    if (this.children[i] == next)
                    {
                        params.pathIndex++;
                        this.children[i].apply(directive, params, visitChildren);
                    }
                }
            }
        }
        else
        {
            // call for all children
            for (var i = 0; i < this.children.length; i++)
            {
                this.children[i].apply(directive, params, visitChildren);
            }
        }
    }
}

Node.prototype.applyNode = function(node, directive, params, visitChildren)
{
    node.apply(directive, params, visitChildren);
}

Node.prototype.setModified = function()
{
    this.modified.pulse();
    
    // TODO: remove if
    if (this.graphMgr) this.graphMgr.updateRegistry.register(this);
}

function Node_EnabledModifiedCB(attribute, container)
{
    container.enabled_ = attribute.getValueDirect();
}
SGNode.prototype = new Node();
SGNode.prototype.constructor = SGNode;

function SGNode()
{
    Node.call(this);
    this.className = "SGNode";

    this.graphMgr = null;
    this.recordDisplayList = false;
    this.disableDisplayLists = false;
    this.displayListObj = null;

    this.enableDisplayList = new BooleanAttr(false);
    this.autoDisplayList = new BooleanAttr(false);
    this.updateDisplayList = new PulseAttr();

    this.modified.addModifiedCB(SGNode_ModifiedModifiedCB, this);
    
    this.registerAttribute(this.enableDisplayList, "enableDisplayList");
    this.registerAttribute(this.autoDisplayList, "autoDisplayList");
    this.registerAttribute(this.updateDisplayList, "updateDisplayList");
}

SGNode.prototype.setGraphMgr = function(graphMgr)
{
    this.graphMgr = graphMgr;
}

SGNode.prototype.update = function(params, visitChildren)
{
    if (this.recordDisplayList)
    {
        this.createDisplayList();
    }

    Node.prototype.update.call(this, params, visitChildren);
}

SGNode.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        return;
    }

    var useDisplayList = false;

    switch (directive)
    {
        case "render":
            {
                if (params.resetDisplayLists)
                {
                    this.recordDisplayList = true;
                }

                // determine if display list should be used; if a display list (from a parent node) is already operating, don't nest record or play...
                // this node's display list operations  will be recorded by the currently operating display list; also check manual override flag for disabling
                // display lists
                useDisplayList = this.enableDisplayList.getValueDirect() &&
                        this.displayListObj != null &&
                        params.displayListObj == null &&
                        !params.disableDisplayLists;

                if (useDisplayList)
                {
                    // set as current display list
                    params.displayListObj = this.displayListObj;

                    if (this.recordDisplayList)
                    {
                        // start recording render engine calls
                        this.displayListObj.record_begin();
                    }
                    else // !this.recordDisplayList
                    {
                        // playback render engine calls and do not visit children
                        this.displayListObj.play();
                        visitChildren = false;
                    }
                }
            }
            break;

        case "rayPick":
            {
                params.currentNodePath.push(this);
            }
            break;

        default:
            {
                // call base-class implementation
                Node.prototype.apply.call(this, directive, params, visitChildren);
                return;
            }
            break;
    }

    if (visitChildren)
    {
        if (params.path)
        {
            // call for next node in path if next node in path is a child of this node
            if (params.path.length > params.pathIndex)
            {
                for (var i = 0; i < this.children.length; i++)
                {
                    var next = params.path[params.pathIndex];

                    if (this.children[i] == next)
                    {
                        params.pathIndex++;
                        this.children[i].apply(directive, params, visitChildren);
                    }
                }
            }
        }
        else
        {
            // call for all children
            for (var i = 0; i < this.children.length; i++)
            {
                this.children[i].apply(directive, params, visitChildren);
            }
        }
    }

    switch (directive)
    {
        case "render":
            {
                if (useDisplayList)
                {
                    if (this.recordDisplayList)
                    {
                        // stop recording render engine calls
                        this.displayListObj.record_end();
                        this.recordDisplayList = false;
                    }

                    // clear current display list
                    params.displayListObj = null;
                }
            }
            break;

        case "rayPick":
            {
                params.currentNodePath.pop();
            }
            break;
    }
}

SGNode.prototype.isRecordingDisplayList = function()
{
    if (this.graphMgr.renderContext.getDisplayList())
    {
        return true;
    }

    return false;
}

SGNode.prototype.createDisplayList = function()
{
    this.displayListObj = new DisplayListObj(this.graphMgr.renderContext);
}

SGNode.prototype.deleteDisplayList = function()
{
    this.displayListObj = null;
}

SGNode.prototype.enableDisplayListModified = function()
{
}

SGNode.prototype.setModified = function()
{
    // call base-class implementation
    Node.prototype.setModified.call(this);

    this.recordDisplayList = true;
}

function SGNode_ModifiedModifiedCB(attribute, container)
{
    container.recordDisplayList = true;
}

RenderableElement.prototype = new SGNode();
RenderableElement.prototype.constructor = RenderableElement;

function RenderableElement()
{
    SGNode.call(this);
    this.className = "RenderableElement";
    this.attrType = eAttrType.RenderableElement;
    
    this.bbox = new BBoxAttr();
    this.renderSequenceSlot = new NumberAttr(0);
    this.hasFocus = new TernaryAttr(0);
    this.selected = new TernaryAttr(0);
    this.styles = new StylesAttr();
    this.stylesMap = new StylesMapAttr();
    this.renderableElementStyle = new RenderableElementStyleAttr();
    this.renderedSlot = new NumberAttr(0);
    
    this.registerAttribute(this.bbox, "bbox");
    this.registerAttribute(this.renderSequenceSlot, "renderSequenceSlot");
    this.registerAttribute(this.hasFocus, "hasFocus");
    this.registerAttribute(this.selected, "selected");
    this.registerAttribute(this.styles, "styles");
    this.registerAttribute(this.stylesMap, "stylesMap");
    this.registerAttribute(this.renderableElementStyle, "renderableElementStyle");
    this.registerAttribute(this.renderedSlot, "renderedSlot");
}

RenderableElement.prototype.setRegistry = function(registry)
{
    this.stylesMap.setRegistry(registry);

    // call base-class implementation
    SGNode.prototype.setRegistry.call(this, registry);
}

RenderableElement.prototype.update = function(params, visitChildren)
{
    // call base-class implementation
    SGNode.prototype.update.call(this, params, visitChildren);
}

RenderableElement.prototype.apply = function(directive, params, visitChildren)
{
    // call base-class implementation
    SGNode.prototype.apply.call(this, directive, params, visitChildren);
}

ParentableMotionElement.prototype = new RenderableElement();
ParentableMotionElement.prototype.constructor = ParentableMotionElement;

function ParentableMotionElement()
{
    RenderableElement.call(this);
    this.className = "ParentableMotionElement";
    this.attrType = eAttrType.ParentableMotionElement;

    this.translationMatrix = new Matrix4x4();           // matrix representing this element's position translation
    this.rotationMatrix = new Matrix4x4();              // matrix representing this element's rotation
    this.scaleMatrix = new Matrix4x4();                 // matrix representing this element's scale transformation
    this.pivotMatrix = new Matrix4x4();                 // matrix representing this element's pivot translation
    this.sectorTranslationMatrix = new Matrix4x4();	// matrix representing this element's sector position translation
    this.stackMatrix = new Matrix4x4();                 // current matrix from the scene graph matrix stack (GcTransform nodes)
    this.transformSimple = new Matrix4x4();             // after Update(), contains this element's transformations (translation/
    							// rotation/scale/pivot)
    this.transformCompound = new Matrix4x4();           // after Update(), contains this element's transformations combined with 
    							// parent's transformations (if any)
    this.sectorTransformSimple = new Matrix4x4();	// after Update(), contains this element's transformations (translation/
    							// rotation/scale/pivot) for the current sector
    this.sectorTransformCompound = new Matrix4x4();     // after Update(), contains this element's transformations combined with 
    							// parent's transformations (if any) for the current sector                                        
    this.updatePosition = false;
    this.updateRotation = false;
    this.updateQuaternion = false;
    this.updateScale = false;
    this.updatePivot = false;
    this.updateSectorPosition = false;
    this.updateInheritance = false;
    this.inheritsPosition = true;
    this.inheritsRotation = true;
    this.inheritsScale = true;
    this.inheritsPivot = true;
    this.nonZeroVelocity = false;
    this.motionParent = null;
    this.motionChildren = [];

    this.position = new Vector3DAttr(0, 0, 0);
    this.rotation = new Vector3DAttr(0, 0, 0);
    this.quaternion = new QuaternionAttr(1, 0, 0, 0);
    this.scale = new Vector3DAttr(1, 1, 1);
    this.pivot = new Vector3DAttr(0, 0, 0);
    this.center = new Vector3DAttr(0, 0, 0);
    this.worldCenter = new Vector3DAttr(0, 0, 0);
    this.worldPosition = new Vector3DAttr(0, 0, 0);
    this.worldRotation = new Vector3DAttr(0, 0, 0);
    this.worldScale = new Vector3DAttr(1, 1, 1);
    this.screenPosition = new Vector3DAttr(0, 0, 0);
    this.sectorOrigin = new Vector3DAttr(0, 0, 0);
    this.sectorPosition = new Vector3DAttr(0, 0, 0);
    this.sectorWorldCenter = new Vector3DAttr(0, 0, 0);
    this.sectorWorldPosition = new Vector3DAttr(0, 0, 0);
    this.panVelocity = new Vector3DAttr(0, 0, 0);          // linear velocity along direction vectors in world-units/second
    this.linearVelocity = new Vector3DAttr(0, 0, 0);       // linear velocity in world-units/second
    this.linearVelocity_affectPosition_Y = new BooleanAttr(true);
    this.angularVelocity = new Vector3DAttr(0, 0, 0);      // angular velocity in degrees/second
    this.scalarVelocity = new Vector3DAttr(0, 0, 0);       // scalar velocity in world-units/second
    this.worldTransform = new Matrix4x4Attr(1, 0, 0, 0,
            0, 1, 0, 0,
            0, 0, 1, 0,
            0, 0, 0, 1);
    this.sectorWorldTransform = new Matrix4x4Attr(1, 0, 0, 0,
            0, 1, 0, 0,
            0, 0, 1, 0,
            0, 0, 0, 1);
    this.parent = new StringAttr("");
    this.inheritPosition_X = new BooleanAttr(true);
    this.inheritPosition_Y = new BooleanAttr(true);
    this.inheritPosition_Z = new BooleanAttr(true);
    this.inheritRotation_X = new BooleanAttr(true);
    this.inheritRotation_Y = new BooleanAttr(true);
    this.inheritRotation_Z = new BooleanAttr(true);
    this.inheritScale_X = new BooleanAttr(true);
    this.inheritScale_Y = new BooleanAttr(true);
    this.inheritScale_Z = new BooleanAttr(true);
    this.inheritPivot_X = new BooleanAttr(true);
    this.inheritPivot_Y = new BooleanAttr(true);
    this.inheritPivot_Z = new BooleanAttr(true);
    this.transformModified = new PulseAttr();               // pulsed when transform has been modified
   
    this.position.addModifiedCB(ParentableMotionElement_PositionModifiedCB, this);
    this.rotation.addModifiedCB(ParentableMotionElement_RotationModifiedCB, this);
    this.quaternion.addModifiedCB(ParentableMotionElement_QuaternionModifiedCB, this);
    this.scale.addModifiedCB(ParentableMotionElement_ScaleModifiedCB, this);
    this.pivot.addModifiedCB(ParentableMotionElement_PivotModifiedCB, this);
    this.sectorOrigin.addModifiedCB(ParentableMotionElement_SectorOriginModifiedCB, this);
    this.sectorPosition.addModifiedCB(ParentableMotionElement_SectorPositionModifiedCB, this);
    this.parent.addModifiedCB(ParentableMotionElement_ParentModifiedCB, this);
    this.inheritPosition_X.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritPosition_Y.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritPosition_Z.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritRotation_X.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritRotation_Y.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritRotation_Z.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritScale_X.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritScale_Y.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritScale_Z.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritPivot_X.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritPivot_Y.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritPivot_Z.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.panVelocity.addModifiedCB(ParentableMotionElement_VelocityModifiedCB, this);
    this.linearVelocity.addModifiedCB(ParentableMotionElement_VelocityModifiedCB, this);
    this.angularVelocity.addModifiedCB(ParentableMotionElement_VelocityModifiedCB, this);
    this.scalarVelocity.addModifiedCB(ParentableMotionElement_VelocityModifiedCB, this);

    this.registerAttribute(this.position, "position");
    this.registerAttribute(this.rotation, "rotation");
    this.registerAttribute(this.quaternion, "quaternion");
    this.registerAttribute(this.scale, "scale");
    this.registerAttribute(this.pivot, "pivot");
    this.registerAttribute(this.center, "center");
    this.registerAttribute(this.worldCenter, "worldCenter");
    this.registerAttribute(this.worldPosition, "worldPosition");
    this.registerAttribute(this.worldRotation, "worldRotation");
    this.registerAttribute(this.worldScale, "worldScale");
    this.registerAttribute(this.screenPosition, "screenPosition");
    this.registerAttribute(this.sectorOrigin, "sectorOrigin");
    this.registerAttribute(this.sectorPosition, "sectorPosition");
    this.registerAttribute(this.sectorWorldCenter, "sectorWorldCenter");
    this.registerAttribute(this.sectorWorldPosition, "sectorWorldPosition");
    this.registerAttribute(this.worldTransform, "worldTransform");
    this.registerAttribute(this.sectorWorldTransform, "sectorWorldTransform");
    this.registerAttribute(this.panVelocity, "panVelocity");
    this.registerAttribute(this.linearVelocity, "linearVelocity");
    this.registerAttribute(this.linearVelocity_affectPosition_Y, "linearVelocity_affectPosition_Y");
    this.registerAttribute(this.angularVelocity, "angularVelocity");
    this.registerAttribute(this.scalarVelocity, "scalarVelocity");
    this.registerAttribute(this.parent, "parent");
    this.registerAttribute(this.inheritPosition_X, "inheritPosition_X");
    this.registerAttribute(this.inheritPosition_Y, "inheritPosition_Y");
    this.registerAttribute(this.inheritPosition_Z, "inheritPosition_Z");
    this.registerAttribute(this.inheritRotation_X, "inheritRotation_X");
    this.registerAttribute(this.inheritRotation_Y, "inheritRotation_Y");
    this.registerAttribute(this.inheritRotation_Z, "inheritRotation_Z");
    this.registerAttribute(this.inheritScale_X, "inheritScale_X");
    this.registerAttribute(this.inheritScale_Y, "inheritScale_Y");
    this.registerAttribute(this.inheritScale_Z, "inheritScale_Z");
    this.registerAttribute(this.inheritPivot_X, "inheritPivot_X");
    this.registerAttribute(this.inheritPivot_X, "inheritPivot_Y");
    this.registerAttribute(this.inheritPivot_X, "inheritPivot_Z");
    this.registerAttribute(this.transformModified, "transformModified");
}

ParentableMotionElement.prototype.getTransform = function()
{
    var matrix = new Matrix4x4();
    matrix.loadMatrix(this.transformCompound);
    return matrix;
}

ParentableMotionElement.prototype.getSectorTransform = function()
{
    var matrix = new Matrix4x4();
    matrix.loadMatrix(this.sectorTransformCompound);
    return matrix;
}

ParentableMotionElement.prototype.update = function(params, visitChildren)
{
    // update this element's position/rotation as affected by velocity
    if (this.nonZeroVelocity)
    {
        this.updateVelocityMotion(params.timeIncrement);
    }

    if (this.updateInheritance)
    {
        this.updateInheritance = false;

        this.inheritsPosition = this.inheritPosition_X.getValueDirect() &&
                this.inheritPosition_Y.getValueDirect() &&
                this.inheritPosition_Z.getValueDirect();

        this.inheritsRotation = this.inheritRotation_X.getValueDirect() &&
                this.inheritRotation_Y.getValueDirect() &&
                this.inheritRotation_Z.getValueDirect();

        this.inheritsScale = this.inheritScale_X.getValueDirect() &&
                this.inheritScale_Y.getValueDirect() &&
                this.inheritScale_Z.getValueDirect();

        this.inheritsPivot = this.inheritPivot_X.getValueDirect() &&
                this.inheritPivot_Y.getValueDirect() &&
                this.inheritPivot_Z.getValueDirect();
    }

    // update this element's transformations (translation/rotation/scale/pivot)
    this.updateSimpleTransform();
    if (this.motionParent)
    {
        this.motionParent.update(params, false);
    }
    this.updateCompoundTransform();
    this.updateWorldMotionInfo();

    // call base-class implementation
    RenderableElement.prototype.update.call(this, params, visitChildren);
}

ParentableMotionElement.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        // call base-class implementation
        RenderableElement.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    switch (directive)
    {
        case "render":
            {
                var screen = toScreenSpace(this.sectorWorldPosition.getValueDirect(),
                        params.viewMatrix, params.projMatrix, params.viewport);
                this.screenPosition.setValueDirect(screen.x, screen.y, screen.z);
            }
            break;
    }

    // call base-class implementation
    RenderableElement.prototype.apply.call(this, directive, params, visitChildren);
}

ParentableMotionElement.prototype.updateChildDisplayLists = function()
{
    /*for (var i=0; i < this.motionChildren.length; i++)
     {
     this.motionChildren[i].updateDisplayList.pulse();
     }*/
}

ParentableMotionElement.prototype.applyTransform = function()
{
    // TODO: if scaling factors are not 1, apply inverse scale before this transformation is
    // applied to avoid translation caused by scaling  

    // set transformation matrix
    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
    this.graphMgr.renderContext.leftMultMatrix(this.sectorTransformCompound);
    this.graphMgr.renderContext.applyWorldTransform();

    // TODO: if invsere scale was applied, re-apply scale
}

ParentableMotionElement.prototype.updateVelocityMotion = function(timeIncrement)
{
    // pan, linear velocity
    var panVelocity = this.panVelocity.getValueDirect();
    var linearVelocity = this.linearVelocity.getValueDirect();
    if (panVelocity.x != 0 || panVelocity.y != 0 || panVelocity.z != 0 ||
        linearVelocity.x != 0 || linearVelocity.y != 0 || linearVelocity.z != 0)
    {
        // position
        var position = this.position.getValueDirect();

        // get direction vectors for pan
        var directionVectors = this.getDirectionVectors();

        // get affect position flags
        var linearVelocity_affectPosition_Y = this.linearVelocity_affectPosition_Y.getValueDirect();

        // update position
        position.x = position.x + (directionVectors.right.x * panVelocity.x * timeIncrement) +
                                  (directionVectors.up.x * panVelocity.y * timeIncrement) +
                                  (directionVectors.forward.x * panVelocity.z * timeIncrement) +
                                  (linearVelocity.x * timeIncrement);
        if (linearVelocity_affectPosition_Y)
        {
            position.y = position.y + (directionVectors.right.y * panVelocity.x * timeIncrement) +
                                      (directionVectors.up.y * panVelocity.y * timeIncrement) +
                                      (directionVectors.forward.y * panVelocity.z * timeIncrement) +
                                      (linearVelocity.y * timeIncrement);
        }
        position.z = position.z + (directionVectors.right.z * panVelocity.x * timeIncrement) +
                                  (directionVectors.up.z * panVelocity.y * timeIncrement) +
                                  (directionVectors.forward.z * panVelocity.z * timeIncrement) +
                                  (linearVelocity.z * timeIncrement);

        this.position.setValueDirect(position.x, position.y, position.z);
    }

    // angular velocity
    var angularVelocity = this.angularVelocity.getValueDirect();
    if (angularVelocity.x != 0 || angularVelocity.y != 0 || angularVelocity.z != 0)
    {
        // rotation
        var rotation = this.rotation.getValueDirect();

        // update rotation
        rotation.x = rotation.x + (angularVelocity.x * timeIncrement);
        rotation.y = rotation.y + (angularVelocity.y * timeIncrement);
        rotation.z = rotation.z + (angularVelocity.z * timeIncrement);

        this.rotation.setValueDirect(rotation.x, rotation.y, rotation.z);
    }

    // scalar velocity
    var scalarVelocity = this.scalarVelocity.getValueDirect();
    if (scalarVelocity.x != 0 || scalarVelocity.y != 0 || scalarVelocity.z != 0)
    {
        // rotation
        var scale = this.scale.getValueDirect();

        // update rotation
        scale.x = scale.x + (scalarVelocity.x * timeIncrement);
        scale.y = scale.y + (scalarVelocity.y * timeIncrement);
        scale.z = scale.z + (scalarVelocity.z * timeIncrement);

        this.scale.setValueDirect(scale.x, scale.y, scale.z);
    }
}

ParentableMotionElement.prototype.updateSimpleTransform = function()
{
    var modified = false;

    if (this.updatePosition || this.updateRotation || this.updateQuaternion || this.updateScale || this.updatePivot)
    {
        var values;

        if (this.updatePosition)
        {
            this.updatePosition = false;

            values = this.position.getValueDirect();
            this.translationMatrix.loadTranslation(values.x, values.y, values.z);

            modified = true;
        }
        /*
        if (this.updateRotation)
        {
            this.updateRotation = false;

            values = this.rotation.getValueDirect();
            var quat = new Quaternion();
            quat.loadXYZAxisRotation(values.x, values.y, values.z);
            //this.quaternion.setValueDirect(quat);
            this.rotationMatrix = quat.getMatrix();

            modified = true;
        }
        */
        if (this.updateQuaternion)
        {
            this.updateQuaternion = false;
            
            var quat = this.quaternion.getValueDirect();
            this.rotationMatrix = quat.getMatrix();

            modified = true;
        }
        
        if (this.updateScale)
        {
            this.updateScale = false;

            values = this.scale.getValueDirect();
            this.scaleMatrix.loadScale(values.x, values.y, values.z);

            modified = true;
        }

        if (this.updatePivot)
        {
            this.updatePivot = false;

            values = this.pivot.getValueDirect();
            this.pivotMatrix.loadTranslation(-values.x, -values.y, -values.z);

            modified = true;
        }

        if (this.updateSectorPosition)
        {
            this.updateSectorPosition = false;

            values = this.sectorPosition.getValueDirect();
            this.sectorTranslationMatrix.loadTranslation(values.x, values.y, values.z);

            modified = true;
        }

        if (modified)
        {
            this.transformModified.pulse();

            // pre-multiply pivot/scale/rotation since this is applied to both regular and sector transforms
            var psr = new Matrix4x4();
            psr.loadMatrix(this.pivotMatrix.multiply(this.scaleMatrix.multiply(this.rotationMatrix)));

            this.transformSimple.loadMatrix(psr.multiply(this.translationMatrix));
            this.sectorTransformSimple.loadMatrix(psr.multiply(this.sectorTranslationMatrix));

            // force any motion children to update their display lists
            this.updateChildDisplayLists();
        }
    }

    return modified;
}

ParentableMotionElement.prototype.updateCompoundTransform = function()
{
    this.transformCompound.loadMatrix(this.transformSimple);
    this.sectorTransformCompound.loadMatrix(this.sectorTransformSimple);

    if (this.motionParent)
    {
        // account for parent's object-inspected rotation
        var inspectionRotationMatrix = new Matrix4x4();
        var inspectionGroup = getInspectionGroup(this.motionParent);
        if (inspectionGroup)
        {
            var translate = inspectionGroup.getChild(0);
            var translationMatrix = translate.getAttribute("matrix").getValueDirect();
            
            var scaleInverse = inspectionGroup.getChild(1);
            var scaleInverseMatrix = scaleInverse.getAttribute("matrix").getValueDirect();
            
            var quaternionRotate = inspectionGroup.getChild(2);
            var rotationMatrix = quaternionRotate.getAttribute("matrix").getValueDirect();
            
            var scale = inspectionGroup.getChild(3);
            var scaleMatrix = scale.getAttribute("matrix").getValueDirect();
            
            var translateBack = inspectionGroup.getChild(4);
            var translationBackMatrix = translateBack.getAttribute("matrix").getValueDirect();
            
            inspectionRotationMatrix = translationBackMatrix.multiply(scaleMatrix.multiply(
                    rotationMatrix.multiply(scaleInverseMatrix.multiply(translationMatrix))));
        }
        
        if (this.inheritsPosition && this.inheritsRotation && this.inheritsScale && this.inheritsPivot)
        {
            this.transformCompound.loadMatrix(this.transformCompound.multiply(inspectionRotationMatrix.multiply(this.motionParent.transformCompound)));
            this.sectorTransformCompound.loadMatrix(this.sectorTransformCompound.multiply(inspectionRotationMatrix.multiply(this.motionParent.sectorTransformCompound)));
        }
        else // !m_inheritsPosition || !m_inheritsRotation || !m_inheritsScale || !m_inheritsPivot
        {
            // TODO
        }
    }
}

ParentableMotionElement.prototype.updateWorldMotionInfo = function()
{
    this.worldTransform.setValueDirect(this.transformCompound);
    this.sectorWorldTransform.setValueDirect(this.sectorTransformCompound);

    this.updateWorldCenter();
    this.updateWorldPosition();
    this.updateWorldRotation();
    this.updateWorldScale();
}

ParentableMotionElement.prototype.updateWorldCenter = function()
{
    var center = this.center.getValueDirect();
    center = this.transformCompound.transform(center.x, center.y, center.z, 1);
    this.worldCenter.setValueDirect(center.x, center.y, center.z);

    center = this.center.getValueDirect();
    center = this.sectorTransformCompound.transform(center.x, center.y, center.z, 1);
    this.sectorWorldCenter.setValueDirect(center.x, center.y, center.z);
}

ParentableMotionElement.prototype.updateWorldPosition = function()
{
    var position = this.transformCompound.transform(0, 0, 0, 1);
    this.worldPosition.setValueDirect(position.x, position.y, position.z);

    position = this.sectorTransformCompound.transform(0, 0, 0, 1);
    this.sectorWorldPosition.setValueDirect(position.x, position.y, position.z);
}

ParentableMotionElement.prototype.updateWorldRotation = function()
{
    var rotation = this.transformCompound.getRotationAngles();
    this.worldRotation.setValueDirect(rotation.x, rotation.y, rotation.z);
}

ParentableMotionElement.prototype.updateWorldScale = function()
{
    var scale = this.transformCompound.getScalingFactors();
    this.worldScale.setValueDirect(scale.x, scale.y, scale.z);
}

ParentableMotionElement.prototype.synchronizePosition = function()
{
    // synchronize position with sector position if necessary (don't sync if not necessary to avoid 
    // the circular dependency between position & sector position

    // get sector origin (use [0, 0, 0] for parented objects)
    var sectorOrigin = new Vector3D();
    if (this.motionParent)
    {
        sectorOrigin.x = 0;
        sectorOrigin.y = 0;
        sectorOrigin.z = 0;
    }
    else // !motionParent
    {
        sectorOrigin = this.sectorOrigin.getValueDirect();
    }

    // get sector position
    var sectorPosition = this.sectorPosition.getValueDirect();

    // get world position
    var position = new Vector3D();
    position.x = sectorOrigin.x + sectorPosition.x;
    position.y = sectorOrigin.y + sectorPosition.y;
    position.z = sectorOrigin.z + sectorPosition.z;

    // update position
    this.position.removeModifiedCB(ParentableMotionElement_PositionModifiedCB, this);
    this.position.setValueDirect(position.x, position.y, position.z);
    this.position.addModifiedCB(ParentableMotionElement_PositionModifiedCB, this);

    // flag a position update
    this.updatePosition = true;
}

ParentableMotionElement.prototype.synchronizeSectorPosition = function()
{
    // synchronize sector position with position if necessary (don't sync if not necessary to avoid 
    // the circular dependency between position & sector position

    // get sector origin (use [0, 0, 0] for parented objects)
    var sectorOrigin = new Vector3D;
    if (this.motionParent)
    {
        sectorOrigin.x = 0;
        sectorOrigin.y = 0;
        sectorOrigin.z = 0;
    }
    else // !motionParent
    {
        sectorOrigin = this.sectorOrigin.getValueDirect();
    }

    // get world position
    var position = this.position.getValueDirect();

    // get sector position
    var sectorPosition = new Vector3D;
    sectorPosition.x = position.x - sectorOrigin.x;
    sectorPosition.y = position.y - sectorOrigin.y;
    sectorPosition.z = position.z - sectorOrigin.z;

    // update sector position
    this.sectorPosition.removeModifiedCB(ParentableMotionElement_SectorPositionModifiedCB, this);
    this.sectorPosition.setValueDirect(sectorPosition.x, sectorPosition.y, sectorPosition.z);
    this.sectorPosition.addModifiedCB(ParentableMotionElement_SectorPositionModifiedCB, this);

    // flag a sector position update
    this.updateSectorPosition = true;
}

ParentableMotionElement.prototype.getDirectionVectors = function()
{
    var up = this.sectorTransformCompound.transform(0, 1, 0, 0);
    var right = this.sectorTransformCompound.transform(1, 0, 0, 0);
    var forward = this.sectorTransformCompound.transform(0, 0, 1, 0);

    return {
        up: up,
        right: right,
        forward: forward
    };
}

ParentableMotionElement.prototype.setMotionParent = function(parent)
{
    if (parent == this)
        return;

    if (this.motionParent)
    {
        for (var i = 0; i < this.motionParent.motionChildren.length; i++)
        {
            if (this.motionParent.motionChildren[i] == this)
            {
                
                this.motionParent.motionChildren.splice(i, 1);
                break;
            }
        }
    }
    
    this.motionParent = parent;
    
    if (parent)
    {
        parent.motionChildren.push(this);
        // make sure this' parent attribute is updated (would not be if this method is called directly); don't invoke modified CB
        this.parent.removeModifiedCB(ParentableMotionElement_ParentModifiedCB, this);
        this.parent.copyValue(parent.name);
        this.parent.addModifiedCB(ParentableMotionElement_ParentModifiedCB, this);
    }
    else
    {
        this.parent.removeModifiedCB(ParentableMotionElement_ParentModifiedCB, this);
        this.parent.setValueDirect("");
        this.parent.addModifiedCB(ParentableMotionElement_ParentModifiedCB, this);
    }

    // set sector position to account for parenting
    this.synchronizeSectorPosition();
    
    this.setModified();
}

ParentableMotionElement.prototype.isMotionAncestor = function(pme)
{
    if (!pme || !this.motionParent) 
        return false;
    
    if (this.motionParent == pme)
        return true;
    
    return this.motionParent.isMotionAncestor(pme);
}
    
ParentableMotionElement.prototype.velocityModified = function()
{
    if (this.panVelocity.isZero() &&
            this.linearVelocity.isZero() &&
            this.angularVelocity.isZero() &&
            this.scalarVelocity.isZero())
    {
        this.nonZeroVelocity = false;
    }
    else
    {
        this.nonZeroVelocity = true;
    }
}

ParentableMotionElement.prototype.setModified = function()
{
    // call base-class implementation
    RenderableElement.prototype.setModified.call(this);
    
    // call for motion children
    for (var i = 0; i < this.motionChildren.length; i++)
    {
        this.motionChildren[i].setModified();
    }
}

function ParentableMotionElement_PositionModifiedCB(attribute, container)
{
    container.updatePosition = true;
    container.synchronizeSectorPosition();
    container.setModified();
}

function ParentableMotionElement_RotationModifiedCB(attribute, container)
{
    //container.updateRotation = true;
    //container.setModified();
    var values = attribute.getValueDirect();
    var quat = new Quaternion();
    quat.loadXYZAxisRotation(values.x, values.y, values.z);
    container.quaternion.setValueDirect(quat);
}

function ParentableMotionElement_QuaternionModifiedCB(attribute, container)
{
    container.updateQuaternion = true;
    container.setModified();
}

function ParentableMotionElement_ScaleModifiedCB(attribute, container)
{
    container.updateScale = true;
    container.setModified();
}

function ParentableMotionElement_PivotModifiedCB(attribute, container)
{
    container.updatePivot = true;
    container.setModified();
}

function ParentableMotionElement_SectorOriginModifiedCB(attribute, container)
{
    container.synchronizeSectorPosition();
    container.setModified();
}

function ParentableMotionElement_SectorPositionModifiedCB(attribute, container)
{
    container.updateSectorPosition = true;
    container.synchronizePosition();
    container.setModified();
}

function ParentableMotionElement_ParentModifiedCB(attribute, container)
{
    container.setMotionParent(container.registry.find(attribute.getValueDirect().join("")));
}

function ParentableMotionElement_VelocityModifiedCB(attribute, container)
{
    container.velocityModified();
    container.setModified();
}

function ParentableMotionElement_InheritanceModifiedCB(attribute, container)
{
    container.updateInheritance = true;
    container.setModified();
}
function DirectiveParams()
{
    this.directive = null;
    this.path = null;
    this.pathIndex = 0;
    this.currentNodePath = new Stack();
    this.userData = null;
}

Directive.prototype = new AttributeContainer();
Directive.prototype.constructor = Directive;

function Directive()
{
    AttributeContainer.call(this);
    this.className = "Directive";
    this.attrType = eAttrType.Directive;
    
    this.name = new StringAttr("");
    this.enabled = new BooleanAttr(true);
    this.rootNode = new ReferenceAttr(null);
    
    this.registerAttribute(this.name, "name");
    this.registerAttribute(this.enabled, "enabled");
    this.registerAttribute(this.rootNode, "rootNode");
}
SGDirective.prototype = new Directive();
SGDirective.prototype.constructor = SGDirective;

function SGDirective()
{
    Directive.call(this);
    this.className = "SGDirective";
    
    this.graphMgr = null;
}

SGDirective.prototype.setGraphMgr = function(graphMgr)
{
    this.graphMgr = graphMgr;
}
UpdateParams.prototype = new DirectiveParams();
UpdateParams.prototype.constructor = UpdateParams();

function UpdateParams() // combined CUpdateParams & GtUpdateParams in this version
{
    DirectiveParams.call(this);
    
    this.pass = 0;
    this.timeIncrement = 0;
    this.visited = [];
    this.nextPass = [];
    this.displayListObj = null;
    this.disableDisplayLists = false;
}

UpdateDirective.prototype = new SGDirective();
UpdateDirective.prototype.constructor = UpdateDirective;

function UpdateDirective()
{
    SGDirective.call(this);
    this.className = "UpdateDirective";
    this.attrType = eAttrType.UpdateDirective;
    
    this.name.setValueDirect("UpdateDirective");
    
    this.timeIncrement = new NumberAttr(0);
    
    this.registerAttribute(this.timeIncrement, "timeIncrement");
    
    this.collideDirective = new CollideDirective();
}

UpdateDirective.prototype.setRegistry = function(registry)
{
    this.collideDirective.setRegistry(registry);    
    
    // call base-class implementation
    SGDirective.prototype.setRegistry.call(this, registry);    
    
    this.registry.register(this.collideDirective);
}

UpdateDirective.prototype.setGraphMgr = function(graphMgr)
{
    // call base-class implementation
    SGDirective.prototype.setGraphMgr.call(this, graphMgr);
    
    this.collideDirective.setGraphMgr(graphMgr);  
}

UpdateDirective.prototype.execute = function(root, detectCollision)
{
    root = root || this.rootNode.getValueDirect();
    if (detectCollision == undefined) detectCollision = true;
    
    this.update();
   
    if (detectCollision)
    {
        // detect collisions
        collideParams = new CollideParams();
        collideParams.directive = this.collideDirective;
        this.collideDirective.execute(root, collideParams);
        
        // update (second pass)
        this.update();
    }
}

UpdateDirective.prototype.update = function()
{
    var params = new UpdateParams();
    params.directive = this.updateDirective;
    params.disableDisplayLists = this.resetDisplayLists; 
    params.timeIncrement = this.timeIncrement.getValueDirect();
    
    for (var i in this.graphMgr.updateRegistry.nodes)
    {
        this.graphMgr.updateRegistry.nodes[i].update(params, false);
    }
    
    this.graphMgr.updateRegistry.clear();
}
Camera.prototype = new ParentableMotionElement();
Camera.prototype.constructor = Camera;

function Camera()
{
    ParentableMotionElement.call(this);
    this.className = "Camera";
    this.attrType = eAttrType.Camera;
    
    this.projectionMatrix = new Matrix4x4();
    this.viewport = new Viewport();
    this.updateNearDistance = false;
    this.updateFarDistance = false;
    this.updateClipPlanes = true;
    this.near = 0;
    this.far = 0;
    
    this.nearDistance = new NumberAttr(0);
    this.farDistance = new NumberAttr(0);
    this.viewVolume = new ViewVolumeAttr();
    //this.viewports
    this.sectorOriginUpdatesEnabled = new BooleanAttr(false);
    //this.updateSectorOrigin
    
    this.nearDistance.addModifiedCB(Camera_NearDistanceModifiedCB, this);
    this.farDistance.addModifiedCB(Camera_FarDistanceModifiedCB, this);
    
    this.registerAttribute(this.nearDistance, "nearDistance");
    this.registerAttribute(this.farDistance, "farDistance");
    this.registerAttribute(this.viewVolume, "viewVolume");
}

Camera.prototype.update = function(params, visitChildren)
{
    if (this.updateNearDistance)
    {
        this.updateNearDistance = false;
        
        this.near = this.nearDistance.getValueDirect();
        
        this.updateClipPlanes = true;
    }
    
    if (this.updateFarDistance)
    {
        this.updateFarDistance = false;
        
        this.far = this.farDistance.getValueDirect();
        
        this.updateClipPlanes = true;
    }
    
    // call base-class implementation
    ParentableMotionElement.prototype.update.call(this, params, visitChildren);
}

Camera.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        // call base-class implementation
        ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    switch (directive)
    {
        case "render":
            {
                this.applyTransform();

                params.projMatrix.loadMatrix(this.projectionMatrix);
                params.viewMatrix.loadMatrix(this.sectorTransformCompound);
                params.viewMatrix.invert(); // put in view-space
            }
            break;

        case "rayPick":
            {
                // if a specific camera is specified in the ray pick params,
                // make sure this is the specified camera
                if (!params.camera || params.camera == this)
                {
                    var ray = this.getViewSpaceRay(params.viewport, params.clickPoint);
                    params.rayOrigin = ray.origin;
                    params.rayDir = ray.direction;
                    params.currentCamera = this;
                    params.nearDistance = this.nearDistance.getValueDirect();
                    params.farDistance = this.farDistance.getValueDirect();
                    params.viewMatrix.loadMatrix(this.sectorTransformCompound);
                    params.viewMatrix.invert(); // put in view-space
                }
            }
            break;

        case "bbox":
            {
                // caller wants bbox in view space; set view matrix so that geometry nodes 
                // can multiply world matrix by view matrix to get worldView matrix
                params.viewMatrix.loadMatrix(this.sectorTransformCompound);
                params.viewMatrix.invert(); // put in view-space
            }
            break;
                       
        case "highlight":
            {
                params.projMatrix.loadMatrix(this.projectionMatrix); // TODO: using jittered allows for antialiasing
                params.viewMatrix.loadMatrix(this.transformCompound);
                params.viewMatrix.invert(); // put in view-space
                params.camera = this;
                params.viewport = this.viewport;
            }
            break;
    }

    // call base-class implementation
    ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
}

Camera.prototype.applyTransform = function()
{
    var matrix = new Matrix4x4();
    matrix.loadMatrix(this.sectorTransformCompound);
    matrix.invert();

    this.graphMgr.renderContext.setMatrixMode(RC_VIEW);
    this.graphMgr.renderContext.loadMatrix(matrix);
    this.graphMgr.renderContext.applyViewTransform();
}

function Camera_NearDistanceModifiedCB(attribute, container)
{
    container.updateNearDistance = true;
    container.setModified();
}

function Camera_FarDistanceModifiedCB(attribute, container)
{
    container.updateFarDistance = true;
    container.setModified();
}
OrthographicCamera.prototype = new Camera();
OrthographicCamera.prototype.constructor = OrthographicCamera;

function OrthographicCamera()
{
    Camera.call(this);
    this.className = "OrthographicCamera";
    this.attrType = eAttrType.OrthographicCamera;
    
    this.updateWidth = false;
    
    this.width = new NumberAttr(2);
    
    this.width.addModifiedCB(OrthographicCamera_WidthModifiedCB, this);
    
    this.registerAttribute(this.width, "width");
}

OrthographicCamera.prototype.update = function(params, visitChildren)
{
    if (this.updateWidth)
    {
        this.updateWidth = false;

        this.updateClipPlanes = true;
    }
    
    // call base-class implementation
    Camera.prototype.update.call(this, params, visitChildren);
}

OrthographicCamera.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        // call base-class implementation
        Camera.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    
    switch (directive)
    {
    case "render":
        {
            if (!this.viewport.equals(params.viewport))
            {
                this.viewport = params.viewport;
                this.updateClipPlanes = true;  
            }
            
            if (this.updateClipPlanes)
            {
                this.updateClipPlanes = false;
                
                this.setClipPlanes();
            }
            
            params.viewVolume.setOrthographic(this.left, this.right, this.top, this.bottom, this.near, this.far);
            
            this.applyOrthographicTransform();
        }
        break;
    }
    
    // call base-class implementation
    Camera.prototype.apply.call(this, directive, params, visitChildren);
}

OrthographicCamera.prototype.setClipPlanes = function()
{
    var width = this.width.getValueDirect();
    var height = width * this.viewport.height / this.viewport.width;
    
    this.top = height / 2;
    this.bottom = -this.top;
    this.right = width / 2;
    this.left = -this.right;
    
    this.projectionMatrix.loadMatrix(this.graphMgr.renderContext.orthographicMatrixLH(this.left, this.right,
        this.top, this.bottom, this.near, this.far));
        
    // update view-volume attribute
    var viewVolume = new ViewVolume();
    viewVolume.setOrthographic(this.left, this.right, this.top, this.bottom, this.near, this.far);
    this.viewVolume.setValueDirect(viewVolume.left, viewVolume.right, viewVolume.top, viewVolume.bottom,
        viewVolume.near, viewVolume.far);    
}

OrthographicCamera.prototype.applyOrthographicTransform = function()
{
    this.graphMgr.renderContext.projectionMatrixStack.top().loadMatrix(this.projectionMatrix);
    this.graphMgr.renderContext.applyProjectionTransform();
}

OrthographicCamera.prototype.getViewSpaceRay = function(viewport, clickPoint)
{
    // normalize click coordinates so they span [-1, 1] on each axis
    var normX =  ((clickPoint.x - viewport.x) / viewport.width  * 2 - 1);
    var normY = -((clickPoint.y - viewport.y) / viewport.height * 2 - 1);

    // determine the width/2 of the visible portion of the x axis on the 
    // far clipping plane
    var farX  = (this.right - this.left) / 2;

    // determine the height/2 of the visible portion of the y axis on the
    // far clipping plane
    var farY  = (this.top - this.bottom) / 2;

    // set ray origin as point within visible portion of x, y on the 
    // near clipping plane corresponding to the normalized screen coordinates
    var origin = new Vector3D(normX * farX, normY * farY, this.near);

    // set ray direction as point within visible portion of x, y on the 
    // far clipping plane corresponding to the normalized screen coordinates
    //rayDir = CVector3Df(normX * farX, normY * farY, m_far);
    var direction = new Vector3D(0, 0, 1);
    
    return { origin: origin, direction: direction };  
}

function OrthographicCamera_WidthModifiedCB(attribute, container)
{
    container.updateWidth = true;
    container.setModified();
}
PerspectiveCamera.prototype = new Camera();
PerspectiveCamera.prototype.constructor = PerspectiveCamera;

function PerspectiveCamera()
{
    Camera.call(this);
    this.className = "PerspectiveCamera";
    this.attrType = eAttrType.PerspectiveCamera;
    
    this.updateZoom = false;
    this.fovyRadians = 0;
    this.left = 0;
    this.right = 0;
    this.top = 0;
    this.bottom = 0;
    
    this.zoom = new NumberAttr(0);
    
    this.zoom.addModifiedCB(PerspectiveCamera_ZoomModifiedCB, this);
    
    this.registerAttribute(this.zoom, "zoom");
}

PerspectiveCamera.prototype.update = function(params, visitChildren)
{
    if (this.updateZoom)
    {
        this.updateZoom = false;
        
        this.fovyRadians = 2 * Math.atan2(1, this.zoom.getValueDirect());

        this.updateClipPlanes = true;
    }
    
    // call base-class implementation
    Camera.prototype.update.call(this, params, visitChildren);
}

PerspectiveCamera.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        // call base-class implementation
        Camera.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    
    switch (directive)
    {
    case "render":
        {
            if (!this.viewport.equals(params.viewport))
            {
                this.viewport = params.viewport;
                this.updateClipPlanes = true;  
            }
            
            if (this.updateClipPlanes)
            {
                this.updateClipPlanes = false;
                
                this.setClipPlanes();
            }
            
            params.viewVolume.setPerspective(this.fovyRadians, this.viewport.width / this.viewport.height, this.near, this.far);
            
            this.applyPerspectiveTransform();
        }
        break;
    }
    
    // call base-class implementation
    Camera.prototype.apply.call(this, directive, params, visitChildren);
}

PerspectiveCamera.prototype.setClipPlanes = function()
{
    this.top = Math.tan(this.fovyRadians / 2) * this.near;
    this.bottom = -this.top;
    this.right = this.top * (this.viewport.width / this.viewport.height);
    this.left = -this.right;
    
    this.projectionMatrix.loadMatrix(this.graphMgr.renderContext.perspectiveMatrixLH(this.left, this.right,
        this.top, this.bottom, this.near, this.far));
        
    // update view-volume attribute
    var viewVolume = new ViewVolume();
    viewVolume.setPerspective(this.fovyRadians, this.viewport.width / this.viewport.height, this.near, this.far);
    this.viewVolume.setValueDirect(viewVolume.left, viewVolume.right, viewVolume.top, viewVolume.bottom,
        viewVolume.near, viewVolume.far);    
}

PerspectiveCamera.prototype.applyPerspectiveTransform = function()
{
    this.graphMgr.renderContext.setMatrixMode(RC_PROJECTION);
    this.graphMgr.renderContext.loadMatrix(this.projectionMatrix);
    this.graphMgr.renderContext.applyProjectionTransform();
}

PerspectiveCamera.prototype.getViewSpaceRay = function(viewport, clickPoint)
{
    // normalize click coordinates so they span [-1, 1] on each axis
    var normX =  ((clickPoint.x - viewport.x) / viewport.width  * 2 - 1);
    var normY = -((clickPoint.y - viewport.y) / viewport.height * 2 - 1);

    // get vertical field of view in radians
    var fovY = this.fovyRadians;

    // get horizontal field of view in radians
    var fovX = 2 * Math.atan(viewport.width / viewport.height * Math.tan(fovY / 2));

    // determine the width/2 of the visible portion of the x axis on the 
    // far clipping plane
    var farX  = Math.tan(fovX / 2) * this.far;

    // determine the height/2 of the visible portion of the y axis on the
    // far clipping plane
    var farY  = Math.tan(fovY / 2) * this.far;

    // set ray origin
    var origin = new Vector3D(0, 0, 0);

    // set ray direction as point within visible portion of x, y on the 
    // far clipping plane corresponding to the normalized screen coordinates
    var direction = new Vector3D(normX * farX, normY * farY, this.far);
    
    return { origin: origin, direction: direction };  
}

function PerspectiveCamera_ZoomModifiedCB(attribute, container)
{
    container.updateZoom = true;
    container.setModified();
}
Light.prototype = new ParentableMotionElement();
Light.prototype.constructor = Light;

function Light()
{
    ParentableMotionElement.call(this);
    this.className = "Light";
    this.attrType = eAttrType.Light;

    this.updateAmbient = true;
    this.updateDiffuse = true;
    this.updateSpecular = true;
    this.updateConstantAttenuation = true;
    this.updateLinearAttenuation = true;
    this.updateQuadraticAttenuation = true;
    this.lightDesc = new LightDesc();
    this.lightDesc.validMembersMask = 0;
    this.lightIndex = 0;
    this.setLightDesc = false;

    this.ambient = new ColorAttr(0, 0, 0, 1);
    this.diffuse = new ColorAttr(1, 1, 1, 1);
    this.specular = new ColorAttr(1, 1, 1, 1);
    this.constantAttenuation = new NumberAttr(1);
    this.linearAttenuation = new NumberAttr(0);
    this.quadraticAttenuation = new NumberAttr(0);
    this.shadowCaster = new BooleanAttr(false);

    this.ambient.addModifiedCB(Light_AmbientModifiedCB, this);
    this.diffuse.addModifiedCB(Light_DiffuseModifiedCB, this);
    this.specular.addModifiedCB(Light_SpecularModifiedCB, this);
    this.constantAttenuation.addModifiedCB(Light_ConstantAttenuationModifiedCB, this);
    this.linearAttenuation.addModifiedCB(Light_LinearAttenuationModifiedCB, this);
    this.quadraticAttenuation.addModifiedCB(Light_QuadraticAttenuationModifiedCB, this);

    this.registerAttribute(this.ambient, "ambient");
    this.registerAttribute(this.diffuse, "diffuse");
    this.registerAttribute(this.specular, "specular");
    this.registerAttribute(this.constantAttenuation, "constantAttenuation");
    this.registerAttribute(this.linearAttenuation, "linearAttenuation");
    this.registerAttribute(this.quadraticAttenuation, "quadraticAttenuation");
    this.registerAttribute(this.shadowCaster, "shadowCaster");
}

Light.prototype.setGraphMgr = function(graphMgr)
{
    this.lightIndex = graphMgr.getAvailableLightIndex();

    // call base-class implementation
    ParentableMotionElement.prototype.setGraphMgr.call(this, graphMgr);
}

Light.prototype.update = function(params, visitChildren)
{
    if (this.updateAmbient)
    {
        this.updateAmbient = false;

        this.lightDesc.ambient.copy(this.ambient.getValueDirect());
        this.lightDesc.validMembersMask |= LIGHTDESC_AMBIENT_BIT;
    }

    if (this.updateDiffuse)
    {
        this.updateDiffuse = false;

        this.lightDesc.diffuse.copy(this.diffuse.getValueDirect());
        this.lightDesc.validMembersMask |= LIGHTDESC_DIFFUSE_BIT;
    }

    if (this.updateSpecular)
    {
        this.updateSpecular = false;

        this.lightDesc.specular.copy(this.specular.getValueDirect());
        this.lightDesc.validMembersMask |= LIGHTDESC_SPECULAR_BIT;
    }

    if (this.updateConstantAttenuation)
    {
        this.updateConstantAttenuation = false;

        this.lightDesc.constantAttenuation = this.constantAttenuation.getValueDirect();
        this.lightDesc.validMembersMask |= LIGHTDESC_CONSTANT_ATT_BIT;
    }

    if (this.updateLinearAttenuation)
    {
        this.updateLinearAttenuation = false;

        this.lightDesc.linearAttenuation = this.linearAttenuation.getValueDirect();
        this.lightDesc.validMembersMask |= LIGHTDESC_LINEAR_ATT_BIT;
    }

    if (this.updateQuadraticAttenuation)
    {
        this.updateQuadraticAttenuation = false;

        this.lightDesc.quadraticAttenuation = this.quadraticAttenuation.getValueDirect();
        this.lightDesc.validMembersMask |= LIGHTDESC_QUADRATIC_ATT_BIT;
    }

    if (this.lightDesc.validMembersMask)
    {
        this.setLightDesc = true;
    }

    // ensure continued update (lights are transformed by view matrix)
    this.setModified();

    // call base-class implementation
    ParentableMotionElement.prototype.update.call(this, params, visitChildren);
}

Light.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        switch (directive)
        {
            case "render":
                {
                    this.setLightEnabled();
                }
                break;
        }

        // call base-class implementation
        ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    switch (directive)
    {
        case "render":
            {
                if (this.setLightDesc)
                {
                    this.setLightDesc = false;

                    this.applyLightDesc();
                }

                this.setLightEnabled();
                params.lights.push(this);
            }
            break;
    }

    // call base-class implementation
    ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
}

Light.prototype.applyLightDesc = function()
{
    this.graphMgr.renderContext.setLight(this.lightIndex, this.lightDesc);
}

Light.prototype.setLightEnabled = function()
{
    this.graphMgr.renderContext.enableLight(this.lightIndex, this.enabled.getValueDirect() ? 1 : 0);
}

Light.prototype.onUnregister = function()
{
    // disable light
    this.graphMgr.renderContext.enableLight(this.lightIndex, 0);
}

function Light_AmbientModifiedCB(attribute, container)
{
    container.updateAmbient = true;
    container.setModified();
}

function Light_DiffuseModifiedCB(attribute, container)
{
    container.updateDiffuse = true;
    container.setModified();
}

function Light_SpecularModifiedCB(attribute, container)
{
    container.updateSpecular = true;
    container.setModified();
}

function Light_ConstantAttenuationModifiedCB(attribute, container)
{
    container.updateConstantAttenuation = true;
    container.setModified();
}

function Light_LinearAttenuationModifiedCB(attribute, container)
{
    container.updateLinearAttenuation = true;
    container.setModified();
}

function Light_QuadraticAttenuationModifiedCB(attribute, container)
{
    container.updateQuadraticAttenuation = true;
    container.setModified();
}

DirectionalLight.prototype = new Light();
DirectionalLight.prototype.constructor = DirectionalLight;

function DirectionalLight()
{
    Light.call(this);
    this.className = "DirectionalLight";
    this.attrType = eAttrType.DirectionalLight;
    
    this.lightDesc.type = "directional";
}

DirectionalLight.prototype.update = function(params, visitChildren)
{
    this.validMembersMask = 0;
    
    // call base-class implementation
    Light.prototype.update.call(this, params, visitChildren);
}

DirectionalLight.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        Light.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    
    switch (directive)
    {
    case "render":
        {      
            var direction = this.sectorTransformCompound.transform(0, 0, 1, 0);
            this.lightDesc.direction.copy(direction);
            this.lightDesc.validMembersMask |= LIGHTDESC_DIRECTION_BIT; 
            
            // must re-update direction every frame because OpenGL transforms
            // light direction by the current modelView matrix
            this.setLightDesc = true;
        }
        break;
    }
    
    // call base-class implementation
    Light.prototype.apply.call(this, directive, params, visitChildren);
}
PointLight.prototype = new Light();
PointLight.prototype.constructor = PointLight;

function PointLight()
{
    Light.call(this);
    this.className = "PointLight";
    this.attrType = eAttrType.PointLight;
    
    this.lightDesc.type = "point";
    
    this.updateRange = false;
    
    this.range = new NumberAttr();
    
    this.range.addModifiedCB(PointLight_RangeModifiedCB, this);

    this.registerAttribute(this.range, "range");
}

PointLight.prototype.setGraphMgr = function(graphMgr)
{
    // call base-class implementation
    Light.prototype.setGraphMgr.call(this, graphMgr);
    
    this.range.setValueDirect(FLT_MAX); // invoke modified CB
}

PointLight.prototype.update = function(params, visitChildren)
{
    this.validMembersMask = 0;
    
    if (this.updateRange)
    {
        this.updateRange = false;

        this.lightDesc.range = this.range.getValueDirect();
        this.lightDesc.validMembersMask |= LIGHTDESC_RANGE_BIT;
    }
    
    // call base-class implementation
    Light.prototype.update.call(this, params, visitChildren);
}

PointLight.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        // call base-class implementation
        Light.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    
    switch (directive)
    {
    case "render":
        {      
            var position = this.sectorTransformCompound.transform(0, 0, 0, 1);
            this.lightDesc.position.copy(position);
            this.lightDesc.validMembersMask |= LIGHTDESC_POSITION_BIT;

            // signifies this is a point light (not a spot light)
            this.lightDesc.outerConeDegrees = 180;
            this.lightDesc.validMembersMask |= LIGHTDESC_OUTER_CONE_DEG_BIT;
            
            // must re-update position every frame because OpenGL transforms
            // light position by the current modelView matrix
            this.setLightDesc = true;
        }
        break;
    }
    
    // call base-class implementation
    Light.prototype.apply.call(this, directive, params, visitChildren);
}

function PointLight_RangeModifiedCB(attribute, container)
{
    container.updateRange = true;
    container.setModified();
}
GlobalIllumination.prototype = new SGNode();
GlobalIllumination.prototype.constructor = GlobalIllumination;

function GlobalIllumination()
{
    SGNode.call(this);
    this.className = "GlobalIllumination";
    this.attrType = eAttrType.GlobalIllumination;
    
    this.updateAmbient = true;
    this.setGlobalIllumination = false;
    
    this.ambient = new ColorAttr(0, 0, 0, 1);
    
    this.ambient.addModifiedCB(GlobalIllumination_AmbientModifiedCB, this);
    
    this.registerAttribute(this.ambient, "ambient");
}

GlobalIllumination.prototype.update = function(params, visitChildren)
{
    if (this.updateAmbient)
    {
        this.updateAmbient = false;
        
        this.setGlobalIllumination = true;
    }
    
    // call base-class implementation
    SGNode.prototype.update.call(this, params, visitChildren);
}

GlobalIllumination.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        // call base-class implementation
        ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    
    switch (directive)
    {
    case "render":
        {
            if (this.setGlobalIllumination)
            {
                this.setGlobalIllumination = false;
                
                this.applyGlobalIllumination();
            }
        }
        break;
    }
    
    // call base-class implementation
    SGNode.prototype.apply.call(this, directive, params, visitChildren);
}

GlobalIllumination.prototype.applyGlobalIllumination = function()
{
    this.graphMgr.renderContext.setGlobalIllumination(this.ambient.getValueDirect());
}

GlobalIllumination.prototype.onUnregister = function()
{
    // disable global illumination (set to black)
    var black = new Color(0, 0, 0, 0);
    this.graphMgr.renderContext.setGlobalIllumination(black);  
}

function GlobalIllumination_AmbientModifiedCB(attribute, container)
{
    container.updateAmbient = true;
    container.setModified();
}
Group.prototype = new SGNode();
Group.prototype.constructor = Group;

function Group()
{
    SGNode.call(this);
    this.className = "Group";
    this.attrType = eAttrType.Group;

    this.proxyChildAttrs = new BooleanAttr(false);

    this.proxyChildAttrs.addModifiedCB(Group_ProxyChildAttrsModifiedCB, this);

    this.registerAttribute(this.proxyChildAttrs, "proxyChildAttrs");
}

Group.prototype.addChild = function(child)
{
    if (this.proxyChildAttrs.getValueDirect() == true)
    {
        this.proxyAttributes(child);
    }

    // call base-class implementation
    SGNode.prototype.addChild.call(this, child);
}

Group.prototype.insertChild = function(child, at)
{
    if (this.proxyChildAttrs.getValueDirect() == true)
    {
        this.proxyAttributes(child);
    }

    // call base-class implementation
    SGNode.prototype.insertChild.call(this, child, at);
}

Group.prototype.removeChild = function(child)
{
    if (this.proxyChildAttrs.getValueDirect() == true)
    {
        //UnProxyAttributes(child);
        this.synchronizeProxiedAttributes();
    }

    // call base-class implementation
    return SGNode.prototype.removeChild.call(this, child);
}

Group.prototype.replaceChild = function(replacement, replacee)
{
    if (this.proxyChildAttrs.getValueDirect() == true)
    {
        //UnProxyAttributes(replacee);
        this.proxyAttributes(replacement);
        this.synchronizeProxiedAttributes(); // replacement might not be the same type as replacee
    }

    // call base-class implementation
    return SGNode.prototype.replaceChild.call(this, replacement, replacee);
}

Group.prototype.update = function(params, visitChildren)
{
    // call base-class implementation
    SGNode.prototype.update.call(this, params, visitChildren);
}

Group.prototype.apply = function(directive, params, visitChildren)
{
    // call base-class implementation
    SGNode.prototype.apply.call(this, directive, params, visitChildren);
}

Group.prototype.proxyChildAttrsModified = function()
{
    // TODO
}

function Group_ProxyChildAttrsModifiedCB(attribute, container)
{
    container.proxyChildAttrsModified();
}

function Group_ProxiedAttrModifiedCB(attribute, data)
{
    data.group.proxiedAttrModified(data.proxiedNodeTypeString, attribute, data.proxiedAttrName);
}

Isolator.prototype = new Group();
Isolator.prototype.constructor = Isolator;

function Isolator()
{
    Group.call(this);
    this.className = "Isolator";
    this.attrType = eAttrType.Isolator;

    this.updateIsolateTransforms = true;
    this.updateIsolateLights = true;
    this.updateIsolateMaterials = true;
    this.updateIsolateTextures = true;
    this.updateIsolateFog = true;
    this.updateIsolateClipPlanes = true;

    this.isolateTransforms = new BooleanAttr(false);
    this.isolateLights = new BooleanAttr(false);
    this.isolateMaterials = new BooleanAttr(false);
    this.isolateTextures = new BooleanAttr(false);
    this.isolateDissolves = new BooleanAttr(false);
    this.isolateGlobalIlluminations = new BooleanAttr(false);
    this.isolateLightModels = new BooleanAttr(false);
    this.isolateFog = new BooleanAttr(false);
    this.isolateClipPlanes = new BooleanAttr(false);
    this.isolateRenderModes = new BooleanAttr(false);

    this.isolateTransforms.addModifiedCB(Isolator_IsolateTransformsModifiedCB, this);
    this.isolateLights.addModifiedCB(Isolator_IsolateLightsModifiedCB, this);
    this.isolateMaterials.addModifiedCB(Isolator_IsolateMaterialsModifiedCB, this);
    this.isolateTextures.addModifiedCB(Isolator_IsolateTexturesModifiedCB, this);
    this.isolateFog.addModifiedCB(Isolator_IsolateFogModifiedCB, this);
    this.isolateClipPlanes.addModifiedCB(Isolator_IsolateClipPlanesModifiedCB, this);

    this.registerAttribute(this.isolateTransforms, "isolateTransforms");
    this.registerAttribute(this.isolateLights, "isolateLights");
    this.registerAttribute(this.isolateMaterials, "isolateMaterials");
    this.registerAttribute(this.isolateTextures, "isolateTextures");
    this.registerAttribute(this.isolateDissolves, "isolateDissolves");
    this.registerAttribute(this.isolateGlobalIlluminations, "isolateGlobalIlluminations");
    this.registerAttribute(this.isolateLightModels, "isolateLightModels");
    this.registerAttribute(this.isolateFog, "isolateFog");
    this.registerAttribute(this.isolateClipPlanes, "isolateClipPlanes");
    this.registerAttribute(this.isolateRenderModes, "isolateRenderModes");
}

Isolator.prototype.update = function(params, visitChildren)
{
    // call base-class implementation
    Group.prototype.update.call(this, params, visitChildren);
}

Isolator.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        // call base-class implementation
        Group.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    var isolateLights = this.isolateLights.values[0];
    var isolateTransforms = this.isolateTransforms.values[0];
    var isolateTextures = this.isolateTextures.values[0];
    var isolateDissolves = this.isolateDissolves.values[0];
    var isolateClipPlanes = this.isolateClipPlanes.values[0];

    var lastDissolve = 0;
    var dissolveNode = null;

    var lastProjMatrix = null;
    var lastViewMatrix = null;
    var lastWorldMatrix = null;

    var lights = null;
    
    switch (directive)
    {
        case "render":
        case "shadow":
            {
                this.pushIsolatedStates();

                // TODO

                // push lights
                if (isolateLights)
                {
                    // TODO
                    lights = params.lights.slice();
                }

                // push transforms
                if (isolateTransforms)
                {
                    lastProjMatrix = params.projMatrix;
                    lastViewMatrix = params.viewMatrix;
                    lastWorldMatrix = params.worldMatrix;

                    // TEMP -- move to pushIsolatedStates
                    this.graphMgr.renderContext.setMatrixMode(RC_PROJECTION);
                    this.graphMgr.renderContext.pushMatrix();
                    this.graphMgr.renderContext.setMatrixMode(RC_VIEW);
                    this.graphMgr.renderContext.pushMatrix();
                    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
                    this.graphMgr.renderContext.pushMatrix();
                }

                // push textures
                if (isolateTextures)
                {
                    this.graphMgr.textureArrayStack.push(new TextureArray(this.graphMgr.textureArrayStack.top()));

                    // TODO: projection stack 
                }
            }
            break;

        case "rayPick":
            {
                // push dissolve and dissolve node
                if (isolateDissolves)
                {
                    lastDissolve = params.dissolve;
                    dissolveNode = this.graphMgr.getCurrentDissolve();
                }

                // push transforms
                if (isolateTransforms)
                {
                    // TODO
                }

                // push clip planes
                if (isolateClipPlanes)
                {
                    // TODO
                }
            }
            break;

        case "bbox":
            {
                // push transforms
                if (isolateTransforms)
                {
                    lastWorldMatrix = params.worldMatrix;
                }
            }
            break;

        case "collide":
            {
                // push transforms
                if (isolateTransforms)
                {
                    lastWorldMatrix = params.worldMatrix;
                }
            }
            break;

        case "highlight":
            {
                // push transforms
                if (isolateTransforms)
                {
                    lastWorldMatrix = params.worldMatrix;
                }
            }
            break;
    }

    // call base-class implementation
    Group.prototype.apply.call(this, directive, params, visitChildren);

    switch (directive)
    {
        case "render":
        case "shadow":
            {
                this.popIsolatedStates();

                // TODO

                // pop lights
                if (isolateLights)
                {
                    // TODO
                    params.lights = lights.slice();
                }
                
                // pop transforms
                if (isolateTransforms)
                {
                    params.projMatrix = lastProjMatrix;
                    params.viewMatrix = lastViewMatrix;
                    params.worldMatrix = lastWorldMatrix;

                    // TEMP -- move to popIsolatedStates
                    this.graphMgr.renderContext.setMatrixMode(RC_PROJECTION);
                    this.graphMgr.renderContext.popMatrix();
                    this.graphMgr.renderContext.setMatrixMode(RC_VIEW);
                    this.graphMgr.renderContext.popMatrix();
                    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
                    this.graphMgr.renderContext.popMatrix();
                }

                // pop textures
                if (isolateTextures)
                {
                    this.graphMgr.textureArrayStack.pop();

                    // TODO: projection stack 
                }
            }
            break;

        case "rayPick":
            {
                // pop dissolve
                if (isolateDissolves)
                {
                    params.dissolve = lastDissolve;
                    this.graphMgr.setCurrentDissolve(dissolveNode);
                }

                // pop transforms
                if (isolateTransforms)
                {
                    // TODO
                }

                // pop clip planes
                if (isolateClipPlanes)
                {
                    // TODO
                }
            }
            break;

        case "bbox":
            {
                // pop transforms
                if (isolateTransforms)
                {
                    params.worldMatrix = lastWorldMatrix;
                }
            }
            break;

        case "collide":
            {
                // pop transforms
                if (isolateTransforms)
                {
                    params.worldMatrix = lastWorldMatrix;
                }
            }
            break;

        case "highlight":
            {
                // pop transforms
                if (isolateTransforms)
                {
                    params.worldMatrix = lastWorldMatrix;
                }
            }
            break;
    }
}

Isolator.prototype.pushIsolatedStates = function()
{
    // TODO


}

Isolator.prototype.popIsolatedStates = function()
{
    // TODO
}

function Isolator_IsolateTransformsModifiedCB(attribute, container)
{
    container.updateIsolateTransforms = true;
    container.setModified();
}

function Isolator_IsolateLightsModifiedCB(attribute, container)
{
    container.updateIsolateLights = true;
    container.setModified();
}

function Isolator_IsolateMaterialsModifiedCB(attribute, container)
{
    container.updateIsolateMaterials = true;
    container.setModified();
}

function Isolator_IsolateTexturesModifiedCB(attribute, container)
{
    container.updateIsolateTextures = true;
    container.setModified();
}

function Isolator_IsolateFogModifiedCB(attribute, container)
{
    container.updateIsolateFog = true;
    container.setModified();
}

function Isolator_IsolateClipPlanesModifiedCB(attribute, container)
{
    container.updateIsolateClipPlanes = true;
    container.setModified();
}

Selector.prototype = new Group();
Selector.prototype.constructor = Selector;

function Selector()
{
    Group.call(this);
    this.className = "Selector";
    this.attrType = eAttrType.Selector;
    
    this.selectee = new NumberAttr(0);
    
    this.registerAttribute(this.selectee, "selectee");
}

Selector.prototype.update = function(params, visitChildren)
{
    // call update for selected child    
    var selectee = this.selectee.getValueDirect();
    if (visitChildren && this.children.length > selectee)
    {
        this.children[selectee].update(params, visitChildren);
        return;
    }
    
    // call base-class implementation
    Group.prototype.update.call(this, params, visitChildren);
}

Selector.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        // call base-class implementation
        Group.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    // call apply for selected child
    var selectee = this.selectee.getValueDirect();
    if (visitChildren && this.children.length > selectee)
    {
        this.children[selectee].apply(directive, params, visitChildren);
        return;
    }
    
    // call base-class implementation
    Group.prototype.apply.call(this, directive, params, visitChildren);
}

Dissolve.prototype = new SGNode();
Dissolve.prototype.constructor = Dissolve;

function Dissolve()
{
    SGNode.call(this);
    this.className = "Dissolve";
    this.attrType = eAttrType.Dissolve;
    
    this.lastDissolve = 0;

    this.dissolve = new NumberAttr(0);

    this.dissolve.addModifiedCB(Dissolve_DissolveModifiedCB, this);

    this.registerAttribute(this.dissolve, "dissolve");
}

Dissolve.prototype.update = function(params, visitChildren)
{
    // call base-class implementation
    SGNode.prototype.update.call(this, params, visitChildren);
}

Dissolve.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        // call base-class implementation
        Group.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    switch (directive)
    {
        case "render":
        case "shadow":
            {
                var dissolve = this.dissolve.getValueDirect();
                this.lastDissolve = dissolve;
                
                params.dissolve = dissolve;
            }
            break;

        case "rayPick":
            {
                params.dissolve = this.lastDissolve;
            }
            break;
    }

    // call base-class implementation
    SGNode.prototype.apply.call(this, directive, params, visitChildren);
}

function Dissolve_DissolveModifiedCB(attribute, container)
{
    container.setModified();   
}
RenderParams.prototype = new DirectiveParams();
RenderParams.prototype.constructor = RenderParams();

function RenderParams()
{
    DirectiveParams.call(this);
    
    this.viewport = new Viewport();
    this.projMatrix = new Matrix4x4();
    this.viewMatrix = new Matrix4x4();
    this.worldMatrix = new Matrix4x4();
    this.dissolve = 0;
    this.opacity = 1;
    this.distanceSortAgent = null;
    this.drawTextures = true;
    this.displayListObj = null;
    this.disableDisplayLists = false;
    this.resetDisplayLists = false;
    this.viewVolume = new ViewVolume();
    this.lights = [];
    this.modelID = 0;
}

RenderDirective.prototype = new SGDirective();
RenderDirective.prototype.constructor = RenderDirective;

function RenderDirective()
{
    SGDirective.call(this);
    this.className = "RenderDirective";
    this.attrType = eAttrType.RenderDirective;
    
    this.name.setValueDirect("RenderDirective");

    this.backgroundImageSet = false;
    
    this.program = null;
    this.viewport = new ViewportAttr();
    this.backgroundColor = new ColorAttr(1, 1, 1, 1);
    this.backgroundImageFilename = new StringAttr("");
    this.foregroundImageFilename = new StringAttr("");
    this.foregroundAlphaFilename = new StringAttr("");
    this.foregroundFadeEnabled = new BooleanAttr(false);
    this.texturesEnabled = new BooleanAttr(true);
    this.shadowsEnabled = new BooleanAttr(false);//true);
    this.timeIncrement = new NumberAttr(0);
    this.highlightType = new NumberAttr(eHighlightType.None);
    
    this.viewport.addModifiedCB(RenderDirective_ViewportModifiedCB, this);
    this.backgroundColor.addModifiedCB(RenderDirective_BackgroundColorModifiedCB, this);
    this.backgroundImageFilename.addModifiedCB(RenderDirective_BackgroundImageFilenameModifiedCB, this);
    this.shadowsEnabled.addModifiedCB(RenderDirective_ShadowsEnabledModifiedCB, this);
    
    this.registerAttribute(this.viewport, "viewport");
    this.registerAttribute(this.backgroundColor, "backgroundColor");
    this.registerAttribute(this.backgroundImageFilename, "backgroundImageFilename");
    this.registerAttribute(this.foregroundImageFilename, "foregroundImageFilename");
    this.registerAttribute(this.foregroundAlphaFilename, "foregroundAlphaFilename");   
    this.registerAttribute(this.foregroundFadeEnabled, "foregroundFadeEnabled");   
    this.registerAttribute(this.texturesEnabled, "texturesEnabled");
    this.registerAttribute(this.shadowsEnabled, "shadowsEnabled");
    this.registerAttribute(this.timeIncrement, "timeIncrement");
    this.registerAttribute(this.highlightType, "highlightType");
    
    this.updateDirective = new UpdateDirective();
    this.timeIncrement.addTarget(this.updateDirective.getAttribute("timeIncrement"));
    this.resetDisplayLists = false;
    
    this.distanceSortAgent = new DistanceSortAgent();
       
    this.highlightDirective = new HighlightDirective();
    this.highlightType.addTarget(this.highlightDirective.getAttribute("highlightType"));
    
    this.shadowDirective = new ShadowDirective();
    
    this.backgroundScreen = new Isolator();
    this.backgroundScreen.isolateTextures.setValueDirect(true);
    
    this.backgroundTexture = new MediaTexture();
    this.backgroundScreen.addChild(this.backgroundTexture);
    
    this.backgroundScreenRect = new ScreenRect();
    this.backgroundScreenRect.setTexture(this.backgroundTexture);
    this.backgroundScreen.addChild(this.backgroundScreenRect);
}

RenderDirective.prototype.setRegistry = function(registry)
{
    this.distanceSortAgent.setRegistry(registry);
    this.updateDirective.setRegistry(registry);
    this.highlightDirective.setRegistry(registry);
    this.shadowDirective.setRegistry(registry); registry.register(this.shadowDirective);
    this.backgroundScreen.setRegistry(registry);
    this.backgroundTexture.setRegistry(registry);
    this.backgroundScreenRect.setRegistry(registry);
    
    // call base-class implementation
    SGDirective.prototype.setRegistry.call(this, registry);    
}

RenderDirective.prototype.setGraphMgr = function(graphMgr)
{
    this.distanceSortAgent.setGraphMgr(graphMgr);
    this.updateDirective.setGraphMgr(graphMgr);
    this.highlightDirective.setGraphMgr(graphMgr);
    this.shadowDirective.setGraphMgr(graphMgr);
    this.backgroundScreen.setGraphMgr(graphMgr);
    this.backgroundTexture.setGraphMgr(graphMgr);
    this.backgroundScreenRect.setGraphMgr(graphMgr);
    
    // create shader program
    if (this.shadowsEnabled.getValueDirect() == true)
    {
        this.program = graphMgr.renderContext.createProgram(pcf_shadow_mapping_render_pass_vs, pcf_shadow_mapping_render_pass_fs);
    }
    else
    {
        this.program = graphMgr.renderContext.createProgram(default_vertex_lighting_vs, default_vertex_lighting_fs);
    }

    // call base-class implementation
    SGDirective.prototype.setGraphMgr.call(this, graphMgr);
}

RenderDirective.prototype.execute = function(root)
{  
    // set shader program
    this.graphMgr.renderContext.useProgram(this.program);
    
    // draw background
    //this.drawBackground();
    
    root = root || this.rootNode.getValueDirect();

    this.updateDirective.execute(root);
    
    if (this.shadowsEnabled.getValueDirect() == true)
    {
        // setup shadow map
        this.shadowDirective.execute(root);
    }

    // render
    params = new RenderParams();
    params.directive = this;
    params.path = null;
    params.pathIndex = 1;
    params.viewport.loadViewport(this.viewport.getValueDirect());
    params.distanceSortAgent = this.distanceSortAgent;
    params.drawTextures = this.texturesEnabled.getValueDirect();

    // if resetting display lists, set the disableDisplayLists renderParams flag this render
    if (this.resetDisplayLists)
    {
    	params.resetDisplayLists = true;
        this.resetDisplayLists = false;
    }
        
    root.apply("render", params, true);
    
    // sort and draw semi-transparent geometries (if any)
    if (!this.distanceSortAgent.isEmpty())
    {
        this.distanceSortAgent.sort();
        this.distanceSortAgent.draw();
        this.distanceSortAgent.clear();
    }
    
    // draw highlights
    this.drawHighlights(root);
}

RenderDirective.prototype.drawBackground = function()
{
    if (!this.backgroundImageSet) return;
    
    // update
    var visited = this.updateDirective.execute(this.backgroundScreen, false);
    
    // render
    params = new RenderParams();
    params.directive = this;
    params.path = null;
    params.pathIndex = 1;
    params.viewport.loadViewport(this.viewport.getValueDirect());

    visited[0].apply("render", params, true);
}

RenderDirective.prototype.drawHighlights = function(root)
{
    // apply highlight directive if specified
    switch (this.highlightType.getValueDirect())
    {
    case eHighlightType.FourPass:
    case eHighlightType.EightPass:
        this.highlightDirective.execute(root);
        break;

    case eHighlightType.None:
    default:
        break;
    }   
}

RenderDirective.prototype.backgroundColorModified = function()
{
    var color = this.backgroundColor.getValueDirect();
    this.graphMgr.renderContext.clearColor(color.r, color.g, color.b, color.a);    
}

function RenderDirective_ViewportModifiedCB(attribute, container)
{
    var vp = container.viewport.getValueDirect();
    var url = container.backgroundImageFilename.getValueDirect().join("");
    container.graphMgr.renderContext.setBackgroundImage(url, vp.width, vp.height);
}

function RenderDirective_BackgroundColorModifiedCB(attribute, container)
{
    container.backgroundColorModified();
}

function RenderDirective_BackgroundImageFilenameModifiedCB(attribute, container)
{
    var vp = container.viewport.getValueDirect();
    var pathInfo = formatPath(container.backgroundImageFilename.getValueDirect().join(""));
    
    container.backgroundImageFilename.removeModifiedCB(RenderDirective_BackgroundImageFilenameModifiedCB, container);
    container.backgroundImageFilename.setValueDirect(pathInfo[0]);
    container.backgroundImageFilename.addModifiedCB(RenderDirective_BackgroundImageFilenameModifiedCB, container);
    
    //container.graphMgr.renderContext.setBackgroundImage(pathInfo[0], vp.width, vp.height);
    container.backgroundTexture.imageFilename.setValueDirect(pathInfo[0]);
    container.backgroundImageSet = true;
}

function RenderDirective_ShadowsEnabledModifiedCB(attribute, container)
{
    var enabled = attribute.getValueDirect();
    if (enabled)
    {
        container.program = container.graphMgr.renderContext.createProgram(pcf_shadow_mapping_render_pass_vs, pcf_shadow_mapping_render_pass_fs);
    }
    else
    {
        container.program = container.graphMgr.renderContext.createProgram(default_vertex_lighting_vs, default_vertex_lighting_fs);
    }
}
RayPickParams.prototype = new DirectiveParams();
RayPickParams.prototype.constructor = RayPickParams();

function RayPickParams()
{
    DirectiveParams.call(this);
    
    /// camera to perform selection testing with
    this.camera = null;
    /// current camera
    this.currentCamera = null;
    /// current viewport
    this.viewport = new Viewport();
    /// click point
    this.clickPoint = new Vector2D();
    /// origin of the ray
    this.rayOrigin = new Vector3D();
    /// direction of the ray
    this.rayDir = new Vector3D();
    /// camera near distance
    this.nearDistance = 0;
    /// camera far distance
    this.farDistance = 0;
    /// current view matrix
    this.viewMatrix = new Matrix4x4();
    /// current world matrix
    this.worldMatrix = new Matrix4x4();
    /// current sector origin
    this.sectorOrigin = new Vector3D();
    /// current material double-sided setting 
    this.doubleSided = false;
    /// current material opacity setting
    this.opacity = 0;
    /// current dissolve
    this.dissolve = 0;
    /// current clip plane(s)
    this.clipPlanes = [];
}

function RayPickRecord(path, intersectRecord, camera)
{
    /// the path of the picked geometry
    this.path = path.copy();
    /// intersection record
    this.intersectRecord = intersectRecord;
    /// the camera viewing the picked geometry
    this.camera = camera;
}

RayPickDirective.prototype = new SGDirective();
RayPickDirective.prototype.constructor = RayPickDirective;

function RayPickDirective()
{
    SGDirective.call(this);
    this.className = "RayPickDirective";
    this.attrType = eAttrType.RayPickDirective;
    
    this.name.setValueDirect("RayPickDirective");
    
    this.picked = [];
    
    this.viewport = new ViewportAttr();
    this.camera = new ReferenceAttr(null);
    this.clickPoint = new Vector2DAttr();
    
    this.registerAttribute(this.viewport, "viewport");
    this.registerAttribute(this.camera, "camera");
    this.registerAttribute(this.clickPoint, "clickPoint");
}

RayPickDirective.prototype.execute = function(root)
{
    root = root || this.rootNode.getValueDirect();
    
    // clear previous picks
    this.picked.length = 0;
    
    // pick
    var params = new RayPickParams();
    params.directive = this;
    params.camera = this.camera.getValueDirect();
    params.viewport.loadViewport(this.viewport.getValueDirect());
    params.clickPoint.copy(this.clickPoint.getValueDirect());

    root.apply("rayPick", params, true);
}

RayPickDirective.prototype.addPickRecord = function(record)
{
    // add to picked list according to distance
    for (var i=0; i < this.picked.length; i++)
    {
        if (this.picked[i].intersectRecord.distance > record.intersectRecord.distance)
        {
            break;
        }
    }
    this.picked.splice(i, 0, record);
}






BBoxParams.prototype = new DirectiveParams();
BBoxParams.prototype.constructor = BBoxParams();

function BBoxParams()
{
    DirectiveParams.call(this);

    this.viewSpace = false;
    this.viewMatrix = new Matrix4x4();
    this.worldMatrix = new Matrix4x4();
    this.minPoint = new Vector3D();
    this.maxPoint = new Vector3D();
    this.minMaxSet = false;
}

BBoxDirective.prototype = new SGDirective();
BBoxDirective.prototype.constructor = BBoxDirective;

function BBoxDirective()
{
    SGDirective.call(this);
    this.className = "BBoxDirective";
    this.attrType = eAttrType.BBoxDirective;

    this.min = new Vector3D();
    this.max = new Vector3D();
    
    this.name.setValueDirect("BBoxDirective");

    this.viewSpace = new BooleanAttr(false);
    this.viewTransform = new Matrix4x4Attr(1, 0, 0, 0,
                                           0, 1, 0, 0,
                                           0, 0, 1, 0,
                                           0, 0, 0, 1);

    this.registerAttribute(this.viewSpace, "viewSpace");
    this.registerAttribute(this.viewTransform, "viewTransform");
}

BBoxDirective.prototype.execute = function(root)
{
    root = root || this.rootNode.getValueDirect();

    // setup bbox params structure
    var params = new BBoxParams();
    params.viewSpace = this.viewSpace.getValueDirect();
    var viewMatrix = this.viewTransform.getValueDirect();
    params.viewMatrix.load(viewMatrix._11, viewMatrix._12, viewMatrix._13, viewMatrix._14,
                           viewMatrix._21, viewMatrix._22, viewMatrix._23, viewMatrix._24,
                           viewMatrix._31, viewMatrix._32, viewMatrix._33, viewMatrix._34,
                           viewMatrix._41, viewMatrix._42, viewMatrix._43, viewMatrix._44);

    // calculate bounding box
    root.apply("bbox", params, true);

    this.min = params.minPoint;
    this.max = params.maxPoint;
}

BBoxDirective.prototype.getBounds = function()
{
    return { min: this.min, max: this.max };
}

Geometry.prototype = new RenderableElement();
Geometry.prototype.constructor = Geometry;

function Geometry()
{
    RenderableElement.call(this);
    this.className = "Geometry";
    this.attrType = eAttrType.Geometry;

    this.boundingTree = null;
    this.updateBoundingTree = false;

    this.selectable = new BooleanAttr(true);
    this.cullable = new BooleanAttr(true);
    this.show = new BooleanAttr(true);
    this.approximationLevels = new NumberAttr(1);
    this.sortPolygons = new BooleanAttr(false);
    this.flipPolygons = new BooleanAttr(false);
    this.shadowCaster = new BooleanAttr(false);
    this.shadowTarget = new BooleanAttr(true);
    this.highlight = new BooleanAttr(false);

    this.selectable.addModifiedCB(Geometry_SelectableModifiedCB, this);
    this.show.addModifiedCB(Geometry_ShowModifiedCB, this);
    this.approximationLevels.addModifiedCB(Geometry_ApproximationLevelsModifiedCB, this);

    this.registerAttribute(this.selectable, "selectable");
    this.registerAttribute(this.cullable, "cullable");
    this.registerAttribute(this.show, "show");
    this.registerAttribute(this.approximationLevels, "approximationLevels");
    this.registerAttribute(this.sortPolygons, "sortPolygons");
    this.registerAttribute(this.flipPolygons, "flipPolygons");
    this.registerAttribute(this.shadowCaster, "shadowCaster");
    this.registerAttribute(this.shadowTarget, "shadowTarget");
    this.registerAttribute(this.highlight, "highlight");
}

Geometry.prototype.update = function(params, visitChildren)
{
    if (this.updateBoundingTree)
    {
        this.updateBoundingTree = false;

        this.buildBoundingTree();
    }
    
    // call base-class implementation
    RenderableElement.prototype.update.call(this, params, visitChildren);
}

Geometry.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        // call base-class implementation
        RenderableElement.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    switch (directive)
    {
        case "render":
            {
                var drawNow = true;
                var dissolve = params.dissolve;
                var opacity = params.opacity;
                var worldViewMatrix = params.worldMatrix.multiply(params.viewMatrix);
                var scale = worldViewMatrix.getScalingFactors();               
                if (dissolve == 1)// || opacity == 0) // completely transparent objects can still reflect specularity
                {
                    // completely transparent, skip drawing
                    drawNow = false;
                }
                else if (this.cullable.getValueDirect() == true && !this.isRecordingDisplayList() && 
                         this.outsideViewVolume(params.viewVolume, max3(scale.x, scale.y, scale.z), 
                                                worldViewMatrix) == eCullResult.Outside)
                {
                    // outside viewing-volume, skip drawing
                    drawNow = false;
                }
                else if (dissolve > 0 ||
                         opacity < 1 ||
                         this.graphMgr.textureArrayStack.top().textures[eTextureType.Transparency].length > 0 ||
                         this.graphMgr.projectionTextureArrayStack.top().textures[eTextureType.Transparency].length > 0)
                {
                    // get bbox of geometry
                    var bounds = this.getBBox();

                    // add geometry to distance sort agent for sorted drawing
                    params.distanceSortAgent.addGeometry(this, bounds.min, bounds.max, dissolve);
                    drawNow = false;
                }

                if (drawNow)
                {
                    this.draw(dissolve);
                }
            }
            break;       

        case "rayPick":
            {
                if (this.boundingTree &&
                    this.selectable.getValueDirect() == true &&
                    params.opacity > 0 &&
                    params.dissolve < 1)
                {
                    var worldViewMatrix = params.worldMatrix.multiply(params.viewMatrix);
                    var scale = worldViewMatrix.getScalingFactors();

                    var intersectRecord = rayPick(this.boundingTree, params.rayOrigin, params.rayDir,
                                                  params.nearDistance, params.farDistance,
                                                  params.worldMatrix, params.viewMatrix,
                                                  max3(scale.x, scale.y, scale.z),
                                                  params.doubleSided, params.clipPlanes);
                    if (intersectRecord)
                    {
                        params.currentNodePath.push(this);
                        params.directive.addPickRecord(new RayPickRecord(params.currentNodePath, intersectRecord, params.camera));
                        params.currentNodePath.pop();
                    }
                }
            }
            break;

        case "bbox":
            {
                var bounds = this.getBBox();

                var matrix = new Matrix4x4();
                matrix.loadMatrix(params.worldMatrix);

                if (params.viewSpace)
                {
                    // user wants bbox in view space; multiply world matrix by view matrix
                    // to get worldView matrix
                    matrix.loadMatrix(matrix.multiply(params.viewMatrix));
                }

                var min = matrix.transform(bounds.min.x, bounds.min.y, bounds.min.z, 1);
                var max = matrix.transform(bounds.max.x, bounds.max.y, bounds.max.z, 1);

                if (params.minMaxSet)
                {
                    params.minPoint.x = Math.min(params.minPoint.x, Math.min(min.x, max.x));
                    params.minPoint.y = Math.min(params.minPoint.y, Math.min(min.y, max.y));
                    params.minPoint.z = Math.min(params.minPoint.z, Math.min(min.z, max.z));

                    params.maxPoint.x = Math.max(params.maxPoint.x, Math.max(min.x, max.x));
                    params.maxPoint.y = Math.max(params.maxPoint.y, Math.max(min.y, max.y));
                    params.maxPoint.z = Math.max(params.maxPoint.z, Math.max(min.z, max.z));
                }
                else // !params.minMaxSet
                {
                    params.minPoint.x = Math.min(min.x, max.x);
                    params.minPoint.y = Math.min(min.y, max.y);
                    params.minPoint.z = Math.min(min.z, max.z);

                    params.maxPoint.x = Math.max(min.x, max.x);
                    params.maxPoint.y = Math.max(min.y, max.y);
                    params.maxPoint.z = Math.max(min.z, max.z);

                    params.minMaxSet = true;
                }
            }
            break;
            
        case "highlight":
            {
                if (this.highlight.getValueDirect())
                {
                    if (params.targets.length > 0)
                    {
                        params.targets[params.targets.length-1].geometries.push(this);
                    }
                }
            }
            break;
    }

    // call base-class implementation
    RenderableElement.prototype.apply.call(this, directive, params, visitChildren);
}

Geometry.prototype.draw = function(dissolve)
{
}

Geometry.prototype.drawPrimitives = function()
{
}

Geometry.prototype.getBBox = function()
{
    return { min: this.bbox.min.getValueDirect(), max: this.bbox.max.getValueDirect() };
}

Geometry.prototype.getTriangles = function()
{
    return new Array();
}

Geometry.prototype.outsideViewVolume = function(viewVolume, scale, worldView)
{
    if (!this.boundingTree)
    {
        return false;
    }
    
    return viewVolumeCull(viewVolume, this.boundingTree.root.sphere, scale, worldView);
}

function Geometry_SelectableModifiedCB(attribute, container)
{
}

function Geometry_ShowModifiedCB(attribute, container)
{
    container.setModified();
}

function Geometry_ApproximationLevelsModifiedCB(attribute, container)
{
    container.updateBoundingTree = true;
    container.setModified();
}
VertexGeometry.prototype = new Geometry();
VertexGeometry.prototype.constructor = VertexGeometry;

function VertexGeometry()
{
    Geometry.call(this);
    this.className = "VertexGeometry";
    this.attrType = eAttrType.VertexGeometry;

    this.updateVertices = false;
    this.updateColors = false;
    this.updateUVCoords = [];
    this.uvCoords = [];
    this.vertexBuffer = null;
    
    this.vertices = new NumberArrayAttr();
    this.colors = new NumberArrayAttr();
    
    this.vertices.addModifiedCB(VertexGeometry_VerticesModifiedCB, this);
    this.colors.addModifiedCB(VertexGeometry_ColorsModifiedCB, this);
    
    this.registerAttribute(this.vertices, "vertices");
    this.registerAttribute(this.colors, "colors");
}

VertexGeometry.prototype.clone = function()
{
    // call base-class implementation
    var clone = Geometry.prototype.clone.call(this);
    
    // set up uv coords
    for (var i = 0; i < this.uvCoords.length; i++)
    {
        clone.getUVCoords(this.uvCoords[i].first).copyValue(this.uvCoords[i].second);
    }
    
    return clone;
}

VertexGeometry.prototype.postCloneChild = function(childClone, pathSrc, pathClone)
{
    var i;
    var node;

    // setup uv-coords for cloned vertex geometry

    // find texture nodes affecting this node
    var textureNodes;
    for (i=0; i < pathSrc.length(); i++)
    {
        node = pathSrc.stack[i];
        if (node.getAttribute() == eAttrType.Texture)
        {
            if (!(textureNodes.push(node))) return;
        }
    }

    // find texture nodes affecting the clone
    var textureNodesClone;
    for (i=0; i < pathClone.length(); i++)
    {
        node = pathClone.stack[i];
        if (node.getAttribute() == eAttrType.Texture)
        {
            if (!(textureNodesClone.push(node))) return;
        }
    }

    // for each texture node, setup the uv-coords (textureNodes.size() and
    // textureNodesClone.size() should be the same, but check anyway)
   // CFloatArrayAttr* uvCoords = null;
    var uvCoords = new NumberArrayAttr();

    for (i=0; i < textureNodes.size() && i < textureNodesClone.size(); i++)
    {
        //uvCoords = FindUVCoords(dynamic_cast<GcTexture*>(textureNodes[i]));
        uvCoords = this.findUVCoords(textureNodes[i]);

        if (uvCoords)
        {
            var uvCoords2 = new NumberArrayAttr();
            uvCoords2 = childClone.getUVCoords(textureNodesClone[i]);
            uvCoords2.copyValue(uvCoords);
        }
    }

    // call base-class implementation
    //GcSGNode::Post_Clone_Child(childClone, pathSrc, pathClone); Not being used right now. Maybe used in the futrue.
}

VertexGeometry.prototype.getUVCoords = function(texture)
{
    for (var i=0; i < this.uvCoords.length; i++)
    {
        if (this.uvCoords[i].first == texture)
            return this.uvCoords[i].second;
    }       
    
    var uvCoords = new NumberArrayAttr();
    uvCoords.addModifiedCB(VertexGeometry_UVCoordsModifiedCB, this);
    this.uvCoords.push(new Pair(texture, uvCoords));
    
    return uvCoords;
}

VertexGeometry.prototype.findUVCoords = function(texture)
{
    if (!texture)
    {
        return null;
    }

    for (var i=0; i < this.uvCoords.length; i++)
    {
        if (this.uvCoords[i].first == texture)
            return this.uvCoords[i].second;
    }

    return null;
}

VertexGeometry.prototype.update = function(params, visitChildren)
{
    if (this.updateVertices)
    {
        this.updateVertices = false;
        
        var vertices = this.vertices.getValueDirect();
        this.vertexBuffer.setVertices(vertices);
        
        this.updateBoundingTree = true;
    }
    
    if (this.updateColors)
    {
        this.updateColors = false;
        
        this.vertexBuffer.setColors(this.colors.getValueDirect());    
    }
    
    if (this.updateUVCoords.length)
    {
        for (var i=0; i < this.updateUVCoords.length; i++)
        {
            for (var j=0; j < this.uvCoords.length; j++)
            {
                if (this.uvCoords[j].second == this.updateUVCoords[i])
                {
                    this.vertexBuffer.setUVCoords(this.uvCoords[j].first.textureObj, this.uvCoords[j].second.getValueDirect());
                    break;
                }
            }   
        }
        this.updateUVCoords.length = 0;
    }
    
    // call base-class implementation
    Geometry.prototype.update.call(this, params, visitChildren);
}

VertexGeometry.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        // call base-class implementation
        Geometry.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    
    switch (directive)
    {
        case "render":
            {
            }
            break;
            
        case "shadow":
            {
                var drawNow = true;
                var dissolve = params.dissolve;
                var opacity = params.opacity;
                if (dissolve == 1)// || opacity == 0) // completely transparent objects can still reflect specularity
                {
                    // completely transparent, skip drawing
                    drawNow = false;
                }
                
                if (drawNow)
                {
                    this.vertexBuffer.draw();
                }
            }
            break;
    }
    
    // call base-class implementation
    Geometry.prototype.apply.call(this, directive, params, visitChildren);
}

VertexGeometry.prototype.drawTextured = function(dissolve)
{
    var texture0 = null;
    var texture1 = null;

    // enable blending
    //this.graphMgr.renderContext.enable(eRenderMode.AlphaBlend);

    // set blend factors
    //this.graphMgr.renderContext.setBlendFactor(RC_SRC_ALPHA, RC_ONE_MINUS_SRC_ALPHA);

    // get number of texture stages
    var maxStages = 2;//this.graphMgr.renderContext.getMaxTextureStages();

    // get texture array
    var textureArray = this.graphMgr.textureArrayStack.top();

    // get current material node component levels
    var ambientLevel = 1;
    var diffuseLevel = 1;
    var specularLevel = 1;
    var emissiveLevel = 1;
    var material = this.graphMgr.getCurrentMaterial();
    if (material)
    {
        ambientLevel = material.getAttribute("ambientLevel").getValueDirect();
        diffuseLevel = material.getAttribute("diffuseLevel").getValueDirect();
        specularLevel = material.getAttribute("specularLevel").getValueDirect();
        emissiveLevel = material.getAttribute("emissiveLevel").getValueDirect();
    }

    // get current material
    var currMatDesc = this.graphMgr.renderContext.getFrontMaterial();

    // push current material
    //this.graphMgr.renderState.push(RENDERSTATE_MATERIAL_BIT);

    // if non-zero dissolve, set to material
    if (dissolve > 0)
    {
        currMatDesc.ambient.a *= (1 - dissolve);
        currMatDesc.diffuse.a *= (1 - dissolve);
        currMatDesc.specular.a *= (1 - dissolve);
        currMatDesc.emissive.a *= (1 - dissolve);
        this.graphMgr.renderContext.setFrontMaterial(currMatDesc);
    }

    // if transparency texture, set to stage 0
    if (textureArray.textures[eTextureType.Transparency].length)
    {
        var texture = textureArray.textures[eTextureType.Transparency][0];
        var uvCoords = this.getUVCoords(texture);

        if (uvCoords && uvCoords.getLength() > 0)
        {
            // lock texture (keep it from being modified)
            //texture->Lock();

            this.setTextureStage(0, eTextureType.Transparency, texture, texture.transformCompound);
            texture0 = texture;
        }

        // disable stage 1
        if (maxStages > 1)
        {
            this.graphMgr.renderContext.enableTextureStage(1, 0);
            texture1 = null;
        }
    }

    // if color texture, set material for blending
    if (textureArray.textures[eTextureType.Color].length)
    {
        //this.setBlendingMaterial(textureArray.textures[eTextureType.Color][0].getAttribute("opacity").getValueDirect(),
        //    ambientLevel, diffuseLevel, specularLevel, emissiveLevel);
    }

    // set texture blend factor
    this.graphMgr.renderContext.setTextureBlendFactor(currMatDesc.diffuse.a * (1 - dissolve));

    // draw untextured if no color texture is present, or if color texture's opacity < 1
    if (textureArray.textures[eTextureType.Color].length == 0 ||
        textureArray.textures[eTextureType.Color][0].getAttribute("opacity").getValueDirect() < 1)
    {
        this.vertexBuffer.draw();
    }

    if (texture0)
    {
        this.graphMgr.renderContext.enableTextureStage(0, 0);
        //texture0->Unlock();
        texture0 = null;
    }
    if (texture1)
    {
        this.graphMgr.renderContext.enableTextureStage(1, 0);
        //texture1->Unlock();
        texture1 = null;
    }
    
    // draw color texture(s)
    for (var i = 0; i < textureArray.textures[eTextureType.Color].length; i++)
    {
        var texture = textureArray.textures[eTextureType.Color][i];
        var uvCoords = this.getUVCoords(texture);

        if (uvCoords && uvCoords.getLength() > 0)
        {
            // lock texture (keep it from being modified)
            //texture->Lock();

            this.setTextureStage(0, eTextureType.Color, texture, texture.transformCompound);
            texture0 = texture;

            // set material for blending
            //this.setBlendingMaterial(texture.getAttribute("opacity").getValueDirect(),
            //    ambientLevel, diffuseLevel, specularLevel, emissiveLevel);

            // set texture blend factor
            this.graphMgr.renderContext.setTextureBlendFactor(currMatDesc.diffuse.a * (1 - dissolve) * texture.getAttribute("opacity").getValueDirect());
        }

        // if transparency texture, and maxStages > 1, set to stage 1
        if (maxStages > 1)
        {
            if (textureArray.textures[eTextureType.Transparency].length)
            {
                texture = textureArray.textures[eTextureType.Transparency][0];
                uvCoords = this.getUVCoords(texture);

                if (uvCoords && uvCoords.getLength() > 0)
                {
                    // lock texture (keep it from being modified)
                    //texture->Lock();

                    this.setTextureStage(1, eTextureType.Transparency, texture, texture.transformCompound);
                    texture1 = texture;
                }
            }
        }

        // draw primitives
        this.vertexBuffer.draw();

        if (texture0)
        {
            this.graphMgr.renderContext.enableTextureStage(0, 0);
            //texture0->Unlock();
            texture0 = null;
        }
        if (texture1)
        {
            this.graphMgr.renderContext.enableTextureStage(1, 0);
            //texture1->Unlock();
            texture1 = null;
        }
    }

    // TODO
    /*
    // if object doesn't contain any specularity textures,
    // make an additional pass to add specular highlights;
    // skip this step if fog is enabled (causes ultra-white surface artifacts)
    var numSpecularityTextures = textureArray.textures[eTextureType.Specularity].length;
    // TODO: + m_graphMgr->GetProjectionTextureStack().top().textures[GeTextureType_Color].size();

    if (numSpecularityTextures == 0 &&
        specularLevel > 0) // TODO: && !renderEngine->IsRenderModeEnabled(Re_Fog)
    {
        this.setSpecularMaterial(currMatDesc.specular, currMatDesc.glossiness);
        this.graphMgr.renderContext.setBlendFactor(RC_ONE, RC_ONE);
        
        // if transparency texture, set to stage 0
        if (textureArray.textures[eTextureType.Transparency].length)
        {
            var texture = textureArray.textures[eTextureType.Transparency][0];
            var uvCoords = this.getUVCoords(texture);

            if (uvCoords && uvCoords.getLength() > 0)
            {
                // lock texture (keep it from being modified)
                //texture->Lock();

                this.setTextureStage(0, eTextureType.Transparency, texture, texture.transformCompound);
                texture0 = texture;
            }

            // disable stage 1
            if (maxStages > 1)
            {
                this.graphMgr.renderContext.enableTextureStage(1, 0);
                texture1 = null;
            }
        }
        
        // draw primitives
        this.vertexBuffer.draw();
        
        if (texture0)
        {
            this.graphMgr.renderContext.enableTextureStage(0, 0);
            //texture0->Unlock();
            texture0 = null;
        }
    }
    */
    // disable texture stage 0, 1
    this.graphMgr.renderContext.enableTextureStage(0, 0);
    this.graphMgr.renderContext.enableTextureStage(1, 0);
    
    // disable blending
    //this.graphMgr.renderContext.disable(eRenderMode.AlphaBlend);

    // pop current material
    //this.graphMgr.renderState.pop(RENDERSTATE_MATERIAL_BIT);
}

VertexGeometry.prototype.drawPrimitives = function()
{
    this.vertexBuffer.draw();
}

VertexGeometry.prototype.setTextureStage = function(stage, type, texture, textureTransform, 
                                                    textureCoordSrc, planeCoefficients)
{
    // get optional parameters
    textureTransform = textureTransform || new Matrix4x4();
    textureCoordSrc = textureCoordSrc || eTextureCoordSrc.VertexUVs;
    planeCoefficients = planeCoefficients ||  new Matrix4x4();   
    
    // enable texture stage
    this.graphMgr.renderContext.enableTextureStage(stage, 1);

    // get texture wrap
    var widthWrap = texture.getAttribute("widthWrap").getValueDirect();
    var heightWrap = texture.getAttribute("heightWrap").getValueDirect();
    var widthWrapType, heightWrapType;
    switch (widthWrap)
    {
        case eTextureWrap.Clamp:
            widthWrapType = RC_CLAMP_TO_EDGE;
            break;

        case eTextureWrap.Repeat:
        default:
            widthWrapType = RC_REPEAT;
            break;
    }
    switch (heightWrap)
    {
        case eTextureWrap.Clamp:
            heightWrapType = RC_CLAMP_TO_EDGE;
            break;

        case eTextureWrap.Repeat:
        default:
            heightWrapType = RC_REPEAT;
            break;
    }
    
    // set texture
    this.vertexBuffer.setTextureStage(stage, texture.textureObj, 
    widthWrapType, heightWrapType, textureCoordSrc, planeCoefficients);

    // set texture blend operation
    this.graphMgr.renderContext.setTextureBlendOp(texture.blendOp.getValueDirect());

    /* TODO
    // set texture matrix
    // TODO: only load texture transforms if they are enabled
    ReMatrixMode mode;
    switch (stage)
    {
    case 0: mode = ReMatrixMode_Texture0; break;
    case 1: mode = ReMatrixMode_Texture1; break;
    case 2: mode = ReMatrixMode_Texture2; break;
    case 3: mode = ReMatrixMode_Texture3; break;
    case 4: mode = ReMatrixMode_Texture4; break;
    case 5: mode = ReMatrixMode_Texture5; break;
    case 6: mode = ReMatrixMode_Texture6; break;
    case 7: mode = ReMatrixMode_Texture7; break;
    }
    this.graphMgr.renderContext.SetMatrixMode(mode);
    this.graphMgr.renderContext.LoadMatrix(textureTransform);
    
    this.graphMgr.renderContext.SetMatrixMode(ReMatrixMode_WorldView);
     */
}

VertexGeometry.prototype.setBlendingMaterial = function(opacity, ambientLevel, diffuseLevel, 
specularLevel, emissiveLevel)
{
    var matDesc = this.graphMgr.renderContext.getFrontMaterial();
    
    // setup material for texture blending operations
    var ambientBlend  = opacity * ambientLevel;
    var diffuseBlend  = opacity * diffuseLevel;
    var specularBlend = opacity * specularLevel;
    var emissiveBlend = opacity * emissiveLevel;

    // ambient
    matDesc.ambient.r = ambientBlend + matDesc.ambient.r * (1-opacity);
    matDesc.ambient.g = ambientBlend + matDesc.ambient.g * (1-opacity);
    matDesc.ambient.b = ambientBlend + matDesc.ambient.b * (1-opacity);
    //matDesc.ambient.a *= opacity;
    
    // diffuse
    matDesc.diffuse.r = diffuseBlend + matDesc.diffuse.r * (1-opacity);
    matDesc.diffuse.g = diffuseBlend + matDesc.diffuse.g * (1-opacity);
    matDesc.diffuse.b = diffuseBlend + matDesc.diffuse.b * (1-opacity);
    //matDesc.diffuse.a *= opacity;

    // specular (turn off)
    matDesc.specular.r = 0;//specularBlend + matDesc.specular.r * (1-opacity);
    matDesc.specular.g = 0;//specularBlend + matDesc.specular.g * (1-opacity);
    matDesc.specular.b = 0;//specularBlend + matDesc.specular.b * (1-opacity);
    //matDesc.specular.a *= opacity;
    matDesc.glossiness = 1;//matDesc.glossiness;

    // emissive
    matDesc.emissive.r = emissiveBlend + matDesc.emissive.r * (1-opacity);
    matDesc.emissive.g = emissiveBlend + matDesc.emissive.g * (1-opacity);
    matDesc.emissive.b = emissiveBlend + matDesc.emissive.b * (1-opacity);
    //matDesc.emissive.a *= opacity;
    
    matDesc.validMembersMask = MATERIALDESC_ALL_BITS;

    this.graphMgr.renderContext.setFrontMaterial(matDesc);
}

VertexGeometry.prototype.setSpecularMaterial = function(specular, glossiness)
{
    var matDesc = new MaterialDesc();
    matDesc.validMembersMask = MATERIALDESC_ALL_BITS;
    matDesc.specular = specular;
    matDesc.glossiness = glossiness;

    this.graphMgr.renderContext.setFrontMaterial(matDesc);
    this.graphMgr.renderContext.setBlendFactor(RC_ONE_MINUS_SRC_ALPHA, RC_ONE);
}

VertexGeometry.prototype.calculateBBox = function()
{
    var vertices = this.vertices.getValueDirect();
    if (vertices.length < 3) return;
    
    var min = new Vector3D(vertices[0], vertices[1], vertices[2]);
    var max = new Vector3D(vertices[0], vertices[1], vertices[2]);
    
    for (var i=3; i < vertices.length; i+=3)
    {
        min.x = Math.min(min.x, vertices[i  ]);
        min.y = Math.min(min.y, vertices[i+1]);
        min.z = Math.min(min.z, vertices[i+2]);

        max.x = Math.max(max.x, vertices[i  ]);
        max.y = Math.max(max.y, vertices[i+1]);
        max.z = Math.max(max.z, vertices[i+2]);
    }

    this.bbox.getAttribute("min").setValueDirect(min.x, min.y, min.z);
    this.bbox.getAttribute("max").setValueDirect(max.x, max.y, max.z);
}

function VertexGeometry_VerticesModifiedCB(attribute, container)
{
    container.updateVertices = true;
    container.calculateBBox();
    container.setModified();
}

function VertexGeometry_ColorsModifiedCB(attribute, container)
{
    container.updateColors = true;
    container.setModified();
}

function VertexGeometry_UVCoordsModifiedCB(attribute, container)
{
    container.updateUVCoords.push(attribute);
    container.setModified();
}
TriList.prototype = new VertexGeometry();
TriList.prototype.constructor = TriList;

function TriList()
{
    VertexGeometry.call(this);
    this.className = "TriList";
    this.attrType = eAttrType.TriList;
    
    this.primitiveType = RC_TRIANGLES;
    this.updateNormals = false;
    
    this.normals = new NumberArrayAttr();
    
    this.vertices.addModifiedCB(TriList_NormalsModifiedCB, this);
    this.normals.addModifiedCB(TriList_NormalsModifiedCB, this);
    
    this.registerAttribute(this.normals, "normals");
}

TriList.prototype.update = function(params, visitChildren)
{
    if (!this.vertexBuffer)
    {
        this.vertexBuffer = this.graphMgr.renderContext.createVertexBuffer(3);
        this.vertexBuffer.setPrimitiveType(this.primitiveType);
    }
       
    if (this.updateNormals)
    {
        this.updateNormals = false;
        
        this.vertexBuffer.setNormals(this.normals.getValueDirect());
    }
    
    // call base-class implementation
    VertexGeometry.prototype.update.call(this, params, visitChildren);
}

TriList.prototype.apply = function(directive, params, visitChildren)
{
    // call base-class impementation
    VertexGeometry.prototype.apply.call(this, directive, params, visitChildren);
}

TriList.prototype.draw = function(dissolve)
{
    // TODO
    
    // check for presence of textures
    var textureArray = this.graphMgr.textureArrayStack.top();
    if (textureArray.textures[eTextureType.Color].length == 0 &&
        textureArray.textures[eTextureType.Transparency].length == 0)
    {
        // draw untextured
        
        // if non-zero dissolve, set to material
        if (dissolve > 0)
        {
            // get current material
            var currMatDesc = this.graphMgr.renderContext.getFrontMaterial();
        
            currMatDesc.ambient.a *= (1 - dissolve);
            currMatDesc.diffuse.a *= (1 - dissolve);
            currMatDesc.specular.a *= (1 - dissolve);
            currMatDesc.emissive.a *= (1 - dissolve);
            this.graphMgr.renderContext.setFrontMaterial(currMatDesc);
        }
        
        this.vertexBuffer.draw();
    }
    else
    {
        // draw with textures
        this.drawTextured(dissolve);
    }
}

TriList.prototype.buildBoundingTree = function()
{
    var min = this.bbox.getAttribute("min").getValueDirect();
    var max = this.bbox.getAttribute("max").getValueDirect();
    
    this.boundingTree = new Octree();
    this.boundingTree.setTriangles(this.getTriangles(), min, max);
    this.boundingTree.buildTree(this.approximationLevels.getValueDirect());
}

TriList.prototype.getTriangles = function()
{
    var vertices = this.vertices.getValueDirect();
    
    var tris = [];
    for (var i=0, vertex=0; vertex+8 < vertices.length; i++, vertex+=9)
    {
        tris.push(new Triangle(vertices[vertex  ],  // v0
                               vertices[vertex+1],
                               vertices[vertex+2],
                               
                               vertices[vertex+3],  // v1
                               vertices[vertex+4],
                               vertices[vertex+5],
                               
                               vertices[vertex+6],  // v2
                               vertices[vertex+7],
                               vertices[vertex+8]));
    }
    
    return tris;
}

function TriList_NormalsModifiedCB(attribute, container)
{
    container.updateNormals = true;
    container.setModified();
}
Material.prototype = new SGNode();
Material.prototype.constructor = Material;

function Material()
{
    SGNode.call(this);
    this.className = "Material";
    this.attrType = eAttrType.Material;
    
    this.updateColor = false;
    this.updateAmbientLevel = false;
    this.updateDiffuseLevel = false;
    this.updateSpecularLevel = false;
    this.updateEmissiveLevel = false;
    this.updateAmbient = true;
    this.updateDiffuse = true;
    this.updateSpecular = true;
    this.updateEmissive = true;
    this.updateGlossiness = true;
    this.updateOpacity = true;
    this.lastOpacity = 0;
    this.lastDoubleSided = false;
    this.materialDesc = new MaterialDesc();
    this.materialDesc.validMembersMask = MATERIALDESC_ALL_BITS;
    
    this.color = new ColorAttr(1, 1, 1, 1);
    this.ambientLevel = new NumberAttr(1);
    this.diffuseLevel = new NumberAttr(1);
    this.specularLevel = new NumberAttr(1);
    this.emissiveLevel = new NumberAttr(0);
    this.ambient = new ColorAttr(0.2, 0.2, 0.2, 1);
    this.diffuse = new ColorAttr(0.8, 0.8, 0.8, 1);
    this.specular = new ColorAttr(0, 0, 0, 1);
    this.emissive = new ColorAttr(0, 0, 0, 1);
    this.glossiness = new NumberAttr(0);
    this.opacity = new NumberAttr(1);
    this.doubleSided = new BooleanAttr(false);
	
    this.color.addModifiedCB(Material_ColorModifiedCB, this);
    this.ambientLevel.addModifiedCB(Material_AmbientLevelModifiedCB, this);
    this.diffuseLevel.addModifiedCB(Material_DiffuseLevelModifiedCB, this);
    this.specularLevel.addModifiedCB(Material_SpecularLevelModifiedCB, this);
    this.emissiveLevel.addModifiedCB(Material_EmissiveLevelModifiedCB, this);
    this.ambient.addModifiedCB(Material_AmbientModifiedCB, this);
    this.diffuse.addModifiedCB(Material_DiffuseModifiedCB, this);
    this.specular.addModifiedCB(Material_SpecularModifiedCB, this);
    this.emissive.addModifiedCB(Material_EmissiveModifiedCB, this);
    this.glossiness.addModifiedCB(Material_GlossinessModifiedCB, this);
    this.opacity.addModifiedCB(Material_OpacityModifiedCB, this);
    this.doubleSided.addModifiedCB(Material_DoubleSidedModifiedCB, this);

    this.registerAttribute(this.color, "color");
    this.registerAttribute(this.ambientLevel, "ambientLevel");
    this.registerAttribute(this.diffuseLevel, "diffuseLevel");
    this.registerAttribute(this.specularLevel, "specularLevel");
    this.registerAttribute(this.emissiveLevel, "emissiveLevel");
    this.registerAttribute(this.ambient, "ambient");
    this.registerAttribute(this.diffuse, "diffuse");
    this.registerAttribute(this.specular, "specular");
    this.registerAttribute(this.emissive, "emissive");
    this.registerAttribute(this.glossiness, "glossiness");
    this.registerAttribute(this.opacity, "opacity");
    this.registerAttribute(this.doubleSided, "doubleSided");
}

Material.prototype.update = function(params, visitChildren)
{
    if (this.updateColor)
    {
        this.updateColor = false;

        this.updateAmbientLevel = true;
        this.updateDiffuseLevel = true;
        this.updateSpecularLevel = true;
        this.updateEmissiveLevel = true;
    }

    if (this.updateAmbientLevel || this.updateDiffuseLevel || this.updateSpecularLevel || this.updateEmissiveLevel)
    {
        var color = this.color.getValueDirect();

        if (this.updateAmbientLevel)
        {
            this.updateAmbientLevel = false;
            
            var level = this.ambientLevel.getValueDirect();
            this.ambient.setValueDirect(color.r * level, color.g * level, color.b * level, color.a);
        }

        if (this.updateDiffuseLevel)
        {
            this.updateDiffuseLevel = false;
            
            var level = this.diffuseLevel.getValueDirect();
            this.diffuse.setValueDirect(color.r * level, color.g * level, color.b * level, color.a);
        }

        if (this.updateSpecularLevel)
        {
            this.updateSpecularLevel = false;
            
            var level = this.specularLevel.getValueDirect();
            this.specular.setValueDirect(color.r * level, color.g * level, color.b * level, color.a);
        }

        if (this.updateEmissiveLevel)
        {
            this.updateEmissiveLevel = false;
            
            var level = this.emissiveLevel.getValueDirect();
            this.emissive.setValueDirect(color.r * level, color.g * level, color.b * level, color.a);
        }
    }

    var opacity = this.opacity.getValueDirect();

    var forceUpdate = false;

    if (this.updateOpacity)
    {
        this.updateOpacity = false;
        
        this.lastOpacity = opacity;

        // have to re-update all members
        forceUpdate = true;
    }

    if (this.updateAmbient || forceUpdate)
    {
        this.updateAmbient = false;
        
        this.materialDesc.ambient.copy(this.ambient.getValueDirect());
        this.materialDesc.ambient.a *= opacity;
    }

    if (this.updateDiffuse || forceUpdate)
    {
        this.updateDiffuse = false;
        
        this.materialDesc.diffuse.copy(this.diffuse.getValueDirect());
        this.materialDesc.diffuse.a *= opacity;
    }

    if (this.updateSpecular || forceUpdate)
    {
        this.updateSpecular = false;
        
        this.materialDesc.specular.copy(this.specular.getValueDirect());
        this.materialDesc.specular.a *= opacity;
    }

    if (this.updateEmissive || forceUpdate)
    {
        this.updateEmissive = false;
        
        this.materialDesc.emissive.copy(this.emissive.getValueDirect());
        this.materialDesc.emissive.a *= opacity;
    }

    if (this.updateGlossiness || forceUpdate)
    {
        this.updateGlossiness = false;
        
        this.materialDesc.glossiness = this.glossiness.getValueDirect();
    }
    
    // call base-class implementation
    SGNode.prototype.update.call(this, params, visitChildren);
}

Material.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        // call base-class implementation
        SGNode.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    
    switch (directive)
    {
        case "render":
        {
            params.opacity = this.lastOpacity; // set in update()
            
            this.applyMaterialDesc();
            this.graphMgr.setCurrentMaterial(this);
        }
        break;
        
        case "rayPick":
        {
            params.doubleSided = this.lastDoubleSided;
            params.opacity = this.lastOpacity;
        }
        break;
    }
    
    // call base-class implementation
    SGNode.prototype.apply.call(this, directive, params, visitChildren);
}

Material.prototype.applyMaterialDesc = function()
{
    // set material
    this.graphMgr.renderContext.setFrontMaterial(this.materialDesc);
    
    // enable/disable backface culling
    var doubleSided = this.doubleSided.getValueDirect();
    this.lastDoubleSided = doubleSided;
    if (doubleSided)
    {
        this.graphMgr.renderContext.disable(eRenderMode.CullBackFace);
    }
    else // !doubleSided
    {
        this.graphMgr.renderContext.enable(eRenderMode.CullBackFace);
    }
}

function Material_ColorModifiedCB(attribute, container)
{
    container.updateColor = true;
    container.setModified();
}

function Material_AmbientLevelModifiedCB(attribute, container)
{
    container.updateAmbientLevel = true;
    container.setModified();
}

function Material_DiffuseLevelModifiedCB(attribute, container)
{
    container.updateDiffuseLevel = true;
    container.setModified();
}

function Material_SpecularLevelModifiedCB(attribute, container)
{
    container.updateSpecularLevel = true;
    container.setModified();
}

function Material_EmissiveLevelModifiedCB(attribute, container)
{
    container.updateEmissiveLevel = true;
    container.setModified();
}

function Material_AmbientModifiedCB(attribute, container)
{
    container.updateAmbient = true;
    container.setModified();
}
    
function Material_DiffuseModifiedCB(attribute, container)
{
    container.updateDiffuse = true;
    container.setModified();
}
    
function Material_SpecularModifiedCB(attribute, container)
{
    container.updateSpecular = true;
    container.setModified();
}
    
function Material_EmissiveModifiedCB(attribute, container)
{
    container.updateEmissive = true;
    container.setModified();
}
    
function Material_GlossinessModifiedCB(attribute, container)
{
    container.updateGlosiness = true;
    container.setModified();
}
    
function Material_OpacityModifiedCB(attribute, container)
{
    container.updateOpacity = true;
    container.setModified();
}

function Material_DoubleSidedModifiedCB(attribute, container)
{
    container.setModified();
}
Surface.prototype = new Isolator();
Surface.prototype.constructor = Surface;

function Surface()
{
    Isolator.call(this);
    this.className = "Surface";
    this.attrType = eAttrType.Surface;
    
    this.geometries = [];
    
    this.color = new ColorAttr(1, 1, 1, 1);
    this.ambientLevel = new NumberAttr(1);
    this.diffuseLevel = new NumberAttr(1);
    this.specularLevel = new NumberAttr(1);
    this.emissiveLevel = new NumberAttr(0);
    this.ambient = new ColorAttr(0.8, 0.8, 0.8, 1);
    this.diffuse = new ColorAttr(0.2, 0.2, 0.2, 1);
    this.specular = new ColorAttr(0, 0, 0, 1);
    this.emissive = new ColorAttr(0, 0, 0, 1);
    this.glossiness = new NumberAttr(0);
    this.opacity = new NumberAttr(1);
    this.doubleSided = new BooleanAttr(false);
    this.texturesEnabled = new BooleanAttr(true);
    this.colorTexturesPresent = new BooleanAttr(true);
    this.diffuseTexturesPresent = new BooleanAttr(false);
    this.luminosityTexturesPresent = new BooleanAttr(false);
    this.specularityTexturesPresent = new BooleanAttr(false);
    this.transparencyTexturesPresent = new BooleanAttr(false);
    this.numColorTextures = new NumberAttr(0);
    this.numDiffuseTextures = new NumberAttr(0);
    this.numLuminosityTextures = new NumberAttr(0);
    this.numSpecularityTextures = new NumberAttr(0);
    this.numTransparencyTextures = new NumberAttr(0);
    this.vertices = new NumberArrayAttr();
    
    this.colorTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB, this);
    this.diffuseTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB, this);
    this.luminosityTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB, this);
    this.specularityTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB, this);
    this.transparencyTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB, this);

    this.registerAttribute(this.color, "color");
    this.registerAttribute(this.ambientLevel, "ambientLevel");
    this.registerAttribute(this.diffuseLevel, "diffuseLevel");
    this.registerAttribute(this.specularLevel, "specularLevel");
    this.registerAttribute(this.emissiveLevel, "emissiveLevel");
    this.registerAttribute(this.ambient, "ambient");
    this.registerAttribute(this.diffuse, "diffuse");
    this.registerAttribute(this.specular, "specular");
    this.registerAttribute(this.emissive, "emissive");
    this.registerAttribute(this.glossiness, "glossiness");
    this.registerAttribute(this.opacity, "opacity");
    this.registerAttribute(this.doubleSided, "doubleSided");
    this.registerAttribute(this.texturesEnabled, "texturesEnabled");
    this.registerAttribute(this.colorTexturesPresent, "colorTexturesPresent");
    this.registerAttribute(this.diffuseTexturesPresent, "diffuseTexturesPresent");
    this.registerAttribute(this.luminosityTexturesPresent, "luminosityTexturesPresent");
    this.registerAttribute(this.specularityTexturesPresent, "specularityTexturesPresent");
    this.registerAttribute(this.transparencyTexturesPresent, "transparencyTexturesPresent");
    this.registerAttribute(this.numColorTextures, "numColorTextures");
    this.registerAttribute(this.numDiffuseTextures, "numDiffuseTextures");
    this.registerAttribute(this.numLuminosityTextures, "numLuminosityTextures");
    this.registerAttribute(this.numSpecularityTextures, "numSpecularityTextures");
    this.registerAttribute(this.numTransparencyTextures, "numTransparencyTextures");
    this.registerAttribute(this.vertices, "vertices");

    this.isolateTextures.setValueDirect(true);

    this.materialNode = new Material();
    this.materialNode.getAttribute("name").setValueDirect("Material");
    this.materialNode.getAttribute("modified").addTarget(this.modified);
    this.addChild(this.materialNode);

    this.colorTexturesNode = new Group();
    this.colorTexturesNode.getAttribute("name").setValueDirect("Color Textures");
    this.colorTexturesNode.getAttribute("modified").addTarget(this.modified);
    this.addChild(this.colorTexturesNode);

    this.diffuseTexturesNode = new Group();
    this.diffuseTexturesNode.getAttribute("name").setValueDirect("Diffuse Textures");
    this.diffuseTexturesNode.getAttribute("modified").addTarget(this.modified);
    this.addChild(this.diffuseTexturesNode);

    this.luminosityTexturesNode = new Group();
    this.luminosityTexturesNode.getAttribute("name").setValueDirect("Luminosity Textures");
    this.luminosityTexturesNode.getAttribute("modified").addTarget(this.modified);
    this.addChild(this.luminosityTexturesNode);

    this.specularityTexturesNode = new Group();
    this.specularityTexturesNode.getAttribute("name").setValueDirect("Specularity Textures");
    this.specularityTexturesNode.getAttribute("modified").addTarget(this.modified);
    this.addChild(this.specularityTexturesNode);

    this.transparencyTexturesNode = new Group();
    this.transparencyTexturesNode.getAttribute("name").setValueDirect("Transparency Textures");
    this.transparencyTexturesNode.getAttribute("modified").addTarget(this.modified);
    this.addChild(this.transparencyTexturesNode);

    this.connectMaterialAttributes(this.materialNode);
}

Surface.prototype.clone = function()
{
    // call base-class implementation
    var clone = Isolator.prototype.clone.call(this);
    
    // set up texture references
    for (var i = 0; i < this.colorTexturesNode.children.length; i++)
    {
        clone.addTexture(this.colorTexturesNode.children[i]);
    }
    
    return clone;
}

Surface.prototype.setGraphMgr = function(graphMgr)
{
    this.materialNode.setGraphMgr(graphMgr);
    this.colorTexturesNode.setGraphMgr(graphMgr);
    this.diffuseTexturesNode.setGraphMgr(graphMgr);
    this.luminosityTexturesNode.setGraphMgr(graphMgr);
    this.specularityTexturesNode.setGraphMgr(graphMgr);
    this.transparencyTexturesNode.setGraphMgr(graphMgr);
    
    // call base-class implementation
    Isolator.prototype.setGraphMgr.call(this, graphMgr);
}

Surface.prototype.update = function(params, visitChildren)
{
    // call base-class implementation
    Isolator.prototype.update.call(this, params, visitChildren);
}

Surface.prototype.apply = function(directive, params, visitChildren)
{
    // call base-class implementation
    Isolator.prototype.apply.call(this, directive, params, visitChildren);
}

Surface.prototype.connectMaterialAttributes = function(material)
{
    this.connectMaterialAttribute(material, this.color, "color");
    this.connectMaterialAttribute(material, this.ambientLevel, "ambientLevel");
    this.connectMaterialAttribute(material, this.diffuseLevel, "diffuseLevel");
    this.connectMaterialAttribute(material, this.specularLevel, "specularLevel");
    this.connectMaterialAttribute(material, this.emissiveLevel, "emissiveLevel");
    this.connectMaterialAttribute(material, this.ambient, "ambient");
    this.connectMaterialAttribute(material, this.diffuse, "diffuse");
    this.connectMaterialAttribute(material, this.specular, "specular");
    this.connectMaterialAttribute(material, this.emissive, "emissive");
    this.connectMaterialAttribute(material, this.glossiness, "glossiness");
    this.connectMaterialAttribute(material, this.opacity, "opacity");
    this.connectMaterialAttribute(material, this.doubleSided, "doubleSided");
}

Surface.prototype.connectMaterialAttribute = function(material, attribute, name)
{
    var modified = attribute.modificationCount > 0 ? true : false;
    attribute.addTarget(material.getAttribute(name), eAttrSetOp.Replace, null, modified);
}

Surface.prototype.addGeometry = function(geometry)
{
    this.addChild(geometry);
    this.geometries.push(geometry);
}

Surface.prototype.removeGeometry = function(geometry)
{
    this.removeChild(geometry);
    for (var i = 0; i < this.geometries.length; i++)
    {
        if (this.geometries[i] == geometry)
        {
            this.geometries.splice(i, 1);
            break;
        }
    }
}
    
Surface.prototype.addTexture = function(texture)
{
    texture.getAttribute("modified").addTarget(this.modified);
    
    // TODO  
    this.colorTexturesNode.addChild(texture);
}

function Surface_TexturesPresentModifiedCB(attribute, container)
{
}
Model.prototype = new ParentableMotionElement();
Model.prototype.constructor = Model;

function Model()
{
    ParentableMotionElement.call(this);
    this.className = "Model";
    this.attrType = eAttrType.Model;
    
    this.surfaces = [];
    this.geometries = [];
    this.geometryIndices = [];
    this.geometryBBoxesMap = [];
    this.geometryAttrConnections = [];
    this.surfaceAttrConnections = [];
    this.boundingTree = null;
    this.updateBoundingTree = false;
    this.bones = [];
    
    this.url = new StringAttr("");
    this.layer = new NumberAttr(0);//0xffffffff);
    this.selectable = new BooleanAttr(true);
    this.moveable = new BooleanAttr(true);
    this.cullable = new BooleanAttr(true);
    this.show = new BooleanAttr(true);
    this.approximationLevels = new NumberAttr(1);
    this.showApproximationLevel = new NumberAttr(-1);
    this.sortPolygons = new BooleanAttr(false);
    this.flipPolygons = new BooleanAttr(false);
    this.shadowCaster = new BooleanAttr(false);
    this.shadowTarget = new BooleanAttr(true);
    this.indexedGeometry = new BooleanAttr(true);
    this.enableSharing = new BooleanAttr(true);
    this.vertices = new NumberArrayAttr();
    this.dissolve = new NumberAttr(0);
    this.color = new ColorAttr(1, 1, 1, 1);
    this.ambientLevel = new NumberAttr(1);
    this.diffuseLevel = new NumberAttr(1);
    this.specularLevel = new NumberAttr(1);
    this.emissiveLevel = new NumberAttr(0);
    this.ambient = new ColorAttr(0.8, 0.8, 0.8, 1);
    this.diffuse = new ColorAttr(0.2, 0.2, 0.2, 1);
    this.specular = new ColorAttr(0, 0, 0, 1);
    this.emissive = new ColorAttr(0, 0, 0, 1);
    this.glossiness = new NumberAttr(0);
    this.opacity = new NumberAttr(1);
    this.textureOpacity = new NumberAttr(1);
    this.doubleSided = new BooleanAttr(false);
    this.texturesEnabled = new BooleanAttr(true);
    this.pivotAboutGeometricCenter = new BooleanAttr(true);
    this.screenScaleEnabled = new BooleanAttr(false);
    this.screenScalePixels = new Vector3DAttr(0, 0, 0);
    // TODO:
    //this.collider = new BooleanAttr(false);
    //this.collidee = new BooleanAttr(false);
    this.detectCollision = new BooleanAttr(false);
    this.collisionDetected = new BooleanAttr(false);
    this.collisionList = new AttributeVector();
    this.stopOnCollision = new BooleanAttr(false);
    this.detectObstruction = new BooleanAttr(false);
    this.obstructionDetected = new BooleanAttr(false);
    this.obstructionList = new AttributeVector(); // currently will only contain most threatening (closest) obstructor
    this.highlight = new BooleanAttr(false);
    this.highlightColor = new ColorAttr(1, 1, 0, 1);
    this.highlightWidth = new NumberAttr(5);
    this.disableOnDissolve = new BooleanAttr(true);
    this.snapEnabled = new BooleanAttr(true);
    this.genericConnectors = new GenericConnectors();
    this.socketConnectors = new SocketConnectors();
    this.plugConnectors = new PlugConnectors();
    this.physicalProperties = new PhysicalPropertiesAttr();
    this.physicsEnabled = new BooleanAttr(true);
    
    this.show.addTarget(this.enabled);
    
    this.selectable.addModifiedCB(Model_GeometryAttrModifiedCB, this);
    this.cullable.addModifiedCB(Model_GeometryAttrModifiedCB, this);
    this.show.addModifiedCB(Model_GeometryAttrModifiedCB, this);
    this.approximationLevels.addModifiedCB(Model_GeometryAttrModifiedCB, this);
    //this.showApproximationLevel.addModifiedCB(Model_ShowApproximationLevelModifiedCB, this);
    this.sortPolygons.addModifiedCB(Model_GeometryAttrModifiedCB, this);
    this.sortPolygons.addModifiedCB(Model_SortPolygonsModifiedCB, this);
    this.flipPolygons.addModifiedCB(Model_GeometryAttrModifiedCB, this);
    this.shadowCaster.addModifiedCB(Model_GeometryAttrModifiedCB, this);
    this.shadowTarget.addModifiedCB(Model_GeometryAttrModifiedCB, this);
    this.renderSequenceSlot.addModifiedCB(Model_GeometryAttrModifiedCB, this);
    this.renderSequenceSlot.addModifiedCB(Model_RenderSequenceSlotModifiedCB, this);
    this.dissolve.addModifiedCB(Model_DissolveModifiedCB, this);
    this.color.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.ambientLevel.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.diffuseLevel.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.specularLevel.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.emissiveLevel.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.ambient.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.diffuse.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.specular.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.emissive.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.glossiness.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.opacity.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.opacity.addModifiedCB(Model_OpacityModifiedCB, this);
    this.textureOpacity.addModifiedCB(Model_TextureOpacityModifiedCB, this);
    this.doubleSided.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.texturesEnabled.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.detectCollision.addModifiedCB(Model_DetectCollisionModifiedCB, this);
    this.collisionDetected.addModifiedCB(Model_CollisionDetectedModifiedCB, this);
    this.vertices.addModifiedCB(Model_VerticesModifiedCB, this);
    this.physicsEnabled.addModifiedCB(Model_PhysicsEnabledModifiedCB, this);

    this.registerAttribute(this.url, "url");
    this.registerAttribute(this.layer, "layer");
    this.registerAttribute(this.selectable, "selectable");
    this.registerAttribute(this.moveable, "moveable");
    this.registerAttribute(this.cullable, "cullable");
    this.registerAttribute(this.show, "show");
    this.registerAttribute(this.approximationLevels, "approximationLevels");
    this.registerAttribute(this.showApproximationLevel, "showApproximationLevel");
    this.registerAttribute(this.sortPolygons, "sortPolygons");
    this.registerAttribute(this.flipPolygons, "flipPolygons");
    this.registerAttribute(this.shadowCaster, "shadowCaster");
    this.registerAttribute(this.shadowTarget, "shadowTarget");
    this.registerAttribute(this.indexedGeometry, "indexedGeometry");
    this.registerAttribute(this.enableSharing, "enableSharing");
    this.registerAttribute(this.vertices, "vertices");
    this.registerAttribute(this.dissolve, "dissolve");
    this.registerAttribute(this.color, "color");
    this.registerAttribute(this.ambientLevel, "ambientLevel");
    this.registerAttribute(this.diffuseLevel, "diffuseLevel");
    this.registerAttribute(this.specularLevel, "specularLevel");
    this.registerAttribute(this.emissiveLevel, "emissiveLevel");
    this.registerAttribute(this.ambient, "ambient");
    this.registerAttribute(this.diffuse, "diffuse");
    this.registerAttribute(this.specular, "specular");
    this.registerAttribute(this.emissive, "emissive");
    this.registerAttribute(this.glossiness, "glossiness");
    this.registerAttribute(this.opacity, "opacity");
    this.registerAttribute(this.textureOpacity, "textureOpacity");
    this.registerAttribute(this.doubleSided, "doubleSided");
    this.registerAttribute(this.texturesEnabled, "texturesEnabled");
    this.registerAttribute(this.pivotAboutGeometricCenter, "pivotAboutGeometricCenter");
    this.registerAttribute(this.screenScaleEnabled, "screenScaleEnabled");
    this.registerAttribute(this.screenScalePixels, "screenScalePixels");
    this.registerAttribute(this.detectCollision, "detectCollision");
    this.registerAttribute(this.collisionDetected, "collisionDetected");
    this.registerAttribute(this.collisionList, "collisionList");
    this.registerAttribute(this.stopOnCollision, "stopOnCollision");
    this.registerAttribute(this.detectObstruction, "detectObstruction");
    this.registerAttribute(this.obstructionDetected, "obstructionDetected");
    this.registerAttribute(this.obstructionList, "obstructionList");
    this.registerAttribute(this.highlight, "highlight");
    this.registerAttribute(this.highlightColor, "highlightColor");
    this.registerAttribute(this.highlightWidth, "highlightWidth");
    this.registerAttribute(this.disableOnDissolve, "disableOnDissolve");
    this.registerAttribute(this.snapEnabled, "snapEnabled");
    this.registerAttribute(this.genericConnectors, "genericConnectors");
    this.registerAttribute(this.socketConnectors, "socketConnectors");
    this.registerAttribute(this.plugConnectors, "plugConnectors");
    this.registerAttribute(this.physicalProperties, "physicalProperties");
    this.registerAttribute(this.physicsEnabled, "physicsEnabled");
        
    this.isolatorNode = new Isolator();
    this.isolatorNode.getAttribute("name").setValueDirect("Isolator");
    this.isolatorNode.getAttribute("isolateDissolves").setValueDirect(true);
    //this.isolatorNode.setCreatedByParent(true);
    this.addChild(this.isolatorNode);

    this.dissolveNode = new Dissolve();
    this.dissolveNode.getAttribute("name").setValueDirect("Dissolve");
    this.addChild(this.dissolveNode);
    this.dissolve.addTarget(this.dissolveNode.getAttribute("dissolve"));
    //this.dissolve.setCreatedByParent(true);

    this.surfacesNode = new Group();
    this.surfacesNode.getAttribute("name").setValueDirect("Surfaces");
    this.addChild(this.surfacesNode);
    //this.surfacesNode.setCreatedByParent(true);
}

Model.prototype.synchronize = function(src, syncValues)
{
    // call base-class implementation
    ParentableMotionElement.prototype.synchronize.call(this, src, syncValues);
    
    // sectorPosition is overwriting position
    this.position.copyValue(src.getAttribute("position"));
}

Model.prototype.copyModel = function(clone,cloneChildren,pathSrc,pathClone)
{
    var clonedByThis = false;
    if(!clone)
    {
        if (!(clone = new Model()))
        {
            return -1;
        }

        clonedByThis = true;
    }

    // call base-class implementation
    if (this.copyNode(clone, cloneChildren, pathSrc, pathClone))
    {
        return -1;
    }
}

Model.prototype.initializeSurfaceAttrConnectionsMap = function()
{
    this.surfaceAttrConnections.push(new Pair(this.color, false));
    this.surfaceAttrConnections.push(new Pair(this.ambientLevel, false));
    this.surfaceAttrConnections.push(new Pair(this.diffuseLevel, false));
    this.surfaceAttrConnections.push(new Pair(this.specularLevel, false));
    this.surfaceAttrConnections.push(new Pair(this.emissiveLevel, false));
    this.surfaceAttrConnections.push(new Pair(this.ambient, false));
    this.surfaceAttrConnections.push(new Pair(this.diffuse, false));
    this.surfaceAttrConnections.push(new Pair(this.specular, false));
    this.surfaceAttrConnections.push(new Pair(this.emissive, false));
    this.surfaceAttrConnections.push(new Pair(this.glossiness, false));
    this.surfaceAttrConnections.push(new Pair(this.opacity, false));
    this.surfaceAttrConnections.push(new Pair(this.doubleSided, false));
    this.surfaceAttrConnections.push(new Pair(this.texturesEnabled, false));
    this.surfaceAttrConnections.push(new Pair(this.renderSequenceSlot, false));
}

Model.prototype.initializeGeometryAttrConnectionsMap = function()
{
    this.geometryAttrConnections.push(new Pair(this.selectable, false));
    this.geometryAttrConnections.push(new Pair(this.cullable, false));
    this.geometryAttrConnections.push(new Pair(this.show, false));
    this.geometryAttrConnections.push(new Pair(this.approximationLevels, false));
    this.geometryAttrConnections.push(new Pair(this.showApproximationLevel, false));
    this.geometryAttrConnections.push(new Pair(this.sortPolygons, false));
    this.geometryAttrConnections.push(new Pair(this.flipPolygons, false));
    this.geometryAttrConnections.push(new Pair(this.intersector, false));
    this.geometryAttrConnections.push(new Pair(this.intersectee, false));
    this.geometryAttrConnections.push(new Pair(this.stationary, false));
    this.geometryAttrConnections.push(new Pair(this.shadowCaster, false));
    this.geometryAttrConnections.push(new Pair(this.shadowTarget, false));
}

Model.prototype.clearSurfaceAttrConnectionMap = function()
{
    this.surfaceAttrConnections = [];

    this.initializeSurfaceAttrConnectionsMap();
}

Model.prototype.clearGeometryAttrConnectionsMap = function()
{
    this.geometryAttrConnections = [];

    this.initializeGeometryAttrConnectionsMap();
}

Model.prototype.setGraphMgr = function(graphMgr)
{
    this.isolatorNode.setGraphMgr(graphMgr);
    this.dissolveNode.setGraphMgr(graphMgr);
    this.surfacesNode.setGraphMgr(graphMgr);
    
    // call base-class implementation
    ParentableMotionElement.prototype.setGraphMgr.call(this, graphMgr);
}

Model.prototype.update = function(params, visitChildren)
{
    if (this.updateBoundingTree)
    {
        this.updateBoundingTree = false;

        this.buildBoundingTree();
    }
    
    // call base-class implementation
    ParentableMotionElement.prototype.update.call(this, params, visitChildren);
}

Model.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        // call base-class implementation
        ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    switch (directive)
    {
        case "render":
        case "shadow":
            {
                var show = this.show.getValueDirect();
                if (!show)
                {
                    // call base-class implementation
                    ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
                    return;
                }

                var lastWorldMatrix = new Matrix4x4();
                lastWorldMatrix.loadMatrix(params.worldMatrix);              

                params.worldMatrix = params.worldMatrix.multiply(this.sectorTransformCompound);
                
                this.pushMatrix();

                this.applyTransform();

                this.graphMgr.renderContext.setModelID(params.modelID++);
                
                // call base-class implementation
                ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
                
                this.popMatrix();
                
                params.worldMatrix.loadMatrix(lastWorldMatrix);
            }
            break;

        case "rayPick":
            {
                var lastWorldMatrix = new Matrix4x4();
                lastWorldMatrix.loadMatrix(params.worldMatrix);
                params.worldMatrix = params.worldMatrix.multiply(this.sectorTransformCompound);

                // call base-class implementation
                ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);

                params.worldMatrix.loadMatrix(lastWorldMatrix);
            }
            break;

        case "bbox":
            {
                var lastWorldMatrix = new Matrix4x4();
                lastWorldMatrix.loadMatrix(params.worldMatrix);
                params.worldMatrix.loadMatrix(this.sectorTransformCompound.multiply(params.worldMatrix));

                // call base-class implementation
                ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);

                params.worldMatrix.loadMatrix(lastWorldMatrix);
            }
            break;

        case "collide":
            {
                var lastWorldMatrix = new Matrix4x4();
                lastWorldMatrix.loadMatrix(params.worldMatrix);              

                params.worldMatrix = params.worldMatrix.multiply(this.sectorTransformCompound);
  
                // call base-class implementation
                ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
                
                if (this.detectCollision.getValueDirect()) 
                {
                    this.boundingTree.setTransform(params.worldMatrix);
                    params.detectCollisions[this.name.getValueDirect().join("")] = new CollideRec(this, this.boundingTree, params.worldMatrix);
                }

                params.worldMatrix.loadMatrix(lastWorldMatrix);
            }
            break;
           
        case "highlight":
            {
                if (this.highlight.getValueDirect())
                {
                    var target = new HighlightTarget();
                    target.projMatrix = params.projMatrix;
                    target.viewMatrix = params.viewMatrix;
                    target.worldMatrix = this.sectorTransformCompound.multiply(params.worldMatrix);
                    target.camera = params.camera;
                    target.viewport = params.viewport;
                    target.center = this.center.getValueDirect();
                    var highlightColor = this.highlightColor.getValueDirect();
                    target.highlightColor_r = highlightColor.r;
                    target.highlightColor_g = highlightColor.g;
                    target.highlightColor_b = highlightColor.b;
                    target.highlightColor_a = highlightColor.a;
                    target.highlightWidth = this.highlightWidth.getValueDirect();
                    params.targets.push(target);

                    // call base-class implementation
                    ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
                }
            }
            break;  
         
        default:
            {
                // call base-class implementation
                ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
            }
            break;
    }
}

Model.prototype.onUnregister = function()
{
    var name = this.name.getValueDirect().join("");
    
    // remove from any physics simulators
    var physicsSimulators = this.registry.getByType(eAttrType.PhysicsSimulator);
    if (physicsSimulators)
    {
        for (var i = 0; i < physicsSimulators.length; i++)
        {
            physicsSimulators[i].bodies.erase(this.name);
        }
    }
}

Model.prototype.pushMatrix = function()
{
    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
    this.graphMgr.renderContext.pushMatrix();
}

Model.prototype.popMatrix = function()
{
    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
    this.graphMgr.renderContext.popMatrix();
    this.graphMgr.renderContext.applyWorldTransform();    
}

Model.prototype.addSurface = function(surface)
{
    this.surfacesNode.addChild(surface);
    
    this.surfaces.push(surface);
    
    // register surface to this for accessiblity with Set
    this.registerAttribute(surface, surface.getAttribute("name").getValueDirect().join(""));
	
    this.connectSurfaceAttributes(surface);
}

Model.prototype.removeSurface = function(surface)
{
    this.surfacesNode.removeChild(surface);
    
    for (var i = 0; i < this.surfaces.length; i++)
    {
        if (this.surfaces[i] == surface)
        {
            this.surfaces.splice(i, 1);
            break;
        }
    }
    
    // unregister surface from this
    this.unregisterAttribute(surface);
	
    this.disconnectSurfaceAttributes(surface);
}
    
Model.prototype.addGeometry = function(geometry, indices, surface)
{
    if (surface) surface.addGeometry(geometry);
    
    this.connectGeometryAttributes(geometry);
    this.geometries.push(geometry);
    if (indices) this.geometryIndices.push(indices);
    geometry.bbox.addModifiedCB(Model_GeometryBBoxModifiedCB, this);
        
    this.updateBBox();
}

Model.prototype.removeGeometry = function(geometry, indices, surface)
{
    if (surface) surface.removeGeometry(geometry);
    
    this.disconnectGeometryAttributes(geometry);
    for (var i = 0; i < this.geometries.length; i++)
    {
        if (this.geometries[i] == geometry)
        {
            this.geometries.splice(i, 1);
            break;
        }
    }  
    if (indices) 
    {
        for (var i = 0; i < this.geometryIndices.length; i++)
        {
            if (this.geometryIndices[i] == indices)
            {
                this.geometryIndices.splice(i, 1);
                break;
            }
        }
    }
    geometry.bbox.removeModifiedCB(Model_GeometryBBoxModifiedCB, this);
        
    this.updateBBox();
}

Model.prototype.connectSurfaceAttributes = function(surface)
{
    this.connectSurfaceAttribute(surface, this.color, "color");
    this.connectSurfaceAttribute(surface, this.ambientLevel, "ambientLevel");
    this.connectSurfaceAttribute(surface, this.diffuseLevel, "diffuseLevel");
    this.connectSurfaceAttribute(surface, this.specularLevel, "specularLevel");
    this.connectSurfaceAttribute(surface, this.emissiveLevel, "emissiveLevel");
    this.connectSurfaceAttribute(surface, this.ambient, "ambient");
    this.connectSurfaceAttribute(surface, this.diffuse, "diffuse");
    this.connectSurfaceAttribute(surface, this.specular, "specular");
    this.connectSurfaceAttribute(surface, this.emissive, "emissive");
    this.connectSurfaceAttribute(surface, this.glossiness, "glossiness");
    this.connectSurfaceAttribute(surface, this.opacity, "opacity");
    this.connectSurfaceAttribute(surface, this.doubleSided, "doubleSided");
    this.connectSurfaceAttribute(surface, this.texturesEnabled, "texturesEnabled");
    this.connectSurfaceAttribute(surface, this.enabled, "enabled");
}

Model.prototype.connectSurfaceAttribute = function(surface, attribute, name)
{
    var modified = attribute.modificationCount > 0 ? true : false;
    attribute.addTarget(surface.getAttribute(name), eAttrSetOp.Replace, null, modified);
}

Model.prototype.disconnectSurfaceAttributes = function(surface)
{
    this.disconnectSurfaceAttribute(surface, this.color, "color");
    this.disconnectSurfaceAttribute(surface, this.ambientLevel, "ambientLevel");
    this.disconnectSurfaceAttribute(surface, this.diffuseLevel, "diffuseLevel");
    this.disconnectSurfaceAttribute(surface, this.specularLevel, "specularLevel");
    this.disconnectSurfaceAttribute(surface, this.emissiveLevel, "emissiveLevel");
    this.disconnectSurfaceAttribute(surface, this.ambient, "ambient");
    this.disconnectSurfaceAttribute(surface, this.diffuse, "diffuse");
    this.disconnectSurfaceAttribute(surface, this.specular, "specular");
    this.disconnectSurfaceAttribute(surface, this.emissive, "emissive");
    this.disconnectSurfaceAttribute(surface, this.glossiness, "glossiness");
    this.disconnectSurfaceAttribute(surface, this.opacity, "opacity");
    this.disconnectSurfaceAttribute(surface, this.doubleSided, "doubleSided");
    this.disconnectSurfaceAttribute(surface, this.texturesEnabled, "texturesEnabled");
    this.disconnectSurfaceAttribute(surface, this.enabled, "enabled");
}

Model.prototype.disconnectSurfaceAttribute = function(surface, attribute, name)
{
    attribute.removeTarget(surface.getAttribute(name));
}

Model.prototype.connectGeometryAttributes = function(geometry)
{
    this.connectGeometryAttribute(geometry, this.name, "name");
    this.connectGeometryAttribute(geometry, this.selectable, "selectable");
    this.connectGeometryAttribute(geometry, this.cullable, "cullable");
    this.connectGeometryAttribute(geometry, this.show, "show");
    this.connectGeometryAttribute(geometry, this.approximationLevels, "approximationLevels");
    this.connectGeometryAttribute(geometry, this.sortPolygons, "sortPolygons");
    this.connectGeometryAttribute(geometry, this.flipPolygons, "flipPolygons");
    this.connectGeometryAttribute(geometry, this.shadowCaster, "shadowCaster");
    this.connectGeometryAttribute(geometry, this.shadowTarget, "shadowTarget");
    this.connectGeometryAttribute(geometry, this.renderSequenceSlot, "renderSequenceSlot");
    this.connectGeometryAttribute(geometry, this.highlight, "highlight");
}

Model.prototype.connectGeometryAttribute = function(geometry, attribute, name)
{
    var modified = attribute.modificationCount > 0 ? true : false;
    attribute.addTarget(geometry.getAttribute(name), eAttrSetOp.Replace, null, modified);
}

Model.prototype.disconnectGeometryAttributes = function(geometry)
{
    this.disconnectGeometryAttribute(geometry, this.name, "name");
    this.disconnectGeometryAttribute(geometry, this.selectable, "selectable");
    this.disconnectGeometryAttribute(geometry, this.cullable, "cullable");
    this.disconnectGeometryAttribute(geometry, this.show, "show");
    this.disconnectGeometryAttribute(geometry, this.approximationLevels, "approximationLevels");
    this.disconnectGeometryAttribute(geometry, this.sortPolygons, "sortPolygons");
    this.disconnectGeometryAttribute(geometry, this.flipPolygons, "flipPolygons");
    this.disconnectGeometryAttribute(geometry, this.shadowCaster, "shadowCaster");
    this.disconnectGeometryAttribute(geometry, this.shadowTarget, "shadowTarget");
    this.disconnectGeometryAttribute(geometry, this.renderSequenceSlot, "renderSequenceSlot");
    this.disconnectGeometryAttribute(geometry, this.highlight, "highlight");
}

Model.prototype.disconnectGeometryAttribute = function(geometry, attribute, name)
{
    attribute.removeTarget(geometry.getAttribute(name));
}

Model.prototype.updateBBox = function()
{
    var min = new Vector3D(FLT_MAX, FLT_MAX, FLT_MAX);
    var max = new Vector3D(-FLT_MAX, -FLT_MAX, -FLT_MAX);
    
    for (var i = 0; i < this.geometries.length; i++)
    {
        var geometryMin = this.geometries[i].bbox.min.getValueDirect();
        var geometryMax = this.geometries[i].bbox.max.getValueDirect();
        
        min.x = Math.min(min.x, geometryMin.x);
        min.y = Math.min(min.y, geometryMin.y);
        min.z = Math.min(min.z, geometryMin.z);
        
        max.x = Math.max(max.x, geometryMax.x);
        max.y = Math.max(max.y, geometryMax.y);
        max.z = Math.max(max.z, geometryMax.z);
    }
    
    this.bbox.min.setValueDirect(min.x, min.y, min.z);
    this.bbox.max.setValueDirect(max.x, max.y, max.z);
    
    var center = new Vector3D((min.x + max.x) / 2.0,
                              (min.y + max.y) / 2.0,
                              (min.z + max.z) / 2.0);
                              
    this.center.setValueDirect(center.x, center.y, center.z);
    
    this.updateBoundingTree = true;
}

Model.prototype.buildBoundingTree = function()
{
    var tris = [];
    for (var i = 0; i < this.geometries.length; i++)
    {
        tris = tris.concat(this.geometries[i].getTriangles());
    }
    
    this.boundingTree = new Octree();
    this.boundingTree.setTriangles(tris, this.bbox.min.getValueDirect(), this.bbox.max.getValueDirect());
    this.boundingTree.buildTree(this.approximationLevels.getValueDirect());
}

Model.prototype.collisionDetectedModified = function()
{
}

Model.prototype.physicsEnabledModified = function(enabled)
{
    if (enabled)
    {
        var bworks = this.registry.find("Bridgeworks");
        bworks.physicsSimulator.updatePhysicsBody(bworks.physicsSimulator.getPhysicsBodyIndex(this));
    }
}

function Model_SortPolygonsModifiedCB(attribute, container)
{
    // TODO
    //container.sortPolygonsModified();
}
    
function Model_RenderSequenceSlotModifiedCB(attribute, container)
{
    var slot = attribute.getValueDirect();
}

function Model_DissolveModifiedCB(attribute, container)
{
    var dissolve = attribute.getValueDirect();
}

function Model_OpacityModifiedCB(attribute, container)
{
    var opacity = attribute.getValueDirect();
}

function Model_TextureOpacityModifiedCB(attribute, container)
{
    //container.textureOpacityModified();
}

function Model_Surface_NumTransparencyTexturesModifiedCB(attribute, container)
{
    var numTransparencyTextures = attribute.getValueDirect();
}

function Model_GeometryBBoxModifiedCB(attribute, container)
{
    container.updateBBox();
}

function Model_SurfaceAttrModifiedCB(attribute, container)
{
    //container.setModified();
}

function Model_GeometryAttrModifiedCB(attribute, container)
{
    //container.incremementModificationCount();
}

function Model_DetectCollisionModifiedCB(attribute, container)
{
    var detectCollision = attribute.getValueDirect();
}

function Model_CollisionDetectedModifiedCB(attribute, container)
{
    container.collisionDetectedModified();
}

function Model_VerticesModifiedCB(attribute, container)
{
}

function Model_PhysicsEnabledModifiedCB(attribute, container)
{
    container.physicsEnabledModified(attribute.getValueDirect());
}
Texture.prototype = new ParentableMotionElement();
Texture.prototype.constructor = Texture;

function Texture()
{
    ParentableMotionElement.call(this);
    this.className = "Texture";
    this.attrType = eAttrType.Texture;
   
    this.updateImage = false;
    this.updateMipmappingEnabled = false;
    this.setImage = false;
    this.imageSet = false;
    this.textureObj = null;
    this.pitch = 0;
    
    this.image = new ImageAttr(); 
    this.opacity = new NumberAttr(1);
    this.textureType = new NumberAttr(eTextureType.Color);
    this.widthWrap = new NumberAttr(eTextureWrap.None);
    this.heightWrap = new NumberAttr(eTextureWrap.None);
    this.mipmappingEnabled = new BooleanAttr(false);
    this.blendOp = new NumberAttr(RC_MODULATE);
    
    this.image.setTransient(true); // don't serialize image data
    
    this.image.getAttribute("width").addModifiedCB(Texture_ImageModifiedCB, this);
    this.image.getAttribute("height").addModifiedCB(Texture_ImageModifiedCB, this);
    this.image.getAttribute("byteAlignment").addModifiedCB(Texture_ImageModifiedCB, this);
    this.image.getAttribute("pixelFormat").addModifiedCB(Texture_ImageModifiedCB, this);
    this.image.getAttribute("pixels").addModifiedCB(Texture_ImagePixelsModifiedCB, this);
    this.textureType.addModifiedCB(Texture_TextureTypeModifiedCB, this);
    this.opacity.addModifiedCB(Texture_OpacityModifiedCB, this);
    this.widthWrap.addModifiedCB(Texture_WrapModifiedCB, this);
    this.heightWrap.addModifiedCB(Texture_WrapModifiedCB, this);
    this.mipmappingEnabled.addModifiedCB(Texture_MipmappingEnabledModifiedCB, this);

    this.registerAttribute(this.image, "image");
    this.registerAttribute(this.opacity, "opacity");
    this.registerAttribute(this.textureType, "textureType");
    this.registerAttribute(this.widthWrap, "widthWrap");
    this.registerAttribute(this.heightWrap, "heightWrap");
    this.registerAttribute(this.mipmappingEnabled, "mipmappingEnabled");
    this.registerAttribute(this.blendOp, "blendOp");
}

Texture.prototype.setGraphMgr = function(graphMgr)
{
    // create texture object
    this.textureObj = graphMgr.renderContext.createTextureObject();
    
    // call base-class implementation
    ParentableMotionElement.prototype.setGraphMgr.call(this, graphMgr);
}

Texture.prototype.update = function(params, visitChildren)
{
    if (this.updateImage)
    {
        this.updateImage = false;

        this.setImage = true;
    }

    if (this.updateMipmappingEnabled)
    {
        // only reset image to use/not use mipmaps if image has been specified
        if (this.imageSet)
        {
            this.setImage = true;
            this.updateMipmappingEnabled = false;
        }
    }

    if (this.setImage)
    {
        this.setImage = !(this.SetImage());
    }

    // only call direct-base class implementation if position, rotation, or scale has been modified
    // (avoids unnecessary calculations for textures)
    if (this.updatePosition || this.updateRotation || this.updateScale)
    {
        ParentableMotionElement.prototype.update.call(this, params, visitChildren);
    }
    else
    {
        SGNode.prototype.update.call(this, params, visitChildren);
    }
}

Texture.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        // call base-class implementation
        ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    switch (directive)
    {
        case "render":
            {
                // if texture is ready, add to texture array
                if (this.imageSet)
                {
                    var drawTextures = params.drawTextures && this.graphMgr.getDrawTextures();
                    if (drawTextures)
                    {
                        // TODO: if current projector object, add texture to projection texture array
                        var textures = this.graphMgr.textureArrayStack.top().textures;
                        var i = this.textureType.getValueDirect();
                        // Added this error handling when several scenes
                        // where textures[i] is undefined but have no
                        // idea why textures[i] is undefined - KMC
                        if (textures[i])
                        {
                            textures[i].push(this);
                        }
                    }
                }
                
            }
            break;
    }

    // call base-class implementation
    ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
}

Texture.prototype.SetImage = function()
{
    var width = this.image.width.getValueDirect();
    var height = this.image.height.getValueDirect();
    var pixelFormat = this.image.pixelFormat.getValueDirect();
    var pixels = this.image.pixels.getValueDirect();

    if (width == 0 ||
        height == 0 ||
        pixelFormat == ePixelFormat.Unknown ||
        pixels == null)
    {
        return false;
    }
    
    var imageFormat;
    switch (this.textureType.getValueDirect())
    {
        case eTextureType.Diffuse:
        case eTextureType.Luminosity:
        case eTextureType.Specularity:
        case eTextureType.Transparency:
            imageFormat = eImageFormat.Alpha;
            break;

        case eTextureType.Color:
        default:
            imageFormat = eImageFormat.RGBA;
            break;
    }

    this.textureObj.setImageData(width, height, pixelFormat, imageFormat, pixels);

    this.imageSet = true;
    
    return true;
}

function Texture_ImageModifiedCB(attribute, container)
{
    container.updateImage = true;
    container.setModified();
}

function Texture_ImagePixelsModifiedCB(attribute, container)
{
    container.updateImage = true;
    container.setModified();
}

function Texture_OpacityModifiedCB(attribute, container)
{
    container.setModified();
}

function Texture_TextureTypeModifiedCB(attribute, container)
{
    // update blendOp based upon type
    switch (attribute.getValueDirect())
    {
        case eTextureType.Color:
            op = RC_MODULATE;
            break;

        case eTextureType.Diffuse:
        case eTextureType.Luminosity:
        case eTextureType.Specularity:
            op = RC_REPLACE;
            break;

        case eTextureType.Transparency:
            op = RC_MODULATE;//BLEND;
            break;

        default:
            return;
    }
    
    container.blendOp.setValueDirect(op);
    container.setModified();
}

function Texture_WrapModifiedCB(attribute, container)
{
    container.setModified();
}

function Texture_MipmappingEnabledModifiedCB(attribute, container)
{
    container.updateMipmappingEnabled = true;
    container.setModified();
}
MediaTexture.prototype = new Texture();
MediaTexture.prototype.constructor = MediaTexture;

function MediaTexture()
{
    Texture.call(this);
    this.className = "MediaTexture";
    this.attrType = eAttrType.MediaTexture;
    
    this.updateImageFilename = false;
    this.updateAlphaFilename = false;
    this.updateNegateImage = false;
    this.updateNegateAlpha = false;
    this.imagePlayback = null;
    this.alphaPlayback = null;
    this.pixelMap = ePixelMap.Default;
    this.forceImageUpdate = false;
    
    this.imageFilename = new StringAttr("");
    this.alphaFilename = new StringAttr("");
    this.negateImage = new BooleanAttr(false);
    this.negateAlpha = new BooleanAttr(false);
    this.frame = new NumberAttr(-1);
    this.frameRetrieved = new NumberAttr(-1);
    
    this.imageFilename.addModifiedCB(MediaTexture_ImageFilenameModifiedCB, this);
    this.alphaFilename.addModifiedCB(MediaTexture_AlphaFilenameModifiedCB, this);
    this.negateImage.addModifiedCB(MediaTexture_NegateImageModifiedCB, this);
    this.negateAlpha.addModifiedCB(MediaTexture_NegateAlphaModifiedCB, this);
   
    this.registerAttribute(this.imageFilename, "imageFilename");
    this.registerAttribute(this.alphaFilename, "alphaFilename");
    this.registerAttribute(this.negateImage, "negateImage");
    this.registerAttribute(this.negateAlpha, "negateAlpha");
    this.registerAttribute(this.frame, "frame");
    this.registerAttribute(this.frameRetrieved, "frameRetrieved");
}

MediaTexture.prototype.setGraphMgr = function(graphMgr)
{
    // call base-class implementation
    Texture.prototype.setGraphMgr.call(this, graphMgr);
}

MediaTexture.prototype.update = function(params, visitChildren)
{
    if (this.updateImageFilename ||
        this.updateAlphaFilename)
    {
        this.updateImageFilename = false;
        this.updateAlphaFilename = false;

        this.frame.setValueDirect(-1);

        this.loadMedia();
    }

    if (this.updateTextureType)
    {
        this.updateTextureType = false;

        this.setImageSize();

        this.forceImageUpdate = true;
    }

    if (this.updateNegateImage)
    {
        this.updateNegateImage = false;

        this.forceImageUpdate = true;
    }

    if (this.updateNegateAlpha)
    {
        this.updateNegateAlpha = false;

        this.forceImageUpdate = true;
    }

    // update texture image if enabled
    if (this.enabled.getValueDirect())
    {
        this.updateMediaTextureImage();
    }

    // call base-class implementation
    Texture.prototype.update.call(this, params, visitChildren);
}

MediaTexture.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        // call base-class implementation
        Texture.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    // call base-class implementation
    Texture.prototype.apply.call(this, directive, params, visitChildren);
}

MediaTexture.prototype.loadMedia = function()
{
    var imageFilename = this.imageFilename.getValueDirect().join("");
    if (imageFilename &&
        imageFilename != "" &&
       !this.imagePlayback || (this.imagePlayback && this.imagePlayback.url != imageFilename))
    {
        this.imagePlayback = new MediaPlayback(this, MediaTexture_OnImageLoad);
        this.imagePlayback.container = this;
        this.imagePlayback.loadImage(imageFilename);
    }
    else if (imageFilename == "")
    {
        // TODO: remove texture
    }

    var alphaFilename = this.alphaFilename.getValueDirect().join("");
    if (alphaFilename &&
        alphaFilename != "" &&
       !this.alphaPlayback || (this.alphaPlayback && this.alphaPlayback.url != alphaFilename))
    {
        this.alphaPlayback = new MediaPlayback(this, MediaTexture_OnAlphaLoad);
        this.alphaPlayback.container = this;
        this.alphaPlayback.loadImage(alphaFilename);

        if (this.imagePlayback)
        {
            this.imagePlayback.setAlphaChannel(this.alphaPlayback);
        }
    }
    else if (alphaFilename == "")
    {
        // TODO: remove texture
    }
    
    // increment modification count
    this.setModified();
}

MediaTexture.prototype.setImageSize = function()
{
    // only perform this action if texture type is not color and/or an alpha channel is present
    if (this.textureType.getValueDirect() == eTextureType.Color &&
       !this.alphaPlayback)
    {
        return;
    }

    if (!this.imagePlayback)
    {
        return;
    }

    // get image playback dimensions
    var dims = this.imagePlayback.getFrameDimensions();
    var width = nextHighestPowerOfTwo(dims.width);
    var height = nextHighestPowerOfTwo(dims.height);

    // based on texture type, determine pixel format
    var pixelFormat;
    switch (this.textureType.getValueDirect())
    {
        case eTextureType.Diffuse:
        case eTextureType.Luminosity:
        case eTextureType.Specularity:
        case eTextureType.Transparency:
        case eTextureType.Clip:
            pixelFormat = ePixelFormat.A8;
            this.pixelMap = ePixelMap.RGBToAlpha;
            break;

        case eTextureType.Color:
        default:
            pixelFormat = this.imagePlayback.getPixelFormat();
            this.pixelMap = ePixelMap.Default;
            break;
    }

    // if alpha playback, ensure pixel format has an alpha channel
    if (this.alphaPlayback)
    {
        switch (pixelFormat)
        {
            case ePixelFormat.R8G8B8:
                pixelFormat = ePixelFormat.R8G8B8A8;
                break;

            case ePixelFormat.B8G8R8:
                pixelFormat = ePixelFormat.B8G8R8A8;
                break;
        }
    }

    // get image playback byte alignment
    var byteAlignment = this.imagePlayback.getPixelByteAlignment();

    // calculate pitch
    this.pitch = width * BytesPerPixel(pixelFormat);
    this.pitch += (byteAlignment - this.pitch % byteAlignment) % byteAlignment;

    // set image attributes
    this.image.width.setValueDirect(width);
    this.image.height.setValueDirect(height);
    this.image.pixelFormat.setValueDirect(pixelFormat);
    this.image.byteAlignment.setValueDirect(byteAlignment);

    // allocate pixel buffer
    this.image.pixels.setLength(height * this.pitch);
}

MediaTexture.prototype.updateMediaTextureImage = function()
{
    // only perform this action if texture type is not color and an alpha channel is present
    if (this.textureType.getValueDirect() == eTextureType.Color &&
       !this.alphaPlayback)
    {
        return;
    }
    
    if (this.imagePlayback &&
        this.imagePlayback.ready &&
       (this.imagePlayback.newFrameDataAvailable() ||
       (this.alphaPlayback && this.alphaPlayback.newFrameDataAvailable()) ||
        this.forceImageUpdate))
    {
        var width = this.image.width.getValueDirect();
        var height = this.image.height.getValueDirect();
        var pixelFormat = this.image.pixelFormat.getValueDirect();

        // set filter mask
        var filterMask = FRAME_FILTER_SCALE_FRAME_BIT;
        if (this.negateImage.getValueDirect())
        {
            filterMask |= FRAME_FILTER_NEGATE_COLOR_BIT;
        }
        if (this.negateAlpha.getValueDirect())
        {
            filterMask |= FRAME_FILTER_NEGATE_ALPHA_BIT;
        }

        // get image data
        var frameRetrieved = this.imagePlayback.getFrameData(width, height, this.pitch, pixelFormat, this.image.pixels.values, filterMask, this.pixelMap, this.frame.getValueDirect());
        this.frameRetrieved.setValueDirect(frameRetrieved);

        this.forceImageUpdate = false;
    }
    
    // increment modification count
    this.setModified();
}

MediaTexture.prototype.onImageLoad = function()
{
    // only perform this action if texture type is not color and/or an alpha channel is present
    if (this.textureType.getValueDirect() == eTextureType.Color &&
       !this.alphaPlayback)
    {
        this.textureObj.setImage(this.imagePlayback.htmlImageElement, ePixelFormat.R8G8B8A8, eImageFormat.RGBA);
        this.imageSet = true;
        this.setModified();
        return;
    }
    
    this.setImageSize();
}

MediaTexture.prototype.onAlphaLoad = function()
{
}

MediaTexture.prototype.onVideoLoad = function()
{   /*
    var image = this.htmlImageElement;
    var canvas = document.createElement("canvas");
    var canvasContext = canvas.getContext("2d");
    canvas.width = 200; //image.width;
    canvas.height = 200; //image.height;
    canvasContext.drawImage(image, 0, 0);
    var imageData = canvasContext.getImageData(0, 0, canvas.width, canvas.height);
    this.textureObj.setImageData(imageData);
    this.imageSet = true;
    this.video = true;
    //alert(imageData.data[0]);
    //alert(imageData.data[1]);
    //alert(imageData.data[2]);
    //alert(imageData.data[3]);
    */
    this.textureObj.setVideo(this.htmlImageElement);
    this.textureObj.negate = this.negateImage.getValueDirect();
    this.imageSet = true;
}

function MediaTexture_OnImageLoad()
{
    this.container.onImageLoad();
}

function MediaTexture_OnAlphaLoad()
{
    this.container.onAlphaLoad();
}

function MediaTexture_OnVideoLoad()
{
    alert("MediaTexture_OnVideoLoad");
    this.container.onVideoLoad();
}

function MediaTexture_ImageFilenameModifiedCB(attribute, container)
{
    container.updateImageFilename = true;
    container.setModified();
}

function MediaTexture_AlphaFilenameModifiedCB(attribute, container)
{
    container.updateAlphaFilename = true;
    container.setModified();
}

function MediaTexture_NegateImageModifiedCB(attribute, container)
{
    container.updateNegateImage = true;
    container.setModified();
}

function MediaTexture_NegateAlphaModifiedCB(attribute, container)
{
    container.updateNegateAlpha = true;
    container.setModified();
}
Evaluator.prototype = new Node();
Evaluator.prototype.constructor = Evaluator;

function Evaluator()
{
    Node.call(this);
    this.className = "Evaluator";
    this.attrType = eAttrType.Evaluator;
    
    this.evaluate_ = new BooleanAttr(true);
    this.expired = new BooleanAttr(false);
    
    this.registerAttribute(this.expired, "expired");
    this.registerAttribute(this.evaluate_, "evaluate");
    
    // evaluate/enabled are interchangeable
    this.evaluate_.addTarget(this.enabled);
    this.enabled.addTarget(this.evaluate_);
}

Evaluator.prototype.evaluate = function()
{
}

Evaluator.prototype.update = function(params, visitChildren)
{
    // evaluate if evaluator is "enabled" and has not "expired"
    var enabled = this.enabled_;
    var expired = this.expired.getValueDirect();
    if (enabled && !expired)
    {
        this.evaluate();
    }
    
    // call base-class implementation
    Node.prototype.update.call(this, params, visitChildren);
}
SceneInspector.prototype = new Evaluator();
SceneInspector.prototype.constructor = SceneInspector;

function SceneInspector()
{
    Evaluator.call(this);
    this.className = "SceneInspector";
    this.attrType = eAttrType.SceneInspector;
    
    this.camera = null;
        
    this.viewPosition = new Vector3DAttr(0, 0, 0);
    this.viewRotation = new Vector3DAttr(0, 0, 0);
    this.translationDelta = new Vector3DAttr(0, 0, 0);
    this.panDelta = new Vector3DAttr(0, 0, 0);
    this.trackDelta = new Vector3DAttr(0, 0, 0);
    this.rotationDelta = new Vector3DAttr(0, 0, 0);
    this.viewRelativeXAxisRotation = new BooleanAttr(false);
    this.viewRelativeYAxisRotation = new BooleanAttr(false);
    this.viewRelativeZAxisRotation = new BooleanAttr(false);
    this.pivotDistance = new NumberAttr(0);
    this.pivotPointWorld = new Vector3DAttr(0, 0, 0);
    this.resultPosition = new Vector3DAttr(0, 0, 0);
    this.resultRotation = new Vector3DAttr(0, 0, 0);
    /// indicates the up/right/forward vectors to use for pan/track; if zero,
    /// camera up/right/forward vectors are used (default: zero)
    this.upVector = new Vector3DAttr(0, 0, 0);
    this.rightVector = new Vector3DAttr(0, 0, 0);
    this.forwardVector = new Vector3DAttr(0, 0, 0);
    /// indicate which components of resultPosition/resultRotation should be set; if true,
    /// the component is set, if false, it is not (default: true)
    this.affectPosition_X = new BooleanAttr(true);
    this.affectPosition_Y = new BooleanAttr(true);
    this.affectPosition_Z = new BooleanAttr(true);
    this.affectRotation_X = new BooleanAttr(true);
    this.affectRotation_Y = new BooleanAttr(true);
    this.affectRotation_Z = new BooleanAttr(true);
    
    this.registerAttribute(this.viewPosition, "viewPosition");
    this.registerAttribute(this.viewRotation, "viewRotation");
    this.registerAttribute(this.translationDelta, "translationDelta");
    this.registerAttribute(this.panDelta, "panDelta");
    this.registerAttribute(this.trackDelta, "trackDelta");
    this.registerAttribute(this.rotationDelta, "rotationDelta");
    this.registerAttribute(this.viewRelativeXAxisRotation, "viewRelativeXAxisRotation");
    this.registerAttribute(this.viewRelativeYAxisRotation, "viewRelativeYAxisRotation");
    this.registerAttribute(this.viewRelativeZAxisRotation, "viewRelativeZAxisRotation");
    this.registerAttribute(this.pivotDistance, "pivotDistance");
    this.registerAttribute(this.pivotPointWorld, "pivotPointWorld");
    this.registerAttribute(this.resultPosition, "resultPosition");
    this.registerAttribute(this.resultRotation, "resultRotation");
    this.registerAttribute(this.upVector, "upVector");
    this.registerAttribute(this.rightVector, "rightVector");
    this.registerAttribute(this.forwardVector, "forwardVector");
    this.registerAttribute(this.affectPosition_X, "affectPosition_X");
    this.registerAttribute(this.affectPosition_Y, "affectPosition_Y");
    this.registerAttribute(this.affectPosition_Z, "affectPosition_Z");
    this.registerAttribute(this.affectRotation_X, "affectRotation_X");
    this.registerAttribute(this.affectRotation_Y, "affectRotation_Y");
    this.registerAttribute(this.affectRotation_Z, "affectRotation_Z");
}

SceneInspector.prototype.setCamera = function(camera)
{
    this.camera = camera;
}

SceneInspector.prototype.getCamera = function()
{
    return this.camera;
}

SceneInspector.prototype.evaluate = function()
{
    if (!this.enabled_)
    {
        return;
    }
    
    // get input values
    
    // view position
    var viewPosition = this.viewPosition.getValueDirect();
    
    // view rotation
    var viewRotation = this.viewRotation.getValueDirect();
    
    // translation delta
    var translationDelta = this.translationDelta.getValueDirect();
    
    // pan delta
    var panDelta = this.panDelta.getValueDirect();
    
    // track delta
    var trackDelta = this.trackDelta.getValueDirect();
    
    // rotation delta
    var rotationDelta = this.rotationDelta.getValueDirect();
    
    // view-relative rotation flags
    var viewRelativeXAxisRotation = this.viewRelativeXAxisRotation.getValueDirect();
    var viewRelativeYAxisRotation = this.viewRelativeYAxisRotation.getValueDirect();
    var viewRelativeZAxisRotation = this.viewRelativeZAxisRotation.getValueDirect();
    
    // pivot distance
    var pivotDistance = this.pivotDistance.getValueDirect();
    
    // formulate view transform
    var viewTrans = new Matrix4x4();
    viewTrans.loadTranslation(-viewPosition.x, -viewPosition.y, -viewPosition.z);
    var viewRot = new Matrix4x4();
    viewRot.loadXYZAxisRotation(-viewRotation.x, -viewRotation.y, -viewRotation.z);
    var viewTransform = viewTrans.multiply(viewRot);

    // calculate camera direction vectors
    var cameraUp = this.transformDirectionVector(0, 1, 0, viewTransform);
    var cameraRight = this.transformDirectionVector(1, 0, 0, viewTransform);
    var cameraForward = this.transformDirectionVector(0, 0, 1, viewTransform);
    
    // set rotation matrix
    var sceneRotX = new Matrix4x4();
    var sceneRotY = new Matrix4x4();
    var sceneRotZ = new Matrix4x4();
    // x
    if (viewRelativeXAxisRotation)
    {
        sceneRotX.loadRotation(cameraRight.x, cameraRight.y, cameraRight.z, -rotationDelta.x);
    }
    else
    {
        sceneRotX.loadXAxisRotation(-rotationDelta.x);
    }
    // y
    if (viewRelativeYAxisRotation)
    {
        sceneRotY.loadRotation(cameraUp.x, cameraUp.y, cameraUp.z, -rotationDelta.y);
    }
    else
    {
        sceneRotY.loadYAxisRotation(-rotationDelta.y);
    }
    // z
    if (viewRelativeZAxisRotation)
    {
        sceneRotZ.loadRotation(cameraForward.x, cameraForward.y, cameraForward.z, -rotationDelta.z);
    }
    else
    {
        sceneRotZ.loadXAxisRotation(-rotationDelta.z);
    }
    var sceneRot = sceneRotY.multiply(sceneRotX.multiply(sceneRotZ)); // this multiplication order eliminates roll when x- and y-axis rotations are combined
    
    // set translation matrix
    var sceneTrans = new Matrix4x4();
    sceneTrans.loadTranslation(translationDelta.x, -translationDelta.y, -translationDelta.z);
    
    // set pan/track
    if (panDelta.x != 0 || panDelta.y != 0 || panDelta.z != 0 ||
        trackDelta.x != 0 || trackDelta.y != 0 || trackDelta.z != 0)
    {
        // pan up/right/forward vectors
        var up = this.upVector.getValueDirect();
        var right = this.rightVector.getValueDirect();
        var forward = this.forwardVector.getValueDirect();
        if (up.x == 0 && up.y == 0 && up.z == 0) up = cameraUp;
        if (right.x == 0 && right.y == 0 && right.z == 0) right = cameraRight;
        if (forward.x == 0 && forward.y == 0 && forward.z == 0) forward = cameraForward;
        
        // calculate direction vectors after scene rotation matrix is applied
        var cameraUpRot = up;
        var cameraRightRot = right;    
        var cameraForwardRot = forward;    
            
        var scenePan = new Matrix4x4();
        scenePan.loadTranslation(
            cameraRightRot.x * panDelta.x + cameraUpRot.x * -panDelta.y + cameraForwardRot.x * -panDelta.z, 
            cameraRightRot.y * panDelta.x + cameraUpRot.y * -panDelta.y + cameraForwardRot.y * -panDelta.z, 
            cameraRightRot.z * panDelta.x + cameraUpRot.z * -panDelta.y + cameraForwardRot.z * -panDelta.z);
            
        sceneTrans = sceneTrans.multiply(scenePan);
        
        // formulate "track" or "dolly" vectors:
        // track forward = cameraForwardRot (calculated above) rotated about cameraRightRot 
        // (calculated above) viewRotation.x (camera pitch) degrees;
        // track up = track forward rotated about the camera right vector 90 degrees;
        // track right = cameraRightRot (calculated above)
        var sceneTrack = new Matrix4x4();
        var cameraVectorRot = new Matrix4x4();
        
        var flipIt = false;
        var abs_heading = Math.abs(viewRotation.y);
        var abs_pitch = Math.abs(viewRotation.x);
        var abs_bank = Math.abs(viewRotation.z);
        if (viewRotation.z >= 90 && viewRotation.z <= 270)
        {
            flipIt = true;
        }
        else if (viewRotation.z <= -90 && viewRotation.z >= -270)
        {
            flipIt = true
        }
        else
        {
            if (viewRotation.x <= -45 || (viewRotation.x >= 45 && viewRotation.x <= 90))
            {
                flipIt = true;
            }
        }
        
        var lastCameraForwardRot = cameraForwardRot;

        cameraVectorRot.loadRotation(cameraRightRot.x, cameraRightRot.y, cameraRightRot.z, viewRotation.x);
        cameraForwardRot = this.transformDirectionVector(cameraForwardRot.x, cameraForwardRot.y, cameraForwardRot.z, cameraVectorRot);

        var angle = toDegrees(Math.acos(cosineAngleBetween(lastCameraForwardRot, cameraForwardRot)));

        cameraVectorRot.loadRotation(cameraRightRot.x, cameraRightRot.y, cameraRightRot.z, 90);
        cameraUpRot = this.transformDirectionVector(cameraUpRot.x, cameraUpRot.y, cameraUpRot.z, cameraVectorRot);
        sceneTrack.loadTranslation(
            cameraRightRot.x * trackDelta.x + cameraUpRot.x * -trackDelta.y + cameraForwardRot.x * -trackDelta.z, 
            cameraRightRot.y * trackDelta.x + cameraUpRot.y * -trackDelta.y + 0, /*cameraForwardRot.y * -trackDelta.z,*/ // don't set y-component when z-tracking
            cameraRightRot.z * trackDelta.x + cameraUpRot.z * -trackDelta.y + cameraForwardRot.z * -trackDelta.z);

        sceneTrans = sceneTrans.multiply(sceneTrack);
    }
    
    // set pivot distance transforms

    // get camera position in world coordinates
    var viewTransformWorld = new Matrix4x4();
    viewTransformWorld.loadMatrix(viewTransform);
    viewTransformWorld.invert();
    var cameraPos = new Vector3D();
    cameraPos.load(viewTransformWorld._41, viewTransformWorld._42, viewTransformWorld._43);

    var pivotTrans = new Vector3D();
    pivotTrans.load(
        cameraPos.x + cameraForward.x * pivotDistance,
        cameraPos.y + cameraForward.y * pivotDistance,
        cameraPos.z + cameraForward.z * pivotDistance);                
	this.pivotPointWorld.setValueDirect(pivotTrans.x, pivotTrans.y, pivotTrans.z);

    var scenePivot = new Matrix4x4();
    var scenePivotInv = new Matrix4x4();
    scenePivot.loadTranslation(-pivotTrans.x, -pivotTrans.y, -pivotTrans.z);
    scenePivotInv.loadTranslation(pivotTrans.x, pivotTrans.y, pivotTrans.z);
    
    // set overall transform
    var resultTransform = sceneTrans.multiply(scenePivot.multiply(sceneRot.multiply(scenePivotInv.multiply(viewTransform))));

    var resultRotation = resultTransform.getRotationAngles();

    var resultPosition = new Vector3D();
    resultPosition.load(resultTransform._41, resultTransform._42, resultTransform._43);
    resultTransform.transpose(); // invert rotation
    resultPosition = resultTransform.transform(resultPosition.x, resultPosition.y, resultPosition.z, 0);

    // output results
    this.resultPosition.setValueDirect(this.affectPosition_X.getValueDirect() ? -resultPosition.x : viewPosition.x, 
                                       this.affectPosition_Y.getValueDirect() ? -resultPosition.y : viewPosition.y,
                                       this.affectPosition_Z.getValueDirect() ? -resultPosition.z : viewPosition.z);
    this.resultRotation.setValueDirect(this.affectRotation_X.getValueDirect() ? -resultRotation.x : viewRotation.x, 
                                       this.affectRotation_Y.getValueDirect() ? -resultRotation.y : viewRotation.y, 
                                       this.affectRotation_Z.getValueDirect() ? -resultRotation.z : viewRotation.z);
}

SceneInspector.prototype.transformDirectionVector = function(x, y, z, matrix)
{
    var m = new Matrix4x4();
    m.loadMatrix(matrix);
    m.transpose(); // invert rotation
    
    return m.transform(x, y, z, 0);
}

/*
SceneInspector.prototype.zoomIn = function()
{
   var x = bridgeworks.registry.find("SceneInspector");
   x.panDelta.z+=30;
    x.panDelta.setValueDirect(this.panDelta.x, this.panDelta.y, this.panDelta.z, this.viewTransform);
    x.updateScene();
}

SceneInspector.prototype.zoomOut = function()
{
    this.panDelta.z-=30;
    this.panDelta.setValueDirect(this.panDelta.x, this.panDelta.y, this.panDelta.z,this.viewTransform);
    this.updateScene();
}
*/


ArcballInspector.prototype = new Evaluator();
ArcballInspector.prototype.constructor = ArcballInspector;

function ArcballInspector()
{
    Evaluator.call(this);
    this.className = "ArcballInspector";
    this.attrType = eAttrType.ArcballInspector;

    this.sphereCenter = new Vector3DAttr(0, 0, 0);
    this.sphereRadius = new NumberAttr(0);
    this.mouseDown = new Vector2DAttr(0, 0);
    this.mouseNow = new Vector2DAttr(0, 0);
    this.quatAtMouseDown = new QuaternionAttr(1, 0, 0, 0);
    this.viewport = new ViewportAttr(0, 0, 0, 0);
    this.worldTransform = new Matrix4x4Attr();
    this.viewTransform = new Matrix4x4Attr();
    this.constrainToAxis = new BooleanAttr(false);
    this.constraintAxis = new Vector3DAttr(0, 0, 0);
    this.resultQuat = new QuaternionAttr(1, 0, 0, 0);

    this.registerAttribute(this.sphereCenter, "sphereCenter");
    this.registerAttribute(this.sphereRadius, "sphereRadius");
    this.registerAttribute(this.mouseDown, "mouseDown");
    this.registerAttribute(this.mouseNow, "mouseNow");
    this.registerAttribute(this.quatAtMouseDown, "quatAtMouseDown");
    this.registerAttribute(this.viewport, "viewport");
    this.registerAttribute(this.worldTransform, "worldTransform");
    this.registerAttribute(this.viewTransform, "viewTransform");
    this.registerAttribute(this.constrainToAxis, "constrainToAxis");
    this.registerAttribute(this.constraintAxis, "constraintAxis");
    this.registerAttribute(this.resultQuat, "resultQuat");
}

ArcballInspector.prototype.evaluate = function()
{
    if (!(this.enabled.getValueDirect()))
    {
        return;
    }

    // get input values

    // sphere center
    var center = this.sphereCenter.getValueDirect();

    // sphere radius
    var radius = this.sphereRadius.getValueDirect();

    // mouse coords
    var mouseDown = this.mouseDown.getValueDirect();
    var mouseNow = this.mouseNow.getValueDirect();

    // mouse down quat
    var quatDown = this.quatAtMouseDown.getValueDirect();

    // viewport
    var vp = this.viewport;
 
    // world transform
    var world = this.worldTransform.getValueDirect();

    // view transform
    var view = this.viewTransform.getValueDirect();

    // invert world transform (to account for existing transformations) and combine with view transform
    world.invert();
    view = view.multiply(world);

    // constrain to axis
    var constrain = this.constrainToAxis.getValueDirect();

    // normalize screen coordinates to [-1, 1] (invert y -- screen y coords are reversed)
    center.x    = 2 * (center.x - vp.x) / vp.width -1;
    center.y    = 2 * (vp.height - center.y - vp.y) / vp.height - 1;
    mouseDown.x = 2 * (mouseDown.x - vp.x) / vp.width  - 1;
    mouseDown.y = 2 * (vp.height - mouseDown.y - vp.y) / vp.height - 1;
    mouseNow.x  = 2 * (mouseNow.x  - vp.x) / vp.width  - 1;
    mouseNow.y  = 2 * (vp.height - mouseNow.y  - vp.y) / vp.height - 1;
    
    // get points on sphere corresponding to mouse down and mouse now
    var ptDown, ptNow;
    if (!constrain)
    {
        ptDown = this.getSpherePoint(mouseDown, center, radius);
        ptNow = this.getSpherePoint(mouseNow, center, radius);
    }
    else // constrain
    {
        // constraint axis
        var axis = this.constraintAxis.getValueDirect();

        ptDown = this.getSpherePointAboutAxis(mouseDown, center, radius, axis);
        ptNow = this.getSpherePointAboutAxis(mouseNow, center, radius, axis);
    }

    // transform by view matrix
    var ptDownX = view.transform(ptDown.x, ptDown.y, ptDown.z, 0);
    var ptNowX = view.transform(ptNow.x, ptNow.y, ptNow.z, 0);
    ptDown.x = ptDownX.x;
    ptDown.y = ptDownX.y;
    ptDown.z = ptDownX.z;
    ptNow.x = ptNowX.x;
    ptNow.y = ptNowX.y;
    ptNow.z = ptNowX.z;
    ptDown.normalize();
    ptNow.normalize();

    // construct unit quaternion from the two points on sphere
    var quatDrag = this.getQuatFromSpherePoints(ptDown, ptNow);

    // multiply drag quaternion with down quaternion
    quatDrag = quatDrag.multiply(quatDown);
    
    this.resultQuat.setValueDirect(quatDrag);
}

ArcballInspector.prototype.getSpherePoint = function(mouse, center, radius)
{
    var point = new Vector3D();
    
    point.x = (mouse.x - center.x) / radius;
    point.y = (mouse.y - center.y) / radius;

    var mag = point.x * point.x + point.y * point.y;
    if (mag > 1.0)
    {
        var scale = 1 / Math.sqrt(mag);
        point.x *= scale;
        point.y *= scale;
        point.z = 0;
    }
    else // mag <= 1.0f
    {
        point.z = -(Math.sqrt(1 - mag));
    }
    return point;
}

ArcballInspector.prototype.getSpherePointAboutAxis = function(mouse, center, radius, axis)
{
    point = this.getSpherePoint(mouse, center, radius);

    var dot = dotProduct(point, axis);
    
    axis.multiplyScalar(dot);
    
    var proj = new Vector3D(point.x, point.y, point.z);
    
    proj.subtractVector(axis);
    
    var norm = magnitude(proj.x, proj.y, proj.z);
    
    point = null;
    
    if (norm > 0)
    {
        var s = 1 / Math.sqrt(norm);
        if (proj.z < 0)
        {
            proj.x = -proj.x;
            proj.y = -proj.y;
            proj.z = -proj.z;
        }

        point = proj.multiplyScalar(s);
    }
    else if (axis.z == 1.0)
    {
        point = new Vector3D(1, 0, 0);
    }
    else
    {
        point.normalize();
    }
}

ArcballInspector.prototype.getQuatFromSpherePoints = function(pt1, pt2)
{
    var quat = new Quaternion();
    quat.x = pt1.y * pt2.z - pt1.z * pt2.y;
    quat.y = pt1.z * pt2.x - pt1.x * pt2.z;
    quat.z = pt1.x * pt2.y - pt1.y * pt2.x;
    quat.w = pt1.x * pt2.x + pt1.y * pt2.y + pt1.z * pt2.z;
    return quat;
}

// doesn't do anything
function ArcballInspector_ViewTransformModifiedCB(attribute, container)
{
    /*
    if (attr)
    {
        CMatrix4x4FloatAttr* viewTransform = dynamic_cast<CMatrix4x4FloatAttr*>(attr);
        if (viewTransform)
        {
            CMatrix4x4f m;
            viewTransform.getValueDirect(m);
        }
    }
    */
}


KeyframeInterpolator.prototype = new Evaluator();
KeyframeInterpolator.prototype.constructor = KeyframeInterpolator;

function EndState()
 {
    this.initialized = false;
    this.startKeyIts = []; // one for each channel
    this.endKeyIts = [];  // one for each channel
    this.startTime = -FLT_MAX;    // across all channels
    this.endTime = FLT_MAX;     // across all channels
 }
    
function KeyframeInterpolator()
{
    Evaluator.call(this);
    this.className = "KeyframeInterpolator";
    this.attrType = eAttrType.KeyframeInterpolator;

    this.lastTime = 0;
    this.evaluated = false;
    this.endState =  new EndState();
    
    this.time = new NumberAttr(0);
    this.channels = new AttributeVector();
    this.startKeys = new AttributeVector();
    this.endKeys = new AttributeVector();
    this.preBehaviors = new AttributeVector();
    this.postBehaviors = new AttributeVector();
    this.resultValues = new AttributeVector();

    this.time.addModifiedCB(KeyframeInterpolator_TimeModifiedCB, this);
    
    this.registerAttribute(this.time, "time");
    this.registerAttribute(this.channels, "channels");
    this.registerAttribute(this.startKeys, "startKeys");
    this.registerAttribute(this.endKeys, "endKeys");
    this.registerAttribute(this.preBehaviors, "preBehaviors");
    this.registerAttribute(this.postBehaviors, "postBehaviors");
    this.registerAttribute(this.resultValues, "resultValues");
}

KeyframeInterpolator.prototype.setNumChannels = function(numChannels)
{
    // clear
    this.channels.resize(0);
    this.startKeys.resize(0);
    this.endKeys.resize(0);
    this.preBehaviors.resize(0);
    this.postBehaviors.resize(0);
    this.resultValues.resize(0);
    
    for (var i=0; i < numChannels; i++)
    {
        this.channels.push_back(new KeyframesAttr());
        this.startKeys.push_back(new NumberAttr(-1));
        this.endKeys.push_back(new NumberAttr(-1));
        this.preBehaviors.push_back(new NumberAttr(eEndBehavior.Reset));
        this.postBehaviors.push_back(new NumberAttr(eEndBehavior.Reset));
        this.resultValues.push_back(new NumberAttr(0));
    }
}

KeyframeInterpolator.prototype.evaluate = function()
{
    // initialize end state if not already initialized
    if (!this.endState.initialized)
    {
        // initialize
        this.updateEndState();
        this.endState.initialized = true;
    }
    
    // get input values

    // time
    var time = this.time.getValueDirect();

    var first, last;
    var pre, post;

    // for each channel...
    for (var i = 0; i < this.channels.vector.length; i++)
    {
        var keyframes = this.channels.getAt(i);
        if (keyframes.vector.length == 0) continue;

        first = this.endState.startKeyIts[i];
        last = this.endState.endKeyIts[i];

        pre = this.preBehaviors.getAt(i).getValueDirect();
        post = this.postBehaviors.getAt(i).getValueDirect();

        // interpolate
        var value = interpolate(time, keyframes, first, last, pre, post);

        // output result
        this.resultValues.getAt(i).setValueDirect(value);
    }

    this.lastTime = time;
    this.evaluated = true;
}

KeyframeInterpolator.prototype.timeModified = function()
{
    this.updateExpired();
}

KeyframeInterpolator.prototype.updateExpired = function()
{
    // determine if kfi has "expired"
    this.expired.setValueDirect(false);

    // NOTE: this code moved from RenderAgent

    // an multi-channel Evaluator (i.e., KeyframeInterpolator) is considered
    // animating if any 1 of its channels meet the requirements for determining
    // whether or not Evaluate is called.  For KeyframeInterpolators, "at least
    // one channel is animating" if any one of the channels' keys has a time 
    // value greater than the current time.
    var bAtLeastOneChannelAnimating = false;

    // for each channel in the interpolator, compare current time
    // with both end behavior and stop time to determine whether or 
    // not this kfi should continue to be evaluated
    var fEvalTime = this.time.getValueDirect();
    var iPost = 0;
    var postBehavior = null;
    var numChannels = this.channels.vector.length;
    for (var i=0; i < numChannels; i++)
    {
        postBehavior = this.postBehaviors.getAt(i);
        if (postBehavior)
        {
            iPost = postBehavior.getValueDirect();
        }

        // if *expression* is TRUE then the end behavior is 
        // repeat, oscillate, or some other continuous behavior
        if (iPost != eEndBehavior.Constant)
        {
            bAtLeastOneChannelAnimating = true;
            break;
        }
    }

    // if the eval's current time either:
    // 1. has advanced passed its longest keyframe OR
    // 2. is not yet at its start time
    // then stop evaluating it.
    // NOTE: only check Constant end behaviors b/c Repeats and
    // Oscillators should keep running.  By definition, scenes w/
    // non-constant end behaviors will never AA
    if (!bAtLeastOneChannelAnimating &&
        (fEvalTime < this.endState.startTime || fEvalTime > this.endState.endTime))
    {
        // set expired flag
        this.expired.setValueDirect(true);
    }
}

KeyframeInterpolator.prototype.updateEndState = function()
{
    var fStartTime = -1;
    var fEndTime = -1;
    var fShortest = FLT_MAX;
    var fLongest = -FLT_MAX;
    var startKey = -1, endKey = -1;
    var keyframes = null;
    var numChannels = this.channels.vector.length;
    
    this.startKeys.resize(numChannels);
    this.endKeys.resize(numChannels);
    
    for (var i=0; i < numChannels; i++)
    {
        keyframes = this.channels.getAt(i);
        
        startKey = this.startKeys.vector.length > i ? this.startKeys.getAt(i).getValueDirect() : -1;
        endKey = this.endKeys.vector.length > i ? this.endKeys.getAt(i).getValueDirect() : -1;
        
        if (endKey < startKey)
        {
            endKey = startKey;
        }
        
        // set first/last keys to evaluate
        this.endState.startKeyIts[i] = keyframes.getAt(0); 
        this.endState.endKeyIts[i] = keyframes.getAt(keyframes.vector.length - 1);
        if (!this.endState.startKeyIts[i] || !this.endState.endKeyIts[i]) continue;
        
        if (startKey >= 0 && startKey < keyframes.vector.length)
        {
            this.endState.startKeyIts[i] = keyframes.getAt(startKey);
        }

        if (endKey >= 0 && endKey < keyframes.vector.length)
        {
            this.endState.endKeyIts[i] = keyframes.getAt(endKey);
        }

	    fStartTime = this.endState.startKeyIts[i].getTime();
        fEndTime = this.endState.endKeyIts[i].getTime();

	    // save the smallest start time for all channels
	    fShortest = fStartTime < fShortest ? fStartTime : fShortest;

	    // save the longest end time for all channels
	    fLongest = fEndTime >= fLongest ? fEndTime : fLongest;
    }
    
    this.endState.startTime = fShortest;
    this.endState.endTime = fLongest;
}

function KeyframeInterpolator_TimeModifiedCB(attribute, container)
{
    container.timeModified();
}

function KeyframeInterpolator_EndStateModifiedCB(attribute, container)
{
    container.updateEndState();
}
BBoxLocator.prototype = new Evaluator();
BBoxLocator.prototype.constructor = BBoxLocator;

function BBoxLocator()
{
    Evaluator.call(this);
    this.className = "BBoxLocator";
    this.attrType = eAttrType.BBoxLocator;

    this.viewPosition = new Vector3DAttr(0, 0, 0);
    this.viewTransform = new Matrix4x4Attr(1, 0, 0, 0,
                                           0, 1, 0, 0,
                                           0, 0, 1, 0,
                                           0, 0, 0, 1);
    this.viewVolume = new ViewVolumeAttr();
    this.viewport = new ViewportAttr(0, 0, 0, 0);
    this.nearDistance = new NumberAttr(0);
    this.bbox = new BBoxAttr();
    this.bboxView = new BBoxAttr();
    this.closeness = new NumberAttr(0.5);
    this.resultPosition = new Vector3DAttr(0, 0, 0);
    this.resultWidth = new NumberAttr(0);
    this.resultFarDistance = new NumberAttr(0);
    this.resultPivotDistance = new NumberAttr(0);
    
    this.registerAttribute(this.viewPosition, "viewPosition");
    this.registerAttribute(this.viewTransform, "viewTransform");
    this.registerAttribute(this.viewVolume, "viewVolume");
    this.registerAttribute(this.viewport, "viewport");
    this.registerAttribute(this.nearDistance, "nearDistance");
    this.registerAttribute(this.bbox, "bbox");
    this.registerAttribute(this.bboxView, "bboxView");
    this.registerAttribute(this.closeness, "closeness");
    this.registerAttribute(this.resultPosition, "resultPosition");
    this.registerAttribute(this.resultWidth, "resultWidth");
    this.registerAttribute(this.resultFarDistance, "resultFarDistance");
    this.registerAttribute(this.resultPivotDistance, "resultPivotDistance");
}

BBoxLocator.prototype.evaluate = function()
{
    // get input values

    // position
    var viewPosition = this.viewPosition.getValueDirect();

    // view transform
    var viewTransform = this.viewTransform.getValueDirect();

    // view volume planes
    var left = this.viewVolume.left.getValueDirect();
    var right = this.viewVolume.right.getValueDirect();
    var top = this.viewVolume.top.getValueDirect();
    var bottom = this.viewVolume.bottom.getValueDirect();
    var near = this.viewVolume.near.getValueDirect();
    var far = this.viewVolume.far.getValueDirect();

    // viewport
    var viewport = this.viewport.getValueDirect();

    // bbox min/max points
    var min = this.bbox.min.getValueDirect();
    var max = this.bbox.max.getValueDirect();

    // closeness
    var closeness = this.closeness.getValueDirect();
    if (closeness != 0)
    {
        var bbw = max.x - min.x;
        var bbh = max.y - min.y;

        bbw += bbw * closeness;
        bbh += bbh * closeness;

        if (viewport.width / viewport.height < bbw / bbh)
        {
            bbw = (bbw - (max.x - min.x)) / 2;
            min.x -= bbw;
            max.x += bbw;
        }
        else // (viewport.width / viewport.height >= bbw / bbh)
        {
            bbh = (bbh - (max.y - min.y)) / 2;
            min.y -= bbh;
            max.y += bbh;
        }
    }

    // formulate bbox endpoints
    var p = new Array(8);
    p[0] = new Vector3D(min.x, min.y, min.z);
    p[1] = new Vector3D(min.x, min.y, max.z);
    p[2] = new Vector3D(min.x, max.y, min.z);
    p[3] = new Vector3D(min.x, max.y, max.z);
    p[4] = new Vector3D(max.x, min.y, min.z);
    p[5] = new Vector3D(max.x, min.y, max.z);
    p[6] = new Vector3D(max.x, max.y, min.z);
    p[7] = new Vector3D(max.x, max.y, max.z);

    // get center of world-space bbox
    var center = new Vector3D((min.x + max.x) / 2,
                              (min.y + max.y) / 2,
                              (min.z + max.z) / 2);

    // get camera forward vector
    var fwd = new Vector3D();
    fwd.copy(viewTransform.transform(0, 0, 1, 0));
    fwd.normalize();

    var distance = 0;
    var resultPosition;
    var perspectiveViewVolume = planesIntersect(left, right);

    // if perspective camera...
    if (perspectiveViewVolume)
    {
        // formulate camera-oriented view-volume planes centered at bbox center
        var vvPlanes = new Array(5); // don't consider far plane

        vvPlanes[0] = this.getPlane(left.point, center, left.normal, viewTransform);
        vvPlanes[1] = this.getPlane(right.point, center, right.normal, viewTransform);
        vvPlanes[2] = this.getPlane(top.point, center, top.normal, viewTransform);
        vvPlanes[3] = this.getPlane(bottom.point, center, bottom.normal, viewTransform);
        vvPlanes[4] = this.getPlane(near.point, center, near.normal, viewTransform);

        // for each bbox point, determine the maximum distance necessary to move all points to within the
        // view-volume along the camera forward vector		
        for (var i = 0; i < 8; i++)
        {
            for (var j = 0; j < 5; j++)
            {
                if (pointOnPositiveSideOfPlane(p[i], vvPlanes[j]))
                {
                    var d = this.distanceFromPlane(p[i], fwd, vvPlanes[j]);
                    if (d.intersection)
                    {
                        distance = Math.max(distance, d.distance);
                    }
                }
            }
        }

        resultPosition = new Vector3D(center.x, center.y, center.z);
        fwd.multiplyScalar(distance);
        resultPosition.subtractVector(fwd);
    }
    else // orthographic camera
    {
        resultPosition = new Vector3D(center.x, center.y, center.z);
        distance = magnitude(viewPosition.x, viewPosition.y, viewPosition.z);
        fwd.multiplyScalar(distance);
        resultPosition.subtractVector(fwd);

        // set width

        // get bboxView min/max points
        var vmin = this.bboxView.min.getValueDirect();
        var vmax = this.bboxView.max.getValueDirect();

        var width = distanceBetweenPlanes(right, left);
        var height = distanceBetweenPlanes(top, bottom);
        var aspect = width / height;

        var xDim = Math.abs(vmax.x - vmin.x);
        var yDim = Math.abs(vmax.y - vmin.y);

        // this could probably be simplified, but it works
        if (xDim > yDim)
        {
            width = xDim;

            height = width / aspect;
            if (height < yDim)
            {
                height = yDim;
                width = height * aspect;
            }
        }
        else
        {
            height = yDim;
            width = height * aspect;

            if (width < xDim)
            {
                width = xDim;
            }
        }

        // output result
        this.resultWidth.setValueDirect(width);
    }

    // output result(s)
    this.resultPosition.setValueDirect(resultPosition.x, resultPosition.y, resultPosition.z);

    // determine distance of all points from near clipping plane
    distance = 0;
    for (var i = 0; i < 8; i++)
    {
        var px = viewTransform.transform(p[i].x, p[i].y, p[i].z, 1);
        distance = Math.max(distance, distanceBetween(p[i], resultPosition));
    }

    this.resultFarDistance.setValueDirect(this.nearDistance.getValueDirect() + distance);

    // determine pivot distance (distance between camera and center of bbox in world-space)
    distance = distanceBetween(resultPosition, new Vector3D(center.x, center.y, center.z));
    this.resultPivotDistance.setValueDirect(distance);
}

BBoxLocator.prototype.getPlane = function(point, offset, normal, transform)
{
    var xpoint = transform.transformVector3D(point, 0);
    xpoint.x += offset.x;
    xpoint.y += offset.y;
    xpoint.z += offset.z;

    var xnormal = transform.transformVector3D(normal, 0);

    var plane = new Plane(new Vector3D(xpoint.x, xpoint.y, xpoint.z), new Vector3D(xnormal.x, xnormal.y, xnormal.z));

    return plane;
}

BBoxLocator.prototype.distanceFromPlane = function(point, dir, plane)
{
    var line = new Line(point, dir);
    var distance;

    var intersection = lineIntersectsPlane(line, plane);
    switch (intersection.result)
    {
    case 0: // no intersection
        distance = FLT_MAX;
        break;

    case 1: // intersection at 1 point
        distance = distanceBetween(point, intersection.point);
        break;

    case 2: // intersection at infinite points (line on plane) 
    default:
        distance = 0;
        break;
    }

    return { intersection: intersection.result, distance: distance };
}
function worldUnitsPerPixelPersp(viewport, zoom, viewSpace_Z)
{
    // get vertical field of view in radians
    var fovY = 2 * Math.atan2(1, zoom);

    // get horizontal field of view in radians
    var fovX = 2 * Math.atan(viewport.width / viewport.height * Math.tan(fovY / 2));

    // determine the width of the visible portion of the x axis on the 
    // clipping plane at viewSpace_Z
    var clipPlaneWidth  = Math.tan(fovX / 2) * viewSpace_Z * 2;

    // determine the height of the visible portion of the y axis on the
    // clipping plane at viewSpace_Z
    var clipPlaneHeight  = Math.tan(fovY / 2) * viewSpace_Z * 2;

    // determine the per-pixel clipPlaneWidth and clipPlaneHeight
    var x = clipPlaneWidth  / viewport.width;
    var y = clipPlaneHeight / viewport.height;
    
    return { x: x, y: y };
}

function worldUnitsPerPixelOrtho(viewport, width)
{
    // calculate height
    var height = width * (viewport.height / viewport.width);

    // determine the per-pixel width and height
    var x = width  / viewport.width;
    var y = height / viewport.height;
    
    return { x: x, y: y };
}

function toScreenSpace(world, view, proj, viewport)
{
    // transform to view space
    var screen = view.transformw(world.x, world.y, world.z, 1);

    // transform to projection space
	screen = proj.transformw(screen.x, screen.y, screen.z, screen.w);

    if (screen.w == 0)
    {
        return { x: -Infinity, y: -Infinity, z: -Infinity };
    }

    // normalize to [-1, 1]
    // (if x or y is outside the range (-w, w), the screen coordinate(s) will be 
    // outside the viewport
    screen.x /= screen.w;
    screen.y /= screen.w;
    //screen.z /= screen.w;

    // clip to viewport
    screen.x = viewport.x + viewport.width  - ((-screen.x + 1) * viewport.width  / 2);
    screen.y = viewport.y + viewport.height - (( screen.y + 1) * viewport.height / 2);
	screen.z = 0;
	
	return { x: screen.x, y: screen.y, z: screen.z };    
} 
RasterComponent.prototype = new ParentableMotionElement();
RasterComponent.prototype.constructor = RasterComponent;

function RasterComponent()
{
    ParentableMotionElement.call(this);
    this.className = "RasterComponent";
    this.attrType = eAttrType.RasterComponent;

    this.rcEventListener = null;

    this.opacity = new NumberAttr(1);				// opaque
    this.anchor = new Vector2DAttr(0, 0);			// 0, 0
    this.origin = new StringAttr("bottomLeft");		// bottom-left
    this.show = new BooleanAttr(true);				// true
    this.selectable = new BooleanAttr(true);		// true
    this.cullable = new BooleanAttr(true);			// true
    this.clampToViewport = new BooleanAttr(false);	// false
    this.rasterPosition = new Vector3DAttr();
    this.inspectionOffset = new Vector3DAttr();
    this.componentRect = new RectAttr();
    this.screenRect = new RectAttr();

    this.stylesMap.size.addModifiedCB(RasterComponent_StylesMapSizeModifiedCB, this);
    this.show.addModifiedCB(RasterComponent_ShowModifiedCB, this);

    this.registerAttribute(this.opacity, "opacity");
    this.registerAttribute(this.anchor, "anchor");
    this.registerAttribute(this.origin, "origin");
    this.registerAttribute(this.show, "show");
    this.registerAttribute(this.selectable, "selectable");
    this.registerAttribute(this.cullable, "cullable");
    this.registerAttribute(this.rasterPosition, "rasterPosition");
    this.registerAttribute(this.inspectionOffset, "inspectionOffset");
    this.registerAttribute(this.clampToViewport, "clampToViewport");
    this.registerAttribute(this.componentRect, "componentRect");
    this.registerAttribute(this.screenRect, "screenRect");

    this.renderSequenceSlot.setValueDirect(0xffff);
}

RasterComponent.prototype.setRegistry = function(registry)
{
    var bworks = registry.find("Bridgeworks");
    if (bworks)
    {
        this.rcEventListener = bworks.rasterComponentEventListener;
        if (this.rcEventListener)
        {
            this.rcEventListener.registerComponent(this); // TODO: unable to unregister without dtor
            this.rcEventListener.Listen(this);
        }
    }

    ParentableMotionElement.prototype.setRegistry.call(this, registry);
}

RasterComponent.prototype.isSelected = function(x, y)
{
    var show = this.show.getValueDirect();
    if (show)
    {
        if (this.screenRect.containsPoint(x, y))
        {
            return true;
        }
    }

    return false;
}

RasterComponent.prototype.stylesMapSizeModified = function()
{
    var size = this.stylesMap.Size();
    for (var i = 0; i < size; i++)
    {
        var styleMap = this.stylesMap.getAt(i);
        if (styleMap)
        {
            // add modified CBs for styles map elements' events (remove first to eliminate duplicates)
            styleMap.event.removeModifiedCB(RasterComponent_StylesMapElementEventModifiedCB, this);
            styleMap.event.addModifiedCB(RasterComponent_StylesMapElementEventModifiedCB, this);
            // invoke CB now for stylesMap that are set by reference
            RasterComponent_StylesMapElementEventModifiedCB(styleMap.event, this);
        }
    }
}

RasterComponent.prototype.stylesMapElementEventModified = function(eventName)
{
    this.rcEventListener.listenEvent(this, eEventNameMap[eventName]);
}

RasterComponent.prototype.showModified = function()
{
}

function RasterComponent_StylesMapSizeModifiedCB(attribute, container)
{
    container.stylesMapSizeModified();
}

function RasterComponent_StylesMapElementEventModifiedCB(attribute, container)
{
    container.stylesMapElementEventModified(attribute.getValueDirect().join(""));
}

function RasterComponent_ShowModifiedCB(attribute, container)
{
    container.showModified();
}
Label.prototype = new RasterComponent();
Label.prototype.constructor = Label;

function Label()
{
    RasterComponent.call(this);
    this.className = "Label";
    this.attrType = eAttrType.Label;

    this.iconRect = new Rect(0, 0, 0, 0);
    this.labelRect = new Rect(0, 0, 0, 0);

    this.text = new StringAttr("");
    this.description = new StringAttr("");
    this.depthShadingEnabled = new BooleanAttr(true);
    this.labelStyle = new LabelStyleAttr();
    this.iconStyle = new IconStyleAttr();
    this.balloonTipLabelStyle = new BalloonTipLabelStyleAttr();

    this.text.addModifiedCB(Label_TextModifiedCB, this);
    this.description.addModifiedCB(Label_DescriptionModifiedCB, this);
    this.labelStyle.backgroundColor.addModifiedCB(Label_LabelStyleBackgroundColorModifiedCB, this);
    this.labelStyle.backgroundOpacity.addModifiedCB(Label_LabelStyleBackgroundOpacityModifiedCB, this);
    this.labelStyle.fontStyle.borderColor.addModifiedCB(Label_LabelStyleFontBorderModifiedCB, this);
    this.labelStyle.fontStyle.borderWidth.addModifiedCB(Label_LabelStyleFontBorderModifiedCB, this);
    this.labelStyle.fontStyle.color.addModifiedCB(Label_LabelStyleFontStyleColorModifiedCB, this);
    this.labelStyle.fontStyle.font.addModifiedCB(Label_LabelStyleFontStyleFontModifiedCB, this);
    this.labelStyle.fontStyle.opacity.addModifiedCB(Label_LabelStyleFontStyleOpacityModifiedCB, this);
    this.labelStyle.fontStyle.size.addModifiedCB(Label_LabelStyleFontStyleSizeModifiedCB, this);
    this.labelStyle.fontStyle.style.addModifiedCB(Label_LabelStyleFontStyleStyleModifiedCB, this);
    this.labelStyle.format.addModifiedCB(Label_LabelStyleFormatModifiedCB, this);
    this.labelStyle.padding.addModifiedCB(Label_LabelStylePaddingModifiedCB, this);
    this.iconStyle.url.addModifiedCB(Label_IconStyleUrlModifiedCB, this);
    this.balloonTipLabelStyle.addModifiedCB(Label_BalloonTipLabelStyleModifiedCB, this);

    this.registerAttribute(this.text, "text");
    this.registerAttribute(this.description, "description");
    this.registerAttribute(this.depthShadingEnabled, "depthShadingEnabled");
    this.registerAttribute(this.labelStyle, "labelStyle");
    this.registerAttribute(this.iconStyle, "iconStyle");
    this.registerAttribute(this.balloonTipLabelStyle, "balloonTipLabelStyle");

    this.styles.registerStyle(this.iconStyle, "iconStyle");
    this.styles.registerStyle(this.labelStyle, "labelStyle");
    this.styles.registerStyle(this.balloonTipLabelStyle, "balloonTipLabelStyle");
}

Label.prototype.setGraphMgr = function(graphMgr)
{
    // call base-class implementation
    RasterComponent.prototype.setGraphMgr.call(this, graphMgr);

    // create id
    this.id = "Label" + this.graphMgr.getNextLabelIndex();
    this.labelId = this.id + "_label";
    this.iconId = this.id + "_icon";

    // create html div for canvas overlay
    var htmlLabel = CreateHTMLLabel(this.id, this.labelId, this.iconId);
    this.htmlLabel = htmlLabel.label;
    this.htmlIconImg = htmlLabel.iconImg;
    this.htmlIconDiv = htmlLabel.iconDiv;

    // initialize base dimensions of icon (used for scaling)
    this.htmlIconImg.baseWidth = 0;
    this.htmlIconImg.baseHeight = 0;

    // set initial style
    Label_LabelStyleBackgroundColorModifiedCB(this.labelStyle.backgroundColor, this);
    Label_LabelStyleBackgroundOpacityModifiedCB(this.labelStyle.backgroundOpacity, this);
    Label_LabelStyleFontBorderModifiedCB(null, this); // handles borderColor and borderWidth
    Label_LabelStyleFontStyleColorModifiedCB(this.labelStyle.fontStyle.color, this);
    Label_LabelStyleFontStyleFontModifiedCB(this.labelStyle.fontStyle.font, this);
    Label_LabelStyleFontStyleOpacityModifiedCB(this.labelStyle.fontStyle.opacity, this);
    Label_LabelStyleFontStyleSizeModifiedCB(this.labelStyle.fontStyle.size, this);
    Label_LabelStyleFontStyleStyleModifiedCB(this.labelStyle.fontStyle.style, this);
    Label_LabelStyleFormatModifiedCB(this.labelStyle.format, this);
    Label_LabelStylePaddingModifiedCB(this.labelStyle.padding, this);
    Label_IconStyleUrlModifiedCB(this.iconStyle.url, this);
}

Label.prototype.update = function(params, visitChildren)
{
    // update icon scale
    // (necessary because dimensions are not available until image is actually loaded)
    this.updateIconScale();
    
    // call base-class implementation
    RasterComponent.prototype.update.call(this, params, visitChildren);
}

Label.prototype.updateIconScale = function()
{
    var scale = this.iconStyle.scale.getValueDirect();

    // obtain original dimensions
    if (this.htmlIconImg.baseWidth == 0)
    {
        this.htmlIconImg.baseWidth = this.htmlIconImg.offsetWidth;
        this.htmlIconImg.baseHeight = this.htmlIconImg.offsetHeight;
    }

    // scale
    if (this.htmlIconImg.baseWidth)
    {
        this.htmlIconImg.width = this.htmlIconImg.baseWidth * scale.x;
        this.htmlIconImg.height = this.htmlIconImg.baseHeight * scale.y;
    }
}

Label.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        // call base-class implementation
        RasterComponent.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    switch (directive)
    {
        case "render":
            {
                this.draw(params.viewport);
            }
            break;

        case "rayPick":
            {
                if (this.selectable.getValueDirect() == true &&
                        this.show.getValueDirect() == true)
                {
                    if (this.isSelected(params.clickPoint.x, params.clickPoint.y))
                    {
                        var intersectRecord = new RayIntersectRecord();
                        intersectRecord.distance = 0;

                        params.currentNodePath.push(this);
                        params.directive.addPickRecord(new RayPickRecord(params.currentNodePath, intersectRecord, params.camera));
                        params.currentNodePath.pop();
                    }
                }
            }
            break;
    }

    // call base-class implementation
    RasterComponent.prototype.apply.call(this, directive, params, visitChildren);
}

Label.prototype.draw = function(viewport)
{
    var bworks = this.registry.find("Bridgeworks");

    // show
    if (this.show.getValueDirect() == false)
    {
        this.htmlLabel.style.visibility = "hidden";
        this.htmlIconImg.style.visibility = "hidden";
        return;
    }

    this.htmlLabel.style.visibility = "visible";
    this.htmlIconImg.style.visibility = "visible";

    // update visibility with respect to color/opacity
    if (this.labelStyle.fontStyle.opacity.getValueDirect() == 0)
    {
        this.htmlLabel.style.visibility = "hidden";
    }
    var iconColor = this.iconStyle.color.getValueDirect();
    if (iconColor.a == 0 || this.iconStyle.opacity.getValueDirect() == 0)
    {
        this.htmlIconImg.style.visibility = "hidden";
    }

    // determine the rendering positions
    var positions = this.getRenderingPositions();

    var labelWidth = this.htmlLabel.offsetWidth; // * this.htmlLabel.style.zoom;
    var labelHeight = this.htmlLabel.offsetHeight; // * this.htmlLabel.style.zoom;
    var iconWidth = this.htmlIconImg.offsetWidth;
    var iconHeight = this.htmlIconImg.offsetHeight;

    // determine if label is fully contained within viewport
    if (positions.labelX < 0 ||
        positions.labelY < 0 ||
        positions.labelX + labelWidth > bworks.canvas.width ||
        positions.labelY + labelHeight > bworks.canvas.height)
    {
        this.htmlLabel.style.visibility = "hidden";
    }

    // determine if icon is fully contained within viewport
    if (positions.iconX < 0 ||
        positions.iconY < 0 ||
        positions.iconX + iconWidth > bworks.canvas.width ||
        positions.iconY + iconHeight > bworks.canvas.height)
    {
        this.htmlIconImg.style.visibility = "hidden";
    }

    // update positions if visible
    if (this.htmlLabel.style.visibility == "visible")
    {
        this.htmlLabel.style.left = bworks.canvas.offsetLeft + positions.labelX;
        this.htmlLabel.style.top = bworks.canvas.offsetTop + positions.labelY;

        this.labelRect.load(bworks.canvas.offsetLeft + positions.labelX,
                bworks.canvas.offsetTop + positions.labelY,
                this.labelRect.left + labelWidth,
                this.labelRect.top + labelHeight);
    }
    else
    {
        this.labelRect.load(0, 0, 0, 0);
    }
    if (this.htmlIconImg.style.visibility == "visible")
    {
        this.htmlIconDiv.style.left = bworks.canvas.offsetLeft + positions.iconX;
        this.htmlIconDiv.style.top = bworks.canvas.offsetTop + positions.iconY;

        this.iconRect.load(bworks.canvas.offsetLeft + positions.iconX,
                bworks.canvas.offsetTop + positions.iconY,
                this.iconRect.left + iconWidth,
                this.iconRect.top + iconHeight);
    }
    else
    {
        this.iconRect.load(0, 0, 0, 0);
    }

    // update screen rect
    var screenRect = new Rect(0, 0, 0, 0);
    if (this.htmlLabel.style.visibility == "visible" &&
            this.htmlIconImg.style.visibility == "visible")
    {
        screenRect.left = Math.min(this.labelRect.left, this.iconRect.left);
        screenRect.top = Math.min(this.labelRect.top, this.iconRect.top);
        screenRect.right = Math.max(this.labelRect.right, this.iconRect.right);
        screenRect.bottom = Math.max(this.labelRect.bottom, this.iconRect.bottom);
    }
    else if (this.htmlLabel.style.visibility == "visible")
    {
        screenRect.loadRect(this.labelRect);
    }
    else if (this.htmlIconImg.style.visibility == "visible")
    {
        screenRect.loadRect(this.iconRect);
    }
    this.screenRect.setValueDirect(screenRect);
}

Label.prototype.getRenderingPositions = function()
{
    // initialize
    var labelX = 0;
    var labelY = 0;
    var iconX = 0;
    var iconY = 0;

    // get screen position
    var screen = this.screenPosition.getValueDirect();

    // get anchor position
    var anchor = this.anchor.getValueDirect();

    // get label offset
    var offset = this.labelStyle.offset.getValueDirect();

    if (this.htmlIconImg.offsetWidth > 0 &&
            this.htmlLabel.offsetWidth > 0) // icon and label present
    {
        var labelWidth = this.htmlLabel.offsetWidth;// * this.htmlLabel.style.zoom;
        var labelHeight = this.htmlLabel.offsetHeight;// * this.htmlLabel.style.zoom;
        var iconWidth = this.htmlIconImg.offsetWidth;
        var iconHeight = this.htmlIconImg.offsetHeight;

        // measure from origin
        if (this.origin.getValueDirect().join("") == "bottomLeft")
        {
            anchor.y = iconHeight - anchor.y;
        }

        // 
        iconX = screen.x - anchor.x;
        iconY = screen.y - anchor.y;
        labelX = iconX + offset.x;
        labelY = iconY + offset.y;

        // adjust according to alignment
        switch (this.labelStyle.textAlign.getValueDirect().join(""))
        {
            case "topLeft":
                labelX -= labelWidth;
                labelY -= labelHeight / 2;
                break;

            case "middleLeft":
                labelX -= labelWidth;
                labelY += iconHeight / 2 - labelHeight / 2;
                break;

            case "bottomLeft":
                labelX -= labelWidth;
                labelY += iconHeight - labelHeight / 2;
                break;

            case "topCenter":
                labelX += iconWidth / 2 - labelWidth / 2;
                labelY -= labelHeight;
                break;

            case "middleCenter":
                labelX += iconWidth / 2 - labelWidth / 2;
                labelY += iconHeight / 2 - labelHeight / 2;
                break;

            case "bottomCenter":
                labelX += iconWidth / 2 - labelWidth / 2;
                labelY += iconHeight;
                break;

            case "topRight":
                labelX += iconWidth;
                labelY -= labelHeight / 2;
                break;

            case "bottomRight":
                labelX += iconWidth;
                labelY += iconHeight - labelHeight / 2;
                break;

            case "middleRight": // default
            default:
                labelX += iconWidth;
                labelY += iconHeight / 2 - labelHeight / 2;
                break;
        }
    }
    else if (this.htmlLabel.offsetWidth > 0)
    {
        var labelWidth = this.htmlLabel.offsetWidth;// * this.htmlLabel.style.zoom;
        var labelHeight = this.htmlLabel.offsetHeight;// * this.htmlLabel.style.zoom;

        // 
        labelX = screen.x + anchor.x + offset.x;
        labelY = screen.y - anchor.y + offset.y;

        // adjust according to alignment
        switch (this.labelStyle.textAlign.getValueDirect().join(""))
        {
            case "topLeft":
                labelX -= labelWidth;
                labelY -= labelHeight;
                break;

            case "middleLeft":
                labelX -= labelWidth;
                labelY -= labelHeight / 2;
                break;

            case "bottomLeft":
                labelX -= labelWidth;
                break;

            case "topCenter":
                labelX -= labelWidth / 2;
                labelY -= labelHeight;
                break;

            case "middleCenter":
                labelX -= labelWidth / 2;
                labelY -= labelHeight / 2;
                break;

            case "bottomCenter":
                labelX -= labelWidth / 2;
                break;

            case "topRight":
                labelY -= labelHeight;
                break;

            case "bottomRight":
                break;

            case "middleRight": // default
            default:
                labelY -= labelHeight / 2;
                break;
        }
    }
    else // only icon present
    {
        var iconWidth = this.htmlIconImg.offsetWidth;
        var iconHeight = this.htmlIconImg.offsetHeight;

        // measure from bottom left
        anchor.y = iconHeight - anchor.y;

        iconX = screen.x - anchor.x;
        iconY = screen.y - anchor.y;
    }

    return {labelX: labelX, labelY: labelY, iconX: iconX, iconY: iconY};
}

Label.prototype.eventPerformed = function(event)
{
    if (!(this.show.getValueDirect()))
    {
        return false;
    }

    var selected = this.isSelected(event.x, event.y);

    return selected;
}

Label.prototype.labelStyleFontBorderModified = function()
{
    var color = this.labelStyle.fontStyle.borderColor.getValueDirect();
    color.a *= this.labelStyle.fontStyle.opacity.getValueDirect();
    var width = this.labelStyle.fontStyle.borderWidth.getValueDirect();

    var shadow = "";
    for (var i = 0; i < color.a; i += 0.2)
    {
        if (i > 0)
            shadow += ", ";

        shadow += "rgba(" + color.r * 255 + ","
                + color.g * 255 + ","
                + color.b * 255 + ","
                + color.a + ")" + " 0px 0px " + width * 2 + "px";
    }

    this.htmlLabel.style.textShadow = shadow;
}

function CreateHTMLLabel(id, labelId, iconId)
{
    var newDiv = null;
    var newLabel = null;
    var newIconImg = null;
    var newIconDiv = null;

    // Needs further refactoring. Currently set in an app Helper
    // because we don't have container scope here to append these elements
    if (bridgeworks.rasterComponents)
    {
        // containing div
        newDiv = document.createElement("div");
        if (newDiv)
        {
            newDiv.setAttribute("id", id);

            // label
            newLabel = document.createElement("span");
            if (newLabel)
            {
                newLabel.setAttribute("id", labelId);
                newLabel.setAttribute("class", "labelText");
                newLabel.style.visibility = "hidden";
                newLabel.style.position = "absolute";
                newLabel.style.zIndex = 3;
                //newLabel.style.zoom = 1;//.95;
                newLabel.onmousedown = function() { /*onMouseDown();*/
                };
                newLabel.onmouseup = function() { /*onMouseUp();*/
                };
                newLabel.onmousemove = function() { /*onMouseMove();*/
                };
                // disable selection
                newLabel.onselectstart = new Function("return false");

                newDiv.appendChild(newLabel);
            }

            // icon
            newIconDiv = document.createElement("div");
            if (newIconDiv)
            {
                newIconDiv.setAttribute("id", iconId);
                newIconDiv.style.position = "absolute";
                newIconDiv.style.zIndex = 3;

                newIconImg = document.createElement("img");
                if (newIconImg)
                {
                    newIconImg.setAttribute("class", "labelIcon");
                    newIconImg.style.visibility = "hidden";
                    newIconImg.src = "BwContent/images/1x1.png";
                    //newIconImg.onmousedown = function(){onMouseDown();};
                    newIconImg.onmouseup = function() { /*onMouseUp();*/
                    };
                    newIconImg.onmousemove = function() { /*onMouseMove();*/
                    };
                    // disable selection
                    newIconImg.onmousedown = function() {
                        return false;
                    };

                    newIconDiv.appendChild(newIconImg);
                }
                newDiv.appendChild(newIconDiv);
            }

            bridgeworks.rasterComponents.appendChild(newDiv);
        }
    }

    return {div: newDiv, label: newLabel, iconDiv: newIconDiv, iconImg: newIconImg};
}

function Label_TextModifiedCB(attribute, container)
{
    container.htmlLabel.innerHTML = attribute.getValueDirect().join("");
}

function Label_DescriptionModifiedCB(attribute, container)
{
    var description = attribute.getValueDirect().join("");
    if (description.length > 0)
    {
        // desired dimensions; if 0, use 50% canvas size
        var width = container.balloonTipLabelStyle.htmlLabelStyle.width.getValueDirect();
        var height = container.balloonTipLabelStyle.htmlLabelStyle.height.getValueDirect();
        if (width == 0 || height == 0)
        {
            var viewportMgr = container.registry.find("ViewportMgr");
            if (width == 0)
                width = viewportMgr.getAttribute("width").getValueDirect() * 0.5;
            if (height == 0)
                height = viewportMgr.getAttribute("height").getValueDirect() * 0.5;
        }

        var id = '#' + container.iconId;
        description = "<div class='gmap' style='" +
                "width:" + (width + 12) + "px;" + // (+ 12 accounts for close button)
                "height:12px;'>" +
                "<a href='javascript:void($(\"" +
                id +
                "\").btOff());'><img src='libs/jquery/bt/close.gif' alt='close' width='12' height='12' class='gmap-close' /></a> " +
                "</div>" +
                "<div style='" +
                "width:" + (width + 12) + "px;" + // (+ 12 accounts for close button)
                "height:" + height + "px;" +
                "overflow:auto;'>" +
                description +
                "</div>";

        var bgColor = container.balloonTipLabelStyle.bgColor.getValueDirect();
        var fill = "rgba(" + bgColor.r * 255 + ","
                + bgColor.g * 255 + ","
                + bgColor.b * 255 + ","
                + bgColor.a * 255 + ")";

        $(id).bt(description, {trigger: 'click',
            width: width + 12 + "px", // (+ 12 accounts for close button)
            height: height + 12 + "px", // (+ 12 accounts for close button)
            shrinkToFit: ((width == 0 && height == 0) ? true : false),
            centerPointX: .9,
            spikeLength: container.balloonTipLabelStyle.balloonOffset.getValueDirect(),
            spikeGirth: 30,
            padding: 15,
            cornerRadius: 25,
            fill: fill,
            strokeStyle: '#ABABAB',
            strokeWidth: 1,
            shadow: true,
            shadowOffsetX: 3,
            shadowOffsetY: 3,
            shadowBlur: 8,
            shadowColor: 'rgba(0,0,0,.9)',
            shadowOverlap: false,
            noShadowOpts: {strokeStyle: '#999', strokeWidth: 2}});
    }
    else
    {
        var id = '#' + container.iconId;
        $(id).bt("", {trigger: 'click'});
    }
}

function Label_LabelStyleBackgroundColorModifiedCB(attribute, container)
{
    var color = attribute.getValueDirect();
    color.a *= attribute.getContainer().getAttribute("backgroundOpacity").getValueDirect();
    container.htmlLabel.style.backgroundColor = "rgba(" + color.r * 255 + ","
            + color.g * 255 + ","
            + color.b * 255 + ","
            + color.a + ")";
}

function Label_LabelStyleBackgroundOpacityModifiedCB(attribute, container)
{
    Label_LabelStyleBackgroundColorModifiedCB(container.labelStyle.backgroundColor, container);
}

function Label_LabelStyleFontBorderModifiedCB(attribute, container)
{
    container.labelStyleFontBorderModified();
}

function Label_LabelStyleFontStyleColorModifiedCB(attribute, container)
{
    var color = attribute.getValueDirect();
    color.a *= attribute.getContainer().getAttribute("opacity").getValueDirect();
    container.htmlLabel.style.color = "rgba(" + color.r * 255 + ","
            + color.g * 255 + ","
            + color.b * 255 + ","
            + color.a + ")";
}

function Label_LabelStyleFontStyleFontModifiedCB(attribute, container)
{
    container.htmlLabel.style.fontFamily = attribute.getValueDirect().join("");
}

function Label_LabelStyleFontStyleOpacityModifiedCB(attribute, container)
{
    Label_LabelStyleFontStyleColorModifiedCB(container.labelStyle.fontStyle.color, container);
    Label_LabelStyleFontBorderModifiedCB(null, container);
}

function Label_LabelStyleFontStyleSizeModifiedCB(attribute, container)
{
    container.htmlLabel.style.fontSize = attribute.getValueDirect() + "pt";
}

function Label_LabelStyleFontStyleStyleModifiedCB(attribute, container)
{
    switch (attribute.getValueDirect().join(""))
    {
        case "Bold":
            container.htmlLabel.style.fontWeight = "bold";
            break;

        case "Heavy":
            container.htmlLabel.style.fontWeight = "bolder";
            break;

        case "Normal":
            container.htmlLabel.style.fontWeight = "normal";
            break;

        case "Thin":
            container.htmlLabel.style.fontWeight = "lighter";
            break;
    }
}

function Label_LabelStyleFormatModifiedCB(attribute, container)
{
    var format = attribute.getValueDirect().join("");
    //container.htmlLabel.style.setProperty("textAlign", format, "normal");
    // TODO
}

function Label_LabelStylePaddingModifiedCB(attribute, container)
{
    var padding = attribute.getValueDirect() + "px";
    container.htmlLabel.style.paddingLeft = padding;
    container.htmlLabel.style.paddingRight = padding;
    container.htmlLabel.style.paddingTop = padding;
    container.htmlLabel.style.paddingBottom = padding;
}

function Label_IconStyleUrlModifiedCB(attribute, container)
{
    var url = attribute.getValueDirect().join("");
    switch (url)
    {
        case "":
            //container.htmlIconImg.src = null;
            break;

        default:
            container.htmlIconImg.src = document.location.href + "/../BwContent/" + url;
            break;
    }
}

function Label_BalloonTipLabelStyleModifiedCB(attribute, container)
{
    Label_DescriptionModifiedCB(container.description, container);
}
BalloonTipLabel.prototype = new RasterComponent();
BalloonTipLabel.prototype.constructor = BalloonTipLabel;

function BalloonTipLabel()
{
    RasterComponent.call(this);
    this.className = "BallonTipLabel";
    this.attrType = eAttrType.BalloonTipLabel;
    
    this.qtip = null;
    this.qtip_api = null;
    
    this.labelRect = new Rect(0, 0, 0, 0);
    
    this.balloonTipLabelStyle = new BalloonTipLabelStyleAttr();
    this.labelWidth = new NumberAttr(0);
    this.labelHeight = new NumberAttr(0);
    
    this.balloonTipLabelStyle.bgColor.addModifiedCB(BalloonTipLabel_balloonTipLabelStyleBgColorModifiedCB, this);
    this.balloonTipLabelStyle.htmlLabelStyle.addModifiedCB(BalloonTipLabel_BalloonTipLabelStyleHTMLLabelStyleModifiedCB, this);
    this.balloonTipLabelStyle.displayMode.addModifiedCB(BalloonTipLabel_balloonTipLabelStyleDisplayModeModifiedCB, this);
    this.show.addModifiedCB(BalloonTipLabel_showModifiedCB, this);
    this.renderSequenceSlot.addModifiedCB(BalloonTipLabel_renderSequenceSlotModifiedCB, this);

    this.registerAttribute(this.balloonTipLabelStyle, "balloonTipLabelStyle");
    this.registerAttribute(this.labelWidth, "labelWidth");
    this.registerAttribute(this.labelHeight, "labelHeight");
    
    this.styles.registerStyle(this.balloonTipLabelStyle, "balloonTipLabelStyle");
}

BalloonTipLabel.prototype.setGraphMgr = function(graphMgr)
{
    // call base-class implementation
    RasterComponent.prototype.setGraphMgr.call(this, graphMgr);
    
    // create id
    this.id = "BalloonTipLabel" + this.graphMgr.getNextBalloonTipLabelIndex();
    
    // create html components for canvas overlay
    var htmlBalloonTipLabel = CreateHTMLBalloonTipLabel(this.id);
    this.htmlBalloonTipLabel = htmlBalloonTipLabel.label;
    this.qtip = htmlBalloonTipLabel.qtip;
    
    // get qtip api 
    this.qtip_api = $('a[id=' + this.id + ']').qtip("api");
}

BalloonTipLabel.prototype.update = function(params, visitChildren)
{
    if (params.userData)
    {
        var updateParams = params.userData;
        if (this.show.getValueDirect())// && (this.updateLabel || isRenderStateModified(updateParams.viewport)))
        {
            this.updateLabel = false;

            //updateLabel(updateParams.viewport);
        }
    }

    // call base-class implementation
    RasterComponent.prototype.update.call(this, params, visitChildren);
}

BalloonTipLabel.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled_)
    {
        // call base-class implementation
        RasterComponent.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    
    switch (directive)
    {
    case "render":
        {
            this.draw(params.viewport);
        }
        break;
    }
    
    // call base-class implementation
    RasterComponent.prototype.apply.call(this, directive, params, visitChildren);
}

BalloonTipLabel.prototype.updateLabel = function(viewport)
{
}

BalloonTipLabel.prototype.updateLabelDimensions = function(viewport)
{
}

BalloonTipLabel.prototype.updateShowStates = function()
{
}

BalloonTipLabel.prototype.draw = function()
{
    if (!(this.show.getValueDirect()))
    {
        if (this.graphMgr.getCurrentBalloonTipLabel() == this)
        {
            this.graphMgr.setCurrentBalloonTipLabel(null);
        }
        return;
    }
    /*
     // only allow one balloon tip to display at a time (per Ted)
     BalloonTipLabel* currentBTL = this.graphMgr.getCurrentBalloonTipLabel();
     if (currentBTL && currentBTL != this)
     {
     this.show.setValueDirect(false, false);
     return;
     }
     */
    this.graphMgr.setCurrentBalloonTipLabel(this);
    
    var bworks = this.registry.find("Bridgeworks");
    
    // determine the rendering positions
    var positions = this.getRenderingPositions();
    
    var labelWidth = this.htmlBalloonTipLabel.offsetWidth; // * this.htmlLabel.style.zoom;
    var labelHeight = this.htmlBalloonTipLabel.offsetHeight; // * this.htmlLabel.style.zoom;
    
    // update positions if visible
    //if (this.show.getValueDirect())
    {
        this.htmlBalloonTipLabel.style.left = bworks.canvas.offsetLeft + positions.labelX;
        this.htmlBalloonTipLabel.style.top = bworks.canvas.offsetTop + positions.labelY;

        this.labelRect.load(bworks.canvas.offsetLeft + positions.labelX,
                            bworks.canvas.offsetTop + positions.labelY,
                            this.labelRect.left + labelWidth,
                            this.labelRect.top + labelHeight);
        
        if (this.qtip_api)
        {
            this.qtip_api.reposition(null, false); // Reposition without animation
            //this.qtip_api.show();
        }
    }
    //else
    //{
    //    this.labelRect.load(0, 0, 0, 0);
    //}
    
    // update screen rect
    var screenRect = new Rect(0, 0, 0, 0);
    //if (this.show.getValueDirect())
    {
        screenRect.loadRect(this.labelRect);
    }
    this.screenRect.setValueDirect(screenRect);
}

BalloonTipLabel.prototype.getRenderingPositions = function()
{
    // initialize
    var labelX = 0;
    var labelY = 0;
    
    // get screen position
    var screen = this.screenPosition.getValueDirect();
    
    // get anchor position
    var anchor = this.anchor.getValueDirect();
    
    labelX = screen.x + anchor.x;
    labelY = screen.y - anchor.y;
    
    return { labelX: labelX, labelY: labelY };
}

BalloonTipLabel.prototype.eventPerformed = function(event)
{
    if (!(this.show.getValueDirect()))
    {
        return false;
    }

    var selected = this.isSelected(event.x, event.y);

    return selected;
}

BalloonTipLabel.prototype.balloonTipLabelStyleModified = function(update)
{
}

BalloonTipLabel.prototype.balloonTipLabelStyleBgColorModified = function()
{
}

BalloonTipLabel.prototype.balloonTipLabelStyleDisplayModeModified = function(mode)
{
    switch (mode)
    {
        case "default":
        {
            this.show.setValueDirect(true, false);
        }
        break;
        
        case "hide":
        {
            // don't hide if parent has focus
            if (this.motionParent && this.motionParent.getAttribute("hasFocus").getValueDirect() > 0)
            {
                // a bit kludgy for this programmer, but this is nessary to get the "Google Earth"-like behavior [MCB]
                this.hasFocus.setValueDirect(1);
                //DisableInspectionState();
            }
            else
            {
                this.show.setValueDirect(false, false);
            }
        }
        break;
    }
        
    this.setModified();
}

BalloonTipLabel.prototype.balloonTipLabelStyleHtmlLabelStyleModified = function()
{
    // html
    var html = this.balloonTipLabelStyle.htmlLabelStyle.html.getValueDirect().join("");
    
    if (this.qtip_api)
    {
        this.qtip_api.set("content.text", html);
    }
    
    this.setModified();
}

BalloonTipLabel.prototype.renderSequenceSlotModified = function()
{
}

BalloonTipLabel.prototype.showModified = function(show)
{
    if (this.qtip_api)
    {
        if (show)
        {
            this.qtip_api.show();
        }
        else
        {
            this.qtip_api.hide();
        }
    }
}

function CreateHTMLBalloonTipLabel(id)
{
    var newA = null;

    // Needs further refactoring. Currently set in an app Helper
    // because we don't have container scope here to append these elements
    if (bridgeworks.rasterComponents)
    {
        newA = document.createElement("a");
        if (newA)
        {
            newA.setAttribute("id", id);
            //newA.innerHTML = "";
            newA.style.visibility = "hidden";
            newA.style.position = "absolute";

            bridgeworks.rasterComponents.appendChild(newA);
        }
    }

    var id = 'a[id=' + id + ']';
    var qtip = $(id).qtip(
    {
        style:
        {
            classes: 'qtip-bootstrap qtip-rounded qtip-shadow qtip-close'
        },
        content :
        {
            text: '',
            button: true
        },
        //show : true,
        hide:
        {
            event: false
        }
    });
   
    return { label: newA, qtip: qtip };
}

function BalloonTipLabel_balloonTipLabelStyleModifiedCB(attribute, container)
{
    container.balloonTipLabelStyleModified();
}

function BalloonTipLabel_balloonTipLabelStyleBgColorModifiedCB(attribute, container)
{
}

function BalloonTipLabel_balloonTipLabelStyleDisplayModeModifiedCB(attribute, container)
{
    container.balloonTipLabelStyleDisplayModeModified(attribute.getValueDirect().join(""));
}

function BalloonTipLabel_BalloonTipLabelStyleHTMLLabelStyleModifiedCB(attribute, container)
{
    container.balloonTipLabelStyleHtmlLabelStyleModified();
}

function BalloonTipLabel_HTMLLabel_PageDimensionsModifiedCB(attribute, container)
{
}

function BalloonTipLabel_showModifiedCB(attribute, container)
{
    container.showModified(attribute.getValueDirect());
}

function BalloonTipLabel_renderSequenceSlotModifiedCB(attribute, container)
{
}

LineList.prototype = new VertexGeometry();
LineList.prototype.constructor = LineList;

function LineList()
{
    VertexGeometry.call(this);
    this.className = "LineList";
    this.attrType = eAttrType.LineList;
    this.width = 1;
}

LineList.prototype.update = function(params, visitChildren)
{
    if (!this.vertexBuffer)
    {
        this.vertexBuffer = this.graphMgr.renderContext.createVertexBuffer(3);
        this.vertexBuffer.setPrimitiveType(RC_LINES);
    }
    
    // call base-class implementation
    VertexGeometry.prototype.update.call(this, params, visitChildren);
}

LineList.prototype.apply = function(directive, params, visitChildren)
{
    // call base-class impementation
    VertexGeometry.prototype.apply.call(this, directive, params, visitChildren);
}

LineList.prototype.draw = function(dissolve)
{
    // TODO
    
    this.vertexBuffer.draw();
}

LineList.prototype.buildBoundingTree = function()
{
    
}
PointList.prototype = new VertexGeometry();
PointList.prototype.constructor = PointList;

function PointList()
{
    VertexGeometry.call(this);
    this.className = "PointList";
    this.attrType = eAttrType.PointList;
    this.width = 1;
}

PointList.prototype.update = function(params, visitChildren)
{
    if (!this.vertexBuffer)
    {
        this.vertexBuffer = this.graphMgr.renderContext.createVertexBuffer(3);
        this.vertexBuffer.setPrimitiveType(RC_POINTS);
    }
    
    // call base-class implementation
    VertexGeometry.prototype.update.call(this, params, visitChildren);
}

PointList.prototype.apply = function(directive, params, visitChildren)
{
    // call base-class impementation
    VertexGeometry.prototype.apply.call(this, directive, params, visitChildren);
}

PointList.prototype.draw = function(dissolve)
{
    // TODO
    
    this.vertexBuffer.draw();
}

PointList.prototype.buildBoundingTree = function()
{
    
}
/*
======================================================================
range()

Given the value v of a periodic function, returns the equivalent value
v2 in the principal interval [lo, hi].  If i isn't NULL, it receives
the number of wavelengths between v and v2.

   v2 = v - i * (hi - lo)

For example, range( 3 pi, 0, 2 pi, i ) returns pi, with i = 1.
====================================================================== */

function range( v, lo, hi )
{
   var v2, r = hi - lo;

   if ( r == 0.0 ) {
      return { value: lo, i: 0 };
   }

   v2 = v - r * Math.floor(( v - lo ) / r );

   return { value: v2, i: -(Math.floor(( v2 - v ) / r + ( ( v2 > v ) ? 0.5 : -0.5 ))) };
}


/*
======================================================================
hermite()

Calculate the Hermite coefficients.
====================================================================== */

function hermite( t )
{
   var t2, t3;

   t2 = t * t;
   t3 = t * t2;

   var h2 = 3 * t2 - t3 - t3;
   var h1 = 1 - h2;
   var h4 = t3 - t2;
   var h3 = h4 - t2 + t;
   
   return { h1: h1, h2: h2, h3: h3, h4: h4 };
}


/*
======================================================================
bezier()

Interpolate the value of a 1D Bezier curve.
====================================================================== */

function bezier( x0, x1, x2, x3, t )
{
   var a, b, c, t2, t3;

   t2 = t * t;
   t3 = t2 * t;

   c = 3 * ( x1 - x0 );
   b = 3 * ( x2 - x1 ) - c;
   a = x3 - x0 - c - b;

   return a * t3 + b * t2 + c * t + x0;
}


/*
======================================================================
bez2_time()

Find the t for which bezier() returns the input time.  The handle
endpoints of a BEZ2 curve represent the control points, and these have
(time, value) coordinates, so time is used as both a coordinate and a
parameter for this curve type.
====================================================================== */

function bez2_time( x0, x1, x2, x3, time, t0, t1 )
{
   var v, t;

   t = t0 + ( t1 - t0 ) * 0.5;
   v = bezier( x0, x1, x2, x3, t );
   if ( Math.abs( time - v ) > .0001 ) {
      if ( v > time )
         t1 = t;
      else
         t0 = t;
      return bez2_time( x0, x1, x2, x3, time, t0, t1 );
   }
   else
      return t;
}


/*
======================================================================
bez2()

Interpolate the value of a BEZ2 curve.
====================================================================== */

function bez2( key0, key1, time )
{
   var x, y, t, t0 = 0, t1 = 1;

   if ( key0.getShape() == eKeyframeShape_Bezier2D )
      x = key0.getTime() + key0.getParams(2);
   else
      x = key0.getTime() + ( key1.getTime() - key0.getTime() ) / 3;

   t = bez2_time( key0.getTime(), x, key1.getTime() + key1.getParams(0), key1.getTime(),
      time, t0, t1 );

   if ( key0.getShape() == eKeyframeShape_Bezier2D )
      y = key0.getValue() + key0.getParams(3);
   else
      y = key0.getValue() + key0.getParams(1) / 3;

   return bezier( key0.getValue(), y, key1.getParams(1) + key1.getValue(), key1.getValue(), t );
}


/*
======================================================================
outgoing()

Return the outgoing tangent to the curve at key0.  The value returned
for the BEZ2 case is used when extrapolating a linear pre behavior and
when interpolating a non-BEZ2 span.
====================================================================== */

function outgoing( keys, key0, key1, first )
{
   var a, b, d, t, out;

   switch ( key0.getShape() )
   {
      case eKeyframeShape.TCB:
         a = ( 1 - key0.getParams(0) )
           * ( 1 + key0.getParams(1) )
           * ( 1 + key0.getParams(2) );
         b = ( 1 - key0.getParams(0) )
           * ( 1 - key0.getParams(1) )
           * ( 1 - key0.getParams(2) );
         d = key1.getValue() - key0.getValue();

         if ( key0 != first ) {
            t = ( key1.getTime() - key0.getTime() ) / ( key1.getTime() - (keys.prev(key0)).getTime() );
            out = t * ( a * ( key0.getValue() - (keys.prev(key0)).getValue() ) + b * d );
         }
         else
            out = b * d;
         break;

      case eKeyframeShape.Linear:
         d = key1.getValue() - key0.getValue();
         if ( key0 != first ) {
            t = ( key1.getTime() - key0.getTime() ) / ( key1.getTime() - (keys.prev(key0)).getTime() );
            out = t * ( key0.getValue() - (keys.prev(key0)).getValue() + d );
         }
         else
            out = d;
         break;

      case eKeyframeShape.Bezier1D:
         out = key0.getParams(1);
         if ( key0 != first )
            out *= ( key1.getTime() - key0.getTime() ) / ( key1.getTime() - (keys.prev(key0)).getTime() );
         break;

      case eKeyframeShape.Bezier2D:
         out = key0.getParams(3) * ( key1.getTime() - key0.getTime() );
         if ( Math.abs( key0.getParams(2) ) > 1e-5 )
            out /= key0.getParams(2);
         else
            out *= 1e5;
         break;

      case eKeyframeShape.Stepped:
      default:
         out = 0;
         break;
   }

   return out;
}


/*
======================================================================
incoming()

Return the incoming tangent to the curve at key1.  The value returned
for the BEZ2 case is used when extrapolating a linear post behavior.
====================================================================== */

function incoming( keys, key0, key1, last )
{
   var a, b, d, t, _in;

   switch ( key1.getShape() )
   {
      case eKeyframeShape.Linear:
         d = key1.getValue() - key0.getValue();
         if ( key1 != last ) {
            t = ( key1.getTime() - key0.getTime() ) / ( (keys.next(key1)).getTime() - key0.getTime() );
            _in = t * ( (keys.next(key1)).getValue() - key1.getValue() + d );
         }
         else
            _in = d;
         break;

      case eKeyframeShape.TCB:
         a = ( 1 - key1.getParams(0) )
           * ( 1 - key1.getParams(1) )
           * ( 1 + key1.getParams(2) );
         b = ( 1 - key1.getParams(0) )
           * ( 1 + key1.getParams(1) )
           * ( 1 - key1.getParams(2) );
         d = key1.getValue() - key0.getValue();

         if ( key1 != last ) {
            t = ( key1.getTime() - key0.getTime() ) / ( (keys.next(key1)).getTime() - key0.getTime() );
            _in = t * ( b * ( (keys.next(key1)).getValue() - key1.getValue() ) + a * d );
         }
         else
            _in = a * d;
         break;

      case eKeyframeShape.Bezier1D:
         _in = key1.getParams(0);
         if ( key1 != last )
            _in *= ( key1.getTime() - key0.getTime() ) / ( (keys.next(key1)).getTime() - key0.getTime() );
         break;
         return _in;

      case eKeyframeShape.Bezier2D:
         _in = key1.getParams(1) * ( key1.getTime() - key0.getTime() );
         if ( Math.abs( key1.getParams(0) ) > 1e-5 )
            _in /= key1.getParams(0);
         else
            _in *= 1e5;
         break;

      case eKeyframeShape.Stepped:
      default:
         _in = 0;
         break;
   }

   return _in;
}


/*
======================================================================
interpolate()

Given a list of keys and a time number, returns the interpolated 
value at that time.
====================================================================== */

function interpolate(time, keyframes, first, last, preBehavior, postBehavior)
{
    // if no keys, the value is 0
    if (keyframes.length == 0)
    {
        return 0;
    }

    // if only one key, the value is constant
    if (keyframes.length == 1)
    {
        return first.getValue();
    }

    var noff = 0;
    var _in = 0;
    var out = 0;
    var offset = 0;
    var result;

    // use pre-behavior if time is before first key time
    if (time < first.getTime())
    {
        switch (preBehavior)
        {
        case eEndBehavior.Reset:
            return 0;

        case eEndBehavior.Constant:
            return first.getValue();

        case eEndBehavior.Repeat:
            result = range(time, first.getTime(), last.getTime());
            time = result.value;
            break;

        case eEndBehavior.Oscillate:
            result = range(time, first.getTime(), last.getTime());
            time = result.value;
            noff = result.i;
            if (noff % 2)
            {
                time = last.getTime() - first.getTime() - time;
            }
            break;

        case eEndBehavior.OffsetRepeat:
            result = range(time, first.getTime(), last.getTime());
            time = result.value;
            noff = result.i;
            offset = noff * (last.getValue() - first.getValue());
            break;

        case eEndBehavior.Linear:
            out = outgoing(keyframes, first, keyframes.next(first), first) / ((keyframes.next(first)).getTime() - first.getTime());
            return out * (time - first.getTime()) + first.getValue();
        }
    }
    // use post-behavior if time is after last key time
    else if (time > last.getTime())
    {
        switch (postBehavior)
        {
        case eEndBehavior.Reset:
            return 0;

        case eEndBehavior.Constant:
            return last.getValue();

        case eEndBehavior.Repeat:
            result = range(time, first.getTime(), last.getTime());
            time = result.value;
            break;

        case eEndBehavior.Oscillate:
            result = range(time, first.getTime(), last.getTime());
            time = result.value;
            noff = result.i;
            if (noff % 2)
            {
                time = last.getTime() - first.getTime() - time;
            }
            break;

        case eEndBehavior.OffsetRepeat:
            result = range(time, first.getTime(), last.getTime());
            time = result.value;
            noff = result.i;
            offset = noff * (last.getValue() - first.getValue());
            break;

        case eEndBehavior.Linear:
            _in = incoming(keyframes, keyframes.prev(last), last, last) / (last.getTime() - (keyframes.prev(last)).getTime());
            return _in * (time - last.getTime()) + last.getValue();
        }
    }

    // get the endpoints of the interval being evaluated 
    var key0 = first;
    while (keyframes.next(key0) && 
           time > (keyframes.next(key0)).getTime())
    {
        key0 = keyframes.next(key0);
    }
    var key1 = keyframes.next(key0);

    // check for singularities first 
    if (time == (key0).getTime())
    {
       return (key0).getValue() + offset;
    }
    else if (time == (key1).getTime())
    {
       return (key1).getValue() + offset;
    }

    // get interval length, time in [0, 1] 
    var t = (time - (key0).getTime()) / ((key1).getTime() - (key0).getTime());

    // interpolate 
    switch ((key1).getShape())
    {
    case eKeyframeShape.TCB:
    case eKeyframeShape.Bezier1D:
        {
            out = outgoing(keyframes, key0, key1, first);
            _in = incoming(keyframes, key0, key1, last);
            var result = hermite(t);
            return result.h1 * (key0).getValue() + result.h2 * (key1).getValue() + result.h3 * out + result.h4 * _in + offset;
        }

    case eKeyframeShape.Bezier2D:
        return bez2(key0, key1, time) + offset;

    case eKeyframeShape.Linear:
        return (key0).getValue() + t * ((key1).getValue() - (key0).getValue()) + offset;

    case eKeyframeShape.Stepped:
        return (key0).getValue() + offset;

    default:
        return 0;
    }

}
function StateRec()
{
    this.material = null;
    this.renderStateRec = null;
    this.cullBackFace = false;
    this.textures = null;
    this.projectionTextures = null;
    this.globalIllumination = new Color();
}

function GetCurrentState(graphMgr)
{
    var rec = new StateRec();
	
    rec.material = graphMgr.getCurrentMaterial();
    rec.renderStateRec = graphMgr.renderState.getState(RENDERSTATE_ALL_BITS);
    rec.cullBackFace = graphMgr.renderContext.enabled(eRenderMode.CullBackFace);
    rec.textures = graphMgr.textureArrayStack.top();
    rec.projectionTextures = graphMgr.projectionTextureArrayStack.top();
    rec.globalIllumination.copy(graphMgr.renderContext.getGlobalIllumination());
    
    return rec;
}

function SetCurrentState(graphMgr, stateRec)
{
    graphMgr.setCurrentMaterial(stateRec.material);
    graphMgr.renderState.setState(RENDERSTATE_ALL_BITS, stateRec.renderStateRec);
    if (stateRec.cullBackFace)
    {
        graphMgr.renderContext.enable(eRenderMode.CullBackFace);
    }
    else
    {
        graphMgr.renderContext.disable(eRenderMode.CullBackFace);
    }
    graphMgr.textureArrayStack.load(stateRec.textures);
    graphMgr.projectionTextureArrayStack.load(stateRec.projectionTextures);
    graphMgr.renderContext.setGlobalIllumination(stateRec.globalIllumination);
}
function DistanceSortRec(distance,
                         geometry,
                         dissolve)
{
    this.distance = distance || 0;
    this.geometry = geometry || null;
    this.dissolve = dissolve || 0;
    this.stateRec = null;
}

DistanceSortAgent.prototype = new Agent();
DistanceSortAgent.prototype.constructor = DistanceSortAgent;

function DistanceSortAgent()
{
    Agent.call(this);
    this.className = "DistanceSortAgent";

    this.graphMgr = null;
    this.sortRecs = [];
}

DistanceSortAgent.prototype.setGraphMgr = function(graphMgr)
{
    this.graphMgr = graphMgr;
}

DistanceSortAgent.prototype.isEmpty = function()
{
    return this.sortRecs.length == 0;
}

DistanceSortAgent.prototype.addGeometry = function(geometry, min, max, dissolve)
{
    var rec = new DistanceSortRec();

    rec.geometry = geometry;
    rec.dissolve = dissolve;
    rec.stateRec = GetCurrentState(this.graphMgr);

    // calculate distance from camera
    var worldViewMatrix = new Matrix4x4();
    worldViewMatrix.loadMatrix(this.graphMgr.renderContext.worldMatrixStack.top());

    // initialize
    rec.distance = FLT_MAX;

    // take smallest z of worldView-transformed endpoints of the geometry's bbox as distance from camera
    var p;
    for (var i = 0; i < 8; i++)
    {
        switch (i)
        {
            case 0: p = new Vector3D(max.x, max.y, max.z); break;
            case 1: p = new Vector3D(max.x, max.y, min.z); break;
            case 2: p = new Vector3D(max.x, min.y, max.z); break;
            case 3: p = new Vector3D(max.x, min.y, min.z); break;
            case 4: p = new Vector3D(min.x, max.y, max.z); break;
            case 5: p = new Vector3D(min.x, max.y, min.z); break;
            case 6: p = new Vector3D(min.x, min.y, max.z); break;
            case 7: p = new Vector3D(min.x, min.y, min.z); break;
        }

        p = worldViewMatrix.transform(p.x, p.y, p.z, 1);

        rec.distance = Math.min(p.z, rec.distance);
    }

    // add to list
    this.sortRecs.push(rec);
    
}

DistanceSortAgent.prototype.clear = function()
{
    this.sortRecs.length = 0;
}

DistanceSortAgent.prototype.sort = function()
{
    this.sortRecs.sort(DistanceSortAgent_CompareSortRecs);
}

DistanceSortAgent.prototype.draw = function()
{
    if (this.sortRecs.length == 0)
    {
        return;
    }

    // push state
    var saveState = GetCurrentState(this.graphMgr);

    // disable writing to the depth buffer
    // technique described in the OpenGL Programming Guide, 2nd edition, pp. 222-223
    //this.graphMgr.renderContext.disable(eRenderMode.DepthBufferWrite);

    for (var i = 0; i < this.sortRecs.length; i++)
    {
        // set state according to sort rec
        SetCurrentState(this.graphMgr, this.sortRecs[i].stateRec);

        // draw
        this.sortRecs[i].geometry.draw(this.sortRecs[i].dissolve);

        // pop clip plane state
        // NOTE: D3D is having issues with clip plane states when more than 1 sort rec was present
        this.graphMgr.renderState.setState(RENDERSTATE_CLIP_PLANE_BIT, saveState.renderStateRec);
    }

    // restore depth buffer write state
    this.graphMgr.renderContext.enable(eRenderMode.DepthBufferWrite);

    // pop state
    SetCurrentState(this.graphMgr, saveState);
}

function DistanceSortAgent_CompareSortRecs(rec1, rec2)
{
    return rec2.distance - rec1.distance;
}
/// <b>Approximate</b> radius of Earth at the equator (in Km).
/// For a more precise value, use either the Ellipsoid corresponding to a
/// particular datum or calculate the radius for a given latitude using
/// Synder's Formula
/// @see
var EARTH_RADIUS_KM_EQ = 6378;

/// <b>Approximate</b> radius of Earth at the poles (in Km).
var EARTH_RADIUS_KM_P = 6377;

/// Maximum width of a UTM zone (taken to be at equator)
var UTM_ZONE_WIDTH_KM = 667.956; 

// EqualArc projection - Metric
var EQ_ARC_WIDTH_KM       = 40075.16;	// Earth circumference at Equator
var EQ_ARC_HEIGHT_KM      = 40008.0;    // Earth circumference from pole to pole
var EQ_ARC_ONE_DEG_LAT_KM = EQ_ARC_HEIGHT_KM / 360;
var EQ_ARC_ONE_DEG_LON_KM = EQ_ARC_WIDTH_KM / 360;

// EqualArc projection - English
var EQ_ARC_WIDTH_MI       = 24902.0;
var EQ_ARC_HEIGHT_MI      = 24900.0;
var EQ_ARC_ONE_DEG_LAT_MI = EQ_ARC_HEIGHT_MI / 360;
var EQ_ARC_ONE_DEG_LON_MI = EQ_ARC_WIDTH_MI / 360;

MapProjectionCalculator.prototype = new Evaluator();
MapProjectionCalculator.prototype.constructor = MapProjectionCalculator;

function MapProjectionCalculator()
{
    Evaluator.call(this);
    this.className = "MapProjectionCalculator";
    this.attrType = eAttrType.MapProjectionCalculator;

    this.unitsMultiplier = 1;
    this.positionCalculators = [];
    this.geoPositionCalculators = [];
    
    this.mapProjection = new StringAttr("equalArc");
    this.elevationModel = new StringAttr();
    this.center2D = new Vector2DAttr(0, 0);
    this.units = new StringAttr("kilometers");
    this.geoPosition = new Vector3DAttr(0, 0, 0);
    this.pointWorld = new Vector3DAttr();
    this.resultPosition = new Vector3DAttr();
    this.resultGeoPosition = new Vector3DAttr();

    this.units.addModifiedCB(MapProjectionCalculator_UnitsModifiedCB, this);
    this.pointWorld.addModifiedCB(MapProjectionCalculator_PointWorldModifiedCB, this);
    
    this.registerAttribute(this.mapProjection, "mapProjection");
    this.registerAttribute(this.elevationModel, "elevationModel");
    this.registerAttribute(this.center2D, "center2d");
    this.registerAttribute(this.units, "units");
    this.registerAttribute(this.geoPosition, "geoPosition");
    this.registerAttribute(this.geoPosition, "position"); // backward-compatibility
    this.registerAttribute(this.pointWorld, "pointWorld");
    this.registerAttribute(this.resultPosition, "resultPosition");
    this.registerAttribute(this.resultGeoPosition, "resultGeoPosition");
    this.registerAttribute(this.resultGeoPosition, "resultGeoLocation"); // backward-compatibility

    this.positionCalculators["equalArc"] = ComputeEqualArc3DPosition;
    this.geoPositionCalculators["equalArc"] = ComputeEqualArcGeoPosition;

    this.units.setValueDirect("meters"); // invoke modified cb
}

MapProjectionCalculator.prototype.evaluate = function()
{
    var geoPosition = this.geoPosition.getValueDirect();

    var resultPosition = this.computePosition(geoPosition.x, geoPosition.y, geoPosition.z);
    this.resultPosition.setValueDirect(resultPosition.x, resultPosition.y, resultPosition.z);

    var resultGeoPosition = this.computeGeoPosition(resultPosition.x, resultPosition.y, resultPosition.z);
    this.resultGeoPosition.setValueDirect(resultGeoPosition.x, resultGeoPosition.y, resultGeoPosition.z);
}

MapProjectionCalculator.prototype.computePosition = function(lon, alt, lat)
{
    var position = undefined;
    
    var mapProjection = this.mapProjection.getValueDirect().join("");
    var computeFunc = this.positionCalculators[mapProjection];
    if (computeFunc)
    {
        var center2D = this.center2D.getValueDirect();
        position = computeFunc(lon, alt, lat, center2D.x, center2D.y, this.unitsMultiplier);
    }

    return position;
}

MapProjectionCalculator.prototype.computeGeoPosition = function(x, y, z)
{
    var geoPosition = undefined;

    var mapProjection = this.mapProjection.getValueDirect().join("");
    var computeFunc = this.geoPositionCalculators[mapProjection];
    if (computeFunc)
    {
        var center2D = this.center2D.getValueDirect();
        geoPosition = computeFunc(x, y, z, center2D.x, center2D.y, this.unitsMultiplier);
    }

    return geoPosition;
}

function MapProjectionCalculator_UnitsModifiedCB(attribute, container)
{
    switch (attribute.getValueDirect().join(""))
    {
        case "kilometers":
            {
                container.unitsMultiplier = 1;
            }
            break;

        case "meters":
            {
                container.unitsMultiplier = 1000;
            }
            break;
    }
}

function MapProjectionCalculator_PointWorldModifiedCB(attribute, container)
{
    // TODO
}

function ComputeEqualArc3DPosition(lon, alt, lat, centerLon, centerLat, units)
{
    if (lat > 90  || lat < -90 ||
		lon > 180 || lon < -180)
	{
		return undefined;
	}
	
	var x = (lon - centerLon) * EQ_ARC_ONE_DEG_LON_KM * units;
	var y = alt;
	var z = (lat - centerLat) * EQ_ARC_ONE_DEG_LAT_KM * units;

	return { x: x, y: y, z: z }
}

function ComputeEqualArcGeoPosition(x, y, z, centerLon, centerLat, units)
{
	var lon = (x / units / EQ_ARC_ONE_DEG_LON_KM) + centerLon;
	var alt = y;
	var lat = (z / units / EQ_ARC_ONE_DEG_LAT_KM) + centerLat;   
    
    return { lon: lon, alt: alt, lat: lat }
}
NullObject.prototype = new ParentableMotionElement();
NullObject.prototype.constructor = NullObject;

function NullObject()
{
    ParentableMotionElement.call(this);
    this.className = "NullObject";
    this.attrType = eAttrType.NullObject;
}
Transform.prototype = new SGNode();
Transform.prototype.constructor = Transform;

/**
 * Defines a generic matrix transformation.
 *
 * @see GcSGNode
 */
function Transform()
{
    SGNode.call(this);
    this.className = "Transform";
    this.attrType = eAttrType.Transform;
    
    this.matrix = new Matrix4x4Attr
       (1, 0, 0, 0,
        0, 1, 0, 0,
        0, 0, 1, 0,
        0, 0, 0, 1);
        
    this.matrixTransform = this.matrix.getValueDirect();
    this.updateMatrix = true;

    this.matrix.addModifiedCB(Transform_MatrixModifiedCB, this);

    this.registerAttribute(this.matrix, "matrix");
}

Transform.prototype.clone = function(src)
{
    this.matrix = src.matrix.clone();
    this.updateMatrix = src.updateMatrix;
}

Transform.prototype.update = function(params, visitChildren)
{
    if (this.updateMatrix)
    {
        this.updateMatrix = false;

        this.matrixTransform = this.matrix.getValueDirect();
    }
    
    // call base-class implementation
    SGNode.prototype.update.call(this, params, visitChildren);
}

Transform.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled.getValueDirect())
    {
        // call base class implementation
        SGNode.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    
    //params.worldMatrix = params.worldMatrix.leftMultiply(this.matrixTransform);
            
    switch (directive)
    {
        case "render":
        case "shadow":
        {
            params.worldMatrix = this.matrixTransform.multiply(params.worldMatrix);
            this.applyTransform();
        }
        break;
         
        case "rayPick":
        case "bbox":
        case "collide":
        {
            params.worldMatrix = this.matrixTransform.multiply(params.worldMatrix);
        }
        break;
        
        case "highlight":
        {
            params.worldMatrix = this.matrixTransform.multiply(params.worldMatrix);
            
            // apply to last target as well (covers object-inspection)
            if (params.targets.length > 0)
            {
                params.targets[params.targets.length-1].worldMatrix = 
                    this.matrixTransform.multiply(params.targets[params.targets.length-1].worldMatrix);
            }
        }
        break;
        
        default:
            break;
    }

    // call base class implementation
    SGNode.prototype.apply.call(this, directive, params, visitChildren);
}

Transform.prototype.applyTransform = function()
{
    // set transformation matrix
    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
    this.graphMgr.renderContext.leftMultMatrix(this.matrixTransform);
    this.graphMgr.renderContext.applyWorldTransform();
}

function Transform_MatrixModifiedCB(attribute, container)
{
    container.updateMatrix = true;
    container.setModified();
}


QuaternionRotate.prototype = new Transform();
QuaternionRotate.prototype.constructor = QuaternionRotate;

function QuaternionRotate()
{
    Transform.call(this);
    this.className = "QuaternionRotate";
    this.attrType = eAttrType.QuaternionRotate;

    this.rotationQuat = new QuaternionAttr(1, 0, 0, 0);
    this.rotation = new Vector3DAttr(0, 0, 0);
    this.updateRotationQuat = true;

    this.rotationQuat.addModifiedCB(QuaternionRotate_RotationQuatModifiedCB, this);

    this.registerAttribute(this.rotationQuat, "rotationQuat");
    this.registerAttribute(this.rotation, "rotation");
}

QuaternionRotate.prototype.update = function(params, visitChildren)
{
    if (this.updateRotationQuat)
    {
        this.updateRotationQuat = false;

        var q = this.rotationQuat.getValueDirect();

        var matrix = q.getMatrix();
        this.matrix.setValueDirect(matrix);

        var rotation = matrix.getRotationAngles();
        this.rotation.setValueDirect(rotation.x, rotation.y, rotation.z);
        
        //console.debug("QuaternionRotate: rotation " + rotation.x + ", " + 
        //rotation.y + ", " + rotation.z);
    }

    // call base-class implementation
    Transform.prototype.update.call(this, params, visitChildren);
}

QuaternionRotate.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled.getValueDirect())
    {
        // call base-class implementation
        Transform.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    /*
    switch (directive)
    {
        case "render":
        {
        }
        break;
         
        case "rayPick":
        {
            
        }
        break;
        
        case "bbox":
        {
            
        }
        break;
        
        case "collide":
        {
        }
        break;
    }
    */
    // call base-class implementation
    Transform.prototype.apply.call(this, directive, params, visitChildren);
}

function QuaternionRotate_RotationQuatModifiedCB(attribute, container)
{
    container.updateRotationQuat = true;
    container.setModified();
}
Rotate.prototype = new Transform();
Rotate.prototype.constructor = Rotate;

function Rotate()
{
    Transform.call(this);
    this.className = "Rotate";
    this.attrType = eAttrType.Rotate;
    
    this.rotation = new Vector3DAttr(0, 0, 0);
    this.updateRotation = true;
    
    this.rotation.addModifiedCB(Rotate_RotationModifiedCB, this);
	
    this.registerAttribute(this.rotation, "rotation");
}

Rotate.prototype.update = function(params, visitChildren)
{
    if (this.updateRotation)
    {
        this.updateRotation = false;

        var r = this.rotation.getValueDirect();

        var matrix = new Matrix4x4()
        matrix.loadXYZAxisRotation(r.x, r.y, r.z);
        this.matrix.setValueDirect(matrix);
    }

    // call base-class implementation
    Transform.prototype.update.call(this, params, visitChildren);
}

Rotate.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled.getValueDirect())
    {
        // call base-class implementation
        Transform.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    // call base-class implementation
    Transform.prototype.apply.call(this, directive, params, visitChildren);
}

function Rotate_RotationModifiedCB(attribute, container)
{
    container.updateRotation = true;
    container.setModified();
}
Scale.prototype = new Transform();
Scale.prototype.constructor = Scale;

function Scale()
{
    Transform.call(this);
    this.className = "Scale";
    this.attrType = eAttrType.Scale;
    
    this.scale = new Vector3DAttr(1, 1, 1);
    this.updateScale = true;
    
    this.scale.addModifiedCB(Scale_ScaleModifiedCB, this);
	
    this.registerAttribute(this.scale, "scale");
}

Scale.prototype.update = function(params, visitChildren)
{
    if (this.updateScale)
    {
        this.updateScale = false;

        var s = this.scale.getValueDirect();

        var matrix = new Matrix4x4();
        matrix.loadScale(s.x, s.y, s.z);
        this.matrix.setValueDirect(matrix);
    }

    // call base-class implementation
    Transform.prototype.update.call(this, params, visitChildren);
}

Scale.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled.getValueDirect())
    {
        // call base-class implementation
        Transform.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    // call base-class implementation
    Transform.prototype.apply.call(this, directive, params, visitChildren);
}

function Scale_ScaleModifiedCB(attribute, container)
{
    container.updateScale = true;
    container.setModified();
}
Translate.prototype = new Transform();
Translate.prototype.constructor = Translate;

function Translate()
{
    Transform.call(this);
    this.className = "Translate";
    this.attrType = eAttrType.Translate;
    
    this.translation = new Vector3DAttr(0, 0, 0);
    this.updateTranslation = true;
    
    this.translation.addModifiedCB(Translate_TranslationModifiedCB, this);
	
    this.registerAttribute(this.translation, "translation");
}

Translate.prototype.update = function(params, visitChildren)
{
    if (this.updateTranslation)
    {
        this.updateTranslation = false;

        var t = this.translation.getValueDirect();

        var matrix = new Matrix4x4();
        matrix.loadTranslation(t.x, t.y, t.z);
        this.matrix.setValueDirect(matrix);
    }

    // call base-class implementation
    Transform.prototype.update.call(this, params, visitChildren);
}

Translate.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled.getValueDirect())
    {
        // call base-class implementation
        Transform.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    // call base-class implementation
    Transform.prototype.apply.call(this, directive, params, visitChildren);
}

function Translate_TranslationModifiedCB(attribute, container)
{
    container.updateTranslation = true;
    container.setModified();
}
MultiTargetObserver.prototype = new Evaluator();
MultiTargetObserver.prototype.constructor = MultiTargetObserver;

function MultiTargetObserver()
{
    Evaluator.call(this);
    this.className = "MultiTargetObserver";
    this.attrType = eAttrType.MultiTargetObserver;
    
    this.targetPosition = [];
    
    this.targets = new NumberAttr(0);
    this.position = new Vector3DAttr(0, 0, 0);
    this.distanceFromFirstTarget = new NumberAttr(0);
	this.affectPitch = new BooleanAttr(true);
	this.affectHeading = new BooleanAttr(true);
	this.resultPosition = new Vector3DAttr(0, 0, 0);
    this.resultPitch = new NumberAttr(0);
    this.resultHeading = new NumberAttr(0);

    this.registerAttribute(this.targets, "targets");
    this.registerAttribute(this.position, "position");
    this.registerAttribute(this.distanceFromFirstTarget, "distanceFromFirstTarget");
	this.registerAttribute(this.affectPitch, "affectPitch");
	this.registerAttribute(this.affectHeading, "affectHeading");
    this.registerAttribute(this.resultPosition, "resultPosition");
    this.registerAttribute(this.resultPitch, "resultPitch");
    this.registerAttribute(this.resultHeading, "resultHeading");
}

MultiTargetObserver.prototype.setNumberOfTargets = function(targets)
{
	// if targets are already registered, then unregister them
    var oldTargets = this.targets.getValueDirect();
	if (oldTargets > 0)
	{
		for (var i=0; i < oldTargets; i++)
        {
            this.unregisterAttribute(this.targetPosition[i]);
        }
	}

    this.targets.setValueDirect(targets);

    // allocate dynamic inputs
    if (targets > 0)
    {
        this.targetPosition.length = targets;
        
        for (var i=0; i < targets; i++)
        {
        	this.targetPosition[i] = new Vector3DAttr(0, 0, 0);
			this.registerAttribute(this.targetPosition[i], "targetPosition" + i);
        }
    }
}

MultiTargetObserver.prototype.evaluate = function()
{
    if (!(this.enabled.getValueDirect()))
	{
		return;
	}

    // if no targets, nothing to do
    if (this.targets.getValueDirect() == 0)
    {
        return;
    }

    // get input values

    // get observer and target positions
    var observerAndTarget = this.getObserverAndTargetPositions();
    var observer = observerAndTarget.observer;
    var target = observerAndTarget.target;

    // calculate target direction vector (vector from observer position to target position)
    var targetDirection = new Vector3D(target.x - observer.x,
                               		   target.y - observer.y,
                               		   target.z - observer.z);

    // get heading and pitch angles from target direction vector
    var targetDirHeading, targetDirPitch;
    var hp = XYZtoHP(targetDirection.x, targetDirection.y, targetDirection.z);
    var targetDirHeading = hp.heading;
    var targetDirPitch = hp.pitch;

    var pitch = 0;
	if (this.affectPitch.getValueDirect() == true)
	{
		pitch = -toDegrees(targetDirPitch);
	}

    var heading = 0;
	if (this.affectHeading.getValueDirect() == true)
	{
		heading = -toDegrees(targetDirHeading);
	}

    // output result
    var values = [observer.x, observer.y, observer.z];
    this.resultPosition.setValue(values);

    if (this.affectPitch.getValueDirect() == true)
    {
    	this.resultPitch.setValueDirect(pitch);
    }

    if (this.affectHeading.getValueDirect() == true)
    {
        this.resultHeading.setValueDirect(heading);
    }
}

MultiTargetObserver.prototype.getObserverAndTargetPositions = function()
{
	var observer, target;
	
    switch (this.targets.getValueDirect())
    {
    case 0:
        {
            observer = new Vector3D(0, 0, 0);
            target = new Vector3D(0, 0, 0);
        }
        break;

    case 1:
        {
            observer = this.position.getValueDirect();
            target = this.targetPosition[0].getValueDirect();
        }
        break;

    case 2:
        {
            var target1 = this.targetPosition[0].getValueDirect();
            var target2 = this.targetPosition[1].getValueDirect();

            var distance = this.distanceFromFirstTarget.getValueDirect();

            // get line direction from target2 to target1
            var lineDir = Normalize(target1 - target2);

            // calculate observer's position as target1's position + lineDir scaled by distance
            observer = lineDir * distance + target1;

            // if distance is 0, observer's position will equal target1's position,
            // so use target1 - lineDir as target's position
            if (distance == 0)
            {
                target = target1 - lineDir;
            }
            else
            {
                target = target1;
            }
        }
        break;

    default: // > 2 targets (currently unsupported)
        {
            observer = new Vector3D(0, 0, 0);
            target = Vector3D(0, 0, 0);
        }
        break;
    }
    
    return { observer: observer, target: target };
}
SerializeParams.prototype = new DirectiveParams();
SerializeParams.prototype.constructor = SerializeParams();

function SerializeParams()
{
    DirectiveParams.call(this);
    
    this.serialized = null;
}

SerializeDirective.prototype = new SGDirective();
SerializeDirective.prototype.constructor = SerializeDirective;

function SerializeDirective()
{
    SGDirective.call(this);
    
    this.className = "SerializeDirective";
    this.attrType = eAttrType.SerializeDirective;

    this.serialized = null;
}

SerializeDirective.prototype.execute = function(root)
{
    if (!root)
    {
		return;
	}

    // clear serialize string
    this.serialized = null;

    // setup serialize params structure
    var params = new SerializeParams();
    params.serialized = new String();

    // apply serialize directive
    root.apply("serialize", params, true);

	this.serialized = params.serialized;

    return;
}


var MIN_COLLIDE_DISTANCE = 0.01;
var MAX_SEE_AHEAD = 2;

CollideParams.prototype = new DirectiveParams();
CollideParams.prototype.constructor = CollideParams();

function CollideParams()
{
    DirectiveParams.call(this);

    this.viewSpace = false;
    this.viewMatrix = new Matrix4x4();
    this.worldMatrix = new Matrix4x4();
    this.detectCollisions = new Array();
}

function CollideRec(model, tree, worldMatrix)
{
    this.model = model;
    this.tree = tree;
    this.worldMatrix = new Matrix4x4();
    this.worldMatrix.loadMatrix(worldMatrix);
}

CollideDirective.prototype = new SGDirective();
CollideDirective.prototype.constructor = CollideDirective;

function CollideDirective()
{
    SGDirective.call(this);
    this.className = "CollideDirective";
    this.attrType = eAttrType.CollideDirective;
    
    this.lastDetected = null;
    this.lastColliding = false;
    this.lastCollidingDistance = FLT_MAX;
    this.selector = null;
    
    this.name.setValueDirect("CollideDirective");
}

CollideDirective.prototype.setRegistry = function(registry)
{
    // use Bridgeworks' physics simulator for collision detection
    var bworks = registry.find("Bridgeworks");
    this.physicsSimulator = bworks.physicsSimulator;
    this.selector = bworks.selector;
    
    // call base-class implementation
    SGDirective.prototype.setRegistry.call(this, registry);
}

CollideDirective.prototype.execute = function(root)
{
    root = root || this.rootNode.getValueDirect();

    // setup collision Detect params structure
    var params = new CollideParams();

    // get list of models for collision detection
    root.apply("collide", params, true);
    
    // detect collisions
    //this.detectCollisions(params.detectCollisions);

    // detect obstructions
    this.detectObstructions(params.detectCollisions);

    // detect snap-to connections
    this.detectSnapConnections(params.detectCollisions);
}

CollideDirective.prototype.detectCollisions = function(collideRecs)
{
    if (!this.physicsSimulator) return;
        
    // reset model's collision attributes; get selected model
    var selected = null;
    for (var i in collideRecs)
    {
        var model = collideRecs[i].model;

        model.getAttribute("collisionDetected").setValueDirect(false);
        model.getAttribute("collisionList").clear();

        if (this.isSelected(model))
        {
            selected = model;
        }
    } 
    
    // currently only detecting collisions on selected model, but still need to evaluate physics simulator
    if (!selected)
    {
        this.physicsSimulator.evaluate();
        this.lastDetected = null; // clear last selected
        return;
    }
    
    this.physicsSimulator.evaluate();
    
    // if selected is not the same as last selected, reset last selected position
    if (selected != this.lastDetected)
    {
        selected.lastPosition = selected.position.getValueDirect();
        selected.lastQuaternion = getInspectionGroupQuaternion(selected).getValueDirect();
        this.lastDetected = selected;
        this.lastColliding = false;
        this.lastCollidingDistance = FLT_MAX;
    }
    /*
    var position = selected.position.getValueDirect();
    var lastPosition = selected.lastPosition || position;
    var delta = new Vector3D(position.x - lastPosition.x, position.y - lastPosition.y, position.z - lastPosition.z);
    var delta_distance = distanceBetween(new Vector3D(position.x, position.y, position.z),
                                         new Vector3D(lastPosition.x, lastPosition.y, lastPosition.z));
    console.log(delta_distance);
    var bbox_min = selected.bbox.min.getValueDirect();
    var bbox_max = selected.bbox.max.getValueDirect();
    var bbox_size = distanceBetween(new Vector3D(bbox_min.x, bbox_min.y, bbox_min.z),
                                    new Vector3D(bbox_max.x, bbox_max.y, bbox_max.z));
    var iterations = 1;
    if (delta_distance > bbox_size)
    {
        iterations = Math.ceil(delta_distance / bbox_size);
    }
    delta.multiplyScalar(1 / iterations);
    var timeIncrement = this.physicsSimulator.timeIncrement.getValueDirect() / iterations;
    this.physicsSimulator.timeIncrement.setValueDirect(timeIncrement);
    for (var i = 0; i < iterations; i++)
    {
        position.x += delta.x;
        position.y += delta.y;
        position.z += delta.z;
        selected.position.setValueDirect(position.x, position.y, position.z);
    */
        if (this.detectCollision(selected))
        {
            return;
        }
    //}
 }
    
CollideDirective.prototype.detectCollision = function(model)
{  return;
    // if selected is not the same as last selected, reset last selected position
    if (model != this.lastDetected)
    {    
        model.lastPosition = model.position.getValueDirect();
        model.lastQuaternion = getInspectionGroupQuaternion(model).getValueDirect();
        this.lastDetected = model;
        this.lastColliding = false;
        this.lastCollidingDistance = FLT_MAX;
    }
    
    // update position of selected model with physics simulator
    this.physicsSimulator.updatePhysicsBodyPosition(this.physicsSimulator.getPhysicsBodyIndex(model), true);
    
    // perform CD 
    this.physicsSimulator.detectCollisions();

    if (model.physicalProperties.mass.getValueDirect() == 0) return false;
    
    // check collision status
    var colliding = this.isColliding(model);
    // if colliding and the distance between collision points is < MIN_COLLIDE_DISTANCE, update position to physics engine's position
    if (colliding.colliding)
    {   
        // if model is set to stop on collision, update its position from the physics simulator
        if (model.getAttribute("stopOnCollision").getValueDirect())
        {    
            //if (colliding.distance > 0.01) // check already performed by PhysicsSimulator::isColliding
            {
                if (this.lastColliding)
                {                   
                    var trans = new Ammo.btTransform();
                    this.physicsSimulator.getPhysicsBody(model).getMotionState().getWorldTransform(trans);
                    var origin = trans.getOrigin();
                    //var rot = trans.getRotation();
                    //var quaternion = new Quaternion();
                    //quaternion.load(rot.w(), rot.x(), rot.y(), rot.z());
                    Ammo.destroy(trans);
                
                    var position = new Vector3D(origin.x(), origin.y(), origin.z());                        
                    model.lastPosition = position;
                    //model.lastQuaternion = quaternion;
                }
                
                model.getAttribute("position").removeModifiedCB(PhysicsSimulator_ModelPositionModifiedCB, this.physicsSimulator);    
                model.getAttribute("position").setValueDirect(model.lastPosition.x, model.lastPosition.y, model.lastPosition.z);
                model.getAttribute("position").addModifiedCB(PhysicsSimulator_ModelPositionModifiedCB, this.physicsSimulator);
                
                //model.getAttribute("quaternion").removeModifiedCB(PhysicsSimulator_ModelPositionModifiedCB, this.physicsSimulator);    
                //model.getAttribute("quaternion").setValueDirect(model.lastQuaternion);
                //model.getAttribute("quaternion").addModifiedCB(PhysicsSimulator_ModelPositionModifiedCB, this.physicsSimulator);
                //getInspectionGroupQuaternion(model).setValueDirect(model.lastQuaternion);
            }

            this.lastColliding = true;
            this.lastCollidingDistance = colliding.distance;
            //console.log("colliding");
        }
    }
    else
    {
        // no collision
        model.lastPosition = model.position.getValueDirect();
        model.lastQuaternion = getInspectionGroupQuaternion(model).getValueDirect();
        this.lastColliding = false;
        this.lastCollidingDistance = FLT_MAX;
        //console.log("not colliding");
    }
    
    return this.lastColliding;
}

CollideDirective.prototype.detectGroundCollision = function(model, transDelta)
{   
    // get ground model
    var ground = this.registry.find("Ground");
    if (!ground) 
    {
        return { colliding: false, distance: FLT_MAX }
    }
    
    // get model center
    var center = model.center.getVector3D();
    
    // get model current position
    var position = model.position.getVector3D();
    
    // get model next position
    var nextPosition = new Vector3D(position.x + transDelta.x, position.y + transDelta.y, position.z + transDelta.z);
    
    // get distance between current and next position
    var distance = distanceBetween(position, nextPosition);
    
    // perform ray pick from model current position to ground along direction and retrieve distance rpG
    var scale = ground.scale.getVector3D();
    var scale_max = max3(scale.x, scale.y, scale.z);
    var rpG = rayPick(ground.boundingTree, new Vector3D(position.x, position.y, position.z), transDelta,
                      0, 10000, ground.transformCompound, new Matrix4x4(), scale_max, false, null);
    if (!rpG)
    {
        return { colliding: false, distance: FLT_MAX }
    } 
    var ground_y_distance = position.y - rpG.pointWorld.y;

    // perform ray pick from model current position to farthest model edge along y direction and retrieve distance model_distance
    
    // account for model's object-inspected rotation
    /*var rotationMatrix = new Matrix4x4();
    var inspectionGroup = getInspectionGroup(model);
    if (inspectionGroup)
    {
        var quaternionRotate = inspectionGroup.getChild(2);
        rotationMatrix = quaternionRotate.getAttribute("matrix").getValueDirect();
    }*/
    
    var model_y_distance = 0;
    scale = model.scale.getVector3D();
    /*scale_max = max3(scale.x, scale.y, scale.z);
    var rpM = rayPick(model.boundingTree, new Vector3D(), rotationMatrix.transform(0, -1, 0, 0),
                  0, 10000, new Matrix4x4(), new Matrix4x4(), scale_max, true, null, true);
    if (rpM)
    {
        model_y_distance = rpM.distance * scale_max;
    }
    else // !rpM*/
    {
        var bbox_max = model.bbox.max.getVector3D();
        var bbox_min = model.bbox.min.getVector3D();
        model_y_distance = scale.y * (bbox_max.y - bbox_min.y) / 2;
    }    
    
    // find collision distance (ground_y_distance - model_distance)
    var collisionDistance = ground_y_distance - model_y_distance;
    //console.log(collisionDistance);
    
    // if collision distance < distance, return colliding with collision distance
    if (collisionDistance < distance)
    {
        //if (collisionDistance < 0) collisionDistance = 0; // don't allow negative values
        return { colliding: true, distance: collisionDistance }
    }
    
    // collision distance > distance, return false
    return { colliding: false, distance: FLT_MAX }
}
    
CollideDirective.prototype.detectObstructions = function(collideRecs)
{
    var i, j;
    var models = [];
    var trees = [];
    var obstructions = [];

    for (i in collideRecs)
    {
        if (collideRecs[i].model.getAttribute("detectObstruction").getValueDirect() == false) continue;
        
        models.push(collideRecs[i].model);
        trees.push(collideRecs[i].tree);
        obstructions.push(false);

        collideRecs[i].model.getAttribute("obstructionList").clear();
    }

    var distance = 0;
    var minDistance = FLT_MAX;
    for (i = 0; i < trees.length; i++)
    {
        var scale = models[i].scale.getValueDirect();
        
        var directionVectors = models[i].getDirectionVectors();
        directionVectors.forward.x *= MAX_SEE_AHEAD * scale.x;
        directionVectors.forward.y *= MAX_SEE_AHEAD * scale.y;
        directionVectors.forward.z *= MAX_SEE_AHEAD * scale.z;

        for (j = 0; j < trees.length; j++)
        {
            if (i == j)
                continue;

            if (( distance = trees[j].obstructs(trees[i], directionVectors.forward)) > 0 && distance < minDistance)
            {
                models[i].getAttribute("obstructionList").clear();
                models[i].getAttribute("obstructionList").push_back(models[j]);
                obstructions[i] = true;
                minDistance = distance;
            }
        }
    }

    for (i = 0; i < obstructions.length; i++)
    {
        models[i].getAttribute("obstructionDetected").setValueDirect(obstructions[i]);
    }
}

CollideDirective.prototype.detectSnapConnections = function(collideRecs)
{
    var snapper = this.selector.selected;
    if (!snapper || snapper.getAttribute("snapEnabled").getValueDirect() == false) return;

    // test plugs for collision with sockets
    var snapMgr = this.registry.find("SnapMgr");
    for (var i in collideRecs)
    {
        var snappee = collideRecs[i].model;
        if (snappee == snapper) continue;
        if (snapper.boundingTree.collides(snappee.boundingTree) &&
            snapMgr.trySnap(snapper, snappee))
        {     
            return;
            //break;
        }
    }
}
    
CollideDirective.prototype.isColliding = function(model)
{   
    var colliding = this.physicsSimulator.isColliding(model);
    
    return colliding;
}

CollideDirective.prototype.isSelected = function(model)
{
    var selected = model.getAttribute("selected").getValueDirect();
    if (!selected)
    {
        for (var i = 0; i < model.motionChildren.length && !selected; i++)
        {
            selected = this.isSelected(model.motionChildren[i]);
        }
    }

    return selected;
}
function HighlightTarget()
{
    this.projMatrix = new Matrix4x4();
    this.viewMatrix = new Matrix4x4();
    this.worldMatrix = new Matrix4x4();
    this.camera = null;
    this.viewport = new Viewport();
    this.geometries = new Array();
    this.center = new Vector3D();
    this.highlightColor_r = 0;
    this.highlightColor_g = 0;
    this.highlightColor_b = 0;
    this.highlightColor_a = 0;
    this.highlightWidth = 0;
};

HighlightParams.prototype = new DirectiveParams();
HighlightParams.prototype.constructor = HighlightParams();

function HighlightParams()
{
    DirectiveParams.call(this);

    this.projMatrix = new Matrix4x4();
    this.viewMatrix = new Matrix4x4();
    this.worldMatrix = new Matrix4x4();
    this.camera = null;
    this.viewport = new Viewport();
    this.targets = new Array();
}

HighlightDirective.prototype = new SGDirective();
HighlightDirective.prototype.constructor = HighlightDirective;

function HighlightDirective()
{
    SGDirective.call(this);
    this.className = "HighlightDirective";
    this.attrType = eAttrType.HighlightDirective;

    this.vertexBuffer = null;
    
    this.name.setValueDirect("HighlightDirective");
        
    this.highlightType = new NumberAttr(eHighlightType.None);
    this.highlightColor = new ColorAttr(1, 1, 0, 1);
    this.highlightWidth = new NumberAttr(5);
    
    this.highlightColor.addModifiedCB(HighlightDirective_HighlightColorModifiedCB, this);
    
    this.registerAttribute(this.highlightType, "highlightType");
    this.registerAttribute(this.highlightColor, "highlightColor");
    this.registerAttribute(this.highlightWidth, "highlightWidth");
}

HighlightDirective.prototype.setGraphMgr = function(graphMgr)
{
    // call base-class implementation
    SGDirective.prototype.setGraphMgr.call(this, graphMgr);
    
    this.initHighlightSquareVB();
}

HighlightDirective.prototype.execute = function(root)
{
    root = root || this.rootNode.getValueDirect();

    // setup collision Detect params structure
    var params = new HighlightParams();

    // get list of models for collision detection
    root.apply("highlight", params, true);
    
    // draw highlights
    this.drawHighlights(params);
}

HighlightDirective.prototype.drawHighlights = function(params)
{
    // if no targets, return
    if (params.targets.length == 0)
    {
        return;
    }

    // get render engine
    var renderContext = this.graphMgr.renderContext;
    if (!renderContext)
    {
        return;
    } 

    var highlightType = this.highlightType.getValueDirect();

    // for each target
    var up, right, forward;
    for (var i=0; i < params.targets.length; i++)
    {
        var target = params.targets[i];

        // get camera direction vectors
        var directions = target.camera.getDirectionVectors();
        up = directions.up;
        right = directions.right;
        forward = directions.forward;

        // get scaling factors from target's worldMatrix
        var scalingFactors = target.worldMatrix.getScalingFactors();
        var maxScalingFactor = max3(scalingFactors.x, scalingFactors.y, scalingFactors.z);
        
        var wupp = this.getWorldUnitsPerPixel(target.center, target.worldMatrix, target.viewMatrix, target.camera, target.viewport) / maxScalingFactor;
        var highlightWidth = target.highlightWidth * wupp;

        // clear stencil buffer
        renderContext.clearStencil(0);
        renderContext.clear(RC_STENCIL_BUFFER_BIT);

        // increment stencil for geometry in delta positions
        var worldViewMatrix;
        for (var j=0; j < target.geometries.length; j++)
        {
            switch (highlightType)
            {
            case eHighlightType.FourPass:
                {
                    for (var pass=0; pass < 4; pass++)
                    {
                        worldViewMatrix = this.getWorldViewMatrix(highlightType, highlightWidth, pass, up, right,
                            forward, target.worldMatrix, target.viewMatrix);
                        this.configureStencil_Target(renderContext, target.geometries[j], target.projMatrix, 
                            worldViewMatrix, eStencilOp.Increment);
                    }
                }
                break;

            case eHighlightType.EightPass:
                {
                    for (var pass=0; pass < 8; pass++)
                    {
                        worldViewMatrix = this.getWorldViewMatrix(highlightType, highlightWidth, pass, up, right,
                            forward, target.worldMatrix, target.viewMatrix);
                        this.configureStencil_Target(renderContext, target.geometries[j], target.projMatrix,
                            worldViewMatrix, eStencilOp.Increment);
                    }
                }
                break;
            }
        }

        // zero stencil for geometry in original position
        worldViewMatrix = target.worldMatrix.multiply(target.viewMatrix);
        for (var j=0; j < target.geometries.length; j++)
        {
            this.configureStencil_Target(renderContext, target.geometries[j], target.projMatrix, worldViewMatrix, eStencilOp.Zero);
        }

        // update highlight color
        this.highlightColor.setValueDirect(target.highlightColor_r, target.highlightColor_g, target.highlightColor_b, target.highlightColor_a);

        // render highlight square
        this.renderHighlightSquare(params, renderContext);
    } 
}

HighlightDirective.prototype.getWorldUnitsPerPixel = function(point, worldMatrix, viewMatrix, camera, viewport)
{
    // get geometry's center in view space
    var worldViewMatrix = worldMatrix.multiply(viewMatrix);
    var centerPtCamSpace = worldViewMatrix.transform(point.x, point.y, point.z, 1);

    // determine the per-pixel width and height at geometry's center in view space
    var perPixel = new Vector2D();
    
    // get camera node type
    switch (camera.attrType)
    {
    case eAttrType.PerspectiveCamera:
        {
            // get zoom
            var zoom = camera.getAttribute("zoom").getValueDirect();
            perPixel = worldUnitsPerPixelPersp(viewport, zoom, centerPtCamSpace.z);
        }
        break;

    case eAttrType.OrthographicCamera:
        {
            // get width
            var width = camera.getAttribute("width").getValueDirect();
            perPixel = worldUnitsPerPixelOrtho(viewport, width);
        }
        break;
        
    default:
        break;
    }
    
    return Math.max(perPixel.x, perPixel.y); 
}

HighlightDirective.prototype.getWorldViewMatrix = function(highlightType, highlightWidth, pass,
                                                           cameraUp, cameraRight, cameraForward,
                                                           world, view)
{
    var degrees = 0;
    switch (highlightType)
    {
    case eHighlightType.FourPass:  degrees = 90; break;
    case eHighlightType.EightPass: degrees = 45; break;
    }

    var rotate = new Matrix4x4();
    rotate.loadZAxisRotation(degrees * pass);
    var delta = rotate.transform(1, 0, 0, 0);
    delta.x *= highlightWidth;
    delta.y *= highlightWidth;
    delta.z *= highlightWidth;

    var translate = new Matrix4x4();
    translate.loadTranslation(cameraRight.x * delta.x + cameraUp.x * delta.y,// + cameraForward.x * delta.z, 
                              cameraRight.y * delta.x + cameraUp.y * delta.y,// + cameraForward.y * delta.z,
                              cameraRight.z * delta.x + cameraUp.z * delta.y);// + cameraForward.z * delta.z);

    return translate.multiply(world.multiply(view));
}

HighlightDirective.prototype.configureStencil_Target = function(renderContext,
                                                                geometry,
                                                                projMatrix,
                                                                worldViewMatrix,
                                                                stencilOp)
{
    // get current render states
    var lastDepthBufferWrite = renderContext.enabled(eRenderMode.DepthBufferWrite);
    var lastStencilTest = renderContext.enabled(eRenderMode.StencilTest);
    var lastAlphaBlend = renderContext.enabled(eRenderMode.AlphaBlend);

    // disable z-buffer writes (note: z-testing still occurs), and enable the
    // stencil-buffer
    renderContext.setEnabled(eRenderMode.DepthBufferWrite, false);
    renderContext.setEnabled(eRenderMode.StencilTest, true);

    // set depth function
    renderContext.setDepthFunc(eDepthFunc.LessEqual);

    // disable smooth shading
    renderContext.setShadeModel(eShadeModel.Flat);

    // set up stencil compare fuction, reference value, and masks.
    // stencil test passes if ((ref & mask) cmpfn (stencil & mask)) is true.
    renderContext.setStencilFunc(eStencilFunc.Always, 0, 0xFF);
    renderContext.setStencilMask(0xFF);

    // if depth-test passes, increment stencil buffer value
    renderContext.setStencilOp(eStencilOp.Keep, stencilOp, stencilOp);

    // make sure that no pixels get drawn to the frame buffer
    renderContext.setEnabled(eRenderMode.AlphaBlend, true);
    renderContext.setBlendFactor(RC_ZERO, RC_ONE);

    // draw geometry in stencil only
    renderContext.setMatrixMode(RC_PROJECTION);
    renderContext.pushMatrix();
    renderContext.loadMatrix(projMatrix);
    renderContext.applyProjectionTransform();
    renderContext.setMatrixMode(RC_VIEW);
    renderContext.pushMatrix();
    renderContext.loadMatrix(new Matrix4x4());
    renderContext.applyViewTransform();
    renderContext.setMatrixMode(RC_WORLD);
    renderContext.pushMatrix();
    renderContext.loadMatrix(worldViewMatrix);
    renderContext.applyWorldTransform();
    geometry.drawPrimitives();
    renderContext.setMatrixMode(RC_PROJECTION);
    renderContext.popMatrix();
    renderContext.setMatrixMode(RC_VIEW);
    renderContext.popMatrix();
    renderContext.setMatrixMode(RC_WORLD);
    renderContext.popMatrix();

    // restore render states
    renderContext.setEnabled(eRenderMode.DepthBufferWrite, lastDepthBufferWrite);
    renderContext.setEnabled(eRenderMode.StencilTest, lastStencilTest);
    renderContext.setDepthFunc(eDepthFunc.LessEqual);
    renderContext.setShadeModel(eShadeModel.Gouraud);
    renderContext.setEnabled(eRenderMode.AlphaBlend, lastAlphaBlend);
}
     
HighlightDirective.prototype.renderHighlightSquare = function(params, renderContext)
{
    // get current render states
    var lastDepthTest = renderContext.enabled(eRenderMode.DepthTest);
    var lastStencilTest = renderContext.enabled(eRenderMode.StencilTest);
    var lastAlphaBlend = renderContext.enabled(eRenderMode.AlphaBlend);
    var lastLighting = renderContext.enabled(eRenderMode.Lighting);

    // set render states
    renderContext.setDepthFunc(eDepthFunc.LessEqual);
    renderContext.setEnabled(eRenderMode.DepthTest, false);
    renderContext.setEnabled(eRenderMode.StencilTest, true);
    renderContext.setEnabled(eRenderMode.AlphaBlend, true);
    renderContext.setEnabled(eRenderMode.Lighting, false);
    renderContext.setBlendFactor(RC_SRC_ALPHA, RC_ONE_MINUS_SRC_ALPHA);

    // only write where stencil val <= 1 (count indicates # of target fragments that
    // overlap that pixel)
    renderContext.setStencilFunc(eStencilFunc.LessEqual, 1, 0xFF);
    renderContext.setStencilOp(eStencilOp.Keep, eStencilOp.Keep, eStencilOp.Keep); 

    // draw the highlight square
    var m = new Matrix4x4();
    m.loadIdentity();
    renderContext.setMatrixMode(RC_PROJECTION);
    renderContext.pushMatrix();
    renderContext.loadMatrix(m);
    renderContext.applyProjectionTransform();
    renderContext.setMatrixMode(RC_VIEW);
    renderContext.pushMatrix();
    renderContext.loadMatrix(m);
    renderContext.applyViewTransform();
    renderContext.setMatrixMode(RC_WORLD);
    renderContext.pushMatrix();
    renderContext.loadMatrix(m);
    renderContext.applyWorldTransform();
    this.vertexBuffer.draw();
    renderContext.popMatrix();
    renderContext.setMatrixMode(RC_VIEW);
    renderContext.popMatrix();
    renderContext.setMatrixMode(RC_PROJECTION);
    renderContext.popMatrix();

    // restore render states
    renderContext.setDepthFunc(eDepthFunc.LessEqual);
    renderContext.setEnabled(eRenderMode.DepthTest, lastDepthTest);
    renderContext.setEnabled(eRenderMode.StencilTest, lastStencilTest);
    renderContext.setEnabled(eRenderMode.AlphaBlend, lastAlphaBlend);
    renderContext.setEnabled(eRenderMode.Lighting, lastLighting);
    renderContext.setMatrixMode(RC_WORLD);
}
                                      
HighlightDirective.prototype.initHighlightSquareVB = function()
{
    this.vertexBuffer = this.graphMgr.renderContext.createVertexBuffer(3);
    this.vertexBuffer.setPrimitiveType(RC_TRIANGLE_STRIP);
    
    var vertices = [ -1, -1,  1,
                     -1,  1,  1,
                      1, -1,  1,
                      1,  1,  1 ];

    var normals = [ 0,  0, -1,
                    0,  0, -1,
                    0,  0, -1,
                    0,  0, -1 ];
             
    var color = this.highlightColor.getValueDirect();       
    var colors = [ color.r, color.g, color.b, color.a,
                   color.r, color.g, color.b, color.a,
                   color.r, color.g, color.b, color.a,
                   color.r, color.g, color.b, color.a ];
                    
    this.vertexBuffer.setVertices(vertices);
    this.vertexBuffer.setNormals(normals);
    this.vertexBuffer.setColors(colors);
}

HighlightDirective.prototype.highlightColorModified = function()
{
    if (this.vertexBuffer)
    {
        var color = this.highlightColor.getValueDirect();       
        var colors = [ color.r, color.g, color.b, color.a,
                       color.r, color.g, color.b, color.a,
                       color.r, color.g, color.b, color.a,
                       color.r, color.g, color.b, color.a ];

        this.vertexBuffer.setColors(colors);
    }
}

function HighlightDirective_HighlightColorModifiedCB(attribute, container)
{
    container.highlightColorModified();
}

ShadowParams.prototype = new DirectiveParams();
ShadowParams.prototype.constructor = ShadowParams();

function ShadowParams()
{
    DirectiveParams.call(this);
    
    this.worldMatrix = new Matrix4x4();
    this.dissolve = 0;
    this.opacity = 1;
    this.lights = [];
    this.modelID = 0;
}

ShadowDirective.prototype = new SGDirective();
ShadowDirective.prototype.constructor = ShadowDirective;

function ShadowDirective()
{
    SGDirective.call(this);
    this.className = "ShadowDirective";
    this.attrType = eAttrType.ShadowDirective;

    this.program = null;
    this.shadowFBO = null;
    this.displayListObj = null;
    
    this.name.setValueDirect("ShadowDirective");
    
    this.casterWorldPosition = new Vector3DAttr(0, 0, 0);
    
    this.registerAttribute(this.casterWorldPosition, "casterWorldPosition");
}

ShadowDirective.prototype.setGraphMgr = function(graphMgr)
{
    this.program = graphMgr.renderContext.createProgram(pcf_shadow_mapping_depth_pass_vs, pcf_shadow_mapping_depth_pass_fs);
    this.shadowFBO = graphMgr.renderContext.createShadowFramebufferObject();
    this.displayListObj = new DisplayListObj(graphMgr.renderContext);
    
    // call base-class implementation
    SGDirective.prototype.setGraphMgr.call(this, graphMgr);
}

ShadowDirective.prototype.execute = function(root)
{
    root = root || this.rootNode.getValueDirect();

    // get current shader program
    var program = this.graphMgr.renderContext.getProgram();

    // get current display list (if any)
    var lastDisplayListObj = this.graphMgr.renderContext.getDisplayList();
    
    // get current viewport and clear color
    var viewport = this.graphMgr.renderContext.getViewport();
    var clearColor = this.graphMgr.renderContext.getClearColor();

    // set shader program
    this.graphMgr.renderContext.useProgram(this.program);
    
    // set projection
    var fovyRadians = toRadians(90);
    var height = 1024;
    var width = 1024;
    var near = 1;
    var far = 100;
    
    var top = Math.tan(fovyRadians / 2) * near;
    var bottom = -top;
    var right = top * (width / height);
    var left = -right;
   
    var projectionMatrix = this.graphMgr.renderContext.perspectiveMatrixLH(left, right,
        top, bottom, near, far);
    
    this.graphMgr.renderContext.setMatrixMode(RC_PROJECTION);
    this.graphMgr.renderContext.pushMatrix();
    this.graphMgr.renderContext.loadMatrix(projectionMatrix);
    this.graphMgr.renderContext.applyProjectionTransform();
    
    // TODO: make configurable
    worldPos = this.casterWorldPosition.getValueDirect();
    this.graphMgr.renderContext.setShadowCasterWorldPosition(worldPos.x, worldPos.y, worldPos.z);
    
    // set view
    var translationMatrix = new Matrix4x4();
    translationMatrix.loadTranslation(worldPos.x, worldPos.y, worldPos.z); // TODO
    
    var rotationMatrix = new Matrix4x4();
    rotationMatrix.loadYAxisRotation(90);
    
    var viewMatrix = rotationMatrix.multiply(translationMatrix);
    viewMatrix.invert();
    
    this.graphMgr.renderContext.setMatrixMode(RC_VIEW);
    this.graphMgr.renderContext.pushMatrix();
    this.graphMgr.renderContext.loadMatrix(viewMatrix);
    this.graphMgr.renderContext.applyViewTransform();
    
    // bind the first face of the shadow fbo to the framebuffer
    this.shadowFBO.bindForWriting(eCubeMapFace.Positive_X);
    
    // set this display list to render context    
    this.graphMgr.renderContext.setDisplayList(this.displayListObj);
    
    // begin recording
    this.displayListObj.record_begin();
    
    // draw
    var params = new ShadowParams();
    root.apply("shadow", params, true);
    
    // stop recording
    this.displayListObj.record_end();
    
    // bind subsequent faces of the shadow fbo to the framebuffer and draw
    for (var i = 1; i < 6; i++)
    {
        // bind the face of the shadow fbo to the framebuffer
        this.shadowFBO.bindForWriting(eCubeMapFace.Positive_X + i);
        
        // set view
        switch (eCubeMapFace.Positive_X + i)
        {
            case eCubeMapFace.Negative_X: rotationMatrix.loadYAxisRotation(-90); break;
            case eCubeMapFace.Positive_Y: rotationMatrix.loadXAxisRotation(90); break;
            case eCubeMapFace.Negative_Y: rotationMatrix.loadXAxisRotation(-90); break;
            case eCubeMapFace.Positive_Z: rotationMatrix.loadYAxisRotation(0); break;
            case eCubeMapFace.Negative_Z: rotationMatrix.loadYAxisRotation(180); break;
        }
        viewMatrix = rotationMatrix.multiply(translationMatrix);
        viewMatrix.invert();
        this.graphMgr.renderContext.setMatrixMode(RC_VIEW);
        this.graphMgr.renderContext.loadMatrix(viewMatrix);
        this.graphMgr.renderContext.applyViewTransform();
        
        // draw
        this.displayListObj.play();
    }
    
    // restore previous projection
    this.graphMgr.renderContext.setMatrixMode(RC_PROJECTION);
    this.graphMgr.renderContext.popMatrix();
    this.graphMgr.renderContext.applyProjectionTransform();
    
    // restore previous view
    this.graphMgr.renderContext.setMatrixMode(RC_VIEW);
    this.graphMgr.renderContext.popMatrix();
    this.graphMgr.renderContext.applyViewTransform();
    
    // restore last display list (if any)
    this.graphMgr.renderContext.setDisplayList(lastDisplayListObj);
    
    // restore last viewport and clear color
    this.graphMgr.renderContext.setViewport(viewport.x, viewport.y, viewport.width, viewport.height);
    this.graphMgr.renderContext.clearColor(clearColor.r, clearColor.g, clearColor.b, clearColor.a);
    
    // restore last shader program
    this.graphMgr.renderContext.useProgram(program);
    
    this.graphMgr.renderContext.setShadowCasterWorldPosition(worldPos.x, worldPos.y, worldPos.z);
    
    // unbind the shadow fbo from the framebuffer and bind for reading by the render pass
    this.shadowFBO.bindForReading();
}
var OBJECTMOTION_PAN_BIT     = 0x001;
var OBJECTMOTION_LINEAR_BIT  = 0x002;
var OBJECTMOTION_ANGULAR_BIT = 0x004;
var OBJECTMOTION_SCALAR_BIT  = 0x008;
var OBJECTMOTION_ALL_BITS    = 0x00F;

function ObjectMotionDesc()
{
    this.validMembersMask = OBJECTMOTION_ALL_BITS;
    this.panVelocity = new Vector3D(0, 0, 0);
    this.linearVelocity = new Vector3D(0, 0, 0);
    this.angularVelocity = new Vector3D(0, 0, 0);
    this.scalarVelocity = new Vector3D(0, 0, 0);
    this.duration = 0; // seconds
    this.stopOnCollision = true;
}

ObjectMotionDesc.prototype.assign = function(rhs)
{
    this.validMembersMask = rhs.validMembersMask;
    this.panVelocity = rhs.panVelocity;
    this.linearVelocity = rhs.linearVelocity;
    this.angularVelocity = rhs.angularVelocity;
    this.scalarVelocity = rhs.scalarVelocity;
    this.duration = rhs.duration;
}

ObjectMover.prototype = new Evaluator();
ObjectMover.prototype.constructor = ObjectMover;

function ObjectMover()
{
    Evaluator.call(this);
    this.className = "ObjectMover";
    this.attrType = eAttrType.ObjectMover;

    this.targetObject = null;
    this.motionQueue = new Queue();
    this.activeMotion = null;
    this.activeDuration = 0;
    this.lastCollisionDetected = false;

    this.target = new StringAttr("");
    this.timeIncrement = new NumberAttr(0);
    this.linearSpeed = new NumberAttr(0); // meters/sec
    this.angularSpeed = new NumberAttr(0); // degrees/sec
    this.panVelocity = new Vector3DAttr();
    this.linearVelocity = new Vector3DAttr();
    this.angularVelocity = new Vector3DAttr();
    this.scalarVelocity = new Vector3DAttr();

    this.enabled.addModifiedCB(ObjectMover_EnabledModifiedCB, this);
    this.target.addModifiedCB(ObjectMover_TargetModifiedCB, this);

    this.registerAttribute(this.target, "target");
    this.registerAttribute(this.timeIncrement, "timeIncrement");
    this.registerAttribute(this.linearSpeed, "linearSpeed");
    this.registerAttribute(this.angularSpeed, "angularSpeed");
}

ObjectMover.prototype.onUnregister = function()
{
    this.motionQueue.clear();
    this.panVelocity.setValueDirect(0, 0, 0);
    this.linearVelocity.setValueDirect(0, 0, 0);
    this.angularVelocity.setValueDirect(0, 0, 0);
    this.scalarVelocity.setValueDirect(0, 0, 0);
}

ObjectMover.prototype.evaluate = function()
{
    // time
    var timeIncrement = this.timeIncrement.getValueDirect();

    this.updateActiveMotion(timeIncrement);

    this.setMotion(this.activeMotion);
}

ObjectMover.prototype.setMotion = function(motion)
{
    if (motion.validMembersMask & OBJECTMOTION_PAN_BIT)
    {
        this.panVelocity.setValueDirect(motion.panVelocity.x,
                motion.panVelocity.y,
                motion.panVelocity.z);
    }

    if (motion.validMembersMask & OBJECTMOTION_LINEAR_BIT)
    {
        this.linearVelocity.setValueDirect(motion.linearVelocity.x,
                motion.linearVelocity.y,
                motion.linearVelocity.z);
    }

    if (motion.validMembersMask & OBJECTMOTION_ANGULAR_BIT)
    {
        this.angularVelocity.setValueDirect(motion.angularVelocity.x,
                motion.angularVelocity.y,
                motion.angularVelocity.z);
    }

    if (motion.validMembersMask & OBJECTMOTION_SCALAR_BIT)
    {
        this.scalarVelocity.setValueDirect(motion.scalarVelocity.x,
                motion.scalarVelocity.y,
                motion.scalarVelocity.z);
    }
}

ObjectMover.prototype.updateActiveMotion = function(timeIncrement)
{
    if (!this.activeMotion ||
            this.activeDuration >= this.activeMotion.duration)
    {
        this.activeDuration = 0;
        this.activeMotion = this.motionQueue.front() || new ObjectMotionDesc();
        this.motionQueue.pop();
    }

    this.activeDuration += timeIncrement;
}

ObjectMover.prototype.connectTarget = function(target)
{
    this.panVelocity.removeAllTargets();
    this.linearVelocity.removeAllTargets();
    this.angularVelocity.removeAllTargets();
    this.scalarVelocity.removeAllTargets();

    if (target)
    {
        this.panVelocity.addTarget(target.getAttribute("panVelocity"));
        this.linearVelocity.addTarget(target.getAttribute("linearVelocity"));
        this.angularVelocity.addTarget(target.getAttribute("angularVelocity"));
        this.scalarVelocity.addTarget(target.getAttribute("scalarVelocity"));
        target.getAttribute("detectCollision").setValueDirect(true);
        target.getAttribute("collisionDetected").addModifiedCB(ObjectMover_TargetCollisionDetectedModifiedCB, this);
        target.getAttribute("detectObstruction").setValueDirect(true);
        target.getAttribute("obstructionDetected").addModifiedCB(ObjectMover_TargetObstructionDetectedModifiedCB, this);       
    }

    this.targetObject = target;
}

ObjectMover.prototype.collisionDetected = function(collisionList)
{
}

ObjectMover.prototype.obstructionDetected = function(obstructionList)
{
}

function ObjectMover_EnabledModifiedCB(attribute, container)
{
    var enabled = attribute.getValueDirect();
    if (!enabled)
    {
        container.motionQueue.clear();
        container.panVelocity.setValueDirect(0, 0, 0);
        container.linearVelocity.setValueDirect(0, 0, 0);
        container.angularVelocity.setValueDirect(0, 0, 0);
        container.scalarVelocity.setValueDirect(0, 0, 0);
    }
}

function ObjectMover_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    var resource = container.registry.find(target);
    if (resource)
    {
        container.connectTarget(resource);
    }
}

function ObjectMover_TargetCollisionDetectedModifiedCB(attribute, container)
{
    var collisionDetected = attribute.getValueDirect();
    var collisionList = attribute.getContainer().getAttribute("collisionList");
    container.collisionDetected(collisionList);
    container.lastCollisionDetected = collisionList.Size() > 0 ? true : false;
}

function ObjectMover_TargetObstructionDetectedModifiedCB(attribute, container)
{
    var obstructionDetected = attribute.getValueDirect();
    var obstructionList = attribute.getContainer().getAttribute("obstructionList");
    container.obstructionDetected(obstructionList);
}

var ANIMALMOVER_MAX_QUEUE_LENGTH = 2;

AnimalMover.prototype = new ObjectMover();
AnimalMover.prototype.constructor = AnimalMover;

function AnimalMover()
{
    ObjectMover.call(this);
    this.className = "AnimalMover";
    this.attrType = eAttrType.AnimalMover;

    this.linearDirection = null;
}

AnimalMover.prototype.evaluate = function()
{
    if (this.motionQueue.length() == 0)
    {
        var rand = Math.random();
        var negateAngle = rand < 0.5 ? -1 : 1;
        var walk = new ObjectMotionDesc();
        walk.duration = 5 * rand; // 
        walk.angularVelocity = new Vector3D(0, this.angularSpeed.getValueDirect() * rand * negateAngle, 0);
        walk.panVelocity = new Vector3D(0, 0, this.linearSpeed.getValueDirect());

        this.motionQueue.push(walk);
    }

    // call base-class implementation
    ObjectMover.prototype.evaluate.call(this);
}

AnimalMover.prototype.collisionDetected = function(collisionList)
{
}

AnimalMover.prototype.obstructionDetected = function(obstructionList)
{
    if (obstructionList.Size() > 0) // obstructions(s) occurred
    {
        this.motionQueue.clear();
        this.activeMotion = null;

        // determine vector to avoid obstruction
        var directionVectors = this.targetObject.getDirectionVectors();
        var thisPos = this.targetObject.getAttribute("sectorPosition").getValueDirect();
        var linearDirection = new Vector3D(directionVectors.forward.x, directionVectors.forward.y, directionVectors.forward.z);
        var obstructorPos = obstructionList.getAt(0).getAttribute("sectorPosition").getValueDirect();
        var angleBetween = toDegrees(Math.acos(cosineAngleBetween(directionVectors.forward,
                new Vector3D(obstructorPos.x - thisPos.x,
                        obstructorPos.y - thisPos.y,
                        obstructorPos.z - thisPos.z))));
        // if angleBetween is 0, offset obstructorPos so that deltaPos is not (0, 0, 0)
        if (angleBetween == 0)
        {
            obstructorPos.x += 0.1;
            obstructorPos.z += 0.1;
        }
        var mag = distanceBetween(thisPos, obstructorPos);
        var deltaPos = new Vector3D(((directionVectors.forward.x * mag) - (obstructorPos.x)),
                ((directionVectors.forward.y * mag) - (obstructorPos.y)),
                ((directionVectors.forward.z * mag) - (obstructorPos.z)));
        deltaPos.normalize();
        //deltaPos.multiplyScalar(MAX_AVOID_FORCE);
        linearDirection.addVector(deltaPos);
        linearDirection.normalize();

        // scale by linear speed   
        linearDirection.multiplyScalar(this.linearSpeed.getValueDirect());
        this.linearDirection = linearDirection;

        // turn so this will travel in direction of this vector
        var cosAngle = cosineAngleBetween(directionVectors.forward, this.linearDirection);
        angleBetween = toDegrees(Math.acos(cosAngle));
        if (angleBetween > 0)
        {
            if (cosAngle < 0)
                angleBetween = -angleBetween;
            var rotation = this.targetObject.getAttribute("rotation").getValueDirect();
            this.targetObject.getAttribute("rotation").setValueDirect(rotation.x, angleBetween + rotation.y, rotation.z);
            
            // this code can result in endless turning
            /*var turn = new ObjectMotionDesc();
            turn.angularVelocity = new Vector3D(0, angleBetween, 0);
            turn.duration = angleBetween / this.angularSpeed.getValueDirect();
            this.motionQueue.push(turn);*/
        }
    }
    else // no obstruction(s)
    {
    }
}
WalkSimulator.prototype = new SceneInspector();
WalkSimulator.prototype.constructor = WalkSimulator;

function WalkSimulator()
{
    SceneInspector.call(this);
    this.className = "WalkSimulator";
    this.attrType = eAttrType.WalkSimulator;
    
    this.sceneInspector_pivotDistanceValue = 0;
    this.selector_computePivotDistanceValue = 0;
    
    this.groundPlane = new PlaneAttr();
    this.linearDelta = new Vector3DAttr(0, 0, 0);
    this.angularDelta = new Vector3DAttr(0, 0, 0);
    this.linearSensitivity = new Vector3DAttr(1, 1, 1);
    this.angularSensitivity = new Vector3DAttr(1, 1, 1);
    this.resultLinear = new Vector3DAttr();
    this.resultAngular = new Vector3DAttr();
    
    this.enabled.addModifiedCB(WalkSimulator_EnabledModifiedCB, this);
    this.linearDelta.addModifiedCB(WalkSimulator_LinearDeltaModifiedCB, this);
    this.angularDelta.addModifiedCB(WalkSimulator_AngularDeltaModifiedCB, this);
    
    this.registerAttribute(this.groundPlane, "groundPlane");
    this.registerAttribute(this.linearDelta, "linearDelta");
    this.registerAttribute(this.angularDelta, "angularDelta");
    this.registerAttribute(this.linearSensitivity, "linearSensitivity");
    this.registerAttribute(this.angularSensitivity, "angularSensitivity");
    this.registerAttribute(this.resultLinear, "resultLinear");
    this.registerAttribute(this.resultAngular, "resultAngular");
    
    this.viewRelativeXAxisRotation.setValueDirect(true);
    this.viewRelativeYAxisRotation.setValueDirect(true);
    this.viewRelativeZAxisRotation.setValueDirect(true);
    this.groundPlane.normal.setValueDirect(0, 1, 0);
}

WalkSimulator.prototype.evaluate = function()
{
    if (!this.enabled_)
    {
        return;
    }
    
    // get inputs
    var linearDelta = this.linearDelta.getValueDirect();
    // reverse pan x
    linearDelta.x *= -1;
    var linearSensitivity = this.linearSensitivity.getValueDirect();
    var angularDelta = this.angularDelta.getValueDirect();
    var angularSensitivity = this.angularSensitivity.getValueDirect();

    var panDelta = new Vector3D(linearDelta.x, linearDelta.y, linearDelta.z);
    panDelta.multiplyVector(linearSensitivity);
    var rotationDelta = new Vector3D(angularDelta.x, angularDelta.y, angularDelta.z);
    rotationDelta.multiplyVector(angularSensitivity);

    // only evaluate if necessary
    if (panDelta.x != 0 || panDelta.y != 0 || panDelta.z != 0 || 
        rotationDelta.x != 0 || rotationDelta.y != 0 || rotationDelta.z != 0)
    {
        this.panDelta.setValueDirect(panDelta.x, panDelta.y, panDelta.z);
        this.rotationDelta.setValueDirect(rotationDelta.x, rotationDelta.y, rotationDelta.z);

        // set camera direction vectors based upon walkPlane
        //if (m_updateDirectionVectors) // uncomment to retain forward direction when inspecting with mouse
        {
            // view position
            var viewPosition = this.viewPosition.getValueDirect();

            // view rotation
            var viewRotation = this.viewRotation.getValueDirect();

            // ground plane
            var groundPlane = this.groundPlane.getValueDirect();

            // formulate view transform
            var viewTrans = new Matrix4x4();
            viewTrans.loadTranslation(-viewPosition.x, -viewPosition.y, -viewPosition.z);
            var viewRot = new Matrix4x4();
            viewRot.loadXYZAxisRotation(-viewRotation.x, -viewRotation.y, -viewRotation.z);
            var viewTransform = viewTrans.multiply(viewRot);

            // formulate direction vectors
            this.upVector.setValueDirect(groundPlane.normal.x, groundPlane.normal.y, groundPlane.normal.z);
            
            var xformedXYZ = this.transformDirectionVector(0, 0, 1, viewTransform);
            var projectedXYZ = planeProject(xformedXYZ, groundPlane);
            var vProjectedXYZ = new Vector3D(projectedXYZ.x, projectedXYZ.y, projectedXYZ.z);
            vProjectedXYZ.normalize();
            this.forwardVector.setValueDirect(vProjectedXYZ.x, vProjectedXYZ.y, vProjectedXYZ.z);

            var m = new Matrix4x4();
            m.loadYAxisRotation(90);
            xformedXYZ = m.transform(vProjectedXYZ.x, vProjectedXYZ.y, vProjectedXYZ.z, 0);
            this.rightVector.setValueDirect(xformedXYZ.x, xformedXYZ.y, xformedXYZ.z);
            
            //m_updateDirectionVectors = false;*/
        }

        // call base-class implementation
        SceneInspector.prototype.evaluate.call(this);
    }
}

WalkSimulator.prototype.enabledModified = function()
{
    var enabled = this.enabled.getValueDirect();
    if (enabled)
    {
        this.enableSceneInspectionState(); // ensure scene inspection is enabled
        //m_updateDirectionVectors = true;
        this.affectRotation_Z.setValueDirect(false); // suspend bank
    }
    else if (this.lastEnabled) // only do the following if previously enabled
    {
        this.restoreSceneInspectionState(); // restore previous scene inspector state
        //m_updateDirectionVectors = false;
        this.affectRotation_Z.setValueDirect(true); // restore bank
        this.upVector.setValueDirect(0, 0, 0, false);
        this.rightVector.setValueDirect(0, 0, 0, false);
        this.forwardVector.setValueDirect(0, 0, 0, false);
    }

    this.lastEnabled = enabled;
}

WalkSimulator.prototype.enableSceneInspectionState = function()
{
    var sceneInspector = this.registry.find("SceneInspector");
    if (sceneInspector)
    {
        sceneInspector.enabled.setValueDirect(true);
        this.sceneInspector_pivotDistanceValue = sceneInspector.pivotDistance.getValueDirect();
        sceneInspector.pivotDistance.setValueDirect(0);
    }
    
    var selector = this.registry.find("Selector");
    if (selector)
    {
        this.selector_computePivotDistanceValue = selector.computePivotDistance.getValueDirect();
        selector.computePivotDistance.setValueDirect(false);
    }
}

WalkSimulator.prototype.restoreSceneInspectionState = function()
{
    var sceneInspector = this.registry.find("SceneInspector");
    if (sceneInspector)
    {
        sceneInspector.pivotDistance.setValueDirect(this.sceneInspector_pivotDistanceValue);
    }
    
    var selector = this.registry.find("Selector");
    if (selector)
    {
        selector.computePivotDistance.setValueDirect(this.selector_computePivotDistanceValue);
    }
}

function WalkSimulator_EnabledModifiedCB(attribute, container)
{
    container.enabledModified();
}

function WalkSimulator_LinearDeltaModifiedCB(attribute, container)
{
    // if orphaned, evaluate (otherwise graph will invoke evaluation)
    //if (container.orphan.getValueDirect() == true)
    {
        container.evaluate();
    }
}

function WalkSimulator_AngularDeltaModifiedCB(attribute, container)
{
    // if orphaned, evaluate (otherwise graph will invoke evaluation)
    //if (container.orphan.getValueDirect() == true)
    {
        container.evaluate();
    }
}

ScreenRect.prototype = new TriList();
ScreenRect.prototype.constructor = ScreenRect;

function ScreenRect()
{
    TriList.call(this);
    this.className = "ScreenRect";
    this.attrType = eAttrType.ScreenRect;
    
    this.primitiveType = RC_TRIANGLE_STRIP;
    
    this.textureColorMask = new ColorAttr(0, 0, 0, 1);
    
    this.registerAttribute(this.textureColorMask, "textureColorMask");
    
    var vertices = 
    [
        -1, -1,  1,
        -1,  1,  1,
         1, -1,  1,
         1,  1,  1
    ];
    
    var normals =
    [
        0,  0,  -1,
        0,  0,  -1,
        0,  0,  -1,
        0,  0,  -1
    ];
    
    var colors =
    [
        1,  1,  1,  1,
        1,  1,  1,  1,
        1,  1,  1,  1,
        1,  1,  1,  1
    ];
    
    this.vertices.setValueDirect(vertices);
    this.normals.setValueDirect(normals);
    this.colors.setValueDirect(colors);
}

ScreenRect.prototype.update = function(params, visitChildren)
{
    // call base-class implementation
    TriList.prototype.update.call(this, params, visitChildren);
}

ScreenRect.prototype.draw = function(dissolve)
{
    // set projection matrix
    var m = new Matrix4x4();
    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
    this.graphMgr.renderContext.pushMatrix();
    this.graphMgr.renderContext.loadMatrix(m);
    this.graphMgr.renderContext.applyWorldTransform();
    this.graphMgr.renderContext.setMatrixMode(RC_PROJECTION);
    this.graphMgr.renderContext.pushMatrix();
    this.graphMgr.renderContext.loadMatrix(m);
    this.graphMgr.renderContext.applyProjectionTransform();
    
    this.graphMgr.renderContext.disable(eRenderMode.DepthTest);
    this.graphMgr.renderContext.disable(eRenderMode.DepthBufferWrite);
    this.graphMgr.renderContext.disable(eRenderMode.Lighting);
    
    var textureColorMask = this.textureColorMask.getValueDirect();
    this.graphMgr.renderContext.setTextureColorMask(textureColorMask.r, textureColorMask.g, textureColorMask.b, textureColorMask.a);
    
    // call base-class implementation
    TriList.prototype.draw.call(this, dissolve);
    
    // restore projection matrix
    this.graphMgr.renderContext.popMatrix();
    this.graphMgr.renderContext.applyProjectionTransform();
    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
    this.graphMgr.renderContext.popMatrix();
    this.graphMgr.renderContext.applyWorldTransform();
    
    this.graphMgr.renderContext.enable(eRenderMode.DepthTest);
    this.graphMgr.renderContext.enable(eRenderMode.DepthBufferWrite);
    this.graphMgr.renderContext.enable(eRenderMode.Lighting);
    
    // reset color mask that won't affect rendering
    this.graphMgr.renderContext.setTextureColorMask(2, 2, 2, 2);
}

ScreenRect.prototype.setTexture = function(texture)
{
    var uvs =
    [
        0, 0,
        0, 1,
        1, 0,
        1, 1
    ];
    
    var uvCoords = this.getUVCoords(texture); 
    uvCoords.setValueDirect(uvs);
}

MorphEffector.prototype = new Evaluator();
MorphEffector.prototype.constructor = MorphEffector;

function MorphEffector()
{
    Evaluator.call(this);
    this.className = "MorphEffector";
    this.attrType = eAttrType.MorphEffector;
    
    this.morphAmt = new NumberAttr(0);
    this.morphIncr = new NumberAttr(0);
    this.sourceVertices = new NumberArrayAttr();
    this.targetVertices = new NumberArrayAttr();
    this.resultVertices = new NumberArrayAttr();
    
    this.registerAttribute(this.morphAmt, "morphAmt");
    this.registerAttribute(this.morphIncr, "morphIncr");
    this.registerAttribute(this.sourceVertices, "sourceVertices");
    this.registerAttribute(this.targetVertices, "targetVertices");
    this.registerAttribute(this.resultVertices, "resultVertices");
}

MorphEffector.prototype.evaluate = function()
{
    // get input values

    // morph amount
    var morphAmt = this.morphAmt.getValueDirect();

    // morph increment
    var morphIncr = this.morphIncr.getValueDirect();

    // increment morph amount by morph increment
    morphAmt += morphIncr;

    // clamp morph amount to range [0, 1]
    morphAmt = clamp(morphAmt, 0, 1);

    // update morph amount attribute value
    this.morphAmt.setValueDirect(morphAmt);

    var sourceVertices = this.sourceVertices.getValueDirect();
    var targetVertices = this.targetVertices.getValueDirect();
    var resultVertices = [];
    
    var count = Math.min(sourceVertices.length, targetVertices.length);
    resultVertices.length = count;
    
    for (var i = 0; i < count; i++)
    {
        resultVertices[i] = (targetVertices[i] - sourceVertices[i]) * morphAmt + sourceVertices[i];
    }
    
    this.resultVertices.setValue(resultVertices);
}

Bone.prototype = new AttributeContainer();
Bone.prototype.constructor = Bone;

function Bone()
{
    AttributeContainer.call(this);
    this.className = "Bone";
    this.attrType = eAttrType.Bone;
    
    this.parent = null;
    this.children = [];
    this.translationMatrix = new Matrix4x4();
    this.rotationMatrix = new Matrix4x4();
    this.rotationQuat = new Quaternion();
    this.scaleMatrix = new Matrix4x4();
    this.pivotMatrix = new Matrix4x4();
    this.matrix = new Matrix4x4();
    this.restMatrix = new Matrix4x4();
    this.restMatrixInv = new Matrix4x4();
    this.parentMatrix = new Matrix4x4();
    this.boneMatrix = new Matrix4x4();
    this.updatePosition = false;
    this.updateRotation = false;
    this.updateScale = false;
    this.updatePivot = false;
    this.updateRestPosition = false;
    this.updateRestRotation = false;
    this.updateRestLength = false;
    this.updateFalloffType = false;
    this.updateParentTransform = false;
    this.updateParentRestTransform = false;
    
    this.name = new StringAttr("");
    this.position = new Vector3DAttr(0, 0, 0);
    this.rotation = new Vector3DAttr(0, 0, 0);
    this.scale = new Vector3DAttr(1, 1, 1);
    this.pivot = new Vector3DAttr(0, 0, 0);
    this.restPosition = new Vector3DAttr(0, 0, 0);
    this.restRotation = new Vector3DAttr(0, 0, 0);
    this.restLength = new NumberAttr(0);
    this.strength = new NumberAttr(0);
    this.falloffType = new NumberAttr(eBoneFalloffType.InverseDistance);
    this.scaleBoneStrength = new BooleanAttr(false);
    this.transform = new Matrix4x4Attr(1, 0, 0, 0,
                                       0, 1, 0, 0,
                                       0, 0, 1, 0,
                                       0, 0, 0, 1);
    this.parentTransform = new Matrix4x4Attr(1, 0, 0, 0,
                                             0, 1, 0, 0,
                                             0, 0, 1, 0,
                                             0, 0, 0, 1);
    this.restTransform = new Matrix4x4Attr(1, 0, 0, 0,
                                           0, 1, 0, 0,
                                           0, 0, 1, 0,
                                           0, 0, 0, 1);
    this.parentRestTransform = new Matrix4x4Attr(1, 0, 0, 0,
                                                 0, 1, 0, 0,
                                                 0, 0, 1, 0,
                                                 0, 0, 0, 1);
    
    this.position.addModifiedCB(Bone_PositionModifiedCB, this);
    this.rotation.addModifiedCB(Bone_RotationModifiedCB, this);
    this.scale.addModifiedCB(Bone_ScaleModifiedCB, this);
    this.pivot.addModifiedCB(Bone_PivotModifiedCB, this);
    this.restPosition.addModifiedCB(Bone_RestPositionModifiedCB, this);
    this.restRotation.addModifiedCB(Bone_RestRotationModifiedCB, this);
    this.restLength.addModifiedCB(Bone_RestLengthModifiedCB, this);
    this.falloffType.addModifiedCB(Bone_FalloffTypeModifiedCB, this);
    this.parentTransform.addModifiedCB(Bone_ParentTransformModifiedCB, this);
    this.parentRestTransform.addModifiedCB(Bone_ParentRestTransformModifiedCB, this);
    
    this.registerAttribute(this.name, "name");
    this.registerAttribute(this.position, "position");
    this.registerAttribute(this.rotation, "rotation");
    this.registerAttribute(this.scale, "scale");
    this.registerAttribute(this.pivot, "pivot");
    this.registerAttribute(this.restPosition, "restPosition");
    this.registerAttribute(this.restRotation, "restRotation");
    this.registerAttribute(this.restLength, "restLength");
    this.registerAttribute(this.strength, "strength");
    this.registerAttribute(this.falloffType, "falloffType");
    this.registerAttribute(this.scaleBoneStrength, "scaleBoneStrength");
}

Bone.prototype.addChild = function(child)
{
    // child can only have one parent
    if (!child || child.parent)
    {
        return false;
    }

    // set child's parent to this
    child.parent = this;

    // set child's parent transform source to this transform
    this.transform.addTarget(child.parentTransform);

    // set child's parent rest tranform source to this rest transform
    this.restTransform.addTarget(child.parentRestTransform);

    this.children.push(child);

    return true;
}

Bone.prototype.removeChild = function(child)
{
    if (!child)
    {
        return false;
    }

    for (var i = 0; i < this.children.length; i++)
    {
        if (this.children[i] == child)
        {
            // clear child's parent
            child.parent = null;
            
            // clear child's parent transform source
            this.transform.removeTarget(child.parentTransform);
            
            // clear child's parent rest transform source
            this.restTransform.removeTarget(child.parentRestTransform);

            // set child's parent transform to identity
            var identity = new Matrix4x4();
            identity.loadIdentity();
            child.parentTransform.setValueDirect(identity);

            // set child's parent rest transform to identity
            child.parentRestTransform.setValueDirect(identity);

            this.children.splice(i, 1);
            
            return true;
        }
    }

    return false;
}

Bone.prototype.getChild = function(n)
{
    if (n >= this.children.length)
    {
        return null;
    }

    return this.children[n];
}
    
Bone.prototype.getChildCount = function()
{
    return this.children.length;
}

Bone.prototype.getParent = function()
{
    return this.parent;
}

Bone.prototype.getScaledStrength = function()
{
    var strength = this.strength.getValueDirect(); 
    if (this.scaleBoneStrength.getValueDirect())
    {
        strength *= this.restLength.getValueDirect();
    }

    return strength;
}

Bone.prototype.calculateFalloffValues = function(vertices)
{
    var bonePos = this.restMatrix.transform(0, 0, 0, 1);

    var boneDir = this.restMatrix.transform(0, 0, 1, 0);

    var restLength = this.restLength.getValueDirect();

    var boneSegment_a = new Vector3D(bonePos.x, bonePos.y, bonePos.z);
    var boneSegment_b = new Vector3D(bonePos.x + boneDir.x * restLength,
                                     bonePos.y + boneDir.y * restLength,
                                     bonePos.z + boneDir.z * restLength);
                                     
    var numVertices = vertices.length / 3;

    var falloffType = this.falloffType.getValueDirect();

    var falloffValues = []; falloffValues.length = numVertices;
    for (var i=0, j=0; i < numVertices; i++, j+=3)
    {
        var distance = distanceBetweenLineSegmentAndPoint(boneSegment_a, boneSegment_b, new Vector3D(vertices[j], vertices[j+1], vertices[j+2]));

        switch (falloffType)
        {
        case eBoneFalloffType.InverseDistance:
            falloffValues[i] = 1 / distance;
            break;

        case eBoneFalloffType.InverseDistance_2:
            falloffValues[i] = 1 / (distance * distance);
            break;

        case eBoneFalloffType.InverseDistance_4:
            falloffValues[i] = 1 / (distance * distance * distance * distance);
            break;

        case eBoneFalloffType.InverseDistance_8:
            falloffValues[i] = 1 / (distance * distance * distance * distance *
                                    distance * distance * distance * distance);
            break;

        case eBoneFalloffType.InverseDistance_16:
            falloffValues[i] = 1 / (distance * distance * distance * distance *
                                    distance * distance * distance * distance *
                                    distance * distance * distance * distance *
                                    distance * distance * distance * distance);  
            break;
        }

        falloffValues[i] *= this.getScaledStrength();
    }
    
    return falloffValues;
}

Bone.prototype.update = function()
{
    var updateBoneMatrix = false;
    
    if (this.updatePosition || this.updateRotation || this.updateScale || this.updatePivot || this.updateParentTransform)
    {
        if (this.updatePosition)
        {
            this.updatePosition = false;

            var position = this.position.getValueDirect();
            this.translationMatrix.loadTranslation(position.x, position.y, position.z);
        }

        if (this.updateRotation)
        {
            this.updateRotation = false;

            var rotation = this.rotation.getValueDirect();
            this.rotationQuat.loadXYZAxisRotation(rotation.x, rotation.y, rotation.z);
            this.rotationMatrix = this.rotationQuat.getMatrix();
        }

        if (this.updateScale)
        {
            this.updateScale = false;

            var scale = this.scale.getValueDirect();
            this.scaleMatrix.loadScale(scale.x, scale.y, scale.z);
        }

        if (this.updatePivot)
        {
            this.updatePivot = false;

            var pivot = this.pivot.getValueDirect();
            this.pivotMatrix.loadTranslation(-pivot.x, -pivot.y, -pivot.z);
        }

        if (this.updateParentTransform)
        {
            this.updateParentTransform = false;

            this.parentMatrix = this.parentTransform.getValueDirect();
        }

        this.matrix = this.pivotMatrix.multiply(this.scaleMatrix.multiply(this.rotationMatrix.multiply(this.translationMatrix.multiply(this.parentMatrix))));

        // set matrix to transform attribute so children will be notified of modification
        this.transform.setValueDirect(this.matrix);

        updateBoneMatrix = true;
    }

    if (this.updateRestPosition || this.updateRestRotation || this.updateParentRestTransform)
    {
        this.updateRestPosition = false;
        this.updateRestRotation = false;
        this.updateParentRestTransform = false;

        var restPosition = this.restPosition.getValueDirect();

        var restPositionMatrix = new Matrix4x4();
        restPositionMatrix.loadTranslation(restPosition.x, restPosition.y, restPosition.z);

        var restRotation = this.restRotation.getValueDirect();

        var restRotationQuat = new Quaternion();
        restRotationQuat.loadXYZAxisRotation(restRotation.x, restRotation.y, restRotation.z);
        var restRotationMatrix = restRotationQuat.getMatrix();

        var parentRestMatrix = this.parentRestTransform.getValueDirect();

        this.restMatrix = restRotationMatrix.multiply(restPositionMatrix.multiply(parentRestMatrix));

        this.restMatrixInv = new Matrix4x4();
        this.restMatrixInv.loadMatrix(this.restMatrix);
        this.restMatrixInv.invert();

        // set rest matrix to rest transform attribute so children will be notified of modification
        this.restTransform.setValueDirect(this.restMatrix);

        updateBoneMatrix = true;
    }

    if (this.updateRestLength)
    {
        this.updateRestLength = false;
    }

    if (updateBoneMatrix)
    {
        this.boneMatrix = this.restMatrixInv.multiply(this.matrix);
    }
}

function Bone_PositionModifiedCB(attribute, container)
{
    container.updatePosition = true;
}

function Bone_RotationModifiedCB(attribute, container)
{
    container.updateRotation = true;
}

function Bone_ScaleModifiedCB(attribute, container)
{
    container.updateScale = true;
}

function Bone_PivotModifiedCB(attribute, container)
{
    container.updatePivot = true;
}

function Bone_RestPositionModifiedCB(attribute, container)
{
    container.updateRestPosition = true;
}

function Bone_RestRotationModifiedCB(attribute, container)
{
    container.updateRestRotation = true;
}

function Bone_RestLengthModifiedCB(attribute, container)
{
    container.updateRestLength = true;
}

function Bone_FalloffTypeModifiedCB(attribute, container)
{
    container.updateFalloffType = true;
}

function Bone_ParentTransformModifiedCB(attribute, container)
{
    container.updateParentTransform = true;
}

function Bone_ParentRestTransformModifiedCB(attribute, container)
{
    container.updateParentRestTransform = true;
}

BoneEffector.prototype = new Evaluator();
BoneEffector.prototype.constructor = BoneEffector;

function BoneEffector()
{
    Evaluator.call(this);
    this.className = "BoneEffector";
    this.attrType = eAttrType.BoneEffector;
    
    this.bones = [];
    this.verticesArray = [];
    this.normalsArray = [];
    this.resultVerticesArray = [];
    this.resultNormalsArray = [];
    this.boneFalloffValuesMap = [];
    this.falloffSums = [];
    this.updateVertices = false;
    this.updateNormals = false;
    
    this.vertices = new NumberArrayAttr();
    this.normals = new NumberArrayAttr();
    this.resultVertices = new NumberArrayAttr();
    this.resultNormals = new NumberArrayAttr();
    
    this.vertices.addModifiedCB(BoneEffector_VerticesModifiedCB, this);
    this.normals.addModifiedCB(BoneEffector_NormalsModifiedCB, this);
    
    this.registerAttribute(this.vertices, "vertices");
    this.registerAttribute(this.normals, "normals");
    this.registerAttribute(this.resultVertices, "resultVertices");
    this.registerAttribute(this.resultNormals, "resultNormals");
}

BoneEffector.prototype.evaluate = function()
{
    if (!(this.enabled.getValueDirect()))
    {
        return;
    }
    
    this.update();

    // update bones
    for (var i=0; i < this.bones.length; i++)
    {
        this.updateBones(this.bones[i]);
    }

    // evaluate bones
    for (var i=0; i < this.bones.length; i++)
    {
        // pass true for "initial" param, so that result arrays will be loaded instead of appended
        this.evaluateBones(this.bones[i], i == 0 ? true : false);
    }

    // output result
    this.resultVertices.setValueDirect(this.resultVerticesArray);
    this.resultNormals.setValueDirect(this.resultNormalsArray);
}

BoneEffector.prototype.addBoneHierarchy = function(root)
{
    if (!root)
    {
        return false;
    }

    this.bones.push(root);

    if (this.verticesArray.length > 0)
    {
        this.calculateFalloffValues();
    }

    return true;
}

BoneEffector.prototype.update = function()
{
    if (this.updateVertices)
    {
        this.updateVertices = false;

        this.verticesArray = this.vertices.getValueDirect();
        this.resultVerticesArray.length = this.verticesArray.length;
        
        this.calculateFalloffValues();
    }

    if (this.updateNormals)
    {
        this.updateNormals = false;

        this.normalsArray = this.normals.getValueDirect();
        this.resultNormalsArray.length = this.normalsArray.length;
    }
}

BoneEffector.prototype.calculateFalloffValues = function()
{
    this.boneFalloffValuesMap = [];
    for (var i=0; i < this.bones.length; i++)
    {
        this.updateBones(this.bones[i]);
        this.calculateBoneFalloffValues(this.bones[i]);
    }

    this.sumFalloffValues();
}

BoneEffector.prototype.calculateBoneFalloffValues = function(root)
{
    if (!root || this.verticesArray.length == 0)
    {
        return;
    }

    var falloffValues = root.calculateFalloffValues(this.verticesArray);
    this.boneFalloffValuesMap.push(new Pair(root, falloffValues));

    // recurse on children
    for (var i=0; i < root.getChildCount(); i++)
    {
        var child = root.getChild(i);
        if (!child)
        {
            continue;
        }

        this.calculateBoneFalloffValues(child);
    }
}

BoneEffector.prototype.sumFalloffValues = function()
{
    if (this.verticesArray.length == 0)
    {
        return;
    }

    var numVertices = this.verticesArray.length / 3;

    // sum falloff values
    this.falloffSums.length = numVertices;
    for (var i=0; i < numVertices; i++) this.falloffSums[i] = 0;
    for (var i=0; i < this.boneFalloffValuesMap.length; i++)
    {
        var boneFalloffValues = this.boneFalloffValuesMap[i].second;
        for (var j=0; j < numVertices; j++)
        {
            this.falloffSums[j] += boneFalloffValues[j];
        }
    }

    // divide falloff values by sum
    for (var i=0; i < this.boneFalloffValuesMap.length; i++)
    {
        var boneFalloffValues = this.boneFalloffValuesMap[i].second;

        for (var j=0; j < numVertices; j++)
        {
            if (this.falloffSums[j] != 0)
            {
                boneFalloffValues[j] /= this.falloffSums[j];
            }
            else // this.falloffSums[j] == 0
            {
                boneFalloffValues[j] = 0;
            }
        }
    }
}

BoneEffector.prototype.updateBones = function(root)
{
    if (!root)
    {
        return;
    }

    root.update();

    // recurse on children
    for (var i=0; i < root.getChildCount(); i++)
    {
        var child = root.getChild(i);
        if (!child)
        {
            continue;
        }

        this.updateBones(child);
    }
}

BoneEffector.prototype.evaluateBones = function(root, initial)
{
    if (!root)
    {
        return;
    }

    // get bone falloff values
    var boneFalloffValues = null;
    for (var i=0; i < this.boneFalloffValuesMap.length; i++)
    {
        if (this.boneFalloffValuesMap[i].first == root)
        {
            boneFalloffValues = this.boneFalloffValuesMap[i].second;
            break;
        }
    }
    
    // get bone transform
    var boneTransform = root.boneMatrix;

    // transform vertices
    var numVertices = this.verticesArray.length / 3;
    for (var i=0, j=0; i < numVertices; i++, j+=3)
    {
        if (boneFalloffValues[i] > 0)
        {
            var xformed = boneTransform.transform(this.verticesArray[j], this.verticesArray[j+1], this.verticesArray[j+2], 1);

            if (initial)
            {
                this.resultVerticesArray[j  ] = xformed.x * boneFalloffValues[i];
                this.resultVerticesArray[j+1] = xformed.y * boneFalloffValues[i];
                this.resultVerticesArray[j+2] = xformed.z * boneFalloffValues[i];
            }
            else // !initial
            {
                this.resultVerticesArray[j  ] += xformed.x * boneFalloffValues[i];
                this.resultVerticesArray[j+1] += xformed.y * boneFalloffValues[i];
                this.resultVerticesArray[j+2] += xformed.z * boneFalloffValues[i];
            }
        }
        else // boneFalloffValues[i] == 0
        {
            // use untransformed vertex
            this.resultVerticesArray[j  ] = this.verticesArray[j  ];
            this.resultVerticesArray[j+1] = this.verticesArray[j+1];
            this.resultVerticesArray[j+2] = this.verticesArray[j+2];
        }
    }

    // transform normals
    var numNormals = this.normalsArray.length / 3;
    for (var i=0, j=0; i < numNormals; i++, j+=3)
    {
        if (boneFalloffValues[i] > 0)
        {
            var xformed = boneTransform.transform(this.normalsArray[j], this.normalsArray[j+1], this.normalsArray[j+2], 0);

            if (initial)
            {
                this.resultNormalsArray[j  ] = xformed.x * boneFalloffValues[i];
                this.resultNormalsArray[j+1] = xformed.y * boneFalloffValues[i];
                this.resultNormalsArray[j+2] = xformed.z * boneFalloffValues[i];
            }
            else // !initial
            {
                this.resultNormalsArray[j  ] += xformed.x * boneFalloffValues[i];
                this.resultNormalsArray[j+1] += xformed.y * boneFalloffValues[i];
                this.resultNormalsArray[j+2] += xformed.z * boneFalloffValues[i];
            }
        }
        else // boneFalloffValues[i] == 0
        {
            // use untransformed normal
            this.resultNormalsArray[j  ] = this.normalsArray[j  ];
            this.resultNormalsArray[j+1] = this.normalsArray[j+1];
            this.resultNormalsArray[j+2] = this.normalsArray[j+2];
        }
    }

    // recurse on children
    for (var i=0; i < root.getChildCount(); i++)
    {
        var child = root.getChild(i);
        if (!child)
        {
            continue;
        }

        this.evaluateBones(child);
    }
}

function BoneEffector_VerticesModifiedCB(attribute, container)
{
    container.updateVertices = true;
}

function BoneEffector_NormalsModifiedCB(attribute, container)
{
    container.updateNormals = true;
}

Cube.prototype = new TriList();
Cube.prototype.constructor = Cube;

function Cube()
{
    TriList.call(this);
    this.className = "Cube";
    this.attrType = eAttrType.Cube;
    
    this.updateTriList = true; // update once
    
    this.transform = new Matrix4x4();
    this.updateTransform = false;
    
    this.materialNode = new Material();
    this.updateMaterial = false;
    
    this.color = new ColorAttr(1, 1, 1, 1);
    this.opacity = new NumberAttr(1);
    this.position = new Vector3DAttr(0, 0, 0);
    this.rotation = new Vector3DAttr(0, 0, 0);
    this.scale = new Vector3DAttr(1, 1, 1);
    
    this.color.addModifiedCB(Cube_MaterialModifiedCB, this);
    this.opacity.addModifiedCB(Cube_MaterialModifiedCB, this);
    this.position.addModifiedCB(Cube_PositionModifiedCB, this);
    this.rotation.addModifiedCB(Cube_RotationModifiedCB, this);
    this.scale.addModifiedCB(Cube_ScaleModifiedCB, this);
    
    this.registerAttribute(this.color, "color");
    this.registerAttribute(this.opacity, "opacity");
    this.registerAttribute(this.position, "position");
    this.registerAttribute(this.rotation, "rotation");
    this.registerAttribute(this.scale, "scale");
    
    var vertices = 
    [
        -0.25, -0.25, 0.25, -0.25, 0.25, 0.25, -0.25, 0.25, -0.25, -0.25, -0.25, -0.25, -0.25, -0.25, 0.25, -0.25, 0.25, -0.25,
        0.25, -0.25, -0.25, 0.25, -0.25, 0.25, -0.25, -0.25, 0.25, -0.25, -0.25, -0.25, 0.25, -0.25, -0.25, -0.25, -0.25, 0.25,
        0.25, -0.25, -0.25, -0.25, 0.25, -0.25, 0.25, 0.25, -0.25, 0.25, -0.25, -0.25, -0.25, -0.25, -0.25, -0.25, 0.25, -0.25,
        0.25, -0.25, 0.25, 0.25, 0.25, -0.25, 0.25, 0.25, 0.25, 0.25, -0.25, -0.25, 0.25, 0.25, -0.25, 0.25, -0.25, 0.25,
        0.25, 0.25, -0.25, -0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, -0.25, -0.25, 0.25, -0.25, -0.25, 0.25, 0.25,
        0.25, -0.25, 0.25, 0.25, 0.25, 0.25, -0.25, 0.25, 0.25, -0.25, -0.25, 0.25, 0.25, -0.25, 0.25, -0.25, 0.25, 0.25
    ];
    
    var normals =
    [
        -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0,
        0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0,
        0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1,
        1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0,
        0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0,
        0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1
    ];
    
    this.vertices.setValue(vertices);
    this.normals.setValue(normals);
    
    this.color.addTarget(this.materialNode.getAttribute("color"));
    this.opacity.addTarget(this.materialNode.getAttribute("opacity"));
}

Cube.prototype.setGraphMgr = function(graphMgr)
{
    // call base-class implementation
    TriList.prototype.setGraphMgr.call(this, graphMgr);

    this.materialNode.setGraphMgr(graphMgr);
}
            
Cube.prototype.update = function(params, visitChildren)
{
    if (this.updateTransform)
    {
        this.updateTransform = false;
 
        var position = this.position.getValueDirect();
        var translationMatrix = new Matrix4x4();
        translationMatrix.loadTranslation(position.x, position.y, position.z);
        
        var rotation = this.rotation.getValueDirect();
        var rotationMatrix = new Matrix4x4();
        rotationMatrix.loadXYZAxisRotation(rotation.x, rotation.y, rotation.z);
        
        var scale = this.scale.getValueDirect();
        var scaleMatrix = new Matrix4x4();
        scaleMatrix.loadScale(scale.x, scale.y, scale.z);
        
        this.transform.loadMatrix(scaleMatrix.multiply(rotationMatrix.multiply(translationMatrix)));
    }
    
    if (this.updateMaterial)
    {
        this.updateMaterial = false;       
        this.materialNode.update(params, visitChildren);
    }

    if (this.updateTriList)
    {
        this.updateTriList = false;
        TriList.prototype.update.call(this, params, visitChildren);
    }
}

Cube.prototype.apply = function(directive, params, visitChildren)
{
    var show = this.show.getValueDirect();
    var enabled = this.enabled.getValueDirect();
    if (!show || !enabled)
    {
        return;
    }
    
    switch (directive)
    {
        case "render":
        case "shadow":
            {
                this.materialNode.apply(directive, params, visitChildren);
                this.draw(params.dissolve);
            }
            break;
    }
}

Cube.prototype.draw = function(dissolve)
{
    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
    this.graphMgr.renderContext.pushMatrix();

    this.graphMgr.renderContext.leftMultMatrix(this.transform);
    this.graphMgr.renderContext.applyWorldTransform();
    
    // draw primitives
    this.vertexBuffer.draw();
    
    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
    this.graphMgr.renderContext.popMatrix();
    this.graphMgr.renderContext.applyWorldTransform();
}

function Cube_PositionModifiedCB(attribute, container)
{
    container.updateTransform = true;
}

function Cube_RotationModifiedCB(attribute, container)
{
    container.updateTransform = true;
}

function Cube_ScaleModifiedCB(attribute, container)
{
    container.updateTransform = true;
}

function Cube_MaterialModifiedCB(attribute, container)
{
    container.updateMaterial = true;
}
SnapConnector.prototype = new AttributeContainer();
SnapConnector.prototype.constructor = SnapConnector;

function SnapConnector()
{
    AttributeContainer.call(this);
    this.className = "SnapConnector";
    this.attrType = eAttrType.SnapConnector;

    this.name = new StringAttr();
    this.type = new StringAttr("default");
    this.normal = new Vector3DAttr(0, 0, 0);
    this.connected = new BooleanAttr(false);

    this.registerAttribute(this.name, "name");
    this.registerAttribute(this.type, "type");
    this.registerAttribute(this.normal, "normal");
    this.registerAttribute(this.connected, "connected");
}

GenericConnector.prototype = new SnapConnector();
GenericConnector.prototype.constructor = GenericConnector;

function GenericConnector()
{
    SnapConnector.call(this);
    this.className = "GenericConnector";
    this.attrType = eAttrType.GenericConnector;

    this.point = new SphereAttr();

    this.registerAttribute(this.point, "point");
}

GenericConnector.prototype.collides = function(genericConnector, colliderWorldMatrix, collideeWorldMatrix)
{
    // check point/point
    this.point.sphere.setTransform(colliderWorldMatrix);
    genericConnector.point.sphere.setTransform(collideeWorldMatrix);

    if (this.point.sphere.intersects(genericConnector.point.sphere))
    {
        return 1;
    }

    // no collision detected
    return 0;
}

GenericConnectors.prototype = new AttributeVector();
GenericConnectors.prototype.constructor = GenericConnectors;

function GenericConnectors()
{
    AttributeVector.call(this, new GenericConnectorAllocator());
    this.className = "GenericConnectors";
    this.attrType = eAttrType.GenericConnectors;

    this.appendParsedElements.setValueDirect(true);
}

GenericConnectors.prototype.get = function(name)
{
    var length = this.Size();
    for (var i = 0; i < length; i++)
    {
        var connector = this.getAt(i);
        if (connector.getAttribute("name").getValueDirect().join("") == name)
        {
            return connector;
        }
    }
    
    return null;
}
    
GenericConnectorAllocator.prototype = new Allocator();
GenericConnectorAllocator.prototype.constructor = GenericConnectorAllocator;

function GenericConnectorAllocator()
{
}

GenericConnectorAllocator.prototype.allocate = function ()
{
    return new GenericConnector();
}

SocketConnector.prototype = new SnapConnector();
SocketConnector.prototype.constructor = SocketConnector;

function SocketConnector()
{
    SnapConnector.call(this);
    this.className = "SocketConnector";
    this.attrType = eAttrType.SocketConnector;

    this.slot = 0;
    
    this.slot1 = new SphereAttr();
    this.slot2 = new SphereAttr();

    this.registerAttribute(this.slot1, "slot1");
    this.registerAttribute(this.slot2, "slot2");
}

SocketConnectors.prototype = new AttributeVector();
SocketConnectors.prototype.constructor = SocketConnectors;

function SocketConnectors()
{
    AttributeVector.call(this, new SocketConnectorAllocator());
    this.className = "SocketConnectors";
    this.attrType = eAttrType.SocketConnectors;

    this.appendParsedElements.setValueDirect(true);
}

SocketConnectors.prototype.get = function(name)
{
    var length = this.Size();
    for (var i = 0; i < length; i++)
    {
        var connector = this.getAt(i);
        if (connector.getAttribute("name").getValueDirect().join("") == name)
        {
            return connector;
        }
    }
    
    return null;
}

SocketConnectorAllocator.prototype = new Allocator();
SocketConnectorAllocator.prototype.constructor = SocketConnectorAllocator;

function SocketConnectorAllocator()
{
}

SocketConnectorAllocator.prototype.allocate = function ()
{
    return new SocketConnector();
}

PlugConnector.prototype = new SnapConnector();
PlugConnector.prototype.constructor = PlugConnector;

function PlugConnector()
{
    SnapConnector.call(this);
    this.className = "PlugConnector";
    this.attrType = eAttrType.PlugConnector;

    this.pin1 = new SphereAttr();
    this.pin2 = new SphereAttr();

    this.registerAttribute(this.pin1, "pin1");
    this.registerAttribute(this.pin2, "pin2");
}

PlugConnector.prototype.collides = function(socketConnector, plugWorldMatrix, socketWorldMatrix)
{
    // check pin1/socket1
    this.pin1.sphere.setTransform(plugWorldMatrix);
    socketConnector.slot1.sphere.setTransform(socketWorldMatrix);

    if (this.pin1.sphere.intersects(socketConnector.slot1.sphere))
    {
        return 1;
    }

    // check pin2/socket2
    this.pin2.sphere.setTransform(plugWorldMatrix);
    socketConnector.slot2.sphere.setTransform(socketWorldMatrix);

    if (this.pin2.sphere.intersects(socketConnector.slot2.sphere))
    {
        return 2;
    }

    // no collision detected
    return 0;
}

PlugConnectors.prototype = new AttributeVector();
PlugConnectors.prototype.constructor = PlugConnectors;

function PlugConnectors()
{
    AttributeVector.call(this, new PlugConnectorAllocator());
    this.className = "PlugConnectors";
    this.attrType = eAttrType.PlugConnectors;

    this.appendParsedElements.setValueDirect(true);
}

PlugConnectors.prototype.get = function(name)
{
    var length = this.Size();
    for (var i = 0; i < length; i++)
    {
        var connector = this.getAt(i);
        if (connector.getAttribute("name").getValueDirect().join("") == name)
        {
            return connector;
        }
    }
    
    return null;
}

PlugConnectorAllocator.prototype = new Allocator();
PlugConnectorAllocator.prototype.constructor = PlugConnectorAllocator;

function PlugConnectorAllocator()
{
}

PlugConnectorAllocator.prototype.allocate = function ()
{
    return new PlugConnector();
}



PhysicsSimulator.prototype = new Evaluator();
PhysicsSimulator.prototype.constructor = PhysicsSimulator;

function PhysicsSimulator()
{
    Evaluator.call(this);
    this.className = "PhysicsSimulator";
    this.attrType = eAttrType.PhysicsSimulator;

    this.collisionConfiguration = null;
    this.dispatcher = null;
    this.overlappingPairCache = null;
    this.solver = null;
    this.world = null;
    this.physicsBodies = [];
    this.physicsShapes = [];
    this.bodyAdded = [];
    this.bodyModels = [];
    this.updateWorld = false;
    this.updateBodies = false;
    this.updateBodyPositions = [];
    this.lastBodies = [];
    this.evaluating = false;
    this.selector = null;

    this.timeIncrement = new NumberAttr(0);
    this.timeScale = new NumberAttr(1);
    this.gravity = new Vector3DAttr(0, -9.8, 0);
    this.worldHalfExtents = new Vector3DAttr(10000, 10000, 10000); // TODO: does this need to be configurable? 
    this.bodies = new AttributeVector(new StringAttrAllocator());

    this.bodies.getAttribute("appendParsedElements").setValueDirect(true);

    this.gravity.addModifiedCB(PhysicsSimulator_GravityModifiedCB, this);
    this.bodies.addModifiedCB(PhysicsSimulator_BodiesModifiedCB, this);
    this.enabled.addModifiedCB(PhysicsSimulator_EnabledModifiedCB, this);

    this.registerAttribute(this.timeIncrement, "timeIncrement");
    this.registerAttribute(this.timeScale, "timeScale");
    this.registerAttribute(this.gravity, "gravity");
    this.registerAttribute(this.worldHalfExtents, "worldHalfExtents");
    this.registerAttribute(this.bodies, "bodies");

    this.name.setValueDirect("PhysicsSimulator");

    this.initPhysics();
}

PhysicsSimulator.prototype.setRegistry = function(registry)
{
    // use Bridgeworks' physics simulator for collision detection
    var bworks = registry.find("Bridgeworks");
    this.selector = bworks.selector;
    
    // call base-class implementation
    SGDirective.prototype.setRegistry.call(this, registry);
}

PhysicsSimulator.prototype.evaluate = function()
{
    if (!(this.enabled.getValueDirect()))
    {
        return;
    }
    
    this.evaluating = true;
    
    var selected = this.selector.selected;
    if (selected)
    {
        var index = this.getPhysicsBodyIndex(selected);
        if (index >= 0 && this.bodyAdded[index])
        {
            // set body gravity to 0 so that it won't be affected by it during interaction
            var zero = new Ammo.btVector3(0, 0, 0);
            this.physicsBodies[index].setGravity(zero);
            Ammo.destroy(zero);
            // stop positional updates 
            this.bodyAdded[index] = false;
        }
    }
    
    // add/remove bodies based on selection state (allows for object inspection)
    for (var i = 0; i < this.bodyAdded.length; i++)
    {
        // if not added, update its position and add
        if (!this.bodyAdded[i])
        {
            if (this.bodyModels[i] != selected)
            {
                this.bodyAdded[i] = true;
                if (this.bodyModels[i].physicsEnabled.getValueDirect())
                {
                    var gravity = this.gravity.getValueDirect();
                    var world = new Ammo.btVector3(gravity.x, gravity.y, gravity.z);
                    this.physicsBodies[i].setGravity(world);
                    Ammo.destroy(world);
                    this.updatePhysicsBodyPosition(i, false);
                }
            }
        }
    }
   
    this.stepSimulation();
    
    var trans = new Ammo.btTransform();
    //var worldHalfExtents = this.worldHalfExtents.getValueDirect();
    //var modelsOutOfBounds = [];
    for (var i = 0; i < this.physicsBodies.length; i++)
    {
        var physicsEnabled = this.bodyModels[i].physicsEnabled.getValueDirect();
        if (!this.bodyAdded[i] || !physicsEnabled)
            continue;

        this.physicsBodies[i].getMotionState().getWorldTransform(trans);
        var origin = trans.getOrigin();
        var position = new Vector3D(origin.x(), origin.y(), origin.z());

        var rot = trans.getRotation();
        var quat = new Quaternion();
        quat.load(rot.w(), rot.x(), rot.y(), rot.z());
    
        this.bodyModels[i].getAttribute("position").setValueDirect(position.x, position.y, position.z);
        this.bodyModels[i].getAttribute("quaternion").setValueDirect(quat);
        /*
        // if object has moved outside of the world boundary, remove it from the simulation
        if (position.x < -worldHalfExtents.x || position.x > worldHalfExtents.x ||
            position.y < -worldHalfExtents.y || position.y > worldHalfExtents.y ||
            position.z < -worldHalfExtents.z || position.z > worldHalfExtents.z)
        {
            modelsOutOfBounds.push(this.bodyModels[i]);
        }*/
    }
    Ammo.destroy(trans);
    /*
    // remove any models that have moved outside of the world boundary
    for (var i = 0; i < modelsOutOfBounds.length; i++)
    {
        this.deletePhysicsBody(modelsOutOfBounds[i]);
    }
    */
    this.evaluating = false;
}

PhysicsSimulator.prototype.update = function()
{
    if (this.updateWorld)
    {
        this.updateWorld = false;
        this.updateBodies = true;
        this.initPhysics();
    }

    if (this.updateBodies)
    {
        this.updateBodies = false;
        this.updatePhysicsBodies();
        
        this.lastBodies = [];
        for (var i = 0; i < this.bodies.Size(); i++)
        {
            this.lastBodies.push(this.bodies.getAt(i));
        }
    }
    
    while (this.updateBodyPositions.length > 0)
    {
        this.updatePhysicsBodyPosition(this.updateBodyPositions[0], true);
    }
}

PhysicsSimulator.prototype.stepSimulation = function(timeIncrement, maxSubSteps)
{
    timeIncrement = timeIncrement || this.timeIncrement.getValueDirect() * this.timeScale.getValueDirect();
    maxSubSteps = 1;//maxSubSteps || 10;
    
    this.update();
    this.world.stepSimulation(timeIncrement, maxSubSteps);
}

PhysicsSimulator.prototype.detectCollisions = function()
{
    this.update();
    this.stepSimulation(0.0001, 1);
    //this.world.performDiscreteCollisionDetection();
}
    
PhysicsSimulator.prototype.isColliding = function(model)
{
    // if model is parented, get parent
    while (model.motionParent)
    {
        model = model.motionParent;
    }
    
    // find physics body corresponding to model
    var physicsBody = this.getPhysicsBody(model);
    if (physicsBody)
    {
        var numManifolds = this.world.getDispatcher().getNumManifolds();
        for (var i = 0; i < numManifolds; i++)
        {
            var contactManifold = this.world.getDispatcher().getManifoldByIndexInternal(i);
            var body0 = contactManifold.getBody0();
            var body1 = contactManifold.getBody1();
            
            var a, b, distance;
            var numContacts = contactManifold.getNumContacts();
            for (var j = 0; j < numContacts; j++)
            {
                var pt = contactManifold.getContactPoint(j);
                var ptA = pt.getPositionWorldOnA();
                var ptB = pt.getPositionWorldOnB();

                a = new Vector3D(ptA.x(), ptA.y(), ptA.z());
                b = new Vector3D(ptB.x(), ptB.y(), ptB.z());
            
                distance = Math.min(distanceBetween(new Vector3D(ptA.x(), ptA.y(), ptA.z()), new Vector3D(ptB.x(), ptB.y(), ptB.z()), distance));
                if (distance < 0.01) continue; // don't consider very small distances
                            
                if (body0.ptr == physicsBody.ptr)
                {
                    if (a.y > 0) continue; // don't consider "collisions" outside of the collidee
                    /*
                    var collidee = null;
                    for (var j = 0; j < this.physicsBodies.length; j++)
                    {
                        if (body1.ptr == this.physicsBodies[j].ptr)
                        {
                            collidee = this.bodyModels[j];                                                      
                            //console.log(distance);               
                            //break;
                        }
                    }*/
                }
                else if (body1.ptr == physicsBody.ptr)
                {
                    if (b.y > 0) continue; // don't consider "collisions" outside of the collidee
                    /*
                    for (var j = 0; j < this.physicsBodies.length; j++)
                    {
                        if (body0.ptr == this.physicsBodies[j].ptr)
                        {
                            collidee = this.bodyModels[j];
                            
                            //console.log(distance);               
                            //break;
                        }
                    }*/
                }
                                   
                return { colliding: true, distance: distance };
            }
        }
    }

    return { colliding: false, distance: FLT_MAX };
}

PhysicsSimulator.prototype.getColliders = function(model)
{
    var colliders = [];

    // if model is parented, get parent
    while (model.motionParent)
    {
        model = model.motionParent;
    }

    // find physics body corresponding to model
    var physicsBody = this.getPhysicsBody(model);
    if (physicsBody)
    {
        var numManifolds = this.world.getDispatcher().getNumManifolds();
        for (var i = 0; i < numManifolds; i++)
        {
            var contactManifold = this.world.getDispatcher().getManifoldByIndexInternal(i);
            var body0 = contactManifold.getBody0();
            var body1 = contactManifold.getBody1();
            
            //var distance = FLT_MAX;
            var numContacts = contactManifold.getNumContacts();
            /*for (var j = 0; j < numContacts; j++)
            {
                var pt = contactManifold.getContactPoint(j);
                var ptA = pt.getPositionWorldOnA();
                var ptB = pt.getPositionWorldOnB();

                var distance = Math.min(distanceBetween(new Vector3D(ptA.x(), ptA.y(), ptA.z()), new Vector3D(ptB.x(), ptB.y(), ptB.z()), distance));
                //console.log(distance);               
            }
            */
            //if (distance < 0.05)
            if (numContacts > 0)
            {
                if (body0.ptr == physicsBody.ptr)
                {
                    colliders.push(this.getBodyModel(body1));
                }
                else if (body1.ptr == physicsBody.ptr)
                {
                    colliders.push(this.getBodyModel(body0));
                }
            }
        }
    }

    return colliders;
}

PhysicsSimulator.prototype.getPhysicsBody = function(bodyModel)
{
    for (var i = 0; i < this.bodyModels.length; i++)
    {
        if (this.bodyModels[i] == bodyModel)
        {
            return this.physicsBodies[i];
        }
    }

    return null;
}

PhysicsSimulator.prototype.getPhysicsBodyIndex = function(bodyModel)
{
    return this.bodyModels.indexOf(bodyModel);
}

PhysicsSimulator.prototype.getBodyModel = function(physicsBody)
{
    for (var i = 0; i < this.physicsBodies.length; i++)
    {
        if (this.physicsBodies[i].ptr == physicsBody.ptr)
        {
            return this.bodyModels[i];
        }
    }

    return null;
}
    
PhysicsSimulator.prototype.updatePhysicsBodies = function()
{
    var i;
    
    // determine changes between lastBodies and bodies
    var added = [];
    for (i = 0; i < this.bodies.Size(); i++)
    {
        var body = this.bodies.getAt(i);
        var index = this.lastBodies.indexOf(body);
        if (index < 0)
        {
            added.push(body);
        }
    }
    var removed = [];
    for (i = 0; i < this.lastBodies.length; i++)
    {
        var body = this.lastBodies[i];
        var index = this.bodies.indexOf(body);
        if (index < 0)
        {
            for (j = 0; j < this.bodyModels.length; j++)
            {
                if (this.bodyModels[j].name == body)
                {
                    removed.push(this.bodyModels[j]);
                    break;
                }
            }
        }
    }
    
    // remove any removed bodies
    for (i = 0; i < removed.length; i++)
    {
        this.deletePhysicsBody(removed[i]);
    }

    // add any added bodies to world
    for (var i = 0; i < added.length; i++)
    {
        var name = added[i].getValueDirect().join("");
        var model = this.registry.find(name);
        if (model)
        {
            this.createPhysicsBody(model);
        }
    }
}

PhysicsSimulator.prototype.createPhysicsBody = function(model)
{
    if (!model)
        return;

    // watch for changes in vertices
    model.getAttribute("vertices").addModifiedCB(PhysicsSimulator_ModelVerticesModifiedCB, this);
    model.getAttribute("position").addModifiedCB(PhysicsSimulator_ModelPositionModifiedCB, this);
    model.getAttribute("rotation").addModifiedCB(PhysicsSimulator_ModelRotationModifiedCB, this);
    model.getAttribute("quaternion").addModifiedCB(PhysicsSimulator_ModelQuaternionModifiedCB, this);
    // watch for changes in scale
    model.getAttribute("scale").addModifiedCB(PhysicsSimulator_ModelScaleModifiedCB, this);
    // watch for changes in parent
    model.getAttribute("parent").addModifiedCB(PhysicsSimulator_ModelParentModifiedCB, this);
    // watch for changes in enabled
    model.getAttribute("enabled").removeModifiedCB(PhysicsSimulator_ModelEnabledModifiedCB, this); // ensure no dups (not removed by delete)
    model.getAttribute("enabled").addModifiedCB(PhysicsSimulator_ModelEnabledModifiedCB, this);
    // watch for changes in physical properties
    model.getAttribute("physicalProperties").addModifiedCB(PhysicsSimulator_ModelPhysicalPropertiesModifiedCB, this);

    // if model is disabled, don't create
    if (model.getAttribute("enabled").getValueDirect() == false)
        return;
    
    // if model is parented, don't add here; it will be added as a shape to the parent model's body
    if (model.motionParent)
        return;

    var shape = this.getCompoundShape(model);

    var properties = this.getNetProperties(model);

    var transform = new Ammo.btTransform();
    transform.setIdentity();

    var position = model.getAttribute("position").getValueDirect();
    var vector = new Ammo.btVector3(position.x, position.y, position.z);
    transform.setOrigin(vector);
    Ammo.destroy(vector);

    var quat = model.getAttribute("quaternion").getValueDirect();
    var quaternion = new Ammo.btQuaternion(quat.x, quat.y, quat.z, quat.w);
    transform.setRotation(quaternion);
    Ammo.destroy(quaternion);

    var isDynamic = (properties.mass != 0);
    var localInertia = new Ammo.btVector3(0, 0, 0);
    if (isDynamic)
    {
        shape.calculateLocalInertia(properties.mass, localInertia);
    }

    var motionState = new Ammo.btDefaultMotionState(transform);
    Ammo.destroy(transform);
    var rbInfo = new Ammo.btRigidBodyConstructionInfo(properties.mass, motionState, shape, localInertia);
    rbInfo.set_m_friction(properties.friction);
    rbInfo.set_m_restitution(properties.restitution);
    rbInfo.set_m_linearDamping(properties.linearDamping);
    rbInfo.set_m_angularDamping(properties.angularDamping);
    rbInfo.set_m_rollingFriction(properties.rollingFriction);
    Ammo.destroy(localInertia);
    var body = new Ammo.btRigidBody(rbInfo);
    Ammo.destroy(rbInfo);
    
    this.world.addRigidBody(body);
    //if (isDynamic)
    {
        this.bodyModels.push(model);
        this.physicsShapes.push(shape);
        this.physicsBodies.push(body);
        this.bodyAdded.push(true);
    }
}

PhysicsSimulator.prototype.deletePhysicsBodies = function()
{
    while (this.bodyModels.length > 0)
    {
        this.deletePhysicsBody(this.bodyModels[0]);
    }
}

PhysicsSimulator.prototype.deletePhysicsBody = function(model)
{
    for (var i = 0; i < this.bodyModels.length; i++)
    {
        if (this.bodyModels[i] == model)
        {
            this.bodyModels[i].getAttribute("vertices").removeModifiedCB(PhysicsSimulator_ModelVerticesModifiedCB, this);
            this.bodyModels[i].getAttribute("position").removeModifiedCB(PhysicsSimulator_ModelPositionModifiedCB, this);
            this.bodyModels[i].getAttribute("rotation").removeModifiedCB(PhysicsSimulator_ModelRotationModifiedCB, this);
            this.bodyModels[i].getAttribute("quaternion").removeModifiedCB(PhysicsSimulator_ModelQuaternionModifiedCB, this);
            this.bodyModels[i].getAttribute("scale").removeModifiedCB(PhysicsSimulator_ModelScaleModifiedCB, this);
            this.bodyModels[i].getAttribute("parent").removeModifiedCB(PhysicsSimulator_ModelParentModifiedCB, this);
            //this.bodyModels[i].getAttribute("enabled").removeModifiedCB(PhysicsSimulator_ModelEnabledModifiedCB, this);
            this.world.removeRigidBody(this.physicsBodies[i]);
            Ammo.destroy(this.physicsShapes[i]);
            Ammo.destroy(this.physicsBodies[i].getMotionState());
            Ammo.destroy(this.physicsBodies[i]);
            this.physicsBodies.splice(i, 1);
            this.physicsShapes.splice(i, 1);
            this.bodyModels.splice(i, 1);
            this.bodyAdded.splice(i, 1);
            return;
        }
    }
}

PhysicsSimulator.prototype.getCompoundShape = function(model)
{
    var compoundShape = new Ammo.btCompoundShape();
    
    var position = new Vector3D();
    var rotation = new Vector3D();
    var scale = model.getAttribute("scale").getValueDirect();
    this.addCollisionShape(model, position, rotation, scale, compoundShape);

    return compoundShape;
}

PhysicsSimulator.prototype.addCollisionShape = function(model, position, rotation, scale, compoundShape)
{
    // get collision shape(s)
    this.getCollisionShape(model, position, rotation, scale, compoundShape);
    
    // recurse on motion children
    for (var i = 0; i < model.motionChildren.length; i++)
    {
        var child = model.motionChildren[i];

        var childPosition = child.getAttribute("position").getValueDirect();
        childPosition.x += position.x;
        childPosition.y += position.y;
        childPosition.z += position.z;

        var childRotation = child.getAttribute("rotation").getValueDirect();
        childRotation.x += rotation.x;
        childRotation.y += rotation.y;
        childRotation.z += rotation.z;

        var childScale = child.getAttribute("scale").getValueDirect();
        childScale.x *= scale.x;
        childScale.y *= scale.y;
        childScale.z *= scale.z;

        this.addCollisionShape(child, childPosition, childRotation, childScale, compoundShape);
    }
}

PhysicsSimulator.prototype.getCollisionShape = function(model, position, rotation, scale, compoundShape)
{
    switch (model.attrType)
    {
        case eAttrType.Model:
        case eAttrType.Box:
        case eAttrType.Beam:       
        case eAttrType.Plank:    
        case eAttrType.Wall:
            shapes = this.getBoxCollisionShape(model, position, rotation, scale, compoundShape);
            break;
            
        case eAttrType.Ball:
            shapes = this.getSphereCollisionShape(model, position, rotation, scale, compoundShape);
            break;
        
        case eAttrType.Elbow:
        case eAttrType.Gear:
        case eAttrType.Pyramid:
        case eAttrType.Ring:
        case eAttrType.Tube:
        case eAttrType.Wedge:
        case eAttrType.SnapModel:
        default:
            shapes = this.getConvexCollisionShape(model, position, rotation, scale, compoundShape);
            break;
    }
}

PhysicsSimulator.prototype.getConvexCollisionShape = function(model, position, rotation, scale, compoundShape)
{
    var shapes = [];
    
    for (var i = 0; i < model.surfaces.length; i++)
    {
        var verts = model.surfaces[i].getAttribute("vertices").getValueDirect();
        if (verts.length == 0) continue;

        // scale vertices
        var scaleMatrix = new Matrix4x4();
        scaleMatrix.loadScale(scale.x, scale.y, scale.z);
        var matrix = scaleMatrix;

        var shape = new Ammo.btConvexHullShape();

        for (var j = 0; j < verts.length; j += 3)
        {
            var vert = matrix.transform(verts[j], verts[j + 1], verts[j + 2], 1);
            var point = new Ammo.btVector3(vert.x, vert.y, vert.z);
            shape.addPoint(point);
            Ammo.destroy(point);
        }
        
        shapes.push(shape);
    }

    // add shape(s) to compound shape
    for (var i = 0; i < shapes.length; i++)
    {
        var transform = new Ammo.btTransform();
        transform.setIdentity();
        var origin = new Ammo.btVector3(position.x, position.y, position.z);
        transform.setOrigin(origin);
        Ammo.destroy(origin);
        var quat = new Quaternion();
        quat.loadXYZAxisRotation(rotation.x, rotation.y, rotation.z);
        var quaternion = new Ammo.btQuaternion(quat.x, quat.y, quat.z, quat.w);
        transform.setRotation(quaternion);
        Ammo.destroy(quaternion);

        compoundShape.addChildShape(transform, shapes[i]);
        Ammo.destroy(transform);
    }
}

PhysicsSimulator.prototype.getBoxCollisionShape = function(model, position, rotation, scale, compoundShape)
{
    var shapes = [];
    
    var bbox_min = model.bbox.min.getValueDirect();
    var bbox_max = model.bbox.max.getValueDirect();

    var halfExtents = new Ammo.btVector3(((bbox_max.x - bbox_min.x) * scale.x) / 2,
                                         ((bbox_max.y - bbox_min.y) * scale.y) / 2,
                                         ((bbox_max.z - bbox_min.z) * scale.z) / 2);
    var shape = new Ammo.btBoxShape(halfExtents);
    Ammo.destroy(halfExtents);
    
    shapes.push(shape);
    
    // add shape(s) to compound shape
    for (var i = 0; i < shapes.length; i++)
    {
        var transform = new Ammo.btTransform();
        transform.setIdentity();
        var origin = new Ammo.btVector3(position.x, position.y, position.z);
        transform.setOrigin(origin);
        Ammo.destroy(origin);
        var quat = new Quaternion();
        quat.loadXYZAxisRotation(rotation.x, rotation.y, rotation.z);
        var quaternion = new Ammo.btQuaternion(quat.x, quat.y, quat.z, quat.w);
        transform.setRotation(quaternion);
        Ammo.destroy(quaternion);

        compoundShape.addChildShape(transform, shapes[i]);
        Ammo.destroy(transform);
    }
}

PhysicsSimulator.prototype.getSphereCollisionShape = function(model, position, rotation, scale, compoundShape)
{
    var shapes = [];
    
    var bbox_min = model.bbox.min.getValueDirect();
    var bbox_max = model.bbox.max.getValueDirect();

    var radius = ((bbox_max.x - bbox_min.x) * scale.x) / 2;
    var shape = new Ammo.btSphereShape(radius);
            
    shapes.push(shape);
    
    // add shape(s) to compound shape
    for (var i = 0; i < shapes.length; i++)
    {
        var transform = new Ammo.btTransform();
        transform.setIdentity();
        var origin = new Ammo.btVector3(position.x, position.y, position.z);
        transform.setOrigin(origin);
        Ammo.destroy(origin);
        var quat = new Quaternion();
        quat.loadXYZAxisRotation(rotation.x, rotation.y, rotation.z);
        var quaternion = new Ammo.btQuaternion(quat.x, quat.y, quat.z, quat.w);
        transform.setRotation(quaternion);
        Ammo.destroy(quaternion);

        compoundShape.addChildShape(transform, shapes[i]);
        Ammo.destroy(transform);
    }
}
/*
PhysicsSimulator.prototype.getSnapCollisionShape = function(model, position, rotation, scale, compoundShape)
{
    for (var i in model.snaps)
    {
        var snapped = model.snaps[i].model;
        var matrix = model.snaps[i].matrix;
        
        var snappedPosition = matrix.getTranslation();
        snappedPosition.x += position.x;
        snappedPosition.y += position.y;
        snappedPosition.z += position.z;
        snappedPosition.x *= scale.x;
        snappedPosition.y *= scale.y;
        snappedPosition.z *= scale.z;
        
        var snappedRotation = matrix.getRotationAngles();
        snappedRotation.x += rotation.x;
        snappedRotation.y += rotation.y;
        snappedRotation.z += rotation.z;
        
        var snappedScale = scale;//matrix.getScalingFactors();
        //snappedScale.x *= scale.x;
        //snappedScale.y *= scale.y;
        //snappedScale.z *= scale.z;
        
        this.getCollisionShape(snapped, snappedPosition, snappedRotation, snappedScale, compoundShape);
    }
}
*/
PhysicsSimulator.prototype.getNetProperties = function(model)
{
    // calculate scaled mass for model
    var scale = model.getAttribute("scale").getValueDirect();
    var avgScale = (scale.x + scale.y + scale.z) / 3;
    var physicalProperties = model.getAttribute("physicalProperties");
    var mass = physicalProperties.getAttribute("mass").getValueDirect() * avgScale;
    var friction = physicalProperties.getAttribute("friction").getValueDirect();
    var restitution = physicalProperties.getAttribute("restitution").getValueDirect();
    var linearDamping = physicalProperties.getAttribute("linearDamping").getValueDirect();
    var angularDamping = physicalProperties.getAttribute("angularDamping").getValueDirect();
    var rollingFriction = physicalProperties.getAttribute("rollingFriction").getValueDirect();
    
    // add children's properties (if any)
    for (var i = 0; i < model.motionChildren.length; i++)
    {
        var childProperties = this.getNetProperties(model.motionChildren[i]);
        mass += childProperties.mass;
        friction += childProperties.friction;
        restitution += childProperties.restitution;
        linearDamping += childProperties.linearDamping;
        angularDamping += childProperties.angularDamping;
        rollingFriction += childProperties.rollingFriction;
    }

    return { mass: mass, 
             friction: friction, 
             restitution: restitution, 
             linearDamping: linearDamping,
             angularDamping: angularDamping,
             rollingFriction: rollingFriction };
}

PhysicsSimulator.prototype.updatePhysicsShape = function(model, shape)
{
    // locate array position of model
    var n = this.getPhysicsBodyIndex(model);
    if (n == -1)
        return;

    shape = shape || this.getCompoundShape(model);

    var properties = this.getNetProperties(model);

    var isDynamic = (properties.mass != 0);
    var localInertia = new Ammo.btVector3(0, 0, 0);
    if (isDynamic)
    {
        shape.calculateLocalInertia(properties.mass, localInertia);
    }

    var motionState = this.physicsBodies[n].getMotionState();
    var rbInfo = new Ammo.btRigidBodyConstructionInfo(properties.mass, motionState, shape, localInertia);
    rbInfo.set_m_friction(properties.friction);
    rbInfo.set_m_restitution(properties.restitution);
    rbInfo.set_m_linearDamping(properties.linearDamping);
    rbInfo.set_m_angularDamping(properties.angularDamping);
    rbInfo.set_m_rollingFriction(properties.rollingFriction);
    Ammo.destroy(localInertia);
    var body = new Ammo.btRigidBody(rbInfo);
    Ammo.destroy(rbInfo);
    
    // remove previous before adding
    this.world.removeRigidBody(this.physicsBodies[n]);
    Ammo.destroy(this.physicsBodies[n]);
    // don't destroy motionState because it's now being used by the new body

    this.world.addRigidBody(body);
    this.physicsBodies[n] = body;
    this.physicsShapes[n] = shape;
}

PhysicsSimulator.prototype.updatePhysicsBody = function(n)
{
    var model = this.bodyModels[n];
    if (!model)
        return;
    var body = this.physicsBodies[n];
    if (!body)
        return;
    var shape = this.physicsShapes[n];
    if (!shape)
        return;

    var transform = new Ammo.btTransform();
    transform.setIdentity();

    var position = model.getAttribute("position").getValueDirect();
    var vector = new Ammo.btVector3(position.x, position.y, position.z);
    transform.setOrigin(vector);
    Ammo.destroy(vector);

    // update rotation to include rotation caused by object inspection
    var rotationGroup = getInspectionGroup(model);
    if (rotationGroup)
    {
        var rotationQuat = rotationGroup.getChild(2).getAttribute("rotationQuat").getValueDirect();
        var quat1 = new Quaternion();
        quat1.load(rotationQuat.w, rotationQuat.x, rotationQuat.y, rotationQuat.z);

        var modelQuat = model.getAttribute("quaternion").getValueDirect();
        var quat2 = new Quaternion();
        quat2.load(modelQuat.w, modelQuat.x, modelQuat.y, modelQuat.z);

        var quat = quat2.multiply(quat1);

        var quaternion = new Ammo.btQuaternion(quat.x, quat.y, quat.z, quat.w);
        transform.setRotation(quaternion);
        Ammo.destroy(quaternion);
    }

    this.world.removeRigidBody(body);
    
    var properties = this.getNetProperties(model);

    var isDynamic = (properties.mass != 0);
    var localInertia = new Ammo.btVector3(0, 0, 0);
    if (isDynamic)
    {
        shape.calculateLocalInertia(properties.mass, localInertia);
    }

    var motionState = new Ammo.btDefaultMotionState(transform);
    Ammo.destroy(transform);
    var rbInfo = new Ammo.btRigidBodyConstructionInfo(properties.mass, motionState, shape, localInertia);
    rbInfo.set_m_friction(properties.friction);
    rbInfo.set_m_restitution(properties.restitution);
    rbInfo.set_m_linearDamping(properties.linearDamping);
    rbInfo.set_m_angularDamping(properties.angularDamping);
    rbInfo.set_m_rollingFriction(properties.rollingFriction);
    Ammo.destroy(localInertia);
    var body = new Ammo.btRigidBody(rbInfo);
    Ammo.destroy(rbInfo);
    
    this.world.addRigidBody(body);
    this.physicsBodies[n] = body;
}

PhysicsSimulator.prototype.updatePhysicsBodyPosition = function(n, retainInspectionGroupRotation)
{
    var index = this.updateBodyPositions.indexOf(n);
    if (index >= 0)
    {
        this.updateBodyPositions.splice(index, 1);
    }
    
    //if (!this.bodyAdded[n]) return;
    
    var model = this.bodyModels[n];
    if (!model)
        return;
    var body = this.physicsBodies[n];
    if (!body)
        return;
    
    var transform = new Ammo.btTransform();
    transform.setIdentity();

    var position = model.getAttribute("position").getValueDirect();
    var vector = new Ammo.btVector3(position.x, position.y, position.z);
    transform.setOrigin(vector);
    Ammo.destroy(vector);

    // update rotation to include rotation caused by object inspection
    var rotationGroup = getInspectionGroup(model);
    if (rotationGroup)
    {
        var rotationQuat = rotationGroup.getChild(2).getAttribute("rotationQuat").getValueDirect();
        var quat1 = new Quaternion();
        quat1.load(rotationQuat.w, rotationQuat.x, rotationQuat.y, rotationQuat.z);

        var modelQuat = model.getAttribute("quaternion").getValueDirect();
        var quat2 = new Quaternion();
        quat2.load(modelQuat.w, modelQuat.x, modelQuat.y, modelQuat.z);

        var quat = quat2.multiply(quat1);

        var quaternion = new Ammo.btQuaternion(quat.x, quat.y, quat.z, quat.w);
        transform.setRotation(quaternion);
        Ammo.destroy(quaternion);

        // clear inspection group's rotation
        if (!retainInspectionGroupRotation) 
        {
            rotationGroup.getChild(2).getAttribute("rotationQuat").setValueDirect(new Quaternion());
        }
    }
    
    body.setWorldTransform(transform);
    body.getMotionState().setWorldTransform(transform);
    body.activate(true);
    Ammo.destroy(transform);
}

PhysicsSimulator.prototype.initPhysics = function()
{
    if (this.collisionConfiguration)
        Ammo.destroy(this.collisionConfiguration);
    if (this.dispatcher)
        Ammo.destroy(this.dispatcher);
    if (this.overlappingPairCache)
        Ammo.destroy(this.overlappingPairCache);
    if (this.solver)
        Ammo.destroy(this.solver);
    //if (this.world) Ammo.destroy(this.world);

    this.collisionConfiguration = new Ammo.btDefaultCollisionConfiguration();
    this.dispatcher = new Ammo.btCollisionDispatcher(this.collisionConfiguration);
    this.overlappingPairCache = new Ammo.btDbvtBroadphase();
    this.solver = new Ammo.btSequentialImpulseConstraintSolver();
    this.world = new Ammo.btDiscreteDynamicsWorld(this.dispatcher, this.overlappingPairCache, this.solver, this.collisionConfiguration);

    var gravity = this.gravity.getValueDirect();
    gravity = new Ammo.btVector3(gravity.x, gravity.y, gravity.z)
    this.world.setGravity(gravity);
    Ammo.destroy(gravity);
}

PhysicsSimulator.prototype.bodiesModified = function()
{
    this.updateBodies = true;
}

PhysicsSimulator.prototype.modelEnabledModified = function(model, enabled)
{
    if (enabled)
    {
        this.deletePhysicsBody(model); // ensure model is not added multiple times
        this.createPhysicsBody(model);
    }
    else // !enabled
    {
        this.deletePhysicsBody(model);
    }
}

PhysicsSimulator.prototype.modelPhysicalPropertiesModified = function(model)
{
    // locate array position of model
    var n = this.getPhysicsBodyIndex(model);
    if (n == -1)
        return;
    
    this.updatePhysicsShape(model, this.physicsShapes[n]);
}

function PhysicsSimulator_GravityModifiedCB(attribute, container)
{
    container.updateWorld = true;
}

function PhysicsSimulator_BodiesModifiedCB(attribute, container)
{
    container.bodiesModified();
}

function PhysicsSimulator_EnabledModifiedCB(attribute, container)
{
    var enabled = attribute.getValueDirect();
}

function PhysicsSimulator_ModelVerticesModifiedCB(attribute, container)
{
    container.updatePhysicsShape(attribute.getContainer());
}

function PhysicsSimulator_ModelPositionModifiedCB(attribute, container)
{
    if (container.evaluating) return;
    
    //container.updatePhysicsBodyPosition(container.getPhysicsBodyIndex(attribute.getContainer()), true);
    //container.updateBodyPositions.push(container.getPhysicsBodyIndex(attribute.getContainer()));
    var index = container.getPhysicsBodyIndex(attribute.getContainer());
    if (index >= 0)
    {
        if (container.updateBodyPositions.indexOf(index) == -1)
        {
            container.updateBodyPositions.push(index);
        }
    }
}

function PhysicsSimulator_ModelRotationModifiedCB(attribute, container)
{
    if (container.evaluating) return;
    
    //container.updatePhysicsBodyPosition(container.getPhysicsBodyIndex(attribute.getContainer()), true);
    //container.updateBodyPositions.push(container.getPhysicsBodyIndex(attribute.getContainer()));
    var index = container.getPhysicsBodyIndex(attribute.getContainer());
    if (index >= 0)
    {
        if (container.updateBodyPositions.indexOf(index) == -1)
        {
            container.updateBodyPositions.push(index);
        }
    }
}

function PhysicsSimulator_ModelQuaternionModifiedCB(attribute, container)
{
    if (container.evaluating) return;
    
    //container.updatePhysicsBodyPosition(container.getPhysicsBodyIndex(attribute.getContainer()), true);
    //container.updateBodyPositions.push(container.getPhysicsBodyIndex(attribute.getContainer()));
    var index = container.getPhysicsBodyIndex(attribute.getContainer());
    if (index >= 0)
    {
        if (container.updateBodyPositions.indexOf(index) == -1)
        {
            container.updateBodyPositions.push(index);
        }
    }
}

function PhysicsSimulator_ModelScaleModifiedCB(attribute, container)
{
    container.updatePhysicsShape(attribute.getContainer());
}

function PhysicsSimulator_ModelParentModifiedCB(attribute, container)
{
    container.updateBodies = true;
}

function PhysicsSimulator_ModelEnabledModifiedCB(attribute, container)
{
    container.modelEnabledModified(attribute.getContainer(), attribute.getValueDirect());
}

function PhysicsSimulator_ModelPhysicalPropertiesModifiedCB(attribute, container)
{
    container.modelPhysicalPropertiesModified(attribute.getContainer());
}
SnapModelDescriptor.prototype = new AttributeContainer();
SnapModelDescriptor.prototype.constructor = SnapModelDescriptor;

function SnapModelDescriptor()
{
    AttributeContainer.call(this);
    this.className = "SnapModelDescriptor";
    this.attrType = eAttrType.SnapModelDescriptor;
    
    this.name = new StringAttr();
    this.position = new Vector3DAttr();
    this.quaternion = new QuaternionAttr();

    this.registerAttribute(this.name, "name");
    this.registerAttribute(this.position, "position");
    this.registerAttribute(this.quaternion, "quaternion");
}

SnapModelDescriptors.prototype = new AttributeVector();
SnapModelDescriptors.prototype.constructor = SnapModelDescriptors;

function SnapModelDescriptors()
{
    AttributeVector.call(this, new SnapModelDescriptorAllocator());
    this.className = "SnapModelDescriptors";
    this.attrType = eAttrType.SnapModelDescriptors;

    this.appendParsedElements.setValueDirect(true);
}

SnapModelDescriptorAllocator.prototype = new Allocator();
SnapModelDescriptorAllocator.prototype.constructor = SnapModelDescriptorAllocator;

function SnapModelDescriptorAllocator()
{
}

SnapModelDescriptorAllocator.prototype.allocate = function ()
{
    return new SnapModelDescriptor();
}

function SnapRec()
{
    this.model = null;
    this.matrix = null;
    this.surfaces = [];
    this.geometries = [];
    this.vertices_start = 0;
    this.vertices_count = 0;
    this.genericConnectors = [];
    this.plugConnectors = [];
    this.socketConnectors = [];
}

SnapModel.prototype = new Model();
SnapModel.prototype.constructor = SnapModel;

function SnapModel()
{
    Model.call(this);
    this.className = "SnapModel";
    this.attrType = eAttrType.SnapModel;
    
    this.snaps = [];
}

SnapModel.prototype.snap = function(model, matrix)
{
    var i, j, k;
    var vertices, xvertices, xvertex;
    var normals, xnormals, normal, xnormal;
    var center, xcenter;
    
    var snapRec = new SnapRec();
    snapRec.model = model;
    snapRec.matrix = matrix;
    
    // disable (hide) model
    model.enabled.setValueDirect(false);
    
    // copy model surfaces to this
    var surfaces = model.surfaces;
    for (i = 0; i < surfaces.length; i++)
    {
        var surface = surfaces[i].clone();
        this.addSurface(surface);
        surface.snappedModel = model;
        snapRec.surfaces.push(surface);

        // enable surface (disabled by model.enabled set above)
        surface.enabled.setValueDirect(true);
        
        // target original surfaces to retain changes made to snapped surface
        surface.color.addTarget(surfaces[i].color, eAttrSetOp.Replace, null, false);
        surface.ambientLevel.addTarget(surfaces[i].ambientLevel, eAttrSetOp.Replace, null, false);
        surface.diffuseLevel.addTarget(surfaces[i].diffuseLevel, eAttrSetOp.Replace, null, false);
        surface.specularLevel.addTarget(surfaces[i].specularLevel, eAttrSetOp.Replace, null, false);
        surface.emissiveLevel.addTarget(surfaces[i].emissiveLevel, eAttrSetOp.Replace, null, false);
        surface.ambient.addTarget(surfaces[i].ambient, eAttrSetOp.Replace, null, false);
        surface.diffuse.addTarget(surfaces[i].diffuse, eAttrSetOp.Replace, null, false);
        surface.specular.addTarget(surfaces[i].specular, eAttrSetOp.Replace, null, false);
        surface.emissive.addTarget(surfaces[i].emissive, eAttrSetOp.Replace, null, false);
        surface.glossiness.addTarget(surfaces[i].glossiness, eAttrSetOp.Replace, null, false);
        surface.opacity.addTarget(surfaces[i].opacity, eAttrSetOp.Replace, null, false);
        surface.doubleSided.addTarget(surfaces[i].doubleSided, eAttrSetOp.Replace, null, false);
        surface.texturesEnabled.addTarget(surfaces[i].texturesEnabled, eAttrSetOp.Replace, null, false);
       
        // transform vertices
        xvertices = [];
        vertices = surface.getAttribute("vertices").getValueDirect();
        for (j = 0; j < vertices.length; j += 3)
        {
            xvertex = matrix.transform(vertices[j], vertices[j + 1], vertices[j + 2], 1);
            xvertices.push(xvertex.x);
            xvertices.push(xvertex.y);
            xvertices.push(xvertex.z);
        }
        surface.getAttribute("vertices").setValueDirect(xvertices);
    
        // copy geometry
        var geometries = surfaces[i].geometries;
        for (j = 0; j < geometries.length; j++)
        {
            var geometry = geometries[j].clone();
            geometry.surface = surface;

            // transform vertices/normals
            xvertices = [];
            vertices = geometry.getAttribute("vertices").getValueDirect();
            for (k = 0; k < vertices.length; k += 3)
            {
                xvertex = matrix.transform(vertices[k], vertices[k + 1], vertices[k + 2], 1);
                xvertices.push(xvertex.x);
                xvertices.push(xvertex.y);
                xvertices.push(xvertex.z);
            }
            geometry.getAttribute("vertices").setValueDirect(xvertices);

            xnormals = [];
            normals = geometry.getAttribute("normals").getValueDirect();
            for (k = 0; k < normals.length; k += 3)
            {
                xnormal = matrix.transform(normals[k], normals[k + 1], normals[k + 2], 0);
                xnormals.push(xnormal.x);
                xnormals.push(xnormal.y);
                xnormals.push(xnormal.z);
            }
            geometry.getAttribute("normals").setValueDirect(xnormals);

            this.addGeometry(geometry, null, surface);
            snapRec.geometries.push(geometry);
        }
    }
    
    // append (transformed) model vertices to snappee
    xvertices = [];
    vertices = model.vertices.getValueDirect();
    for (i = 0; i < vertices.length; i += 3)
    {
        xvertex = matrix.transform(vertices[i], vertices[i + 1], vertices[i + 2], 1);
        xvertices.push(xvertex.x);
        xvertices.push(xvertex.y);
        xvertices.push(xvertex.z);
    }
    vertices = this.vertices.getValueDirect();   
    snapRec.vertices_start = vertices.length;
    snapRec.vertices_count = xvertices.length;
    vertices = vertices.concat(xvertices);
    this.vertices.setValueDirect(vertices);
   
    // copy (transformed) snap connectors to snappee
    
    // generics
    var genericConnectors = model.genericConnectors;
    for (i = 0; i < genericConnectors.Size(); i++)
    {
        var genericConnector = genericConnectors.getAt(i);
        var xgenericConnector = new GenericConnector();
        xgenericConnector.synchronize(genericConnector);
        
        normal = xgenericConnector.normal.getValueDirect();
        xnormal = matrix.transform(normal.x, normal.y, normal.z, 0);
        xgenericConnector.normal.setValueDirect(xnormal.x, xnormal.y, xnormal.z);
        
        center = xgenericConnector.point.center.getValueDirect();
        xcenter = matrix.transform(center.x, center.y, center.z, 1);
        xgenericConnector.point.center.setValueDirect(xcenter.x, xcenter.y, xcenter.z);
        
        this.genericConnectors.push_back(xgenericConnector);
        snapRec.genericConnectors.push(xgenericConnector);
    }
    
    // plugs  
    var plugConnectors = model.plugConnectors;
    for (i = 0; i < plugConnectors.Size(); i++)
    {
        var plugConnector = plugConnectors.getAt(i);
        var xplugConnector = new PlugConnector();
        xplugConnector.synchronize(plugConnector);
        
        normal = xgenericConnector.normal.getValueDirect();
        xnormal = matrix.transform(normal.x, normal.y, normal.z, 0);
        xgenericConnector.normal.setValueDirect(xnormal.x, xnormal.y, xnormal.z);
        
        center = xplugConnector.pin1.center.getValueDirect();
        xcenter = matrix.transform(center.x, center.y, center.z, 1);
        xplugConnector.pin1.center.setValueDirect(xcenter.x, xcenter.y, xcenter.z);
        
        center = xplugConnector.pin2.center.getValueDirect();
        xcenter = matrix.transform(center.x, center.y, center.z, 1);
        xplugConnector.pin2.center.setValueDirect(xcenter.x, xcenter.y, xcenter.z);
        
        this.plugConnectors.push_back(xplugConnector);
        snapRec.plugConnectors.push(xplugConnector);
    }
    
    // sockets
    var socketConnectors = model.socketConnectors;
    for (i = 0; i < socketConnectors.Size(); i++)
    {
        var socketConnector = socketConnectors.getAt(i);
        var xsocketConnector = new SocketConnector();
        xsocketConnector.synchronize(socketConnector);
        
        normal = xgenericConnector.normal.getValueDirect();
        xnormal = matrix.transform(normal.x, normal.y, normal.z, 0);
        xgenericConnector.normal.setValueDirect(xnormal.x, xnormal.y, xnormal.z);
        
        center = xsocketConnector.slot1.center.getValueDirect();
        xcenter = matrix.transform(center.x, center.y, center.z, 1);
        xsocketConnector.slot1.center.setValueDirect(xcenter.x, xcenter.y, xcenter.z);
        
        center = xsocketConnector.slot2.center.getValueDirect();
        xcenter = matrix.transform(center.x, center.y, center.z, 1);
        xsocketConnector.slot2.center.setValueDirect(xcenter.x, xcenter.y, xcenter.z);
        
        this.socketConnectors.push_back(xsocketConnector);
        snapRec.socketConnectors.push(xsocketConnector);
    }
    
    // append name
    //var name = this.name.getValueDirect().join("");
    //name += "_" + model.name.getValueDirect().join("");
    //this.name.setValueDirect(name);
    
    // add snap entry
    this.snaps[model.__nodeId__] = snapRec;
}

SnapModel.prototype.unsnap = function(model)
{
    var i;
    
    var snapRec = this.snaps[model.__nodeId__];
    if (!snapRec) return;
    
    // remove model's surfaces and synchronize original model's corresponding 
    // surface attributes to retain changes applied to this
    for (i = 0; i < snapRec.surfaces.length; i++)
    {   
        var surface = snapRec.surfaces[i];
        
        // untarget original surfaces
        surface.color.removeTarget(model.surfaces[i].color);
        surface.ambientLevel.removeTarget(model.surfaces[i].ambientLevel);
        surface.diffuseLevel.removeTarget(model.surfaces[i].diffuseLevel);
        surface.specularLevel.removeTarget(model.surfaces[i].specularLevel);
        surface.emissiveLevel.removeTarget(model.surfaces[i].emissiveLevel);
        surface.ambient.removeTarget(model.surfaces[i].ambient);
        surface.diffuse.removeTarget(model.surfaces[i].diffuse);
        surface.specular.removeTarget(model.surfaces[i].specular);
        surface.emissive.removeTarget(model.surfaces[i].emissive);
        surface.glossiness.removeTarget(model.surfaces[i].glossiness);
        surface.opacity.removeTarget(model.surfaces[i].opacity);
        surface.doubleSided.removeTarget(model.surfaces[i].doubleSided);
        surface.texturesEnabled.removeTarget(model.surfaces[i].texturesEnabled);
        
        this.removeSurface(surface);
    }
    
    // remove model's geometries
    for (i = 0; i < snapRec.geometries.length; i++)
    {
        this.removeGeometry(snapRec.geometries[i], null, snapRec.geometries[i].surface);
    }
    
    // remove model's vertices
    var vertices = this.vertices.getValueDirect();
    vertices.splice(snapRec.vertices_start, snapRec.vertices_count);
    this.vertices.setValueDirect(vertices);
    
    // remove model's snapConnectors
    for (i = 0; i < snapRec.genericConnectors.length; i++)
    {
        this.genericConnectors.erase(snapRec.genericConnectors[i]);
    }
    for (i = 0; i < snapRec.plugConnectors.length; i++)
    {
        this.plugConnectors.erase(snapRec.plugConnectors[i]);
    }
    for (i = 0; i < snapRec.socketConnectors.length; i++)
    {
        this.socketConnectors.erase(snapRec.socketConnectors[i]);
    }
    
    // clear snapConnector's connected flags
    var genericConnectors = model.genericConnectors;
    for (i = 0; i < genericConnectors.Size(); i++)
    {
        genericConnectors.getAt(i).getAttribute("connected").setValueDirect(false);
    }
    var plugConnectors = model.plugConnectors;
    for (i = 0; i < plugConnectors.Size(); i++)
    {
        plugConnectors.getAt(i).getAttribute("connected").setValueDirect(false);
    }
    var socketConnectors = model.socketConnectors;
    for (i = 0; i < socketConnectors.Size(); i++)
    {
        socketConnectors.getAt(i).getAttribute("connected").setValueDirect(false);
    }
        
    // set model's position
    var matrix = snapRec.matrix;
    
    var position = matrix.transform(0, 0, 0, 1);
    model.position.setValueDirect(position.x, position.y, position.z);

    var rotationAngles = matrix.getRotationAngles();
    model.rotation.setValueDirect(rotationAngles.x, rotationAngles.y, rotationAngles.z);

    model.setMotionParent(this);
    zeroInspectionGroup(model);
    model.updateSimpleTransform();
    model.updateCompoundTransform();
    model.setMotionParent(null);

    matrix = model.sectorTransformCompound;

    position = matrix.transform(0, 0, 0, 1);
    model.position.setValueDirect(position.x, position.y, position.z);

    var quaternion = matrix.getQuaternion();
    model.quaternion.setValueDirect(quaternion);
        
    // enable (show) model
    model.enabled.setValueDirect(true);
    
    // clear snap entry
    this.snaps[model.__nodeId__] = undefined;
}

SnapModel.prototype.unsnapAll = function()
{
    var unsnapped = [];
    
    var snaps = this.snaps.slice();
    for (var i in snaps)
    {
        this.unsnap(snaps[i].model);
        unsnapped.push(snaps[i].model);
    }
    
    // remove this
    this.getParent(0).removeChild(this);
    // remove from registry
    this.registry.unregister(this);
    // delete
    //this.destroy();
    
    return unsnapped;
}

SnapModel.prototype.getSnapped = function()
{
    var i;
    var descriptors = new SnapModelDescriptors();
    
    for (i in this.snaps)
    {
        var snapRec = this.snaps[i];
        var model = snapRec.model;
        
        // get model's position
        var matrix = snapRec.matrix;

        var position = matrix.transform(0, 0, 0, 1);
        model.position.setValueDirect(position.x, position.y, position.z);

        var rotationAngles = matrix.getRotationAngles();
        model.rotation.setValueDirect(rotationAngles.x, rotationAngles.y, rotationAngles.z);

        model.setMotionParent(this);
        zeroInspectionGroup(model);
        model.updateSimpleTransform();
        model.updateCompoundTransform();
        model.setMotionParent(null);

        matrix = model.sectorTransformCompound;

        position = matrix.transform(0, 0, 0, 1);
        var quaternion = matrix.getQuaternion();
        
        var descriptor = new SnapModelDescriptor();
        descriptor.name.copyValue(model.name);
        descriptor.position.setValueDirect(position.x, position.y, position.z);
        descriptor.quaternion.setValueDirect(quaternion);
        
        descriptors.push_back(descriptor);
    }
    
    return descriptors;
}
    
SnapModel.prototype.apply = function(directive, params, visitChildren)
{
    // call base-class implementation
    Model.prototype.apply.call(this, directive, params, visitChildren);
}

SnapModel.prototype.connectSurfaceAttribute = function(surface, attribute, name)
{
    // don't replace snapped surface's attribute value
    attribute.addTarget(surface.getAttribute(name), eAttrSetOp.Replace, null, false);
}
Animator.prototype = new Evaluator();
Animator.prototype.constructor = Animator;
    
function Animator()
{
    Evaluator.call(this);
    this.className = "Animator";
    this.attrType = eAttrType.Animator;
    
    this.targetObject = null;
    
    this.timeIncrement = new NumberAttr();
    this.target = new StringAttr("");
    
    this.target.addModifiedCB(Animator_TargetModifiedCB, this);
    
    this.registerAttribute(this.timeIncrement, "timeIncrement");
    this.registerAttribute(this.target, "target");
}

Animator.prototype.evaluate = function()
{    
}

Animator.prototype.targetModified = function(targetObject)
{
    this.targetObject = targetObject;
}

function Animator_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    var resource = container.registry.find(target);
    if (resource)
    {
        container.targetModified(resource);
    }
}


Spinner.prototype = new Animator();
Spinner.prototype.constructor = Spinner;
    
function Spinner()
{
    Animator.call(this);
    this.className = "Spinner";
    this.attrType = eAttrType.Spinner;
    
    this.targetCenter = new Vector3D();
    
    this.axisEndpoint = new Vector3DAttr(0, 0, 0);
    this.angularVelocity = new NumberAttr(0);
    
    this.registerAttribute(this.axisEndpoint, "axisEndpoint");
    this.registerAttribute(this.angularVelocity, "angularVelocity");
}

Spinner.prototype.evaluate = function()
{
    if (!this.targetObject) return;
    
    var timeIncrement = this.timeIncrement.getValueDirect()
    var angularVelocity = this.targetObject.angularVelocity.getValueDirect();
    
    var axisEndpoint = this.axisEndpoint.getValueDirect();   
    var axis = new Vector3D(axisEndpoint.x - this.targetCenter.x,
        axisEndpoint.y - this.targetCenter.y, 
        axisEndpoint.z - this.targetCenter.z);
    
    var spinQuat = new Quaternion();
    spinQuat.loadXYZAxisRotation(axis.x, axis.y, axis.z, this.angularVelocity.getValueDirect() * timeIncrement);
    
    var quaternion = this.targetObject.quaternion.getValueDirect();
    quaternion = spinQuat.multiply(quaternion);
    
    this.targetObject.quaternion.setValueDirect(quaternion);
}

Spinner.prototype.targetModified = function(targetObject)
{
    this.targetObject = targetObject;
    if (targetObject)
    {    
        // get center
        this.targetCenter = targetObject.center.getValueDirect();
    }
}


Ball.prototype = new Model();
Ball.prototype.constructor = Ball;

function Ball()
{
    Model.call(this);
    this.className = "Ball";
    this.attrType = eAttrType.Ball;
    
    this.url.setValueDirect("objects/Sphere.lwo");
    
    // Physical Properties
    this.physicalProperties.mass.setValueDirect(8);
    this.physicalProperties.friction.setValueDirect(1.2);
    this.physicalProperties.restitution.setValueDirect(0.1);
    
    // Snap Connectors
    
    // PositiveX
    var connector = new GenericConnector();
    connector.name.setValueDirect("PositiveX");
    connector.normal.setValueDirect(1, 0, 0);
    connector.point.center.setValueDirect(1, 0, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // PositiveY
    connector = new GenericConnector();
    connector.name.setValueDirect("PositiveY");
    connector.normal.setValueDirect(0, 1, 0);
    connector.point.center.setValueDirect(0, 1, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // PositiveZ
    connector = new GenericConnector();
    connector.name.setValueDirect("PositiveZ");
    connector.normal.setValueDirect(0, 0, 1);
    connector.point.center.setValueDirect(0, 0, 1);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // NegativeX
    connector = new GenericConnector();
    connector.name.setValueDirect("NegativeX");
    connector.normal.setValueDirect(-1, 0, 0);
    connector.point.center.setValueDirect(-1, 0, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // NegativeY
    connector = new GenericConnector();
    connector.name.setValueDirect("NegativeY");
    connector.normal.setValueDirect(0, -1, 0);
    connector.point.center.setValueDirect(0, -1, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // NegativeZ
    connector = new GenericConnector();
    connector.name.setValueDirect("NegativeZ");
    connector.normal.setValueDirect(0, 0, -1);
    connector.point.center.setValueDirect(0, 0, -1);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
}


Beam.prototype = new Model();
Beam.prototype.constructor = Beam;

function Beam()
{
    Model.call(this);
    this.className = "Beam";
    this.attrType = eAttrType.Beam;
    
    this.url.setValueDirect("objects/Beam.lwo");
    
    // Physical Properties
    this.physicalProperties.mass.setValueDirect(35);
    this.physicalProperties.friction.setValueDirect(1.2);
    this.physicalProperties.restitution.setValueDirect(0.1);
}


Box.prototype = new Model();
Box.prototype.constructor = Box;

function Box()
{
    Model.call(this);
    this.className = "Box";
    this.attrType = eAttrType.Box;
    
    this.url.setValueDirect("objects/Cube.lwo");
    
    // Physical Properties
    this.physicalProperties.mass.setValueDirect(5);
    this.physicalProperties.friction.setValueDirect(1.2);
    this.physicalProperties.restitution.setValueDirect(0.1);
    
    // Snap Connectors
    
    // PositiveX
    var connector = new GenericConnector();
    connector.name.setValueDirect("PositiveX");
    connector.normal.setValueDirect(1, 0, 0);
    connector.point.center.setValueDirect(1, 0, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // PositiveY
    connector = new GenericConnector();
    connector.name.setValueDirect("PositiveY");
    connector.normal.setValueDirect(0, 1, 0);
    connector.point.center.setValueDirect(0, 1, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // PositiveZ
    connector = new GenericConnector();
    connector.name.setValueDirect("PositiveZ");
    connector.normal.setValueDirect(0, 0, 1);
    connector.point.center.setValueDirect(0, 0, 1);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // NegativeX
    connector = new GenericConnector();
    connector.name.setValueDirect("NegativeX");
    connector.normal.setValueDirect(-1, 0, 0);
    connector.point.center.setValueDirect(-1, 0, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // NegativeY
    connector = new GenericConnector();
    connector.name.setValueDirect("NegativeY");
    connector.normal.setValueDirect(0, -1, 0);
    connector.point.center.setValueDirect(0, -1, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // NegativeZ
    connector = new GenericConnector();
    connector.name.setValueDirect("NegativeZ");
    connector.normal.setValueDirect(0, 0, -1);
    connector.point.center.setValueDirect(0, 0, -1);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
}


Elbow.prototype = new Model();
Elbow.prototype.constructor = Elbow;

function Elbow()
{
    Model.call(this);
    this.className = "Elbow";
    this.attrType = eAttrType.Elbow;
    
    this.url.setValueDirect("objects/Elbow.lwo");
    
    // Physical Properties
    this.physicalProperties.mass.setValueDirect(5);
    this.physicalProperties.friction.setValueDirect(1.2);
    this.physicalProperties.restitution.setValueDirect(0.1);
    
    // Snap Connectors
    
    // NegativeZ
    var connector = new GenericConnector();
    connector.name.setValueDirect("NegativeZ");
    connector.normal.setValueDirect(0, 0, -1);
    connector.point.center.setValueDirect(0, 0.42, -1.3);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // NegativeY
    connector = new GenericConnector();
    connector.name.setValueDirect("NegativeY");
    connector.normal.setValueDirect(0, -1, 0);
    connector.point.center.setValueDirect(0, -1.42, 0.3);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
}


Gear.prototype = new Model();
Gear.prototype.constructor = Gear;

function Gear()
{
    Model.call(this);
    this.className = "Gear";
    this.attrType = eAttrType.Gear;
    
    this.url.setValueDirect("objects/Gear.lwo");
    
    // Physical Properties
    this.physicalProperties.mass.setValueDirect(5);
    this.physicalProperties.friction.setValueDirect(1.2);
    this.physicalProperties.restitution.setValueDirect(0.1);
}


Plank.prototype = new Model();
Plank.prototype.constructor = Plank;

function Plank()
{
    Model.call(this);
    this.className = "Plank";
    this.attrType = eAttrType.Plank;
    
    this.url.setValueDirect("objects/Plank.lwo");
    
    // Physical Properties
    this.physicalProperties.mass.setValueDirect(3);
    this.physicalProperties.friction.setValueDirect(1.2);
    this.physicalProperties.restitution.setValueDirect(0.1);
}


Pyramid.prototype = new Model();
Pyramid.prototype.constructor = Pyramid;

function Pyramid()
{
    Model.call(this);
    this.className = "Pyramid";
    this.attrType = eAttrType.Pyramid;
    
    this.url.setValueDirect("objects/Pyramid.lwo");
    
    // Physical Properties
    this.physicalProperties.mass.setValueDirect(10);
    this.physicalProperties.friction.setValueDirect(1.2);
    this.physicalProperties.restitution.setValueDirect(0.1);
    
    // Snap Connectors
    
    // PositiveX
    var connector = new GenericConnector();
    connector.name.setValueDirect("PositiveX");
    connector.normal.setValueDirect(1, 0, 0);
    connector.point.center.setValueDirect(1, 0, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // PositiveY
    connector = new GenericConnector();
    connector.name.setValueDirect("PositiveY");
    connector.normal.setValueDirect(0, 1, 0);
    connector.point.center.setValueDirect(0, 1, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // PositiveZ
    connector = new GenericConnector();
    connector.name.setValueDirect("PositiveZ");
    connector.normal.setValueDirect(0, 0, 1);
    connector.point.center.setValueDirect(0, 0, 1);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // NegativeX
    connector = new GenericConnector();
    connector.name.setValueDirect("NegativeX");
    connector.normal.setValueDirect(-1, 0, 0);
    connector.point.center.setValueDirect(-1, 0, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // NegativeY
    connector = new GenericConnector();
    connector.name.setValueDirect("NegativeY");
    connector.normal.setValueDirect(0, -1, 0);
    connector.point.center.setValueDirect(0, -1, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // NegativeZ
    connector = new GenericConnector();
    connector.name.setValueDirect("NegativeZ");
    connector.normal.setValueDirect(0, 0, -1);
    connector.point.center.setValueDirect(0, 0, -1);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
}


Ring.prototype = new Model();
Ring.prototype.constructor = Ring;

function Ring()
{
    Model.call(this);
    this.className = "Ring";
    this.attrType = eAttrType.Ring;
    
    this.url.setValueDirect("objects/Ring.lwo");
    
    // Physical Properties
    this.physicalProperties.mass.setValueDirect(5);
    this.physicalProperties.friction.setValueDirect(1.2);
    this.physicalProperties.restitution.setValueDirect(0.1);
}


Tube.prototype = new Model();
Tube.prototype.constructor = Tube;

function Tube()
{
    Model.call(this);
    this.className = "Tube";
    this.attrType = eAttrType.Tube;
    
    this.url.setValueDirect("objects/Tube.lwo");
    
    // Physical Properties
    this.physicalProperties.mass.setValueDirect(10);
    this.physicalProperties.friction.setValueDirect(1.2);
    this.physicalProperties.restitution.setValueDirect(0.1);
    
    // Snap Connectors
    
    // PositiveX
    var connector = new GenericConnector();
    connector.name.setValueDirect("PositiveX");
    connector.normal.setValueDirect(1, 0, 0);
    connector.point.center.setValueDirect(1, 0, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // PositiveY
    connector = new GenericConnector();
    connector.name.setValueDirect("PositiveY");
    connector.normal.setValueDirect(0, 1, 0);
    connector.point.center.setValueDirect(0, 1, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // PositiveZ
    connector = new GenericConnector();
    connector.name.setValueDirect("PositiveZ");
    connector.normal.setValueDirect(0, 0, 1);
    connector.point.center.setValueDirect(0, 0, 1);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // NegativeX
    connector = new GenericConnector();
    connector.name.setValueDirect("NegativeX");
    connector.normal.setValueDirect(-1, 0, 0);
    connector.point.center.setValueDirect(-1, 0, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // NegativeY
    connector = new GenericConnector();
    connector.name.setValueDirect("NegativeY");
    connector.normal.setValueDirect(0, -1, 0);
    connector.point.center.setValueDirect(0, -1, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // NegativeZ
    connector = new GenericConnector();
    connector.name.setValueDirect("NegativeZ");
    connector.normal.setValueDirect(0, 0, -1);
    connector.point.center.setValueDirect(0, 0, -1);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
}


Wall.prototype = new Model();
Wall.prototype.constructor = Wall;

function Wall()
{
    Model.call(this);
    this.className = "Wall";
    this.attrType = eAttrType.Wall;
    
    this.url.setValueDirect("objects/Wall.lwo");
    
    // Physical Properties
    this.physicalProperties.mass.setValueDirect(15);
    this.physicalProperties.friction.setValueDirect(1.2);
    this.physicalProperties.restitution.setValueDirect(0.1);
    
    // Snap Connectors
    
    // PositiveX
    var connector = new GenericConnector();
    connector.name.setValueDirect("PositiveX");
    connector.normal.setValueDirect(1, 0, 0);
    connector.point.center.setValueDirect(1, 0, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // PositiveY
    connector = new GenericConnector();
    connector.name.setValueDirect("PositiveY");
    connector.normal.setValueDirect(0, 1, 0);
    connector.point.center.setValueDirect(0, 1, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // PositiveZ
    connector = new GenericConnector();
    connector.name.setValueDirect("PositiveZ");
    connector.normal.setValueDirect(0, 0, 1);
    connector.point.center.setValueDirect(0, 0, 1);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // NegativeX
    connector = new GenericConnector();
    connector.name.setValueDirect("NegativeX");
    connector.normal.setValueDirect(-1, 0, 0);
    connector.point.center.setValueDirect(-1, 0, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // NegativeY
    connector = new GenericConnector();
    connector.name.setValueDirect("NegativeY");
    connector.normal.setValueDirect(0, -1, 0);
    connector.point.center.setValueDirect(0, -1, 0);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
    // NegativeZ
    connector = new GenericConnector();
    connector.name.setValueDirect("NegativeZ");
    connector.normal.setValueDirect(0, 0, -1);
    connector.point.center.setValueDirect(0, 0, -1);
    connector.point.radius.setValueDirect(0.25);   
    this.genericConnectors.push_back(connector);
}


Wedge.prototype = new Model();
Wedge.prototype.constructor = Wedge;

function Wedge()
{
    Model.call(this);
    this.className = "Wedge";
    this.attrType = eAttrType.Wedge;
    
    this.url.setValueDirect("objects/Wedge.lwo");
    
    // Physical Properties
    this.physicalProperties.mass.setValueDirect(25);
    this.physicalProperties.friction.setValueDirect(1.2);
    this.physicalProperties.restitution.setValueDirect(0.1);
}


var eEventType = {
    Unknown                     :-1,
    
    Render_First                :0,
    RenderBegin                 :1,
    RenderEnd                   :2,
    Render_End                  :9,
    
    Mouse_First                 :100,
    MouseMove                   :101,
    MouseDown                   :102,
    MouseLeftDown               :103,
    MouseMiddleDown             :104,
    MouseRightDown              :105,
    MouseAllDown                :106,
    MouseBothDown               :107,
    MouseWheelDown              :108,
    MouseUp                     :109,
    MouseLeftUp                 :110,
    MouseRightUp                :111,
    MouseMiddleUp               :112,
    MouseWheelUp                :113,
    MouseLeftClick              :114,
    MouseMiddleClick            :115,
    MouseRightClick             :116,
    MouseLeftDblClick           :117,
    MouseMiddleDblClick         :118,
    MouseRightDblClick          :119,
    MouseDrag                   :120,
    MouseWheelForward           :121,
    MouseWheelBackward          :122,
    MouseHover                  :123,
    MouseLeave                  :124,	// fires when the mouse leaves the client area of the window
    MouseOver                   :125,	// fires when the mouse is moved onto an element
    MouseOut                    :126,	// fires when the mouse is moved off an element
    Mouse_Last                  :199,

    Key_First                   :200,
    KeyDown_First               :201,
    KeyDown_Last                :500,
    KeyUp_First                 :501,
    KeyUp_Last                  :798,
    Key_Last                    :799,
    
    Element_First               :800,
    ElementSelected             :801,
    ElementUnselected           :802,
    ElementFocus                :803,
    ElementBlur                 :804,
    Element_Last                :899,
    
    UserDefined                 :2000
};

var eEventNameMap = {
    "MButton1"                  : eEventType.MouseLeftDown,
    "MButton1.Down"             : eEventType.MouseLeftDown,
    "MButton2"                  : eEventType.MouseMiddleDown,
    "MButton2.Down"             : eEventType.MouseMiddleDown,
    "MButton3"                  : eEventType.MouseRightDown,
    "MButton3.Down"             : eEventType.MouseRightDown,
    "MButton1+MButton2.Down"    : eEventType.MouseBothDown,
    "MButton2+MButton3.Down"    : eEventType.MouseBothDown,
    "MButton1+MButton3.Down"    : eEventType.MouseBothDown,
    "MButton1.Click"            : eEventType.MouseLeftClick,
    "MButton1.DoubleClick"      : eEventType.MouseLeftDblClick,
    "MButton1.Up"               : eEventType.MouseLeftUp,
    "MButton2.Click"            : eEventType.MouseMiddleClick,
    "MButton2.DoubleClick"      : eEventType.MouseMiddleDblClick,
    "MButton2.Up"               : eEventType.MouseMiddleUp,
    "MButton3.Click"            : eEventType.MouseRightClick,
    "MButton3.DoubleClick"      : eEventType.MouseRightDblClick,
    "MButton3.Up"               : eEventType.MouseRightUp,
    "MWheel"                    : eEventType.MouseWheelDown,
    "MWheel.Down"               : eEventType.MouseWheelDown,
    "MWheel.Click"              : eEventType.MouseWheelUp,
    "MWheel.Up"                 : eEventType.MouseWheelUp,
    "Mouse.Move"                : eEventType.MouseMove,
    "Mouse.Hover"               : eEventType.MouseHover,
    "Mouse.Leave"               : eEventType.MouseLeave,
    "Mouse.Over"                : eEventType.MouseOver,
    "Mouse.Out"                 : eEventType.MouseOut,
    "Element.Selected"          : eEventType.ElementSelected,
    "Element.Unselected"        : eEventType.ElementUnselected,
    "Element.Focus"             : eEventType.ElementFocus,
    "Element.Blur"              : eEventType.ElementBlur
};

// map of VK_* strings to javascript key codes
var eKeyCodeMap = {
    "VK_BACK"                   : 8,
    "VK_TAB"                    : 9,
    "VK_ENTER"                  : 13,
    "VK_SHIFT"                  : 16,
    "VK_CONTROL"                : 17,
    "VK_ALT"                    : 18,
    "VK_PAUSE"                  : 19,
    "VK_CAPITAL"                : 20,
    "VK_ESCAPE"                 : 27,
    "VK_PAGEUP"                 : 33,
    "VK_PAGEDOWN"               : 34,
    "VK_END"                    : 35,
    "VK_HOME"                   : 36,
    "VK_LEFT"                   : 37,
    "VK_UP"                     : 38,
    "VK_RIGHT"                  : 39,
    "VK_DOWN"                   : 40,
    "VK_INSERT"                 : 45,
    "VK_DELETE"                 : 46,
    "VK_0"                      : 48,
    "VK_1"                      : 49,
    "VK_2"                      : 50,
    "VK_3"                      : 51,
    "VK_4"                      : 52,
    "VK_5"                      : 53,
    "VK_6"                      : 54,
    "VK_7"                      : 55,
    "VK_8"                      : 56,
    "VK_9"                      : 57,
    "VK_A"                      : 65,
    "VK_B"                      : 66,
    "VK_C"                      : 67,
    "VK_D"                      : 68,
    "VK_E"                      : 69,
    "VK_F"                      : 70,
    "VK_G"                      : 71,
    "VK_H"                      : 72,
    "VK_I"                      : 73,
    "VK_J"                      : 74,
    "VK_K"                      : 75,
    "VK_L"                      : 76,
    "VK_M"                      : 77,
    "VK_N"                      : 78,
    "VK_O"                      : 79,  
    "VK_P"                      : 80,
    "VK_Q"                      : 81,
    "VK_R"                      : 82,    
    "VK_S"                      : 83,
    "VK_T"                      : 84,
    "VK_U"                      : 85,
    "VK_V"                      : 86,
    "VK_W"                      : 87,
    "VK_X"                      : 88,
    "VK_Y"                      : 89,
    "VK_Z"                      : 90,
    "VK_COMMA"                  : 189,
    "VK_PERIOD"                 : 190,
    "VK_SLASH"                  : 191
};

function getEventTypeByName(name)
{
    var type = eEventNameMap[name];
    
    if (type == undefined)
    {
        // key
        if (name.indexOf("VK") != -1)
        {
            var key = name;
            var state = "";
            var dot = name.indexOf(".");
            if (dot != -1)
            {
                // key
                key = name.substring(0, dot);
                // state
                state = name.substring(dot+1);
            }
                
            var keyCode = eKeyCodeMap[key];
            if (keyCode)
            {
                switch (state)
                {
                    case "Down":
                        type = eEventType.KeyDown_First + keyCode;
                        break;
                        
                    case "Up":
                    default:
                        type = eEventType.KeyUp_First + keyCode;
                        break;
                }
            }
        }     
    }   
    
    return type;
}
Event.prototype = new AttributeContainer();
Event.prototype.constructor = Event;

function Event(type, time, userData)
{
    AttributeContainer.call(this);
    this.className = "Event";
    
    this.type = type || eEventType.Unknown;
    this.time = time || 0;
    this.userData = userData || null;
}

Event.prototype.synchronize = function(src)
{
    this.type = src.type;
    this.time = src.time;
    this.userData = src.userData;
}
InputEvent.prototype = new Event();
InputEvent.prototype.constructor = InputEvent;

function InputEvent(type, time, inputId, modifiers, state, userData)
{
    Event.call(this, type, time, userData);
    this.className = "InputEvent";
    
    this.inputId = inputId || 0;
    this.modifiers = modifiers || 0;
    this.state = state || 0;
}

InputEvent.prototype.synchronize = function(src)
{
	this.inputId = src.inputId;
	this.modifiers = src.modifiers;
	this.state = src.state;

	Event.prototype.synchronize.call(this, src);
}
var MOUSEEVENT_LEFT_BUTTON     = 0x0001;
var MOUSEEVENT_MIDDLE_BUTTON   = 0x0002;
var MOUSEEVENT_RIGHT_BUTTON    = 0x0004;

MouseEvent.prototype = new InputEvent();
MouseEvent.prototype.constructor = MouseEvent;

function MouseEvent(type, time, buttonId, modifiers, state, x, y, userData)
{
    InputEvent.call(this, type, time, buttonId, modifiers, state, userData);
    this.className = "MouseEvent";
    
    this.x = x || 0;
    this.y = y || 0;
}
KeyboardEvent.prototype = new InputEvent();
KeyboardEvent.prototype.constructor = KeyboardEvent;

function KeyboardEvent(type, time, buttonId, modifiers, state, userData)
{
    InputEvent.call(this, type, time, buttonId, modifiers, state, userData);
    this.className = "KeyboardEvent";
}
function MouseEventState()
{
    this.leftButtonDown = false;
    this.middleButtonDown = false;
    this.rightButtonDown = false;
}

EventAdapter.prototype = new AttributeContainer();
EventAdapter.prototype.constructor = EventAdapter;

function EventAdapter()
{
    AttributeContainer.call(this);
    this.className = "EventAdapter";
    
    this.mouseState = new MouseEventState();
    
    this.name = new StringAttr("EventAdapter");
    
    this.registerAttribute(this.name, "name");
}

EventAdapter.prototype.createKeyboardEvent = function(event, eventType /* optional; used for "keyup" */)
{
    var date = new Date();
    
    var type = eEventType.Unknown;
    var time = date.getTime();
    var buttonId = event.keyCode;
    var modifiers = 0;  // TODO
    var state = 0;      // TODO
    
    var eventType = eventType || event.type;
    switch (eventType)
    {
        case "keydown":
            {
                type = eEventType.KeyDown_First + buttonId;
            }
            break;
            
        case "keypress":
            {
                type = eEventType.KeyDown_First + buttonId - 32; //  not sure why keycodes have +32 compared to keydown events
            }
            break;
            
        case "keyup":
            {
                type = eEventType.KeyUp_First + buttonId;
            }
            break;
    }
    
    var keyboardEvent = new KeyboardEvent(type, time, buttonId, modifiers, state);
    
    return keyboardEvent;
}

EventAdapter.prototype.createMouseEvent = function(event)
{
    var date = new Date();
    
    var type = eEventType.Unknown;
    var time = date.getTime();
    var buttonId = 0;
    var modifiers = 0;  // TODO
    var state = 0;      // TODO
    
    var x = event.canvasX;
    var y = event.canvasY;

    switch (event.type)
    {
    case "click":
        {
            switch (event.button)
            {
            case 0: type = eEventType.MouseLeftClick; break;
            case 1: type = eEventType.MouseMiddleDown; break;
            case 2: type = eEventType.MouseRightClick; break;
            } 
        }
        break;

    case "dblclick":
        {
            switch (event.button)
            {
            case 0: type = eEventType.MouseLeftDblClick; break;
            case 1: type = eEventType.MouseMiddleDblClick; break;
            case 2: type = eEventType.MouseRightDblClick; break;
            }    
        }
        break;
        
    case "mousedown":
        {
            switch (event.button)
            {
            case 0:
                { 
                    if (this.mouseState.rightButtonDown)
                    {
                        type = eEventType.MouseBothDown;
                    }
                    else 
                    {
                        type = eEventType.MouseLeftDown;
                    }
                    this.mouseState.leftButtonDown = true;
                }
                break;
                
            case 1: 
                {
                    type = eEventType.MouseMiddleDown;
                    this.mouseState.middleButtonDown = true;
                }
                break;
                
            case 2: 
                {
                    if (this.mouseState.leftButtonDown)
                    {
                        type = eEventType.MouseBothDown;
                    }
                    else 
                    {
                        type = eEventType.MouseRightDown;
                    }
                    this.mouseState.rightButtonDown = true;
                }
                break;
            }
        }
        break;
      
    case "mouseup":
        {
            switch (event.button)
            {
            case 0:
                { 
                    type = eEventType.MouseLeftUp; 
                    this.mouseState.leftButtonDown = false;
                }
                break;
                
            case 1: 
                {
                    type = eEventType.MouseMiddleUp;
                    this.mouseState.middleButtonDown = false;
                }
                break;
                
            case 2: 
                {
                    type = eEventType.MouseRightUp;
                    this.mouseState.rightButtonDown = false;
                }
                break;
            }
        }
        break;
        
    case "mousemove":
        {
            type = eEventType.MouseMove;
        }
        break;
        
        case "mousewheel":
        {
            type = eEventType.MouseWheelBackward;
        }
        break;

    default:
        {
            type = eEventType.UserDefined; // TEMPTEST (?)
        }
        break;
    }       
    
    // set which buttons are pressed to buttonId
    if (this.mouseState.leftButtonDown)     buttonId |= MOUSEEVENT_LEFT_BUTTON;
    if (this.mouseState.middleButtonDown)   buttonId |= MOUSEEVENT_MIDDLE_BUTTON;
    if (this.mouseState.rightButtonDown)    buttonId |= MOUSEEVENT_RIGHT_BUTTON;
    
    var mouseEvent = new MouseEvent(type, time, buttonId, modifiers, state, x, y);
    
    return mouseEvent;
}
EventListener.prototype = new Agent();
EventListener.prototype.constructor = EventListener;

function EventListener()
{
    Agent.call(this);
    this.className = "EventListener";
    
    this.events = [];
    
    this.listen = new BooleanAttr(true);
    this.trigger = new StringAttr("");
    this.numResponses = new NumberAttr(1);
    this.event = new StringAttr("");
    
    this.event.addModifiedCB(EventListener_EventModifiedCB, this);
    
    this.registerAttribute(this.listen, "listen");
    this.registerAttribute(this.trigger, "trigger");
    this.registerAttribute(this.numResponses, "numResponses");
    this.registerAttribute(this.event, "event");
}

EventListener.prototype.addEventType = function(type)
{
    this.events.push(type);
    
    // for serialization
    var name = this.event.getValueDirect().join("");
    var event = new StringAttr(name);
    event.flagDeserializedFromXML(); 
    this.events.push(event);
    this.registerAttribute(event, "event");
}

EventListener.prototype.getEventTypes = function()
{
    return this.events;
}

EventListener.prototype.eventPerformed = function(event)
{
    // decr numResponses
    var numResponses = this.numResponses.getValueDirect();
    if (numResponses > 0)
    {
        this.numResponses.setValueDirect(numResponses-1);
    }
}
EventListener.prototype.getTrigger = function()
{
    this.trigger;
}
EventListener.prototype.setTrigger = function(trigger)
{
    if(trigger)
    {
        this.trigger = trigger;
    }
}

function EventListener_EventModifiedCB(attribute, container)
{
    var type = getEventTypeByName(attribute.getValueDirect().join(""));
    // TODO -- restore the following line when all events are defined
    //if (type != eEventType.Unknown)
    {
        container.addEventType(type);
    }
}
EventMgr.prototype = new AttributeContainer();
EventMgr.prototype.constructor = EventMgr;

function EventMgr()
{
    AttributeContainer.call(this);
    this.className = "EventMgr";
    
    this.listeners = [];
    
    this.name = new StringAttr("EventMgr");
    
    this.registerAttribute(this.name, "name");
}

EventMgr.prototype.addListener = function(type, listener)
{
    if (this.listeners[type] == undefined)
    {
        this.listeners[type] = [];
    }
    
    // only add once
    if (this.listeners[type].indexOf(listener) == -1)
    {
        this.listeners[type].push(listener);
    }
}

EventMgr.prototype.removeListener = function(type, listener)
{
    if (this.listeners[type])
    {
        this.listeners[type].splice(this.listeners[type].indexOf(listener), 1);
    }    
}

EventMgr.prototype.processEvent = function(event)
{
    var type = event.type;
    var expired = [];
    
    // process event for registered listeners
    if (this.listeners[type])
    {
        for (var i=0; i < this.listeners[type].length; i++)
        {
            this.listeners[type][i].eventPerformed(event);
            
            // if listener has finished responding, add to expired list
            var numResponses = this.listeners[type][i].getAttribute("numResponses");
            if (numResponses && numResponses.getValueDirect() == 0)
            {
                expired.push(this.listeners[type][i]);
            }
        }
    }
    
    // remove expired listeners
    for (var i=0; i < expired.length; i++)
    {
        this.removeListener(type, expired[i]);
        this.registry.unregister(expired[i]);
    }
}
EventMgr.prototype.clearEvents = function()
{
/*
    this.bProcessingQs = false;
    this.bPendingRegistrations = false;

    while (!this.pendingAddsQ.empty())
    {
        var elp = m_pendingAddsQ.front();
        var elist = elp.second;
        this.elist.clear();
//        SAFE_DELETE(elist);
        this.pendingAddsQ.pop();
    }

    while (!this.userInputEventsQ.empty())
    {
        var pEvent = this.userInputEventsQ.front();
        this.userInputEventsQ.pop();
//        SAFE_RELEASE(pEvent);
    }

    while (!this.sceneOutputEventsQ.empty())
    {
        var pEvent = this.sceneOutputEventsQ.front();
        this.sceneOutputEventsQ.pop();
//        SAFE_RELEASE(pEvent);
    }

    this.removeAllListeners();
    */
    this.listeners.length = 0;
}
DeviceHandler.prototype = new EventListener();
DeviceHandler.prototype.constructor = DeviceHandler;

function DeviceHandler()
{
    EventListener.call(this);
    this.className = "DeviceHandler";
    this.attrType = eAttrType.DeviceHandler;
    
    this.inputMessage = new NumberAttr(0);
    this.inputId = new NumberAttr(0);
    this.inputModifier = new NumberAttr(0);
    this.inputState = new NumberAttr(0);
    this.prevInputState = new NumberAttr(0);
    this.output = new StringAttr("");
    
    this.registerAttribute(this.inputMessage, "inputMessage");
    this.registerAttribute(this.inputId, "inputId");
    this.registerAttribute(this.inputModifier, "inputModifier");
    this.registerAttribute(this.inputState, "inputState");
    this.registerAttribute(this.prevInputState, "prevInputState");
    this.registerAttribute(this.output, "output");
    
    // always respond to events
    this.numResponses.setValueDirect(-1);
}

DeviceHandler.prototype.eventPerformed = function(event)
{
    this.inputMessage.setValueDirect(event.type);
    this.inputId.setValueDirect(event.inputId);
    this.inputState.setValueDirect(event.state);
    this.inputModifier.setValueDirect(event.modifiers);
}
MouseHandler.prototype = new DeviceHandler();
MouseHandler.prototype.constructor = MouseHandler;

function MouseHandler()
{
    DeviceHandler.call(this);
    this.className = "MouseHandler";
    this.attrType = eAttrType.MouseHandler;
    
    this.name.setValueDirect("MouseHandler");
        
    this.lastX = 0;
    this.lastY = 0;
    
    this.x = new NumberAttr(0);
    this.y = new NumberAttr(0);
    this.deltaX = new NumberAttr(0);
    this.deltaY = new NumberAttr(0);
    this.delta = new Vector2DAttr(0, 0);
    
    this.registerAttribute(this.x, "deviceX");
    this.registerAttribute(this.y, "deviceY");
    this.registerAttribute(this.deltaX, "deltaX");
    this.registerAttribute(this.deltaY, "deltaY");
    this.registerAttribute(this.delta, "delta");
   
    this.addEventType(eEventType.MouseMove);
    this.addEventType(eEventType.MouseLeftDown);
}

MouseHandler.prototype.eventPerformed = function(event)
{
    var x = event.x;
    var y = event.y;

    switch (event.type)
    {
    	case eEventType.MouseMove:
    	{
			// do nothing
    	}
    	break;
    	
    	default:
    	{
    		this.lastX = x;
    		this.lastY = y;
    	}
    	break;
    }
   
    this.x.setValueDirect(x);
    this.y.setValueDirect(y);
    
    this.deltaX.setValueDirect(this.lastX-x);
    this.deltaY.setValueDirect(this.lastY-y);
    
    this.delta.setValueDirect(this.lastX-x, this.lastY-y);
    
    this.lastX = x;
    this.lastY = y;
    
    // call the base class to copy the rest of the InputEvent data
	DeviceHandler.prototype.eventPerformed.call(this, event);

	this.deltaX.setValueDirect(0);
	this.deltaY.setValueDirect(0);
	this.delta.setValueDirect(0, 0);
}
KeyboardHandler.prototype = new DeviceHandler();
KeyboardHandler.prototype.constructor = KeyboardHandler;

function KeyboardHandler()
{
    DeviceHandler.call(this);
    this.className = "KeyboardHandler";
    this.attrType = eAttrType.KeyboardHandler;
    
    this.name.setValueDirect("KeyboardHandler");
    
    this.keyString = new StringAttr();
    
    this.registerAttribute(this.keyString, "keyString");
}

KeyboardHandler.prototype.eventPerformed = function(event)
{
    
}


Command.prototype = new EventListener();
Command.prototype.constructor = Command;

function Command()
{
    EventListener.call(this);
    this.className = "Command";
    this.attrType = eAttrType.Command;
    
    this.borrowedAttributes = [];
    this.attributeValuePairs = [];
    this.attributeRefPairs = [];
    
    this.target = new StringAttr("");
    
    this.registerAttribute(this.target, "target");
}

Command.prototype.finalize = function()
{  
}

Command.prototype.eventPerformed = function(event)
{
    if (this.listen.getValueDirect() == true)
    {
        this.execute();
    }
    
    // call base-class implementation
    EventListener.prototype.eventPerformed.call(this, event);
}

Command.prototype.isBorrowed = function(attribute)
{
    for (var i=0; i < this.borrowedAttributes.length; i++)
    {
        if (attribute == this.borrowedAttributes[i])
        {
            return true;
        }
    }

    return false;
}

Command.prototype.isBorrowedAndValueModified = function(attribute)
{
    if (this.isBorrowed(attribute))
    {
        for (var i=0; i < this.attributeValuePairs.length; i++)
        {
            if (attribute == this.attributeValuePairs[i].first)
            {
                return { borrowed: true, value: this.attributeValuePairs[i].second };
            }
        }
    }

    return { borrowed: false, value: null };
}

Command.prototype.isBorrowedAndReferenceModified = function(attribute)
{
    if (this.isBorrowed(attribute))
    {
        for (var i=0; i < this.attributeRefPairs.length; i++)
        {
            if (attribute == this.attributeRefPairs[i].second)
            {
                return { borrowed: true, reference: this.attributeRefPairs[i].first };
            }
        }
    }

    return { borrowed: false, reference: null };
}


AppendNodeCommand.prototype = new Command();
AppendNodeCommand.prototype.constructor = AppendNodeCommand;

function AppendNodeCommand()
{
    Command.call(this);
    this.className = "AppendNodeCommand";
    this.attrType = eAttrType.AppendNode;

    this.parent = new StringAttr("");
    this.child = new StringAttr("");
    this.parentNode = null;
    this.childNode = null;
    
    this.parent.addModifiedCB(AppendNodeCommand_ParentModifiedCB, this);
    this.child.addModifiedCB(AppendNodeCommand_ChildModifiedCB, this);
    
    this.registerAttribute(this.parent, "parent");
    this.registerAttribute(this.child, "child");   
}

AppendNodeCommand.prototype.execute = function()
{
    if (this.parentNode && this.childNode)
    {
        this.parentNode.addChild(this.childNode);
    }
}

function AppendNodeCommand_ParentModifiedCB(attribute, container)
{
    var parent = attribute.getValueDirect().join("");
    container.parentNode = container.registry.find(parent);
}

function AppendNodeCommand_ChildModifiedCB(attribute, container)
{
    var child = attribute.getValueDirect().join("");
    container.childNode = container.registry.find(child);
}
SetCommand.prototype = new Command();
SetCommand.prototype.constructor = SetCommand;

function SetCommand()
{
    Command.call(this);
    this.className = "Set";
    this.attrType = eAttrType.Set;
    
    this.target.addModifiedCB(SetCommand_TargetModifiedCB, this);
}

SetCommand.prototype.onUnregister = function()
{
    for (var i = 0; i < this.borrowedAttributes.length; i++)
    {
        this.unregisterAttribute(this.borrowedAttributes[i]);
    }
}

SetCommand.prototype.execute = function()
{
    // TODO: enabled (? - there is a commandEnabled attaribute in .cpp)
    
    this.applyAttributeValues();
}

SetCommand.prototype.applyAttributeValues = function()
{
    for (var i=0; i < this.attributeValuePairs.length; i++)
    {
        setAttributeValue(this.attributeValuePairs[i].first, this.attributeValuePairs[i].second);
    }
}

SetCommand.prototype.registerTargetAttributes = function(target, targetName)
{
    var sname;
    var myAttribute;
    var count = target.getAttributeCount();
    for (var i=0; i < count; i++)
    {
        var attribute = target.getAttributeAt(i);
        var attributeName = target.getAttributeNameAt(i);

        // if the target has an attribute of the same name as the
		// Set, register that same attribute using a relative path
		// expression, e.g., "Container_target"
		if ((myAttribute = this.getAttribute(attributeName)) != null)
		{
			// insert relative path expression
			sName = targetName + "_";	
			sName += attributeName;	
		}
		else	// attribute is not already registered
		{
			sName = attributeName;
		}
		
		this.registerAttribute(attribute, sName);
		this.borrowedAttributes.push(attribute);
    }    
}

function SetCommand_TargetModifiedCB(attribute, container)
{ 
    var target = attribute.getValueDirect().join("");
    var targets = target.split(",");
    
    container.targets.length = 0;
    for (var i=0; i < targets.length; i++)
    {
        var resource = container.registry.find(targets[i]);
        if (resource)
        {
            container.registerTargetAttributes(resource, targets[i]);
        }
    }
    
    setAttributeBin(container.attributeValuePairs);
}
function ConnectionDesc()
{
    this.sourceContainer = null;
    this.targetContainer = null;
    this.sourceAttribute = null;
    this.targetAttribute = null;
    this.sourceAttributeName = "";
    this.targetAttributeName = "";
    this.sourceIndex = -1;
    this.targetIndex = -1;
}

var gConnectionHelpers = [];

function registerConnectionHelper(type, connect, disconnect)
{
    gConnectionHelpers[type] = new Pair(connect, disconnect);
}

ConnectAttributesCommand.prototype = new Command();
ConnectAttributesCommand.prototype.constructor = ConnectAttributesCommand;

function ConnectAttributesCommand()
{
    Command.call(this);
    this.className = "ConnectAttributes";
    this.attrType = eAttrType.ConnectAttributes;
    
    this.connections = new Stack();
    this.connectionHelper = new Pair(null, null);
    
    this.sourceContainer = new StringAttr("");
    this.targetContainer = new StringAttr("");
    this.sourceAttribute = new StringAttr("");
    this.targetAttribute = new StringAttr("");
    this.source = new StringAttr("");
    this.negate = new BooleanAttr(false);   // if true, disconnect
    this.persist = new BooleanAttr(true);
    this.connectionType = new StringAttr("");
    
    this.source.addTarget(this.sourceAttribute);
    this.target.addTarget(this.targetAttribute);
    
    this.sourceContainer.addModifiedCB(ConnectAttributesCommand_SourceContainerModifiedCB, this);
    this.targetContainer.addModifiedCB(ConnectAttributesCommand_TargetContainerModifiedCB, this);
    this.sourceAttribute.addModifiedCB(ConnectAttributesCommand_SourceAttributeModifiedCB, this);
    this.targetAttribute.addModifiedCB(ConnectAttributesCommand_TargetAttributeModifiedCB, this);
    this.connectionType.addModifiedCB(ConnectAttributesCommand_ConnectionTypeModifiedCB, this);
    this.negate.addModifiedCB(ConnectAttributesCommand_NegateModifiedCB, this);
    
    this.registerAttribute(this.sourceContainer, "sourceContainer");
	this.registerAttribute(this.sourceContainer, "sourceEvaluator");
	this.registerAttribute(this.targetContainer, "targetContainer");
	this.registerAttribute(this.sourceAttribute, "sourceAttribute");
	this.registerAttribute(this.sourceAttribute, "sourceOutput");
	this.registerAttribute(this.targetAttribute, "targetAttribute");
	this.registerAttribute(this.source, "source");
	this.registerAttribute(this.negate, "negate");
	this.registerAttribute(this.persist, "persist");
	this.registerAttribute(this.connectionType, "connectionType");
}

ConnectAttributesCommand.prototype.finalize = function()
{
    // for serialization; register each sourceAttribute/targetAttribute pair
    for (var i=0; i < this.connections.length()-2; i++)
    {
        var connection = this.connections.getAt(i);
        if (connection.sourceAttribute && connection.targetAttribute)
        {
            var sourceAttribute = new StringAttr(connection.sourceAttributeName);
            sourceAttribute.flagDeserializedFromXML();
            this.registerAttribute(sourceAttribute, "sourceAttribute");
            
            var targetAttribute = new StringAttr(connection.targetAttributeName);
            targetAttribute.flagDeserializedFromXML();
            this.registerAttribute(targetAttribute, "targetAttribute"); 
        }    
    }
    
    // call base-class implementation
    Command.prototype.finalize.call(this);
}

ConnectAttributesCommand.prototype.eventPerformed = function(event)
{
    // TEMPTEST
    // call base-class implementation
    Command.prototype.eventPerformed.call(this, event);
}

ConnectAttributesCommand.prototype.execute = function()
{
    var desc = this.connections.top();
    var persist = this.persist.getValueDirect();
    
    var sourceEvaluator = null;
    if (desc.sourceContainer &&
        desc.sourceContainer.attrType >= eAttrType.Evaluator &&
        desc.sourceContainer.attrType <= eAttrType.Evaluator_End)
    {
        sourceEvaluator = desc.sourceContainer;
    }
    
    if (this.negate.getValueDirect() == false)
    {
        if (this.connectionHelper.first)
        {
            this.connectionHelper.first(desc.sourceContainer, desc.targetContainer)
            if (!persist && this.connectionHelper.second)
            {
                // if source is evaluator, evaluate
                if (sourceEvaluator) sourceEvaluator.evalute();
                
                this.connectionHelper.second(desc.sourceContainer, desc.targetContainer);
            }
        }
        else
        {
            this.addOrRemoveTargets(true);
            
            if (!persist)
            {
                // if source is evaluator, evaluate
                if (sourceEvaluator) sourceEvaluator.evalute();
                
                this.addOrRemoveTargets(false);
            }
        }
    }
    else // negate - disconnect
    {
        if (this.connectionHelper.second)
        {
            var desc = this.connections.top();
            this.connectionHelper.second(desc.sourceContainer, desc.targetContainer);
            
            // if source is evaluator, evaluate
            if (sourceEvaluator) sourceEvaluator.evalute();
        }
        else
        {
            this.addOrRemoveTargets(false);
            
            // if source is evaluator, evaluate
            if (sourceEvaluator) sourceEvaluator.evalute();
        }
    }
}

ConnectAttributesCommand.prototype.addOrRemoveTargets = function(add)
{
    for (var i=0; i < this.connections.length(); i++)
    {
        var desc = this.connections.getAt(i);
        if (desc.sourceAttribute && desc.targetAttribute)
        {
            // always remove first to ensure no duplicates
            desc.sourceAttribute.removeElementTarget(desc.targetAttribute, desc.sourceIndex, desc.targetIndex);
            if (add)
            {
                desc.sourceAttribute.addElementTarget(desc.targetAttribute, desc.sourceIndex, desc.targetIndex);
            }
            
            // detect connection of a screenPosition to anything and disable display lists
            var container = desc.sourceAttribute.getContainer();
            if (container)
            {   
                var screenPosition = container.getAttribute("screenPosition");
                if (screenPosition && screenPosition == desc.sourceAttribute)
                {
                    var autoDL = container.getAttribute("autoDisplayList");
                    if (autoDL)
                    {
                        autoDL.setValueDirect(false);    
                    }
                    
                    var enableDL = container.getAttribute("enableDisplayList");
                    if (enableDL)
                    {
                        enableDL.setValueDirect(false);    
                    }
                }
            }
        }
    }
}

function ConnectAttributesCommand_SourceContainerModifiedCB(attribute, container)
{
    if (container.connections.length() == 0)
    {
        container.connections.push(new ConnectionDesc());
    }
    var connection = container.connections.top();
    connection.sourceContainer = container.registry.find(attribute.getValueDirect().join(""));       
}

function ConnectAttributesCommand_TargetContainerModifiedCB(attribute, container)
{
    if (container.connections.length() == 0)
    {
        container.connections.push(new ConnectionDesc());
    }
    var connection = container.connections.top();     
    connection.targetContainer = container.registry.find(attribute.getValueDirect().join(""));       
}

function ConnectAttributesCommand_SourceAttributeModifiedCB(attribute, container)
{
    var source = null;
    var index = -1;
    
    if (container.connections.length() == 0)
    {
        container.connections.push(new ConnectionDesc());
    }

    var connection = container.connections.top();    
    if (connection.sourceContainer)
    {
        var sourceTokens = attribute.getValueDirect().join("").split(":");
        source = connection.sourceContainer.getAttribute(sourceTokens[0]);
        if (sourceTokens.length > 1)
        {
            index = sourceTokens[1];
        }              
    }
    else
    {
        source = container.registry.find(attribute.getValueDirect().join(""));
        if (source)
        {
            connection.sourceContainer = source.getContainer();
            if (!connection.sourceContainer) connection.sourceContainer = source;     
        }
    }
    
    connection.sourceAttribute = source;
    connection.sourceAttributeName = attribute.getValueDirect().join("");
    connection.sourceIndex = index;
    
    // if source and target attributes have both been set, push another connection desc for the next source/target pair
    if (connection.sourceAttribute && connection.targetAttribute)
    {
        container.connections.push(new ConnectionDesc());
        container.connections.top().sourceContainer = connection.sourceContainer;
        container.connections.top().targetContainer = connection.targetContainer;
    }
}

function ConnectAttributesCommand_TargetAttributeModifiedCB(attribute, container)
{
    var target = null;
    var index = -1;
    
    if (container.connections.length() == 0)
    {
        container.connections.push(new ConnectionDesc());
    }
    
    var connection = container.connections.top();    
    if (connection.targetContainer)
    {
        var targetTokens = attribute.getValueDirect().join("").split(":");
        target = connection.targetContainer.getAttribute(targetTokens[0]);
        if (targetTokens.length > 1)
        {
            index = targetTokens[1];
        }              
    }
    else
    {
        target = container.registry.find(attribute.getValueDirect().join(""));
        if (target)
        {
            connection.targetContainer = target.getContainer();
            if (!connection.targetContainer) connection.targetContainer = target;     
        }
    }
    
    connection.targetAttribute = target;
    connection.targetAttributeName = attribute.getValueDirect().join("");
    connection.targetIndex = index;
        
    // if source and target attributes have both been set, push another connection desc for the next source/target pair
    if (connection.sourceAttribute && connection.targetAttribute)
    {
        container.connections.push(new ConnectionDesc());
        container.connections.top().sourceContainer = connection.sourceContainer;
        container.connections.top().targetContainer = connection.targetContainer;
    }
}

function ConnectAttributesCommand_ConnectionTypeModifiedCB(attribute, container)
{
    var helpers = gConnectionHelpers[attribute.getValueDirect().join("")];
    if (helpers)
    {
        container.connectionHelper.first = helpers.first;
        container.connectionHelper.second = helpers.second;
    }
}

function ConnectAttributesCommand_NegateModifiedCB(attribute, container)
{
    var negate = attribute.getValueDirect();
    if (negate)
    {
        container.className = "DisconnectAttributes";
        container.attrType = eAttrType.DisconnectAttributes;
    }
    else // !negate
    {
        container.className = "ConnectAttributes";
        container.attrType = eAttrType.ConnectAttributes;       
    }
}
AutoInterpolateCommand.prototype = new Command();
AutoInterpolateCommand.prototype.constructor = AutoInterpolateCommand;

function AutoInterpolateCommand()
{
    Command.call(this);
    this.className = "AutoInterpolate";
    this.attrType = eAttrType.AutoInterpolate;

    this.kfi = null;
    this.numValueChannels = 0;
    this.numReferenceChannels = 0;
    this.numChannels = 0;

    this.shape = new NumberAttr(eKeyframeShape.Linear);
    this.duration = new NumberAttr(1);
    this.preBehavior = new NumberAttr(eEndBehavior.Constant);
    this.postBehavior = new NumberAttr(eEndBehavior.Constant);
    this.renderAndRelease = new BooleanAttr(true);

    this.target.addModifiedCB(AutoInterpolateCommand_TargetModifiedCB, this);

    this.registerAttribute(this.shape, "shape");
    this.registerAttribute(this.duration, "duration");
    this.registerAttribute(this.preBehavior, "preBehavior");
    this.registerAttribute(this.postBehavior, "postBehavior");
    this.registerAttribute(this.renderAndRelease, "renderAndRelease");
}

AutoInterpolateCommand.prototype.execute = function()
{
    // TODO: enabled (?)

    this.buildMotion();
    if (this.kfi)
    {
        this.kfi.getAttribute("time").setValueDirect(0);
        this.kfi.getAttribute("enabled").setValueDirect(true);
    }
}

AutoInterpolateCommand.prototype.buildMotion = function()
{
    var factory = this.registry.find("AttributeFactory");
    this.kfi = factory.create("KeyframeInterpolator");
    if (!this.kfi)
    {
        return;
    }
    this.kfi.getAttribute("enabled").setValueDirect(false);
    this.kfi.getAttribute("renderAndRelease").copyValue(this.renderAndRelease);

    var name = this.name.getValueDirect().join("");
    name += "_AutoInterpolator";
    this.kfi.getAttribute("name").setValueDirect(name);

    for (var i = 0; i < this.attributeValuePairs.length; i++)
    {
        this.numValueChannels += this.attributeValuePairs[i].first.getLength();
    }
    for (var i = 0; i < this.attributeRefPairs.length; i++)
    {
        this.numReferenceChannels += this.attributeRefPairs[i].first.getLength();
    }
    this.numChannels = this.numValueChannels + this.numReferenceChannels;
    this.kfi.setNumChannels(this.numChannels);

    var pre = this.preBehavior.getValueDirect();
    var post = this.postBehavior.getValueDirect();
    for (var i = 0; i < this.numChannels; i++)
    {
        this.kfi.getAttribute("preBehaviors").getAt(i).setValueDirect(pre);
        this.kfi.getAttribute("postBehaviors").getAt(i).setValueDirect(post);
    }

    // apply the parsed values to the kfi
    this.applyAttributeValues();
    this.applyAttributeRefs();
}

AutoInterpolateCommand.prototype.applyAttributeValues = function()
{
    // i = channel counter, advanced by j elements each pass
    // j = element of an Attribute, always 0 for primitive Attrs or 0-length-1 for complex
    // k = index in attribute values map
    var i, j, k;
    for (i = 0, k = 0; k < this.attributeValuePairs.length; k++)
    {
        var attr = this.attributeValuePairs[k].first;
        var value = this.attributeValuePairs[k].second;

        // for each channel:
        // 1. create a starting keyframe from target's current value for each attribute
        // 2. create an ending keyframe from the value contained in the map for each attribute
        for (j = 0; j < attr.getLength(); j++)
        {
            var keyframes = this.kfi.getAttribute("channels").getAt(i + j);

            var start = new KeyframeAttr();
            var end = new KeyframeAttr();

            start.getAttribute("time").setValueDirect(0);
            end.getAttribute("time").setValueDirect(this.duration.getValueDirect());

            start.getAttribute("shape").setValueDirect(this.shape.getValueDirect());
            end.getAttribute("shape").setValueDirect(this.shape.getValueDirect());

            // ensure numerical value with parseFloat()
            var startVal = parseFloat(attr.getElement(j));
            var endVal = parseFloat(attr.getLength() > 1 ? value[j] : value);

            // if the attribute is rotational (determined by "rotation" or "angle" as the attribute name),
            // ensure motion will be the shortest path (eliminate the spin caused by 360's)
            if (this.isAttributeRotational(attr))
            {
                var shortestPath = this.shortestPath(startVal, endVal);
                startVal = shortestPath.start;
                endVal = shortestPath.end;
            }

            start.getAttribute("value").setValueDirect(startVal);
            end.getAttribute("value").setValueDirect(endVal);

            keyframes.push_back(start);
            keyframes.push_back(end);

            // connect the interpolator's output to the attribute
            this.kfi.getAttribute("resultValues").getAt(i + j).addElementTarget(attr, 0, j)
        }

        i += j;
    }
}

AutoInterpolateCommand.prototype.applyAttributeRefs = function()
{
    // i = channel counter, advanced by j elements each pass
    // j = element of an Attribute, always 0 for primitive Attrs or 0-length-1 for complex
    // k = index in attribute values map
    var i, j, k;
    for (i = 0, k = 0; k < this.attributeRefPairs.length; k++)
    {
        var ref = this.attributeRefPairs[k].first;
        var attr = this.attributeRefPairs[k].second;

        // for each channel:
        // 1. create a starting keyframe from target's current value for each attribute
        // 2. create an ending keyframe from the value contained in the map for each attribute
        for (j = 0; j < attr.getLength(); j++)
        {
            var keyframes = this.kfi.getAttribute("channels").getAt(i + j);

            var start = new KeyframeAttr();
            var end = new KeyframeAttr();

            start.getAttribute("time").setValueDirect(0);
            end.getAttribute("time").setValueDirect(this.duration.getValueDirect());

            start.getAttribute("shape").setValueDirect(this.shape.getValueDirect());
            end.getAttribute("shape").setValueDirect(this.shape.getValueDirect());

            // ensure numerical value with parseFloat()
            var startVal = parseFloat(attr.getElement(j));
            var endVal = parseFloat(ref.getElement(j));

            // if the attribute is rotational (determined by "rotation" or "angle" as the attribute name),
            // ensure motion will be the shortest path (eliminate the spin caused by 360's)
            if (this.isAttributeRotational(attr))
            {
                var shortestPath = this.shortestPath(startVal, endVal);
                startVal = shortestPath.start;
                endVal = shortestPath.end;
            }

            start.getAttribute("value").setValueDirect(startVal);
            end.getAttribute("value").setValueDirect(endVal);

            keyframes.push_back(start);
            keyframes.push_back(end);

            // connect the interpolator's output to the attribute
            this.kfi.getAttribute("resultValues").getAt(i + j).addElementTarget(attr, 0, j)
        }

        i += j;
    }
}

AutoInterpolateCommand.prototype.registerTargetAttributes = function(target, targetName)
{
    var sname;
    var myAttribute;
    var count = target.getAttributeCount();
    for (var i = 0; i < count; i++)
    {
        var attribute = target.getAttributeAt(i);
        var attributeName = target.getAttributeNameAt(i);

        // if the target has an attribute of the same name as the
        // Set, register that same attribute using a relative path
        // expression, e.g., "Container_target"
        if ((myAttribute = this.getAttribute(attributeName)) != null)
        {
            // insert relative path expression
            sName = targetName + "_";
            sName += attributeName;
        }
        else	// attribute is not already registered
        {
            sName = attributeName;
        }

        this.registerAttribute(attribute, sName);
        this.borrowedAttributes.push(attribute);
    }
}

AutoInterpolateCommand.prototype.isAttributeRotational = function(attr)
{
    var container = attr.getContainer();
    if (container)
    {
        var name = container.getAttributeName(attr);
        if (name)
        {
            if (name == "rotation" ||
                name == "angle")
            {
                return true;
            }
        }
    }

    return false;
}

AutoInterpolateCommand.prototype.shortestPath = function(start, end)
{
    // normalize start to [0, 360)
    var nstart = degreeNormalize(start);

    // normalize end to [0, 360]
    var nend = degreeNormalize(end);

    // calculate direct path
    var directPath = nend - nstart;
    if (directPath <= 180 && directPath >= -180)
    {
        return { start: start, end: end }; // direct path is shortest path, no changes necessary
    }

    // if direct path > 180 or < -180, a shorter path exists
    var shortestPath = 0;
    if (directPath > 180)
    {
        shortestPath = 360 - directPath;
    }
    else //if (directPath < -180)
    {
        shortestPath = 360 + directPath;
    }

    // update start/end so that shortest path is traversed
    start = nstart;
    if (nend > nstart)
    {
        end = nstart - shortestPath;
    }
    else
    {
        end = nstart + shortestPath;
    }

    return { start: start, end: end };
}

function AutoInterpolateCommand_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    var targets = target.split(",");

    container.targets.length = 0;
    for (var i = 0; i < targets.length; i++)
    {
        var resource = container.registry.find(targets[i]);
        if (resource)
        {
            container.registerTargetAttributes(resource, targets[i]);
        }
    }

    setAttributeBin(container.attributeValuePairs);
    setAttributePairs(container.attributeRefPairs);
}

MotionInterpolateCommand.prototype = new AutoInterpolateCommand();
MotionInterpolateCommand.prototype.constructor = MotionInterpolateCommand;

function MotionInterpolateCommand()
{
    AutoInterpolateCommand.call(this);
    this.className = "MotionInterpolateCommand";

    this.startPosition = new Vector3DAttr();
    this.endPosition = new Vector3DAttr();
    this.resultPosition = new Vector3DAttr();
    this.positionControl = new Vector3DAttr();
    this.easeIn = new BooleanAttr(true);
    this.easeOut = new BooleanAttr(true);
    this.midPosition = new Vector3DAttr();

    //this.resultPosition.addModifiedCB(MotionInterpolateCommand_ResultPositionModifiedCB, this);
    
    this.registerAttribute(this.startPosition, "startPosition");
    this.registerAttribute(this.endPosition, "endPosition");
    this.registerAttribute(this.resultPosition, "resultPosition");
    this.registerAttribute(this.positionControl, "positionControl");
    this.registerAttribute(this.easeIn, "easeIn");
    this.registerAttribute(this.easeOut, "easeOut");
}

MotionInterpolateCommand.prototype.execute = function()
{
    // call base-class implementation
    AutoInterpolateCommand.prototype.execute.call(this);
}

MotionInterpolateCommand.prototype.buildMotion = function()
{
    var factory = this.registry.find("AttributeFactory");
    this.kfi = factory.create("KeyframeInterpolator");
    if (!this.kfi)
    {
        return;
    }
    this.kfi.getAttribute("enabled").setValueDirect(false);
    this.kfi.getAttribute("renderAndRelease").copyValue(this.renderAndRelease);

    this.numChannels = 3;
    this.kfi.setNumChannels(this.numChannels);

    var pre = this.preBehavior.getValueDirect();
    var post = this.postBehavior.getValueDirect();
    for (var i = 0; i < this.numChannels; i++)
    {
        this.kfi.getAttribute("preBehaviors").getAt(i).setValueDirect(pre);
        this.kfi.getAttribute("postBehaviors").getAt(i).setValueDirect(post);
    }

    // set the keyframes
    this.setKeyframes();
}

MotionInterpolateCommand.prototype.setKeyframes = function()
{
    // get start position
    var startPosition = this.startPosition.getValueDirect();

    // get end position
    var endPosition = this.endPosition.getValueDirect();

    // get distance between start/end
    var positionDelta = distanceBetween(startPosition, endPosition);

    // get position control vector
    var positionControl = new Vector3D(); 
    positionControl.copy(this.positionControl.getValueDirect());
    positionControl.normalize();

    // get mid position
    var midPosition = new Vector3D(
        ((startPosition.x + endPosition.x) / 2) + (positionControl.x * (positionDelta / 2)),
        ((startPosition.y + endPosition.y) / 2) + (positionControl.y * (positionDelta / 2)),
        ((startPosition.z + endPosition.z) / 2) + (positionControl.z * (positionDelta / 2)));
    this.midPosition.setValueDirect(midPosition.x, midPosition.y, midPosition.z);

    // get ease-in, ease-out settings
    var easeIn = this.easeIn.getValueDirect();
    var easeOut = this.easeOut.getValueDirect();

    // get shape
    var shape = this.shape.getValueDirect();

    // get duration
    var duration = this.duration.getValueDirect();

    // for each channel...
    for (var channel = 0; channel < this.numChannels; channel++)
    {
        var keyframes = this.kfi.getAttribute("channels").getAt(channel);

        var start = new KeyframeAttr();
        var mid = new KeyframeAttr();
        var end = new KeyframeAttr();

        start.getAttribute("time").setValueDirect(0);
        mid.getAttribute("time").setValueDirect(duration * 0.5);
        end.getAttribute("time").setValueDirect(duration);

        start.getAttribute("shape").setValueDirect(shape);
        mid.getAttribute("shape").setValueDirect(shape);
        end.getAttribute("shape").setValueDirect(shape);

        start.getAttribute("value").setValueDirect(this.startPosition.getElement(channel));
        mid.getAttribute("value").setValueDirect(this.midPosition.getElement(channel));
        end.getAttribute("value").setValueDirect(this.endPosition.getElement(channel));

        keyframes.push_back(start);
        keyframes.push_back(mid);
        keyframes.push_back(end);

        this.kfi.getAttribute("resultValues").getAt(channel).addElementTarget(this.resultPosition, 0, channel);
    }
}

function MotionInterpolateCommand_ResultPositionModifiedCB(attribute, container)
{
    var value = attribute.getValueDirect();

    OutputDebugMsg("x: " + value.x + " y: " + value.y + " z: " + value.z + "\n");
}
LocateCommand.prototype = new Command();
LocateCommand.prototype.constructor = LocateCommand;

function LocateCommand()
{
    Command.call(this);
    this.className = "LocateCommand";
    this.attrType = eAttrType.Locate;

    this.targetNode = null;
    this.directive = new BBoxDirective();
    this.locator = new BBoxLocator();
    this.inspector = null;

	this.duration = new NumberAttr(1);
	this.transition = new BooleanAttr(true);
	this.updateClipPlanes = new BooleanAttr(false);
	this.shape = new NumberAttr(eKeyframeShape.TCB);
	this.easeIn = new BooleanAttr(true);
	this.easeOut = new BooleanAttr(true);
	this.resultPosition = new Vector3DAttr();
	this.resultFarDistance = new NumberAttr();
	this.resultWidth = new NumberAttr();

    this.target.addModifiedCB(LocateCommand_TargetModifiedCB, this);

	this.registerAttribute(this.duration, "duration");
	this.registerAttribute(this.transition, "transition");
	this.registerAttribute(this.updateClipPlanes, "updateClipPlanes");
	this.registerAttribute(this.shape, "shape");
	this.registerAttribute(this.easeIn, "easeIn");
	this.registerAttribute(this.easeOut, "easeOut");
	this.registerAttribute(this.resultPosition, "resultPosition");
	this.registerAttribute(this.resultFarDistance, "resultFarDistance");
	this.registerAttribute(this.resultWidth, "resultWidth");

    this.registerAttribute(this.locator.getAttribute("closeness"), "closeness");
    this.registerAttribute(this.locator.getAttribute("resultPivotDistance"), "resultPivotDistance");
}

LocateCommand.prototype.execute = function()
{
    if (this.targetNode)
    {
        this.locate();
    }
}

LocateCommand.prototype.locate = function()
{
    var selector = this.registry.find("Selector");
    var viewportMgr = this.registry.find("ViewportMgr");

    // get camera at last select point (if no selection has been made, gets camera at (0, 0))
    var clickPoint = selector.getAttribute("clickPoint").getValueDirect();
    var vp = viewportMgr.getViewportAtScreenXY(clickPoint.x, clickPoint.y);
    var camera = vp.camera;
    var viewport = vp.viewport;

    // get world-space bbox
    this.directive.execute(this.targetNode);
    var bounds = this.directive.getBounds();
    this.locator.getAttribute("bbox").setValueDirect(bounds.min, bounds.max);

    // get view-space bbox
    var view = vp.camera.getTransform();
    view.invert();
    this.directive.getAttribute("viewTransform").setValueDirect(view);
    this.directive.getAttribute("viewSpace").setValueDirect(true);
    this.directive.execute(this.targetNode);
    bounds = this.directive.getBounds();
    this.locator.getAttribute("bboxView").setValueDirect(bounds.min, bounds.max);

    // copy current viewport to the locator's viewport attribute
    this.locator.getAttribute("viewport").setValueDirect(viewport.x, viewport.y, viewport.width, viewport.height);

    // inputs
    var locatorNear = this.locator.getAttribute("nearDistance");
    var locatorVolume = this.locator.getAttribute("viewVolume");
    var locatorViewPosition = this.locator.getAttribute("viewPosition");
    var locatorTransform = this.locator.getAttribute("viewTransform");

    // outputs
    var locatorResultPosition = this.locator.getAttribute("resultPosition");
    var locatorResultWidth = this.locator.getAttribute("resultWidth");
    var locatorResultFarDistance = this.locator.getAttribute("resultFarDistance");
    var resultPivotDistance = this.locator.getAttribute("resultPivotDistance");

    // output targets (others determined later)
    var targetPivotDistance = null;
    var updateClipPlanes = this.updateClipPlanes.getValueDirect();
    var transition = this.transition.getValueDirect();

    if (this.inspector)
    {
        targetPivotDistance = this.inspector.getAttribute("pivotDistance");
    }

    if (resultPivotDistance && targetPivotDistance)
    {
        resultPivotDistance.addTarget(targetPivotDistance);
    }

    cameraNear = camera.getAttribute("nearDistance");
    cameraFar = camera.getAttribute("farDistance");
    cameraWidth = camera.getAttribute("width");
    cameraVolume = camera.getAttribute("viewVolume");
    cameraPosition = camera.getAttribute("sectorPosition");
    cameraWorldPosition = camera.getAttribute("sectorWorldPosition");
    cameraWorldTransform = camera.getAttribute("sectorWorldTransform");

    cameraNear.addTarget(locatorNear);
    cameraVolume.addTarget(locatorVolume);
    cameraWorldPosition.addTarget(locatorViewPosition);
    cameraWorldTransform.addTarget(locatorTransform);

    // if NOT transitioning, apply the result directly back to the camera
    if (transition == false)
    {
        locatorResultPosition.addTarget(cameraPosition);
        locatorResultWidth.addTarget(cameraWidth);

        if (updateClipPlanes)
        {
            locatorResultFarDistance.addTarget(cameraFar);
        }

        this.locator.evaluate();

        locatorResultPosition.removeTarget(cameraPosition);

        // removing null or non-targets is harmless,
        // so no need to check, just call remove
        locatorResultWidth.removeTarget(cameraWidth);
        locatorResultFarDistance.removeTarget(cameraFar);
    }
    else
    {
        locatorResultPosition.addTarget(this.resultPosition);
        locatorResultWidth.addTarget(this.resultWidth);

        if (updateClipPlanes)
        {
            locatorResultFarDistance.addTarget(this.resultFarDistance);
        }

        this.locator.evaluate();

        locatorResultPosition.removeTarget(this.resultPosition);

        // removing null or non-targets is harmless,
        // so no need to check, just call remove
        locatorResultWidth.removeTarget(this.resultWidth);
        locatorResultFarDistance.removeTarget(this.resultFarDistance);

        // based upon shape value, create either a normal auto-interpolator (linear), or a
        // motion-interpolator (non-linear)
        switch (this.shape.getValueDirect())
        {
            case eKeyframeShape.Stepped:
            case eKeyframeShape.TCB:
            case eKeyframeShape.Bezier1D:
            case eKeyframeShape.Bezier2D:
                {
                    var factory = this.registry.find("AttributeFactory");
                    var autoInterpolate = factory.create("MotionInterpolate");

                    autoInterpolate.getAttribute("shape").copyValue(this.shape);
                    autoInterpolate.getAttribute("easeIn").copyValue(this.easeIn);
                    autoInterpolate.getAttribute("easeOut").copyValue(this.easeOut);
                    autoInterpolate.getAttribute("startPosition").copyValue(cameraPosition);
                    autoInterpolate.getAttribute("endPosition").copyValue(this.resultPosition);
                    autoInterpolate.getAttribute("resultPosition").addTarget(cameraPosition,
                        eAttrSetOp.Replace, null, false);

                    // get camera direction vectors
                    var dirs = camera.getDirectionVectors();

                    // set the inverse camera fwd vector to the interpolator's position control
                    autoInterpolate.getAttribute("positionControl").setValueDirect(-dirs.forward.x,
					    -dirs.forward.y, -dirs.forward.z);
                }
                break;

            case eKeyframeShape.Linear:
            default:
                {
                    var factory = this.registry.find("AttributeFactory");
                    var autoInterpolate = factory.create("AutoInterpolate");

                    autoInterpolate.attributeRefPairs.push(new Pair(this.resultPosition, cameraPosition));
                }
                break;
        }

        if (updateClipPlanes)
        {
            if (cameraWidth) autoInterpolate.attributeRefPairs.push(new Pair(this.resultWidth, cameraWidth));
            if (cameraFar) autoInterpolate.attributeRefPairs.push(new Pair(this.resultFarDistance, cameraFar));
        }

        autoInterpolate.target = camera;
        autoInterpolate.getAttribute("duration").copyValue(this.duration);
        autoInterpolate.execute();
        this.registry.unregister(autoInterpolate);
    }

    if (resultPivotDistance && targetPivotDistance)
    {
        resultPivotDistance.removeTarget(targetPivotDistance);
    }
}

function LocateCommand_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    var resource = container.registry.find(target);
    if (resource)
    {
        container.targetNode = resource;

        // try and locate a scene inspector for updating pivotDistance
        container.inspector = container.registry.find("SceneInspector");
    }
    else
    {
        console.debug("TODO: " + arguments.callee.name);
        // TODO: target not found
        //_snprintf(msg, sizeof(msg), "LocateBBox: target=\"%s\" not found\n", name.c_str());
        // TODO: Locate a point on an object and/or in the world
    }
}

PlayCommand.prototype = new Command();
PlayCommand.prototype.constructor = PlayCommand;

function PlayCommand()
{
    Command.call(this);
    this.className = "Play";
    this.attrType = eAttrType.Play;

    this.evaluators = [];
    this.negate = new BooleanAttr(false);   // if true, Pause
    
    this.registerAttribute(this.negate, "negate");
    
    this.target.addModifiedCB(PlayCommand_TargetModifiedCB, this);
    this.negate.addModifiedCB(PlayCommand_NegateModifiedCB, this);
}

PlayCommand.prototype.execute = function()
{
    // TODO: enabled (?)
	var renderAgent = this.registry.find("RenderAgent");
	if (renderAgent)
	{
        // SetEvaluatorPlayState not implemented by RenderAgent
        // ePlayState_* is not implemented by RenderAgent
        if (this.evaluators.length < 1)
        {
			if (this.negate.getValueDirect() == false)
			{
				renderAgent.setEvaluatorsPlayState(ePlayState.Play);
			}
			else
			{
				renderAgent.setEvaluatorsPlayState(ePlayState.Pause);
			}
        }
        else
        {
            for (var i = 0; i < this.evaluators.length; i++)
            {
         
    			if (this.negate.getValueDirect() == false)
    			{
    				renderAgent.setEvaluatorPlayState(evaluators[i], ePlayState.Play);
    			}
    			else
    			{
    				renderAgent.setEvaluatorPlayState(evaluators[i], ePlayState.Pause);
    			}
            
            }   
        }
	}
}

function PlayCommand_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    var targets = target.split(",");

    // find one or more evaluator to play
    container.targets.length = 0;   // copied this from Set. What does it do?
    for (var i = 0; i < targets.length; i++)
    {
        var evaluator = container.registry.find(targets[i]);
        if (evaluator)
        {
            container.evaluators[i] = evaluator;
        }
    }
}

function PlayCommand_NegateModifiedCB(attribute, container)
{
    var negate = attribute.getValueDirect();
    if (negate)
    {
        container.className = "Pause";
        container.attrType = eAttrType.Pause;
    }
    else // !negate
    {
        container.className = "Play";
        container.attrType = eAttrType.Play;       
    }
}
RemoveCommand.prototype = new Command();
RemoveCommand.prototype.constructor = RemoveCommand;

function RemoveCommand()
{
    Command.call(this);
    this.className = "RemoveCommand";
    this.attrType = eAttrType.Remove;

    this.targetAttribute = null;
    
    this.target.addModifiedCB(RemoveCommand_TargetModifiedCB, this);
}

RemoveCommand.prototype.execute = function()
{
    if (this.targetAttribute)
    {
        // if node, remove from tree, and remove/unregister all children
        if (this.targetAttribute.isNode())
        {
            var i = 0;
            var parent = null;
            while ((parent = this.targetAttribute.getParent(i++)))
            {
                parent.removeChild(this.targetAttribute);
            }

            this.removeChildren(this.targetAttribute);
        }

        // remove from registry
        this.registry.unregister(this.targetAttribute);
        
        // delete
        this.targetAttribute.destroy();
    }
}

RemoveCommand.prototype.removeChildren = function(root)
{
    var child = null;
	while ((child = root.getChild(0))) // get child 0 each time because we are removing the front child
	{
		// recurse on child
		this.removeChildren(child);

		// remove from registry
		this.registry.unregister(child);

		// remove from root node
		root.removeChild(child);
	}
}

function RemoveCommand_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    container.targetAttribute = container.registry.find(target);
}

StopCommand.prototype = new Command();
StopCommand.prototype.constructor = StopCommand;

function StopCommand()
{
    Command.call(this);
    this.className = "Stop";
    this.attrType = eAttrType.Stop;

    this.evaluators = [];
    
    this.target.addModifiedCB(StopCommand_TargetModifiedCB, this);

}

StopCommand.prototype.execute = function()
{
    // TODO: enabled (?)
	var renderAgent = this.registry.find("RenderAgent");
	if (renderAgent)
	{
        // SetEvaluatorStopState not implemented by RenderAgent
        // eStopState_* is not implemented by RenderAgent
        if (this.evaluators.length < 1)
        {
			renderAgent.setEvaluatorsPlayState(ePlayState.Stop);
        }
        else
        {
            for (var i = 0; i < this.evaluators.length; i++)
            {
         
    			renderAgent.setEvaluatorPlayState(evaluators[i], ePlayState.Stop);
            }   
        }
	}
}

function StopCommand_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    var targets = target.split(",");

    // find one or more evaluator to play
    container.targets.length = 0;   // copied this from Set. What does it do?
    for (var i = 0; i < targets.length; i++)
    {
        var evaluator = container.registry.find(targets[i]);
        if (evaluator)
        {
            container.evaluators[i] = evaluator;
        }
    }
}
CommandSequence.prototype = new Command();
CommandSequence.prototype.constructor = CommandSequence;

function CommandSequence()
{
    Command.call(this);
    this.className = "CommandSequence";
    this.attrType = eAttrType.CommandSequence;
    
    this.sequence = [];
}

CommandSequence.prototype.execute = function()
{
    for (var i=0; i < this.sequence.length; i++)
    {
        this.sequence[i].execute();
    }
}

CommandSequence.prototype.addCommand = function(command)
{
    this.sequence.push(command);
    
    // register command for serialization
    var num = this.sequence.length - 1;
    var name = "Command(" + num.toString() + ")";
    this.registerAttribute(command, name);
}
CommandMgr.prototype = new AttributeContainer();
CommandMgr.prototype.constructor = CommandMgr;

function CommandMgr()
{
    AttributeContainer.call(this);
    this.className = "CommandMgr";
    
    this.commandSeqStack = new Stack();
    
    this.name = new StringAttr("CommandMgr");
    
    this.registerAttribute(this.name, "name");
}

CommandMgr.prototype.pushCommandSequence = function(sequence)
{
    this.commandSeqStack.push(sequence);
}

CommandMgr.prototype.popCommandSequence = function()
{
    this.commandSeqStack.pop();
}

CommandMgr.prototype.clearCommandSequenceStack = function()
{
    this.commandSeqStack.clear();
}

CommandMgr.prototype.addCommand = function(command)
{
    setAttributeBin(null);
    setAttributePairs(null);
    
    if (this.commandSeqStack.length() > 0)
    {
        this.commandSeqStack.top().addCommand(command);
        this.registry.unregister(command); // unregister here so command will not be serialized separately
        return;
    }
    
    // execute the command or register it for events.  If the command
    // was NOT configured for events, then Execute it and get rid of it             
    var events = command.getEventTypes();
    var trigger = command.getAttribute("trigger");
    if (events.length > 0)
    {
        var eventMgr = this.registry.find("EventMgr");
        if (eventMgr)
        {
            for (var i=0; i < events.length; i++)
            {
                eventMgr.addListener(events[i], command);
            }
        }   
    }
    else if (trigger.getLength() > 0)
    {
		trigger.addModifiedCB(CommandMgr_CommandTriggerModifiedCB, this);
		this.createCommandTrigger(command, trigger);
    }
    else // no events -- execute and remove
    {
        command.execute();
        this.registry.unregister(command);
    }
}

CommandMgr.prototype.createCommandTrigger = function(command, trigger) 
 {

 	// TODO: Support Commands that Execute from Events AND Triggers

 	// trigger syntax based on Attributes:
 	// ObjectName/Attribute=value
 	// ObjectName/Attribute[item]=value
 	// ObjectName/Attribute=value,value,value,...,value
 	// Where "ObjectName" may be an XPath-like expression
 	var attrNdx = 0;
    var valueNdx = 0;
    var rangeNdx = 0;
    var itemNdx = 0;

    var triggerString = "";
    triggerString = trigger.getValueDirect().join("");
 	attrNdx = triggerString.lastIndexOf('/');

 	if (attrNdx != -1)
 	{
 		var objectName = triggerString.substring(0, attrNdx);
 		var resource = bridgeworks.registry.find(objectName);
 		if(resource)
 		{
 			var not = false;

            var attrName = "";
            var itemString = "";
            var valueString = "";
            var rangeString = "";
            
 			valueNdx = triggerString.lastIndexOf('!');
 			if (valueNdx > 0)
 			{
 			    triggerString.replace("!", ""); // erase the '!' for subsequent processing
 			    not = true;
 			}

 			valueNdx = triggerString.lastIndexOf('=');

 			if(valueNdx > 0) 
 			{
 				itemNdx = triggerString.lastIndexOf('[');
 				if(itemNdx > 0) 
 				{
 					var itemNdx2 = triggerString.lastIndexOf(']', itemNdx); 
 					itemString = triggerString.substring(itemNdx+1, itemNdx2 - itemNdx - 1); 
 				}

 				var range = FLT_MAX; 
 				var rangeNdx = triggerString.lastIndexOf(',');
 				if(rangeNdx > 0)
 				{
 					var rangeString = triggerString.substring(rangeNdx+1, trigger.length()-rangeNdx-1);
 					range = rangeString.parseFloat(); 
 				}
 				rangeNdx = rangeNdx == -1 ? triggerString.length : rangeNdx;
 				// value is the string between '=' && (',' || end of string)
 				valueString = triggerString.substring(valueNdx+1, valueNdx+(rangeNdx-valueNdx));

 			}
 			else //TEMPEST
 			{
 				itemNdx = triggerString.lastIndexOf('[');
 				if(itemNdx > 0) 
 				{
 					var itemNdx2 = triggerString.lastIndexOf(']', itemNdx);
 					itemString = triggerString.substring(itemNdx+1, itemNdx2-itemNdx-1);
 				}
 			}
 			valueNdx = itemNdx == -1 ? (valueNdx == -1 ? triggerString.length() : valueNdx) : itemNdx;
 			attrName = triggerString.substring(attrNdx+1, valueNdx);

 			var input = resource.getAttribute(attrName);

 			var attr = this.createAttribute(input, valueString);

 			if(attr)
 			{
 				var item = -1; 
 				if(itemString != "")
 				{
 					item = parseInt(itemString);
 				}

 				var numExecutions = command.numResponses;
 				var newTrigger = new AttributeTrigger(input, attr, command, item, not, numExecutions);

 				command.setTrigger(newTrigger);
 			}
 			triggerString = objectName + "/" + attrName;

 			console.debug(trigger);
 			console.debug("\n");
 		}		
 	}
 }

CommandMgr.prototype.createAttribute = function(attribute, value)
{
	var newAttribute = null;
	if(attribute)
	{
        //console.debug(attribute);
		var etype = attribute.attrType;
		var len = attribute.getLength();
        //console.debug(etype);
//			switch (etype)
//			{
//
//			case eAttrType.BooleanAttr:
//				{
//					newAttribute = new NumberAttr();
//		            newAttribute.setValueDirect(parseInt(value));
//				}
//				break;
//            case eAttrType.NumberAttr:
//
//				{
					newAttribute = new NumberAttr();
		            newAttribute.setValueDirect(parseFloat(value));
//				}
//				break;
//
//            case eAttrType.StringAttr:
//				{
//					newAttribute = new StringAttr();
//                    newAttribute.setValueDirect(value);
//				}
//				break;
//
//			default:
//				newAttribute = null;
//				break;
//			}
		  }
        //console.debug(newAttribute);
		return newAttribute; 
}

function CommandMgr_CommandTriggerModifiedCB(attribute, container)
{
	this.createCommandTrigger(attribute, container);
}

AttributeTrigger.prototype = new Command();
AttributeTrigger.prototype.constructor = AttributeTrigger;


function AttributeTrigger(input, trigger, target, item, _not, _executionCount)
{
    this.input = input;
    this.trigger = trigger;
    this.target = target;

    this.lastValues = [];

	this.input.getValue(this.lastValues);
    this.attrType = eAttrType.AttributeTrigger;
	
    this.item = item;
    
    this.not = _not;


    this.executionCount = _executionCount;

	this.input.addModifiedCB(AttributeTrigger_InputModifiedCB, this);

	var len = this.input.getLength();

	if (len == 1)
	{
		this.item = 0;
	}
}


AttributeTrigger.prototype.execute = function()
{
	if (this.target)
	{
        var type = this.trigger.attrType;

        switch (type)
        {

        case eAttrType.StringAttr:
            {
                var vIn = [];
                var vTrig = [];
            
                this.input.getValue(vIn);
                this.trigger.getValue(vTrig);

                var pass = vIn[0] == vTrig[0] ? true : false;
                pass = this.not ? !pass : pass;
                if (pass)
                {
                    var count = this.executionCount.getValueDirect() - 1;
                    this.executionCount.setValueDirect(count);
                }

                if (this.executionCount == 0)
		        {
			        this.target = null;
		        }
            }
            break;

        default:
            {
                var vIn = [];
                var vTrig = [];

		        this.input.getValue(vIn);
		        this.trigger.getValue(vTrig);

		        // match single-item Attribute OR single item of a multi-item Attribute
		        if (this.item != -1)
		        {
			        // if equal OR descending past OR ascending past
                    var pass = ((vIn[this.item] == vTrig[0]) ||
			                     (this.lastValues[this.item] > vIn[this.item] && vIn[this.item] < vTrig[0]) ||
			                     (this.lastValues[this.item] < vIn[this.item] && vIn[this.item] > vTrig[0]));
                    pass = this.not ? !pass : pass;
                    if (pass)
			        {
						this.target.execute();
                        var count = this.executionCount.getValueDirect() - 1;
				        this.executionCount.setValueDirect(count);
			        }
		        }
		        else	// match every item in a multi-item Attribute
		        {
			        var len = this.input.getLength();
			        var matches = 0;
			        for (var i = 0; i < len; ++i)
			        {
				        // if equal OR descending past OR ascending past
				        var pass = ((vIn[i] == vTrig[i]) ||
				                     (this.lastValues[i] > vIn[i] && vIn[i] < vTrig[i]) ||
				                     (this.lastValues[i] < vIn[i] && vIn[i] > vTrig[i]));
                        pass = this.not ? !pass : pass;
                        if (pass)
				        {
					        ++matches;
				        }
			        }

			        // if every item matches simultaneously
			        if (matches = len)
			        {
						err = this.target.execute();
						this.executionCount.setValueDirect(--this.executionCount);
			        }
		        }

		        if (this.executionCount.getValueDirect() == 0)
		        {
			        this.target = null;
                    this.input.removeModifiedCB(AttributeTrigger_InputModifiedCB,this);
		        }
		        else
		        {
			        this.lastValues = vIn;
		        }
            }
            break;
        }
	}

	return;
}

function AttributeTrigger_InputModifiedCB(attribute, container)
{
	container.execute();

	// TODO:  Expand to also support EventListener::EventPerformed
}
/*
void AttributeTrigger_InputModifiedTaskProc(void* data, const bool & run)
{
	TAttributeTrigger* pTrigger = static_cast<TAttributeTrigger*>(data);
	pTrigger.Execute();
}
*/
BwRegistry.prototype = new AttributeRegistry();
BwRegistry.prototype.constructor = BwRegistry;

function BwRegistry()
{
    AttributeRegistry.call(this);
    this.className = "BwRegistry";
    this.attrType = eAttrType.AttributeRegistry;
    
    this.rootPtr = new ReferenceAttr(null);
    this.subtreePtr = new ReferenceAttr(null);
    this.sgPointer = new StringAttr("");
    this.maxAnimationTimeInSecs = new NumberAttr(0);

    this.rootPtr.addModifiedCB(BwRegistry_RootPtrModifiedCB, this);
    this.sgPointer.addModifiedCB(BwRegistry_SgPointerModifiedCB, this);
    
    this.registerAttribute(this.rootPtr, "rootPtr");
    this.registerAttribute(this.subtreePtr, "subtreePtr");
    this.registerAttribute(this.sgPointer, "sgPointer");
    this.registerAttribute(this.maxAnimationTimeInSecs, "maxAnimationTimeInSecs");
    
    this.registerByName(this, "NodeMgr");      // backward-compatibility
    this.registerByName(this, "EvaluatorMgr"); // backward-compatibility
}

BwRegistry.prototype.find = function(name)
{
    if (!name) return null;
    
    // tokenize name path
    var tokens = [];
    var index = 0;
    while ((index = name.indexOf('/')) > -1)
    {
        tokens.push(name.substring(0, index));
        name = name.substring(index+1, name.length);
    }
    tokens.push(name);
    
    // call get() on first token
    var resource = this.getByName(tokens[0]);
    if (resource) resource = resource[0];
    
    // call getAttribute() on subsequent tokens
    for (var i=1; i < tokens.length && resource; i++)
    {
        resource = resource.getAttribute(tokens[i]);
    }
    
    return resource;
}

BwRegistry.prototype.findContext = function(name, context)
{
    // TODO
}

BwRegistry.prototype.registerResource = function(container)
{
    // setup parent relationship for nodes (not all containers passed to this method will be nodes)
    if (container.isNode() && container.getAttribute("orphan").getValueDirect() == false)
    {
        this.updateTree(container);
    }
}

BwRegistry.prototype.finalizeResource = function(container)
{
    if (container.isNode() && container.getParentCount() > 0)
    {
        this.subtreePtr.setValueDirect(container.getParent(0));
    }
}

BwRegistry.prototype.register = function(container)
{
    // call base-class implementation
    AttributeRegistry.prototype.register.call(this, container);
    
    // TODO
}

BwRegistry.prototype.unregister = function(container)
{
    // call base-class implementation
    AttributeRegistry.prototype.unregister.call(this, container);
    
    // TODO
}

BwRegistry.prototype.clear = function()
{
    this.rootPtr.setValueDirect(null);
    this.subtreePtr.setValueDirect(null);
    this.sgPointer.setValueDirect(null);
    
    // call base-class implementation
    AttributeRegistry.prototype.clear.call(this);    
}

BwRegistry.prototype.updateTree = function(node)
{
    var root = this.rootPtr.getValueDirect();
    var subtree = this.subtreePtr.getValueDirect();
  
    // by default, first node is the root
    if (root == null)
    {
        root = subtree = node;
    }
    else
    {
        if (subtree)
        {
            subtree.addChild(node);
        }
        else
        {
            root.addChild(node);
        }
        
        subtree = node;
    }
    
    this.rootPtr.setValueDirect(root);
    this.subtreePtr.setValueDirect(subtree);
}

BwRegistry.prototype.updateMaxAnimationTime = function()
{
    // TODO
}

BwRegistry.prototype.formatContext = function(attribute, name)
{
    // TODO
}

BwRegistry.prototype.sgPointerModified = function()
{
    var resource = this.find(this.sgPointer.getValueDirect().join(""));
    if (resource)
    {
        this.subtreePtr.setValueDirect(resource);
    }
}

function BwRegistry_RootPtrModifiedCB(attribute, container)
{
    var resource = attribute.getValueDirect();
}

function BwRegistry_SgPointerModifiedCB(attribute, container)
{
    container.sgPointerModified();
}
BwSceneInspector.prototype = new SceneInspector();
BwSceneInspector.prototype.constructor = BwSceneInspector;

function BwSceneInspector()
{
    SceneInspector.call(this);
    this.className = "BwSceneInspector";
    this.attrType = eAttrType.SceneInspector;
    
    this.viewport = new Viewport();
    this.worldUnitsPerPixel = new Vector2D();
    this.clickPosWorld = new Vector3D();
    this.last_d3 = 0;
    
    this.translationSensitivity = new Vector3DAttr(1, 1, 1);
    this.panSensitivity = new Vector3DAttr(1, 1, 1);
    this.trackSensitivity = new Vector3DAttr(1, 1, 1);
    this.rotationSensitivity = new Vector3DAttr(1, 1, 1);
    this.zoomSensitivity = new NumberAttr(1);
    this.invertedTranslationDelta = new Vector3DAttr(0, 0, 0);
    this.invertedPanDelta = new Vector3DAttr(0, 0, 0);
    this.invertedTrackDelta = new Vector3DAttr(0, 0, 0);
    this.invertedRotationDelta = new Vector3DAttr(0, 0, 0);
    this.zoomDelta = new NumberAttr(0);
    this.invertedZoomDelta = new NumberAttr(0);
    this.selectionOccurred = new BooleanAttr(false);
    this.viewRelativeTranslationDelta = new Vector3DAttr(0, 0, 0);
    
    this.translationDelta.addModifiedCB(BwSceneInspector_TranslationDeltaModifiedCB, this);
    this.panDelta.addModifiedCB(BwSceneInspector_PanDeltaModifiedCB, this);
    this.trackDelta.addModifiedCB(BwSceneInspector_TrackDeltaModifiedCB, this);
    this.rotationDelta.addModifiedCB(BwSceneInspector_RotationDeltaModifiedCB, this);
    this.invertedTranslationDelta.addModifiedCB(BwSceneInspector_InvertedTranslationDeltaModifiedCB, this);
    this.invertedPanDelta.addModifiedCB(BwSceneInspector_InvertedPanDeltaModifiedCB, this);
    this.invertedTrackDelta.addModifiedCB(BwSceneInspector_InvertedTrackDeltaModifiedCB, this);
    this.invertedRotationDelta.addModifiedCB(BwSceneInspector_InvertedRotationDeltaModifiedCB, this);
    this.zoomDelta.addModifiedCB(BwSceneInspector_ZoomDeltaModifiedCB, this);
    this.invertedZoomDelta.addModifiedCB(BwSceneInspector_InvertedZoomDeltaModifiedCB, this);
    this.selectionOccurred.addModifiedCB(BwSceneInspector_SelectionOccurredCB, this);
    this.viewRelativeTranslationDelta.addModifiedCB(BwSceneInspector_TrackDeltaModifiedCB, this);
    
    this.registerAttribute(this.translationSensitivity, "translationSensitivity");
    this.registerAttribute(this.panSensitivity, "panSensitivity");
    this.registerAttribute(this.trackSensitivity, "trackSensitivity");
    this.registerAttribute(this.rotationSensitivity, "rotationSensitivity");
    this.registerAttribute(this.zoomSensitivity, "zoomSensitivity");
    this.registerAttribute(this.invertedTranslationDelta, "invertedTranslationDelta");
    this.registerAttribute(this.invertedPanDelta, "invertedPanDelta");
    this.registerAttribute(this.invertedTrackDelta, "invertedTrackDelta");
    this.registerAttribute(this.invertedRotationDelta, "invertedRotationDelta");
    this.registerAttribute(this.zoomDelta, "zoomDelta");
    this.registerAttribute(this.invertedZoomDelta, "invertedZoomDelta");
    this.registerAttribute(this.selectionOccurred, "selectionOccurred");
    this.registerAttribute(this.viewRelativeTranslationDelta, "viewRelativeTranslationDelta");
    
    // set orphan so that evaluator will not be added to scene graph
	this.orphan.setValueDirect(true);
	
	this.enabled.addModifiedCB(BwSceneInspector_EnabledModifiedCB, this);
}

BwSceneInspector.prototype.evaluate = function()
{
    // call base-class implementation
    SceneInspector.prototype.evaluate.call(this);
}

BwSceneInspector.prototype.translate = function(delta)
{
    if (delta.x == 0 && delta.y == 0 && delta.z == 0)
    {
        // no effect
        return;
    }
    
    // get sensitivity
    var sensitivity = this.translationSensitivity.getValueDirect();

    // calculate deltas (scale by sensitivity)
    delta.x *= sensitivity.x;
    delta.y *= sensitivity.y;
    delta.z *= sensitivity.z;

    // set deltas
    var values = [delta.x, delta.y, delta.z];
    var params = new AttributeSetParams(-1, -1, 0, true, false);
	this.translationDelta.setValue(values, params);
	
    // evaluate scene inspector
	this.evaluate();

    // clear deltas
    var zeroes = [0, 0, 0];
    this.translationDelta.setValue(zeroes, params);
    this.invertedTranslationDelta.setValue(zeroes, params);
}

BwSceneInspector.prototype.pan = function(delta)
{
    if (delta.x == 0 && delta.y == 0 && delta.z == 0)
    {
        // no effect
        return;
    }
    
    // if worldUnitsPerPixel hasn't been set, use pivot distance as default
    if (this.worldUnitsPerPixel.x == 0 && this.worldUnitsPerPixel.y == 0)
    {
        var wupp = this.getWorldUnitsPerPixel(this.pivotDistance.getValueDirect());
        this.worldUnitsPerPixel.x = wupp.x;
        this.worldUnitsPerPixel.y = wupp.y;
    }
    
    // get sensitivity
    var sensitivity = this.panSensitivity.getValueDirect();

    // calculate deltas (scale by sensitivity & worldUnitsPerPixel)
    delta.x *= sensitivity.x * this.worldUnitsPerPixel.x;
    delta.y *= sensitivity.y * this.worldUnitsPerPixel.y;
    delta.z *= sensitivity.z * this.worldUnitsPerPixel.y; // use y for z
    
    // set deltas
    var values = [delta.x, delta.y, delta.z];
    var params = new AttributeSetParams(-1, -1, 0, true, false);
	this.panDelta.setValue(values, params);
	
	// update pivot distance if panning in z-direction
	if (delta.z != 0)
	{
	    var pivotDistance = this.pivotDistance.getValueDirect();
	    pivotDistance -= delta.z;
	    this.pivotDistance.setValueDirect(pivotDistance);
	}
	
    // evaluate scene inspector
	this.evaluate();

    // clear deltas
    var zeroes = [0, 0, 0];
    this.panDelta.setValue(zeroes, params);
    this.invertedPanDelta.setValue(zeroes, params);
}

BwSceneInspector.prototype.track = function(delta)
{   
    if (delta.x == 0 && delta.y == 0 && delta.z == 0)
    {
        // no effect
        return;
    }

    // not supported for orthographic cameras
    if (this.camera == null || this.camera.attrType == eAttrType.OrthographicCamera)
    {
        return;
    }

	// check for valid viewport
	if (this.viewport.width <= 0 || this.viewport.height <= 0)
	{
		return;
	}

    // if worldUnitsPerPixel hasn't been set, use pivot distance as default
    if (this.worldUnitsPerPixel.x == 0 && this.worldUnitsPerPixel.y == 0)
    {
        var wupp = this.getWorldUnitsPerPixel(this.pivotDistance.getValueDirect());
        this.worldUnitsPerPixel.x = wupp.x;
        this.worldUnitsPerPixel.y = wupp.y;
    }

    // get sensitivity
    var sensitivity = this.trackSensitivity.getValueDirect();

    // calculate x and y deltas (scale by sensitivity & worldUnitsPerPixel)
    // calculate deltas (scale by sensitivity & worldUnitsPerPixel)
    delta.x *= sensitivity.x * this.worldUnitsPerPixel.x;
    delta.y *= sensitivity.y * this.worldUnitsPerPixel.y;
    
    // calculate z delta (scale by sensitivity)
    if (delta.z != 0)
    {
        // Let cameraPos be the sector position of the camera
		var cameraPos = this.camera.getAttribute("position").getValueDirect();

        // Let cameraRot be the world-space rotation of the camera
        var cameraRot = this.camera.getAttribute("rotation").getValueDirect();
    
        // Let cameraHeight be the delta between the clickPosWorld.y and cameraPos.y
        var cameraHeight = cameraPos.y - this.clickPosWorld.y;
        
        // STEP 2: define d1 as the distance between cameraPos and clickPosWorld
        var d1 = distanceBetween(cameraPos, this.clickPosWorld);

        // STEP 3: using the pythagorean theorem, a^2 + b^2 = c^2, where a = cameraHeight, 
        //         b = unknown, and c = d1, find the length b1 of side b
        var b1 = Math.sqrt((d1 * d1) - (cameraHeight * cameraHeight));

        // calculate distance between camera and new point
        var zoom = this.camera.getAttribute("zoom").getValueDirect();
        var fovy = 2 * Math.atan2(1, zoom);
        var radsPerPixel = fovy / this.viewport.height;
        var angleB_Radians = Math.acos(cameraHeight / d1);
        var angleA_Radians = angleB_Radians + (delta.z * radsPerPixel);
        var b2 = Math.tan(angleA_Radians) * cameraHeight;

        // STEP 7: define d3 as b2 - b1
        var d3 = b2 - b1;

        // as angle B approaches 90, use last calculated d3 (algorithm produces exponential results otherwise) 
        if (angleB_Radians >= toRadians(88) && angleB_Radians <= toRadians(92))
        {
            if (d3 < 0)
            {
                d3 = -(Math.abs(this.last_d3));
            }
            else
            {
                d3 = Math.abs(this.last_d3);
            }
        }

        var viewRotation = cameraRot;
        var fabs_bank = Math.abs(cameraRot.z);
        var flipIt = false;
        if (fabs_bank >= 90 && fabs_bank <= 270)
        {
            if (cameraRot.x > -45 && cameraRot.x < 45)
            {
                flipIt = true;
            }
        }
        if (flipIt)
        {
            d3 = -d3;
        }

        this.last_d3 = d3;

        // STEP 8: translate camera by d3 units
		delta.z = d3 * sensitivity.z * (cameraHeight < 0 ? -1 : 1);

        //var mat = new Matrix4x4();
        //mat.loadYAxisRotation(cameraRot.y);
        //var v = mat.transform(0, 0, 1, 0);
        //v.normalize();
        
        var directions = this.camera.getDirectionVectors();
        v = new Vector3D(directions.forward.x, directions.forward.y, directions.forward.z);
        v.y = 0;
        v.normalize();

        // method 1 for retrieval of angle C
        var camToClick = subtract3D(this.clickPosWorld, cameraPos);
        camToClick.y = 0;
        camToClick.normalize();
        var cosAngleBetweenCameraDirectionAndCamToClick = cosineAngleBetween(camToClick, v);
        var headingRads = Math.acos(cosAngleBetweenCameraDirectionAndCamToClick);
    
        // method 2 for retrieval of angle C
        var fovx = 2 * Math.atan(this.viewport.width / this.viewport.height * Math.tan(fovy / 2));
        var radsPerPixelX = fovx / this.viewport.width;
        var clickPoint;
        var selector = this.registry.find("Selector");
        if (selector)
        {
            clickPoint = selector.getAttribute("clickPoint").getValueDirect();
        }
        var angleC_Radians = Math.abs(this.viewport.width / 2 - clickPoint.x) * radsPerPixelX;
        headingRads = angleC_Radians;
    
        var xTrans = Math.tan(headingRads) * d3;

        var plane = new Plane(cameraPos, directions.right);
        if (pointOnNegativeSideOfPlane(this.clickPosWorld, plane))
        {
            xTrans *= -1;
        }
        if (flipIt)
        {
            xTrans *= -1;
        }

        delta.x += -xTrans;
    }
    
    // set deltas
    var values = [delta.x, delta.y, delta.z];
    var params = new AttributeSetParams(-1, -1, 0, true, false);
	this.trackDelta.setValue(values, params);
	
	// evaluate scene inspector
	this.evaluate();

    // clear deltas
    var zeroes = [0, 0, 0];
    this.trackDelta.setValue(zeroes, params);
    this.invertedTrackDelta.setValue(zeroes, params);
}

BwSceneInspector.prototype.rotate = function(delta)
{
    if (delta.x == 0 && delta.y == 0 && delta.z == 0)
    {
        // no effect
        return;
    }

    // get sensitivity
    var sensitivity = this.rotationSensitivity.getValueDirect();

    // calculate deltas (scale by sensitivity)
    delta.x *= sensitivity.x;
    delta.y *= sensitivity.y;
    delta.z *= sensitivity.z;

    // set deltas
    var values = [delta.x, delta.y, delta.z];
    var params = new AttributeSetParams(-1, -1, 0, true, false);
	this.rotationDelta.setValue(values, params);
	
    // evaluate scene inspector
	this.evaluate();

    // clear deltas
    var zeroes = [0, 0, 0];
    this.rotationDelta.setValue(zeroes, params);
    this.invertedRotationDelta.setValue(zeroes, params);
}

BwSceneInspector.prototype.zoom = function(delta)
{
    if (delta == 0)
    {
        // no effect
        return;
    }
    
    if (!this.camera)
    {
        return;
    }
    
    switch (this.camera.className)
    {
    case "PerspectiveCamera":
        {
            var zoom = this.camera.getAttribute("zoom").getValueDirect();
            zoom += delta * this.zoomSensitivity.getValueDirect();
            if (zoom < 0) zoom = 0.05; // don't go < 0
            this.camera.getAttribute("zoom").setValueDirect(zoom);
        }
        break;
        
    case "OrthographicCamera":
        {
            var width = this.camera.getAttribute("width").getValueDirect();
            width += delta * this.zoomSensitivity.getValueDirect();
            if (width < 0) width = 0; // don't go < 0
            this.camera.getAttribute("width").setValueDirect(width);
        }
        break;
    }
}

BwSceneInspector.prototype.getWorldUnitsPerPixel = function(viewSpace_Z)
{
    var x = 0;
    var y = 0;
    
    // get current viewport
    var selector = this.registry.find("Selector");
    if (selector)
    {
        var vp = selector.selections.viewports[selector.selections.viewports.length-1];
        
        if (this.camera)
        {
            switch (this.camera.attrType)
            {
            case eAttrType.PerspectiveCamera:
                {
                    // get zoom
				    var zoom = this.camera.getAttribute("zoom").getValueDirect();

				    // determine the per-pixel width and height at viewSpace_Z
				    var result = worldUnitsPerPixelPersp(vp, zoom, viewSpace_Z);
				    x = result.x;
				    y = result.y;    
                }
                break;
                
            case eAttrType.OrthographicCamera:
                {
                    // get width
				    var width = this.camera.getAttribute("width").getValueDirect();

				    // determine the per-pixel width and height
				    var result = worldUnitsPerPixelOrtho(vp, width);
				    x = result.x;
				    y = result.y;
                }
                break;
            }
        }
    }
    
    return { x: x, y: y };
}

function BwSceneInspector_TranslationDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.translate(attribute.getValueDirect());
    }
}
    
function BwSceneInspector_PanDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.pan(attribute.getValueDirect());
    }
}

function BwSceneInspector_TrackDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.track(attribute.getValueDirect());
    }
}

function BwSceneInspector_RotationDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.rotate(attribute.getValueDirect());
    }
}

function BwSceneInspector_InvertedTranslationDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        var deltas = attribute.getValueDirect();
        deltas.x *= -1;
        deltas.y *= -1;
        deltas.z *= -1;
        container.translate(deltas);
        
        if (deltas.x != 0 || deltas.y != 0 || deltas.z != 0) alert("rotate");
    }
}
 
function BwSceneInspector_InvertedPanDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        var deltas = attribute.getValueDirect();
        deltas.x *= -1;
        deltas.y *= -1;
        deltas.z *= -1;
        container.pan(deltas);
    }
}

function BwSceneInspector_InvertedTrackDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        var deltas = attribute.getValueDirect();
        deltas.x *= -1;
        deltas.y *= -1;
        deltas.z *= -1;
        container.track(deltas);
    }
}

function BwSceneInspector_InvertedRotationDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        var deltas = attribute.getValueDirect();
        deltas.x *= -1;
        deltas.y *= -1;
        deltas.z *= -1;
        container.rotate(deltas);
    }
}

function BwSceneInspector_ZoomDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.zoom(attribute.getValueDirect());
    }
}

function BwSceneInspector_InvertedZoomDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.zoom(attribute.getValueDirect() * -1);
    }
}

function BwSceneInspector_SelectionOccurredCB(attribute, container)
{
    var selector = container.registry.find("Selector");
    if (selector)
    {
        // get viewport
        if (selector.selections.viewports.length > 0)
        {
            container.viewport.loadViewport(selector.selections.viewports[0]);
        }
        
        // get click point in world-space
        container.clickPosWorld.copy(selector.getAttribute("pointWorld").getValueDirect());
        
        // get click point in view-space
        var clickPosView = selector.getAttribute("pointView").getValueDirect();
        
        // get world units per-pixel at click point z
        container.getWorldUnitsPerPixel(clickPosView.z);
    }
}

function BwSceneInspector_EnabledModifiedCB(attribute, container)
{
    var enabled = attribute.getValueDirect();
}


ObjectInspector.prototype = new ArcballInspector();
ObjectInspector.prototype.constructor = ObjectInspector;

function ObjectInspector()
{
    ArcballInspector.call(this);
    this.className = "ObjectInspector";
    this.attrType = eAttrType.ObjectInspector;
    
    this.camera = null;
    this.selectedObjects = [];
    this.pointView = new Vector3DAttr(1, 1, 1);
    this.translationDelta = new Vector3DAttr(0, 0, 0);
    this.rotationDelta = new Vector3DAttr(0, 0, 0);
    this.translationNow = new Vector3DAttr(0, 0, 0);
    this.rotationNow = new Vector3DAttr(0, 0, 0);
    this.selectionOccurred = new BooleanAttr(false);
    this.selectionCleared = new BooleanAttr(false);
    this.cd = null;
    
    this.translationDelta.addModifiedCB(ObjectInspector_TranslationDeltaModifiedCB, this);
    this.rotationDelta.addModifiedCB(ObjectInspector_RotationDeltaModifiedCB, this);
    this.translationNow.addModifiedCB(ObjectInspector_TranslationNowModifiedCB, this);
    this.rotationNow.addModifiedCB(ObjectInspector_RotationNowModifiedCB, this);
    this.selectionOccurred.addModifiedCB(ObjectInspector_SelectionOccurredCB, this);
    this.selectionCleared.addModifiedCB(ObjectInspector_SelectionClearedCB, this);
    
    this.registerAttribute(this.pointView, "pointView");
    this.registerAttribute(this.translationDelta, "translationDelta");
    this.registerAttribute(this.rotationDelta, "rotationDelta");    
    this.registerAttribute(this.translationNow, "translationNow");    
    this.registerAttribute(this.rotationNow, "rotationNow");    
    this.registerAttribute(this.selectionOccurred, "selectionOccurred");
    this.registerAttribute(this.selectionCleared, "selectionCleared");
    
    // set orphan so that evaluator will not be added to scene graph
    this.orphan.setValueDirect(true);   
    
    this.enabled.addModifiedCB(ObjectInspector_EnabledModifiedCB, this)   
}

ObjectInspector.prototype.applyCameraRelativeRotation = function(selected)
{
    var i;
	
    // vectors
    var pivot  = null;
    var screen = null;
	
    // matrices
    var camXform  = null;
    var proj  = null;
    var world = null;
    
    // viewport
    var vp = this.viewport;

    // convenience
    var cam = this.camera;

    // sphere center (use world position of selected node)
    pivot = selected.worldCenter.getValueDirect();

    camXform = cam.getTransform();
    camXform.invert(); // put in view-space
    
    projection = cam.projectionMatrix;

    screen = toScreenSpace(pivot, camXform, projection, vp);
	
    this.sphereCenter.setValueDirect(screen.x, screen.y, 0);

    // sphere radius
    this.sphereRadius.setValueDirect(0.75);

    // world transform
    world = selected.getTransform();
    
    this.worldTransform.setValueDirect(world);

    // view transform
    camXform = cam.getTransform();
	
    this.viewTransform.setValueDirect(camXform);
    
    //var sPos = this.viewTransform.getValueDirect();
    //console.debug("ObjectInspector.viewTransform: " + sPos._11 + ", " + 
    //    sPos._12 + ", " + sPos._13);
}

ObjectInspector.prototype.applyCameraRelativeTranslation = function(selected)
{
    var cam = this.camera;

    // get translation delta values
    var delta = this.translationDelta.getValueDirect();
	
    if (delta.x == 0 && delta.y == 0 && delta.z == 0) 
    {
        return;
    }
    
    // get view matrix
    var camXform = cam.getTransform();
    camXform.invert(); // put in view-space

    // get node, camera world positions
    var nodePos = selected.worldCenter.getValueDirect();
    var camPos  = cam.worldPosition.getValueDirect();

    // calculate forward vector as vector from camera world position to node world position
    var fwd = new Vector3D(nodePos.x - camPos.x, 
                           nodePos.y - camPos.y,
                           nodePos.z - camPos.z);
    fwd.normalize();

    // get viewport dimensions
    var vp = this.viewport;

    // get click point in camera space
    var v = this.pointView.getValueDirect();
    var clickPtCamSpace = new Vector3D(v.x, v.y, v.z);

    var transDelta = null;
    
    var xTransCamSpace = new Vector3D(1, 0, 0);
    var yTransCamSpace = new Vector3D(0, 1, 0);
    var zTransWorldSpace = new Vector3D(fwd.x, fwd.y, fwd.z);
    
    var destCamSpace = new Vector3D(v.x, v.y, v.z);
    
    var parent = selected.motionParent;
    var mParent = null;
    if (parent) 
    {
        mParent = parent.getTransform();
        mParent.invert();
    }
    
    var perPixelWidth = -1;
    var zoom_or_width = -1;
    
    switch (cam.attrType)
    {
        case eAttrType.PerspectiveCamera:
        {
            // get zoom
            zoom_or_width = cam.zoom.getValueDirect();

            // determine the per-pixel width and height at clickPtCamSpace.z
            perPixelWidth = worldUnitsPerPixelPersp(vp, zoom_or_width, clickPtCamSpace.z);
        }
        break;

        case eAttrType.OrthographicCamera:
        {
            // get width
            zoom_or_width = cam.width.getValueDirect();

            // determine the per-pixel width and height
            perPixelWidth = worldUnitsPerPixelOrtho(vp, zoom_or_width);

        }
        break;

        default:
            break;
    }
    
    // multiply the per-pixel width by delta.x and use this to scale the
    // camera-space vector (1, 0, 0)
    xTransCamSpace.multiplyScalar(perPixelWidth.x);
    xTransCamSpace.multiplyScalar(-delta.x);

    // multiply the per-pixel height by delta.y and use this to scale the
    // camera-space vector (0, 1, 0)
    yTransCamSpace.multiplyScalar(perPixelWidth.y);
    yTransCamSpace.multiplyScalar(delta.y);

    // multiply the per-pixel height by delta.z and use this to scale the
    // world-space forward vector
    zTransWorldSpace.multiplyScalar(perPixelWidth.y);
    zTransWorldSpace.multiplyScalar(delta.z);

    // calculate camera-space destination point as camera-space click point
    // plus xTransCamSpace and yTransCamSpace
    destCamSpace.addVector(xTransCamSpace);
    destCamSpace.addVector(yTransCamSpace);

    // convert clickPtCamSpace and destCamSpace to world space
    camXform.invert();
    // if parented, multipy view with parent's inverse
    if (mParent)
    {
        camXform = camXform.multiply(mParent);
        zTransWorldSpace = mParent.transform(zTransWorldSpace.x, zTransWorldSpace.y, zTransWorldSpace.z, 0);
    }
    clickPtCamSpace = camXform.transform(clickPtCamSpace.x, clickPtCamSpace.y, clickPtCamSpace.z, 1);
    destCamSpace = camXform.transform(destCamSpace.x, destCamSpace.y, destCamSpace.z, 1);
    
    // calculate the translation delta as destCamSpace - clickPtCamSpace + zTransWorldSpace
    transDelta = new Vector3D(destCamSpace.x, destCamSpace.y, destCamSpace.z);
    transDelta.subtractVector(clickPtCamSpace);
    transDelta.addVector(zTransWorldSpace);

    // check for potential collision with ground, and adjust transDelta if collision would occur otherwise
    if (!this.cd) this.cd = this.registry.find("CollideDirective");
    var colliding = this.cd.detectGroundCollision(selected, transDelta, camXform);
    if (colliding.colliding)
    {
        transDelta.normalize();
        transDelta.multiplyScalar(colliding.distance);
        //transDelta.y += colliding.yTrans;
    }
    
    // add transDelta to current node position
    var attrSetParams = new AttributeSetParams(-1, -1, eAttrSetOp.Add, true, true);
    var attrSetVals = [transDelta.x, transDelta.y, transDelta.z];
    
    selected.position.setValue(attrSetVals, attrSetParams);
    
    //if (colliding.colliding) this.cd.detectCollision(selected);
}

ObjectInspector.prototype.translationDeltaModified = function()
{
    var pme = null;
    for (var i=0; i < this.selectedObjects.length; i++)
    {
        pme = this.getInspectionObject(this.selectedObjects[i]);
        if (!pme)
        {
            continue;
        }

        var moveable = pme.getAttribute("moveable").getValueDirect();
        if (!moveable)
        {
            continue;
        }

        this.applyCameraRelativeTranslation(pme);
    }

    var zeroes = [0, 0, 0];
    var params = new AttributeSetParams(-1, -1, eAttrSetOp.Replace, true, false);

    this.translationDelta.setValue(zeroes, params);
}

ObjectInspector.prototype.rotationDeltaModified = function()
{
    var pme = null;
    for (var i=0; i < this.selectedObjects.length; i++)
    {
        pme = this.getInspectionObject(this.selectedObjects[i]);
        if (!pme)
        {
            continue;
        }

        var moveable = pme.moveable.getValueDirect();
        if (!moveable)
        {
            continue;
        }

        this.applyCameraRelativeRotation(pme);

        var mNow = this.mouseNow.getValueDirect();
        var rDelta = this.rotationDelta.getValueDirect();

        mNow.x -= rDelta.x;
        mNow.y -= rDelta.y;

        // mouse now (formulate so that mouse coords match windows standard
        // of (0, 0) at top-left, and (width, height) at bottom-right)
        this.mouseNow.setValueDirect(mNow.y, mNow.x);

        this.evaluate();
                   
        if (!this.cd) this.cd = this.registry.find("CollideDirective");
        this.cd.detectCollision(pme);
    }
}

ObjectInspector.prototype.rotationNowModified = function()
{
    if (this.selectedObjects == null ||
        this.selectedObjects == undefined)
        return;
    
    var pme = null;
    for (var i=0; i < this.selectedObjects.length; i++)
    {
        pme = this.getInspectionObject(this.selectedObjects[i]);
		
        var moveable = pme.moveable.getValueDirect();
        if (moveable)
        {

            this.applyCameraRelativeRotation(pme);
            
            var rNow = this.rotationNow.getValueDirect();
            
            // mouse now (formulate so that mouse coords match windows standard
            // of (0, 0) at top-left, and (width, height) at bottom-right)
            this.mouseNow.setValueDirect(rNow.y, rNow.x);
            
            //console.debug("mouseNow: " + rNow.x + ", " + 
            //    rNow.y);
    
            this.evaluate();
                           
            if (!this.cd) this.cd = this.registry.find("CollideDirective");
            this.cd.detectCollision(pme);
        }
    }
}

ObjectInspector.prototype.runSelectionOccurred = function()
{       
    var selector =  this.registry.find("Selector");
    var vpMgr = this.registry.find("ViewportMgr");

    //this.registryThreadLock.Unlock();
    if (!selector || !vpMgr)
    {
        return;
    }

    // get selector click point
    // must use getAttribute here b/c it's not a native attribute to Selector
    var clickPoint = selector.getAttribute("clickPoint").getValueDirect();

    // get viewport and camera into view object
    var view = vpMgr.getViewportAtScreenXY(clickPoint.x, clickPoint.y);
    this.viewport = view.viewport;
    this.camera = view.camera;
	
    // get selected movable objects
    // TODO: don't assume models?
    this.selectedObjects = selector.selections.models.slice();

    var pResultQuat = this.resultQuat;
    var pQuatAtMouseDown = this.quatAtMouseDown;
    var pMouseDown = this.mouseDown;
    var pMouseNow = this.mouseNow;
    
    var pSelected = null;
    var pIso = null;	// TODO: support more than just Isolators
    var pChildZero = null;
    var pRotGroup = null;
    var pQuat = null;
    var pTransOut = null;
    var pTransBack = null;
    var pRotQuatAttr = null;
    var pBox = null;
    var center = 0;
    var centerNeg = 0;
	
    for (var i=0; i < this.selectedObjects.length; i++)
    {
        pResultQuat.removeAllTargets();

        pMouseDown.setValueDirect(clickPoint.x, clickPoint.y);
        pMouseNow.setValueDirect(clickPoint.x, clickPoint.y);

        pSelected = this.getInspectionObject(this.selectedObjects[i]);
        pSelected.lastPosition = pSelected.position.getValueDirect();

        pRotGroup = getInspectionGroup(pSelected);
        //setInspectionGroupActivationState(pSelected, this.enabled.getValueDirect())
        if (pRotGroup && (pQuat = pRotGroup.getChild(2)))
        {
            // see notes in BwObjectInspector.cpp
            var values = [true];
            var params = new AttributeSetParams(-1, -1, eAttrSetOp.Replace, true, true);
            // it would seem easier to setValueDirect(true) here given params are
            // created with all default values but params are reused throughout this
            // function and setting the intended params values, per the notes in .cpp,
            // triggers a bug elsewhere. 
            pQuat.enabled.setValue(values, params);

            pRotQuatAttr = pQuat.rotationQuat;
            pSelected.lastQuaternion = pRotQuatAttr.getValueDirect();

            pResultQuat.addTarget(pRotQuatAttr, eAttrSetOp.Replace, null, false);

            var prq = pRotQuatAttr.getValueDirect();
            pQuatAtMouseDown.setValueDirect(prq);

            var box = pSelected.bbox;
            var min = box.min.getValueDirect();
            var max = box.max.getValueDirect();
            center = new Vector3D(min.x, min.y, min.z);
            center.addVector(max);
            center.multiplyScalar(0.5);

            var pivot = pSelected.pivot.getValueDirect();
            if (pSelected.pivotAboutGeometricCenter.getValueDirect())
            {
                pivot = center;
            }				
            var pivotNeg = new Vector3D(pivot.x, pivot.y, pivot.z);
            pivotNeg.multiplyScalar(-1);

            // translate to pivot before applying quaternion rotation
            // don't alert modified sinks here because this will cause antialiasing to reset
            values = [pivot.x, pivot.y, pivot.z];
            pRotGroup.getChild(0).translation.setValue(values, params);

            // don't alert modified sinks here because this will cause antialiasing to reset
            var scale = pSelected.worldScale.getValueDirect();
            var scaleInv = new Vector3D(1 / scale.x,
                1 / scale.y,
                1 / scale.z);
            values[0] = scaleInv.x;
            values[1] = scaleInv.y;
            values[2] = scaleInv.z;
            pRotGroup.getChild(1).scale.setValue(values, params);

            values[0] = scale.x;
            values[1] = scale.y;
            values[2] = scale.z;
            pRotGroup.getChild(3).scale.setValue(values, params);

            // translate back from pivot after applying quaternion rotation
            // don't alert modified sinks here because this will cause antialiasing to reset
            values[0] = pivotNeg.x;
            values[1] = pivotNeg.y;
            values[2] = pivotNeg.z;
            pRotGroup.getChild(4).translation.setValue(values, params);
        }
    }   
}

ObjectInspector.prototype.runSelectionCleared = function()
{
    this.selectedObjects = [];
}

ObjectInspector.prototype.getInspectionObject = function(selected)
{
    while (selected.motionParent)
    {
        selected = selected.motionParent;
    }
    
    return selected;
}

ObjectInspector.prototype.clearSelection = function(selected)
{
    for (var i = 0; i < this.selectedObjects.length; i++)
    {
        if (this.selectedObjects[i] == selected)
        {
            this.selectedObjects.splice(i, 1);
        }
    }
}

function ObjectInspector_TranslationDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.translationDeltaModified();
    }
}

function ObjectInspector_RotationDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.rotationDeltaModified();
    }
}

function ObjectInspector_TranslationNowModifiedCB(attribute, container)
{
// deprecated
}

function ObjectInspector_RotationNowModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.rotationNowModified();
    }
}

function ObjectInspector_SelectionOccurredCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.runSelectionOccurred();
    }
}

function ObjectInspector_SelectionClearedCB(attribute, container)
{
    container.runSelectionCleared();
}

function ObjectInspector_EnabledModifiedCB(attribute, container)
{
    console.debug("ObjectInspector.enable modified: " + container.enabled.getValueDirect().toString())
}


ConnectionMgr.prototype = new AttributeContainer();
ConnectionMgr.prototype.constructor = ConnectionMgr;

function ConnectionMgr()
{
    AttributeContainer.call(this);
    this.className = "ConnectionMgr";
    
    this.name = new StringAttr("ConnectionMgr");
    
    this.registerAttribute(this.name, "name");
    
    // TODO: finish adding connection helpers
    //registerConnectionHelper("DisconnectAllSources", null, ConnectionMgr.prototype.disconnectAllSources);
    registerConnectionHelper("DisconnectAllTargets", null, ConnectionMgr.prototype.disconnectAllTargets);
    registerConnectionHelper("dissolve", ConnectionMgr.prototype.connectDissolve, ConnectionMgr.prototype.disconnectDissolve);
    registerConnectionHelper("walkSimulation", ConnectionMgr.prototype.connectWalkSimulation, ConnectionMgr.prototype.disconnectWalkSimulation);
}

ConnectionMgr.prototype.connectSceneInspection = function(inspector, camera)
{
    if (!inspector || !camera) return;
    
    var lastCamera = inspector.getCamera();
    if (lastCamera == camera)
    {
        // already connected
        return;
    }
    else if (lastCamera)
    {
        this.disconnectSceneInspection(inspector, lastCamera);
    }

    camera.getAttribute("sectorPosition").addTarget(inspector.getAttribute("viewPosition"), eAttrSetOp.Replace, null, true);
    camera.getAttribute("rotation").addTarget(inspector.getAttribute("viewRotation"), eAttrSetOp.Replace, null, true);

    inspector.getAttribute("resultPosition").addTarget(camera.getAttribute("sectorPosition"), eAttrSetOp.Replace, null, false);
    inspector.getAttribute("resultRotation").addTarget(camera.getAttribute("rotation"), eAttrSetOp.Replace, null, false);
    
    inspector.setCamera(camera);
}

ConnectionMgr.prototype.disconnectAllTargets = function(source, target)
{
    if (source)
    {
        var count = source.getAttributeCount();
        for (var i=0; i < count; i++)
        {
            var attribute = source.getAttributeAt(i);
            if (attribute)
            {
                attribute.removeAllTargets();
            }
        }
    }
}

ConnectionMgr.prototype.disconnectSceneInspection = function(inspector, camera)
{
    if (!inspector || !camera) return;
    
    camera.getAttribute("sectorPosition").removeTarget(inspector.getAttribute("viewPosition"));
    camera.getAttribute("rotation").removeTarget(inspector.getAttribute("viewRotation"));
    
    inspector.getAttribute("resultPosition").removeTarget(camera.getAttribute("sectorPosition"));
    inspector.getAttribute("resultRotation").removeTarget(camera.getAttribute("rotation"));
    
    inspector.setCamera(null);
}

ConnectionMgr.prototype.connectMapProjectionCalculator = function(mpc, pme)
{
    if (!mpc || !pme) return;

    mpc.getAttribute("resultPosition").addTarget(pme.getAttribute("position"));

    mpc.evaluate();
}

ConnectionMgr.prototype.disconnectMapProjectionCalculator = function(mpc, pme)
{
    if (!mpc || !pme) return;

    mpc.getAttribute("resultPosition").removeTarget(pme.getAttribute("position"));
}

ConnectionMgr.prototype.connectDissolve = function(evaluator, target)
{
    if (!evaluator || !target) return;
    
    var dissolve = target.getAttribute("dissolve");
    if (dissolve)
    {
        var resultValues = evaluator.getAttribute("resultValues");
        if (resultValues)
        {
            var resultValue = resultValues.getAt(0);
            if (resultValue)
            {
                resultValue.addTarget(dissolve);
            }
        }
    }
}

ConnectionMgr.prototype.disconnectDissolve = function(evaluator, target)
{
    if (!evaluator || !target) return;
    
    var dissolve = target.getAttribute("dissolve");
    if (dissolve)
    {
        var resultValues = evaluator.getAttribute("resultValues");
        if (resultValues)
        {
            var resultValue = resultValues.getAt(0);
            if (resultValue)
            {
                resultValue.removeTarget(dissolve);
            }
        }
    }
}

ConnectionMgr.prototype.connectWalkSimulation = function(simulator, target)
{
    ConnectionMgr.prototype.connectSceneInspection.call(null, simulator, target);
}

ConnectionMgr.prototype.disconnectWalkSimulation = function(simulator, target)
{
    ConnectionMgr.prototype.disconnectSceneInspection.call(null, simulator, target);
}

ConnectionMgr.prototype.connectModelsToMorph = function(source, target, morphIncr)
{
    if (!source || !target) return;
    
    var factory = this.registry.find("AttributeFactory");
    
    // get target vertices
    var targetVertices = target.getAttribute("vertices").getValueDirect();
    
    // for each geometry set in the source...
    for (var i = 0; i < source.geometry.length; i++)
    {
        // get indices
        var indices = source.geometryIndices[i];    
        if (!indices) continue;
        
        // create morph effector    
        var morpher = factory.create("MorphEffector");   
        morpher.getAttribute("renderAndRelease").setValueDirect(true);
        morpher.getAttribute("morphIncr").setValueDirect(morphIncr);
        
        // get source vertices from geometry and set to sourceVertices on morpher
        var sourceVertices = source.geometry[i].getAttribute("vertices").getValueDirect();
        morpher.getAttribute("sourceVertices").setValueDirect(sourceVertices);
        
        // set target vertices
        var morpher_targetVertices = [];
        for (var j = 0; j < indices.length; j++)
        {
            var index = indices[j];
            
            if (index * 3 + 2 < targetVertices.length)
            {
                morpher_targetVertices.push(targetVertices[index * 3    ]);
                morpher_targetVertices.push(targetVertices[index * 3 + 1]);
                morpher_targetVertices.push(targetVertices[index * 3 + 2]);
            }
            else // target deosn't contain enough points, use source
            {
                morpher_targetVertices.push(sourceVertices[j * 3    ]);
                morpher_targetVertices.push(sourceVertices[j * 3 + 1]);
                morpher_targetVertices.push(sourceVertices[j * 3 + 2]);
            }
        }
        morpher.getAttribute("targetVertices").setValueDirect(morpher_targetVertices);
        
        // connect result vertices to source vertices
        morpher.getAttribute("resultVertices").addTarget(source.geometry[i].getAttribute("vertices"));
    }
}


RenderAgent.prototype = new Agent();
RenderAgent.prototype.constructor = RenderAgent;

var ePlayState = {
    Unknown:    -1,
    
    Play:       0,
    Pause:      1,
    Stop:       2,
}

function RenderAgent(bridgeworks)
{
    Agent.call(this);
    this.className = "RenderAgent";
    
    this.bridgeworks = bridgeworks;
    
    this.name.setValueDirect("RenderAgent");
    this.timer = new Timer();
    
    this.frameRate = new NumberAttr(0);
    this.desiredFrameRate = new NumberAttr(30);
    this.timeIncrement = new NumberAttr(0);
    this.globalTimeInSecs = new NumberAttr(0);
    this.elapsedTimeInSecs = new NumberAttr(0);

    this.desiredFrameRate.addModifiedCB(RenderAgent_DesiredFrameRateModified, this);
    this.globalTimeInSecs.addModifiedCB(RenderAgent_GlobalTimeInSecsModified, this);
    
    this.registerAttribute(this.frameRate, "frameRate");
    this.registerAttribute(this.desiredFrameRate, "desiredFrameRate");
    this.registerAttribute(this.timeIncrement, "timeIncrement");
    this.registerAttribute(this.globalTimeInSecs, "globalTimeInSecs");
    this.registerAttribute(this.elapsedTimeInSecs, "elapsedTimeInSecs");
}

RenderAgent.prototype.render = function()
{
    this.timer.stop();
    var increment = this.timer.getTime();
    this.timer.start();
    this.timeIncrement.setValueDirect(increment);
    
    var elapsedTime = this.elapsedTimeInSecs.getValueDirect() + increment;
    this.elapsedTimeInSecs.setValueDirect(elapsedTime);
    // update frame rate
    this.frameRate.setValueDirect(1.0 / increment);
    //alert(this.desiredFrameRate.getValueDirect());
    this.animateEvaluators(increment);
    this.executeRenderDirectives();
}

RenderAgent.prototype.animateEvaluators = function(timeIncrement)
{
    var evaluators = this.registry.getByType(eAttrType.Evaluator);
    for (var i=0; i < evaluators.length; i++)
    {
        this.animateEvaluator(evaluators[i], timeIncrement);
    }
}

RenderAgent.prototype.animateEvaluator = function(evaluator, timeIncrement)
{
    var enabled = evaluator.getAttribute("enabled").getValueDirect();
    var expired = evaluator.getAttribute("expired").getValueDirect();

    var orphan = evaluator.getAttribute("orphan").getValueDirect();

    if (enabled && !expired)
    {
        switch (evaluator.className)
        {
            case "KeyframeInterpolator":
            {
                var params = new AttributeSetParams(-1, -1, eAttrSetOp.Add, true, true);
                evaluator.getAttribute("time").setValue(timeIncrement, params);
            }
            break;
            
            case "ObjectMover":
            case "AnimalMover":
            case "PhysicsSimulator":
            case "GoblinPhysicsSimulator":
            case "CannonPhysicsSimulator":
            case "Spinner":
            {
            	evaluator.getAttribute("timeIncrement").setValueDirect(timeIncrement);
            }
        }

        // don't evaluate scene/object inspection here, or any other evaluator not in the scene graph
        if (!orphan) evaluator.evaluate();
    }

    // if evaluator has expired, and it's set to "renderAndRelease", release it
    if (expired && evaluator.getAttribute("renderAndRelease").getValueDirect())
    {
        this.registry.unregister(evaluator);
    }
}

RenderAgent.prototype.executeRenderDirectives = function()
{
    var directives = this.registry.getByType(eAttrType.RenderDirective);
    if (directives)
    {
        this.bridgeworks.viewportMgr.layoutDirectives(directives);
        for (var i=0; i < directives.length; i++)
        {
        	directives[i].getAttribute("timeIncrement").setValueDirect(this.timeIncrement.getValueDirect());
            directives[i].execute();    
        }
    }   
}

// never executes
RenderAgent.prototype.globalTimeInSecsModified = function()
{
    var globalTime = this.globalTimeInSecs.getValueDirect();

    // synchronize elapsed time
    this.elapsedTimeInSecs.setValueDirect(globalTime);

    // get all evaluators and set their time to globalTimeInSecs
    if (this.registry)
    {
        var evaluators = this.registry.getByType(eAttrType.Evaluator);
        if (evaluators)
        {
            for (var i=0; i < evaluators.length; i++)
            {
                var evaluator = evaluators[i];
                if (evaluator)
                {
                    var time = evaluator.getAttribute("time");
                    if (time)
                    {
                        var globalTimeSyncEnabled = evaluator.getAttribute("globalTimeSyncEnabled");
                        if ((globalTimeSyncEnabled && globalTimeSyncEnabled.getValueDirect()) ||
                            !globalTimeSyncEnabled)
                        {
                            time.setValueDirect(globalTime);
                        }
                    }
                    
                    evaluator.evaluate(); // calling Evaluate() will reset "expired" flag based upon global time
                }
            }
        }

        // disable the rotation inspection group for the models in the scene;
        // this is required b/c user may have rotated models during
        // object inspection and Object Inspection uses transformation
        // nodes that will still be affecting the target
        var models = this.registry.getByType(eAttrType.Model);
        if (models)
        {
            for (var i=0; i < models.length; i++)
            {
                setInspectionGroupActivationState(models[i], false);
            }
        }
    }
}

RenderAgent.prototype.setEvaluatorPlayState = function(evaluator, state)
{
    if (!evaluator)
    {
        return this.setEvaluatorPlayState(state);
    }
    
    // perform state-specific processing
    var en = evaluator.getAttribute("enabled");
    switch (state)
    {
    case ePlayState.Play:
        {
            en.setValueDirect(true);
        }
        break;

    case ePlayState.Pause:
        {
            en.setValueDirect(false);
        }
        break;

    case ePlayState.Stop:
        {
            en.setValueDirect(false);

            // if kfi, set time to 0 and evaluate once to reset outputs to time 0
            switch (evaluator.className)
            {
            case "KeyframeInterpolator":
                {
                    evaluator.getAttribute("time").setValueDirect(0);
                    evaluator.evaluate();
                }
            }
        }
        break;
    }
    
    clearObjectPositionMap();
}

RenderAgent.prototype.setEvaluatorsPlayState = function(state)
{
    if (this.registry)
    {
        var evaluators = this.registry.getByType(eAttrType.Evaluator);
        if (evaluators)
        {
            for (i=0; i < evaluators.length; i++)
            {
                var evaluator = evaluators[i];
                
                var type = evaluator.attrType;

                // don't set play state for inspectors or any evaluators not in scenegraph
                var orphan = evaluator.getAttribute("orphan").getValueDirect();
                if (!orphan)
                {
                    this.setEvaluatorPlayState(evaluator, state)
                }

            }
        }
    }
}

RenderAgent.prototype.setDesiredFrameRate = function(rate)
{
    this.desiredFrameRate.setValueDirect(rate);
}

function RenderAgent_DesiredFrameRateModified(attribute, container)
{
}

function RenderAgent_GlobalTimeInSecsModified(attribute, container)
{
    var renderAgent = container.registry.find("RenderAgent");
    renderAgent.globalTimeInSecsModified();
}
var FRAME_RATE_DEFAULT = 30;
var FRAME_RATE_MAX = FRAME_RATE_DEFAULT * 32;
var FRAME_RATE_MIN = FRAME_RATE_DEFAULT * -32;

RenderController.prototype = new AttributeContainer();
RenderController.prototype.constructor = RenderController;

function RenderController(bridgeworks)
{
    AttributeContainer.call(this);
    this.className = "RenderController";
    
    this.playState = ePlayState.Pause;
    
    this.renderAgent = bridgeworks.renderAgent;
}

RenderController.prototype.fastForward = function()
{
    this.play();
    var rate = this.renderAgent.frameRate.getValueDirect();
    if (rate < 0)
    {
        this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_DEFAULT);
    }
    
    if (rate < FRAME_RATE_MAX)
	{
		this.renderAgent.desiredFrameRate.setValueDirect(Math.abs(this.renderAgent.frameRate) * 2);
	}
	else
	{
		// clamp to max fast forward speed
		this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_MAX);
	}
}

RenderController.prototype.pause = function()
{
    this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_DEFAULT);
    this.renderAgent.setEvaluatorsPlayState(ePlayState.Pause);
}

RenderController.prototype.play = function()
{
    this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_DEFAULT);
    this.renderAgent.setEvaluatorsPlayState(ePlayState.Play);    
}

RenderController.prototype.rewind = function()
{
    this.play();
    var rate = this.renderAgent.frameRate.getValueDirect();
    if (rate > 0)
    {
        this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_DEFAULT);
    }
    if (rate > FRAME_RATE_MIN)
    {
        this.renderAgent.desiredFrameRate.setValueDirect(Math.abs(this.renderAgent.frameRate) * -2);
    }
    else
    {
        this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_MIN);    
    }
}

RenderController.prototype.stop = function()
{
    this.renderAgent.setEvaluatorsPlayState(ePlayState.Stop);
    this.renderAgent.desiredFrameRate.setValueDirect(1);
}


/**
 *	Reverses the frame rate and updates a status label with the
 *	current playback speed.  Rewind is a negative frame rate
 *  that doubles with each push of the button until 
 *  BridgeworksObject.FRAME_RATE_MIN is reached
 *	
 *	@param void
 *	@return void
	
function DVD_Rewind()
{
    bridgeworks.updateScene("<Play/>");
    

    if (bridgeworks.renderAgent.frameRate > 0)
    {
        bridgeworks.renderAgent.setDesiredFrameRate(FRAME_RATE_DEFAULT);
    }
    
    if (bridgeworks.renderAgent.frameRate > FRAME_RATE_MIN)	// if fast forwarding or playing
	{
		bridgeworks.renderAgent.setDesiredFrameRate(Math.abs(bridgeworks.renderAgent.frameRate) * -2);
	}
	else	// max rewind value reached
	{
		// clamp to max rewind speed
		bridgeworks.renderAgent.setDesiredFrameRate(FRAME_RATE_MIN);
	}
    
    g_paused = false;

}
 */

/**
 *	Fast forwards the frame rate and updates a status label with the
 *	current playback speed.  Fast forward is a positive frame rate
 *  that doubles with each push of the button until
 *  BridgeworksObject.FRAME_RATE_MAX is reached
 *	
 *	@param void
 *	@return void

function DVD_FastForward()
{
    bridgeworks.updateScene("<Play/>");
    
    if (bridgeworks.renderAgent.frameRate < 0)
    {
        bridgeworks.renderAgent.setDesiredFrameRate(FRAME_RATE_DEFAULT);
    }
    
    if (bridgeworks.renderAgent.frameRate < FRAME_RATE_MAX)
	{
		bridgeworks.renderAgent.setDesiredFrameRate(Math.abs(bridgeworks.renderAgent.frameRate) * 2);
	}
	else
	{
		// clamp to max fast forward speed
		bridgeworks.renderAgent.setDesiredFrameRate(FRAME_RATE_MAX);
	}
    
    g_paused = false;

}
 */	

function Selections()
{
    this.viewports = [];
    this.cameras = [];
    this.lights = [];
    this.models = [];
    this.surfaces = [];
    this.labels = [];
    
    this.clear = function()
    {
        this.viewports = [];
        this.cameras = [];
        this.lights = [];
        this.models = [];
        this.surfaces = [];
        this.labels = [];
    }
}

SelectionListener.prototype = new EventListener();
SelectionListener.prototype.constructor = SelectionListener;

function SelectionListener()
{
    EventListener.call(this);
    this.className = "SelectionListener";

    this.name.setValueDirect("Selector");

    this.rayPick = null;
    this.selections = new Selections();
    this.selectionEvent = null;
    this.selected = null;
    this.unsnapped = null;
    
    this.selectionOccurred = new PulseAttr();
    this.selectionCleared = new PulseAttr();
    this.pointView = new Vector3DAttr();
    this.pointWorld = new Vector3DAttr();
    this.pointObject = new Vector3DAttr();
    this.pointGeo = new Vector3DAttr();
    this.normalView = new Vector3DAttr();
    this.normalWorld = new Vector3DAttr();
    this.normalObject = new Vector3DAttr();
    this.triIndex = new NumberAttr();
    this.distance = new NumberAttr();
    this.distanceFromScreenCenter = new NumberAttr();
    this.computePivotDistance = new BooleanAttr(true);
    this.selectedName = new StringAttr();
    this.selectedElement = new NumberAttr(-1);	// this.registered when the selection has a selected element
    this.lastSelectedName = new StringAttr();

    this.pointWorld.addModifiedCB(SelectionListener_PointWorldModifiedCB, this);

    this.registerAttribute(this.selectionOccurred, "selectionOccurred");
    this.registerAttribute(this.selectionCleared, "selectionCleared");
    this.registerAttribute(this.pointView, "pointView");
    this.registerAttribute(this.pointWorld, "pointWorld");
    this.registerAttribute(this.pointObject, "pointObject");
    this.registerAttribute(this.pointGeo, "pointGeo");
    this.registerAttribute(this.normalView, "normalView");
    this.registerAttribute(this.normalWorld, "normalWorld");
    this.registerAttribute(this.normalObject, "normalObject");
    this.registerAttribute(this.triIndex, "triIndex");
    this.registerAttribute(this.distance, "distance");
    this.registerAttribute(this.distanceFromScreenCenter, "distanceFromScreenCenter");
    this.registerAttribute(this.computePivotDistance, "computePivotDistance");
    this.registerAttribute(this.selectedName, "selectedName");
    this.registerAttribute(this.lastSelectedName, "lastSelectedName");
    
    this.numResponses.setValueDirect(-1);
}

SelectionListener.prototype.setRayPick = function(rayPick)
{
    this.rayPick = rayPick;
    
    var clickPoint = this.rayPick.getAttribute("clickPoint");
    this.registerAttribute(clickPoint, "clickPoint");
    clickPoint.addModifiedCB(SelectionListener_ClickPointModifiedCB, this);
}

SelectionListener.prototype.eventPerformed = function(event)
{
    this.selectionEvent = event;
    
    // if mouse-move event, don't process if any other mouse button is pressed (this affects object inspection)
    switch (event.type)
    {
        case eEventType.MouseMove:
        {
            if (event.inputId & MOUSEEVENT_LEFT_BUTTON ||
                event.inputId & MOUSEEVENT_MIDDLE_BUTTON ||
                event.inputId & MOUSEEVENT_RIGHT_BUTTON)
                return;        
        }
        break;
    }
    
    // TODO: allow for multi-select (clear if Ctrl is not pressed)
    this.clearSelections();
    
    this.getAttribute("clickPoint").setValueDirect(event.x, event.y);
}

SelectionListener.prototype.registerSelection = function(node, element)
{ 
    // only register first item
    if (this.selected) return;
    
    this.selected = node;
    var selected = node.getAttribute("selected");
    if (selected)
    {
        selected.setValueDirect(1);
    }
    
    // registering an attribute that has a NULL container (Get/SetContainer()) will set
    // the calling object as the container; don't want this behavior here
    var lastContainer = this.selected.getContainer();
    this.registerAttribute(this.selected, "Selected");	// unregistered in clearSelections()
    this.selected.setContainer(lastContainer);
	
    var name = node.getAttribute("name").getValueDirect().join("");
    //OutputDebugMsg("Selected: " + name);

    this.selectedName.setValueDirect(name);
    
    if (element >= 0)
    {
        this.selectedElement.setValueDirect(element);
        this.selected.registerAttribute(this.selectedElement, "selectedElement");
    }
}

SelectionListener.prototype.clearSelections = function()
{    
    this.selections.clear();
   
    this.selectedElement.setValueDirect(-1);
    if (this.selected)
    {
        this.selected.highlight.setValueDirect(false);
        this.selected.getAttribute("stopOnCollision").setValueDirect(false);
        
        var selected = this.selected.getAttribute("selected");
        if (selected)
        {
            selected.setValueDirect(0);
        }
    
    	if (this.selected.getAttribute("selectedElement"))
    	{
            this.selected.unregisterAttribute(this.selectedElement);
        }
        
        this.selectedName.setValueDirect("");
    	this.unregisterAttribute(this.selected);
    	this.selected = null;
    }
    
    this.selectionCleared.pulse();
}

SelectionListener.prototype.processPick = function(pick)
{
    for (var i=0; i < pick.path.length; i++)
    {
        var node = pick.path[i];
        
        // if selectable or show is false, or polygons are flipped, skip
        var selectable = node.getAttribute("selectable");
        var show = node.getAttribute("show");
        var flipPolygons = node.getAttribute("flipPolygons");
        if ((selectable && selectable.getValueDirect() == false) ||
            (show && show.getValueDirect() == false) ||
            (flipPolygons && flipPolygons.getValueDirect() == true))
            {
            continue;
        }      
        
        var element = -1;
        switch (node.attrType)
        {
            case eAttrType.PerspectiveCamera:
            case eAttrType.OrthographicCamera:
            {
                this.selections.cameras.push(node);
            }
            break;
		    
            case eAttrType.DirectionalLight:
            case eAttrType.PointLight:
            case eAttrType.SpotLight:
            {
                this.selections.lights.push(node);
            }
            break;
		    
            case eAttrType.Model:
            case eAttrType.SnapModel:
            case eAttrType.Ball:
            case eAttrType.Beam:
            case eAttrType.Box:
            case eAttrType.Elbow:
            case eAttrType.Gear:
            case eAttrType.Plank:
            case eAttrType.Pyramid:
            case eAttrType.Ring:
            case eAttrType.Tube:
            case eAttrType.Wall:
            case eAttrType.Wedge:
            {
                this.selections.models.push(node);
                this.registerSelection(node, element);
            }
            break;
            
            case eAttrType.Surface:
            {
                this.selections.surfaces.push(node);
            }
            break;

            case eAttrType.Label:
            {
                this.selections.labels.push(node);
                this.registerRasterComponentSelection(node, element);
            }
        }
    }
    
    if (this.selected)
    {
        // resnap if previously unsnapped
        if (this.unsnapped != this.selected)
        {
            if (this.unsnapped)
            {
                // restore unsnapped snapEnabled state
                this.unsnapped.snapEnabled.setValueDirect(true);
                
                // resnap previously-unsapped models (if still touching)
                var snapMgr = this.registry.find("SnapMgr");
                snapMgr.resnap(this.unsnappedModels);
               
                // mark all unsnapped models as physics-enabled and restore stopOnCollision flag (so they repel)
                for (var i = 0; i < this.unsnappedModels.length; i++)
                {
                    this.unsnappedModels[i].physicsEnabled.setValueDirect(true);
                    //this.unsnappedModels[i].stopOnCollision.setValueDirect(true);
                }
                
                this.unsnappedModels = null;
                this.unsnapped = null;
            }
        }
    
        // set stopOnCollision for the selected object (do this here because it needs to be 
        // cleared by the unsnap block below (if unsnapping)
        this.selected.getAttribute("stopOnCollision").setValueDirect(true);
        
        // unsnap if double-clicking on a snapped model and select the appropriate unsnapped model
        // corresponding to the snapped surface selected
        if (this.selectionEvent.type == eEventType.MouseLeftDblClick)
        {          
            if (this.selected.attrType == eAttrType.SnapModel)
            {
                // unsnap models
                this.unsnappedModels = this.selected.unsnapAll();
                // select selected unsnapped model
                this.unsnapped = this.selections.surfaces[0].snappedModel;
                this.unsnapped.snapEnabled.setValueDirect(false);
                this.selected = null // clear previous
                this.registerSelection(this.unsnapped, -1);
                
                // mark all unsnapped models as physics-disabled and clear stopOnCollision flag (so they won't repel)
                for (var i = 0; i < this.unsnappedModels.length; i++)
                {
                    this.unsnappedModels[i].physicsEnabled.setValueDirect(false);
                    this.unsnappedModels[i].stopOnCollision.setValueDirect(false);
                }              
            }
        }
        
        this.selected.highlight.setValueDirect(true);
        
        this.pointObject.setValueDirect(pick.intersectRecord.pointModel.x, pick.intersectRecord.pointModel.y, pick.intersectRecord.pointModel.z);
        this.pointWorld.setValueDirect(pick.intersectRecord.pointWorld.x, pick.intersectRecord.pointWorld.y, pick.intersectRecord.pointWorld.z);
        this.pointView.setValueDirect(pick.intersectRecord.pointView.x, pick.intersectRecord.pointView.y, pick.intersectRecord.pointView.z);
        this.normalObject.setValueDirect(pick.intersectRecord.normalModel.x, pick.intersectRecord.normalModel.y, pick.intersectRecord.normalModel.z);
        this.normalWorld.setValueDirect(pick.intersectRecord.normalWorld.x, pick.intersectRecord.normalWorld.y, pick.intersectRecord.normalWorld.z);
        this.normalView.setValueDirect(pick.intersectRecord.normalView.x, pick.intersectRecord.normalView.y, pick.intersectRecord.normalView.z);
        this.triIndex.setValueDirect(pick.intersectRecord.triIndex);
        this.distance.setValueDirect(pick.intersectRecord.distance);
    }
    
    return (this.selected ? true : false);
}

SelectionListener.prototype.processPicks = function(picks)
{
    for (var i=0; i < picks.length; i++)
    {
        if (this.processPick(picks[i]) == true)
        {
            return true;
        }
    }   
    
    return false;
}

SelectionListener.prototype.registerRasterComponentSelection = function(rc,element)
{
    // if a GUI has already been selected, replace if node paramter has a greater renderedSlot value
    if (this.selected)
    {
        var selected = this.selected;
        if (selected)
        {
            var renderedSlotSelection = rc.renderedSlot.getValueDirect();
            var renderedSlotSelected = selected.renderedSlot.getValueDirect();

            if (renderedSlotSelection > renderedSlotSelected)
            {
                return this.registerSelection(rc, element, true);
            }
        }
    }
    else // no previous selection, register
    {
        this.registerSelection(rc, element);
    }

}
SelectionListener.prototype.clickPointModified = function()
{
    var point = this.getAttribute("clickPoint").getValueDirect();
    var vpMgr = this.registry.find("ViewportMgr");
    var vp = vpMgr.getViewportAtScreenXY(point.x, point.y);
    this.selections.viewports.push(vp.viewport);
    this.rayPick.getAttribute("viewport").setValueDirect(vp.viewport.x, vp.viewport.y, vp.viewport.width, vp.viewport.height);
    this.rayPick.getAttribute("camera").setValueDirect(vp.camera);
    var root = this.registry.getAttribute("rootPtr").getValueDirect();
    this.rayPick.execute(root);
    if (this.rayPick.picked.length > 0)
    {
        this.processPicks(this.rayPick.picked);
        this.selectionOccurred.pulse();
    }
    // update distance from screen center
    this.updateDistanceFromScreenCenter(root);
    // update scene inspector with selected camera
    this.updateSceneInspectionCamera(vp.camera);
}

SelectionListener.prototype.updateDistanceFromScreenCenter = function(root)
{
    if (this.computePivotDistance.getValueDirect() == false)
    {
        return;
    }

    // get window center and set to ray pick's click point
    var bworks = this.registry.find("Bridgeworks");
    if (!bworks) return;
    var x = bworks.canvas.width / 2;
    var y = bworks.canvas.height / 2;
    var lastClickPoint = this.rayPick.getAttribute("clickPoint").getValueDirect();
    var params = new AttributeSetParams(-1, -1, 0, false, false);   
    this.rayPick.getAttribute("clickPoint").setValueDirect(x, y, params);
    
    // execute
    this.rayPick.execute(root);
    
    // cycle through picked list and skip labels and poly lines
    // NOTE: we may eventually want the convenience of pivoting about a label because labels are sometimes easier 
    // to intersect (i.e., when the model is too small to intersect)
    var found = false;
    for (var i=0; i < this.rayPick.picked.length && !found; i++)
    {
        if (this.rayPick.picked[i].intersectRecord.distance != 0) // labels and poly lines have a distance of 0
        {
            // found selected geometry, update distance from screen center
            this.distanceFromScreenCenter.setValueDirect(this.rayPick.picked[i].intersectRecord.distance);
            found = true;
            break;
        }
    }

    // restore previous click point
    this.rayPick.getAttribute("clickPoint").setValueDirect(lastClickPoint.x, lastClickPoint.y, params);   
}

SelectionListener.prototype.updateSceneInspectionCamera = function(camera)
{
    var si = this.registry.find("SceneInspector");
    if (si)
    {
        if (si.getCamera() == camera) return; // already connected
        
        // disconnect old camera, connect new one
        var connectionMgr = this.registry.find("ConnectionMgr");
        if (connectionMgr)
        {
            connectionMgr.disconnectSceneInspection(si, si.getCamera());
            connectionMgr.connectSceneInspection(si, camera);
        }
    }
}

function SelectionListener_ClickPointModifiedCB(attribute, container)
{
    container.clickPointModified();
}

function SelectionListener_PointWorldModifiedCB(attribute, container)
{
}
ViewportLayout.prototype = new AttributeContainer();
ViewportLayout.prototype.constructor = ViewportLayout;

function ViewportLayout()
{
    AttributeContainer.call(this);
    this.className = "ViewportLayout";
    
    this.name = new StringAttr("ViewportLayout");
    this.width = new NumberAttr(0);
    this.height = new NumberAttr(0);
    
    this.registerAttribute(this.name, "name");
    this.registerAttribute(this.width, "width");
    this.registerAttribute(this.height, "height");
}

ViewportLayout.prototype.initialize = function()
{
}

ViewportLayout.prototype.layoutDirectives = function(directives)
{
}

GridLayout.prototype = new ViewportLayout();
GridLayout.prototype.constructor = GridLayout;

function GridLayout()
{
    ViewportLayout.call(this);
    this.className = "GridLayout";
    
    this.name.setValueDirect("GridLayout");
    
    this.rows = new NumberAttr(1);
    this.cols = new NumberAttr(1);
    
    this.registerAttribute(this.rows, "rows");
    this.registerAttribute(this.cols, "cols");
}

GridLayout.prototype.initialize = function()
{
    this.rows.setValueDirect(1);
    this.cols.setValueDirect(1);
    
    // call base-class implementation
    ViewportLayout.prototype.initialize.call(this);
}

GridLayout.prototype.layoutDirectives = function(directives)
{
	if (!directives)
	{
		return;
	}

    var width = this.width.getValueDirect();
    var height = this.height.getValueDirect();
    var rows = this.rows.getValueDirect();
    var cols = this.cols.getValueDirect();
    if (width <= 0 || height <= 0 || rows <= 0 || cols <= 0)
    {
        return;
    }
    
    var vpX = 0;
    var vpY = 0;
    var vpWidth = width / cols;
	var vpHeight = height / rows;
	var values = new Array(4);

	var nDirectives = directives.length;
	for (var i=0, n=0; i < rows && n < nDirectives; i++)
	{
		for (var j=0; j < cols && n < nDirectives; j++, n++)
		{
			values[0] = vpX;
			values[1] = vpY;
			values[2] = vpWidth;
			values[3] = vpHeight;

			directives[n].getAttribute("viewport").setValue(values);

			vpX += vpWidth;
		}

		vpX = 0;
		vpY += vpHeight;
	}
}
ViewportMgr.prototype = new AttributeContainer();
ViewportMgr.prototype.constructor = ViewportMgr;

function ViewportMgr()
{
    AttributeContainer.call(this);
    this.className = "ViewportMgr";
    
    this.name = new StringAttr("ViewportMgr");
    this.cursor = new StringAttr("Arrow");
    this.width = new NumberAttr(0);
    this.height = new NumberAttr(0);
    this.layout = new ReferenceAttr(null);
    
    this.cursor.addModifiedCB(ViewportMgr_CursorModifiedCB, this);
    this.width.addModifiedCB(ViewportMgr_WidthModifiedCB, this);
    this.height.addModifiedCB(ViewportMgr_HeightModifiedCB, this);
    this.layout.addModifiedCB(ViewportMgr_LayoutModifiedCB, this);
    
    this.registerAttribute(this.name, "name");
    this.registerAttribute(this.cursor, "cursor");
    this.registerAttribute(this.width, "width");
    this.registerAttribute(this.height, "height");
    this.registerAttribute(this.layout, "layout");
}

ViewportMgr.prototype.initLayout = function()
{
    var layout = this.layout.getValueDirect();
    if (layout)
    {
        layout.initialize();
    }
}

ViewportMgr.prototype.layoutDirectives = function(directives)
{
    var layout = this.layout.getValueDirect();
    if (layout)
    {
        layout.layoutDirectives(directives);   
    }
}

ViewportMgr.prototype.getViewportAtScreenXY = function(x, y)
{
    var width = this.width.getValueDirect();
    var height = this.height.getValueDirect();
    
    // make sure x, y fall between [0, viewport width/height]
    x = clamp(x, 0, width);
    y = clamp(y, 0, height);
    
    // get cameras
    var cameras = this.registry.getByType(eAttrType.Camera);
    
    // get smallest viewport containing screen x, y (necessary for picture-in-picture)
    var minWidth = width;
    var minHeight = height;
    var camera, viewport;
    for (var i=0; i < cameras.length; i++)
    {
        if (cameras[i].viewport.containsPoint(x, y) &&
            cameras[i].viewport.width <= minWidth &&
            cameras[i].viewport.height <= minHeight)
        {
            camera = cameras[i];
            viewport = cameras[i].viewport;
            minWidth = cameras[i].viewport.width;
            minHeight = cameras[i].viewport.height
        }
    }
    
    return { viewport: viewport, camera: camera };
}

function ViewportMgr_CursorModifiedCB(attribute, container)
{
    // TODO
}

function ViewportMgr_WidthModifiedCB(attribute, container)
{
    var layout = container.layout.getValueDirect();
    if (layout)
    {
        layout.getAttribute("width").setValueDirect(attribute.getValueDirect());
    }
}

function ViewportMgr_HeightModifiedCB(attribute, container)
{
    var layout = container.layout.getValueDirect();
    if (layout)
    {
        layout.getAttribute("height").setValueDirect(attribute.getValueDirect());
    }
}

function ViewportMgr_LayoutModifiedCB(attribute, container)
{
    var layout = attribute.getValueDirect();
    if (layout)
    {
        layout.getAttribute("width").setValueDirect(container.width.getValueDirect());
        layout.getAttribute("height").setValueDirect(container.height.getValueDirect());
    }
}
RasterComponentEventListener.prototype = new EventListener();
RasterComponentEventListener.prototype.constructor = Command;

function RasterComponentEventListener()
{
    EventListener.call(this);
    this.className = "RasterComponentEventListener";

    this.rcs = [];
    this.rcsSelectionState = [];
    this.rcListenMap = [];
    this.rcEventMap = [];
    this.styleMgr = null;
    
    this.selectionEvent = new InputEvent(eEventType.Unknown, 0, 0xffffffff, 0, eEventType.Key_Up);

	this.name.setValueDirect("RasterComponentEventListener");
	this.numResponses.setValueDirect(-1);
}

RasterComponentEventListener.prototype.eventPerformed = function(event)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        return;
    }
    
    var currSelectionState, lastSelectionState, selectionEventSelectionState;
	for (var i=0; i < this.rcs.length; i++)
	{
		if (!this.isListening(this.rcs[i]))
		{
			continue;
		}

		lastSelectionState = this.rcsSelectionState[i];
		currSelectionState = this.rcs[i].eventPerformed(event);
		
		if (this.styleMgr)
	    {
		    if (currSelectionState)
			{
				this.styleMgr.eventPerformed(event, this.rcs[i]);

				// send selected/focus/mouseover event depending upon event type and whether 
				// component doesn't have focus/didn't have selection
				switch (event.type)
				{
				case eEventType.MouseLeftClick:
					{
						// send element focus event (once)
						if (this.isListeningEvent(this.rcs[i], eEventType.ElementFocus) &&
							this.rcs[i].hasFocus.getValueDirect() <= 0)
						{
							this.selectionEvent.synchronize(event);
							this.selectionEvent.type = eEventType.ElementFocus;
							
							selectionEventSelectionState = m_rcs[i].eventPerformed(this.selectionEvent);
							this.styleMgr.eventPerformed(this.selectionEvent, this.rcs[i]);

							this.rcs[i].hasFocus.setValueDirect(1);
					    }
					}
					break;

				case eEventType.MouseMove:
					{
						// send element selected event (once)
						if (this.isListeningEvent(this.rcs[i], eEventType.ElementSelected) &&
							this.rcs[i].selected.getValueDirect() <= 0)
						{
							this.selectionEvent.synchronize(event);
							this.selectionEvent.type = eEventType.ElementSelected;
							
							selectionEventSelectionState = this.rcs[i].eventPerformed(this.selectionEvent);
							this.styleMgr.eventPerformed(this.selectionEvent, this.rcs[i]);
							this.rcs[i].selected.setValueDirect(1);
						}

						if (!lastSelectionState &&
							this.isListeningEvent(this.rcs[i], eEventType.MouseOver))
						{
							this.selectionEvent.synchronize(event);
							this.selectionEvent.type = eEventType.MouseOver;

							selectionEventSelectionState = this.rcs[i].eventPerformed(this.selectionEvent);
							this.styleMgr.eventPerformed(this.selectionEvent, this.rcs[i]);
						}
					}
					break;
				}
			}
			else // !currSelectionState
			{
				// send unselected/blur/mouseout event depending upon event type and whether 
				// component has focus/had selection
				switch (event.type)
				{
				case eEventType.MouseLeftDown:
				case eEventType.MouseLeftClick:
				case eEventType.MouseLeftDblClick:
				case eEventType.MouseMiddleDown:
				case eEventType.MouseMiddleClick:
				case eEventType.MouseMiddleDblClick:
				case eEventType.MouseRightDown:
				case eEventType.MouseRightClick:
				case eEventType.MouseRightDblClick:
				case eEventType.MouseWheelDown:
				case eEventType.MouseBothDown:
					{
						// send element blur event (once)
						if (this.isListeningEvent(this.rcs[i], eEventType.ElementBlur) &&
							this.rcs[i].hasFocus.getValueDirect() > 0)
						{
							this.selectionEvent.synchronize(event);
							this.selectionEvent.type = eEventType.ElementBlur;
							
							selectionEventSelectionState = this.rcs[i].eventPerformed(this.selectionEvent);
							this.styleMgr.eventPerformed(this.selectionEvent, this.rcs[i]);

							this.rcs[i].hasFocus.setValueDirect(-1);
						}
					}
					break;

				case eEventType.MouseMove:
					{
						// send element unselected event (once)
						if (this.isListeningEvent(this.rcs[i], eEventType.ElementUnselected) &&
							this.rcs[i].selected.getValueDirect() > 0)
						{
							this.selectionEvent.synchronize(event);
							this.selectionEvent.type = eEventType.ElementUnselected;
							
							selectionEventSelectionState = this.rcs[i].eventPerformed(this.selectionEvent);
							this.styleMgr.eventPerformed(this.selectionEvent, this.rcs[i]);
							this.rcs[i].selected.setValueDirect(-1);
						}

						if (lastSelectionState &&
							this.isListeningEvent(this.rcs[i], eEventType.MouseOut))
						{
							this.selectionEvent.synchronize(event);
							this.selectionEvent.type = eEventType.MouseOut;

							selectionEventSelectionState = this.rcs[i].eventPerformed(this.selectionEvent);
							this.styleMgr.eventPerformed(this.selectionEvent, this.rcs[i]);
						}
					}
					break;
				}
			}
		}

		this.rcsSelectionState[i] = currSelectionState;
	}
}

RasterComponentEventListener.prototype.registerComponent = function(rc, before)
{
    if (rc)
    {
        if (before)
        {
            var i = this.rcs.indexOf(before);
            if (i < 0) i = this.rcs.length;
            
            this.rcs.splice(i, 0, rc);
            this.rcsSelectionState.splice(i, 0, rc);
        }
        else
        {
            this.rcs.push(rc);
            this.rcsSelectionState.push(rc);
        }
    }
}

RasterComponentEventListener.prototype.unregisterComponent = function(rc)
{
    if (rc)
    {
        this.rcs.splice(this.rcs.indexOf(rc), 1);
    }
}

RasterComponentEventListener.prototype.Listen = function(rc)
{
    if (rc)
    {
        this.rcListenMap[rc] = true;
    }
}

RasterComponentEventListener.prototype.Ignore = function(rc)
{
    if (rc)
    {
        this.rcListenMap[rc] = false;
    }
}

RasterComponentEventListener.prototype.listenEvent = function(rc, eventType)
{
    if (rc)
    {
        if (this.rcEventMap[rc] == undefined)
        {
            this.rcEventMap[rc] = new Array();
        }

        this.rcEventMap[rc].push(eventType);
    }
}

RasterComponentEventListener.prototype.ignoreEvent = function(rc, eventType)
{
    if (rc)
    {
        if (this.rcEventMap[rc])
        {
            this.rcEventMap[rc].splice(this.rcEventMap[rc].indexOf(eventType), 1);
        }
    }
}

RasterComponentEventListener.prototype.setStyleMgr = function(styleMgr)
{
    this.styleMgr = styleMgr;
}

RasterComponentEventListener.prototype.setSelectionState = function(rc, selected)
{
    this.rcsSelectionState[rc] = selected;
}

RasterComponentEventListener.prototype.getComponent = function(n)
{
    if (n < this.rcs.length)
    {
        return this.rcs[n];
    }

    return null;
}

RasterComponentEventListener.prototype.isListening = function(rc)
{
    if (rc)
    {
        if (this.rcListenMap[rc])
        {
            return this.rcListenMap[rc];
        }
    }

    return false;
}

RasterComponentEventListener.prototype.isListeningEvent = function(rc, eventType)
{
    if (rc)
    {
        if (this.rcEventMap[rc])
        {
            if (this.rcEventMap[rc].indexOf(eventType) >= 0)
                return true;
        }
    }

    return false;
}




var g_objPosMap = {};

function addInspectionGroup(node, factory)
{

    // ensure that rotation group has not already been added
    var rotGroup = getInspectionGroup(node);

    if (rotGroup)
        return;

    var pGrp = new Group();
    pGrp.setGraphMgr(factory.graphMgr);
    var pTranslate = new Translate();
    pTranslate.setGraphMgr(factory.graphMgr);
    var pScaleInv = new Scale();
    pScaleInv.setGraphMgr(factory.graphMgr);
    var pQuat = new QuaternionRotate();
    pQuat.setGraphMgr(factory.graphMgr);
    var pTransBack = new Translate();
    pTransBack.setGraphMgr(factory.graphMgr);
    var pScale = new Scale();
    pScale.setGraphMgr(factory.graphMgr);

    pQuat.addModifiedCB(Util_InspectionGroup_RotationQuatModifiedCB, node);

    pGrp.name.setValueDirect("InspectionGroup");
    pTranslate.name.setValueDirect("Translate");
    pScaleInv.name.setValueDirect("ScaleInverse");
    pQuat.name.setValueDirect("Quaternion");
    pTransBack.name.setValueDirect("TranslateBack");
    pScale.name.setValueDirect("Scale");

    pGrp.addChild(pTranslate); // child 0
    pGrp.addChild(pScaleInv);  // child 1
    pGrp.addChild(pQuat);      // child 2
    pGrp.addChild(pScale);     // child 3
    pGrp.addChild(pTransBack); // child 4

    var pChildZero = node.getChild(0);
    if (pChildZero)
    {
        pChildZero.insertChild(pGrp, 0);
    }

    node.registerAttribute(pTranslate.translation, "inspectionGroup_translate");
    node.registerAttribute(pScaleInv.scale, "inspectionGroup_scaleInverse");
    node.registerAttribute(pQuat.rotationQuat, "inspectionGroup_rotationQuat");
    node.registerAttribute(pQuat.enabled, "inspectionGroup_rotationEnabled");
    node.registerAttribute(pScale.scale, "inspectionGroup_scale");
    node.registerAttribute(pTransBack.translation, "inspectionGroup_translateBack");

    pTranslate.translation.setContainer(node);
    pScaleInv.scale.setContainer(node);
    pQuat.rotationQuat.setContainer(node);
    pQuat.enabled.setContainer(node);
    pScale.scale.setContainer(node);
    pTransBack.translation.setContainer(node);

    return;
}

function deleteInspectionGroup(node)
{
    var rotGroup = getInspectionGroup(node);
    if (rotGroup)
    {
        rotGroup.getChild(0).getAttribute("translation").setContainer(rotGroup.getChild(0));
        rotGroup.getChild(1).getAttribute("scale").setContainer(rotGroup.getChild(1));
        rotGroup.getChild(2).getAttribute("rotationQuat").setContainer(rotGroup.getChild(2));
        rotGroup.getChild(2).getAttribute("enabled").setContainer(rotGroup.getChild(2));
        rotGroup.getChild(3).getAttribute("scale").setContainer(rotGroup.getChild(3));
        rotGroup.getChild(4).getAttribute("translation").setContainer(rotGroup.getChild(4));

        node.unregisterAttribute(node.getAttribute("inspectionGroup_translate"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_scaleInverse"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_rotationQuat"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_rotationEnabled"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_scale"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_translateBack"));

        node.removeChild(rotGroup);

    }

    return;
}

function getInspectionGroup(moveableNode)
{
    var group = null;

    var childZero = moveableNode.getChild(0);
    if (childZero)
    {
        group = childZero.getNamedChild("InspectionGroup")
    }

    return group;
}

function setInspectionGroupActivationState(node, enable)
{
    var pRotGroup = getInspectionGroup(node);
    if (pRotGroup)
    {
        var pQuat = pRotGroup.getChild(2);
        if (pQuat)
        {
            pQuat.enabled.setValueDirect(enable);

            if (!enable)
            {
                var quat = new Quaternion();
                quat.loadIdentity();

                var quatAttr = pQuat.rotationQuat;
                quatAttr.setValueDirect(quat);
            }
        }

        var pPos = node.getAttribute("position");
        if (enable)
        {
            if (!(node in g_objPosMap))
            {
                g_objPosMap[node] = pPos.getValueDirect();
            }
        }
        else // !enable
        {
            var pos = g_objPosMap[node];
            pPos.setValueDirect(pos);
        }
    }

    return;
}

function setInspectionGroupContainer(node)
{
    var pRotGroup = getInspectionGroup(node);
    if (pRotGroup)
    {
        node.unregisterAttribute(node.getAttribute("inspectionGroup_translate"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_scaleInverse"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_rotationQuat"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_rotationEnabled"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_scale"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_translateBack"));

        node.registerAttribute(pRotGroup.getChild(0).getAttribute("translation"), "inspectionGroup_translate");
        node.registerAttribute(pRotGroup.getChild(1).getAttribute("scale"), "inspectionGroup_scaleInverse");
        node.registerAttribute(pRotGroup.getChild(2).getAttribute("rotationQuat"), "inspectionGroup_rotationQuat");
        node.registerAttribute(pRotGroup.getChild(2).getAttribute("enabled"), "inspectionGroup_rotationEnabled");
        node.registerAttribute(pRotGroup.getChild(3).getAttribute("scale"), "inspectionGroup_scale");
        node.registerAttribute(pRotGroup.getChild(4).getAttribute("translation"), "inspectionGroup_translateBack");

        pRotGroup.getChild(0).getAttribute("translation").setContainer(node);
        pRotGroup.getChild(1).getAttribute("scale").setContainer(node);
        pRotGroup.getChild(2).getAttribute("rotationQuat").setContainer(node);
        pRotGroup.getChild(2).getAttribute("enabled").setContainer(node);
        pRotGroup.getChild(3).getAttribute("scale").setContainer(node);
        pRotGroup.getChild(4).getAttribute("translation").setContainer(node);
    }

    return;
}

function zeroInspectionGroup(node)
{
    var pRotGroup = getInspectionGroup(node);
    if (pRotGroup)
    {
        var pQuat = pRotGroup.getChild(2);
        if (pQuat)
        {
            var quat = new Quaternion();
            quat.loadIdentity();

            var quatAttr = pQuat.rotationQuat;
            quatAttr.setValueDirect(quat);
        }
    }

    return;
}

function getInspectionGroupQuaternion(node)
{
    var pRotGroup = getInspectionGroup(node);
    if (pRotGroup)
    {
        var pQuat = pRotGroup.getChild(2);
        if (pQuat)
        {
            var quatAttr = pQuat.rotationQuat;
            return quatAttr;
        }
    }
    
    return null;
}

function clearObjectPositionMap()
{
    g_objPosMap = {};

    return;
}

// notify node that the rotation quat rotates that it has been modified
function Util_InspectionGroup_RotationQuatModifiedCB(attribute, container)
{
    container.setModified();
}
SerializeCommand.prototype = new Command();
SerializeCommand.prototype.constructor = SerializeCommand;

function SerializeCommand()
{
    Command.call(this);
    this.className = "Serialize";
    this.attrType = eAttrType.Serialize;

    this.targetAttribute = null;
    this.target.addModifiedCB(SerializeCommand_TargetModifiedCB, this);
    this.directive = null;
    this.serialized = "";
}

SerializeCommand.prototype.execute = function()
{
    if (this.directive)
    {
//        if (this.target && this.directive)
//        {
//            if (this.directive.execute(this.target === 0))
//            {
//                this.serialized = this.directive.getSerialized();
//            }
//        }
//        else // !this.target
//        {
        this.serializeScene();
//        }
    }
}

SerializeCommand.prototype.serializeScene = function()
{
    var i;
    var container = null;
    var node = null;
    var context = new Context();
    var xstr;

    // root element open tag
    this.serialized = '<?xml version="1.0" encoding="UTF-8"?><?bw onload="initialize"?><Session broadcast="false">';

    //var attrContainerRegistry = this.registry.getAttributeContainerRegistry();
    var attrContainerRegistry = bridgeworks.registry;
    if (attrContainerRegistry)
    {
        var factory = this.registry.find("AttributeFactory");
        var serializer = factory.create("Serializer");
        var xmlSerializer = new XMLSerializer();
        // set minimum flag so that only the minimum required for recreation is serialized
        serializer.serializeMinimum.setValueDirect(true);

        var count = attrContainerRegistry.getObjectCount();

        // serialize
        var i;
        var physicsSimulators = [];
        for (i = 0; i < count; i++)
        {
            container = attrContainerRegistry.getObject(i);
            if (!container)
                continue;

            // physics simulator (serialize at end)
            if (container.attrType == eAttrType.PhysicsSimulator)
            {
                physicsSimulators.push(container);
                continue;
            }
            // device handlers
            if (container.attrType > eAttrType.DeviceHandler &&
                    container.attrType < eAttrType.DeviceHandler_End)
            {
                context.attribute = container;

                // serialize
                serializer.serialize(context.attribute, context.item, context.attributeName, context.container);
                var serialized = xmlSerializer.serializeToString(serializer.DOM);
                if (serialized == "<__InitialRoot/>")
                    continue;
                this.serialized += serialized;
            }
            // root nodes (nodes without parents)
            else if (container.attrType > eAttrType.Node &&
                    container.attrType < eAttrType.Node_End)
            {
                if (container.getParentCount() == 0)
                {
                    this.directive.execute(container);
                    this.serialized += this.directive.serialized;
                }
            }
            // directives
            else if (container.attrType > eAttrType.Directive &&
                    container.attrType < eAttrType.Directive_End)
            {
                context.attribute = container;

                // serialize
                serializer.serialize(context.attribute, context.item, context.attributeName, context.container);
                var serialized = xmlSerializer.serializeToString(serializer.DOM);
                if (serialized == "<__InitialRoot/>")
                    continue;
                this.serialized += serialized;
            }
            // SelectionListener
            else if (container.className == "SelectionListener")
            {
                var computePivotDistance = container.getAttribute("computePivotDistance").getValueDirect();

                this.serialized += "<Set target=\"Selector\" computePivotDistance=\"";
                this.serialized += (computePivotDistance ? "true" : "false");
                this.serialized += "\"/>";
            }
            // remaining attributes not fitting other criteria and not a command (commands serialized below)
            /*else if (container.attrType < eAttrType.Command || 
             container.attrType > eAttrType.Command_End)
             {
             context.attribute = container;
             
             // serialize
             serializer.serialize(context.attribute, context.item, context.attributeName, context.container);
             this.serialized += xmlSerializer.serializeToString(serializer.DOM);
             }*/
        }

        // commands

        // DisconnectAttributes commands (must come before ConnectAttributes in DefaultPreferences.xml)
        for (i = 0; i < count; i++)
        {
            container = attrContainerRegistry.getObject(i);
            if (!container)
                continue;

            if (container.className == "DisconnectAttributes")
            {
                context.attribute = container;

                // serialize
                serializer.serialize(context.attribute, context.item, context.attributeName, context.container);
                var serialized = xmlSerializer.serializeToString(serializer.DOM);
                if (serialized == "<__InitialRoot/>")
                    continue;
                this.serialized += serialized;
            }
        }

        // other commands
        for (i = 0; i < count; i++)
        {
            container = attrContainerRegistry.getObject(i);
            if (!container)
                continue;

            if (container.attrType > eAttrType.Command &&
                container.attrType < eAttrType.Command_End &&
                container.className != "DisconnectAttributes")
            {
                context.attribute = container;

                // serialize
                serializer.serialize(context.attribute, context.item, context.attributeName, context.container);
                var serialized = xmlSerializer.serializeToString(serializer.DOM);
                if (serialized == "<__InitialRoot/>")
                    continue;
                this.serialized += serialized;
            }
        }

        // snapped models
        var snapMgr = this.registry.find("SnapMgr");
        this.serialized += snapMgr.serialize();
        
        // physicsSimulators
        for (i = 0; i < physicsSimulators.length; i++)
        {
            this.directive.execute(physicsSimulators[i]);
            this.serialized += this.directive.serialized;
        }
    }

    // root element close tag
    this.serialized += "</Session>";
    serializedScene += this.serialized;
    console.log(this.serialized);

    return;
}

SerializeCommand.prototype.undo = function()
{

}

SerializeCommand.prototype.setRegistry = function(registry)
{
    // create serialize directive
    var factory = bridgeworks.registry.find("AttributeFactory");
    this.directive = factory.create("SerializeDirective");

    // call base-class implementation
    Command.prototype.setRegistry.call(this, registry);
}

SerializeCommand.prototype.getSerialized = function()
{
    return this.serialized;
}

function SerializeCommand_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    container.targetAttribute = container.registry.find(target);
}
ScreenCaptureCommand.prototype = new Command();
ScreenCaptureCommand.prototype.constructor = ScreenCaptureCommand;

function ScreenCaptureCommand()
{
    Command.call(this);
    this.className = "ScreenCapture";
    this.attrType = eAttrType.ScreenCapture;

    this.canvasId = new StringAttr();

    this.registerAttribute(this.canvasId, "canvasId");

    this.numResponses.setValueDirect(0);
}

ScreenCaptureCommand.prototype.execute = function()
{
    var bworks = this.registry.find("Bridgeworks");
    bworks.eventMgr.addListener(eEventType.RenderBegin, this);
    bworks.eventMgr.addListener(eEventType.RenderEnd, this);
}

ScreenCaptureCommand.prototype.screenCapture = function(canvasId)
{
    var canvas = document.getElementById(canvasId);
    var imageData = canvas.toDataURL('image/png');

    // 3Scape-specific: decode the base64 data into 8bit array
    cimageData = imageData;
    var cnt = imageData.lastIndexOf(',') + 1;
    imageData = imageData.substr(cnt);
    imgeData = Base64Binary.decode(imageData);
        
    // for testing with Bug-60.htm
    //document.getElementById('imgCapture').src = imageData;

    // copy to clipboard
    // TODO: investigate method described at: https://forums.mozilla.org/addons/viewtopic.php?t=9736&p=21119

    // open in new window
    //window.open(imageData);
    
    // download
    //var imageDataStream = imageData.replace("image/png", "image/octet-stream");
    //window.location.href = imageDataStream;
}

ScreenCaptureCommand.prototype.get2DElementCanvas = function(canvas3D)
{
    // create 2D canvas for labels
    var canvas2D = document.createElement('canvas');
    canvas2D.id = "canvas2D";
    canvas2D.width = canvas3D.width;
    canvas2D.height = canvas3D.height;
    var ctx = canvas2D.getContext('2d');

    // get labels
    var labels = this.registry.getByType(eAttrType.Label);
    
    // calculate mask color which is different from all labels colors
    var maskColor = "black";
    
    // setup img src data for labels
    var data = "data:image/svg+xml," + 
               "<svg xmlns='http://www.w3.org/2000/svg' width='" + canvas2D.width + "' height='" + canvas2D.height + "'>" + 
               "<foreignObject width='100%' height='100%'>" + 
               "<div xmlns='http://www.w3.org/1999/xhtml' style='background:" + maskColor + ";'>";   
    for (var i=0; i < labels.length; i++)
    {
        var style = labels[i].htmlLabel.style;
        data += "<span style='position:absolute; " +
                "font-family:" + style.fontFamily + "; " +
                "font-size:" + style.fontSize + "; " +
                "font-weight:" + style.fontWeight + "; " +
                "color:" + style.color + "; " +
                "background-color:" + style.backgroundColor + "; " +
                "text-shadow:" + style.textShadow + "; " +
                "visibility:" + style.visibility + "; " +
                "left:" + style.left + "; " +
                "top:" + style.top + "; " +
                "padding-left:" + style.paddingLeft + "; " +
                "padding-right:" + style.paddingRight + "; " +
                "padding-top:" + style.paddingTop + "; " +
                "padding-bottom:" + style.paddingBottom + "; " +
                "'>" + labels[i].text.getValueDirect().join("") + 
                "</span>";                
    }   
    data += "</div>" +
            "</foreignObject>" + 
            "</svg>";
        
    // create Image and set data as its src
    var img = new Image();
    img.src = data;

    // fill 2D canvas with background color
    ctx.fillStyle = maskColor;
    ctx.fillRect(0, 0, canvas2D.width, canvas2D.height);
    
    // draw image to 2D canvas
    ctx.drawImage(img, 0, 0);

    return { canvas: canvas2D, maskColor: maskColor }
}

ScreenCaptureCommand.prototype.eventPerformed = function(event)
{
    // if mouse-move event, don't process if any other mouse button is pressed (this affects object inspection)
    switch (event.type)
    {
        case eEventType.RenderBegin:
            {
                var screenCaptureRect = this.registry.find("ScreenCaptureRect");                    // TODO: change name
                var screenCaptureTexture = this.registry.find("ScreenCaptureTexture")
                if (screenCaptureRect && screenCaptureTexture)
                {
                    // set 2D element canvas to screen capture texture
                    var canvas2D = this.get2DElementCanvas(document.getElementById(this.canvasId.getValueDirect().join("")));
                    screenCaptureTexture.textureObj.setImageWithCanvas(canvas2D.canvas);
                    screenCaptureTexture.imageSet = true;
                    // TODO: set blendOp/maskColor
                    //screenCaptureTexture.setTextureColorMask(0, 0, 0, 1);

                    // set screen capture texture to screen capture rect object
                    screenCaptureRect.setTexture(screenCaptureTexture);

                    // show screen capture rect object
                    screenCaptureRect.enabled.setValueDirect(true);
                }
            }
            break;

        case eEventType.RenderEnd:
            {
                this.screenCapture(this.canvasId.getValueDirect().join(""));
                // hide screen capture rect object
                var screenCaptureRect = this.registry.find("ScreenCaptureRect");
                if (screenCaptureRect)
                {
                    screenCaptureRect.enabled.setValueDirect(false);
                }
            }
            break;
    }
}

ExportCommand.prototype = new Command();
ExportCommand.prototype.constructor = ExportCommand;

function ExportCommand()
{
    Command.call(this);
    this.className = "Export";
    this.attrType = eAttrType.Export;

    this.targetNode = null;
    
    this.url = new StringAttr();
    
    this.target.addModifiedCB(ExportCommand_TargetModifiedCB, this);

    this.registerAttribute(this.url, "url");
}

ExportCommand.prototype.execute = function()
{
    if (!this.targetNode) return;
    
    var url = this.url.getValueDirect().join("");   
    switch (getFileExtension(url))
    {
        case "stl":
            this.exportSTL(this.targetNode, url);
            break;
            
        default:
            break;
    }
}

ExportCommand.prototype.exportSTL = function(model, url)
{
    // name
    var name = model.name.getValueDirect().join("");
    
    // vertices/normals
    var vertices = [];
    var normals = [];   
    for (var i=0; i < model.geometry.length; i++)
    {
        var geometry = model.geometry[i];
        switch (geometry.attrType)
        {
            case eAttrType.TriList:
                {
                    vertices = vertices.concat(geometry.vertices.getValueDirect());
                    normals = normals.concat(geometry.vertices.getValueDirect());
                }
                break;
        }
    }
    if (vertices.length == 0) return;
    
    // vertices cannot have negative values, so offset vertices if negative values are present
    var x = FLT_MAX, y = FLT_MAX, z = FLT_MAX;
    for (var i=0; i < vertices.length; i+=3)
    {
        x = Math.min(x, vertices[i  ]);
        y = Math.min(y, vertices[i+1]);
        z = Math.min(z, vertices[i+2]);
    }
    if (x < 0)
    {
        x = Math.abs(x);
        for (var i=0; i < vertices.length; i+=3)
        {
            vertices[i  ] += x;
        }
    }
    if (y < 0)
    {
        y = Math.abs(y);
        for (var i=0; i < vertices.length; i+=3)
        {
            vertices[i+1] += y;
        }
    }
    if (z < 0)
    {
        z = Math.abs(z);
        for (var i=0; i < vertices.length; i+=3)
        {
            vertices[i+2] += z;
        }
    }
    
    var stl = "";
    stl += "solid " + name + "\r\n";
    for (var v=0, n=0; v < vertices.length && n < normals.length; v+=9, n+=9) // one normal per face
    {
    stl += "   facet normal " + normals[n].toExponential() + " " + normals[n+1].toExponential() + " " + normals[n+2].toExponential() + "\r\n";
    stl += "      outer loop\r\n";
    stl += "         vertex " + vertices[v  ].toExponential() + " " + vertices[v+1].toExponential() + " " + vertices[v+2].toExponential() + "\r\n";
    stl += "         vertex " + vertices[v+3].toExponential() + " " + vertices[v+4].toExponential() + " " + vertices[v+5].toExponential() + "\r\n";
    stl += "         vertex " + vertices[v+6].toExponential() + " " + vertices[v+7].toExponential() + " " + vertices[v+8].toExponential() + "\r\n";
    stl += "      endloop\r\n";
    stl += "   end facet\r\n";    
    }
    stl += "endsolid " + name;
    
    var blob = new Blob([stl], {type: "text/plain"});
    saveAs(blob, url);
}

function ExportCommand_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    var resource = container.registry.find(target);
    if (resource)
    {
        container.targetNode = resource;
    }
}


MorphCommand.prototype = new Command();
MorphCommand.prototype.constructor = MorphCommand;

function MorphCommand()
{
    Command.call(this);
    this.className = "Morph";
    this.attrType = eAttrType.Morph;

    this.sourceModel = null;
    this.targetModel = null;
    
    this.source = new StringAttr("");
    this.morphIncr = new NumberAttr(0.1);
    
    this.source.addModifiedCB(MorphCommand_SourceModifiedCB, this);
    this.target.addModifiedCB(MorphCommand_TargetModifiedCB, this);

    this.registerAttribute(this.source, "source");
    this.registerAttribute(this.morphIncr, "morphIncr");
}

MorphCommand.prototype.execute = function()
{
    if (this.sourceModel && this.targetModel)
    {
        var connectionMgr = this.registry.find("ConnectionMgr");
        if (connectionMgr)
        {
            connectionMgr.connectModelsToMorph(this.sourceModel, this.targetModel, this.morphIncr.getValueDirect());
        }    
    }
}

function MorphCommand_SourceModifiedCB(attribute, container)
{
    var source = attribute.getValueDirect().join("");
    var resource = container.registry.find(source);
    if (resource)
    {
        container.sourceModel = resource;
    }
}

function MorphCommand_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    var resource = container.registry.find(target);
    if (resource)
    {
        container.targetModel = resource;
    }
}

SnapToCommand.prototype = new Command();
SnapToCommand.prototype.constructor = SnapToCommand;

function SnapToCommand()
{
    Command.call(this);
    this.className = "SnapTo";
    this.attrType = eAttrType.SnapTo;

    this.models = new SnapModelDescriptors();

    this.registerAttribute(this.models, "models");
    
    this.numResponses.setValueDirect(0);
}

SnapToCommand.prototype.execute = function()
{
    var i;
    var models = [];
    
    for (i = 0; i < this.models.Size(); i++)
    {
        var modelDesc = this.models.getAt(i);
        var model = this.registry.find(modelDesc.name.getValueDirect().join(""));
        if (model)
        {
            var position = modelDesc.position.getValueDirect();
            model.position.setValueDirect(position.x, position.y, position.z);
            
            var quaternion = modelDesc.quaternion.getValueDirect();
            model.quaternion.setValueDirect(quaternion);
            
            model.updateSimpleTransform();
            model.updateCompoundTransform();
            
            models.push(model);
        }
    }
    
    var snapMgr = this.registry.find("SnapMgr");
    snapMgr.resnap(models);
}
SnapMgr.prototype = new AttributeContainer();
SnapMgr.prototype.constructor = SnapMgr;

function SnapMgr()
{
    AttributeContainer.call(this);
    this.className = "SnapMgr";

    this.name = new StringAttr("SnapMgr");

    this.registerAttribute(this.name, "name");
}

SnapMgr.prototype.snapGenericToGeneric = function(snapper, snappee, snapperConnector, snappeeConnector)
{
    // set rotation
    var matrix = new Matrix4x4();
    
    // rotate so that normals are coincident; do this by rotating angle between
    // the normals degrees about the cross product of the normals
    var snappeeNormal = snappeeConnector.getAttribute("normal").getValueDirect();
    snappeeNormal = new Vector3D(snappeeNormal.x, snappeeNormal.y, snappeeNormal.z);
    snappeeNormal.normalize();

    var snapperNormal = snapperConnector.getAttribute("normal").getValueDirect();
    snapperNormal = new Vector3D(snapperNormal.x, snapperNormal.y, snapperNormal.z);
    snapperNormal.normalize();

    var cross = crossProduct(snappeeNormal, snapperNormal);
    var cosAngle = cosineAngleBetween(snappeeNormal, snapperNormal);
    var angleBetween = 180 - toDegrees(Math.acos(cosAngle));
    if (angleBetween > 0)
    {
        var rotationMatrix = new Matrix4x4();
        rotationMatrix.loadRotation(cross.x, cross.y, cross.z, angleBetween);

        matrix = rotationMatrix;
    }

    // set position

    // get positions of points to connect 
    var point1, point2;
    point1 = snapperConnector.getAttribute("point").getAttribute("center").getValueDirect();
    point1 = matrix.transform(point1.x, point1.y, point1.z, 1);
    point2 = snappeeConnector.getAttribute("point").getAttribute("center").getValueDirect();
    
    var translationMatrix = new Matrix4x4();
    translationMatrix.loadTranslation(point2.x - point1.x, point2.y - point1.y, point2.z - point1.z);
    matrix = matrix.multiply(translationMatrix);
    
    snapperConnector.getAttribute("connected").setValueDirect(true);
    snappeeConnector.getAttribute("connected").setValueDirect(true);
    
    // perform snap
    var snapped = this.snap(snapper, snappee, matrix);
    
    return snapped;
}

SnapMgr.prototype.snapPlugToSocket = function(plug, socket, plugConnector, socketConnector)
{
    // set rotation
    var matrix = new Matrix4x4();
    
    // rotate so that normals are coincident; do this by rotating angle between
    // the normals degrees about the cross product of the normals
    var socketNormal = socketConnector.getAttribute("normal").getValueDirect();
    socketNormal = new Vector3D(socketNormal.x, socketNormal.y, socketNormal.z);
    socketNormal.normalize();

    var plugNormal = plugConnector.getAttribute("normal").getValueDirect();
    plugNormal = new Vector3D(plugNormal.x, plugNormal.y, plugNormal.z);
    plugNormal.normalize();

    var cross = crossProduct(socketNormal, plugNormal);
    var cosAngle = cosineAngleBetween(socketNormal, plugNormal);
    var angleBetween = 180 - toDegrees(Math.acos(cosAngle));
    if (angleBetween > 0)
    {
        var rotationMatrix = new Matrix4x4();
        rotationMatrix.loadRotation(cross.x, cross.y, cross.z, angleBetween);

        matrix = rotationMatrix;
    }

    // line up the unconnected slot; do this by rotating the angle between the
    // remaining slot (socket unconnected - connected) and
    // (plug unconnected - connected) about the socket normal
    var pin1 = plugConnector.getAttribute("pin1").getAttribute("center").getValueDirect();
    var slot1 = socketConnector.getAttribute("slot1").getAttribute("center").getValueDirect();
    var pin2 = plugConnector.getAttribute("pin2").getAttribute("center").getValueDirect();
    var slot2 = socketConnector.getAttribute("slot2").getAttribute("center").getValueDirect();

    pin1 = matrix.transform(pin1.x, pin1.y, pin1.z, 1);
    pin2 = matrix.transform(pin2.x, pin2.y, pin2.z, 1);

    var pinToPin, slotToSlot;
    switch (socketConnector.slot)
    {
        case 1:
            pinToPin = new Vector3D(pin2.x - pin1.x, pin2.y - pin1.y, pin2.z - pin1.z);
            slotToSlot = new Vector3D(slot2.x - slot1.x, slot2.y - slot1.y, slot2.z - slot1.z);
            break;

        case 2:
            pinToPin = new Vector3D(pin1.x - pin2.x, pin1.y - pin2.y, pin1.z - pin2.z);
            slotToSlot = new Vector3D(slot1.x - slot2.x, slot1.y - slot2.y, slot1.z - slot2.z);
            break;

        default:
            return;
    }

    cosAngle = cosineAngleBetween(pinToPin, slotToSlot);
    angleBetween = toDegrees(Math.acos(cosAngle));
    if (angleBetween > 0)
    {
        var rotationMatrix = new Matrix4x4();
        rotationMatrix.loadRotation(plugNormal.x, plugNormal.y, plugNormal.z, angleBetween);

        matrix = matrix.multiply(rotationMatrix);
    }

    // set position

    // get positions of pin and slot to connect 
    var pin, slot;
    switch (socketConnector.slot)
    {
        case 1:
            pin = plugConnector.getAttribute("pin1").getAttribute("center").getValueDirect();
            slot = socketConnector.getAttribute("slot1").getAttribute("center").getValueDirect();
            break;

        case 2:
            pin = plugConnector.getAttribute("pin2").getAttribute("center").getValueDirect();
            slot = socketConnector.getAttribute("slot2").getAttribute("center").getValueDirect();
            break;

        default:
            return;
    }
    pin = matrix.transform(pin.x, pin.y, pin.z, 1);
    
    var translationMatrix = new Matrix4x4();
    translationMatrix.loadTranslation(slot.x - pin.x, slot.y - pin.y, slot.z - pin.z);
    matrix = matrix.multiply(translationMatrix);
    
    plugConnector.getAttribute("connected").setValueDirect(true);
    socketConnector.getAttribute("connected").setValueDirect(true);
    
    // perform snap
    var snapped = this.snap(plug, socket, matrix);
    
    return snapped;
}

SnapMgr.prototype.snap = function(snapper, snappee, matrix)
{
    // if snappee is not a SnapModel, create one and snap snappee onto it first
    if (snappee.attrType != eAttrType.SnapModel)
    {
        var factory = this.registry.find("AttributeFactory");
        var snapModel = factory.create("SnapModel");
        factory.finalize("Model", snapModel);
        snapModel.synchronize(snappee, true);
        // don't copy vertices/snapConnectors
        snapModel.vertices.setValueDirect(new Array());
        snapModel.genericConnectors.clear();
        snapModel.plugConnectors.clear();
        snapModel.socketConnectors.clear();
        // set name
        var name = "CompoundModel_" + snapModel.__nodeId__;
        snapModel.name.setValueDirect(name);
        // enable physics
        snapModel.physicsEnabled.setValueDirect(true);
        // update transforms
        snapModel.updateSimpleTransform();
        snapModel.updateCompoundTransform();
        
        snapModel.snap(snappee, new Matrix4x4());
        snappee.getParent(0).addChild(snapModel);
        snappee = snapModel;
    }
    
    if (snapper.attrType == eAttrType.SnapModel)
    {
        // snap snapper's snaps onto snappee
        var snaps = snapper.snaps;
        
        // remove snapper first
        snapper.getParent(0).removeChild(snapper);
        // remove from registry
        this.registry.unregister(snapper);
        // delete
        //snapper.destroy();
        
        // snap snapper's snaps
        for (var i in snaps)
        {
            if (snaps[i])
            {
                this.snap(snaps[i].model, snappee, snaps[i].matrix.multiply(matrix));
            }
        }
    }
    else // simple model (not a SnapModel)
    {
        snappee.snap(snapper, matrix);
    }
    
    return snappee;
}

SnapMgr.prototype.resnap = function(models)
{
    var i, j;
    var rootSnaps = [];
    
    var snapModels = [];
    for (i = 0; i < models.length; i++)
    {
        snapModels.push(null);
    }
    
    for (i = 0; i < models.length; i++)
    {
        if (snapModels[i] != null) continue; // already snapped
        var snapper = models[i];
        
        for (j = 0; j < models.length; j++)
        {
            if (i == j) continue; // don't test model against itself          
            var snappee = snapModels[j] ? snapModels[j] : models[j];
            
            var snapped = this.trySnap(snapper, snappee);
            if (snapped)
            {
                snapModels[i] = snapped;
                snapModels[j] = snapped;
                // if snappee is a snapModel, remove from root-level snapped shapes, because it
                // is now a part of snapped
                for (k = 0; k < rootSnaps.length; k++)
                {
                    if (rootSnaps[k] == snappee)
                    {
                        rootSnaps.splice(k, 1);
                        break;
                    }
                }
                rootSnaps.push(snapped);
                break;
            }
        }
    }
    
    // recurse on root-level snapped shapes
    if (rootSnaps.length > 1)
    {
        this.resnap(rootSnaps);
    }
}

SnapMgr.prototype.trySnap = function(snapper, snappee)
{
    var i, j;
    
    if (snapper.snapEnabled.getValueDirect() == false ||
        snappee.snapEnabled.getValueDirect() == false)
        return null;

    // if the snapper is a SnapModel, and the snappee is not a SnapModel, swap (simplifies connection)
    if (snapper.attrType == eAttrType.SnapModel &&
        snappee.attrType != eAttrType.SnapModel)
    {
        var temp = snapper;
        snapper = snappee;
        snappee = temp;
    }
        
    var snapperMatrix = snapper.sectorTransformCompound;
    var snappeeMatrix = snappee.sectorTransformCompound;
    
    // generics
    var snapperGenerics = snapper.genericConnectors;
    var snappeeGenerics = snappee.genericConnectors;
    for (i = 0; i < snapperGenerics.Size(); i++)
    {
        var snapperGeneric = snapperGenerics.getAt(i);
        if (snapperGeneric.connected.getValueDirect() == true) continue;
        
        for (j = 0; j < snappeeGenerics.Size(); j++)
        {
            var snappeeGeneric = snappeeGenerics.getAt(j);
            if (snappeeGeneric.connected.getValueDirect() == true) continue;
            if (snapperGeneric.type.getValueDirect().join("") != snappeeGeneric.type.getValueDirect().join("")) continue; // only test same types
            
            if (snapperGeneric.collides(snappeeGeneric, snapperMatrix, snappeeMatrix))
            {
                return this.snapGenericToGeneric(snapper, snappee, snapperGeneric, snappeeGeneric);
            }
        }
    }
    
    // plugs/sockets
    // TODO: might need to test snapper's sockets to snappee's plugs (?)
    var snapperPlugs = snapper.plugConnectors;
    var snappeeSockets = snappee.socketConnectors;
    for (i = 0; i < snapperPlugs.Size(); i++)
    {
        var snapperPlug = snapperPlugs.getAt(i);
        if (snapperPlug.connected.getValueDirect() == true) continue;
        
        for (j = 0; j < snappeeSockets.Size(); j++)
        {
            var snappeeSocket = snappeeSockets.getAt(j);
            if (snappeeSocket.connected.getValueDirect() == true) continue;
            if (snapperPlug.type.getValueDirect().join("") != snappeeSocket.type.getValueDirect().join("")) continue; // only test same types
            
            if ((snappeeSocket.slot = snapperPlug.collides(snappeeSocket, snapperMatrix, snappeeMatrix)) > 0)
            {
                return this.snapPlugToSocket(snapper, snappee, snapperPlug, snappeeSocket);
            }
        }
    }
    
    return null;
}

SnapMgr.prototype.serialize = function()
{
    var i;
    var serialized = "";
    
    var factory = this.registry.find("AttributeFactory");
    var serializer = factory.create("Serializer");
    var xmlSerializer = new XMLSerializer();
    var context = new Context();
        
    // get snapped models
    var snapped = this.registry.getByType(eAttrType.SnapModel);
    if (snapped)
    {    
        for (i = 0; i < snapped.length; i++)
        {
            var snapTo = new SnapToCommand();
            var descriptors = snapped[i].getSnapped();

            snapTo.models.synchronize(descriptors, false);

            // serialize
            context.attribute = snapTo;
            serializer.serialize(context.attribute, context.item, context.attributeName, context.container);
            serialized += xmlSerializer.serializeToString(serializer.DOM);
        }
    }
    
    return serialized;
}
// TODO
var eLWObjectTokens = 
{
    COLR    : 1129270354,
    DIFF    : 1145652806,
    LUMI    : 1280658761,
    SPEC    : 1397769539,
    TRAN    : 1414676814
};

function LWO2BlockData()
{
    this.type = "";
    this.ordinal = "";
    this.channel = 0;
    this.enable = 1;
    this.opacityType = 7;
    this.opacity = 1;
    this.opacityEnvelope = 0;
    this.negative = 0;
    this.center = new Vector3D();
    this.size = new Vector3D();
    this.coordSys = 0;
    this.projMode = 0;
    this.axis = 0;
    this.imageIndex = 0;
    this.widthWrap = 1;
    this.heightWrap = 1;
    this.widthWrapAmt = 0;
    this.heightWrapAmt = 0;
    this.uvMapName = "";
}

function LWO2SurfaceData()
{
    this.name = "";
    this.source = "";
    this.color = new Vector3D();
    this.diffuseLevel = 1;
    this.specularLevel = 0;
    this.luminosityLevel = 0;
    this.transparencyLevel = 0;
    this.glossiness = 0.4;
    this.doubleSided = false;
    this.smoothingAngle = 0;  
    this.blocks = [];
    this.addBlock = function()
    {
        this.blocks.push(new LWO2BlockData());
    }
    this.currentBlock = function()
    {
        return this.blocks.length > 0 ? this.blocks[this.blocks.length-1] : null;
    }
}

function LWO2ClipData()
{
    this.type = 0;
    this.negative = 0;
    
    var filename = "";
    var platformNeutralFilename = "";
    this.setPlatformNeutralFilename = function(_filename)
    {
        platformNeutralFilename = _filename;
        filename = _filename;
        if (filename.indexOf(':') >= 0)
        {
            var split = new Array();
            split = filename.split(':');
            filename = split[0] + ':' + '/' + split[1];
        }
    }
    this.setFilename = function(_filename)
    {
        filename = _filename;
        platformNeutralFilename = _filename;
        // check that filename is not in platform neutral format
        var pos = filename.indexOf(':');
        if (pos >= 0)
        {
            if (filename.charAt(pos+1) != '/' && filename.charAt(pos+1) != '\\')
            {
                var split = new Array();
                split = filename.split(':');
                filename = split[0] + ':' + '/' + split[1];
            }
        }
        // check that platform neutral filename is in platform neutral format
        pos = platformNeutralFilename.indexOf(':');
        if (pos >= 0)
        {
            if (platformNeutralFilename.charAt(pos+1) == '/' || platformNeutralFilename.charAt(pos+1) == '\\')
            {
                var split = new Array();
                split = platformNeutralFilename.split(':');
                platformNeutralFilename = split[0] + ':' + split[1].substr(1, split[1].length);
            }
        }
        this.getPlatformNeutralFilename = function()
        {
            return platformNeutralFilename;
        }
        this.getFilename = function()
        {
            return filename;
        }
    }
}

function LWO2EnvelopeData()
{
    this.userFormat = 0;
    this.type = 0;
    this.preBehavior = 0;
    this.postBehavior = 0;
    this.keyframes = [];
    
    this.currentKyframe = function()
    {
        return this.keyframes.length > 0 ? this.keyframes[this.keyframes.length-1] : null;
    }
}

function LWO2VMAPData()
{
    this.vertex = 0;
    this.u = 0;
    this.v = 0;
}

function LWO2VMADData()
{
    this.poly = 0;
    this.vertex = 0;
    this.u = 0;
    this.v = 0;
}

function LWO2PTAGData()
{
    this.poly = 0;
    this.tag = 0;
}

function LWO2LayerData()
{
    this.number = 0;
    this.name = "";
    this.pnts = [];
    this.pols = [];
    this.ptagsSURF = [];
    this.vmapsTXUV = [];
    this.vmadsTXUV = [];
    this.ptagsSURFMaxIndex = 0;
    this.pivot = new Vector3D();
    
    this.getVmap = function(type, name)
    {
        switch (type)
        {
            case 'TXUV':
                return this.vmapsTXUV[name];
                break;
            
            default: 
                return null;
        }
    }
    
    this.putVmap = function(type, name, vmap)
    {
        switch (type)
        {
            case 'TXUV':
                if (this.vmapsTXUV[name] == undefined) 
                    this.vmapsTXUV[name] = []
                this.vmapsTXUV[name].push(vmap);
                break;
        }
    }
    
    this.getVmad = function(type, name)
    {
        switch (type)
        {
            case 'TXUV':
                return this.vmadsTXUV[name];
                break;
            
            default: 
                return null;
        }
    }
    
    this.putVmad = function(type, name, vmad)
    {
        switch (type)
        {
            case 'TXUV':
                if (this.vmadsTXUV[name] == undefined) 
                    this.vmadsTXUV[name] = []
                this.vmadsTXUV[name].push(vmad);
                break;
        }
    }
    
    this.putPtag = function(ptag)
    {
        this.ptagsSURF.push(ptag);
    }
}

function LWO2Data()
{
    this.name = "";
    this.contentDir = "";
    this.layers = [];
    this.tags = [];
    this.surfaces = [];
    this.clips = [];
    this.envelopes = [];
    this.subChunkContext = "";
    this.evaluators = [];
    
    var currentClip = null;
    var currentEnvelope = null;
    var currentLayer = null;
    this.addLayer = function(number)
    {
        var layer = new LWO2LayerData();
        layer.number = number;
        if (this.layers.length <= number)
        {
            this.layers.length = number + 1;
        }
        this.layers[number] = layer;
        currentLayer = layer;
    }
    this.currentLayer = function()
    {
        return currentLayer;
    }
    this.addSurface = function(name, source)
    {
        var surface = new LWO2SurfaceData();
        surface.name = name;
        surface.source = source;
        this.surfaces.push(surface);
    }
    this.currentSurface = function()
    {
        return this.surfaces.length > 0 ? this.surfaces[this.surfaces.length-1] : null;
    }
    this.getSurface = function(name)
    {
        for (var i=0; i < this.surfaces.length; i++)
        {
            if (this.surfaces[i].name == name)
            {
                return this.surfaces[i];
            }
        }
        return null;
    }
    this.addClip = function(index)
    {
        var clip = new LWO2ClipData();
        if (this.clips.length <= index)
        {
            this.clips.length = index + 1;
        }
        this.clips[index] = clip;
        currentClip = clip;
    }
    this.currentClip = function()
    {
        return currentClip;
    }
    this.addEnvelope = function(index)
    {
        var envelope = new LWO2EnvelopeData();
        this.envelopes[index] = envelope;
        currentEnvelope = envelope;
    }
    this.currentEnvelope = function()
    {
        return currentEnvelope;
    }
}

LWObjectHandler.prototype = new ContentHandler();
LWObjectHandler.prototype.constructor = LWObjectHandler;

function LWObjectHandler()
{
    ContentHandler.call(this);
    this.className = "LWObjectHandler";
    
    this.lwo2DataHandlers = [];
    this.lwo2DataHandlersData = [];
}

LWObjectHandler.prototype.addObjectHandler = function(handler, data)
{
    this.lwo2DataHandlers.push(handler);
    this.lwo2DataHandlersData.push(data);
}

LWObjectHandler.prototype.parseFileStream = function(url)
{
    var filename = formFullPath(url, this.contentDirectory.getValueDirect().join(""));
    var filestream = loadBinaryResource(filename);
    if (filestream == null)
    {
        return -2;
    }

    var parser = new BinaryParser(filestream, true);

    // read file tag (must be 'FORM')
    if (parser.readUInt8() != 70 || // 'F'
    parser.readUInt8() != 79 || // 'O'
    parser.readUInt8() != 82 || // 'R'
    parser.readUInt8() != 77)   // 'M'
    {
        return -1;
    }

    // read file size
    var fileSize = parser.readUInt32();

    // read file type (must be 'LWO2')
    if (parser.readUInt8() != 76 || // 'L'
    parser.readUInt8() != 87 || // 'W'
    parser.readUInt8() != 79 || // 'O'
    parser.readUInt8() != 50)   // '2'
    {
        return -1;
    }
    fileSize -= 4; // subtract these 4 bytes from the file size

    var data = new LWO2Data();
    data.contentDir = this.contentDirectory.getValueDirect().join("");

    // set the model name (filename w/o extension)
    var lastSlash = url.lastIndexOf("/");
    var extension = url.lastIndexOf(".");
    data.name = url.substring(lastSlash+1, extension);

    // read file chunks into LWOData
    while (fileSize > 0)
    {
        fileSize -= this.parseChunk(parser, data);
    }

    // pass data to consumer(s)
    for (var i = 0; i < this.lwo2DataHandlers.length; i++)
    {
        this.lwo2DataHandlers[i](data, this.lwo2DataHandlersData[i]);
    }

    return 0;
}

LWObjectHandler.prototype.parseChunk = function(parser, data)
{
    var bytesRead = 0;
    
    // ASSUMPTION MADE:  file stream pointer is currently sitting at a tag
    // i.e., has been advanced past header.

    // read chunk tag
    var tag = parser.readUInt32(); // bytesRead accounted for at end of method
    //alert("tag: " + tag);
    
    // read chunk size
    var chunkSize = parser.readUInt32(); // bytesRead accounted for at end of method
    //alert("chunkSize: " + chunkSize);
    
    // read chunk size bytes
    switch (tag)
    {
        case 1279351122: // 'LAYR'
            {
                var number = parser.readUInt16(); bytesRead += 2;
            
                var flags = parser.readUInt16(); bytesRead += 2;

                var x = parser.readFloat32(); bytesRead += 4;
                var y = parser.readFloat32(); bytesRead += 4;
                var z = parser.readFloat32(); bytesRead += 4;
            
                var name = this.readString(parser); bytesRead += name.bytesRead;
            
                if (chunkSize > bytesRead)
                {
                    var parent = parser.readUInt16(); bytesRead += 2;
                }

                data.addLayer(number);
                data.currentLayer().name = name.string;
                data.currentLayer().pivot.x = x;
                data.currentLayer().pivot.y = y;
                data.currentLayer().pivot.z = z;
            }
            break;
    
        case 1347310675: // 'PNTS'
            {
                var numPnts = chunkSize / 12;

                for (var i=0; i < numPnts; i++)
                {
                    var x = parser.readFloat32(); bytesRead += 4;
                    var y = parser.readFloat32(); bytesRead += 4;
                    var z = parser.readFloat32(); bytesRead += 4; 
            
                    data.currentLayer().pnts[i] = new Vector3D();
                    data.currentLayer().pnts[i].x = x;
                    data.currentLayer().pnts[i].y = y; 
                    data.currentLayer().pnts[i].z = z;                
                }
            }
            break;
    
        case 1347374163: // 'POLS'
            {
                var type = parser.readUInt32(); bytesRead += 4;
            
                var flags, numVerts;
                while (chunkSize > bytesRead)
                {
                    var poly = [];
                
                    flags = parser.readUInt16(); bytesRead += 2;
                    numVerts = flags & 0x03ff;
                    for (var i=0; i < numVerts; i++)
                    {
                        var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                    
                        poly.push(index.index);
                    }
                
                    data.currentLayer().pols.push(poly);
                }
            }
            break;
        
        case 1413564243: // 'TAGS'
            {
                while (chunkSize > bytesRead)
                {
                    var tags = this.readString(parser); bytesRead += tags.bytesRead;
                    data.tags.push(tags.string);
                }
            }
            break;
      		
        case 1347699015: // 'PTAG'
            {
                var type = parser.readUInt32(); bytesRead += 4;
            
                while (chunkSize > bytesRead)
                {
                    var ptag = new LWO2PTAGData();
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                    ptag.poly = index.index;
                    ptag.tag = parser.readUInt16(); bytesRead += 2;
                
                    switch (type)
                    {
                        case 1398100550: // 'SURF'
                            {
                                data.currentLayer().putPtag(ptag);
                                data.currentLayer().ptagsSURFMaxIndex = Math.max(ptag.tag, data.currentLayer().ptagsSURFMaxIndex);
                            }
                            break;
                    }
                }
            }
            break;
    
        case 1447903568: // 'VMAP'
            {
                var type = parser.readUInt32(); bytesRead += 4;
                var dimension = parser.readUInt16(); bytesRead += 2;
                var name = this.readString(parser); bytesRead += name.bytesRead;
            
                var u, v, value;
                while (chunkSize > bytesRead)
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead; 
                
                    switch (type)
                    {
                        case 1415075158: // 'TXUV'
                            {
                                u = parser.readFloat32(); bytesRead += 4;
                                v = parser.readFloat32(); bytesRead += 4;
                        
                                var vmapData = new LWO2VMAPData();
                                vmapData.vertex = index.index;
                                vmapData.u = u;
                                vmapData.v = v;
                                data.currentLayer().putVmap('TXUV', name.string, vmapData);
                            }
                            break;
                    
                        default:
                            {
                                for (var i=0; i < dimension; i++)
                                {
                                    value = parser.readFloat32(); bytesRead += 4;       
                                }
                            }
                            break;    
                    }
                }
            }
            break;
        
        case 1447903556: // 'VMAD'
            {
                var type = parser.readUInt32(); bytesRead += 4;
                var dimension = parser.readUInt16(); bytesRead += 2;
                var name = this.readString(parser); bytesRead += name.bytesRead;
            
                var u, v, value;
                while (chunkSize > bytesRead)
                {
                    var vertIndex = this.readVariableLengthIndex(parser); bytesRead += vertIndex.bytesRead;
                    var polyIndex = this.readVariableLengthIndex(parser); bytesRead += polyIndex.bytesRead;
                
                    switch (type)
                    {
                        case 1415075158: // 'TXUV'
                            {
                                u = parser.readFloat32(); bytesRead += 4;
                                v = parser.readFloat32(); bytesRead += 4;
                        
                                var vmadData = new LWO2VMADData();
                                vmadData.vertex = vertIndex.index;
                                vmadData.poly = polyIndex.index;
                                vmadData.u = u;
                                vmadData.v = v;
                                data.currentLayer().putVmad('TXUV', name.string, vmadData);
                            }
                            break;
                    
                        default:
                            {
                                for (var i=0; i < dimension; i++)
                                {
                                    value = parser.readFloat32(); bytesRead += 4;       
                                }
                            }
                            break;    
                    }       
                }
            }
            break;
        
        case 1398100550: // 'SURF'
            {
                var name = this.readString(parser); bytesRead += name.bytesRead;
                var source = this.readString(parser); bytesRead += source.bytesRead;

                data.addSurface(name.string, source.string);
            
                // parse surface subchunks
                while (chunkSize > bytesRead)
                {
                    bytesRead += this.parseSubChunk(parser, data);
                }
            }
            break;
        
        case 1129072976: // 'CLIP'
            {
                var index = parser.readUInt32(); bytesRead += 4;
            
                data.addClip(index);
                data.subChunkContext = tag;
            
                // parse clip subchunks
                while (chunkSize > bytesRead)
                {
                    bytesRead += this.parseSubChunk(parser, data);
                }
            }
            break;
        
        case 1162761804: // 'ENVL'
            {
                var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
            
                data.addEnvelope(index.index);
            
                // parse envelope subchunks
                while (chunkSize > bytesRead)
                {
                    bytesRead += this.parseSubChunk(parser, data);
                }
            }
            break;
          
        default:
            {
                // unrecognized tag - seek to end of chunk
                while (chunkSize > bytesRead)
                {
                    parser.readUInt8(); bytesRead++;
                }
            }
            break;
    }
    
    // read pad byte if chunk size is odd
    if (chunkSize & 0x1)
    {
        parser.readUInt8(); bytesRead++;
    }
    
    // account for tag/chunk size (read at beginning of method)
    bytesRead += 8;
    //alert("bytesRead: " + bytesRead);
    
    return bytesRead;    
}

LWObjectHandler.prototype.parseSubChunk = function(parser, data)
{
    var bytesRead = 0;

    // read subchunk tag
    var tag = parser.readUInt32(); bytesRead += 4;

    // read subchunk size
    var subChunkSize = parser.readUInt16(); bytesRead += 2;

    // read subchunk size bytes
    switch (tag)
    {
        case 1129270354: // 'COLR'
            {
                data.currentSurface().color.x = parser.readFloat32(); bytesRead += 4;
                data.currentSurface().color.y = parser.readFloat32(); bytesRead += 4;
                data.currentSurface().color.z = parser.readFloat32(); bytesRead += 4;
            
                if (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                }    
            }
            break;
        
        case 1145652806: // 'DIFF'
            {
                data.currentSurface().diffuseLevel = parser.readFloat32(); bytesRead += 4;
            
                if (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                } 
            }
            break;
    
        case 1280658761: // 'LUMI'  
            {
                data.currentSurface().luminosityLevel = parser.readFloat32(); bytesRead += 4;
            
                if (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                }
            }
            break;
        
        case 1397769539: // 'SPEC'
            {
                data.currentSurface().specularLevel = parser.readFloat32(); bytesRead += 4;
            
                if (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                }
            }
            break;
        
        case 1414676814: // 'TRAN'
            {
                data.currentSurface().transparencyLevel = parser.readFloat32(); bytesRead += 4;
            
                if (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                }
            }
            break;
        
        case 1196183379: // 'GLOS'
            {
                data.currentSurface().glossiness = parser.readFloat32(); bytesRead += 4;
            
                if (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                }
            }
            break;
        
        case 1397310533: // 'SIDE'
            {
                data.currentSurface().doubleSided = (parser.readUInt16() == 3 ? true : false); bytesRead += 2;            
            }
            break;
        
        case 1397571918: // 'SMAN'
            {
                data.currentSurface().smoothingAngle = parser.readFloat32(); bytesRead += 4;
            }
            break;
        
        case 1398032716: // 'STIL'
        case 1095649613: // 'ANIM'
        case 1230194001: // 'ISEQ'
            {
                var filename = this.readString(parser); bytesRead += filename.bytesRead;
            
                // skip subsequent chunk data
                while (subChunkSize > (bytesRead - 6))
                {
                    parser.readUInt8(); bytesRead += 1;
                }
            
                data.currentClip().type = tag;
                data.currentClip().setFilename(filename.string);
            }
            break;
        
        case 1313163073: // 'NEGA'
            {
                var negative = parser.readUInt16(); bytesRead += 2;
            
                if (data.subChunkContext == 'IMAP')
                {
                    data.currentSurface().currentBlock().negative = negative;
                }
                else if (data.subChunkContext == 'CLIP')
                {
                    data.currentClip().negative = negative;
                }
            }
            break;
        
        case 1112297291: // 'BLOK'
            {
                data.currentSurface().addBlock();
            }
            break;
        
        case 1229799760: // 'IMAP'
            {
                var ordinal = this.readString(parser); bytesRead += ordinal.bytesRead;
            
                data.currentSurface().currentBlock().type = 'IMAP';
                data.currentSurface().currentBlock().ordinal = ordinal.string;
                data.subChunkContext = 'IMAP';
            }
            break;
        
        case 1128808782: // 'CHAN'
            {
                var channel = parser.readUInt32(); bytesRead += 4;
            
                if (data.subChunkContext == 'IMAP')
                {
                    data.currentSurface().currentBlock().channel = channel;
                }
            }
            break;
        
        case 1162756418: // 'ENAB'
            {
                data.currentSurface().currentBlock().enable = parser.readUInt16(); bytesRead += 2;
            }
            break;
        
        case 1330659651: // 'OPAC'
            {
                data.currentSurface().currentBlock().opacityType = parser.readUInt16(); bytesRead += 2;
                data.currentSurface().currentBlock().opacity = parser.readFloat32(); bytesRead += 4;
            
                if (subChunkSize > (bytesRead - 6))
                {
                    var envelope = this.readVariableLengthIndex(parser); bytesRead += envelope.bytesRead;
                
                    data.currentSurface().currentBlock().opacityEnvelope = envelope.index;
                }
            }
            break;
        
        case 1414349136: // 'TMAP'
            {
            }
            break;
         
        case 1129206866: // 'CNTR'
            {
                data.currentSurface().currentBlock().center.x = parser.readFloat32(); bytesRead += 4;
                data.currentSurface().currentBlock().center.y = parser.readFloat32(); bytesRead += 4;
                data.currentSurface().currentBlock().center.z = parser.readFloat32(); bytesRead += 4;
            
                while (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                }
            }
            break;
        
        case 1397316165: // 'SIZE'
            {
                data.currentSurface().currentBlock().size.x = parser.readFloat32(); bytesRead += 4;
                data.currentSurface().currentBlock().size.y = parser.readFloat32(); bytesRead += 4;
                data.currentSurface().currentBlock().size.z = parser.readFloat32(); bytesRead += 4;
            
                while (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                }
            }
            break;
        
        case 1129535827: // 'CSYS'
            {
                data.currentSurface().currentBlock().coordSys = parser.readUInt16(); bytesRead += 2;
            }
            break;
        
        case 1347571530: // 'PROJ'
            {
                data.currentSurface().currentBlock().projMode = parser.readUInt16(); bytesRead += 2;
            }
            break;
        
        case 1096304979: // 'AXIS'
            {
                var axis = parser.readUInt16(); bytesRead += 2;
            
                if (data.subChunkContext == 'IMAP')
                {
                    data.currentSurface().currentBlock().axis = axis;
                }
            }
            break;
        
        case 1229799751: // 'IMAG'
            {
                var image = this.readVariableLengthIndex(parser); bytesRead += image.bytesRead;
            
                data.currentSurface().currentBlock().imageIndex = image.index;
            }
            break;
        
        case 1465008464: // 'WRAP'
            {
                data.currentSurface().currentBlock().widthWrap = parser.readUInt16(); bytesRead += 2;
                data.currentSurface().currentBlock().heightWrap = parser.readUInt16(); bytesRead += 2;
            }
            break;
        
        case 1465012311: // 'WRPW'
            {
                data.currentSurface().currentBlock().widthWrapAmt = parser.readFloat32(); bytesRead += 4;
            
                if (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                }
            }
            break;
        
        case 1465012296: // 'WRPH'
            {
                data.currentSurface().currentBlock().heightWrapAmt = parser.readFloat32(); bytesRead += 4;
            
                if (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                }
            }
            break;
        
        case 1447903568: // 'VMAP'
            {
                var name = this.readString(parser); bytesRead += name.bytesRead;
            
                data.currentSurface().currentBlock().uvMapName = name.string; 
            }
            break;
        
        case 1415139397: // 'TYPE'
            {
                data.currentEnvelope().userFormat = parser.readUInt8(); bytesRead += 1;
                data.currentEnvelope().type = parser.readUInt8(); bytesRead += 1;
            }
            break;
        
        case 1347568928: // 'PRE '
            {
                data.currentEnvelope().preBehavior = parser.readUInt16(); bytesRead += 2;
            }
            break;
        
            //case 1262836000: // 'KEY '
            {
                // TODO        
            }
            break;
       
            //case 1397768526: // 'SPAN'
            {
                // TODO
                //case 1413693984: // 'TCB '
                //case 1212502605: // 'HERM'
                //case 1111841353: // 'BEZI'
                //case 1111841330: // 'BEZ2'
                //case 1398031696: // 'STEP'
                //case 1279872581: // 'LINE'
            }
            break;
        
        case 1347375956: // 'POST'
            {
                data.currentEnvelope().postBehavior = parser.readUInt16(); bytesRead += 2;
            }
            break;

        default:
            {
                // unrecognized tag - seek to end of chunk
                while (subChunkSize > (bytesRead - 6))
                {
                    parser.readUInt8(); bytesRead += 1;
                }
            }
            break;
    }
    
    // read pad byte if subchunk size is odd
    if (subChunkSize & 0x1)
    {
        parser.readUInt8(); bytesRead += 1;
    }
    
    return bytesRead;
}

LWObjectHandler.prototype.readString = function(parser)
{
    var s = "";
    var c = 0;
    var count = 0;
    do
    {
        c = parser.readUInt8(); count++;
        s += String.fromCharCode(c);
        
    } while (c);
    
    // read pad byte if length is odd
    if (count & 0x1)
    {
        parser.readUInt8(); count++;   
    }
    
    return { string: s, bytesRead: count };
}

LWObjectHandler.prototype.readVariableLengthIndex = function(parser)
{
    var i = 0;
    var c = new Array(4);
    var count = 0;
    
    c[0] = parser.readUInt8(); count++;
    c[1] = parser.readUInt8(); count++;
    
    if (c[0] < 0xff00) // 2-byte form
    {
        i = c[0] << 8 | c[1];
    }
    else // 4-byte form
    {
        c[2] = parser.readUInt8(); count++;
        c[3] = parser.readUInt8(); count++;
        
        i = c[1] << 16 | c[2] << 8 | c[3];
    }

    return { index: i, bytesRead: count };
}

LWObjectHandler.prototype.matchesType = function(type)
{
    return (type == "lwo");
}
LWObjectBuilder.prototype = new ContentBuilder();
LWObjectBuilder.prototype.constructor = LWObjectBuilder;

function LWObjectBuilder()
{
    ContentBuilder.call(this);
    this.className = "LWObjectBuilder";
    
    this.graphMgr = null;
    
    this.indexGeometry = new BooleanAttr(true);
    
    this.registerAttribute(this.indexGeometry, "indexGeometry");
}

LWObjectBuilder.prototype.visitHandler = function(handler)
{
    handler.addObjectHandler(LWObjectBuilder_ObjectHandler, this);
}

LWObjectBuilder.prototype.finalize = function()
{
}

LWObjectBuilder.prototype.matchesType = function(type)
{
    return (type == "lwo");
}

LWObjectBuilder.prototype.allocateModel = function(data)
{
    var model = null;
    var layer = this.layer;
    if (layer == 0)
    {
        for (var i=0; i < data.layers.length; i++)
        {
            // allocate model if necessary (otherwise use the model passed to the builder)
            if (!this.models[0])
            {
                var factory = this.registry.find("AttributeFactory");
                model = factory.create("Model");
                this.models.push(model);
            }
            else model = this.models[0];

            // TODO: matching model/replace model surfaces

            // define model attributes
            this.describeModel(data, data.layers[i], model);
        }
    }
    else if (layer <= data.layers.length) // layer > 0
    {
        // allocate model if necessary (otherwise use the model passed to the builder)
        if (!this.models[0])
        {
            var factory = this.registry.find("AttributeFactory");
            model = factory.create("Model");
            this.models.push(model);
        }
        else model = this.models[0];
        
        // TODO: matching model/replace model surfaces

        // define model attributes
        this.describeModel(data, data.layers[layer-1], model);
    }
}

LWObjectBuilder.prototype.describeModel = function(data, layer, model)
{
    var factory = this.registry.find("AttributeFactory");
    
    // set name if not already set by scene
    var name = model.getAttribute("name");
    if (name.modificationCount == 0)
    {
        var layerName = data.name;
        if (data.layers.length > 1)
        {
            layerName += ":Layer" + this.layer;
        }
        name.setValueDirect(layerName);
    }
    
    // set pivot if not already set by scene
    var pivot = model.getAttribute("pivot");
    if (pivot.modificationCount == 0)
    {
        pivot.setValue(layer.pivot.v());
    }

    // build list of tri, line, and point poly indices indexed by surface number
    var numSurfaces = layer.ptagsSURFMaxIndex + 1;
    var triPolys = new Array(numSurfaces);
    var linePolys = new Array(numSurfaces);
    var pointPolys = new Array(numSurfaces);
    var NPolys = new Array(numSurfaces);
    for (var i = 0; i < numSurfaces; i++)
    {
        triPolys[i] = [];
        linePolys[i] = [];
        pointPolys[i] = [];
        NPolys[i] = [];
    }

    var polyIndex, surfIndex;
    var numPtagsSURF = layer.ptagsSURF.length;
    for (var ptag = 0; ptag < numPtagsSURF; ptag++)
    {
        polyIndex = layer.ptagsSURF[ptag].poly;
        surfIndex = layer.ptagsSURF[ptag].tag;

        switch (layer.pols[polyIndex].length)
        {
            case 3: triPolys[surfIndex].push(polyIndex); break;
            case 2: linePolys[surfIndex].push(polyIndex); break;
            case 1: pointPolys[surfIndex].push(polyIndex); break;
            default: NPolys[surfIndex].push(polyIndex); break;
        }
    }

    // create surfaces for geometry
    var surfaces = new Array(numSurfaces);
    for (var surfIndex = 0; surfIndex < numSurfaces; surfIndex++)
    {
        surfaces[surfIndex] = this.allocateSurface(data, layer, surfIndex);

        // add surface to model (model will target surface and set its color to the surface)
        model.addSurface(surfaces[surfIndex]);
    }

    // create geometry (calculate polygon normals for tris)
    var vertexPolyNormals = [];
    var vertexNormals = [];
    var vertexOrder = [];
    var vertexMinMax = [];
    var polyOrder = [];
    var triLists = [];
    var triVertices = [];
    var triPolyNormals = [];
    var leg1 = new Vector3D();
    var leg2 = new Vector3D();
        
    vertexPolyNormals.length = layer.pnts.length;
    for (var i = 0; i < vertexPolyNormals.length; i++)
    {
        vertexPolyNormals[i] = [];
    }
    vertexNormals.length = numSurfaces;
    vertexOrder.length = numSurfaces;
    vertexMinMax.length = numSurfaces;
    polyOrder.length = numSurfaces;
    triLists.length = numSurfaces;
    triVertices.length = numSurfaces;
    triPolyNormals.length = numSurfaces;

    for (var surfIndex = 0; surfIndex < surfaces.length; surfIndex++)
    {
        var vertices = [];
        var normals = [];
        var surfacePnts = []; // for setting surface's layer vertices to surface
        vertexNormals[surfIndex] = []
        vertexOrder[surfIndex] = [];
        vertexMinMax[surfIndex] = new Pair();
        vertexMinMax[surfIndex].first = vertexMinMax[surfIndex].second = 0;
        polyOrder[surfIndex] = [];
        triPolyNormals[surfIndex] = [];

        // N-polys (triangulate then add to tris list)
        var polys = NPolys[surfIndex];
        var numPolys = polys.length;
        for (var polyIndex = 0; polyIndex < numPolys; polyIndex++)
        {
            var jsmPolygon = new JSM.Polygon();
            var poly = layer.pols[polys[polyIndex]];
            for (var vertex = 0; vertex < poly.length; vertex++)
            {
                var point = layer.pnts[poly[vertex]];
                surfacePnts[poly[vertex]] = point;
                
                vertices.push([point.x, point.y, point.z]);

                jsmPolygon.AddVertex(point.x, point.y, point.z);
            }
           
            var triangles = JSM.PolygonTriangulate(jsmPolygon);
            for (var i=0; i < triangles.length; i++)
            {
                var triPoly = [];
                triPoly.push(poly[triangles[i][0]]);
                triPoly.push(poly[triangles[i][1]]);
                triPoly.push(poly[triangles[i][2]]);
                
                layer.pols.push(triPoly);
                triPolys[surfIndex].push(layer.pols.length-1);
            }
        }

        // tris   
        vertices = [];
        polys = triPolys[surfIndex];
        numPolys = polys.length;
        for (var polyIndex = 0; polyIndex < numPolys; polyIndex++)
        {
            var poly = layer.pols[polys[polyIndex]];
            for (var vertex = 0; vertex < 3; vertex++)
            {
                var point = layer.pnts[poly[vertex]];
                surfacePnts[poly[vertex]] = point;
                
                vertices.push(point.x);
                vertices.push(point.y);
                vertices.push(point.z);

                vertexOrder[surfIndex].push(poly[vertex]);
                vertexMinMax[surfIndex].first = Math.min(poly[vertex], vertexMinMax[surfIndex].first);
                vertexMinMax[surfIndex].second = Math.min(poly[vertex], vertexMinMax[surfIndex].second);
                polyOrder[surfIndex].push(polys[polyIndex]);
            }

            // get vertex indices
            var vertIndex0 = poly[0];
            var vertIndex1 = poly[1];
            var vertIndex2 = poly[2];

            // calculate polygon normal
            var point0 = layer.pnts[vertIndex0];
            var point1 = layer.pnts[vertIndex1];
            var point2 = layer.pnts[vertIndex2];

            leg1.load(point1.x - point0.x,
                      point1.y - point0.y,
                      point1.z - point0.z);

            leg2.load(point2.x - point0.x,
                      point2.y - point0.y,
                      point2.z - point0.z);

            var cross = crossProduct(leg1, leg2);
            cross.normalize();

            normals.push(cross.x)
            normals.push(cross.y);
            normals.push(cross.z);

            normals.push(cross.x)
            normals.push(cross.y);
            normals.push(cross.z);

            normals.push(cross.x)
            normals.push(cross.y);
            normals.push(cross.z);

            vertexNormals[surfIndex].push(new Pair(vertIndex0, cross));
            vertexNormals[surfIndex].push(new Pair(vertIndex1, cross));
            vertexNormals[surfIndex].push(new Pair(vertIndex2, cross));

            vertexPolyNormals[vertIndex0].push(cross);
            vertexPolyNormals[vertIndex1].push(cross);
            vertexPolyNormals[vertIndex2].push(cross);

            triPolyNormals[surfIndex].push(cross);
            triPolyNormals[surfIndex].push(cross);
            triPolyNormals[surfIndex].push(cross);
        }

        if (vertices.length)
        {
            var triList = factory.create("TriList");

            model.addGeometry(triList, vertexOrder[surfIndex], surfaces[surfIndex]);

            triList.getAttribute("vertices").setValue(vertices);
            triList.getAttribute("normals").setValue(normals);

            triLists[surfIndex] = triList;
            triVertices[surfIndex] = vertices;
        }

        // lines
        vertices = [];
        polys = linePolys[surfIndex];
        numPolys = polys.length;
        
        for (var polyIndex = 0; polyIndex < numPolys; polyIndex++)
        {
            var poly = layer.pols[polyIndex];
            if (poly.length < 2) continue;
            
            for (var vertex = 0; vertex < 2; vertex++)
            {
                var point = layer.pnts[poly[vertex]];
                surfacePnts[poly[vertex]] = point;
                
                vertices.push(point.x);
                vertices.push(point.y);
                vertices.push(point.z);
                
            }
        }
        
        if (vertices.length)
        {
            var lineList = factory.create("LineList");

            model.addGeometry(lineList, null, surfaces[surfIndex]);
            
            lineList.getAttribute("vertices").setValue(vertices);
        }
        
        // points
        vertices = [];
        polys = pointPolys[surfIndex];
        numPolys = polys.length;
        
        for (var polyIndex = 0; polyIndex < numPolys; polyIndex++)
        {
            var poly = layer.pols[polyIndex];
            
            var point = layer.pnts[poly[0]];
            surfacePnts[poly[0]] = point;
            
            vertices.push(point.x);
            vertices.push(point.y);
            vertices.push(point.z);
                
        }
        
        if (vertices.length)
        {
            var pointList = factory.create("PointList");

            model.addGeometry(pointList, null, surfaces[surfIndex]);
            
            pointList.getAttribute("vertices").setValue(vertices);
        }
        
        // set surface's layer vertices to surface
        var surfaceVertices = [];
        for (var surfacePnt in surfacePnts)
        {
            surfaceVertices.push(surfacePnts[surfacePnt].x);
            surfaceVertices.push(surfacePnts[surfacePnt].y);
            surfaceVertices.push(surfacePnts[surfacePnt].z);
        }
        surfaces[surfIndex].getAttribute("vertices").setValue(surfaceVertices);
    }

    // calculate smooth normals for tris
    var smoothNormals = [];
    for (var surfIndex = 0; surfIndex < surfaces.length; surfIndex++)
    {
        if (!triLists[surfIndex]) continue;

        var surface = data.getSurface(data.tags[surfIndex]);
        if (!surface) continue;
        
        var smoothingAngle = surface.smoothingAngle;
        if (smoothingAngle <= 0) continue;

        var cosSmoothingAngle = Math.cos(smoothingAngle);

        smoothNormals.length = vertexNormals[surfIndex].length;
        for (var i = 0; i < smoothNormals.length; i++)
        {
            smoothNormals[i] = new Vector3D();
        }

        // for each vertex normal...
        for (var vn = 0; vn < vertexNormals[surfIndex].length; vn++)
        {
            var vertexIndex = vertexNormals[surfIndex][vn].first;
            var vertexNormal = vertexNormals[surfIndex][vn].second;

            // for each polygon normal...
            for (var vpn = 0; vpn < vertexPolyNormals[vertexIndex].length; vpn++)
            {
                var polyNormal = vertexPolyNormals[vertexIndex][vpn];
                var angle = cosineAngleBetween(vertexNormal, polyNormal);
                if (Math.acos(angle) <= smoothingAngle)
                {
                    smoothNormals[vn].x += polyNormal.x;
                    smoothNormals[vn].y += polyNormal.y;
                    smoothNormals[vn].z += polyNormal.z;
                }
            }

            smoothNormals[vn].normalize();
        }

        // arrange smooth normals in array
        var smoothedNormals = [];
        for (var i = 0; i < smoothNormals.length; i++)
        {
            smoothedNormals.push(smoothNormals[i].x);
            smoothedNormals.push(smoothNormals[i].y);
            smoothedNormals.push(smoothNormals[i].z);
        }
        smoothNormals.length = 0;

        triLists[surfIndex].getAttribute("normals").setValue(smoothedNormals);
    }

    // load textures
    for (var surfIndex = 0; surfIndex < surfaces.length; surfIndex++)
    {
        var surfaceData = data.getSurface(surfaces[surfIndex].getAttribute("name").getValueDirect().join(""));
        if (surfaceData)
        {
            var textures = this.loadTextures(data, layer, surfaceData, surfaces[surfIndex]);

            // calculate texture coordinates
            for (var i = 0; i < textures.length; i++)
            {
                var uvCoords = this.calculateTextureCoords(data, layer, textures[i].second, triVertices[surfIndex],
                                                       triPolyNormals[surfIndex], vertexOrder[surfIndex],
                                                       polyOrder[surfIndex]);
                if (uvCoords)
                {
                    triLists[surfIndex].getUVCoords(textures[i].first).setValueDirect(uvCoords);
                }
            }
        }
    }

    // set layer vertices to model
    var layerVertices = new Array(layer.pnts.length * 3);
    for (var layerVertex = 0; layerVertex < layer.pnts.length; layerVertex++)
    {
        layerVertices[layerVertex * 3] = layer.pnts[layerVertex].x;
        layerVertices[layerVertex * 3 + 1] = layer.pnts[layerVertex].y;
        layerVertices[layerVertex * 3 + 2] = layer.pnts[layerVertex].z;
    }
    model.getAttribute("vertices").setValue(layerVertices);
    
    // TODO: index vertices if requested
}

LWObjectBuilder.prototype.allocateSurface = function(data, layer, surfaceNumber)
{
     var factory = this.registry.find("AttributeFactory");
     surface = factory.create("Surface");
     
     var name = data.tags[surfaceNumber];
     surface.getAttribute("name").setValueDirect(name);
     
     this.describeSurface(data.getSurface(name), surface);
     
     return surface;
}

LWObjectBuilder.prototype.describeSurface = function(data, surface)
{
    // TEMPTEST
    if (!data) return;
    
    // color
    var values = [];
    values.push(data.color.x);
    values.push(data.color.y);
    values.push(data.color.z);
    values.push(1);
    surface.getAttribute("color").setValue(values);
    
    // ambient level (use diffuse since ambient level is not specified
    surface.getAttribute("ambientLevel").setValueDirect(data.diffuseLevel);
    
    // diffuse level
    surface.getAttribute("diffuseLevel").setValueDirect(data.diffuseLevel);
    
    // specular level
    surface.getAttribute("specularLevel").setValueDirect(data.specularLevel);
    
    // emissive level
    surface.getAttribute("emissiveLevel").setValueDirect(data.luminosityLevel);
    
    // glossiness
    surface.getAttribute("glossiness").setValueDirect(data.glossiness);
    
    // opacity
    surface.getAttribute("opacity").setValueDirect(1 - data.transparencyLevel);
    
    // double-sidedness
    surface.getAttribute("doubleSided").setValueDirect(data.doubleSided ? true : false);
}

LWObjectBuilder.prototype.loadTextures = function(data, layer, surfaceData, surface)
{
    var textures = [];

    // arrange blocks into ordered lists indexed by channel
    var channelBlocks = [];
    for (var i = 0; i < surfaceData.blocks.length; i++)
    {
        var block = surfaceData.blocks[i];
        if (block.type != 'IMAP') continue;

        if (!channelBlocks[block.channel])
        {
            channelBlocks[block.channel] = []
        }
        channelBlocks[block.channel].push(block);
    }

    // allocate textures for supported channel types

    // color
    if (channelBlocks[eLWObjectTokens.COLR])
    {
        this.allocateTextures(eTextureType.Color, data, layer, channelBlocks[eLWObjectTokens.COLR], surface, textures);
    }

    // diffuse
    if (channelBlocks[eLWObjectTokens.DIFF])
    {
        this.allocateTextures(eTextureType.Diffuse, data, layer, channelBlocks[eLWObjectTokens.DIFF], surface, textures);
    }

    // luminosity
    if (channelBlocks[eLWObjectTokens.LUMI])
    {
        this.allocateTextures(eTextureType.Luminosity, data, layer, channelBlocks[eLWObjectTokens.LUMI], surface, textures);
    }

    // specular
    if (channelBlocks[eLWObjectTokens.SPEC])
    {
        this.allocateTextures(eTextureType.Specular, data, layer, channelBlocks[eLWObjectTokens.SPEC], surface, textures);
    }

    // transparency
    if (channelBlocks[eLWObjectTokens.TRAN])
    {
        this.allocateTextures(eTextureType.Transparency, data, layer, channelBlocks[eLWObjectTokens.TRAN], surface, textures);
    }

    return textures;
}

LWObjectBuilder.prototype.allocateTextures = function(type, data, layer, blocks, surface, textures)
{  
    // create a media texture object for each normal or additive texture layer; if subsequent
    // layer is alpha, add as texture alpha channel
    for (var i=0; i < blocks.length; i++)
    {
        var block = blocks[i];
        if (block.opacityType != 0 && 
            block.opacityType != 7)
            continue;
            
        var imageClip = data.clips[block.imageIndex];
        if (!imageClip)
            continue;
            
        var alphaClip = null;
        if (i+1 < blocks.length)
        {
            if (blocks[i+1].opacityType == 5)
            {
                alphaClip = data.clips[blocks[i+1].imageIndex];
            }    
        } 
        
        var widthWrap, heightWrap;
        switch (block.widthWrap)
        {
        case 0: widthWrap = eTextureWrap.None; break;
        case 1: widthWrap = eTextureWrap.Repeat; break; 
        case 2: widthWrap = eTextureWrap.Mirror; break;
        case 3: widthWrap = eTextureWrap.Clamp; break;
        } 
        switch (block.heightWrap)
        {
        case 0: heightWrap = eTextureWrap.None; break;
        case 1: heightWrap = eTextureWrap.Repeat; break; 
        case 2: heightWrap = eTextureWrap.Mirror; break;
        case 3: heightWrap = eTextureWrap.Clamp; break;
        }     
        
        var filename = imageClip.getFilename();
        
        // strip any local paths saved by the modeler
        var ndx = filename.lastIndexOf('/');
        
        filename = ndx === -1 ? filename : filename.substring(ndx+1);
         
        var clipFilename = data.contentDir + "images/" + filename;
        
        // setup negate image flag based upon whether or not the graphics card uses
        // inverted alpha values, and if this is a transparency, diffuse, luminosity,
        // or specularity texture
        var negateImage = block.negative ? true : false;
        if (this.invertAlpha && 
           (type == eTextureType.Transparency ||
            type == eTextureType.Diffuse ||
            type == eTextureType.Luminosity ||
            type == eTextureType.Specularity))
        {
            negateImage = !negateImage;
        }

        // setup negate alpha flag based upon existance of an alpha clip and 
        // whether or not the graphics card uses inverted alpha values
        var negateAlpha = false;
        if (alphaClip)
        {
            negateAlpha = blocks[i+1].negative ? true : false;
            if (this.invertAlpha)
            {
                negateAlpha = !negateAlpha;
            }
        }
        
        // TODO: check if texture with same attributes has already been created;
        // if not, or if an opacity envelope is being used, allocate new one
        var mediaTexture = null;
        
        var factory = this.registry.find("AttributeFactory");
        mediaTexture = factory.create("MediaTexture");
           
        mediaTexture.getAttribute("name").setValueDirect(""); // TODO
        mediaTexture.getAttribute("textureType").setValueDirect(type);
        mediaTexture.getAttribute("opacity").setValueDirect(block.opacity);
        mediaTexture.getAttribute("widthWrap").setValueDirect(widthWrap);
        mediaTexture.getAttribute("heightWrap").setValueDirect(heightWrap);
        mediaTexture.getAttribute("mipmappingEnabled").setValueDirect(false);
        mediaTexture.getAttribute("imageFilename").setValueDirect(clipFilename);
        mediaTexture.getAttribute("negateImage").setValueDirect(negateImage);
        mediaTexture.getAttribute("negateAlpha").setValueDirect(negateAlpha);
        if (alphaClip)
        {
            mediaTexture.getAttribute("alphaFilename").setValueDirect(data.contentDir + alphaClip.getFilename());
        }
        
        // TODO: if opacity is an envelope, create a KeyframeInterpolator and attach to texture opacity attr

        textures.push(new Pair(mediaTexture, block));
        surface.addTexture(mediaTexture);
    }       
}

LWObjectBuilder.prototype.calculateTextureCoords = function(data, layer, blockData, vertices, polyNormals,
                                                            vertIndices, polyIndices)
{
    if (!data ||
        !layer ||
        !blockData ||
        !vertices ||
        !polyNormals ||
        !vertIndices ||
        !polyIndices)
    {
        return null;
    }

    var uvCoords = []
    var numVertices = vertices.length / 3;

    switch (blockData.projMode)
    {
        case 0: // planar
        case 1: // cylindrical
        case 2: // spherical
            {
                var i, vertex, uv;
                for (i = 0, vertex = 0, uv = 0; i < numVertices; i++, vertex += 3, uv += 2)
                {
                    uv = this.mapXYZtoUV(vertices[vertex], vertices[vertex + 1], vertices[vertex + 2],
                                     blockData.center, blockData.size, blockData.projMode, blockData.axis,
                                     blockData.widthWrapAmt, blockData.heightWrapAmt);
                    uvCoords.push(uv.u);
                    uvCoords.push(uv.v);
                }
            }
            break;

        case 3: // cubic
            {
                var i, vertex, uv;
                for (i = 0, vertex = 0, uv = 0; i < numVertices; i++, vertex += 3, uv += 2)
                {
                    polyNormal = polyNormals[i];

                    if (Math.acos(cosineAngleBetween(polyNormal, new Vector3D(1, 0, 0))) <= QUARTERPI ||
                    Math.acos(cosineAngleBetween(polyNormal, new Vector3D(-1, 0, 0))) <= QUARTERPI)
                    {
                        axis = 0; // x
                    }
                    else if (Math.acos(cosineAngleBetween(polyNormal, new Vector3D(0, 1, 0))) <= QUARTERPI ||
                         Math.acos(cosineAngleBetween(polyNormal, new Vector3D(0, -1, 0))) <= QUARTERPI)
                    {
                        axis = 1; // y
                    }
                    else
                    {
                        axis = 2; // z
                    }

                    uv = this.mapXYZtoUV(vertices[vertex], vertices[vertex + 1], vertices[vertex + 2],
                                     blockData.center, blockData.size, 0, axis,
                                     blockData.widthWrapAmt, blockData.heightWrapAmt);
                    uvCoords.push(uv.u);
                    uvCoords.push(uv.v);
                }
            }
            break;

        case 5: // UV
            {
                var vmap = layer.getVmap('TXUV', blockData.uvMapName);
                //if (vmap) quick_sort(vmap, LWObjectBuilder_CompareVmapEntries);

                var vmad = layer.getVmad('TXUV', blockData.uvMapName);
                //if (vmad) quick_sort(vmad, LWObjectBuilder_CompareVmadEntries);

                var i, vertIndex, polyIndex, uv, uvSet;
                for (i = 0, uv = 0; i < numVertices; i++, uv += 2)
                {
                    vertIndex = vertIndices[i];
                    polyIndex = polyIndices[i];
                    uvSet = false;

                    // check for vmad entry (overrides vmap entry)
                    if (vmad && vmad.length)
                    {
                        for (var vmad_entries = 0; vmad_entries < vmad.length; vmad_entries++)
                        {
                            if (vmad[vmad_entries].poly > polyIndex)
                            {
                                break;
                            }

                            if (vmad[vmad_entries].poly == polyIndex)
                            {
                                if (vmad[vmad_entries].vertex == vertIndex)
                                {
                                    uvCoords[uv] = vmad[vmad_entries].u;
                                    uvCoords[uv + 1] = vmad[vmad_entries].v;
                                    uvSet = true;
                                    break;
                                }
                            }
                        }

                        if (uvSet)
                        {
                            // don't retrieve from vmap
                            continue;
                        }
                    }

                    // check for vmap entry
                    if (vmap && vmap.length)
                    {
                        for (var vmap_entries = 0; vmap_entries < vmap.length; vmap_entries++)
                        {
                            if (vmap[vmap_entries].vertex > vertIndex)
                            {
                                break;
                            }

                            if (vmap[vmap_entries].vertex == vertIndex)
                            {
                                uvCoords[uv] = vmap[vmap_entries].u;
                                uvCoords[uv + 1] = vmap[vmap_entries].v;
                                uvSet = true;
                                break;
                            }
                        }
                    }

                    if (!uvSet)
                    {
                        uvCoords[uv] = 0;
                        uvCoords[uv + 1] = 0;
                    }
                }
            }
            break;

        default:
            {
                //alert(blockData.projMode);
            }
            break;
    }

    return uvCoords;
}

LWObjectBuilder.prototype.mapXYZtoUV = function(x, y, z, textureCenter, textureSize, projMode, axis, widthWrapAmt, heightWrapAmt)
{
    var lon, lat;
    var integerPart;

    var u = 0;
    var v = 0;

    switch(projMode)
    {
    case 0: // planar
        switch(axis)
        {
        case 0: // x
            u = (z - textureCenter.z) / textureSize.z + 0.5;
            v = (y - textureCenter.y) / textureSize.y + 0.5;
            break;

        case 1: // y
            u = (x - textureCenter.x) / textureSize.x + 0.5;
            v = (z - textureCenter.z) / textureSize.z + 0.5;
            break;

        case 2: // z
        default:
            u = (x - textureCenter.x) / textureSize.x + 0.5;
            v = (y - textureCenter.y) / textureSize.y + 0.5;
            break;
        }
        break;

   case 1: // cylindrical
        x -= textureCenter.x;
        y -= textureCenter.y;
        z -= textureCenter.z;
        
        switch(axis)
        {
        case 0: // x
            lon = XYZtoH(z, x, y);
            u = lon / (TWOPI * widthWrapAmt);
            v = x / textureSize.x + 0.5;
            break;

        case 1: // y
            lon = XYZtoH(x, y, z);
            u = lon / (TWOPI * widthWrapAmt);
            v = y / textureSize.y + 0.5;
            break;

        case 2: // z
        default:
            lon = XYZtoH(-x, z, -y);
            u = lon / (TWOPI * widthWrapAmt);
            v = -z / textureSize.z + 0.5;
            break;
        }

        // clamp u coordinate to range [0, 1)
        u = modf(u).fractionalPart;
        if (u < 0) u += 1;
        break;

   case 2: // spherical
        x -= textureCenter.x;
        y -= textureCenter.y;
        z -= textureCenter.z;

        switch (axis)
        {
        case 0: // x
            var hp = XYZtoHP(z, x, -y);
            lon = hp.heading;
            lat = hp.pitch;
            break;

        case 1: // y
            var hp = XYZtoHP(-x, y, z);
            lon = hp.heading;
            lat = hp.pitch;
            break;

        case 2: // z
        default:
            var hp = XYZtoHP(-x, z, -y);
            lon = hp.heading;
            lat = hp.pitch;
            break;
        }

        u = modf(1 - (lon / TWOPI * widthWrapAmt)).fractionalPart;
        v = 1 - modf(0.5 - (lat / Math.PI * heightWrapAmt)).fractionalPart;

        break;
    }
 
    return { u: u, v: v };   
}

function LWObjectBuilder_ObjectHandler(data, builder)
{
    builder.allocateModel(data);
}

function LWObjectBuilder_CompareVmapEntries(elem1, elem2)
{
    if (elem1.vertex < elem2.vertex) return -1;
    if (elem1.vertex > elem2.vertex) return 1;
    return 0;
}

function LWObjectBuilder_CompareVmadEntries(elem1, elem2)
{
    if (elem1.poly < elem2.poly) return -1;
    if (elem1.poly > elem2.poly) return 1;
    return 0;
}
LWSceneHandler.prototype = new ContentHandler();
LWSceneHandler.prototype.constructor = LWSceneHandler;

function LWSceneHandler()
{
    ContentHandler.call(this);
    this.className = "LWSceneHandler";
    
    this.tokenHandlers = [];
    this.tokenHandlersData = [];
}

LWSceneHandler.prototype.addTokenHandler = function(handler, data)
{
    this.tokenHandlers.push(handler);
    this.tokenHandlersData.push(data);
}

LWSceneHandler.prototype.parseFileStream = function(url)
{
    var filename = formFullPath(url, this.contentDirectory.getValueDirect().join(""));
    var filestream = loadTextResource(filename);
    if (filestream == null)
    {
        return -2;
    }
    
    var parser = new TextParser(filestream);
    
    var tokens;
    while (tokens = parser.readLineTokens())
    {
        if (tokens.length == 0) continue;
        
        // check for string
        if (tokens[0].indexOf("\"") != -1)
        {
            tokens.push(tokens[0].substring(1, tokens[0].length-1));
            tokens[0] = "String";    
        }
        
        // pass tokens to consumer(s)
        for (var i=0; i < this.tokenHandlers.length; i++)
        {
            this.tokenHandlers[i](tokens, this.tokenHandlersData[i]);    
        }    
    }
    
    // pass EOF to consumer(s)
    for (var i=0; i < this.tokenHandlers.length; i++)
    {
        this.tokenHandlers[i](new Array("EOF"), this.tokenHandlersData[i]);    
    }   
}
function TLWSCSceneData()
{
    var fps = 0;
    var backgroundColorR = 0;
    var backgroundColorG = 0;
    var backgroundColorB = 0;
    var backgroundImageFilename = "";
    var foregroundImageFilename = "";
    var foregroundAlphaFilename = "";
    var fadeForeground = false;
    var gridSize = 0;
    var nearClipDistance = 0.25;
}

function TLWSCv3LightDesc()
{
    this.name = "";
    this.type = 0;
    this.colorR = 0;
    this.colorG = 0;
    this.colorB = 0;
    this.intensity = 0;
    this.range = 0;
    this.coneAngle = 0; // for spot lights
    this.edgeAngle = 0; // for spot lights
    this.motion = null;
    this.parentItem = 0;
}

LWSceneBuilder.prototype = new ContentBuilder();
LWSceneBuilder.prototype.constructor = LWSceneBuilder;

function LWSceneBuilder()
{
    ContentBuilder.call(this);
    this.className = "LWSceneBuilder";

    this.root = null;
    this.sgRoot = null;
    this.evaluatorsGroup = null;
    this.camerasSelector = null;
    this.lightsGroup = null;
    this.modelsGroup = null;
    this.renderDirective = null;
    this.boneFalloffType = eBoneFalloffType.InverseDistance;
    this.parsingBgImage = false;
    this.parsingFgImage = false;
    this.parsingFgAlphaImage = false;
    this.imagePath = "";
    this.currElement = null;
    this.currChannel = 0;   // motions
    this.sceneData = new TLWSCSceneData();
    this.ambientLightDesc = new TLWSCv3LightDesc();
    this.globalLightDesc = new TLWSCv3LightDesc();
    this.lightDescs = [];
    this.parentItems = [];
    this.bones = [];
    this.objectBones = [];
    
    this.indexGeometry = new BooleanAttr(true);
    
    this.registerAttribute(this.indexGeometry, "indexGeometry");
    
    this.ambientLightDesc.colorR = 1;
    this.ambientLightDesc.colorG = 1;
    this.ambientLightDesc.colorB = 1;
    this.ambientLightDesc.intensity = 0.05;
    this.globalLightDesc.intensity = 1;
}

LWSceneBuilder.prototype.visitHandler = function(handler)
{
    handler.addTokenHandler(LWSceneBuilder_TokenHandler, this);
}

LWSceneBuilder.prototype.finalize = function()
{
}

LWSceneBuilder.prototype.matchesType = function(type)
{
    return (type == "lws" ||
            type == "mot");
}

LWSceneBuilder.prototype.handleToken = function(token, params)
{
    switch (token)
    {
        case "LWSC":
            this.handleSceneToken(params);
            break;
            
        case "LWMO":
            this.handleMotionToken(params);
            break;
            
        default:
            this.handleCommandToken(token, params);
            break;
    }
}

LWSceneBuilder.prototype.handleSceneToken = function(params)
{
    this.allocateSceneGraph();
}

LWSceneBuilder.prototype.handleMotionToken = function(params)
{

}

LWSceneBuilder.prototype.handleCommandToken = function(token, params)
{
    this.allocateSceneElement(token, params);
}

LWSceneBuilder.prototype.allocateSceneGraph = function()
{
    // root
    this.root = this.factory.create("Isolator");
    this.root.name.setValueDirect("Root");
    this.root.isolateLights.setValueDirect(true);
    this.registry.rootPtr.setValueDirect(this.root);
    
    // evaluators group
    this.evaluatorsGroup = this.factory.create("Group");
    this.evaluatorsGroup.name.setValueDirect("Evaluators");
    this.root.addChild(this.evaluatorsGroup);
    
    // cameras group
    this.camerasSelector = this.factory.create("Selector");
    this.camerasSelector.name.setValueDirect("Cameras");
    this.camerasSelector.selectee.setValueDirect(0);
    this.root.addChild(this.camerasSelector);
    
    // lights group
    this.lightsGroup = this.factory.create("Group");
    this.lightsGroup.name.setValueDirect("Lights");
    this.root.addChild(this.lightsGroup);
    
    // models group
    this.modelsGroup = this.factory.create("Group");
    this.modelsGroup.name.setValueDirect("Models");
    this.root.addChild(this.modelsGroup);
    
    // render directive
    this.renderDirective = this.factory.create("RenderDirective");
    this.renderDirective.name.setValueDirect("RenderDirective");
    this.renderDirective.rootNode.setValueDirect(this.root);
   
    return true;
}

LWSceneBuilder.prototype.allocateSceneElement = function(token, params)
{
    switch (token)
    {
        case "LoadObjectLayer":
        {
            var model = this.factory.create("Model");            
            this.currElement = model;
            
            // layer
            var layer = params[0];
            model.layer.setValueDirect(layer);
            
            // combine tokens into one string (if filename has
            // spaces, multiple tokens will be present)
            var filename = params.slice(1).join();
            filename = addSlashAfterDriveSpecifier(filename);
            model.url.setValueDirect(filename);
            
            // don't allow disableOnDissolve, because this breaks label positioning when targeted to null-object models
            model.disableOnDissolve.setValueDirect(false);
            
            this.models.push(model);
            this.modelsGroup.addChild(model);
            
            // load model
            finalizeModel(model, this.factory);
            
            this.objectBones.push(new Array());
        }
        break;
        
        case "ObjectMotion":
        {
            var kfi = this.factory.create("KeyframeInterpolator");        
            kfi.name.setValueDirect("Motion");
            
            this.evaluators.push(kfi);
            this.evaluatorsGroup.addChild(kfi);
        }
        break;
        
        case "NumChannels":
        {            
            if (this.evaluators.length > 0)
            {
                var kfi = this.evaluators[this.evaluators.length-1];                
                var numChannels = parseInt(params[0]);
                
                this.initializeKeyframeInterpolator(kfi, numChannels);
                
                var element = this.currElement || this.registry.find(kfi.getAttribute("target").getValueDirect().join(""));
                if (element)
                {
                    switch (numChannels)
                    {
                        case 1:  this.attachDissolveInterpolator(kfi, element); break;
                        default: this.attachKeyframeInterpolator(kfi, element); break;
                    }
                }
            }
        }
        break;
        
        case "Channel":
        {
            this.currChannel = parseInt(params[0]);
        }
        break;
        
        case "Key":
        {
            if (this.evaluators.length > 0)
            {
                var kfi = this.evaluators[this.evaluators.length-1];
                var keyframes = kfi.channels.getAt(this.currChannel);
                var keyframe = new KeyframeAttr();
                
                for (var i=0; i < params.length; i++)
                {
                    switch (i)
                    {
                        case 0: // value
                        {
                            var f = parseFloat(params[i]);
                            
                            // if channel 3, 4, or 5, convert value to degrees
                            if (this.currChannel == 3 || this.currChannel == 4 || this.currChannel == 5)
                            {
                                f = toDegrees(f);
                            }
                            
                            keyframe.value.setValueDirect(f);
                        }
                        break;
                        
                        case 1: // time
                        {
                            keyframe.time.setValueDirect(parseFloat(params[i]));
                        }
                        break;
                        
                        case 2:
                        {
                            var shape = parseInt(params[i]);
                            switch (shape)
                            {
                                case 0: keyframe.shape.setValueDirect(eKeyframeShape.TCB); break;
                                case 1: keyframe.shape.setValueDirect(eKeyframeShape.Hermite); break;
                                case 2: keyframe.shape.setValueDirect(eKeyframeShape.Bezier1D); break;
                                case 3: keyframe.shape.setValueDirect(eKeyframeShape.Linear); break;
                                case 4: keyframe.shape.setValueDirect(eKeyframeShape.Stepped); break;
                                case 5: keyframe.shape.setValueDirect(eKeyframeShape.Bezier2D); break;
                                default: keyframe.shape.setValueDirect(eKeyframeShape.Linear); break;
                            }
                        }
                        break;
                        
                        case 3:
                        case 4:
                        case 5:
                        case 6:
                        case 7:
                        case 8:
                            keyframe.params.getAt(i-3).setValueDirect(parseFloat(params[i]));
                            break;
                            
                        default:
                            break;
                    }   
                }
                
                keyframes.push_back(keyframe);
            }
        }
        break;
        
        case "Behaviors":
        {
            if (this.evaluators.length > 0)
            {
                var kfi = this.evaluators[this.evaluators.length-1];
                
                kfi.preBehaviors.getAt(this.currChannel).setValueDirect(parseInt(params[0]));
                kfi.postBehaviors.getAt(this.currChannel).setValueDirect(parseInt(params[1]));
            }       
        }
        break;
        
        case "ObjectDissolve":
        {
            if (params[0] == "(envelope)")
            {
                var kfi = this.factory.create("KeyframeInterpolator");
                kfi.name.setValueDirect("Dissolve");
                
                this.initializeKeyframeInterpolator(kfi, 1);
                this.attachDissolveInterpolator(kfi, this.models[this.models.length-1]);
                
                this.evaluators.push(kfi);
                this.evaluatorsGroup.addChild(kfi);
            }
            else // non-envelope dissolve
            {
                // set to last loaded model
                if (this.models.length > 0)
                {
                    this.models[this.models.length-1].dissolve.setValueDirect(parseFloat(params[0]));
                }
            }
        }
        break;
        
        case "AddCamera":
        {
            var camera = this.factory.create("PerspectiveCamera");
            this.currElement = camera;
            
            this.cameras.push(camera);
            this.camerasSelector.addChild(camera);
        }
        break;
        
        case "CameraName":
        {
            // set to last loaded camera
            if (this.cameras.length > 0)
            {
                this.cameras[this.cameras.length-1].name.setValueDirect(params[0]);
            }
        }
        break;
        
        case "CameraMotion":
        {
            var kfi = this.factory.create("KeyframeInterpolator");
            kfi.name.setValueDirect("Motion");
            
            this.evaluators.push(kfi);
            this.evaluatorsGroup.addChild(kfi);
        }
        break;
        
        case "ZoomFactor":
        {
            // set to last loaded camera
            if (this.cameras.length > 0)
            {
                this.cameras[this.cameras.length-1].zoom.setValueDirect(parseFloat(params[0]));
            }
        }
        break;
        
        case "AmbientColor":
        {
            this.ambientLightDesc.colorR = parseFloat(params[0]);
            this.ambientLightDesc.colorG = parseFloat(params[1]); 
            this.ambientLightDesc.colorB = parseFloat(params[2]); 
        }
        break;
        
        case "AmbientIntensity":
        {
            var globalIllumination = this.factory.create("GlobalIllumination");
            globalIllumination.name.setValueDirect("GLight");
            
            var intensity = parseFloat(params[0]);
            
            globalIllumination.ambient.setValueDirect(this.ambientLightDesc.colorR * intensity,
                                                      this.ambientLightDesc.colorG * intensity,
                                                      this.ambientLightDesc.colorB * intensity,
                                                      1);
                                                      
            this.lightsGroup.addChild(globalIllumination);
        }
        break;
        
        case "GlobalLightIntensity":
        {
            this.globalLightDesc.intensity = parseFloat(params[0]);
        }
        break;
        
        case "AddLight":
        {
            var lightDesc = new TLWSCv3LightDesc();
            
            // set default range (if unspecified in scene file)
            lightDesc.range = Math.sqrt(FLT_MAX);
            
            this.lightDescs.push(lightDesc);
            
            this.currElement = null;
        }
        break;
        
        case "LightName":
        {
            if (this.lightDescs.length > 0)
            {
                this.lightDescs[this.lightDescs.length-1].name = params[0];
            }
        }
        break;
        
        case "LightMotion":
        {
            var kfi = this.factory.create("KeyframeInterpolator");
            kfi.name.setValueDirect("Motion");
            
            // add to last light record
            if (this.lightDescs.length > 0)
            {
                this.lightDescs[this.lightDescs.length-1].motion = kfi;
            }
                
            this.evaluators.push(kfi);
            this.evaluatorsGroup.addChild(kfi);
        }
        break;
        
        case "LightColor":
        {
            // add to last light record
            if (this.lightDescs.length > 0)
            {
                this.lightDescs[this.lightDescs.length-1].colorR = parseFloat(params[0]);
                this.lightDescs[this.lightDescs.length-1].colorG = parseFloat(params[1]);
                this.lightDescs[this.lightDescs.length-1].colorB = parseFloat(params[2]);
            }
        }
        break;
        
        case "LightIntensity":
        {
            // add to last light record
            if (this.lightDescs.length > 0)
            {
                this.lightDescs[this.lightDescs.length-1].intensity = parseFloat(params[0]);
            }
        }
        break;
        
        case "LightRange":
        {
            // add to last light record
            if (this.lightDescs.length > 0)
            {
                this.lightDescs[this.lightDescs.length-1].range = parseFloat(params[0]);
            }
        }
        break;
        
        case "LightConeAngle":
        {
            // add to last light record
            if (this.lightDescs.length > 0)
            {
                this.lightDescs[this.lightDescs.length-1].coneAngle = parseFloat(params[0]);
            }
        }
        break;
        
        case "LightEdgeAngle":
        {
            // add to last light record
            if (this.lightDescs.length > 0)
            {
                this.lightDescs[this.lightDescs.length-1].edgeAngle = parseFloat(params[0]);
            }
        }
        break;
        
        case "LightType":
        {
            // add to last light record
            if (this.lightDescs.length > 0)
            {
                this.lightDescs[this.lightDescs.length-1].type = parseInt(params[0]);
            }
        }
        break;
        
        case "AddNullObject":
        {
            var nullObject = this.factory.create("NullObject");
            this.currElement = nullObject;
            
            this.models.push(nullObject);
            this.modelsGroup.addChild(nullObject);
            
            if (params[0])
            {
                nullObject.name.setValueDirect(params[0]);
            }
        }
        break;
        
        case "PivotPosition":
        {
            if (this.currElement)
            {
                this.currElement.pivot.setValueDirect(parseFloat(params[0]), parseFloat(params[1]), parseFloat(params[2]));
            }
        }
        break;
        
        case "BoneFalloffType":
        {
            this.boneFalloffType = parseInt(params[0]);
        }
        break;
        
        case "AddBone":
        {
            var bone = this.factory.create("Bone");
            bone.falloffType.setValueDirect(this.boneFalloffType);
            this.currElement = bone;
            this.bones.push(bone);
            this.objectBones[this.objectBones.length-1].push(bone);
            
        }
        break;
        
        case "BoneName":
        {
            var bone = this.bones.length > 0 ? this.bones[this.bones.length-1] : null;
            if (bone)
            {
                // check if this bone name has already been specified; if it has, append " (n)" to the
                // bone name, where n is the number of occurrences of this bone name
                var numOccurrences = 0;
                var s = "";
                for (var i=0; i < this.bones.length; i++)
                {
                    if (params[0] == this.bones[i].name.getValueDirect().join(""))
                    {
                        numOccurrences++;
                    }
                }
                if (numOccurrences > 0)
                {
                    params[0] += "(" + numOccurrences+1 + ")";
                }

                bone.name.setValueDirect(params[0]);
            }    
        }
        break;
        
        case "BoneRestPosition":
        {
            var bone = this.bones.length > 0 ? this.bones[this.bones.length-1] : null;
            if (bone)
            {
                bone.restPosition.setValueDirect(parseFloat(params[0]), parseFloat(params[1]), parseFloat(params[2]));
            }
        }
        break;
        
        case "BoneRestDirection":
        {
            var bone = this.bones.length > 0 ? this.bones[this.bones.length-1] : null;
            if (bone)
            {
                bone.restRotation.setValueDirect(parseFloat(params[1]), parseFloat(params[0]), parseFloat(params[2]));
            }
        }
        break;
        
        case "BoneRestLength":
        {
            var bone = this.bones.length > 0 ? this.bones[this.bones.length-1] : null;
            if (bone)
            {
                bone.restLength.setValueDirect(parseFloat(params[0]));
            }
        }
        break;
        
        case "BoneStrength":
        {
            var bone = this.bones.length > 0 ? this.bones[this.bones.length-1] : null;
            if (bone)
            {
                bone.strength.setValueDirect(parseFloat(params[0]));
            }
        }
        break;
        
        case "BoneScaleBoneStrength":
        {
            var bone = this.bones.length > 0 ? this.bones[this.bones.length-1] : null;
            if (bone)
            {
                bone.scaleBoneStrength.setValueDirect(parseFloat(params[0]));
            }
        }
        break;
        
        case "BoneMotion":
        {
            var kfi = this.factory.create("KeyframeInterpolator");
            kfi.name.setValueDirect("Motion");
            
            // add to last light record
            if (this.bones.length > 0)
            {
                this.bones[this.bones.length-1].motion = kfi;
            }
                
            this.evaluators.push(kfi);
            this.evaluatorsGroup.addChild(kfi);
        }
        break;
        
        case "ParentItem":
        {
            if (this.currElement)
            {
                this.parentItems.push(new Pair(this.currElement, params[0]));
            }
            else // !this.currElement -- current element is a light (this.currElement is NULL because 
                 // light can't be allocated until later when type is known)
            {
                if (this.lightDescs.length > 0)
                {
                    this.lightDescs[this.lightDescs.length-1].parentItem = params[0];
                }
            }
        }
        
        case "GridSize":
        {
            this.sceneData.gridSize = parseFloat(params[0]);
        }
        
        case "NearClipDistance":
        {
            // set to last camera
            if (this.cameras.length > 0)
            {
                this.cameras[this.cameras.length-1].nearDistance.setValueDirect(parseFloat(params[0]));
            }
        }
        break;
        
        case "FramesPerSecond":
        {
            this.sceneData.fps = parseFloat(params[0]);
        }
        break;
        
        case "BackdropColor":
        {
            this.sceneData.backgroundColorR = parseFloat(params[0]);
            this.sceneData.backgroundColorG = parseFloat(params[1]);
            this.sceneData.backgroundColorB = parseFloat(params[2]);
        }
        break;
        
        case "}":
        {
            this.currChannel = 0;
            
            if (this.imagePath != "")
            {
                if (this.parsingBgImage)
                {
                    this.renderDirective.backgroundImageFilename.setValueDirect(this.imagePath);
                    this.parsingBgImage = false;
                }
                else if (this.parsingFgImage)
                {
                    this.renderDirective.foregroundImageFilename.setValueDirect(this.imagePath);
                    this.parsingFgImage = false;
                }
                else if (this.parsingFgAlphaImage)
                {
                    this.renderDirective.foregroundAlphaImageFilename.setValueDirect(this.imagePath);
                    this.parsingFgAlphaImage = false;
                }
                
                this.imagePath = "";
            }
        }
        break;
        
        case "String":
        {
            if (this.parsingBgImage ||
                this.parsingFgImage ||
                this.parsingFgAlphaImage)
            {
                this.imagePath = params[0];
            }
        }
        break;
        
        case "BGImage":
        {
            this.parsingBgImage = true;
        }
        break;
        
        case "FGImage":
        {
            this.parsingFgImage = true;
        }
        break;
        
        case "FGAlphaImage":
        {
            this.parsingFgAlphaImage = true;
        }
        break;
        
        case "EOF":
        {
            this.finalize();
        }
        break;
        
        default:
        {
            // unsupported tag
        }
        break;
    }
}

LWSceneBuilder.prototype.finalize = function()
{
    // place models into name bins
    var nameBins = [];
    for (var i=0; i < this.models.length; i++)
    {
        var name = this.models[i].name.getValueDirect().join("");
        if (nameBins[name] == undefined)
        {
            nameBins[name] = new Array();
        }
        
        nameBins[name].push(this.models[i]);
    }
    
    // any name bins that contain more than 1 entry are duplicates and need to be renamed with "(n)" appended
    for (var name in nameBins)
    {
        if (nameBins[name].length > 1)
        {
            for (var i=0; i < nameBins[name].length; i++)
            {
                nameBins[name][i].name.setValueDirect(name + " (" + (i+1) + ")")
            }
        }
    }
    
    // set camera(s) clip planes
    var nearDistance, farDistance;
    for (var i=0; i < this.cameras.length; i++)
    {
        var zoom = this.cameras[i].zoom.getValueDirect();

        nearDistance = this.sceneData.gridSize * 0.1 * zoom;
        farDistance = nearDistance * 100000;
        
        this.cameras[i].nearDistance.setValueDirect(nearDistance);
        this.cameras[i].farDistance.setValueDirect(farDistance);
    }

    // allocate lights
    for (var i=0; i < this.lightDescs.length; i++)
    {
        var light = this.allocateLight(this.lightDescs[i]);
        
        // if parented, add entry in parent items map
        if (this.lightDescs[i].parentItem)
        {
            this.parentItems.push(new Pair(light, this.lightDescs[i].parentItem));
        }
        
        this.lights.push(light);
        this.lightsGroup.addChild(light);
    }
    
    // assign parents
    for (var i=0; i < this.parentItems.length; i++)
    {
        this.setParentItem(this.parentItems[i].first, this.parentItems[i].second);    
    }
    
    // setup motion controllers
    // TODO
    
    // create bone effectors
    for (var i=0; i < this.models.length; i++)
    {
        var model = this.models[i];
        if (model.bones && 
            model.bones.length > 0)
        {
            this.attachBoneEffectors(model, model.bones);
        }
    }

    // create morph effectors
    // TODO
    
    // backdrop color
    
    // register evaluators; evaluate evaluators once so that their initial values 
    // are set to their targets (e.g., models that depend upon KFI's for position)
    for (var i=0; i < this.evaluators.length; i++)
    {
        this.evaluators[i].evaluate();
    }
}

LWSceneBuilder.prototype.allocateLight = function(lightDesc)
{
    var light = null;
    switch (lightDesc.type)
    {
        case 0: // distance (directional)
        case 3: // linear (use directional to approximate)
            light = this.factory.create("DirectionalLight");
            break;
            
        case 1: // point
            light = this.factory.create("PointLight");
            break;
            
        case 2: // spot
        case 4: // area (use spot to approximate)
            light = this.factory.create("SpotLight");
            break;
    }
    if (!light) return null;
    
    // attach motion object
    if (lightDesc.motion)
    {
        this.attachKeyframeInterpolator(lightDesc.motion, light);
    }
    
    // set common attributes
    
    // name
    light.name.setValueDirect(lightDesc.name);
    
    // light color
    var red = lightDesc.colorR * lightDesc.intensity * this.globalLightDesc.intensity;
    var green = lightDesc.colorG * lightDesc.intensity * this.globalLightDesc.intensity;
    var blue = lightDesc.colorB * lightDesc.intensity * this.globalLightDesc.intensity;
    var alpha = 1;
    
    // ambient color
    light.ambient.setValueDirect(this.ambientLightDesc.colorR * this.ambientLightDesc.intensity,
                                 this.ambientLightDesc.colorG * this.ambientLightDesc.intensity,
                                 this.ambientLightDesc.colorB * this.ambientLightDesc.intensity,
                                 1);
    
    // diffuse color
    light.diffuse.setValueDirect(red, green, blue, alpha);
    
    // specular color
    light.specular.setValueDirect(red, green, blue, alpha);
    
    // set type-specific attributes
    switch (lightDesc.type)
    {
        case 0: // distance (directional)
        case 3: // linear (use directional to approximate)
            break;
            
        case 1: // point
            // range
            light.range.setValueDirect(lightDesc.range);
            break;
            
        case 2: // spot
        case 4: // area (use spot to approximate)
            // range
            light.range.setValueDirect(lightDesc.range);
            // inner cone degrees
            light.innerConeDegrees.setValueDirect(lightDesc.coneAngle);
            // outer cone degrees
            light.outerConeDegrees.setValueDirect(lightDesc.edgeAngle);
            // cone falloff
            light.coneFalloff.setValueDirect(1);
            break;
    }
    
    return light;
}

LWSceneBuilder.prototype.initializeKeyframeInterpolator = function(kfi, numChannels)
{
    kfi.setNumChannels(numChannels);
}

LWSceneBuilder.prototype.attachKeyframeInterpolator = function(kfi, target)
{
    if (!kfi || !target) return;
    
    var numChannels = kfi.getAttribute("channels").vector.length;
    
    for (var channel=0; channel < numChannels; channel++)
    {
        var resultValue = kfi.getAttribute("resultValues").getAt(channel);
        
        switch (channel)
        {
            case 0: // x pos
                resultValue.addElementTarget(target.getAttribute("position"), 0, 0);
                break;

            case 1: // y pos
                resultValue.addElementTarget(target.getAttribute("position"), 0, 1);
                break;

            case 2: // z pos
                resultValue.addElementTarget(target.getAttribute("position"), 0, 2);
                break;

            case 3: // heading (y rot)
                resultValue.addElementTarget(target.getAttribute("rotation"), 0, 1);
                break;

            case 4: // pitch (x rot)
                resultValue.addElementTarget(target.getAttribute("rotation"), 0, 0);
                break;

            case 5: // bank (z rot)
                resultValue.addElementTarget(target.getAttribute("rotation"), 0, 2);
                break;

            case 6: // x scale
                resultValue.addElementTarget(target.getAttribute("scale"), 0, 0);
                break;

            case 7: // y scale
                resultValue.addElementTarget(target.getAttribute("scale"), 0, 1);
                break;

            case 8: // z scale
                resultValue.addElementTarget(target.getAttribute("scale"), 0, 2);
                break;
        }   
    }
    
    kfi.getAttribute("time").setValueDirect(0);
}

LWSceneBuilder.prototype.attachDissolveInterpolator = function(kfi, target)
{
    if (!kfi || !target) return;
    
    var resultValue = kfi.getAttribute("resultValues").getAt(0);
    
    resultValue.addElementTarget(target.getAttribute("dissolve"), 0, 0);
}

LWSceneBuilder.prototype.attachBoneEffectors = function(model, bones)
{
    // for each geometry set in model...
    for (var i=0; i < model.geometries.length; i++)
    {
        var geometry = model.geometries[i];
        
        // allocate bone effector
        var boneEffector = this.factory.create("BoneEffector");
        this.evaluators.push(boneEffector);
        this.evaluatorsGroup.addChild(boneEffector);
        
        // add bones to bone effector
        for (var j=0; j < bones.length; j++)
        {
            boneEffector.addBoneHierarchy(bones[j]);
        }

        // get vertices/normals from geometry
        var verticesAttr = geometry.getAttribute("vertices");
        var vertices = verticesAttr.getValueDirect();

        // points/lines will not have normals
        var normalsAttr = geometry.getAttribute("normals");
        var normals = normalsAttr.getValueDirect();

        // assign to bone effector inputs
        boneEffector.getAttribute("vertices").setValueDirect(vertices);
        boneEffector.getAttribute("normals").setValueDirect(normals);

        // route bone effector outputs back to geometry
        boneEffector.getAttribute("resultVertices").addTarget(verticesAttr);
        boneEffector.getAttribute("resultNormals").addTarget(normalsAttr);
    }
}

LWSceneBuilder.prototype.setParentItem = function(object, parentItem)
{
    var itemNum = hexStrToULong(parentItem.substring(1));
    var parent = null;
    switch (parentItem.charAt(0))
    {
        case "1": // model parent
            {
                parent = this.models[itemNum];
                if (object.attrType == eAttrType.Bone)
                {
                    parent.bones.push(object);
                }
            }
            break;
    
        case "2": // light parent
            {
                parent = this.lights[itemNum];
            }
            break;
    
        case "3": // camera parent
            {
                parent = this.cameras[itemNum];
            }
            break;
    
        case "4": // bone parent
            {
                var boneNum = hexStrToULong(parentItem.substring(1, 4));
                var objNum = hexStrToULong(parentItem.substring(4));

                if (this.bones.length > boneNum)
                {
                    var childBone = object;
                    var parentBone = null;
                    if (this.objectBones.length > objNum && this.objectBones[objNum].length > boneNum)
                    {
                        parentBone = this.objectBones[objNum][boneNum];
                    }

                    if (parentBone && childBone)
                    {
                        parentBone.addChild(childBone);
                    }
                }  
            }
            break;
        
        default:
            return;
    }
    
    // assign parent
    switch (object.attrType)
    {
        case eAttrType.Bone:
            break;
        
        default:
            object.setMotionParent(parent);
            break;
    }
}

function LWSceneBuilder_TokenHandler(tokens, builder)
{
    builder.handleToken(tokens[0], tokens.slice(1));
}
AttributeFactory.prototype = new AttributeContainer();
AttributeFactory.prototype.constructor = AttributeFactory;

function AttributeFactory()
{
    AttributeContainer.call(this);
    this.className = "AttributeFactory";
    this.attrType = eAttrType.AttributeFactory;

    this.newResourceProcs = [];
    this.configureProcs = [];
    this.finalizeProcs = [];
    this.registry = null;
    this.graphMgr = null;

    this.name = new StringAttr("AttributeFactory");

    this.registerAttribute(this.name, "name");

    this.initializeNewResourceMap();
    this.initializeConfigureMap();
    this.initializeFinalizeMap();
}

AttributeFactory.prototype.create = function(name)
{
    var resource = null;

    // invoke new resource proc
    var newResourceProc = this.newResourceProcs[name];
    if (newResourceProc)
    {
        resource = newResourceProc(name, this);
    }
    if (!resource)
        return null;

    // invoke configuration proc (if specified)
    var configureProc = this.configureProcs[name];
    if (configureProc)
    {
        configureProc(resource, this);
    }

    // if resource is a container, register name and userData if not already registered
    if (resource.isContainer())
    {
        if (!resource.getAttribute("name"))
            resource.registerAttribute(new StringAttr(""), "name");
        if (!resource.getAttribute("userData"))
            resource.registerAttribute(new StringAttr(""), "userData");
    }

    // register resource
    if (this.registry)
    {
        this.registry.register(resource);
        resource.setRegistry(this.registry);
    }

    // invoke post-register proc (if specified)

    return resource;
}

AttributeFactory.prototype.finalize = function(name, attribute)
{
    // invoke finalize proc
    var finalizeProc = this.finalizeProcs[name];
    if (finalizeProc)
    {
        finalizeProc(attribute, this);
    }
}

AttributeFactory.prototype.initializeNewResourceMap = function()
{
    // attributes
    this.newResourceProcs["Styles"] = newAttribute;
    this.newResourceProcs["StyleMap"] = newAttribute;
    this.newResourceProcs["StylesMap"] = newAttribute;
    this.newResourceProcs["LabelStyle"] = newAttribute;
    this.newResourceProcs["IconStyle"] = newAttribute;
    this.newResourceProcs["FontStyle"] = newAttribute;
    this.newResourceProcs["HTMLLabelStyle"] = newAttribute;
    this.newResourceProcs["BalloonTipLabelStyle"] = newAttribute;
    this.newResourceProcs["RenderableElementStyle"] = newAttribute;
    this.newResourceProcs["Serializer"] = newAttribute;
    this.newResourceProcs["Bone"] = newAttribute;

    // nodes
    this.newResourceProcs["DirectionalLight"] = newSGNode;
    this.newResourceProcs["GlobalIllumination"] = newSGNode;
    this.newResourceProcs["Group"] = newSGNode;
    this.newResourceProcs["Isolator"] = newSGNode;
    this.newResourceProcs["Label"] = newSGNode;
    this.newResourceProcs["HTMLLabel"] = newSGNode;
    this.newResourceProcs["BalloonTipLabel"] = newSGNode;
    this.newResourceProcs["LineList"] = newSGNode;
    this.newResourceProcs["MediaTexture"] = newSGNode;
    this.newResourceProcs["Model"] = newModel;
    this.newResourceProcs["OrthographicCamera"] = newSGNode;
    this.newResourceProcs["PerspectiveCamera"] = newSGNode;
    this.newResourceProcs["PointLight"] = newSGNode;
    this.newResourceProcs["PointList"] = newSGNode;
    this.newResourceProcs["QuaternionRotate"] = newSGNode;
    this.newResourceProcs["Rotate"] = newSGNode;
    this.newResourceProcs["Scale"] = newSGNode;
    this.newResourceProcs["Selector"] = newSGNode;
    this.newResourceProcs["Surface"] = newSGNode;
    this.newResourceProcs["Translate"] = newSGNode;
    this.newResourceProcs["Transform"] = newSGNode;
    this.newResourceProcs["TriList"] = newSGNode;
    this.newResourceProcs["NullObject"] = newSGNode;
    this.newResourceProcs["Material"] = newSGNode;
    this.newResourceProcs["ScreenRect"] = newSGNode;
    this.newResourceProcs["SnapModel"] = newSnapModel;
    this.newResourceProcs["Beam"] = newShape;
    this.newResourceProcs["Box"] = newShape;
    this.newResourceProcs["Elbow"] = newShape;
    this.newResourceProcs["Gear"] = newShape;
    this.newResourceProcs["Plank"] = newShape;
    this.newResourceProcs["Pyramid"] = newShape;
    this.newResourceProcs["Ring"] = newShape;
    this.newResourceProcs["Ball"] = newShape;
    this.newResourceProcs["Tube"] = newShape;
    this.newResourceProcs["Wall"] = newShape;
    this.newResourceProcs["Wedge"] = newShape;

    // directives
    this.newResourceProcs["BBoxDirective"] = newSGDirective;
    this.newResourceProcs["RayPickDirective"] = newSGDirective;
    this.newResourceProcs["RenderDirective"] = newSGDirective;
    this.newResourceProcs["SerializeDirective"] = newSGDirective;
    this.newResourceProcs["UpdateDirective"] = newSGDirective;
    this.newResourceProcs["CollideDirective"] = newSGDirective;
    this.newResourceProcs["HighlightDirective"] = newSGDirective;

    // evaluators
    this.newResourceProcs["BBoxLocator"] = newBBoxLocator;
    this.newResourceProcs["KeyframeInterpolator"] = newKeyframeInterpolator;
    this.newResourceProcs["MapProjectionCalculator"] = newMapProjectionCalculator;
    this.newResourceProcs["ObjectInspector"] = newObjectInspector;
    this.newResourceProcs["SceneInspector"] = newSceneInspector;
    this.newResourceProcs["TargetObserver"] = newTargetObserver;
    this.newResourceProcs["AnimalMover"] = newAnimalMover;
    this.newResourceProcs["WalkSimulator"] = newWalkSimulator;
    this.newResourceProcs["MorphEffector"] = newMorphEffector;
    this.newResourceProcs["BoneEffector"] = newBoneEffector;
    this.newResourceProcs["PhysicsSimulator"] = newPhysicsSimulator;
    this.newResourceProcs["GoblinPhysicsSimulator"] = newGoblinPhysicsSimulator;
    this.newResourceProcs["CannonPhysicsSimulator"] = newCannonPhysicsSimulator;
    this.newResourceProcs["Spinner"] = newAnimator;

    // commands
    this.newResourceProcs["AppendNode"] = newCommand;
    this.newResourceProcs["AutoInterpolate"] = newCommand;
    this.newResourceProcs["CommandSequence"] = newCommand;
    this.newResourceProcs["ConnectAttributes"] = newCommand;
    this.newResourceProcs["ConnectOutputs"] = newCommand;
    this.newResourceProcs["DisconnectAttributes"] = newCommand;
    this.newResourceProcs["DisconnectOutputs"] = newCommand;
    this.newResourceProcs["Export"] = newCommand;
    this.newResourceProcs["Locate"] = newCommand;
    this.newResourceProcs["MotionInterpolate"] = newCommand;
    this.newResourceProcs["Pause"] = newCommand;
    this.newResourceProcs["Play"] = newCommand;
    this.newResourceProcs["Remove"] = newCommand;
    this.newResourceProcs["ScreenCapture"] = newCommand;
    this.newResourceProcs["Serialize"] = newCommand;
    this.newResourceProcs["Set"] = newCommand;
    this.newResourceProcs["Stop"] = newCommand;
    this.newResourceProcs["Morph"] = newCommand;
    this.newResourceProcs["SnapTo"] = newCommand;

    // device handlers
    this.newResourceProcs["MouseHandler"] = newDeviceHandler;
    this.newResourceProcs["KeyboardHandler"] = newDeviceHandler;
}

AttributeFactory.prototype.initializeConfigureMap = function()
{
    // nodes
    this.configureProcs["Model"] = configureModel;

    // directives
    this.configureProcs["BBoxDirective"] = configureDirective;
    this.configureProcs["RayPickDirective"] = configureDirective;
    this.configureProcs["RenderDirective"] = configureDirective;
    this.configureProcs["SerializeDirective"] = configureDirective;
    this.configureProcs["UpdateDirective"] = configureDirective;
    this.configureProcs["CollideDirective"] = configureDirective;
    this.configureProcs["HighlightDirective"] = configureDirective;
}

AttributeFactory.prototype.initializeFinalizeMap = function()
{
    // nodes
    this.finalizeProcs["Model"] = finalizeModel;
    this.finalizeProcs["Beam"] = finalizeModel;
    this.finalizeProcs["Box"] = finalizeModel;
    this.finalizeProcs["Elbow"] = finalizeModel;
    this.finalizeProcs["Gear"] = finalizeModel;
    this.finalizeProcs["Plank"] = finalizeModel;
    this.finalizeProcs["Pyramid"] = finalizeModel;
    this.finalizeProcs["Ring"] = finalizeModel;
    this.finalizeProcs["Ball"] = finalizeModel;
    this.finalizeProcs["Tube"] = finalizeModel;
    this.finalizeProcs["Wall"] = finalizeModel;
    this.finalizeProcs["Wedge"] = finalizeModel;

    // directives
    this.finalizeProcs["BBoxDirective"] = finalizeDirective;
    this.finalizeProcs["RayPickDirective"] = finalizeDirective;
    this.finalizeProcs["RenderDirective"] = finalizeDirective;
    this.finalizeProcs["SerializeDirective"] = finalizeDirective;
    this.finalizeProcs["UpdateDirective"] = finalizeDirective;
    this.finalizeProcs["CollideDirective"] = finalizeDirective;
    this.finalizeProcs["HighlightDirective"] = finalizeDirective;

    // evaluators 
    this.finalizeProcs["KeyframeInterpolator"] = finalizeEvaluator;

    // commands
    this.finalizeProcs["AppendNode"] = finalizeCommand;
    this.finalizeProcs["AutoInterpolate"] = finalizeCommand;
    this.finalizeProcs["CommandSequence"] = finalizeCommand;
    this.finalizeProcs["ConnectAttributes"] = finalizeCommand;
    this.finalizeProcs["ConnectOutputs"] = finalizeCommand;
    this.finalizeProcs["DisconnectAttributes"] = finalizeCommand;
    this.finalizeProcs["DisconnectOutputs"] = finalizeCommand;
    this.finalizeProcs["Export"] = finalizeCommand;
    this.finalizeProcs["Locate"] = finalizeCommand;
    this.finalizeProcs["MotionInterpolate"] = finalizeCommand;
    this.finalizeProcs["Pause"] = finalizeCommand;
    this.finalizeProcs["Play"] = finalizeCommand;
    this.finalizeProcs["Remove"] = finalizeCommand;
    this.finalizeProcs["ScreenCapture"] = finalizeCommand;
    this.finalizeProcs["Serialize"] = finalizeCommand;
    this.finalizeProcs["Set"] = finalizeCommand;
    this.finalizeProcs["Stop"] = finalizeCommand;
    this.finalizeProcs["Morph"] = finalizeCommand;
    this.finalizeProcs["SnapTo"] = finalizeCommand;

    // device handlers
    this.finalizeProcs["MouseHandler"] = finalizeDeviceHandler;
    this.finalizeProcs["KeyboardHandler"] = finalizeDeviceHandler;
}

AttributeFactory.prototype.setRegistry = function(registry)
{
    this.registry = registry;
}

AttributeFactory.prototype.setGraphMgr = function(graphMgr)
{
    this.graphMgr = graphMgr;
}

function newAttribute(name, factory)
{
    var resource = null;

    switch (name)
    {
        case "BalloonTipLabelStyleAttr":
            resource = new BalloonTipLabelStyleAttr();
            break;
        case "BBoxAttr":
            resource = new BBoxAttr();
            break;
        case "BooleanAttr":
            resource = new BooleanAttr();
            break;
        case "ColorAttr":
            resource = new ColorAttr();
            break;
        case "FontStyleAttr":
            resource = new FontStyleAttr();
            break;
        case "IconStyleAttr":
            resource = new IconStyleAttr();
            break;
        case "ImageAttr":
            resource = new ImageAttr();
            break;
        case "KeyframeAttr":
            resource = new KeyframeAttr();
            break;
        case "KeyframesAttr":
            resource = new KeyframesAttr();
            break;
        case "LabelStyleAttr":
            resource = new LabelStyleAttr();
            break;
        case "HTMLLabelStyleAttr":
            resource = new HTMLLabelStyleAttr();
            break;
        case "NumberArrayAttr":
            resource = new NumberArrayAttr();
            break;
        case "NumberAttr":
            resource = new NumberAttr();
            break;
        case "Matrix4x4Attr":
            resource = new Matrix4x4Attr();
            break;
        case "PlaneAttr":
            resource = new PlaneAttr();
            break;
        case "PulseAttr":
            resource = new PulseAttr();
            break;
        case "QuaternionAttr":
            resource = new QuaternionAttr();
            break;
        case "RectAttr":
            resource = new RectAttr();
            break;
        case "ReferenceAttr":
            resource = new ReferenceAttr();
            break;
        case "StringAttr":
            resource = new StringAttr();
            break;
        case "StyleAttr":
            resource = new StyleAttr();
            break;
        case "StylesAttr":
            resource = new StylesAttr();
            break;
        case "StyleMapAttr":
            resource = new StyleMapAttr();
            break;
        case "StylesMapAttr":
            resource = new StylesMapAttr();
            break;
        case "Vector2DAttr":
            resource = new Vector2DAttr();
            break;
        case "Vector3DAttr":
            resource = new Vector3DAttr();
            break;
        case "ViewportAttr":
            resource = new ViewportAttr();
            break;
        case "ViewVolumeAttr":
            resource = new ViewVolumeAttr();
            break;
        case "RenderableElementStyleAttr":
            resource = new RenderableElementStyleAttr();
            break;
        case "Serializer":
            resource = new Serializer();
            break;
        case "Bone":
            resource = new Bone();
            break;
    }

    return resource;
}

function newSGNode(name, factory)
{
    var resource = null;

    switch (name)
    {
        case "DirectionalLight":
            resource = new DirectionalLight();
            registerParentableAttributes(resource, factory);
            break;
        case "GlobalIllumination":
            resource = new GlobalIllumination();
            break;
        case "Group":
            resource = new Group();
            break;
        case "Isolator":
            resource = new Isolator();
            break;
        case "Label":
            resource = new Label();
            break;
        case "HTMLLabel":
            resource = new HTMLLabel();
            break;
        case "BalloonTipLabel":
            resource = new BalloonTipLabel();
            break;
        case "LineList":
            resource = new LineList();
            break;
        case "MediaTexture":
            resource = new MediaTexture();
            break;
        case "OrthographicCamera":
            resource = new OrthographicCamera();
            registerParentableAttributes(resource, factory);
            break;
        case "PerspectiveCamera":
            resource = new PerspectiveCamera();
            registerParentableAttributes(resource, factory);
            break;
        case "PointLight":
            resource = new PointLight();
            registerParentableAttributes(resource, factory);
            break;
        case "PointList":
            resource = new PointList();
            break;
        case "QuaternionRotate":
            resource = new QuaternionRotate();
            break;
        case "Rotate":
            resource = new Rotate();
            break;
        case "Scale":
            resource = new Scale();
            break;
        case "Selector":
            resource = new Selector();
            break;
        case "Surface":
            resource = new Surface();
            break;
        case "Transform":
            resource = new Transform();
            break;
        case "Translate":
            resource = new Translate();
            break;
        case "TriList":
            resource = new TriList();
            break;
        case "NullObject":
            resource = new NullObject();
            registerParentableAttributes(resource, factory);
            break;
        case "Material":
            resource = new Material();
            break;
        case "ScreenRect":
            resource = new ScreenRect();
            break;
    }

    if (resource)
    {
        resource.setGraphMgr(factory.graphMgr);
    }

    return resource;
}

function newSGDirective(name, factory)
{
    var resource = null;

    switch (name)
    {
        case "BBoxDirective":
            resource = new BBoxDirective();
            break;
        case "RayPickDirective":
            resource = new RayPickDirective();
            break;
        case "RenderDirective":
            resource = new RenderDirective();
            break;
        case "SerializeDirective":
            resource = new SerializeDirective();
            break;
        case "UpdateDirective":
            resource = new UpdateDirective();
            break;
        case "CollideDirective":
            resource = new CollideDirective();
            break;
        case "HighlightDirective":
            resource = new HighlightDirective();
            break;
    }

    if (resource)
    {
        resource.setGraphMgr(factory.graphMgr);
    }

    return resource;
}

function newModel(name, factory)
{
    var resource = new Model();
    resource.setGraphMgr(factory.graphMgr);
    registerParentableAttributes(resource, factory);
    addInspectionGroup(resource, factory);
    return resource;
}

function newSnapModel(name, factory)
{
    var resource = new SnapModel();
    resource.setGraphMgr(factory.graphMgr);
    registerParentableAttributes(resource, factory);
    addInspectionGroup(resource, factory);
    return resource;
}

function newShape(name, factory)
{
    var resource = null;
    
    switch (name)
    {
        case "Ball":
            resource = new Ball();
            break;
        case "Beam":
            resource = new Beam();
            break;
        case "Box":
            resource = new Box();
            break;
        case "Elbow":
            resource = new Elbow();
            break;
        case "Gear":
            resource = new Gear();
            break;
        case "Plank":
            resource = new Plank();
            break;
        case "Pyramid":
            resource = new Pyramid();
            break;
        case "Ring":
            resource = new Ring();
            break;
        case "Tube":
            resource = new Tube();
            break;
        case "Wall":
            resource = new Wall();
            break;
        case "Wedge":
            resource = new Wedge();
            break;
    }
    
    if (resource)
    {
        resource.setGraphMgr(factory.graphMgr);
        registerParentableAttributes(resource, factory);
        addInspectionGroup(resource, factory);
    }
    
    return resource;
}

function newBBoxLocator(name, factory)
{
    var resource = new BBoxLocator();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newKeyframeInterpolator(name, factory)
{
    var resource = new KeyframeInterpolator();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newMapProjectionCalculator(name, factory)
{
    var resource = new MapProjectionCalculator();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newObjectInspector(name, factory)
{
    var resource = new ObjectInspector();

    registerEvaluatorAttributes(resource, factory);

    // target the Inspector's selection flag with the selector's clickPoint
    var selector = factory.registry.find("Selector");
    if (selector)
    {
        selector.getAttribute("selectionOccurred").addTarget(
                resource.getAttribute("selectionOccurred"), eAttrSetOp.Replace, null, false);

        selector.getAttribute("selectionCleared").addTarget(
                resource.getAttribute("selectionCleared"), eAttrSetOp.Replace, null, false);

        selector.getAttribute("pointView").addTarget(
                resource.getAttribute("pointView"), eAttrSetOp.Replace, null, false);
    }

    return resource;
}

function newSceneInspector(name, factory)
{
    var resource = new BwSceneInspector();

    registerEvaluatorAttributes(resource, factory);

    // target the Inspector's selection flag with the selector's clickPoint
    // target the Inspector's pivotDistance with the selector's distanceFromScreenCenter
    var selector = factory.registry.find("Selector");
    if (selector)
    {
        selector.getAttribute("selectionOccurred").addTarget(
                resource.getAttribute("selectionOccurred"), eAttrSetOp.Replace, null, false);

        selector.getAttribute("distanceFromScreenCenter").addTarget(
                resource.getAttribute("pivotDistance"), eAttrSetOp.Replace, null, false);
    }

    return resource;
}

function newTargetObserver(name, factory)
{
    var resource = new BwTargetObserver();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newAnimalMover(name, factory)
{
    var resource = new AnimalMover();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newWalkSimulator(name, factory)
{
    var resource = new WalkSimulator();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newMorphEffector(name, factory)
{
    var resource = new MorphEffector();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newBoneEffector(name, factory)
{
    var resource = new BoneEffector();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newPhysicsSimulator(name, factory)
{
    var resource = new PhysicsSimulator();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newGoblinPhysicsSimulator(name, factory)
{
    var resource = new GoblinPhysicsSimulator();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newCannonPhysicsSimulator(name, factory)
{
    var resource = new CannonPhysicsSimulator();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newAnimator(name, factory)
{
    var resource = null;
    
    switch (name)
    {
        case "Spinner":
            resource = new Spinner();
            break;
    }
    
    return resource;
}

function newCommand(name, factory)
{
    var resource = null;

    switch (name)
    {
        case "AppendNode":
            resource = new AppendNodeCommand();
            break;
        case "AutoInterpolate":
            resource = new AutoInterpolateCommand();
            break;
        case "CommandSequence":
            resource = new CommandSequence();
            break;
        case "ConnectAttributes":
            resource = new ConnectAttributesCommand();
            break;
        case "ConnectOutputs":
            resource = new ConnectAttributesCommand();
            break;
        case "DisconnectAttributes":
            resource = new ConnectAttributesCommand();
            resource.getAttribute("negate").setValueDirect(true);
            break;
        case "DisconnectOutputs":
            resource = new ConnectAttributesCommand();
            resource.getAttribute("negate").setValueDirect(true);
            break;
        case "Export":
            resource = new ExportCommand();
            break;
        case "Locate":
            resource = new LocateCommand();
            break;
        case "MotionInterpolate":
            resource = new MotionInterpolateCommand();
            break;
        case "Pause":
            resource = new PlayCommand();
            resource.getAttribute("negate").setValueDirect(true);
            break;
        case "Play":
            resource = new PlayCommand();
            break;
        case "Remove":
            resource = new RemoveCommand();
            break;
        case "ScreenCapture":
            resource = new ScreenCaptureCommand();
            break;
        case "Serialize":
            resource = new SerializeCommand();
            break;
        case "Set":
            resource = new SetCommand();
            break;
        case "Stop":
            resource = new StopCommand();
            break;
        case "Morph":
            resource = new MorphCommand();
            break;
        case "SnapTo":
            resource = new SnapToCommand();
            break;
    }

    // if command sequence, set to command mgr
    if (name == "CommandSequence")
    {
        var commandMgr = factory.registry.find("CommandMgr");
        if (commandMgr)
        {
            commandMgr.pushCommandSequence(resource);
        }
    }

    return resource;
}

function newDeviceHandler(name, factory)
{
    var resource = null;

    switch (name)
    {
        case "MouseHandler":
            resource = new MouseHandler();
            break;
        case "KeyboardHandler":
            resource = new KeyboardHandler();
            break;
    }

    return resource;
}

function configureModel(model, factory)
{
    // TODO
    console.debug("TODO: " + arguments.callee.name);
}

function configureDirective(directive, factory)
{
    var root = new StringAttr("");
    root.addModifiedCB(AttributeFactory_DirectiveRootModifiedCB, factory);
    directive.registerAttribute(root, "root");

    var rootNode = factory.registry.getAttribute("rootPtr").getValueDirect();
    if (rootNode)
    {
        root.setValueDirect(rootNode.getAttribute("name").getValueDirect().join(""));
    }
}

function finalizeModel(model, factory)
{
    // TODO
    console.debug("TODO: remove LWO assumption");

    var url = model.getAttribute("url").getValueDirect();
    if (url) {

        url = url.join("");

        var pathInfo = formatPath(url);
        console.debug("path: " + pathInfo[0]);
        console.debug("content dir: " + pathInfo[1]);

        var contentHandler = new LWObjectHandler();
        contentHandler.getAttribute("contentDirectory").setValueDirect(pathInfo[1]);

        var contentBuilder = new LWObjectBuilder();
        contentBuilder.setRegistry(factory.registry);
        contentBuilder.models.push(model);
        contentBuilder.layer = model.getAttribute("layer").getValueDirect();
        contentBuilder.visitHandler(contentHandler);

        contentHandler.parseFileStream(pathInfo[0]);
    }
    
    // add to Bridgeworks' physics simulator
    var bworks = factory.registry.find("Bridgeworks");
    bworks.physicsSimulator.bodies.push_back(model.name);
}

function finalizeDirective(directive, factory)
{
}

function finalizeCommand(command, factory)
{
    command.finalize();

    var commandMgr = factory.registry.find("CommandMgr");
    if (commandMgr)
    {
        // if command sequence, clear from command mgr
        if (command.className == "CommandSequence")
        {
            commandMgr.popCommandSequence();
        }

        commandMgr.addCommand(command);
    }
}

function finalizeDeviceHandler(handler, factory)
{
    var eventMgr = factory.registry.find("EventMgr");
    if (eventMgr)
    {
        var events = handler.getEventTypes();
        for (var i = 0; i < events.length; i++)
        {
            eventMgr.addListener(events[i], handler);
        }
    }
}

function finalizeEvaluator(evaluator, factory)
{
    // TODO
    console.debug("TODO: " + arguments.callee.name);

    switch (evaluator.className)
    {
        case "KeyframeInterpolator":

            var url = evaluator.getAttribute("url").getValueDirect();
            if (url) {

                url = url.join("");

                var pathInfo = formatPath(url);

                var contentHandler = new LWSceneHandler();
                contentHandler.getAttribute("contentDirectory").setValueDirect(pathInfo[1]);

                var contentBuilder = new LWSceneBuilder();
                contentBuilder.setRegistry(factory.registry);
                contentBuilder.evaluators.push(evaluator);
                contentBuilder.visitHandler(contentHandler);

                contentHandler.parseFileStream(pathInfo[0]);
            }
            AttributeFactory_EvaluatorTargetConnectionTypeModifiedCB(evaluator.getAttribute("targetConnectionType"), factory);
            break;
    }
}

function registerEvaluatorAttributes(evaluator, factory)
{
    // url
    if (!evaluator.getAttribute("url"))
    {
        var url = new StringAttr("");
        evaluator.registerAttribute(url, "url");
    }

    // target
    if (!evaluator.getAttribute("target"))
    {
        var target = new StringAttr("");
        evaluator.registerAttribute(target, "target");
    }

    // renderAndRelease
    if (!evaluator.getAttribute("renderAndRelease"))
    {
        var renderAndRelease = new BooleanAttr(false);
        evaluator.registerAttribute(renderAndRelease, "renderAndRelease");
    }

    // targetConnectionType
    if (!evaluator.getAttribute("targetConnectionType"))
    {
        var targetConnectionType = new StringAttr("transform");
        targetConnectionType.addModifiedCB(AttributeFactory_EvaluatorTargetConnectionTypeModifiedCB, factory);
        evaluator.registerAttribute(targetConnectionType, "targetConnectionType");
    }
}

function registerParentableAttributes(pme, factory)
{
    // label
    if (!pme.getAttribute("label"))
    {
        var label = new StringAttr("");
        pme.registerAttribute(label, "label");
        label.addModifiedCB(AttributeFactory_ParentableLabelModifiedCB, factory);
    }

    // geoPosition
    if (!pme.getAttribute("geoPosition"))
    {
        var geoPosition = new Vector3DAttr();
        pme.registerAttribute(geoPosition, "geoPosition");
        geoPosition.addModifiedCB(AttributeFactory_ParentableGeoPositionModifiedCB, factory);
    }

    // altitude
    if (!pme.getAttribute("altitude"))
    {
        var altitude = new NumberAttr();
        pme.registerAttribute(altitude, "altitude");
    }

    // latitude
    if (!pme.getAttribute("latitude"))
    {
        var latitude = new NumberAttr();
        pme.registerAttribute(latitude, "latitude");
    }

    // longitude
    if (!pme.getAttribute("longitude"))
    {
        var longitude = new NumberAttr();
        pme.registerAttribute(longitude, "longitude");
    }

    // misc modified callbacks
    pme.getAttribute("worldCenter").addModifiedCB(AttributeFactory_ParentableWorldPositionModifiedCB, factory);
}

function getSceneGraph()
{
    return this.sceneGraph;
}

function AttributeFactory_DirectiveRootModifiedCB(root, factory)
{
    var directive = root.getContainer();
    var resources = factory.registry.getByName(root.getValueDirect().join(""));
    if (resources)
    {
        directive.getAttribute("rootNode").setValueDirect(resources[0]);
    }
}

function AttributeFactory_ParentableLabelModifiedCB(attribute, container)
{
    console.debug("TODO: " + arguments.callee.name);
}

function AttributeFactory_ParentableGeoPositionModifiedCB(attribute, container)
{
    var pme = attribute.getContainer();
    if (pme)
    {
        var cms = container.registry.getByName("ConnectionMgr");
        if (cms && cms.length)
        {
            var cm = cms[0];

            var mpcs = container.registry.getByType(eAttrType.MapProjectionCalculator);
            if (mpcs && mpcs.length)
            {
                var mpc = mpcs[0];

                mpc.getAttribute("geoPosition").copyValue(attribute);

                cm.connectMapProjectionCalculator(mpc, pme);
                cm.disconnectMapProjectionCalculator(mpc, pme);
            }
        }
    }
}

function AttributeFactory_ParentableWorldPositionModifiedCB(attribute, container)
{
    // TODO
    //console.debug("TODO: " + arguments.callee.name);
}

function AttributeFactory_EvaluatorTargetConnectionTypeModifiedCB(attribute, container)
{
    var evaluator = attribute.getContainer();
    if (evaluator)
    {
        var connect = new ConnectAttributesCommand();
        connect.setRegistry(container.registry);
        connect.getAttribute("sourceContainer").copyValue(evaluator.getAttribute("name"));
        connect.getAttribute("targetContainer").copyValue(evaluator.getAttribute("target"));
        connect.getAttribute("connectionType").copyValue(attribute);
        connect.execute();
    }
}
var bridgeworks = null;

Bridgeworks.prototype = new AttributeContainer();
Bridgeworks.prototype.constructor = Bridgeworks;

function Bridgeworks(canvas, bgImage, contentDir)
{
    AttributeContainer.call(this);
    this.className = "Bridgeworks";

    this.renderContext =  newRenderContext("webgl", canvas, bgImage);
    if (!this.renderContext) return;

    contentDir = contentDir == null? "BwContent" : contentDir;

    this.canvas = canvas;
    this.contentDir = contentDir;

    this.name = new StringAttr("Bridgeworks");
    this.onLoad = new StringAttr();

    this.onLoad.addModifiedCB(Bridgeworks_OnLoadModifiedCB, this);

    this.registerAttribute(this.name, "name");
    this.registerAttribute(this.onLoad, "onLoad");
    
    // allocate objects
    this.registry = new BwRegistry();
    this.registry.register(this); // need to set here for objects that might need Bridgeworks on call to setRegistry
        
    //this.renderContext = null;
    this.graphMgr = new GraphMgr();
    this.graphMgr.setRenderContext(this.renderContext)

    this.styleMgr = new StyleMgr();  
    this.factory = new AttributeFactory();
    this.parser = new XMLParser(this.factory, this.registry, this.contentDir);
    this.eventAdapter = new EventAdapter();
    this.eventMgr = new EventMgr();
    this.commandMgr = new CommandMgr();
    this.connectionMgr = new ConnectionMgr();
    this.viewportMgr = new ViewportMgr();
    this.selector = new SelectionListener();
    this.rayPick = new RayPickDirective();
    this.renderAgent = new RenderAgent(this);
    this.renderController = new RenderController(this);
    this.layout = new GridLayout();
    this.mapProjectionCalculator = new MapProjectionCalculator();
    this.rasterComponentEventListener = new RasterComponentEventListener();
    this.snapMgr = new SnapMgr();
    this.physicsSimulator = new PhysicsSimulator();

    // set registry to allocated objects
    this.graphMgr.setRegistry(this.registry);
    this.factory.setRegistry(this.registry);
    this.eventAdapter.setRegistry(this.registry);
    this.eventMgr.setRegistry(this.registry);
    this.commandMgr.setRegistry(this.registry);
    this.connectionMgr.setRegistry(this.registry);
    this.viewportMgr.setRegistry(this.registry);
    this.selector.setRegistry(this.registry);
    this.renderAgent.setRegistry(this.registry);
    this.layout.setRegistry(this.registry);
    this.mapProjectionCalculator.setRegistry(this.registry);
    this.rasterComponentEventListener.setRegistry(this.registry);
    this.snapMgr.setRegistry(this.registry);
    this.physicsSimulator.setRegistry(this.registry);

    // configure dependencies
    this.factory.setGraphMgr(this.graphMgr);
    this.selector.setRayPick(this.rayPick);
    this.rasterComponentEventListener.setStyleMgr(this.styleMgr);
    this.rasterComponents = null;
    this.physicsSimulator.orphan.setValueDirect(false); // evaluated by renders (true to disable)

    this.viewportMgr.getAttribute("width").setValueDirect(this.canvas.width);
    this.viewportMgr.getAttribute("height").setValueDirect(this.canvas.height);
    this.viewportMgr.getAttribute("layout").setValueDirect(this.layout);

    enumerateAttributeTypes();
    enumerateAttributeElementTypes();

    // TODO: remove the following when onLoadModified is defined
    console.debug("TODO: " + arguments.callee.name);
    this.initRegistry();
    this.initEventListeners();
    this.viewportMgr.initLayout();
}

Bridgeworks.prototype.get = function(name) {
  return this.registry.find(name);
}

Bridgeworks.prototype.handleEvent = function(event, eventType /* optional type override */)
{
    var bwEvent = null;

    switch (getObjectClassName(event))
    {
        case "MouseEvent":
        case "MouseEventConstructor": // Safari
        case "WheelEvent":
            {
                var absPos = getElementAbsolutePos(this.canvas);
                event.canvasX = event.clientX - absPos.x;
                event.canvasY = event.clientY - absPos.y;
                bwEvent = this.eventAdapter.createMouseEvent(event);
            }
            break;
        
        case "KeyboardEvent":
        case "KeyboardEventConstructor": // Safari
            {
                bwEvent = this.eventAdapter.createKeyboardEvent(event, eventType);
            }
            break;
            
        default:
            break;
    }

    if (bwEvent)
    {
        this.eventMgr.processEvent(bwEvent);
    }
}

Bridgeworks.prototype.initRegistry = function()
{
    // register this (if not already)
    if (!this.registry.find("Bridgeworks"))
    {
        this.registry.register(this);
    }
    
    // register allocated objects
    this.registry.register(this.graphMgr);
    this.registry.register(this.factory);
    this.registry.register(this.eventAdapter);
    this.registry.register(this.eventMgr);
    this.registry.register(this.commandMgr);
    this.registry.register(this.connectionMgr);
    this.registry.register(this.viewportMgr);
    this.registry.register(this.selector);
    this.registry.register(this.renderAgent);
    this.registry.register(this.layout);
    this.registry.register(this.mapProjectionCalculator);
    this.registry.register(this.rasterComponentEventListener);
    this.registry.register(this.snapMgr);
    this.registry.register(this.physicsSimulator);

    // backward compatibility
    this.registry.registerByName(this.renderAgent, "AnimationAgent");
}

Bridgeworks.prototype.initEventListeners = function()
{
    // selector
    this.eventMgr.addListener(eEventType.MouseLeftDown, this.selector);
    this.eventMgr.addListener(eEventType.MouseLeftDblClick, this.selector);
    this.eventMgr.addListener(eEventType.MouseMiddleDown, this.selector);
    this.eventMgr.addListener(eEventType.MouseRightDown, this.selector);
    this.eventMgr.addListener(eEventType.MouseBothDown, this.selector);
    this.eventMgr.addListener(eEventType.MouseHover, this.selector);
    //this.eventMgr.addListener(eMOUSE_MOVE, this.selector);

    // raster component event listener
    this.eventMgr.addListener(eEventType.MouseLeftDown, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseLeftUp, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseLeftClick, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseLeftDblClick, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseMiddleDown, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseMiddleUp, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseMiddleClick, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseMiddleDblClick, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseRightDown, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseRightUp, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseRightClick, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseRightDblClick, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseWheelDown, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseWheelUp, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseBothDown, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseHover, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseMove, this.rasterComponentEventListener);
}

Bridgeworks.prototype.onLoadModified = function()
{
    this.renderAgent.stop();
    //this.iscetAgent.stop(); There is no isectAgent in javascript version
    this.selector.stop();
    this.rasterComponentEventListener.stop();

    this.commandMgr.clearCommandSequenceStack();
    this.eventMgr.clearEvents();
    $('#RasterComponents').empty();
    //this.resouceMgr.clear(); There is no resourceMgr in javascript version
    this.selector.clearSelections();
    this.selector.getAttribute("lastSelectedName").setValueDirect("");
    this.viewportMgr.initLayout();

    this.registry.clear();
    g__nodeId__ = 0; // reset node ID counter
    
    this.initEventListeners();
    this.initRegistry();

    this.renderAgent.getAttribute("globalTimeInSecs").setValueDirect(0);

    this.graphMgr.reset();

    this.renderAgent.start();
    //this.iscetAgent.start(); There is no isectAgent in javascript version
    this.selector.start();
    this.rasterComponentEventListener.start();
    
    this.physicsSimulator.bodies.clear();
    this.physicsSimulator.deletePhysicsBodies();
    
    // TODO
    console.debug("TODO: " + arguments.callee.name);
}

Bridgeworks.prototype.resize = function(width, height)
{
    this.canvas.width = width;
    this.canvas.height = height;
    this.renderContext.setViewport(this.canvas.offsetLeft, this.canvas.offsetTop, width, height);

    this.viewportMgr.getAttribute("width").setValueDirect(width);
    this.viewportMgr.getAttribute("height").setValueDirect(height);
}

Bridgeworks.prototype.render = function()
{
    this.eventMgr.processEvent(new Event(eEventType.RenderBegin));

    this.renderContext.clear();
    this.renderAgent.render();

    this.eventMgr.processEvent(new Event(eEventType.RenderEnd));
}

Bridgeworks.prototype.setRenderContext = function(rc)
{
    this.renderContext = rc;
    this.graphMgr.setRenderContext(rc);
}

Bridgeworks.prototype.updateScene = function(xml)
{
    var xmlString = new String(xml);
    var extension = xmlString.substr(xmlString.length - 3, 3);
    if (extension == "xml")
    {
        xml = loadXMLResource(this.contentDir + "/" + xml);
    }

    // disable physics while parsing
    //var evaluate = this.physicsSimulator.evaluate_.getValueDirect();
    
    this.parser.parse(xml);
    
    // restore physics evaluate state
    //this.physicsSimulator.evaluate_.setValueDirect(evaluate);
}

function Bridgeworks_OnLoadModifiedCB(attribute, container)
{
    container.onLoadModified();
}

/*! jQuery v1.10.2 | (c) 2005, 2013 jQuery Foundation, Inc. | jquery.org/license
 //@ sourceMappingURL=jquery-1.10.2.min.map
 */
(function (e, t) {
    var n, r, i = typeof t, o = e.location, a = e.document, s = a.documentElement, l = e.jQuery, u = e.$, c = {}, p = [], f = "1.10.2", d = p.concat, h = p.push, g = p.slice, m = p.indexOf, y = c.toString, v = c.hasOwnProperty, b = f.trim, x = function (e, t) {
        return new x.fn.init(e, t, r)
    }, w = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source, T = /\S+/g, C = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, N = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/, k = /^<(\w+)\s*\/?>(?:<\/\1>|)$/, E = /^[\],:{}\s]*$/, S = /(?:^|:|,)(?:\s*\[)+/g, A = /\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g, j = /"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g, D = /^-ms-/, L = /-([\da-z])/gi, H = function (e, t) {
        return t.toUpperCase()
    }, q = function (e) {
        (a.addEventListener || "load" === e.type || "complete" === a.readyState) && (_(), x.ready())
    }, _ = function () {
        a.addEventListener ? (a.removeEventListener("DOMContentLoaded", q, !1), e.removeEventListener("load", q, !1)) : (a.detachEvent("onreadystatechange", q), e.detachEvent("onload", q))
    };
    x.fn = x.prototype = {jquery: f, constructor: x, init: function (e, n, r) {
        var i, o;
        if (!e)return this;
        if ("string" == typeof e) {
            if (i = "<" === e.charAt(0) && ">" === e.charAt(e.length - 1) && e.length >= 3 ? [null, e, null] : N.exec(e), !i || !i[1] && n)return!n || n.jquery ? (n || r).find(e) : this.constructor(n).find(e);
            if (i[1]) {
                if (n = n instanceof x ? n[0] : n, x.merge(this, x.parseHTML(i[1], n && n.nodeType ? n.ownerDocument || n : a, !0)), k.test(i[1]) && x.isPlainObject(n))for (i in n)x.isFunction(this[i]) ? this[i](n[i]) : this.attr(i, n[i]);
                return this
            }
            if (o = a.getElementById(i[2]), o && o.parentNode) {
                if (o.id !== i[2])return r.find(e);
                this.length = 1, this[0] = o
            }
            return this.context = a, this.selector = e, this
        }
        return e.nodeType ? (this.context = this[0] = e, this.length = 1, this) : x.isFunction(e) ? r.ready(e) : (e.selector !== t && (this.selector = e.selector, this.context = e.context), x.makeArray(e, this))
    }, selector: "", length: 0, toArray: function () {
        return g.call(this)
    }, get: function (e) {
        return null == e ? this.toArray() : 0 > e ? this[this.length + e] : this[e]
    }, pushStack: function (e) {
        var t = x.merge(this.constructor(), e);
        return t.prevObject = this, t.context = this.context, t
    }, each: function (e, t) {
        return x.each(this, e, t)
    }, ready: function (e) {
        return x.ready.promise().done(e), this
    }, slice: function () {
        return this.pushStack(g.apply(this, arguments))
    }, first: function () {
        return this.eq(0)
    }, last: function () {
        return this.eq(-1)
    }, eq: function (e) {
        var t = this.length, n = +e + (0 > e ? t : 0);
        return this.pushStack(n >= 0 && t > n ? [this[n]] : [])
    }, map: function (e) {
        return this.pushStack(x.map(this, function (t, n) {
            return e.call(t, n, t)
        }))
    }, end: function () {
        return this.prevObject || this.constructor(null)
    }, push: h, sort: [].sort, splice: [].splice}, x.fn.init.prototype = x.fn, x.extend = x.fn.extend = function () {
        var e, n, r, i, o, a, s = arguments[0] || {}, l = 1, u = arguments.length, c = !1;
        for ("boolean" == typeof s && (c = s, s = arguments[1] || {}, l = 2), "object" == typeof s || x.isFunction(s) || (s = {}), u === l && (s = this, --l); u > l; l++)if (null != (o = arguments[l]))for (i in o)e = s[i], r = o[i], s !== r && (c && r && (x.isPlainObject(r) || (n = x.isArray(r))) ? (n ? (n = !1, a = e && x.isArray(e) ? e : []) : a = e && x.isPlainObject(e) ? e : {}, s[i] = x.extend(c, a, r)) : r !== t && (s[i] = r));
        return s
    }, x.extend({expando: "jQuery" + (f + Math.random()).replace(/\D/g, ""), noConflict: function (t) {
        return e.$ === x && (e.$ = u), t && e.jQuery === x && (e.jQuery = l), x
    }, isReady: !1, readyWait: 1, holdReady: function (e) {
        e ? x.readyWait++ : x.ready(!0)
    }, ready: function (e) {
        if (e === !0 ? !--x.readyWait : !x.isReady) {
            if (!a.body)return setTimeout(x.ready);
            x.isReady = !0, e !== !0 && --x.readyWait > 0 || (n.resolveWith(a, [x]), x.fn.trigger && x(a).trigger("ready").off("ready"))
        }
    }, isFunction: function (e) {
        return"function" === x.type(e)
    }, isArray: Array.isArray || function (e) {
        return"array" === x.type(e)
    }, isWindow: function (e) {
        return null != e && e == e.window
    }, isNumeric: function (e) {
        return!isNaN(parseFloat(e)) && isFinite(e)
    }, type: function (e) {
        return null == e ? e + "" : "object" == typeof e || "function" == typeof e ? c[y.call(e)] || "object" : typeof e
    }, isPlainObject: function (e) {
        var n;
        if (!e || "object" !== x.type(e) || e.nodeType || x.isWindow(e))return!1;
        try {
            if (e.constructor && !v.call(e, "constructor") && !v.call(e.constructor.prototype, "isPrototypeOf"))return!1
        } catch (r) {
            return!1
        }
        if (x.support.ownLast)for (n in e)return v.call(e, n);
        for (n in e);
        return n === t || v.call(e, n)
    }, isEmptyObject: function (e) {
        var t;
        for (t in e)return!1;
        return!0
    }, error: function (e) {
        throw Error(e)
    }, parseHTML: function (e, t, n) {
        if (!e || "string" != typeof e)return null;
        "boolean" == typeof t && (n = t, t = !1), t = t || a;
        var r = k.exec(e), i = !n && [];
        return r ? [t.createElement(r[1])] : (r = x.buildFragment([e], t, i), i && x(i).remove(), x.merge([], r.childNodes))
    }, parseJSON: function (n) {
        return e.JSON && e.JSON.parse ? e.JSON.parse(n) : null === n ? n : "string" == typeof n && (n = x.trim(n), n && E.test(n.replace(A, "@").replace(j, "]").replace(S, ""))) ? Function("return " + n)() : (x.error("Invalid JSON: " + n), t)
    }, parseXML: function (n) {
        var r, i;
        if (!n || "string" != typeof n)return null;
        try {
            e.DOMParser ? (i = new DOMParser, r = i.parseFromString(n, "text/xml")) : (r = new ActiveXObject("Microsoft.XMLDOM"), r.async = "false", r.loadXML(n))
        } catch (o) {
            r = t
        }
        return r && r.documentElement && !r.getElementsByTagName("parsererror").length || x.error("Invalid XML: " + n), r
    }, noop: function () {
    }, globalEval: function (t) {
        t && x.trim(t) && (e.execScript || function (t) {
            e.eval.call(e, t)
        })(t)
    }, camelCase: function (e) {
        return e.replace(D, "ms-").replace(L, H)
    }, nodeName: function (e, t) {
        return e.nodeName && e.nodeName.toLowerCase() === t.toLowerCase()
    }, each: function (e, t, n) {
        var r, i = 0, o = e.length, a = M(e);
        if (n) {
            if (a) {
                for (; o > i; i++)if (r = t.apply(e[i], n), r === !1)break
            } else for (i in e)if (r = t.apply(e[i], n), r === !1)break
        } else if (a) {
            for (; o > i; i++)if (r = t.call(e[i], i, e[i]), r === !1)break
        } else for (i in e)if (r = t.call(e[i], i, e[i]), r === !1)break;
        return e
    }, trim: b && !b.call("\ufeff\u00a0") ? function (e) {
        return null == e ? "" : b.call(e)
    } : function (e) {
        return null == e ? "" : (e + "").replace(C, "")
    }, makeArray: function (e, t) {
        var n = t || [];
        return null != e && (M(Object(e)) ? x.merge(n, "string" == typeof e ? [e] : e) : h.call(n, e)), n
    }, inArray: function (e, t, n) {
        var r;
        if (t) {
            if (m)return m.call(t, e, n);
            for (r = t.length, n = n ? 0 > n ? Math.max(0, r + n) : n : 0; r > n; n++)if (n in t && t[n] === e)return n
        }
        return-1
    }, merge: function (e, n) {
        var r = n.length, i = e.length, o = 0;
        if ("number" == typeof r)for (; r > o; o++)e[i++] = n[o]; else while (n[o] !== t)e[i++] = n[o++];
        return e.length = i, e
    }, grep: function (e, t, n) {
        var r, i = [], o = 0, a = e.length;
        for (n = !!n; a > o; o++)r = !!t(e[o], o), n !== r && i.push(e[o]);
        return i
    }, map: function (e, t, n) {
        var r, i = 0, o = e.length, a = M(e), s = [];
        if (a)for (; o > i; i++)r = t(e[i], i, n), null != r && (s[s.length] = r); else for (i in e)r = t(e[i], i, n), null != r && (s[s.length] = r);
        return d.apply([], s)
    }, guid: 1, proxy: function (e, n) {
        var r, i, o;
        return"string" == typeof n && (o = e[n], n = e, e = o), x.isFunction(e) ? (r = g.call(arguments, 2), i = function () {
            return e.apply(n || this, r.concat(g.call(arguments)))
        }, i.guid = e.guid = e.guid || x.guid++, i) : t
    }, access: function (e, n, r, i, o, a, s) {
        var l = 0, u = e.length, c = null == r;
        if ("object" === x.type(r)) {
            o = !0;
            for (l in r)x.access(e, n, l, r[l], !0, a, s)
        } else if (i !== t && (o = !0, x.isFunction(i) || (s = !0), c && (s ? (n.call(e, i), n = null) : (c = n, n = function (e, t, n) {
            return c.call(x(e), n)
        })), n))for (; u > l; l++)n(e[l], r, s ? i : i.call(e[l], l, n(e[l], r)));
        return o ? e : c ? n.call(e) : u ? n(e[0], r) : a
    }, now: function () {
        return(new Date).getTime()
    }, swap: function (e, t, n, r) {
        var i, o, a = {};
        for (o in t)a[o] = e.style[o], e.style[o] = t[o];
        i = n.apply(e, r || []);
        for (o in t)e.style[o] = a[o];
        return i
    }}), x.ready.promise = function (t) {
        if (!n)if (n = x.Deferred(), "complete" === a.readyState)setTimeout(x.ready); else if (a.addEventListener)a.addEventListener("DOMContentLoaded", q, !1), e.addEventListener("load", q, !1); else {
            a.attachEvent("onreadystatechange", q), e.attachEvent("onload", q);
            var r = !1;
            try {
                r = null == e.frameElement && a.documentElement
            } catch (i) {
            }
            r && r.doScroll && function o() {
                if (!x.isReady) {
                    try {
                        r.doScroll("left")
                    } catch (e) {
                        return setTimeout(o, 50)
                    }
                    _(), x.ready()
                }
            }()
        }
        return n.promise(t)
    }, x.each("Boolean Number String Function Array Date RegExp Object Error".split(" "), function (e, t) {
        c["[object " + t + "]"] = t.toLowerCase()
    });
    function M(e) {
        var t = e.length, n = x.type(e);
        return x.isWindow(e) ? !1 : 1 === e.nodeType && t ? !0 : "array" === n || "function" !== n && (0 === t || "number" == typeof t && t > 0 && t - 1 in e)
    }

    r = x(a), function (e, t) {
        var n, r, i, o, a, s, l, u, c, p, f, d, h, g, m, y, v, b = "sizzle" + -new Date, w = e.document, T = 0, C = 0, N = st(), k = st(), E = st(), S = !1, A = function (e, t) {
            return e === t ? (S = !0, 0) : 0
        }, j = typeof t, D = 1 << 31, L = {}.hasOwnProperty, H = [], q = H.pop, _ = H.push, M = H.push, O = H.slice, F = H.indexOf || function (e) {
            var t = 0, n = this.length;
            for (; n > t; t++)if (this[t] === e)return t;
            return-1
        }, B = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped", P = "[\\x20\\t\\r\\n\\f]", R = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+", W = R.replace("w", "w#"), $ = "\\[" + P + "*(" + R + ")" + P + "*(?:([*^$|!~]?=)" + P + "*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|(" + W + ")|)|)" + P + "*\\]", I = ":(" + R + ")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|" + $.replace(3, 8) + ")*)|.*)\\)|)", z = RegExp("^" + P + "+|((?:^|[^\\\\])(?:\\\\.)*)" + P + "+$", "g"), X = RegExp("^" + P + "*," + P + "*"), U = RegExp("^" + P + "*([>+~]|" + P + ")" + P + "*"), V = RegExp(P + "*[+~]"), Y = RegExp("=" + P + "*([^\\]'\"]*)" + P + "*\\]", "g"), J = RegExp(I), G = RegExp("^" + W + "$"), Q = {ID: RegExp("^#(" + R + ")"), CLASS: RegExp("^\\.(" + R + ")"), TAG: RegExp("^(" + R.replace("w", "w*") + ")"), ATTR: RegExp("^" + $), PSEUDO: RegExp("^" + I), CHILD: RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + P + "*(even|odd|(([+-]|)(\\d*)n|)" + P + "*(?:([+-]|)" + P + "*(\\d+)|))" + P + "*\\)|)", "i"), bool: RegExp("^(?:" + B + ")$", "i"), needsContext: RegExp("^" + P + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + P + "*((?:-\\d)?\\d*)" + P + "*\\)|)(?=[^-]|$)", "i")}, K = /^[^{]+\{\s*\[native \w/, Z = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, et = /^(?:input|select|textarea|button)$/i, tt = /^h\d$/i, nt = /'|\\/g, rt = RegExp("\\\\([\\da-f]{1,6}" + P + "?|(" + P + ")|.)", "ig"), it = function (e, t, n) {
            var r = "0x" + t - 65536;
            return r !== r || n ? t : 0 > r ? String.fromCharCode(r + 65536) : String.fromCharCode(55296 | r >> 10, 56320 | 1023 & r)
        };
        try {
            M.apply(H = O.call(w.childNodes), w.childNodes), H[w.childNodes.length].nodeType
        } catch (ot) {
            M = {apply: H.length ? function (e, t) {
                _.apply(e, O.call(t))
            } : function (e, t) {
                var n = e.length, r = 0;
                while (e[n++] = t[r++]);
                e.length = n - 1
            }}
        }
        function at(e, t, n, i) {
            var o, a, s, l, u, c, d, m, y, x;
            if ((t ? t.ownerDocument || t : w) !== f && p(t), t = t || f, n = n || [], !e || "string" != typeof e)return n;
            if (1 !== (l = t.nodeType) && 9 !== l)return[];
            if (h && !i) {
                if (o = Z.exec(e))if (s = o[1]) {
                    if (9 === l) {
                        if (a = t.getElementById(s), !a || !a.parentNode)return n;
                        if (a.id === s)return n.push(a), n
                    } else if (t.ownerDocument && (a = t.ownerDocument.getElementById(s)) && v(t, a) && a.id === s)return n.push(a), n
                } else {
                    if (o[2])return M.apply(n, t.getElementsByTagName(e)), n;
                    if ((s = o[3]) && r.getElementsByClassName && t.getElementsByClassName)return M.apply(n, t.getElementsByClassName(s)), n
                }
                if (r.qsa && (!g || !g.test(e))) {
                    if (m = d = b, y = t, x = 9 === l && e, 1 === l && "object" !== t.nodeName.toLowerCase()) {
                        c = mt(e), (d = t.getAttribute("id")) ? m = d.replace(nt, "\\$&") : t.setAttribute("id", m), m = "[id='" + m + "'] ", u = c.length;
                        while (u--)c[u] = m + yt(c[u]);
                        y = V.test(e) && t.parentNode || t, x = c.join(",")
                    }
                    if (x)try {
                        return M.apply(n, y.querySelectorAll(x)), n
                    } catch (T) {
                    } finally {
                        d || t.removeAttribute("id")
                    }
                }
            }
            return kt(e.replace(z, "$1"), t, n, i)
        }

        function st() {
            var e = [];

            function t(n, r) {
                return e.push(n += " ") > o.cacheLength && delete t[e.shift()], t[n] = r
            }

            return t
        }

        function lt(e) {
            return e[b] = !0, e
        }

        function ut(e) {
            var t = f.createElement("div");
            try {
                return!!e(t)
            } catch (n) {
                return!1
            } finally {
                t.parentNode && t.parentNode.removeChild(t), t = null
            }
        }

        function ct(e, t) {
            var n = e.split("|"), r = e.length;
            while (r--)o.attrHandle[n[r]] = t
        }

        function pt(e, t) {
            var n = t && e, r = n && 1 === e.nodeType && 1 === t.nodeType && (~t.sourceIndex || D) - (~e.sourceIndex || D);
            if (r)return r;
            if (n)while (n = n.nextSibling)if (n === t)return-1;
            return e ? 1 : -1
        }

        function ft(e) {
            return function (t) {
                var n = t.nodeName.toLowerCase();
                return"input" === n && t.type === e
            }
        }

        function dt(e) {
            return function (t) {
                var n = t.nodeName.toLowerCase();
                return("input" === n || "button" === n) && t.type === e
            }
        }

        function ht(e) {
            return lt(function (t) {
                return t = +t, lt(function (n, r) {
                    var i, o = e([], n.length, t), a = o.length;
                    while (a--)n[i = o[a]] && (n[i] = !(r[i] = n[i]))
                })
            })
        }

        s = at.isXML = function (e) {
            var t = e && (e.ownerDocument || e).documentElement;
            return t ? "HTML" !== t.nodeName : !1
        }, r = at.support = {}, p = at.setDocument = function (e) {
            var n = e ? e.ownerDocument || e : w, i = n.defaultView;
            return n !== f && 9 === n.nodeType && n.documentElement ? (f = n, d = n.documentElement, h = !s(n), i && i.attachEvent && i !== i.top && i.attachEvent("onbeforeunload", function () {
                p()
            }), r.attributes = ut(function (e) {
                return e.className = "i", !e.getAttribute("className")
            }), r.getElementsByTagName = ut(function (e) {
                return e.appendChild(n.createComment("")), !e.getElementsByTagName("*").length
            }), r.getElementsByClassName = ut(function (e) {
                return e.innerHTML = "<div class='a'></div><div class='a i'></div>", e.firstChild.className = "i", 2 === e.getElementsByClassName("i").length
            }), r.getById = ut(function (e) {
                return d.appendChild(e).id = b, !n.getElementsByName || !n.getElementsByName(b).length
            }), r.getById ? (o.find.ID = function (e, t) {
                if (typeof t.getElementById !== j && h) {
                    var n = t.getElementById(e);
                    return n && n.parentNode ? [n] : []
                }
            }, o.filter.ID = function (e) {
                var t = e.replace(rt, it);
                return function (e) {
                    return e.getAttribute("id") === t
                }
            }) : (delete o.find.ID, o.filter.ID = function (e) {
                var t = e.replace(rt, it);
                return function (e) {
                    var n = typeof e.getAttributeNode !== j && e.getAttributeNode("id");
                    return n && n.value === t
                }
            }), o.find.TAG = r.getElementsByTagName ? function (e, n) {
                return typeof n.getElementsByTagName !== j ? n.getElementsByTagName(e) : t
            } : function (e, t) {
                var n, r = [], i = 0, o = t.getElementsByTagName(e);
                if ("*" === e) {
                    while (n = o[i++])1 === n.nodeType && r.push(n);
                    return r
                }
                return o
            }, o.find.CLASS = r.getElementsByClassName && function (e, n) {
                return typeof n.getElementsByClassName !== j && h ? n.getElementsByClassName(e) : t
            }, m = [], g = [], (r.qsa = K.test(n.querySelectorAll)) && (ut(function (e) {
                e.innerHTML = "<select><option selected=''></option></select>", e.querySelectorAll("[selected]").length || g.push("\\[" + P + "*(?:value|" + B + ")"), e.querySelectorAll(":checked").length || g.push(":checked")
            }), ut(function (e) {
                var t = n.createElement("input");
                t.setAttribute("type", "hidden"), e.appendChild(t).setAttribute("t", ""), e.querySelectorAll("[t^='']").length && g.push("[*^$]=" + P + "*(?:''|\"\")"), e.querySelectorAll(":enabled").length || g.push(":enabled", ":disabled"), e.querySelectorAll("*,:x"), g.push(",.*:")
            })), (r.matchesSelector = K.test(y = d.webkitMatchesSelector || d.mozMatchesSelector || d.oMatchesSelector || d.msMatchesSelector)) && ut(function (e) {
                r.disconnectedMatch = y.call(e, "div"), y.call(e, "[s!='']:x"), m.push("!=", I)
            }), g = g.length && RegExp(g.join("|")), m = m.length && RegExp(m.join("|")), v = K.test(d.contains) || d.compareDocumentPosition ? function (e, t) {
                var n = 9 === e.nodeType ? e.documentElement : e, r = t && t.parentNode;
                return e === r || !(!r || 1 !== r.nodeType || !(n.contains ? n.contains(r) : e.compareDocumentPosition && 16 & e.compareDocumentPosition(r)))
            } : function (e, t) {
                if (t)while (t = t.parentNode)if (t === e)return!0;
                return!1
            }, A = d.compareDocumentPosition ? function (e, t) {
                if (e === t)return S = !0, 0;
                var i = t.compareDocumentPosition && e.compareDocumentPosition && e.compareDocumentPosition(t);
                return i ? 1 & i || !r.sortDetached && t.compareDocumentPosition(e) === i ? e === n || v(w, e) ? -1 : t === n || v(w, t) ? 1 : c ? F.call(c, e) - F.call(c, t) : 0 : 4 & i ? -1 : 1 : e.compareDocumentPosition ? -1 : 1
            } : function (e, t) {
                var r, i = 0, o = e.parentNode, a = t.parentNode, s = [e], l = [t];
                if (e === t)return S = !0, 0;
                if (!o || !a)return e === n ? -1 : t === n ? 1 : o ? -1 : a ? 1 : c ? F.call(c, e) - F.call(c, t) : 0;
                if (o === a)return pt(e, t);
                r = e;
                while (r = r.parentNode)s.unshift(r);
                r = t;
                while (r = r.parentNode)l.unshift(r);
                while (s[i] === l[i])i++;
                return i ? pt(s[i], l[i]) : s[i] === w ? -1 : l[i] === w ? 1 : 0
            }, n) : f
        }, at.matches = function (e, t) {
            return at(e, null, null, t)
        }, at.matchesSelector = function (e, t) {
            if ((e.ownerDocument || e) !== f && p(e), t = t.replace(Y, "='$1']"), !(!r.matchesSelector || !h || m && m.test(t) || g && g.test(t)))try {
                var n = y.call(e, t);
                if (n || r.disconnectedMatch || e.document && 11 !== e.document.nodeType)return n
            } catch (i) {
            }
            return at(t, f, null, [e]).length > 0
        }, at.contains = function (e, t) {
            return(e.ownerDocument || e) !== f && p(e), v(e, t)
        }, at.attr = function (e, n) {
            (e.ownerDocument || e) !== f && p(e);
            var i = o.attrHandle[n.toLowerCase()], a = i && L.call(o.attrHandle, n.toLowerCase()) ? i(e, n, !h) : t;
            return a === t ? r.attributes || !h ? e.getAttribute(n) : (a = e.getAttributeNode(n)) && a.specified ? a.value : null : a
        }, at.error = function (e) {
            throw Error("Syntax error, unrecognized expression: " + e)
        }, at.uniqueSort = function (e) {
            var t, n = [], i = 0, o = 0;
            if (S = !r.detectDuplicates, c = !r.sortStable && e.slice(0), e.sort(A), S) {
                while (t = e[o++])t === e[o] && (i = n.push(o));
                while (i--)e.splice(n[i], 1)
            }
            return e
        }, a = at.getText = function (e) {
            var t, n = "", r = 0, i = e.nodeType;
            if (i) {
                if (1 === i || 9 === i || 11 === i) {
                    if ("string" == typeof e.textContent)return e.textContent;
                    for (e = e.firstChild; e; e = e.nextSibling)n += a(e)
                } else if (3 === i || 4 === i)return e.nodeValue
            } else for (; t = e[r]; r++)n += a(t);
            return n
        }, o = at.selectors = {cacheLength: 50, createPseudo: lt, match: Q, attrHandle: {}, find: {}, relative: {">": {dir: "parentNode", first: !0}, " ": {dir: "parentNode"}, "+": {dir: "previousSibling", first: !0}, "~": {dir: "previousSibling"}}, preFilter: {ATTR: function (e) {
            return e[1] = e[1].replace(rt, it), e[3] = (e[4] || e[5] || "").replace(rt, it), "~=" === e[2] && (e[3] = " " + e[3] + " "), e.slice(0, 4)
        }, CHILD: function (e) {
            return e[1] = e[1].toLowerCase(), "nth" === e[1].slice(0, 3) ? (e[3] || at.error(e[0]), e[4] = +(e[4] ? e[5] + (e[6] || 1) : 2 * ("even" === e[3] || "odd" === e[3])), e[5] = +(e[7] + e[8] || "odd" === e[3])) : e[3] && at.error(e[0]), e
        }, PSEUDO: function (e) {
            var n, r = !e[5] && e[2];
            return Q.CHILD.test(e[0]) ? null : (e[3] && e[4] !== t ? e[2] = e[4] : r && J.test(r) && (n = mt(r, !0)) && (n = r.indexOf(")", r.length - n) - r.length) && (e[0] = e[0].slice(0, n), e[2] = r.slice(0, n)), e.slice(0, 3))
        }}, filter: {TAG: function (e) {
            var t = e.replace(rt, it).toLowerCase();
            return"*" === e ? function () {
                return!0
            } : function (e) {
                return e.nodeName && e.nodeName.toLowerCase() === t
            }
        }, CLASS: function (e) {
            var t = N[e + " "];
            return t || (t = RegExp("(^|" + P + ")" + e + "(" + P + "|$)")) && N(e, function (e) {
                return t.test("string" == typeof e.className && e.className || typeof e.getAttribute !== j && e.getAttribute("class") || "")
            })
        }, ATTR: function (e, t, n) {
            return function (r) {
                var i = at.attr(r, e);
                return null == i ? "!=" === t : t ? (i += "", "=" === t ? i === n : "!=" === t ? i !== n : "^=" === t ? n && 0 === i.indexOf(n) : "*=" === t ? n && i.indexOf(n) > -1 : "$=" === t ? n && i.slice(-n.length) === n : "~=" === t ? (" " + i + " ").indexOf(n) > -1 : "|=" === t ? i === n || i.slice(0, n.length + 1) === n + "-" : !1) : !0
            }
        }, CHILD: function (e, t, n, r, i) {
            var o = "nth" !== e.slice(0, 3), a = "last" !== e.slice(-4), s = "of-type" === t;
            return 1 === r && 0 === i ? function (e) {
                return!!e.parentNode
            } : function (t, n, l) {
                var u, c, p, f, d, h, g = o !== a ? "nextSibling" : "previousSibling", m = t.parentNode, y = s && t.nodeName.toLowerCase(), v = !l && !s;
                if (m) {
                    if (o) {
                        while (g) {
                            p = t;
                            while (p = p[g])if (s ? p.nodeName.toLowerCase() === y : 1 === p.nodeType)return!1;
                            h = g = "only" === e && !h && "nextSibling"
                        }
                        return!0
                    }
                    if (h = [a ? m.firstChild : m.lastChild], a && v) {
                        c = m[b] || (m[b] = {}), u = c[e] || [], d = u[0] === T && u[1], f = u[0] === T && u[2], p = d && m.childNodes[d];
                        while (p = ++d && p && p[g] || (f = d = 0) || h.pop())if (1 === p.nodeType && ++f && p === t) {
                            c[e] = [T, d, f];
                            break
                        }
                    } else if (v && (u = (t[b] || (t[b] = {}))[e]) && u[0] === T)f = u[1]; else while (p = ++d && p && p[g] || (f = d = 0) || h.pop())if ((s ? p.nodeName.toLowerCase() === y : 1 === p.nodeType) && ++f && (v && ((p[b] || (p[b] = {}))[e] = [T, f]), p === t))break;
                    return f -= i, f === r || 0 === f % r && f / r >= 0
                }
            }
        }, PSEUDO: function (e, t) {
            var n, r = o.pseudos[e] || o.setFilters[e.toLowerCase()] || at.error("unsupported pseudo: " + e);
            return r[b] ? r(t) : r.length > 1 ? (n = [e, e, "", t], o.setFilters.hasOwnProperty(e.toLowerCase()) ? lt(function (e, n) {
                var i, o = r(e, t), a = o.length;
                while (a--)i = F.call(e, o[a]), e[i] = !(n[i] = o[a])
            }) : function (e) {
                return r(e, 0, n)
            }) : r
        }}, pseudos: {not: lt(function (e) {
            var t = [], n = [], r = l(e.replace(z, "$1"));
            return r[b] ? lt(function (e, t, n, i) {
                var o, a = r(e, null, i, []), s = e.length;
                while (s--)(o = a[s]) && (e[s] = !(t[s] = o))
            }) : function (e, i, o) {
                return t[0] = e, r(t, null, o, n), !n.pop()
            }
        }), has: lt(function (e) {
            return function (t) {
                return at(e, t).length > 0
            }
        }), contains: lt(function (e) {
            return function (t) {
                return(t.textContent || t.innerText || a(t)).indexOf(e) > -1
            }
        }), lang: lt(function (e) {
            return G.test(e || "") || at.error("unsupported lang: " + e), e = e.replace(rt, it).toLowerCase(), function (t) {
                var n;
                do if (n = h ? t.lang : t.getAttribute("xml:lang") || t.getAttribute("lang"))return n = n.toLowerCase(), n === e || 0 === n.indexOf(e + "-"); while ((t = t.parentNode) && 1 === t.nodeType);
                return!1
            }
        }), target: function (t) {
            var n = e.location && e.location.hash;
            return n && n.slice(1) === t.id
        }, root: function (e) {
            return e === d
        }, focus: function (e) {
            return e === f.activeElement && (!f.hasFocus || f.hasFocus()) && !!(e.type || e.href || ~e.tabIndex)
        }, enabled: function (e) {
            return e.disabled === !1
        }, disabled: function (e) {
            return e.disabled === !0
        }, checked: function (e) {
            var t = e.nodeName.toLowerCase();
            return"input" === t && !!e.checked || "option" === t && !!e.selected
        }, selected: function (e) {
            return e.parentNode && e.parentNode.selectedIndex, e.selected === !0
        }, empty: function (e) {
            for (e = e.firstChild; e; e = e.nextSibling)if (e.nodeName > "@" || 3 === e.nodeType || 4 === e.nodeType)return!1;
            return!0
        }, parent: function (e) {
            return!o.pseudos.empty(e)
        }, header: function (e) {
            return tt.test(e.nodeName)
        }, input: function (e) {
            return et.test(e.nodeName)
        }, button: function (e) {
            var t = e.nodeName.toLowerCase();
            return"input" === t && "button" === e.type || "button" === t
        }, text: function (e) {
            var t;
            return"input" === e.nodeName.toLowerCase() && "text" === e.type && (null == (t = e.getAttribute("type")) || t.toLowerCase() === e.type)
        }, first: ht(function () {
            return[0]
        }), last: ht(function (e, t) {
            return[t - 1]
        }), eq: ht(function (e, t, n) {
            return[0 > n ? n + t : n]
        }), even: ht(function (e, t) {
            var n = 0;
            for (; t > n; n += 2)e.push(n);
            return e
        }), odd: ht(function (e, t) {
            var n = 1;
            for (; t > n; n += 2)e.push(n);
            return e
        }), lt: ht(function (e, t, n) {
            var r = 0 > n ? n + t : n;
            for (; --r >= 0;)e.push(r);
            return e
        }), gt: ht(function (e, t, n) {
            var r = 0 > n ? n + t : n;
            for (; t > ++r;)e.push(r);
            return e
        })}}, o.pseudos.nth = o.pseudos.eq;
        for (n in{radio: !0, checkbox: !0, file: !0, password: !0, image: !0})o.pseudos[n] = ft(n);
        for (n in{submit: !0, reset: !0})o.pseudos[n] = dt(n);
        function gt() {
        }

        gt.prototype = o.filters = o.pseudos, o.setFilters = new gt;
        function mt(e, t) {
            var n, r, i, a, s, l, u, c = k[e + " "];
            if (c)return t ? 0 : c.slice(0);
            s = e, l = [], u = o.preFilter;
            while (s) {
                (!n || (r = X.exec(s))) && (r && (s = s.slice(r[0].length) || s), l.push(i = [])), n = !1, (r = U.exec(s)) && (n = r.shift(), i.push({value: n, type: r[0].replace(z, " ")}), s = s.slice(n.length));
                for (a in o.filter)!(r = Q[a].exec(s)) || u[a] && !(r = u[a](r)) || (n = r.shift(), i.push({value: n, type: a, matches: r}), s = s.slice(n.length));
                if (!n)break
            }
            return t ? s.length : s ? at.error(e) : k(e, l).slice(0)
        }

        function yt(e) {
            var t = 0, n = e.length, r = "";
            for (; n > t; t++)r += e[t].value;
            return r
        }

        function vt(e, t, n) {
            var r = t.dir, o = n && "parentNode" === r, a = C++;
            return t.first ? function (t, n, i) {
                while (t = t[r])if (1 === t.nodeType || o)return e(t, n, i)
            } : function (t, n, s) {
                var l, u, c, p = T + " " + a;
                if (s) {
                    while (t = t[r])if ((1 === t.nodeType || o) && e(t, n, s))return!0
                } else while (t = t[r])if (1 === t.nodeType || o)if (c = t[b] || (t[b] = {}), (u = c[r]) && u[0] === p) {
                    if ((l = u[1]) === !0 || l === i)return l === !0
                } else if (u = c[r] = [p], u[1] = e(t, n, s) || i, u[1] === !0)return!0
            }
        }

        function bt(e) {
            return e.length > 1 ? function (t, n, r) {
                var i = e.length;
                while (i--)if (!e[i](t, n, r))return!1;
                return!0
            } : e[0]
        }

        function xt(e, t, n, r, i) {
            var o, a = [], s = 0, l = e.length, u = null != t;
            for (; l > s; s++)(o = e[s]) && (!n || n(o, r, i)) && (a.push(o), u && t.push(s));
            return a
        }

        function wt(e, t, n, r, i, o) {
            return r && !r[b] && (r = wt(r)), i && !i[b] && (i = wt(i, o)), lt(function (o, a, s, l) {
                var u, c, p, f = [], d = [], h = a.length, g = o || Nt(t || "*", s.nodeType ? [s] : s, []), m = !e || !o && t ? g : xt(g, f, e, s, l), y = n ? i || (o ? e : h || r) ? [] : a : m;
                if (n && n(m, y, s, l), r) {
                    u = xt(y, d), r(u, [], s, l), c = u.length;
                    while (c--)(p = u[c]) && (y[d[c]] = !(m[d[c]] = p))
                }
                if (o) {
                    if (i || e) {
                        if (i) {
                            u = [], c = y.length;
                            while (c--)(p = y[c]) && u.push(m[c] = p);
                            i(null, y = [], u, l)
                        }
                        c = y.length;
                        while (c--)(p = y[c]) && (u = i ? F.call(o, p) : f[c]) > -1 && (o[u] = !(a[u] = p))
                    }
                } else y = xt(y === a ? y.splice(h, y.length) : y), i ? i(null, a, y, l) : M.apply(a, y)
            })
        }

        function Tt(e) {
            var t, n, r, i = e.length, a = o.relative[e[0].type], s = a || o.relative[" "], l = a ? 1 : 0, c = vt(function (e) {
                return e === t
            }, s, !0), p = vt(function (e) {
                return F.call(t, e) > -1
            }, s, !0), f = [function (e, n, r) {
                return!a && (r || n !== u) || ((t = n).nodeType ? c(e, n, r) : p(e, n, r))
            }];
            for (; i > l; l++)if (n = o.relative[e[l].type])f = [vt(bt(f), n)]; else {
                if (n = o.filter[e[l].type].apply(null, e[l].matches), n[b]) {
                    for (r = ++l; i > r; r++)if (o.relative[e[r].type])break;
                    return wt(l > 1 && bt(f), l > 1 && yt(e.slice(0, l - 1).concat({value: " " === e[l - 2].type ? "*" : ""})).replace(z, "$1"), n, r > l && Tt(e.slice(l, r)), i > r && Tt(e = e.slice(r)), i > r && yt(e))
                }
                f.push(n)
            }
            return bt(f)
        }

        function Ct(e, t) {
            var n = 0, r = t.length > 0, a = e.length > 0, s = function (s, l, c, p, d) {
                var h, g, m, y = [], v = 0, b = "0", x = s && [], w = null != d, C = u, N = s || a && o.find.TAG("*", d && l.parentNode || l), k = T += null == C ? 1 : Math.random() || .1;
                for (w && (u = l !== f && l, i = n); null != (h = N[b]); b++) {
                    if (a && h) {
                        g = 0;
                        while (m = e[g++])if (m(h, l, c)) {
                            p.push(h);
                            break
                        }
                        w && (T = k, i = ++n)
                    }
                    r && ((h = !m && h) && v--, s && x.push(h))
                }
                if (v += b, r && b !== v) {
                    g = 0;
                    while (m = t[g++])m(x, y, l, c);
                    if (s) {
                        if (v > 0)while (b--)x[b] || y[b] || (y[b] = q.call(p));
                        y = xt(y)
                    }
                    M.apply(p, y), w && !s && y.length > 0 && v + t.length > 1 && at.uniqueSort(p)
                }
                return w && (T = k, u = C), x
            };
            return r ? lt(s) : s
        }

        l = at.compile = function (e, t) {
            var n, r = [], i = [], o = E[e + " "];
            if (!o) {
                t || (t = mt(e)), n = t.length;
                while (n--)o = Tt(t[n]), o[b] ? r.push(o) : i.push(o);
                o = E(e, Ct(i, r))
            }
            return o
        };
        function Nt(e, t, n) {
            var r = 0, i = t.length;
            for (; i > r; r++)at(e, t[r], n);
            return n
        }

        function kt(e, t, n, i) {
            var a, s, u, c, p, f = mt(e);
            if (!i && 1 === f.length) {
                if (s = f[0] = f[0].slice(0), s.length > 2 && "ID" === (u = s[0]).type && r.getById && 9 === t.nodeType && h && o.relative[s[1].type]) {
                    if (t = (o.find.ID(u.matches[0].replace(rt, it), t) || [])[0], !t)return n;
                    e = e.slice(s.shift().value.length)
                }
                a = Q.needsContext.test(e) ? 0 : s.length;
                while (a--) {
                    if (u = s[a], o.relative[c = u.type])break;
                    if ((p = o.find[c]) && (i = p(u.matches[0].replace(rt, it), V.test(s[0].type) && t.parentNode || t))) {
                        if (s.splice(a, 1), e = i.length && yt(s), !e)return M.apply(n, i), n;
                        break
                    }
                }
            }
            return l(e, f)(i, t, !h, n, V.test(e)), n
        }

        r.sortStable = b.split("").sort(A).join("") === b, r.detectDuplicates = S, p(), r.sortDetached = ut(function (e) {
            return 1 & e.compareDocumentPosition(f.createElement("div"))
        }), ut(function (e) {
            return e.innerHTML = "<a href='#'></a>", "#" === e.firstChild.getAttribute("href")
        }) || ct("type|href|height|width", function (e, n, r) {
            return r ? t : e.getAttribute(n, "type" === n.toLowerCase() ? 1 : 2)
        }), r.attributes && ut(function (e) {
            return e.innerHTML = "<input/>", e.firstChild.setAttribute("value", ""), "" === e.firstChild.getAttribute("value")
        }) || ct("value", function (e, n, r) {
            return r || "input" !== e.nodeName.toLowerCase() ? t : e.defaultValue
        }), ut(function (e) {
            return null == e.getAttribute("disabled")
        }) || ct(B, function (e, n, r) {
            var i;
            return r ? t : (i = e.getAttributeNode(n)) && i.specified ? i.value : e[n] === !0 ? n.toLowerCase() : null
        }), x.find = at, x.expr = at.selectors, x.expr[":"] = x.expr.pseudos, x.unique = at.uniqueSort, x.text = at.getText, x.isXMLDoc = at.isXML, x.contains = at.contains
    }(e);
    var O = {};

    function F(e) {
        var t = O[e] = {};
        return x.each(e.match(T) || [], function (e, n) {
            t[n] = !0
        }), t
    }

    x.Callbacks = function (e) {
        e = "string" == typeof e ? O[e] || F(e) : x.extend({}, e);
        var n, r, i, o, a, s, l = [], u = !e.once && [], c = function (t) {
            for (r = e.memory && t, i = !0, a = s || 0, s = 0, o = l.length, n = !0; l && o > a; a++)if (l[a].apply(t[0], t[1]) === !1 && e.stopOnFalse) {
                r = !1;
                break
            }
            n = !1, l && (u ? u.length && c(u.shift()) : r ? l = [] : p.disable())
        }, p = {add: function () {
            if (l) {
                var t = l.length;
                (function i(t) {
                    x.each(t, function (t, n) {
                        var r = x.type(n);
                        "function" === r ? e.unique && p.has(n) || l.push(n) : n && n.length && "string" !== r && i(n)
                    })
                })(arguments), n ? o = l.length : r && (s = t, c(r))
            }
            return this
        }, remove: function () {
            return l && x.each(arguments, function (e, t) {
                var r;
                while ((r = x.inArray(t, l, r)) > -1)l.splice(r, 1), n && (o >= r && o--, a >= r && a--)
            }), this
        }, has: function (e) {
            return e ? x.inArray(e, l) > -1 : !(!l || !l.length)
        }, empty: function () {
            return l = [], o = 0, this
        }, disable: function () {
            return l = u = r = t, this
        }, disabled: function () {
            return!l
        }, lock: function () {
            return u = t, r || p.disable(), this
        }, locked: function () {
            return!u
        }, fireWith: function (e, t) {
            return!l || i && !u || (t = t || [], t = [e, t.slice ? t.slice() : t], n ? u.push(t) : c(t)), this
        }, fire: function () {
            return p.fireWith(this, arguments), this
        }, fired: function () {
            return!!i
        }};
        return p
    }, x.extend({Deferred: function (e) {
        var t = [
            ["resolve", "done", x.Callbacks("once memory"), "resolved"],
            ["reject", "fail", x.Callbacks("once memory"), "rejected"],
            ["notify", "progress", x.Callbacks("memory")]
        ], n = "pending", r = {state: function () {
            return n
        }, always: function () {
            return i.done(arguments).fail(arguments), this
        }, then: function () {
            var e = arguments;
            return x.Deferred(function (n) {
                x.each(t, function (t, o) {
                    var a = o[0], s = x.isFunction(e[t]) && e[t];
                    i[o[1]](function () {
                        var e = s && s.apply(this, arguments);
                        e && x.isFunction(e.promise) ? e.promise().done(n.resolve).fail(n.reject).progress(n.notify) : n[a + "With"](this === r ? n.promise() : this, s ? [e] : arguments)
                    })
                }), e = null
            }).promise()
        }, promise: function (e) {
            return null != e ? x.extend(e, r) : r
        }}, i = {};
        return r.pipe = r.then, x.each(t, function (e, o) {
            var a = o[2], s = o[3];
            r[o[1]] = a.add, s && a.add(function () {
                n = s
            }, t[1 ^ e][2].disable, t[2][2].lock), i[o[0]] = function () {
                return i[o[0] + "With"](this === i ? r : this, arguments), this
            }, i[o[0] + "With"] = a.fireWith
        }), r.promise(i), e && e.call(i, i), i
    }, when: function (e) {
        var t = 0, n = g.call(arguments), r = n.length, i = 1 !== r || e && x.isFunction(e.promise) ? r : 0, o = 1 === i ? e : x.Deferred(), a = function (e, t, n) {
            return function (r) {
                t[e] = this, n[e] = arguments.length > 1 ? g.call(arguments) : r, n === s ? o.notifyWith(t, n) : --i || o.resolveWith(t, n)
            }
        }, s, l, u;
        if (r > 1)for (s = Array(r), l = Array(r), u = Array(r); r > t; t++)n[t] && x.isFunction(n[t].promise) ? n[t].promise().done(a(t, u, n)).fail(o.reject).progress(a(t, l, s)) : --i;
        return i || o.resolveWith(u, n), o.promise()
    }}), x.support = function (t) {
        var n, r, o, s, l, u, c, p, f, d = a.createElement("div");
        if (d.setAttribute("className", "t"), d.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>", n = d.getElementsByTagName("*") || [], r = d.getElementsByTagName("a")[0], !r || !r.style || !n.length)return t;
        s = a.createElement("select"), u = s.appendChild(a.createElement("option")), o = d.getElementsByTagName("input")[0], r.style.cssText = "top:1px;float:left;opacity:.5", t.getSetAttribute = "t" !== d.className, t.leadingWhitespace = 3 === d.firstChild.nodeType, t.tbody = !d.getElementsByTagName("tbody").length, t.htmlSerialize = !!d.getElementsByTagName("link").length, t.style = /top/.test(r.getAttribute("style")), t.hrefNormalized = "/a" === r.getAttribute("href"), t.opacity = /^0.5/.test(r.style.opacity), t.cssFloat = !!r.style.cssFloat, t.checkOn = !!o.value, t.optSelected = u.selected, t.enctype = !!a.createElement("form").enctype, t.html5Clone = "<:nav></:nav>" !== a.createElement("nav").cloneNode(!0).outerHTML, t.inlineBlockNeedsLayout = !1, t.shrinkWrapBlocks = !1, t.pixelPosition = !1, t.deleteExpando = !0, t.noCloneEvent = !0, t.reliableMarginRight = !0, t.boxSizingReliable = !0, o.checked = !0, t.noCloneChecked = o.cloneNode(!0).checked, s.disabled = !0, t.optDisabled = !u.disabled;
        try {
            delete d.test
        } catch (h) {
            t.deleteExpando = !1
        }
        o = a.createElement("input"), o.setAttribute("value", ""), t.input = "" === o.getAttribute("value"), o.value = "t", o.setAttribute("type", "radio"), t.radioValue = "t" === o.value, o.setAttribute("checked", "t"), o.setAttribute("name", "t"), l = a.createDocumentFragment(), l.appendChild(o), t.appendChecked = o.checked, t.checkClone = l.cloneNode(!0).cloneNode(!0).lastChild.checked, d.attachEvent && (d.attachEvent("onclick", function () {
            t.noCloneEvent = !1
        }), d.cloneNode(!0).click());
        for (f in{submit: !0, change: !0, focusin: !0})d.setAttribute(c = "on" + f, "t"), t[f + "Bubbles"] = c in e || d.attributes[c].expando === !1;
        d.style.backgroundClip = "content-box", d.cloneNode(!0).style.backgroundClip = "", t.clearCloneStyle = "content-box" === d.style.backgroundClip;
        for (f in x(t))break;
        return t.ownLast = "0" !== f, x(function () {
            var n, r, o, s = "padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;", l = a.getElementsByTagName("body")[0];
            l && (n = a.createElement("div"), n.style.cssText = "border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px", l.appendChild(n).appendChild(d), d.innerHTML = "<table><tr><td></td><td>t</td></tr></table>", o = d.getElementsByTagName("td"), o[0].style.cssText = "padding:0;margin:0;border:0;display:none", p = 0 === o[0].offsetHeight, o[0].style.display = "", o[1].style.display = "none", t.reliableHiddenOffsets = p && 0 === o[0].offsetHeight, d.innerHTML = "", d.style.cssText = "box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;", x.swap(l, null != l.style.zoom ? {zoom: 1} : {}, function () {
                t.boxSizing = 4 === d.offsetWidth
            }), e.getComputedStyle && (t.pixelPosition = "1%" !== (e.getComputedStyle(d, null) || {}).top, t.boxSizingReliable = "4px" === (e.getComputedStyle(d, null) || {width: "4px"}).width, r = d.appendChild(a.createElement("div")), r.style.cssText = d.style.cssText = s, r.style.marginRight = r.style.width = "0", d.style.width = "1px", t.reliableMarginRight = !parseFloat((e.getComputedStyle(r, null) || {}).marginRight)), typeof d.style.zoom !== i && (d.innerHTML = "", d.style.cssText = s + "width:1px;padding:1px;display:inline;zoom:1", t.inlineBlockNeedsLayout = 3 === d.offsetWidth, d.style.display = "block", d.innerHTML = "<div></div>", d.firstChild.style.width = "5px", t.shrinkWrapBlocks = 3 !== d.offsetWidth, t.inlineBlockNeedsLayout && (l.style.zoom = 1)), l.removeChild(n), n = d = o = r = null)
        }), n = s = l = u = r = o = null, t
    }({});
    var B = /(?:\{[\s\S]*\}|\[[\s\S]*\])$/, P = /([A-Z])/g;

    function R(e, n, r, i) {
        if (x.acceptData(e)) {
            var o, a, s = x.expando, l = e.nodeType, u = l ? x.cache : e, c = l ? e[s] : e[s] && s;
            if (c && u[c] && (i || u[c].data) || r !== t || "string" != typeof n)return c || (c = l ? e[s] = p.pop() || x.guid++ : s), u[c] || (u[c] = l ? {} : {toJSON: x.noop}), ("object" == typeof n || "function" == typeof n) && (i ? u[c] = x.extend(u[c], n) : u[c].data = x.extend(u[c].data, n)), a = u[c], i || (a.data || (a.data = {}), a = a.data), r !== t && (a[x.camelCase(n)] = r), "string" == typeof n ? (o = a[n], null == o && (o = a[x.camelCase(n)])) : o = a, o
        }
    }

    function W(e, t, n) {
        if (x.acceptData(e)) {
            var r, i, o = e.nodeType, a = o ? x.cache : e, s = o ? e[x.expando] : x.expando;
            if (a[s]) {
                if (t && (r = n ? a[s] : a[s].data)) {
                    x.isArray(t) ? t = t.concat(x.map(t, x.camelCase)) : t in r ? t = [t] : (t = x.camelCase(t), t = t in r ? [t] : t.split(" ")), i = t.length;
                    while (i--)delete r[t[i]];
                    if (n ? !I(r) : !x.isEmptyObject(r))return
                }
                (n || (delete a[s].data, I(a[s]))) && (o ? x.cleanData([e], !0) : x.support.deleteExpando || a != a.window ? delete a[s] : a[s] = null)
            }
        }
    }

    x.extend({cache: {}, noData: {applet: !0, embed: !0, object: "clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"}, hasData: function (e) {
        return e = e.nodeType ? x.cache[e[x.expando]] : e[x.expando], !!e && !I(e)
    }, data: function (e, t, n) {
        return R(e, t, n)
    }, removeData: function (e, t) {
        return W(e, t)
    }, _data: function (e, t, n) {
        return R(e, t, n, !0)
    }, _removeData: function (e, t) {
        return W(e, t, !0)
    }, acceptData: function (e) {
        if (e.nodeType && 1 !== e.nodeType && 9 !== e.nodeType)return!1;
        var t = e.nodeName && x.noData[e.nodeName.toLowerCase()];
        return!t || t !== !0 && e.getAttribute("classid") === t
    }}), x.fn.extend({data: function (e, n) {
        var r, i, o = null, a = 0, s = this[0];
        if (e === t) {
            if (this.length && (o = x.data(s), 1 === s.nodeType && !x._data(s, "parsedAttrs"))) {
                for (r = s.attributes; r.length > a; a++)i = r[a].name, 0 === i.indexOf("data-") && (i = x.camelCase(i.slice(5)), $(s, i, o[i]));
                x._data(s, "parsedAttrs", !0)
            }
            return o
        }
        return"object" == typeof e ? this.each(function () {
            x.data(this, e)
        }) : arguments.length > 1 ? this.each(function () {
            x.data(this, e, n)
        }) : s ? $(s, e, x.data(s, e)) : null
    }, removeData: function (e) {
        return this.each(function () {
            x.removeData(this, e)
        })
    }});
    function $(e, n, r) {
        if (r === t && 1 === e.nodeType) {
            var i = "data-" + n.replace(P, "-$1").toLowerCase();
            if (r = e.getAttribute(i), "string" == typeof r) {
                try {
                    r = "true" === r ? !0 : "false" === r ? !1 : "null" === r ? null : +r + "" === r ? +r : B.test(r) ? x.parseJSON(r) : r
                } catch (o) {
                }
                x.data(e, n, r)
            } else r = t
        }
        return r
    }

    function I(e) {
        var t;
        for (t in e)if (("data" !== t || !x.isEmptyObject(e[t])) && "toJSON" !== t)return!1;
        return!0
    }

    x.extend({queue: function (e, n, r) {
        var i;
        return e ? (n = (n || "fx") + "queue", i = x._data(e, n), r && (!i || x.isArray(r) ? i = x._data(e, n, x.makeArray(r)) : i.push(r)), i || []) : t
    }, dequeue: function (e, t) {
        t = t || "fx";
        var n = x.queue(e, t), r = n.length, i = n.shift(), o = x._queueHooks(e, t), a = function () {
            x.dequeue(e, t)
        };
        "inprogress" === i && (i = n.shift(), r--), i && ("fx" === t && n.unshift("inprogress"), delete o.stop, i.call(e, a, o)), !r && o && o.empty.fire()
    }, _queueHooks: function (e, t) {
        var n = t + "queueHooks";
        return x._data(e, n) || x._data(e, n, {empty: x.Callbacks("once memory").add(function () {
            x._removeData(e, t + "queue"), x._removeData(e, n)
        })})
    }}), x.fn.extend({queue: function (e, n) {
        var r = 2;
        return"string" != typeof e && (n = e, e = "fx", r--), r > arguments.length ? x.queue(this[0], e) : n === t ? this : this.each(function () {
            var t = x.queue(this, e, n);
            x._queueHooks(this, e), "fx" === e && "inprogress" !== t[0] && x.dequeue(this, e)
        })
    }, dequeue: function (e) {
        return this.each(function () {
            x.dequeue(this, e)
        })
    }, delay: function (e, t) {
        return e = x.fx ? x.fx.speeds[e] || e : e, t = t || "fx", this.queue(t, function (t, n) {
            var r = setTimeout(t, e);
            n.stop = function () {
                clearTimeout(r)
            }
        })
    }, clearQueue: function (e) {
        return this.queue(e || "fx", [])
    }, promise: function (e, n) {
        var r, i = 1, o = x.Deferred(), a = this, s = this.length, l = function () {
            --i || o.resolveWith(a, [a])
        };
        "string" != typeof e && (n = e, e = t), e = e || "fx";
        while (s--)r = x._data(a[s], e + "queueHooks"), r && r.empty && (i++, r.empty.add(l));
        return l(), o.promise(n)
    }});
    var z, X, U = /[\t\r\n\f]/g, V = /\r/g, Y = /^(?:input|select|textarea|button|object)$/i, J = /^(?:a|area)$/i, G = /^(?:checked|selected)$/i, Q = x.support.getSetAttribute, K = x.support.input;
    x.fn.extend({attr: function (e, t) {
        return x.access(this, x.attr, e, t, arguments.length > 1)
    }, removeAttr: function (e) {
        return this.each(function () {
            x.removeAttr(this, e)
        })
    }, prop: function (e, t) {
        return x.access(this, x.prop, e, t, arguments.length > 1)
    }, removeProp: function (e) {
        return e = x.propFix[e] || e, this.each(function () {
            try {
                this[e] = t, delete this[e]
            } catch (n) {
            }
        })
    }, addClass: function (e) {
        var t, n, r, i, o, a = 0, s = this.length, l = "string" == typeof e && e;
        if (x.isFunction(e))return this.each(function (t) {
            x(this).addClass(e.call(this, t, this.className))
        });
        if (l)for (t = (e || "").match(T) || []; s > a; a++)if (n = this[a], r = 1 === n.nodeType && (n.className ? (" " + n.className + " ").replace(U, " ") : " ")) {
            o = 0;
            while (i = t[o++])0 > r.indexOf(" " + i + " ") && (r += i + " ");
            n.className = x.trim(r)
        }
        return this
    }, removeClass: function (e) {
        var t, n, r, i, o, a = 0, s = this.length, l = 0 === arguments.length || "string" == typeof e && e;
        if (x.isFunction(e))return this.each(function (t) {
            x(this).removeClass(e.call(this, t, this.className))
        });
        if (l)for (t = (e || "").match(T) || []; s > a; a++)if (n = this[a], r = 1 === n.nodeType && (n.className ? (" " + n.className + " ").replace(U, " ") : "")) {
            o = 0;
            while (i = t[o++])while (r.indexOf(" " + i + " ") >= 0)r = r.replace(" " + i + " ", " ");
            n.className = e ? x.trim(r) : ""
        }
        return this
    }, toggleClass: function (e, t) {
        var n = typeof e;
        return"boolean" == typeof t && "string" === n ? t ? this.addClass(e) : this.removeClass(e) : x.isFunction(e) ? this.each(function (n) {
            x(this).toggleClass(e.call(this, n, this.className, t), t)
        }) : this.each(function () {
            if ("string" === n) {
                var t, r = 0, o = x(this), a = e.match(T) || [];
                while (t = a[r++])o.hasClass(t) ? o.removeClass(t) : o.addClass(t)
            } else(n === i || "boolean" === n) && (this.className && x._data(this, "__className__", this.className), this.className = this.className || e === !1 ? "" : x._data(this, "__className__") || "")
        })
    }, hasClass: function (e) {
        var t = " " + e + " ", n = 0, r = this.length;
        for (; r > n; n++)if (1 === this[n].nodeType && (" " + this[n].className + " ").replace(U, " ").indexOf(t) >= 0)return!0;
        return!1
    }, val: function (e) {
        var n, r, i, o = this[0];
        {
            if (arguments.length)return i = x.isFunction(e), this.each(function (n) {
                var o;
                1 === this.nodeType && (o = i ? e.call(this, n, x(this).val()) : e, null == o ? o = "" : "number" == typeof o ? o += "" : x.isArray(o) && (o = x.map(o, function (e) {
                    return null == e ? "" : e + ""
                })), r = x.valHooks[this.type] || x.valHooks[this.nodeName.toLowerCase()], r && "set"in r && r.set(this, o, "value") !== t || (this.value = o))
            });
            if (o)return r = x.valHooks[o.type] || x.valHooks[o.nodeName.toLowerCase()], r && "get"in r && (n = r.get(o, "value")) !== t ? n : (n = o.value, "string" == typeof n ? n.replace(V, "") : null == n ? "" : n)
        }
    }}), x.extend({valHooks: {option: {get: function (e) {
        var t = x.find.attr(e, "value");
        return null != t ? t : e.text
    }}, select: {get: function (e) {
        var t, n, r = e.options, i = e.selectedIndex, o = "select-one" === e.type || 0 > i, a = o ? null : [], s = o ? i + 1 : r.length, l = 0 > i ? s : o ? i : 0;
        for (; s > l; l++)if (n = r[l], !(!n.selected && l !== i || (x.support.optDisabled ? n.disabled : null !== n.getAttribute("disabled")) || n.parentNode.disabled && x.nodeName(n.parentNode, "optgroup"))) {
            if (t = x(n).val(), o)return t;
            a.push(t)
        }
        return a
    }, set: function (e, t) {
        var n, r, i = e.options, o = x.makeArray(t), a = i.length;
        while (a--)r = i[a], (r.selected = x.inArray(x(r).val(), o) >= 0) && (n = !0);
        return n || (e.selectedIndex = -1), o
    }}}, attr: function (e, n, r) {
        var o, a, s = e.nodeType;
        if (e && 3 !== s && 8 !== s && 2 !== s)return typeof e.getAttribute === i ? x.prop(e, n, r) : (1 === s && x.isXMLDoc(e) || (n = n.toLowerCase(), o = x.attrHooks[n] || (x.expr.match.bool.test(n) ? X : z)), r === t ? o && "get"in o && null !== (a = o.get(e, n)) ? a : (a = x.find.attr(e, n), null == a ? t : a) : null !== r ? o && "set"in o && (a = o.set(e, r, n)) !== t ? a : (e.setAttribute(n, r + ""), r) : (x.removeAttr(e, n), t))
    }, removeAttr: function (e, t) {
        var n, r, i = 0, o = t && t.match(T);
        if (o && 1 === e.nodeType)while (n = o[i++])r = x.propFix[n] || n, x.expr.match.bool.test(n) ? K && Q || !G.test(n) ? e[r] = !1 : e[x.camelCase("default-" + n)] = e[r] = !1 : x.attr(e, n, ""), e.removeAttribute(Q ? n : r)
    }, attrHooks: {type: {set: function (e, t) {
        if (!x.support.radioValue && "radio" === t && x.nodeName(e, "input")) {
            var n = e.value;
            return e.setAttribute("type", t), n && (e.value = n), t
        }
    }}}, propFix: {"for": "htmlFor", "class": "className"}, prop: function (e, n, r) {
        var i, o, a, s = e.nodeType;
        if (e && 3 !== s && 8 !== s && 2 !== s)return a = 1 !== s || !x.isXMLDoc(e), a && (n = x.propFix[n] || n, o = x.propHooks[n]), r !== t ? o && "set"in o && (i = o.set(e, r, n)) !== t ? i : e[n] = r : o && "get"in o && null !== (i = o.get(e, n)) ? i : e[n]
    }, propHooks: {tabIndex: {get: function (e) {
        var t = x.find.attr(e, "tabindex");
        return t ? parseInt(t, 10) : Y.test(e.nodeName) || J.test(e.nodeName) && e.href ? 0 : -1
    }}}}), X = {set: function (e, t, n) {
        return t === !1 ? x.removeAttr(e, n) : K && Q || !G.test(n) ? e.setAttribute(!Q && x.propFix[n] || n, n) : e[x.camelCase("default-" + n)] = e[n] = !0, n
    }}, x.each(x.expr.match.bool.source.match(/\w+/g), function (e, n) {
        var r = x.expr.attrHandle[n] || x.find.attr;
        x.expr.attrHandle[n] = K && Q || !G.test(n) ? function (e, n, i) {
            var o = x.expr.attrHandle[n], a = i ? t : (x.expr.attrHandle[n] = t) != r(e, n, i) ? n.toLowerCase() : null;
            return x.expr.attrHandle[n] = o, a
        } : function (e, n, r) {
            return r ? t : e[x.camelCase("default-" + n)] ? n.toLowerCase() : null
        }
    }), K && Q || (x.attrHooks.value = {set: function (e, n, r) {
        return x.nodeName(e, "input") ? (e.defaultValue = n, t) : z && z.set(e, n, r)
    }}), Q || (z = {set: function (e, n, r) {
        var i = e.getAttributeNode(r);
        return i || e.setAttributeNode(i = e.ownerDocument.createAttribute(r)), i.value = n += "", "value" === r || n === e.getAttribute(r) ? n : t
    }}, x.expr.attrHandle.id = x.expr.attrHandle.name = x.expr.attrHandle.coords = function (e, n, r) {
        var i;
        return r ? t : (i = e.getAttributeNode(n)) && "" !== i.value ? i.value : null
    }, x.valHooks.button = {get: function (e, n) {
        var r = e.getAttributeNode(n);
        return r && r.specified ? r.value : t
    }, set: z.set}, x.attrHooks.contenteditable = {set: function (e, t, n) {
        z.set(e, "" === t ? !1 : t, n)
    }}, x.each(["width", "height"], function (e, n) {
        x.attrHooks[n] = {set: function (e, r) {
            return"" === r ? (e.setAttribute(n, "auto"), r) : t
        }}
    })), x.support.hrefNormalized || x.each(["href", "src"], function (e, t) {
        x.propHooks[t] = {get: function (e) {
            return e.getAttribute(t, 4)
        }}
    }), x.support.style || (x.attrHooks.style = {get: function (e) {
        return e.style.cssText || t
    }, set: function (e, t) {
        return e.style.cssText = t + ""
    }}), x.support.optSelected || (x.propHooks.selected = {get: function (e) {
        var t = e.parentNode;
        return t && (t.selectedIndex, t.parentNode && t.parentNode.selectedIndex), null
    }}), x.each(["tabIndex", "readOnly", "maxLength", "cellSpacing", "cellPadding", "rowSpan", "colSpan", "useMap", "frameBorder", "contentEditable"], function () {
        x.propFix[this.toLowerCase()] = this
    }), x.support.enctype || (x.propFix.enctype = "encoding"), x.each(["radio", "checkbox"], function () {
        x.valHooks[this] = {set: function (e, n) {
            return x.isArray(n) ? e.checked = x.inArray(x(e).val(), n) >= 0 : t
        }}, x.support.checkOn || (x.valHooks[this].get = function (e) {
            return null === e.getAttribute("value") ? "on" : e.value
        })
    });
    var Z = /^(?:input|select|textarea)$/i, et = /^key/, tt = /^(?:mouse|contextmenu)|click/, nt = /^(?:focusinfocus|focusoutblur)$/, rt = /^([^.]*)(?:\.(.+)|)$/;

    function it() {
        return!0
    }

    function ot() {
        return!1
    }

    function at() {
        try {
            return a.activeElement
        } catch (e) {
        }
    }

    x.event = {global: {}, add: function (e, n, r, o, a) {
        var s, l, u, c, p, f, d, h, g, m, y, v = x._data(e);
        if (v) {
            r.handler && (c = r, r = c.handler, a = c.selector), r.guid || (r.guid = x.guid++), (l = v.events) || (l = v.events = {}), (f = v.handle) || (f = v.handle = function (e) {
                return typeof x === i || e && x.event.triggered === e.type ? t : x.event.dispatch.apply(f.elem, arguments)
            }, f.elem = e), n = (n || "").match(T) || [""], u = n.length;
            while (u--)s = rt.exec(n[u]) || [], g = y = s[1], m = (s[2] || "").split(".").sort(), g && (p = x.event.special[g] || {}, g = (a ? p.delegateType : p.bindType) || g, p = x.event.special[g] || {}, d = x.extend({type: g, origType: y, data: o, handler: r, guid: r.guid, selector: a, needsContext: a && x.expr.match.needsContext.test(a), namespace: m.join(".")}, c), (h = l[g]) || (h = l[g] = [], h.delegateCount = 0, p.setup && p.setup.call(e, o, m, f) !== !1 || (e.addEventListener ? e.addEventListener(g, f, !1) : e.attachEvent && e.attachEvent("on" + g, f))), p.add && (p.add.call(e, d), d.handler.guid || (d.handler.guid = r.guid)), a ? h.splice(h.delegateCount++, 0, d) : h.push(d), x.event.global[g] = !0);
            e = null
        }
    }, remove: function (e, t, n, r, i) {
        var o, a, s, l, u, c, p, f, d, h, g, m = x.hasData(e) && x._data(e);
        if (m && (c = m.events)) {
            t = (t || "").match(T) || [""], u = t.length;
            while (u--)if (s = rt.exec(t[u]) || [], d = g = s[1], h = (s[2] || "").split(".").sort(), d) {
                p = x.event.special[d] || {}, d = (r ? p.delegateType : p.bindType) || d, f = c[d] || [], s = s[2] && RegExp("(^|\\.)" + h.join("\\.(?:.*\\.|)") + "(\\.|$)"), l = o = f.length;
                while (o--)a = f[o], !i && g !== a.origType || n && n.guid !== a.guid || s && !s.test(a.namespace) || r && r !== a.selector && ("**" !== r || !a.selector) || (f.splice(o, 1), a.selector && f.delegateCount--, p.remove && p.remove.call(e, a));
                l && !f.length && (p.teardown && p.teardown.call(e, h, m.handle) !== !1 || x.removeEvent(e, d, m.handle), delete c[d])
            } else for (d in c)x.event.remove(e, d + t[u], n, r, !0);
            x.isEmptyObject(c) && (delete m.handle, x._removeData(e, "events"))
        }
    }, trigger: function (n, r, i, o) {
        var s, l, u, c, p, f, d, h = [i || a], g = v.call(n, "type") ? n.type : n, m = v.call(n, "namespace") ? n.namespace.split(".") : [];
        if (u = f = i = i || a, 3 !== i.nodeType && 8 !== i.nodeType && !nt.test(g + x.event.triggered) && (g.indexOf(".") >= 0 && (m = g.split("."), g = m.shift(), m.sort()), l = 0 > g.indexOf(":") && "on" + g, n = n[x.expando] ? n : new x.Event(g, "object" == typeof n && n), n.isTrigger = o ? 2 : 3, n.namespace = m.join("."), n.namespace_re = n.namespace ? RegExp("(^|\\.)" + m.join("\\.(?:.*\\.|)") + "(\\.|$)") : null, n.result = t, n.target || (n.target = i), r = null == r ? [n] : x.makeArray(r, [n]), p = x.event.special[g] || {}, o || !p.trigger || p.trigger.apply(i, r) !== !1)) {
            if (!o && !p.noBubble && !x.isWindow(i)) {
                for (c = p.delegateType || g, nt.test(c + g) || (u = u.parentNode); u; u = u.parentNode)h.push(u), f = u;
                f === (i.ownerDocument || a) && h.push(f.defaultView || f.parentWindow || e)
            }
            d = 0;
            while ((u = h[d++]) && !n.isPropagationStopped())n.type = d > 1 ? c : p.bindType || g, s = (x._data(u, "events") || {})[n.type] && x._data(u, "handle"), s && s.apply(u, r), s = l && u[l], s && x.acceptData(u) && s.apply && s.apply(u, r) === !1 && n.preventDefault();
            if (n.type = g, !o && !n.isDefaultPrevented() && (!p._default || p._default.apply(h.pop(), r) === !1) && x.acceptData(i) && l && i[g] && !x.isWindow(i)) {
                f = i[l], f && (i[l] = null), x.event.triggered = g;
                try {
                    i[g]()
                } catch (y) {
                }
                x.event.triggered = t, f && (i[l] = f)
            }
            return n.result
        }
    }, dispatch: function (e) {
        e = x.event.fix(e);
        var n, r, i, o, a, s = [], l = g.call(arguments), u = (x._data(this, "events") || {})[e.type] || [], c = x.event.special[e.type] || {};
        if (l[0] = e, e.delegateTarget = this, !c.preDispatch || c.preDispatch.call(this, e) !== !1) {
            s = x.event.handlers.call(this, e, u), n = 0;
            while ((o = s[n++]) && !e.isPropagationStopped()) {
                e.currentTarget = o.elem, a = 0;
                while ((i = o.handlers[a++]) && !e.isImmediatePropagationStopped())(!e.namespace_re || e.namespace_re.test(i.namespace)) && (e.handleObj = i, e.data = i.data, r = ((x.event.special[i.origType] || {}).handle || i.handler).apply(o.elem, l), r !== t && (e.result = r) === !1 && (e.preventDefault(), e.stopPropagation()))
            }
            return c.postDispatch && c.postDispatch.call(this, e), e.result
        }
    }, handlers: function (e, n) {
        var r, i, o, a, s = [], l = n.delegateCount, u = e.target;
        if (l && u.nodeType && (!e.button || "click" !== e.type))for (; u != this; u = u.parentNode || this)if (1 === u.nodeType && (u.disabled !== !0 || "click" !== e.type)) {
            for (o = [], a = 0; l > a; a++)i = n[a], r = i.selector + " ", o[r] === t && (o[r] = i.needsContext ? x(r, this).index(u) >= 0 : x.find(r, this, null, [u]).length), o[r] && o.push(i);
            o.length && s.push({elem: u, handlers: o})
        }
        return n.length > l && s.push({elem: this, handlers: n.slice(l)}), s
    }, fix: function (e) {
        if (e[x.expando])return e;
        var t, n, r, i = e.type, o = e, s = this.fixHooks[i];
        s || (this.fixHooks[i] = s = tt.test(i) ? this.mouseHooks : et.test(i) ? this.keyHooks : {}), r = s.props ? this.props.concat(s.props) : this.props, e = new x.Event(o), t = r.length;
        while (t--)n = r[t], e[n] = o[n];
        return e.target || (e.target = o.srcElement || a), 3 === e.target.nodeType && (e.target = e.target.parentNode), e.metaKey = !!e.metaKey, s.filter ? s.filter(e, o) : e
    }, props: "altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "), fixHooks: {}, keyHooks: {props: "char charCode key keyCode".split(" "), filter: function (e, t) {
        return null == e.which && (e.which = null != t.charCode ? t.charCode : t.keyCode), e
    }}, mouseHooks: {props: "button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "), filter: function (e, n) {
        var r, i, o, s = n.button, l = n.fromElement;
        return null == e.pageX && null != n.clientX && (i = e.target.ownerDocument || a, o = i.documentElement, r = i.body, e.pageX = n.clientX + (o && o.scrollLeft || r && r.scrollLeft || 0) - (o && o.clientLeft || r && r.clientLeft || 0), e.pageY = n.clientY + (o && o.scrollTop || r && r.scrollTop || 0) - (o && o.clientTop || r && r.clientTop || 0)), !e.relatedTarget && l && (e.relatedTarget = l === e.target ? n.toElement : l), e.which || s === t || (e.which = 1 & s ? 1 : 2 & s ? 3 : 4 & s ? 2 : 0), e
    }}, special: {load: {noBubble: !0}, focus: {trigger: function () {
        if (this !== at() && this.focus)try {
            return this.focus(), !1
        } catch (e) {
        }
    }, delegateType: "focusin"}, blur: {trigger: function () {
        return this === at() && this.blur ? (this.blur(), !1) : t
    }, delegateType: "focusout"}, click: {trigger: function () {
        return x.nodeName(this, "input") && "checkbox" === this.type && this.click ? (this.click(), !1) : t
    }, _default: function (e) {
        return x.nodeName(e.target, "a")
    }}, beforeunload: {postDispatch: function (e) {
        e.result !== t && (e.originalEvent.returnValue = e.result)
    }}}, simulate: function (e, t, n, r) {
        var i = x.extend(new x.Event, n, {type: e, isSimulated: !0, originalEvent: {}});
        r ? x.event.trigger(i, null, t) : x.event.dispatch.call(t, i), i.isDefaultPrevented() && n.preventDefault()
    }}, x.removeEvent = a.removeEventListener ? function (e, t, n) {
        e.removeEventListener && e.removeEventListener(t, n, !1)
    } : function (e, t, n) {
        var r = "on" + t;
        e.detachEvent && (typeof e[r] === i && (e[r] = null), e.detachEvent(r, n))
    }, x.Event = function (e, n) {
        return this instanceof x.Event ? (e && e.type ? (this.originalEvent = e, this.type = e.type, this.isDefaultPrevented = e.defaultPrevented || e.returnValue === !1 || e.getPreventDefault && e.getPreventDefault() ? it : ot) : this.type = e, n && x.extend(this, n), this.timeStamp = e && e.timeStamp || x.now(), this[x.expando] = !0, t) : new x.Event(e, n)
    }, x.Event.prototype = {isDefaultPrevented: ot, isPropagationStopped: ot, isImmediatePropagationStopped: ot, preventDefault: function () {
        var e = this.originalEvent;
        this.isDefaultPrevented = it, e && (e.preventDefault ? e.preventDefault() : e.returnValue = !1)
    }, stopPropagation: function () {
        var e = this.originalEvent;
        this.isPropagationStopped = it, e && (e.stopPropagation && e.stopPropagation(), e.cancelBubble = !0)
    }, stopImmediatePropagation: function () {
        this.isImmediatePropagationStopped = it, this.stopPropagation()
    }}, x.each({mouseenter: "mouseover", mouseleave: "mouseout"}, function (e, t) {
        x.event.special[e] = {delegateType: t, bindType: t, handle: function (e) {
            var n, r = this, i = e.relatedTarget, o = e.handleObj;
            return(!i || i !== r && !x.contains(r, i)) && (e.type = o.origType, n = o.handler.apply(this, arguments), e.type = t), n
        }}
    }), x.support.submitBubbles || (x.event.special.submit = {setup: function () {
        return x.nodeName(this, "form") ? !1 : (x.event.add(this, "click._submit keypress._submit", function (e) {
            var n = e.target, r = x.nodeName(n, "input") || x.nodeName(n, "button") ? n.form : t;
            r && !x._data(r, "submitBubbles") && (x.event.add(r, "submit._submit", function (e) {
                e._submit_bubble = !0
            }), x._data(r, "submitBubbles", !0))
        }), t)
    }, postDispatch: function (e) {
        e._submit_bubble && (delete e._submit_bubble, this.parentNode && !e.isTrigger && x.event.simulate("submit", this.parentNode, e, !0))
    }, teardown: function () {
        return x.nodeName(this, "form") ? !1 : (x.event.remove(this, "._submit"), t)
    }}), x.support.changeBubbles || (x.event.special.change = {setup: function () {
        return Z.test(this.nodeName) ? (("checkbox" === this.type || "radio" === this.type) && (x.event.add(this, "propertychange._change", function (e) {
            "checked" === e.originalEvent.propertyName && (this._just_changed = !0)
        }), x.event.add(this, "click._change", function (e) {
            this._just_changed && !e.isTrigger && (this._just_changed = !1), x.event.simulate("change", this, e, !0)
        })), !1) : (x.event.add(this, "beforeactivate._change", function (e) {
            var t = e.target;
            Z.test(t.nodeName) && !x._data(t, "changeBubbles") && (x.event.add(t, "change._change", function (e) {
                !this.parentNode || e.isSimulated || e.isTrigger || x.event.simulate("change", this.parentNode, e, !0)
            }), x._data(t, "changeBubbles", !0))
        }), t)
    }, handle: function (e) {
        var n = e.target;
        return this !== n || e.isSimulated || e.isTrigger || "radio" !== n.type && "checkbox" !== n.type ? e.handleObj.handler.apply(this, arguments) : t
    }, teardown: function () {
        return x.event.remove(this, "._change"), !Z.test(this.nodeName)
    }}), x.support.focusinBubbles || x.each({focus: "focusin", blur: "focusout"}, function (e, t) {
        var n = 0, r = function (e) {
            x.event.simulate(t, e.target, x.event.fix(e), !0)
        };
        x.event.special[t] = {setup: function () {
            0 === n++ && a.addEventListener(e, r, !0)
        }, teardown: function () {
            0 === --n && a.removeEventListener(e, r, !0)
        }}
    }), x.fn.extend({on: function (e, n, r, i, o) {
        var a, s;
        if ("object" == typeof e) {
            "string" != typeof n && (r = r || n, n = t);
            for (a in e)this.on(a, n, r, e[a], o);
            return this
        }
        if (null == r && null == i ? (i = n, r = n = t) : null == i && ("string" == typeof n ? (i = r, r = t) : (i = r, r = n, n = t)), i === !1)i = ot; else if (!i)return this;
        return 1 === o && (s = i, i = function (e) {
            return x().off(e), s.apply(this, arguments)
        }, i.guid = s.guid || (s.guid = x.guid++)), this.each(function () {
            x.event.add(this, e, i, r, n)
        })
    }, one: function (e, t, n, r) {
        return this.on(e, t, n, r, 1)
    }, off: function (e, n, r) {
        var i, o;
        if (e && e.preventDefault && e.handleObj)return i = e.handleObj, x(e.delegateTarget).off(i.namespace ? i.origType + "." + i.namespace : i.origType, i.selector, i.handler), this;
        if ("object" == typeof e) {
            for (o in e)this.off(o, n, e[o]);
            return this
        }
        return(n === !1 || "function" == typeof n) && (r = n, n = t), r === !1 && (r = ot), this.each(function () {
            x.event.remove(this, e, r, n)
        })
    }, trigger: function (e, t) {
        return this.each(function () {
            x.event.trigger(e, t, this)
        })
    }, triggerHandler: function (e, n) {
        var r = this[0];
        return r ? x.event.trigger(e, n, r, !0) : t
    }});
    var st = /^.[^:#\[\.,]*$/, lt = /^(?:parents|prev(?:Until|All))/, ut = x.expr.match.needsContext, ct = {children: !0, contents: !0, next: !0, prev: !0};
    x.fn.extend({find: function (e) {
        var t, n = [], r = this, i = r.length;
        if ("string" != typeof e)return this.pushStack(x(e).filter(function () {
            for (t = 0; i > t; t++)if (x.contains(r[t], this))return!0
        }));
        for (t = 0; i > t; t++)x.find(e, r[t], n);
        return n = this.pushStack(i > 1 ? x.unique(n) : n), n.selector = this.selector ? this.selector + " " + e : e, n
    }, has: function (e) {
        var t, n = x(e, this), r = n.length;
        return this.filter(function () {
            for (t = 0; r > t; t++)if (x.contains(this, n[t]))return!0
        })
    }, not: function (e) {
        return this.pushStack(ft(this, e || [], !0))
    }, filter: function (e) {
        return this.pushStack(ft(this, e || [], !1))
    }, is: function (e) {
        return!!ft(this, "string" == typeof e && ut.test(e) ? x(e) : e || [], !1).length
    }, closest: function (e, t) {
        var n, r = 0, i = this.length, o = [], a = ut.test(e) || "string" != typeof e ? x(e, t || this.context) : 0;
        for (; i > r; r++)for (n = this[r]; n && n !== t; n = n.parentNode)if (11 > n.nodeType && (a ? a.index(n) > -1 : 1 === n.nodeType && x.find.matchesSelector(n, e))) {
            n = o.push(n);
            break
        }
        return this.pushStack(o.length > 1 ? x.unique(o) : o)
    }, index: function (e) {
        return e ? "string" == typeof e ? x.inArray(this[0], x(e)) : x.inArray(e.jquery ? e[0] : e, this) : this[0] && this[0].parentNode ? this.first().prevAll().length : -1
    }, add: function (e, t) {
        var n = "string" == typeof e ? x(e, t) : x.makeArray(e && e.nodeType ? [e] : e), r = x.merge(this.get(), n);
        return this.pushStack(x.unique(r))
    }, addBack: function (e) {
        return this.add(null == e ? this.prevObject : this.prevObject.filter(e))
    }});
    function pt(e, t) {
        do e = e[t]; while (e && 1 !== e.nodeType);
        return e
    }

    x.each({parent: function (e) {
        var t = e.parentNode;
        return t && 11 !== t.nodeType ? t : null
    }, parents: function (e) {
        return x.dir(e, "parentNode")
    }, parentsUntil: function (e, t, n) {
        return x.dir(e, "parentNode", n)
    }, next: function (e) {
        return pt(e, "nextSibling")
    }, prev: function (e) {
        return pt(e, "previousSibling")
    }, nextAll: function (e) {
        return x.dir(e, "nextSibling")
    }, prevAll: function (e) {
        return x.dir(e, "previousSibling")
    }, nextUntil: function (e, t, n) {
        return x.dir(e, "nextSibling", n)
    }, prevUntil: function (e, t, n) {
        return x.dir(e, "previousSibling", n)
    }, siblings: function (e) {
        return x.sibling((e.parentNode || {}).firstChild, e)
    }, children: function (e) {
        return x.sibling(e.firstChild)
    }, contents: function (e) {
        return x.nodeName(e, "iframe") ? e.contentDocument || e.contentWindow.document : x.merge([], e.childNodes)
    }}, function (e, t) {
        x.fn[e] = function (n, r) {
            var i = x.map(this, t, n);
            return"Until" !== e.slice(-5) && (r = n), r && "string" == typeof r && (i = x.filter(r, i)), this.length > 1 && (ct[e] || (i = x.unique(i)), lt.test(e) && (i = i.reverse())), this.pushStack(i)
        }
    }), x.extend({filter: function (e, t, n) {
        var r = t[0];
        return n && (e = ":not(" + e + ")"), 1 === t.length && 1 === r.nodeType ? x.find.matchesSelector(r, e) ? [r] : [] : x.find.matches(e, x.grep(t, function (e) {
            return 1 === e.nodeType
        }))
    }, dir: function (e, n, r) {
        var i = [], o = e[n];
        while (o && 9 !== o.nodeType && (r === t || 1 !== o.nodeType || !x(o).is(r)))1 === o.nodeType && i.push(o), o = o[n];
        return i
    }, sibling: function (e, t) {
        var n = [];
        for (; e; e = e.nextSibling)1 === e.nodeType && e !== t && n.push(e);
        return n
    }});
    function ft(e, t, n) {
        if (x.isFunction(t))return x.grep(e, function (e, r) {
            return!!t.call(e, r, e) !== n
        });
        if (t.nodeType)return x.grep(e, function (e) {
            return e === t !== n
        });
        if ("string" == typeof t) {
            if (st.test(t))return x.filter(t, e, n);
            t = x.filter(t, e)
        }
        return x.grep(e, function (e) {
            return x.inArray(e, t) >= 0 !== n
        })
    }

    function dt(e) {
        var t = ht.split("|"), n = e.createDocumentFragment();
        if (n.createElement)while (t.length)n.createElement(t.pop());
        return n
    }

    var ht = "abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video", gt = / jQuery\d+="(?:null|\d+)"/g, mt = RegExp("<(?:" + ht + ")[\\s/>]", "i"), yt = /^\s+/, vt = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi, bt = /<([\w:]+)/, xt = /<tbody/i, wt = /<|&#?\w+;/, Tt = /<(?:script|style|link)/i, Ct = /^(?:checkbox|radio)$/i, Nt = /checked\s*(?:[^=]|=\s*.checked.)/i, kt = /^$|\/(?:java|ecma)script/i, Et = /^true\/(.*)/, St = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g, At = {option: [1, "<select multiple='multiple'>", "</select>"], legend: [1, "<fieldset>", "</fieldset>"], area: [1, "<map>", "</map>"], param: [1, "<object>", "</object>"], thead: [1, "<table>", "</table>"], tr: [2, "<table><tbody>", "</tbody></table>"], col: [2, "<table><tbody></tbody><colgroup>", "</colgroup></table>"], td: [3, "<table><tbody><tr>", "</tr></tbody></table>"], _default: x.support.htmlSerialize ? [0, "", ""] : [1, "X<div>", "</div>"]}, jt = dt(a), Dt = jt.appendChild(a.createElement("div"));
    At.optgroup = At.option, At.tbody = At.tfoot = At.colgroup = At.caption = At.thead, At.th = At.td, x.fn.extend({text: function (e) {
        return x.access(this, function (e) {
            return e === t ? x.text(this) : this.empty().append((this[0] && this[0].ownerDocument || a).createTextNode(e))
        }, null, e, arguments.length)
    }, append: function () {
        return this.domManip(arguments, function (e) {
            if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) {
                var t = Lt(this, e);
                t.appendChild(e)
            }
        })
    }, prepend: function () {
        return this.domManip(arguments, function (e) {
            if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) {
                var t = Lt(this, e);
                t.insertBefore(e, t.firstChild)
            }
        })
    }, before: function () {
        return this.domManip(arguments, function (e) {
            this.parentNode && this.parentNode.insertBefore(e, this)
        })
    }, after: function () {
        return this.domManip(arguments, function (e) {
            this.parentNode && this.parentNode.insertBefore(e, this.nextSibling)
        })
    }, remove: function (e, t) {
        var n, r = e ? x.filter(e, this) : this, i = 0;
        for (; null != (n = r[i]); i++)t || 1 !== n.nodeType || x.cleanData(Ft(n)), n.parentNode && (t && x.contains(n.ownerDocument, n) && _t(Ft(n, "script")), n.parentNode.removeChild(n));
        return this
    }, empty: function () {
        var e, t = 0;
        for (; null != (e = this[t]); t++) {
            1 === e.nodeType && x.cleanData(Ft(e, !1));
            while (e.firstChild)e.removeChild(e.firstChild);
            e.options && x.nodeName(e, "select") && (e.options.length = 0)
        }
        return this
    }, clone: function (e, t) {
        return e = null == e ? !1 : e, t = null == t ? e : t, this.map(function () {
            return x.clone(this, e, t)
        })
    }, html: function (e) {
        return x.access(this, function (e) {
            var n = this[0] || {}, r = 0, i = this.length;
            if (e === t)return 1 === n.nodeType ? n.innerHTML.replace(gt, "") : t;
            if (!("string" != typeof e || Tt.test(e) || !x.support.htmlSerialize && mt.test(e) || !x.support.leadingWhitespace && yt.test(e) || At[(bt.exec(e) || ["", ""])[1].toLowerCase()])) {
                e = e.replace(vt, "<$1></$2>");
                try {
                    for (; i > r; r++)n = this[r] || {}, 1 === n.nodeType && (x.cleanData(Ft(n, !1)), n.innerHTML = e);
                    n = 0
                } catch (o) {
                }
            }
            n && this.empty().append(e)
        }, null, e, arguments.length)
    }, replaceWith: function () {
        var e = x.map(this, function (e) {
            return[e.nextSibling, e.parentNode]
        }), t = 0;
        return this.domManip(arguments, function (n) {
            var r = e[t++], i = e[t++];
            i && (r && r.parentNode !== i && (r = this.nextSibling), x(this).remove(), i.insertBefore(n, r))
        }, !0), t ? this : this.remove()
    }, detach: function (e) {
        return this.remove(e, !0)
    }, domManip: function (e, t, n) {
        e = d.apply([], e);
        var r, i, o, a, s, l, u = 0, c = this.length, p = this, f = c - 1, h = e[0], g = x.isFunction(h);
        if (g || !(1 >= c || "string" != typeof h || x.support.checkClone) && Nt.test(h))return this.each(function (r) {
            var i = p.eq(r);
            g && (e[0] = h.call(this, r, i.html())), i.domManip(e, t, n)
        });
        if (c && (l = x.buildFragment(e, this[0].ownerDocument, !1, !n && this), r = l.firstChild, 1 === l.childNodes.length && (l = r), r)) {
            for (a = x.map(Ft(l, "script"), Ht), o = a.length; c > u; u++)i = l, u !== f && (i = x.clone(i, !0, !0), o && x.merge(a, Ft(i, "script"))), t.call(this[u], i, u);
            if (o)for (s = a[a.length - 1].ownerDocument, x.map(a, qt), u = 0; o > u; u++)i = a[u], kt.test(i.type || "") && !x._data(i, "globalEval") && x.contains(s, i) && (i.src ? x._evalUrl(i.src) : x.globalEval((i.text || i.textContent || i.innerHTML || "").replace(St, "")));
            l = r = null
        }
        return this
    }});
    function Lt(e, t) {
        return x.nodeName(e, "table") && x.nodeName(1 === t.nodeType ? t : t.firstChild, "tr") ? e.getElementsByTagName("tbody")[0] || e.appendChild(e.ownerDocument.createElement("tbody")) : e
    }

    function Ht(e) {
        return e.type = (null !== x.find.attr(e, "type")) + "/" + e.type, e
    }

    function qt(e) {
        var t = Et.exec(e.type);
        return t ? e.type = t[1] : e.removeAttribute("type"), e
    }

    function _t(e, t) {
        var n, r = 0;
        for (; null != (n = e[r]); r++)x._data(n, "globalEval", !t || x._data(t[r], "globalEval"))
    }

    function Mt(e, t) {
        if (1 === t.nodeType && x.hasData(e)) {
            var n, r, i, o = x._data(e), a = x._data(t, o), s = o.events;
            if (s) {
                delete a.handle, a.events = {};
                for (n in s)for (r = 0, i = s[n].length; i > r; r++)x.event.add(t, n, s[n][r])
            }
            a.data && (a.data = x.extend({}, a.data))
        }
    }

    function Ot(e, t) {
        var n, r, i;
        if (1 === t.nodeType) {
            if (n = t.nodeName.toLowerCase(), !x.support.noCloneEvent && t[x.expando]) {
                i = x._data(t);
                for (r in i.events)x.removeEvent(t, r, i.handle);
                t.removeAttribute(x.expando)
            }
            "script" === n && t.text !== e.text ? (Ht(t).text = e.text, qt(t)) : "object" === n ? (t.parentNode && (t.outerHTML = e.outerHTML), x.support.html5Clone && e.innerHTML && !x.trim(t.innerHTML) && (t.innerHTML = e.innerHTML)) : "input" === n && Ct.test(e.type) ? (t.defaultChecked = t.checked = e.checked, t.value !== e.value && (t.value = e.value)) : "option" === n ? t.defaultSelected = t.selected = e.defaultSelected : ("input" === n || "textarea" === n) && (t.defaultValue = e.defaultValue)
        }
    }

    x.each({appendTo: "append", prependTo: "prepend", insertBefore: "before", insertAfter: "after", replaceAll: "replaceWith"}, function (e, t) {
        x.fn[e] = function (e) {
            var n, r = 0, i = [], o = x(e), a = o.length - 1;
            for (; a >= r; r++)n = r === a ? this : this.clone(!0), x(o[r])[t](n), h.apply(i, n.get());
            return this.pushStack(i)
        }
    });
    function Ft(e, n) {
        var r, o, a = 0, s = typeof e.getElementsByTagName !== i ? e.getElementsByTagName(n || "*") : typeof e.querySelectorAll !== i ? e.querySelectorAll(n || "*") : t;
        if (!s)for (s = [], r = e.childNodes || e; null != (o = r[a]); a++)!n || x.nodeName(o, n) ? s.push(o) : x.merge(s, Ft(o, n));
        return n === t || n && x.nodeName(e, n) ? x.merge([e], s) : s
    }

    function Bt(e) {
        Ct.test(e.type) && (e.defaultChecked = e.checked)
    }

    x.extend({clone: function (e, t, n) {
        var r, i, o, a, s, l = x.contains(e.ownerDocument, e);
        if (x.support.html5Clone || x.isXMLDoc(e) || !mt.test("<" + e.nodeName + ">") ? o = e.cloneNode(!0) : (Dt.innerHTML = e.outerHTML, Dt.removeChild(o = Dt.firstChild)), !(x.support.noCloneEvent && x.support.noCloneChecked || 1 !== e.nodeType && 11 !== e.nodeType || x.isXMLDoc(e)))for (r = Ft(o), s = Ft(e), a = 0; null != (i = s[a]); ++a)r[a] && Ot(i, r[a]);
        if (t)if (n)for (s = s || Ft(e), r = r || Ft(o), a = 0; null != (i = s[a]); a++)Mt(i, r[a]); else Mt(e, o);
        return r = Ft(o, "script"), r.length > 0 && _t(r, !l && Ft(e, "script")), r = s = i = null, o
    }, buildFragment: function (e, t, n, r) {
        var i, o, a, s, l, u, c, p = e.length, f = dt(t), d = [], h = 0;
        for (; p > h; h++)if (o = e[h], o || 0 === o)if ("object" === x.type(o))x.merge(d, o.nodeType ? [o] : o); else if (wt.test(o)) {
            s = s || f.appendChild(t.createElement("div")), l = (bt.exec(o) || ["", ""])[1].toLowerCase(), c = At[l] || At._default, s.innerHTML = c[1] + o.replace(vt, "<$1></$2>") + c[2], i = c[0];
            while (i--)s = s.lastChild;
            if (!x.support.leadingWhitespace && yt.test(o) && d.push(t.createTextNode(yt.exec(o)[0])), !x.support.tbody) {
                o = "table" !== l || xt.test(o) ? "<table>" !== c[1] || xt.test(o) ? 0 : s : s.firstChild, i = o && o.childNodes.length;
                while (i--)x.nodeName(u = o.childNodes[i], "tbody") && !u.childNodes.length && o.removeChild(u)
            }
            x.merge(d, s.childNodes), s.textContent = "";
            while (s.firstChild)s.removeChild(s.firstChild);
            s = f.lastChild
        } else d.push(t.createTextNode(o));
        s && f.removeChild(s), x.support.appendChecked || x.grep(Ft(d, "input"), Bt), h = 0;
        while (o = d[h++])if ((!r || -1 === x.inArray(o, r)) && (a = x.contains(o.ownerDocument, o), s = Ft(f.appendChild(o), "script"), a && _t(s), n)) {
            i = 0;
            while (o = s[i++])kt.test(o.type || "") && n.push(o)
        }
        return s = null, f
    }, cleanData: function (e, t) {
        var n, r, o, a, s = 0, l = x.expando, u = x.cache, c = x.support.deleteExpando, f = x.event.special;
        for (; null != (n = e[s]); s++)if ((t || x.acceptData(n)) && (o = n[l], a = o && u[o])) {
            if (a.events)for (r in a.events)f[r] ? x.event.remove(n, r) : x.removeEvent(n, r, a.handle);
            u[o] && (delete u[o], c ? delete n[l] : typeof n.removeAttribute !== i ? n.removeAttribute(l) : n[l] = null, p.push(o))
        }
    }, _evalUrl: function (e) {
        return x.ajax({url: e, type: "GET", dataType: "script", async: !1, global: !1, "throws": !0})
    }}), x.fn.extend({wrapAll: function (e) {
        if (x.isFunction(e))return this.each(function (t) {
            x(this).wrapAll(e.call(this, t))
        });
        if (this[0]) {
            var t = x(e, this[0].ownerDocument).eq(0).clone(!0);
            this[0].parentNode && t.insertBefore(this[0]), t.map(function () {
                var e = this;
                while (e.firstChild && 1 === e.firstChild.nodeType)e = e.firstChild;
                return e
            }).append(this)
        }
        return this
    }, wrapInner: function (e) {
        return x.isFunction(e) ? this.each(function (t) {
            x(this).wrapInner(e.call(this, t))
        }) : this.each(function () {
            var t = x(this), n = t.contents();
            n.length ? n.wrapAll(e) : t.append(e)
        })
    }, wrap: function (e) {
        var t = x.isFunction(e);
        return this.each(function (n) {
            x(this).wrapAll(t ? e.call(this, n) : e)
        })
    }, unwrap: function () {
        return this.parent().each(function () {
            x.nodeName(this, "body") || x(this).replaceWith(this.childNodes)
        }).end()
    }});
    var Pt, Rt, Wt, $t = /alpha\([^)]*\)/i, It = /opacity\s*=\s*([^)]*)/, zt = /^(top|right|bottom|left)$/, Xt = /^(none|table(?!-c[ea]).+)/, Ut = /^margin/, Vt = RegExp("^(" + w + ")(.*)$", "i"), Yt = RegExp("^(" + w + ")(?!px)[a-z%]+$", "i"), Jt = RegExp("^([+-])=(" + w + ")", "i"), Gt = {BODY: "block"}, Qt = {position: "absolute", visibility: "hidden", display: "block"}, Kt = {letterSpacing: 0, fontWeight: 400}, Zt = ["Top", "Right", "Bottom", "Left"], en = ["Webkit", "O", "Moz", "ms"];

    function tn(e, t) {
        if (t in e)return t;
        var n = t.charAt(0).toUpperCase() + t.slice(1), r = t, i = en.length;
        while (i--)if (t = en[i] + n, t in e)return t;
        return r
    }

    function nn(e, t) {
        return e = t || e, "none" === x.css(e, "display") || !x.contains(e.ownerDocument, e)
    }

    function rn(e, t) {
        var n, r, i, o = [], a = 0, s = e.length;
        for (; s > a; a++)r = e[a], r.style && (o[a] = x._data(r, "olddisplay"), n = r.style.display, t ? (o[a] || "none" !== n || (r.style.display = ""), "" === r.style.display && nn(r) && (o[a] = x._data(r, "olddisplay", ln(r.nodeName)))) : o[a] || (i = nn(r), (n && "none" !== n || !i) && x._data(r, "olddisplay", i ? n : x.css(r, "display"))));
        for (a = 0; s > a; a++)r = e[a], r.style && (t && "none" !== r.style.display && "" !== r.style.display || (r.style.display = t ? o[a] || "" : "none"));
        return e
    }

    x.fn.extend({css: function (e, n) {
        return x.access(this, function (e, n, r) {
            var i, o, a = {}, s = 0;
            if (x.isArray(n)) {
                for (o = Rt(e), i = n.length; i > s; s++)a[n[s]] = x.css(e, n[s], !1, o);
                return a
            }
            return r !== t ? x.style(e, n, r) : x.css(e, n)
        }, e, n, arguments.length > 1)
    }, show: function () {
        return rn(this, !0)
    }, hide: function () {
        return rn(this)
    }, toggle: function (e) {
        return"boolean" == typeof e ? e ? this.show() : this.hide() : this.each(function () {
            nn(this) ? x(this).show() : x(this).hide()
        })
    }}), x.extend({cssHooks: {opacity: {get: function (e, t) {
        if (t) {
            var n = Wt(e, "opacity");
            return"" === n ? "1" : n
        }
    }}}, cssNumber: {columnCount: !0, fillOpacity: !0, fontWeight: !0, lineHeight: !0, opacity: !0, order: !0, orphans: !0, widows: !0, zIndex: !0, zoom: !0}, cssProps: {"float": x.support.cssFloat ? "cssFloat" : "styleFloat"}, style: function (e, n, r, i) {
        if (e && 3 !== e.nodeType && 8 !== e.nodeType && e.style) {
            var o, a, s, l = x.camelCase(n), u = e.style;
            if (n = x.cssProps[l] || (x.cssProps[l] = tn(u, l)), s = x.cssHooks[n] || x.cssHooks[l], r === t)return s && "get"in s && (o = s.get(e, !1, i)) !== t ? o : u[n];
            if (a = typeof r, "string" === a && (o = Jt.exec(r)) && (r = (o[1] + 1) * o[2] + parseFloat(x.css(e, n)), a = "number"), !(null == r || "number" === a && isNaN(r) || ("number" !== a || x.cssNumber[l] || (r += "px"), x.support.clearCloneStyle || "" !== r || 0 !== n.indexOf("background") || (u[n] = "inherit"), s && "set"in s && (r = s.set(e, r, i)) === t)))try {
                u[n] = r
            } catch (c) {
            }
        }
    }, css: function (e, n, r, i) {
        var o, a, s, l = x.camelCase(n);
        return n = x.cssProps[l] || (x.cssProps[l] = tn(e.style, l)), s = x.cssHooks[n] || x.cssHooks[l], s && "get"in s && (a = s.get(e, !0, r)), a === t && (a = Wt(e, n, i)), "normal" === a && n in Kt && (a = Kt[n]), "" === r || r ? (o = parseFloat(a), r === !0 || x.isNumeric(o) ? o || 0 : a) : a
    }}), e.getComputedStyle ? (Rt = function (t) {
        return e.getComputedStyle(t, null)
    }, Wt = function (e, n, r) {
        var i, o, a, s = r || Rt(e), l = s ? s.getPropertyValue(n) || s[n] : t, u = e.style;
        return s && ("" !== l || x.contains(e.ownerDocument, e) || (l = x.style(e, n)), Yt.test(l) && Ut.test(n) && (i = u.width, o = u.minWidth, a = u.maxWidth, u.minWidth = u.maxWidth = u.width = l, l = s.width, u.width = i, u.minWidth = o, u.maxWidth = a)), l
    }) : a.documentElement.currentStyle && (Rt = function (e) {
        return e.currentStyle
    }, Wt = function (e, n, r) {
        var i, o, a, s = r || Rt(e), l = s ? s[n] : t, u = e.style;
        return null == l && u && u[n] && (l = u[n]), Yt.test(l) && !zt.test(n) && (i = u.left, o = e.runtimeStyle, a = o && o.left, a && (o.left = e.currentStyle.left), u.left = "fontSize" === n ? "1em" : l, l = u.pixelLeft + "px", u.left = i, a && (o.left = a)), "" === l ? "auto" : l
    });
    function on(e, t, n) {
        var r = Vt.exec(t);
        return r ? Math.max(0, r[1] - (n || 0)) + (r[2] || "px") : t
    }

    function an(e, t, n, r, i) {
        var o = n === (r ? "border" : "content") ? 4 : "width" === t ? 1 : 0, a = 0;
        for (; 4 > o; o += 2)"margin" === n && (a += x.css(e, n + Zt[o], !0, i)), r ? ("content" === n && (a -= x.css(e, "padding" + Zt[o], !0, i)), "margin" !== n && (a -= x.css(e, "border" + Zt[o] + "Width", !0, i))) : (a += x.css(e, "padding" + Zt[o], !0, i), "padding" !== n && (a += x.css(e, "border" + Zt[o] + "Width", !0, i)));
        return a
    }

    function sn(e, t, n) {
        var r = !0, i = "width" === t ? e.offsetWidth : e.offsetHeight, o = Rt(e), a = x.support.boxSizing && "border-box" === x.css(e, "boxSizing", !1, o);
        if (0 >= i || null == i) {
            if (i = Wt(e, t, o), (0 > i || null == i) && (i = e.style[t]), Yt.test(i))return i;
            r = a && (x.support.boxSizingReliable || i === e.style[t]), i = parseFloat(i) || 0
        }
        return i + an(e, t, n || (a ? "border" : "content"), r, o) + "px"
    }

    function ln(e) {
        var t = a, n = Gt[e];
        return n || (n = un(e, t), "none" !== n && n || (Pt = (Pt || x("<iframe frameborder='0' width='0' height='0'/>").css("cssText", "display:block !important")).appendTo(t.documentElement), t = (Pt[0].contentWindow || Pt[0].contentDocument).document, t.write("<!doctype html><html><body>"), t.close(), n = un(e, t), Pt.detach()), Gt[e] = n), n
    }

    function un(e, t) {
        var n = x(t.createElement(e)).appendTo(t.body), r = x.css(n[0], "display");
        return n.remove(), r
    }

    x.each(["height", "width"], function (e, n) {
        x.cssHooks[n] = {get: function (e, r, i) {
            return r ? 0 === e.offsetWidth && Xt.test(x.css(e, "display")) ? x.swap(e, Qt, function () {
                return sn(e, n, i)
            }) : sn(e, n, i) : t
        }, set: function (e, t, r) {
            var i = r && Rt(e);
            return on(e, t, r ? an(e, n, r, x.support.boxSizing && "border-box" === x.css(e, "boxSizing", !1, i), i) : 0)
        }}
    }), x.support.opacity || (x.cssHooks.opacity = {get: function (e, t) {
        return It.test((t && e.currentStyle ? e.currentStyle.filter : e.style.filter) || "") ? .01 * parseFloat(RegExp.$1) + "" : t ? "1" : ""
    }, set: function (e, t) {
        var n = e.style, r = e.currentStyle, i = x.isNumeric(t) ? "alpha(opacity=" + 100 * t + ")" : "", o = r && r.filter || n.filter || "";
        n.zoom = 1, (t >= 1 || "" === t) && "" === x.trim(o.replace($t, "")) && n.removeAttribute && (n.removeAttribute("filter"), "" === t || r && !r.filter) || (n.filter = $t.test(o) ? o.replace($t, i) : o + " " + i)
    }}), x(function () {
        x.support.reliableMarginRight || (x.cssHooks.marginRight = {get: function (e, n) {
            return n ? x.swap(e, {display: "inline-block"}, Wt, [e, "marginRight"]) : t
        }}), !x.support.pixelPosition && x.fn.position && x.each(["top", "left"], function (e, n) {
            x.cssHooks[n] = {get: function (e, r) {
                return r ? (r = Wt(e, n), Yt.test(r) ? x(e).position()[n] + "px" : r) : t
            }}
        })
    }), x.expr && x.expr.filters && (x.expr.filters.hidden = function (e) {
        return 0 >= e.offsetWidth && 0 >= e.offsetHeight || !x.support.reliableHiddenOffsets && "none" === (e.style && e.style.display || x.css(e, "display"))
    }, x.expr.filters.visible = function (e) {
        return!x.expr.filters.hidden(e)
    }), x.each({margin: "", padding: "", border: "Width"}, function (e, t) {
        x.cssHooks[e + t] = {expand: function (n) {
            var r = 0, i = {}, o = "string" == typeof n ? n.split(" ") : [n];
            for (; 4 > r; r++)i[e + Zt[r] + t] = o[r] || o[r - 2] || o[0];
            return i
        }}, Ut.test(e) || (x.cssHooks[e + t].set = on)
    });
    var cn = /%20/g, pn = /\[\]$/, fn = /\r?\n/g, dn = /^(?:submit|button|image|reset|file)$/i, hn = /^(?:input|select|textarea|keygen)/i;
    x.fn.extend({serialize: function () {
        return x.param(this.serializeArray())
    }, serializeArray: function () {
        return this.map(function () {
            var e = x.prop(this, "elements");
            return e ? x.makeArray(e) : this
        }).filter(function () {
            var e = this.type;
            return this.name && !x(this).is(":disabled") && hn.test(this.nodeName) && !dn.test(e) && (this.checked || !Ct.test(e))
        }).map(function (e, t) {
            var n = x(this).val();
            return null == n ? null : x.isArray(n) ? x.map(n, function (e) {
                return{name: t.name, value: e.replace(fn, "\r\n")}
            }) : {name: t.name, value: n.replace(fn, "\r\n")}
        }).get()
    }}), x.param = function (e, n) {
        var r, i = [], o = function (e, t) {
            t = x.isFunction(t) ? t() : null == t ? "" : t, i[i.length] = encodeURIComponent(e) + "=" + encodeURIComponent(t)
        };
        if (n === t && (n = x.ajaxSettings && x.ajaxSettings.traditional), x.isArray(e) || e.jquery && !x.isPlainObject(e))x.each(e, function () {
            o(this.name, this.value)
        }); else for (r in e)gn(r, e[r], n, o);
        return i.join("&").replace(cn, "+")
    };
    function gn(e, t, n, r) {
        var i;
        if (x.isArray(t))x.each(t, function (t, i) {
            n || pn.test(e) ? r(e, i) : gn(e + "[" + ("object" == typeof i ? t : "") + "]", i, n, r)
        }); else if (n || "object" !== x.type(t))r(e, t); else for (i in t)gn(e + "[" + i + "]", t[i], n, r)
    }

    x.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "), function (e, t) {
        x.fn[t] = function (e, n) {
            return arguments.length > 0 ? this.on(t, null, e, n) : this.trigger(t)
        }
    }), x.fn.extend({hover: function (e, t) {
        return this.mouseenter(e).mouseleave(t || e)
    }, bind: function (e, t, n) {
        return this.on(e, null, t, n)
    }, unbind: function (e, t) {
        return this.off(e, null, t)
    }, delegate: function (e, t, n, r) {
        return this.on(t, e, n, r)
    }, undelegate: function (e, t, n) {
        return 1 === arguments.length ? this.off(e, "**") : this.off(t, e || "**", n)
    }});
    var mn, yn, vn = x.now(), bn = /\?/, xn = /#.*$/, wn = /([?&])_=[^&]*/, Tn = /^(.*?):[ \t]*([^\r\n]*)\r?$/gm, Cn = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/, Nn = /^(?:GET|HEAD)$/, kn = /^\/\//, En = /^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/, Sn = x.fn.load, An = {}, jn = {}, Dn = "*/".concat("*");
    try {
        yn = o.href
    } catch (Ln) {
        yn = a.createElement("a"), yn.href = "", yn = yn.href
    }
    mn = En.exec(yn.toLowerCase()) || [];
    function Hn(e) {
        return function (t, n) {
            "string" != typeof t && (n = t, t = "*");
            var r, i = 0, o = t.toLowerCase().match(T) || [];
            if (x.isFunction(n))while (r = o[i++])"+" === r[0] ? (r = r.slice(1) || "*", (e[r] = e[r] || []).unshift(n)) : (e[r] = e[r] || []).push(n)
        }
    }

    function qn(e, n, r, i) {
        var o = {}, a = e === jn;

        function s(l) {
            var u;
            return o[l] = !0, x.each(e[l] || [], function (e, l) {
                var c = l(n, r, i);
                return"string" != typeof c || a || o[c] ? a ? !(u = c) : t : (n.dataTypes.unshift(c), s(c), !1)
            }), u
        }

        return s(n.dataTypes[0]) || !o["*"] && s("*")
    }

    function _n(e, n) {
        var r, i, o = x.ajaxSettings.flatOptions || {};
        for (i in n)n[i] !== t && ((o[i] ? e : r || (r = {}))[i] = n[i]);
        return r && x.extend(!0, e, r), e
    }

    x.fn.load = function (e, n, r) {
        if ("string" != typeof e && Sn)return Sn.apply(this, arguments);
        var i, o, a, s = this, l = e.indexOf(" ");
        return l >= 0 && (i = e.slice(l, e.length), e = e.slice(0, l)), x.isFunction(n) ? (r = n, n = t) : n && "object" == typeof n && (a = "POST"), s.length > 0 && x.ajax({url: e, type: a, dataType: "html", data: n}).done(function (e) {
            o = arguments, s.html(i ? x("<div>").append(x.parseHTML(e)).find(i) : e)
        }).complete(r && function (e, t) {
            s.each(r, o || [e.responseText, t, e])
        }), this
    }, x.each(["ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend"], function (e, t) {
        x.fn[t] = function (e) {
            return this.on(t, e)
        }
    }), x.extend({active: 0, lastModified: {}, etag: {}, ajaxSettings: {url: yn, type: "GET", isLocal: Cn.test(mn[1]), global: !0, processData: !0, async: !0, contentType: "application/x-www-form-urlencoded; charset=UTF-8", accepts: {"*": Dn, text: "text/plain", html: "text/html", xml: "application/xml, text/xml", json: "application/json, text/javascript"}, contents: {xml: /xml/, html: /html/, json: /json/}, responseFields: {xml: "responseXML", text: "responseText", json: "responseJSON"}, converters: {"* text": String, "text html": !0, "text json": x.parseJSON, "text xml": x.parseXML}, flatOptions: {url: !0, context: !0}}, ajaxSetup: function (e, t) {
        return t ? _n(_n(e, x.ajaxSettings), t) : _n(x.ajaxSettings, e)
    }, ajaxPrefilter: Hn(An), ajaxTransport: Hn(jn), ajax: function (e, n) {
        "object" == typeof e && (n = e, e = t), n = n || {};
        var r, i, o, a, s, l, u, c, p = x.ajaxSetup({}, n), f = p.context || p, d = p.context && (f.nodeType || f.jquery) ? x(f) : x.event, h = x.Deferred(), g = x.Callbacks("once memory"), m = p.statusCode || {}, y = {}, v = {}, b = 0, w = "canceled", C = {readyState: 0, getResponseHeader: function (e) {
            var t;
            if (2 === b) {
                if (!c) {
                    c = {};
                    while (t = Tn.exec(a))c[t[1].toLowerCase()] = t[2]
                }
                t = c[e.toLowerCase()]
            }
            return null == t ? null : t
        }, getAllResponseHeaders: function () {
            return 2 === b ? a : null
        }, setRequestHeader: function (e, t) {
            var n = e.toLowerCase();
            return b || (e = v[n] = v[n] || e, y[e] = t), this
        }, overrideMimeType: function (e) {
            return b || (p.mimeType = e), this
        }, statusCode: function (e) {
            var t;
            if (e)if (2 > b)for (t in e)m[t] = [m[t], e[t]]; else C.always(e[C.status]);
            return this
        }, abort: function (e) {
            var t = e || w;
            return u && u.abort(t), k(0, t), this
        }};
        if (h.promise(C).complete = g.add, C.success = C.done, C.error = C.fail, p.url = ((e || p.url || yn) + "").replace(xn, "").replace(kn, mn[1] + "//"), p.type = n.method || n.type || p.method || p.type, p.dataTypes = x.trim(p.dataType || "*").toLowerCase().match(T) || [""], null == p.crossDomain && (r = En.exec(p.url.toLowerCase()), p.crossDomain = !(!r || r[1] === mn[1] && r[2] === mn[2] && (r[3] || ("http:" === r[1] ? "80" : "443")) === (mn[3] || ("http:" === mn[1] ? "80" : "443")))), p.data && p.processData && "string" != typeof p.data && (p.data = x.param(p.data, p.traditional)), qn(An, p, n, C), 2 === b)return C;
        l = p.global, l && 0 === x.active++ && x.event.trigger("ajaxStart"), p.type = p.type.toUpperCase(), p.hasContent = !Nn.test(p.type), o = p.url, p.hasContent || (p.data && (o = p.url += (bn.test(o) ? "&" : "?") + p.data, delete p.data), p.cache === !1 && (p.url = wn.test(o) ? o.replace(wn, "$1_=" + vn++) : o + (bn.test(o) ? "&" : "?") + "_=" + vn++)), p.ifModified && (x.lastModified[o] && C.setRequestHeader("If-Modified-Since", x.lastModified[o]), x.etag[o] && C.setRequestHeader("If-None-Match", x.etag[o])), (p.data && p.hasContent && p.contentType !== !1 || n.contentType) && C.setRequestHeader("Content-Type", p.contentType), C.setRequestHeader("Accept", p.dataTypes[0] && p.accepts[p.dataTypes[0]] ? p.accepts[p.dataTypes[0]] + ("*" !== p.dataTypes[0] ? ", " + Dn + "; q=0.01" : "") : p.accepts["*"]);
        for (i in p.headers)C.setRequestHeader(i, p.headers[i]);
        if (p.beforeSend && (p.beforeSend.call(f, C, p) === !1 || 2 === b))return C.abort();
        w = "abort";
        for (i in{success: 1, error: 1, complete: 1})C[i](p[i]);
        if (u = qn(jn, p, n, C)) {
            C.readyState = 1, l && d.trigger("ajaxSend", [C, p]), p.async && p.timeout > 0 && (s = setTimeout(function () {
                C.abort("timeout")
            }, p.timeout));
            try {
                b = 1, u.send(y, k)
            } catch (N) {
                if (!(2 > b))throw N;
                k(-1, N)
            }
        } else k(-1, "No Transport");
        function k(e, n, r, i) {
            var c, y, v, w, T, N = n;
            2 !== b && (b = 2, s && clearTimeout(s), u = t, a = i || "", C.readyState = e > 0 ? 4 : 0, c = e >= 200 && 300 > e || 304 === e, r && (w = Mn(p, C, r)), w = On(p, w, C, c), c ? (p.ifModified && (T = C.getResponseHeader("Last-Modified"), T && (x.lastModified[o] = T), T = C.getResponseHeader("etag"), T && (x.etag[o] = T)), 204 === e || "HEAD" === p.type ? N = "nocontent" : 304 === e ? N = "notmodified" : (N = w.state, y = w.data, v = w.error, c = !v)) : (v = N, (e || !N) && (N = "error", 0 > e && (e = 0))), C.status = e, C.statusText = (n || N) + "", c ? h.resolveWith(f, [y, N, C]) : h.rejectWith(f, [C, N, v]), C.statusCode(m), m = t, l && d.trigger(c ? "ajaxSuccess" : "ajaxError", [C, p, c ? y : v]), g.fireWith(f, [C, N]), l && (d.trigger("ajaxComplete", [C, p]), --x.active || x.event.trigger("ajaxStop")))
        }

        return C
    }, getJSON: function (e, t, n) {
        return x.get(e, t, n, "json")
    }, getScript: function (e, n) {
        return x.get(e, t, n, "script")
    }}), x.each(["get", "post"], function (e, n) {
        x[n] = function (e, r, i, o) {
            return x.isFunction(r) && (o = o || i, i = r, r = t), x.ajax({url: e, type: n, dataType: o, data: r, success: i})
        }
    });
    function Mn(e, n, r) {
        var i, o, a, s, l = e.contents, u = e.dataTypes;
        while ("*" === u[0])u.shift(), o === t && (o = e.mimeType || n.getResponseHeader("Content-Type"));
        if (o)for (s in l)if (l[s] && l[s].test(o)) {
            u.unshift(s);
            break
        }
        if (u[0]in r)a = u[0]; else {
            for (s in r) {
                if (!u[0] || e.converters[s + " " + u[0]]) {
                    a = s;
                    break
                }
                i || (i = s)
            }
            a = a || i
        }
        return a ? (a !== u[0] && u.unshift(a), r[a]) : t
    }

    function On(e, t, n, r) {
        var i, o, a, s, l, u = {}, c = e.dataTypes.slice();
        if (c[1])for (a in e.converters)u[a.toLowerCase()] = e.converters[a];
        o = c.shift();
        while (o)if (e.responseFields[o] && (n[e.responseFields[o]] = t), !l && r && e.dataFilter && (t = e.dataFilter(t, e.dataType)), l = o, o = c.shift())if ("*" === o)o = l; else if ("*" !== l && l !== o) {
            if (a = u[l + " " + o] || u["* " + o], !a)for (i in u)if (s = i.split(" "), s[1] === o && (a = u[l + " " + s[0]] || u["* " + s[0]])) {
                a === !0 ? a = u[i] : u[i] !== !0 && (o = s[0], c.unshift(s[1]));
                break
            }
            if (a !== !0)if (a && e["throws"])t = a(t); else try {
                t = a(t)
            } catch (p) {
                return{state: "parsererror", error: a ? p : "No conversion from " + l + " to " + o}
            }
        }
        return{state: "success", data: t}
    }

    x.ajaxSetup({accepts: {script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"}, contents: {script: /(?:java|ecma)script/}, converters: {"text script": function (e) {
        return x.globalEval(e), e
    }}}), x.ajaxPrefilter("script", function (e) {
        e.cache === t && (e.cache = !1), e.crossDomain && (e.type = "GET", e.global = !1)
    }), x.ajaxTransport("script", function (e) {
        if (e.crossDomain) {
            var n, r = a.head || x("head")[0] || a.documentElement;
            return{send: function (t, i) {
                n = a.createElement("script"), n.async = !0, e.scriptCharset && (n.charset = e.scriptCharset), n.src = e.url, n.onload = n.onreadystatechange = function (e, t) {
                    (t || !n.readyState || /loaded|complete/.test(n.readyState)) && (n.onload = n.onreadystatechange = null, n.parentNode && n.parentNode.removeChild(n), n = null, t || i(200, "success"))
                }, r.insertBefore(n, r.firstChild)
            }, abort: function () {
                n && n.onload(t, !0)
            }}
        }
    });
    var Fn = [], Bn = /(=)\?(?=&|$)|\?\?/;
    x.ajaxSetup({jsonp: "callback", jsonpCallback: function () {
        var e = Fn.pop() || x.expando + "_" + vn++;
        return this[e] = !0, e
    }}), x.ajaxPrefilter("json jsonp", function (n, r, i) {
        var o, a, s, l = n.jsonp !== !1 && (Bn.test(n.url) ? "url" : "string" == typeof n.data && !(n.contentType || "").indexOf("application/x-www-form-urlencoded") && Bn.test(n.data) && "data");
        return l || "jsonp" === n.dataTypes[0] ? (o = n.jsonpCallback = x.isFunction(n.jsonpCallback) ? n.jsonpCallback() : n.jsonpCallback, l ? n[l] = n[l].replace(Bn, "$1" + o) : n.jsonp !== !1 && (n.url += (bn.test(n.url) ? "&" : "?") + n.jsonp + "=" + o), n.converters["script json"] = function () {
            return s || x.error(o + " was not called"), s[0]
        }, n.dataTypes[0] = "json", a = e[o], e[o] = function () {
            s = arguments
        }, i.always(function () {
            e[o] = a, n[o] && (n.jsonpCallback = r.jsonpCallback, Fn.push(o)), s && x.isFunction(a) && a(s[0]), s = a = t
        }), "script") : t
    });
    var Pn, Rn, Wn = 0, $n = e.ActiveXObject && function () {
        var e;
        for (e in Pn)Pn[e](t, !0)
    };

    function In() {
        try {
            return new e.XMLHttpRequest
        } catch (t) {
        }
    }

    function zn() {
        try {
            return new e.ActiveXObject("Microsoft.XMLHTTP")
        } catch (t) {
        }
    }

    x.ajaxSettings.xhr = e.ActiveXObject ? function () {
        return!this.isLocal && In() || zn()
    } : In, Rn = x.ajaxSettings.xhr(), x.support.cors = !!Rn && "withCredentials"in Rn, Rn = x.support.ajax = !!Rn, Rn && x.ajaxTransport(function (n) {
        if (!n.crossDomain || x.support.cors) {
            var r;
            return{send: function (i, o) {
                var a, s, l = n.xhr();
                if (n.username ? l.open(n.type, n.url, n.async, n.username, n.password) : l.open(n.type, n.url, n.async), n.xhrFields)for (s in n.xhrFields)l[s] = n.xhrFields[s];
                n.mimeType && l.overrideMimeType && l.overrideMimeType(n.mimeType), n.crossDomain || i["X-Requested-With"] || (i["X-Requested-With"] = "XMLHttpRequest");
                try {
                    for (s in i)l.setRequestHeader(s, i[s])
                } catch (u) {
                }
                l.send(n.hasContent && n.data || null), r = function (e, i) {
                    var s, u, c, p;
                    try {
                        if (r && (i || 4 === l.readyState))if (r = t, a && (l.onreadystatechange = x.noop, $n && delete Pn[a]), i)4 !== l.readyState && l.abort(); else {
                            p = {}, s = l.status, u = l.getAllResponseHeaders(), "string" == typeof l.responseText && (p.text = l.responseText);
                            try {
                                c = l.statusText
                            } catch (f) {
                                c = ""
                            }
                            s || !n.isLocal || n.crossDomain ? 1223 === s && (s = 204) : s = p.text ? 200 : 404
                        }
                    } catch (d) {
                        i || o(-1, d)
                    }
                    p && o(s, c, p, u)
                }, n.async ? 4 === l.readyState ? setTimeout(r) : (a = ++Wn, $n && (Pn || (Pn = {}, x(e).unload($n)), Pn[a] = r), l.onreadystatechange = r) : r()
            }, abort: function () {
                r && r(t, !0)
            }}
        }
    });
    var Xn, Un, Vn = /^(?:toggle|show|hide)$/, Yn = RegExp("^(?:([+-])=|)(" + w + ")([a-z%]*)$", "i"), Jn = /queueHooks$/, Gn = [nr], Qn = {"*": [function (e, t) {
        var n = this.createTween(e, t), r = n.cur(), i = Yn.exec(t), o = i && i[3] || (x.cssNumber[e] ? "" : "px"), a = (x.cssNumber[e] || "px" !== o && +r) && Yn.exec(x.css(n.elem, e)), s = 1, l = 20;
        if (a && a[3] !== o) {
            o = o || a[3], i = i || [], a = +r || 1;
            do s = s || ".5", a /= s, x.style(n.elem, e, a + o); while (s !== (s = n.cur() / r) && 1 !== s && --l)
        }
        return i && (a = n.start = +a || +r || 0, n.unit = o, n.end = i[1] ? a + (i[1] + 1) * i[2] : +i[2]), n
    }]};

    function Kn() {
        return setTimeout(function () {
            Xn = t
        }), Xn = x.now()
    }

    function Zn(e, t, n) {
        var r, i = (Qn[t] || []).concat(Qn["*"]), o = 0, a = i.length;
        for (; a > o; o++)if (r = i[o].call(n, t, e))return r
    }

    function er(e, t, n) {
        var r, i, o = 0, a = Gn.length, s = x.Deferred().always(function () {
            delete l.elem
        }), l = function () {
            if (i)return!1;
            var t = Xn || Kn(), n = Math.max(0, u.startTime + u.duration - t), r = n / u.duration || 0, o = 1 - r, a = 0, l = u.tweens.length;
            for (; l > a; a++)u.tweens[a].run(o);
            return s.notifyWith(e, [u, o, n]), 1 > o && l ? n : (s.resolveWith(e, [u]), !1)
        }, u = s.promise({elem: e, props: x.extend({}, t), opts: x.extend(!0, {specialEasing: {}}, n), originalProperties: t, originalOptions: n, startTime: Xn || Kn(), duration: n.duration, tweens: [], createTween: function (t, n) {
            var r = x.Tween(e, u.opts, t, n, u.opts.specialEasing[t] || u.opts.easing);
            return u.tweens.push(r), r
        }, stop: function (t) {
            var n = 0, r = t ? u.tweens.length : 0;
            if (i)return this;
            for (i = !0; r > n; n++)u.tweens[n].run(1);
            return t ? s.resolveWith(e, [u, t]) : s.rejectWith(e, [u, t]), this
        }}), c = u.props;
        for (tr(c, u.opts.specialEasing); a > o; o++)if (r = Gn[o].call(u, e, c, u.opts))return r;
        return x.map(c, Zn, u), x.isFunction(u.opts.start) && u.opts.start.call(e, u), x.fx.timer(x.extend(l, {elem: e, anim: u, queue: u.opts.queue})), u.progress(u.opts.progress).done(u.opts.done, u.opts.complete).fail(u.opts.fail).always(u.opts.always)
    }

    function tr(e, t) {
        var n, r, i, o, a;
        for (n in e)if (r = x.camelCase(n), i = t[r], o = e[n], x.isArray(o) && (i = o[1], o = e[n] = o[0]), n !== r && (e[r] = o, delete e[n]), a = x.cssHooks[r], a && "expand"in a) {
            o = a.expand(o), delete e[r];
            for (n in o)n in e || (e[n] = o[n], t[n] = i)
        } else t[r] = i
    }

    x.Animation = x.extend(er, {tweener: function (e, t) {
        x.isFunction(e) ? (t = e, e = ["*"]) : e = e.split(" ");
        var n, r = 0, i = e.length;
        for (; i > r; r++)n = e[r], Qn[n] = Qn[n] || [], Qn[n].unshift(t)
    }, prefilter: function (e, t) {
        t ? Gn.unshift(e) : Gn.push(e)
    }});
    function nr(e, t, n) {
        var r, i, o, a, s, l, u = this, c = {}, p = e.style, f = e.nodeType && nn(e), d = x._data(e, "fxshow");
        n.queue || (s = x._queueHooks(e, "fx"), null == s.unqueued && (s.unqueued = 0, l = s.empty.fire, s.empty.fire = function () {
            s.unqueued || l()
        }), s.unqueued++, u.always(function () {
            u.always(function () {
                s.unqueued--, x.queue(e, "fx").length || s.empty.fire()
            })
        })), 1 === e.nodeType && ("height"in t || "width"in t) && (n.overflow = [p.overflow, p.overflowX, p.overflowY], "inline" === x.css(e, "display") && "none" === x.css(e, "float") && (x.support.inlineBlockNeedsLayout && "inline" !== ln(e.nodeName) ? p.zoom = 1 : p.display = "inline-block")), n.overflow && (p.overflow = "hidden", x.support.shrinkWrapBlocks || u.always(function () {
            p.overflow = n.overflow[0], p.overflowX = n.overflow[1], p.overflowY = n.overflow[2]
        }));
        for (r in t)if (i = t[r], Vn.exec(i)) {
            if (delete t[r], o = o || "toggle" === i, i === (f ? "hide" : "show"))continue;
            c[r] = d && d[r] || x.style(e, r)
        }
        if (!x.isEmptyObject(c)) {
            d ? "hidden"in d && (f = d.hidden) : d = x._data(e, "fxshow", {}), o && (d.hidden = !f), f ? x(e).show() : u.done(function () {
                x(e).hide()
            }), u.done(function () {
                var t;
                x._removeData(e, "fxshow");
                for (t in c)x.style(e, t, c[t])
            });
            for (r in c)a = Zn(f ? d[r] : 0, r, u), r in d || (d[r] = a.start, f && (a.end = a.start, a.start = "width" === r || "height" === r ? 1 : 0))
        }
    }

    function rr(e, t, n, r, i) {
        return new rr.prototype.init(e, t, n, r, i)
    }

    x.Tween = rr, rr.prototype = {constructor: rr, init: function (e, t, n, r, i, o) {
        this.elem = e, this.prop = n, this.easing = i || "swing", this.options = t, this.start = this.now = this.cur(), this.end = r, this.unit = o || (x.cssNumber[n] ? "" : "px")
    }, cur: function () {
        var e = rr.propHooks[this.prop];
        return e && e.get ? e.get(this) : rr.propHooks._default.get(this)
    }, run: function (e) {
        var t, n = rr.propHooks[this.prop];
        return this.pos = t = this.options.duration ? x.easing[this.easing](e, this.options.duration * e, 0, 1, this.options.duration) : e, this.now = (this.end - this.start) * t + this.start, this.options.step && this.options.step.call(this.elem, this.now, this), n && n.set ? n.set(this) : rr.propHooks._default.set(this), this
    }}, rr.prototype.init.prototype = rr.prototype, rr.propHooks = {_default: {get: function (e) {
        var t;
        return null == e.elem[e.prop] || e.elem.style && null != e.elem.style[e.prop] ? (t = x.css(e.elem, e.prop, ""), t && "auto" !== t ? t : 0) : e.elem[e.prop]
    }, set: function (e) {
        x.fx.step[e.prop] ? x.fx.step[e.prop](e) : e.elem.style && (null != e.elem.style[x.cssProps[e.prop]] || x.cssHooks[e.prop]) ? x.style(e.elem, e.prop, e.now + e.unit) : e.elem[e.prop] = e.now
    }}}, rr.propHooks.scrollTop = rr.propHooks.scrollLeft = {set: function (e) {
        e.elem.nodeType && e.elem.parentNode && (e.elem[e.prop] = e.now)
    }}, x.each(["toggle", "show", "hide"], function (e, t) {
        var n = x.fn[t];
        x.fn[t] = function (e, r, i) {
            return null == e || "boolean" == typeof e ? n.apply(this, arguments) : this.animate(ir(t, !0), e, r, i)
        }
    }), x.fn.extend({fadeTo: function (e, t, n, r) {
        return this.filter(nn).css("opacity", 0).show().end().animate({opacity: t}, e, n, r)
    }, animate: function (e, t, n, r) {
        var i = x.isEmptyObject(e), o = x.speed(t, n, r), a = function () {
            var t = er(this, x.extend({}, e), o);
            (i || x._data(this, "finish")) && t.stop(!0)
        };
        return a.finish = a, i || o.queue === !1 ? this.each(a) : this.queue(o.queue, a)
    }, stop: function (e, n, r) {
        var i = function (e) {
            var t = e.stop;
            delete e.stop, t(r)
        };
        return"string" != typeof e && (r = n, n = e, e = t), n && e !== !1 && this.queue(e || "fx", []), this.each(function () {
            var t = !0, n = null != e && e + "queueHooks", o = x.timers, a = x._data(this);
            if (n)a[n] && a[n].stop && i(a[n]); else for (n in a)a[n] && a[n].stop && Jn.test(n) && i(a[n]);
            for (n = o.length; n--;)o[n].elem !== this || null != e && o[n].queue !== e || (o[n].anim.stop(r), t = !1, o.splice(n, 1));
            (t || !r) && x.dequeue(this, e)
        })
    }, finish: function (e) {
        return e !== !1 && (e = e || "fx"), this.each(function () {
            var t, n = x._data(this), r = n[e + "queue"], i = n[e + "queueHooks"], o = x.timers, a = r ? r.length : 0;
            for (n.finish = !0, x.queue(this, e, []), i && i.stop && i.stop.call(this, !0), t = o.length; t--;)o[t].elem === this && o[t].queue === e && (o[t].anim.stop(!0), o.splice(t, 1));
            for (t = 0; a > t; t++)r[t] && r[t].finish && r[t].finish.call(this);
            delete n.finish
        })
    }});
    function ir(e, t) {
        var n, r = {height: e}, i = 0;
        for (t = t ? 1 : 0; 4 > i; i += 2 - t)n = Zt[i], r["margin" + n] = r["padding" + n] = e;
        return t && (r.opacity = r.width = e), r
    }

    x.each({slideDown: ir("show"), slideUp: ir("hide"), slideToggle: ir("toggle"), fadeIn: {opacity: "show"}, fadeOut: {opacity: "hide"}, fadeToggle: {opacity: "toggle"}}, function (e, t) {
        x.fn[e] = function (e, n, r) {
            return this.animate(t, e, n, r)
        }
    }), x.speed = function (e, t, n) {
        var r = e && "object" == typeof e ? x.extend({}, e) : {complete: n || !n && t || x.isFunction(e) && e, duration: e, easing: n && t || t && !x.isFunction(t) && t};
        return r.duration = x.fx.off ? 0 : "number" == typeof r.duration ? r.duration : r.duration in x.fx.speeds ? x.fx.speeds[r.duration] : x.fx.speeds._default, (null == r.queue || r.queue === !0) && (r.queue = "fx"), r.old = r.complete, r.complete = function () {
            x.isFunction(r.old) && r.old.call(this), r.queue && x.dequeue(this, r.queue)
        }, r
    }, x.easing = {linear: function (e) {
        return e
    }, swing: function (e) {
        return.5 - Math.cos(e * Math.PI) / 2
    }}, x.timers = [], x.fx = rr.prototype.init, x.fx.tick = function () {
        var e, n = x.timers, r = 0;
        for (Xn = x.now(); n.length > r; r++)e = n[r], e() || n[r] !== e || n.splice(r--, 1);
        n.length || x.fx.stop(), Xn = t
    }, x.fx.timer = function (e) {
        e() && x.timers.push(e) && x.fx.start()
    }, x.fx.interval = 13, x.fx.start = function () {
        Un || (Un = setInterval(x.fx.tick, x.fx.interval))
    }, x.fx.stop = function () {
        clearInterval(Un), Un = null
    }, x.fx.speeds = {slow: 600, fast: 200, _default: 400}, x.fx.step = {}, x.expr && x.expr.filters && (x.expr.filters.animated = function (e) {
        return x.grep(x.timers,function (t) {
            return e === t.elem
        }).length
    }), x.fn.offset = function (e) {
        if (arguments.length)return e === t ? this : this.each(function (t) {
            x.offset.setOffset(this, e, t)
        });
        var n, r, o = {top: 0, left: 0}, a = this[0], s = a && a.ownerDocument;
        if (s)return n = s.documentElement, x.contains(n, a) ? (typeof a.getBoundingClientRect !== i && (o = a.getBoundingClientRect()), r = or(s), {top: o.top + (r.pageYOffset || n.scrollTop) - (n.clientTop || 0), left: o.left + (r.pageXOffset || n.scrollLeft) - (n.clientLeft || 0)}) : o
    }, x.offset = {setOffset: function (e, t, n) {
        var r = x.css(e, "position");
        "static" === r && (e.style.position = "relative");
        var i = x(e), o = i.offset(), a = x.css(e, "top"), s = x.css(e, "left"), l = ("absolute" === r || "fixed" === r) && x.inArray("auto", [a, s]) > -1, u = {}, c = {}, p, f;
        l ? (c = i.position(), p = c.top, f = c.left) : (p = parseFloat(a) || 0, f = parseFloat(s) || 0), x.isFunction(t) && (t = t.call(e, n, o)), null != t.top && (u.top = t.top - o.top + p), null != t.left && (u.left = t.left - o.left + f), "using"in t ? t.using.call(e, u) : i.css(u)
    }}, x.fn.extend({position: function () {
        if (this[0]) {
            var e, t, n = {top: 0, left: 0}, r = this[0];
            return"fixed" === x.css(r, "position") ? t = r.getBoundingClientRect() : (e = this.offsetParent(), t = this.offset(), x.nodeName(e[0], "html") || (n = e.offset()), n.top += x.css(e[0], "borderTopWidth", !0), n.left += x.css(e[0], "borderLeftWidth", !0)), {top: t.top - n.top - x.css(r, "marginTop", !0), left: t.left - n.left - x.css(r, "marginLeft", !0)}
        }
    }, offsetParent: function () {
        return this.map(function () {
            var e = this.offsetParent || s;
            while (e && !x.nodeName(e, "html") && "static" === x.css(e, "position"))e = e.offsetParent;
            return e || s
        })
    }}), x.each({scrollLeft: "pageXOffset", scrollTop: "pageYOffset"}, function (e, n) {
        var r = /Y/.test(n);
        x.fn[e] = function (i) {
            return x.access(this, function (e, i, o) {
                var a = or(e);
                return o === t ? a ? n in a ? a[n] : a.document.documentElement[i] : e[i] : (a ? a.scrollTo(r ? x(a).scrollLeft() : o, r ? o : x(a).scrollTop()) : e[i] = o, t)
            }, e, i, arguments.length, null)
        }
    });
    function or(e) {
        return x.isWindow(e) ? e : 9 === e.nodeType ? e.defaultView || e.parentWindow : !1
    }

    x.each({Height: "height", Width: "width"}, function (e, n) {
        x.each({padding: "inner" + e, content: n, "": "outer" + e}, function (r, i) {
            x.fn[i] = function (i, o) {
                var a = arguments.length && (r || "boolean" != typeof i), s = r || (i === !0 || o === !0 ? "margin" : "border");
                return x.access(this, function (n, r, i) {
                    var o;
                    return x.isWindow(n) ? n.document.documentElement["client" + e] : 9 === n.nodeType ? (o = n.documentElement, Math.max(n.body["scroll" + e], o["scroll" + e], n.body["offset" + e], o["offset" + e], o["client" + e])) : i === t ? x.css(n, r, s) : x.style(n, r, i, s)
                }, n, a ? i : t, a, null)
            }
        })
    }), x.fn.size = function () {
        return this.length
    }, x.fn.andSelf = x.fn.addBack, "object" == typeof module && module && "object" == typeof module.exports ? module.exports = x : (e.jQuery = e.$ = x, "function" == typeof define && define.amd && define("jquery", [], function () {
        return x
    }))
})(window);

/* qTip2 v2.2.0 None | qtip2.com | Licensed MIT, GPL | Sat Mar 15 2014 10:36:19 */

!function(a,b,c){!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):jQuery&&!jQuery.fn.qtip&&a(jQuery)}(function(d){"use strict";function e(a,b,c,e){this.id=c,this.target=a,this.tooltip=A,this.elements={target:a},this._id=J+"-"+c,this.timers={img:{}},this.options=b,this.plugins={},this.cache={event:{},target:d(),disabled:z,attr:e,onTooltip:z,lastClass:""},this.rendered=this.destroyed=this.disabled=this.waiting=this.hiddenDuringWait=this.positioning=this.triggering=z}function f(a){return a===A||"object"!==d.type(a)}function g(a){return!(d.isFunction(a)||a&&a.attr||a.length||"object"===d.type(a)&&(a.jquery||a.then))}function h(a){var b,c,e,h;return f(a)?z:(f(a.metadata)&&(a.metadata={type:a.metadata}),"content"in a&&(b=a.content,f(b)||b.jquery||b.done?b=a.content={text:c=g(b)?z:b}:c=b.text,"ajax"in b&&(e=b.ajax,h=e&&e.once!==z,delete b.ajax,b.text=function(a,b){var f=c||d(this).attr(b.options.content.attr)||"Loading...",g=d.ajax(d.extend({},e,{context:b})).then(e.success,A,e.error).then(function(a){return a&&h&&b.set("content.text",a),a},function(a,c,d){b.destroyed||0===a.status||b.set("content.text",c+": "+d)});return h?f:(b.set("content.text",f),g)}),"title"in b&&(f(b.title)||(b.button=b.title.button,b.title=b.title.text),g(b.title||z)&&(b.title=z))),"position"in a&&f(a.position)&&(a.position={my:a.position,at:a.position}),"show"in a&&f(a.show)&&(a.show=a.show.jquery?{target:a.show}:a.show===y?{ready:y}:{event:a.show}),"hide"in a&&f(a.hide)&&(a.hide=a.hide.jquery?{target:a.hide}:{event:a.hide}),"style"in a&&f(a.style)&&(a.style={classes:a.style}),d.each(I,function(){this.sanitize&&this.sanitize(a)}),a)}function i(a,b){for(var c,d=0,e=a,f=b.split(".");e=e[f[d++]];)d<f.length&&(c=e);return[c||a,f.pop()]}function j(a,b){var c,d,e;for(c in this.checks)for(d in this.checks[c])(e=new RegExp(d,"i").exec(a))&&(b.push(e),("builtin"===c||this.plugins[c])&&this.checks[c][d].apply(this.plugins[c]||this,b))}function k(a){return M.concat("").join(a?"-"+a+" ":" ")}function l(c){return c&&{type:c.type,pageX:c.pageX,pageY:c.pageY,target:c.target,relatedTarget:c.relatedTarget,scrollX:c.scrollX||a.pageXOffset||b.body.scrollLeft||b.documentElement.scrollLeft,scrollY:c.scrollY||a.pageYOffset||b.body.scrollTop||b.documentElement.scrollTop}||{}}function m(a,b){return b>0?setTimeout(d.proxy(a,this),b):(a.call(this),void 0)}function n(a){return this.tooltip.hasClass(T)?z:(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this.timers.show=m.call(this,function(){this.toggle(y,a)},this.options.show.delay),void 0)}function o(a){if(this.tooltip.hasClass(T))return z;var b=d(a.relatedTarget),c=b.closest(N)[0]===this.tooltip[0],e=b[0]===this.options.show.target[0];if(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this!==b[0]&&"mouse"===this.options.position.target&&c||this.options.hide.fixed&&/mouse(out|leave|move)/.test(a.type)&&(c||e))try{a.preventDefault(),a.stopImmediatePropagation()}catch(f){}else this.timers.hide=m.call(this,function(){this.toggle(z,a)},this.options.hide.delay,this)}function p(a){return this.tooltip.hasClass(T)||!this.options.hide.inactive?z:(clearTimeout(this.timers.inactive),this.timers.inactive=m.call(this,function(){this.hide(a)},this.options.hide.inactive),void 0)}function q(a){this.rendered&&this.tooltip[0].offsetWidth>0&&this.reposition(a)}function r(a,c,e){d(b.body).delegate(a,(c.split?c:c.join($+" "))+$,function(){var a=t.api[d.attr(this,L)];a&&!a.disabled&&e.apply(a,arguments)})}function s(a,c,f){var g,i,j,k,l,m=d(b.body),n=a[0]===b?m:a,o=a.metadata?a.metadata(f.metadata):A,p="html5"===f.metadata.type&&o?o[f.metadata.name]:A,q=a.data(f.metadata.name||"qtipopts");try{q="string"==typeof q?d.parseJSON(q):q}catch(r){}if(k=d.extend(y,{},t.defaults,f,"object"==typeof q?h(q):A,h(p||o)),i=k.position,k.id=c,"boolean"==typeof k.content.text){if(j=a.attr(k.content.attr),k.content.attr===z||!j)return z;k.content.text=j}if(i.container.length||(i.container=m),i.target===z&&(i.target=n),k.show.target===z&&(k.show.target=n),k.show.solo===y&&(k.show.solo=i.container.closest("body")),k.hide.target===z&&(k.hide.target=n),k.position.viewport===y&&(k.position.viewport=i.container),i.container=i.container.eq(0),i.at=new v(i.at,y),i.my=new v(i.my),a.data(J))if(k.overwrite)a.qtip("destroy",!0);else if(k.overwrite===z)return z;return a.attr(K,c),k.suppress&&(l=a.attr("title"))&&a.removeAttr("title").attr(V,l).attr("title",""),g=new e(a,k,c,!!j),a.data(J,g),a.one("remove.qtip-"+c+" removeqtip.qtip-"+c,function(){var a;(a=d(this).data(J))&&a.destroy(!0)}),g}var t,u,v,w,x,y=!0,z=!1,A=null,B="x",C="y",D="top",E="left",F="bottom",G="right",H="center",I={},J="qtip",K="data-hasqtip",L="data-qtip-id",M=["ui-widget","ui-tooltip"],N="."+J,O="click dblclick mousedown mouseup mousemove mouseleave mouseenter".split(" "),P=J+"-fixed",Q=J+"-default",R=J+"-focus",S=J+"-hover",T=J+"-disabled",U="_replacedByqTip",V="oldtitle",W={ie:function(){for(var a=3,c=b.createElement("div");(c.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->")&&c.getElementsByTagName("i")[0];);return a>4?a:0/0}(),iOS:parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||z};u=e.prototype,u._when=function(a){return d.when.apply(d,a)},u.render=function(a){if(this.rendered||this.destroyed)return this;var b,c=this,e=this.options,f=this.cache,g=this.elements,h=e.content.text,i=e.content.title,j=e.content.button,k=e.position,l=("."+this._id+" ",[]);return d.attr(this.target[0],"aria-describedby",this._id),this.tooltip=g.tooltip=b=d("<div/>",{id:this._id,"class":[J,Q,e.style.classes,J+"-pos-"+e.position.my.abbrev()].join(" "),width:e.style.width||"",height:e.style.height||"",tracking:"mouse"===k.target&&k.adjust.mouse,role:"alert","aria-live":"polite","aria-atomic":z,"aria-describedby":this._id+"-content","aria-hidden":y}).toggleClass(T,this.disabled).attr(L,this.id).data(J,this).appendTo(k.container).append(g.content=d("<div />",{"class":J+"-content",id:this._id+"-content","aria-atomic":y})),this.rendered=-1,this.positioning=y,i&&(this._createTitle(),d.isFunction(i)||l.push(this._updateTitle(i,z))),j&&this._createButton(),d.isFunction(h)||l.push(this._updateContent(h,z)),this.rendered=y,this._setWidget(),d.each(I,function(a){var b;"render"===this.initialize&&(b=this(c))&&(c.plugins[a]=b)}),this._unassignEvents(),this._assignEvents(),this._when(l).then(function(){c._trigger("render"),c.positioning=z,c.hiddenDuringWait||!e.show.ready&&!a||c.toggle(y,f.event,z),c.hiddenDuringWait=z}),t.api[this.id]=this,this},u.destroy=function(a){function b(){if(!this.destroyed){this.destroyed=y;var a=this.target,b=a.attr(V);this.rendered&&this.tooltip.stop(1,0).find("*").remove().end().remove(),d.each(this.plugins,function(){this.destroy&&this.destroy()}),clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this._unassignEvents(),a.removeData(J).removeAttr(L).removeAttr(K).removeAttr("aria-describedby"),this.options.suppress&&b&&a.attr("title",b).removeAttr(V),this._unbind(a),this.options=this.elements=this.cache=this.timers=this.plugins=this.mouse=A,delete t.api[this.id]}}return this.destroyed?this.target:(a===y&&"hide"!==this.triggering||!this.rendered?b.call(this):(this.tooltip.one("tooltiphidden",d.proxy(b,this)),!this.triggering&&this.hide()),this.target)},w=u.checks={builtin:{"^id$":function(a,b,c,e){var f=c===y?t.nextid:c,g=J+"-"+f;f!==z&&f.length>0&&!d("#"+g).length?(this._id=g,this.rendered&&(this.tooltip[0].id=this._id,this.elements.content[0].id=this._id+"-content",this.elements.title[0].id=this._id+"-title")):a[b]=e},"^prerender":function(a,b,c){c&&!this.rendered&&this.render(this.options.show.ready)},"^content.text$":function(a,b,c){this._updateContent(c)},"^content.attr$":function(a,b,c,d){this.options.content.text===this.target.attr(d)&&this._updateContent(this.target.attr(c))},"^content.title$":function(a,b,c){return c?(c&&!this.elements.title&&this._createTitle(),this._updateTitle(c),void 0):this._removeTitle()},"^content.button$":function(a,b,c){this._updateButton(c)},"^content.title.(text|button)$":function(a,b,c){this.set("content."+b,c)},"^position.(my|at)$":function(a,b,c){"string"==typeof c&&(a[b]=new v(c,"at"===b))},"^position.container$":function(a,b,c){this.rendered&&this.tooltip.appendTo(c)},"^show.ready$":function(a,b,c){c&&(!this.rendered&&this.render(y)||this.toggle(y))},"^style.classes$":function(a,b,c,d){this.rendered&&this.tooltip.removeClass(d).addClass(c)},"^style.(width|height)":function(a,b,c){this.rendered&&this.tooltip.css(b,c)},"^style.widget|content.title":function(){this.rendered&&this._setWidget()},"^style.def":function(a,b,c){this.rendered&&this.tooltip.toggleClass(Q,!!c)},"^events.(render|show|move|hide|focus|blur)$":function(a,b,c){this.rendered&&this.tooltip[(d.isFunction(c)?"":"un")+"bind"]("tooltip"+b,c)},"^(show|hide|position).(event|target|fixed|inactive|leave|distance|viewport|adjust)":function(){if(this.rendered){var a=this.options.position;this.tooltip.attr("tracking","mouse"===a.target&&a.adjust.mouse),this._unassignEvents(),this._assignEvents()}}}},u.get=function(a){if(this.destroyed)return this;var b=i(this.options,a.toLowerCase()),c=b[0][b[1]];return c.precedance?c.string():c};var X=/^position\.(my|at|adjust|target|container|viewport)|style|content|show\.ready/i,Y=/^prerender|show\.ready/i;u.set=function(a,b){if(this.destroyed)return this;{var c,e=this.rendered,f=z,g=this.options;this.checks}return"string"==typeof a?(c=a,a={},a[c]=b):a=d.extend({},a),d.each(a,function(b,c){if(e&&Y.test(b))return delete a[b],void 0;var h,j=i(g,b.toLowerCase());h=j[0][j[1]],j[0][j[1]]=c&&c.nodeType?d(c):c,f=X.test(b)||f,a[b]=[j[0],j[1],c,h]}),h(g),this.positioning=y,d.each(a,d.proxy(j,this)),this.positioning=z,this.rendered&&this.tooltip[0].offsetWidth>0&&f&&this.reposition("mouse"===g.position.target?A:this.cache.event),this},u._update=function(a,b){var c=this,e=this.cache;return this.rendered&&a?(d.isFunction(a)&&(a=a.call(this.elements.target,e.event,this)||""),d.isFunction(a.then)?(e.waiting=y,a.then(function(a){return e.waiting=z,c._update(a,b)},A,function(a){return c._update(a,b)})):a===z||!a&&""!==a?z:(a.jquery&&a.length>0?b.empty().append(a.css({display:"block",visibility:"visible"})):b.html(a),this._waitForContent(b).then(function(a){a.images&&a.images.length&&c.rendered&&c.tooltip[0].offsetWidth>0&&c.reposition(e.event,!a.length)}))):z},u._waitForContent=function(a){var b=this.cache;return b.waiting=y,(d.fn.imagesLoaded?a.imagesLoaded():d.Deferred().resolve([])).done(function(){b.waiting=z}).promise()},u._updateContent=function(a,b){this._update(a,this.elements.content,b)},u._updateTitle=function(a,b){this._update(a,this.elements.title,b)===z&&this._removeTitle(z)},u._createTitle=function(){var a=this.elements,b=this._id+"-title";a.titlebar&&this._removeTitle(),a.titlebar=d("<div />",{"class":J+"-titlebar "+(this.options.style.widget?k("header"):"")}).append(a.title=d("<div />",{id:b,"class":J+"-title","aria-atomic":y})).insertBefore(a.content).delegate(".qtip-close","mousedown keydown mouseup keyup mouseout",function(a){d(this).toggleClass("ui-state-active ui-state-focus","down"===a.type.substr(-4))}).delegate(".qtip-close","mouseover mouseout",function(a){d(this).toggleClass("ui-state-hover","mouseover"===a.type)}),this.options.content.button&&this._createButton()},u._removeTitle=function(a){var b=this.elements;b.title&&(b.titlebar.remove(),b.titlebar=b.title=b.button=A,a!==z&&this.reposition())},u.reposition=function(c,e){if(!this.rendered||this.positioning||this.destroyed)return this;this.positioning=y;var f,g,h=this.cache,i=this.tooltip,j=this.options.position,k=j.target,l=j.my,m=j.at,n=j.viewport,o=j.container,p=j.adjust,q=p.method.split(" "),r=i.outerWidth(z),s=i.outerHeight(z),t=0,u=0,v=i.css("position"),w={left:0,top:0},x=i[0].offsetWidth>0,A=c&&"scroll"===c.type,B=d(a),C=o[0].ownerDocument,J=this.mouse;if(d.isArray(k)&&2===k.length)m={x:E,y:D},w={left:k[0],top:k[1]};else if("mouse"===k)m={x:E,y:D},!J||!J.pageX||!p.mouse&&c&&c.pageX?c&&c.pageX||((!p.mouse||this.options.show.distance)&&h.origin&&h.origin.pageX?c=h.origin:(!c||c&&("resize"===c.type||"scroll"===c.type))&&(c=h.event)):c=J,"static"!==v&&(w=o.offset()),C.body.offsetWidth!==(a.innerWidth||C.documentElement.clientWidth)&&(g=d(b.body).offset()),w={left:c.pageX-w.left+(g&&g.left||0),top:c.pageY-w.top+(g&&g.top||0)},p.mouse&&A&&J&&(w.left-=(J.scrollX||0)-B.scrollLeft(),w.top-=(J.scrollY||0)-B.scrollTop());else{if("event"===k?c&&c.target&&"scroll"!==c.type&&"resize"!==c.type?h.target=d(c.target):c.target||(h.target=this.elements.target):"event"!==k&&(h.target=d(k.jquery?k:this.elements.target)),k=h.target,k=d(k).eq(0),0===k.length)return this;k[0]===b||k[0]===a?(t=W.iOS?a.innerWidth:k.width(),u=W.iOS?a.innerHeight:k.height(),k[0]===a&&(w={top:(n||k).scrollTop(),left:(n||k).scrollLeft()})):I.imagemap&&k.is("area")?f=I.imagemap(this,k,m,I.viewport?q:z):I.svg&&k&&k[0].ownerSVGElement?f=I.svg(this,k,m,I.viewport?q:z):(t=k.outerWidth(z),u=k.outerHeight(z),w=k.offset()),f&&(t=f.width,u=f.height,g=f.offset,w=f.position),w=this.reposition.offset(k,w,o),(W.iOS>3.1&&W.iOS<4.1||W.iOS>=4.3&&W.iOS<4.33||!W.iOS&&"fixed"===v)&&(w.left-=B.scrollLeft(),w.top-=B.scrollTop()),(!f||f&&f.adjustable!==z)&&(w.left+=m.x===G?t:m.x===H?t/2:0,w.top+=m.y===F?u:m.y===H?u/2:0)}return w.left+=p.x+(l.x===G?-r:l.x===H?-r/2:0),w.top+=p.y+(l.y===F?-s:l.y===H?-s/2:0),I.viewport?(w.adjusted=I.viewport(this,w,j,t,u,r,s),g&&w.adjusted.left&&(w.left+=g.left),g&&w.adjusted.top&&(w.top+=g.top)):w.adjusted={left:0,top:0},this._trigger("move",[w,n.elem||n],c)?(delete w.adjusted,e===z||!x||isNaN(w.left)||isNaN(w.top)||"mouse"===k||!d.isFunction(j.effect)?i.css(w):d.isFunction(j.effect)&&(j.effect.call(i,this,d.extend({},w)),i.queue(function(a){d(this).css({opacity:"",height:""}),W.ie&&this.style.removeAttribute("filter"),a()})),this.positioning=z,this):this},u.reposition.offset=function(a,c,e){function f(a,b){c.left+=b*a.scrollLeft(),c.top+=b*a.scrollTop()}if(!e[0])return c;var g,h,i,j,k=d(a[0].ownerDocument),l=!!W.ie&&"CSS1Compat"!==b.compatMode,m=e[0];do"static"!==(h=d.css(m,"position"))&&("fixed"===h?(i=m.getBoundingClientRect(),f(k,-1)):(i=d(m).position(),i.left+=parseFloat(d.css(m,"borderLeftWidth"))||0,i.top+=parseFloat(d.css(m,"borderTopWidth"))||0),c.left-=i.left+(parseFloat(d.css(m,"marginLeft"))||0),c.top-=i.top+(parseFloat(d.css(m,"marginTop"))||0),g||"hidden"===(j=d.css(m,"overflow"))||"visible"===j||(g=d(m)));while(m=m.offsetParent);return g&&(g[0]!==k[0]||l)&&f(g,1),c};var Z=(v=u.reposition.Corner=function(a,b){a=(""+a).replace(/([A-Z])/," $1").replace(/middle/gi,H).toLowerCase(),this.x=(a.match(/left|right/i)||a.match(/center/)||["inherit"])[0].toLowerCase(),this.y=(a.match(/top|bottom|center/i)||["inherit"])[0].toLowerCase(),this.forceY=!!b;var c=a.charAt(0);this.precedance="t"===c||"b"===c?C:B}).prototype;Z.invert=function(a,b){this[a]=this[a]===E?G:this[a]===G?E:b||this[a]},Z.string=function(){var a=this.x,b=this.y;return a===b?a:this.precedance===C||this.forceY&&"center"!==b?b+" "+a:a+" "+b},Z.abbrev=function(){var a=this.string().split(" ");return a[0].charAt(0)+(a[1]&&a[1].charAt(0)||"")},Z.clone=function(){return new v(this.string(),this.forceY)},u.toggle=function(a,c){var e=this.cache,f=this.options,g=this.tooltip;if(c){if(/over|enter/.test(c.type)&&/out|leave/.test(e.event.type)&&f.show.target.add(c.target).length===f.show.target.length&&g.has(c.relatedTarget).length)return this;e.event=l(c)}if(this.waiting&&!a&&(this.hiddenDuringWait=y),!this.rendered)return a?this.render(1):this;if(this.destroyed||this.disabled)return this;var h,i,j,k=a?"show":"hide",m=this.options[k],n=(this.options[a?"hide":"show"],this.options.position),o=this.options.content,p=this.tooltip.css("width"),q=this.tooltip.is(":visible"),r=a||1===m.target.length,s=!c||m.target.length<2||e.target[0]===c.target;return(typeof a).search("boolean|number")&&(a=!q),h=!g.is(":animated")&&q===a&&s,i=h?A:!!this._trigger(k,[90]),this.destroyed?this:(i!==z&&a&&this.focus(c),!i||h?this:(d.attr(g[0],"aria-hidden",!a),a?(e.origin=l(this.mouse),d.isFunction(o.text)&&this._updateContent(o.text,z),d.isFunction(o.title)&&this._updateTitle(o.title,z),!x&&"mouse"===n.target&&n.adjust.mouse&&(d(b).bind("mousemove."+J,this._storeMouse),x=y),p||g.css("width",g.outerWidth(z)),this.reposition(c,arguments[2]),p||g.css("width",""),m.solo&&("string"==typeof m.solo?d(m.solo):d(N,m.solo)).not(g).not(m.target).qtip("hide",d.Event("tooltipsolo"))):(clearTimeout(this.timers.show),delete e.origin,x&&!d(N+'[tracking="true"]:visible',m.solo).not(g).length&&(d(b).unbind("mousemove."+J),x=z),this.blur(c)),j=d.proxy(function(){a?(W.ie&&g[0].style.removeAttribute("filter"),g.css("overflow",""),"string"==typeof m.autofocus&&d(this.options.show.autofocus,g).focus(),this.options.show.target.trigger("qtip-"+this.id+"-inactive")):g.css({display:"",visibility:"",opacity:"",left:"",top:""}),this._trigger(a?"visible":"hidden")},this),m.effect===z||r===z?(g[k](),j()):d.isFunction(m.effect)?(g.stop(1,1),m.effect.call(g,this),g.queue("fx",function(a){j(),a()})):g.fadeTo(90,a?1:0,j),a&&m.target.trigger("qtip-"+this.id+"-inactive"),this))},u.show=function(a){return this.toggle(y,a)},u.hide=function(a){return this.toggle(z,a)},u.focus=function(a){if(!this.rendered||this.destroyed)return this;var b=d(N),c=this.tooltip,e=parseInt(c[0].style.zIndex,10),f=t.zindex+b.length;return c.hasClass(R)||this._trigger("focus",[f],a)&&(e!==f&&(b.each(function(){this.style.zIndex>e&&(this.style.zIndex=this.style.zIndex-1)}),b.filter("."+R).qtip("blur",a)),c.addClass(R)[0].style.zIndex=f),this},u.blur=function(a){return!this.rendered||this.destroyed?this:(this.tooltip.removeClass(R),this._trigger("blur",[this.tooltip.css("zIndex")],a),this)},u.disable=function(a){return this.destroyed?this:("toggle"===a?a=!(this.rendered?this.tooltip.hasClass(T):this.disabled):"boolean"!=typeof a&&(a=y),this.rendered&&this.tooltip.toggleClass(T,a).attr("aria-disabled",a),this.disabled=!!a,this)},u.enable=function(){return this.disable(z)},u._createButton=function(){var a=this,b=this.elements,c=b.tooltip,e=this.options.content.button,f="string"==typeof e,g=f?e:"Close tooltip";b.button&&b.button.remove(),b.button=e.jquery?e:d("<a />",{"class":"qtip-close "+(this.options.style.widget?"":J+"-icon"),title:g,"aria-label":g}).prepend(d("<span />",{"class":"ui-icon ui-icon-close",html:"&times;"})),b.button.appendTo(b.titlebar||c).attr("role","button").click(function(b){return c.hasClass(T)||a.hide(b),z})},u._updateButton=function(a){if(!this.rendered)return z;var b=this.elements.button;a?this._createButton():b.remove()},u._setWidget=function(){var a=this.options.style.widget,b=this.elements,c=b.tooltip,d=c.hasClass(T);c.removeClass(T),T=a?"ui-state-disabled":"qtip-disabled",c.toggleClass(T,d),c.toggleClass("ui-helper-reset "+k(),a).toggleClass(Q,this.options.style.def&&!a),b.content&&b.content.toggleClass(k("content"),a),b.titlebar&&b.titlebar.toggleClass(k("header"),a),b.button&&b.button.toggleClass(J+"-icon",!a)},u._storeMouse=function(a){(this.mouse=l(a)).type="mousemove"},u._bind=function(a,b,c,e,f){var g="."+this._id+(e?"-"+e:"");b.length&&d(a).bind((b.split?b:b.join(g+" "))+g,d.proxy(c,f||this))},u._unbind=function(a,b){d(a).unbind("."+this._id+(b?"-"+b:""))};var $="."+J;d(function(){r(N,["mouseenter","mouseleave"],function(a){var b="mouseenter"===a.type,c=d(a.currentTarget),e=d(a.relatedTarget||a.target),f=this.options;b?(this.focus(a),c.hasClass(P)&&!c.hasClass(T)&&clearTimeout(this.timers.hide)):"mouse"===f.position.target&&f.hide.event&&f.show.target&&!e.closest(f.show.target[0]).length&&this.hide(a),c.toggleClass(S,b)}),r("["+L+"]",O,p)}),u._trigger=function(a,b,c){var e=d.Event("tooltip"+a);return e.originalEvent=c&&d.extend({},c)||this.cache.event||A,this.triggering=a,this.tooltip.trigger(e,[this].concat(b||[])),this.triggering=z,!e.isDefaultPrevented()},u._bindEvents=function(a,b,c,e,f,g){if(e.add(c).length===e.length){var h=[];b=d.map(b,function(b){var c=d.inArray(b,a);return c>-1?(h.push(a.splice(c,1)[0]),void 0):b}),h.length&&this._bind(c,h,function(a){var b=this.rendered?this.tooltip[0].offsetWidth>0:!1;(b?g:f).call(this,a)})}this._bind(c,a,f),this._bind(e,b,g)},u._assignInitialEvents=function(a){function b(a){return this.disabled||this.destroyed?z:(this.cache.event=l(a),this.cache.target=a?d(a.target):[c],clearTimeout(this.timers.show),this.timers.show=m.call(this,function(){this.render("object"==typeof a||e.show.ready)},e.show.delay),void 0)}var e=this.options,f=e.show.target,g=e.hide.target,h=e.show.event?d.trim(""+e.show.event).split(" "):[],i=e.hide.event?d.trim(""+e.hide.event).split(" "):[];/mouse(over|enter)/i.test(e.show.event)&&!/mouse(out|leave)/i.test(e.hide.event)&&i.push("mouseleave"),this._bind(f,"mousemove",function(a){this._storeMouse(a),this.cache.onTarget=y}),this._bindEvents(h,i,f,g,b,function(){clearTimeout(this.timers.show)}),(e.show.ready||e.prerender)&&b.call(this,a)},u._assignEvents=function(){var c=this,e=this.options,f=e.position,g=this.tooltip,h=e.show.target,i=e.hide.target,j=f.container,k=f.viewport,l=d(b),m=(d(b.body),d(a)),r=e.show.event?d.trim(""+e.show.event).split(" "):[],s=e.hide.event?d.trim(""+e.hide.event).split(" "):[];d.each(e.events,function(a,b){c._bind(g,"toggle"===a?["tooltipshow","tooltiphide"]:["tooltip"+a],b,null,g)}),/mouse(out|leave)/i.test(e.hide.event)&&"window"===e.hide.leave&&this._bind(l,["mouseout","blur"],function(a){/select|option/.test(a.target.nodeName)||a.relatedTarget||this.hide(a)}),e.hide.fixed?i=i.add(g.addClass(P)):/mouse(over|enter)/i.test(e.show.event)&&this._bind(i,"mouseleave",function(){clearTimeout(this.timers.show)}),(""+e.hide.event).indexOf("unfocus")>-1&&this._bind(j.closest("html"),["mousedown","touchstart"],function(a){var b=d(a.target),c=this.rendered&&!this.tooltip.hasClass(T)&&this.tooltip[0].offsetWidth>0,e=b.parents(N).filter(this.tooltip[0]).length>0;b[0]===this.target[0]||b[0]===this.tooltip[0]||e||this.target.has(b[0]).length||!c||this.hide(a)}),"number"==typeof e.hide.inactive&&(this._bind(h,"qtip-"+this.id+"-inactive",p),this._bind(i.add(g),t.inactiveEvents,p,"-inactive")),this._bindEvents(r,s,h,i,n,o),this._bind(h.add(g),"mousemove",function(a){if("number"==typeof e.hide.distance){var b=this.cache.origin||{},c=this.options.hide.distance,d=Math.abs;(d(a.pageX-b.pageX)>=c||d(a.pageY-b.pageY)>=c)&&this.hide(a)}this._storeMouse(a)}),"mouse"===f.target&&f.adjust.mouse&&(e.hide.event&&this._bind(h,["mouseenter","mouseleave"],function(a){this.cache.onTarget="mouseenter"===a.type}),this._bind(l,"mousemove",function(a){this.rendered&&this.cache.onTarget&&!this.tooltip.hasClass(T)&&this.tooltip[0].offsetWidth>0&&this.reposition(a)})),(f.adjust.resize||k.length)&&this._bind(d.event.special.resize?k:m,"resize",q),f.adjust.scroll&&this._bind(m.add(f.container),"scroll",q)},u._unassignEvents=function(){var c=[this.options.show.target[0],this.options.hide.target[0],this.rendered&&this.tooltip[0],this.options.position.container[0],this.options.position.viewport[0],this.options.position.container.closest("html")[0],a,b];this._unbind(d([]).pushStack(d.grep(c,function(a){return"object"==typeof a})))},t=d.fn.qtip=function(a,b,e){var f=(""+a).toLowerCase(),g=A,i=d.makeArray(arguments).slice(1),j=i[i.length-1],k=this[0]?d.data(this[0],J):A;return!arguments.length&&k||"api"===f?k:"string"==typeof a?(this.each(function(){var a=d.data(this,J);if(!a)return y;if(j&&j.timeStamp&&(a.cache.event=j),!b||"option"!==f&&"options"!==f)a[f]&&a[f].apply(a,i);else{if(e===c&&!d.isPlainObject(b))return g=a.get(b),z;a.set(b,e)}}),g!==A?g:this):"object"!=typeof a&&arguments.length?void 0:(k=h(d.extend(y,{},a)),this.each(function(a){var b,c;return c=d.isArray(k.id)?k.id[a]:k.id,c=!c||c===z||c.length<1||t.api[c]?t.nextid++:c,b=s(d(this),c,k),b===z?y:(t.api[c]=b,d.each(I,function(){"initialize"===this.initialize&&this(b)}),b._assignInitialEvents(j),void 0)}))},d.qtip=e,t.api={},d.each({attr:function(a,b){if(this.length){var c=this[0],e="title",f=d.data(c,"qtip");if(a===e&&f&&"object"==typeof f&&f.options.suppress)return arguments.length<2?d.attr(c,V):(f&&f.options.content.attr===e&&f.cache.attr&&f.set("content.text",b),this.attr(V,b))}return d.fn["attr"+U].apply(this,arguments)},clone:function(a){var b=(d([]),d.fn["clone"+U].apply(this,arguments));return a||b.filter("["+V+"]").attr("title",function(){return d.attr(this,V)}).removeAttr(V),b}},function(a,b){if(!b||d.fn[a+U])return y;var c=d.fn[a+U]=d.fn[a];d.fn[a]=function(){return b.apply(this,arguments)||c.apply(this,arguments)}}),d.ui||(d["cleanData"+U]=d.cleanData,d.cleanData=function(a){for(var b,c=0;(b=d(a[c])).length;c++)if(b.attr(K))try{b.triggerHandler("removeqtip")}catch(e){}d["cleanData"+U].apply(this,arguments)}),t.version="2.2.0",t.nextid=0,t.inactiveEvents=O,t.zindex=15e3,t.defaults={prerender:z,id:z,overwrite:y,suppress:y,content:{text:y,attr:"title",title:z,button:z},position:{my:"top left",at:"bottom right",target:z,container:z,viewport:z,adjust:{x:0,y:0,mouse:y,scroll:y,resize:y,method:"flipinvert flipinvert"},effect:function(a,b){d(this).animate(b,{duration:200,queue:z})}},show:{target:z,event:"mouseenter",effect:y,delay:90,solo:z,ready:z,autofocus:z},hide:{target:z,event:"mouseleave",effect:y,delay:0,fixed:z,inactive:z,leave:"window",distance:z},style:{classes:"",widget:z,width:z,height:z,def:y},events:{render:A,move:A,show:A,hide:A,toggle:A,visible:A,hidden:A,focus:A,blur:A}}})}(window,document);
//# sourceMappingURL=http://cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.0//var/www/qtip2/build/tmp/tmp-119546t2z600/jquery.qtip.min.map
/**
* hoverIntent r5 // 2007.03.27 // jQuery 1.1.2+
* <http://cherne.net/brian/resources/jquery.hoverIntent.html>
* 
* @param  f  onMouseOver function || An object with configuration options
* @param  g  onMouseOut function  || Nothing (use configuration options object)
* @author    Brian Cherne <brian@cherne.net>
*/
(function($){$.fn.hoverIntent=function(f,g){var cfg={sensitivity:7,interval:100,timeout:0};cfg=$.extend(cfg,g?{over:f,out:g}:f);var cX,cY,pX,pY;var track=function(ev){cX=ev.pageX;cY=ev.pageY;};var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if((Math.abs(pX-cX)+Math.abs(pY-cY))<cfg.sensitivity){$(ob).unbind("mousemove",track);ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev]);}else{pX=cX;pY=cY;ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);},cfg.interval);}};var delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev]);};var handleHover=function(e){var p=(e.type=="mouseover"?e.fromElement:e.toElement)||e.relatedTarget;while(p&&p!=this){try{p=p.parentNode;}catch(e){p=this;}}if(p==this){return false;}var ev=jQuery.extend({},e);var ob=this;if(ob.hoverIntent_t){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);}if(e.type=="mouseover"){pX=ev.pageX;pY=ev.pageY;$(ob).bind("mousemove",track);if(ob.hoverIntent_s!=1){ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);},cfg.interval);}}else{$(ob).unbind("mousemove",track);if(ob.hoverIntent_s==1){ob.hoverIntent_t=setTimeout(function(){delay(ev,ob);},cfg.timeout);}}};return this.mouseover(handleHover).mouseout(handleHover);};})(jQuery);
/* Copyright (c) 2006 Brandon Aaron (http://brandonaaron.net)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) 
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * $LastChangedDate: 2007-07-21 18:45:56 -0500 (Sat, 21 Jul 2007) $
 * $Rev: 2447 $
 *
 * Version 2.1.1
 */
(function($){$.fn.bgIframe=$.fn.bgiframe=function(s){if($.browser.msie&&/6.0/.test(navigator.userAgent)){s=$.extend({top:'auto',left:'auto',width:'auto',height:'auto',opacity:true,src:'javascript:false;'},s||{});var prop=function(n){return n&&n.constructor==Number?n+'px':n;},html='<iframe class="bgiframe"frameborder="0"tabindex="-1"src="'+s.src+'"'+'style="display:block;position:absolute;z-index:-1;'+(s.opacity!==false?'filter:Alpha(Opacity=\'0\');':'')+'top:'+(s.top=='auto'?'expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+\'px\')':prop(s.top))+';'+'left:'+(s.left=='auto'?'expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+\'px\')':prop(s.left))+';'+'width:'+(s.width=='auto'?'expression(this.parentNode.offsetWidth+\'px\')':prop(s.width))+';'+'height:'+(s.height=='auto'?'expression(this.parentNode.offsetHeight+\'px\')':prop(s.height))+';'+'"/>';return this.each(function(){if($('> iframe.bgiframe',this).length==0)this.insertBefore(document.createElement(html),this.firstChild);});}return this;};})(jQuery);
// threejs.org/license
'use strict';var THREE={REVISION:"69"};"object"===typeof module&&(module.exports=THREE);void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:0});THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;
THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.MinEquation=103;THREE.MaxEquation=104;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;
THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=function(){};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.RepeatWrapping=1E3;
THREE.ClampToEdgeWrapping=1001;THREE.MirroredRepeatWrapping=1002;THREE.NearestFilter=1003;THREE.NearestMipMapNearestFilter=1004;THREE.NearestMipMapLinearFilter=1005;THREE.LinearFilter=1006;THREE.LinearMipMapNearestFilter=1007;THREE.LinearMipMapLinearFilter=1008;THREE.UnsignedByteType=1009;THREE.ByteType=1010;THREE.ShortType=1011;THREE.UnsignedShortType=1012;THREE.IntType=1013;THREE.UnsignedIntType=1014;THREE.FloatType=1015;THREE.UnsignedShort4444Type=1016;THREE.UnsignedShort5551Type=1017;
THREE.UnsignedShort565Type=1018;THREE.AlphaFormat=1019;THREE.RGBFormat=1020;THREE.RGBAFormat=1021;THREE.LuminanceFormat=1022;THREE.LuminanceAlphaFormat=1023;THREE.RGB_S3TC_DXT1_Format=2001;THREE.RGBA_S3TC_DXT1_Format=2002;THREE.RGBA_S3TC_DXT3_Format=2003;THREE.RGBA_S3TC_DXT5_Format=2004;THREE.RGB_PVRTC_4BPPV1_Format=2100;THREE.RGB_PVRTC_2BPPV1_Format=2101;THREE.RGBA_PVRTC_4BPPV1_Format=2102;THREE.RGBA_PVRTC_2BPPV1_Format=2103;
THREE.Color=function(a){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(a)};
THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(a){a instanceof THREE.Color?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(a,b,c){if(0===b)this.r=this.g=this.b=c;else{var d=function(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*
c:.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a};b=.5>=c?c*(1+b):c+b-c*b;c=2*c-b;this.r=d(c,b,a+1/3);this.g=d(c,b,a);this.b=d(c,b,a-1/3)}return this},setStyle:function(a){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(a))return a=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(a),this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,this;if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(a))return a=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(a),this.r=
Math.min(100,parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,this;if(/^\#([0-9a-f]{6})$/i.test(a))return a=/^\#([0-9a-f]{6})$/i.exec(a),this.setHex(parseInt(a[1],16)),this;if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a))return a=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a),this.setHex(parseInt(a[1]+a[1]+a[2]+a[2]+a[3]+a[3],16)),this;if(/^(\w+)$/i.test(a))return this.setHex(THREE.ColorKeywords[a]),this},copy:function(a){this.r=a.r;this.g=
a.g;this.b=a.b;return this},copyGammaToLinear:function(a){this.r=a.r*a.r;this.g=a.g*a.g;this.b=a.b*a.b;return this},copyLinearToGamma:function(a){this.r=Math.sqrt(a.r);this.g=Math.sqrt(a.g);this.b=Math.sqrt(a.b);return this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<
8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b=this.r,c=this.g,d=this.b,e=Math.max(b,c,d),f=Math.min(b,c,d),g,h=(f+e)/2;if(f===e)f=g=0;else{var k=e-f,f=.5>=h?k/(e+f):k/(2-e-f);switch(e){case b:g=(c-d)/k+(c<d?6:0);break;case c:g=(d-b)/k+2;break;case d:g=(b-c)/k+4}g/=6}a.h=g;a.s=f;a.l=h;return a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,
b,c){var d=this.getHSL();d.h+=a;d.s+=b;d.l+=c;this.setHSL(d.h,d.s,d.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;
this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a){this.r=a[0];this.g=a[1];this.b=a[2];return this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};
THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,
darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,
grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,
lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,
palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,
tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==d?d:1};
THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this.onChangeCallback();return this},copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;
this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!1===a instanceof THREE.Euler)throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var c=Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),f=Math.sin(a._x/2),g=Math.sin(a._y/2),h=Math.sin(a._z/2);"XYZ"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"YXZ"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=
c*d*h-f*g*e,this._w=c*d*e+f*g*h):"ZXY"===a.order?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"ZYX"===a.order?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):"YZX"===a.order?(this._x=f*d*e+c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e-f*g*h):"XZY"===a.order&&(this._x=f*d*e-c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e+f*g*h);if(!1!==b)this.onChangeCallback();return this},setFromAxisAngle:function(a,
b){var c=b/2,d=Math.sin(c);this._x=a.x*d;this._y=a.y*d;this._z=a.z*d;this._w=Math.cos(c);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var d=b[8],e=b[1],f=b[5],g=b[9],h=b[2],k=b[6],b=b[10],n=c+f+b;0<n?(c=.5/Math.sqrt(n+1),this._w=.25/c,this._x=(k-g)*c,this._y=(d-h)*c,this._z=(e-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this._w=(k-g)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+h)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this._w=(d-h)/c,this._x=(a+e)/c,this._y=
.25*c,this._z=(g+k)/c):(c=2*Math.sqrt(1+b-c-f),this._w=(e-a)/c,this._x=(d+h)/c,this._y=(g+k)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3);b=c.dot(d)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=
-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},
multiply:function(a,b){return void 0!==b?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,k=b._z,n=b._w;this._x=c*n+f*g+d*k-e*h;this._y=d*n+f*h+e*g-c*k;this._z=e*n+f*k+c*h-d*g;this._w=f*n-c*g-d*h-e*k;this.onChangeCallback();return this},multiplyVector3:function(a){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");
return a.applyQuaternion(this)},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a);if(1<=g)return this._w=f,this._x=c,this._y=d,this._z=e,this;var h=Math.acos(g),k=Math.sqrt(1-g*g);if(.001>Math.abs(k))return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;g=Math.sin((1-b)*h)/k;h=
Math.sin(b*h)/k;this._w=f*g+this._w*h;this._x=c*g+this._x*h;this._y=d*g+this._y*h;this._z=e*g+this._z*h;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=
a;return this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}};THREE.Quaternion.slerp=function(a,b,c,d){return c.copy(a).slerp(b,d)};THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};
THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(a,b){this.x=a;this.y=b;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,
b){if(void 0!==b)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},
subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a):this.y=this.x=0;return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);return this},clamp:function(a,
b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector2,b=new THREE.Vector2);a.set(c,c);b.set(d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},
roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=
this.x-a.x;a=this.y-a.y;return b*b+a*a},setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},clone:function(){return new THREE.Vector2(this.x,this.y)}};
THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};
THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+
a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=
a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===b instanceof THREE.Euler&&console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.");void 0===a&&(a=new THREE.Quaternion);this.applyQuaternion(a.setFromEuler(b));return this}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new THREE.Quaternion);this.applyQuaternion(a.setFromAxisAngle(b,c));return this}}(),applyMatrix3:function(a){var b=this.x,
c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12];this.y=a[1]*b+a[5]*c+a[9]*d+a[13];this.z=a[2]*b+a[6]*c+a[10]*d+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*e;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=
(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=a.w;var h=a*b+f*d-g*c,k=a*c+g*b-e*d,n=a*d+e*c-f*b,b=-e*b-f*c-g*d;this.x=h*a+b*-e+k*-g-n*-f;this.y=k*a+b*-f+n*-e-h*-g;this.z=n*a+b*-g+h*-f-k*-e;return this},project:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),unproject:function(){var a;return function(b){void 0===
a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),transformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;this.normalize();return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return this},min:function(a){this.x>
a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3,b=new THREE.Vector3);a.set(c,c,c);b.set(d,d,d);return this.clamp(a,
b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);
return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/
b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},cross:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;this.x=d*a.z-e*a.y;this.y=e*a.x-c*a.z;this.z=c*a.y-d*a.x;return this},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;this.x=d*h-e*g;this.y=e*f-c*h;this.z=c*g-d*f;return this},
projectOnVector:function(){var a,b;return function(c){void 0===a&&(a=new THREE.Vector3);a.copy(c).normalize();b=this.dot(a);return this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/(this.length()*a.length());
return Math.acos(THREE.Math.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},setEulerFromRotationMatrix:function(a,b){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(a,b){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},
getPositionFromMatrix:function(a){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(a,
b)},setFromMatrixPosition:function(a){this.x=a.elements[12];this.y=a.elements[13];this.z=a.elements[14];return this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length();a=this.set(a.elements[8],a.elements[9],a.elements[10]).length();this.x=b;this.y=c;this.z=a;return this},setFromMatrixColumn:function(a,b){var c=4*a,d=b.elements;this.x=d[c];this.y=d[c+1];this.z=d[c+2];return this},equals:function(a){return a.x===
this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1};
THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;
case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},
addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},applyMatrix4:function(a){var b=
this.x,c=this.y,d=this.z,e=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*e;this.z=a[2]*b+a[6]*c+a[10]*d+a[14]*e;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a):(this.z=this.y=this.x=0,this.w=1);return this},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},
setAxisAngleFromRotationMatrix:function(a){var b,c,d;a=a.elements;var e=a[0];d=a[4];var f=a[8],g=a[1],h=a[5],k=a[9];c=a[2];b=a[6];var n=a[10];if(.01>Math.abs(d-g)&&.01>Math.abs(f-c)&&.01>Math.abs(k-b)){if(.1>Math.abs(d+g)&&.1>Math.abs(f+c)&&.1>Math.abs(k+b)&&.1>Math.abs(e+h+n-3))return this.set(1,0,0,0),this;a=Math.PI;e=(e+1)/2;h=(h+1)/2;n=(n+1)/2;d=(d+g)/4;f=(f+c)/4;k=(k+b)/4;e>h&&e>n?.01>e?(b=0,d=c=.707106781):(b=Math.sqrt(e),c=d/b,d=f/b):h>n?.01>h?(b=.707106781,c=0,d=.707106781):(c=Math.sqrt(h),
b=d/c,d=k/c):.01>n?(c=b=.707106781,d=0):(d=Math.sqrt(n),b=f/d,c=k/d);this.set(b,c,d,a);return this}a=Math.sqrt((b-k)*(b-k)+(f-c)*(f-c)+(g-d)*(g-d));.001>Math.abs(a)&&(a=1);this.x=(b-k)/a;this.y=(f-c)/a;this.z=(g-d)/a;this.w=Math.acos((e+h+n-1)/2);return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);this.w>a.w&&(this.w=a.w);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);this.w<a.w&&(this.w=a.w);
return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z);this.w<a.w?this.w=a.w:this.w>b.w&&(this.w=b.w);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector4,b=new THREE.Vector4);a.set(c,c,c,c);b.set(d,d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);
return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);
return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},
setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=
this.z;a[b+3]=this.w;return a},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Euler=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");THREE.Euler.DefaultOrder="XYZ";
THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},copy:function(a){this._x=
a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b){var c=THREE.Math.clamp,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[1],k=d[5],n=d[9],p=d[2],q=d[6],d=d[10];b=b||this._order;"XYZ"===b?(this._y=Math.asin(c(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(-n,d),this._z=Math.atan2(-f,e)):(this._x=Math.atan2(q,k),this._z=0)):"YXZ"===b?(this._x=Math.asin(-c(n,-1,1)),.99999>Math.abs(n)?(this._y=Math.atan2(g,d),this._z=Math.atan2(h,k)):(this._y=
Math.atan2(-p,e),this._z=0)):"ZXY"===b?(this._x=Math.asin(c(q,-1,1)),.99999>Math.abs(q)?(this._y=Math.atan2(-p,d),this._z=Math.atan2(-f,k)):(this._y=0,this._z=Math.atan2(h,e))):"ZYX"===b?(this._y=Math.asin(-c(p,-1,1)),.99999>Math.abs(p)?(this._x=Math.atan2(q,d),this._z=Math.atan2(h,e)):(this._x=0,this._z=Math.atan2(-f,k))):"YZX"===b?(this._z=Math.asin(c(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(-n,k),this._y=Math.atan2(-p,e)):(this._x=0,this._y=Math.atan2(g,d))):"XZY"===b?(this._z=Math.asin(-c(f,
-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(q,k),this._y=Math.atan2(g,e)):(this._x=Math.atan2(-n,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+b);this._order=b;this.onChangeCallback();return this},setFromQuaternion:function(a,b,c){var d=THREE.Math.clamp,e=a.x*a.x,f=a.y*a.y,g=a.z*a.z,h=a.w*a.w;b=b||this._order;"XYZ"===b?(this._x=Math.atan2(2*(a.x*a.w-a.y*a.z),h-e-f+g),this._y=Math.asin(d(2*(a.x*a.z+a.y*a.w),-1,1)),this._z=Math.atan2(2*(a.z*a.w-a.x*
a.y),h+e-f-g)):"YXZ"===b?(this._x=Math.asin(d(2*(a.x*a.w-a.y*a.z),-1,1)),this._y=Math.atan2(2*(a.x*a.z+a.y*a.w),h-e-f+g),this._z=Math.atan2(2*(a.x*a.y+a.z*a.w),h-e+f-g)):"ZXY"===b?(this._x=Math.asin(d(2*(a.x*a.w+a.y*a.z),-1,1)),this._y=Math.atan2(2*(a.y*a.w-a.z*a.x),h-e-f+g),this._z=Math.atan2(2*(a.z*a.w-a.x*a.y),h-e+f-g)):"ZYX"===b?(this._x=Math.atan2(2*(a.x*a.w+a.z*a.y),h-e-f+g),this._y=Math.asin(d(2*(a.y*a.w-a.x*a.z),-1,1)),this._z=Math.atan2(2*(a.x*a.y+a.z*a.w),h+e-f-g)):"YZX"===b?(this._x=Math.atan2(2*
(a.x*a.w-a.z*a.y),h-e+f-g),this._y=Math.atan2(2*(a.y*a.w-a.x*a.z),h+e-f-g),this._z=Math.asin(d(2*(a.x*a.y+a.z*a.w),-1,1))):"XZY"===b?(this._x=Math.atan2(2*(a.x*a.w+a.y*a.z),h-e+f-g),this._y=Math.atan2(2*(a.x*a.z+a.y*a.w),h+e-f-g),this._z=Math.asin(d(2*(a.z*a.w-a.x*a.y),-1,1))):console.warn("THREE.Euler: .setFromQuaternion() given unsupported order: "+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},reorder:function(){var a=new THREE.Quaternion;return function(b){a.setFromEuler(this);
this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}};
THREE.Line3=function(a,b){this.start=void 0!==a?a:new THREE.Vector3;this.end=void 0!==b?b:new THREE.Vector3};
THREE.Line3.prototype={constructor:THREE.Line3,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},center:function(a){return(a||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,
b){var c=b||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);var e=b.dot(b),e=b.dot(a)/e;d&&(e=THREE.Math.clamp(e,0,1));return e}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);c=c||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);
this.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}};THREE.Box2=function(a,b){this.min=void 0!==a?a:new THREE.Vector2(Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector2(-Infinity,-Infinity)};
THREE.Box2.prototype={constructor:THREE.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new THREE.Vector2;return function(b,c){var d=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this}}(),copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=
this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new THREE.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);
this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>
this.max.y?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector2;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&
a.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}};THREE.Box3=function(a,b){this.min=void 0!==a?a:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};
THREE.Box3.prototype={constructor:THREE.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new THREE.Vector3;return function(b,c){var d=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this}}(),setFromObject:function(){var a=new THREE.Vector3;return function(b){var c=this;b.updateMatrixWorld(!0);
this.makeEmpty();b.traverse(function(b){var e=b.geometry;if(void 0!==e)if(e instanceof THREE.Geometry)for(var f=e.vertices,e=0,g=f.length;e<g;e++)a.copy(f[e]),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a);else if(e instanceof THREE.BufferGeometry&&void 0!==e.attributes.position)for(f=e.attributes.position.array,e=0,g=f.length;e<g;e+=3)a.set(f[e],f[e+1],f[e+2]),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a)});return this}}(),copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},
makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(a){return(a||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);
this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector3).set((a.x-this.min.x)/(this.max.x-
this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=
new THREE.Vector3;return function(b){b=b||new THREE.Sphere;b.center=this.center();b.radius=.5*this.size(a).length();return b}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(b){a[0].set(this.min.x,this.min.y,
this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.makeEmpty();this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);
this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}};THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")};
THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(a,b,c,d,e,f,g,h,k){var n=this.elements;n[0]=a;n[3]=b;n[6]=c;n[1]=d;n[4]=e;n[7]=f;n[2]=g;n[5]=h;n[8]=k;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},multiplyVector3:function(a){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},
multiplyVector3Array:function(a){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new THREE.Vector3;return function(b,c,d){void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix3(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=
a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],k=a[7],a=a[8];return b*f*a-b*g*k-c*e*a+c*g*h+d*e*k-d*f*h},getInverse:function(a,b){var c=a.elements,d=this.elements;d[0]=c[10]*c[5]-c[6]*c[9];d[1]=-c[10]*c[1]+c[2]*c[9];d[2]=c[6]*c[1]-c[2]*c[5];d[3]=-c[10]*c[4]+c[6]*c[8];d[4]=c[10]*c[0]-c[2]*c[8];d[5]=-c[6]*c[0]+c[2]*c[4];d[6]=c[9]*c[4]-c[5]*c[8];d[7]=-c[9]*c[0]+c[1]*c[8];d[8]=c[5]*c[0]-c[1]*c[4];
c=c[0]*d[0]+c[1]*d[3]+c[2]*d[6];if(0===c){if(b)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");console.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/c);return this},transpose:function(){var a,b=this.elements;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=b[7];b[7]=a;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];
a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a},getNormalMatrix:function(a){this.getInverse(a).transpose();return this},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]},clone:function(){return(new THREE.Matrix3).fromArray(this.elements)}};
THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")};
THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(a,b,c,d,e,f,g,h,k,n,p,q,m,r,t,s){var u=this.elements;u[0]=a;u[4]=b;u[8]=c;u[12]=d;u[1]=e;u[5]=f;u[9]=g;u[13]=h;u[2]=k;u[6]=n;u[10]=p;u[14]=q;u[3]=m;u[7]=r;u[11]=t;u[15]=s;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){this.elements.set(a.elements);return this},extractPosition:function(a){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(a)},
copyPosition:function(a){var b=this.elements;a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractRotation:function(){var a=new THREE.Vector3;return function(b){var c=this.elements;b=b.elements;var d=1/a.set(b[0],b[1],b[2]).length(),e=1/a.set(b[4],b[5],b[6]).length(),f=1/a.set(b[8],b[9],b[10]).length();c[0]=b[0]*d;c[1]=b[1]*d;c[2]=b[2]*d;c[4]=b[4]*e;c[5]=b[5]*e;c[6]=b[6]*e;c[8]=b[8]*f;c[9]=b[9]*f;c[10]=b[10]*f;return this}}(),makeRotationFromEuler:function(a){!1===a instanceof THREE.Euler&&
console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c),c=Math.sin(c),g=Math.cos(d),d=Math.sin(d),h=Math.cos(e),e=Math.sin(e);if("XYZ"===a.order){a=f*h;var k=f*e,n=c*h,p=c*e;b[0]=g*h;b[4]=-g*e;b[8]=d;b[1]=k+n*d;b[5]=a-p*d;b[9]=-c*g;b[2]=p-a*d;b[6]=n+k*d;b[10]=f*g}else"YXZ"===a.order?(a=g*h,k=g*e,n=d*h,p=d*e,b[0]=a+p*c,b[4]=n*c-k,b[8]=f*d,b[1]=f*e,b[5]=f*h,b[9]=-c,b[2]=k*c-n,b[6]=p+a*c,
b[10]=f*g):"ZXY"===a.order?(a=g*h,k=g*e,n=d*h,p=d*e,b[0]=a-p*c,b[4]=-f*e,b[8]=n+k*c,b[1]=k+n*c,b[5]=f*h,b[9]=p-a*c,b[2]=-f*d,b[6]=c,b[10]=f*g):"ZYX"===a.order?(a=f*h,k=f*e,n=c*h,p=c*e,b[0]=g*h,b[4]=n*d-k,b[8]=a*d+p,b[1]=g*e,b[5]=p*d+a,b[9]=k*d-n,b[2]=-d,b[6]=c*g,b[10]=f*g):"YZX"===a.order?(a=f*g,k=f*d,n=c*g,p=c*d,b[0]=g*h,b[4]=p-a*e,b[8]=n*e+k,b[1]=e,b[5]=f*h,b[9]=-c*h,b[2]=-d*h,b[6]=k*e+n,b[10]=a-p*e):"XZY"===a.order&&(a=f*g,k=f*d,n=c*g,p=c*d,b[0]=g*h,b[4]=-e,b[8]=d*h,b[1]=a*e+p,b[5]=f*h,b[9]=k*
e-n,b[2]=n*e-k,b[6]=c*h,b[10]=p*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},setRotationFromQuaternion:function(a){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(a)},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,k=e+e;a=c*g;var n=c*h,c=c*k,p=d*h,d=d*k,e=e*k,g=f*g,h=f*h,f=f*k;b[0]=1-(p+e);b[4]=n-f;b[8]=c+h;b[1]=n+f;b[5]=1-
(a+e);b[9]=d-g;b[2]=c-h;b[6]=d+g;b[10]=1-(a+p);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f){var g=this.elements;c.subVectors(d,e).normalize();0===c.length()&&(c.z=1);a.crossVectors(f,c).normalize();0===a.length()&&(c.x+=1E-4,a.crossVectors(f,c).normalize());b.crossVectors(c,a);g[0]=a.x;g[4]=b.x;g[8]=c.x;g[1]=a.y;g[5]=b.y;g[9]=c.y;g[2]=a.z;g[6]=b.z;g[10]=c.z;return this}}(),
multiply:function(a,b){return void 0!==b?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],k=c[12],n=c[1],p=c[5],q=c[9],m=c[13],r=c[2],t=c[6],s=c[10],u=c[14],v=c[3],y=c[7],G=c[11],c=c[15],w=d[0],K=d[4],x=d[8],D=d[12],E=d[1],A=d[5],B=d[9],F=d[13],R=d[2],H=d[6],C=d[10],T=d[14],Q=d[3],
O=d[7],S=d[11],d=d[15];e[0]=f*w+g*E+h*R+k*Q;e[4]=f*K+g*A+h*H+k*O;e[8]=f*x+g*B+h*C+k*S;e[12]=f*D+g*F+h*T+k*d;e[1]=n*w+p*E+q*R+m*Q;e[5]=n*K+p*A+q*H+m*O;e[9]=n*x+p*B+q*C+m*S;e[13]=n*D+p*F+q*T+m*d;e[2]=r*w+t*E+s*R+u*Q;e[6]=r*K+t*A+s*H+u*O;e[10]=r*x+t*B+s*C+u*S;e[14]=r*D+t*F+s*T+u*d;e[3]=v*w+y*E+G*R+c*Q;e[7]=v*K+y*A+G*H+c*O;e[11]=v*x+y*B+G*C+c*S;e[15]=v*D+y*F+G*T+c*d;return this},multiplyToArray:function(a,b,c){var d=this.elements;this.multiplyMatrices(a,b);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=
d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},multiplyVector3:function(a){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");
return a.applyProjection(this)},multiplyVector4:function(a){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new THREE.Vector3;return function(b,c,d){void 0===c&&(c=0);void 0===d&&(d=
b.length);for(var e=0;e<d;e+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix4(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),rotateAxis:function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},determinant:function(){var a=this.elements,b=
a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],k=a[13],n=a[2],p=a[6],q=a[10],m=a[14];return a[3]*(+e*h*p-d*k*p-e*g*q+c*k*q+d*g*m-c*h*m)+a[7]*(+b*h*m-b*k*q+e*f*q-d*f*m+d*k*n-e*h*n)+a[11]*(+b*k*p-b*g*m-e*f*p+c*f*m+e*g*n-c*k*n)+a[15]*(-d*g*n-b*h*p+b*g*q+d*f*p-c*f*q+c*h*n)},transpose:function(){var a=this.elements,b;b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,
b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a},getPosition:function(){var a=new THREE.Vector3;return function(){console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var b=this.elements;return a.set(b[12],b[13],b[14])}}(),setPosition:function(a){var b=
this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[12],k=d[1],n=d[5],p=d[9],q=d[13],m=d[2],r=d[6],t=d[10],s=d[14],u=d[3],v=d[7],y=d[11],d=d[15];c[0]=p*s*v-q*t*v+q*r*y-n*s*y-p*r*d+n*t*d;c[4]=h*t*v-g*s*v-h*r*y+f*s*y+g*r*d-f*t*d;c[8]=g*q*v-h*p*v+h*n*y-f*q*y-g*n*d+f*p*d;c[12]=h*p*r-g*q*r-h*n*t+f*q*t+g*n*s-f*p*s;c[1]=q*t*u-p*s*u-q*m*y+k*s*y+p*m*d-k*t*d;c[5]=g*s*u-h*t*u+h*m*y-e*s*y-g*m*d+e*t*d;c[9]=h*p*u-g*q*u-h*k*
y+e*q*y+g*k*d-e*p*d;c[13]=g*q*m-h*p*m+h*k*t-e*q*t-g*k*s+e*p*s;c[2]=n*s*u-q*r*u+q*m*v-k*s*v-n*m*d+k*r*d;c[6]=h*r*u-f*s*u-h*m*v+e*s*v+f*m*d-e*r*d;c[10]=f*q*u-h*n*u+h*k*v-e*q*v-f*k*d+e*n*d;c[14]=h*n*m-f*q*m-h*k*r+e*q*r+f*k*s-e*n*s;c[3]=p*r*u-n*t*u-p*m*v+k*t*v+n*m*y-k*r*y;c[7]=f*t*u-g*r*u+g*m*v-e*t*v-f*m*y+e*r*y;c[11]=g*n*u-f*p*u-g*k*v+e*p*v+f*k*y-e*n*y;c[15]=f*p*m-g*n*m+g*k*r-e*p*r-f*k*t+e*n*t;c=e*c[0]+k*c[4]+m*c[8]+u*c[12];if(0==c){if(b)throw Error("Matrix4.getInverse(): can't invert matrix, determinant is 0");
console.warn("Matrix4.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/c);return this},translate:function(a){console.warn("THREE.Matrix4: .translate() has been removed.")},rotateX:function(a){console.warn("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(a){console.warn("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(a){console.warn("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(a,b){console.warn("THREE.Matrix4: .rotateByAxis() has been removed.")},
scale:function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],Math.max(a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10])))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,
0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,k=e*f,n=e*g;this.set(k*f+c,k*g-d*h,k*h+d*g,0,k*g+d*h,n*g+c,n*h-d*f,0,k*h-d*g,n*h+d*f,e*h*h+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,
0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a=new THREE.Vector3,b=new THREE.Matrix4;return function(c,d,e){var f=this.elements,g=a.set(f[0],f[1],f[2]).length(),h=a.set(f[4],f[5],f[6]).length(),k=a.set(f[8],f[9],f[10]).length();0>this.determinant()&&(g=-g);c.x=f[12];c.y=f[13];c.z=f[14];b.elements.set(this.elements);c=1/g;var f=1/h,n=1/k;b.elements[0]*=c;b.elements[1]*=
c;b.elements[2]*=c;b.elements[4]*=f;b.elements[5]*=f;b.elements[6]*=f;b.elements[8]*=n;b.elements[9]*=n;b.elements[10]*=n;d.setFromRotationMatrix(b);e.x=g;e.y=h;e.z=k;return this}}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements;g[0]=2*e/(b-a);g[4]=0;g[8]=(b+a)/(b-a);g[12]=0;g[1]=0;g[5]=2*e/(d-c);g[9]=(d+c)/(d-c);g[13]=0;g[2]=0;g[6]=0;g[10]=-(f+e)/(f-e);g[14]=-2*f*e/(f-e);g[3]=0;g[7]=0;g[11]=-1;g[15]=0;return this},makePerspective:function(a,b,c,d){a=c*Math.tan(THREE.Math.degToRad(.5*a));
var e=-a;return this.makeFrustum(e*b,a*b,e,a,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=b-a,k=c-d,n=f-e;g[0]=2/h;g[4]=0;g[8]=0;g[12]=-((b+a)/h);g[1]=0;g[5]=2/k;g[9]=0;g[13]=-((c+d)/k);g[2]=0;g[6]=0;g[10]=-2/n;g[14]=-((f+e)/n);g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)}};
THREE.Ray=function(a,b){this.origin=void 0!==a?a:new THREE.Vector3;this.direction=void 0!==b?b:new THREE.Vector3};
THREE.Ray.prototype={constructor:THREE.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){return(b||new THREE.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},recast:function(){var a=new THREE.Vector3;return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(a,b){var c=b||new THREE.Vector3;c.subVectors(a,this.origin);
var d=c.dot(this.direction);return 0>d?c.copy(this.origin):c.copy(this.direction).multiplyScalar(d).add(this.origin)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceTo(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);return a.distanceTo(b)}}(),distanceSqToSegment:function(a,b,c,d){var e=a.clone().add(b).multiplyScalar(.5),f=b.clone().sub(a).normalize(),g=.5*a.distanceTo(b),h=
this.origin.clone().sub(e);a=-this.direction.dot(f);b=h.dot(this.direction);var k=-h.dot(f),n=h.lengthSq(),p=Math.abs(1-a*a),q,m;0<=p?(h=a*k-b,q=a*b-k,m=g*p,0<=h?q>=-m?q<=m?(g=1/p,h*=g,q*=g,a=h*(h+a*q+2*b)+q*(a*h+q+2*k)+n):(q=g,h=Math.max(0,-(a*q+b)),a=-h*h+q*(q+2*k)+n):(q=-g,h=Math.max(0,-(a*q+b)),a=-h*h+q*(q+2*k)+n):q<=-m?(h=Math.max(0,-(-a*g+b)),q=0<h?-g:Math.min(Math.max(-g,-k),g),a=-h*h+q*(q+2*k)+n):q<=m?(h=0,q=Math.min(Math.max(-g,-k),g),a=q*(q+2*k)+n):(h=Math.max(0,-(a*g+b)),q=0<h?g:Math.min(Math.max(-g,
-k),g),a=-h*h+q*(q+2*k)+n)):(q=0<a?-g:g,h=Math.max(0,-(a*q+b)),a=-h*h+q*(q+2*k)+n);c&&c.copy(this.direction.clone().multiplyScalar(h).add(this.origin));d&&d.copy(f.clone().multiplyScalar(q).add(e));return a},isIntersectionSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},intersectSphere:function(){var a=new THREE.Vector3;return function(b,c){a.subVectors(b.center,this.origin);var d=a.dot(this.direction),e=a.dot(a)-d*d,f=b.radius*b.radius;if(e>f)return null;f=Math.sqrt(f-e);e=d-f;
d+=f;return 0>e&&0>d?null:0>e?this.at(d,c):this.at(e,c)}}(),isIntersectionPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0==b)return 0==a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){var c=this.distanceToPlane(a);return null===c?null:this.at(c,b)},isIntersectionBox:function(){var a=new THREE.Vector3;
return function(b){return null!==this.intersectBox(b,a)}}(),intersectBox:function(a,b){var c,d,e,f,g;d=1/this.direction.x;f=1/this.direction.y;g=1/this.direction.z;var h=this.origin;0<=d?(c=(a.min.x-h.x)*d,d*=a.max.x-h.x):(c=(a.max.x-h.x)*d,d*=a.min.x-h.x);0<=f?(e=(a.min.y-h.y)*f,f*=a.max.y-h.y):(e=(a.max.y-h.y)*f,f*=a.min.y-h.y);if(c>f||e>d)return null;if(e>c||c!==c)c=e;if(f<d||d!==d)d=f;0<=g?(e=(a.min.z-h.z)*g,g*=a.max.z-h.z):(e=(a.max.z-h.z)*g,g*=a.min.z-h.z);if(c>g||e>d)return null;if(e>c||c!==
c)c=e;if(g<d||d!==d)d=g;return 0>d?null:this.at(0<=c?c:d,b)},intersectTriangle:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(e,f,g,h,k){b.subVectors(f,e);c.subVectors(g,e);d.crossVectors(b,c);f=this.direction.dot(d);if(0<f){if(h)return null;h=1}else if(0>f)h=-1,f=-f;else return null;a.subVectors(this.origin,e);e=h*this.direction.dot(c.crossVectors(a,c));if(0>e)return null;g=h*this.direction.dot(b.cross(a));if(0>g||e+g>f)return null;
e=-h*a.dot(d);return 0>e?null:this.at(e/f,k)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}};THREE.Sphere=function(a,b){this.center=void 0!==a?a:new THREE.Vector3;this.radius=void 0!==b?b:0};
THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new THREE.Box3;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).center(d);for(var e=0,f=0,g=b.length;f<g;f++)e=Math.max(e,d.distanceToSquared(b[f]));this.radius=Math.sqrt(e);return this}}(),copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=
this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},clampPoint:function(a,b){var c=this.center.distanceToSquared(a),d=b||new THREE.Vector3;d.copy(a);c>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center));return d},getBoundingBox:function(a){a=a||new THREE.Box3;a.set(this.center,this.center);a.expandByScalar(this.radius);
return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}};
THREE.Frustum=function(a,b,c,d,e,f){this.planes=[void 0!==a?a:new THREE.Plane,void 0!==b?b:new THREE.Plane,void 0!==c?c:new THREE.Plane,void 0!==d?d:new THREE.Plane,void 0!==e?e:new THREE.Plane,void 0!==f?f:new THREE.Plane]};
THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(a,b,c,d,e,f){var g=this.planes;g[0].copy(a);g[1].copy(b);g[2].copy(c);g[3].copy(d);g[4].copy(e);g[5].copy(f);return this},copy:function(a){for(var b=this.planes,c=0;6>c;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements;a=c[0];var d=c[1],e=c[2],f=c[3],g=c[4],h=c[5],k=c[6],n=c[7],p=c[8],q=c[9],m=c[10],r=c[11],t=c[12],s=c[13],u=c[14],c=c[15];b[0].setComponents(f-a,n-g,r-p,c-t).normalize();b[1].setComponents(f+
a,n+g,r+p,c+t).normalize();b[2].setComponents(f+d,n+h,r+q,c+s).normalize();b[3].setComponents(f-d,n-h,r-q,c-s).normalize();b[4].setComponents(f-e,n-k,r-m,c-u).normalize();b[5].setComponents(f+e,n+k,r+m,c+u).normalize();return this},intersectsObject:function(){var a=new THREE.Sphere;return function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();a.copy(c.boundingSphere);a.applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSphere:function(a){var b=this.planes,
c=a.center;a=-a.radius;for(var d=0;6>d;d++)if(b[d].distanceToPoint(c)<a)return!1;return!0},intersectsBox:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){for(var d=this.planes,e=0;6>e;e++){var f=d[e];a.x=0<f.normal.x?c.min.x:c.max.x;b.x=0<f.normal.x?c.max.x:c.min.x;a.y=0<f.normal.y?c.min.y:c.max.y;b.y=0<f.normal.y?c.max.y:c.min.y;a.z=0<f.normal.z?c.min.z:c.max.z;b.z=0<f.normal.z?c.max.z:c.min.z;var g=f.distanceToPoint(a),f=f.distanceToPoint(b);if(0>g&&0>f)return!1}return!0}}(),
containsPoint:function(a){for(var b=this.planes,c=0;6>c;c++)if(0>b[c].distanceToPoint(a))return!1;return!0},clone:function(){return(new THREE.Frustum).copy(this)}};THREE.Plane=function(a,b){this.normal=void 0!==a?a:new THREE.Vector3(1,0,0);this.constant=void 0!==b?b:0};
THREE.Plane.prototype={constructor:THREE.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){d=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,
c);return this}}(),copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,
b){var c=this.distanceToPoint(a);return(b||new THREE.Vector3).copy(this.normal).multiplyScalar(c)},isIntersectionLine:function(a){var b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectLine:function(){var a=new THREE.Vector3;return function(b,c){var d=c||new THREE.Vector3,e=b.delta(a),f=this.normal.dot(e);if(0==f){if(0==this.distanceToPoint(b.start))return d.copy(b.start)}else return f=-(b.start.dot(this.normal)+this.constant)/f,0>f||1<f?void 0:d.copy(e).multiplyScalar(f).add(b.start)}}(),
coplanarPoint:function(a){return(a||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(d,e){var f=e||c.getNormalMatrix(d),f=a.copy(this.normal).applyMatrix3(f),g=this.coplanarPoint(b);g.applyMatrix4(d);this.setFromNormalAndCoplanarPoint(f,g);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&
a.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}};
THREE.Math={generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),b=Array(36),c=0,d;return function(){for(var e=0;36>e;e++)8==e||13==e||18==e||23==e?b[e]="-":14==e?b[e]="4":(2>=c&&(c=33554432+16777216*Math.random()|0),d=c&15,c>>=4,b[e]=a[19==e?d&3|8:d]);return b.join("")}}(),clamp:function(a,b,c){return a<b?b:a>c?c:a},clampBottom:function(a,b){return a<b?b:a},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){if(a<=
b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(){var a=Math.PI/180;return function(b){return b*a}}(),radToDeg:function(){var a=
180/Math.PI;return function(b){return b*a}}(),isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a}};
THREE.Spline=function(a){function b(a,b,c,d,e,f,g){a=.5*(c-a);d=.5*(d-b);return(2*(b-c)+a+d)*g+(-3*(b-c)-2*a-d)*f+a*e+b}this.points=a;var c=[],d={x:0,y:0,z:0},e,f,g,h,k,n,p,q,m;this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}};this.getPoint=function(a){e=(this.points.length-1)*a;f=Math.floor(e);g=e-f;c[0]=0===f?f:f-1;c[1]=f;c[2]=f>this.points.length-2?this.points.length-1:f+1;c[3]=f>this.points.length-3?this.points.length-1:f+
2;n=this.points[c[0]];p=this.points[c[1]];q=this.points[c[2]];m=this.points[c[3]];h=g*g;k=g*h;d.x=b(n.x,p.x,q.x,m.x,g,h,k);d.y=b(n.y,p.y,q.y,m.y,g,h,k);d.z=b(n.z,p.z,q.z,m.z,g,h,k);return d};this.getControlPointsArray=function(){var a,b,c=this.points.length,d=[];for(a=0;a<c;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return d};this.getLength=function(a){var b,c,d,e=b=b=0,f=new THREE.Vector3,g=new THREE.Vector3,h=[],k=0;h[0]=0;a||(a=100);c=this.points.length*a;f.copy(this.points[0]);for(a=1;a<c;a++)b=
a/c,d=this.getPoint(b),g.copy(d),k+=g.distanceTo(f),f.copy(d),b*=this.points.length-1,b=Math.floor(b),b!=e&&(h[b]=k,e=b);h[h.length]=k;return{chunks:h,total:k}};this.reparametrizeByArcLength=function(a){var b,c,d,e,f,g,h=[],k=new THREE.Vector3,m=this.getLength();h.push(k.copy(this.points[0]).clone());for(b=1;b<this.points.length;b++){c=m.chunks[b]-m.chunks[b-1];g=Math.ceil(a*c/m.total);e=(b-1)/(this.points.length-1);f=b/(this.points.length-1);for(c=1;c<g-1;c++)d=e+1/g*c*(f-e),d=this.getPoint(d),h.push(k.copy(d).clone());
h.push(k.copy(this.points[b]).clone())}this.points=h}};THREE.Triangle=function(a,b,c){this.a=void 0!==a?a:new THREE.Vector3;this.b=void 0!==b?b:new THREE.Vector3;this.c=void 0!==c?c:new THREE.Vector3};THREE.Triangle.normal=function(){var a=new THREE.Vector3;return function(b,c,d,e){e=e||new THREE.Vector3;e.subVectors(d,c);a.subVectors(b,c);e.cross(a);b=e.lengthSq();return 0<b?e.multiplyScalar(1/Math.sqrt(b)):e.set(0,0,0)}}();
THREE.Triangle.barycoordFromPoint=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f,g,h){a.subVectors(g,e);b.subVectors(f,e);c.subVectors(d,e);d=a.dot(a);e=a.dot(b);f=a.dot(c);var k=b.dot(b);g=b.dot(c);var n=d*k-e*e;h=h||new THREE.Vector3;if(0==n)return h.set(-2,-1,-1);n=1/n;k=(k*f-e*g)*n;d=(d*g-e*f)*n;return h.set(1-k-d,d,k)}}();
THREE.Triangle.containsPoint=function(){var a=new THREE.Vector3;return function(b,c,d,e){b=THREE.Triangle.barycoordFromPoint(b,c,d,e,a);return 0<=b.x&&0<=b.y&&1>=b.x+b.y}}();
THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,this.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||
new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return THREE.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return THREE.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return THREE.Triangle.containsPoint(a,this.a,this.b,this.c)},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)},
clone:function(){return(new THREE.Triangle).copy(this)}};THREE.Clock=function(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};
THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),
a=.001*(b-this.oldTime);this.oldTime=b;this.elapsedTime+=a}return a}};THREE.EventDispatcher=function(){};
THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(a){a.addEventListener=THREE.EventDispatcher.prototype.addEventListener;a.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;a.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;a.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&
c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){if(void 0!==this._listeners){var c=this._listeners[a];if(void 0!==c){var d=c.indexOf(b);-1!==d&&c.splice(d,1)}}},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;for(var c=[],d=b.length,e=0;e<d;e++)c[e]=b[e];for(e=0;e<d;e++)c[e].call(this,a)}}}};
(function(a){a.Raycaster=function(b,c,f,g){this.ray=new a.Ray(b,c);this.near=f||0;this.far=g||Infinity;this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var b=function(a,b){return a.distance-b.distance},c=function(a,b,f,g){a.raycast(b,f);if(!0===g){a=a.children;g=0;for(var h=a.length;g<h;g++)c(a[g],b,f,!0)}};a.Raycaster.prototype={constructor:a.Raycaster,precision:1E-4,linePrecision:1,set:function(a,b){this.ray.set(a,b)},intersectObject:function(a,e){var f=[];c(a,this,f,e);
f.sort(b);return f},intersectObjects:function(a,e){var f=[];if(!1===a instanceof Array)return console.log("THREE.Raycaster.intersectObjects: objects is not an Array."),f;for(var g=0,h=a.length;g<h;g++)c(a[g],this,f,e);f.sort(b);return f}}})(THREE);
THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Object3D";this.parent=void 0;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var a=new THREE.Vector3,b=new THREE.Euler,c=new THREE.Quaternion,d=new THREE.Vector3(1,1,1);b.onChange(function(){c.setFromEuler(b,!1)});c.onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,
value:b},quaternion:{enumerable:!0,value:c},scale:{enumerable:!0,value:d}});this.renderDepth=null;this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.userData={}};THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);
THREE.Object3D.prototype={constructor:THREE.Object3D,get eulerOrder(){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");return this.rotation.order},set eulerOrder(a){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");this.rotation.order=a},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(a){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},
applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=new THREE.Quaternion;return function(b,c){a.setFromAxisAngle(b,
c);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new THREE.Vector3;return function(b,c){a.copy(b).applyQuaternion(this.quaternion);this.position.add(a.multiplyScalar(c));
return this}}(),translate:function(a,b){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(b,a)},translateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,
b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new THREE.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new THREE.Matrix4;return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a===this)return console.error("THREE.Object3D.add:",
a,"can't be added as a child of itself."),this;a instanceof THREE.Object3D?(void 0!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):console.error("THREE.Object3D.add:",a,"is not an instance of THREE.Object3D.");return this},remove:function(a){if(1<arguments.length)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);b=this.children.indexOf(a);-1!==b&&(a.parent=void 0,a.dispatchEvent({type:"removed"}),this.children.splice(b,1))},getChildByName:function(a,
b){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(a,b)},getObjectById:function(a,b){if(this.id===a)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c].getObjectById(a,b);if(void 0!==e)return e}},getObjectByName:function(a,b){if(this.name===a)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c].getObjectByName(a,b);if(void 0!==e)return e}},getWorldPosition:function(a){a=a||new THREE.Vector3;
this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){c=c||new THREE.Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,b);return c}}(),getWorldRotation:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Euler;this.getWorldQuaternion(a);return b.setFromQuaternion(a,this.rotation.order,!1)}}(),getWorldScale:function(){var a=new THREE.Vector3,b=new THREE.Quaternion;
return function(c){c=c||new THREE.Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,b,c);return c}}(),getWorldDirection:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var b=0,c=this.children.length;b<
c;b++)this.children[b].traverseVisible(a)}},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},
toJSON:function(){var a={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}},b={},c=function(c){void 0===a.geometries&&(a.geometries=[]);if(void 0===b[c.uuid]){var d=c.toJSON();delete d.metadata;b[c.uuid]=d;a.geometries.push(d)}return c.uuid},d={},e=function(b){void 0===a.materials&&(a.materials=[]);if(void 0===d[b.uuid]){var c=b.toJSON();delete c.metadata;d[b.uuid]=c;a.materials.push(c)}return b.uuid},f=function(a){var b={};b.uuid=a.uuid;b.type=a.type;""!==a.name&&(b.name=a.name);"{}"!==
JSON.stringify(a.userData)&&(b.userData=a.userData);!0!==a.visible&&(b.visible=a.visible);a instanceof THREE.PerspectiveCamera?(b.fov=a.fov,b.aspect=a.aspect,b.near=a.near,b.far=a.far):a instanceof THREE.OrthographicCamera?(b.left=a.left,b.right=a.right,b.top=a.top,b.bottom=a.bottom,b.near=a.near,b.far=a.far):a instanceof THREE.AmbientLight?b.color=a.color.getHex():a instanceof THREE.DirectionalLight?(b.color=a.color.getHex(),b.intensity=a.intensity):a instanceof THREE.PointLight?(b.color=a.color.getHex(),
b.intensity=a.intensity,b.distance=a.distance):a instanceof THREE.SpotLight?(b.color=a.color.getHex(),b.intensity=a.intensity,b.distance=a.distance,b.angle=a.angle,b.exponent=a.exponent):a instanceof THREE.HemisphereLight?(b.color=a.color.getHex(),b.groundColor=a.groundColor.getHex()):a instanceof THREE.Mesh?(b.geometry=c(a.geometry),b.material=e(a.material)):a instanceof THREE.Line?(b.geometry=c(a.geometry),b.material=e(a.material)):a instanceof THREE.Sprite&&(b.material=e(a.material));b.matrix=
a.matrix.toArray();if(0<a.children.length){b.children=[];for(var d=0;d<a.children.length;d++)b.children.push(f(a.children[d]))}return b};a.object=f(this);return a},clone:function(a,b){void 0===a&&(a=new THREE.Object3D);void 0===b&&(b=!0);a.name=this.name;a.up.copy(this.up);a.position.copy(this.position);a.quaternion.copy(this.quaternion);a.scale.copy(this.scale);a.renderDepth=this.renderDepth;a.rotationAutoUpdate=this.rotationAutoUpdate;a.matrix.copy(this.matrix);a.matrixWorld.copy(this.matrixWorld);
a.matrixAutoUpdate=this.matrixAutoUpdate;a.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;a.visible=this.visible;a.castShadow=this.castShadow;a.receiveShadow=this.receiveShadow;a.frustumCulled=this.frustumCulled;a.userData=JSON.parse(JSON.stringify(this.userData));if(!0===b)for(var c=0;c<this.children.length;c++)a.add(this.children[c].clone());return a}};THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);THREE.Object3DIdCount=0;
THREE.Projector=function(){console.warn("THREE.Projector has been moved to /examples/renderers/Projector.js.");this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() has been removed.")}};
THREE.Face3=function(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=d instanceof Array?d:[];this.color=e instanceof THREE.Color?e:new THREE.Color;this.vertexColors=e instanceof Array?e:[];this.vertexTangents=[];this.materialIndex=void 0!==f?f:0};
THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var a=new THREE.Face3(this.a,this.b,this.c);a.normal.copy(this.normal);a.color.copy(this.color);a.materialIndex=this.materialIndex;for(var b=0,c=this.vertexNormals.length;b<c;b++)a.vertexNormals[b]=this.vertexNormals[b].clone();b=0;for(c=this.vertexColors.length;b<c;b++)a.vertexColors[b]=this.vertexColors[b].clone();b=0;for(c=this.vertexTangents.length;b<c;b++)a.vertexTangents[b]=this.vertexTangents[b].clone();return a}};
THREE.Face4=function(a,b,c,d,e,f,g){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new THREE.Face3(a,b,c,e,f,g)};THREE.BufferAttribute=function(a,b){this.array=a;this.itemSize=b;this.needsUpdate=!1};
THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d]},set:function(a){this.array.set(a);return this},setX:function(a,b){this.array[a*this.itemSize]=b;return this},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},setXY:function(a,b,c){a*=this.itemSize;
this.array[a]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;this.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=e;return this},clone:function(){return new THREE.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}};
THREE.Int8Attribute=function(a,b){console.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(a,b)};THREE.Uint8Attribute=function(a,b){console.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(a,b)};
THREE.Uint8ClampedAttribute=function(a,b){console.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(a,b)};THREE.Int16Attribute=function(a,b){console.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(a,b)};
THREE.Uint16Attribute=function(a,b){console.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(a,b)};THREE.Int32Attribute=function(a,b){console.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(a,b)};
THREE.Uint32Attribute=function(a,b){console.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(a,b)};THREE.Float32Attribute=function(a,b){console.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(a,b)};
THREE.Float64Attribute=function(a,b){console.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(a,b)};THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="BufferGeometry";this.attributes={};this.attributesKeys=[];this.offsets=this.drawcalls=[];this.boundingSphere=this.boundingBox=null};
THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(a,b,c){!1===b instanceof THREE.BufferAttribute?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.attributes[a]={array:b,itemSize:c}):(this.attributes[a]=b,this.attributesKeys=Object.keys(this.attributes))},getAttribute:function(a){return this.attributes[a]},addDrawCall:function(a,b,c){this.drawcalls.push({start:a,count:b,index:void 0!==c?c:0})},applyMatrix:function(a){var b=
this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0);b=this.attributes.normal;void 0!==b&&((new THREE.Matrix3).getNormalMatrix(a).applyToVector3Array(b.array),b.needsUpdate=!0)},center:function(){},fromGeometry:function(a,b){b=b||{vertexColors:THREE.NoColors};var c=a.vertices,d=a.faces,e=a.faceVertexUvs,f=b.vertexColors,g=0<e[0].length,h=3==d[0].vertexNormals.length,k=new Float32Array(9*d.length);this.addAttribute("position",new THREE.BufferAttribute(k,3));var n=
new Float32Array(9*d.length);this.addAttribute("normal",new THREE.BufferAttribute(n,3));if(f!==THREE.NoColors){var p=new Float32Array(9*d.length);this.addAttribute("color",new THREE.BufferAttribute(p,3))}if(!0===g){var q=new Float32Array(6*d.length);this.addAttribute("uv",new THREE.BufferAttribute(q,2))}for(var m=0,r=0,t=0;m<d.length;m++,r+=6,t+=9){var s=d[m],u=c[s.a],v=c[s.b],y=c[s.c];k[t]=u.x;k[t+1]=u.y;k[t+2]=u.z;k[t+3]=v.x;k[t+4]=v.y;k[t+5]=v.z;k[t+6]=y.x;k[t+7]=y.y;k[t+8]=y.z;!0===h?(u=s.vertexNormals[0],
v=s.vertexNormals[1],y=s.vertexNormals[2],n[t]=u.x,n[t+1]=u.y,n[t+2]=u.z,n[t+3]=v.x,n[t+4]=v.y,n[t+5]=v.z,n[t+6]=y.x,n[t+7]=y.y,n[t+8]=y.z):(u=s.normal,n[t]=u.x,n[t+1]=u.y,n[t+2]=u.z,n[t+3]=u.x,n[t+4]=u.y,n[t+5]=u.z,n[t+6]=u.x,n[t+7]=u.y,n[t+8]=u.z);f===THREE.FaceColors?(s=s.color,p[t]=s.r,p[t+1]=s.g,p[t+2]=s.b,p[t+3]=s.r,p[t+4]=s.g,p[t+5]=s.b,p[t+6]=s.r,p[t+7]=s.g,p[t+8]=s.b):f===THREE.VertexColors&&(u=s.vertexColors[0],v=s.vertexColors[1],s=s.vertexColors[2],p[t]=u.r,p[t+1]=u.g,p[t+2]=u.b,p[t+3]=
v.r,p[t+4]=v.g,p[t+5]=v.b,p[t+6]=s.r,p[t+7]=s.g,p[t+8]=s.b);!0===g&&(s=e[0][m][0],u=e[0][m][1],v=e[0][m][2],q[r]=s.x,q[r+1]=s.y,q[r+2]=u.x,q[r+3]=u.y,q[r+4]=v.x,q[r+5]=v.y)}this.computeBoundingSphere();return this},computeBoundingBox:function(){var a=new THREE.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var b=this.attributes.position.array;if(b){var c=this.boundingBox;c.makeEmpty();for(var d=0,e=b.length;d<e;d+=3)a.set(b[d],b[d+1],b[d+2]),c.expandByPoint(a)}if(void 0===
b||0===b.length)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0);(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var a=new THREE.Box3,b=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var c=this.attributes.position.array;
if(c){a.makeEmpty();for(var d=this.boundingSphere.center,e=0,f=c.length;e<f;e+=3)b.set(c[e],c[e+1],c[e+2]),a.expandByPoint(b);a.center(d);for(var g=0,e=0,f=c.length;e<f;e+=3)b.set(c[e],c[e+1],c[e+2]),g=Math.max(g,d.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(g);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var a=
this.attributes;if(a.position){var b=a.position.array;if(void 0===a.normal)this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(b.length),3));else for(var c=a.normal.array,d=0,e=c.length;d<e;d++)c[d]=0;var c=a.normal.array,f,g,h,k=new THREE.Vector3,n=new THREE.Vector3,p=new THREE.Vector3,q=new THREE.Vector3,m=new THREE.Vector3;if(a.index)for(var r=a.index.array,t=0<this.offsets.length?this.offsets:[{start:0,count:r.length,index:0}],s=0,u=t.length;s<u;++s){e=t[s].start;f=t[s].count;
for(var v=t[s].index,d=e,e=e+f;d<e;d+=3)f=3*(v+r[d]),g=3*(v+r[d+1]),h=3*(v+r[d+2]),k.fromArray(b,f),n.fromArray(b,g),p.fromArray(b,h),q.subVectors(p,n),m.subVectors(k,n),q.cross(m),c[f]+=q.x,c[f+1]+=q.y,c[f+2]+=q.z,c[g]+=q.x,c[g+1]+=q.y,c[g+2]+=q.z,c[h]+=q.x,c[h+1]+=q.y,c[h+2]+=q.z}else for(d=0,e=b.length;d<e;d+=9)k.fromArray(b,d),n.fromArray(b,d+3),p.fromArray(b,d+6),q.subVectors(p,n),m.subVectors(k,n),q.cross(m),c[d]=q.x,c[d+1]=q.y,c[d+2]=q.z,c[d+3]=q.x,c[d+4]=q.y,c[d+5]=q.z,c[d+6]=q.x,c[d+7]=q.y,
c[d+8]=q.z;this.normalizeNormals();a.normal.needsUpdate=!0}},computeTangents:function(){function a(a,b,c){q.fromArray(d,3*a);m.fromArray(d,3*b);r.fromArray(d,3*c);t.fromArray(f,2*a);s.fromArray(f,2*b);u.fromArray(f,2*c);v=m.x-q.x;y=r.x-q.x;G=m.y-q.y;w=r.y-q.y;K=m.z-q.z;x=r.z-q.z;D=s.x-t.x;E=u.x-t.x;A=s.y-t.y;B=u.y-t.y;F=1/(D*B-E*A);R.set((B*v-A*y)*F,(B*G-A*w)*F,(B*K-A*x)*F);H.set((D*y-E*v)*F,(D*w-E*G)*F,(D*x-E*K)*F);k[a].add(R);k[b].add(R);k[c].add(R);n[a].add(H);n[b].add(H);n[c].add(H)}function b(a){ya.fromArray(e,
3*a);P.copy(ya);Fa=k[a];la.copy(Fa);la.sub(ya.multiplyScalar(ya.dot(Fa))).normalize();ma.crossVectors(P,Fa);za=ma.dot(n[a]);Ga=0>za?-1:1;h[4*a]=la.x;h[4*a+1]=la.y;h[4*a+2]=la.z;h[4*a+3]=Ga}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");else{var c=this.attributes.index.array,d=this.attributes.position.array,
e=this.attributes.normal.array,f=this.attributes.uv.array,g=d.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*g),4));for(var h=this.attributes.tangent.array,k=[],n=[],p=0;p<g;p++)k[p]=new THREE.Vector3,n[p]=new THREE.Vector3;var q=new THREE.Vector3,m=new THREE.Vector3,r=new THREE.Vector3,t=new THREE.Vector2,s=new THREE.Vector2,u=new THREE.Vector2,v,y,G,w,K,x,D,E,A,B,F,R=new THREE.Vector3,H=new THREE.Vector3,C,T,Q,O,S;0===this.drawcalls.length&&
this.addDrawCall(0,c.length,0);var X=this.drawcalls,p=0;for(T=X.length;p<T;++p){C=X[p].start;Q=X[p].count;var Y=X[p].index,g=C;for(C+=Q;g<C;g+=3)Q=Y+c[g],O=Y+c[g+1],S=Y+c[g+2],a(Q,O,S)}var la=new THREE.Vector3,ma=new THREE.Vector3,ya=new THREE.Vector3,P=new THREE.Vector3,Ga,Fa,za,p=0;for(T=X.length;p<T;++p)for(C=X[p].start,Q=X[p].count,Y=X[p].index,g=C,C+=Q;g<C;g+=3)Q=Y+c[g],O=Y+c[g+1],S=Y+c[g+2],b(Q),b(O),b(S)}},computeOffsets:function(a){var b=a;void 0===a&&(b=65535);Date.now();a=this.attributes.index.array;
for(var c=this.attributes.position.array,d=a.length/3,e=new Uint16Array(a.length),f=0,g=0,h=[{start:0,count:0,index:0}],k=h[0],n=0,p=0,q=new Int32Array(6),m=new Int32Array(c.length),r=new Int32Array(c.length),t=0;t<c.length;t++)m[t]=-1,r[t]=-1;for(c=0;c<d;c++){for(var s=p=0;3>s;s++)t=a[3*c+s],-1==m[t]?(q[2*s]=t,q[2*s+1]=-1,p++):m[t]<k.index?(q[2*s]=t,q[2*s+1]=-1,n++):(q[2*s]=t,q[2*s+1]=m[t]);if(g+p>k.index+b)for(k={start:f,count:0,index:g},h.push(k),p=0;6>p;p+=2)s=q[p+1],-1<s&&s<k.index&&(q[p+1]=
-1);for(p=0;6>p;p+=2)t=q[p],s=q[p+1],-1===s&&(s=g++),m[t]=s,r[s]=t,e[f++]=s-k.index,k.count++}this.reorderBuffers(e,r,g);return this.offsets=h},merge:function(){console.log("BufferGeometry.merge(): TODO")},normalizeNormals:function(){for(var a=this.attributes.normal.array,b,c,d,e=0,f=a.length;e<f;e+=3)b=a[e],c=a[e+1],d=a[e+2],b=1/Math.sqrt(b*b+c*c+d*d),a[e]*=b,a[e+1]*=b,a[e+2]*=b},reorderBuffers:function(a,b,c){var d={},e;for(e in this.attributes)"index"!=e&&(d[e]=new this.attributes[e].array.constructor(this.attributes[e].itemSize*
c));for(var f=0;f<c;f++){var g=b[f];for(e in this.attributes)if("index"!=e)for(var h=this.attributes[e].array,k=this.attributes[e].itemSize,n=d[e],p=0;p<k;p++)n[f*k+p]=h[g*k+p]}this.attributes.index.array=a;for(e in this.attributes)"index"!=e&&(this.attributes[e].array=d[e],this.attributes[e].numItems=this.attributes[e].itemSize*c)},toJSON:function(){var a={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}},b=this.attributes,
c=this.offsets,d=this.boundingSphere,e;for(e in b){for(var f=b[e],g=[],h=f.array,k=0,n=h.length;k<n;k++)g[k]=h[k];a.data.attributes[e]={itemSize:f.itemSize,type:f.array.constructor.name,array:g}}0<c.length&&(a.data.offsets=JSON.parse(JSON.stringify(c)));null!==d&&(a.data.boundingSphere={center:d.center.toArray(),radius:d.radius});return a},clone:function(){var a=new THREE.BufferGeometry,b;for(b in this.attributes)a.addAttribute(b,this.attributes[b].clone());b=0;for(var c=this.offsets.length;b<c;b++){var d=
this.offsets[b];a.offsets.push({start:d.start,index:d.index,count:d.count})}return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);
THREE.Geometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.hasTangents=!1;this.dynamic=!0;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=
this.tangentsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!1};
THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(a){for(var b=(new THREE.Matrix3).getNormalMatrix(a),c=0,d=this.vertices.length;c<d;c++)this.vertices[c].applyMatrix4(a);c=0;for(d=this.faces.length;c<d;c++){a=this.faces[c];a.normal.applyMatrix3(b).normalize();for(var e=0,f=a.vertexNormals.length;e<f;e++)a.vertexNormals[e].applyMatrix3(b).normalize()}this.boundingBox instanceof THREE.Box3&&this.computeBoundingBox();this.boundingSphere instanceof THREE.Sphere&&this.computeBoundingSphere()},
fromBufferGeometry:function(a){for(var b=this,c=a.attributes,d=c.position.array,e=void 0!==c.index?c.index.array:void 0,f=void 0!==c.normal?c.normal.array:void 0,g=void 0!==c.color?c.color.array:void 0,h=void 0!==c.uv?c.uv.array:void 0,k=[],n=[],p=c=0;c<d.length;c+=3,p+=2)b.vertices.push(new THREE.Vector3(d[c],d[c+1],d[c+2])),void 0!==f&&k.push(new THREE.Vector3(f[c],f[c+1],f[c+2])),void 0!==g&&b.colors.push(new THREE.Color(g[c],g[c+1],g[c+2])),void 0!==h&&n.push(new THREE.Vector2(h[p],h[p+1]));h=
function(a,c,d){var e=void 0!==f?[k[a].clone(),k[c].clone(),k[d].clone()]:[],h=void 0!==g?[b.colors[a].clone(),b.colors[c].clone(),b.colors[d].clone()]:[];b.faces.push(new THREE.Face3(a,c,d,e,h));b.faceVertexUvs[0].push([n[a],n[c],n[d]])};if(void 0!==e)for(c=0;c<e.length;c+=3)h(e[c],e[c+1],e[c+2]);else for(c=0;c<d.length/3;c+=3)h(c,c+1,c+2);this.computeFaceNormals();null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());
return this},center:function(){this.computeBoundingBox();var a=new THREE.Vector3;a.addVectors(this.boundingBox.min,this.boundingBox.max);a.multiplyScalar(-.5);this.applyMatrix((new THREE.Matrix4).makeTranslation(a.x,a.y,a.z));this.computeBoundingBox();return a},computeFaceNormals:function(){for(var a=new THREE.Vector3,b=new THREE.Vector3,c=0,d=this.faces.length;c<d;c++){var e=this.faces[c],f=this.vertices[e.a],g=this.vertices[e.b];a.subVectors(this.vertices[e.c],g);b.subVectors(f,g);a.cross(b);a.normalize();
e.normal.copy(a)}},computeVertexNormals:function(a){var b,c,d;d=Array(this.vertices.length);b=0;for(c=this.vertices.length;b<c;b++)d[b]=new THREE.Vector3;if(a){var e,f,g,h=new THREE.Vector3,k=new THREE.Vector3;new THREE.Vector3;new THREE.Vector3;new THREE.Vector3;a=0;for(b=this.faces.length;a<b;a++)c=this.faces[a],e=this.vertices[c.a],f=this.vertices[c.b],g=this.vertices[c.c],h.subVectors(g,f),k.subVectors(e,f),h.cross(k),d[c.a].add(h),d[c.b].add(h),d[c.c].add(h)}else for(a=0,b=this.faces.length;a<
b;a++)c=this.faces[a],d[c.a].add(c.normal),d[c.b].add(c.normal),d[c.c].add(c.normal);b=0;for(c=this.vertices.length;b<c;b++)d[b].normalize();a=0;for(b=this.faces.length;a<b;a++)c=this.faces[a],c.vertexNormals[0]=d[c.a].clone(),c.vertexNormals[1]=d[c.b].clone(),c.vertexNormals[2]=d[c.c].clone()},computeMorphNormals:function(){var a,b,c,d,e;c=0;for(d=this.faces.length;c<d;c++)for(e=this.faces[c],e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||
(e.__originalVertexNormals=[]),a=0,b=e.vertexNormals.length;a<b;a++)e.__originalVertexNormals[a]?e.__originalVertexNormals[a].copy(e.vertexNormals[a]):e.__originalVertexNormals[a]=e.vertexNormals[a].clone();var f=new THREE.Geometry;f.faces=this.faces;a=0;for(b=this.morphTargets.length;a<b;a++){if(!this.morphNormals[a]){this.morphNormals[a]={};this.morphNormals[a].faceNormals=[];this.morphNormals[a].vertexNormals=[];e=this.morphNormals[a].faceNormals;var g=this.morphNormals[a].vertexNormals,h,k;c=
0;for(d=this.faces.length;c<d;c++)h=new THREE.Vector3,k={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3},e.push(h),g.push(k)}g=this.morphNormals[a];f.vertices=this.morphTargets[a].vertices;f.computeFaceNormals();f.computeVertexNormals();c=0;for(d=this.faces.length;c<d;c++)e=this.faces[c],h=g.faceNormals[c],k=g.vertexNormals[c],h.copy(e.normal),k.a.copy(e.vertexNormals[0]),k.b.copy(e.vertexNormals[1]),k.c.copy(e.vertexNormals[2])}c=0;for(d=this.faces.length;c<d;c++)e=this.faces[c],e.normal=
e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals},computeTangents:function(){var a,b,c,d,e,f,g,h,k,n,p,q,m,r,t,s,u,v=[],y=[];c=new THREE.Vector3;var G=new THREE.Vector3,w=new THREE.Vector3,K=new THREE.Vector3,x=new THREE.Vector3;a=0;for(b=this.vertices.length;a<b;a++)v[a]=new THREE.Vector3,y[a]=new THREE.Vector3;a=0;for(b=this.faces.length;a<b;a++)e=this.faces[a],f=this.faceVertexUvs[0][a],d=e.a,u=e.b,e=e.c,g=this.vertices[d],h=this.vertices[u],k=this.vertices[e],n=f[0],p=f[1],q=f[2],
f=h.x-g.x,m=k.x-g.x,r=h.y-g.y,t=k.y-g.y,h=h.z-g.z,g=k.z-g.z,k=p.x-n.x,s=q.x-n.x,p=p.y-n.y,n=q.y-n.y,q=1/(k*n-s*p),c.set((n*f-p*m)*q,(n*r-p*t)*q,(n*h-p*g)*q),G.set((k*m-s*f)*q,(k*t-s*r)*q,(k*g-s*h)*q),v[d].add(c),v[u].add(c),v[e].add(c),y[d].add(G),y[u].add(G),y[e].add(G);G=["a","b","c","d"];a=0;for(b=this.faces.length;a<b;a++)for(e=this.faces[a],c=0;c<Math.min(e.vertexNormals.length,3);c++)x.copy(e.vertexNormals[c]),d=e[G[c]],u=v[d],w.copy(u),w.sub(x.multiplyScalar(x.dot(u))).normalize(),K.crossVectors(e.vertexNormals[c],
u),d=K.dot(y[d]),d=0>d?-1:1,e.vertexTangents[c]=new THREE.Vector4(w.x,w.y,w.z,d);this.hasTangents=!0},computeLineDistances:function(){for(var a=0,b=this.vertices,c=0,d=b.length;c<d;c++)0<c&&(a+=b[c].distanceTo(b[c-1])),this.lineDistances[c]=a},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);this.boundingSphere.setFromPoints(this.vertices)},
merge:function(a,b,c){if(!1===a instanceof THREE.Geometry)console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",a);else{var d,e=this.vertices.length,f=this.vertices,g=a.vertices,h=this.faces,k=a.faces,n=this.faceVertexUvs[0];a=a.faceVertexUvs[0];void 0===c&&(c=0);void 0!==b&&(d=(new THREE.Matrix3).getNormalMatrix(b));for(var p=0,q=g.length;p<q;p++){var m=g[p].clone();void 0!==b&&m.applyMatrix4(b);f.push(m)}p=0;for(q=k.length;p<q;p++){var g=k[p],r,t=g.vertexNormals,s=
g.vertexColors,m=new THREE.Face3(g.a+e,g.b+e,g.c+e);m.normal.copy(g.normal);void 0!==d&&m.normal.applyMatrix3(d).normalize();b=0;for(f=t.length;b<f;b++)r=t[b].clone(),void 0!==d&&r.applyMatrix3(d).normalize(),m.vertexNormals.push(r);m.color.copy(g.color);b=0;for(f=s.length;b<f;b++)r=s[b],m.vertexColors.push(r.clone());m.materialIndex=g.materialIndex+c;h.push(m)}p=0;for(q=a.length;p<q;p++)if(c=a[p],d=[],void 0!==c){b=0;for(f=c.length;b<f;b++)d.push(new THREE.Vector2(c[b].x,c[b].y));n.push(d)}}},mergeVertices:function(){var a=
{},b=[],c=[],d,e=Math.pow(10,4),f,g;f=0;for(g=this.vertices.length;f<g;f++)d=this.vertices[f],d=Math.round(d.x*e)+"_"+Math.round(d.y*e)+"_"+Math.round(d.z*e),void 0===a[d]?(a[d]=f,b.push(this.vertices[f]),c[f]=b.length-1):c[f]=c[a[d]];a=[];f=0;for(g=this.faces.length;f<g;f++)for(e=this.faces[f],e.a=c[e.a],e.b=c[e.b],e.c=c[e.c],e=[e.a,e.b,e.c],d=0;3>d;d++)if(e[d]==e[(d+1)%3]){a.push(f);break}for(f=a.length-1;0<=f;f--)for(e=a[f],this.faces.splice(e,1),c=0,g=this.faceVertexUvs.length;c<g;c++)this.faceVertexUvs[c].splice(e,
1);f=this.vertices.length-b.length;this.vertices=b;return f},toJSON:function(){function a(a,b,c){return c?a|1<<b:a&~(1<<b)}function b(a){var b=a.x.toString()+a.y.toString()+a.z.toString();if(void 0!==n[b])return n[b];n[b]=k.length/3;k.push(a.x,a.y,a.z);return n[b]}function c(a){var b=a.r.toString()+a.g.toString()+a.b.toString();if(void 0!==q[b])return q[b];q[b]=p.length;p.push(a.getHex());return q[b]}function d(a){var b=a.x.toString()+a.y.toString();if(void 0!==r[b])return r[b];r[b]=m.length/2;m.push(a.x,
a.y);return r[b]}var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};""!==this.name&&(e.name=this.name);if(void 0!==this.parameters){var f=this.parameters,g;for(g in f)void 0!==f[g]&&(e[g]=f[g]);return e}f=[];for(g=0;g<this.vertices.length;g++){var h=this.vertices[g];f.push(h.x,h.y,h.z)}var h=[],k=[],n={},p=[],q={},m=[],r={};for(g=0;g<this.faces.length;g++){var t=this.faces[g],s=void 0!==this.faceVertexUvs[0][g],u=0<t.normal.length(),
v=0<t.vertexNormals.length,y=1!==t.color.r||1!==t.color.g||1!==t.color.b,G=0<t.vertexColors.length,w=0,w=a(w,0,0),w=a(w,1,!1),w=a(w,2,!1),w=a(w,3,s),w=a(w,4,u),w=a(w,5,v),w=a(w,6,y),w=a(w,7,G);h.push(w);h.push(t.a,t.b,t.c);s&&(s=this.faceVertexUvs[0][g],h.push(d(s[0]),d(s[1]),d(s[2])));u&&h.push(b(t.normal));v&&(u=t.vertexNormals,h.push(b(u[0]),b(u[1]),b(u[2])));y&&h.push(c(t.color));G&&(t=t.vertexColors,h.push(c(t[0]),c(t[1]),c(t[2])))}e.data={};e.data.vertices=f;e.data.normals=k;0<p.length&&(e.data.colors=
p);0<m.length&&(e.data.uvs=[m]);e.data.faces=h;return e},clone:function(){for(var a=new THREE.Geometry,b=this.vertices,c=0,d=b.length;c<d;c++)a.vertices.push(b[c].clone());b=this.faces;c=0;for(d=b.length;c<d;c++)a.faces.push(b[c].clone());b=this.faceVertexUvs[0];c=0;for(d=b.length;c<d;c++){for(var e=b[c],f=[],g=0,h=e.length;g<h;g++)f.push(new THREE.Vector2(e[g].x,e[g].y));a.faceVertexUvs[0].push(f)}return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);
THREE.GeometryIdCount=0;THREE.Camera=function(){THREE.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.getWorldDirection=function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,-1).applyQuaternion(a)}}();
THREE.Camera.prototype.lookAt=function(){var a=new THREE.Matrix4;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();THREE.Camera.prototype.clone=function(a){void 0===a&&(a=new THREE.Camera);THREE.Object3D.prototype.clone.call(this,a);a.matrixWorldInverse.copy(this.matrixWorldInverse);a.projectionMatrix.copy(this.projectionMatrix);return a};
THREE.CubeCamera=function(a,b,c){THREE.Object3D.call(this);this.type="CubeCamera";var d=new THREE.PerspectiveCamera(90,1,a,b);d.up.set(0,-1,0);d.lookAt(new THREE.Vector3(1,0,0));this.add(d);var e=new THREE.PerspectiveCamera(90,1,a,b);e.up.set(0,-1,0);e.lookAt(new THREE.Vector3(-1,0,0));this.add(e);var f=new THREE.PerspectiveCamera(90,1,a,b);f.up.set(0,0,1);f.lookAt(new THREE.Vector3(0,1,0));this.add(f);var g=new THREE.PerspectiveCamera(90,1,a,b);g.up.set(0,0,-1);g.lookAt(new THREE.Vector3(0,-1,0));
this.add(g);var h=new THREE.PerspectiveCamera(90,1,a,b);h.up.set(0,-1,0);h.lookAt(new THREE.Vector3(0,0,1));this.add(h);var k=new THREE.PerspectiveCamera(90,1,a,b);k.up.set(0,-1,0);k.lookAt(new THREE.Vector3(0,0,-1));this.add(k);this.renderTarget=new THREE.WebGLRenderTargetCube(c,c,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(a,b){var c=this.renderTarget,m=c.generateMipmaps;c.generateMipmaps=!1;c.activeCubeFace=0;a.render(b,d,c);c.activeCubeFace=
1;a.render(b,e,c);c.activeCubeFace=2;a.render(b,f,c);c.activeCubeFace=3;a.render(b,g,c);c.activeCubeFace=4;a.render(b,h,c);c.generateMipmaps=m;c.activeCubeFace=5;a.render(b,k,c)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.OrthographicCamera=function(a,b,c,d,e,f){THREE.Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=void 0!==e?e:.1;this.far=void 0!==f?f:2E3;this.updateProjectionMatrix()};
THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(c-a,c+a,d+b,d-b,this.near,this.far)};
THREE.OrthographicCamera.prototype.clone=function(){var a=new THREE.OrthographicCamera;THREE.Camera.prototype.clone.call(this,a);a.zoom=this.zoom;a.left=this.left;a.right=this.right;a.top=this.top;a.bottom=this.bottom;a.near=this.near;a.far=this.far;a.projectionMatrix.copy(this.projectionMatrix);return a};
THREE.PerspectiveCamera=function(a,b,c,d){THREE.Camera.call(this);this.type="PerspectiveCamera";this.zoom=1;this.fov=void 0!==a?a:50;this.aspect=void 0!==b?b:1;this.near=void 0!==c?c:.1;this.far=void 0!==d?d:2E3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.setLens=function(a,b){void 0===b&&(b=24);this.fov=2*THREE.Math.radToDeg(Math.atan(b/(2*a)));this.updateProjectionMatrix()};
THREE.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,d,e,f){this.fullWidth=a;this.fullHeight=b;this.x=c;this.y=d;this.width=e;this.height=f;this.updateProjectionMatrix()};
THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var a=THREE.Math.radToDeg(2*Math.atan(Math.tan(.5*THREE.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var b=this.fullWidth/this.fullHeight,a=Math.tan(THREE.Math.degToRad(.5*a))*this.near,c=-a,d=b*c,b=Math.abs(b*a-d),c=Math.abs(a-c);this.projectionMatrix.makeFrustum(d+this.x*b/this.fullWidth,d+(this.x+this.width)*b/this.fullWidth,a-(this.y+this.height)*c/this.fullHeight,a-this.y*c/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(a,
this.aspect,this.near,this.far)};THREE.PerspectiveCamera.prototype.clone=function(){var a=new THREE.PerspectiveCamera;THREE.Camera.prototype.clone.call(this,a);a.zoom=this.zoom;a.fov=this.fov;a.aspect=this.aspect;a.near=this.near;a.far=this.far;a.projectionMatrix.copy(this.projectionMatrix);return a};THREE.Light=function(a){THREE.Object3D.call(this);this.type="Light";this.color=new THREE.Color(a)};THREE.Light.prototype=Object.create(THREE.Object3D.prototype);
THREE.Light.prototype.clone=function(a){void 0===a&&(a=new THREE.Light);THREE.Object3D.prototype.clone.call(this,a);a.color.copy(this.color);return a};THREE.AmbientLight=function(a){THREE.Light.call(this,a);this.type="AmbientLight"};THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype);THREE.AmbientLight.prototype.clone=function(){var a=new THREE.AmbientLight;THREE.Light.prototype.clone.call(this,a);return a};
THREE.AreaLight=function(a,b){THREE.Light.call(this,a);this.type="AreaLight";this.normal=new THREE.Vector3(0,-1,0);this.right=new THREE.Vector3(1,0,0);this.intensity=void 0!==b?b:1;this.height=this.width=1;this.constantAttenuation=1.5;this.linearAttenuation=.5;this.quadraticAttenuation=.1};THREE.AreaLight.prototype=Object.create(THREE.Light.prototype);
THREE.DirectionalLight=function(a,b){THREE.Light.call(this,a);this.type="DirectionalLight";this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=void 0!==b?b:1;this.onlyShadow=this.castShadow=!1;this.shadowCameraNear=50;this.shadowCameraFar=5E3;this.shadowCameraLeft=-500;this.shadowCameraTop=this.shadowCameraRight=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=!1;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowCascade=!1;
this.shadowCascadeOffset=new THREE.Vector3(0,0,-1E3);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,.99,.998];this.shadowCascadeFarZ=[.99,.998,1];this.shadowCascadeArray=[];this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null};THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype);
THREE.DirectionalLight.prototype.clone=function(){var a=new THREE.DirectionalLight;THREE.Light.prototype.clone.call(this,a);a.target=this.target.clone();a.intensity=this.intensity;a.castShadow=this.castShadow;a.onlyShadow=this.onlyShadow;a.shadowCameraNear=this.shadowCameraNear;a.shadowCameraFar=this.shadowCameraFar;a.shadowCameraLeft=this.shadowCameraLeft;a.shadowCameraRight=this.shadowCameraRight;a.shadowCameraTop=this.shadowCameraTop;a.shadowCameraBottom=this.shadowCameraBottom;a.shadowCameraVisible=
this.shadowCameraVisible;a.shadowBias=this.shadowBias;a.shadowDarkness=this.shadowDarkness;a.shadowMapWidth=this.shadowMapWidth;a.shadowMapHeight=this.shadowMapHeight;a.shadowCascade=this.shadowCascade;a.shadowCascadeOffset.copy(this.shadowCascadeOffset);a.shadowCascadeCount=this.shadowCascadeCount;a.shadowCascadeBias=this.shadowCascadeBias.slice(0);a.shadowCascadeWidth=this.shadowCascadeWidth.slice(0);a.shadowCascadeHeight=this.shadowCascadeHeight.slice(0);a.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0);
a.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0);return a};THREE.HemisphereLight=function(a,b,c){THREE.Light.call(this,a);this.type="HemisphereLight";this.position.set(0,100,0);this.groundColor=new THREE.Color(b);this.intensity=void 0!==c?c:1};THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype);
THREE.HemisphereLight.prototype.clone=function(){var a=new THREE.HemisphereLight;THREE.Light.prototype.clone.call(this,a);a.groundColor.copy(this.groundColor);a.intensity=this.intensity;return a};THREE.PointLight=function(a,b,c){THREE.Light.call(this,a);this.type="PointLight";this.intensity=void 0!==b?b:1;this.distance=void 0!==c?c:0};THREE.PointLight.prototype=Object.create(THREE.Light.prototype);
THREE.PointLight.prototype.clone=function(){var a=new THREE.PointLight;THREE.Light.prototype.clone.call(this,a);a.intensity=this.intensity;a.distance=this.distance;return a};
THREE.SpotLight=function(a,b,c,d,e){THREE.Light.call(this,a);this.type="SpotLight";this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=void 0!==b?b:1;this.distance=void 0!==c?c:0;this.angle=void 0!==d?d:Math.PI/3;this.exponent=void 0!==e?e:10;this.onlyShadow=this.castShadow=!1;this.shadowCameraNear=50;this.shadowCameraFar=5E3;this.shadowCameraFov=50;this.shadowCameraVisible=!1;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowMatrix=
this.shadowCamera=this.shadowMapSize=this.shadowMap=null};THREE.SpotLight.prototype=Object.create(THREE.Light.prototype);
THREE.SpotLight.prototype.clone=function(){var a=new THREE.SpotLight;THREE.Light.prototype.clone.call(this,a);a.target=this.target.clone();a.intensity=this.intensity;a.distance=this.distance;a.angle=this.angle;a.exponent=this.exponent;a.castShadow=this.castShadow;a.onlyShadow=this.onlyShadow;a.shadowCameraNear=this.shadowCameraNear;a.shadowCameraFar=this.shadowCameraFar;a.shadowCameraFov=this.shadowCameraFov;a.shadowCameraVisible=this.shadowCameraVisible;a.shadowBias=this.shadowBias;a.shadowDarkness=
this.shadowDarkness;a.shadowMapWidth=this.shadowMapWidth;a.shadowMapHeight=this.shadowMapHeight;return a};THREE.Cache=function(){this.files={}};THREE.Cache.prototype={constructor:THREE.Cache,add:function(a,b){this.files[a]=b},get:function(a){return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}};
THREE.Loader=function(a){this.statusDomElement=(this.showStatus=a)?THREE.Loader.prototype.addStatusElement():null;this.imageLoader=new THREE.ImageLoader;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};
THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:void 0,addStatusElement:function(){var a=document.createElement("div");a.style.position="absolute";a.style.right="0px";a.style.top="0px";a.style.fontSize="0.8em";a.style.textAlign="left";a.style.background="rgba(0,0,0,0.25)";a.style.color="#fff";a.style.width="120px";a.style.padding="0.5em 0.5em 0.5em 0.5em";a.style.zIndex=1E3;a.innerHTML="Loading ...";return a},updateProgress:function(a){var b="Loaded ",b=a.total?b+((100*a.loaded/a.total).toFixed(0)+
"%"):b+((a.loaded/1024).toFixed(2)+" KB");this.statusDomElement.innerHTML=b},extractUrlBase:function(a){a=a.split("/");if(1===a.length)return"./";a.pop();return a.join("/")+"/"},initMaterials:function(a,b){for(var c=[],d=0;d<a.length;++d)c[d]=this.createMaterial(a[d],b);return c},needsTangents:function(a){for(var b=0,c=a.length;b<c;b++)if(a[b]instanceof THREE.ShaderMaterial)return!0;return!1},createMaterial:function(a,b){function c(a){a=Math.log(a)/Math.LN2;return Math.pow(2,Math.round(a))}function d(a,
d,e,g,h,k,s){var u=b+e,v,y=THREE.Loader.Handlers.get(u);null!==y?v=y.load(u):(v=new THREE.Texture,y=f.imageLoader,y.crossOrigin=f.crossOrigin,y.load(u,function(a){if(!1===THREE.Math.isPowerOfTwo(a.width)||!1===THREE.Math.isPowerOfTwo(a.height)){var b=c(a.width),d=c(a.height),e=document.createElement("canvas");e.width=b;e.height=d;e.getContext("2d").drawImage(a,0,0,b,d);v.image=e}else v.image=a;v.needsUpdate=!0}));v.sourceFile=e;g&&(v.repeat.set(g[0],g[1]),1!==g[0]&&(v.wrapS=THREE.RepeatWrapping),
1!==g[1]&&(v.wrapT=THREE.RepeatWrapping));h&&v.offset.set(h[0],h[1]);k&&(e={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==e[k[0]]&&(v.wrapS=e[k[0]]),void 0!==e[k[1]]&&(v.wrapT=e[k[1]]));s&&(v.anisotropy=s);a[d]=v}function e(a){return(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]}var f=this,g="MeshLambertMaterial",h={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(a.shading){var k=a.shading.toLowerCase();"phong"===k?g="MeshPhongMaterial":
"basic"===k&&(g="MeshBasicMaterial")}void 0!==a.blending&&void 0!==THREE[a.blending]&&(h.blending=THREE[a.blending]);if(void 0!==a.transparent||1>a.opacity)h.transparent=a.transparent;void 0!==a.depthTest&&(h.depthTest=a.depthTest);void 0!==a.depthWrite&&(h.depthWrite=a.depthWrite);void 0!==a.visible&&(h.visible=a.visible);void 0!==a.flipSided&&(h.side=THREE.BackSide);void 0!==a.doubleSided&&(h.side=THREE.DoubleSide);void 0!==a.wireframe&&(h.wireframe=a.wireframe);void 0!==a.vertexColors&&("face"===
a.vertexColors?h.vertexColors=THREE.FaceColors:a.vertexColors&&(h.vertexColors=THREE.VertexColors));a.colorDiffuse?h.color=e(a.colorDiffuse):a.DbgColor&&(h.color=a.DbgColor);a.colorSpecular&&(h.specular=e(a.colorSpecular));a.colorAmbient&&(h.ambient=e(a.colorAmbient));a.colorEmissive&&(h.emissive=e(a.colorEmissive));a.transparency&&(h.opacity=a.transparency);a.specularCoef&&(h.shininess=a.specularCoef);a.mapDiffuse&&b&&d(h,"map",a.mapDiffuse,a.mapDiffuseRepeat,a.mapDiffuseOffset,a.mapDiffuseWrap,
a.mapDiffuseAnisotropy);a.mapLight&&b&&d(h,"lightMap",a.mapLight,a.mapLightRepeat,a.mapLightOffset,a.mapLightWrap,a.mapLightAnisotropy);a.mapBump&&b&&d(h,"bumpMap",a.mapBump,a.mapBumpRepeat,a.mapBumpOffset,a.mapBumpWrap,a.mapBumpAnisotropy);a.mapNormal&&b&&d(h,"normalMap",a.mapNormal,a.mapNormalRepeat,a.mapNormalOffset,a.mapNormalWrap,a.mapNormalAnisotropy);a.mapSpecular&&b&&d(h,"specularMap",a.mapSpecular,a.mapSpecularRepeat,a.mapSpecularOffset,a.mapSpecularWrap,a.mapSpecularAnisotropy);a.mapAlpha&&
b&&d(h,"alphaMap",a.mapAlpha,a.mapAlphaRepeat,a.mapAlphaOffset,a.mapAlphaWrap,a.mapAlphaAnisotropy);a.mapBumpScale&&(h.bumpScale=a.mapBumpScale);a.mapNormal?(g=THREE.ShaderLib.normalmap,k=THREE.UniformsUtils.clone(g.uniforms),k.tNormal.value=h.normalMap,a.mapNormalFactor&&k.uNormalScale.value.set(a.mapNormalFactor,a.mapNormalFactor),h.map&&(k.tDiffuse.value=h.map,k.enableDiffuse.value=!0),h.specularMap&&(k.tSpecular.value=h.specularMap,k.enableSpecular.value=!0),h.lightMap&&(k.tAO.value=h.lightMap,
k.enableAO.value=!0),k.diffuse.value.setHex(h.color),k.specular.value.setHex(h.specular),k.ambient.value.setHex(h.ambient),k.shininess.value=h.shininess,void 0!==h.opacity&&(k.opacity.value=h.opacity),g=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:k,lights:!0,fog:!0}),h.transparent&&(g.transparent=!0)):g=new THREE[g](h);void 0!==a.DbgName&&(g.name=a.DbgName);return g}};
THREE.Loader.Handlers={handlers:[],add:function(a,b){this.handlers.push(a,b)},get:function(a){for(var b=0,c=this.handlers.length;b<c;b+=2){var d=this.handlers[b+1];if(this.handlers[b].test(a))return d}return null}};THREE.XHRLoader=function(a){this.cache=new THREE.Cache;this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(a,b,c,d){var e=this,f=e.cache.get(a);void 0!==f?b&&b(f):(f=new XMLHttpRequest,f.open("GET",a,!0),f.addEventListener("load",function(c){e.cache.add(a,this.response);b&&b(this.response);e.manager.itemEnd(a)},!1),void 0!==c&&f.addEventListener("progress",function(a){c(a)},!1),void 0!==d&&f.addEventListener("error",function(a){d(a)},!1),void 0!==this.crossOrigin&&(f.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(f.responseType=
this.responseType),f.send(null),e.manager.itemStart(a))},setResponseType:function(a){this.responseType=a},setCrossOrigin:function(a){this.crossOrigin=a}};THREE.ImageLoader=function(a){this.cache=new THREE.Cache;this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(a,b,c,d){var e=this,f=e.cache.get(a);if(void 0!==f)b(f);else return f=document.createElement("img"),void 0!==b&&f.addEventListener("load",function(c){e.cache.add(a,this);b(this);e.manager.itemEnd(a)},!1),void 0!==c&&f.addEventListener("progress",function(a){c(a)},!1),void 0!==d&&f.addEventListener("error",function(a){d(a)},!1),void 0!==this.crossOrigin&&(f.crossOrigin=this.crossOrigin),f.src=a,e.manager.itemStart(a),f},setCrossOrigin:function(a){this.crossOrigin=
a}};THREE.JSONLoader=function(a){THREE.Loader.call(this,a);this.withCredentials=!1};THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype);THREE.JSONLoader.prototype.load=function(a,b,c){c=c&&"string"===typeof c?c:this.extractUrlBase(a);this.onLoadStart();this.loadAjaxJSON(this,a,b,c)};
THREE.JSONLoader.prototype.loadAjaxJSON=function(a,b,c,d,e){var f=new XMLHttpRequest,g=0;f.onreadystatechange=function(){if(f.readyState===f.DONE)if(200===f.status||0===f.status){if(f.responseText){var h=JSON.parse(f.responseText);if(void 0!==h.metadata&&"scene"===h.metadata.type){console.error('THREE.JSONLoader: "'+b+'" seems to be a Scene. Use THREE.SceneLoader instead.');return}h=a.parse(h,d);c(h.geometry,h.materials)}else console.error('THREE.JSONLoader: "'+b+'" seems to be unreachable or the file is empty.');
a.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load \""+b+'" ('+f.status+")");else f.readyState===f.LOADING?e&&(0===g&&(g=f.getResponseHeader("Content-Length")),e({total:g,loaded:f.responseText.length})):f.readyState===f.HEADERS_RECEIVED&&void 0!==e&&(g=f.getResponseHeader("Content-Length"))};f.open("GET",b,!0);f.withCredentials=this.withCredentials;f.send(null)};
THREE.JSONLoader.prototype.parse=function(a,b){var c=new THREE.Geometry,d=void 0!==a.scale?1/a.scale:1;(function(b){var d,g,h,k,n,p,q,m,r,t,s,u,v,y=a.faces;p=a.vertices;var G=a.normals,w=a.colors,K=0;if(void 0!==a.uvs){for(d=0;d<a.uvs.length;d++)a.uvs[d].length&&K++;for(d=0;d<K;d++)c.faceVertexUvs[d]=[]}k=0;for(n=p.length;k<n;)d=new THREE.Vector3,d.x=p[k++]*b,d.y=p[k++]*b,d.z=p[k++]*b,c.vertices.push(d);k=0;for(n=y.length;k<n;)if(b=y[k++],r=b&1,h=b&2,d=b&8,q=b&16,t=b&32,p=b&64,b&=128,r){r=new THREE.Face3;
r.a=y[k];r.b=y[k+1];r.c=y[k+3];s=new THREE.Face3;s.a=y[k+1];s.b=y[k+2];s.c=y[k+3];k+=4;h&&(h=y[k++],r.materialIndex=h,s.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<K;d++)for(u=a.uvs[d],c.faceVertexUvs[d][h]=[],c.faceVertexUvs[d][h+1]=[],g=0;4>g;g++)m=y[k++],v=u[2*m],m=u[2*m+1],v=new THREE.Vector2(v,m),2!==g&&c.faceVertexUvs[d][h].push(v),0!==g&&c.faceVertexUvs[d][h+1].push(v);q&&(q=3*y[k++],r.normal.set(G[q++],G[q++],G[q]),s.normal.copy(r.normal));if(t)for(d=0;4>d;d++)q=3*y[k++],t=new THREE.Vector3(G[q++],
G[q++],G[q]),2!==d&&r.vertexNormals.push(t),0!==d&&s.vertexNormals.push(t);p&&(p=y[k++],p=w[p],r.color.setHex(p),s.color.setHex(p));if(b)for(d=0;4>d;d++)p=y[k++],p=w[p],2!==d&&r.vertexColors.push(new THREE.Color(p)),0!==d&&s.vertexColors.push(new THREE.Color(p));c.faces.push(r);c.faces.push(s)}else{r=new THREE.Face3;r.a=y[k++];r.b=y[k++];r.c=y[k++];h&&(h=y[k++],r.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<K;d++)for(u=a.uvs[d],c.faceVertexUvs[d][h]=[],g=0;3>g;g++)m=y[k++],v=u[2*m],m=u[2*m+1],
v=new THREE.Vector2(v,m),c.faceVertexUvs[d][h].push(v);q&&(q=3*y[k++],r.normal.set(G[q++],G[q++],G[q]));if(t)for(d=0;3>d;d++)q=3*y[k++],t=new THREE.Vector3(G[q++],G[q++],G[q]),r.vertexNormals.push(t);p&&(p=y[k++],r.color.setHex(w[p]));if(b)for(d=0;3>d;d++)p=y[k++],r.vertexColors.push(new THREE.Color(w[p]));c.faces.push(r)}})(d);(function(){var b=void 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var d=0,g=a.skinWeights.length;d<g;d+=b)c.skinWeights.push(new THREE.Vector4(a.skinWeights[d],
1<b?a.skinWeights[d+1]:0,2<b?a.skinWeights[d+2]:0,3<b?a.skinWeights[d+3]:0));if(a.skinIndices)for(d=0,g=a.skinIndices.length;d<g;d+=b)c.skinIndices.push(new THREE.Vector4(a.skinIndices[d],1<b?a.skinIndices[d+1]:0,2<b?a.skinIndices[d+2]:0,3<b?a.skinIndices[d+3]:0));c.bones=a.bones;c.bones&&0<c.bones.length&&(c.skinWeights.length!==c.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn("When skinning, number of vertices ("+c.vertices.length+"), skinIndices ("+c.skinIndices.length+
"), and skinWeights ("+c.skinWeights.length+") should match.");c.animation=a.animation;c.animations=a.animations})();(function(b){if(void 0!==a.morphTargets){var d,g,h,k,n,p;d=0;for(g=a.morphTargets.length;d<g;d++)for(c.morphTargets[d]={},c.morphTargets[d].name=a.morphTargets[d].name,c.morphTargets[d].vertices=[],n=c.morphTargets[d].vertices,p=a.morphTargets[d].vertices,h=0,k=p.length;h<k;h+=3){var q=new THREE.Vector3;q.x=p[h]*b;q.y=p[h+1]*b;q.z=p[h+2]*b;n.push(q)}}if(void 0!==a.morphColors)for(d=
0,g=a.morphColors.length;d<g;d++)for(c.morphColors[d]={},c.morphColors[d].name=a.morphColors[d].name,c.morphColors[d].colors=[],k=c.morphColors[d].colors,n=a.morphColors[d].colors,b=0,h=n.length;b<h;b+=3)p=new THREE.Color(16755200),p.setRGB(n[b],n[b+1],n[b+2]),k.push(p)})(d);c.computeFaceNormals();c.computeBoundingSphere();if(void 0===a.materials||0===a.materials.length)return{geometry:c};d=this.initMaterials(a.materials,b);this.needsTangents(d)&&c.computeTangents();return{geometry:c,materials:d}};
THREE.LoadingManager=function(a,b,c){var d=this,e=0,f=0;this.onLoad=a;this.onProgress=b;this.onError=c;this.itemStart=function(a){f++};this.itemEnd=function(a){e++;if(void 0!==d.onProgress)d.onProgress(a,e,f);if(e===f&&void 0!==d.onLoad)d.onLoad()}};THREE.DefaultLoadingManager=new THREE.LoadingManager;THREE.BufferGeometryLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(a,b,c,d){var e=this,f=new THREE.XHRLoader;f.setCrossOrigin(this.crossOrigin);f.load(a,function(a){b(e.parse(JSON.parse(a)))},c,d)},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a){var b=new THREE.BufferGeometry,c=a.attributes,d;for(d in c){var e=c[d],f=new self[e.type](e.array);b.addAttribute(d,new THREE.BufferAttribute(f,e.itemSize))}c=a.offsets;void 0!==c&&(b.offsets=JSON.parse(JSON.stringify(c)));
a=a.boundingSphere;void 0!==a&&(c=new THREE.Vector3,void 0!==a.center&&c.fromArray(a.center),b.boundingSphere=new THREE.Sphere(c,a.radius));return b}};THREE.MaterialLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(a,b,c,d){var e=this,f=new THREE.XHRLoader;f.setCrossOrigin(this.crossOrigin);f.load(a,function(a){b(e.parse(JSON.parse(a)))},c,d)},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a){var b=new THREE[a.type];void 0!==a.color&&b.color.setHex(a.color);void 0!==a.ambient&&b.ambient.setHex(a.ambient);void 0!==a.emissive&&b.emissive.setHex(a.emissive);void 0!==a.specular&&b.specular.setHex(a.specular);void 0!==a.shininess&&
(b.shininess=a.shininess);void 0!==a.uniforms&&(b.uniforms=a.uniforms);void 0!==a.vertexShader&&(b.vertexShader=a.vertexShader);void 0!==a.fragmentShader&&(b.fragmentShader=a.fragmentShader);void 0!==a.vertexColors&&(b.vertexColors=a.vertexColors);void 0!==a.shading&&(b.shading=a.shading);void 0!==a.blending&&(b.blending=a.blending);void 0!==a.side&&(b.side=a.side);void 0!==a.opacity&&(b.opacity=a.opacity);void 0!==a.transparent&&(b.transparent=a.transparent);void 0!==a.wireframe&&(b.wireframe=a.wireframe);
if(void 0!==a.materials)for(var c=0,d=a.materials.length;c<d;c++)b.materials.push(this.parse(a.materials[c]));return b}};THREE.ObjectLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(a,b,c,d){var e=this,f=new THREE.XHRLoader(e.manager);f.setCrossOrigin(this.crossOrigin);f.load(a,function(a){b(e.parse(JSON.parse(a)))},c,d)},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a){var b=this.parseGeometries(a.geometries),c=this.parseMaterials(a.materials);return this.parseObject(a.object,b,c)},parseGeometries:function(a){var b={};if(void 0!==a)for(var c=new THREE.JSONLoader,d=new THREE.BufferGeometryLoader,
e=0,f=a.length;e<f;e++){var g,h=a[e];switch(h.type){case "PlaneGeometry":g=new THREE.PlaneGeometry(h.width,h.height,h.widthSegments,h.heightSegments);break;case "BoxGeometry":case "CubeGeometry":g=new THREE.BoxGeometry(h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case "CircleGeometry":g=new THREE.CircleGeometry(h.radius,h.segments);break;case "CylinderGeometry":g=new THREE.CylinderGeometry(h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded);
break;case "SphereGeometry":g=new THREE.SphereGeometry(h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case "IcosahedronGeometry":g=new THREE.IcosahedronGeometry(h.radius,h.detail);break;case "TorusGeometry":g=new THREE.TorusGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case "TorusKnotGeometry":g=new THREE.TorusKnotGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.p,h.q,h.heightScale);break;case "BufferGeometry":g=
d.parse(h.data);break;case "Geometry":g=c.parse(h.data).geometry}g.uuid=h.uuid;void 0!==h.name&&(g.name=h.name);b[h.uuid]=g}return b},parseMaterials:function(a){var b={};if(void 0!==a)for(var c=new THREE.MaterialLoader,d=0,e=a.length;d<e;d++){var f=a[d],g=c.parse(f);g.uuid=f.uuid;void 0!==f.name&&(g.name=f.name);b[f.uuid]=g}return b},parseObject:function(){var a=new THREE.Matrix4;return function(b,c,d){var e;switch(b.type){case "Scene":e=new THREE.Scene;break;case "PerspectiveCamera":e=new THREE.PerspectiveCamera(b.fov,
b.aspect,b.near,b.far);break;case "OrthographicCamera":e=new THREE.OrthographicCamera(b.left,b.right,b.top,b.bottom,b.near,b.far);break;case "AmbientLight":e=new THREE.AmbientLight(b.color);break;case "DirectionalLight":e=new THREE.DirectionalLight(b.color,b.intensity);break;case "PointLight":e=new THREE.PointLight(b.color,b.intensity,b.distance);break;case "SpotLight":e=new THREE.SpotLight(b.color,b.intensity,b.distance,b.angle,b.exponent);break;case "HemisphereLight":e=new THREE.HemisphereLight(b.color,
b.groundColor,b.intensity);break;case "Mesh":e=c[b.geometry];var f=d[b.material];void 0===e&&console.warn("THREE.ObjectLoader: Undefined geometry",b.geometry);void 0===f&&console.warn("THREE.ObjectLoader: Undefined material",b.material);e=new THREE.Mesh(e,f);break;case "Line":e=c[b.geometry];f=d[b.material];void 0===e&&console.warn("THREE.ObjectLoader: Undefined geometry",b.geometry);void 0===f&&console.warn("THREE.ObjectLoader: Undefined material",b.material);e=new THREE.Line(e,f);break;case "Sprite":f=
d[b.material];void 0===f&&console.warn("THREE.ObjectLoader: Undefined material",b.material);e=new THREE.Sprite(f);break;case "Group":e=new THREE.Group;break;default:e=new THREE.Object3D}e.uuid=b.uuid;void 0!==b.name&&(e.name=b.name);void 0!==b.matrix?(a.fromArray(b.matrix),a.decompose(e.position,e.quaternion,e.scale)):(void 0!==b.position&&e.position.fromArray(b.position),void 0!==b.rotation&&e.rotation.fromArray(b.rotation),void 0!==b.scale&&e.scale.fromArray(b.scale));void 0!==b.visible&&(e.visible=
b.visible);void 0!==b.userData&&(e.userData=b.userData);if(void 0!==b.children)for(var g in b.children)e.add(this.parseObject(b.children[g],c,d));return e}}()};THREE.TextureLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager};
THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(a,b,c,d){var e=new THREE.ImageLoader(this.manager);e.setCrossOrigin(this.crossOrigin);e.load(a,function(a){a=new THREE.Texture(a);a.needsUpdate=!0;void 0!==b&&b(a)},c,d)},setCrossOrigin:function(a){this.crossOrigin=a}};THREE.CompressedTextureLoader=function(){this._parser=null};
THREE.CompressedTextureLoader.prototype={constructor:THREE.CompressedTextureLoader,load:function(a,b,c){var d=this,e=[],f=new THREE.CompressedTexture;f.image=e;var g=new THREE.XHRLoader;g.setResponseType("arraybuffer");if(a instanceof Array){var h=0;c=function(c){g.load(a[c],function(a){a=d._parser(a,!0);e[c]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps};h+=1;6===h&&(1==a.mipmapCount&&(f.minFilter=THREE.LinearFilter),f.format=a.format,f.needsUpdate=!0,b&&b(f))})};for(var k=0,n=
a.length;k<n;++k)c(k)}else g.load(a,function(a){a=d._parser(a,!0);if(a.isCubemap)for(var c=a.mipmaps.length/a.mipmapCount,g=0;g<c;g++){e[g]={mipmaps:[]};for(var h=0;h<a.mipmapCount;h++)e[g].mipmaps.push(a.mipmaps[g*a.mipmapCount+h]),e[g].format=a.format,e[g].width=a.width,e[g].height=a.height}else f.image.width=a.width,f.image.height=a.height,f.mipmaps=a.mipmaps;1===a.mipmapCount&&(f.minFilter=THREE.LinearFilter);f.format=a.format;f.needsUpdate=!0;b&&b(f)});return f}};
THREE.Material=function(){Object.defineProperty(this,"id",{value:THREE.MaterialIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Material";this.side=THREE.FrontSide;this.opacity=1;this.transparent=!1;this.blending=THREE.NormalBlending;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.depthWrite=this.depthTest=!0;this.polygonOffset=!1;this.overdraw=this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=
0;this.needsUpdate=this.visible=!0};
THREE.Material.prototype={constructor:THREE.Material,setValues:function(a){if(void 0!==a)for(var b in a){var c=a[b];if(void 0===c)console.warn("THREE.Material: '"+b+"' parameter is undefined.");else if(b in this){var d=this[b];d instanceof THREE.Color?d.set(c):d instanceof THREE.Vector3&&c instanceof THREE.Vector3?d.copy(c):this[b]="overdraw"==b?Number(c):c}}},toJSON:function(){var a={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};""!==this.name&&
(a.name=this.name);this instanceof THREE.MeshBasicMaterial?(a.color=this.color.getHex(),this.vertexColors!==THREE.NoColors&&(a.vertexColors=this.vertexColors),this.blending!==THREE.NormalBlending&&(a.blending=this.blending),this.side!==THREE.FrontSide&&(a.side=this.side)):this instanceof THREE.MeshLambertMaterial?(a.color=this.color.getHex(),a.ambient=this.ambient.getHex(),a.emissive=this.emissive.getHex(),this.vertexColors!==THREE.NoColors&&(a.vertexColors=this.vertexColors),this.blending!==THREE.NormalBlending&&
(a.blending=this.blending),this.side!==THREE.FrontSide&&(a.side=this.side)):this instanceof THREE.MeshPhongMaterial?(a.color=this.color.getHex(),a.ambient=this.ambient.getHex(),a.emissive=this.emissive.getHex(),a.specular=this.specular.getHex(),a.shininess=this.shininess,this.vertexColors!==THREE.NoColors&&(a.vertexColors=this.vertexColors),this.blending!==THREE.NormalBlending&&(a.blending=this.blending),this.side!==THREE.FrontSide&&(a.side=this.side)):this instanceof THREE.MeshNormalMaterial?(this.shading!==
THREE.FlatShading&&(a.shading=this.shading),this.blending!==THREE.NormalBlending&&(a.blending=this.blending),this.side!==THREE.FrontSide&&(a.side=this.side)):this instanceof THREE.MeshDepthMaterial?(this.blending!==THREE.NormalBlending&&(a.blending=this.blending),this.side!==THREE.FrontSide&&(a.side=this.side)):this instanceof THREE.ShaderMaterial?(a.uniforms=this.uniforms,a.vertexShader=this.vertexShader,a.fragmentShader=this.fragmentShader):this instanceof THREE.SpriteMaterial&&(a.color=this.color.getHex());
1>this.opacity&&(a.opacity=this.opacity);!1!==this.transparent&&(a.transparent=this.transparent);!1!==this.wireframe&&(a.wireframe=this.wireframe);return a},clone:function(a){void 0===a&&(a=new THREE.Material);a.name=this.name;a.side=this.side;a.opacity=this.opacity;a.transparent=this.transparent;a.blending=this.blending;a.blendSrc=this.blendSrc;a.blendDst=this.blendDst;a.blendEquation=this.blendEquation;a.depthTest=this.depthTest;a.depthWrite=this.depthWrite;a.polygonOffset=this.polygonOffset;a.polygonOffsetFactor=
this.polygonOffsetFactor;a.polygonOffsetUnits=this.polygonOffsetUnits;a.alphaTest=this.alphaTest;a.overdraw=this.overdraw;a.visible=this.visible;return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Material.prototype);THREE.MaterialIdCount=0;
THREE.LineBasicMaterial=function(a){THREE.Material.call(this);this.type="LineBasicMaterial";this.color=new THREE.Color(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.vertexColors=THREE.NoColors;this.fog=!0;this.setValues(a)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.LineBasicMaterial.prototype.clone=function(){var a=new THREE.LineBasicMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.linewidth=this.linewidth;a.linecap=this.linecap;a.linejoin=this.linejoin;a.vertexColors=this.vertexColors;a.fog=this.fog;return a};
THREE.LineDashedMaterial=function(a){THREE.Material.call(this);this.type="LineDashedMaterial";this.color=new THREE.Color(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.vertexColors=!1;this.fog=!0;this.setValues(a)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.LineDashedMaterial.prototype.clone=function(){var a=new THREE.LineDashedMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.linewidth=this.linewidth;a.scale=this.scale;a.dashSize=this.dashSize;a.gapSize=this.gapSize;a.vertexColors=this.vertexColors;a.fog=this.fog;return a};
THREE.MeshBasicMaterial=function(a){THREE.Material.call(this);this.type="MeshBasicMaterial";this.color=new THREE.Color(16777215);this.envMap=this.alphaMap=this.specularMap=this.lightMap=this.map=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=!0;this.shading=THREE.SmoothShading;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=THREE.NoColors;this.morphTargets=this.skinning=!1;this.setValues(a)};
THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.MeshBasicMaterial.prototype.clone=function(){var a=new THREE.MeshBasicMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.map=this.map;a.lightMap=this.lightMap;a.specularMap=this.specularMap;a.alphaMap=this.alphaMap;a.envMap=this.envMap;a.combine=this.combine;a.reflectivity=this.reflectivity;a.refractionRatio=this.refractionRatio;a.fog=this.fog;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.wireframeLinecap=this.wireframeLinecap;
a.wireframeLinejoin=this.wireframeLinejoin;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;return a};
THREE.MeshLambertMaterial=function(a){THREE.Material.call(this);this.type="MeshLambertMaterial";this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.wrapAround=!1;this.wrapRGB=new THREE.Vector3(1,1,1);this.envMap=this.alphaMap=this.specularMap=this.lightMap=this.map=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=!0;this.shading=THREE.SmoothShading;this.wireframe=!1;this.wireframeLinewidth=
1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=THREE.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.MeshLambertMaterial.prototype.clone=function(){var a=new THREE.MeshLambertMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.ambient.copy(this.ambient);a.emissive.copy(this.emissive);a.wrapAround=this.wrapAround;a.wrapRGB.copy(this.wrapRGB);a.map=this.map;a.lightMap=this.lightMap;a.specularMap=this.specularMap;a.alphaMap=this.alphaMap;a.envMap=this.envMap;a.combine=this.combine;a.reflectivity=this.reflectivity;a.refractionRatio=this.refractionRatio;a.fog=this.fog;
a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.wireframeLinecap=this.wireframeLinecap;a.wireframeLinejoin=this.wireframeLinejoin;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;a.morphNormals=this.morphNormals;return a};
THREE.MeshPhongMaterial=function(a){THREE.Material.call(this);this.type="MeshPhongMaterial";this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.specular=new THREE.Color(1118481);this.shininess=30;this.wrapAround=this.metal=!1;this.wrapRGB=new THREE.Vector3(1,1,1);this.bumpMap=this.lightMap=this.map=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.envMap=this.alphaMap=this.specularMap=null;this.combine=
THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=!0;this.shading=THREE.SmoothShading;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexColors=THREE.NoColors;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.MeshPhongMaterial.prototype.clone=function(){var a=new THREE.MeshPhongMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.ambient.copy(this.ambient);a.emissive.copy(this.emissive);a.specular.copy(this.specular);a.shininess=this.shininess;a.metal=this.metal;a.wrapAround=this.wrapAround;a.wrapRGB.copy(this.wrapRGB);a.map=this.map;a.lightMap=this.lightMap;a.bumpMap=this.bumpMap;a.bumpScale=this.bumpScale;a.normalMap=this.normalMap;a.normalScale.copy(this.normalScale);
a.specularMap=this.specularMap;a.alphaMap=this.alphaMap;a.envMap=this.envMap;a.combine=this.combine;a.reflectivity=this.reflectivity;a.refractionRatio=this.refractionRatio;a.fog=this.fog;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.wireframeLinecap=this.wireframeLinecap;a.wireframeLinejoin=this.wireframeLinejoin;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;a.morphNormals=this.morphNormals;return a};
THREE.MeshDepthMaterial=function(a){THREE.Material.call(this);this.type="MeshDepthMaterial";this.wireframe=this.morphTargets=!1;this.wireframeLinewidth=1;this.setValues(a)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshDepthMaterial.prototype.clone=function(){var a=new THREE.MeshDepthMaterial;THREE.Material.prototype.clone.call(this,a);a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;return a};
THREE.MeshNormalMaterial=function(a){THREE.Material.call(this,a);this.type="MeshNormalMaterial";this.shading=THREE.FlatShading;this.wireframe=!1;this.wireframeLinewidth=1;this.morphTargets=!1;this.setValues(a)};THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.MeshNormalMaterial.prototype.clone=function(){var a=new THREE.MeshNormalMaterial;THREE.Material.prototype.clone.call(this,a);a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;return a};THREE.MeshFaceMaterial=function(a){this.uuid=THREE.Math.generateUUID();this.type="MeshFaceMaterial";this.materials=a instanceof Array?a:[]};
THREE.MeshFaceMaterial.prototype={constructor:THREE.MeshFaceMaterial,toJSON:function(){for(var a={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},b=0,c=this.materials.length;b<c;b++)a.materials.push(this.materials[b].toJSON());return a},clone:function(){for(var a=new THREE.MeshFaceMaterial,b=0;b<this.materials.length;b++)a.materials.push(this.materials[b].clone());return a}};
THREE.PointCloudMaterial=function(a){THREE.Material.call(this);this.type="PointCloudMaterial";this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.vertexColors=THREE.NoColors;this.fog=!0;this.setValues(a)};THREE.PointCloudMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.PointCloudMaterial.prototype.clone=function(){var a=new THREE.PointCloudMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.map=this.map;a.size=this.size;a.sizeAttenuation=this.sizeAttenuation;a.vertexColors=this.vertexColors;a.fog=this.fog;return a};THREE.ParticleBasicMaterial=function(a){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial.");return new THREE.PointCloudMaterial(a)};
THREE.ParticleSystemMaterial=function(a){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial.");return new THREE.PointCloudMaterial(a)};
THREE.ShaderMaterial=function(a){THREE.Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.attributes=null;this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.shading=THREE.SmoothShading;this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.vertexColors=THREE.NoColors;this.morphNormals=
this.morphTargets=this.skinning=!1;this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;this.setValues(a)};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);
THREE.ShaderMaterial.prototype.clone=function(){var a=new THREE.ShaderMaterial;THREE.Material.prototype.clone.call(this,a);a.fragmentShader=this.fragmentShader;a.vertexShader=this.vertexShader;a.uniforms=THREE.UniformsUtils.clone(this.uniforms);a.attributes=this.attributes;a.defines=this.defines;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.fog=this.fog;a.lights=this.lights;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=
this.morphTargets;a.morphNormals=this.morphNormals;return a};THREE.RawShaderMaterial=function(a){THREE.ShaderMaterial.call(this,a);this.type="RawShaderMaterial"};THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);THREE.RawShaderMaterial.prototype.clone=function(){var a=new THREE.RawShaderMaterial;THREE.ShaderMaterial.prototype.clone.call(this,a);return a};
THREE.SpriteMaterial=function(a){THREE.Material.call(this);this.type="SpriteMaterial";this.color=new THREE.Color(16777215);this.map=null;this.rotation=0;this.fog=!1;this.setValues(a)};THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.clone=function(){var a=new THREE.SpriteMaterial;THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.map=this.map;a.rotation=this.rotation;a.fog=this.fog;return a};
THREE.Texture=function(a,b,c,d,e,f,g,h,k){Object.defineProperty(this,"id",{value:THREE.TextureIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.image=void 0!==a?a:THREE.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==b?b:THREE.Texture.DEFAULT_MAPPING;this.wrapS=void 0!==c?c:THREE.ClampToEdgeWrapping;this.wrapT=void 0!==d?d:THREE.ClampToEdgeWrapping;this.magFilter=void 0!==e?e:THREE.LinearFilter;this.minFilter=void 0!==f?f:THREE.LinearMipMapLinearFilter;this.anisotropy=
void 0!==k?k:1;this.format=void 0!==g?g:THREE.RGBAFormat;this.type=void 0!==h?h:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this._needsUpdate=!1;this.onUpdate=null};THREE.Texture.DEFAULT_IMAGE=void 0;THREE.Texture.DEFAULT_MAPPING=new THREE.UVMapping;
THREE.Texture.prototype={constructor:THREE.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(a){!0===a&&this.update();this._needsUpdate=a},clone:function(a){void 0===a&&(a=new THREE.Texture);a.image=this.image;a.mipmaps=this.mipmaps.slice(0);a.mapping=this.mapping;a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.anisotropy=this.anisotropy;a.format=this.format;a.type=this.type;a.offset.copy(this.offset);a.repeat.copy(this.repeat);a.generateMipmaps=
this.generateMipmaps;a.premultiplyAlpha=this.premultiplyAlpha;a.flipY=this.flipY;a.unpackAlignment=this.unpackAlignment;return a},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);THREE.TextureIdCount=0;THREE.CubeTexture=function(a,b,c,d,e,f,g,h,k){THREE.Texture.call(this,a,b,c,d,e,f,g,h,k);this.images=a};THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype);
THREE.CubeTexture.clone=function(a){void 0===a&&(a=new THREE.CubeTexture);THREE.Texture.prototype.clone.call(this,a);a.images=this.images;return a};THREE.CompressedTexture=function(a,b,c,d,e,f,g,h,k,n,p){THREE.Texture.call(this,null,f,g,h,k,n,d,e,p);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);
THREE.CompressedTexture.prototype.clone=function(){var a=new THREE.CompressedTexture;THREE.Texture.prototype.clone.call(this,a);return a};THREE.DataTexture=function(a,b,c,d,e,f,g,h,k,n,p){THREE.Texture.call(this,null,f,g,h,k,n,d,e,p);this.image={data:a,width:b,height:c}};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.clone=function(){var a=new THREE.DataTexture;THREE.Texture.prototype.clone.call(this,a);return a};
THREE.VideoTexture=function(a,b,c,d,e,f,g,h,k){THREE.Texture.call(this,a,b,c,d,e,f,g,h,k);this.generateMipmaps=!1;var n=this,p=function(){requestAnimationFrame(p);a.readyState===a.HAVE_ENOUGH_DATA&&(n.needsUpdate=!0)};p()};THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype);THREE.Group=function(){THREE.Object3D.call(this);this.type="Group"};THREE.Group.prototype=Object.create(THREE.Object3D.prototype);
THREE.PointCloud=function(a,b){THREE.Object3D.call(this);this.type="PointCloud";this.geometry=void 0!==a?a:new THREE.Geometry;this.material=void 0!==b?b:new THREE.PointCloudMaterial({color:16777215*Math.random()});this.sortParticles=!1};THREE.PointCloud.prototype=Object.create(THREE.Object3D.prototype);
THREE.PointCloud.prototype.raycast=function(){var a=new THREE.Matrix4,b=new THREE.Ray;return function(c,d){var e=this,f=e.geometry,g=c.params.PointCloud.threshold;a.getInverse(this.matrixWorld);b.copy(c.ray).applyMatrix4(a);if(null===f.boundingBox||!1!==b.isIntersectionBox(f.boundingBox)){var h=g/((this.scale.x+this.scale.y+this.scale.z)/3),k=new THREE.Vector3,g=function(a,f){var g=b.distanceToPoint(a);if(g<h){var k=b.closestPointToPoint(a);k.applyMatrix4(e.matrixWorld);var m=c.ray.origin.distanceTo(k);
d.push({distance:m,distanceToRay:g,point:k.clone(),index:f,face:null,object:e})}};if(f instanceof THREE.BufferGeometry){var n=f.attributes,p=n.position.array;if(void 0!==n.index){var n=n.index.array,q=f.offsets;0===q.length&&(q=[{start:0,count:n.length,index:0}]);for(var m=0,r=q.length;m<r;++m)for(var t=q[m].start,s=q[m].index,f=t,t=t+q[m].count;f<t;f++){var u=s+n[f];k.fromArray(p,3*u);g(k,u)}}else for(n=p.length/3,f=0;f<n;f++)k.set(p[3*f],p[3*f+1],p[3*f+2]),g(k,f)}else for(k=this.geometry.vertices,
f=0;f<k.length;f++)g(k[f],f)}}}();THREE.PointCloud.prototype.clone=function(a){void 0===a&&(a=new THREE.PointCloud(this.geometry,this.material));a.sortParticles=this.sortParticles;THREE.Object3D.prototype.clone.call(this,a);return a};THREE.ParticleSystem=function(a,b){console.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud.");return new THREE.PointCloud(a,b)};
THREE.Line=function(a,b,c){THREE.Object3D.call(this);this.type="Line";this.geometry=void 0!==a?a:new THREE.Geometry;this.material=void 0!==b?b:new THREE.LineBasicMaterial({color:16777215*Math.random()});this.mode=void 0!==c?c:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=Object.create(THREE.Object3D.prototype);
THREE.Line.prototype.raycast=function(){var a=new THREE.Matrix4,b=new THREE.Ray,c=new THREE.Sphere;return function(d,e){var f=d.linePrecision,f=f*f,g=this.geometry;null===g.boundingSphere&&g.computeBoundingSphere();c.copy(g.boundingSphere);c.applyMatrix4(this.matrixWorld);if(!1!==d.ray.isIntersectionSphere(c)&&(a.getInverse(this.matrixWorld),b.copy(d.ray).applyMatrix4(a),g instanceof THREE.Geometry))for(var g=g.vertices,h=g.length,k=new THREE.Vector3,n=new THREE.Vector3,p=this.mode===THREE.LineStrip?
1:2,q=0;q<h-1;q+=p)if(!(b.distanceSqToSegment(g[q],g[q+1],n,k)>f)){var m=b.origin.distanceTo(n);m<d.near||m>d.far||e.push({distance:m,point:k.clone().applyMatrix4(this.matrixWorld),face:null,faceIndex:null,object:this})}}}();THREE.Line.prototype.clone=function(a){void 0===a&&(a=new THREE.Line(this.geometry,this.material,this.mode));THREE.Object3D.prototype.clone.call(this,a);return a};
THREE.Mesh=function(a,b){THREE.Object3D.call(this);this.type="Mesh";this.geometry=void 0!==a?a:new THREE.Geometry;this.material=void 0!==b?b:new THREE.MeshBasicMaterial({color:16777215*Math.random()});this.updateMorphTargets()};THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);
THREE.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}};
THREE.Mesh.prototype.getMorphTargetIndexByName=function(a){if(void 0!==this.morphTargetDictionary[a])return this.morphTargetDictionary[a];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};
THREE.Mesh.prototype.raycast=function(){var a=new THREE.Matrix4,b=new THREE.Ray,c=new THREE.Sphere,d=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Vector3;return function(g,h){var k=this.geometry;null===k.boundingSphere&&k.computeBoundingSphere();c.copy(k.boundingSphere);c.applyMatrix4(this.matrixWorld);if(!1!==g.ray.isIntersectionSphere(c)&&(a.getInverse(this.matrixWorld),b.copy(g.ray).applyMatrix4(a),null===k.boundingBox||!1!==b.isIntersectionBox(k.boundingBox)))if(k instanceof THREE.BufferGeometry){var n=
this.material;if(void 0!==n){var p=k.attributes,q,m,r=g.precision;if(void 0!==p.index){var t=p.index.array,s=p.position.array,u=k.offsets;0===u.length&&(u=[{start:0,count:t.length,index:0}]);for(var v=0,y=u.length;v<y;++v)for(var p=u[v].start,G=u[v].index,k=p,w=p+u[v].count;k<w;k+=3){p=G+t[k];q=G+t[k+1];m=G+t[k+2];d.fromArray(s,3*p);e.fromArray(s,3*q);f.fromArray(s,3*m);var K=n.side===THREE.BackSide?b.intersectTriangle(f,e,d,!0):b.intersectTriangle(d,e,f,n.side!==THREE.DoubleSide);if(null!==K){K.applyMatrix4(this.matrixWorld);
var x=g.ray.origin.distanceTo(K);x<r||x<g.near||x>g.far||h.push({distance:x,point:K,face:new THREE.Face3(p,q,m,THREE.Triangle.normal(d,e,f)),faceIndex:null,object:this})}}}else for(s=p.position.array,t=k=0,w=s.length;k<w;k+=3,t+=9)p=k,q=k+1,m=k+2,d.fromArray(s,t),e.fromArray(s,t+3),f.fromArray(s,t+6),K=n.side===THREE.BackSide?b.intersectTriangle(f,e,d,!0):b.intersectTriangle(d,e,f,n.side!==THREE.DoubleSide),null!==K&&(K.applyMatrix4(this.matrixWorld),x=g.ray.origin.distanceTo(K),x<r||x<g.near||x>
g.far||h.push({distance:x,point:K,face:new THREE.Face3(p,q,m,THREE.Triangle.normal(d,e,f)),faceIndex:null,object:this}))}}else if(k instanceof THREE.Geometry)for(t=this.material instanceof THREE.MeshFaceMaterial,s=!0===t?this.material.materials:null,r=g.precision,u=k.vertices,v=0,y=k.faces.length;v<y;v++)if(G=k.faces[v],n=!0===t?s[G.materialIndex]:this.material,void 0!==n){p=u[G.a];q=u[G.b];m=u[G.c];if(!0===n.morphTargets){K=k.morphTargets;x=this.morphTargetInfluences;d.set(0,0,0);e.set(0,0,0);f.set(0,
0,0);for(var w=0,D=K.length;w<D;w++){var E=x[w];if(0!==E){var A=K[w].vertices;d.x+=(A[G.a].x-p.x)*E;d.y+=(A[G.a].y-p.y)*E;d.z+=(A[G.a].z-p.z)*E;e.x+=(A[G.b].x-q.x)*E;e.y+=(A[G.b].y-q.y)*E;e.z+=(A[G.b].z-q.z)*E;f.x+=(A[G.c].x-m.x)*E;f.y+=(A[G.c].y-m.y)*E;f.z+=(A[G.c].z-m.z)*E}}d.add(p);e.add(q);f.add(m);p=d;q=e;m=f}K=n.side===THREE.BackSide?b.intersectTriangle(m,q,p,!0):b.intersectTriangle(p,q,m,n.side!==THREE.DoubleSide);null!==K&&(K.applyMatrix4(this.matrixWorld),x=g.ray.origin.distanceTo(K),x<r||
x<g.near||x>g.far||h.push({distance:x,point:K,face:G,faceIndex:v,object:this}))}}}();THREE.Mesh.prototype.clone=function(a,b){void 0===a&&(a=new THREE.Mesh(this.geometry,this.material));THREE.Object3D.prototype.clone.call(this,a,b);return a};THREE.Bone=function(a){THREE.Object3D.call(this);this.skin=a};THREE.Bone.prototype=Object.create(THREE.Object3D.prototype);
THREE.Skeleton=function(a,b,c){this.useVertexTexture=void 0!==c?c:!0;this.identityMatrix=new THREE.Matrix4;a=a||[];this.bones=a.slice(0);this.useVertexTexture?(this.boneTextureHeight=this.boneTextureWidth=a=256<this.bones.length?64:64<this.bones.length?32:16<this.bones.length?16:8,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),
this.boneTexture.minFilter=THREE.NearestFilter,this.boneTexture.magFilter=THREE.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===b)this.calculateInverses();else if(this.bones.length===b.length)this.boneInverses=b.slice(0);else for(console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[],b=0,a=this.bones.length;b<a;b++)this.boneInverses.push(new THREE.Matrix4)};
THREE.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var a=0,b=this.bones.length;a<b;a++){var c=new THREE.Matrix4;this.bones[a]&&c.getInverse(this.bones[a].matrixWorld);this.boneInverses.push(c)}};
THREE.Skeleton.prototype.pose=function(){for(var a,b=0,c=this.bones.length;b<c;b++)(a=this.bones[b])&&a.matrixWorld.getInverse(this.boneInverses[b]);b=0;for(c=this.bones.length;b<c;b++)if(a=this.bones[b])a.parent?(a.matrix.getInverse(a.parent.matrixWorld),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale)};
THREE.Skeleton.prototype.update=function(){var a=new THREE.Matrix4;return function(){for(var b=0,c=this.bones.length;b<c;b++)a.multiplyMatrices(this.bones[b]?this.bones[b].matrixWorld:this.identityMatrix,this.boneInverses[b]),a.flattenToArrayOffset(this.boneMatrices,16*b);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}();
THREE.SkinnedMesh=function(a,b,c){THREE.Mesh.call(this,a,b);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new THREE.Matrix4;this.bindMatrixInverse=new THREE.Matrix4;a=[];if(this.geometry&&void 0!==this.geometry.bones){for(var d,e,f,g,h=0,k=this.geometry.bones.length;h<k;++h)d=this.geometry.bones[h],e=d.pos,f=d.rotq,g=d.scl,b=new THREE.Bone(this),a.push(b),b.name=d.name,b.position.set(e[0],e[1],e[2]),b.quaternion.set(f[0],f[1],f[2],f[3]),void 0!==g?b.scale.set(g[0],g[1],g[2]):b.scale.set(1,
1,1);h=0;for(k=this.geometry.bones.length;h<k;++h)d=this.geometry.bones[h],-1!==d.parent?a[d.parent].add(a[h]):this.add(a[h])}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new THREE.Skeleton(a,void 0,c))};THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.SkinnedMesh.prototype.bind=function(a,b){this.skeleton=a;void 0===b&&(this.updateMatrixWorld(!0),b=this.matrixWorld);this.bindMatrix.copy(b);this.bindMatrixInverse.getInverse(b)};
THREE.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()};THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry)for(var a=0;a<this.geometry.skinIndices.length;a++){var b=this.geometry.skinWeights[a],c=1/b.lengthManhattan();Infinity!==c?b.multiplyScalar(c):b.set(1)}};
THREE.SkinnedMesh.prototype.updateMatrixWorld=function(a){THREE.Mesh.prototype.updateMatrixWorld.call(this,!0);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)};
THREE.SkinnedMesh.prototype.clone=function(a){void 0===a&&(a=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture));THREE.Mesh.prototype.clone.call(this,a);return a};THREE.MorphAnimMesh=function(a,b){THREE.Mesh.call(this,a,b);this.type="MorphAnimMesh";this.duration=1E3;this.mirroredLoop=!1;this.currentKeyframe=this.lastKeyframe=this.time=0;this.direction=1;this.directionBackwards=!1;this.setFrameRange(0,this.geometry.morphTargets.length-1)};THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype);
THREE.MorphAnimMesh.prototype.setFrameRange=function(a,b){this.startKeyframe=a;this.endKeyframe=b;this.length=this.endKeyframe-this.startKeyframe+1};THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=!1};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=!0};
THREE.MorphAnimMesh.prototype.parseAnimations=function(){var a=this.geometry;a.animations||(a.animations={});for(var b,c=a.animations,d=/([a-z]+)_?(\d+)/,e=0,f=a.morphTargets.length;e<f;e++){var g=a.morphTargets[e].name.match(d);if(g&&1<g.length){g=g[1];c[g]||(c[g]={start:Infinity,end:-Infinity});var h=c[g];e<h.start&&(h.start=e);e>h.end&&(h.end=e);b||(b=g)}}a.firstAnimation=b};
THREE.MorphAnimMesh.prototype.setAnimationLabel=function(a,b,c){this.geometry.animations||(this.geometry.animations={});this.geometry.animations[a]={start:b,end:c}};THREE.MorphAnimMesh.prototype.playAnimation=function(a,b){var c=this.geometry.animations[a];c?(this.setFrameRange(c.start,c.end),this.duration=(c.end-c.start)/b*1E3,this.time=0):console.warn("animation["+a+"] undefined")};
THREE.MorphAnimMesh.prototype.updateAnimation=function(a){var b=this.duration/this.length;this.time+=this.direction*a;if(this.mirroredLoop){if(this.time>this.duration||0>this.time)this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)}else this.time%=this.duration,0>this.time&&(this.time+=this.duration);a=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/b),0,this.length-1);a!==this.currentKeyframe&&
(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[a]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=a);b=this.time%b/b;this.directionBackwards&&(b=1-b);this.morphTargetInfluences[this.currentKeyframe]=b;this.morphTargetInfluences[this.lastKeyframe]=1-b};
THREE.MorphAnimMesh.prototype.interpolateTargets=function(a,b,c){for(var d=this.morphTargetInfluences,e=0,f=d.length;e<f;e++)d[e]=0;-1<a&&(d[a]=1-c);-1<b&&(d[b]=c)};
THREE.MorphAnimMesh.prototype.clone=function(a){void 0===a&&(a=new THREE.MorphAnimMesh(this.geometry,this.material));a.duration=this.duration;a.mirroredLoop=this.mirroredLoop;a.time=this.time;a.lastKeyframe=this.lastKeyframe;a.currentKeyframe=this.currentKeyframe;a.direction=this.direction;a.directionBackwards=this.directionBackwards;THREE.Mesh.prototype.clone.call(this,a);return a};THREE.LOD=function(){THREE.Object3D.call(this);this.objects=[]};THREE.LOD.prototype=Object.create(THREE.Object3D.prototype);
THREE.LOD.prototype.addLevel=function(a,b){void 0===b&&(b=0);b=Math.abs(b);for(var c=0;c<this.objects.length&&!(b<this.objects[c].distance);c++);this.objects.splice(c,0,{distance:b,object:a});this.add(a)};THREE.LOD.prototype.getObjectForDistance=function(a){for(var b=1,c=this.objects.length;b<c&&!(a<this.objects[b].distance);b++);return this.objects[b-1].object};
THREE.LOD.prototype.raycast=function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var d=b.ray.origin.distanceTo(a);this.getObjectForDistance(d).raycast(b,c)}}();
THREE.LOD.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){if(1<this.objects.length){a.setFromMatrixPosition(c.matrixWorld);b.setFromMatrixPosition(this.matrixWorld);c=a.distanceTo(b);this.objects[0].object.visible=!0;for(var d=1,e=this.objects.length;d<e;d++)if(c>=this.objects[d].distance)this.objects[d-1].object.visible=!1,this.objects[d].object.visible=!0;else break;for(;d<e;d++)this.objects[d].object.visible=!1}}}();
THREE.LOD.prototype.clone=function(a){void 0===a&&(a=new THREE.LOD);THREE.Object3D.prototype.clone.call(this,a);for(var b=0,c=this.objects.length;b<c;b++){var d=this.objects[b].object.clone();d.visible=0===b;a.addLevel(d,this.objects[b].distance)}return a};
THREE.Sprite=function(){var a=new Uint16Array([0,1,2,0,2,3]),b=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),c=new Float32Array([0,0,1,0,1,1,0,1]),d=new THREE.BufferGeometry;d.addAttribute("index",new THREE.BufferAttribute(a,1));d.addAttribute("position",new THREE.BufferAttribute(b,3));d.addAttribute("uv",new THREE.BufferAttribute(c,2));return function(a){THREE.Object3D.call(this);this.type="Sprite";this.geometry=d;this.material=void 0!==a?a:new THREE.SpriteMaterial}}();
THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype);THREE.Sprite.prototype.raycast=function(){var a=new THREE.Vector3;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var d=b.ray.distanceToPoint(a);d>this.scale.x||c.push({distance:d,point:this.position,face:null,object:this})}}();THREE.Sprite.prototype.clone=function(a){void 0===a&&(a=new THREE.Sprite(this.material));THREE.Object3D.prototype.clone.call(this,a);return a};THREE.Particle=THREE.Sprite;
THREE.LensFlare=function(a,b,c,d,e){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=void 0;void 0!==a&&this.add(a,b,c,d,e)};THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype);
THREE.LensFlare.prototype.add=function(a,b,c,d,e,f){void 0===b&&(b=-1);void 0===c&&(c=0);void 0===f&&(f=1);void 0===e&&(e=new THREE.Color(16777215));void 0===d&&(d=THREE.NormalBlending);c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:a,size:b,distance:c,x:0,y:0,z:0,scale:1,rotation:1,opacity:f,color:e,blending:d})};
THREE.LensFlare.prototype.updateLensFlares=function(){var a,b=this.lensFlares.length,c,d=2*-this.positionScreen.x,e=2*-this.positionScreen.y;for(a=0;a<b;a++)c=this.lensFlares[a],c.x=this.positionScreen.x+d*c.distance,c.y=this.positionScreen.y+e*c.distance,c.wantedRotation=c.x*Math.PI*.25,c.rotation+=.25*(c.wantedRotation-c.rotation)};THREE.Scene=function(){THREE.Object3D.call(this);this.type="Scene";this.overrideMaterial=this.fog=null;this.autoUpdate=!0};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);
THREE.Scene.prototype.clone=function(a){void 0===a&&(a=new THREE.Scene);THREE.Object3D.prototype.clone.call(this,a);null!==this.fog&&(a.fog=this.fog.clone());null!==this.overrideMaterial&&(a.overrideMaterial=this.overrideMaterial.clone());a.autoUpdate=this.autoUpdate;a.matrixAutoUpdate=this.matrixAutoUpdate;return a};THREE.Fog=function(a,b,c){this.name="";this.color=new THREE.Color(a);this.near=void 0!==b?b:1;this.far=void 0!==c?c:1E3};
THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)};THREE.FogExp2=function(a,b){this.name="";this.color=new THREE.Color(a);this.density=void 0!==b?b:2.5E-4};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)};THREE.ShaderChunk={};THREE.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n\tif ( gl_FragColor.a < ALPHATEST ) discard;\n\n#endif\n";THREE.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n\tvec3 dirVector = normalize( lDirection.xyz );\n\n\tfloat dotProduct = dot( transformedNormal, dirVector );\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t#endif\n\n\t#endif\n\n\t#ifdef WRAP_AROUND\n\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n\t\t#endif\n\n\t#endif\n\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n\t#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat lDistance = 1.0;\n\t\tif ( pointLightDistance[ i ] > 0.0 )\n\t\t\tlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n\t\tlVector = normalize( lVector );\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\tfloat lDistance = 1.0;\n\t\t\tif ( spotLightDistance[ i ] > 0.0 )\n\t\t\t\tlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n\t\t\tlVector = normalize( lVector );\n\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n\t\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n\n\t\t\t#endif\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n\t\tvec3 lVector = normalize( lDirection.xyz );\n\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n\t\t#endif\n\n\t}\n\n#endif\n\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n\n#endif";
THREE.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif";THREE.ShaderChunk.default_vertex="vec4 mvPosition;\n\n#ifdef USE_SKINNING\n\n\tmvPosition = modelViewMatrix * skinned;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\n\n\tmvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\n\n\tmvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;";
THREE.ShaderChunk.map_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif";THREE.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\t#ifdef USE_MORPHNORMALS\n\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n\t#else\n\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n\t#endif\n\n#endif\n";
THREE.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif";THREE.ShaderChunk.lightmap_pars_vertex="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\n#endif";THREE.ShaderChunk.lights_phong_fragment="vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef DOUBLE_SIDED\n\n\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tvec3 pointDiffuse = vec3( 0.0 );\n\tvec3 pointSpecular = vec3( 0.0 );\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat lDistance = 1.0;\n\t\tif ( pointLightDistance[ i ] > 0.0 )\n\t\t\tlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n\t\tlVector = normalize( lVector );\n\n\t\t\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\tpointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n\n\t\t\t\t// specular\n\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\tpointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tvec3 spotDiffuse = vec3( 0.0 );\n\tvec3 spotSpecular = vec3( 0.0 );\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat lDistance = 1.0;\n\t\tif ( spotLightDistance[ i ] > 0.0 )\n\t\t\tlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n\t\tlVector = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\t\t\t// diffuse\n\n\t\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t#else\n\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t#endif\n\n\t\t\tspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\n\n\t\t\t\t\t// specular\n\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n\t\t\tspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tvec3 dirDiffuse = vec3( 0.0 );\n\tvec3 dirSpecular = vec3( 0.0 );\n\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n\t\tvec3 dirVector = normalize( lDirection.xyz );\n\n\t\t\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, dirVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\tdirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n\n\t\t// specular\n\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n\t\t/*\n\t\t// fresnel term from skin shader\n\t\tconst float F0 = 0.128;\n\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\n\t\tfloat exponential = pow( base, 5.0 );\n\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\n\t\t*/\n\n\t\t/*\n\t\t// fresnel term from fresnel shader\n\t\tconst float mFresnelBias = 0.08;\n\t\tconst float mFresnelScale = 0.3;\n\t\tconst float mFresnelPower = 5.0;\n\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n\t\t*/\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\tdirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tvec3 hemiDiffuse = vec3( 0.0 );\n\tvec3 hemiSpecular = vec3( 0.0 );\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n\t\tvec3 lVector = normalize( lDirection.xyz );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\themiDiffuse += diffuse * hemiColor;\n\n\t\t// specular (sky light)\n\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n\t\t// specular (ground light)\n\n\t\tvec3 lVectorGround = -lVector;\n\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n\t\themiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n\t}\n\n#endif\n\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n\n#if MAX_DIR_LIGHTS > 0\n\n\ttotalDiffuse += dirDiffuse;\n\ttotalSpecular += dirSpecular;\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\ttotalDiffuse += hemiDiffuse;\n\ttotalSpecular += hemiSpecular;\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\ttotalDiffuse += pointDiffuse;\n\ttotalSpecular += pointSpecular;\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\ttotalDiffuse += spotDiffuse;\n\ttotalSpecular += spotSpecular;\n\n#endif\n\n#ifdef METAL\n\n\tgl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n\n#else\n\n\tgl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n\n#endif";
THREE.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif";THREE.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n\tvec3 morphedNormal = vec3( 0.0 );\n\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n\tmorphedNormal += normal;\n\n#endif";
THREE.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\tuniform samplerCube envMap;\n\tuniform float flipEnvMap;\n\tuniform int combine;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tuniform bool useRefract;\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif";THREE.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif";
THREE.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t\t\t// Per-Pixel Tangent Space Normal Mapping\n\t\t\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n";
THREE.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n";THREE.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\tuniform sampler2D lightMap;\n\n#endif";THREE.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n\t}\n\n#endif";
THREE.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif";THREE.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\t#ifdef GAMMA_INPUT\n\n\t\ttexelColor.xyz *= texelColor.xyz;\n\n\t#endif\n\n\tgl_FragColor = gl_FragColor * texelColor;\n\n#endif";THREE.ShaderChunk.lightmap_vertex="#ifdef USE_LIGHTMAP\n\n\tvUv2 = uv2;\n\n#endif";
THREE.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n\tgl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n\n#endif";THREE.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n";THREE.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n\t#ifdef GAMMA_INPUT\n\n\t\tvColor = color * color;\n\n\t#else\n\n\t\tvColor = color;\n\n\t#endif\n\n#endif";THREE.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n\t#ifdef USE_MORPHTARGETS\n\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n";
THREE.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\tuniform bool useRefract;\n\n#endif\n";THREE.ShaderChunk.linear_to_gamma_fragment="#ifdef GAMMA_OUTPUT\n\n\tgl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n\n#endif";THREE.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif";
THREE.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\n\nuniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n";
THREE.ShaderChunk.map_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n";THREE.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n\tvec3 reflectVec;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\n\t\tvec3 worldNormal = normalize( vec3( vec4( normal, 0.0 ) * viewMatrix ) );\n\n\t\tif ( useRefract ) {\n\n\t\t\treflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t} else { \n\n\t\t\treflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t}\n\n\t#else\n\n\t\treflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\t\tvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#else\n\n\t\tvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#endif\n\n\t#ifdef GAMMA_INPUT\n\n\t\tcubeColor.xyz *= cubeColor.xyz;\n\n\t#endif\n\n\tif ( combine == 1 ) {\n\n\t\tgl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n\n\t} else if ( combine == 2 ) {\n\n\t\tgl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n\n\t} else {\n\n\t\tgl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n\n\t}\n\n#endif";
THREE.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif";THREE.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif";THREE.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif";
THREE.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif";THREE.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tconst float LOG2 = 1.442695;\n\t\tfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\t\n\tgl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n\n#endif";
THREE.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t\t\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n\t\t\t//\thttp://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n\t\t\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif";
THREE.ShaderChunk.defaultnormal_vertex="vec3 objectNormal;\n\n#ifdef USE_SKINNING\n\n\tobjectNormal = skinnedNormal.xyz;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\n\n\tobjectNormal = morphedNormal;\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\n\n\tobjectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;";
THREE.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;";
THREE.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif";THREE.ShaderChunk.map_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif";
THREE.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n\tgl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n\n#endif";THREE.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif";THREE.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n\tgl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n\n#endif";THREE.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n\tvec3 morphed = vec3( 0.0 );\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n\tmorphed += position;\n\n#endif";
THREE.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\n\tworldNormal = normalize( worldNormal );\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\tif ( useRefract ) {\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t} else {\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t}\n\n#endif";
THREE.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n\t#ifdef SHADOWMAP_DEBUG\n\n\t\tvec3 frustumColors[3];\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n\t#endif\n\n\t#ifdef SHADOWMAP_CASCADE\n\n\t\tint inFrustumCount = 0;\n\n\t#endif\n\n\tfloat fDepth;\n\tvec3 shadowColor = vec3( 1.0 );\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\t\t\t// don't shadow pixels outside of light frustum\n\t\t\t\t// use just first frustum (for cascades)\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\n\n\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\tinFrustumCount += int( inFrustum );\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n\t\t#else\n\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\t#endif\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t/*\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n\t\t\t\t\t\t// must enroll loop manually\n\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\t\t\tshadow += 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tshadow /= 9.0;\n\n\t\t*/\n\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\n\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#else\n\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\n\t\t// spot with multiple shadows is darker\n\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n\t\t// spot with multiple shadows has the same color as single shadow spot\n\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n\t\t\t#endif\n\n\t\t}\n\n\n\t\t#ifdef SHADOWMAP_DEBUG\n\n\t\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n\n\t\t\t#else\n\n\t\t\t\tif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t}\n\n\t#ifdef GAMMA_OUTPUT\n\n\t\tshadowColor *= shadowColor;\n\n\t#endif\n\n\tgl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n\n#endif\n";
THREE.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#endif\n\n\t#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n\t#endif\n\n\t#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n#endif";
THREE.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\n\t}\n\n#endif";
THREE.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n";
THREE.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t#extension GL_EXT_frag_depth : enable\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif";THREE.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n\tgl_FragColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n";THREE.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n";
THREE.UniformsUtils={merge:function(a){for(var b={},c=0;c<a.length;c++){var d=this.clone(a[c]),e;for(e in d)b[e]=d[e]}return b},clone:function(a){var b={},c;for(c in a){b[c]={};for(var d in a[c]){var e=a[c][d];b[c][d]=e instanceof THREE.Color||e instanceof THREE.Vector2||e instanceof THREE.Vector3||e instanceof THREE.Vector4||e instanceof THREE.Matrix4||e instanceof THREE.Texture?e.clone():e instanceof Array?e.slice():e}}return b}};
THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",
value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},
hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},
opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:2.5E-4},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2E3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};
THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,
THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"\t#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"\t#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,
THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,
{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,
THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,
THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,
THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = vec4( vec3( 1.0 ), opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"\t#ifdef DOUBLE_SIDED\n\t\tif ( gl_FrontFacing )\n\t\t\tgl_FragColor.xyz *= vLightFront;\n\t\telse\n\t\t\tgl_FragColor.xyz *= vLightBack;\n\t#else\n\t\tgl_FragColor.xyz *= vLightFront;\n\t#endif",
THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},
specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,
THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"\tvNormal = normalize( transformedNormal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"\tvViewPosition = -mvPosition.xyz;",
THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG\nuniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,
THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = vec4( vec3( 1.0 ), opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,
THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,
THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",
THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,
THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,
"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tgl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,
"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2E3},opacity:{type:"f",value:1}},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;\nuniform float mFar;\nuniform float opacity;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,
"\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );\n\tgl_FragColor = vec4( vec3( color ), opacity );\n}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n\tvNormal = normalize( normalMatrix * normal );",
THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vNormal;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",
value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new THREE.Color(16777215)},
specular:{type:"c",value:new THREE.Color(1118481)},ambient:{type:"c",value:new THREE.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform vec2 uNormalScale;\nuniform bool useRefract;\nuniform float refractionRatio;\nuniform float reflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\n\tuniform vec3 wrapRGB;\n#endif\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",
THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"\tgl_FragColor = vec4( vec3( 1.0 ), opacity );\n\tvec3 specularTex = vec3( 1.0 );\n\tvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\n\tnormalTex.xy *= uNormalScale;\n\tnormalTex = normalize( normalTex );\n\tif( enableDiffuse ) {\n\t\t#ifdef GAMMA_INPUT\n\t\t\tvec4 texelColor = texture2D( tDiffuse, vUv );\n\t\t\ttexelColor.xyz *= texelColor.xyz;\n\t\t\tgl_FragColor = gl_FragColor * texelColor;\n\t\t#else\n\t\t\tgl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n\t\t#endif\n\t}\n\tif( enableAO ) {\n\t\t#ifdef GAMMA_INPUT\n\t\t\tvec4 aoColor = texture2D( tAO, vUv );\n\t\t\taoColor.xyz *= aoColor.xyz;\n\t\t\tgl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n\t\t#else\n\t\t\tgl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n\t\t#endif\n\t}",
THREE.ShaderChunk.alphatest_fragment,"\tif( enableSpecular )\n\t\tspecularTex = texture2D( tSpecular, vUv ).xyz;\n\tmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\n\tvec3 finalNormal = tsb * normalTex;\n\t#ifdef FLIP_SIDED\n\t\tfinalNormal = -finalNormal;\n\t#endif\n\tvec3 normal = normalize( finalNormal );\n\tvec3 viewPosition = normalize( vViewPosition );\n\t#if MAX_POINT_LIGHTS > 0\n\t\tvec3 pointDiffuse = vec3( 0.0 );\n\t\tvec3 pointSpecular = vec3( 0.0 );\n\t\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\t\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\t\tvec3 pointVector = lPosition.xyz + vViewPosition.xyz;\n\t\t\tfloat pointDistance = 1.0;\n\t\t\tif ( pointLightDistance[ i ] > 0.0 )\n\t\t\t\tpointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );\n\t\t\tpointVector = normalize( pointVector );\n\t\t\t#ifdef WRAP_AROUND\n\t\t\t\tfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\n\t\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\n\t\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\t\t\t#else\n\t\t\t\tfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n\t\t\t#endif\n\t\t\tpointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;\n\t\t\tvec3 pointHalfVector = normalize( pointVector + viewPosition );\n\t\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\t\tfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( pointVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\t\tpointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n\t\t}\n\t#endif\n\t#if MAX_SPOT_LIGHTS > 0\n\t\tvec3 spotDiffuse = vec3( 0.0 );\n\t\tvec3 spotSpecular = vec3( 0.0 );\n\t\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\t\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\t\tvec3 spotVector = lPosition.xyz + vViewPosition.xyz;\n\t\t\tfloat spotDistance = 1.0;\n\t\t\tif ( spotLightDistance[ i ] > 0.0 )\n\t\t\t\tspotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );\n\t\t\tspotVector = normalize( spotVector );\n\t\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\t\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\t\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\t\t\t\t#ifdef WRAP_AROUND\n\t\t\t\t\tfloat spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );\n\t\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );\n\t\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\t\t\t\t#else\n\t\t\t\t\tfloat spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );\n\t\t\t\t#endif\n\t\t\t\tspotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;\n\t\t\t\tvec3 spotHalfVector = normalize( spotVector + viewPosition );\n\t\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n\t\t\t\tfloat spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\t\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\t\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( spotVector, spotHalfVector ), 0.0 ), 5.0 );\n\t\t\t\tspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;\n\t\t\t}\n\t\t}\n\t#endif\n\t#if MAX_DIR_LIGHTS > 0\n\t\tvec3 dirDiffuse = vec3( 0.0 );\n\t\tvec3 dirSpecular = vec3( 0.0 );\n\t\tfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\n\t\t\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n\t\t\tvec3 dirVector = normalize( lDirection.xyz );\n\t\t\t#ifdef WRAP_AROUND\n\t\t\t\tfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\n\t\t\t\tfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\n\t\t\t\tvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n\t\t\t#else\n\t\t\t\tfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n\t\t\t#endif\n\t\t\tdirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;\n\t\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\t\tfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\t\tdirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\t\t}\n\t#endif\n\t#if MAX_HEMI_LIGHTS > 0\n\t\tvec3 hemiDiffuse = vec3( 0.0 );\n\t\tvec3 hemiSpecular = vec3( 0.0 );\n\t\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\t\t\tvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n\t\t\tvec3 lVector = normalize( lDirection.xyz );\n\t\t\tfloat dotProduct = dot( normal, lVector );\n\t\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\t\t\themiDiffuse += diffuse * hemiColor;\n\t\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n\t\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n\t\t\tfloat hemiSpecularWeightSky = specularTex.r * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\t\t\tvec3 lVectorGround = -lVector;\n\t\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n\t\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n\t\t\tfloat hemiSpecularWeightGround = specularTex.r * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\t\t\tfloat dotProductGround = dot( normal, lVectorGround );\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\t\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n\t\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n\t\t\themiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\t\t}\n\t#endif\n\tvec3 totalDiffuse = vec3( 0.0 );\n\tvec3 totalSpecular = vec3( 0.0 );\n\t#if MAX_DIR_LIGHTS > 0\n\t\ttotalDiffuse += dirDiffuse;\n\t\ttotalSpecular += dirSpecular;\n\t#endif\n\t#if MAX_HEMI_LIGHTS > 0\n\t\ttotalDiffuse += hemiDiffuse;\n\t\ttotalSpecular += hemiSpecular;\n\t#endif\n\t#if MAX_POINT_LIGHTS > 0\n\t\ttotalDiffuse += pointDiffuse;\n\t\ttotalSpecular += pointSpecular;\n\t#endif\n\t#if MAX_SPOT_LIGHTS > 0\n\t\ttotalDiffuse += spotDiffuse;\n\t\ttotalSpecular += spotSpecular;\n\t#endif\n\t#ifdef METAL\n\t\tgl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );\n\t#else\n\t\tgl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n\t#endif\n\tif ( enableReflection ) {\n\t\tvec3 vReflect;\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tif ( useRefract ) {\n\t\t\tvReflect = refract( cameraToVertex, normal, refractionRatio );\n\t\t} else {\n\t\t\tvReflect = reflect( cameraToVertex, normal );\n\t\t}\n\t\tvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n\t\t#ifdef GAMMA_INPUT\n\t\t\tcubeColor.xyz *= cubeColor.xyz;\n\t\t#endif\n\t\tgl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );\n\t}",
THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\nuniform bool enableDisplacement;\n#ifdef VERTEX_TEXTURES\n\tuniform sampler2D tDisplacement;\n\tuniform float uDisplacementScale;\n\tuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",
THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,"\t#ifdef USE_SKINNING\n\t\tvNormal = normalize( normalMatrix * skinnedNormal.xyz );\n\t\tvec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );\n\t\tvTangent = normalize( normalMatrix * skinnedTangent.xyz );\n\t#else\n\t\tvNormal = normalize( normalMatrix * normal );\n\t\tvTangent = normalize( normalMatrix * tangent.xyz );\n\t#endif\n\tvBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );\n\tvUv = uv * uRepeat + uOffset;\n\tvec3 displacedPosition;\n\t#ifdef VERTEX_TEXTURES\n\t\tif ( enableDisplacement ) {\n\t\t\tvec3 dv = texture2D( tDisplacement, uv ).xyz;\n\t\t\tfloat df = uDisplacementScale * dv.x + uDisplacementBias;\n\t\t\tdisplacedPosition = position + normalize( normal ) * df;\n\t\t} else {\n\t\t\t#ifdef USE_SKINNING\n\t\t\t\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\t\t\t\tvec4 skinned = vec4( 0.0 );\n\t\t\t\tskinned += boneMatX * skinVertex * skinWeight.x;\n\t\t\t\tskinned += boneMatY * skinVertex * skinWeight.y;\n\t\t\t\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\t\t\t\tskinned += boneMatW * skinVertex * skinWeight.w;\n\t\t\t\tskinned  = bindMatrixInverse * skinned;\n\t\t\t\tdisplacedPosition = skinned.xyz;\n\t\t\t#else\n\t\t\t\tdisplacedPosition = position;\n\t\t\t#endif\n\t\t}\n\t#else\n\t\t#ifdef USE_SKINNING\n\t\t\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\t\t\tvec4 skinned = vec4( 0.0 );\n\t\t\tskinned += boneMatX * skinVertex * skinWeight.x;\n\t\t\tskinned += boneMatY * skinVertex * skinWeight.y;\n\t\t\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\t\t\tskinned += boneMatW * skinVertex * skinWeight.w;\n\t\t\tskinned  = bindMatrixInverse * skinned;\n\t\t\tdisplacedPosition = skinned.xyz;\n\t\t#else\n\t\t\tdisplacedPosition = position;\n\t\t#endif\n\t#endif\n\tvec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );\n\tvec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;",
THREE.ShaderChunk.logdepthbuf_vertex,"\tvWorldPosition = worldPosition.xyz;\n\tvViewPosition = -mvPosition.xyz;\n\t#ifdef USE_SHADOWMAP\n\t\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\t\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\t\t}\n\t#endif\n}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\tvWorldPosition = worldPosition.xyz;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",
THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,
"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[THREE.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {\n\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}\nvoid main() {",
THREE.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\n\t#else\n\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n\t#endif\n}"].join("\n")}};
THREE.WebGLRenderer=function(a){function b(a){var b=a.geometry;a=a.material;var c=b.vertices.length;if(a.attributes){void 0===b.__webglCustomAttributesList&&(b.__webglCustomAttributesList=[]);for(var d in a.attributes){var e=a.attributes[d];if(!e.__webglInitialized||e.createUniqueBuffers){e.__webglInitialized=!0;var f=1;"v2"===e.type?f=2:"v3"===e.type?f=3:"v4"===e.type?f=4:"c"===e.type&&(f=3);e.size=f;e.array=new Float32Array(c*f);e.buffer=l.createBuffer();e.buffer.belongsToAttribute=d;e.needsUpdate=
!0}b.__webglCustomAttributesList.push(e)}}}function c(a,b){var c=b.geometry,e=a.faces3,f=3*e.length,g=1*e.length,h=3*e.length,e=d(b,a);a.__vertexArray=new Float32Array(3*f);a.__normalArray=new Float32Array(3*f);a.__colorArray=new Float32Array(3*f);a.__uvArray=new Float32Array(2*f);1<c.faceVertexUvs.length&&(a.__uv2Array=new Float32Array(2*f));c.hasTangents&&(a.__tangentArray=new Float32Array(4*f));b.geometry.skinWeights.length&&b.geometry.skinIndices.length&&(a.__skinIndexArray=new Float32Array(4*
f),a.__skinWeightArray=new Float32Array(4*f));c=null!==pa.get("OES_element_index_uint")&&21845<g?Uint32Array:Uint16Array;a.__typeArray=c;a.__faceArray=new c(3*g);a.__lineArray=new c(2*h);var k;if(a.numMorphTargets)for(a.__morphTargetsArrays=[],c=0,k=a.numMorphTargets;c<k;c++)a.__morphTargetsArrays.push(new Float32Array(3*f));if(a.numMorphNormals)for(a.__morphNormalsArrays=[],c=0,k=a.numMorphNormals;c<k;c++)a.__morphNormalsArrays.push(new Float32Array(3*f));a.__webglFaceCount=3*g;a.__webglLineCount=
2*h;if(e.attributes){void 0===a.__webglCustomAttributesList&&(a.__webglCustomAttributesList=[]);for(var m in e.attributes){var g=e.attributes[m],h={},n;for(n in g)h[n]=g[n];if(!h.__webglInitialized||h.createUniqueBuffers)h.__webglInitialized=!0,c=1,"v2"===h.type?c=2:"v3"===h.type?c=3:"v4"===h.type?c=4:"c"===h.type&&(c=3),h.size=c,h.array=new Float32Array(f*c),h.buffer=l.createBuffer(),h.buffer.belongsToAttribute=m,g.needsUpdate=!0,h.__original=g;a.__webglCustomAttributesList.push(h)}}a.__inittedArrays=
!0}function d(a,b){return a.material instanceof THREE.MeshFaceMaterial?a.material.materials[b.materialIndex]:a.material}function e(a,b,c,d){c=c.attributes;var e=b.attributes;b=b.attributesKeys;for(var f=0,k=b.length;f<k;f++){var m=b[f],n=e[m];if(0<=n){var p=c[m];void 0!==p?(m=p.itemSize,l.bindBuffer(l.ARRAY_BUFFER,p.buffer),g(n),l.vertexAttribPointer(n,m,l.FLOAT,!1,0,d*m*4)):void 0!==a.defaultAttributeValues&&(2===a.defaultAttributeValues[m].length?l.vertexAttrib2fv(n,a.defaultAttributeValues[m]):
3===a.defaultAttributeValues[m].length&&l.vertexAttrib3fv(n,a.defaultAttributeValues[m]))}}h()}function f(){for(var a=0,b=wb.length;a<b;a++)wb[a]=0}function g(a){wb[a]=1;0===ib[a]&&(l.enableVertexAttribArray(a),ib[a]=1)}function h(){for(var a=0,b=ib.length;a<b;a++)ib[a]!==wb[a]&&(l.disableVertexAttribArray(a),ib[a]=0)}function k(a,b){return a.material.id!==b.material.id?b.material.id-a.material.id:a.z!==b.z?b.z-a.z:a.id-b.id}function n(a,b){return a.z!==b.z?a.z-b.z:a.id-b.id}function p(a,b){return b[0]-
a[0]}function q(a,e){if(!1!==e.visible){if(!(e instanceof THREE.Scene||e instanceof THREE.Group)){void 0===e.__webglInit&&(e.__webglInit=!0,e._modelViewMatrix=new THREE.Matrix4,e._normalMatrix=new THREE.Matrix3,e.addEventListener("removed",Hc));var f=e.geometry;if(void 0!==f&&void 0===f.__webglInit&&(f.__webglInit=!0,f.addEventListener("dispose",Ic),!(f instanceof THREE.BufferGeometry)))if(e instanceof THREE.Mesh)s(a,e,f);else if(e instanceof THREE.Line){if(void 0===f.__webglVertexBuffer){f.__webglVertexBuffer=
l.createBuffer();f.__webglColorBuffer=l.createBuffer();f.__webglLineDistanceBuffer=l.createBuffer();J.info.memory.geometries++;var g=f.vertices.length;f.__vertexArray=new Float32Array(3*g);f.__colorArray=new Float32Array(3*g);f.__lineDistanceArray=new Float32Array(1*g);f.__webglLineCount=g;b(e);f.verticesNeedUpdate=!0;f.colorsNeedUpdate=!0;f.lineDistancesNeedUpdate=!0}}else if(e instanceof THREE.PointCloud&&void 0===f.__webglVertexBuffer){f.__webglVertexBuffer=l.createBuffer();f.__webglColorBuffer=
l.createBuffer();J.info.memory.geometries++;var h=f.vertices.length;f.__vertexArray=new Float32Array(3*h);f.__colorArray=new Float32Array(3*h);f.__sortArray=[];f.__webglParticleCount=h;b(e);f.verticesNeedUpdate=!0;f.colorsNeedUpdate=!0}if(void 0===e.__webglActive)if(e.__webglActive=!0,e instanceof THREE.Mesh)if(f instanceof THREE.BufferGeometry)u(ob,f,e);else{if(f instanceof THREE.Geometry)for(var k=xb[f.id],m=0,n=k.length;m<n;m++)u(ob,k[m],e)}else e instanceof THREE.Line||e instanceof THREE.PointCloud?
u(ob,f,e):(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback)&&jb.push({id:null,object:e,opaque:null,transparent:null,z:0});if(e instanceof THREE.Light)cb.push(e);else if(e instanceof THREE.Sprite)yb.push(e);else if(e instanceof THREE.LensFlare)Ra.push(e);else{var t=ob[e.id];if(t&&(!1===e.frustumCulled||!0===Ec.intersectsObject(e))){var r=e.geometry,w,G;if(r instanceof THREE.BufferGeometry)for(var x=r.attributes,D=r.attributesKeys,E=0,B=D.length;E<B;E++){var A=D[E],K=x[A];void 0===
K.buffer&&(K.buffer=l.createBuffer(),K.needsUpdate=!0);if(!0===K.needsUpdate){var F="index"===A?l.ELEMENT_ARRAY_BUFFER:l.ARRAY_BUFFER;l.bindBuffer(F,K.buffer);l.bufferData(F,K.array,l.STATIC_DRAW);K.needsUpdate=!1}}else if(e instanceof THREE.Mesh){!0===r.groupsNeedUpdate&&s(a,e,r);for(var H=xb[r.id],O=0,Q=H.length;O<Q;O++){var R=H[O];G=d(e,R);!0===r.groupsNeedUpdate&&c(R,e);w=G.attributes&&v(G);if(r.verticesNeedUpdate||r.morphTargetsNeedUpdate||r.elementsNeedUpdate||r.uvsNeedUpdate||r.normalsNeedUpdate||
r.colorsNeedUpdate||r.tangentsNeedUpdate||w){var C=R,P=e,S=l.DYNAMIC_DRAW,T=!r.dynamic,X=G;if(C.__inittedArrays){var bb=X&&void 0!==X.shading&&X.shading===THREE.SmoothShading,M=void 0,ea=void 0,Y=void 0,ca=void 0,ma=void 0,pa=void 0,sa=void 0,Fa=void 0,la=void 0,hb=void 0,za=void 0,aa=void 0,$=void 0,Z=void 0,ya=void 0,qa=void 0,L=void 0,Ga=void 0,na=void 0,nc=void 0,ia=void 0,oc=void 0,pc=void 0,qc=void 0,Ba=void 0,zb=void 0,Ab=void 0,Ha=void 0,Bb=void 0,Aa=void 0,va=void 0,Cb=void 0,Oa=void 0,Qb=
void 0,Ma=void 0,ib=void 0,Ya=void 0,Za=void 0,uc=void 0,Rb=void 0,db=0,eb=0,qb=0,rb=0,Db=0,Sa=0,Ca=0,Pa=0,Ka=0,ja=0,ta=0,I=0,Ia=void 0,Qa=C.__vertexArray,sb=C.__uvArray,fb=C.__uv2Array,Ta=C.__normalArray,ra=C.__tangentArray,La=C.__colorArray,Ua=C.__skinIndexArray,Va=C.__skinWeightArray,Eb=C.__morphTargetsArrays,Jc=C.__morphNormalsArrays,Kb=C.__webglCustomAttributesList,z=void 0,Sb=C.__faceArray,Ja=C.__lineArray,wa=P.geometry,$a=wa.elementsNeedUpdate,Kc=wa.uvsNeedUpdate,ec=wa.normalsNeedUpdate,da=
wa.tangentsNeedUpdate,wb=wa.colorsNeedUpdate,U=wa.morphTargetsNeedUpdate,fa=wa.vertices,N=C.faces3,xa=wa.faces,ua=wa.faceVertexUvs[0],Lc=wa.faceVertexUvs[1],Fc=wa.skinIndices,Tb=wa.skinWeights,kb=wa.morphTargets,Da=wa.morphNormals;if(wa.verticesNeedUpdate){M=0;for(ea=N.length;M<ea;M++)ca=xa[N[M]],aa=fa[ca.a],$=fa[ca.b],Z=fa[ca.c],Qa[eb]=aa.x,Qa[eb+1]=aa.y,Qa[eb+2]=aa.z,Qa[eb+3]=$.x,Qa[eb+4]=$.y,Qa[eb+5]=$.z,Qa[eb+6]=Z.x,Qa[eb+7]=Z.y,Qa[eb+8]=Z.z,eb+=9;l.bindBuffer(l.ARRAY_BUFFER,C.__webglVertexBuffer);
l.bufferData(l.ARRAY_BUFFER,Qa,S)}if(U)for(Ma=0,ib=kb.length;Ma<ib;Ma++){M=ta=0;for(ea=N.length;M<ea;M++)uc=N[M],ca=xa[uc],aa=kb[Ma].vertices[ca.a],$=kb[Ma].vertices[ca.b],Z=kb[Ma].vertices[ca.c],Ya=Eb[Ma],Ya[ta]=aa.x,Ya[ta+1]=aa.y,Ya[ta+2]=aa.z,Ya[ta+3]=$.x,Ya[ta+4]=$.y,Ya[ta+5]=$.z,Ya[ta+6]=Z.x,Ya[ta+7]=Z.y,Ya[ta+8]=Z.z,X.morphNormals&&(bb?(Rb=Da[Ma].vertexNormals[uc],Ga=Rb.a,na=Rb.b,nc=Rb.c):nc=na=Ga=Da[Ma].faceNormals[uc],Za=Jc[Ma],Za[ta]=Ga.x,Za[ta+1]=Ga.y,Za[ta+2]=Ga.z,Za[ta+3]=na.x,Za[ta+4]=
na.y,Za[ta+5]=na.z,Za[ta+6]=nc.x,Za[ta+7]=nc.y,Za[ta+8]=nc.z),ta+=9;l.bindBuffer(l.ARRAY_BUFFER,C.__webglMorphTargetsBuffers[Ma]);l.bufferData(l.ARRAY_BUFFER,Eb[Ma],S);X.morphNormals&&(l.bindBuffer(l.ARRAY_BUFFER,C.__webglMorphNormalsBuffers[Ma]),l.bufferData(l.ARRAY_BUFFER,Jc[Ma],S))}if(Tb.length){M=0;for(ea=N.length;M<ea;M++)ca=xa[N[M]],qc=Tb[ca.a],Ba=Tb[ca.b],zb=Tb[ca.c],Va[ja]=qc.x,Va[ja+1]=qc.y,Va[ja+2]=qc.z,Va[ja+3]=qc.w,Va[ja+4]=Ba.x,Va[ja+5]=Ba.y,Va[ja+6]=Ba.z,Va[ja+7]=Ba.w,Va[ja+8]=zb.x,
Va[ja+9]=zb.y,Va[ja+10]=zb.z,Va[ja+11]=zb.w,Ab=Fc[ca.a],Ha=Fc[ca.b],Bb=Fc[ca.c],Ua[ja]=Ab.x,Ua[ja+1]=Ab.y,Ua[ja+2]=Ab.z,Ua[ja+3]=Ab.w,Ua[ja+4]=Ha.x,Ua[ja+5]=Ha.y,Ua[ja+6]=Ha.z,Ua[ja+7]=Ha.w,Ua[ja+8]=Bb.x,Ua[ja+9]=Bb.y,Ua[ja+10]=Bb.z,Ua[ja+11]=Bb.w,ja+=12;0<ja&&(l.bindBuffer(l.ARRAY_BUFFER,C.__webglSkinIndicesBuffer),l.bufferData(l.ARRAY_BUFFER,Ua,S),l.bindBuffer(l.ARRAY_BUFFER,C.__webglSkinWeightsBuffer),l.bufferData(l.ARRAY_BUFFER,Va,S))}if(wb){M=0;for(ea=N.length;M<ea;M++)ca=xa[N[M]],sa=ca.vertexColors,
Fa=ca.color,3===sa.length&&X.vertexColors===THREE.VertexColors?(ia=sa[0],oc=sa[1],pc=sa[2]):pc=oc=ia=Fa,La[Ka]=ia.r,La[Ka+1]=ia.g,La[Ka+2]=ia.b,La[Ka+3]=oc.r,La[Ka+4]=oc.g,La[Ka+5]=oc.b,La[Ka+6]=pc.r,La[Ka+7]=pc.g,La[Ka+8]=pc.b,Ka+=9;0<Ka&&(l.bindBuffer(l.ARRAY_BUFFER,C.__webglColorBuffer),l.bufferData(l.ARRAY_BUFFER,La,S))}if(da&&wa.hasTangents){M=0;for(ea=N.length;M<ea;M++)ca=xa[N[M]],la=ca.vertexTangents,ya=la[0],qa=la[1],L=la[2],ra[Ca]=ya.x,ra[Ca+1]=ya.y,ra[Ca+2]=ya.z,ra[Ca+3]=ya.w,ra[Ca+4]=qa.x,
ra[Ca+5]=qa.y,ra[Ca+6]=qa.z,ra[Ca+7]=qa.w,ra[Ca+8]=L.x,ra[Ca+9]=L.y,ra[Ca+10]=L.z,ra[Ca+11]=L.w,Ca+=12;l.bindBuffer(l.ARRAY_BUFFER,C.__webglTangentBuffer);l.bufferData(l.ARRAY_BUFFER,ra,S)}if(ec){M=0;for(ea=N.length;M<ea;M++)if(ca=xa[N[M]],ma=ca.vertexNormals,pa=ca.normal,3===ma.length&&bb)for(Aa=0;3>Aa;Aa++)Cb=ma[Aa],Ta[Sa]=Cb.x,Ta[Sa+1]=Cb.y,Ta[Sa+2]=Cb.z,Sa+=3;else for(Aa=0;3>Aa;Aa++)Ta[Sa]=pa.x,Ta[Sa+1]=pa.y,Ta[Sa+2]=pa.z,Sa+=3;l.bindBuffer(l.ARRAY_BUFFER,C.__webglNormalBuffer);l.bufferData(l.ARRAY_BUFFER,
Ta,S)}if(Kc&&ua){M=0;for(ea=N.length;M<ea;M++)if(Y=N[M],hb=ua[Y],void 0!==hb)for(Aa=0;3>Aa;Aa++)Oa=hb[Aa],sb[qb]=Oa.x,sb[qb+1]=Oa.y,qb+=2;0<qb&&(l.bindBuffer(l.ARRAY_BUFFER,C.__webglUVBuffer),l.bufferData(l.ARRAY_BUFFER,sb,S))}if(Kc&&Lc){M=0;for(ea=N.length;M<ea;M++)if(Y=N[M],za=Lc[Y],void 0!==za)for(Aa=0;3>Aa;Aa++)Qb=za[Aa],fb[rb]=Qb.x,fb[rb+1]=Qb.y,rb+=2;0<rb&&(l.bindBuffer(l.ARRAY_BUFFER,C.__webglUV2Buffer),l.bufferData(l.ARRAY_BUFFER,fb,S))}if($a){M=0;for(ea=N.length;M<ea;M++)Sb[Db]=db,Sb[Db+
1]=db+1,Sb[Db+2]=db+2,Db+=3,Ja[Pa]=db,Ja[Pa+1]=db+1,Ja[Pa+2]=db,Ja[Pa+3]=db+2,Ja[Pa+4]=db+1,Ja[Pa+5]=db+2,Pa+=6,db+=3;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,C.__webglFaceBuffer);l.bufferData(l.ELEMENT_ARRAY_BUFFER,Sb,S);l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,C.__webglLineBuffer);l.bufferData(l.ELEMENT_ARRAY_BUFFER,Ja,S)}if(Kb)for(Aa=0,va=Kb.length;Aa<va;Aa++)if(z=Kb[Aa],z.__original.needsUpdate){I=0;if(1===z.size)if(void 0===z.boundTo||"vertices"===z.boundTo)for(M=0,ea=N.length;M<ea;M++)ca=xa[N[M]],z.array[I]=
z.value[ca.a],z.array[I+1]=z.value[ca.b],z.array[I+2]=z.value[ca.c],I+=3;else{if("faces"===z.boundTo)for(M=0,ea=N.length;M<ea;M++)Ia=z.value[N[M]],z.array[I]=Ia,z.array[I+1]=Ia,z.array[I+2]=Ia,I+=3}else if(2===z.size)if(void 0===z.boundTo||"vertices"===z.boundTo)for(M=0,ea=N.length;M<ea;M++)ca=xa[N[M]],aa=z.value[ca.a],$=z.value[ca.b],Z=z.value[ca.c],z.array[I]=aa.x,z.array[I+1]=aa.y,z.array[I+2]=$.x,z.array[I+3]=$.y,z.array[I+4]=Z.x,z.array[I+5]=Z.y,I+=6;else{if("faces"===z.boundTo)for(M=0,ea=N.length;M<
ea;M++)Z=$=aa=Ia=z.value[N[M]],z.array[I]=aa.x,z.array[I+1]=aa.y,z.array[I+2]=$.x,z.array[I+3]=$.y,z.array[I+4]=Z.x,z.array[I+5]=Z.y,I+=6}else if(3===z.size){var ka;ka="c"===z.type?["r","g","b"]:["x","y","z"];if(void 0===z.boundTo||"vertices"===z.boundTo)for(M=0,ea=N.length;M<ea;M++)ca=xa[N[M]],aa=z.value[ca.a],$=z.value[ca.b],Z=z.value[ca.c],z.array[I]=aa[ka[0]],z.array[I+1]=aa[ka[1]],z.array[I+2]=aa[ka[2]],z.array[I+3]=$[ka[0]],z.array[I+4]=$[ka[1]],z.array[I+5]=$[ka[2]],z.array[I+6]=Z[ka[0]],z.array[I+
7]=Z[ka[1]],z.array[I+8]=Z[ka[2]],I+=9;else if("faces"===z.boundTo)for(M=0,ea=N.length;M<ea;M++)Z=$=aa=Ia=z.value[N[M]],z.array[I]=aa[ka[0]],z.array[I+1]=aa[ka[1]],z.array[I+2]=aa[ka[2]],z.array[I+3]=$[ka[0]],z.array[I+4]=$[ka[1]],z.array[I+5]=$[ka[2]],z.array[I+6]=Z[ka[0]],z.array[I+7]=Z[ka[1]],z.array[I+8]=Z[ka[2]],I+=9;else if("faceVertices"===z.boundTo)for(M=0,ea=N.length;M<ea;M++)Ia=z.value[N[M]],aa=Ia[0],$=Ia[1],Z=Ia[2],z.array[I]=aa[ka[0]],z.array[I+1]=aa[ka[1]],z.array[I+2]=aa[ka[2]],z.array[I+
3]=$[ka[0]],z.array[I+4]=$[ka[1]],z.array[I+5]=$[ka[2]],z.array[I+6]=Z[ka[0]],z.array[I+7]=Z[ka[1]],z.array[I+8]=Z[ka[2]],I+=9}else if(4===z.size)if(void 0===z.boundTo||"vertices"===z.boundTo)for(M=0,ea=N.length;M<ea;M++)ca=xa[N[M]],aa=z.value[ca.a],$=z.value[ca.b],Z=z.value[ca.c],z.array[I]=aa.x,z.array[I+1]=aa.y,z.array[I+2]=aa.z,z.array[I+3]=aa.w,z.array[I+4]=$.x,z.array[I+5]=$.y,z.array[I+6]=$.z,z.array[I+7]=$.w,z.array[I+8]=Z.x,z.array[I+9]=Z.y,z.array[I+10]=Z.z,z.array[I+11]=Z.w,I+=12;else if("faces"===
z.boundTo)for(M=0,ea=N.length;M<ea;M++)Z=$=aa=Ia=z.value[N[M]],z.array[I]=aa.x,z.array[I+1]=aa.y,z.array[I+2]=aa.z,z.array[I+3]=aa.w,z.array[I+4]=$.x,z.array[I+5]=$.y,z.array[I+6]=$.z,z.array[I+7]=$.w,z.array[I+8]=Z.x,z.array[I+9]=Z.y,z.array[I+10]=Z.z,z.array[I+11]=Z.w,I+=12;else if("faceVertices"===z.boundTo)for(M=0,ea=N.length;M<ea;M++)Ia=z.value[N[M]],aa=Ia[0],$=Ia[1],Z=Ia[2],z.array[I]=aa.x,z.array[I+1]=aa.y,z.array[I+2]=aa.z,z.array[I+3]=aa.w,z.array[I+4]=$.x,z.array[I+5]=$.y,z.array[I+6]=$.z,
z.array[I+7]=$.w,z.array[I+8]=Z.x,z.array[I+9]=Z.y,z.array[I+10]=Z.z,z.array[I+11]=Z.w,I+=12;l.bindBuffer(l.ARRAY_BUFFER,z.buffer);l.bufferData(l.ARRAY_BUFFER,z.array,S)}T&&(delete C.__inittedArrays,delete C.__colorArray,delete C.__normalArray,delete C.__tangentArray,delete C.__uvArray,delete C.__uv2Array,delete C.__faceArray,delete C.__vertexArray,delete C.__lineArray,delete C.__skinIndexArray,delete C.__skinWeightArray)}}}r.verticesNeedUpdate=!1;r.morphTargetsNeedUpdate=!1;r.elementsNeedUpdate=
!1;r.uvsNeedUpdate=!1;r.normalsNeedUpdate=!1;r.colorsNeedUpdate=!1;r.tangentsNeedUpdate=!1;G.attributes&&y(G)}else if(e instanceof THREE.Line){G=d(e,r);w=G.attributes&&v(G);if(r.verticesNeedUpdate||r.colorsNeedUpdate||r.lineDistancesNeedUpdate||w){var Zb=l.DYNAMIC_DRAW,ab,Fb,gb,$b,ga,vc,dc=r.vertices,fc=r.colors,Pb=r.lineDistances,kc=dc.length,lc=fc.length,mc=Pb.length,wc=r.__vertexArray,xc=r.__colorArray,jc=r.__lineDistanceArray,sc=r.colorsNeedUpdate,tc=r.lineDistancesNeedUpdate,gc=r.__webglCustomAttributesList,
yc,Lb,Ea,hc,Wa,oa;if(r.verticesNeedUpdate){for(ab=0;ab<kc;ab++)$b=dc[ab],ga=3*ab,wc[ga]=$b.x,wc[ga+1]=$b.y,wc[ga+2]=$b.z;l.bindBuffer(l.ARRAY_BUFFER,r.__webglVertexBuffer);l.bufferData(l.ARRAY_BUFFER,wc,Zb)}if(sc){for(Fb=0;Fb<lc;Fb++)vc=fc[Fb],ga=3*Fb,xc[ga]=vc.r,xc[ga+1]=vc.g,xc[ga+2]=vc.b;l.bindBuffer(l.ARRAY_BUFFER,r.__webglColorBuffer);l.bufferData(l.ARRAY_BUFFER,xc,Zb)}if(tc){for(gb=0;gb<mc;gb++)jc[gb]=Pb[gb];l.bindBuffer(l.ARRAY_BUFFER,r.__webglLineDistanceBuffer);l.bufferData(l.ARRAY_BUFFER,
jc,Zb)}if(gc)for(yc=0,Lb=gc.length;yc<Lb;yc++)if(oa=gc[yc],oa.needsUpdate&&(void 0===oa.boundTo||"vertices"===oa.boundTo)){ga=0;hc=oa.value.length;if(1===oa.size)for(Ea=0;Ea<hc;Ea++)oa.array[Ea]=oa.value[Ea];else if(2===oa.size)for(Ea=0;Ea<hc;Ea++)Wa=oa.value[Ea],oa.array[ga]=Wa.x,oa.array[ga+1]=Wa.y,ga+=2;else if(3===oa.size)if("c"===oa.type)for(Ea=0;Ea<hc;Ea++)Wa=oa.value[Ea],oa.array[ga]=Wa.r,oa.array[ga+1]=Wa.g,oa.array[ga+2]=Wa.b,ga+=3;else for(Ea=0;Ea<hc;Ea++)Wa=oa.value[Ea],oa.array[ga]=Wa.x,
oa.array[ga+1]=Wa.y,oa.array[ga+2]=Wa.z,ga+=3;else if(4===oa.size)for(Ea=0;Ea<hc;Ea++)Wa=oa.value[Ea],oa.array[ga]=Wa.x,oa.array[ga+1]=Wa.y,oa.array[ga+2]=Wa.z,oa.array[ga+3]=Wa.w,ga+=4;l.bindBuffer(l.ARRAY_BUFFER,oa.buffer);l.bufferData(l.ARRAY_BUFFER,oa.array,Zb)}}r.verticesNeedUpdate=!1;r.colorsNeedUpdate=!1;r.lineDistancesNeedUpdate=!1;G.attributes&&y(G)}else if(e instanceof THREE.PointCloud){G=d(e,r);w=G.attributes&&v(G);if(r.verticesNeedUpdate||r.colorsNeedUpdate||e.sortParticles||w){var Mb=
l.DYNAMIC_DRAW,Xa,tb,ub,W,vb,Ub,zc=r.vertices,pb=zc.length,Nb=r.colors,Ob=Nb.length,ac=r.__vertexArray,bc=r.__colorArray,Gb=r.__sortArray,Xb=r.verticesNeedUpdate,Yb=r.colorsNeedUpdate,Hb=r.__webglCustomAttributesList,lb,ic,ba,mb,ha,V;if(e.sortParticles){Gc.copy(Ac);Gc.multiply(e.matrixWorld);for(Xa=0;Xa<pb;Xa++)ub=zc[Xa],Na.copy(ub),Na.applyProjection(Gc),Gb[Xa]=[Na.z,Xa];Gb.sort(p);for(Xa=0;Xa<pb;Xa++)ub=zc[Gb[Xa][1]],W=3*Xa,ac[W]=ub.x,ac[W+1]=ub.y,ac[W+2]=ub.z;for(tb=0;tb<Ob;tb++)W=3*tb,Ub=Nb[Gb[tb][1]],
bc[W]=Ub.r,bc[W+1]=Ub.g,bc[W+2]=Ub.b;if(Hb)for(lb=0,ic=Hb.length;lb<ic;lb++)if(V=Hb[lb],void 0===V.boundTo||"vertices"===V.boundTo)if(W=0,mb=V.value.length,1===V.size)for(ba=0;ba<mb;ba++)vb=Gb[ba][1],V.array[ba]=V.value[vb];else if(2===V.size)for(ba=0;ba<mb;ba++)vb=Gb[ba][1],ha=V.value[vb],V.array[W]=ha.x,V.array[W+1]=ha.y,W+=2;else if(3===V.size)if("c"===V.type)for(ba=0;ba<mb;ba++)vb=Gb[ba][1],ha=V.value[vb],V.array[W]=ha.r,V.array[W+1]=ha.g,V.array[W+2]=ha.b,W+=3;else for(ba=0;ba<mb;ba++)vb=Gb[ba][1],
ha=V.value[vb],V.array[W]=ha.x,V.array[W+1]=ha.y,V.array[W+2]=ha.z,W+=3;else if(4===V.size)for(ba=0;ba<mb;ba++)vb=Gb[ba][1],ha=V.value[vb],V.array[W]=ha.x,V.array[W+1]=ha.y,V.array[W+2]=ha.z,V.array[W+3]=ha.w,W+=4}else{if(Xb)for(Xa=0;Xa<pb;Xa++)ub=zc[Xa],W=3*Xa,ac[W]=ub.x,ac[W+1]=ub.y,ac[W+2]=ub.z;if(Yb)for(tb=0;tb<Ob;tb++)Ub=Nb[tb],W=3*tb,bc[W]=Ub.r,bc[W+1]=Ub.g,bc[W+2]=Ub.b;if(Hb)for(lb=0,ic=Hb.length;lb<ic;lb++)if(V=Hb[lb],V.needsUpdate&&(void 0===V.boundTo||"vertices"===V.boundTo))if(mb=V.value.length,
W=0,1===V.size)for(ba=0;ba<mb;ba++)V.array[ba]=V.value[ba];else if(2===V.size)for(ba=0;ba<mb;ba++)ha=V.value[ba],V.array[W]=ha.x,V.array[W+1]=ha.y,W+=2;else if(3===V.size)if("c"===V.type)for(ba=0;ba<mb;ba++)ha=V.value[ba],V.array[W]=ha.r,V.array[W+1]=ha.g,V.array[W+2]=ha.b,W+=3;else for(ba=0;ba<mb;ba++)ha=V.value[ba],V.array[W]=ha.x,V.array[W+1]=ha.y,V.array[W+2]=ha.z,W+=3;else if(4===V.size)for(ba=0;ba<mb;ba++)ha=V.value[ba],V.array[W]=ha.x,V.array[W+1]=ha.y,V.array[W+2]=ha.z,V.array[W+3]=ha.w,W+=
4}if(Xb||e.sortParticles)l.bindBuffer(l.ARRAY_BUFFER,r.__webglVertexBuffer),l.bufferData(l.ARRAY_BUFFER,ac,Mb);if(Yb||e.sortParticles)l.bindBuffer(l.ARRAY_BUFFER,r.__webglColorBuffer),l.bufferData(l.ARRAY_BUFFER,bc,Mb);if(Hb)for(lb=0,ic=Hb.length;lb<ic;lb++)if(V=Hb[lb],V.needsUpdate||e.sortParticles)l.bindBuffer(l.ARRAY_BUFFER,V.buffer),l.bufferData(l.ARRAY_BUFFER,V.array,Mb)}r.verticesNeedUpdate=!1;r.colorsNeedUpdate=!1;G.attributes&&y(G)}for(var cc=0,nb=t.length;cc<nb;cc++){var Bc=t[cc],Vb=Bc,rc=
Vb.object,Cc=Vb.buffer,Dc=rc.geometry,Wb=rc.material;Wb instanceof THREE.MeshFaceMaterial?(Wb=Wb.materials[Dc instanceof THREE.BufferGeometry?0:Cc.materialIndex],Vb.material=Wb,Wb.transparent?Ib.push(Vb):Jb.push(Vb)):Wb&&(Vb.material=Wb,Wb.transparent?Ib.push(Vb):Jb.push(Vb));Bc.render=!0;!0===J.sortObjects&&(null!==e.renderDepth?Bc.z=e.renderDepth:(Na.setFromMatrixPosition(e.matrixWorld),Na.applyProjection(Ac),Bc.z=Na.z))}}}}cc=0;for(nb=e.children.length;cc<nb;cc++)q(a,e.children[cc])}}function m(a,
b,c,d,e,f){for(var g,h=a.length-1;-1!==h;h--){g=a[h];var k=g.object,l=g.buffer;x(k,b);if(f)g=f;else{g=g.material;if(!g)continue;e&&J.setBlending(g.blending,g.blendEquation,g.blendSrc,g.blendDst);J.setDepthTest(g.depthTest);J.setDepthWrite(g.depthWrite);B(g.polygonOffset,g.polygonOffsetFactor,g.polygonOffsetUnits)}J.setMaterialFaces(g);l instanceof THREE.BufferGeometry?J.renderBufferDirect(b,c,d,g,l,k):J.renderBuffer(b,c,d,g,l,k)}}function r(a,b,c,d,e,f,g){for(var h,k=0,l=a.length;k<l;k++){h=a[k];
var m=h.object;if(m.visible){if(g)h=g;else{h=h[b];if(!h)continue;f&&J.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst);J.setDepthTest(h.depthTest);J.setDepthWrite(h.depthWrite);B(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}J.renderImmediateObject(c,d,e,h,m)}}}function t(a){var b=a.object.material;b.transparent?(a.transparent=b,a.opaque=null):(a.opaque=b,a.transparent=null)}function s(a,b,d){var e=b.material,f=!1;if(void 0===xb[d.id]||!0===d.groupsNeedUpdate){delete ob[b.id];
a=xb;for(var g=d.id,e=e instanceof THREE.MeshFaceMaterial,h=pa.get("OES_element_index_uint")?4294967296:65535,k,f={},m=d.morphTargets.length,n=d.morphNormals.length,p,r={},q=[],t=0,s=d.faces.length;t<s;t++){k=d.faces[t];var v=e?k.materialIndex:0;v in f||(f[v]={hash:v,counter:0});k=f[v].hash+"_"+f[v].counter;k in r||(p={id:rc++,faces3:[],materialIndex:v,vertices:0,numMorphTargets:m,numMorphNormals:n},r[k]=p,q.push(p));r[k].vertices+3>h&&(f[v].counter+=1,k=f[v].hash+"_"+f[v].counter,k in r||(p={id:rc++,
faces3:[],materialIndex:v,vertices:0,numMorphTargets:m,numMorphNormals:n},r[k]=p,q.push(p)));r[k].faces3.push(t);r[k].vertices+=3}a[g]=q;d.groupsNeedUpdate=!1}a=xb[d.id];g=0;for(e=a.length;g<e;g++){h=a[g];if(void 0===h.__webglVertexBuffer){f=h;f.__webglVertexBuffer=l.createBuffer();f.__webglNormalBuffer=l.createBuffer();f.__webglTangentBuffer=l.createBuffer();f.__webglColorBuffer=l.createBuffer();f.__webglUVBuffer=l.createBuffer();f.__webglUV2Buffer=l.createBuffer();f.__webglSkinIndicesBuffer=l.createBuffer();
f.__webglSkinWeightsBuffer=l.createBuffer();f.__webglFaceBuffer=l.createBuffer();f.__webglLineBuffer=l.createBuffer();n=m=void 0;if(f.numMorphTargets)for(f.__webglMorphTargetsBuffers=[],m=0,n=f.numMorphTargets;m<n;m++)f.__webglMorphTargetsBuffers.push(l.createBuffer());if(f.numMorphNormals)for(f.__webglMorphNormalsBuffers=[],m=0,n=f.numMorphNormals;m<n;m++)f.__webglMorphNormalsBuffers.push(l.createBuffer());J.info.memory.geometries++;c(h,b);d.verticesNeedUpdate=!0;d.morphTargetsNeedUpdate=!0;d.elementsNeedUpdate=
!0;d.uvsNeedUpdate=!0;d.normalsNeedUpdate=!0;d.tangentsNeedUpdate=!0;f=d.colorsNeedUpdate=!0}else f=!1;(f||void 0===b.__webglActive)&&u(ob,h,b)}b.__webglActive=!0}function u(a,b,c){var d=c.id;a[d]=a[d]||[];a[d].push({id:d,buffer:b,object:c,material:null,z:0})}function v(a){for(var b in a.attributes)if(a.attributes[b].needsUpdate)return!0;return!1}function y(a){for(var b in a.attributes)a.attributes[b].needsUpdate=!1}function G(a,b,c,d,e){var f,g,h,k;dc=0;if(d.needsUpdate){d.program&&Cc(d);d.addEventListener("dispose",
Dc);var m;d instanceof THREE.MeshDepthMaterial?m="depth":d instanceof THREE.MeshNormalMaterial?m="normal":d instanceof THREE.MeshBasicMaterial?m="basic":d instanceof THREE.MeshLambertMaterial?m="lambert":d instanceof THREE.MeshPhongMaterial?m="phong":d instanceof THREE.LineBasicMaterial?m="basic":d instanceof THREE.LineDashedMaterial?m="dashed":d instanceof THREE.PointCloudMaterial&&(m="particle_basic");if(m){var n=THREE.ShaderLib[m];d.__webglShader={uniforms:THREE.UniformsUtils.clone(n.uniforms),
vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}}else d.__webglShader={uniforms:d.uniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader};for(var p=0,r=0,q=0,t=0,s=0,u=b.length;s<u;s++){var v=b[s];v.onlyShadow||!1===v.visible||(v instanceof THREE.DirectionalLight&&p++,v instanceof THREE.PointLight&&r++,v instanceof THREE.SpotLight&&q++,v instanceof THREE.HemisphereLight&&t++)}f=p;g=r;h=q;k=t;for(var y,G=0,x=0,B=b.length;x<B;x++){var A=b[x];A.castShadow&&(A instanceof THREE.SpotLight&&
G++,A instanceof THREE.DirectionalLight&&!A.shadowCascade&&G++)}y=G;var C;if(jc&&e&&e.skeleton&&e.skeleton.useVertexTexture)C=1024;else{var H=l.getParameter(l.MAX_VERTEX_UNIFORM_VECTORS),S=Math.floor((H-20)/4);void 0!==e&&e instanceof THREE.SkinnedMesh&&(S=Math.min(e.skeleton.bones.length,S),S<e.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+S+" (try OpenGL instead of ANGLE)"));C=S}var P={precision:X,supportsVertexTextures:sc,
map:!!d.map,envMap:!!d.envMap,lightMap:!!d.lightMap,bumpMap:!!d.bumpMap,normalMap:!!d.normalMap,specularMap:!!d.specularMap,alphaMap:!!d.alphaMap,vertexColors:d.vertexColors,fog:c,useFog:d.fog,fogExp:c instanceof THREE.FogExp2,sizeAttenuation:d.sizeAttenuation,logarithmicDepthBuffer:Fa,skinning:d.skinning,maxBones:C,useVertexTexture:jc&&e&&e.skeleton&&e.skeleton.useVertexTexture,morphTargets:d.morphTargets,morphNormals:d.morphNormals,maxMorphTargets:J.maxMorphTargets,maxMorphNormals:J.maxMorphNormals,
maxDirLights:f,maxPointLights:g,maxSpotLights:h,maxHemiLights:k,maxShadows:y,shadowMapEnabled:J.shadowMapEnabled&&e.receiveShadow&&0<y,shadowMapType:J.shadowMapType,shadowMapDebug:J.shadowMapDebug,shadowMapCascade:J.shadowMapCascade,alphaTest:d.alphaTest,metal:d.metal,wrapAround:d.wrapAround,doubleSided:d.side===THREE.DoubleSide,flipSided:d.side===THREE.BackSide},T=[];m?T.push(m):(T.push(d.fragmentShader),T.push(d.vertexShader));if(void 0!==d.defines)for(var bb in d.defines)T.push(bb),T.push(d.defines[bb]);
for(bb in P)T.push(bb),T.push(P[bb]);for(var M=T.join(),Y,jb=0,ca=hb.length;jb<ca;jb++){var cb=hb[jb];if(cb.code===M){Y=cb;Y.usedTimes++;break}}void 0===Y&&(Y=new THREE.WebGLProgram(J,M,d,P),hb.push(Y),J.info.memory.programs=hb.length);d.program=Y;var ob=Y.attributes;if(d.morphTargets){d.numSupportedMorphTargets=0;for(var ma,pa="morphTarget",la=0;la<J.maxMorphTargets;la++)ma=pa+la,0<=ob[ma]&&d.numSupportedMorphTargets++}if(d.morphNormals)for(d.numSupportedMorphNormals=0,pa="morphNormal",la=0;la<J.maxMorphNormals;la++)ma=
pa+la,0<=ob[ma]&&d.numSupportedMorphNormals++;d.uniformsList=[];for(var Jb in d.__webglShader.uniforms){var za=d.program.uniforms[Jb];za&&d.uniformsList.push([d.__webglShader.uniforms[Jb],za])}d.needsUpdate=!1}d.morphTargets&&!e.__webglMorphTargetInfluences&&(e.__webglMorphTargetInfluences=new Float32Array(J.maxMorphTargets));var aa=!1,$=!1,Z=!1,yb=d.program,qa=yb.uniforms,L=d.__webglShader.uniforms;yb.id!==tc&&(l.useProgram(yb.program),tc=yb.id,Z=$=aa=!0);d.id!==Kb&&(-1===Kb&&(Z=!0),Kb=d.id,$=!0);
if(aa||a!==ec)l.uniformMatrix4fv(qa.projectionMatrix,!1,a.projectionMatrix.elements),Fa&&l.uniform1f(qa.logDepthBufFC,2/(Math.log(a.far+1)/Math.LN2)),a!==ec&&(ec=a),(d instanceof THREE.ShaderMaterial||d instanceof THREE.MeshPhongMaterial||d.envMap)&&null!==qa.cameraPosition&&(Na.setFromMatrixPosition(a.matrixWorld),l.uniform3f(qa.cameraPosition,Na.x,Na.y,Na.z)),(d instanceof THREE.MeshPhongMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.ShaderMaterial||d.skinning)&&null!==qa.viewMatrix&&
l.uniformMatrix4fv(qa.viewMatrix,!1,a.matrixWorldInverse.elements);if(d.skinning)if(e.bindMatrix&&null!==qa.bindMatrix&&l.uniformMatrix4fv(qa.bindMatrix,!1,e.bindMatrix.elements),e.bindMatrixInverse&&null!==qa.bindMatrixInverse&&l.uniformMatrix4fv(qa.bindMatrixInverse,!1,e.bindMatrixInverse.elements),jc&&e.skeleton&&e.skeleton.useVertexTexture){if(null!==qa.boneTexture){var Ib=K();l.uniform1i(qa.boneTexture,Ib);J.setTexture(e.skeleton.boneTexture,Ib)}null!==qa.boneTextureWidth&&l.uniform1i(qa.boneTextureWidth,
e.skeleton.boneTextureWidth);null!==qa.boneTextureHeight&&l.uniform1i(qa.boneTextureHeight,e.skeleton.boneTextureHeight)}else e.skeleton&&e.skeleton.boneMatrices&&null!==qa.boneGlobalMatrices&&l.uniformMatrix4fv(qa.boneGlobalMatrices,!1,e.skeleton.boneMatrices);if($){c&&d.fog&&(L.fogColor.value=c.color,c instanceof THREE.Fog?(L.fogNear.value=c.near,L.fogFar.value=c.far):c instanceof THREE.FogExp2&&(L.fogDensity.value=c.density));if(d instanceof THREE.MeshPhongMaterial||d instanceof THREE.MeshLambertMaterial||
d.lights){if(fc){var Z=!0,na,Ra,ia,ya=0,Ga=0,Oa=0,Ba,zb,Ab,Ha,Bb,Aa,va=Mc,Cb=va.directional.colors,ib=va.directional.positions,Qb=va.point.colors,Ma=va.point.positions,xb=va.point.distances,Ya=va.spot.colors,Za=va.spot.positions,Mb=va.spot.distances,Rb=va.spot.directions,db=va.spot.anglesCos,eb=va.spot.exponents,qb=va.hemi.skyColors,rb=va.hemi.groundColors,Db=va.hemi.positions,Sa=0,Ca=0,Pa=0,Ka=0,ja=0,ta=0,I=0,Ia=0,Qa=0,sb=0,fb=0,Ta=0;na=0;for(Ra=b.length;na<Ra;na++)ia=b[na],ia.onlyShadow||(Ba=ia.color,
Ha=ia.intensity,Aa=ia.distance,ia instanceof THREE.AmbientLight?ia.visible&&(J.gammaInput?(ya+=Ba.r*Ba.r,Ga+=Ba.g*Ba.g,Oa+=Ba.b*Ba.b):(ya+=Ba.r,Ga+=Ba.g,Oa+=Ba.b)):ia instanceof THREE.DirectionalLight?(ja+=1,ia.visible&&(sa.setFromMatrixPosition(ia.matrixWorld),Na.setFromMatrixPosition(ia.target.matrixWorld),sa.sub(Na),sa.normalize(),Qa=3*Sa,ib[Qa]=sa.x,ib[Qa+1]=sa.y,ib[Qa+2]=sa.z,J.gammaInput?D(Cb,Qa,Ba,Ha*Ha):E(Cb,Qa,Ba,Ha),Sa+=1)):ia instanceof THREE.PointLight?(ta+=1,ia.visible&&(sb=3*Ca,J.gammaInput?
D(Qb,sb,Ba,Ha*Ha):E(Qb,sb,Ba,Ha),Na.setFromMatrixPosition(ia.matrixWorld),Ma[sb]=Na.x,Ma[sb+1]=Na.y,Ma[sb+2]=Na.z,xb[Ca]=Aa,Ca+=1)):ia instanceof THREE.SpotLight?(I+=1,ia.visible&&(fb=3*Pa,J.gammaInput?D(Ya,fb,Ba,Ha*Ha):E(Ya,fb,Ba,Ha),sa.setFromMatrixPosition(ia.matrixWorld),Za[fb]=sa.x,Za[fb+1]=sa.y,Za[fb+2]=sa.z,Mb[Pa]=Aa,Na.setFromMatrixPosition(ia.target.matrixWorld),sa.sub(Na),sa.normalize(),Rb[fb]=sa.x,Rb[fb+1]=sa.y,Rb[fb+2]=sa.z,db[Pa]=Math.cos(ia.angle),eb[Pa]=ia.exponent,Pa+=1)):ia instanceof
THREE.HemisphereLight&&(Ia+=1,ia.visible&&(sa.setFromMatrixPosition(ia.matrixWorld),sa.normalize(),Ta=3*Ka,Db[Ta]=sa.x,Db[Ta+1]=sa.y,Db[Ta+2]=sa.z,zb=ia.color,Ab=ia.groundColor,J.gammaInput?(Bb=Ha*Ha,D(qb,Ta,zb,Bb),D(rb,Ta,Ab,Bb)):(E(qb,Ta,zb,Ha),E(rb,Ta,Ab,Ha)),Ka+=1)));na=3*Sa;for(Ra=Math.max(Cb.length,3*ja);na<Ra;na++)Cb[na]=0;na=3*Ca;for(Ra=Math.max(Qb.length,3*ta);na<Ra;na++)Qb[na]=0;na=3*Pa;for(Ra=Math.max(Ya.length,3*I);na<Ra;na++)Ya[na]=0;na=3*Ka;for(Ra=Math.max(qb.length,3*Ia);na<Ra;na++)qb[na]=
0;na=3*Ka;for(Ra=Math.max(rb.length,3*Ia);na<Ra;na++)rb[na]=0;va.directional.length=Sa;va.point.length=Ca;va.spot.length=Pa;va.hemi.length=Ka;va.ambient[0]=ya;va.ambient[1]=Ga;va.ambient[2]=Oa;fc=!1}if(Z){var ra=Mc;L.ambientLightColor.value=ra.ambient;L.directionalLightColor.value=ra.directional.colors;L.directionalLightDirection.value=ra.directional.positions;L.pointLightColor.value=ra.point.colors;L.pointLightPosition.value=ra.point.positions;L.pointLightDistance.value=ra.point.distances;L.spotLightColor.value=
ra.spot.colors;L.spotLightPosition.value=ra.spot.positions;L.spotLightDistance.value=ra.spot.distances;L.spotLightDirection.value=ra.spot.directions;L.spotLightAngleCos.value=ra.spot.anglesCos;L.spotLightExponent.value=ra.spot.exponents;L.hemisphereLightSkyColor.value=ra.hemi.skyColors;L.hemisphereLightGroundColor.value=ra.hemi.groundColors;L.hemisphereLightDirection.value=ra.hemi.positions;w(L,!0)}else w(L,!1)}if(d instanceof THREE.MeshBasicMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof
THREE.MeshPhongMaterial){L.opacity.value=d.opacity;J.gammaInput?L.diffuse.value.copyGammaToLinear(d.color):L.diffuse.value=d.color;L.map.value=d.map;L.lightMap.value=d.lightMap;L.specularMap.value=d.specularMap;L.alphaMap.value=d.alphaMap;d.bumpMap&&(L.bumpMap.value=d.bumpMap,L.bumpScale.value=d.bumpScale);d.normalMap&&(L.normalMap.value=d.normalMap,L.normalScale.value.copy(d.normalScale));var La;d.map?La=d.map:d.specularMap?La=d.specularMap:d.normalMap?La=d.normalMap:d.bumpMap?La=d.bumpMap:d.alphaMap&&
(La=d.alphaMap);if(void 0!==La){var Ua=La.offset,Va=La.repeat;L.offsetRepeat.value.set(Ua.x,Ua.y,Va.x,Va.y)}L.envMap.value=d.envMap;L.flipEnvMap.value=d.envMap instanceof THREE.WebGLRenderTargetCube?1:-1;L.reflectivity.value=d.reflectivity;L.refractionRatio.value=d.refractionRatio;L.combine.value=d.combine;L.useRefract.value=d.envMap&&d.envMap.mapping instanceof THREE.CubeRefractionMapping}d instanceof THREE.LineBasicMaterial?(L.diffuse.value=d.color,L.opacity.value=d.opacity):d instanceof THREE.LineDashedMaterial?
(L.diffuse.value=d.color,L.opacity.value=d.opacity,L.dashSize.value=d.dashSize,L.totalSize.value=d.dashSize+d.gapSize,L.scale.value=d.scale):d instanceof THREE.PointCloudMaterial?(L.psColor.value=d.color,L.opacity.value=d.opacity,L.size.value=d.size,L.scale.value=O.height/2,L.map.value=d.map):d instanceof THREE.MeshPhongMaterial?(L.shininess.value=d.shininess,J.gammaInput?(L.ambient.value.copyGammaToLinear(d.ambient),L.emissive.value.copyGammaToLinear(d.emissive),L.specular.value.copyGammaToLinear(d.specular)):
(L.ambient.value=d.ambient,L.emissive.value=d.emissive,L.specular.value=d.specular),d.wrapAround&&L.wrapRGB.value.copy(d.wrapRGB)):d instanceof THREE.MeshLambertMaterial?(J.gammaInput?(L.ambient.value.copyGammaToLinear(d.ambient),L.emissive.value.copyGammaToLinear(d.emissive)):(L.ambient.value=d.ambient,L.emissive.value=d.emissive),d.wrapAround&&L.wrapRGB.value.copy(d.wrapRGB)):d instanceof THREE.MeshDepthMaterial?(L.mNear.value=a.near,L.mFar.value=a.far,L.opacity.value=d.opacity):d instanceof THREE.MeshNormalMaterial&&
(L.opacity.value=d.opacity);if(e.receiveShadow&&!d._shadowPass&&L.shadowMatrix)for(var Eb=0,pb=0,Nb=b.length;pb<Nb;pb++){var z=b[pb];z.castShadow&&(z instanceof THREE.SpotLight||z instanceof THREE.DirectionalLight&&!z.shadowCascade)&&(L.shadowMap.value[Eb]=z.shadowMap,L.shadowMapSize.value[Eb]=z.shadowMapSize,L.shadowMatrix.value[Eb]=z.shadowMatrix,L.shadowDarkness.value[Eb]=z.shadowDarkness,L.shadowBias.value[Eb]=z.shadowBias,Eb++)}for(var Sb=d.uniformsList,Ja,wa,$a,nb=0,Pb=Sb.length;nb<Pb;nb++){var da=
Sb[nb][0];if(!1!==da.needsUpdate){var wb=da.type,U=da.value,fa=Sb[nb][1];switch(wb){case "1i":l.uniform1i(fa,U);break;case "1f":l.uniform1f(fa,U);break;case "2f":l.uniform2f(fa,U[0],U[1]);break;case "3f":l.uniform3f(fa,U[0],U[1],U[2]);break;case "4f":l.uniform4f(fa,U[0],U[1],U[2],U[3]);break;case "1iv":l.uniform1iv(fa,U);break;case "3iv":l.uniform3iv(fa,U);break;case "1fv":l.uniform1fv(fa,U);break;case "2fv":l.uniform2fv(fa,U);break;case "3fv":l.uniform3fv(fa,U);break;case "4fv":l.uniform4fv(fa,U);
break;case "Matrix3fv":l.uniformMatrix3fv(fa,!1,U);break;case "Matrix4fv":l.uniformMatrix4fv(fa,!1,U);break;case "i":l.uniform1i(fa,U);break;case "f":l.uniform1f(fa,U);break;case "v2":l.uniform2f(fa,U.x,U.y);break;case "v3":l.uniform3f(fa,U.x,U.y,U.z);break;case "v4":l.uniform4f(fa,U.x,U.y,U.z,U.w);break;case "c":l.uniform3f(fa,U.r,U.g,U.b);break;case "iv1":l.uniform1iv(fa,U);break;case "iv":l.uniform3iv(fa,U);break;case "fv1":l.uniform1fv(fa,U);break;case "fv":l.uniform3fv(fa,U);break;case "v2v":void 0===
da._array&&(da._array=new Float32Array(2*U.length));for(var N=0,xa=U.length;N<xa;N++)$a=2*N,da._array[$a]=U[N].x,da._array[$a+1]=U[N].y;l.uniform2fv(fa,da._array);break;case "v3v":void 0===da._array&&(da._array=new Float32Array(3*U.length));N=0;for(xa=U.length;N<xa;N++)$a=3*N,da._array[$a]=U[N].x,da._array[$a+1]=U[N].y,da._array[$a+2]=U[N].z;l.uniform3fv(fa,da._array);break;case "v4v":void 0===da._array&&(da._array=new Float32Array(4*U.length));N=0;for(xa=U.length;N<xa;N++)$a=4*N,da._array[$a]=U[N].x,
da._array[$a+1]=U[N].y,da._array[$a+2]=U[N].z,da._array[$a+3]=U[N].w;l.uniform4fv(fa,da._array);break;case "m3":l.uniformMatrix3fv(fa,!1,U.elements);break;case "m3v":void 0===da._array&&(da._array=new Float32Array(9*U.length));N=0;for(xa=U.length;N<xa;N++)U[N].flattenToArrayOffset(da._array,9*N);l.uniformMatrix3fv(fa,!1,da._array);break;case "m4":l.uniformMatrix4fv(fa,!1,U.elements);break;case "m4v":void 0===da._array&&(da._array=new Float32Array(16*U.length));N=0;for(xa=U.length;N<xa;N++)U[N].flattenToArrayOffset(da._array,
16*N);l.uniformMatrix4fv(fa,!1,da._array);break;case "t":Ja=U;wa=K();l.uniform1i(fa,wa);if(!Ja)continue;if(Ja instanceof THREE.CubeTexture||Ja.image instanceof Array&&6===Ja.image.length){var ua=Ja,Lb=wa;if(6===ua.image.length)if(ua.needsUpdate){ua.image.__webglTextureCube||(ua.addEventListener("dispose",gc),ua.image.__webglTextureCube=l.createTexture(),J.info.memory.textures++);l.activeTexture(l.TEXTURE0+Lb);l.bindTexture(l.TEXTURE_CUBE_MAP,ua.image.__webglTextureCube);l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,
ua.flipY);for(var Ob=ua instanceof THREE.CompressedTexture,Tb=ua.image[0]instanceof THREE.DataTexture,kb=[],Da=0;6>Da;Da++)kb[Da]=!J.autoScaleCubemaps||Ob||Tb?Tb?ua.image[Da].image:ua.image[Da]:R(ua.image[Da],$c);var ka=kb[0],Zb=THREE.Math.isPowerOfTwo(ka.width)&&THREE.Math.isPowerOfTwo(ka.height),ab=Q(ua.format),Fb=Q(ua.type);F(l.TEXTURE_CUBE_MAP,ua,Zb);for(Da=0;6>Da;Da++)if(Ob)for(var gb,$b=kb[Da].mipmaps,ga=0,Xb=$b.length;ga<Xb;ga++)gb=$b[ga],ua.format!==THREE.RGBAFormat&&ua.format!==THREE.RGBFormat?
-1<Nc().indexOf(ab)?l.compressedTexImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+Da,ga,ab,gb.width,gb.height,0,gb.data):console.warn("Attempt to load unsupported compressed texture format"):l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+Da,ga,ab,gb.width,gb.height,0,ab,Fb,gb.data);else Tb?l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+Da,0,ab,kb[Da].width,kb[Da].height,0,ab,Fb,kb[Da].data):l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+Da,0,ab,ab,Fb,kb[Da]);ua.generateMipmaps&&Zb&&l.generateMipmap(l.TEXTURE_CUBE_MAP);
ua.needsUpdate=!1;if(ua.onUpdate)ua.onUpdate()}else l.activeTexture(l.TEXTURE0+Lb),l.bindTexture(l.TEXTURE_CUBE_MAP,ua.image.__webglTextureCube)}else if(Ja instanceof THREE.WebGLRenderTargetCube){var Yb=Ja;l.activeTexture(l.TEXTURE0+wa);l.bindTexture(l.TEXTURE_CUBE_MAP,Yb.__webglTexture)}else J.setTexture(Ja,wa);break;case "tv":void 0===da._array&&(da._array=[]);N=0;for(xa=da.value.length;N<xa;N++)da._array[N]=K();l.uniform1iv(fa,da._array);N=0;for(xa=da.value.length;N<xa;N++)Ja=da.value[N],wa=da._array[N],
Ja&&J.setTexture(Ja,wa);break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+wb)}}}}l.uniformMatrix4fv(qa.modelViewMatrix,!1,e._modelViewMatrix.elements);qa.normalMatrix&&l.uniformMatrix3fv(qa.normalMatrix,!1,e._normalMatrix.elements);null!==qa.modelMatrix&&l.uniformMatrix4fv(qa.modelMatrix,!1,e.matrixWorld.elements);return yb}function w(a,b){a.ambientLightColor.needsUpdate=b;a.directionalLightColor.needsUpdate=b;a.directionalLightDirection.needsUpdate=b;a.pointLightColor.needsUpdate=
b;a.pointLightPosition.needsUpdate=b;a.pointLightDistance.needsUpdate=b;a.spotLightColor.needsUpdate=b;a.spotLightPosition.needsUpdate=b;a.spotLightDistance.needsUpdate=b;a.spotLightDirection.needsUpdate=b;a.spotLightAngleCos.needsUpdate=b;a.spotLightExponent.needsUpdate=b;a.hemisphereLightSkyColor.needsUpdate=b;a.hemisphereLightGroundColor.needsUpdate=b;a.hemisphereLightDirection.needsUpdate=b}function K(){var a=dc;a>=Oc&&console.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+
Oc);dc+=1;return a}function x(a,b){a._modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,a.matrixWorld);a._normalMatrix.getNormalMatrix(a._modelViewMatrix)}function D(a,b,c,d){a[b]=c.r*c.r*d;a[b+1]=c.g*c.g*d;a[b+2]=c.b*c.b*d}function E(a,b,c,d){a[b]=c.r*d;a[b+1]=c.g*d;a[b+2]=c.b*d}function A(a){a!==Pc&&(l.lineWidth(a),Pc=a)}function B(a,b,c){Qc!==a&&(a?l.enable(l.POLYGON_OFFSET_FILL):l.disable(l.POLYGON_OFFSET_FILL),Qc=a);!a||Rc===b&&Sc===c||(l.polygonOffset(b,c),Rc=b,Sc=c)}function F(a,b,c){c?
(l.texParameteri(a,l.TEXTURE_WRAP_S,Q(b.wrapS)),l.texParameteri(a,l.TEXTURE_WRAP_T,Q(b.wrapT)),l.texParameteri(a,l.TEXTURE_MAG_FILTER,Q(b.magFilter)),l.texParameteri(a,l.TEXTURE_MIN_FILTER,Q(b.minFilter))):(l.texParameteri(a,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(a,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(a,l.TEXTURE_MAG_FILTER,T(b.magFilter)),l.texParameteri(a,l.TEXTURE_MIN_FILTER,T(b.minFilter)));(c=pa.get("EXT_texture_filter_anisotropic"))&&b.type!==THREE.FloatType&&(1<b.anisotropy||
b.__oldAnisotropy)&&(l.texParameterf(a,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.anisotropy,J.getMaxAnisotropy())),b.__oldAnisotropy=b.anisotropy)}function R(a,b){if(a.width>b||a.height>b){var c=b/Math.max(a.width,a.height),d=document.createElement("canvas");d.width=Math.floor(a.width*c);d.height=Math.floor(a.height*c);d.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,d.width,d.height);console.log("THREE.WebGLRenderer:",a,"is too big ("+a.width+"x"+a.height+"). Resized to "+d.width+"x"+d.height+
".");return d}return a}function H(a,b){l.bindRenderbuffer(l.RENDERBUFFER,a);b.depthBuffer&&!b.stencilBuffer?(l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_COMPONENT16,b.width,b.height),l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,a)):b.depthBuffer&&b.stencilBuffer?(l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_STENCIL,b.width,b.height),l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.RENDERBUFFER,a)):l.renderbufferStorage(l.RENDERBUFFER,l.RGBA4,b.width,
b.height)}function C(a){a instanceof THREE.WebGLRenderTargetCube?(l.bindTexture(l.TEXTURE_CUBE_MAP,a.__webglTexture),l.generateMipmap(l.TEXTURE_CUBE_MAP),l.bindTexture(l.TEXTURE_CUBE_MAP,null)):(l.bindTexture(l.TEXTURE_2D,a.__webglTexture),l.generateMipmap(l.TEXTURE_2D),l.bindTexture(l.TEXTURE_2D,null))}function T(a){return a===THREE.NearestFilter||a===THREE.NearestMipMapNearestFilter||a===THREE.NearestMipMapLinearFilter?l.NEAREST:l.LINEAR}function Q(a){var b;if(a===THREE.RepeatWrapping)return l.REPEAT;
if(a===THREE.ClampToEdgeWrapping)return l.CLAMP_TO_EDGE;if(a===THREE.MirroredRepeatWrapping)return l.MIRRORED_REPEAT;if(a===THREE.NearestFilter)return l.NEAREST;if(a===THREE.NearestMipMapNearestFilter)return l.NEAREST_MIPMAP_NEAREST;if(a===THREE.NearestMipMapLinearFilter)return l.NEAREST_MIPMAP_LINEAR;if(a===THREE.LinearFilter)return l.LINEAR;if(a===THREE.LinearMipMapNearestFilter)return l.LINEAR_MIPMAP_NEAREST;if(a===THREE.LinearMipMapLinearFilter)return l.LINEAR_MIPMAP_LINEAR;if(a===THREE.UnsignedByteType)return l.UNSIGNED_BYTE;
if(a===THREE.UnsignedShort4444Type)return l.UNSIGNED_SHORT_4_4_4_4;if(a===THREE.UnsignedShort5551Type)return l.UNSIGNED_SHORT_5_5_5_1;if(a===THREE.UnsignedShort565Type)return l.UNSIGNED_SHORT_5_6_5;if(a===THREE.ByteType)return l.BYTE;if(a===THREE.ShortType)return l.SHORT;if(a===THREE.UnsignedShortType)return l.UNSIGNED_SHORT;if(a===THREE.IntType)return l.INT;if(a===THREE.UnsignedIntType)return l.UNSIGNED_INT;if(a===THREE.FloatType)return l.FLOAT;if(a===THREE.AlphaFormat)return l.ALPHA;if(a===THREE.RGBFormat)return l.RGB;
if(a===THREE.RGBAFormat)return l.RGBA;if(a===THREE.LuminanceFormat)return l.LUMINANCE;if(a===THREE.LuminanceAlphaFormat)return l.LUMINANCE_ALPHA;if(a===THREE.AddEquation)return l.FUNC_ADD;if(a===THREE.SubtractEquation)return l.FUNC_SUBTRACT;if(a===THREE.ReverseSubtractEquation)return l.FUNC_REVERSE_SUBTRACT;if(a===THREE.ZeroFactor)return l.ZERO;if(a===THREE.OneFactor)return l.ONE;if(a===THREE.SrcColorFactor)return l.SRC_COLOR;if(a===THREE.OneMinusSrcColorFactor)return l.ONE_MINUS_SRC_COLOR;if(a===
THREE.SrcAlphaFactor)return l.SRC_ALPHA;if(a===THREE.OneMinusSrcAlphaFactor)return l.ONE_MINUS_SRC_ALPHA;if(a===THREE.DstAlphaFactor)return l.DST_ALPHA;if(a===THREE.OneMinusDstAlphaFactor)return l.ONE_MINUS_DST_ALPHA;if(a===THREE.DstColorFactor)return l.DST_COLOR;if(a===THREE.OneMinusDstColorFactor)return l.ONE_MINUS_DST_COLOR;if(a===THREE.SrcAlphaSaturateFactor)return l.SRC_ALPHA_SATURATE;b=pa.get("WEBGL_compressed_texture_s3tc");if(null!==b){if(a===THREE.RGB_S3TC_DXT1_Format)return b.COMPRESSED_RGB_S3TC_DXT1_EXT;
if(a===THREE.RGBA_S3TC_DXT1_Format)return b.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT3_Format)return b.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===THREE.RGBA_S3TC_DXT5_Format)return b.COMPRESSED_RGBA_S3TC_DXT5_EXT}b=pa.get("WEBGL_compressed_texture_pvrtc");if(null!==b){if(a===THREE.RGB_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===THREE.RGB_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===THREE.RGBA_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;
if(a===THREE.RGBA_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}b=pa.get("EXT_blend_minmax");if(null!==b){if(a===THREE.MinEquation)return b.MIN_EXT;if(a===THREE.MaxEquation)return b.MAX_EXT}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION);a=a||{};var O=void 0!==a.canvas?a.canvas:document.createElement("canvas"),S=void 0!==a.context?a.context:null,X=void 0!==a.precision?a.precision:"highp",Y=void 0!==a.alpha?a.alpha:!1,la=void 0!==a.depth?a.depth:!0,ma=void 0!==a.stencil?
a.stencil:!0,ya=void 0!==a.antialias?a.antialias:!1,P=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,Ga=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,Fa=void 0!==a.logarithmicDepthBuffer?a.logarithmicDepthBuffer:!1,za=new THREE.Color(0),bb=0,cb=[],ob={},jb=[],Jb=[],Ib=[],yb=[],Ra=[];this.domElement=O;this.context=null;this.devicePixelRatio=void 0!==a.devicePixelRatio?a.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1;this.sortObjects=this.autoClearStencil=
this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.shadowMapEnabled=this.gammaOutput=this.gammaInput=!1;this.shadowMapType=THREE.PCFShadowMap;this.shadowMapCullFace=THREE.CullFaceFront;this.shadowMapCascade=this.shadowMapDebug=!1;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=!0;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var J=this,hb=[],tc=null,Tc=null,Kb=-1,Oa=-1,ec=null,dc=0,Lb=-1,Mb=-1,pb=-1,Nb=-1,Ob=-1,
Xb=-1,Yb=-1,nb=-1,Qc=null,Rc=null,Sc=null,Pc=null,Pb=0,kc=0,lc=O.width,mc=O.height,Uc=0,Vc=0,wb=new Uint8Array(16),ib=new Uint8Array(16),Ec=new THREE.Frustum,Ac=new THREE.Matrix4,Gc=new THREE.Matrix4,Na=new THREE.Vector3,sa=new THREE.Vector3,fc=!0,Mc={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],
positions:[]}},l;try{var Wc={alpha:Y,depth:la,stencil:ma,antialias:ya,premultipliedAlpha:P,preserveDrawingBuffer:Ga};l=S||O.getContext("webgl",Wc)||O.getContext("experimental-webgl",Wc);if(null===l){if(null!==O.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";throw"Error creating WebGL context.";}}catch(ad){console.error(ad)}void 0===l.getShaderPrecisionFormat&&(l.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var pa=new THREE.WebGLExtensions(l);
pa.get("OES_texture_float");pa.get("OES_texture_float_linear");pa.get("OES_standard_derivatives");Fa&&pa.get("EXT_frag_depth");l.clearColor(0,0,0,1);l.clearDepth(1);l.clearStencil(0);l.enable(l.DEPTH_TEST);l.depthFunc(l.LEQUAL);l.frontFace(l.CCW);l.cullFace(l.BACK);l.enable(l.CULL_FACE);l.enable(l.BLEND);l.blendEquation(l.FUNC_ADD);l.blendFunc(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA);l.viewport(Pb,kc,lc,mc);l.clearColor(za.r,za.g,za.b,bb);this.context=l;var Oc=l.getParameter(l.MAX_TEXTURE_IMAGE_UNITS),
bd=l.getParameter(l.MAX_VERTEX_TEXTURE_IMAGE_UNITS),cd=l.getParameter(l.MAX_TEXTURE_SIZE),$c=l.getParameter(l.MAX_CUBE_MAP_TEXTURE_SIZE),sc=0<bd,jc=sc&&pa.get("OES_texture_float"),dd=l.getShaderPrecisionFormat(l.VERTEX_SHADER,l.HIGH_FLOAT),ed=l.getShaderPrecisionFormat(l.VERTEX_SHADER,l.MEDIUM_FLOAT);l.getShaderPrecisionFormat(l.VERTEX_SHADER,l.LOW_FLOAT);var fd=l.getShaderPrecisionFormat(l.FRAGMENT_SHADER,l.HIGH_FLOAT),gd=l.getShaderPrecisionFormat(l.FRAGMENT_SHADER,l.MEDIUM_FLOAT);l.getShaderPrecisionFormat(l.FRAGMENT_SHADER,
l.LOW_FLOAT);var Nc=function(){var a;return function(){if(void 0!==a)return a;a=[];if(pa.get("WEBGL_compressed_texture_pvrtc")||pa.get("WEBGL_compressed_texture_s3tc"))for(var b=l.getParameter(l.COMPRESSED_TEXTURE_FORMATS),c=0;c<b.length;c++)a.push(b[c]);return a}}(),hd=0<dd.precision&&0<fd.precision,Xc=0<ed.precision&&0<gd.precision;"highp"!==X||hd||(Xc?(X="mediump",console.warn("THREE.WebGLRenderer: highp not supported, using mediump.")):(X="lowp",console.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp.")));
"mediump"!==X||Xc||(X="lowp",console.warn("THREE.WebGLRenderer: mediump not supported, using lowp."));var id=new THREE.ShadowMapPlugin(this,cb,ob,jb),jd=new THREE.SpritePlugin(this,yb),kd=new THREE.LensFlarePlugin(this,Ra);this.getContext=function(){return l};this.supportsVertexTextures=function(){return sc};this.supportsFloatTextures=function(){return pa.get("OES_texture_float")};this.supportsStandardDerivatives=function(){return pa.get("OES_standard_derivatives")};this.supportsCompressedTextureS3TC=
function(){return pa.get("WEBGL_compressed_texture_s3tc")};this.supportsCompressedTexturePVRTC=function(){return pa.get("WEBGL_compressed_texture_pvrtc")};this.supportsBlendMinMax=function(){return pa.get("EXT_blend_minmax")};this.getMaxAnisotropy=function(){var a;return function(){if(void 0!==a)return a;var b=pa.get("EXT_texture_filter_anisotropic");return a=null!==b?l.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}();this.getPrecision=function(){return X};this.setSize=function(a,b,c){O.width=
a*this.devicePixelRatio;O.height=b*this.devicePixelRatio;!1!==c&&(O.style.width=a+"px",O.style.height=b+"px");this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){Pb=a*this.devicePixelRatio;kc=b*this.devicePixelRatio;lc=c*this.devicePixelRatio;mc=d*this.devicePixelRatio;l.viewport(Pb,kc,lc,mc)};this.setScissor=function(a,b,c,d){l.scissor(a*this.devicePixelRatio,b*this.devicePixelRatio,c*this.devicePixelRatio,d*this.devicePixelRatio)};this.enableScissorTest=function(a){a?l.enable(l.SCISSOR_TEST):
l.disable(l.SCISSOR_TEST)};this.setClearColor=function(a,b){za.set(a);bb=void 0!==b?b:1;l.clearColor(za.r,za.g,za.b,bb)};this.setClearColorHex=function(a,b){console.warn("THREE.WebGLRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(a,b)};this.getClearColor=function(){return za};this.getClearAlpha=function(){return bb};this.clear=function(a,b,c){var d=0;if(void 0===a||a)d|=l.COLOR_BUFFER_BIT;if(void 0===b||b)d|=l.DEPTH_BUFFER_BIT;if(void 0===c||c)d|=
l.STENCIL_BUFFER_BIT;l.clear(d)};this.clearColor=function(){l.clear(l.COLOR_BUFFER_BIT)};this.clearDepth=function(){l.clear(l.DEPTH_BUFFER_BIT)};this.clearStencil=function(){l.clear(l.STENCIL_BUFFER_BIT)};this.clearTarget=function(a,b,c,d){this.setRenderTarget(a);this.clear(b,c,d)};this.resetGLState=function(){ec=tc=null;Kb=Oa=Mb=Lb=nb=Yb=pb=-1;fc=!0};var Hc=function(a){a.target.traverse(function(a){a.removeEventListener("remove",Hc);if(a instanceof THREE.Mesh||a instanceof THREE.PointCloud||a instanceof
THREE.Line)delete ob[a.id];else if(a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback)for(var b=jb,c=b.length-1;0<=c;c--)b[c].object===a&&b.splice(c,1);delete a.__webglInit;delete a._modelViewMatrix;delete a._normalMatrix;delete a.__webglActive})},Ic=function(a){a=a.target;a.removeEventListener("dispose",Ic);delete a.__webglInit;if(a instanceof THREE.BufferGeometry){for(var b in a.attributes){var c=a.attributes[b];void 0!==c.buffer&&(l.deleteBuffer(c.buffer),delete c.buffer)}J.info.memory.geometries--}else if(b=
xb[a.id],void 0!==b){for(var c=0,d=b.length;c<d;c++){var e=b[c];if(void 0!==e.numMorphTargets){for(var f=0,g=e.numMorphTargets;f<g;f++)l.deleteBuffer(e.__webglMorphTargetsBuffers[f]);delete e.__webglMorphTargetsBuffers}if(void 0!==e.numMorphNormals){f=0;for(g=e.numMorphNormals;f<g;f++)l.deleteBuffer(e.__webglMorphNormalsBuffers[f]);delete e.__webglMorphNormalsBuffers}Yc(e)}delete xb[a.id]}else Yc(a);Oa=-1},gc=function(a){a=a.target;a.removeEventListener("dispose",gc);a.image&&a.image.__webglTextureCube?
(l.deleteTexture(a.image.__webglTextureCube),delete a.image.__webglTextureCube):void 0!==a.__webglInit&&(l.deleteTexture(a.__webglTexture),delete a.__webglTexture,delete a.__webglInit);J.info.memory.textures--},Zc=function(a){a=a.target;a.removeEventListener("dispose",Zc);if(a&&void 0!==a.__webglTexture){l.deleteTexture(a.__webglTexture);delete a.__webglTexture;if(a instanceof THREE.WebGLRenderTargetCube)for(var b=0;6>b;b++)l.deleteFramebuffer(a.__webglFramebuffer[b]),l.deleteRenderbuffer(a.__webglRenderbuffer[b]);
else l.deleteFramebuffer(a.__webglFramebuffer),l.deleteRenderbuffer(a.__webglRenderbuffer);delete a.__webglFramebuffer;delete a.__webglRenderbuffer}J.info.memory.textures--},Dc=function(a){a=a.target;a.removeEventListener("dispose",Dc);Cc(a)},Yc=function(a){for(var b="__webglVertexBuffer __webglNormalBuffer __webglTangentBuffer __webglColorBuffer __webglUVBuffer __webglUV2Buffer __webglSkinIndicesBuffer __webglSkinWeightsBuffer __webglFaceBuffer __webglLineBuffer __webglLineDistanceBuffer".split(" "),
c=0,d=b.length;c<d;c++){var e=b[c];void 0!==a[e]&&(l.deleteBuffer(a[e]),delete a[e])}if(void 0!==a.__webglCustomAttributesList){for(e in a.__webglCustomAttributesList)l.deleteBuffer(a.__webglCustomAttributesList[e].buffer);delete a.__webglCustomAttributesList}J.info.memory.geometries--},Cc=function(a){var b=a.program.program;if(void 0!==b){a.program=void 0;var c,d,e=!1;a=0;for(c=hb.length;a<c;a++)if(d=hb[a],d.program===b){d.usedTimes--;0===d.usedTimes&&(e=!0);break}if(!0===e){e=[];a=0;for(c=hb.length;a<
c;a++)d=hb[a],d.program!==b&&e.push(d);hb=e;l.deleteProgram(b);J.info.memory.programs--}}};this.renderBufferImmediate=function(a,b,c){f();a.hasPositions&&!a.__webglVertexBuffer&&(a.__webglVertexBuffer=l.createBuffer());a.hasNormals&&!a.__webglNormalBuffer&&(a.__webglNormalBuffer=l.createBuffer());a.hasUvs&&!a.__webglUvBuffer&&(a.__webglUvBuffer=l.createBuffer());a.hasColors&&!a.__webglColorBuffer&&(a.__webglColorBuffer=l.createBuffer());a.hasPositions&&(l.bindBuffer(l.ARRAY_BUFFER,a.__webglVertexBuffer),
l.bufferData(l.ARRAY_BUFFER,a.positionArray,l.DYNAMIC_DRAW),g(b.attributes.position),l.vertexAttribPointer(b.attributes.position,3,l.FLOAT,!1,0,0));if(a.hasNormals){l.bindBuffer(l.ARRAY_BUFFER,a.__webglNormalBuffer);if(c.shading===THREE.FlatShading){var d,e,k,m,n,p,r,q,t,s,v,u=3*a.count;for(v=0;v<u;v+=9)s=a.normalArray,d=s[v],e=s[v+1],k=s[v+2],m=s[v+3],p=s[v+4],q=s[v+5],n=s[v+6],r=s[v+7],t=s[v+8],d=(d+m+n)/3,e=(e+p+r)/3,k=(k+q+t)/3,s[v]=d,s[v+1]=e,s[v+2]=k,s[v+3]=d,s[v+4]=e,s[v+5]=k,s[v+6]=d,s[v+
7]=e,s[v+8]=k}l.bufferData(l.ARRAY_BUFFER,a.normalArray,l.DYNAMIC_DRAW);g(b.attributes.normal);l.vertexAttribPointer(b.attributes.normal,3,l.FLOAT,!1,0,0)}a.hasUvs&&c.map&&(l.bindBuffer(l.ARRAY_BUFFER,a.__webglUvBuffer),l.bufferData(l.ARRAY_BUFFER,a.uvArray,l.DYNAMIC_DRAW),g(b.attributes.uv),l.vertexAttribPointer(b.attributes.uv,2,l.FLOAT,!1,0,0));a.hasColors&&c.vertexColors!==THREE.NoColors&&(l.bindBuffer(l.ARRAY_BUFFER,a.__webglColorBuffer),l.bufferData(l.ARRAY_BUFFER,a.colorArray,l.DYNAMIC_DRAW),
g(b.attributes.color),l.vertexAttribPointer(b.attributes.color,3,l.FLOAT,!1,0,0));h();l.drawArrays(l.TRIANGLES,0,a.count);a.count=0};this.renderBufferDirect=function(a,b,c,d,g,h){if(!1!==d.visible)if(a=G(a,b,c,d,h),b=!1,c=16777215*g.id+2*a.id+(d.wireframe?1:0),c!==Oa&&(Oa=c,b=!0),b&&f(),h instanceof THREE.Mesh)if(h=!0===d.wireframe?l.LINES:l.TRIANGLES,c=g.attributes.index){var k,m;c.array instanceof Uint32Array&&pa.get("OES_element_index_uint")?(k=l.UNSIGNED_INT,m=4):(k=l.UNSIGNED_SHORT,m=2);var n=
g.offsets;if(0===n.length)b&&(e(d,a,g,0),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,c.buffer)),l.drawElements(h,c.array.length,k,0),J.info.render.calls++,J.info.render.vertices+=c.array.length,J.info.render.faces+=c.array.length/3;else{b=!0;for(var p=0,r=n.length;p<r;p++){var q=n[p].index;b&&(e(d,a,g,q),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,c.buffer));l.drawElements(h,n[p].count,k,n[p].start*m);J.info.render.calls++;J.info.render.vertices+=n[p].count;J.info.render.faces+=n[p].count/3}}}else b&&e(d,a,g,0),
d=g.attributes.position,l.drawArrays(h,0,d.array.length/3),J.info.render.calls++,J.info.render.vertices+=d.array.length/3,J.info.render.faces+=d.array.length/9;else if(h instanceof THREE.PointCloud)b&&e(d,a,g,0),d=g.attributes.position,l.drawArrays(l.POINTS,0,d.array.length/3),J.info.render.calls++,J.info.render.points+=d.array.length/3;else if(h instanceof THREE.Line)if(h=h.mode===THREE.LineStrip?l.LINE_STRIP:l.LINES,A(d.linewidth),c=g.attributes.index)if(c.array instanceof Uint32Array?(k=l.UNSIGNED_INT,
m=4):(k=l.UNSIGNED_SHORT,m=2),n=g.offsets,0===n.length)b&&(e(d,a,g,0),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,c.buffer)),l.drawElements(h,c.array.length,k,0),J.info.render.calls++,J.info.render.vertices+=c.array.length;else for(1<n.length&&(b=!0),p=0,r=n.length;p<r;p++)q=n[p].index,b&&(e(d,a,g,q),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,c.buffer)),l.drawElements(h,n[p].count,k,n[p].start*m),J.info.render.calls++,J.info.render.vertices+=n[p].count;else b&&e(d,a,g,0),d=g.attributes.position,l.drawArrays(h,0,
d.array.length/3),J.info.render.calls++,J.info.render.points+=d.array.length/3};this.renderBuffer=function(a,b,c,d,e,k){if(!1!==d.visible){c=G(a,b,c,d,k);b=c.attributes;a=!1;c=16777215*e.id+2*c.id+(d.wireframe?1:0);c!==Oa&&(Oa=c,a=!0);a&&f();if(!d.morphTargets&&0<=b.position)a&&(l.bindBuffer(l.ARRAY_BUFFER,e.__webglVertexBuffer),g(b.position),l.vertexAttribPointer(b.position,3,l.FLOAT,!1,0,0));else if(k.morphTargetBase){c=d.program.attributes;-1!==k.morphTargetBase&&0<=c.position?(l.bindBuffer(l.ARRAY_BUFFER,
e.__webglMorphTargetsBuffers[k.morphTargetBase]),g(c.position),l.vertexAttribPointer(c.position,3,l.FLOAT,!1,0,0)):0<=c.position&&(l.bindBuffer(l.ARRAY_BUFFER,e.__webglVertexBuffer),g(c.position),l.vertexAttribPointer(c.position,3,l.FLOAT,!1,0,0));if(k.morphTargetForcedOrder.length)for(var m=0,n=k.morphTargetForcedOrder,r=k.morphTargetInfluences;m<d.numSupportedMorphTargets&&m<n.length;)0<=c["morphTarget"+m]&&(l.bindBuffer(l.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[n[m]]),g(c["morphTarget"+m]),l.vertexAttribPointer(c["morphTarget"+
m],3,l.FLOAT,!1,0,0)),0<=c["morphNormal"+m]&&d.morphNormals&&(l.bindBuffer(l.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[n[m]]),g(c["morphNormal"+m]),l.vertexAttribPointer(c["morphNormal"+m],3,l.FLOAT,!1,0,0)),k.__webglMorphTargetInfluences[m]=r[n[m]],m++;else{var n=[],r=k.morphTargetInfluences,q,t=r.length;for(q=0;q<t;q++)m=r[q],0<m&&n.push([m,q]);n.length>d.numSupportedMorphTargets?(n.sort(p),n.length=d.numSupportedMorphTargets):n.length>d.numSupportedMorphNormals?n.sort(p):0===n.length&&n.push([0,
0]);for(m=0;m<d.numSupportedMorphTargets;)n[m]?(q=n[m][1],0<=c["morphTarget"+m]&&(l.bindBuffer(l.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[q]),g(c["morphTarget"+m]),l.vertexAttribPointer(c["morphTarget"+m],3,l.FLOAT,!1,0,0)),0<=c["morphNormal"+m]&&d.morphNormals&&(l.bindBuffer(l.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[q]),g(c["morphNormal"+m]),l.vertexAttribPointer(c["morphNormal"+m],3,l.FLOAT,!1,0,0)),k.__webglMorphTargetInfluences[m]=r[q]):k.__webglMorphTargetInfluences[m]=0,m++}null!==d.program.uniforms.morphTargetInfluences&&
l.uniform1fv(d.program.uniforms.morphTargetInfluences,k.__webglMorphTargetInfluences)}if(a){if(e.__webglCustomAttributesList)for(c=0,r=e.__webglCustomAttributesList.length;c<r;c++)n=e.__webglCustomAttributesList[c],0<=b[n.buffer.belongsToAttribute]&&(l.bindBuffer(l.ARRAY_BUFFER,n.buffer),g(b[n.buffer.belongsToAttribute]),l.vertexAttribPointer(b[n.buffer.belongsToAttribute],n.size,l.FLOAT,!1,0,0));0<=b.color&&(0<k.geometry.colors.length||0<k.geometry.faces.length?(l.bindBuffer(l.ARRAY_BUFFER,e.__webglColorBuffer),
g(b.color),l.vertexAttribPointer(b.color,3,l.FLOAT,!1,0,0)):void 0!==d.defaultAttributeValues&&l.vertexAttrib3fv(b.color,d.defaultAttributeValues.color));0<=b.normal&&(l.bindBuffer(l.ARRAY_BUFFER,e.__webglNormalBuffer),g(b.normal),l.vertexAttribPointer(b.normal,3,l.FLOAT,!1,0,0));0<=b.tangent&&(l.bindBuffer(l.ARRAY_BUFFER,e.__webglTangentBuffer),g(b.tangent),l.vertexAttribPointer(b.tangent,4,l.FLOAT,!1,0,0));0<=b.uv&&(k.geometry.faceVertexUvs[0]?(l.bindBuffer(l.ARRAY_BUFFER,e.__webglUVBuffer),g(b.uv),
l.vertexAttribPointer(b.uv,2,l.FLOAT,!1,0,0)):void 0!==d.defaultAttributeValues&&l.vertexAttrib2fv(b.uv,d.defaultAttributeValues.uv));0<=b.uv2&&(k.geometry.faceVertexUvs[1]?(l.bindBuffer(l.ARRAY_BUFFER,e.__webglUV2Buffer),g(b.uv2),l.vertexAttribPointer(b.uv2,2,l.FLOAT,!1,0,0)):void 0!==d.defaultAttributeValues&&l.vertexAttrib2fv(b.uv2,d.defaultAttributeValues.uv2));d.skinning&&0<=b.skinIndex&&0<=b.skinWeight&&(l.bindBuffer(l.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),g(b.skinIndex),l.vertexAttribPointer(b.skinIndex,
4,l.FLOAT,!1,0,0),l.bindBuffer(l.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),g(b.skinWeight),l.vertexAttribPointer(b.skinWeight,4,l.FLOAT,!1,0,0));0<=b.lineDistance&&(l.bindBuffer(l.ARRAY_BUFFER,e.__webglLineDistanceBuffer),g(b.lineDistance),l.vertexAttribPointer(b.lineDistance,1,l.FLOAT,!1,0,0))}h();k instanceof THREE.Mesh?(k=e.__typeArray===Uint32Array?l.UNSIGNED_INT:l.UNSIGNED_SHORT,d.wireframe?(A(d.wireframeLinewidth),a&&l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),l.drawElements(l.LINES,
e.__webglLineCount,k,0)):(a&&l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),l.drawElements(l.TRIANGLES,e.__webglFaceCount,k,0)),J.info.render.calls++,J.info.render.vertices+=e.__webglFaceCount,J.info.render.faces+=e.__webglFaceCount/3):k instanceof THREE.Line?(k=k.mode===THREE.LineStrip?l.LINE_STRIP:l.LINES,A(d.linewidth),l.drawArrays(k,0,e.__webglLineCount),J.info.render.calls++):k instanceof THREE.PointCloud&&(l.drawArrays(l.POINTS,0,e.__webglParticleCount),J.info.render.calls++,J.info.render.points+=
e.__webglParticleCount)}};this.render=function(a,b,c,d){if(!1===b instanceof THREE.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var e=a.fog;Kb=Oa=-1;ec=null;fc=!0;!0===a.autoUpdate&&a.updateMatrixWorld();void 0===b.parent&&b.updateMatrixWorld();a.traverse(function(a){a instanceof THREE.SkinnedMesh&&a.skeleton.update()});b.matrixWorldInverse.getInverse(b.matrixWorld);Ac.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);Ec.setFromMatrix(Ac);
cb.length=0;Jb.length=0;Ib.length=0;yb.length=0;Ra.length=0;q(a,a);!0===J.sortObjects&&(Jb.sort(k),Ib.sort(n));id.render(a,b);J.info.render.calls=0;J.info.render.vertices=0;J.info.render.faces=0;J.info.render.points=0;this.setRenderTarget(c);(this.autoClear||d)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);d=0;for(var f=jb.length;d<f;d++){var g=jb[d],h=g.object;h.visible&&(x(h,b),t(g))}a.overrideMaterial?(d=a.overrideMaterial,this.setBlending(d.blending,d.blendEquation,
d.blendSrc,d.blendDst),this.setDepthTest(d.depthTest),this.setDepthWrite(d.depthWrite),B(d.polygonOffset,d.polygonOffsetFactor,d.polygonOffsetUnits),m(Jb,b,cb,e,!0,d),m(Ib,b,cb,e,!0,d),r(jb,"",b,cb,e,!1,d)):(d=null,this.setBlending(THREE.NoBlending),m(Jb,b,cb,e,!1,d),r(jb,"opaque",b,cb,e,!1,d),m(Ib,b,cb,e,!0,d),r(jb,"transparent",b,cb,e,!0,d));jd.render(a,b);kd.render(a,b,Uc,Vc);c&&c.generateMipmaps&&c.minFilter!==THREE.NearestFilter&&c.minFilter!==THREE.LinearFilter&&C(c);this.setDepthTest(!0);this.setDepthWrite(!0)}};
this.renderImmediateObject=function(a,b,c,d,e){var f=G(a,b,c,d,e);Oa=-1;J.setMaterialFaces(d);e.immediateRenderCallback?e.immediateRenderCallback(f,l,Ec):e.render(function(a){J.renderBufferImmediate(a,f,d)})};var xb={},rc=0;this.setFaceCulling=function(a,b){a===THREE.CullFaceNone?l.disable(l.CULL_FACE):(b===THREE.FrontFaceDirectionCW?l.frontFace(l.CW):l.frontFace(l.CCW),a===THREE.CullFaceBack?l.cullFace(l.BACK):a===THREE.CullFaceFront?l.cullFace(l.FRONT):l.cullFace(l.FRONT_AND_BACK),l.enable(l.CULL_FACE))};
this.setMaterialFaces=function(a){var b=a.side===THREE.DoubleSide;a=a.side===THREE.BackSide;Lb!==b&&(b?l.disable(l.CULL_FACE):l.enable(l.CULL_FACE),Lb=b);Mb!==a&&(a?l.frontFace(l.CW):l.frontFace(l.CCW),Mb=a)};this.setDepthTest=function(a){Yb!==a&&(a?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),Yb=a)};this.setDepthWrite=function(a){nb!==a&&(l.depthMask(a),nb=a)};this.setBlending=function(a,b,c,d){a!==pb&&(a===THREE.NoBlending?l.disable(l.BLEND):a===THREE.AdditiveBlending?(l.enable(l.BLEND),l.blendEquation(l.FUNC_ADD),
l.blendFunc(l.SRC_ALPHA,l.ONE)):a===THREE.SubtractiveBlending?(l.enable(l.BLEND),l.blendEquation(l.FUNC_ADD),l.blendFunc(l.ZERO,l.ONE_MINUS_SRC_COLOR)):a===THREE.MultiplyBlending?(l.enable(l.BLEND),l.blendEquation(l.FUNC_ADD),l.blendFunc(l.ZERO,l.SRC_COLOR)):a===THREE.CustomBlending?l.enable(l.BLEND):(l.enable(l.BLEND),l.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),l.blendFuncSeparate(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA)),pb=a);if(a===THREE.CustomBlending){if(b!==Nb&&(l.blendEquation(Q(b)),
Nb=b),c!==Ob||d!==Xb)l.blendFunc(Q(c),Q(d)),Ob=c,Xb=d}else Xb=Ob=Nb=null};this.uploadTexture=function(a){void 0===a.__webglInit&&(a.__webglInit=!0,a.addEventListener("dispose",gc),a.__webglTexture=l.createTexture(),J.info.memory.textures++);l.bindTexture(l.TEXTURE_2D,a.__webglTexture);l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,a.flipY);l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha);l.pixelStorei(l.UNPACK_ALIGNMENT,a.unpackAlignment);a.image=R(a.image,cd);var b=a.image,c=THREE.Math.isPowerOfTwo(b.width)&&
THREE.Math.isPowerOfTwo(b.height),d=Q(a.format),e=Q(a.type);F(l.TEXTURE_2D,a,c);var f=a.mipmaps;if(a instanceof THREE.DataTexture)if(0<f.length&&c){for(var g=0,h=f.length;g<h;g++)b=f[g],l.texImage2D(l.TEXTURE_2D,g,d,b.width,b.height,0,d,e,b.data);a.generateMipmaps=!1}else l.texImage2D(l.TEXTURE_2D,0,d,b.width,b.height,0,d,e,b.data);else if(a instanceof THREE.CompressedTexture)for(g=0,h=f.length;g<h;g++)b=f[g],a.format!==THREE.RGBAFormat&&a.format!==THREE.RGBFormat?-1<Nc().indexOf(d)?l.compressedTexImage2D(l.TEXTURE_2D,
g,d,b.width,b.height,0,b.data):console.warn("Attempt to load unsupported compressed texture format"):l.texImage2D(l.TEXTURE_2D,g,d,b.width,b.height,0,d,e,b.data);else if(0<f.length&&c){g=0;for(h=f.length;g<h;g++)b=f[g],l.texImage2D(l.TEXTURE_2D,g,d,d,e,b);a.generateMipmaps=!1}else l.texImage2D(l.TEXTURE_2D,0,d,d,e,a.image);a.generateMipmaps&&c&&l.generateMipmap(l.TEXTURE_2D);a.needsUpdate=!1;if(a.onUpdate)a.onUpdate()};this.setTexture=function(a,b){l.activeTexture(l.TEXTURE0+b);a.needsUpdate?J.uploadTexture(a):
l.bindTexture(l.TEXTURE_2D,a.__webglTexture)};this.setRenderTarget=function(a){var b=a instanceof THREE.WebGLRenderTargetCube;if(a&&void 0===a.__webglFramebuffer){void 0===a.depthBuffer&&(a.depthBuffer=!0);void 0===a.stencilBuffer&&(a.stencilBuffer=!0);a.addEventListener("dispose",Zc);a.__webglTexture=l.createTexture();J.info.memory.textures++;var c=THREE.Math.isPowerOfTwo(a.width)&&THREE.Math.isPowerOfTwo(a.height),d=Q(a.format),e=Q(a.type);if(b){a.__webglFramebuffer=[];a.__webglRenderbuffer=[];
l.bindTexture(l.TEXTURE_CUBE_MAP,a.__webglTexture);F(l.TEXTURE_CUBE_MAP,a,c);for(var f=0;6>f;f++){a.__webglFramebuffer[f]=l.createFramebuffer();a.__webglRenderbuffer[f]=l.createRenderbuffer();l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,d,a.width,a.height,0,d,e,null);var g=a,h=l.TEXTURE_CUBE_MAP_POSITIVE_X+f;l.bindFramebuffer(l.FRAMEBUFFER,a.__webglFramebuffer[f]);l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,h,g.__webglTexture,0);H(a.__webglRenderbuffer[f],a)}c&&l.generateMipmap(l.TEXTURE_CUBE_MAP)}else a.__webglFramebuffer=
l.createFramebuffer(),a.__webglRenderbuffer=a.shareDepthFrom?a.shareDepthFrom.__webglRenderbuffer:l.createRenderbuffer(),l.bindTexture(l.TEXTURE_2D,a.__webglTexture),F(l.TEXTURE_2D,a,c),l.texImage2D(l.TEXTURE_2D,0,d,a.width,a.height,0,d,e,null),d=l.TEXTURE_2D,l.bindFramebuffer(l.FRAMEBUFFER,a.__webglFramebuffer),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,d,a.__webglTexture,0),a.shareDepthFrom?a.depthBuffer&&!a.stencilBuffer?l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,
l.RENDERBUFFER,a.__webglRenderbuffer):a.depthBuffer&&a.stencilBuffer&&l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.RENDERBUFFER,a.__webglRenderbuffer):H(a.__webglRenderbuffer,a),c&&l.generateMipmap(l.TEXTURE_2D);b?l.bindTexture(l.TEXTURE_CUBE_MAP,null):l.bindTexture(l.TEXTURE_2D,null);l.bindRenderbuffer(l.RENDERBUFFER,null);l.bindFramebuffer(l.FRAMEBUFFER,null)}a?(b=b?a.__webglFramebuffer[a.activeCubeFace]:a.__webglFramebuffer,c=a.width,a=a.height,e=d=0):(b=null,c=lc,a=mc,
d=Pb,e=kc);b!==Tc&&(l.bindFramebuffer(l.FRAMEBUFFER,b),l.viewport(d,e,c,a),Tc=b);Uc=c;Vc=a};this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}};
THREE.WebGLRenderTarget=function(a,b,c){this.width=a;this.height=b;c=c||{};this.wrapS=void 0!==c.wrapS?c.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=void 0!==c.wrapT?c.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=void 0!==c.magFilter?c.magFilter:THREE.LinearFilter;this.minFilter=void 0!==c.minFilter?c.minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=void 0!==c.anisotropy?c.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=void 0!==c.format?c.format:
THREE.RGBAFormat;this.type=void 0!==c.type?c.type:THREE.UnsignedByteType;this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0;this.generateMipmaps=!0;this.shareDepthFrom=null};
THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,setSize:function(a,b){this.width=a;this.height=b},clone:function(){var a=new THREE.WebGLRenderTarget(this.width,this.height);a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.anisotropy=this.anisotropy;a.offset.copy(this.offset);a.repeat.copy(this.repeat);a.format=this.format;a.type=this.type;a.depthBuffer=this.depthBuffer;a.stencilBuffer=this.stencilBuffer;a.generateMipmaps=this.generateMipmaps;
a.shareDepthFrom=this.shareDepthFrom;return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube=function(a,b,c){THREE.WebGLRenderTarget.call(this,a,b,c);this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);
THREE.WebGLExtensions=function(a){var b={};this.get=function(c){if(void 0!==b[c])return b[c];var d;switch(c){case "OES_texture_float":d=a.getExtension("OES_texture_float");break;case "OES_texture_float_linear":d=a.getExtension("OES_texture_float_linear");break;case "OES_standard_derivatives":d=a.getExtension("OES_standard_derivatives");break;case "EXT_texture_filter_anisotropic":d=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");
break;case "WEBGL_compressed_texture_s3tc":d=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":d=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "OES_element_index_uint":d=a.getExtension("OES_element_index_uint");break;case "EXT_blend_minmax":d=a.getExtension("EXT_blend_minmax");break;
case "EXT_frag_depth":d=a.getExtension("EXT_frag_depth")}null===d&&console.log("THREE.WebGLRenderer: "+c+" extension not supported.");return b[c]=d}};
THREE.WebGLProgram=function(){var a=0;return function(b,c,d,e){var f=b.context,g=d.defines,h=d.__webglShader.uniforms,k=d.attributes,n=d.__webglShader.vertexShader,p=d.__webglShader.fragmentShader,q=d.index0AttributeName;void 0===q&&!0===e.morphTargets&&(q="position");var m="SHADOWMAP_TYPE_BASIC";e.shadowMapType===THREE.PCFShadowMap?m="SHADOWMAP_TYPE_PCF":e.shadowMapType===THREE.PCFSoftShadowMap&&(m="SHADOWMAP_TYPE_PCF_SOFT");var r,t;r=[];for(var s in g)t=g[s],!1!==t&&(t="#define "+s+" "+t,r.push(t));
r=r.join("\n");g=f.createProgram();d instanceof THREE.RawShaderMaterial?b=d="":(d=["precision "+e.precision+" float;","precision "+e.precision+" int;",r,e.supportsVertexTextures?"#define VERTEX_TEXTURES":"",b.gammaInput?"#define GAMMA_INPUT":"",b.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+e.maxDirLights,"#define MAX_POINT_LIGHTS "+e.maxPointLights,"#define MAX_SPOT_LIGHTS "+e.maxSpotLights,"#define MAX_HEMI_LIGHTS "+e.maxHemiLights,"#define MAX_SHADOWS "+e.maxShadows,"#define MAX_BONES "+
e.maxBones,e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.lightMap?"#define USE_LIGHTMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.vertexColors?"#define USE_COLOR":"",e.skinning?"#define USE_SKINNING":"",e.useVertexTexture?"#define BONE_TEXTURE":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals?"#define USE_MORPHNORMALS":"",e.wrapAround?"#define WRAP_AROUND":
"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+m:"",e.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",e.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\n\tattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\n\tattribute vec3 morphTarget0;\n\tattribute vec3 morphTarget1;\n\tattribute vec3 morphTarget2;\n\tattribute vec3 morphTarget3;\n\t#ifdef USE_MORPHNORMALS\n\t\tattribute vec3 morphNormal0;\n\t\tattribute vec3 morphNormal1;\n\t\tattribute vec3 morphNormal2;\n\t\tattribute vec3 morphNormal3;\n\t#else\n\t\tattribute vec3 morphTarget4;\n\t\tattribute vec3 morphTarget5;\n\t\tattribute vec3 morphTarget6;\n\t\tattribute vec3 morphTarget7;\n\t#endif\n#endif\n#ifdef USE_SKINNING\n\tattribute vec4 skinIndex;\n\tattribute vec4 skinWeight;\n#endif\n"].join("\n"),
b=["precision "+e.precision+" float;","precision "+e.precision+" int;",e.bumpMap||e.normalMap?"#extension GL_OES_standard_derivatives : enable":"",r,"#define MAX_DIR_LIGHTS "+e.maxDirLights,"#define MAX_POINT_LIGHTS "+e.maxPointLights,"#define MAX_SPOT_LIGHTS "+e.maxSpotLights,"#define MAX_HEMI_LIGHTS "+e.maxHemiLights,"#define MAX_SHADOWS "+e.maxShadows,e.alphaTest?"#define ALPHATEST "+e.alphaTest:"",b.gammaInput?"#define GAMMA_INPUT":"",b.gammaOutput?"#define GAMMA_OUTPUT":"",e.useFog&&e.fog?"#define USE_FOG":
"",e.useFog&&e.fogExp?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.lightMap?"#define USE_LIGHTMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.vertexColors?"#define USE_COLOR":"",e.metal?"#define METAL":"",e.wrapAround?"#define WRAP_AROUND":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":
"",e.shadowMapEnabled?"#define "+m:"",e.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",e.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"));n=new THREE.WebGLShader(f,f.VERTEX_SHADER,d+n);p=new THREE.WebGLShader(f,f.FRAGMENT_SHADER,b+p);f.attachShader(g,n);f.attachShader(g,p);void 0!==q&&f.bindAttribLocation(g,0,q);f.linkProgram(g);!1===f.getProgramParameter(g,f.LINK_STATUS)&&(console.error("THREE.WebGLProgram: Could not initialise shader."),
console.error("gl.VALIDATE_STATUS",f.getProgramParameter(g,f.VALIDATE_STATUS)),console.error("gl.getError()",f.getError()));""!==f.getProgramInfoLog(g)&&console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",f.getProgramInfoLog(g));f.deleteShader(n);f.deleteShader(p);q="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition morphTargetInfluences bindMatrix bindMatrixInverse".split(" ");e.useVertexTexture?(q.push("boneTexture"),q.push("boneTextureWidth"),q.push("boneTextureHeight")):
q.push("boneGlobalMatrices");e.logarithmicDepthBuffer&&q.push("logDepthBufFC");for(var u in h)q.push(u);h=q;u={};q=0;for(b=h.length;q<b;q++)m=h[q],u[m]=f.getUniformLocation(g,m);this.uniforms=u;q="position normal uv uv2 tangent color skinIndex skinWeight lineDistance".split(" ");for(h=0;h<e.maxMorphTargets;h++)q.push("morphTarget"+h);for(h=0;h<e.maxMorphNormals;h++)q.push("morphNormal"+h);for(var v in k)q.push(v);e=q;k={};v=0;for(h=e.length;v<h;v++)u=e[v],k[u]=f.getAttribLocation(g,u);this.attributes=
k;this.attributesKeys=Object.keys(this.attributes);this.id=a++;this.code=c;this.usedTimes=1;this.program=g;this.vertexShader=n;this.fragmentShader=p;return this}}();
THREE.WebGLShader=function(){var a=function(a){a=a.split("\n");for(var c=0;c<a.length;c++)a[c]=c+1+": "+a[c];return a.join("\n")};return function(b,c,d){c=b.createShader(c);b.shaderSource(c,d);b.compileShader(c);!1===b.getShaderParameter(c,b.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");""!==b.getShaderInfoLog(c)&&(console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",b.getShaderInfoLog(c)),console.warn(a(d)));return c}}();
THREE.LensFlarePlugin=function(a,b){var c,d,e,f,g,h,k,n,p,q,m=a.context,r,t,s,u,v,y;this.render=function(G,w,K,x){if(0!==b.length){G=new THREE.Vector3;var D=x/K,E=.5*K,A=.5*x,B=16/x,F=new THREE.Vector2(B*D,B),R=new THREE.Vector3(1,1,0),H=new THREE.Vector2(1,1);if(void 0===s){var B=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),C=new Uint16Array([0,1,2,0,2,3]);r=m.createBuffer();t=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,r);m.bufferData(m.ARRAY_BUFFER,B,m.STATIC_DRAW);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,
t);m.bufferData(m.ELEMENT_ARRAY_BUFFER,C,m.STATIC_DRAW);v=m.createTexture();y=m.createTexture();m.bindTexture(m.TEXTURE_2D,v);m.texImage2D(m.TEXTURE_2D,0,m.RGB,16,16,0,m.RGB,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST);m.bindTexture(m.TEXTURE_2D,y);m.texImage2D(m.TEXTURE_2D,0,
m.RGBA,16,16,0,m.RGBA,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST);var B=(u=0<m.getParameter(m.MAX_VERTEX_TEXTURE_IMAGE_UNITS))?{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},
C=m.createProgram(),T=m.createShader(m.FRAGMENT_SHADER),Q=m.createShader(m.VERTEX_SHADER),O="precision "+a.getPrecision()+" float;\n";m.shaderSource(T,O+B.fragmentShader);m.shaderSource(Q,O+B.vertexShader);m.compileShader(T);m.compileShader(Q);m.attachShader(C,T);m.attachShader(C,Q);m.linkProgram(C);s=C;p=m.getAttribLocation(s,"position");q=m.getAttribLocation(s,"uv");c=m.getUniformLocation(s,"renderType");d=m.getUniformLocation(s,"map");e=m.getUniformLocation(s,"occlusionMap");f=m.getUniformLocation(s,
"opacity");g=m.getUniformLocation(s,"color");h=m.getUniformLocation(s,"scale");k=m.getUniformLocation(s,"rotation");n=m.getUniformLocation(s,"screenPosition")}m.useProgram(s);m.enableVertexAttribArray(p);m.enableVertexAttribArray(q);m.uniform1i(e,0);m.uniform1i(d,1);m.bindBuffer(m.ARRAY_BUFFER,r);m.vertexAttribPointer(p,2,m.FLOAT,!1,16,0);m.vertexAttribPointer(q,2,m.FLOAT,!1,16,8);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,t);m.disable(m.CULL_FACE);m.depthMask(!1);C=0;for(T=b.length;C<T;C++)if(B=16/x,F.set(B*
D,B),Q=b[C],G.set(Q.matrixWorld.elements[12],Q.matrixWorld.elements[13],Q.matrixWorld.elements[14]),G.applyMatrix4(w.matrixWorldInverse),G.applyProjection(w.projectionMatrix),R.copy(G),H.x=R.x*E+E,H.y=R.y*A+A,u||0<H.x&&H.x<K&&0<H.y&&H.y<x){m.activeTexture(m.TEXTURE1);m.bindTexture(m.TEXTURE_2D,v);m.copyTexImage2D(m.TEXTURE_2D,0,m.RGB,H.x-8,H.y-8,16,16,0);m.uniform1i(c,0);m.uniform2f(h,F.x,F.y);m.uniform3f(n,R.x,R.y,R.z);m.disable(m.BLEND);m.enable(m.DEPTH_TEST);m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,
0);m.activeTexture(m.TEXTURE0);m.bindTexture(m.TEXTURE_2D,y);m.copyTexImage2D(m.TEXTURE_2D,0,m.RGBA,H.x-8,H.y-8,16,16,0);m.uniform1i(c,1);m.disable(m.DEPTH_TEST);m.activeTexture(m.TEXTURE1);m.bindTexture(m.TEXTURE_2D,v);m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0);Q.positionScreen.copy(R);Q.customUpdateCallback?Q.customUpdateCallback(Q):Q.updateLensFlares();m.uniform1i(c,2);m.enable(m.BLEND);for(var O=0,S=Q.lensFlares.length;O<S;O++){var X=Q.lensFlares[O];.001<X.opacity&&.001<X.scale&&(R.x=X.x,
R.y=X.y,R.z=X.z,B=X.size*X.scale/x,F.x=B*D,F.y=B,m.uniform3f(n,R.x,R.y,R.z),m.uniform2f(h,F.x,F.y),m.uniform1f(k,X.rotation),m.uniform1f(f,X.opacity),m.uniform3f(g,X.color.r,X.color.g,X.color.b),a.setBlending(X.blending,X.blendEquation,X.blendSrc,X.blendDst),a.setTexture(X.texture,1),m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0))}}m.enable(m.CULL_FACE);m.enable(m.DEPTH_TEST);m.depthMask(!0);a.resetGLState()}}};
THREE.ShadowMapPlugin=function(a,b,c,d){function e(a,b,d){if(b.visible){var f=c[b.id];if(f&&b.castShadow&&(!1===b.frustumCulled||!0===p.intersectsObject(b)))for(var g=0,h=f.length;g<h;g++){var k=f[g];b._modelViewMatrix.multiplyMatrices(d.matrixWorldInverse,b.matrixWorld);s.push(k)}g=0;for(h=b.children.length;g<h;g++)e(a,b.children[g],d)}}var f=a.context,g,h,k,n,p=new THREE.Frustum,q=new THREE.Matrix4,m=new THREE.Vector3,r=new THREE.Vector3,t=new THREE.Vector3,s=[],u=THREE.ShaderLib.depthRGBA,v=THREE.UniformsUtils.clone(u.uniforms);
g=new THREE.ShaderMaterial({uniforms:v,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader});h=new THREE.ShaderMaterial({uniforms:v,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,morphTargets:!0});k=new THREE.ShaderMaterial({uniforms:v,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,skinning:!0});n=new THREE.ShaderMaterial({uniforms:v,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,morphTargets:!0,skinning:!0});g._shadowPass=!0;h._shadowPass=!0;k._shadowPass=
!0;n._shadowPass=!0;this.render=function(c,v){if(!1!==a.shadowMapEnabled){var u,K,x,D,E,A,B,F,R=[];D=0;f.clearColor(1,1,1,1);f.disable(f.BLEND);f.enable(f.CULL_FACE);f.frontFace(f.CCW);a.shadowMapCullFace===THREE.CullFaceFront?f.cullFace(f.FRONT):f.cullFace(f.BACK);a.setDepthTest(!0);u=0;for(K=b.length;u<K;u++)if(x=b[u],x.castShadow)if(x instanceof THREE.DirectionalLight&&x.shadowCascade)for(E=0;E<x.shadowCascadeCount;E++){var H;if(x.shadowCascadeArray[E])H=x.shadowCascadeArray[E];else{B=x;var C=
E;H=new THREE.DirectionalLight;H.isVirtual=!0;H.onlyShadow=!0;H.castShadow=!0;H.shadowCameraNear=B.shadowCameraNear;H.shadowCameraFar=B.shadowCameraFar;H.shadowCameraLeft=B.shadowCameraLeft;H.shadowCameraRight=B.shadowCameraRight;H.shadowCameraBottom=B.shadowCameraBottom;H.shadowCameraTop=B.shadowCameraTop;H.shadowCameraVisible=B.shadowCameraVisible;H.shadowDarkness=B.shadowDarkness;H.shadowBias=B.shadowCascadeBias[C];H.shadowMapWidth=B.shadowCascadeWidth[C];H.shadowMapHeight=B.shadowCascadeHeight[C];
H.pointsWorld=[];H.pointsFrustum=[];F=H.pointsWorld;A=H.pointsFrustum;for(var T=0;8>T;T++)F[T]=new THREE.Vector3,A[T]=new THREE.Vector3;F=B.shadowCascadeNearZ[C];B=B.shadowCascadeFarZ[C];A[0].set(-1,-1,F);A[1].set(1,-1,F);A[2].set(-1,1,F);A[3].set(1,1,F);A[4].set(-1,-1,B);A[5].set(1,-1,B);A[6].set(-1,1,B);A[7].set(1,1,B);H.originalCamera=v;A=new THREE.Gyroscope;A.position.copy(x.shadowCascadeOffset);A.add(H);A.add(H.target);v.add(A);x.shadowCascadeArray[E]=H;console.log("Created virtualLight",H)}C=
x;F=E;B=C.shadowCascadeArray[F];B.position.copy(C.position);B.target.position.copy(C.target.position);B.lookAt(B.target);B.shadowCameraVisible=C.shadowCameraVisible;B.shadowDarkness=C.shadowDarkness;B.shadowBias=C.shadowCascadeBias[F];A=C.shadowCascadeNearZ[F];C=C.shadowCascadeFarZ[F];B=B.pointsFrustum;B[0].z=A;B[1].z=A;B[2].z=A;B[3].z=A;B[4].z=C;B[5].z=C;B[6].z=C;B[7].z=C;R[D]=H;D++}else R[D]=x,D++;u=0;for(K=R.length;u<K;u++){x=R[u];x.shadowMap||(E=THREE.LinearFilter,a.shadowMapType===THREE.PCFSoftShadowMap&&
(E=THREE.NearestFilter),x.shadowMap=new THREE.WebGLRenderTarget(x.shadowMapWidth,x.shadowMapHeight,{minFilter:E,magFilter:E,format:THREE.RGBAFormat}),x.shadowMapSize=new THREE.Vector2(x.shadowMapWidth,x.shadowMapHeight),x.shadowMatrix=new THREE.Matrix4);if(!x.shadowCamera){if(x instanceof THREE.SpotLight)x.shadowCamera=new THREE.PerspectiveCamera(x.shadowCameraFov,x.shadowMapWidth/x.shadowMapHeight,x.shadowCameraNear,x.shadowCameraFar);else if(x instanceof THREE.DirectionalLight)x.shadowCamera=new THREE.OrthographicCamera(x.shadowCameraLeft,
x.shadowCameraRight,x.shadowCameraTop,x.shadowCameraBottom,x.shadowCameraNear,x.shadowCameraFar);else{console.error("Unsupported light type for shadow");continue}c.add(x.shadowCamera);!0===c.autoUpdate&&c.updateMatrixWorld()}x.shadowCameraVisible&&!x.cameraHelper&&(x.cameraHelper=new THREE.CameraHelper(x.shadowCamera),c.add(x.cameraHelper));if(x.isVirtual&&H.originalCamera==v){E=v;D=x.shadowCamera;A=x.pointsFrustum;B=x.pointsWorld;m.set(Infinity,Infinity,Infinity);r.set(-Infinity,-Infinity,-Infinity);
for(C=0;8>C;C++)F=B[C],F.copy(A[C]),F.unproject(E),F.applyMatrix4(D.matrixWorldInverse),F.x<m.x&&(m.x=F.x),F.x>r.x&&(r.x=F.x),F.y<m.y&&(m.y=F.y),F.y>r.y&&(r.y=F.y),F.z<m.z&&(m.z=F.z),F.z>r.z&&(r.z=F.z);D.left=m.x;D.right=r.x;D.top=r.y;D.bottom=m.y;D.updateProjectionMatrix()}D=x.shadowMap;A=x.shadowMatrix;E=x.shadowCamera;E.position.setFromMatrixPosition(x.matrixWorld);t.setFromMatrixPosition(x.target.matrixWorld);E.lookAt(t);E.updateMatrixWorld();E.matrixWorldInverse.getInverse(E.matrixWorld);x.cameraHelper&&
(x.cameraHelper.visible=x.shadowCameraVisible);x.shadowCameraVisible&&x.cameraHelper.update();A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);A.multiply(E.projectionMatrix);A.multiply(E.matrixWorldInverse);q.multiplyMatrices(E.projectionMatrix,E.matrixWorldInverse);p.setFromMatrix(q);a.setRenderTarget(D);a.clear();s.length=0;e(c,c,E);x=0;for(D=s.length;x<D;x++)B=s[x],A=B.object,B=B.buffer,C=A.material instanceof THREE.MeshFaceMaterial?A.material.materials[0]:A.material,F=void 0!==A.geometry.morphTargets&&
0<A.geometry.morphTargets.length&&C.morphTargets,T=A instanceof THREE.SkinnedMesh&&C.skinning,F=A.customDepthMaterial?A.customDepthMaterial:T?F?n:k:F?h:g,a.setMaterialFaces(C),B instanceof THREE.BufferGeometry?a.renderBufferDirect(E,b,null,F,B,A):a.renderBuffer(E,b,null,F,B,A);x=0;for(D=d.length;x<D;x++)B=d[x],A=B.object,A.visible&&A.castShadow&&(A._modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,A.matrixWorld),a.renderImmediateObject(E,b,null,g,A))}u=a.getClearColor();K=a.getClearAlpha();f.clearColor(u.r,
u.g,u.b,K);f.enable(f.BLEND);a.shadowMapCullFace===THREE.CullFaceFront&&f.cullFace(f.BACK);a.resetGLState()}}};
THREE.SpritePlugin=function(a,b){var c,d,e,f,g,h,k,n,p,q,m,r,t,s,u,v,y;function G(a,b){return a.z!==b.z?b.z-a.z:b.id-a.id}var w=a.context,K,x,D,E;this.render=function(A,B){if(0!==b.length){if(void 0===D){var F=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),R=new Uint16Array([0,1,2,0,2,3]);K=w.createBuffer();x=w.createBuffer();w.bindBuffer(w.ARRAY_BUFFER,K);w.bufferData(w.ARRAY_BUFFER,F,w.STATIC_DRAW);w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,x);w.bufferData(w.ELEMENT_ARRAY_BUFFER,R,w.STATIC_DRAW);
var F=w.createProgram(),R=w.createShader(w.VERTEX_SHADER),H=w.createShader(w.FRAGMENT_SHADER);w.shaderSource(R,["precision "+a.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));
w.shaderSource(H,["precision "+a.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
w.compileShader(R);w.compileShader(H);w.attachShader(F,R);w.attachShader(F,H);w.linkProgram(F);D=F;v=w.getAttribLocation(D,"position");y=w.getAttribLocation(D,"uv");c=w.getUniformLocation(D,"uvOffset");d=w.getUniformLocation(D,"uvScale");e=w.getUniformLocation(D,"rotation");f=w.getUniformLocation(D,"scale");g=w.getUniformLocation(D,"color");h=w.getUniformLocation(D,"map");k=w.getUniformLocation(D,"opacity");n=w.getUniformLocation(D,"modelViewMatrix");p=w.getUniformLocation(D,"projectionMatrix");q=
w.getUniformLocation(D,"fogType");m=w.getUniformLocation(D,"fogDensity");r=w.getUniformLocation(D,"fogNear");t=w.getUniformLocation(D,"fogFar");s=w.getUniformLocation(D,"fogColor");u=w.getUniformLocation(D,"alphaTest");F=document.createElement("canvas");F.width=8;F.height=8;R=F.getContext("2d");R.fillStyle="white";R.fillRect(0,0,8,8);E=new THREE.Texture(F);E.needsUpdate=!0}w.useProgram(D);w.enableVertexAttribArray(v);w.enableVertexAttribArray(y);w.disable(w.CULL_FACE);w.enable(w.BLEND);w.bindBuffer(w.ARRAY_BUFFER,
K);w.vertexAttribPointer(v,2,w.FLOAT,!1,16,0);w.vertexAttribPointer(y,2,w.FLOAT,!1,16,8);w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,x);w.uniformMatrix4fv(p,!1,B.projectionMatrix.elements);w.activeTexture(w.TEXTURE0);w.uniform1i(h,0);R=F=0;(H=A.fog)?(w.uniform3f(s,H.color.r,H.color.g,H.color.b),H instanceof THREE.Fog?(w.uniform1f(r,H.near),w.uniform1f(t,H.far),w.uniform1i(q,1),R=F=1):H instanceof THREE.FogExp2&&(w.uniform1f(m,H.density),w.uniform1i(q,2),R=F=2)):(w.uniform1i(q,0),R=F=0);for(var H=0,C=b.length;H<
C;H++){var T=b[H];T._modelViewMatrix.multiplyMatrices(B.matrixWorldInverse,T.matrixWorld);T.z=null===T.renderDepth?-T._modelViewMatrix.elements[14]:T.renderDepth}b.sort(G);for(var Q=[],H=0,C=b.length;H<C;H++){var T=b[H],O=T.material;w.uniform1f(u,O.alphaTest);w.uniformMatrix4fv(n,!1,T._modelViewMatrix.elements);Q[0]=T.scale.x;Q[1]=T.scale.y;T=0;A.fog&&O.fog&&(T=R);F!==T&&(w.uniform1i(q,T),F=T);null!==O.map?(w.uniform2f(c,O.map.offset.x,O.map.offset.y),w.uniform2f(d,O.map.repeat.x,O.map.repeat.y)):
(w.uniform2f(c,0,0),w.uniform2f(d,1,1));w.uniform1f(k,O.opacity);w.uniform3f(g,O.color.r,O.color.g,O.color.b);w.uniform1f(e,O.rotation);w.uniform2fv(f,Q);a.setBlending(O.blending,O.blendEquation,O.blendSrc,O.blendDst);a.setDepthTest(O.depthTest);a.setDepthWrite(O.depthWrite);O.map&&O.map.image&&O.map.image.width?a.setTexture(O.map,0):a.setTexture(E,0);w.drawElements(w.TRIANGLES,6,w.UNSIGNED_SHORT,0)}w.enable(w.CULL_FACE);a.resetGLState()}}};
THREE.GeometryUtils={merge:function(a,b,c){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var d;b instanceof THREE.Mesh&&(b.matrixAutoUpdate&&b.updateMatrix(),d=b.matrix,b=b.geometry);a.merge(b,d,c)},center:function(a){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return a.center()}};
THREE.ImageUtils={crossOrigin:void 0,loadTexture:function(a,b,c,d){var e=new THREE.ImageLoader;e.crossOrigin=this.crossOrigin;var f=new THREE.Texture(void 0,b);e.load(a,function(a){f.image=a;f.needsUpdate=!0;c&&c(f)},void 0,function(a){d&&d(a)});f.sourceFile=a;return f},loadTextureCube:function(a,b,c,d){var e=new THREE.ImageLoader;e.crossOrigin=this.crossOrigin;var f=new THREE.CubeTexture([],b);f.flipY=!1;var g=0;b=function(b){e.load(a[b],function(a){f.images[b]=a;g+=1;6===g&&(f.needsUpdate=!0,c&&
c(f))})};d=0;for(var h=a.length;d<h;++d)b(d);return f},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(a,b){var c=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/b,a[1]/b,a[2]/b]};b|=1;var d=a.width,e=a.height,f=document.createElement("canvas");
f.width=d;f.height=e;var g=f.getContext("2d");g.drawImage(a,0,0);for(var h=g.getImageData(0,0,d,e).data,k=g.createImageData(d,e),n=k.data,p=0;p<d;p++)for(var q=0;q<e;q++){var m=0>q-1?0:q-1,r=q+1>e-1?e-1:q+1,t=0>p-1?0:p-1,s=p+1>d-1?d-1:p+1,u=[],v=[0,0,h[4*(q*d+p)]/255*b];u.push([-1,0,h[4*(q*d+t)]/255*b]);u.push([-1,-1,h[4*(m*d+t)]/255*b]);u.push([0,-1,h[4*(m*d+p)]/255*b]);u.push([1,-1,h[4*(m*d+s)]/255*b]);u.push([1,0,h[4*(q*d+s)]/255*b]);u.push([1,1,h[4*(r*d+s)]/255*b]);u.push([0,1,h[4*(r*d+p)]/255*
b]);u.push([-1,1,h[4*(r*d+t)]/255*b]);m=[];t=u.length;for(r=0;r<t;r++){var s=u[r],y=u[(r+1)%t],s=[s[0]-v[0],s[1]-v[1],s[2]-v[2]],y=[y[0]-v[0],y[1]-v[1],y[2]-v[2]];m.push(c([s[1]*y[2]-s[2]*y[1],s[2]*y[0]-s[0]*y[2],s[0]*y[1]-s[1]*y[0]]))}u=[0,0,0];for(r=0;r<m.length;r++)u[0]+=m[r][0],u[1]+=m[r][1],u[2]+=m[r][2];u[0]/=m.length;u[1]/=m.length;u[2]/=m.length;v=4*(q*d+p);n[v]=(u[0]+1)/2*255|0;n[v+1]=(u[1]+1)/2*255|0;n[v+2]=255*u[2]|0;n[v+3]=255}g.putImageData(k,0,0);return f},generateDataTexture:function(a,
b,c){var d=a*b,e=new Uint8Array(3*d),f=Math.floor(255*c.r),g=Math.floor(255*c.g);c=Math.floor(255*c.b);for(var h=0;h<d;h++)e[3*h]=f,e[3*h+1]=g,e[3*h+2]=c;a=new THREE.DataTexture(e,a,b,THREE.RGBFormat);a.needsUpdate=!0;return a}};
THREE.SceneUtils={createMultiMaterialObject:function(a,b){for(var c=new THREE.Object3D,d=0,e=b.length;d<e;d++)c.add(new THREE.Mesh(a,b[d]));return c},detach:function(a,b,c){a.applyMatrix(b.matrixWorld);b.remove(a);c.add(a)},attach:function(a,b,c){var d=new THREE.Matrix4;d.getInverse(c.matrixWorld);a.applyMatrix(d);b.remove(a);c.add(a)}};
THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(a){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing.";}},loadFace:function(a){var b=a.familyName.toLowerCase();this.faces[b]=this.faces[b]||{};this.faces[b][a.cssFontWeight]=this.faces[b][a.cssFontWeight]||{};this.faces[b][a.cssFontWeight][a.cssFontStyle]=a;return this.faces[b][a.cssFontWeight][a.cssFontStyle]=
a},drawText:function(a){var b=this.getFace(),c=this.size/b.resolution,d=0,e=String(a).split(""),f=e.length,g=[];for(a=0;a<f;a++){var h=new THREE.Path,h=this.extractGlyphPoints(e[a],b,c,d,h),d=d+h.offset;g.push(h.path)}return{paths:g,offset:d/2}},extractGlyphPoints:function(a,b,c,d,e){var f=[],g,h,k,n,p,q,m,r,t,s,u,v=b.glyphs[a]||b.glyphs["?"];if(v){if(v.o)for(b=v._cachedOutline||(v._cachedOutline=v.o.split(" ")),n=b.length,a=0;a<n;)switch(k=b[a++],k){case "m":k=b[a++]*c+d;p=b[a++]*c;e.moveTo(k,p);
break;case "l":k=b[a++]*c+d;p=b[a++]*c;e.lineTo(k,p);break;case "q":k=b[a++]*c+d;p=b[a++]*c;r=b[a++]*c+d;t=b[a++]*c;e.quadraticCurveTo(r,t,k,p);if(g=f[f.length-1])for(q=g.x,m=g.y,g=1,h=this.divisions;g<=h;g++){var y=g/h;THREE.Shape.Utils.b2(y,q,r,k);THREE.Shape.Utils.b2(y,m,t,p)}break;case "b":if(k=b[a++]*c+d,p=b[a++]*c,r=b[a++]*c+d,t=b[a++]*c,s=b[a++]*c+d,u=b[a++]*c,e.bezierCurveTo(r,t,s,u,k,p),g=f[f.length-1])for(q=g.x,m=g.y,g=1,h=this.divisions;g<=h;g++)y=g/h,THREE.Shape.Utils.b3(y,q,r,s,k),THREE.Shape.Utils.b3(y,
m,t,u,p)}return{offset:v.ha*c,path:e}}}};
THREE.FontUtils.generateShapes=function(a,b){b=b||{};var c=void 0!==b.curveSegments?b.curveSegments:4,d=void 0!==b.font?b.font:"helvetiker",e=void 0!==b.weight?b.weight:"normal",f=void 0!==b.style?b.style:"normal";THREE.FontUtils.size=void 0!==b.size?b.size:100;THREE.FontUtils.divisions=c;THREE.FontUtils.face=d;THREE.FontUtils.weight=e;THREE.FontUtils.style=f;c=THREE.FontUtils.drawText(a).paths;d=[];e=0;for(f=c.length;e<f;e++)Array.prototype.push.apply(d,c[e].toShapes());return d};
(function(a){var b=function(a){for(var b=a.length,e=0,f=b-1,g=0;g<b;f=g++)e+=a[f].x*a[g].y-a[g].x*a[f].y;return.5*e};a.Triangulate=function(a,d){var e=a.length;if(3>e)return null;var f=[],g=[],h=[],k,n,p;if(0<b(a))for(n=0;n<e;n++)g[n]=n;else for(n=0;n<e;n++)g[n]=e-1-n;var q=2*e;for(n=e-1;2<e;){if(0>=q--){console.log("Warning, unable to triangulate polygon!");break}k=n;e<=k&&(k=0);n=k+1;e<=n&&(n=0);p=n+1;e<=p&&(p=0);var m;a:{var r=m=void 0,t=void 0,s=void 0,u=void 0,v=void 0,y=void 0,G=void 0,w=void 0,
r=a[g[k]].x,t=a[g[k]].y,s=a[g[n]].x,u=a[g[n]].y,v=a[g[p]].x,y=a[g[p]].y;if(1E-10>(s-r)*(y-t)-(u-t)*(v-r))m=!1;else{var K=void 0,x=void 0,D=void 0,E=void 0,A=void 0,B=void 0,F=void 0,R=void 0,H=void 0,C=void 0,H=R=F=w=G=void 0,K=v-s,x=y-u,D=r-v,E=t-y,A=s-r,B=u-t;for(m=0;m<e;m++)if(G=a[g[m]].x,w=a[g[m]].y,!(G===r&&w===t||G===s&&w===u||G===v&&w===y)&&(F=G-r,R=w-t,H=G-s,C=w-u,G-=v,w-=y,H=K*C-x*H,F=A*R-B*F,R=D*w-E*G,-1E-10<=H&&-1E-10<=R&&-1E-10<=F)){m=!1;break a}m=!0}}if(m){f.push([a[g[k]],a[g[n]],a[g[p]]]);
h.push([g[k],g[n],g[p]]);k=n;for(p=n+1;p<e;k++,p++)g[k]=g[p];e--;q=2*e}}return d?h:f};a.Triangulate.area=b;return a})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.typeface_js=self._typeface_js;
THREE.Audio=function(a){THREE.Object3D.call(this);this.type="Audio";this.context=a.context;this.source=this.context.createBufferSource();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.panner=this.context.createPanner();this.panner.connect(this.gain)};THREE.Audio.prototype=Object.create(THREE.Object3D.prototype);
THREE.Audio.prototype.load=function(a){var b=this,c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="arraybuffer";c.onload=function(a){b.context.decodeAudioData(this.response,function(a){b.source.buffer=a;b.source.connect(b.panner);b.source.start(0)})};c.send();return this};THREE.Audio.prototype.setLoop=function(a){this.source.loop=a};THREE.Audio.prototype.setRefDistance=function(a){this.panner.refDistance=a};THREE.Audio.prototype.setRolloffFactor=function(a){this.panner.rolloffFactor=a};
THREE.Audio.prototype.updateMatrixWorld=function(){var a=new THREE.Vector3;return function(b){THREE.Object3D.prototype.updateMatrixWorld.call(this,b);a.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(a.x,a.y,a.z)}}();THREE.AudioListener=function(){THREE.Object3D.call(this);this.type="AudioListener";this.context=new (window.AudioContext||window.webkitAudioContext)};THREE.AudioListener.prototype=Object.create(THREE.Object3D.prototype);
THREE.AudioListener.prototype.updateMatrixWorld=function(){var a=new THREE.Vector3,b=new THREE.Quaternion,c=new THREE.Vector3,d=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Vector3;return function(g){THREE.Object3D.prototype.updateMatrixWorld.call(this,g);g=this.context.listener;this.matrixWorld.decompose(a,b,c);d.set(0,0,-1).applyQuaternion(b);e.subVectors(a,f);g.setPosition(a.x,a.y,a.z);g.setOrientation(d.x,d.y,d.z,this.up.x,this.up.y,this.up.z);g.setVelocity(e.x,e.y,e.z);f.copy(a)}}();
THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(a){console.log("Warning, getPoint() not implemented!");return null};THREE.Curve.prototype.getPointAt=function(a){a=this.getUtoTmapping(a);return this.getPoint(a)};THREE.Curve.prototype.getPoints=function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPoint(b/a));return c};THREE.Curve.prototype.getSpacedPoints=function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPointAt(b/a));return c};
THREE.Curve.prototype.getLength=function(){var a=this.getLengths();return a[a.length-1]};THREE.Curve.prototype.getLengths=function(a){a||(a=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b=[],c,d=this.getPoint(0),e,f=0;b.push(0);for(e=1;e<=a;e++)c=this.getPoint(e/a),f+=c.distanceTo(d),b.push(f),d=c;return this.cacheArcLengths=b};
THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0;this.getLengths()};THREE.Curve.prototype.getUtoTmapping=function(a,b){var c=this.getLengths(),d=0,e=c.length,f;f=b?b:a*c[e-1];for(var g=0,h=e-1,k;g<=h;)if(d=Math.floor(g+(h-g)/2),k=c[d]-f,0>k)g=d+1;else if(0<k)h=d-1;else{h=d;break}d=h;if(c[d]==f)return d/(e-1);g=c[d];return c=(d+(f-g)/(c[d+1]-g))/(e-1)};THREE.Curve.prototype.getTangent=function(a){var b=a-1E-4;a+=1E-4;0>b&&(b=0);1<a&&(a=1);b=this.getPoint(b);return this.getPoint(a).clone().sub(b).normalize()};
THREE.Curve.prototype.getTangentAt=function(a){a=this.getUtoTmapping(a);return this.getTangent(a)};
THREE.Curve.Utils={tangentQuadraticBezier:function(a,b,c,d){return 2*(1-a)*(c-b)+2*a*(d-c)},tangentCubicBezier:function(a,b,c,d,e){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*e},tangentSpline:function(a,b,c,d,e){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(a,b,c,d,e){a=.5*(c-a);d=.5*(d-b);var f=e*e;return(2*b-2*c+a+d)*e*f+(-3*b+3*c-2*a-d)*f+a*e+b}};
THREE.Curve.create=function(a,b){a.prototype=Object.create(THREE.Curve.prototype);a.prototype.getPoint=b;return a};THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=!1};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.add=function(a){this.curves.push(a)};THREE.CurvePath.prototype.checkConnection=function(){};
THREE.CurvePath.prototype.closePath=function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new THREE.LineCurve(b,a))};THREE.CurvePath.prototype.getPoint=function(a){var b=a*this.getLength(),c=this.getCurveLengths();for(a=0;a<c.length;){if(c[a]>=b)return b=c[a]-b,a=this.curves[a],b=1-b/a.getLength(),a.getPointAt(b);a++}return null};THREE.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1]};
THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var a=[],b=0,c,d=this.curves.length;for(c=0;c<d;c++)b+=this.curves[c].getLength(),a.push(b);return this.cacheLengths=a};
THREE.CurvePath.prototype.getBoundingBox=function(){var a=this.getPoints(),b,c,d,e,f,g;b=c=Number.NEGATIVE_INFINITY;e=f=Number.POSITIVE_INFINITY;var h,k,n,p,q=a[0]instanceof THREE.Vector3;p=q?new THREE.Vector3:new THREE.Vector2;k=0;for(n=a.length;k<n;k++)h=a[k],h.x>b?b=h.x:h.x<e&&(e=h.x),h.y>c?c=h.y:h.y<f&&(f=h.y),q&&(h.z>d?d=h.z:h.z<g&&(g=h.z)),p.add(h);a={minX:e,minY:f,maxX:b,maxY:c};q&&(a.maxZ=d,a.minZ=g);return a};
THREE.CurvePath.prototype.createPointsGeometry=function(a){a=this.getPoints(a,!0);return this.createGeometry(a)};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(a){a=this.getSpacedPoints(a,!0);return this.createGeometry(a)};THREE.CurvePath.prototype.createGeometry=function(a){for(var b=new THREE.Geometry,c=0;c<a.length;c++)b.vertices.push(new THREE.Vector3(a[c].x,a[c].y,a[c].z||0));return b};THREE.CurvePath.prototype.addWrapPath=function(a){this.bends.push(a)};
THREE.CurvePath.prototype.getTransformedPoints=function(a,b){var c=this.getPoints(a),d,e;b||(b=this.bends);d=0;for(e=b.length;d<e;d++)c=this.getWrapPoints(c,b[d]);return c};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(a,b){var c=this.getSpacedPoints(a),d,e;b||(b=this.bends);d=0;for(e=b.length;d<e;d++)c=this.getWrapPoints(c,b[d]);return c};
THREE.CurvePath.prototype.getWrapPoints=function(a,b){var c=this.getBoundingBox(),d,e,f,g,h,k;d=0;for(e=a.length;d<e;d++)f=a[d],g=f.x,h=f.y,k=g/c.maxX,k=b.getUtoTmapping(k,g),g=b.getPoint(k),k=b.getTangent(k),k.set(-k.y,k.x).multiplyScalar(h),f.x=g.x+k.x,f.y=g.y+k.y;return a};THREE.Gyroscope=function(){THREE.Object3D.call(this)};THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype);
THREE.Gyroscope.prototype.updateMatrixWorld=function(){var a=new THREE.Vector3,b=new THREE.Quaternion,c=new THREE.Vector3,d=new THREE.Vector3,e=new THREE.Quaternion,f=new THREE.Vector3;return function(g){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||g)this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(d,e,f),this.matrix.decompose(a,b,c),this.matrixWorld.compose(d,b,f)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=
!1,g=!0;for(var h=0,k=this.children.length;h<k;h++)this.children[h].updateMatrixWorld(g)}}();THREE.Path=function(a){THREE.CurvePath.call(this);this.actions=[];a&&this.fromPoints(a)};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};
THREE.Path.prototype.fromPoints=function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y)};THREE.Path.prototype.moveTo=function(a,b){var c=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:c})};
THREE.Path.prototype.lineTo=function(a,b){var c=Array.prototype.slice.call(arguments),d=this.actions[this.actions.length-1].args,d=new THREE.LineCurve(new THREE.Vector2(d[d.length-2],d[d.length-1]),new THREE.Vector2(a,b));this.curves.push(d);this.actions.push({action:THREE.PathActions.LINE_TO,args:c})};
THREE.Path.prototype.quadraticCurveTo=function(a,b,c,d){var e=Array.prototype.slice.call(arguments),f=this.actions[this.actions.length-1].args,f=new THREE.QuadraticBezierCurve(new THREE.Vector2(f[f.length-2],f[f.length-1]),new THREE.Vector2(a,b),new THREE.Vector2(c,d));this.curves.push(f);this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:e})};
THREE.Path.prototype.bezierCurveTo=function(a,b,c,d,e,f){var g=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args,h=new THREE.CubicBezierCurve(new THREE.Vector2(h[h.length-2],h[h.length-1]),new THREE.Vector2(a,b),new THREE.Vector2(c,d),new THREE.Vector2(e,f));this.curves.push(h);this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:g})};
THREE.Path.prototype.splineThru=function(a){var b=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,c=[new THREE.Vector2(c[c.length-2],c[c.length-1])];Array.prototype.push.apply(c,a);c=new THREE.SplineCurve(c);this.curves.push(c);this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:b})};THREE.Path.prototype.arc=function(a,b,c,d,e,f){var g=this.actions[this.actions.length-1].args;this.absarc(a+g[g.length-2],b+g[g.length-1],c,d,e,f)};
THREE.Path.prototype.absarc=function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f)};THREE.Path.prototype.ellipse=function(a,b,c,d,e,f,g){var h=this.actions[this.actions.length-1].args;this.absellipse(a+h[h.length-2],b+h[h.length-1],c,d,e,f,g)};THREE.Path.prototype.absellipse=function(a,b,c,d,e,f,g){var h=Array.prototype.slice.call(arguments),k=new THREE.EllipseCurve(a,b,c,d,e,f,g);this.curves.push(k);k=k.getPoint(1);h.push(k.x);h.push(k.y);this.actions.push({action:THREE.PathActions.ELLIPSE,args:h})};
THREE.Path.prototype.getSpacedPoints=function(a,b){a||(a=40);for(var c=[],d=0;d<a;d++)c.push(this.getPoint(d/a));return c};
THREE.Path.prototype.getPoints=function(a,b){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(a,b);a=a||12;var c=[],d,e,f,g,h,k,n,p,q,m,r,t,s;d=0;for(e=this.actions.length;d<e;d++)switch(f=this.actions[d],g=f.action,f=f.args,g){case THREE.PathActions.MOVE_TO:c.push(new THREE.Vector2(f[0],f[1]));break;case THREE.PathActions.LINE_TO:c.push(new THREE.Vector2(f[0],f[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:h=f[2];k=f[3];q=f[0];m=f[1];0<c.length?(g=c[c.length-1],r=g.x,
t=g.y):(g=this.actions[d-1].args,r=g[g.length-2],t=g[g.length-1]);for(f=1;f<=a;f++)s=f/a,g=THREE.Shape.Utils.b2(s,r,q,h),s=THREE.Shape.Utils.b2(s,t,m,k),c.push(new THREE.Vector2(g,s));break;case THREE.PathActions.BEZIER_CURVE_TO:h=f[4];k=f[5];q=f[0];m=f[1];n=f[2];p=f[3];0<c.length?(g=c[c.length-1],r=g.x,t=g.y):(g=this.actions[d-1].args,r=g[g.length-2],t=g[g.length-1]);for(f=1;f<=a;f++)s=f/a,g=THREE.Shape.Utils.b3(s,r,q,n,h),s=THREE.Shape.Utils.b3(s,t,m,p,k),c.push(new THREE.Vector2(g,s));break;case THREE.PathActions.CSPLINE_THRU:g=
this.actions[d-1].args;s=[new THREE.Vector2(g[g.length-2],g[g.length-1])];g=a*f[0].length;s=s.concat(f[0]);s=new THREE.SplineCurve(s);for(f=1;f<=g;f++)c.push(s.getPointAt(f/g));break;case THREE.PathActions.ARC:h=f[0];k=f[1];m=f[2];n=f[3];g=f[4];q=!!f[5];r=g-n;t=2*a;for(f=1;f<=t;f++)s=f/t,q||(s=1-s),s=n+s*r,g=h+m*Math.cos(s),s=k+m*Math.sin(s),c.push(new THREE.Vector2(g,s));break;case THREE.PathActions.ELLIPSE:for(h=f[0],k=f[1],m=f[2],p=f[3],n=f[4],g=f[5],q=!!f[6],r=g-n,t=2*a,f=1;f<=t;f++)s=f/t,q||
(s=1-s),s=n+s*r,g=h+m*Math.cos(s),s=k+p*Math.sin(s),c.push(new THREE.Vector2(g,s))}d=c[c.length-1];1E-10>Math.abs(d.x-c[0].x)&&1E-10>Math.abs(d.y-c[0].y)&&c.splice(c.length-1,1);b&&c.push(c[0]);return c};
THREE.Path.prototype.toShapes=function(a,b){function c(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c],f=new THREE.Shape;f.actions=e.actions;f.curves=e.curves;b.push(f)}return b}function d(a,b){for(var c=b.length,d=!1,e=c-1,f=0;f<c;e=f++){var g=b[e],h=b[f],k=h.x-g.x,m=h.y-g.y;if(1E-10<Math.abs(m)){if(0>m&&(g=b[f],k=-k,h=b[e],m=-m),!(a.y<g.y||a.y>h.y))if(a.y==g.y){if(a.x==g.x)return!0}else{e=m*(a.x-g.x)-k*(a.y-g.y);if(0==e)return!0;0>e||(d=!d)}}else if(a.y==g.y&&(h.x<=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=
h.x))return!0}return d}var e=function(a){var b,c,d,e,f=[],g=new THREE.Path;b=0;for(c=a.length;b<c;b++)d=a[b],e=d.args,d=d.action,d==THREE.PathActions.MOVE_TO&&0!=g.actions.length&&(f.push(g),g=new THREE.Path),g[d].apply(g,e);0!=g.actions.length&&f.push(g);return f}(this.actions);if(0==e.length)return[];if(!0===b)return c(e);var f,g,h,k=[];if(1==e.length)return g=e[0],h=new THREE.Shape,h.actions=g.actions,h.curves=g.curves,k.push(h),k;var n=!THREE.Shape.Utils.isClockWise(e[0].getPoints()),n=a?!n:n;
h=[];var p=[],q=[],m=0,r;p[m]=void 0;q[m]=[];var t,s;t=0;for(s=e.length;t<s;t++)g=e[t],r=g.getPoints(),f=THREE.Shape.Utils.isClockWise(r),(f=a?!f:f)?(!n&&p[m]&&m++,p[m]={s:new THREE.Shape,p:r},p[m].s.actions=g.actions,p[m].s.curves=g.curves,n&&m++,q[m]=[]):q[m].push({h:g,p:r[0]});if(!p[0])return c(e);if(1<p.length){t=!1;s=[];g=0;for(e=p.length;g<e;g++)h[g]=[];g=0;for(e=p.length;g<e;g++)for(f=q[g],n=0;n<f.length;n++){m=f[n];r=!0;for(var u=0;u<p.length;u++)d(m.p,p[u].p)&&(g!=u&&s.push({froms:g,tos:u,
hole:n}),r?(r=!1,h[u].push(m)):t=!0);r&&h[g].push(m)}0<s.length&&(t||(q=h))}t=0;for(s=p.length;t<s;t++)for(h=p[t].s,k.push(h),g=q[t],e=0,f=g.length;e<f;e++)h.holes.push(g[e].h);return k};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.extrude=function(a){return new THREE.ExtrudeGeometry(this,a)};THREE.Shape.prototype.makeGeometry=function(a){return new THREE.ShapeGeometry(this,a)};
THREE.Shape.prototype.getPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;b<c;b++)d[b]=this.holes[b].getTransformedPoints(a,this.bends);return d};THREE.Shape.prototype.getSpacedPointsHoles=function(a){var b,c=this.holes.length,d=[];for(b=0;b<c;b++)d[b]=this.holes[b].getTransformedSpacedPoints(a,this.bends);return d};THREE.Shape.prototype.extractAllPoints=function(a){return{shape:this.getTransformedPoints(a),holes:this.getPointsHoles(a)}};
THREE.Shape.prototype.extractPoints=function(a){return this.useSpacedPoints?this.extractAllSpacedPoints(a):this.extractAllPoints(a)};THREE.Shape.prototype.extractAllSpacedPoints=function(a){return{shape:this.getTransformedSpacedPoints(a),holes:this.getSpacedPointsHoles(a)}};
THREE.Shape.Utils={triangulateShape:function(a,b){function c(a,b,c){return a.x!=b.x?a.x<b.x?a.x<=c.x&&c.x<=b.x:b.x<=c.x&&c.x<=a.x:a.y<b.y?a.y<=c.y&&c.y<=b.y:b.y<=c.y&&c.y<=a.y}function d(a,b,d,e,f){var g=b.x-a.x,h=b.y-a.y,k=e.x-d.x,n=e.y-d.y,p=a.x-d.x,q=a.y-d.y,D=h*k-g*n,E=h*p-g*q;if(1E-10<Math.abs(D)){if(0<D){if(0>E||E>D)return[];k=n*p-k*q;if(0>k||k>D)return[]}else{if(0<E||E<D)return[];k=n*p-k*q;if(0<k||k<D)return[]}if(0==k)return!f||0!=E&&E!=D?[a]:[];if(k==D)return!f||0!=E&&E!=D?[b]:[];if(0==E)return[d];
if(E==D)return[e];f=k/D;return[{x:a.x+f*g,y:a.y+f*h}]}if(0!=E||n*p!=k*q)return[];h=0==g&&0==h;k=0==k&&0==n;if(h&&k)return a.x!=d.x||a.y!=d.y?[]:[a];if(h)return c(d,e,a)?[a]:[];if(k)return c(a,b,d)?[d]:[];0!=g?(a.x<b.x?(g=a,k=a.x,h=b,a=b.x):(g=b,k=b.x,h=a,a=a.x),d.x<e.x?(b=d,D=d.x,n=e,d=e.x):(b=e,D=e.x,n=d,d=d.x)):(a.y<b.y?(g=a,k=a.y,h=b,a=b.y):(g=b,k=b.y,h=a,a=a.y),d.y<e.y?(b=d,D=d.y,n=e,d=e.y):(b=e,D=e.y,n=d,d=d.y));return k<=D?a<D?[]:a==D?f?[]:[b]:a<=d?[b,h]:[b,n]:k>d?[]:k==d?f?[]:[g]:a<=d?[g,h]:
[g,n]}function e(a,b,c,d){var e=b.x-a.x,f=b.y-a.y;b=c.x-a.x;c=c.y-a.y;var g=d.x-a.x;d=d.y-a.y;a=e*c-f*b;e=e*d-f*g;return 1E-10<Math.abs(a)?(b=g*c-d*b,0<a?0<=e&&0<=b:0<=e||0<=b):0<e}var f,g,h,k,n,p={};h=a.concat();f=0;for(g=b.length;f<g;f++)Array.prototype.push.apply(h,b[f]);f=0;for(g=h.length;f<g;f++)n=h[f].x+":"+h[f].y,void 0!==p[n]&&console.log("Duplicate point",n),p[n]=f;f=function(a,b){function c(a,b){var d=h.length-1,f=a-1;0>f&&(f=d);var g=a+1;g>d&&(g=0);d=e(h[a],h[f],h[g],k[b]);if(!d)return!1;
d=k.length-1;f=b-1;0>f&&(f=d);g=b+1;g>d&&(g=0);return(d=e(k[b],k[f],k[g],h[a]))?!0:!1}function f(a,b){var c,e;for(c=0;c<h.length;c++)if(e=c+1,e%=h.length,e=d(a,b,h[c],h[e],!0),0<e.length)return!0;return!1}function g(a,c){var e,f,h,k;for(e=0;e<n.length;e++)for(f=b[n[e]],h=0;h<f.length;h++)if(k=h+1,k%=f.length,k=d(a,c,f[h],f[k],!0),0<k.length)return!0;return!1}var h=a.concat(),k,n=[],p,q,x,D,E,A=[],B,F,R,H=0;for(p=b.length;H<p;H++)n.push(H);B=0;for(var C=2*n.length;0<n.length;){C--;if(0>C){console.log("Infinite Loop! Holes left:"+
n.length+", Probably Hole outside Shape!");break}for(q=B;q<h.length;q++){x=h[q];p=-1;for(H=0;H<n.length;H++)if(D=n[H],E=x.x+":"+x.y+":"+D,void 0===A[E]){k=b[D];for(F=0;F<k.length;F++)if(D=k[F],c(q,F)&&!f(x,D)&&!g(x,D)){p=F;n.splice(H,1);B=h.slice(0,q+1);D=h.slice(q);F=k.slice(p);R=k.slice(0,p+1);h=B.concat(F).concat(R).concat(D);B=q;break}if(0<=p)break;A[E]=!0}if(0<=p)break}}return h}(a,b);var q=THREE.FontUtils.Triangulate(f,!1);f=0;for(g=q.length;f<g;f++)for(k=q[f],h=0;3>h;h++)n=k[h].x+":"+k[h].y,
n=p[n],void 0!==n&&(k[h]=n);return q.concat()},isClockWise:function(a){return 0>THREE.FontUtils.Triangulate.area(a)},b2p0:function(a,b){var c=1-a;return c*c*b},b2p1:function(a,b){return 2*(1-a)*a*b},b2p2:function(a,b){return a*a*b},b2:function(a,b,c,d){return this.b2p0(a,b)+this.b2p1(a,c)+this.b2p2(a,d)},b3p0:function(a,b){var c=1-a;return c*c*c*b},b3p1:function(a,b){var c=1-a;return 3*c*c*a*b},b3p2:function(a,b){return 3*(1-a)*a*a*b},b3p3:function(a,b){return a*a*a*b},b3:function(a,b,c,d,e){return this.b3p0(a,
b)+this.b3p1(a,c)+this.b3p2(a,d)+this.b3p3(a,e)}};THREE.LineCurve=function(a,b){this.v1=a;this.v2=b};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.getPoint=function(a){var b=this.v2.clone().sub(this.v1);b.multiplyScalar(a).add(this.v1);return b};THREE.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)};THREE.LineCurve.prototype.getTangent=function(a){return this.v2.clone().sub(this.v1).normalize()};
THREE.QuadraticBezierCurve=function(a,b,c){this.v0=a;this.v1=b;this.v2=c};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.getPoint=function(a){var b=new THREE.Vector2;b.x=THREE.Shape.Utils.b2(a,this.v0.x,this.v1.x,this.v2.x);b.y=THREE.Shape.Utils.b2(a,this.v0.y,this.v1.y,this.v2.y);return b};
THREE.QuadraticBezierCurve.prototype.getTangent=function(a){var b=new THREE.Vector2;b.x=THREE.Curve.Utils.tangentQuadraticBezier(a,this.v0.x,this.v1.x,this.v2.x);b.y=THREE.Curve.Utils.tangentQuadraticBezier(a,this.v0.y,this.v1.y,this.v2.y);return b.normalize()};THREE.CubicBezierCurve=function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);
THREE.CubicBezierCurve.prototype.getPoint=function(a){var b;b=THREE.Shape.Utils.b3(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x);a=THREE.Shape.Utils.b3(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(b,a)};THREE.CubicBezierCurve.prototype.getTangent=function(a){var b;b=THREE.Curve.Utils.tangentCubicBezier(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x);a=THREE.Curve.Utils.tangentCubicBezier(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y);b=new THREE.Vector2(b,a);b.normalize();return b};
THREE.SplineCurve=function(a){this.points=void 0==a?[]:a};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.getPoint=function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);a-=c;var d=b[0==c?c:c-1],e=b[c],f=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=new THREE.Vector2;c.x=THREE.Curve.Utils.interpolate(d.x,e.x,f.x,b.x,a);c.y=THREE.Curve.Utils.interpolate(d.y,e.y,f.y,b.y,a);return c};
THREE.EllipseCurve=function(a,b,c,d,e,f,g){this.aX=a;this.aY=b;this.xRadius=c;this.yRadius=d;this.aStartAngle=e;this.aEndAngle=f;this.aClockwise=g};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);
THREE.EllipseCurve.prototype.getPoint=function(a){var b=this.aEndAngle-this.aStartAngle;0>b&&(b+=2*Math.PI);b>2*Math.PI&&(b-=2*Math.PI);a=!0===this.aClockwise?this.aEndAngle+(1-a)*(2*Math.PI-b):this.aStartAngle+a*b;b=new THREE.Vector2;b.x=this.aX+this.xRadius*Math.cos(a);b.y=this.aY+this.yRadius*Math.sin(a);return b};THREE.ArcCurve=function(a,b,c,d,e,f){THREE.EllipseCurve.call(this,a,b,c,c,d,e,f)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);
THREE.LineCurve3=THREE.Curve.create(function(a,b){this.v1=a;this.v2=b},function(a){var b=new THREE.Vector3;b.subVectors(this.v2,this.v1);b.multiplyScalar(a);b.add(this.v1);return b});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(a,b,c){this.v0=a;this.v1=b;this.v2=c},function(a){var b=new THREE.Vector3;b.x=THREE.Shape.Utils.b2(a,this.v0.x,this.v1.x,this.v2.x);b.y=THREE.Shape.Utils.b2(a,this.v0.y,this.v1.y,this.v2.y);b.z=THREE.Shape.Utils.b2(a,this.v0.z,this.v1.z,this.v2.z);return b});
THREE.CubicBezierCurve3=THREE.Curve.create(function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d},function(a){var b=new THREE.Vector3;b.x=THREE.Shape.Utils.b3(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x);b.y=THREE.Shape.Utils.b3(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y);b.z=THREE.Shape.Utils.b3(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return b});
THREE.SplineCurve3=THREE.Curve.create(function(a){this.points=void 0==a?[]:a},function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);a-=c;var d=b[0==c?c:c-1],e=b[c],f=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=new THREE.Vector3;c.x=THREE.Curve.Utils.interpolate(d.x,e.x,f.x,b.x,a);c.y=THREE.Curve.Utils.interpolate(d.y,e.y,f.y,b.y,a);c.z=THREE.Curve.Utils.interpolate(d.z,e.z,f.z,b.z,a);return c});
THREE.ClosedSplineCurve3=THREE.Curve.create(function(a){this.points=void 0==a?[]:a},function(a){var b=this.points;a*=b.length-0;var c=Math.floor(a);a-=c;var c=c+(0<c?0:(Math.floor(Math.abs(c)/b.length)+1)*b.length),d=b[(c-1)%b.length],e=b[c%b.length],f=b[(c+1)%b.length],b=b[(c+2)%b.length],c=new THREE.Vector3;c.x=THREE.Curve.Utils.interpolate(d.x,e.x,f.x,b.x,a);c.y=THREE.Curve.Utils.interpolate(d.y,e.y,f.y,b.y,a);c.z=THREE.Curve.Utils.interpolate(d.z,e.z,f.z,b.z,a);return c});
THREE.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(a){if(!0!==a.initialized){for(var b=0;b<a.hierarchy.length;b++){for(var c=0;c<a.hierarchy[b].keys.length;c++)if(0>a.hierarchy[b].keys[c].time&&(a.hierarchy[b].keys[c].time=
0),void 0!==a.hierarchy[b].keys[c].rot&&!(a.hierarchy[b].keys[c].rot instanceof THREE.Quaternion)){var d=a.hierarchy[b].keys[c].rot;a.hierarchy[b].keys[c].rot=(new THREE.Quaternion).fromArray(d)}if(a.hierarchy[b].keys.length&&void 0!==a.hierarchy[b].keys[0].morphTargets){d={};for(c=0;c<a.hierarchy[b].keys.length;c++)for(var e=0;e<a.hierarchy[b].keys[c].morphTargets.length;e++){var f=a.hierarchy[b].keys[c].morphTargets[e];d[f]=-1}a.hierarchy[b].usedMorphTargets=d;for(c=0;c<a.hierarchy[b].keys.length;c++){var g=
{};for(f in d){for(e=0;e<a.hierarchy[b].keys[c].morphTargets.length;e++)if(a.hierarchy[b].keys[c].morphTargets[e]===f){g[f]=a.hierarchy[b].keys[c].morphTargetsInfluences[e];break}e===a.hierarchy[b].keys[c].morphTargets.length&&(g[f]=0)}a.hierarchy[b].keys[c].morphTargetsInfluences=g}}for(c=1;c<a.hierarchy[b].keys.length;c++)a.hierarchy[b].keys[c].time===a.hierarchy[b].keys[c-1].time&&(a.hierarchy[b].keys.splice(c,1),c--);for(c=0;c<a.hierarchy[b].keys.length;c++)a.hierarchy[b].keys[c].index=c}a.initialized=
!0;return a}},parse:function(a){var b=function(a,c){c.push(a);for(var d=0;d<a.children.length;d++)b(a.children[d],c)},c=[];if(a instanceof THREE.SkinnedMesh)for(var d=0;d<a.skeleton.bones.length;d++)c.push(a.skeleton.bones[d]);else b(a,c);return c},play:function(a){-1===this.animations.indexOf(a)&&this.animations.push(a)},stop:function(a){a=this.animations.indexOf(a);-1!==a&&this.animations.splice(a,1)},update:function(a){for(var b=0;b<this.animations.length;b++)this.animations[b].resetBlendWeights();
for(b=0;b<this.animations.length;b++)this.animations[b].update(a)}};THREE.Animation=function(a,b){this.root=a;this.data=THREE.AnimationHandler.init(b);this.hierarchy=THREE.AnimationHandler.parse(a);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=!0;this.weight=0;this.interpolationType=THREE.AnimationHandler.LINEAR};THREE.Animation.prototype.keyTypes=["pos","rot","scl"];
THREE.Animation.prototype.play=function(a,b){this.currentTime=void 0!==a?a:0;this.weight=void 0!==b?b:1;this.isPlaying=!0;this.reset();THREE.AnimationHandler.play(this)};THREE.Animation.prototype.stop=function(){this.isPlaying=!1;THREE.AnimationHandler.stop(this)};
THREE.Animation.prototype.reset=function(){for(var a=0,b=this.hierarchy.length;a<b;a++){var c=this.hierarchy[a];c.matrixAutoUpdate=!0;void 0===c.animationCache&&(c.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}});void 0===c.animationCache.animations[this.data.name]&&(c.animationCache.animations[this.data.name]={},c.animationCache.animations[this.data.name].prevKey={pos:0,rot:0,scl:0},c.animationCache.animations[this.data.name].nextKey={pos:0,rot:0,scl:0},
c.animationCache.animations[this.data.name].originalMatrix=c.matrix);for(var c=c.animationCache.animations[this.data.name],d=0;3>d;d++){for(var e=this.keyTypes[d],f=this.data.hierarchy[a].keys[0],g=this.getNextKeyWith(e,a,1);g.time<this.currentTime&&g.index>f.index;)f=g,g=this.getNextKeyWith(e,a,g.index+1);c.prevKey[e]=f;c.nextKey[e]=g}}};
THREE.Animation.prototype.resetBlendWeights=function(){for(var a=0,b=this.hierarchy.length;a<b;a++){var c=this.hierarchy[a];void 0!==c.animationCache&&(c.animationCache.blending.positionWeight=0,c.animationCache.blending.quaternionWeight=0,c.animationCache.blending.scaleWeight=0)}};
THREE.Animation.prototype.update=function(){var a=[],b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Quaternion,e=function(a,b){var c=[],d=[],e,q,m,r,t,s;e=(a.length-1)*b;q=Math.floor(e);e-=q;c[0]=0===q?q:q-1;c[1]=q;c[2]=q>a.length-2?q:q+1;c[3]=q>a.length-3?q:q+2;q=a[c[0]];r=a[c[1]];t=a[c[2]];s=a[c[3]];c=e*e;m=e*c;d[0]=f(q[0],r[0],t[0],s[0],e,c,m);d[1]=f(q[1],r[1],t[1],s[1],e,c,m);d[2]=f(q[2],r[2],t[2],s[2],e,c,m);return d},f=function(a,b,c,d,e,f,m){a=.5*(c-a);d=.5*(d-b);return(2*(b-c)+a+d)*m+
(-3*(b-c)-2*a-d)*f+a*e+b};return function(f){if(!1!==this.isPlaying&&(this.currentTime+=f*this.timeScale,0!==this.weight)){f=this.data.length;if(this.currentTime>f||0>this.currentTime)if(this.loop)this.currentTime%=f,0>this.currentTime&&(this.currentTime+=f),this.reset();else{this.stop();return}f=0;for(var h=this.hierarchy.length;f<h;f++)for(var k=this.hierarchy[f],n=k.animationCache.animations[this.data.name],p=k.animationCache.blending,q=0;3>q;q++){var m=this.keyTypes[q],r=n.prevKey[m],t=n.nextKey[m];
if(0<this.timeScale&&t.time<=this.currentTime||0>this.timeScale&&r.time>=this.currentTime){r=this.data.hierarchy[f].keys[0];for(t=this.getNextKeyWith(m,f,1);t.time<this.currentTime&&t.index>r.index;)r=t,t=this.getNextKeyWith(m,f,t.index+1);n.prevKey[m]=r;n.nextKey[m]=t}k.matrixAutoUpdate=!0;k.matrixWorldNeedsUpdate=!0;var s=(this.currentTime-r.time)/(t.time-r.time),u=r[m],v=t[m];0>s&&(s=0);1<s&&(s=1);if("pos"===m)if(this.interpolationType===THREE.AnimationHandler.LINEAR)c.x=u[0]+(v[0]-u[0])*s,c.y=
u[1]+(v[1]-u[1])*s,c.z=u[2]+(v[2]-u[2])*s,r=this.weight/(this.weight+p.positionWeight),k.position.lerp(c,r),p.positionWeight+=this.weight;else{if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)a[0]=this.getPrevKeyWith("pos",f,r.index-1).pos,a[1]=u,a[2]=v,a[3]=this.getNextKeyWith("pos",f,t.index+1).pos,s=.33*s+.33,t=e(a,s),r=this.weight/(this.weight+p.positionWeight),p.positionWeight+=this.weight,m=k.position,m.x+=(t[0]-
m.x)*r,m.y+=(t[1]-m.y)*r,m.z+=(t[2]-m.z)*r,this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(s=e(a,1.01*s),b.set(s[0],s[1],s[2]),b.sub(m),b.y=0,b.normalize(),s=Math.atan2(b.x,b.z),k.rotation.set(0,s,0))}else"rot"===m?(THREE.Quaternion.slerp(u,v,d,s),0===p.quaternionWeight?(k.quaternion.copy(d),p.quaternionWeight=this.weight):(r=this.weight/(this.weight+p.quaternionWeight),THREE.Quaternion.slerp(k.quaternion,d,k.quaternion,r),p.quaternionWeight+=this.weight)):"scl"===m&&(c.x=u[0]+
(v[0]-u[0])*s,c.y=u[1]+(v[1]-u[1])*s,c.z=u[2]+(v[2]-u[2])*s,r=this.weight/(this.weight+p.scaleWeight),k.scale.lerp(c,r),p.scaleWeight+=this.weight)}return!0}}}();THREE.Animation.prototype.getNextKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?c<d.length-1?c:d.length-1:c%d.length;c<d.length;c++)if(void 0!==d[c][a])return d[c];return this.data.hierarchy[b].keys[0]};
THREE.Animation.prototype.getPrevKeyWith=function(a,b,c){var d=this.data.hierarchy[b].keys;for(c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?0<c?c:0:0<=c?c:c+d.length;0<=c;c--)if(void 0!==d[c][a])return d[c];return this.data.hierarchy[b].keys[d.length-1]};
THREE.KeyFrameAnimation=function(a){this.root=a.node;this.data=THREE.AnimationHandler.init(a);this.hierarchy=THREE.AnimationHandler.parse(this.root);this.currentTime=0;this.timeScale=.001;this.isPlaying=!1;this.loop=this.isPaused=!0;a=0;for(var b=this.hierarchy.length;a<b;a++){var c=this.data.hierarchy[a].sids,d=this.hierarchy[a];if(this.data.hierarchy[a].keys.length&&c){for(var e=0;e<c.length;e++){var f=c[e],g=this.getNextKeyWith(f,a,0);g&&g.apply(f)}d.matrixAutoUpdate=!1;this.data.hierarchy[a].node.updateMatrix();
d.matrixWorldNeedsUpdate=!0}}};
THREE.KeyFrameAnimation.prototype.play=function(a){this.currentTime=void 0!==a?a:0;if(!1===this.isPlaying){this.isPlaying=!0;var b=this.hierarchy.length,c,d;for(a=0;a<b;a++)c=this.hierarchy[a],d=this.data.hierarchy[a],void 0===d.animationCache&&(d.animationCache={},d.animationCache.prevKey=null,d.animationCache.nextKey=null,d.animationCache.originalMatrix=c.matrix),c=this.data.hierarchy[a].keys,c.length&&(d.animationCache.prevKey=c[0],d.animationCache.nextKey=c[1],this.startTime=Math.min(c[0].time,
this.startTime),this.endTime=Math.max(c[c.length-1].time,this.endTime));this.update(0)}this.isPaused=!1;THREE.AnimationHandler.play(this)};THREE.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;THREE.AnimationHandler.stop(this);for(var a=0;a<this.data.hierarchy.length;a++){var b=this.hierarchy[a],c=this.data.hierarchy[a];if(void 0!==c.animationCache){var d=c.animationCache.originalMatrix;d.copy(b.matrix);b.matrix=d;delete c.animationCache}}};
THREE.KeyFrameAnimation.prototype.update=function(a){if(!1!==this.isPlaying){this.currentTime+=a*this.timeScale;a=this.data.length;!0===this.loop&&this.currentTime>a&&(this.currentTime%=a);this.currentTime=Math.min(this.currentTime,a);a=0;for(var b=this.hierarchy.length;a<b;a++){var c=this.hierarchy[a],d=this.data.hierarchy[a],e=d.keys,d=d.animationCache;if(e.length){var f=d.prevKey,g=d.nextKey;if(g.time<=this.currentTime){for(;g.time<this.currentTime&&g.index>f.index;)f=g,g=e[f.index+1];d.prevKey=
f;d.nextKey=g}g.time>=this.currentTime?f.interpolate(g,this.currentTime):f.interpolate(g,g.time);this.data.hierarchy[a].node.updateMatrix();c.matrixWorldNeedsUpdate=!0}}}};THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(a,b,c){b=this.data.hierarchy[b].keys;for(c%=b.length;c<b.length;c++)if(b[c].hasTarget(a))return b[c];return b[0]};
THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(a,b,c){b=this.data.hierarchy[b].keys;for(c=0<=c?c:c+b.length;0<=c;c--)if(b[c].hasTarget(a))return b[c];return b[b.length-1]};THREE.MorphAnimation=function(a){this.mesh=a;this.frames=a.morphTargetInfluences.length;this.currentTime=0;this.duration=1E3;this.loop=!0;this.isPlaying=!1};
THREE.MorphAnimation.prototype={play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(){var a=0,b=0;return function(c){if(!1!==this.isPlaying){this.currentTime+=c;!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration);this.currentTime=Math.min(this.currentTime,this.duration);c=this.duration/this.frames;var d=Math.floor(this.currentTime/c);d!=b&&(this.mesh.morphTargetInfluences[a]=0,this.mesh.morphTargetInfluences[b]=1,this.mesh.morphTargetInfluences[d]=
0,a=b,b=d);this.mesh.morphTargetInfluences[d]=this.currentTime%c/c;this.mesh.morphTargetInfluences[a]=1-this.mesh.morphTargetInfluences[d]}}}()};
THREE.BoxGeometry=function(a,b,c,d,e,f){function g(a,b,c,d,e,f,g,s){var u,v=h.widthSegments,y=h.heightSegments,G=e/2,w=f/2,K=h.vertices.length;if("x"===a&&"y"===b||"y"===a&&"x"===b)u="z";else if("x"===a&&"z"===b||"z"===a&&"x"===b)u="y",y=h.depthSegments;else if("z"===a&&"y"===b||"y"===a&&"z"===b)u="x",v=h.depthSegments;var x=v+1,D=y+1,E=e/v,A=f/y,B=new THREE.Vector3;B[u]=0<g?1:-1;for(e=0;e<D;e++)for(f=0;f<x;f++){var F=new THREE.Vector3;F[a]=(f*E-G)*c;F[b]=(e*A-w)*d;F[u]=g;h.vertices.push(F)}for(e=
0;e<y;e++)for(f=0;f<v;f++)w=f+x*e,a=f+x*(e+1),b=f+1+x*(e+1),c=f+1+x*e,d=new THREE.Vector2(f/v,1-e/y),g=new THREE.Vector2(f/v,1-(e+1)/y),u=new THREE.Vector2((f+1)/v,1-(e+1)/y),G=new THREE.Vector2((f+1)/v,1-e/y),w=new THREE.Face3(w+K,a+K,c+K),w.normal.copy(B),w.vertexNormals.push(B.clone(),B.clone(),B.clone()),w.materialIndex=s,h.faces.push(w),h.faceVertexUvs[0].push([d,g,G]),w=new THREE.Face3(a+K,b+K,c+K),w.normal.copy(B),w.vertexNormals.push(B.clone(),B.clone(),B.clone()),w.materialIndex=s,h.faces.push(w),
h.faceVertexUvs[0].push([g.clone(),u,G.clone()])}THREE.Geometry.call(this);this.type="BoxGeometry";this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};this.widthSegments=d||1;this.heightSegments=e||1;this.depthSegments=f||1;var h=this;d=a/2;e=b/2;f=c/2;g("z","y",-1,-1,c,b,d,0);g("z","y",1,-1,c,b,-d,1);g("x","z",1,1,a,c,e,2);g("x","z",1,-1,a,c,-e,3);g("x","y",1,-1,a,b,f,4);g("x","y",-1,-1,a,b,-f,5);this.mergeVertices()};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.CircleGeometry=function(a,b,c,d){THREE.Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d};a=a||50;b=void 0!==b?Math.max(3,b):8;c=void 0!==c?c:0;d=void 0!==d?d:2*Math.PI;var e,f=[];e=new THREE.Vector3;var g=new THREE.Vector2(.5,.5);this.vertices.push(e);f.push(g);for(e=0;e<=b;e++){var h=new THREE.Vector3,k=c+e/b*d;h.x=a*Math.cos(k);h.y=a*Math.sin(k);this.vertices.push(h);f.push(new THREE.Vector2((h.x/a+1)/2,(h.y/a+1)/2))}c=new THREE.Vector3(0,
0,1);for(e=1;e<=b;e++)this.faces.push(new THREE.Face3(e,e+1,0,[c.clone(),c.clone(),c.clone()])),this.faceVertexUvs[0].push([f[e].clone(),f[e+1].clone(),g.clone()]);this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CubeGeometry=function(a,b,c,d,e,f){console.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry.");return new THREE.BoxGeometry(a,b,c,d,e,f)};
THREE.CylinderGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f};a=void 0!==a?a:20;b=void 0!==b?b:20;c=void 0!==c?c:100;d=d||8;e=e||1;f=void 0!==f?f:!1;var g=c/2,h,k,n=[],p=[];for(k=0;k<=e;k++){var q=[],m=[],r=k/e,t=r*(b-a)+a;for(h=0;h<=d;h++){var s=h/d,u=new THREE.Vector3;u.x=t*Math.sin(s*Math.PI*2);u.y=-r*c+g;u.z=t*Math.cos(s*Math.PI*2);this.vertices.push(u);q.push(this.vertices.length-
1);m.push(new THREE.Vector2(s,1-r))}n.push(q);p.push(m)}c=(b-a)/c;for(h=0;h<d;h++)for(0!==a?(q=this.vertices[n[0][h]].clone(),m=this.vertices[n[0][h+1]].clone()):(q=this.vertices[n[1][h]].clone(),m=this.vertices[n[1][h+1]].clone()),q.setY(Math.sqrt(q.x*q.x+q.z*q.z)*c).normalize(),m.setY(Math.sqrt(m.x*m.x+m.z*m.z)*c).normalize(),k=0;k<e;k++){var r=n[k][h],t=n[k+1][h],s=n[k+1][h+1],u=n[k][h+1],v=q.clone(),y=q.clone(),G=m.clone(),w=m.clone(),K=p[k][h].clone(),x=p[k+1][h].clone(),D=p[k+1][h+1].clone(),
E=p[k][h+1].clone();this.faces.push(new THREE.Face3(r,t,u,[v,y,w]));this.faceVertexUvs[0].push([K,x,E]);this.faces.push(new THREE.Face3(t,s,u,[y.clone(),G,w.clone()]));this.faceVertexUvs[0].push([x.clone(),D,E.clone()])}if(!1===f&&0<a)for(this.vertices.push(new THREE.Vector3(0,g,0)),h=0;h<d;h++)r=n[0][h],t=n[0][h+1],s=this.vertices.length-1,v=new THREE.Vector3(0,1,0),y=new THREE.Vector3(0,1,0),G=new THREE.Vector3(0,1,0),K=p[0][h].clone(),x=p[0][h+1].clone(),D=new THREE.Vector2(x.x,0),this.faces.push(new THREE.Face3(r,
t,s,[v,y,G])),this.faceVertexUvs[0].push([K,x,D]);if(!1===f&&0<b)for(this.vertices.push(new THREE.Vector3(0,-g,0)),h=0;h<d;h++)r=n[k][h+1],t=n[k][h],s=this.vertices.length-1,v=new THREE.Vector3(0,-1,0),y=new THREE.Vector3(0,-1,0),G=new THREE.Vector3(0,-1,0),K=p[k][h+1].clone(),x=p[k][h].clone(),D=new THREE.Vector2(x.x,1),this.faces.push(new THREE.Face3(r,t,s,[v,y,G])),this.faceVertexUvs[0].push([K,x,D]);this.computeFaceNormals()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.ExtrudeGeometry=function(a,b){"undefined"!==typeof a&&(THREE.Geometry.call(this),this.type="ExtrudeGeometry",a=a instanceof Array?a:[a],this.addShapeList(a,b),this.computeFaceNormals())};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.addShapeList=function(a,b){for(var c=a.length,d=0;d<c;d++)this.addShape(a[d],b)};
THREE.ExtrudeGeometry.prototype.addShape=function(a,b){function c(a,b,c){b||console.log("die");return b.clone().multiplyScalar(c).add(a)}function d(a,b,c){var d=1,d=a.x-b.x,e=a.y-b.y,f=c.x-a.x,g=c.y-a.y,h=d*d+e*e;if(1E-10<Math.abs(d*g-e*f)){var k=Math.sqrt(h),m=Math.sqrt(f*f+g*g),h=b.x-e/k;b=b.y+d/k;f=((c.x-g/m-h)*g-(c.y+f/m-b)*f)/(d*g-e*f);c=h+d*f-a.x;a=b+e*f-a.y;d=c*c+a*a;if(2>=d)return new THREE.Vector2(c,a);d=Math.sqrt(d/2)}else a=!1,1E-10<d?1E-10<f&&(a=!0):-1E-10>d?-1E-10>f&&(a=!0):Math.sign(e)==
Math.sign(g)&&(a=!0),a?(c=-e,a=d,d=Math.sqrt(h)):(c=d,a=e,d=Math.sqrt(h/2));return new THREE.Vector2(c/d,a/d)}function e(a,b){var c,d;for(P=a.length;0<=--P;){c=P;d=P-1;0>d&&(d=a.length-1);for(var e=0,f=r+2*p,e=0;e<f;e++){var g=la*e,h=la*(e+1),k=b+c+g,g=b+d+g,m=b+d+h,h=b+c+h,k=k+R,g=g+R,m=m+R,h=h+R;F.faces.push(new THREE.Face3(k,g,h,null,null,y));F.faces.push(new THREE.Face3(g,m,h,null,null,y));k=G.generateSideWallUV(F,k,g,m,h);F.faceVertexUvs[0].push([k[0],k[1],k[3]]);F.faceVertexUvs[0].push([k[1],
k[2],k[3]])}}}function f(a,b,c){F.vertices.push(new THREE.Vector3(a,b,c))}function g(a,b,c){a+=R;b+=R;c+=R;F.faces.push(new THREE.Face3(a,b,c,null,null,v));a=G.generateTopUV(F,a,b,c);F.faceVertexUvs[0].push(a)}var h=void 0!==b.amount?b.amount:100,k=void 0!==b.bevelThickness?b.bevelThickness:6,n=void 0!==b.bevelSize?b.bevelSize:k-2,p=void 0!==b.bevelSegments?b.bevelSegments:3,q=void 0!==b.bevelEnabled?b.bevelEnabled:!0,m=void 0!==b.curveSegments?b.curveSegments:12,r=void 0!==b.steps?b.steps:1,t=b.extrudePath,
s,u=!1,v=b.material,y=b.extrudeMaterial,G=void 0!==b.UVGenerator?b.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator,w,K,x,D;t&&(s=t.getSpacedPoints(r),u=!0,q=!1,w=void 0!==b.frames?b.frames:new THREE.TubeGeometry.FrenetFrames(t,r,!1),K=new THREE.Vector3,x=new THREE.Vector3,D=new THREE.Vector3);q||(n=k=p=0);var E,A,B,F=this,R=this.vertices.length,t=a.extractPoints(m),m=t.shape,H=t.holes;if(t=!THREE.Shape.Utils.isClockWise(m)){m=m.reverse();A=0;for(B=H.length;A<B;A++)E=H[A],THREE.Shape.Utils.isClockWise(E)&&
(H[A]=E.reverse());t=!1}var C=THREE.Shape.Utils.triangulateShape(m,H),T=m;A=0;for(B=H.length;A<B;A++)E=H[A],m=m.concat(E);var Q,O,S,X,Y,la=m.length,ma,ya=C.length,t=[],P=0;S=T.length;Q=S-1;for(O=P+1;P<S;P++,Q++,O++)Q===S&&(Q=0),O===S&&(O=0),t[P]=d(T[P],T[Q],T[O]);var Ga=[],Fa,za=t.concat();A=0;for(B=H.length;A<B;A++){E=H[A];Fa=[];P=0;S=E.length;Q=S-1;for(O=P+1;P<S;P++,Q++,O++)Q===S&&(Q=0),O===S&&(O=0),Fa[P]=d(E[P],E[Q],E[O]);Ga.push(Fa);za=za.concat(Fa)}for(Q=0;Q<p;Q++){S=Q/p;X=k*(1-S);O=n*Math.sin(S*
Math.PI/2);P=0;for(S=T.length;P<S;P++)Y=c(T[P],t[P],O),f(Y.x,Y.y,-X);A=0;for(B=H.length;A<B;A++)for(E=H[A],Fa=Ga[A],P=0,S=E.length;P<S;P++)Y=c(E[P],Fa[P],O),f(Y.x,Y.y,-X)}O=n;for(P=0;P<la;P++)Y=q?c(m[P],za[P],O):m[P],u?(x.copy(w.normals[0]).multiplyScalar(Y.x),K.copy(w.binormals[0]).multiplyScalar(Y.y),D.copy(s[0]).add(x).add(K),f(D.x,D.y,D.z)):f(Y.x,Y.y,0);for(S=1;S<=r;S++)for(P=0;P<la;P++)Y=q?c(m[P],za[P],O):m[P],u?(x.copy(w.normals[S]).multiplyScalar(Y.x),K.copy(w.binormals[S]).multiplyScalar(Y.y),
D.copy(s[S]).add(x).add(K),f(D.x,D.y,D.z)):f(Y.x,Y.y,h/r*S);for(Q=p-1;0<=Q;Q--){S=Q/p;X=k*(1-S);O=n*Math.sin(S*Math.PI/2);P=0;for(S=T.length;P<S;P++)Y=c(T[P],t[P],O),f(Y.x,Y.y,h+X);A=0;for(B=H.length;A<B;A++)for(E=H[A],Fa=Ga[A],P=0,S=E.length;P<S;P++)Y=c(E[P],Fa[P],O),u?f(Y.x,Y.y+s[r-1].y,s[r-1].x+X):f(Y.x,Y.y,h+X)}(function(){if(q){var a;a=0*la;for(P=0;P<ya;P++)ma=C[P],g(ma[2]+a,ma[1]+a,ma[0]+a);a=r+2*p;a*=la;for(P=0;P<ya;P++)ma=C[P],g(ma[0]+a,ma[1]+a,ma[2]+a)}else{for(P=0;P<ya;P++)ma=C[P],g(ma[2],
ma[1],ma[0]);for(P=0;P<ya;P++)ma=C[P],g(ma[0]+la*r,ma[1]+la*r,ma[2]+la*r)}})();(function(){var a=0;e(T,a);a+=T.length;A=0;for(B=H.length;A<B;A++)E=H[A],e(E,a),a+=E.length})()};
THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(a,b,c,d){a=a.vertices;b=a[b];c=a[c];d=a[d];return[new THREE.Vector2(b.x,b.y),new THREE.Vector2(c.x,c.y),new THREE.Vector2(d.x,d.y)]},generateSideWallUV:function(a,b,c,d,e){a=a.vertices;b=a[b];c=a[c];d=a[d];e=a[e];return.01>Math.abs(b.y-c.y)?[new THREE.Vector2(b.x,1-b.z),new THREE.Vector2(c.x,1-c.z),new THREE.Vector2(d.x,1-d.z),new THREE.Vector2(e.x,1-e.z)]:[new THREE.Vector2(b.y,1-b.z),new THREE.Vector2(c.y,1-c.z),new THREE.Vector2(d.y,
1-d.z),new THREE.Vector2(e.y,1-e.z)]}};THREE.ShapeGeometry=function(a,b){THREE.Geometry.call(this);this.type="ShapeGeometry";!1===a instanceof Array&&(a=[a]);this.addShapeList(a,b);this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.addShapeList=function(a,b){for(var c=0,d=a.length;c<d;c++)this.addShape(a[c],b);return this};
THREE.ShapeGeometry.prototype.addShape=function(a,b){void 0===b&&(b={});var c=b.material,d=void 0===b.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:b.UVGenerator,e,f,g,h=this.vertices.length;e=a.extractPoints(void 0!==b.curveSegments?b.curveSegments:12);var k=e.shape,n=e.holes;if(!THREE.Shape.Utils.isClockWise(k))for(k=k.reverse(),e=0,f=n.length;e<f;e++)g=n[e],THREE.Shape.Utils.isClockWise(g)&&(n[e]=g.reverse());var p=THREE.Shape.Utils.triangulateShape(k,n);e=0;for(f=n.length;e<f;e++)g=n[e],
k=k.concat(g);n=k.length;f=p.length;for(e=0;e<n;e++)g=k[e],this.vertices.push(new THREE.Vector3(g.x,g.y,0));for(e=0;e<f;e++)n=p[e],k=n[0]+h,g=n[1]+h,n=n[2]+h,this.faces.push(new THREE.Face3(k,g,n,null,null,c)),this.faceVertexUvs[0].push(d.generateTopUV(this,k,g,n))};
THREE.LatheGeometry=function(a,b,c,d){THREE.Geometry.call(this);this.type="LatheGeometry";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};b=b||12;c=c||0;d=d||2*Math.PI;for(var e=1/(a.length-1),f=1/b,g=0,h=b;g<=h;g++)for(var k=c+g*f*d,n=Math.cos(k),p=Math.sin(k),k=0,q=a.length;k<q;k++){var m=a[k],r=new THREE.Vector3;r.x=n*m.x-p*m.y;r.y=p*m.x+n*m.y;r.z=m.z;this.vertices.push(r)}c=a.length;g=0;for(h=b;g<h;g++)for(k=0,q=a.length-1;k<q;k++){b=p=k+c*g;d=p+c;var n=p+1+c,p=p+1,m=g*f,r=k*e,t=
m+f,s=r+e;this.faces.push(new THREE.Face3(b,d,p));this.faceVertexUvs[0].push([new THREE.Vector2(m,r),new THREE.Vector2(t,r),new THREE.Vector2(m,s)]);this.faces.push(new THREE.Face3(d,n,p));this.faceVertexUvs[0].push([new THREE.Vector2(t,r),new THREE.Vector2(t,s),new THREE.Vector2(m,s)])}this.mergeVertices();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.PlaneGeometry=function(a,b,c,d){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint.");THREE.Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};this.fromBufferGeometry(new THREE.PlaneBufferGeometry(a,b,c,d))};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.PlaneBufferGeometry=function(a,b,c,d){THREE.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};var e=a/2,f=b/2;c=c||1;d=d||1;var g=c+1,h=d+1,k=a/c,n=b/d;b=new Float32Array(g*h*3);a=new Float32Array(g*h*3);for(var p=new Float32Array(g*h*2),q=0,m=0,r=0;r<h;r++)for(var t=r*n-f,s=0;s<g;s++)b[q]=s*k-e,b[q+1]=-t,a[q+2]=1,p[m]=s/c,p[m+1]=1-r/d,q+=3,m+=2;q=0;e=new (65535<b.length/3?Uint32Array:Uint16Array)(c*d*6);for(r=0;r<d;r++)for(s=
0;s<c;s++)f=s+g*(r+1),h=s+1+g*(r+1),k=s+1+g*r,e[q]=s+g*r,e[q+1]=f,e[q+2]=k,e[q+3]=f,e[q+4]=h,e[q+5]=k,q+=6;this.addAttribute("index",new THREE.BufferAttribute(e,1));this.addAttribute("position",new THREE.BufferAttribute(b,3));this.addAttribute("normal",new THREE.BufferAttribute(a,3));this.addAttribute("uv",new THREE.BufferAttribute(p,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);
THREE.RingGeometry=function(a,b,c,d,e,f){THREE.Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};a=a||0;b=b||50;e=void 0!==e?e:0;f=void 0!==f?f:2*Math.PI;c=void 0!==c?Math.max(3,c):8;d=void 0!==d?Math.max(1,d):8;var g,h=[],k=a,n=(b-a)/d;for(a=0;a<d+1;a++){for(g=0;g<c+1;g++){var p=new THREE.Vector3,q=e+g/c*f;p.x=k*Math.cos(q);p.y=k*Math.sin(q);this.vertices.push(p);h.push(new THREE.Vector2((p.x/b+1)/2,
(p.y/b+1)/2))}k+=n}b=new THREE.Vector3(0,0,1);for(a=0;a<d;a++)for(e=a*(c+1),g=0;g<c;g++)f=q=g+e,n=q+c+1,p=q+c+2,this.faces.push(new THREE.Face3(f,n,p,[b.clone(),b.clone(),b.clone()])),this.faceVertexUvs[0].push([h[f].clone(),h[n].clone(),h[p].clone()]),f=q,n=q+c+2,p=q+1,this.faces.push(new THREE.Face3(f,n,p,[b.clone(),b.clone(),b.clone()])),this.faceVertexUvs[0].push([h[f].clone(),h[n].clone(),h[p].clone()]);this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,k)};
THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.SphereGeometry=function(a,b,c,d,e,f,g){THREE.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};a=a||50;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;f=void 0!==f?f:0;g=void 0!==g?g:Math.PI;var h,k,n=[],p=[];for(k=0;k<=c;k++){var q=[],m=[];for(h=0;h<=b;h++){var r=h/b,t=k/c,s=new THREE.Vector3;s.x=-a*Math.cos(d+r*e)*Math.sin(f+t*g);
s.y=a*Math.cos(f+t*g);s.z=a*Math.sin(d+r*e)*Math.sin(f+t*g);this.vertices.push(s);q.push(this.vertices.length-1);m.push(new THREE.Vector2(r,1-t))}n.push(q);p.push(m)}for(k=0;k<c;k++)for(h=0;h<b;h++){d=n[k][h+1];e=n[k][h];f=n[k+1][h];g=n[k+1][h+1];var q=this.vertices[d].clone().normalize(),m=this.vertices[e].clone().normalize(),r=this.vertices[f].clone().normalize(),t=this.vertices[g].clone().normalize(),s=p[k][h+1].clone(),u=p[k][h].clone(),v=p[k+1][h].clone(),y=p[k+1][h+1].clone();Math.abs(this.vertices[d].y)===
a?(s.x=(s.x+u.x)/2,this.faces.push(new THREE.Face3(d,f,g,[q,r,t])),this.faceVertexUvs[0].push([s,v,y])):Math.abs(this.vertices[f].y)===a?(v.x=(v.x+y.x)/2,this.faces.push(new THREE.Face3(d,e,f,[q,m,r])),this.faceVertexUvs[0].push([s,u,v])):(this.faces.push(new THREE.Face3(d,e,g,[q,m,t])),this.faceVertexUvs[0].push([s,u,y]),this.faces.push(new THREE.Face3(e,f,g,[m.clone(),r,t.clone()])),this.faceVertexUvs[0].push([u.clone(),v,y.clone()]))}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,
a)};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TextGeometry=function(a,b){b=b||{};var c=THREE.FontUtils.generateShapes(a,b);b.amount=void 0!==b.height?b.height:50;void 0===b.bevelThickness&&(b.bevelThickness=10);void 0===b.bevelSize&&(b.bevelSize=8);void 0===b.bevelEnabled&&(b.bevelEnabled=!1);THREE.ExtrudeGeometry.call(this,c,b);this.type="TextGeometry"};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);
THREE.TorusGeometry=function(a,b,c,d,e){THREE.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};a=a||100;b=b||40;c=c||8;d=d||6;e=e||2*Math.PI;for(var f=new THREE.Vector3,g=[],h=[],k=0;k<=c;k++)for(var n=0;n<=d;n++){var p=n/d*e,q=k/c*Math.PI*2;f.x=a*Math.cos(p);f.y=a*Math.sin(p);var m=new THREE.Vector3;m.x=(a+b*Math.cos(q))*Math.cos(p);m.y=(a+b*Math.cos(q))*Math.sin(p);m.z=b*Math.sin(q);this.vertices.push(m);g.push(new THREE.Vector2(n/
d,k/c));h.push(m.clone().sub(f).normalize())}for(k=1;k<=c;k++)for(n=1;n<=d;n++)a=(d+1)*k+n-1,b=(d+1)*(k-1)+n-1,e=(d+1)*(k-1)+n,f=(d+1)*k+n,p=new THREE.Face3(a,b,f,[h[a].clone(),h[b].clone(),h[f].clone()]),this.faces.push(p),this.faceVertexUvs[0].push([g[a].clone(),g[b].clone(),g[f].clone()]),p=new THREE.Face3(b,e,f,[h[b].clone(),h[e].clone(),h[f].clone()]),this.faces.push(p),this.faceVertexUvs[0].push([g[b].clone(),g[e].clone(),g[f].clone()]);this.computeFaceNormals()};
THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.TorusKnotGeometry=function(a,b,c,d,e,f,g){function h(a,b,c,d,e){var f=Math.cos(a),g=Math.sin(a);a*=b/c;b=Math.cos(a);f*=d*(2+b)*.5;g=d*(2+b)*g*.5;d=e*d*Math.sin(a)*.5;return new THREE.Vector3(f,g,d)}THREE.Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,p:e,q:f,heightScale:g};a=a||100;b=b||40;c=c||64;d=d||8;e=e||2;f=f||3;g=g||1;for(var k=Array(c),n=new THREE.Vector3,p=new THREE.Vector3,q=new THREE.Vector3,m=0;m<c;++m){k[m]=
Array(d);var r=m/c*2*e*Math.PI,t=h(r,f,e,a,g),r=h(r+.01,f,e,a,g);n.subVectors(r,t);p.addVectors(r,t);q.crossVectors(n,p);p.crossVectors(q,n);q.normalize();p.normalize();for(r=0;r<d;++r){var s=r/d*2*Math.PI,u=-b*Math.cos(s),s=b*Math.sin(s),v=new THREE.Vector3;v.x=t.x+u*p.x+s*q.x;v.y=t.y+u*p.y+s*q.y;v.z=t.z+u*p.z+s*q.z;k[m][r]=this.vertices.push(v)-1}}for(m=0;m<c;++m)for(r=0;r<d;++r)e=(m+1)%c,f=(r+1)%d,a=k[m][r],b=k[e][r],e=k[e][f],f=k[m][f],g=new THREE.Vector2(m/c,r/d),n=new THREE.Vector2((m+1)/c,
r/d),p=new THREE.Vector2((m+1)/c,(r+1)/d),q=new THREE.Vector2(m/c,(r+1)/d),this.faces.push(new THREE.Face3(a,b,f)),this.faceVertexUvs[0].push([g,n,q]),this.faces.push(new THREE.Face3(b,e,f)),this.faceVertexUvs[0].push([n.clone(),p,q.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.TubeGeometry=function(a,b,c,d,e){THREE.Geometry.call(this);this.type="TubeGeometry";this.parameters={path:a,segments:b,radius:c,radialSegments:d,closed:e};b=b||64;c=c||1;d=d||8;e=e||!1;var f=[],g,h,k=b+1,n,p,q,m,r=new THREE.Vector3,t,s,u;t=new THREE.TubeGeometry.FrenetFrames(a,b,e);s=t.normals;u=t.binormals;this.tangents=t.tangents;this.normals=s;this.binormals=u;for(t=0;t<k;t++)for(f[t]=[],n=t/(k-1),m=a.getPointAt(n),g=s[t],h=u[t],n=0;n<d;n++)p=n/d*2*Math.PI,q=-c*Math.cos(p),p=c*Math.sin(p),
r.copy(m),r.x+=q*g.x+p*h.x,r.y+=q*g.y+p*h.y,r.z+=q*g.z+p*h.z,f[t][n]=this.vertices.push(new THREE.Vector3(r.x,r.y,r.z))-1;for(t=0;t<b;t++)for(n=0;n<d;n++)k=e?(t+1)%b:t+1,r=(n+1)%d,a=f[t][n],c=f[k][n],k=f[k][r],r=f[t][r],s=new THREE.Vector2(t/b,n/d),u=new THREE.Vector2((t+1)/b,n/d),g=new THREE.Vector2((t+1)/b,(n+1)/d),h=new THREE.Vector2(t/b,(n+1)/d),this.faces.push(new THREE.Face3(a,c,r)),this.faceVertexUvs[0].push([s,u,h]),this.faces.push(new THREE.Face3(c,k,r)),this.faceVertexUvs[0].push([u.clone(),
g,h.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.TubeGeometry.FrenetFrames=function(a,b,c){new THREE.Vector3;var d=new THREE.Vector3;new THREE.Vector3;var e=[],f=[],g=[],h=new THREE.Vector3,k=new THREE.Matrix4;b+=1;var n,p,q;this.tangents=e;this.normals=f;this.binormals=g;for(n=0;n<b;n++)p=n/(b-1),e[n]=a.getTangentAt(p),e[n].normalize();f[0]=new THREE.Vector3;g[0]=new THREE.Vector3;a=Number.MAX_VALUE;n=Math.abs(e[0].x);p=Math.abs(e[0].y);q=Math.abs(e[0].z);n<=a&&(a=n,d.set(1,0,0));p<=a&&(a=p,d.set(0,1,0));q<=a&&d.set(0,0,1);h.crossVectors(e[0],
d).normalize();f[0].crossVectors(e[0],h);g[0].crossVectors(e[0],f[0]);for(n=1;n<b;n++)f[n]=f[n-1].clone(),g[n]=g[n-1].clone(),h.crossVectors(e[n-1],e[n]),1E-4<h.length()&&(h.normalize(),d=Math.acos(THREE.Math.clamp(e[n-1].dot(e[n]),-1,1)),f[n].applyMatrix4(k.makeRotationAxis(h,d))),g[n].crossVectors(e[n],f[n]);if(c)for(d=Math.acos(THREE.Math.clamp(f[0].dot(f[b-1]),-1,1)),d/=b-1,0<e[0].dot(h.crossVectors(f[0],f[b-1]))&&(d=-d),n=1;n<b;n++)f[n].applyMatrix4(k.makeRotationAxis(e[n],d*n)),g[n].crossVectors(e[n],
f[n])};
THREE.PolyhedronGeometry=function(a,b,c,d){function e(a){var b=a.normalize().clone();b.index=k.vertices.push(b)-1;var c=Math.atan2(a.z,-a.x)/2/Math.PI+.5;a=Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5;b.uv=new THREE.Vector2(c,1-a);return b}function f(a,b,c){var d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);k.faces.push(d);u.copy(a).add(b).add(c).divideScalar(3);d=Math.atan2(u.z,-u.x);k.faceVertexUvs[0].push([h(a.uv,a,d),h(b.uv,b,d),h(c.uv,c,d)])}function g(a,b){var c=
Math.pow(2,b);Math.pow(4,b);for(var d=e(k.vertices[a.a]),g=e(k.vertices[a.b]),h=e(k.vertices[a.c]),m=[],n=0;n<=c;n++){m[n]=[];for(var p=e(d.clone().lerp(h,n/c)),q=e(g.clone().lerp(h,n/c)),r=c-n,s=0;s<=r;s++)m[n][s]=0==s&&n==c?p:e(p.clone().lerp(q,s/r))}for(n=0;n<c;n++)for(s=0;s<2*(c-n)-1;s++)d=Math.floor(s/2),0==s%2?f(m[n][d+1],m[n+1][d],m[n][d]):f(m[n][d+1],m[n+1][d+1],m[n+1][d])}function h(a,b,c){0>c&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y));0===b.x&&0===b.z&&(a=new THREE.Vector2(c/2/Math.PI+.5,
a.y));return a.clone()}THREE.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:a,indices:b,radius:c,detail:d};c=c||1;d=d||0;for(var k=this,n=0,p=a.length;n<p;n+=3)e(new THREE.Vector3(a[n],a[n+1],a[n+2]));a=this.vertices;for(var q=[],m=n=0,p=b.length;n<p;n+=3,m++){var r=a[b[n]],t=a[b[n+1]],s=a[b[n+2]];q[m]=new THREE.Face3(r.index,t.index,s.index,[r.clone(),t.clone(),s.clone()])}for(var u=new THREE.Vector3,n=0,p=q.length;n<p;n++)g(q[n],d);n=0;for(p=this.faceVertexUvs[0].length;n<
p;n++)b=this.faceVertexUvs[0][n],d=b[0].x,a=b[1].x,q=b[2].x,m=Math.max(d,Math.max(a,q)),r=Math.min(d,Math.min(a,q)),.9<m&&.1>r&&(.2>d&&(b[0].x+=1),.2>a&&(b[1].x+=1),.2>q&&(b[2].x+=1));n=0;for(p=this.vertices.length;n<p;n++)this.vertices[n].multiplyScalar(c);this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.DodecahedronGeometry=function(a,b){this.parameters={radius:a,detail:b};var c=(1+Math.sqrt(5))/2,d=1/c;THREE.PolyhedronGeometry.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-d,-c,0,-d,c,0,d,-c,0,d,c,-d,-c,0,-d,c,0,d,-c,0,d,c,0,-c,0,-d,c,0,-d,-c,0,d,c,0,d],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,
11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],a,b)};THREE.DodecahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.IcosahedronGeometry=function(a,b){var c=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type="IcosahedronGeometry";this.parameters={radius:a,detail:b}};THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.OctahedronGeometry=function(a,b){this.parameters={radius:a,detail:b};THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b);this.type="OctahedronGeometry";this.parameters={radius:a,detail:b}};THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.TetrahedronGeometry=function(a,b){THREE.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,b);this.type="TetrahedronGeometry";this.parameters={radius:a,detail:b}};THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.ParametricGeometry=function(a,b,c){THREE.Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:a,slices:b,stacks:c};var d=this.vertices,e=this.faces,f=this.faceVertexUvs[0],g,h,k,n,p=b+1;for(g=0;g<=c;g++)for(n=g/c,h=0;h<=b;h++)k=h/b,k=a(k,n),d.push(k);var q,m,r,t;for(g=0;g<c;g++)for(h=0;h<b;h++)a=g*p+h,d=g*p+h+1,n=(g+1)*p+h+1,k=(g+1)*p+h,q=new THREE.Vector2(h/b,g/c),m=new THREE.Vector2((h+1)/b,g/c),r=new THREE.Vector2((h+1)/b,(g+1)/c),t=new THREE.Vector2(h/b,(g+1)/c),e.push(new THREE.Face3(a,
d,k)),f.push([q,m,t]),e.push(new THREE.Face3(d,n,k)),f.push([m.clone(),r,t.clone()]);this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.AxisHelper=function(a){a=a||1;var b=new Float32Array([0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a]),c=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.BufferAttribute(b,3));a.addAttribute("color",new THREE.BufferAttribute(c,3));b=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,a,b,THREE.LinePieces)};THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype);
THREE.ArrowHelper=function(){var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var b=new THREE.CylinderGeometry(0,.5,1,5,1);b.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0));return function(c,d,e,f,g,h){THREE.Object3D.call(this);void 0===f&&(f=16776960);void 0===e&&(e=1);void 0===g&&(g=.2*e);void 0===h&&(h=.2*g);this.position.copy(d);this.line=new THREE.Line(a,new THREE.LineBasicMaterial({color:f}));this.line.matrixAutoUpdate=!1;this.add(this.line);
this.cone=new THREE.Mesh(b,new THREE.MeshBasicMaterial({color:f}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(c);this.setLength(e,g,h)}}();THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.setDirection=function(){var a=new THREE.Vector3,b;return function(c){.99999<c.y?this.quaternion.set(0,0,0,1):-.99999>c.y?this.quaternion.set(1,0,0,0):(a.set(c.z,0,-c.x).normalize(),b=Math.acos(c.y),this.quaternion.setFromAxisAngle(a,b))}}();
THREE.ArrowHelper.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a);void 0===c&&(c=.2*b);this.line.scale.set(1,a,1);this.line.updateMatrix();this.cone.scale.set(c,b,c);this.cone.position.y=a;this.cone.updateMatrix()};THREE.ArrowHelper.prototype.setColor=function(a){this.line.material.color.set(a);this.cone.material.color.set(a)};
THREE.BoxHelper=function(a){var b=new THREE.BufferGeometry;b.addAttribute("position",new THREE.BufferAttribute(new Float32Array(72),3));THREE.Line.call(this,b,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces);void 0!==a&&this.update(a)};THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype);
THREE.BoxHelper.prototype.update=function(a){var b=a.geometry;null===b.boundingBox&&b.computeBoundingBox();var c=b.boundingBox.min,b=b.boundingBox.max,d=this.geometry.attributes.position.array;d[0]=b.x;d[1]=b.y;d[2]=b.z;d[3]=c.x;d[4]=b.y;d[5]=b.z;d[6]=c.x;d[7]=b.y;d[8]=b.z;d[9]=c.x;d[10]=c.y;d[11]=b.z;d[12]=c.x;d[13]=c.y;d[14]=b.z;d[15]=b.x;d[16]=c.y;d[17]=b.z;d[18]=b.x;d[19]=c.y;d[20]=b.z;d[21]=b.x;d[22]=b.y;d[23]=b.z;d[24]=b.x;d[25]=b.y;d[26]=c.z;d[27]=c.x;d[28]=b.y;d[29]=c.z;d[30]=c.x;d[31]=b.y;
d[32]=c.z;d[33]=c.x;d[34]=c.y;d[35]=c.z;d[36]=c.x;d[37]=c.y;d[38]=c.z;d[39]=b.x;d[40]=c.y;d[41]=c.z;d[42]=b.x;d[43]=c.y;d[44]=c.z;d[45]=b.x;d[46]=b.y;d[47]=c.z;d[48]=b.x;d[49]=b.y;d[50]=b.z;d[51]=b.x;d[52]=b.y;d[53]=c.z;d[54]=c.x;d[55]=b.y;d[56]=b.z;d[57]=c.x;d[58]=b.y;d[59]=c.z;d[60]=c.x;d[61]=c.y;d[62]=b.z;d[63]=c.x;d[64]=c.y;d[65]=c.z;d[66]=b.x;d[67]=c.y;d[68]=b.z;d[69]=b.x;d[70]=c.y;d[71]=c.z;this.geometry.attributes.position.needsUpdate=!0;this.geometry.computeBoundingSphere();this.matrix=a.matrixWorld;
this.matrixAutoUpdate=!1};THREE.BoundingBoxHelper=function(a,b){var c=void 0!==b?b:8947848;this.object=a;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:c,wireframe:!0}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};
THREE.CameraHelper=function(a){function b(a,b,d){c(a,d);c(b,d)}function c(a,b){d.vertices.push(new THREE.Vector3);d.colors.push(new THREE.Color(b));void 0===f[a]&&(f[a]=[]);f[a].push(d.vertices.length-1)}var d=new THREE.Geometry,e=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),f={};b("n1","n2",16755200);b("n2","n4",16755200);b("n4","n3",16755200);b("n3","n1",16755200);b("f1","f2",16755200);b("f2","f4",16755200);b("f4","f3",16755200);b("f3","f1",16755200);b("n1","f1",16755200);
b("n2","f2",16755200);b("n3","f3",16755200);b("n4","f4",16755200);b("p","n1",16711680);b("p","n2",16711680);b("p","n3",16711680);b("p","n4",16711680);b("u1","u2",43775);b("u2","u3",43775);b("u3","u1",43775);b("c","t",16777215);b("p","c",3355443);b("cn1","cn2",3355443);b("cn3","cn4",3355443);b("cf1","cf2",3355443);b("cf3","cf4",3355443);THREE.Line.call(this,d,e,THREE.LinePieces);this.camera=a;this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=f;this.update()};
THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype);
THREE.CameraHelper.prototype.update=function(){var a,b,c=new THREE.Vector3,d=new THREE.Camera,e=function(e,g,h,k){c.set(g,h,k).unproject(d);e=b[e];if(void 0!==e)for(g=0,h=e.length;g<h;g++)a.vertices[e[g]].copy(c)};return function(){a=this.geometry;b=this.pointMap;d.projectionMatrix.copy(this.camera.projectionMatrix);e("c",0,0,-1);e("t",0,0,1);e("n1",-1,-1,-1);e("n2",1,-1,-1);e("n3",-1,1,-1);e("n4",1,1,-1);e("f1",-1,-1,1);e("f2",1,-1,1);e("f3",-1,1,1);e("f4",1,1,1);e("u1",.7,1.1,-1);e("u2",-.7,1.1,
-1);e("u3",0,2,-1);e("cf1",-1,0,1);e("cf2",1,0,1);e("cf3",0,-1,1);e("cf4",0,1,1);e("cn1",-1,0,-1);e("cn2",1,0,-1);e("cn3",0,-1,-1);e("cn4",0,1,-1);a.verticesNeedUpdate=!0}}();
THREE.DirectionalLightHelper=function(a,b){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;b=b||1;var c=new THREE.Geometry;c.vertices.push(new THREE.Vector3(-b,b,0),new THREE.Vector3(b,b,0),new THREE.Vector3(b,-b,0),new THREE.Vector3(-b,-b,0),new THREE.Vector3(-b,b,0));var d=new THREE.LineBasicMaterial({fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new THREE.Line(c,d);this.add(this.lightPlane);
c=new THREE.Geometry;c.vertices.push(new THREE.Vector3,new THREE.Vector3);d=new THREE.LineBasicMaterial({fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new THREE.Line(c,d);this.add(this.targetLine);this.update()};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);
THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};
THREE.DirectionalLightHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);c.subVectors(b,a);this.lightPlane.lookAt(c);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(c);this.targetLine.geometry.verticesNeedUpdate=!0;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();
THREE.EdgesHelper=function(a,b){var c=void 0!==b?b:16777215,d=[0,0],e={},f=function(a,b){return a-b},g=["a","b","c"],h=new THREE.BufferGeometry,k=a.geometry.clone();k.mergeVertices();k.computeFaceNormals();for(var n=k.vertices,k=k.faces,p=0,q=0,m=k.length;q<m;q++)for(var r=k[q],t=0;3>t;t++){d[0]=r[g[t]];d[1]=r[g[(t+1)%3]];d.sort(f);var s=d.toString();void 0===e[s]?(e[s]={vert1:d[0],vert2:d[1],face1:q,face2:void 0},p++):e[s].face2=q}d=new Float32Array(6*p);f=0;for(s in e)if(g=e[s],void 0===g.face2||
.9999>k[g.face1].normal.dot(k[g.face2].normal))p=n[g.vert1],d[f++]=p.x,d[f++]=p.y,d[f++]=p.z,p=n[g.vert2],d[f++]=p.x,d[f++]=p.y,d[f++]=p.z;h.addAttribute("position",new THREE.BufferAttribute(d,3));THREE.Line.call(this,h,new THREE.LineBasicMaterial({color:c}),THREE.LinePieces);this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1};THREE.EdgesHelper.prototype=Object.create(THREE.Line.prototype);
THREE.FaceNormalsHelper=function(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16776960;d=void 0!==d?d:1;b=new THREE.Geometry;c=0;for(var e=this.object.geometry.faces.length;c<e;c++)b.vertices.push(new THREE.Vector3,new THREE.Vector3);THREE.Line.call(this,b,new THREE.LineBasicMaterial({color:a,linewidth:d}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype);
THREE.FaceNormalsHelper.prototype.update=function(){var a=this.geometry.vertices,b=this.object,c=b.geometry.vertices,d=b.geometry.faces,e=b.matrixWorld;b.updateMatrixWorld(!0);this.normalMatrix.getNormalMatrix(e);for(var f=b=0,g=d.length;b<g;b++,f+=2){var h=d[b];a[f].copy(c[h.a]).add(c[h.b]).add(c[h.c]).divideScalar(3).applyMatrix4(e);a[f+1].copy(h.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(a[f])}this.geometry.verticesNeedUpdate=!0;return this};
THREE.GridHelper=function(a,b){var c=new THREE.Geometry,d=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924);this.color2=new THREE.Color(8947848);for(var e=-a;e<=a;e+=b){c.vertices.push(new THREE.Vector3(-a,0,e),new THREE.Vector3(a,0,e),new THREE.Vector3(e,0,-a),new THREE.Vector3(e,0,a));var f=0===e?this.color1:this.color2;c.colors.push(f,f,f,f)}THREE.Line.call(this,c,d,THREE.LinePieces)};THREE.GridHelper.prototype=Object.create(THREE.Line.prototype);
THREE.GridHelper.prototype.setColors=function(a,b){this.color1.set(a);this.color2.set(b);this.geometry.colorsNeedUpdate=!0};
THREE.HemisphereLightHelper=function(a,b,c,d){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.colors=[new THREE.Color,new THREE.Color];a=new THREE.SphereGeometry(b,4,2);a.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(b=0;8>b;b++)a.faces[b].color=this.colors[4>b?0:1];b=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(a,b);this.add(this.lightSphere);
this.update()};THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};
THREE.HemisphereLightHelper.prototype.update=function(){var a=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=!0}}();
THREE.PointLightHelper=function(a,b){this.light=a;this.light.updateMatrixWorld();var c=new THREE.SphereGeometry(b,4,2),d=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,c,d);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};
THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};
THREE.SkeletonHelper=function(a){this.bones=this.getBoneList(a);for(var b=new THREE.Geometry,c=0;c<this.bones.length;c++)this.bones[c].parent instanceof THREE.Bone&&(b.vertices.push(new THREE.Vector3),b.vertices.push(new THREE.Vector3),b.colors.push(new THREE.Color(0,0,1)),b.colors.push(new THREE.Color(0,1,0)));c=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});THREE.Line.call(this,b,c,THREE.LinePieces);this.root=a;this.matrix=a.matrixWorld;
this.matrixAutoUpdate=!1;this.update()};THREE.SkeletonHelper.prototype=Object.create(THREE.Line.prototype);THREE.SkeletonHelper.prototype.getBoneList=function(a){var b=[];a instanceof THREE.Bone&&b.push(a);for(var c=0;c<a.children.length;c++)b.push.apply(b,this.getBoneList(a.children[c]));return b};
THREE.SkeletonHelper.prototype.update=function(){for(var a=this.geometry,b=(new THREE.Matrix4).getInverse(this.root.matrixWorld),c=new THREE.Matrix4,d=0,e=0;e<this.bones.length;e++){var f=this.bones[e];f.parent instanceof THREE.Bone&&(c.multiplyMatrices(b,f.matrixWorld),a.vertices[d].setFromMatrixPosition(c),c.multiplyMatrices(b,f.parent.matrixWorld),a.vertices[d+1].setFromMatrixPosition(c),d+=2)}a.verticesNeedUpdate=!0;a.computeBoundingSphere()};
THREE.SpotLightHelper=function(a){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;a=new THREE.CylinderGeometry(0,1,1,8,1,!0);a.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0));a.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var b=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(a,b);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);
THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};THREE.SpotLightHelper.prototype.update=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){var c=this.light.distance?this.light.distance:1E4,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c);a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(b.sub(a));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();
THREE.VertexNormalsHelper=function(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;b=void 0!==c?c:16711680;d=void 0!==d?d:1;c=new THREE.Geometry;a=a.geometry.faces;for(var e=0,f=a.length;e<f;e++)for(var g=0,h=a[e].vertexNormals.length;g<h;g++)c.vertices.push(new THREE.Vector3,new THREE.Vector3);THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:b,linewidth:d}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype);
THREE.VertexNormalsHelper.prototype.update=function(a){var b=new THREE.Vector3;return function(a){a=["a","b","c","d"];this.object.updateMatrixWorld(!0);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var d=this.geometry.vertices,e=this.object.geometry.vertices,f=this.object.geometry.faces,g=this.object.matrixWorld,h=0,k=0,n=f.length;k<n;k++)for(var p=f[k],q=0,m=p.vertexNormals.length;q<m;q++){var r=p.vertexNormals[q];d[h].copy(e[p[a[q]]]).applyMatrix4(g);b.copy(r).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);
b.add(d[h]);h+=1;d[h].copy(b);h+=1}this.geometry.verticesNeedUpdate=!0;return this}}();
THREE.VertexTangentsHelper=function(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;b=void 0!==c?c:255;d=void 0!==d?d:1;c=new THREE.Geometry;a=a.geometry.faces;for(var e=0,f=a.length;e<f;e++)for(var g=0,h=a[e].vertexTangents.length;g<h;g++)c.vertices.push(new THREE.Vector3),c.vertices.push(new THREE.Vector3);THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:b,linewidth:d}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.update()};THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype);
THREE.VertexTangentsHelper.prototype.update=function(a){var b=new THREE.Vector3;return function(a){a=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var d=this.geometry.vertices,e=this.object.geometry.vertices,f=this.object.geometry.faces,g=this.object.matrixWorld,h=0,k=0,n=f.length;k<n;k++)for(var p=f[k],q=0,m=p.vertexTangents.length;q<m;q++){var r=p.vertexTangents[q];d[h].copy(e[p[a[q]]]).applyMatrix4(g);b.copy(r).transformDirection(g).multiplyScalar(this.size);b.add(d[h]);h+=1;d[h].copy(b);
h+=1}this.geometry.verticesNeedUpdate=!0;return this}}();
THREE.WireframeHelper=function(a,b){var c=void 0!==b?b:16777215,d=[0,0],e={},f=function(a,b){return a-b},g=["a","b","c"],h=new THREE.BufferGeometry;if(a.geometry instanceof THREE.Geometry){for(var k=a.geometry.vertices,n=a.geometry.faces,p=0,q=new Uint32Array(6*n.length),m=0,r=n.length;m<r;m++)for(var t=n[m],s=0;3>s;s++){d[0]=t[g[s]];d[1]=t[g[(s+1)%3]];d.sort(f);var u=d.toString();void 0===e[u]&&(q[2*p]=d[0],q[2*p+1]=d[1],e[u]=!0,p++)}d=new Float32Array(6*p);m=0;for(r=p;m<r;m++)for(s=0;2>s;s++)p=
k[q[2*m+s]],g=6*m+3*s,d[g+0]=p.x,d[g+1]=p.y,d[g+2]=p.z;h.addAttribute("position",new THREE.BufferAttribute(d,3))}else if(a.geometry instanceof THREE.BufferGeometry){if(void 0!==a.geometry.attributes.index){k=a.geometry.attributes.position.array;r=a.geometry.attributes.index.array;n=a.geometry.drawcalls;p=0;0===n.length&&(n=[{count:r.length,index:0,start:0}]);for(var q=new Uint32Array(2*r.length),t=0,v=n.length;t<v;++t)for(var s=n[t].start,u=n[t].count,g=n[t].index,m=s,y=s+u;m<y;m+=3)for(s=0;3>s;s++)d[0]=
g+r[m+s],d[1]=g+r[m+(s+1)%3],d.sort(f),u=d.toString(),void 0===e[u]&&(q[2*p]=d[0],q[2*p+1]=d[1],e[u]=!0,p++);d=new Float32Array(6*p);m=0;for(r=p;m<r;m++)for(s=0;2>s;s++)g=6*m+3*s,p=3*q[2*m+s],d[g+0]=k[p],d[g+1]=k[p+1],d[g+2]=k[p+2]}else for(k=a.geometry.attributes.position.array,p=k.length/3,q=p/3,d=new Float32Array(6*p),m=0,r=q;m<r;m++)for(s=0;3>s;s++)g=18*m+6*s,q=9*m+3*s,d[g+0]=k[q],d[g+1]=k[q+1],d[g+2]=k[q+2],p=9*m+(s+1)%3*3,d[g+3]=k[p],d[g+4]=k[p+1],d[g+5]=k[p+2];h.addAttribute("position",new THREE.BufferAttribute(d,
3))}THREE.Line.call(this,h,new THREE.LineBasicMaterial({color:c}),THREE.LinePieces);this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1};THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype);THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(a){}};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);
THREE.MorphBlendMesh=function(a,b){THREE.Mesh.call(this,a,b);this.animationsMap={};this.animationsList=[];var c=this.geometry.morphTargets.length;this.createAnimation("__default",0,c-1,c/1);this.setAnimationWeight("__default",1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);
THREE.MorphBlendMesh.prototype.createAnimation=function(a,b,c,d){b={startFrame:b,endFrame:c,length:c-b+1,fps:d,duration:(c-b)/d,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=b;this.animationsList.push(b)};
THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(a){for(var b=/([a-z]+)_?(\d+)/,c,d={},e=this.geometry,f=0,g=e.morphTargets.length;f<g;f++){var h=e.morphTargets[f].name.match(b);if(h&&1<h.length){var k=h[1];d[k]||(d[k]={start:Infinity,end:-Infinity});h=d[k];f<h.start&&(h.start=f);f>h.end&&(h.end=f);c||(c=k)}}for(k in d)h=d[k],this.createAnimation(k,h.start,h.end,a);this.firstAnimation=c};
THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){if(a=this.animationsMap[a])a.direction=1,a.directionBackwards=!1};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){if(a=this.animationsMap[a])a.direction=-1,a.directionBackwards=!0};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];c&&(c.fps=b,c.duration=(c.end-c.start)/c.fps)};
THREE.MorphBlendMesh.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];c&&(c.duration=b,c.fps=(c.end-c.start)/c.duration)};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];c&&(c.weight=b)};THREE.MorphBlendMesh.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];c&&(c.time=b)};THREE.MorphBlendMesh.prototype.getAnimationTime=function(a){var b=0;if(a=this.animationsMap[a])b=a.time;return b};
THREE.MorphBlendMesh.prototype.getAnimationDuration=function(a){var b=-1;if(a=this.animationsMap[a])b=a.duration;return b};THREE.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):console.warn("animation["+a+"] undefined")};THREE.MorphBlendMesh.prototype.stopAnimation=function(a){if(a=this.animationsMap[a])a.active=!1};
THREE.MorphBlendMesh.prototype.update=function(a){for(var b=0,c=this.animationsList.length;b<c;b++){var d=this.animationsList[b];if(d.active){var e=d.duration/d.length;d.time+=d.direction*a;if(d.mirroredLoop){if(d.time>d.duration||0>d.time)d.direction*=-1,d.time>d.duration&&(d.time=d.duration,d.directionBackwards=!0),0>d.time&&(d.time=0,d.directionBackwards=!1)}else d.time%=d.duration,0>d.time&&(d.time+=d.duration);var f=d.startFrame+THREE.Math.clamp(Math.floor(d.time/e),0,d.length-1),g=d.weight;
f!==d.currentFrame&&(this.morphTargetInfluences[d.lastFrame]=0,this.morphTargetInfluences[d.currentFrame]=1*g,this.morphTargetInfluences[f]=0,d.lastFrame=d.currentFrame,d.currentFrame=f);e=d.time%e/e;d.directionBackwards&&(e=1-e);this.morphTargetInfluences[d.currentFrame]=e*g;this.morphTargetInfluences[d.lastFrame]=(1-e)*g}}};

/* JSModeler 0.32.183 - http://www.github.com/kovacsv/JSModeler */ 'use strict';var JSM={mainVersion:0,subVersion:32,Eps:1E-8,Inf:9999999999,RadDeg:57.29577951308232,DegRad:0.017453292519943,IsZero:function(a){return Math.abs(a)<JSM.Eps},IsPositive:function(a){return a>JSM.Eps},IsNegative:function(a){return a<-JSM.Eps},IsLower:function(a,b){return b-a>JSM.Eps},IsGreater:function(a,b){return a-b>JSM.Eps},IsEqual:function(a,b){return Math.abs(b-a)<JSM.Eps},IsEqualWithEps:function(a,b,c){return Math.abs(b-a)<c},IsLowerOrEqual:function(a,b){return JSM.IsLower(a,b)||
JSM.IsEqual(a,b)},IsGreaterOrEqual:function(a,b){return JSM.IsGreater(a,b)||JSM.IsEqual(a,b)},Minimum:function(a,b){return JSM.IsLower(a,b)?a:b},Maximum:function(a,b){return JSM.IsGreater(a,b)?a:b},ArcSin:function(a){return JSM.IsGreaterOrEqual(a,1)?Math.PI/2:JSM.IsLowerOrEqual(a,-1)?-Math.PI/2:Math.asin(a)},ArcCos:function(a){return JSM.IsGreaterOrEqual(a,1)?0:JSM.IsLowerOrEqual(a,-1)?Math.PI:Math.acos(a)},RandomNumber:function(a,b){return Math.random()*(b-a)+a},RandomInt:function(a,b){return Math.floor(Math.random()*
(b-a+1)+a)},SeededRandomInt:function(a,b,c){return Math.floor((9301*c+49297)%233280/233280*(b-a+1)+a)},ValueOrDefault:function(a,b){return void 0===a||null===a?b:a},Assert:function(a,b){if(!a){var c="Assertion failed.";void 0!==b&&null!==b&&(c+=" "+b);alert(c)}},Timer:function(){this.stop=this.start=0}};JSM.Timer.prototype.Start=function(){this.start=(new Date).getTime()};JSM.Timer.prototype.Stop=function(){this.end=(new Date).getTime()};JSM.Timer.prototype.Result=function(){return this.end-this.start};
JSM.FPSCounter=function(){this.current=this.frames=this.start=null};JSM.FPSCounter.prototype.Get=function(a){var b=(new Date).getTime();null===this.start&&(this.start=b,this.current=this.frames=0);if(null===a||void 0===a)a=1E3;this.frames+=1;var c=b-this.start;c>=a&&(this.current=1E3*(this.frames/c),this.start=b,this.frames=0);return parseInt(this.current,10)};
JSM.BubbleSort=function(a,b){if(!(2>a.length||void 0===b||null===b)){var c,d;for(c=0;c<a.length-1;c++)for(d=0;d<a.length-c-1;d++)if(!b(a[d],a[d+1])){var e=a,f=d+1,g=e[d];e[d]=e[f];e[f]=g}}};JSM.AsyncEnvironment=function(a){this.parameters=a};JSM.AsyncEnvironment.prototype.OnStart=function(a,b){if(void 0!==this.parameters&&void 0!==this.parameters.onStart)this.parameters.onStart(a,b)};
JSM.AsyncEnvironment.prototype.OnProcess=function(a,b){if(void 0!==this.parameters&&void 0!==this.parameters.onProcess)this.parameters.onProcess(a,b)};JSM.AsyncEnvironment.prototype.OnFinish=function(a){if(void 0!==this.parameters&&void 0!==this.parameters.onFinish)this.parameters.onFinish(a)};
JSM.AsyncRunTask=function(a,b,c,d,e){function f(g){var h=a();b.OnProcess(g,e);h&&g<c-1?setTimeout(function(){f(g+1)},d):setTimeout(function(){b.OnFinish(e)},d)}if(void 0===b||null===b){var g,h;for(g=0;g<c&&!(h=a(),!h);g++);}else b.OnStart(c,e),f(0)};JSM.Coord2D=function(a,b){this.x=a;this.y=b};JSM.Coord2D.prototype.Set=function(a,b){this.x=a;this.y=b};JSM.Coord2D.prototype.ToString=function(){return"("+this.x+", "+this.y+")"};JSM.Coord2D.prototype.Clone=function(){return new JSM.Coord2D(this.x,this.y)};
JSM.PolarCoord=function(a,b){this.radius=a;this.angle=b};JSM.PolarCoord.prototype.Set=function(a,b){this.radius=a;this.angle=b};JSM.PolarCoord.prototype.ToString=function(){return"("+this.radius+", "+this.angle+")"};JSM.PolarCoord.prototype.Clone=function(){return new JSM.PolarCoord(this.radius,this.angle)};JSM.Coord=function(a,b,c){this.x=a;this.y=b;this.z=c};JSM.Coord.prototype.Set=function(a,b,c){this.x=a;this.y=b;this.z=c};
JSM.Coord.prototype.ToString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};JSM.Coord.prototype.Clone=function(){return new JSM.Coord(this.x,this.y,this.z)};JSM.SphericalCoord=function(a,b,c){this.radius=a;this.theta=b;this.phi=c};JSM.SphericalCoord.prototype.Set=function(a,b,c){this.radius=a;this.theta=b;this.phi=c};JSM.SphericalCoord.prototype.ToString=function(){return"("+this.radius+", "+this.theta+", "+this.phi+")"};
JSM.SphericalCoord.prototype.Clone=function(){return new JSM.SphericalCoord(this.radius,this.theta,this.phi)};JSM.Vector2D=JSM.Coord2D;JSM.Vector=JSM.Coord;JSM.MatrixDeterminant2x2=function(a,b,c,d){return a*d-b*c};JSM.MatrixDeterminant3x3=function(a,b,c,d,e,f,g,h,l){var k=JSM.MatrixDeterminant2x2(e,f,h,l);f=JSM.MatrixDeterminant2x2(d,f,g,l);d=JSM.MatrixDeterminant2x2(d,e,g,h);return a*k-b*f+c*d};
JSM.MatrixDeterminant4x4=function(a,b,c,d,e,f,g,h,l,k,m,n,p,q,r,s){var x=JSM.MatrixDeterminant3x3(f,g,h,k,m,n,q,r,s),v=JSM.MatrixDeterminant3x3(e,g,h,l,m,n,p,r,s);h=JSM.MatrixDeterminant3x3(e,f,h,l,k,n,p,q,s);e=JSM.MatrixDeterminant3x3(e,f,g,l,k,m,p,q,r);return x*a-v*b+h*c-e*d};JSM.CoordFromArray2D=function(a){return new JSM.Coord2D(a[0],a[1])};JSM.CoordFromArray=function(a){return new JSM.Coord(a[0],a[1],a[2])};JSM.CoordIsEqual2D=function(a,b){return JSM.IsEqual(a.x,b.x)&&JSM.IsEqual(a.y,b.y)};
JSM.CoordIsEqual2DWithEps=function(a,b,c){return JSM.IsEqualWithEps(a.x,b.x,c)&&JSM.IsEqualWithEps(a.y,b.y,c)};JSM.CoordDistance2D=function(a,b){var c=a.x,d=a.y,e=b.x,f=b.y;return Math.sqrt((e-c)*(e-c)+(f-d)*(f-d))};JSM.MidCoord2D=function(a,b){return new JSM.Coord2D((a.x+b.x)/2,(a.y+b.y)/2)};JSM.PolarToCartesian=function(a,b){var c=new JSM.Coord2D(0,0);c.x=a*Math.cos(b);c.y=a*Math.sin(b);return c};JSM.GetArcLengthFromAngle=function(a,b){return b*a};
JSM.GetAngleFromArcLength=function(a,b){return JSM.IsEqual(a,0)?0:b/a};JSM.CoordTurnType2D=function(a,b,c){a=JSM.MatrixDeterminant3x3(a.x,a.y,1,b.x,b.y,1,c.x,c.y,1);return JSM.IsPositive(a)?"CounterClockwise":JSM.IsNegative(a)?"Clockwise":"Collinear"};JSM.CoordIsEqual=function(a,b){return JSM.IsEqual(a.x,b.x)&&JSM.IsEqual(a.y,b.y)&&JSM.IsEqual(a.z,b.z)};JSM.CoordIsEqualWithEps=function(a,b,c){return JSM.IsEqualWithEps(a.x,b.x,c)&&JSM.IsEqualWithEps(a.y,b.y,c)&&JSM.IsEqualWithEps(a.z,b.z,c)};
JSM.SphericalCoordIsEqual=function(a,b){return JSM.IsEqual(a.radius,b.radius)&&JSM.IsEqual(a.phi,b.phi)&&JSM.IsEqual(a.theta,b.theta)};JSM.CoordDistance=function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;return Math.sqrt((f-c)*(f-c)+(g-d)*(g-d)+(h-e)*(h-e))};JSM.CoordSignedDistance=function(a,b,c){var d=JSM.CoordSub(b,a);a=JSM.CoordDistance(a,b);c=JSM.GetVectorsAngle(d,c);JSM.IsPositive(c)&&(a=-a);return a};JSM.MidCoord=function(a,b){return new JSM.Coord((a.x+b.x)/2,(a.y+b.y)/2,(a.z+b.z)/2)};
JSM.VectorMultiply=function(a,b){var c=new JSM.Vector(0,0,0);c.x=a.x*b;c.y=a.y*b;c.z=a.z*b;return c};JSM.VectorDot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};JSM.VectorCross=function(a,b){var c=new JSM.Vector(0,0,0);c.x=a.y*b.z-a.z*b.y;c.y=a.z*b.x-a.x*b.z;c.z=a.x*b.y-a.y*b.x;return c};JSM.VectorLength=function(a){var b=a.x,c=a.y;a=a.z;return Math.sqrt(b*b+c*c+a*a)};
JSM.VectorNormalize=function(a){var b=JSM.VectorLength(a),c=new JSM.Vector(0,0,0);JSM.IsGreater(b,0)&&(c=JSM.VectorMultiply(a,1/b));return c};JSM.VectorSetLength=function(a,b){var c=b/JSM.VectorLength(a);return JSM.VectorMultiply(a,c)};JSM.GetVectorsAngle=function(a,b){var c=JSM.VectorNormalize(a),d=JSM.VectorNormalize(b);if(JSM.CoordIsEqual(c,d))return 0;c=JSM.VectorDot(c,d);return JSM.ArcCos(c)};
JSM.GetVectorsFullAngle=function(a,b,c){var d=JSM.GetVectorsAngle(a,b),e=new JSM.Coord(0,0,0);"Clockwise"==JSM.CoordTurnType(a,e,b,c)&&(d=2*Math.PI-d);return d};JSM.VectorsAreCollinear=function(a,b){var c=JSM.GetVectorsAngle(a,b);return JSM.IsEqual(c,0)||JSM.IsEqual(c,Math.PI)};JSM.CoordAdd=function(a,b){return new JSM.Vector(a.x+b.x,a.y+b.y,a.z+b.z)};JSM.CoordSub=function(a,b){return new JSM.Vector(a.x-b.x,a.y-b.y,a.z-b.z)};
JSM.CoordOffset=function(a,b,c){b=JSM.VectorNormalize(b);var d=new JSM.Coord(0,0,0);d.x=a.x+b.x*c;d.y=a.y+b.y*c;d.z=a.z+b.z*c;return d};
JSM.CoordRotate=function(a,b,c,d){var e=JSM.CoordSub(a,d),f=JSM.VectorNormalize(b);b=f.x;a=f.y;var f=f.z,g=e.x,h=e.y,e=e.z,l=new JSM.Coord(0,0,0);l.x=-b*(-b*g-a*h-f*e)*(1-Math.cos(c))+g*Math.cos(c)+(-f*h+a*e)*Math.sin(c);l.y=-a*(-b*g-a*h-f*e)*(1-Math.cos(c))+h*Math.cos(c)+(f*g-b*e)*Math.sin(c);l.z=-f*(-b*g-a*h-f*e)*(1-Math.cos(c))+e*Math.cos(c)+(-a*g+b*h)*Math.sin(c);return l=JSM.CoordAdd(l,d)};
JSM.GetCoord2DFromCoord=function(a,b,c){var d=new JSM.Vector(0,0,1),e=JSM.VectorCross(c,d);c=JSM.GetVectorsAngle(c,d);a=JSM.CoordRotate(a,e,c,b);return new JSM.Coord2D(a.x,a.y)};
JSM.CoordTurnType=function(a,b,c,d){var e=new JSM.Coord(0,0,0);a=JSM.GetCoord2DFromCoord(a,e,d);b=JSM.GetCoord2DFromCoord(b,e,d);c=JSM.GetCoord2DFromCoord(c,e,d);c=JSM.CoordTurnType2D(a,b,c);e=new JSM.Vector(0,0,1);d=JSM.GetVectorsAngle(d,e);JSM.IsEqual(d,Math.PI)&&("CounterClockwise"===c?c="Clockwise":"Clockwise"===c&&(c="CounterClockwise"));return c};
JSM.CalculateCentroid=function(a){var b=a.length,c=new JSM.Coord(0,0,0);if(1<=b){var d;for(d=0;d<b;d++)c=JSM.CoordAdd(c,a[d]);c=JSM.VectorMultiply(c,1/b)}return c};JSM.CalculateTriangleNormal=function(a,b,c){b=JSM.CoordSub(b,a);a=JSM.CoordSub(c,a);c=new JSM.Vector(0,0,0);c.x=b.y*a.z-b.z*a.y;c.y=b.z*a.x-b.x*a.z;c.z=b.x*a.y-b.y*a.x;return JSM.VectorNormalize(c)};
JSM.CalculateNormal=function(a){var b=a.length,c=new JSM.Vector(0,0,0);if(3<=b){var d,e,f;for(d=0;d<b;d++)e=d%b,f=(d+1)%b,e=a[e],f=a[f],c.x+=(e.y-f.y)*(e.z+f.z),c.y+=(e.z-f.z)*(e.x+f.x),c.z+=(e.x-f.x)*(e.y+f.y)}return JSM.VectorNormalize(c)};JSM.SphericalToCartesian=function(a,b,c){var d=new JSM.Coord(0,0,0);d.x=a*Math.sin(b)*Math.cos(c);d.y=a*Math.sin(b)*Math.sin(c);d.z=a*Math.cos(b);return d};
JSM.CartesianToSpherical=function(a,b,c){var d=new JSM.SphericalCoord(0,0,0);d.radius=Math.sqrt(a*a+b*b+c*c);if(JSM.IsZero(d.radius))return d;d.theta=Math.acos(c/d.radius);d.phi=Math.atan2(b,a);return d};JSM.SphericalToCartesianWithOrigo=function(a,b){var c=JSM.SphericalToCartesian(a.radius,a.theta,a.phi);return JSM.CoordAdd(c,b)};JSM.CartesianToSphericalWithOrigo=function(a,b){var c=JSM.CoordSub(a,b);return JSM.CartesianToSpherical(c.x,c.y,c.z)};
JSM.MoveCoordOnSphere=function(a,b,c,d){a=JSM.CartesianToSphericalWithOrigo(a,b);a.theta+=c;a.phi+=d;return JSM.SphericalToCartesianWithOrigo(a,b)};JSM.CylindricalToCartesian=function(a,b,c){var d=new JSM.Coord(0,0,0);d.x=a*Math.cos(c);d.y=a*Math.sin(c);d.z=b;return d};JSM.GetArcLength=function(a,b,c){return JSM.GetVectorsAngle(a,b)*c};JSM.GetFullArcLength=function(a,b,c,d){return JSM.GetVectorsFullAngle(a,b,d)*c};JSM.MatrixIdentity=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};
JSM.MatrixClone=function(a){var b=[];b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};JSM.MatrixTranspose=function(a){var b=[];b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b};
JSM.MatrixVectorMultiply=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=a[1],h=a[2],l=a[3],k=a[5],m=a[6],n=a[7],p=a[9],q=a[10],r=a[11],s=a[13],x=a[14],v=a[15],t=[];t[0]=c*a[0]+d*a[4]+e*a[8]+f*a[12];t[1]=c*g+d*k+e*p+f*s;t[2]=c*h+d*m+e*q+f*x;t[3]=c*l+d*n+e*r+f*v;return t};
JSM.MatrixMultiply=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],l=a[6],k=a[7],m=a[8],n=a[9],p=a[10],q=a[11],r=a[12],s=a[13],x=a[14],v=a[15],t=b[0],y=b[1],F=b[2],C=b[3],u=b[4],H=b[5],z=b[6],I=b[7],J=b[8],D=b[9],A=b[10],B=b[11],K=b[12],L=b[13],M=b[14],w=b[15],G=[];G[0]=c*t+d*u+e*J+f*K;G[1]=c*y+d*H+e*D+f*L;G[2]=c*F+d*z+e*A+f*M;G[3]=c*C+d*I+e*B+f*w;G[4]=g*t+h*u+l*J+k*K;G[5]=g*y+h*H+l*D+k*L;G[6]=g*F+h*z+l*A+k*M;G[7]=g*C+h*I+l*B+k*w;G[8]=m*t+n*u+p*J+q*K;G[9]=m*y+n*H+p*D+q*L;G[10]=m*F+n*z+
p*A+q*M;G[11]=m*C+n*I+p*B+q*w;G[12]=r*t+s*u+x*J+v*K;G[13]=r*y+s*H+x*D+v*L;G[14]=r*F+s*z+x*A+v*M;G[15]=r*C+s*I+x*B+v*w;return G};JSM.MatrixDeterminant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],l=a[7],k=a[8],m=a[9],n=a[10],p=a[11],q=a[12],r=a[13],s=a[14];a=a[15];return(b*g-c*f)*(n*a-p*s)-(b*h-d*f)*(m*a-p*r)+(b*l-e*f)*(m*s-n*r)+(c*h-d*g)*(k*a-p*q)-(c*l-e*g)*(k*s-n*q)+(d*l-e*h)*(k*r-m*q)};
JSM.MatrixInvert=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],l=a[7],k=a[8],m=a[9],n=a[10],p=a[11],q=a[12],r=a[13],s=a[14];a=a[15];var x=b*g-c*f,v=b*h-d*f,t=b*l-e*f,y=c*h-d*g,F=c*l-e*g,C=d*l-e*h,u=k*r-m*q,H=k*s-n*q,z=k*a-p*q,I=m*s-n*r,J=m*a-p*r,D=n*a-p*s,A=x*D-v*J+t*I+y*z-F*H+C*u;if(JSM.IsZero(A))return null;var B=[];B[0]=(g*D-h*J+l*I)/A;B[1]=(d*J-c*D-e*I)/A;B[2]=(r*C-s*F+a*y)/A;B[3]=(n*F-m*C-p*y)/A;B[4]=(h*z-f*D-l*H)/A;B[5]=(b*D-d*z+e*H)/A;B[6]=(s*t-q*C-a*v)/A;B[7]=(k*C-n*t+p*
v)/A;B[8]=(f*J-g*z+l*u)/A;B[9]=(c*z-b*J-e*u)/A;B[10]=(q*F-r*t+a*x)/A;B[11]=(m*t-k*F-p*x)/A;B[12]=(g*H-f*I-h*u)/A;B[13]=(b*I-c*H+d*u)/A;B[14]=(r*v-q*y-s*x)/A;B[15]=(k*y-m*v+n*x)/A;return B};JSM.MatrixTranslation=function(a,b,c){var d=[1,0,0,0,0,1,0,0,0,0,1,0];d[12]=a;d[13]=b;d[14]=c;d[15]=1;return d};
JSM.MatrixRotation=function(a,b,c){var d=JSM.VectorNormalize(a);a=d.x;var e=d.y,d=d.z,f=a*a,g=e*e,h=d*d,l=Math.sin(b);b=Math.cos(b);var k=[];if(void 0===c||null===c)k[0]=f+(g+h)*b,k[1]=a*e*(1-b)+d*l,k[2]=a*d*(1-b)-e*l,k[3]=0,k[4]=a*e*(1-b)-d*l,k[5]=g+(f+h)*b,k[6]=e*d*(1-b)+a*l,k[7]=0,k[8]=a*d*(1-b)+e*l,k[9]=e*d*(1-b)-a*l,k[10]=h+(f+g)*b,k[11]=0,k[12]=0,k[13]=0,k[14]=0;else{var m=c.x,n=c.y;c=c.z;k[0]=f+(g+h)*b;k[1]=a*e*(1-b)+d*l;k[2]=a*d*(1-b)-e*l;k[3]=0;k[4]=a*e*(1-b)-d*l;k[5]=g+(f+h)*b;k[6]=e*d*
(1-b)+a*l;k[7]=0;k[8]=a*d*(1-b)+e*l;k[9]=e*d*(1-b)-a*l;k[10]=h+(f+g)*b;k[11]=0;k[12]=(m*(g+h)-a*(n*e+c*d))*(1-b)+(n*d-c*e)*l;k[13]=(n*(f+h)-e*(m*a+c*d))*(1-b)+(c*a-m*d)*l;k[14]=(c*(f+g)-d*(m*a+n*e))*(1-b)+(m*e-n*a)*l}k[15]=1;return k};
JSM.MatrixRotationQuaternion=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=b+b,g=c+c,h=d+d;a=b*f;var l=b*g,b=b*h,k=c*g,c=c*h,d=d*h,f=e*f,g=e*g,e=e*h,h=[];h[0]=1-(k+d);h[1]=l+e;h[2]=b-g;h[3]=0;h[4]=l-e;h[5]=1-(a+d);h[6]=c+f;h[7]=0;h[8]=b+g;h[9]=c-f;h[10]=1-(a+k);h[11]=0;h[12]=0;h[13]=0;h[14]=0;h[15]=1;return h};JSM.MatrixRotationX=function(a){var b=Math.sin(a);a=Math.cos(a);var c=[1,0,0,0,0];c[5]=a;c[6]=b;c[7]=0;c[8]=0;c[9]=-b;c[10]=a;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};
JSM.MatrixRotationY=function(a){var b=Math.sin(a);a=Math.cos(a);var c=[];c[0]=a;c[1]=0;c[2]=-b;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=b;c[9]=0;c[10]=a;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};JSM.MatrixRotationZ=function(a){var b=Math.sin(a);a=Math.cos(a);var c=[];c[0]=a;c[1]=b;c[2]=0;c[3]=0;c[4]=-b;c[5]=a;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};
JSM.MatrixView=function(a,b,c){if(JSM.CoordIsEqual(a,b))return JSM.MatrixIdentity();var d=[];b=JSM.VectorNormalize(JSM.CoordSub(a,b));c=JSM.VectorNormalize(JSM.VectorCross(c,b));var e=JSM.VectorNormalize(JSM.VectorCross(b,c));d[0]=c.x;d[1]=e.x;d[2]=b.x;d[3]=0;d[4]=c.y;d[5]=e.y;d[6]=b.y;d[7]=0;d[8]=c.z;d[9]=e.z;d[10]=b.z;d[11]=0;d[12]=-JSM.VectorDot(c,a);d[13]=-JSM.VectorDot(e,a);d[14]=-JSM.VectorDot(b,a);d[15]=1;return d};
JSM.MatrixPerspective=function(a,b,c,d){var e=[];a=1/Math.tan(a/2);var f=1/(c-d);e[0]=a/b;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=a;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=(d+c)*f;e[11]=-1;e[12]=0;e[13]=0;e[14]=2*d*c*f;e[15]=0;return e};JSM.ApplyTransformation=function(a,b){var c=[];c[0]=b.x;c[1]=b.y;c[2]=b.z;c[3]=1;c=JSM.MatrixVectorMultiply(a,c);return new JSM.Coord(c[0],c[1],c[2])};JSM.CoordSystem=function(a,b,c,d){this.origo=a;this.e1=b;this.e2=c;this.e3=d};
JSM.CoordSystem.prototype.Set=function(a,b,c,d){this.origo=a;this.e1=b;this.e2=c;this.e3=d};JSM.CoordSystem.prototype.Clone=function(){return new JSM.CoordSystem(this.origo.Clone(),this.e1.Clone(),this.e2.Clone(),this.e3.Clone())};JSM.CoordSystemToDirectionVectors=function(a){return new JSM.CoordSystem(a.origo,JSM.CoordSub(a.e1,a.origo),JSM.CoordSub(a.e2,a.origo),JSM.CoordSub(a.e3,a.origo))};
JSM.CoordSystemToAbsoluteCoords=function(a){return new JSM.CoordSystem(a.origo,JSM.CoordAdd(a.e1,a.origo),JSM.CoordAdd(a.e2,a.origo),JSM.CoordAdd(a.e3,a.origo))};
JSM.ChangeCoordSystem=function(a,b,c){var d=JSM.VectorNormalize(b.e1),e=JSM.VectorNormalize(b.e2),f=JSM.VectorNormalize(b.e3),g=JSM.VectorNormalize(c.e1),h=JSM.VectorNormalize(c.e2),l=JSM.VectorNormalize(c.e3);a=JSM.CoordSub(a,b.origo);b=new JSM.Coord(0,0,0);b.x=JSM.VectorDot(g,d)*a.x+JSM.VectorDot(g,e)*a.y+JSM.VectorDot(g,f)*a.z;b.y=JSM.VectorDot(h,d)*a.x+JSM.VectorDot(h,e)*a.y+JSM.VectorDot(h,f)*a.z;b.z=JSM.VectorDot(l,d)*a.x+JSM.VectorDot(l,e)*a.y+JSM.VectorDot(l,f)*a.z;return b=JSM.CoordAdd(b,
c.origo)};JSM.Sector2D=function(a,b){this.beg=a;this.end=b};JSM.Sector2D.prototype.Set=function(a,b){this.beg=a;this.end=b};JSM.Sector2D.prototype.Clone=function(){return new JSM.Sector2D(this.beg.Clone(),this.end.Clone())};JSM.Sector=function(a,b){this.beg=a;this.end=b};JSM.Sector.prototype.Set=function(a,b){this.beg=a;this.end=b};JSM.Sector.prototype.Clone=function(){return new JSM.Sector(this.beg.Clone(),this.end.Clone())};
JSM.CoordSectorPosition2D=function(a,b){var c=a.x,d=a.y,e=b.beg.x,f=b.beg.y,g=b.end.x,h=b.end.y,l=Math.pow(g-e,2)+Math.pow(h-f,2);if(JSM.IsZero(l))return JSM.CoordIsEqual2D(a,b.beg)?"CoordOnSectorEndCoord":"CoordOutsideOfSector";l=((c-e)*(g-e)+(d-f)*(h-f))/l;if(JSM.IsLower(l,0)||JSM.IsGreater(l,1))return"CoordOutsideOfSector";f+=l*(h-f);return!JSM.IsEqual(e+l*(g-e),c)||!JSM.IsEqual(f,d)?"CoordOutsideOfSector":JSM.IsEqual(l,0)||JSM.IsEqual(l,1)?"CoordOnSectorEndCoord":"CoordInsideOfSector"};
JSM.SectorSectorPosition2D=function(a,b,c){var d=a.beg.x,e=a.beg.y,f=a.end.x,g=a.end.y,h=b.beg.x,l=b.beg.y,k=b.end.x,m=b.end.y,n=(k-h)*(e-l)-(m-l)*(d-h),p=(f-d)*(e-l)-(g-e)*(d-h);if(JSM.IsZero(n)&&JSM.IsZero(p))return c=JSM.CoordSectorPosition2D(a.beg,b),d=JSM.CoordSectorPosition2D(a.end,b),e=JSM.CoordSectorPosition2D(b.beg,a),a=JSM.CoordSectorPosition2D(b.end,a),"CoordInsideOfSector"===c||("CoordInsideOfSector"===d||"CoordInsideOfSector"===e||"CoordInsideOfSector"===a)||"CoordOnSectorEndCoord"===
c&&"CoordOnSectorEndCoord"===d&&"CoordOnSectorEndCoord"===e&&"CoordOnSectorEndCoord"===a?"SectorsIntersectsCoincident":"CoordOnSectorEndCoord"===c||"CoordOnSectorEndCoord"===d||"CoordOnSectorEndCoord"===e||"CoordOnSectorEndCoord"===a?"SectorsIntersectsEndPoint":"SectorsDontIntersects";a=(m-l)*(f-d)-(k-h)*(g-e);if(JSM.IsZero(a))return"SectorsDontIntersects";n/=a;p/=a;if(JSM.IsLower(n,0)||JSM.IsGreater(n,1)||JSM.IsLower(p,0)||JSM.IsGreater(p,1))return"SectorsDontIntersects";void 0!==c&&(c.x=d+n*(f-
d),c.y=e+n*(g-e));return JSM.IsEqual(n,0)||JSM.IsEqual(n,1)||JSM.IsEqual(p,0)||JSM.IsEqual(p,1)?"SectorsIntersectsEndPoint":"SectorsIntersectsOnePoint"};JSM.GetSectorSegmentation=function(a,b,c){var d=JSM.CoordSub(a.end,a.beg),e=JSM.CoordDistance(a.beg,a.end)/b,f=0,g;for(g=0;g<=b;g++)c.push(JSM.CoordOffset(a.beg,d,f)),f+=e};JSM.Line2D=function(a,b){this.start=a;this.direction=b};JSM.Line2D.prototype.Set=function(a,b){this.start=a;this.direction=b};
JSM.Line2D.prototype.Clone=function(){return new JSM.Line2D(this.start.Clone(),this.direction.Clone())};JSM.Line=function(a,b){this.start=a;this.direction=b};JSM.Line.prototype.Set=function(a,b){this.start=a;this.direction=b};JSM.Line.prototype.Clone=function(){return new JSM.Line(this.start.Clone(),this.direction.Clone())};
JSM.CoordLinePosition2D=function(a,b){var c=b.start,d=b.direction,c=d.x*(a.y-c.y)-d.y*(a.x-c.x);return JSM.IsPositive(c)?"CoordAtLineLeft":JSM.IsNegative(c)?"CoordAtLineRight":"CoordOnLine"};
JSM.CoordLinePosition=function(a,b,c){var d=a.x,e=a.y,f=a.z,g=b.start;b=b.direction;var h=g.x,l=g.y,k=g.z,m=g.x+b.x,n=g.y+b.y,p=g.z+b.z,q=(m-h)*(m-h)+(n-l)*(n-l)+(p-k)*(p-k);if(JSM.IsZero(q))return void 0!==c&&c.Set(g.x,g.y,g.z),JSM.CoordIsEqual(g,a)?"CoordOnLine":"CoordOutsideOfLine";d=JSM.CoordAdd(g,JSM.VectorMultiply(b,((m-h)*(d-h)+(n-l)*(e-l)+(p-k)*(f-k))/q));void 0!==c&&c.Set(d.x,d.y,d.z);a=JSM.CoordDistance(a,d);return JSM.IsZero(a)?"CoordOnLine":"CoordOutsideOfLine"};
JSM.ProjectCoordToLine=function(a,b){var c=new JSM.Coord(0,0,0),d=a.x,e=a.y,f=a.z,g=b.start,h=b.direction,l=g.x,k=g.y,m=g.z,n=g.x+h.x,p=g.y+h.y,q=g.z+h.z,r=(n-l)*(n-l)+(p-k)*(p-k)+(q-m)*(q-m);if(JSM.IsZero(r))return c.Set(g.x,g.y,g.z),c;d=JSM.CoordAdd(g,JSM.VectorMultiply(h,((n-l)*(d-l)+(p-k)*(e-k)+(q-m)*(f-m))/r));c.Set(d.x,d.y,d.z);return c};
JSM.LineLineClosestPoint=function(a,b,c,d){function e(a,b,c,d,e){return(a[b].x-a[c].x)*(a[d].x-a[e].x)+(a[b].y-a[c].y)*(a[d].y-a[e].y)+(a[b].z-a[c].z)*(a[d].z-a[e].z)}var f=JSM.VectorNormalize(a.direction),g=a.start,f=JSM.CoordAdd(g,f);a=JSM.VectorNormalize(b.direction);b=b.start;var h=JSM.CoordAdd(b,a),l=[g,f,b,h],k=e(l,1,0,1,0),m=e(l,0,2,1,0),h=e(l,0,2,3,2),n=e(l,3,2,1,0),l=e(l,3,2,3,2),k=k*l-n*n;if(JSM.IsEqual(k,0))return!1;m=(h*n-m*l)/k;h=(h+m*n)/l;void 0!==c&&(f=JSM.VectorNormalize(JSM.CoordSub(f,
g)),g=JSM.CoordAdd(g,JSM.VectorMultiply(f,m)),c.Set(g.x,g.y,g.z));void 0!==d&&(c=JSM.CoordAdd(b,JSM.VectorMultiply(a,h)),d.Set(c.x,c.y,c.z));return!0};JSM.LineLinePosition=function(a,b,c){var d=new JSM.Coord(0,0,0),e=new JSM.Coord(0,0,0);return!JSM.LineLineClosestPoint(a,b,d,e)?"LinesIntersectsCoincident":JSM.CoordIsEqual(d,e)?(void 0!==c&&c.Set(d.x,d.y,d.z),"LinesIntersectsOnePoint"):"LinesDontIntersects"};JSM.Transformation=function(){this.matrix=JSM.MatrixIdentity()};
JSM.Transformation.prototype.GetMatrix=function(){return this.matrix};JSM.Transformation.prototype.SetMatrix=function(a){this.matrix=a};JSM.Transformation.prototype.Append=function(a){this.matrix=JSM.MatrixMultiply(this.matrix,a.matrix)};JSM.Transformation.prototype.Apply=function(a){return JSM.ApplyTransformation(this.matrix,a)};JSM.Transformation.prototype.Clone=function(){var a=new JSM.Transformation;a.matrix=JSM.MatrixClone(this.matrix);return a};
JSM.IdentityTransformation=function(){var a=new JSM.Transformation;a.matrix=JSM.MatrixIdentity();return a};JSM.TranslationTransformation=function(a){var b=new JSM.Transformation;b.matrix=JSM.MatrixTranslation(a.x,a.y,a.z);return b};JSM.OffsetTransformation=function(a,b){var c=JSM.VectorNormalize(a),c=JSM.VectorMultiply(c,b);return JSM.TranslationTransformation(c)};JSM.RotationTransformation=function(a,b,c){var d=new JSM.Transformation;d.matrix=JSM.MatrixRotation(a,b,c);return d};
JSM.RotationXTransformation=function(a,b){var c=new JSM.Transformation;void 0===b||null===b?c.matrix=JSM.MatrixRotationX(a):(c.Append(JSM.TranslationTransformation(new JSM.Vector(-b.x,-b.y,-b.z))),c.Append(JSM.RotationXTransformation(a)),c.Append(JSM.TranslationTransformation(new JSM.Vector(b.x,b.y,b.z))));return c};
JSM.RotationYTransformation=function(a,b){var c=new JSM.Transformation;void 0===b||null===b?c.matrix=JSM.MatrixRotationY(a):(c.Append(JSM.TranslationTransformation(new JSM.Vector(-b.x,-b.y,-b.z))),c.Append(JSM.RotationYTransformation(a)),c.Append(JSM.TranslationTransformation(new JSM.Vector(b.x,b.y,b.z))));return c};
JSM.RotationZTransformation=function(a,b){var c=new JSM.Transformation;void 0===b||null===b?c.matrix=JSM.MatrixRotationZ(a):(c.Append(JSM.TranslationTransformation(new JSM.Vector(-b.x,-b.y,-b.z))),c.Append(JSM.RotationZTransformation(a)),c.Append(JSM.TranslationTransformation(new JSM.Vector(b.x,b.y,b.z))));return c};
JSM.RotationXYZTransformation=function(a,b,c,d){var e=new JSM.Transformation;e.Append(JSM.RotationXTransformation(a,d));e.Append(JSM.RotationYTransformation(b,d));e.Append(JSM.RotationZTransformation(c,d));return e};JSM.Plane=function(a,b,c,d){this.a=a;this.b=b;this.c=c;this.d=d};JSM.Plane.prototype.Set=function(a,b,c,d){this.a=a;this.b=b;this.c=c;this.d=d};JSM.Plane.prototype.GetNormal=function(){return new JSM.Vector(this.a,this.b,this.c)};
JSM.Plane.prototype.Clone=function(){return new JSM.Plane(this.a,this.b,this.c,this.d)};JSM.GetPlaneFromCoordAndDirection=function(a,b){var c=new JSM.Plane,d=JSM.VectorNormalize(b),e=d.x,f=d.y,d=d.z;c.Set(e,f,d,-(e*a.x+f*a.y+d*a.z));return c};JSM.GetPlaneFromThreeCoords=function(a,b,c){var d=new JSM.Plane,e=(b.y-a.y)*(c.z-a.z)-(c.y-a.y)*(b.z-a.z),f=(b.z-a.z)*(c.x-a.x)-(c.z-a.z)*(b.x-a.x);b=(b.x-a.x)*(c.y-a.y)-(c.x-a.x)*(b.y-a.y);d.Set(e,f,b,-(e*a.x+f*a.y+b*a.z));return d};
JSM.CoordPlanePosition=function(a,b){var c=b.a*a.x+b.b*a.y+b.c*a.z+b.d;return JSM.IsPositive(c)?"CoordInFrontOfPlane":JSM.IsNegative(c)?"CoordAtBackOfPlane":"CoordOnPlane"};
JSM.LinePlanePosition=function(a,b,c){var d=JSM.VectorNormalize(a.direction),e=a.start.x,f=a.start.y,g=a.start.z,h=b.a,l=b.b,k=b.c;b=b.d;var m=h*(e-(a.start.x+d.x))+l*(f-(a.start.y+d.y))+k*(g-(a.start.z+d.z));if(JSM.IsZero(m))return"LineParallelToPlane";void 0!==c&&(a=JSM.CoordAdd(a.start,JSM.VectorMultiply(d,(h*e+l*f+k*g+b)/m)),c.Set(a.x,a.y,a.z));return"LineIntersectsPlane"};
JSM.LinePlaneIntersection=function(a,b){var c=JSM.VectorNormalize(a.direction),d=a.start.x,e=a.start.y,f=a.start.z,g=a.start.x+c.x,h=a.start.y+c.y,l=a.start.z+c.z,k=b.a,m=b.b,n=b.c,p=b.d,q=new JSM.Coord(0,0,0),g=k*(d-g)+m*(e-h)+n*(f-l);return JSM.IsZero(g)?q:q=JSM.CoordAdd(a.start,JSM.VectorMultiply(c,(k*d+m*e+n*f+p)/g))};JSM.CoordPlaneSignedDistance=function(a,b){var c=b.a,d=b.b,e=b.c;return(c*a.x+d*a.y+e*a.z+b.d)/Math.sqrt(c*c+d*d+e*e)};
JSM.CoordPlaneDistance=function(a,b){return Math.abs(JSM.CoordPlaneSignedDistance(a,b))};JSM.CoordPlaneSignedDirectionalDistance=function(a,b,c){var d=JSM.VectorNormalize(b);b=a.x;var e=a.y,f=a.z,g=c.a,h=c.b,l=c.c;c=c.d;var k=g*(b-(a.x+d.x))+h*(e-(a.y+d.y))+l*(f-(a.z+d.z));if(JSM.IsZero(k))return 0;d=JSM.CoordAdd(a,JSM.VectorMultiply(d,(g*b+h*e+l*f+c)/k));a=JSM.CoordDistance(a,d);JSM.IsNegative(g*b+h*e+l*f+c)&&(a=-a);return a};
JSM.CoordPlaneDirectionalDistance=function(a,b,c){return Math.abs(JSM.CoordPlaneSignedDirectionalDistance(a,b,c))};JSM.ProjectCoordToPlane=function(a,b){var c=a.x,d=a.y,e=a.z,f=b.a,g=b.b,h=b.c,l=b.d,k=JSM.CoordPlaneDistance(a,b);JSM.IsGreater(f*c+g*d+h*e+l,0)&&(k=-k);c=JSM.VectorNormalize(new JSM.Coord(f,g,h));return JSM.CoordOffset(a,c,k)};
JSM.Project=function(a,b,c,d,e,f,g,h,l){b=JSM.MatrixView(b,c,d);g=JSM.MatrixPerspective(e,f,g,h);e=new JSM.Coord(0,0,0);h=[];f=[];h[0]=a.x;h[1]=a.y;h[2]=a.z;h[3]=1;f=JSM.MatrixVectorMultiply(g,JSM.MatrixVectorMultiply(b,h));a=f[3];JSM.IsZero(a)?l=null:(f[0]=0.5*(f[0]/a)+0.5,f[1]=0.5*(f[1]/a)+0.5,f[2]=0.5*(f[2]/a)+0.5,f[0]=f[0]*l[2]+l[0],f[1]=f[1]*l[3]+l[1],e.x=f[0],e.y=f[1],e.z=f[2],l=e);return l};
JSM.ConvexHull2D=function(a){function b(a,b){var c=a.length,d=0,e;for(e=1;e<c;e++)b==d?d=e:"Clockwise"==JSM.CoordTurnType2D(a[b],a[d],a[e])&&(d=e);return d}var c=[];if(3>a.length)return c;var d=function(a){var b=a.length,c=JSM.Inf,d=-1,e,f;for(e=0;e<b;e++)f=a[e].x,JSM.IsLower(f,c)&&(c=f,d=e);return d}(a),e=d,f;do c.push(e),e=f=b(a,e);while(f!=d);return c};
JSM.ConvexHull3D=function(a){function b(){this.position=null}function c(){this.tri2=this.tri1=this.vert2=this.vert1=null}function d(){this.valid=this.edges=this.vertices=null}function e(a,c){var d=new b;d.position=c;a.vertices.push(d);return a.vertices.length-1}function f(a,b,d,e){var f=-1,g,h;for(g=0;g<a.edges.length;g++)if(h=a.edges[g],h.vert1==d&&h.vert2==e||h.vert1==e&&h.vert2==d){f=g;break}-1==f&&(f=new c,f.vert1=d,f.vert2=e,f.tri1=-1,f.tri2=-1,a.edges.push(f),f=a.edges.length-1);a=a.edges[f];
a.tri1!=b&&a.tri2!=b&&(-1==a.tri1?a.tri1=b:-1==a.tri2&&(a.tri2=b));return f}function g(a,b,c,e){var g=a.triangles.length,h=f(a,g,b,c),k=f(a,g,c,e),g=f(a,g,e,b),l=new d;l.vertices=[b,c,e];l.edges=[h,k,g];l.valid=!0;a.triangles.push(l);return a.triangles.length-1}function h(a,b,c){a=a.edges[c];a.tri1==b?a.tri1=-1:a.tri2==b&&(a.tri2=-1)}function l(a,b,c,d,e){c=a.vertices[c].position;d=a.vertices[d].position;e=a.vertices[e].position;a=JSM.CoordSub(a.vertices[b].position,e);b=JSM.CoordSub(c,e);c=JSM.CoordSub(d,
e);return JSM.VectorDot(a,JSM.VectorCross(b,c))/6}function k(a,b){var c=[],d,e;for(d=0;d<a.triangles.length;d++)e=a.triangles[d],e.valid?!JSM.IsLower(l(a,e.vertices[0],e.vertices[2],e.vertices[1],b),0)?c.push(!0):c.push(!1):c.push(!1);var f,k,m,n=[];for(d=0;d<c.length;d++)c[d]&&(e=a.triangles[d],e.valid&&(f=a.edges[e.edges[0]],k=a.edges[e.edges[1]],m=a.edges[e.edges[2]],f=-1==f.tri1||-1==f.tri2||c[f.tri1]!=c[f.tri2],k=-1==k.tri1||-1==k.tri2||c[k.tri1]!=c[k.tri2],m=-1==m.tri1||-1==m.tri2||c[m.tri1]!=
c[m.tri2],f&&n.push([e.vertices[0],e.vertices[1],b]),k&&n.push([e.vertices[1],e.vertices[2],b]),m&&n.push([e.vertices[2],e.vertices[0],b])));for(d=0;d<c.length;d++)c[d]&&(e=a.triangles[d],e.valid&&(e=a,m=d,f=e.triangles[m],f.valid&&(h(e,m,f.edges[0]),h(e,m,f.edges[1]),h(e,m,f.edges[2]),f.valid=!1)));for(d=0;d<n.length;d++)c=n[d],g(a,c[0],c[1],c[2])}var m=[],n=a.length;if(4>n)return m;var p=new function(){this.vertices=[];this.edges=[];this.triangles=[]},q;for(q=0;q<n;q++)e(p,a[q]);(function(a){var b=
-1,b=!JSM.IsLower(l(a,0,1,2,3),0)?g(a,0,1,2):g(a,0,2,1),b=a.triangles[b];g(a,b.vertices[0],b.vertices[2],3);g(a,b.vertices[2],b.vertices[1],3);g(a,b.vertices[1],b.vertices[0],3)})(p);for(q=4;q<n;q++)k(p,q);for(q=0;q<p.triangles.length;q++)a=p.triangles[q],a.valid&&m.push(a.vertices);return m};JSM.Polygon2D=function(){this.vertices=[]};JSM.Polygon2D.prototype.AddVertex=function(a,b){this.vertices.push(new JSM.Coord2D(a,b))};JSM.Polygon2D.prototype.GetVertex=function(a){return this.vertices[a]};
JSM.Polygon2D.prototype.SetVertex=function(a,b,c){this.vertices[a].Set(b,c)};JSM.Polygon2D.prototype.VertexCount=function(){return this.vertices.length};JSM.Polygon2D.prototype.Clear=function(){this.vertices=[]};JSM.Polygon2D.prototype.Clone=function(){var a=new JSM.Polygon2D,b;for(b=0;b<this.vertices.length;b++)a.vertices.push(this.vertices[b].Clone());return a};JSM.ContourPolygon2D=function(){this.polygons=[]};
JSM.ContourPolygon2D.prototype.AddVertex=function(a,b,c){void 0===this.polygons[a]&&(this.polygons[a]=new JSM.Polygon2D);this.polygons[a].AddVertex(b,c)};JSM.ContourPolygon2D.prototype.VertexCount=function(a){return void 0===this.polygons[a]?0:this.polygons[a].VertexCount()};JSM.ContourPolygon2D.prototype.GetVertex=function(a,b){return this.polygons[a].GetVertex(b)};JSM.ContourPolygon2D.prototype.SetVertex=function(a,b,c,d){this.polygons[a].SetVertex(b,c,d)};
JSM.ContourPolygon2D.prototype.AddContour=function(){this.polygons.push(new JSM.Polygon2D)};JSM.ContourPolygon2D.prototype.ContourCount=function(){return this.polygons.length};JSM.ContourPolygon2D.prototype.GetContour=function(a){return this.polygons[a]};JSM.ContourPolygon2D.prototype.Clear=function(){this.polygons=[]};JSM.ContourPolygon2D.prototype.Clone=function(){var a=new JSM.ContourPolygon2D,b;for(b=0;b<this.polygons.length;b++)a.polygons.push(this.polygons[b].Clone());return a};
JSM.Polygon=function(){this.vertices=[]};JSM.Polygon.prototype.AddVertex=function(a,b,c){this.vertices.push(new JSM.Coord(a,b,c))};JSM.Polygon.prototype.GetVertex=function(a){return this.vertices[a]};JSM.Polygon.prototype.SetVertex=function(a,b,c,d){this.vertices[a].Set(b,c,d)};JSM.Polygon.prototype.VertexCount=function(){return this.vertices.length};JSM.Polygon.prototype.Clear=function(){this.vertices=[]};
JSM.Polygon.prototype.Clone=function(){var a=new JSM.Polygon,b;for(b=0;b<this.vertices.length;b++)a.vertices.push(this.vertices[b].Clone());return a};JSM.CreatePolygonFromVertices=function(a){var b=new JSM.Polygon2D,c,d;for(c=0;c<a.length;c++)d=a[c],b.AddVertex(d.x,d.y);return b};JSM.PolygonSignedArea2D=function(a){var b=a.VertexCount(),c=0,d,e,f;for(d=0;d<b;d++)e=a.GetVertex(d),f=a.GetVertex((d+1)%b),c+=e.x*f.y-f.x*e.y;return c/2};JSM.PolygonArea2D=function(a){return Math.abs(JSM.PolygonSignedArea2D(a))};
JSM.PolygonOrientation2D=function(a){a=JSM.PolygonSignedArea2D(a);return JSM.IsPositive(a)?"CounterClockwise":JSM.IsNegative(a)?"Clockwise":"Invalid"};JSM.ChangePolygonOrientation2D=function(a){var b=a.Clone();a.Clear();var c,d;for(c=b.VertexCount()-1;0<=c;c--)d=b.GetVertex(c),a.AddVertex(d.x,d.y)};JSM.CreateCCWPolygonFromVertices=function(a){a=JSM.CreatePolygonFromVertices(a);"CounterClockwise"!=JSM.PolygonOrientation2D(a)&&JSM.ChangePolygonOrientation2D(a);return a};
JSM.PolygonComplexity2D=function(a){var b=!1,c=!1,d=a.VertexCount(),e,f,g,h;for(e=0;e<d;e++)if(f=0===e?d-1:e-1,g=e,h=e===d-1?0:e+1,f=a.GetVertex(f),g=a.GetVertex(g),h=a.GetVertex(h),h=JSM.CoordTurnType2D(f,g,h),"CounterClockwise"===h?b=!0:"Clockwise"===h&&(c=!0),b&&c)return"Concave";return!b&&!c?"Invalid":"Convex"};
JSM.CoordPolygonPosition2D=function(a,b){var c=b.VertexCount(),d,e,f;for(d=0;d<c;d++)if(e=b.GetVertex(d),f=b.GetVertex((d+1)%c),e=new JSM.Sector2D(e,f),"CoordOutsideOfSector"!==JSM.CoordSectorPosition2D(a,e))return"CoordOnPolygonEdge";var g=0,h;for(d=0;d<c;d++)h=Math.abs(b.GetVertex(d).x-a.x),JSM.IsGreater(h,g)&&(g=h);g=new JSM.Sector2D(a,new JSM.Coord2D(a.x+2*g,a.y));h=0;var l;for(d=0;d<c;d++)e=b.GetVertex(d),f=b.GetVertex((d+1)%c),e=new JSM.Sector2D(e,f),f=new JSM.Coord2D(0,0),l=JSM.SectorSectorPosition2D(g,
e,f),"SectorsDontIntersects"!==l&&("SectorsIntersectsOnePoint"===l?h++:"SectorsIntersectsEndPoint"===l&&(JSM.CoordIsEqual2D(f,e.beg)?JSM.IsGreater(e.beg.y,e.end.y)&&h++:JSM.CoordIsEqual2D(f,e.end)&&JSM.IsLower(e.beg.y,e.end.y)&&h++));return 0===h%2?"CoordOutsideOfPolygon":"CoordInsideOfPolygon"};
JSM.SectorIntersectsPolygon2D=function(a,b,c,d){var e=a.VertexCount(),f,g,h;for(f=0;f<e;f++)if(g=f,h=(f+1)%e,!(g==c||h==c||g==d||h==d))if(g=new JSM.Sector2D(a.GetVertex(g),a.GetVertex(h)),g=JSM.SectorSectorPosition2D(b,g),"SectorsDontIntersects"!==g)return!0;return!1};
JSM.IsPolygonVertexVisible2D=function(a,b,c){if(b===c)return!1;var d=a.VertexCount();if(c===(0<b?b-1:d-1)||c===(b<d-1?b+1:0))return!1;d=new JSM.Sector2D(a.GetVertex(b),a.GetVertex(c));if(JSM.SectorIntersectsPolygon2D(a,d,b,c))return!1;b=JSM.MidCoord2D(d.beg,d.end);return"CoordInsideOfPolygon"!==JSM.CoordPolygonPosition2D(b,a)?!1:!0};
JSM.CreatePolygonWithHole2D=function(a){var b=[],c=[],d=0,e;c.push(-1);for(e=0;e<a.length;e++)null===a[e]&&(c.push(e),d+=1);c.push(e);d+=1;for(e=0;e<d;e++){var f=e,g=c[f]+1,h=c[f+1];if(0===f){f=void 0;for(f=g;f<h;f++)b.push(f)}else{for(var g=void 0,g=new JSM.Polygon2D,h=new JSM.Polygon2D,l=void 0,k=void 0,k=void 0,l=0;l<b.length;l++)k=a[b[l]],g.AddVertex(k.x,k.y);for(var m=c[f]+1,n=c[f+1],l=m;l<n;l++)k=a[l],h.AddVertex(k.x,k.y);for(var p=null,q=void 0,r=void 0,s=void 0,l=0;l<g.VertexCount();l++){r=
b[l];for(k=m;k<n;k++)if(s=k-m,q=new JSM.Sector(a[r],a[k]),!JSM.SectorIntersectsPolygon2D(g,q,l,-1)&&!JSM.SectorIntersectsPolygon2D(h,q,-1,s)){p=[r,k];break}if(null!==p)break}g=p;h=c[f]+1;f=c[f+1];l=[];n=m=void 0;for(m=0;m<b.length;m++)l[m]=b[m];b=[];p=k=void 0;for(m=0;m<l.length;m++)if(b.push(l[m]),l[m]==g[0]){n=g[1];k=!0;for(p=!1;!p;)b.push(n),!k&&n==g[1]&&(p=!0),k&&(k=!1),n=n<f-1?n+1:h;b.push(l[m])}}}return b};
JSM.PolygonTriangulate2D=function(a){function b(){var a=[],b,c,d,e;for(b=0;b<g.length;b++)if(d=g[b],3===d.length)if("CounterClockwise"===k)a.push(d);else{e=[];for(c=d.length-1;0<=c;c--)e.push(f-d[c]-1);a.push(e)}return a}function c(a,b,c){if(b===c)return!1;var d=a.VertexCount(),e;if(!(e=(b<d-1?b+1:0)===c))e=(0<b?b-1:d-1)===c;return e?!1:JSM.IsPolygonVertexVisible2D(a,b,c)}function d(a,b,c){var d=a.length;if(3>=d)return!0;var e,f,h,k;for(e=0;2>e;e++){h=f=-1;0===e?(f=b,h=c):1===e&&(f=c,h=b);k=[];for(k.push(a[h]);f!==
h;f=f<d-1?f+1:0)k.push(a[f]);g.push(k)}return!0}var e=a.Clone(),f=e.VertexCount();if(3>f)return[];var g=[],h=[],l;for(a=0;a<f;a++)h.push(a);g.push(h);if(3===f)return b();var h=JSM.PolygonComplexity2D(e),k=JSM.PolygonOrientation2D(e);if("Invalid"===h||"Invalid"===k)return[];if("CounterClockwise"!==k){var m,n,p;for(a=0;a<f/2;a++)m=a,n=f-a-1,p=e.vertices[m],e.vertices[m]=e.vertices[n],e.vertices[n]=p}if("Convex"===h){for(a=0;a<f-2;a++)e=[],e.push(0),e.push((a+1)%f),e.push((a+2)%f),g.push(e);return b()}var q;
for(a=0;a<g.length;a++)if(m=g[a],n=m.length,3!==n){p=new JSM.Polygon2D;for(h=0;h<n;h++)l=e.GetVertex(m[h]),p.AddVertex(l.x,l.y);q=!1;for(h=0;h<n;h++){for(l=0;l<n;l++)if(c(p,h,l)){d(m,h,l);q=!0;break}if(q)break}}return b()};
JSM.CheckTriangulation2D=function(a,b){var c=JSM.PolygonSignedArea2D(a),d=0,e,f,g,h,l;for(e=0;e<b.length;e++){g=b[e];if(3!==g.length)return!1;h=new JSM.Polygon2D;for(f=0;f<g.length;f++)l=a.GetVertex(g[f]),h.AddVertex(l.x,l.y);d+=JSM.PolygonSignedArea2D(h)}return!JSM.IsEqual(c,d)?!1:!0};
JSM.CreatePolygonWithHole=function(a){var b=[],c;for(c=0;c<a.length;c++)null!==a[c]&&b.push(a[c]);var b=JSM.CalculateNormal(b),d=new JSM.Coord(0,0,0),e=[],f;for(c=0;c<a.length;c++)null!==a[c]?(f=JSM.GetCoord2DFromCoord(a[c],d,b),e.push(f)):e.push(null);return JSM.CreatePolygonWithHole2D(e)};
JSM.PolygonTriangulate=function(a){var b=new JSM.Polygon2D,c=JSM.CalculateNormal(a.vertices),d=new JSM.Coord(0,0,0),e=a.VertexCount(),f,g;for(f=0;f<e;f++)g=JSM.GetCoord2DFromCoord(a.GetVertex(f),d,c),b.AddVertex(g.x,g.y);return JSM.PolygonTriangulate2D(b)};
JSM.OffsetPolygonContour=function(a,b){var c=a.VertexCount(),d=JSM.CalculateNormal(a.vertices),e,f,g,h,l,k=new JSM.Polygon,m;for(m=0;m<c;m++)e=0===m?c-1:m-1,f=m,g=m===c-1?0:m+1,e=a.GetVertex(e),f=a.GetVertex(f),h=a.GetVertex(g),l=JSM.CoordSub(e,f),g=JSM.CoordSub(h,f),l=JSM.GetVectorsAngle(l,g)/2,"Clockwise"===JSM.CoordTurnType(e,f,h,d)&&(l=Math.PI-l),e=b/Math.sin(l),e=JSM.CoordOffset(f,g,e),e=JSM.CoordRotate(e,d,l,f),k.AddVertex(e.x,e.y,e.z);return k};
JSM.CutPolygonWithPlane=function(a,b,c,d,e){function f(a,b,c,d,e){1==b?c.push(a):-1==b?d.push(a):e.push(a)}function g(a,b,c,d){function e(a,b){if(!(2>b.length)){for(var c=a.GetVertex(b[0]),d=a.GetVertex(b[1]),d=JSM.CoordSub(d,c),f=JSM.GetPlaneFromCoordAndDirection(c,d),g,d=[],c=0;c<b.length;c++)g=a.GetVertex(b[c]),d.push(JSM.CoordPlaneSignedDistance(g,f));for(c=0;c<b.length-1;c++)for(f=0;f<b.length-c-1;f++)if(JSM.IsGreater(d[f],d[f+1])){g=d;var h=f+1,k=g[f];g[f]=g[h];g[h]=k;g=b;h=f+1;k=g[f];g[f]=
g[h];g[h]=k}}}function f(a,b,c,d,e,g){function h(a,b){a[a[b]]=-1;a[b]=-1}var k=[];(function(a,b,c){var d;for(d=0;d<a.VertexCount();d++)c.push(-1);for(d=0;d<b.length;d+=2){a=c;var e=b,f=d;a[e[f]]=e[f+1];a[e[f+1]]=e[f]}})(a,b,k);var l=0;g&&(l=b.length-1);for(var m=b[l],n=m,p=!1,q=0,r=new JSM.Polygon,s;;){p||(q=c[n],0!==q&&(p=!0));if(0<r.VertexCount()&&n==m)if(1==q?d.push(r):-1==q&&e.push(r),r=new JSM.Polygon,0<l&&l<b.length){n=m=b[l];continue}else break;s=a.GetVertex(n);r.AddVertex(s.x,s.y,s.z);-1!=
k[n]?(l=g?l-2:l+2,n=k[n],h(k,n)):n=n<a.VertexCount()-1?n+1:0}}var g=[];(function(a,b){var c,d,e,f;for(c=0;c<a.length;c++)if(d=a[c],0===d){d=0<c?c-1:a.length-1;e=c<a.length-1?c+1:0;f=a[d];e=a[e];if(0!==e&&0===f){for(;0===a[d];)d=0<d?d-1:a.length-1;f=a[d]}(-1==f&&1==e||1==f&&-1==e)&&b.push(c)}})(b,g);0===g.length||0!==g.length%2||(e(a,g),f(a,g,b,c,d,!1),f(a,g,b,c,d,!0))}var h=new JSM.Polygon,l=[];b=function(a,b,c,d){function e(a,c,d,f,g){function h(a,c,d,e,f,g){var k=d[d.length-1];0!==k&&(0!==g&&k!=
g)&&(e=a.GetVertex(e),a=a.GetVertex(f),a=new JSM.Line(a,JSM.CoordSub(a,e)),f=new JSM.Coord(0,0,0),"LineIntersectsPlane"==JSM.LinePlanePosition(a,b,f)&&(c.AddVertex(f.x,f.y,f.z),d.push(0)))}function k(a,b,c,d,e){a=a.GetVertex(d);b.AddVertex(a.x,a.y,a.z);c.push(e)}var l=0===c,n=c===a.VertexCount(),p;n?(c=0,p=a.VertexCount()-1):p=c-1;f=f[c];l||h(a,d,g,p,c,f);n||k(a,d,g,c,f);return f}var f=[],g=!1,h=!1,l,t,y;for(l=0;l<a.VertexCount();l++)t=a.GetVertex(l),t=JSM.CoordPlanePosition(t,b),y=0,"CoordInFrontOfPlane"==
t?(y=1,h=!0):"CoordAtBackOfPlane"==t&&(y=-1,g=!0),f.push(y);if(g&&h)for(l=0;l<=a.VertexCount();l++)e(a,l,c,f,d);else{if(g)return-1;if(h)return 1}return 0}(a,b,h,l);0===h.VertexCount()&&0===l.length?f(a,b,c,d,e):g(h,l,c,d);return 0===c.length+d.length+e.length?!1:!0};JSM.BSPNode=function(){this.outside=this.inside=this.parent=this.plane=this.userData=this.polygon=null};JSM.BSPNode.prototype.IsLeaf=function(){return null===this.inside&&null===this.outside};JSM.BSPTree=function(){this.root=null};
JSM.BSPTree.prototype.AddPolygon=function(a,b){null===this.root&&(this.root=this.GetNewNode());return this.AddPolygonToNode(this.root,a,b)};JSM.BSPTree.prototype.Traverse=function(a){this.TraverseNode(this.root,a)};JSM.BSPTree.prototype.TraverseNode=function(a,b){null!==a&&(b(a),this.TraverseNode(a.inside,b),this.TraverseNode(a.outside,b))};JSM.BSPTree.prototype.GetNodes=function(){var a=[];this.Traverse(function(b){a.push(b)});return a};
JSM.BSPTree.prototype.NodeCount=function(){var a=0;this.Traverse(function(){a+=1});return a};
JSM.BSPTree.prototype.AddPolygonToNode=function(a,b,c){if(3>b.VertexCount())return!1;var d;if(null===a.polygon){d=JSM.CalculateNormal(b.vertices);var e=JSM.GetPlaneFromCoordAndDirection(b.GetVertex(0),d);a.polygon=b;void 0!==c&&(a.userData=c);a.plane=e}else{d=[];var f=[],e=[];JSM.CutPolygonWithPlane(b,a.plane,f,d,e)&&(0<d.length&&this.AddInsidePolygonsToNode(a,d,c),0<f.length&&this.AddOutsidePolygonsToNode(a,f,c),0<e.length&&(d=JSM.CalculateNormal(b.vertices),0<JSM.VectorDot(d,a.plane.GetNormal())?
this.AddInsidePolygonsToNode(a,e,c):this.AddOutsidePolygonsToNode(a,e,c)))}return!0};JSM.BSPTree.prototype.AddInsidePolygonsToNode=function(a,b,c){null===a.inside&&(a.inside=this.GetNewNode(),a.inside.parent=a);var d;for(d=0;d<b.length;d++)this.AddPolygonToNode(a.inside,b[d],c)};JSM.BSPTree.prototype.AddOutsidePolygonsToNode=function(a,b,c){null===a.outside&&(a.outside=this.GetNewNode(),a.outside.parent=a);var d;for(d=0;d<b.length;d++)this.AddPolygonToNode(a.outside,b[d],c)};
JSM.BSPTree.prototype.GetNewNode=function(){return new JSM.BSPNode};
JSM.ClipPolygonWithBSPTree=function(a,b,c,d,e,f){function g(a,b,c){if(null!==b){var d=[],e=[],f=[];JSM.CutPolygonWithPlane(a,b.plane,e,d,f)&&(0<d.length&&l(b,d,c),0<e.length&&k(b,e,c),0<f.length&&(a=JSM.CalculateNormal(a.vertices),0<JSM.VectorDot(a,b.plane.GetNormal())?l(b,f,!0):k(b,f,!0)))}}function h(a,b){var c;for(c=0;c<a.length;c++)b.push(a[c])}function l(a,b,c){if(null!==a.inside){a=a.inside;var e;for(e=0;e<b.length;e++)g(b[e],a,c)}else h(b,c?f:d)}function k(a,b,d){if(null!==a.outside){a=a.outside;
var f;for(f=0;f<b.length;f++)g(b[f],a,d)}else h(b,d?e:c)}g(a,b.root,!1);return!0};JSM.GetGaussianCParameter=function(a,b,c,d){return Math.sqrt(-(Math.pow(a-c,2)/(2*Math.log(d/Math.abs(b)))))};JSM.GetGaussianValue=function(a,b,c,d){return b*Math.exp(-(Math.pow(a-c,2)/(2*Math.pow(d,2))))};JSM.GenerateCirclePoints=function(a,b,c){var d=[],e=2*Math.PI,f=2*Math.PI/b,g,h;for(g=0;g<b;g++)h=JSM.CylindricalToCartesian(a,0,e),void 0!==c&&null!==c&&(h=JSM.CoordAdd(h,c)),d.push(h),e+=f;return d};
JSM.GetRuledMesh=function(a,b,c,d,e){if(a.length===b.length){var f=a.length-1,g=[],h=[],l;for(l=0;l<=f;l++)g.push(JSM.CoordSub(b[l],a[l])),h.push(JSM.CoordDistance(a[l],b[l]));var k,m;for(l=0;l<=f;l++){k=h[l]/c;for(b=0;b<=c;b++)m=JSM.CoordOffset(a[l],g[l],k*b),d.push(m)}for(l=0;l<f;l++)for(b=0;b<c;b++)a=l*(c+1)+b,d=a+1,g=a+c+1,h=g+1,a=[a,g,h,d],e.push(a)}};JSM.BodyVertex=function(a){this.position=a};JSM.BodyVertex.prototype.GetPosition=function(){return this.position};
JSM.BodyVertex.prototype.SetPosition=function(a){this.position=a};JSM.BodyVertex.prototype.Clone=function(){return new JSM.BodyVertex(this.position.Clone())};JSM.BodyPolygon=function(a){this.vertices=a;this.curved=this.material=-1};JSM.BodyPolygon.prototype.AddVertexIndex=function(a){this.vertices.push(a)};JSM.BodyPolygon.prototype.GetVertexIndex=function(a){return this.vertices[a]};JSM.BodyPolygon.prototype.VertexIndexCount=function(){return this.vertices.length};
JSM.BodyPolygon.prototype.HasMaterialIndex=function(){return-1!==this.material};JSM.BodyPolygon.prototype.GetMaterialIndex=function(){return this.material};JSM.BodyPolygon.prototype.SetMaterialIndex=function(a){this.material=a};JSM.BodyPolygon.prototype.HasCurveGroup=function(){return-1!==this.curved};JSM.BodyPolygon.prototype.GetCurveGroup=function(){return this.curved};JSM.BodyPolygon.prototype.SetCurveGroup=function(a){this.curved=a};
JSM.BodyPolygon.prototype.InheritAttributes=function(a){this.material=a.material;this.curved=a.curved};JSM.BodyPolygon.prototype.Clone=function(){var a=new JSM.BodyPolygon([]),b;for(b=0;b<this.vertices.length;b++)a.vertices.push(this.vertices[b]);a.material=this.material;a.curved=this.curved;return a};JSM.Body=function(){this.vertices=[];this.polygons=[];this.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1))};
JSM.Body.prototype.AddVertex=function(a){this.vertices.push(a);return this.vertices.length-1};JSM.Body.prototype.AddPolygon=function(a){this.polygons.push(a);return this.polygons.length-1};JSM.Body.prototype.GetVertex=function(a){return this.vertices[a]};JSM.Body.prototype.GetVertexPosition=function(a){return this.vertices[a].position};JSM.Body.prototype.SetVertexPosition=function(a,b){this.vertices[a].position=b};JSM.Body.prototype.VertexCount=function(){return this.vertices.length};
JSM.Body.prototype.GetPolygon=function(a){return this.polygons[a]};JSM.Body.prototype.PolygonCount=function(){return this.polygons.length};JSM.Body.prototype.SetPolygonsMaterialIndex=function(a){var b;for(b=0;b<this.polygons.length;b++)this.polygons[b].SetMaterialIndex(a)};JSM.Body.prototype.SetPolygonsCurveGroup=function(a){var b;for(b=0;b<this.polygons.length;b++)this.polygons[b].SetCurveGroup(a)};JSM.Body.prototype.GetTextureProjectionType=function(){return this.projection};
JSM.Body.prototype.SetTextureProjectionType=function(a){this.projection=a};JSM.Body.prototype.GetTextureProjectionCoords=function(){return this.coords};JSM.Body.prototype.SetTextureProjectionCoords=function(a){this.coords=a};JSM.Body.prototype.SetPlanarTextureProjection=function(a,b,c){this.SetTextureProjectionType("Planar");this.SetTextureProjectionCoords(new JSM.CoordSystem(a,b,JSM.VectorCross(b,c),new JSM.Coord(0,0,0)))};
JSM.Body.prototype.SetCubicTextureProjection=function(a,b,c,d){this.SetTextureProjectionType("Cubic");this.SetTextureProjectionCoords(new JSM.CoordSystem(a,b,c,d))};JSM.Body.prototype.SetCylindricalTextureProjection=function(a,b,c,d){this.SetTextureProjectionType("Cylindrical");this.SetTextureProjectionCoords(new JSM.CoordSystem(a,JSM.VectorSetLength(c,b),JSM.VectorSetLength(JSM.VectorCross(d,c),b),d))};
JSM.Body.prototype.Transform=function(a){var b;for(b=0;b<this.vertices.length;b++)this.vertices[b].position=a.Apply(this.vertices[b].position);null!==this.coords&&(b=JSM.CoordSystemToAbsoluteCoords(this.coords),b.origo=a.Apply(b.origo),b.e1=a.Apply(b.e1),b.e2=a.Apply(b.e2),b.e3=a.Apply(b.e3),this.coords=JSM.CoordSystemToDirectionVectors(b))};
JSM.Body.prototype.GetBoundingBox=function(){var a=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf),b=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf),c,d;for(c=0;c<this.vertices.length;c++)d=this.vertices[c].position,a.x=JSM.Minimum(a.x,d.x),a.y=JSM.Minimum(a.y,d.y),a.z=JSM.Minimum(a.z,d.z),b.x=JSM.Maximum(b.x,d.x),b.y=JSM.Maximum(b.y,d.y),b.z=JSM.Maximum(b.z,d.z);return[a,b]};JSM.Body.prototype.GetCenter=function(){var a=this.GetBoundingBox();return JSM.MidCoord(a[0],a[1])};
JSM.Body.prototype.GetBoundingSphereRadius=function(){var a=this.GetCenter(),b=0,c,d;for(c=0;c<this.vertices.length;c++)d=JSM.CoordDistance(a,this.vertices[c].position),JSM.IsGreater(d,b)&&(b=d);return b};JSM.Body.prototype.OffsetToOrigo=function(){var a=this.GetCenter(),a=JSM.VectorMultiply(a,-1),b;for(b=0;b<this.vertices.length;b++)this.vertices[b].position=JSM.CoordAdd(this.vertices[b].position,a)};
JSM.Body.prototype.Merge=function(a){var b=this.vertices.length,c,d;for(c=0;c<a.VertexCount();c++)this.vertices.push(a.GetVertex(c).Clone());var e;for(c=0;c<a.PolygonCount();c++){e=a.GetPolygon(c).Clone();for(d=0;d<e.VertexIndexCount();d++)e.vertices[d]+=b;this.polygons.push(e)}};JSM.Body.prototype.Clear=function(){this.vertices=[];this.polygons=[];this.coords=this.projection=null};JSM.Model=function(){this.bodies=[]};
JSM.Model.prototype.AddBody=function(a){this.bodies.push(a);return this.bodies.length-1};JSM.Model.prototype.GetBody=function(a){return this.bodies[a]};JSM.Model.prototype.BodyCount=function(){return this.bodies.length};JSM.Model.prototype.VertexCount=function(){var a=0,b;for(b=0;b<this.bodies.length;b++)a+=this.bodies[b].VertexCount();return a};JSM.Model.prototype.PolygonCount=function(){var a=0,b;for(b=0;b<this.bodies.length;b++)a+=this.bodies[b].PolygonCount();return a};
JSM.HexColorToRGBComponents=function(a){for(var b=a.toString(16);6>b.length;)b="0"+b;a=parseInt(b.substr(0,2),16);var c=parseInt(b.substr(2,2),16),b=parseInt(b.substr(4,2),16);return[a,c,b]};JSM.HexColorToNormalizedRGBComponents=function(a){a=JSM.HexColorToRGBComponents(a);return[a[0]/255,a[1]/255,a[2]/255]};JSM.HexColorToRGBColor=function(a){return parseInt("0x"+a,16)};
JSM.RGBComponentsToHexColor=function(a,b,c){function d(a){for(a=parseInt(a,10).toString(16);2>a.length;)a="0"+a;return a}a=d(a);b=d(b);c=d(c);return parseInt("0x"+a+b+c,16)};JSM.Light=function(a){var b=8355711,c=8355711,d=0,e=new JSM.Vector(1,0,0);void 0!==a&&null!==a&&(b=JSM.ValueOrDefault(a.ambient,b),c=JSM.ValueOrDefault(a.diffuse,c),d=JSM.ValueOrDefault(a.specular,d),e=JSM.ValueOrDefault(a.direction,e));this.ambient=b;this.diffuse=c;this.specular=d;this.direction=e};
JSM.Material=function(a){var b=52224,c=52224,d=0,e=0,f=1,g=null,h=1,l=1;void 0!==a&&null!==a&&(b=JSM.ValueOrDefault(a.ambient,b),c=JSM.ValueOrDefault(a.diffuse,c),d=JSM.ValueOrDefault(a.specular,d),e=JSM.ValueOrDefault(a.shininess,e),f=JSM.ValueOrDefault(a.opacity,f),g=JSM.ValueOrDefault(a.texture,g),h=JSM.ValueOrDefault(a.textureWidth,h),l=JSM.ValueOrDefault(a.textureHeight,l));this.ambient=b;this.diffuse=c;this.specular=d;this.shininess=e;this.opacity=f;this.texture=g;this.textureWidth=h;this.textureHeight=
l};JSM.Materials=function(){this.materials=[];this.defaultMaterial=new JSM.Material};JSM.Materials.prototype.GetMaterial=function(a){return 0>a||a>=this.materials.length?this.defaultMaterial:this.materials[a]};JSM.Materials.prototype.AddMaterial=function(a){this.materials.push(a)};JSM.Materials.prototype.GetDefaultMaterial=function(){return this.defaultMaterial};JSM.Materials.prototype.Count=function(){return this.materials.length};
JSM.AddVertexToBody=function(a,b,c,d){a.AddVertex(new JSM.BodyVertex(new JSM.Coord(b,c,d)))};JSM.AddPolygonToBody=function(a,b){a.AddPolygon(new JSM.BodyPolygon(b))};JSM.CalculateBodyVertexToPolygon=function(a){var b=[],c,d;for(c=0;c<a.VertexCount();c++)b.push([]);var e;for(c=0;c<a.PolygonCount();c++){e=a.GetPolygon(c);for(d=0;d<e.VertexIndexCount();d++)b[e.GetVertexIndex(d)].push(c)}return b};
JSM.CalculateBodyPolygonNormal=function(a,b){var c=a.GetPolygon(b),d=c.VertexIndexCount(),e=new JSM.Vector(0,0,0);if(3<=d){var f,g,h;for(f=0;f<d;f++)g=f,h=(f+1)%d,g=a.GetVertexPosition(c.GetVertexIndex(g)),h=a.GetVertexPosition(c.GetVertexIndex(h)),e.x+=(g.y-h.y)*(g.z+h.z),e.y+=(g.z-h.z)*(g.x+h.x),e.z+=(g.x-h.x)*(g.y+h.y)}return JSM.VectorNormalize(e)};JSM.CalculateBodyPolygonNormals=function(a){var b=[],c;for(c=0;c<a.PolygonCount();c++)b.push(JSM.CalculateBodyPolygonNormal(a,c));return b};
JSM.CalculateBodyVertexNormals=function(a){var b=[],c=JSM.CalculateBodyPolygonNormals(a),d=null,e,f,g,h,l,k,m,n;for(e=0;e<a.PolygonCount();e++)if(h=a.GetPolygon(e),b[e]=[],h.HasCurveGroup()){null===d&&(d=JSM.CalculateBodyVertexToPolygon(a));for(f=0;f<h.VertexIndexCount();f++){l=new JSM.Vector(0,0,0);k=0;m=d[h.GetVertexIndex(f)];for(g=0;g<m.length;g++)n=a.GetPolygon(m[g]),n.GetCurveGroup()===h.GetCurveGroup()&&(l=JSM.CoordAdd(l,c[m[g]]),k++);l=JSM.VectorMultiply(l,1/k);l=JSM.VectorNormalize(l);b[e].push(l)}}else{g=
c[e];for(f=0;f<h.VertexIndexCount();f++)b[e].push(new JSM.Vector(g.x,g.y,g.z))}return b};JSM.MakeBodyInsideOut=function(a){var b,c,d,e,f;for(b=0;b<a.PolygonCount();b++){d=a.GetPolygon(b);f=d.vertices.slice(0);e=f.length;d.vertices=[];for(c=0;c<e;c++)d.vertices.push(f[e-c-1])}};
JSM.SoftMoveBodyVertex=function(a,b,c,d,e){b=a.GetVertex(b).position;var f=JSM.GetGaussianCParameter(c,e,0,1E-5),g,h,l;for(g=0;g<a.VertexCount();g++)h=JSM.CoordDistance(b,a.GetVertex(g).position),JSM.IsGreater(h,c)||(h=JSM.GetGaussianValue(h,e,0,f),l=a.GetVertex(g).position,a.GetVertex(g).position=JSM.CoordOffset(l,d,h))};
JSM.CalculatePolygonCentroid=function(a,b){var c=a.GetPolygon(b),d=c.VertexIndexCount(),e=new JSM.Coord(0,0,0),f;for(f=0;f<d;f++)e=JSM.CoordAdd(e,a.GetVertexPosition(c.GetVertexIndex(f)));return e=JSM.VectorMultiply(e,1/d)};
JSM.TriangulateWithCentroids=function(a){var b=new JSM.Body,c,d;for(c=0;c<a.VertexCount();c++)d=a.GetVertex(c).position,b.AddVertex(new JSM.BodyVertex(new JSM.Coord(d.x,d.y,d.z)));var e,f,g,h,l;for(c=0;c<a.PolygonCount();c++){d=JSM.CalculatePolygonCentroid(a,c);l=b.VertexCount();b.AddVertex(new JSM.BodyVertex(new JSM.Coord(d.x,d.y,d.z)));f=a.GetPolygon(c);g=f.VertexIndexCount();for(d=0;d<g;d++)e=f.GetVertexIndex(d),h=f.GetVertexIndex(d<g-1?d+1:0),e=new JSM.BodyPolygon([e,h,l]),e.material=f.material,
e.curved=f.curved,b.AddPolygon(e)}return b};
JSM.TriangulatePolygons=function(a){var b=new JSM.Body,c,d,e;for(c=0;c<a.VertexCount();c++)e=a.GetVertexPosition(c),b.AddVertex(new JSM.BodyVertex(new JSM.Coord(e.x,e.y,e.z)));var f,g;for(c=0;c<a.PolygonCount();c++){f=new JSM.Polygon;g=a.GetPolygon(c);for(d=0;d<g.VertexIndexCount();d++)e=a.GetVertexPosition(g.GetVertexIndex(d)),f.AddVertex(e.x,e.y,e.z);e=JSM.PolygonTriangulate(f);for(d=0;d<e.length;d++)f=e[d],f=new JSM.BodyPolygon([g.GetVertexIndex(f[0]),g.GetVertexIndex(f[1]),g.GetVertexIndex(f[2])]),
f.InheritAttributes(g),b.AddPolygon(f)}return b};JSM.GenerateRandomMaterials=function(a,b,c){var d,e;for(d=0;d<a.PolygonCount();d++)e=void 0!==c&&c?JSM.SeededRandomInt(0,16777215,d+1):JSM.RandomInt(0,16777215),b.AddMaterial(new JSM.Material({ambient:e,diffuse:e})),e=b.Count()-1,a.GetPolygon(d).SetMaterialIndex(e)};JSM.VertInfo=function(){this.edges=[];this.pgons=[]};JSM.EdgeInfo=function(){this.pgon2=this.pgon1=this.vert2=this.vert1=-1};JSM.PolyEdgeInfo=function(){this.index=-1;this.reverse=!1};
JSM.PgonInfo=function(){this.verts=[];this.pedges=[]};JSM.AdjacencyInfo=function(){this.verts=[];this.edges=[];this.pgons=[]};JSM.GetPolyEdgeStartVertex=function(a,b){return a.reverse?b.edges[a.index].vert2:b.edges[a.index].vert1};JSM.GetPolyEdgeEndVertex=function(a,b){return a.reverse?b.edges[a.index].vert1:b.edges[a.index].vert2};
JSM.CalculateAdjacencyInfo=function(a){var b=new JSM.AdjacencyInfo,c,d,e;for(c=0;c<a.VertexCount();c++)d=new JSM.VertInfo,b.verts.push(d);var f,g,h,l,k;for(c=0;c<a.PolygonCount();c++){f=a.GetPolygon(c);e=new JSM.PgonInfo;g=f.VertexIndexCount();for(d=0;d<g;d++){h=f.GetVertexIndex(d);l=f.GetVertexIndex(d<g-1?d+1:0);k=h;var m=l;l=c;for(var n=new JSM.PolyEdgeInfo,p=void 0,q=void 0,p=0;p<b.edges.length;p++)q=b.edges[p],q.vert1===k&&q.vert2===m?(n.index=p,n.reverse=!1):q.vert1===m&&q.vert2===k&&(n.index=
p,n.reverse=!0);-1===n.index?(p=new JSM.EdgeInfo,p.vert1=k,p.vert2=m,p.pgon1=l,p.pgon2=-1,b.edges.push(p),n.index=b.edges.length-1,n.reverse=!1):(k=b.edges[n.index],-1===k.pgon1?k.pgon1=l:k.pgon1!==l&&-1===k.pgon2&&(k.pgon2=l));k=n;e.verts.push(h);e.pedges.push(k);b.verts[h].edges.push(k.index);b.verts[h].pgons.push(c)}b.pgons.push(e)}return b};JSM.IsSolidBody=function(a){a=JSM.CalculateAdjacencyInfo(a);var b,c;for(b=0;b<a.edges.length;b++)if(c=a.edges[b],-1===c.pgon1||-1===c.pgon2)return!1;return!0};
JSM.CheckSolidBody=function(a){a=JSM.CalculateAdjacencyInfo(a);var b,c,d,e,f,g,h,l;for(b=0;b<a.edges.length;b++){d=a.edges[b];if(-1===d.pgon1||-1===d.pgon2)return!1;g=a.pgons[d.pgon1];f=!1;for(c=0;c<g.pedges.length;c++)if(e=g.pedges[c],e.index==b){h=e.reverse;f=!0;break}if(!f)return!1;d=a.pgons[d.pgon2];f=!1;for(c=0;c<d.pedges.length;c++)if(e=d.pedges[c],e.index==b){l=e.reverse;f=!0;break}if(!f||h==l)return!1}return!0};
JSM.CalculatePlanarTextureCoord=function(a,b){var c=new JSM.Coord2D(0,0),d=JSM.VectorNormalize(b.e1),e=JSM.VectorNormalize(b.e2),f=JSM.VectorCross(b.e1,b.e2),f=JSM.GetPlaneFromCoordAndDirection(b.origo,f),e=JSM.GetPlaneFromCoordAndDirection(b.origo,e),d=JSM.GetPlaneFromCoordAndDirection(b.origo,d),f=JSM.ProjectCoordToPlane(a,f);c.x=JSM.CoordPlaneSignedDistance(f,d);c.y=JSM.CoordPlaneSignedDistance(f,e);return c};
JSM.CalculateCubicTextureCoord=function(a,b,c){var d=new JSM.Coord2D(0,0),e=JSM.VectorNormalize(c.e1),f=JSM.VectorNormalize(c.e2),g=JSM.VectorNormalize(c.e3),h=-1,l=0,k,m,n;for(k=0;3>k;k++)0===k?m=e:1===k?m=f:2===k&&(m=g),n=Math.abs(JSM.VectorDot(b,m)),JSM.IsGreater(n,l)&&(h=k,l=n);if(-1===h)return d;b=null;0===h?b=new JSM.CoordSystem(c.origo,f,g,new JSM.Coord(0,0,0)):1===h?b=new JSM.CoordSystem(c.origo,e,g,new JSM.Coord(0,0,0)):2===h&&(b=new JSM.CoordSystem(c.origo,e,f,new JSM.Coord(0,0,0)));return null===
b?d:JSM.CalculatePlanarTextureCoord(a,b)};JSM.CalculateCylindricalTextureCoord=function(a,b,c){var d=new JSM.Coord2D(0,0),e=JSM.VectorNormalize(c.e3);if(JSM.VectorsAreCollinear(e,b))return d=JSM.CalculateCubicTextureCoord(a,b,c),[d,0];b=new JSM.Line(c.origo,e);var f=JSM.ProjectCoordToLine(a,b);b=JSM.CoordSignedDistance(c.origo,f,e);var g=JSM.VectorNormalize(c.e1);a=JSM.CoordSub(a,f);e=JSM.GetVectorsFullAngle(a,g,e);c=JSM.VectorLength(c.e1);d.x=e*c;d.y=b;return[d,e]};
JSM.CalculatePolygonPlanarTextureCoords=function(a,b){var c=[],d=a.GetPolygon(b),e=a.GetTextureProjectionCoords(),f,g;for(f=0;f<d.VertexIndexCount();f++)g=a.GetVertexPosition(d.GetVertexIndex(f)),c.push(JSM.CalculatePlanarTextureCoord(g,e));return c};JSM.CalculatePolygonCubicTextureCoords=function(a,b,c){var d=[];b=a.GetPolygon(b);var e=a.GetTextureProjectionCoords(),f,g;for(f=0;f<b.VertexIndexCount();f++)g=a.GetVertexPosition(b.GetVertexIndex(f)),d.push(JSM.CalculateCubicTextureCoord(g,c,e));return d};
JSM.CalculatePolygonCylindricalTextureCoords=function(a,b,c){var d=[],e=[],f=a.GetPolygon(b);b=a.GetTextureProjectionCoords();var g,h;for(g=0;g<f.VertexIndexCount();g++)h=a.GetVertexPosition(f.GetVertexIndex(g)),h=JSM.CalculateCylindricalTextureCoord(h,c,b),d.push(h[0]),e.push(h[1]);g=JSM.VectorNormalize(b.e3);if(JSM.VectorsAreCollinear(g,c))return d;a=!1;for(g=0;g<e.length;g++){for(c=g+1;c<e.length;c++)if(JSM.IsGreater(Math.abs(e[g]-e[c]),Math.PI)){a=!0;break}if(a)break}if(a){b=JSM.VectorLength(b.e1);
for(g=0;g<e.length;g++)JSM.IsLower(e[g],Math.PI)&&(d[g].x=b*(e[g]+2*Math.PI))}return d};JSM.CalculateBodyPlanarTextureCoords=function(a){var b=[],c;for(c=0;c<a.PolygonCount();c++)b.push(JSM.CalculatePolygonPlanarTextureCoords(a,c));return b};JSM.CalculateBodyCubicTextureCoords=function(a){var b=[],c=JSM.CalculateBodyPolygonNormals(a),d,e;for(d=0;d<a.PolygonCount();d++)e=c[d],b.push(JSM.CalculatePolygonCubicTextureCoords(a,d,e));return b};
JSM.CalculateBodyCylindricalTextureCoords=function(a){var b=[],c=JSM.CalculateBodyPolygonNormals(a),d,e;for(d=0;d<a.PolygonCount();d++)e=c[d],b.push(JSM.CalculatePolygonCylindricalTextureCoords(a,d,e));return b};JSM.CalculateBodyTextureCoords=function(a){var b=[],c=a.GetTextureProjectionType();"Planar"===c?b=JSM.CalculateBodyPlanarTextureCoords(a):"Cubic"===c?b=JSM.CalculateBodyCubicTextureCoords(a):"Cylindrical"===c&&(b=JSM.CalculateBodyCylindricalTextureCoords(a));return b};
JSM.CutBodyByPlane=function(a,b){function c(a,b,c){function d(a){q.push(new JSM.Coord(p.x,p.y,p.z));r.push(a)}function e(c,d){s=JSM.VectorNormalize(JSM.CoordSub(a[d],a[c]));M=new JSM.Line(a[c],s);w=JSM.LinePlaneIntersection(M,b);q.push(new JSM.Coord(w.x,w.y,w.z));r.push(-1)}var f=void 0!==c&&null!==c,g=a.length,h=[],k=[],l=!1,m,n,p;for(m=0;m<g;m++)p=a[m],n=JSM.CoordPlanePosition(p,b),k.push("CoordAtBackOfPlane"!==n),0<m&&k[m-1]!==k[m]&&(l=!0);if(!l){if(!1===k[0])return h;for(m=0;m<g;m++)p=a[m],h.push(new JSM.Coord(p.x,
p.y,p.z)),f&&c.push(m);return h}var q=[],r=[],s,M,w;for(m=0;m<g;m++)l=m-1,n=m,0===m&&(l=g-1),p=a[n],k[n]?(k[l]||e(l,n),d(n)):k[l]&&e(l,n);for(m=0;m<q.length;m++)g=q[m],k=h[h.length-1],0===m||!JSM.CoordIsEqual(k,g)?(h.push(new JSM.Coord(g.x,g.y,g.z)),f&&(g=r[m],c.push(g))):f&&(g=r[m],k=r[m-1],-1!==g?c[c.length-1]=g:-1!==k&&(c[c.length-1]=k));return h}function d(a){var b=-1,c;for(c=s;c<e.VertexCount();c++)if(JSM.CoordIsEqual(e.GetVertexPosition(c),a)){b=c;break}-1===b&&(b=e.AddVertex(new JSM.BodyVertex(new JSM.Coord(a.x,
a.y,a.z))));return b}var e=new JSM.Body,f=[],g=[],h=[],l=[],k,m,n,p,q;for(k=0;k<a.PolygonCount();k++){n=a.GetPolygon(k);p=[];for(m=0;m<n.VertexIndexCount();m++)q=a.GetVertexPosition(n.GetVertexIndex(m)),p.push(new JSM.Coord(q.x,q.y,q.z));q=[];p=c(p,b,q);for(m=0;m<q.length;m++)-1!==q[m]&&(h[n.GetVertexIndex(q[m])]=!0);f.push(p);g.push(q)}var r;for(k=0;k<a.VertexCount();k++)h[k]&&(r=a.GetVertexPosition(k),l[k]=e.AddVertex(new JSM.BodyVertex(new JSM.Coord(r.x,r.y,r.z))));var s=e.VertexCount();for(k=
0;k<a.PolygonCount();k++)if(n=a.GetPolygon(k),p=f[k],q=g[k],0!==q.length){h=[];for(m=0;m<q.length;m++)-1!==q[m]?h.push(l[n.GetVertexIndex(q[m])]):(r=p[m],h.push(d(r)));m=new JSM.BodyPolygon(h);m.InheritAttributes(n);e.AddPolygon(m)}return e};
JSM.GenerateRectangle=function(a,b){var c=new JSM.Body,d=a/2,e=b/2;c.AddVertex(new JSM.BodyVertex(new JSM.Coord(-d,-e,0)));c.AddVertex(new JSM.BodyVertex(new JSM.Coord(d,-e,0)));c.AddVertex(new JSM.BodyVertex(new JSM.Coord(d,e,0)));c.AddVertex(new JSM.BodyVertex(new JSM.Coord(-d,e,0)));c.AddPolygon(new JSM.BodyPolygon([0,1,2,3]));c.SetCubicTextureProjection(new JSM.Coord(-d,-e,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return c};
JSM.GenerateCuboid=function(a,b,c){var d=new JSM.Body;a/=2;b/=2;c/=2;d.AddVertex(new JSM.BodyVertex(new JSM.Coord(-a,-b,-c)));d.AddVertex(new JSM.BodyVertex(new JSM.Coord(a,-b,-c)));d.AddVertex(new JSM.BodyVertex(new JSM.Coord(a,-b,c)));d.AddVertex(new JSM.BodyVertex(new JSM.Coord(-a,-b,c)));d.AddVertex(new JSM.BodyVertex(new JSM.Coord(-a,b,-c)));d.AddVertex(new JSM.BodyVertex(new JSM.Coord(a,b,-c)));d.AddVertex(new JSM.BodyVertex(new JSM.Coord(a,b,c)));d.AddVertex(new JSM.BodyVertex(new JSM.Coord(-a,
b,c)));d.AddPolygon(new JSM.BodyPolygon([0,1,2,3]));d.AddPolygon(new JSM.BodyPolygon([1,5,6,2]));d.AddPolygon(new JSM.BodyPolygon([5,4,7,6]));d.AddPolygon(new JSM.BodyPolygon([4,0,3,7]));d.AddPolygon(new JSM.BodyPolygon([0,4,5,1]));d.AddPolygon(new JSM.BodyPolygon([3,2,6,7]));d.SetCubicTextureProjection(new JSM.Coord(-a,-b,-c),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return d};
JSM.GenerateCuboidSides=function(a,b,c,d){var e=new JSM.Body;a/=2;b/=2;c/=2;e.AddVertex(new JSM.BodyVertex(new JSM.Coord(-a,-b,-c)));e.AddVertex(new JSM.BodyVertex(new JSM.Coord(a,-b,-c)));e.AddVertex(new JSM.BodyVertex(new JSM.Coord(a,-b,c)));e.AddVertex(new JSM.BodyVertex(new JSM.Coord(-a,-b,c)));e.AddVertex(new JSM.BodyVertex(new JSM.Coord(-a,b,-c)));e.AddVertex(new JSM.BodyVertex(new JSM.Coord(a,b,-c)));e.AddVertex(new JSM.BodyVertex(new JSM.Coord(a,b,c)));e.AddVertex(new JSM.BodyVertex(new JSM.Coord(-a,
b,c)));d[0]&&e.AddPolygon(new JSM.BodyPolygon([0,1,2,3]));d[1]&&e.AddPolygon(new JSM.BodyPolygon([1,5,6,2]));d[2]&&e.AddPolygon(new JSM.BodyPolygon([5,4,7,6]));d[3]&&e.AddPolygon(new JSM.BodyPolygon([4,0,3,7]));d[4]&&e.AddPolygon(new JSM.BodyPolygon([0,4,5,1]));d[5]&&e.AddPolygon(new JSM.BodyPolygon([3,2,6,7]));e.SetCubicTextureProjection(new JSM.Coord(-a,-b,-c),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return e};
JSM.GenerateSegmentedRectangle=function(a,b,c,d){var e=new JSM.Body,f=a/2,g=b/2,h=a/c,l=b/d;(function(){var a,b,n;for(a=0;a<=d;a++)for(b=0;b<=c;b++)n=new JSM.Coord(b*h-f,a*l-g,0),e.AddVertex(new JSM.BodyVertex(n))})();(function(){var a,b,f,g,h,l;for(b=0;b<d;b++)for(a=0;a<c;a++)f=b*(c+1)+a,g=f+1,h=f+c+1,l=h+1,e.AddPolygon(new JSM.BodyPolygon([f,g,l,h]))})();return e};
JSM.GenerateSegmentedCuboid=function(a,b,c,d){function e(a){var b=0;0<a&&a<=d&&(b=(d+1)*(d+1)+(a-1)*4*d);return b}function f(a){var b=[],c=e(a);if(0===a||a===d){for(a=0;a<=d;a++)b.push(c+a);for(a=1;a<=d;a++)b.push(c+(a+1)*d+a);for(a=d-1;0<=a;a--)b.push(c+(d+1)*d+a);for(a=d-1;0<a;a--)b.push(c+a*(d+1))}else if(0<a&&a<d){for(a=0;a<=d;a++)b.push(c+a);for(a=1;a<d;a++)b.push(c+d+2*a);for(a=d;0<=a;a--)b.push(c+3*d+a-1);for(a=d-1;0<a;a--)b.push(c+d+2*a-1)}return b}function g(a){var b,c,e=a*r;if(0===a||a===
d)for(a=0;a<=d;a++)for(b=0;b<=d;b++)c=new JSM.Coord(b*p-k,a*q-m,e-n),l.AddVertex(new JSM.BodyVertex(c));else if(0<a&&a<d)for(a=0;a<=d;a++)for(b=0;b<=d;b++)if(0===a||a===d||0===b||b===d)c=new JSM.Coord(b*p-k,a*q-m,e-n),l.AddVertex(new JSM.BodyVertex(c))}function h(a){var b,c,f,g,h,k;if(0===a||a===d){var m=e(a);for(b=0;b<d;b++)for(c=0;c<d;c++)f=m+b*(d+1)+c,g=f+1,h=f+d+1,k=h+1,0===a?l.AddPolygon(new JSM.BodyPolygon([f,h,k,g])):l.AddPolygon(new JSM.BodyPolygon([f,g,k,h]))}if(0<a&&a<=d){c=s[a-1];a=s[a];
for(b=0;b<4*d;b++)f=c[b],h=a[b],b<4*d-1?(g=c[b+1],k=a[b+1]):(g=c[0],k=a[0]),l.AddPolygon(new JSM.BodyPolygon([f,g,k,h]))}}var l=new JSM.Body,k=a/2,m=b/2,n=c/2,p=a/d,q=b/d,r=c/d;for(a=0;a<=d;a++)g(a);var s=[];for(a=0;a<=d;a++)s.push(f(a));for(a=0;a<=d;a++)h(a);return l};
JSM.GenerateCircle=function(a,b){var c=new JSM.Body,d=JSM.GenerateCirclePoints(a,b),e;for(e=0;e<d.length;e++)c.AddVertex(new JSM.BodyVertex(d[e]));d=new JSM.BodyPolygon([]);for(e=0;e<b;e++)d.AddVertexIndex(e);c.AddPolygon(d);c.SetCylindricalTextureProjection(new JSM.Coord(0,0,0),a,new JSM.Coord(1,0,0),new JSM.Coord(0,0,1));return c};
JSM.GenerateSphere=function(a,b,c){var d=new JSM.Body,e=2*b,f=d.AddVertex(new JSM.BodyVertex(JSM.SphericalToCartesian(a,0,0))),g=Math.PI/b,h=g,l,k,m;for(l=1;l<b;l++){for(k=m=0;k<e;k++)d.AddVertex(new JSM.BodyVertex(JSM.SphericalToCartesian(a,h,m))),m+=g;h+=g}a=d.AddVertex(new JSM.BodyVertex(JSM.SphericalToCartesian(-a,0,0)));var n,p;for(l=1;l<=b;l++)if(1===l){g=1;for(k=0;k<e;k++)h=g+k,m=h+1,k===e-1&&(m=g),h=new JSM.BodyPolygon([h,m,f]),c&&h.SetCurveGroup(0),d.AddPolygon(h)}else if(l<b){g=(l-1)*e+
1;for(k=0;k<e;k++)h=g+k,m=h+1,n=h-e,p=n+1,k===e-1&&(m=g,p=g-e),h=new JSM.BodyPolygon([h,m,p,n]),c&&h.SetCurveGroup(0),d.AddPolygon(h)}else if(l===b){g=(l-2)*e+1;for(k=0;k<e;k++)h=g+k,m=h+1,k===e-1&&(m=g),h=new JSM.BodyPolygon([h,a,m]),c&&h.SetCurveGroup(0),d.AddPolygon(h)}d.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return d};
JSM.GenerateTriangulatedSphere=function(a,b,c){var d;d=new JSM.Body;var e=(1+Math.sqrt(5))/2;JSM.AddVertexToBody(d,0,1,+e);JSM.AddVertexToBody(d,0,1,-e);JSM.AddVertexToBody(d,0,-1,+e);JSM.AddVertexToBody(d,0,-1,-e);JSM.AddVertexToBody(d,1,+e,0);JSM.AddVertexToBody(d,1,-e,0);JSM.AddVertexToBody(d,-1,+e,0);JSM.AddVertexToBody(d,-1,-e,0);JSM.AddVertexToBody(d,+e,0,1);JSM.AddVertexToBody(d,-e,0,1);JSM.AddVertexToBody(d,+e,0,-1);JSM.AddVertexToBody(d,-e,0,-1);JSM.AddPolygonToBody(d,[0,2,8]);JSM.AddPolygonToBody(d,
[0,4,6]);JSM.AddPolygonToBody(d,[0,6,9]);JSM.AddPolygonToBody(d,[0,8,4]);JSM.AddPolygonToBody(d,[0,9,2]);JSM.AddPolygonToBody(d,[1,3,11]);JSM.AddPolygonToBody(d,[1,4,10]);JSM.AddPolygonToBody(d,[1,6,4]);JSM.AddPolygonToBody(d,[1,10,3]);JSM.AddPolygonToBody(d,[1,11,6]);JSM.AddPolygonToBody(d,[2,5,8]);JSM.AddPolygonToBody(d,[2,7,5]);JSM.AddPolygonToBody(d,[2,9,7]);JSM.AddPolygonToBody(d,[3,5,7]);JSM.AddPolygonToBody(d,[3,7,11]);JSM.AddPolygonToBody(d,[3,10,5]);JSM.AddPolygonToBody(d,[4,8,10]);JSM.AddPolygonToBody(d,
[6,11,9]);JSM.AddPolygonToBody(d,[5,10,8]);JSM.AddPolygonToBody(d,[7,9,11]);for(var e=JSM.VectorLength(d.GetVertexPosition(0)),f=a/e,g,h,e=0;e<d.VertexCount();e++)h=d.GetVertex(e),h.SetPosition(JSM.VectorMultiply(h.GetPosition(),f));for(var l,k,m,n,f=0;f<b;f++){g=d;d=new JSM.Body;h=JSM.CalculateAdjacencyInfo(g);for(e=0;e<h.verts.length;e++)l=g.GetVertexPosition(e),JSM.AddVertexToBody(d,l.x,l.y,l.z);l=[];for(e=0;e<h.edges.length;e++)k=h.edges[e],k=JSM.MidCoord(g.GetVertexPosition(k.vert1),g.GetVertexPosition(k.vert2)),
k=JSM.VectorMultiply(JSM.VectorNormalize(k),a),l.push(d.AddVertex(new JSM.BodyVertex(k)));for(e=0;e<h.pgons.length;e++){k=h.pgons[e];m=[];for(g=0;g<k.pedges.length;g++)n=k.pedges[g],m.push(JSM.GetPolyEdgeStartVertex(n,h)),m.push(l[n.index]);JSM.AddPolygonToBody(d,[m[0],m[1],m[5]]);JSM.AddPolygonToBody(d,[m[1],m[2],m[3]]);JSM.AddPolygonToBody(d,[m[3],m[4],m[5]]);JSM.AddPolygonToBody(d,[m[1],m[3],m[5]])}}if(c)for(e=0;e<d.PolygonCount();e++)d.GetPolygon(e).SetCurveGroup(0);d.SetCubicTextureProjection(new JSM.Coord(0,
0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return d};
JSM.GenerateCylinder=function(a,b,c,d,e){var f=new JSM.Body,g=2*Math.PI,h=2*Math.PI/c,l;for(l=0;l<c;l++)f.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(a,b/2,g))),f.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(a,-b/2,g))),g-=h;for(l=0;l<c;l++)g=2*l,h=g+2,l===c-1&&(h=0),g=new JSM.BodyPolygon([g,h,h+1,g+1]),e&&g.SetCurveGroup(0),f.AddPolygon(g);if(d){d=new JSM.BodyPolygon([]);e=new JSM.BodyPolygon([]);for(l=0;l<c;l++)d.AddVertexIndex(2*(c-l-1)),e.AddVertexIndex(2*l+1);f.AddPolygon(d);
f.AddPolygon(e)}f.SetCylindricalTextureProjection(new JSM.Coord(0,0,-(b/2)),a,new JSM.Coord(1,0,0),new JSM.Coord(0,0,1));return f};
JSM.GeneratePie=function(a,b,c,d,e,f){var g=new JSM.Body,h=c,l=c/(d-1);g.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(0,b/2,0)));g.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(0,-b/2,0)));for(c=0;c<d;c++)g.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(a,b/2,h))),g.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(a,-b/2,h))),h-=l;for(c=0;c<=d;c++)h=2*c,l=h+2,c===d&&(l=0),h=new JSM.BodyPolygon([h,l,l+1,h+1]),f&&(0<c&&c<d)&&h.SetCurveGroup(0),g.AddPolygon(h);if(e){e=
new JSM.BodyPolygon([]);f=new JSM.BodyPolygon([]);for(c=0;c<=d;c++)e.AddVertexIndex(2*(d-c)),f.AddVertexIndex(2*c+1);g.AddPolygon(e);g.AddPolygon(f)}g.SetCylindricalTextureProjection(new JSM.Coord(0,0,-(b/2)),a,new JSM.Coord(1,0,0),new JSM.Coord(0,0,1));return g};
JSM.GenerateCone=function(a,b,c,d,e,f){var g=new JSM.Body,h=JSM.IsZero(a),l=JSM.IsZero(b),k=2*Math.PI,m=2*Math.PI/d;h&&g.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(0,c/2,0)));var n;for(n=0;n<d;n++)h||g.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(a,c/2,k))),l||g.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(b,-c/2,k))),k-=m;l&&g.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(0,-c/2,0)));for(n=0;n<d;n++)h?(k=n+1,m=k+1,n===d-1&&(m=1),k=new JSM.BodyPolygon([0,
m,k])):l?(k=n,m=k+1,n===d-1&&(m=0),k=new JSM.BodyPolygon([k,m,d])):(k=2*n,m=k+2,n===d-1&&(m=0),k=new JSM.BodyPolygon([k,m,m+1,k+1])),f&&k.SetCurveGroup(0),g.AddPolygon(k);if(e)if(h){f=new JSM.BodyPolygon([]);for(n=0;n<d;n++)f.AddVertexIndex(n+1);g.AddPolygon(f)}else if(l){e=new JSM.BodyPolygon([]);for(n=0;n<d;n++)e.AddVertexIndex(d-n-1);g.AddPolygon(e)}else{e=new JSM.BodyPolygon([]);f=new JSM.BodyPolygon([]);for(n=0;n<d;n++)e.AddVertexIndex(2*(d-n-1)),f.AddVertexIndex(2*n+1);g.AddPolygon(e);g.AddPolygon(f)}g.SetCylindricalTextureProjection(new JSM.Coord(0,
0,-(c/2)),(a+b)/2,new JSM.Coord(1,0,0),new JSM.Coord(0,0,1));return g};
JSM.GeneratePrism=function(a,b,c,d){var e=new JSM.Body,f=a.length,g;for(g=0;g<f;g++)e.AddVertex(new JSM.BodyVertex(a[g])),e.AddVertex(new JSM.BodyVertex(JSM.CoordOffset(a[g],b,c)));var h;for(g=0;g<f;g++)c=2*g,h=c+2,g===f-1&&(h=0),e.AddPolygon(new JSM.BodyPolygon([c,h,h+1,c+1]));if(d){d=new JSM.BodyPolygon([]);c=new JSM.BodyPolygon([]);for(g=0;g<f;g++)d.AddVertexIndex(2*g+1),c.AddVertexIndex(2*(f-g-1));e.AddPolygon(d);e.AddPolygon(c)}f=JSM.VectorNormalize(JSM.CoordSub(a[1],a[0]));a=new JSM.Coord(a[0].x,
a[0].y,a[0].z);b=JSM.VectorNormalize(b);f=JSM.VectorCross(b,f);g=JSM.VectorCross(f,b);e.SetCubicTextureProjection(a,g,f,b);return e};JSM.GenerateCurvedPrism=function(a,b,c,d,e){c=JSM.GeneratePrism(a,c,d,e);if(void 0===b||null===b||a.length!=b.length)return c;for(d=0;d<a.length;d++)e=b[d],c.GetPolygon(d).SetCurveGroup(e);return c};
JSM.GeneratePrismWithHole=function(a,b,c,d){function e(){var b=0,c=[],d;for(d=0;d<a.length;d++)null===a[d]&&(b+=1),c.push(d-b);var b=JSM.CreatePolygonWithHole(a),e=new JSM.Polygon,g;for(d=0;d<b.length;d++)g=a[b[d]],e.AddVertex(g.x,g.y,g.z);g=JSM.PolygonTriangulate(e);var h,l,x;for(d=0;d<g.length;d++){h=g[d];l=new JSM.BodyPolygon([]);x=new JSM.BodyPolygon([]);for(e=0;3>e;e++)l.AddVertexIndex(2*c[b[h[e]]]+1),x.AddVertexIndex(2*c[b[h[3-e-1]]]);f.AddPolygon(l);f.AddPolygon(x)}}var f=new JSM.Body;(function(){var d;
for(d=0;d<a.length;d++)null!==a[d]&&(f.AddVertex(new JSM.BodyVertex(a[d])),f.AddVertex(new JSM.BodyVertex(JSM.CoordOffset(a[d],b,c))))})();(function(){var b=0,c=[];c.push(0);var d;for(d=0;d<a.length;d++)null===a[d]&&(c.push(d-b),b+=1);c.push(d-b);for(b=0;b<c.length-1;b++){var e=d=void 0,g=void 0,h=c[b],l=c[b+1];for(d=h;d<l;d++)e=2*d,g=e+2,d===l-1&&(g=2*h),f.AddPolygon(new JSM.BodyPolygon([e,g,g+1,e+1]))}})();d&&e();var g=JSM.VectorNormalize(JSM.CoordSub(a[1],a[0]));d=new JSM.Coord(a[0].x,a[0].y,a[0].z);
var h=JSM.VectorNormalize(b),g=JSM.VectorCross(h,g),l=JSM.VectorCross(g,h);f.SetCubicTextureProjection(d,l,g,h);return f};JSM.GenerateCurvedPrismWithHole=function(a,b,c,d,e){c=JSM.GeneratePrismWithHole(a,c,d,e);if(void 0===b||null===b||a.length!=b.length)return c;d=0;var f;for(e=0;e<a.length;e++)f=b[e],null!==f&&(c.GetPolygon(d).SetCurveGroup(f),d++);return c};
JSM.GeneratePrismShell=function(a,b,c,d,e){var f=new JSM.Body,g=a.length,h;for(h=0;h<g;h++)f.AddVertex(new JSM.BodyVertex(a[h]));h=new JSM.Polygon;h.vertices=a;d=JSM.OffsetPolygonContour(h,d).vertices;for(h=0;h<g;h++)f.AddVertex(new JSM.BodyVertex(d[h]));var l;for(h=0;h<g;h++)l=JSM.CoordOffset(a[h],b,c),f.AddVertex(new JSM.BodyVertex(l));for(h=0;h<g;h++)l=JSM.CoordOffset(d[h],b,c),f.AddVertex(new JSM.BodyVertex(l));var k;for(h=0;h<g;h++)c=h,d=c+1,l=c+2*g,k=l+1,h===g-1&&(d=0,k=2*g),f.AddPolygon(new JSM.BodyPolygon([c,
d,k,l])),f.AddPolygon(new JSM.BodyPolygon([c+g,l+g,k+g,d+g]));if(e)for(h=0;h<g;h++)c=h,d=c+1,l=h+g,k=l+1,h===g-1&&(d=0,k=g),f.AddPolygon(new JSM.BodyPolygon([c,l,k,d])),f.AddPolygon(new JSM.BodyPolygon([c+2*g,d+2*g,k+2*g,l+2*g]));e=JSM.VectorNormalize(JSM.CoordSub(a[1],a[0]));a=new JSM.Coord(a[0].x,a[0].y,a[0].z);b=JSM.VectorNormalize(b);e=JSM.VectorCross(b,e);g=JSM.VectorCross(e,b);f.SetCubicTextureProjection(a,g,e,b);return f};
JSM.GenerateCylinderShell=function(a,b,c,d,e,f){for(var g=new JSM.Vector(0,0,1),h=-b/2,l=[],k=2*Math.PI/d,m,n=0,n=0;n<d;n++)m=n*k,m=JSM.PolarToCartesian(a,m),l.push(new JSM.Coord(m.x,m.y,h));a=JSM.GeneratePrismShell(l,g,b,c,e);if(f)for(f=0;f<d;f++)a.GetPolygon(2*f).SetCurveGroup(0),a.GetPolygon(2*f+1).SetCurveGroup(0);return a};
JSM.GenerateLineShell=function(a,b,c,d,e,f){var g=new JSM.Body,h=a.length,l=[],k,m,n,p,q,r;for(k=0;k<h;k++)0===k||k===h-1?q=Math.PI/2:(m=k-1,n=k,p=k+1,r=JSM.CoordSub(a[p],a[n]),q=JSM.CoordSub(a[m],a[n]),q=JSM.GetVectorsAngle(r,q)/2,"Clockwise"===JSM.CoordTurnType(a[m],a[n],a[p],b)&&(q=Math.PI-q)),l.push(q);r=new JSM.Vector(0,0,1);m=[];var s;for(k=0;k<h;k++)n=k,k===h-1?s=JSM.CoordSub(a[n-1],a[n]):(p=(k+1)%h,s=JSM.CoordSub(a[n],a[p])),q=l[n],p=d/Math.sin(q),p=JSM.CoordOffset(a[n],s,p),p=JSM.CoordRotate(p,
r,-(Math.PI-q),a[n]),m.push(p);for(k=0;k<h;k++)g.AddVertex(new JSM.BodyVertex(a[k]));for(k=0;k<h;k++)g.AddVertex(new JSM.BodyVertex(m[k]));for(k=0;k<h;k++)n=JSM.CoordOffset(a[k],b,c),g.AddVertex(new JSM.BodyVertex(n));for(k=0;k<h;k++)n=JSM.CoordOffset(m[k],b,c),g.AddVertex(new JSM.BodyVertex(n));for(k=0;k<h-1;k++)n=k,p=n+1,c=n+2*h,d=c+1,g.AddPolygon(new JSM.BodyPolygon([n,p,d,c])),g.AddPolygon(new JSM.BodyPolygon([n+h,c+h,d+h,p+h]));e&&(n=0,g.AddPolygon(new JSM.BodyPolygon([n,n+2*h,n+3*h,n+h])),n=
h-1,g.AddPolygon(new JSM.BodyPolygon([n,n+h,n+3*h,n+2*h])));if(f)for(k=0;k<h-1;k++)n=k,p=n+1,c=k+h,d=c+1,g.AddPolygon(new JSM.BodyPolygon([n,c,d,p])),g.AddPolygon(new JSM.BodyPolygon([n+2*h,p+2*h,d+2*h,c+2*h]));e=JSM.VectorNormalize(JSM.CoordSub(a[1],a[0]));a=new JSM.Coord(a[0].x,a[0].y,a[0].z);b=JSM.VectorNormalize(b);e=JSM.VectorCross(b,e);f=JSM.VectorCross(e,b);g.SetCubicTextureProjection(a,f,e,b);return g};
JSM.GenerateTorus=function(a,b,c,d,e){var f=new JSM.Body,g=0,h=2*Math.PI/d,l=[],k,m;for(k=0;k<d;k++)m=JSM.PolarToCartesian(b,g),m=new JSM.Coord(m.x+a,0,m.y),l.push(m),g+=h;b=new JSM.Coord(0,0,1);g=new JSM.Coord(0,0,0);h=2*Math.PI/c;for(k=0;k<c;k++)for(a=0;a<d;a++)m=JSM.CoordRotate(l[a],b,k*h,g),f.AddVertex(new JSM.BodyVertex(m));for(k=0;k<c;k++){new JSM.BodyPolygon([]);for(a=0;a<d;a++)h=k*d+a,b=h+d,l=h+1,g=b+1,a===d-1&&(l=k*d,g=(k+1)*d),k===c-1&&(b=a,g=a+1,a===d-1&&(g=0)),h=new JSM.BodyPolygon([h,
b,g,l]),e&&h.SetCurveGroup(0),f.AddPolygon(h)}f.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return f};
JSM.GeneratePolyTorus=function(a,b,c,d){var e=new JSM.Body,f=a.length,g=2*Math.PI/f,h=[],l;for(l=0;l<f;l++)g=a[l],g=new JSM.Coord(g.x+b,0,g.y),h.push(g);b=new JSM.Coord(0,0,1);var k=new JSM.Coord(0,0,0),g=2*Math.PI/c,m;for(l=0;l<c;l++)for(a=0;a<f;a++)m=JSM.CoordRotate(h[a],b,l*g,k),e.AddVertex(new JSM.BodyVertex(m));for(l=0;l<c;l++){new JSM.BodyPolygon([]);for(a=0;a<f;a++)h=l*f+a,b=h+f,g=h+1,k=b+1,a===f-1&&(g=l*f,k=(l+1)*f),l===c-1&&(b=a,k=a+1,a===f-1&&(k=0)),h=new JSM.BodyPolygon([h,b,k,g]),d&&h.SetCurveGroup(a),
e.AddPolygon(h)}e.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return e};
JSM.GenerateRuledFromSectors=function(a,b,c,d,e){var f=new JSM.Body,g=[],h=[];JSM.GetSectorSegmentation(a,c,g);JSM.GetSectorSegmentation(b,c,h);b=[];a=[];JSM.GetRuledMesh(g,h,d,b,a);for(d=0;d<b.length;d++)f.AddVertex(new JSM.BodyVertex(b[d]));for(d=0;d<a.length;d++)g=a[d],g=new JSM.BodyPolygon(g),e&&g.SetCurveGroup(0),f.AddPolygon(g);f.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return f};
JSM.GenerateGrid=function(a,b,c,d,e){var f=new JSM.Sector(new JSM.Coord(0,0,0),new JSM.Coord(a,0,0));a=new JSM.Sector(new JSM.Coord(0,b,0),new JSM.Coord(a,b,0));return JSM.GenerateRuledFromSectors(f,a,c,d,e)};JSM.GenerateSquareGrid=function(a,b,c){return JSM.GenerateGrid(a,a,b,b,c)};
JSM.GenerateRuledFromSectorsWithHeight=function(a,b,c,d,e,f){var g=new JSM.Body,h=[],l=[];JSM.GetSectorSegmentation(a,c,h);JSM.GetSectorSegmentation(b,c,l);b=[];a=[];JSM.GetRuledMesh(h,l,d,b,a);for(h=0;h<b.length;h++)g.AddVertex(new JSM.BodyVertex(b[h]));for(var k,h=0;h<a.length;h++)k=a[h],k=new JSM.BodyPolygon(k),e&&k.SetCurveGroup(0),g.AddPolygon(k);l=g.VertexCount();for(h=0;h<b.length;h++)k=b[h],k=new JSM.Coord(k.x,k.y,k.z),k.z-=f,g.AddVertex(new JSM.BodyVertex(k));for(h=0;h<a.length;h++){k=a[h];
b=[];for(f=k.length-1;0<=f;f--)b.push(k[f]+l);k=new JSM.BodyPolygon(b);e&&k.SetCurveGroup(0);g.AddPolygon(k)}for(h=0;h<d;h++)e=h+l,f=e+1,a=e-l,b=a+1,k=new JSM.BodyPolygon([e,f,b,a]),g.AddPolygon(k);for(h=0;h<d;h++)e=h+c*(d+1)+l,f=e+1,a=e-l,b=a+1,k=new JSM.BodyPolygon([e,a,b,f]),g.AddPolygon(k);for(h=0;h<c;h++)e=h*(d+1)+l,f=e+d+1,a=e-l,b=a+d+1,k=new JSM.BodyPolygon([e,a,b,f]),g.AddPolygon(k);for(h=0;h<c;h++)e=(h+1)*d+h+l,f=e+d+1,a=e-l,b=a+d+1,k=new JSM.BodyPolygon([e,f,b,a]),g.AddPolygon(k);g.SetCubicTextureProjection(new JSM.Coord(0,
0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return g};JSM.GenerateRuledFromCoords=function(a,b,c,d){var e=new JSM.Body,f=[],g=[];JSM.GetRuledMesh(a,b,c,f,g);for(a=0;a<f.length;a++)e.AddVertex(new JSM.BodyVertex(f[a]));for(a=0;a<g.length;a++)f=g[a],f=new JSM.BodyPolygon(f),d&&f.SetCurveGroup(0),e.AddPolygon(f);e.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return e};
JSM.GenerateRevolved=function(a,b,c,d,e,f){var g=new JSM.Body,h=JSM.IsEqual(c,2*Math.PI),l=a.length,k=c/d;c=JSM.CoordSub(b.end,b.beg);var m,n,p;for(m=0;m<l;m++)for(n=0;n<=d;n++)h&&n===d||(p=JSM.CoordRotate(a[m],c,n*k,b.beg),g.AddVertex(new JSM.BodyVertex(p)));var q,r;for(m=0;m<l-1;m++)for(n=0;n<d;n++)k=m*(d+1)+n,p=k+d+1,q=k+1,r=p+1,h&&(k=m*d+n,p=k+d,q=k+1,r=p+1,n===d-1&&(q=m*d,r=(m+1)*d)),k=new JSM.BodyPolygon([k,q,r,p]),f&&k.SetCurveGroup(m),g.AddPolygon(k);if(h&&e){e=new JSM.BodyPolygon([]);f=new JSM.BodyPolygon([]);
for(m=0;m<d;m++)e.AddVertexIndex(d*(l-1)+m),f.AddVertexIndex(d-m-1);g.AddPolygon(e);g.AddPolygon(f)}e=new JSM.Line(b.beg,JSM.VectorNormalize(c));for(m=d=0;m<l;m++)f=JSM.ProjectCoordToLine(a[m],e),d+=JSM.CoordDistance(f,a[m]);d/=l;b=new JSM.Coord(b.beg.x,b.beg.y,b.beg.z);l=JSM.VectorNormalize(c);c=new JSM.Line(b,c);c=JSM.ProjectCoordToLine(a[0],c);a=JSM.VectorNormalize(JSM.CoordSub(a[0],c));g.SetCylindricalTextureProjection(b,d,a,l);return g};
JSM.GenerateTube=function(a,b){var c=new JSM.Body,d=a.length,e=a[0].length,f,g;for(g=0;g<e;g++)for(f=0;f<d;f++)c.AddVertex(new JSM.BodyVertex(a[f][g]));var h,l;for(g=0;g<d-1;g++)for(f=0;f<e;f++)h=g+d*f,l=h+d,f===e-1&&(l=g),c.AddPolygon(new JSM.BodyPolygon([h,l,l+1,h+1]));if(b){g=new JSM.BodyPolygon([]);h=new JSM.BodyPolygon([]);for(f=0;f<e;f++)g.AddVertexIndex(d*f+d-1);for(f=e-1;0<=f;f--)h.AddVertexIndex(d*f);c.AddPolygon(g);c.AddPolygon(h)}c.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,
0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return c};JSM.GenerateFunctionSurface=function(a,b,c,d,e){var f=new JSM.Sector(new JSM.Coord(b.x,b.y,0),new JSM.Coord(c.x,b.y,0));b=new JSM.Sector(new JSM.Coord(b.x,c.y,0),new JSM.Coord(c.x,c.y,0));d=JSM.GenerateRuledFromSectors(f,b,d,d,e);for(e=0;e<d.VertexCount();e++)f=d.GetVertexPosition(e),f.z=a(f.x,f.y);d.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return d};
JSM.GenerateFunctionSurfaceSolid=function(a,b,c,d,e,f){var g=new JSM.Sector(new JSM.Coord(c.x,b.y,0),new JSM.Coord(b.x,b.y,0));b=new JSM.Sector(new JSM.Coord(c.x,c.y,0),new JSM.Coord(b.x,c.y,0));e=JSM.GenerateRuledFromSectorsWithHeight(g,b,d,d,e,f);g=(d+1)*(d+1);for(d=0;d<g;d++)f=e.GetVertexPosition(d),f.z=a(f.x,f.y);e.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return e};
JSM.Camera=function(a,b,c,d,e,f){this.eye=JSM.ValueOrDefault(a,new JSM.Coord(1,1,1));this.center=JSM.ValueOrDefault(b,new JSM.Coord(0,0,0));this.up=JSM.ValueOrDefault(c,new JSM.Vector(0,0,1));this.fieldOfView=JSM.ValueOrDefault(d,45);this.nearClippingPlane=JSM.ValueOrDefault(e,0.1);this.farClippingPlane=JSM.ValueOrDefault(f,1E3)};
JSM.Camera.prototype.Set=function(a,b,c,d,e,f){this.eye=a;this.center=b;this.up=c;this.fieldOfView=JSM.ValueOrDefault(d,45);this.nearClippingPlane=JSM.ValueOrDefault(e,0.1);this.farClippingPlane=JSM.ValueOrDefault(f,1E3)};JSM.Camera.prototype.Clone=function(){var a=new JSM.Camera;a.eye=this.eye;a.center=this.center;a.up=this.up;a.fieldOfView=this.fieldOfView;a.nearClippingPlane=this.nearClippingPlane;a.farClippingPlane=this.farClippingPlane;return a};
JSM.ExplodeBodyToTriangles=function(a,b,c){if(void 0===c||null===c)return!1;var d=JSM.CalculateBodyVertexNormals(a),e,f,g=!1;if(void 0!==b&&null!==b)for(e=0;e<b.Count();e++)if(null!==b.GetMaterial(e).texture){g=!0;break}var h,l;if(g){h=JSM.CalculateBodyTextureCoords(a);for(e=0;e<h.length;e++)if(f=a.GetPolygon(e),f.HasMaterialIndex()){l=b.GetMaterial(f.GetMaterialIndex());for(f=0;f<h[e].length;f++)h[e][f].x/=l.textureWidth,h[e][f].y/=-l.textureHeight}}var k=!0;void 0!==c.hasConvexPolygons&&null!==
c.hasConvexPolygons&&(k=c.hasConvexPolygons);(function(a,b,c,d,e){function f(h,l){var t=b.GetMaterial(l);if(void 0!==e.onGeometryStart&&null!==e.onGeometryStart)e.onGeometryStart(t);var x;for(x=0;x<h.length;x++){var s=h[x],v=a.GetPolygon(s),y=v.VertexIndexCount();if(!(3>y)){var D=void 0,A=void 0,B=void 0,K=void 0,L=void 0,M=void 0,w=void 0,G=void 0,N=void 0,E=void 0;if(3==y||k)for(E=0;E<y-2;E++){if(D=a.GetVertex(v.GetVertexIndex(0)).position,A=a.GetVertex(v.GetVertexIndex((E+1)%y)).position,B=a.GetVertex(v.GetVertexIndex((E+
2)%y)).position,K=c[s][0],L=c[s][(E+1)%y],M=c[s][(E+2)%y],N=G=w=null,g&&(w=d[s][0],G=d[s][(E+1)%y],N=d[s][(E+2)%y]),void 0!==e.onTriangle&&null!==e.onTriangle)e.onTriangle(D,A,B,K,L,M,w,G,N)}else{D=new JSM.Polygon;A=void 0;for(E=0;E<y;E++)A=a.GetVertex(v.vertices[E]),D.AddVertex(A.position.x,A.position.y,A.position.z);for(var E=JSM.CalculateBodyPolygonNormal(a,s),y=JSM.PolygonTriangulate(D,E),O=void 0,E=0;E<y.length;E++)if(O=y[E],D=a.GetVertex(v.GetVertexIndex(O[0])).position,A=a.GetVertex(v.GetVertexIndex(O[1])).position,
B=a.GetVertex(v.GetVertexIndex(O[2])).position,K=c[s][O[0]],L=c[s][O[1]],M=c[s][O[2]],N=G=w=null,g&&(w=d[s][O[0]],G=d[s][O[1]],N=d[s][O[2]]),void 0!==e.onTriangle&&null!==e.onTriangle)e.onTriangle(D,A,B,K,L,M,w,G,N)}}}if(void 0!==e.onGeometryEnd&&null!==e.onGeometryEnd)e.onGeometryEnd(t)}var h,l=[],t=[];if(void 0===b||null===b)b=new JSM.Materials;for(h=0;h<b.Count();h++)l[h]=[];var y;for(h=0;h<a.PolygonCount();h++)y=a.GetPolygon(h),y.HasMaterialIndex()?(y=y.GetMaterialIndex(),l[y].push(h)):t.push(h);
for(h=0;h<l.length;h++)y=l[h],0!==y.length&&f(y,h);0!==t.length&&f(t,-1)})(a,b,d,h,c);return!0};
JSM.ExportBodyContentToStl=function(a,b,c){function d(a){g+=a+"\n"}function e(a,b,c,e){d("\tfacet normal "+a.x+" "+a.y+" "+a.z);d("\t\touter loop");d("\t\t\tvertex "+b.x+" "+b.y+" "+b.z);d("\t\t\tvertex "+c.x+" "+c.y+" "+c.z);d("\t\t\tvertex "+e.x+" "+e.y+" "+e.z);d("\t\tendloop");d("\tendfacet")}function f(b){var d=a.GetPolygon(b),f=d.VertexIndexCount();if(!(3>f)){var g,n,p,q=null;if(3===f)q=JSM.CalculateBodyPolygonNormal(a,b),g=a.GetVertex(d.GetVertexIndex(0)).position,n=a.GetVertex(d.GetVertexIndex(1)).position,
p=a.GetVertex(d.GetVertexIndex(2)).position,e(q,g,n,p);else if(g=!0,void 0!==c&&c&&(g=!1),q=JSM.CalculateBodyPolygonNormal(a,b),g){g=new JSM.Polygon;for(b=0;b<f;b++)n=a.GetVertex(d.vertices[b]),g.AddVertex(n.position.x,n.position.y,n.position.z);f=JSM.PolygonTriangulate(g,q);for(b=0;b<f.length;b++)p=f[b],g=a.GetVertex(d.GetVertexIndex(p[0])).position,n=a.GetVertex(d.GetVertexIndex(p[1])).position,p=a.GetVertex(d.GetVertexIndex(p[2])).position,e(q,g,n,p)}else for(b=0;b<f-2;b++)g=a.GetVertex(d.GetVertexIndex(0)).position,
n=a.GetVertex(d.GetVertexIndex((b+1)%f)).position,p=a.GetVertex(d.GetVertexIndex((b+2)%f)).position,e(q,g,n,p)}}var g="";for(b=0;b<a.PolygonCount();b++)f(b);return g};JSM.ExportBodyToStl=function(a,b,c){a=""+("solid "+b+"\n")+JSM.ExportBodyContentToStl(a,b,c);return a+="endsolid "+b+"\n"};JSM.ExportModelToStl=function(a,b,c){var d;d=""+("solid "+b+"\n");var e,f;for(e=0;e<a.BodyCount();e++)f=a.GetBody(e),d+=JSM.ExportBodyContentToStl(f,b+(e+1).toString(),c);return d+("endsolid "+b+"\n")};
JSM.ExportBodyContentToObj=function(a,b,c){function d(b){b=a.GetVertex(b).position;g+="v "+b.x+" "+b.y+" "+b.z+"\n"}function e(b){b=JSM.CalculateBodyPolygonNormal(a,b);g+="vn "+b.x+" "+b.y+" "+b.z+"\n"}function f(d){var e=a.GetPolygon(d);g+="f ";var f;for(f=0;f<e.VertexIndexCount();f++){var h=b+e.GetVertexIndex(f)+1+"//"+(c+d+1)+" ";g+=h}g+="\n"}var g="",h;for(h=0;h<a.VertexCount();h++)d(h);for(h=0;h<a.PolygonCount();h++)e(h);for(h=0;h<a.PolygonCount();h++)f(h);return g};
JSM.ExportBodyToObj=function(a){return JSM.ExportBodyContentToObj(a,0,0)};JSM.ExportModelToObj=function(a){var b="",c=0,d=0,e,f;for(e=0;e<a.BodyCount();e++)f=a.GetBody(e),b+=JSM.ExportBodyContentToObj(f,c,d),c+=f.VertexCount(),d+=f.PolygonCount();return b};
JSM.ExportMaterialsToGdl=function(a){function b(a,b){var d=JSM.HexColorToRGBComponents(a.diffuse);c+='define material "material'+b+'" 2, '+(d[0]/255+","+d[1]/255+","+d[2]/255)+" ! "+b+"\n"}var c="",d=!1;void 0!==a&&null!==a&&(d=!0);if(d){b(a.GetDefaultMaterial(),1);for(d=0;d<a.Count();d++)b(a.GetMaterial(d),d+2)}return c};
JSM.ExportBodyGeometryToGdl=function(a,b){function c(a){if(200<a.length){var b=0,c,d;for(c=0;c<a.length;c++)d=a[c],h+=d,b++,200<b&&","==d&&(h+="\n",b=0)}else h+=a}function d(a){c(a+"\n")}function e(b){var c=a.GetVertex(b).position;d("vert "+c.x+", "+c.y+", "+c.z+" ! "+(b+1))}function f(b){var c=l.edges[b],e=0;-1!=c.pgon1&&-1!=c.pgon2&&a.GetPolygon(c.pgon1).HasCurveGroup()&&a.GetPolygon(c.pgon2).HasCurveGroup()&&a.GetPolygon(c.pgon1).GetCurveGroup()==a.GetPolygon(c.pgon2).GetCurveGroup()&&(e=2);d("edge "+
(c.vert1+1)+", "+(c.vert2+1)+", -1, -1, "+e+" ! "+(b+1))}function g(e,f){var g=-1;b&&(g=a.GetPolygon(e).GetMaterialIndex()+2,g!=f&&d('set material "material'+g+'"'));var h=l.pgons[e],k=0;a.GetPolygon(e).HasCurveGroup()&&(k=2);c("pgon "+h.pedges.length+", 0, "+k+", ");var k="",m,v;for(m=0;m<h.pedges.length;m++)v=h.pedges[m],k=v.reverse?k+-(v.index+1):k+(v.index+1),m<h.pedges.length-1&&(k+=", ");c(k);c(" ! "+(e+1));d("");return g}var h="";d("base");var l=JSM.CalculateAdjacencyInfo(a),k;for(k=0;k<l.verts.length;k++)e(k);
for(k=0;k<l.edges.length;k++)f(k);var m=-1;for(k=0;k<l.pgons.length;k++)m=g(k,m);d("body -1");return h};JSM.ExportBodyToGdl=function(a,b){var c="",d=!1;void 0!==b&&null!==b&&(c+=JSM.ExportMaterialsToGdl(b),d=!0);return c+=JSM.ExportBodyGeometryToGdl(a,d)};JSM.ExportModelToGdl=function(a,b){var c="",d=!1;void 0!==b&&null!==b&&(c+=JSM.ExportMaterialsToGdl(b),d=!0);var e,f;for(e=0;e<a.BodyCount();e++)f=a.GetBody(e),c+=JSM.ExportBodyGeometryToGdl(f,d);return c};
JSM.TriangleBody=function(a){this.name=a;this.vertices=[];this.normals=[];this.triangles=[]};JSM.TriangleBody.prototype.SetName=function(a){this.name=a};JSM.TriangleBody.prototype.GetName=function(){return this.name};JSM.TriangleBody.prototype.AddVertex=function(a,b,c){this.vertices.push(new JSM.Coord(a,b,c));return this.vertices.length-1};JSM.TriangleBody.prototype.GetVertex=function(a){return this.vertices[a]};
JSM.TriangleBody.prototype.SetVertex=function(a,b,c,d){this.vertices[a]=new JSM.Coord(b,c,d)};JSM.TriangleBody.prototype.VertexCount=function(){return this.vertices.length};JSM.TriangleBody.prototype.AddNormal=function(a,b,c){this.normals.push(new JSM.Coord(a,b,c));return this.normals.length-1};JSM.TriangleBody.prototype.GetNormal=function(a){return this.normals[a]};JSM.TriangleBody.prototype.NormalCount=function(){return this.normals.length};
JSM.TriangleBody.prototype.AddTriangle=function(a,b,c,d,e,f,g,h,l,k,m){this.triangles.push({v0:a,v1:b,v2:c,n0:d,n1:e,n2:f,u0:g,u1:h,u2:l,mat:k,curve:m});return this.triangles.length-1};JSM.TriangleBody.prototype.GetTriangle=function(a){return this.triangles[a]};JSM.TriangleBody.prototype.TriangleCount=function(){return this.triangles.length};
JSM.TriangleBody.prototype.Finalize=function(a){function b(b,c,d,f){function g(a,b,c,d,e){var f=new JSM.Vector(0,0,0),h=0;c=a.GetTriangle(c);b=e[b];var k,l;for(e=0;e<b.length;e++)k=b[e],l=a.GetTriangle(k),c.curve==l.curve&&(f=JSM.CoordAdd(f,d[k]),h+=1);f=JSM.VectorMultiply(f,1/h);f=JSM.VectorNormalize(f);return a.AddNormal(f.x,f.y,f.z)}var p=b.triangles[e];void 0===p.mat&&(p.mat=a.AddDefaultMaterial());if(void 0===p.n0||void 0===p.n1||void 0===p.n2)void 0===p.curve||0===p.curve?(c=d[e],b=b.AddNormal(c.x,
c.y,c.z),p.n0=b,p.n1=b,p.n2=b):(p.n0=g(b,p.v0,c,d,f),p.n1=g(b,p.v1,c,d,f),p.n2=g(b,p.v2,c,d,f))}var c=[],d={},e;for(e=0;e<this.vertices.length;e++)d[e]=[];var f,g;for(e=0;e<this.triangles.length;e++)f=this.triangles[e],g=JSM.CalculateTriangleNormal(this.vertices[f.v0],this.vertices[f.v1],this.vertices[f.v2]),c.push(g),d[f.v0].push(e),d[f.v1].push(e),d[f.v2].push(e);for(e=0;e<this.triangles.length;e++)b(this,e,c,d)};
JSM.TriangleBody.prototype.Clone=function(){var a=new JSM.TriangleBody(this.name),b,c;for(b=0;b<this.vertices.length;b++)a.vertices.push(this.vertices[b].Clone());for(b=0;b<this.normals.length;b++)a.normals.push(this.normals[b].Clone());for(b=0;b<this.triangles.length;b++)c=this.triangles[b],a.triangles.push({v0:c.v0,v1:c.v1,v2:c.v2,n0:c.n0,n1:c.n1,n2:c.n2,u0:c.u0,u1:c.u1,u2:c.u2,mat:c.mat,curve:c.curve});return a};
JSM.TriangleModel=function(){this.materials=[];this.bodies=[];this.defaultMaterial=-1};JSM.TriangleModel.prototype.AddMaterial=function(a,b,c,d,e){this.materials.push({name:a,ambient:b,diffuse:c,specular:d,opacity:e});return this.materials.length-1};JSM.TriangleModel.prototype.GetMaterial=function(a){return this.materials[a]};
JSM.TriangleModel.prototype.AddDefaultMaterial=function(){-1==this.defaultMaterial&&(this.materials.push({name:"Default",ambient:{r:0.5,g:0.5,b:0.5},diffuse:{r:0.5,g:0.5,b:0.5},specular:{r:0.1,g:0.1,b:0.1},opacity:1}),this.defaultMaterial=this.materials.length-1);return this.defaultMaterial};JSM.TriangleModel.prototype.GetDefaultMaterialIndex=function(){return this.AddDefaultMaterial()};JSM.TriangleModel.prototype.MaterialCount=function(){return this.materials.length};
JSM.TriangleModel.prototype.AddBody=function(a){this.bodies.push(a);return this.bodies.length-1};JSM.TriangleModel.prototype.AddBodyToIndex=function(a,b){this.bodies.splice(b,0,a);return b};JSM.TriangleModel.prototype.GetBody=function(a){return this.bodies[a]};JSM.TriangleModel.prototype.BodyCount=function(){return this.bodies.length};JSM.TriangleModel.prototype.GetBody=function(a){return this.bodies[a]};
JSM.TriangleModel.prototype.Finalize=function(){var a,b;for(a=0;a<this.bodies.length;a++)b=this.bodies[a],b.Finalize(this)};JSM.BinaryReader=function(a,b){this.arrayBuffer=a;this.dataView=new DataView(a);this.isLittleEndian=b;this.position=0};JSM.BinaryReader.prototype.GetPosition=function(){return this.position};JSM.BinaryReader.prototype.GetByteLength=function(){return this.arrayBuffer.byteLength};JSM.BinaryReader.prototype.Skip=function(a){this.position+=a};
JSM.BinaryReader.prototype.End=function(){return this.position>=this.arrayBuffer.byteLength};JSM.BinaryReader.prototype.ReadBoolean=function(){var a=this.dataView.getInt8(this.position,this.isLittleEndian);this.position+=1;return a?!0:!1};JSM.BinaryReader.prototype.ReadCharacter=function(){var a=this.dataView.getInt8(this.position,this.isLittleEndian);this.position+=1;return a};
JSM.BinaryReader.prototype.ReadUnsignedCharacter=function(){var a=this.dataView.getUint8(this.position,this.isLittleEndian);this.position+=1;return a};JSM.BinaryReader.prototype.ReadInteger16=function(){var a=this.dataView.getInt16(this.position,this.isLittleEndian);this.position+=2;return a};JSM.BinaryReader.prototype.ReadUnsignedInteger16=function(){var a=this.dataView.getUint16(this.position,this.isLittleEndian);this.position+=2;return a};
JSM.BinaryReader.prototype.ReadInteger32=function(){var a=this.dataView.getInt32(this.position,this.isLittleEndian);this.position+=4;return a};JSM.BinaryReader.prototype.ReadUnsignedInteger32=function(){var a=this.dataView.getUint32(this.position,this.isLittleEndian);this.position+=4;return a};JSM.BinaryReader.prototype.ReadFloat32=function(){var a=this.dataView.getFloat32(this.position,this.isLittleEndian);this.position+=4;return a};
JSM.BinaryReader.prototype.ReadDouble64=function(){var a=this.dataView.getFloat64(this.position,this.isLittleEndian);this.position+=8;return a};JSM.GetArrayBufferFromURL=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="arraybuffer";c.onload=function(){var a=c.response;a&&b(a)};c.send(null)};JSM.GetArrayBufferFromFile=function(a,b){var c=new FileReader;c.onloadend=function(a){a.target.readyState==FileReader.DONE&&b(a.target.result)};c.readAsArrayBuffer(a)};
JSM.GetStringBufferFromURL=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="text";c.onload=function(){var a=c.response;a&&b(a)};c.send(null)};JSM.LoadMultipleBuffers=function(a,b,c,d,e){c>=a.length?e(b):d(a[c],function(f){b.push(f);JSM.LoadMultipleBuffers(a,b,c+1,d,e)})};JSM.GetStringBufferFromFile=function(a,b){var c=new FileReader;c.onloadend=function(a){a.target.readyState==FileReader.DONE&&b(a.target.result)};c.readAsText(a)};
JSM.GetStringBuffersFromURLList=function(a,b){JSM.LoadMultipleBuffers(a,[],0,JSM.GetStringBufferFromURL,function(a){b(a)})};JSM.GetStringBuffersFromFileList=function(a,b){JSM.LoadMultipleBuffers(a,[],0,JSM.GetStringBufferFromFile,function(a){b(a)})};
JSM.ConvertTriangleModelToJsonData=function(a){function b(a,b,c){var d=[],e=a.MaterialCount(),f;for(a=0;a<b.VertexCount();a++)f=b.GetVertex(a),c.vertices.push(f.x,f.y,f.z);for(a=0;a<b.NormalCount();a++)f=b.GetNormal(a),c.normals.push(f.x,f.y,f.z);c.uvs.push(0,0);for(a=0;a<e;a++)d.push([]);for(a=0;a<b.TriangleCount();a++)f=b.GetTriangle(a),void 0===f.mat||(0>f.mat||f.mat>=e)||d[f.mat].push(a);var p,q;for(a=0;a<d.length;a++)if(p=d[a],0!==p.length){q={material:a,parameters:[]};for(e=0;e<p.length;e++)f=
b.GetTriangle(p[e]),q.parameters.push(f.v0,f.v1,f.v2,f.n0,f.n1,f.n2,0,0,0);c.triangles.push(q)}}var c={version:1,materials:[],meshes:[]};(function(a,b){var c,d;for(c=0;c<a.MaterialCount();c++)d=a.GetMaterial(c),b.push({name:d.name,ambient:[d.ambient.r,d.ambient.g,d.ambient.b],diffuse:[d.diffuse.r,d.diffuse.g,d.diffuse.b],specular:[d.specular.r,d.specular.g,d.specular.b],opacity:d.opacity})})(a,c.materials);var d,e,f;for(d=0;d<a.BodyCount();d++)e=a.GetBody(d),0!==e.TriangleCount()&&(f={name:e.GetName(),
vertices:[],normals:[],uvs:[],triangles:[]},b(a,e,f),c.meshes.push(f));return c};
JSM.MergeJsonDataMeshes=function(a){function b(a,b,c){function d(a,b,c){var h=b.material,l=c[h];void 0===l&&(a.triangles.push({material:h,parameters:[]}),l=a.triangles.length-1,c[h]=l);a=a.triangles[l].parameters;for(c=0;c<b.parameters.length;c+=9)a.push(b.parameters[c]+e,b.parameters[c+1]+e,b.parameters[c+2]+e,b.parameters[c+3]+f,b.parameters[c+4]+f,b.parameters[c+5]+f,b.parameters[c+6]+g,b.parameters[c+7]+g,b.parameters[c+8]+g)}var e=a.vertices.length/3,f=a.normals.length/3,g=a.uvs.length/2;(function(a,
b){var c;for(c=0;c<b.vertices.length;c++)a.vertices.push(b.vertices[c]);for(c=0;c<b.normals.length;c++)a.normals.push(b.normals[c]);for(c=0;c<b.uvs.length;c++)a.uvs.push(b.uvs[c])})(a,b);var r,s;for(r=0;r<b.triangles.length;r++)s=b.triangles[r],d(a,s,c)}var c={version:a.version,materials:a.materials,meshes:[]},d={name:"Merged",vertices:[],normals:[],uvs:[],triangles:[]},e={},f,g;for(f=0;f<a.meshes.length;f++)g=a.meshes[f],b(d,g,e);c.meshes.push(d);return c};
JSM.Read3dsFile=function(a,b){var c,d,e,f,g,h,l,k,m,n,p,q,r,s,x,v,t,y,F,C,u,H,z,I,J,D,A,B,K,L,M;function w(a,c){if(void 0!==b.onLog&&null!==b.onLog)b.onLog(a,c)}function G(a){for(var b="",c=0,d=0;64>d;){c=a.ReadCharacter();if(0===c)break;b+=String.fromCharCode(c);d+=1}return b}function N(a){var b=[],c;for(c=0;3>c;c++)b[c]=a.ReadFloat32();return b}function E(a,b,c){for(;a.GetPosition()<=b-6;){var d=a,e=c,f=d.ReadUnsignedInteger16(),d=d.ReadUnsignedInteger32();e(f,d)}}if(void 0===b||null===b)b={};c=
15677;d=45055;e=40960;f=40976;g=40992;h=41008;l=41024;k=41040;m=16;n=17;p=18;q=19;r=48;s=49;x=16384;v=16640;t=17920;y=18176;F=16656;C=16672;u=16736;H=16688;z=16720;I=45056;J=45058;D=45072;A=45075;B=45088;K=45089;L=45090;M=45104;(function(a){function P(a,b,c){var d={};b=a.GetPosition()+c-6;var e=!1;E(a,b,function(b,c){b==n?e||(d.r=a.ReadUnsignedCharacter()/255,d.g=a.ReadUnsignedCharacter()/255,d.b=a.ReadUnsignedCharacter()/255):b==p?(d.r=a.ReadUnsignedCharacter()/255,d.g=a.ReadUnsignedCharacter()/
255,d.b=a.ReadUnsignedCharacter()/255,e=!0):b==m?e||(d.r=a.ReadFloat32(),d.g=a.ReadFloat32(),d.b=a.ReadFloat32()):b==q?(d.r=a.ReadFloat32(),d.g=a.ReadFloat32(),d.b=a.ReadFloat32(),e=!0):a.Skip(c-6)});return d}function Q(a,b,c){var d=0;b=a.GetPosition()+c-6;E(a,b,function(b,c){b==r?d=a.ReadUnsignedInteger16()/100:b==s?d=a.ReadFloat32():a.Skip(c-6)});return d}function R(a,c,d){w("Read material chunk ("+c.toString(16)+", "+d+")",2);var m={},n=a.GetPosition()+d-6;E(a,n,function(b,n){b==e?(w("Read material name chunk ("+
c.toString(16)+", "+d+")",3),m.name=G(a)):b==f?(w("Read material ambient chunk ("+c.toString(16)+", "+d+")",3),m.ambient=P(a,b,n)):b==g?(w("Read material diffuse chunk ("+c.toString(16)+", "+d+")",3),m.diffuse=P(a,b,n)):b==h?(w("Read material specular chunk ("+c.toString(16)+", "+d+")",3),m.specular=P(a,b,n)):b==l?(w("Read material shininess chunk ("+c.toString(16)+", "+d+")",3),m.shininess=Q(a,b,n)):b==k?(w("Read material transparency chunk ("+c.toString(16)+", "+d+")",3),m.transparency=Q(a,b,n)):
(w("Skip chunk ("+b.toString(16)+", "+n+")",3),a.Skip(n-6))});if(void 0!==b.onMaterial&&null!==b.onMaterial)b.onMaterial(m)}function S(a,c,d){w("Read faces chunk ("+c.toString(16)+", "+d+")",4);c=a.GetPosition()+d-6;var e=a.ReadUnsignedInteger16(),f,g,h,l;for(d=0;d<e;d++)if(f=a.ReadUnsignedInteger16(),g=a.ReadUnsignedInteger16(),h=a.ReadUnsignedInteger16(),l=a.ReadUnsignedInteger16(),void 0!==b.onFace&&null!==b.onFace)b.onFace(f,g,h,l);E(a,c,function(c,d){if(c==H){w("Read face materials chunk ("+
c.toString(16)+", "+d+")",5);var f=G(a),g=a.ReadUnsignedInteger16(),h,l;for(h=0;h<g;h++)if(l=a.ReadUnsignedInteger16(),void 0!==b.onFaceMaterial&&null!==b.onFaceMaterial)b.onFaceMaterial(l,f)}else if(c==z){w("Read face smoothing groups chunk ("+c.toString(16)+", "+d+")",5);for(f=0;f<e;f++)if(g=a.ReadUnsignedInteger32(),void 0!==b.onFaceSmoothingGroup&&null!==b.onFaceSmoothingGroup)b.onFaceSmoothingGroup(f,g)}else w("Skip chunk ("+c.toString(16)+", "+d+")",5),a.Skip(d-6)})}function T(a,c,d,e){w("Read mesh chunk ("+
c+", "+d.toString(16)+", "+e+")",3);if(void 0!==b.onMesh&&null!==b.onMesh)b.onMesh(c);c=a.GetPosition()+e-6;E(a,c,function(c,d){if(c==F){w("Read vertices chunk ("+c.toString(16)+", "+d+")",4);var e=a.ReadUnsignedInteger16(),f,g,h,l;for(f=0;f<e;f++)if(g=a.ReadFloat32(),h=a.ReadFloat32(),l=a.ReadFloat32(),void 0!==b.onVertex&&null!==b.onVertex)b.onVertex(g,h,l)}else if(c==C)S(a,c,d);else if(c==u){w("Read transformation chunk ("+c.toString(16)+", "+d+")",4);e=[];for(f=0;4>f;f++){for(g=0;3>g;g++)e.push(a.ReadFloat32());
3>f?e.push(0):e.push(1)}if(void 0!==b.onTransformation&&null!==b.onTransformation)b.onTransformation(e)}else w("Skip chunk ("+c.toString(16)+", "+d+")",4),a.Skip(d-6)})}function U(a,b,c){w("Read object chunk ("+b.toString(16)+", "+c+")",2);b=a.GetPosition()+c-6;var d=G(a);E(a,b,function(b,c){b==v?T(a,d,b,c):(b==t?w("Skip light chunk ("+d+", "+b.toString(16)+", "+c+")",3):b==y?w("Skip camera chunk ("+d+", "+b.toString(16)+", "+c+")",3):w("Skip chunk ("+b.toString(16)+", "+c+")",3),a.Skip(c-6))})}function V(a,
b,c){w("Read editor chunk ("+b.toString(16)+", "+c+")",1);b=a.GetPosition()+c-6;E(a,b,function(b,c){b==d?R(a,b,c):b==x?U(a,b,c):(w("Skip chunk ("+b.toString(16)+", "+c+")",2),a.Skip(c-6))})}function W(a,c,d){function e(a,b){var c=[];a.Skip(10);var d,f,g,h=a.ReadInteger32();for(d=0;d<h;d++)a.ReadInteger32(),f=a.ReadUnsignedInteger16(),0!==f&&a.ReadFloat32(),b==K?(g=a.ReadFloat32(),f=N(a),f[3]=g):f=N(a),c.push(f);return c}w("Read object node chunk ("+c.toString(16)+", "+d+")",2);var f={name:"",nodeId:-1,
flags:-1,userId:-1,pivot:[0,0,0],positions:[],rotations:[],scales:[]};c=a.GetPosition()+d-6;E(a,c,function(b,c){b==D?(f.name=G(a),f.flags=a.ReadUnsignedInteger32(),f.userId=a.ReadUnsignedInteger16()):b==A?f.pivot=N(a):b==B?f.positions=e(a,B):b==K?f.rotations=e(a,K):b==L?f.scales=e(a,L):b==M?f.nodeId=a.ReadUnsignedInteger16():(w("Skip chunk ("+b.toString(16)+", "+c+")",3),a.Skip(c-6))});if(void 0!==b.onObjectNode&&null!==b.onObjectNode)b.onObjectNode(f)}function X(a,b,c){w("Read keyframe chunk ("+
b.toString(16)+", "+c+")",1);b=a.GetPosition()+c-6;E(a,b,function(b,c){b==J?W(a,b,c):(w("Skip chunk ("+b.toString(16)+", "+c+")",2),a.Skip(c-6))})}function Y(a,b,d){w("Read main chunk ("+b.toString(16)+", "+d+")",0);b=a.GetPosition()+d-6;E(a,b,function(b,d){b==c?V(a,b,d):b==I?X(a,b,d):(w("Skip chunk ("+b.toString(16)+", "+d+")",1),a.Skip(d-6))})}var Z=a.GetByteLength();E(a,Z,function(b,c){19789==b?Y(a,b,c):(w("Skip chunk ("+b.toString(16)+", "+c+")",0),a.Skip(c-6))})})(new JSM.BinaryReader(a,!0))};
JSM.Convert3dsToJsonData=function(a){var b=new JSM.TriangleModel,c=null,d={},e={},f={nodes:[],nodeIdToIndex:{}};JSM.Read3dsFile(a,{onMaterial:function(a){function c(a){return void 0===a||null===a?{r:0,g:0,b:0}:a}var e=b.AddMaterial(a.name,c(a.ambient),c(a.diffuse),c(a.specular),void 0===a.transparency||null===a.transparency?1:1-a.transparency);void 0===d[a.name]&&(d[a.name]=e)},onMesh:function(a){var d=b.AddBody(new JSM.TriangleBody(a));c=b.GetBody(d);c.meshData={faceToMaterial:{},faceToSmoothingGroup:{},
objectNodes:[],transformation:null};e[a]=d},onTransformation:function(a){null!==c&&(c.meshData.transformation=a)},onObjectNode:function(a){var c=f.nodes.length;f.nodes.push(a);f.nodeIdToIndex[a.nodeId]=c;a=e[a.name];void 0!==a&&b.GetBody(a).meshData.objectNodes.push(c)},onVertex:function(a,b,d){null!==c&&c.AddVertex(a,b,d)},onFace:function(a,b,d){null!==c&&c.AddTriangle(a,b,d)},onFaceMaterial:function(a,b){null!==c&&(c.meshData.faceToMaterial[a]=b)},onFaceSmoothingGroup:function(a,b){null!==c&&(c.meshData.faceToSmoothingGroup[a]=
b)}});(function(a,b,c){function d(a,b,c){function e(a,b){var c=b[0],d=b[1],f=b[2],g;for(g=0;4>g;g++)a[0+g]*=c,a[4+g]*=d,a[8+g]*=f;return a}function f(a,b){var c=b[0],d=b[1],e=b[2],g;for(g=0;3>g;g++)a[12+g]+=a[0+g]*c+a[4+g]*d+a[8+g]*e;return a}function g(a,b){var c,d;for(c=0;c<a.VertexCount();c++)d=a.GetVertex(c),d=JSM.ApplyTransformation(b,d),a.SetVertex(c,d.x,d.y,d.z)}function h(a,b,c){var d=JSM.MatrixDeterminant(b);JSM.IsNegative(d)&&(b=JSM.MatrixClone(b),e(b,[-1,1,1]),c=JSM.MatrixMultiply(c,b),
g(a,c))}function l(a,b){if(void 0!==a.matrix)return a.matrix;var c=JSM.MatrixIdentity(),d;d=0===a.positions.length?[0,0,0]:a.positions[0];c=f(c,d);if(0===a.rotations.length)d=[0,0,0,0];else{d=a.rotations[0];var g=[0,0,0,1],h=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);JSM.IsPositive(h)&&(g=-0.5*d[3],h=Math.sin(g)/h,g=[h*d[0],h*d[1],h*d[2],Math.cos(g)]);d=g}d=JSM.MatrixRotationQuaternion(d);c=JSM.MatrixMultiply(d,c);d=0===a.scales.length?[0,0,0,0]:a.scales[0];c=e(c,d);65535!=a.userId&&(d=b.nodeIdToIndex[a.userId],
void 0!==d&&(d=l(b.nodes[d],b),c=JSM.MatrixMultiply(c,d)));return a.matrix=c}var k=a.meshData;k=void 0===k||null===k?null:k.transformation;if(null!==k){var m=null,m=null!==b?l(b,c):k;c=JSM.MatrixClone(m);m=JSM.MatrixClone(k);k=JSM.MatrixInvert(m);null!==k&&(h(a,m,k),b=void 0===b||null===b?[0,0,0]:b.pivot,f(c,[-b[0],-b[1],-b[2]]),b=JSM.MatrixMultiply(k,c),g(a,b))}}function e(a,b,c,f){d(a,b,f);b=a.meshData;var g,h;for(f=0;f<a.TriangleCount();f++)g=a.GetTriangle(f),h=b.faceToMaterial[f],void 0!==h&&
(h=c[h],void 0!==h&&(g.mat=h)),h=b.faceToSmoothingGroup[f],void 0!==h&&(g.curve=h)}function f(a,b,c,d){b=b.Clone();b.SetName(b.GetName()+" ("+d+")");c<a.BodyCount()?a.AddBodyToIndex(b,c):a.AddBody(b);return b}var p,q,r,s,x,v,t;for(p=0;p<b.BodyCount();p++)if(r=b.GetBody(p),s=r.meshData,0===s.objectNodes.length)e(r,null,c,a);else{v=a.nodes[s.objectNodes[0]];for(q=1;q<s.objectNodes.length;q++)x=a.nodes[s.objectNodes[q]],t=f(b,r,p+1,q+1),t.meshData=r.meshData,e(t,x,c,a),p+=1;e(r,v,c,a)}})(f,b,d);b.Finalize();
return JSM.ConvertTriangleModelToJsonData(b)};
JSM.ReadObjFile=function(a,b){function c(a){a=a.split("\n");var e,f;for(e=0;e<a.length;e++){var g=f=a[e].trim();if(0!==g.length&&"#"!=g[0]&&(f=g.split(/\s+/),!(0===f.length||"#"==f[0][0]))){var h=void 0,h=void 0;if("g"==f[0]){if(!(2>f.length)){g="";for(h=1;h<f.length;h++)g+=f[h],h<f.length-1&&(g+=" ");if(void 0!==b.onMesh&&null!==b.onMesh)b.onMesh(g)}}else if("v"==f[0]){if(!(4>f.length)&&(h=parseFloat(f[1]),g=parseFloat(f[2]),f=parseFloat(f[3]),void 0!==b.onVertex&&null!==b.onVertex))b.onVertex(h,
g,f)}else if("vn"==f[0]){if(!(4>f.length)&&(h=parseFloat(f[1]),g=parseFloat(f[2]),f=parseFloat(f[3]),void 0!==b.onNormal&&null!==b.onNormal))b.onNormal(h,g,f)}else if("f"==f[0]){if(!(4>f.length)){for(var g=[],l=[],k=void 0,h=1;h<f.length;h++)k=f[h].split("/"),g.push(parseInt(k[0],10)-1),2<k.length&&0<k[2].length&&l.push(parseInt(k[2],10)-1);if(void 0!==b.onFace&&null!==b.onFace)b.onFace(g,l)}}else if("usemtl"==f[0]){if(!(2>f.length)&&void 0!==b.onUseMaterial&&null!==b.onUseMaterial)b.onUseMaterial(f[1])}else if("newmtl"==
f[0]){if(!(2>f.length)&&void 0!==b.onNewMaterial&&null!==b.onNewMaterial)b.onNewMaterial(f[1])}else if("Ka"==f[0]||"Kd"==f[0]||"Ks"==f[0]){if(!(4>f.length)&&(h=parseFloat(f[1]),g=parseFloat(f[2]),l=parseFloat(f[3]),void 0!==b.onMaterialComponent&&null!==b.onMaterialComponent))b.onMaterialComponent(f[0],h,g,l)}else if("Ka"==f[0]||"Kd"==f[0]||"Ks"==f[0]){if(!(4>f.length)&&(h=parseFloat(f[1]),g=parseFloat(f[2]),l=parseFloat(f[3]),void 0!==b.onMaterialComponent&&null!==b.onMaterialComponent))b.onMaterialComponent(f[0],
h,g,l)}else"mtllib"==f[0]&&!(2>f.length)&&(f=g.indexOf("mtllib")+6,h=g.substr(f,g.length-f).trim(),f=h.trim(),f=void 0!==b.onFileRequested&&null!==b.onFileRequested?b.onFileRequested(f):null,null!==f&&c(f))}}}c(a)};
JSM.ConvertObjToJsonData=function(a,b){var c=new JSM.TriangleModel,d=c.AddBody(new JSM.TriangleBody("Default")),e=c.GetBody(d),f={},g=null,h=null,l=[],k=[];JSM.ReadObjFile(a,{onNewMaterial:function(a){var b=c.AddMaterial(a,{r:1,g:0,b:0},{r:1,g:0,b:0},{r:0,g:0,b:0},1);g=c.GetMaterial(b);f[a]=b},onMaterialComponent:function(a,b,c,d){null!==g&&("Ka"==a?(a=g.ambient,a.r=b,a.g=c,a.b=d):"Kd"==a?(a=g.diffuse,a.r=b,a.g=c,a.b=d):"Ks"==a&&(a=g.specular,a.r=b,a.g=c,a.b=d))},onUseMaterial:function(a){a=f[a];
void 0!==a&&(h=a)},onMesh:function(a){a=c.AddBody(new JSM.TriangleBody(a));e=c.GetBody(a)},onVertex:function(a,b,c){l.push(new JSM.Coord(a,b,c))},onNormal:function(a,b,c){k.push(new JSM.Coord(a,b,c))},onFace:function(a,b){var c,d,f=a.length==b.length,g=a.length;for(c=0;c<g-2;c++)d=e.AddTriangle(a[0],a[(c+1)%g],a[(c+2)%g]),d=e.GetTriangle(d),f&&(d.n0=b[0],d.n1=b[(c+1)%g],d.n2=b[(c+2)%g]),null!==h&&(d.mat=h)},onFileRequested:function(a){return void 0!==b.onFileRequested&&null!==b.onFileRequested?b.onFileRequested(a):
null}});(function(a,b,c){function d(a,b,c,e,f){if(void 0!==c){var g=e[c];if(void 0!==g)return g;b=b[c];0===f?g=a.AddVertex(b.x,b.y,b.z):1===f&&(g=a.AddNormal(b.x,b.y,b.z));return e[c]=g}}var e,f,g,h,l,k;for(e=0;e<a.BodyCount();e++){g=a.GetBody(e);l={};k={};for(f=0;f<g.TriangleCount();f++)h=g.GetTriangle(f),h.v0=d(g,b,h.v0,l,0),h.v1=d(g,b,h.v1,l,0),h.v2=d(g,b,h.v2,l,0),h.n0=d(g,c,h.n0,k,1),h.n1=d(g,c,h.n1,k,1),h.n2=d(g,c,h.n2,k,1)}})(c,l,k);c.Finalize();return JSM.ConvertTriangleModelToJsonData(c)};
JSM.ReadBinaryStlFile=function(a,b){function c(a){var b=[],c;for(c=0;3>c;c++)b[c]=a.ReadFloat32();return b}var d=new JSM.BinaryReader(a,!0);d.Skip(80);var e=d.ReadUnsignedInteger32(),f,g,h,l,k;for(f=0;f<e;f++)if(k=c(d),g=c(d),h=c(d),l=c(d),d.Skip(2),void 0!==b.onFace&&null!==b.onFace)b.onFace(g,h,l,k)};
JSM.ReadAsciiStlFile=function(a,b){function c(a,c){var d=a[c].trim();if(0===d.length)return c+1;d=d.split(/\s+/);if(0===d.length)return c+1;if("solid"!=d[0]&&"facet"==d[0]&&"normal"==d[1]){if(5>d.length)return-1;var d=[parseFloat(d[2]),parseFloat(d[3]),parseFloat(d[4])],e=[],k,m;for(k=c+1;k<a.length&&3>e.length;k++)if(m=a[k].trim(),0!==m.length&&(m=m.split(/\s+/),0!==m.length&&"vertex"==m[0]))if(4>m.length)break;else m=[parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3])],e.push(m);k+=1;if(3!=e.length)return-1;
if(void 0!==b.onFace&&null!==b.onFace)b.onFace(e[0],e[1],e[2],d);return k}return c+1}for(var d=0,e=a.split("\n");d<e.length&&-1!=d;)d=c(e,d)};
JSM.ConvertStlToJsonData=function(a){var b=new JSM.TriangleModel,c=b.AddBody(new JSM.TriangleBody("Default")),d=b.GetBody(c);(function(a){var b=a.byteLength;if(84>b)return!1;a=new JSM.BinaryReader(a,!0);a.Skip(80);a=a.ReadUnsignedInteger32();return b!=50*a+84?!1:!0})(a)?JSM.ReadBinaryStlFile(a,{onFace:function(a,b,c,h){a=d.AddVertex(a[0],a[1],a[2]);b=d.AddVertex(b[0],b[1],b[2]);c=d.AddVertex(c[0],c[1],c[2]);h=JSM.VectorNormalize(new JSM.Vector(h[0],h[1],h[2]));h=d.AddNormal(h.x,h.y,h.z);d.AddTriangle(a,
b,c,h,h,h)}}):(a=String.fromCharCode.apply(null,new Uint8Array(a)),JSM.ReadAsciiStlFile(a,{onFace:function(a,b,c,h){a=d.AddVertex(a[0],a[1],a[2]);b=d.AddVertex(b[0],b[1],b[2]);c=d.AddVertex(c[0],c[1],c[2]);h=JSM.VectorNormalize(new JSM.Vector(h[0],h[1],h[2]));h=d.AddNormal(h.x,h.y,h.z);d.AddTriangle(a,b,c,h,h,h)}}));b.Finalize();return JSM.ConvertTriangleModelToJsonData(b)};JSM.ImportFileList=function(){this.descriptors=null};
JSM.ImportFileList.prototype.Init=function(a){this.descriptors=[];var b,c;for(b=0;b<a.length;b++)c=a[b],c={originalObject:c,originalFileName:c.name,fileName:c.name.toUpperCase(),extension:this.GetFileExtension(c.name)},this.descriptors.push(c)};JSM.ImportFileList.prototype.GetFileDescriptor=function(a){return this.descriptors[a]};
JSM.ImportFileList.prototype.GetMainFileIndex=function(a){var b;for(a=0;a<this.descriptors.length;a++)if(b=this.descriptors[a],this.IsSupportedExtension(b.extension))return a;return-1};JSM.ImportFileList.prototype.GetFileIndexByName=function(a){var b,c;for(b=0;b<this.descriptors.length;b++)if(c=this.descriptors[b],c.fileName==a.toUpperCase())return b;return-1};JSM.ImportFileList.prototype.IsSupportedExtension=function(a){return".3DS"==a||".OBJ"==a||".STL"==a?!0:!1};
JSM.ImportFileList.prototype.GetFileExtension=function(a){var b=a.lastIndexOf(".");if(-1==b)return"";a=a.substr(b);return a=a.toUpperCase()};
JSM.ConvertFileListToJsonData=function(a,b){function c(a,c){if(void 0!==b.onReady&&null!==b.onReady)b.onReady(a,c)}var d=new JSM.ImportFileList;d.Init(a);var e=d.GetMainFileIndex();if(-1===e){if(void 0!==b.onError&&null!==b.onError)b.onError()}else{var f=d.GetFileDescriptor(e),g={main:f.originalFileName,requested:[],missing:[]};".3DS"==f.extension?JSM.GetArrayBufferFromFile(f.originalObject,function(a){a=JSM.Convert3dsToJsonData(a);c(g,a)}):".OBJ"==f.extension?JSM.GetStringBuffersFromFileList(a,function(a){var b=
JSM.ConvertObjToJsonData(a[e],{onFileRequested:function(b){var c=d.GetFileIndexByName(b);if(-1==c)return g.missing.push(b),null;g.requested.push(b);return a[c]}});c(g,b)}):".STL"==f.extension&&JSM.GetArrayBufferFromFile(f.originalObject,function(a){a=JSM.ConvertStlToJsonData(a);c(g,a)})}};
JSM.GenerateSolidWithRadius=function(a,b){var c=new JSM.Body,d=!0;"Tetrahedron"===a?c=JSM.GenerateTetrahedron():"Hexahedron"===a?c=JSM.GenerateHexahedron():"Octahedron"===a?c=JSM.GenerateOctahedron():"Dodecahedron"===a?c=JSM.GenerateDodecahedron():"Icosahedron"===a?c=JSM.GenerateIcosahedron():"TruncatedTetrahedron"===a?c=JSM.GenerateTruncatedTetrahedron():"Cuboctahedron"===a?c=JSM.GenerateCuboctahedron():"TruncatedCube"===a?c=JSM.GenerateTruncatedCube():"TruncatedOctahedron"===a?c=JSM.GenerateTruncatedOctahedron():
"Rhombicuboctahedron"===a?c=JSM.GenerateRhombicuboctahedron():"TruncatedCuboctahedron"===a?c=JSM.GenerateTruncatedCuboctahedron():"SnubCube"===a?c=JSM.GenerateSnubCube():"Icosidodecahedron"===a?c=JSM.GenerateIcosidodecahedron():"TruncatedDodecahedron"===a?c=JSM.GenerateTruncatedDodecahedron():"TruncatedIcosahedron"===a?c=JSM.GenerateTruncatedIcosahedron():"Rhombicosidodecahedron"===a?c=JSM.GenerateRhombicosidodecahedron():"TruncatedIcosidodecahedron"===a?c=JSM.GenerateTruncatedIcosidodecahedron():
"SnubDodecahedron"===a?c=JSM.GenerateSnubDodecahedron():"TetrakisHexahedron"===a?(c=JSM.GenerateTetrakisHexahedron(),d=!1):"RhombicDodecahedron"===a?(c=JSM.GenerateRhombicDodecahedron(),d=!1):"PentakisDodecahedron"===a?(c=JSM.GeneratePentakisDodecahedron(),d=!1):"SmallStellatedDodecahedron"===a?(c=JSM.GenerateSmallStellatedDodecahedron(),d=!1):"GreatDodecahedron"===a?(c=JSM.GenerateGreatDodecahedron(),d=!1):"SmallTriambicIcosahedron"===a?(c=JSM.GenerateSmallTriambicIcosahedron(),d=!1):"GreatStellatedDodecahedron"===
a?(c=JSM.GenerateGreatStellatedDodecahedron(),d=!1):"SmallTriakisOctahedron"===a?(c=JSM.GenerateSmallTriakisOctahedron(),d=!1):"StellaOctangula"===a?(c=JSM.GenerateStellaOctangula(),d=!1):"TriakisTetrahedron"===a&&(c=JSM.GenerateTriakisTetrahedron(),d=!1);if(0<c.VertexCount()){var e=0;if(d)e=JSM.VectorLength(c.GetVertexPosition(0));else for(var f,d=0;d<c.VertexCount();d++)f=JSM.VectorLength(c.GetVertexPosition(d)),JSM.IsGreater(f,e)&&(e=f);e=b/e;for(d=0;d<c.VertexCount();d++)f=c.GetVertex(d),f.SetPosition(JSM.VectorMultiply(f.GetPosition(),
e))}return c};JSM.GenerateTetrahedron=function(){var a=new JSM.Body;a.AddVertex(new JSM.BodyVertex(new JSM.Coord(1,1,1)));a.AddVertex(new JSM.BodyVertex(new JSM.Coord(-1,-1,1)));a.AddVertex(new JSM.BodyVertex(new JSM.Coord(-1,1,-1)));a.AddVertex(new JSM.BodyVertex(new JSM.Coord(1,-1,-1)));a.AddPolygon(new JSM.BodyPolygon([0,1,3]));a.AddPolygon(new JSM.BodyPolygon([0,2,1]));a.AddPolygon(new JSM.BodyPolygon([0,3,2]));a.AddPolygon(new JSM.BodyPolygon([1,2,3]));return a};
JSM.GenerateHexahedron=function(){var a=new JSM.Body;JSM.AddVertexToBody(a,1,1,1);JSM.AddVertexToBody(a,1,1,-1);JSM.AddVertexToBody(a,1,-1,1);JSM.AddVertexToBody(a,-1,1,1);JSM.AddVertexToBody(a,1,-1,-1);JSM.AddVertexToBody(a,-1,1,-1);JSM.AddVertexToBody(a,-1,-1,1);JSM.AddVertexToBody(a,-1,-1,-1);JSM.AddPolygonToBody(a,[0,1,5,3]);JSM.AddPolygonToBody(a,[0,2,4,1]);JSM.AddPolygonToBody(a,[0,3,6,2]);JSM.AddPolygonToBody(a,[1,4,7,5]);JSM.AddPolygonToBody(a,[2,6,7,4]);JSM.AddPolygonToBody(a,[3,5,7,6]);
return a};JSM.GenerateOctahedron=function(){var a=new JSM.Body;JSM.AddVertexToBody(a,1,0,0);JSM.AddVertexToBody(a,-1,0,0);JSM.AddVertexToBody(a,0,1,0);JSM.AddVertexToBody(a,0,-1,0);JSM.AddVertexToBody(a,0,0,1);JSM.AddVertexToBody(a,0,0,-1);JSM.AddPolygonToBody(a,[0,2,4]);JSM.AddPolygonToBody(a,[0,3,5]);JSM.AddPolygonToBody(a,[0,4,3]);JSM.AddPolygonToBody(a,[0,5,2]);JSM.AddPolygonToBody(a,[1,2,5]);JSM.AddPolygonToBody(a,[1,3,4]);JSM.AddPolygonToBody(a,[1,4,2]);JSM.AddPolygonToBody(a,[1,5,3]);return a};
JSM.GenerateDodecahedron=function(){var a=new JSM.Body,b=(1+Math.sqrt(5))/2,c=1/b;JSM.AddVertexToBody(a,1,1,1);JSM.AddVertexToBody(a,1,1,-1);JSM.AddVertexToBody(a,1,-1,1);JSM.AddVertexToBody(a,-1,1,1);JSM.AddVertexToBody(a,1,-1,-1);JSM.AddVertexToBody(a,-1,1,-1);JSM.AddVertexToBody(a,-1,-1,1);JSM.AddVertexToBody(a,-1,-1,-1);JSM.AddVertexToBody(a,0,+c,+b);JSM.AddVertexToBody(a,0,+c,-b);JSM.AddVertexToBody(a,0,-c,+b);JSM.AddVertexToBody(a,0,-c,-b);JSM.AddVertexToBody(a,+c,+b,0);JSM.AddVertexToBody(a,
+c,-b,0);JSM.AddVertexToBody(a,-c,+b,0);JSM.AddVertexToBody(a,-c,-b,0);JSM.AddVertexToBody(a,+b,0,+c);JSM.AddVertexToBody(a,-b,0,+c);JSM.AddVertexToBody(a,+b,0,-c);JSM.AddVertexToBody(a,-b,0,-c);JSM.AddPolygonToBody(a,[0,8,10,2,16]);JSM.AddPolygonToBody(a,[0,16,18,1,12]);JSM.AddPolygonToBody(a,[0,12,14,3,8]);JSM.AddPolygonToBody(a,[1,9,5,14,12]);JSM.AddPolygonToBody(a,[1,18,4,11,9]);JSM.AddPolygonToBody(a,[2,10,6,15,13]);JSM.AddPolygonToBody(a,[2,13,4,18,16]);JSM.AddPolygonToBody(a,[3,14,5,19,17]);
JSM.AddPolygonToBody(a,[3,17,6,10,8]);JSM.AddPolygonToBody(a,[4,13,15,7,11]);JSM.AddPolygonToBody(a,[5,9,11,7,19]);JSM.AddPolygonToBody(a,[6,17,19,7,15]);return a};
JSM.GenerateIcosahedron=function(){var a=new JSM.Body,b=(1+Math.sqrt(5))/2;JSM.AddVertexToBody(a,0,1,+b);JSM.AddVertexToBody(a,0,1,-b);JSM.AddVertexToBody(a,0,-1,+b);JSM.AddVertexToBody(a,0,-1,-b);JSM.AddVertexToBody(a,1,+b,0);JSM.AddVertexToBody(a,1,-b,0);JSM.AddVertexToBody(a,-1,+b,0);JSM.AddVertexToBody(a,-1,-b,0);JSM.AddVertexToBody(a,+b,0,1);JSM.AddVertexToBody(a,-b,0,1);JSM.AddVertexToBody(a,+b,0,-1);JSM.AddVertexToBody(a,-b,0,-1);JSM.AddPolygonToBody(a,[0,2,8]);JSM.AddPolygonToBody(a,[0,4,
6]);JSM.AddPolygonToBody(a,[0,6,9]);JSM.AddPolygonToBody(a,[0,8,4]);JSM.AddPolygonToBody(a,[0,9,2]);JSM.AddPolygonToBody(a,[1,3,11]);JSM.AddPolygonToBody(a,[1,4,10]);JSM.AddPolygonToBody(a,[1,6,4]);JSM.AddPolygonToBody(a,[1,10,3]);JSM.AddPolygonToBody(a,[1,11,6]);JSM.AddPolygonToBody(a,[2,5,8]);JSM.AddPolygonToBody(a,[2,7,5]);JSM.AddPolygonToBody(a,[2,9,7]);JSM.AddPolygonToBody(a,[3,5,7]);JSM.AddPolygonToBody(a,[3,7,11]);JSM.AddPolygonToBody(a,[3,10,5]);JSM.AddPolygonToBody(a,[4,8,10]);JSM.AddPolygonToBody(a,
[6,11,9]);JSM.AddPolygonToBody(a,[5,10,8]);JSM.AddPolygonToBody(a,[7,9,11]);return a};
JSM.GenerateTruncatedTetrahedron=function(){var a=new JSM.Body;JSM.AddVertexToBody(a,1,1,3);JSM.AddVertexToBody(a,1,-1,-3);JSM.AddVertexToBody(a,-1,-1,3);JSM.AddVertexToBody(a,-1,1,-3);JSM.AddVertexToBody(a,1,3,1);JSM.AddVertexToBody(a,1,-3,-1);JSM.AddVertexToBody(a,-1,-3,1);JSM.AddVertexToBody(a,-1,3,-1);JSM.AddVertexToBody(a,3,1,1);JSM.AddVertexToBody(a,3,-1,-1);JSM.AddVertexToBody(a,-3,-1,1);JSM.AddVertexToBody(a,-3,1,-1);JSM.AddPolygonToBody(a,[0,8,4]);JSM.AddPolygonToBody(a,[1,9,5]);JSM.AddPolygonToBody(a,
[2,10,6]);JSM.AddPolygonToBody(a,[3,11,7]);JSM.AddPolygonToBody(a,[0,2,6,5,9,8]);JSM.AddPolygonToBody(a,[0,4,7,11,10,2]);JSM.AddPolygonToBody(a,[1,3,7,4,8,9]);JSM.AddPolygonToBody(a,[1,5,6,10,11,3]);return a};
JSM.GenerateCuboctahedron=function(){var a=new JSM.Body;JSM.AddVertexToBody(a,1,1,0);JSM.AddVertexToBody(a,1,-1,0);JSM.AddVertexToBody(a,-1,-1,0);JSM.AddVertexToBody(a,-1,1,0);JSM.AddVertexToBody(a,1,0,1);JSM.AddVertexToBody(a,1,0,-1);JSM.AddVertexToBody(a,-1,0,1);JSM.AddVertexToBody(a,-1,0,-1);JSM.AddVertexToBody(a,0,1,1);JSM.AddVertexToBody(a,0,-1,-1);JSM.AddVertexToBody(a,0,-1,1);JSM.AddVertexToBody(a,0,1,-1);JSM.AddPolygonToBody(a,[0,5,11]);JSM.AddPolygonToBody(a,[0,8,4]);JSM.AddPolygonToBody(a,
[1,4,10]);JSM.AddPolygonToBody(a,[1,9,5]);JSM.AddPolygonToBody(a,[2,7,9]);JSM.AddPolygonToBody(a,[2,10,6]);JSM.AddPolygonToBody(a,[3,6,8]);JSM.AddPolygonToBody(a,[3,11,7]);JSM.AddPolygonToBody(a,[0,4,1,5]);JSM.AddPolygonToBody(a,[0,11,3,8]);JSM.AddPolygonToBody(a,[1,10,2,9]);JSM.AddPolygonToBody(a,[2,6,3,7]);JSM.AddPolygonToBody(a,[4,8,6,10]);JSM.AddPolygonToBody(a,[5,9,7,11]);return a};
JSM.GenerateTruncatedCube=function(){var a=new JSM.Body,b=Math.sqrt(2)-1;JSM.AddVertexToBody(a,1,1,+b);JSM.AddVertexToBody(a,1,1,-b);JSM.AddVertexToBody(a,1,-1,+b);JSM.AddVertexToBody(a,-1,1,+b);JSM.AddVertexToBody(a,1,-1,-b);JSM.AddVertexToBody(a,-1,1,-b);JSM.AddVertexToBody(a,-1,-1,+b);JSM.AddVertexToBody(a,-1,-1,-b);JSM.AddVertexToBody(a,1,+b,1);JSM.AddVertexToBody(a,1,+b,-1);JSM.AddVertexToBody(a,1,-b,1);JSM.AddVertexToBody(a,-1,+b,1);JSM.AddVertexToBody(a,1,-b,-1);JSM.AddVertexToBody(a,-1,+b,
-1);JSM.AddVertexToBody(a,-1,-b,1);JSM.AddVertexToBody(a,-1,-b,-1);JSM.AddVertexToBody(a,+b,1,1);JSM.AddVertexToBody(a,+b,1,-1);JSM.AddVertexToBody(a,+b,-1,1);JSM.AddVertexToBody(a,-b,1,1);JSM.AddVertexToBody(a,+b,-1,-1);JSM.AddVertexToBody(a,-b,1,-1);JSM.AddVertexToBody(a,-b,-1,1);JSM.AddVertexToBody(a,-b,-1,-1);JSM.AddPolygonToBody(a,[0,16,8]);JSM.AddPolygonToBody(a,[1,9,17]);JSM.AddPolygonToBody(a,[2,10,18]);JSM.AddPolygonToBody(a,[3,11,19]);JSM.AddPolygonToBody(a,[4,20,12]);JSM.AddPolygonToBody(a,
[5,21,13]);JSM.AddPolygonToBody(a,[6,22,14]);JSM.AddPolygonToBody(a,[7,15,23]);JSM.AddPolygonToBody(a,[0,1,17,21,5,3,19,16]);JSM.AddPolygonToBody(a,[0,8,10,2,4,12,9,1]);JSM.AddPolygonToBody(a,[2,18,22,6,7,23,20,4]);JSM.AddPolygonToBody(a,[3,5,13,15,7,6,14,11]);JSM.AddPolygonToBody(a,[8,16,19,11,14,22,18,10]);JSM.AddPolygonToBody(a,[9,12,20,23,15,13,21,17]);return a};
JSM.GenerateTruncatedOctahedron=function(){var a=new JSM.Body;JSM.AddVertexToBody(a,0,1,2);JSM.AddVertexToBody(a,0,1,-2);JSM.AddVertexToBody(a,0,-1,2);JSM.AddVertexToBody(a,0,-1,-2);JSM.AddVertexToBody(a,0,2,1);JSM.AddVertexToBody(a,0,-2,1);JSM.AddVertexToBody(a,0,2,-1);JSM.AddVertexToBody(a,0,-2,-1);JSM.AddVertexToBody(a,1,0,2);JSM.AddVertexToBody(a,1,0,-2);JSM.AddVertexToBody(a,-1,0,2);JSM.AddVertexToBody(a,-1,0,-2);JSM.AddVertexToBody(a,1,2,0);JSM.AddVertexToBody(a,1,-2,0);JSM.AddVertexToBody(a,
-1,2,0);JSM.AddVertexToBody(a,-1,-2,0);JSM.AddVertexToBody(a,2,0,1);JSM.AddVertexToBody(a,-2,0,1);JSM.AddVertexToBody(a,2,0,-1);JSM.AddVertexToBody(a,-2,0,-1);JSM.AddVertexToBody(a,2,1,0);JSM.AddVertexToBody(a,-2,1,0);JSM.AddVertexToBody(a,2,-1,0);JSM.AddVertexToBody(a,-2,-1,0);JSM.AddPolygonToBody(a,[0,10,2,8]);JSM.AddPolygonToBody(a,[1,9,3,11]);JSM.AddPolygonToBody(a,[4,12,6,14]);JSM.AddPolygonToBody(a,[5,15,7,13]);JSM.AddPolygonToBody(a,[16,22,18,20]);JSM.AddPolygonToBody(a,[17,21,19,23]);JSM.AddPolygonToBody(a,
[0,4,14,21,17,10]);JSM.AddPolygonToBody(a,[0,8,16,20,12,4]);JSM.AddPolygonToBody(a,[1,6,12,20,18,9]);JSM.AddPolygonToBody(a,[1,11,19,21,14,6]);JSM.AddPolygonToBody(a,[2,5,13,22,16,8]);JSM.AddPolygonToBody(a,[2,10,17,23,15,5]);JSM.AddPolygonToBody(a,[3,7,15,23,19,11]);JSM.AddPolygonToBody(a,[3,9,18,22,13,7]);return a};
JSM.GenerateRhombicuboctahedron=function(){var a=new JSM.Body,b=1+Math.sqrt(2);JSM.AddVertexToBody(a,1,1,+b);JSM.AddVertexToBody(a,1,1,-b);JSM.AddVertexToBody(a,1,-1,+b);JSM.AddVertexToBody(a,-1,1,+b);JSM.AddVertexToBody(a,1,-1,-b);JSM.AddVertexToBody(a,-1,1,-b);JSM.AddVertexToBody(a,-1,-1,+b);JSM.AddVertexToBody(a,-1,-1,-b);JSM.AddVertexToBody(a,1,+b,1);JSM.AddVertexToBody(a,1,+b,-1);JSM.AddVertexToBody(a,1,-b,1);JSM.AddVertexToBody(a,-1,+b,1);JSM.AddVertexToBody(a,1,-b,-1);JSM.AddVertexToBody(a,
-1,+b,-1);JSM.AddVertexToBody(a,-1,-b,1);JSM.AddVertexToBody(a,-1,-b,-1);JSM.AddVertexToBody(a,+b,1,1);JSM.AddVertexToBody(a,+b,1,-1);JSM.AddVertexToBody(a,+b,-1,1);JSM.AddVertexToBody(a,-b,1,1);JSM.AddVertexToBody(a,+b,-1,-1);JSM.AddVertexToBody(a,-b,1,-1);JSM.AddVertexToBody(a,-b,-1,1);JSM.AddVertexToBody(a,-b,-1,-1);JSM.AddPolygonToBody(a,[0,16,8]);JSM.AddPolygonToBody(a,[1,9,17]);JSM.AddPolygonToBody(a,[2,10,18]);JSM.AddPolygonToBody(a,[3,11,19]);JSM.AddPolygonToBody(a,[4,20,12]);JSM.AddPolygonToBody(a,
[5,21,13]);JSM.AddPolygonToBody(a,[6,22,14]);JSM.AddPolygonToBody(a,[7,15,23]);JSM.AddPolygonToBody(a,[0,2,18,16]);JSM.AddPolygonToBody(a,[0,3,6,2]);JSM.AddPolygonToBody(a,[0,8,11,3]);JSM.AddPolygonToBody(a,[1,4,7,5]);JSM.AddPolygonToBody(a,[1,5,13,9]);JSM.AddPolygonToBody(a,[1,17,20,4]);JSM.AddPolygonToBody(a,[2,6,14,10]);JSM.AddPolygonToBody(a,[3,19,22,6]);JSM.AddPolygonToBody(a,[4,12,15,7]);JSM.AddPolygonToBody(a,[5,7,23,21]);JSM.AddPolygonToBody(a,[8,9,13,11]);JSM.AddPolygonToBody(a,[8,16,17,
9]);JSM.AddPolygonToBody(a,[10,12,20,18]);JSM.AddPolygonToBody(a,[10,14,15,12]);JSM.AddPolygonToBody(a,[11,13,21,19]);JSM.AddPolygonToBody(a,[14,22,23,15]);JSM.AddPolygonToBody(a,[16,18,20,17]);JSM.AddPolygonToBody(a,[19,21,23,22]);return a};
JSM.GenerateTruncatedCuboctahedron=function(){var a=new JSM.Body,b=1+Math.sqrt(2),c=1+2*Math.sqrt(2);JSM.AddVertexToBody(a,1,+b,+c);JSM.AddVertexToBody(a,1,+b,-c);JSM.AddVertexToBody(a,1,-b,+c);JSM.AddVertexToBody(a,-1,+b,+c);JSM.AddVertexToBody(a,1,-b,-c);JSM.AddVertexToBody(a,-1,+b,-c);JSM.AddVertexToBody(a,-1,-b,+c);JSM.AddVertexToBody(a,-1,-b,-c);JSM.AddVertexToBody(a,1,+c,+b);JSM.AddVertexToBody(a,1,-c,+b);JSM.AddVertexToBody(a,1,+c,-b);JSM.AddVertexToBody(a,-1,+c,+b);JSM.AddVertexToBody(a,1,
-c,-b);JSM.AddVertexToBody(a,-1,-c,+b);JSM.AddVertexToBody(a,-1,+c,-b);JSM.AddVertexToBody(a,-1,-c,-b);JSM.AddVertexToBody(a,+b,1,+c);JSM.AddVertexToBody(a,+b,1,-c);JSM.AddVertexToBody(a,-b,1,+c);JSM.AddVertexToBody(a,+b,-1,+c);JSM.AddVertexToBody(a,-b,1,-c);JSM.AddVertexToBody(a,+b,-1,-c);JSM.AddVertexToBody(a,-b,-1,+c);JSM.AddVertexToBody(a,-b,-1,-c);JSM.AddVertexToBody(a,+b,+c,1);JSM.AddVertexToBody(a,+b,-c,1);JSM.AddVertexToBody(a,-b,+c,1);JSM.AddVertexToBody(a,+b,+c,-1);JSM.AddVertexToBody(a,
-b,-c,1);JSM.AddVertexToBody(a,+b,-c,-1);JSM.AddVertexToBody(a,-b,+c,-1);JSM.AddVertexToBody(a,-b,-c,-1);JSM.AddVertexToBody(a,+c,1,+b);JSM.AddVertexToBody(a,-c,1,+b);JSM.AddVertexToBody(a,+c,1,-b);JSM.AddVertexToBody(a,+c,-1,+b);JSM.AddVertexToBody(a,-c,1,-b);JSM.AddVertexToBody(a,-c,-1,+b);JSM.AddVertexToBody(a,+c,-1,-b);JSM.AddVertexToBody(a,-c,-1,-b);JSM.AddVertexToBody(a,+c,+b,1);JSM.AddVertexToBody(a,-c,+b,1);JSM.AddVertexToBody(a,+c,-b,1);JSM.AddVertexToBody(a,+c,+b,-1);JSM.AddVertexToBody(a,
-c,-b,1);JSM.AddVertexToBody(a,-c,+b,-1);JSM.AddVertexToBody(a,+c,-b,-1);JSM.AddVertexToBody(a,-c,-b,-1);JSM.AddPolygonToBody(a,[0,8,11,3]);JSM.AddPolygonToBody(a,[1,5,14,10]);JSM.AddPolygonToBody(a,[2,6,13,9]);JSM.AddPolygonToBody(a,[4,12,15,7]);JSM.AddPolygonToBody(a,[16,19,35,32]);JSM.AddPolygonToBody(a,[17,34,38,21]);JSM.AddPolygonToBody(a,[18,33,37,22]);JSM.AddPolygonToBody(a,[23,39,36,20]);JSM.AddPolygonToBody(a,[24,40,43,27]);JSM.AddPolygonToBody(a,[25,29,46,42]);JSM.AddPolygonToBody(a,[26,
30,45,41]);JSM.AddPolygonToBody(a,[28,44,47,31]);JSM.AddPolygonToBody(a,[0,16,32,40,24,8]);JSM.AddPolygonToBody(a,[1,10,27,43,34,17]);JSM.AddPolygonToBody(a,[2,9,25,42,35,19]);JSM.AddPolygonToBody(a,[3,11,26,41,33,18]);JSM.AddPolygonToBody(a,[4,21,38,46,29,12]);JSM.AddPolygonToBody(a,[5,20,36,45,30,14]);JSM.AddPolygonToBody(a,[6,22,37,44,28,13]);JSM.AddPolygonToBody(a,[7,15,31,47,39,23]);JSM.AddPolygonToBody(a,[0,3,18,22,6,2,19,16]);JSM.AddPolygonToBody(a,[1,17,21,4,7,23,20,5]);JSM.AddPolygonToBody(a,
[8,24,27,10,14,30,26,11]);JSM.AddPolygonToBody(a,[9,13,28,31,15,12,29,25]);JSM.AddPolygonToBody(a,[32,35,42,46,38,34,43,40]);JSM.AddPolygonToBody(a,[33,41,45,36,39,47,44,37]);return a};
JSM.GenerateSnubCube=function(){var a=new JSM.Body,b=1/3*(Math.pow(17+3*Math.sqrt(33),1/3)-Math.pow(-17+3*Math.sqrt(33),1/3)-1),c=1/b;JSM.AddVertexToBody(a,1,+b,-c);JSM.AddVertexToBody(a,1,-b,+c);JSM.AddVertexToBody(a,-1,+b,+c);JSM.AddVertexToBody(a,-1,-b,-c);JSM.AddVertexToBody(a,+b,-c,1);JSM.AddVertexToBody(a,-b,+c,1);JSM.AddVertexToBody(a,+b,+c,-1);JSM.AddVertexToBody(a,-b,-c,-1);JSM.AddVertexToBody(a,-c,1,+b);JSM.AddVertexToBody(a,+c,1,-b);JSM.AddVertexToBody(a,+c,-1,+b);JSM.AddVertexToBody(a,
-c,-1,-b);JSM.AddVertexToBody(a,1,+c,+b);JSM.AddVertexToBody(a,1,-c,-b);JSM.AddVertexToBody(a,-1,+c,-b);JSM.AddVertexToBody(a,-1,-c,+b);JSM.AddVertexToBody(a,+b,1,+c);JSM.AddVertexToBody(a,-b,1,-c);JSM.AddVertexToBody(a,-b,-1,+c);JSM.AddVertexToBody(a,+b,-1,-c);JSM.AddVertexToBody(a,+c,+b,1);JSM.AddVertexToBody(a,-c,-b,1);JSM.AddVertexToBody(a,+c,-b,-1);JSM.AddVertexToBody(a,-c,+b,-1);JSM.AddPolygonToBody(a,[0,6,9]);JSM.AddPolygonToBody(a,[0,9,22]);JSM.AddPolygonToBody(a,[0,17,6]);JSM.AddPolygonToBody(a,
[0,22,19]);JSM.AddPolygonToBody(a,[1,4,10]);JSM.AddPolygonToBody(a,[1,10,20]);JSM.AddPolygonToBody(a,[1,18,4]);JSM.AddPolygonToBody(a,[1,20,16]);JSM.AddPolygonToBody(a,[2,5,8]);JSM.AddPolygonToBody(a,[2,8,21]);JSM.AddPolygonToBody(a,[2,16,5]);JSM.AddPolygonToBody(a,[2,21,18]);JSM.AddPolygonToBody(a,[3,7,11]);JSM.AddPolygonToBody(a,[3,11,23]);JSM.AddPolygonToBody(a,[3,19,7]);JSM.AddPolygonToBody(a,[3,23,17]);JSM.AddPolygonToBody(a,[4,13,10]);JSM.AddPolygonToBody(a,[4,18,15]);JSM.AddPolygonToBody(a,
[5,14,8]);JSM.AddPolygonToBody(a,[5,16,12]);JSM.AddPolygonToBody(a,[6,12,9]);JSM.AddPolygonToBody(a,[6,17,14]);JSM.AddPolygonToBody(a,[7,15,11]);JSM.AddPolygonToBody(a,[7,19,13]);JSM.AddPolygonToBody(a,[8,14,23]);JSM.AddPolygonToBody(a,[9,12,20]);JSM.AddPolygonToBody(a,[10,13,22]);JSM.AddPolygonToBody(a,[11,15,21]);JSM.AddPolygonToBody(a,[12,16,20]);JSM.AddPolygonToBody(a,[13,19,22]);JSM.AddPolygonToBody(a,[14,17,23]);JSM.AddPolygonToBody(a,[15,18,21]);JSM.AddPolygonToBody(a,[0,19,3,17]);JSM.AddPolygonToBody(a,
[1,16,2,18]);JSM.AddPolygonToBody(a,[4,15,7,13]);JSM.AddPolygonToBody(a,[5,12,6,14]);JSM.AddPolygonToBody(a,[8,23,11,21]);JSM.AddPolygonToBody(a,[9,20,10,22]);return a};
JSM.GenerateIcosidodecahedron=function(){var a=new JSM.Body,b=(1+Math.sqrt(5))/2,c=b/2,d=(1+b)/2;JSM.AddVertexToBody(a,0,0,+b);JSM.AddVertexToBody(a,0,0,-b);JSM.AddVertexToBody(a,0,+b,0);JSM.AddVertexToBody(a,0,-b,0);JSM.AddVertexToBody(a,+b,0,0);JSM.AddVertexToBody(a,-b,0,0);JSM.AddVertexToBody(a,0.5,+c,+d);JSM.AddVertexToBody(a,0.5,+c,-d);JSM.AddVertexToBody(a,0.5,-c,+d);JSM.AddVertexToBody(a,-0.5,+c,+d);JSM.AddVertexToBody(a,0.5,-c,-d);JSM.AddVertexToBody(a,-0.5,+c,-d);JSM.AddVertexToBody(a,-0.5,
-c,+d);JSM.AddVertexToBody(a,-0.5,-c,-d);JSM.AddVertexToBody(a,+c,+d,0.5);JSM.AddVertexToBody(a,+c,-d,0.5);JSM.AddVertexToBody(a,-c,+d,0.5);JSM.AddVertexToBody(a,+c,+d,-0.5);JSM.AddVertexToBody(a,-c,-d,0.5);JSM.AddVertexToBody(a,+c,-d,-0.5);JSM.AddVertexToBody(a,-c,+d,-0.5);JSM.AddVertexToBody(a,-c,-d,-0.5);JSM.AddVertexToBody(a,+d,0.5,+c);JSM.AddVertexToBody(a,-d,0.5,+c);JSM.AddVertexToBody(a,+d,0.5,-c);JSM.AddVertexToBody(a,+d,-0.5,+c);JSM.AddVertexToBody(a,-d,0.5,-c);JSM.AddVertexToBody(a,-d,-0.5,
+c);JSM.AddVertexToBody(a,+d,-0.5,-c);JSM.AddVertexToBody(a,-d,-0.5,-c);JSM.AddPolygonToBody(a,[0,6,9]);JSM.AddPolygonToBody(a,[0,12,8]);JSM.AddPolygonToBody(a,[1,10,13]);JSM.AddPolygonToBody(a,[1,11,7]);JSM.AddPolygonToBody(a,[2,14,17]);JSM.AddPolygonToBody(a,[2,20,16]);JSM.AddPolygonToBody(a,[3,18,21]);JSM.AddPolygonToBody(a,[3,19,15]);JSM.AddPolygonToBody(a,[4,22,25]);JSM.AddPolygonToBody(a,[4,28,24]);JSM.AddPolygonToBody(a,[5,26,29]);JSM.AddPolygonToBody(a,[5,27,23]);JSM.AddPolygonToBody(a,[6,
22,14]);JSM.AddPolygonToBody(a,[7,17,24]);JSM.AddPolygonToBody(a,[8,15,25]);JSM.AddPolygonToBody(a,[9,16,23]);JSM.AddPolygonToBody(a,[10,28,19]);JSM.AddPolygonToBody(a,[11,26,20]);JSM.AddPolygonToBody(a,[12,27,18]);JSM.AddPolygonToBody(a,[13,21,29]);JSM.AddPolygonToBody(a,[0,8,25,22,6]);JSM.AddPolygonToBody(a,[0,9,23,27,12]);JSM.AddPolygonToBody(a,[1,7,24,28,10]);JSM.AddPolygonToBody(a,[1,13,29,26,11]);JSM.AddPolygonToBody(a,[2,16,9,6,14]);JSM.AddPolygonToBody(a,[2,17,7,11,20]);JSM.AddPolygonToBody(a,
[3,15,8,12,18]);JSM.AddPolygonToBody(a,[3,21,13,10,19]);JSM.AddPolygonToBody(a,[4,24,17,14,22]);JSM.AddPolygonToBody(a,[4,25,15,19,28]);JSM.AddPolygonToBody(a,[5,23,16,20,26]);JSM.AddPolygonToBody(a,[5,29,21,18,27]);return a};
JSM.GenerateTruncatedDodecahedron=function(){var a=new JSM.Body,b=(1+Math.sqrt(5))/2,c=1/b,d=2+b,e=2*b,f=Math.pow(b,2);JSM.AddVertexToBody(a,0,+c,+d);JSM.AddVertexToBody(a,0,+c,-d);JSM.AddVertexToBody(a,0,-c,+d);JSM.AddVertexToBody(a,0,-c,-d);JSM.AddVertexToBody(a,+d,0,+c);JSM.AddVertexToBody(a,-d,0,+c);JSM.AddVertexToBody(a,+d,0,-c);JSM.AddVertexToBody(a,-d,0,-c);JSM.AddVertexToBody(a,+c,+d,0);JSM.AddVertexToBody(a,+c,-d,0);JSM.AddVertexToBody(a,-c,+d,0);JSM.AddVertexToBody(a,-c,-d,0);JSM.AddVertexToBody(a,
+c,+b,+e);JSM.AddVertexToBody(a,+c,+b,-e);JSM.AddVertexToBody(a,+c,-b,+e);JSM.AddVertexToBody(a,-c,+b,+e);JSM.AddVertexToBody(a,+c,-b,-e);JSM.AddVertexToBody(a,-c,+b,-e);JSM.AddVertexToBody(a,-c,-b,+e);JSM.AddVertexToBody(a,-c,-b,-e);JSM.AddVertexToBody(a,+e,+c,+b);JSM.AddVertexToBody(a,+e,+c,-b);JSM.AddVertexToBody(a,+e,-c,+b);JSM.AddVertexToBody(a,-e,+c,+b);JSM.AddVertexToBody(a,+e,-c,-b);JSM.AddVertexToBody(a,-e,+c,-b);JSM.AddVertexToBody(a,-e,-c,+b);JSM.AddVertexToBody(a,-e,-c,-b);JSM.AddVertexToBody(a,
+b,+e,+c);JSM.AddVertexToBody(a,+b,+e,-c);JSM.AddVertexToBody(a,+b,-e,+c);JSM.AddVertexToBody(a,-b,+e,+c);JSM.AddVertexToBody(a,+b,-e,-c);JSM.AddVertexToBody(a,-b,+e,-c);JSM.AddVertexToBody(a,-b,-e,+c);JSM.AddVertexToBody(a,-b,-e,-c);JSM.AddVertexToBody(a,+b,2,+f);JSM.AddVertexToBody(a,+b,2,-f);JSM.AddVertexToBody(a,+b,-2,+f);JSM.AddVertexToBody(a,-b,2,+f);JSM.AddVertexToBody(a,+b,-2,-f);JSM.AddVertexToBody(a,-b,2,-f);JSM.AddVertexToBody(a,-b,-2,+f);JSM.AddVertexToBody(a,-b,-2,-f);JSM.AddVertexToBody(a,
+f,+b,2);JSM.AddVertexToBody(a,+f,+b,-2);JSM.AddVertexToBody(a,+f,-b,2);JSM.AddVertexToBody(a,-f,+b,2);JSM.AddVertexToBody(a,+f,-b,-2);JSM.AddVertexToBody(a,-f,+b,-2);JSM.AddVertexToBody(a,-f,-b,2);JSM.AddVertexToBody(a,-f,-b,-2);JSM.AddVertexToBody(a,2,+f,+b);JSM.AddVertexToBody(a,2,+f,-b);JSM.AddVertexToBody(a,2,-f,+b);JSM.AddVertexToBody(a,-2,+f,+b);JSM.AddVertexToBody(a,2,-f,-b);JSM.AddVertexToBody(a,-2,+f,-b);JSM.AddVertexToBody(a,-2,-f,+b);JSM.AddVertexToBody(a,-2,-f,-b);JSM.AddPolygonToBody(a,
[0,12,15]);JSM.AddPolygonToBody(a,[1,17,13]);JSM.AddPolygonToBody(a,[2,18,14]);JSM.AddPolygonToBody(a,[3,16,19]);JSM.AddPolygonToBody(a,[4,20,22]);JSM.AddPolygonToBody(a,[5,26,23]);JSM.AddPolygonToBody(a,[6,24,21]);JSM.AddPolygonToBody(a,[7,25,27]);JSM.AddPolygonToBody(a,[8,28,29]);JSM.AddPolygonToBody(a,[9,32,30]);JSM.AddPolygonToBody(a,[10,33,31]);JSM.AddPolygonToBody(a,[11,34,35]);JSM.AddPolygonToBody(a,[36,44,52]);JSM.AddPolygonToBody(a,[37,53,45]);JSM.AddPolygonToBody(a,[38,54,46]);JSM.AddPolygonToBody(a,
[39,55,47]);JSM.AddPolygonToBody(a,[40,48,56]);JSM.AddPolygonToBody(a,[41,49,57]);JSM.AddPolygonToBody(a,[42,50,58]);JSM.AddPolygonToBody(a,[43,59,51]);JSM.AddPolygonToBody(a,[0,2,14,38,46,22,20,44,36,12]);JSM.AddPolygonToBody(a,[0,15,39,47,23,26,50,42,18,2]);JSM.AddPolygonToBody(a,[1,3,19,43,51,27,25,49,41,17]);JSM.AddPolygonToBody(a,[1,13,37,45,21,24,48,40,16,3]);JSM.AddPolygonToBody(a,[4,6,21,45,53,29,28,52,44,20]);JSM.AddPolygonToBody(a,[4,22,46,54,30,32,56,48,24,6]);JSM.AddPolygonToBody(a,[5,
7,27,51,59,35,34,58,50,26]);JSM.AddPolygonToBody(a,[5,23,47,55,31,33,57,49,25,7]);JSM.AddPolygonToBody(a,[8,10,31,55,39,15,12,36,52,28]);JSM.AddPolygonToBody(a,[8,29,53,37,13,17,41,57,33,10]);JSM.AddPolygonToBody(a,[9,11,35,59,43,19,16,40,56,32]);JSM.AddPolygonToBody(a,[9,30,54,38,14,18,42,58,34,11]);return a};
JSM.GenerateTruncatedIcosahedron=function(){var a=new JSM.Body,b=(1+Math.sqrt(5))/2,c=3*b,d=1+2*b,e=2+b,f=2*b;JSM.AddVertexToBody(a,0,1,+c);JSM.AddVertexToBody(a,0,1,-c);JSM.AddVertexToBody(a,0,-1,+c);JSM.AddVertexToBody(a,0,-1,-c);JSM.AddVertexToBody(a,1,+c,0);JSM.AddVertexToBody(a,1,-c,0);JSM.AddVertexToBody(a,-1,+c,0);JSM.AddVertexToBody(a,-1,-c,0);JSM.AddVertexToBody(a,+c,0,1);JSM.AddVertexToBody(a,-c,0,1);JSM.AddVertexToBody(a,+c,0,-1);JSM.AddVertexToBody(a,-c,0,-1);JSM.AddVertexToBody(a,2,+d,
+b);JSM.AddVertexToBody(a,2,+d,-b);JSM.AddVertexToBody(a,2,-d,+b);JSM.AddVertexToBody(a,-2,+d,+b);JSM.AddVertexToBody(a,2,-d,-b);JSM.AddVertexToBody(a,-2,+d,-b);JSM.AddVertexToBody(a,-2,-d,+b);JSM.AddVertexToBody(a,-2,-d,-b);JSM.AddVertexToBody(a,+d,+b,2);JSM.AddVertexToBody(a,+d,-b,2);JSM.AddVertexToBody(a,-d,+b,2);JSM.AddVertexToBody(a,+d,+b,-2);JSM.AddVertexToBody(a,-d,-b,2);JSM.AddVertexToBody(a,+d,-b,-2);JSM.AddVertexToBody(a,-d,+b,-2);JSM.AddVertexToBody(a,-d,-b,-2);JSM.AddVertexToBody(a,+b,
2,+d);JSM.AddVertexToBody(a,-b,2,+d);JSM.AddVertexToBody(a,+b,2,-d);JSM.AddVertexToBody(a,+b,-2,+d);JSM.AddVertexToBody(a,-b,2,-d);JSM.AddVertexToBody(a,-b,-2,+d);JSM.AddVertexToBody(a,+b,-2,-d);JSM.AddVertexToBody(a,-b,-2,-d);JSM.AddVertexToBody(a,1,+e,+f);JSM.AddVertexToBody(a,1,+e,-f);JSM.AddVertexToBody(a,1,-e,+f);JSM.AddVertexToBody(a,-1,+e,+f);JSM.AddVertexToBody(a,1,-e,-f);JSM.AddVertexToBody(a,-1,+e,-f);JSM.AddVertexToBody(a,-1,-e,+f);JSM.AddVertexToBody(a,-1,-e,-f);JSM.AddVertexToBody(a,
+e,+f,1);JSM.AddVertexToBody(a,+e,-f,1);JSM.AddVertexToBody(a,-e,+f,1);JSM.AddVertexToBody(a,+e,+f,-1);JSM.AddVertexToBody(a,-e,-f,1);JSM.AddVertexToBody(a,+e,-f,-1);JSM.AddVertexToBody(a,-e,+f,-1);JSM.AddVertexToBody(a,-e,-f,-1);JSM.AddVertexToBody(a,+f,1,+e);JSM.AddVertexToBody(a,-f,1,+e);JSM.AddVertexToBody(a,+f,1,-e);JSM.AddVertexToBody(a,+f,-1,+e);JSM.AddVertexToBody(a,-f,1,-e);JSM.AddVertexToBody(a,-f,-1,+e);JSM.AddVertexToBody(a,+f,-1,-e);JSM.AddVertexToBody(a,-f,-1,-e);JSM.AddPolygonToBody(a,
[0,28,36,39,29]);JSM.AddPolygonToBody(a,[1,32,41,37,30]);JSM.AddPolygonToBody(a,[2,33,42,38,31]);JSM.AddPolygonToBody(a,[3,34,40,43,35]);JSM.AddPolygonToBody(a,[4,12,44,47,13]);JSM.AddPolygonToBody(a,[5,16,49,45,14]);JSM.AddPolygonToBody(a,[6,17,50,46,15]);JSM.AddPolygonToBody(a,[7,18,48,51,19]);JSM.AddPolygonToBody(a,[8,20,52,55,21]);JSM.AddPolygonToBody(a,[9,24,57,53,22]);JSM.AddPolygonToBody(a,[10,25,58,54,23]);JSM.AddPolygonToBody(a,[11,26,56,59,27]);JSM.AddPolygonToBody(a,[0,2,31,55,52,28]);
JSM.AddPolygonToBody(a,[0,29,53,57,33,2]);JSM.AddPolygonToBody(a,[1,3,35,59,56,32]);JSM.AddPolygonToBody(a,[1,30,54,58,34,3]);JSM.AddPolygonToBody(a,[4,6,15,39,36,12]);JSM.AddPolygonToBody(a,[4,13,37,41,17,6]);JSM.AddPolygonToBody(a,[5,7,19,43,40,16]);JSM.AddPolygonToBody(a,[5,14,38,42,18,7]);JSM.AddPolygonToBody(a,[8,10,23,47,44,20]);JSM.AddPolygonToBody(a,[8,21,45,49,25,10]);JSM.AddPolygonToBody(a,[9,11,27,51,48,24]);JSM.AddPolygonToBody(a,[9,22,46,50,26,11]);JSM.AddPolygonToBody(a,[12,36,28,52,
20,44]);JSM.AddPolygonToBody(a,[13,47,23,54,30,37]);JSM.AddPolygonToBody(a,[14,45,21,55,31,38]);JSM.AddPolygonToBody(a,[15,46,22,53,29,39]);JSM.AddPolygonToBody(a,[16,40,34,58,25,49]);JSM.AddPolygonToBody(a,[17,41,32,56,26,50]);JSM.AddPolygonToBody(a,[18,42,33,57,24,48]);JSM.AddPolygonToBody(a,[19,51,27,59,35,43]);return a};
JSM.GenerateRhombicosidodecahedron=function(){var a=new JSM.Body,b=(1+Math.sqrt(5))/2,c=Math.pow(b,2),d=Math.pow(b,3),e=2*b,f=2+b;JSM.AddVertexToBody(a,1,1,+d);JSM.AddVertexToBody(a,1,1,-d);JSM.AddVertexToBody(a,1,-1,+d);JSM.AddVertexToBody(a,-1,1,+d);JSM.AddVertexToBody(a,1,-1,-d);JSM.AddVertexToBody(a,-1,1,-d);JSM.AddVertexToBody(a,-1,-1,+d);JSM.AddVertexToBody(a,-1,-1,-d);JSM.AddVertexToBody(a,+d,1,1);JSM.AddVertexToBody(a,+d,1,-1);JSM.AddVertexToBody(a,+d,-1,1);JSM.AddVertexToBody(a,-d,1,1);JSM.AddVertexToBody(a,
+d,-1,-1);JSM.AddVertexToBody(a,-d,1,-1);JSM.AddVertexToBody(a,-d,-1,1);JSM.AddVertexToBody(a,-d,-1,-1);JSM.AddVertexToBody(a,1,+d,1);JSM.AddVertexToBody(a,1,+d,-1);JSM.AddVertexToBody(a,1,-d,1);JSM.AddVertexToBody(a,-1,+d,1);JSM.AddVertexToBody(a,1,-d,-1);JSM.AddVertexToBody(a,-1,+d,-1);JSM.AddVertexToBody(a,-1,-d,1);JSM.AddVertexToBody(a,-1,-d,-1);JSM.AddVertexToBody(a,+c,+b,+e);JSM.AddVertexToBody(a,+c,+b,-e);JSM.AddVertexToBody(a,+c,-b,+e);JSM.AddVertexToBody(a,-c,+b,+e);JSM.AddVertexToBody(a,
+c,-b,-e);JSM.AddVertexToBody(a,-c,+b,-e);JSM.AddVertexToBody(a,-c,-b,+e);JSM.AddVertexToBody(a,-c,-b,-e);JSM.AddVertexToBody(a,+e,+c,+b);JSM.AddVertexToBody(a,+e,+c,-b);JSM.AddVertexToBody(a,+e,-c,+b);JSM.AddVertexToBody(a,-e,+c,+b);JSM.AddVertexToBody(a,+e,-c,-b);JSM.AddVertexToBody(a,-e,+c,-b);JSM.AddVertexToBody(a,-e,-c,+b);JSM.AddVertexToBody(a,-e,-c,-b);JSM.AddVertexToBody(a,+b,+e,+c);JSM.AddVertexToBody(a,+b,+e,-c);JSM.AddVertexToBody(a,+b,-e,+c);JSM.AddVertexToBody(a,-b,+e,+c);JSM.AddVertexToBody(a,
+b,-e,-c);JSM.AddVertexToBody(a,-b,+e,-c);JSM.AddVertexToBody(a,-b,-e,+c);JSM.AddVertexToBody(a,-b,-e,-c);JSM.AddVertexToBody(a,+f,0,+c);JSM.AddVertexToBody(a,+f,0,-c);JSM.AddVertexToBody(a,-f,0,+c);JSM.AddVertexToBody(a,-f,0,-c);JSM.AddVertexToBody(a,+c,+f,0);JSM.AddVertexToBody(a,-c,+f,0);JSM.AddVertexToBody(a,+c,-f,0);JSM.AddVertexToBody(a,-c,-f,0);JSM.AddVertexToBody(a,0,+c,+f);JSM.AddVertexToBody(a,0,-c,+f);JSM.AddVertexToBody(a,0,+c,-f);JSM.AddVertexToBody(a,0,-c,-f);JSM.AddPolygonToBody(a,
[0,56,3]);JSM.AddPolygonToBody(a,[1,5,58]);JSM.AddPolygonToBody(a,[2,6,57]);JSM.AddPolygonToBody(a,[4,59,7]);JSM.AddPolygonToBody(a,[8,48,10]);JSM.AddPolygonToBody(a,[9,12,49]);JSM.AddPolygonToBody(a,[11,14,50]);JSM.AddPolygonToBody(a,[13,51,15]);JSM.AddPolygonToBody(a,[16,52,17]);JSM.AddPolygonToBody(a,[18,20,54]);JSM.AddPolygonToBody(a,[19,21,53]);JSM.AddPolygonToBody(a,[22,55,23]);JSM.AddPolygonToBody(a,[24,32,40]);JSM.AddPolygonToBody(a,[25,41,33]);JSM.AddPolygonToBody(a,[26,42,34]);JSM.AddPolygonToBody(a,
[27,43,35]);JSM.AddPolygonToBody(a,[28,36,44]);JSM.AddPolygonToBody(a,[29,37,45]);JSM.AddPolygonToBody(a,[30,38,46]);JSM.AddPolygonToBody(a,[31,47,39]);JSM.AddPolygonToBody(a,[0,3,6,2]);JSM.AddPolygonToBody(a,[0,24,40,56]);JSM.AddPolygonToBody(a,[1,4,7,5]);JSM.AddPolygonToBody(a,[1,58,41,25]);JSM.AddPolygonToBody(a,[2,57,42,26]);JSM.AddPolygonToBody(a,[3,56,43,27]);JSM.AddPolygonToBody(a,[4,28,44,59]);JSM.AddPolygonToBody(a,[5,29,45,58]);JSM.AddPolygonToBody(a,[6,30,46,57]);JSM.AddPolygonToBody(a,
[7,59,47,31]);JSM.AddPolygonToBody(a,[8,10,12,9]);JSM.AddPolygonToBody(a,[8,32,24,48]);JSM.AddPolygonToBody(a,[9,49,25,33]);JSM.AddPolygonToBody(a,[10,48,26,34]);JSM.AddPolygonToBody(a,[11,13,15,14]);JSM.AddPolygonToBody(a,[11,50,27,35]);JSM.AddPolygonToBody(a,[12,36,28,49]);JSM.AddPolygonToBody(a,[13,37,29,51]);JSM.AddPolygonToBody(a,[14,38,30,50]);JSM.AddPolygonToBody(a,[15,51,31,39]);JSM.AddPolygonToBody(a,[16,17,21,19]);JSM.AddPolygonToBody(a,[16,40,32,52]);JSM.AddPolygonToBody(a,[17,52,33,41]);
JSM.AddPolygonToBody(a,[18,22,23,20]);JSM.AddPolygonToBody(a,[18,54,34,42]);JSM.AddPolygonToBody(a,[19,53,35,43]);JSM.AddPolygonToBody(a,[20,44,36,54]);JSM.AddPolygonToBody(a,[21,45,37,53]);JSM.AddPolygonToBody(a,[22,46,38,55]);JSM.AddPolygonToBody(a,[23,55,39,47]);JSM.AddPolygonToBody(a,[0,2,26,48,24]);JSM.AddPolygonToBody(a,[1,25,49,28,4]);JSM.AddPolygonToBody(a,[3,27,50,30,6]);JSM.AddPolygonToBody(a,[5,7,31,51,29]);JSM.AddPolygonToBody(a,[8,9,33,52,32]);JSM.AddPolygonToBody(a,[10,34,54,36,12]);
JSM.AddPolygonToBody(a,[11,35,53,37,13]);JSM.AddPolygonToBody(a,[14,15,39,55,38]);JSM.AddPolygonToBody(a,[16,19,43,56,40]);JSM.AddPolygonToBody(a,[17,41,58,45,21]);JSM.AddPolygonToBody(a,[18,42,57,46,22]);JSM.AddPolygonToBody(a,[20,23,47,59,44]);return a};
JSM.GenerateTruncatedIcosidodecahedron=function(){var a=new JSM.Body,b=(1+Math.sqrt(5))/2,c=1/b,d=3+b,e=2/b,f=1+2*b,g=Math.pow(b,2),h=-1+3*b,l=-1+2*b,k=2+b,m=2*b;JSM.AddVertexToBody(a,+c,+c,+d);JSM.AddVertexToBody(a,+c,+c,-d);JSM.AddVertexToBody(a,+c,-c,+d);JSM.AddVertexToBody(a,-c,+c,+d);JSM.AddVertexToBody(a,+c,-c,-d);JSM.AddVertexToBody(a,-c,+c,-d);JSM.AddVertexToBody(a,-c,-c,+d);JSM.AddVertexToBody(a,-c,-c,-d);JSM.AddVertexToBody(a,+c,+d,+c);JSM.AddVertexToBody(a,+c,-d,+c);JSM.AddVertexToBody(a,
-c,+d,+c);JSM.AddVertexToBody(a,+c,+d,-c);JSM.AddVertexToBody(a,-c,-d,+c);JSM.AddVertexToBody(a,+c,-d,-c);JSM.AddVertexToBody(a,-c,+d,-c);JSM.AddVertexToBody(a,-c,-d,-c);JSM.AddVertexToBody(a,+d,+c,+c);JSM.AddVertexToBody(a,-d,+c,+c);JSM.AddVertexToBody(a,+d,+c,-c);JSM.AddVertexToBody(a,+d,-c,+c);JSM.AddVertexToBody(a,-d,+c,-c);JSM.AddVertexToBody(a,-d,-c,+c);JSM.AddVertexToBody(a,+d,-c,-c);JSM.AddVertexToBody(a,-d,-c,-c);JSM.AddVertexToBody(a,+e,+b,+f);JSM.AddVertexToBody(a,+e,+b,-f);JSM.AddVertexToBody(a,
+e,-b,+f);JSM.AddVertexToBody(a,-e,+b,+f);JSM.AddVertexToBody(a,+e,-b,-f);JSM.AddVertexToBody(a,-e,+b,-f);JSM.AddVertexToBody(a,-e,-b,+f);JSM.AddVertexToBody(a,-e,-b,-f);JSM.AddVertexToBody(a,+b,+f,+e);JSM.AddVertexToBody(a,+b,-f,+e);JSM.AddVertexToBody(a,-b,+f,+e);JSM.AddVertexToBody(a,+b,+f,-e);JSM.AddVertexToBody(a,-b,-f,+e);JSM.AddVertexToBody(a,+b,-f,-e);JSM.AddVertexToBody(a,-b,+f,-e);JSM.AddVertexToBody(a,-b,-f,-e);JSM.AddVertexToBody(a,+f,+e,+b);JSM.AddVertexToBody(a,-f,+e,+b);JSM.AddVertexToBody(a,
+f,+e,-b);JSM.AddVertexToBody(a,+f,-e,+b);JSM.AddVertexToBody(a,-f,+e,-b);JSM.AddVertexToBody(a,-f,-e,+b);JSM.AddVertexToBody(a,+f,-e,-b);JSM.AddVertexToBody(a,-f,-e,-b);JSM.AddVertexToBody(a,+c,+g,+h);JSM.AddVertexToBody(a,+c,+g,-h);JSM.AddVertexToBody(a,+c,-g,+h);JSM.AddVertexToBody(a,-c,+g,+h);JSM.AddVertexToBody(a,+c,-g,-h);JSM.AddVertexToBody(a,-c,+g,-h);JSM.AddVertexToBody(a,-c,-g,+h);JSM.AddVertexToBody(a,-c,-g,-h);JSM.AddVertexToBody(a,+g,+h,+c);JSM.AddVertexToBody(a,+g,-h,+c);JSM.AddVertexToBody(a,
-g,+h,+c);JSM.AddVertexToBody(a,+g,+h,-c);JSM.AddVertexToBody(a,-g,-h,+c);JSM.AddVertexToBody(a,+g,-h,-c);JSM.AddVertexToBody(a,-g,+h,-c);JSM.AddVertexToBody(a,-g,-h,-c);JSM.AddVertexToBody(a,+h,+c,+g);JSM.AddVertexToBody(a,-h,+c,+g);JSM.AddVertexToBody(a,+h,+c,-g);JSM.AddVertexToBody(a,+h,-c,+g);JSM.AddVertexToBody(a,-h,+c,-g);JSM.AddVertexToBody(a,-h,-c,+g);JSM.AddVertexToBody(a,+h,-c,-g);JSM.AddVertexToBody(a,-h,-c,-g);JSM.AddVertexToBody(a,+l,2,+k);JSM.AddVertexToBody(a,+l,2,-k);JSM.AddVertexToBody(a,
+l,-2,+k);JSM.AddVertexToBody(a,-l,2,+k);JSM.AddVertexToBody(a,+l,-2,-k);JSM.AddVertexToBody(a,-l,2,-k);JSM.AddVertexToBody(a,-l,-2,+k);JSM.AddVertexToBody(a,-l,-2,-k);JSM.AddVertexToBody(a,2,+k,+l);JSM.AddVertexToBody(a,2,-k,+l);JSM.AddVertexToBody(a,-2,+k,+l);JSM.AddVertexToBody(a,2,+k,-l);JSM.AddVertexToBody(a,-2,-k,+l);JSM.AddVertexToBody(a,2,-k,-l);JSM.AddVertexToBody(a,-2,+k,-l);JSM.AddVertexToBody(a,-2,-k,-l);JSM.AddVertexToBody(a,+k,+l,2);JSM.AddVertexToBody(a,-k,+l,2);JSM.AddVertexToBody(a,
+k,+l,-2);JSM.AddVertexToBody(a,+k,-l,2);JSM.AddVertexToBody(a,-k,+l,-2);JSM.AddVertexToBody(a,-k,-l,2);JSM.AddVertexToBody(a,+k,-l,-2);JSM.AddVertexToBody(a,-k,-l,-2);JSM.AddVertexToBody(a,+b,3,+m);JSM.AddVertexToBody(a,+b,3,-m);JSM.AddVertexToBody(a,+b,-3,+m);JSM.AddVertexToBody(a,-b,3,+m);JSM.AddVertexToBody(a,+b,-3,-m);JSM.AddVertexToBody(a,-b,3,-m);JSM.AddVertexToBody(a,-b,-3,+m);JSM.AddVertexToBody(a,-b,-3,-m);JSM.AddVertexToBody(a,3,+m,+b);JSM.AddVertexToBody(a,3,-m,+b);JSM.AddVertexToBody(a,
-3,+m,+b);JSM.AddVertexToBody(a,3,+m,-b);JSM.AddVertexToBody(a,-3,-m,+b);JSM.AddVertexToBody(a,3,-m,-b);JSM.AddVertexToBody(a,-3,+m,-b);JSM.AddVertexToBody(a,-3,-m,-b);JSM.AddVertexToBody(a,+m,+b,3);JSM.AddVertexToBody(a,-m,+b,3);JSM.AddVertexToBody(a,+m,+b,-3);JSM.AddVertexToBody(a,+m,-b,3);JSM.AddVertexToBody(a,-m,+b,-3);JSM.AddVertexToBody(a,-m,-b,3);JSM.AddVertexToBody(a,+m,-b,-3);JSM.AddVertexToBody(a,-m,-b,-3);JSM.AddPolygonToBody(a,[0,3,6,2]);JSM.AddPolygonToBody(a,[1,4,7,5]);JSM.AddPolygonToBody(a,
[8,11,14,10]);JSM.AddPolygonToBody(a,[9,12,15,13]);JSM.AddPolygonToBody(a,[16,19,22,18]);JSM.AddPolygonToBody(a,[17,20,23,21]);JSM.AddPolygonToBody(a,[24,72,96,48]);JSM.AddPolygonToBody(a,[25,49,97,73]);JSM.AddPolygonToBody(a,[26,50,98,74]);JSM.AddPolygonToBody(a,[27,51,99,75]);JSM.AddPolygonToBody(a,[28,76,100,52]);JSM.AddPolygonToBody(a,[29,77,101,53]);JSM.AddPolygonToBody(a,[30,78,102,54]);JSM.AddPolygonToBody(a,[31,55,103,79]);JSM.AddPolygonToBody(a,[32,80,104,56]);JSM.AddPolygonToBody(a,[33,
57,105,81]);JSM.AddPolygonToBody(a,[34,58,106,82]);JSM.AddPolygonToBody(a,[35,59,107,83]);JSM.AddPolygonToBody(a,[36,84,108,60]);JSM.AddPolygonToBody(a,[37,85,109,61]);JSM.AddPolygonToBody(a,[38,86,110,62]);JSM.AddPolygonToBody(a,[39,63,111,87]);JSM.AddPolygonToBody(a,[40,88,112,64]);JSM.AddPolygonToBody(a,[41,65,113,89]);JSM.AddPolygonToBody(a,[42,66,114,90]);JSM.AddPolygonToBody(a,[43,67,115,91]);JSM.AddPolygonToBody(a,[44,92,116,68]);JSM.AddPolygonToBody(a,[45,93,117,69]);JSM.AddPolygonToBody(a,
[46,94,118,70]);JSM.AddPolygonToBody(a,[47,71,119,95]);JSM.AddPolygonToBody(a,[0,24,48,51,27,3]);JSM.AddPolygonToBody(a,[1,5,29,53,49,25]);JSM.AddPolygonToBody(a,[2,6,30,54,50,26]);JSM.AddPolygonToBody(a,[4,28,52,55,31,7]);JSM.AddPolygonToBody(a,[8,32,56,59,35,11]);JSM.AddPolygonToBody(a,[9,13,37,61,57,33]);JSM.AddPolygonToBody(a,[10,14,38,62,58,34]);JSM.AddPolygonToBody(a,[12,36,60,63,39,15]);JSM.AddPolygonToBody(a,[16,40,64,67,43,19]);JSM.AddPolygonToBody(a,[17,21,45,69,65,41]);JSM.AddPolygonToBody(a,
[18,22,46,70,66,42]);JSM.AddPolygonToBody(a,[20,44,68,71,47,23]);JSM.AddPolygonToBody(a,[72,112,88,104,80,96]);JSM.AddPolygonToBody(a,[73,97,83,107,90,114]);JSM.AddPolygonToBody(a,[74,98,81,105,91,115]);JSM.AddPolygonToBody(a,[75,99,82,106,89,113]);JSM.AddPolygonToBody(a,[76,118,94,109,85,100]);JSM.AddPolygonToBody(a,[78,117,93,108,84,102]);JSM.AddPolygonToBody(a,[79,103,87,111,95,119]);JSM.AddPolygonToBody(a,[86,101,77,116,92,110]);JSM.AddPolygonToBody(a,[0,2,26,74,115,67,64,112,72,24]);JSM.AddPolygonToBody(a,
[1,25,73,114,66,70,118,76,28,4]);JSM.AddPolygonToBody(a,[3,27,75,113,65,69,117,78,30,6]);JSM.AddPolygonToBody(a,[5,7,31,79,119,71,68,116,77,29]);JSM.AddPolygonToBody(a,[8,10,34,82,99,51,48,96,80,32]);JSM.AddPolygonToBody(a,[9,33,81,98,50,54,102,84,36,12]);JSM.AddPolygonToBody(a,[11,35,83,97,49,53,101,86,38,14]);JSM.AddPolygonToBody(a,[13,15,39,87,103,55,52,100,85,37]);JSM.AddPolygonToBody(a,[16,18,42,90,107,59,56,104,88,40]);JSM.AddPolygonToBody(a,[17,41,89,106,58,62,110,92,44,20]);JSM.AddPolygonToBody(a,
[19,43,91,105,57,61,109,94,46,22]);JSM.AddPolygonToBody(a,[21,23,47,95,111,63,60,108,93,45]);return a};
JSM.GenerateSnubDodecahedron=function(){var a=new JSM.Body,b=(1+Math.sqrt(5))/2,c=Math.pow(b/2+0.5*Math.sqrt(b-5/27),1/3)+Math.pow(b/2-0.5*Math.sqrt(b-5/27),1/3),d=c-1/c,e=c*b+Math.pow(b,2)+b/c,c=2*d,f=2*e,g=d+e/b+b,h=-(d*b)+e+1/b,l=d/b+e*b-1,k=-(d/b)+e*b+1,m=-d+e/b-b,n=d*b+e-1/b,p=-(d/b)+e*b-1,q=d-e/b-b,r=d*b+e+1/b,s=d+e/b-b,x=d*b-e+1/b,b=d/b+e*b+1;JSM.AddVertexToBody(a,+c,2,-f);JSM.AddVertexToBody(a,+c,-2,+f);JSM.AddVertexToBody(a,-c,2,+f);JSM.AddVertexToBody(a,-c,-2,-f);JSM.AddVertexToBody(a,2,
-f,+c);JSM.AddVertexToBody(a,-2,+f,+c);JSM.AddVertexToBody(a,2,+f,-c);JSM.AddVertexToBody(a,-2,-f,-c);JSM.AddVertexToBody(a,-f,+c,2);JSM.AddVertexToBody(a,+f,+c,-2);JSM.AddVertexToBody(a,+f,-c,2);JSM.AddVertexToBody(a,-f,-c,-2);JSM.AddVertexToBody(a,+g,+h,-l);JSM.AddVertexToBody(a,+g,-h,+l);JSM.AddVertexToBody(a,-g,+h,+l);JSM.AddVertexToBody(a,-g,-h,-l);JSM.AddVertexToBody(a,+h,-l,+g);JSM.AddVertexToBody(a,-h,+l,+g);JSM.AddVertexToBody(a,+h,+l,-g);JSM.AddVertexToBody(a,-h,-l,-g);JSM.AddVertexToBody(a,
-l,+g,+h);JSM.AddVertexToBody(a,+l,+g,-h);JSM.AddVertexToBody(a,+l,-g,+h);JSM.AddVertexToBody(a,-l,-g,-h);JSM.AddVertexToBody(a,+k,+m,-n);JSM.AddVertexToBody(a,+k,-m,+n);JSM.AddVertexToBody(a,-k,+m,+n);JSM.AddVertexToBody(a,-k,-m,-n);JSM.AddVertexToBody(a,+m,-n,+k);JSM.AddVertexToBody(a,-m,+n,+k);JSM.AddVertexToBody(a,+m,+n,-k);JSM.AddVertexToBody(a,-m,-n,-k);JSM.AddVertexToBody(a,-n,+k,+m);JSM.AddVertexToBody(a,+n,+k,-m);JSM.AddVertexToBody(a,+n,-k,+m);JSM.AddVertexToBody(a,-n,-k,-m);JSM.AddVertexToBody(a,
+p,+q,-r);JSM.AddVertexToBody(a,+p,-q,+r);JSM.AddVertexToBody(a,-p,+q,+r);JSM.AddVertexToBody(a,-p,-q,-r);JSM.AddVertexToBody(a,+q,-r,+p);JSM.AddVertexToBody(a,-q,+r,+p);JSM.AddVertexToBody(a,+q,+r,-p);JSM.AddVertexToBody(a,-q,-r,-p);JSM.AddVertexToBody(a,-r,+p,+q);JSM.AddVertexToBody(a,+r,+p,-q);JSM.AddVertexToBody(a,+r,-p,+q);JSM.AddVertexToBody(a,-r,-p,-q);JSM.AddVertexToBody(a,+s,+x,-b);JSM.AddVertexToBody(a,+s,-x,+b);JSM.AddVertexToBody(a,-s,+x,+b);JSM.AddVertexToBody(a,-s,-x,-b);JSM.AddVertexToBody(a,
+x,-b,+s);JSM.AddVertexToBody(a,-x,+b,+s);JSM.AddVertexToBody(a,+x,+b,-s);JSM.AddVertexToBody(a,-x,-b,-s);JSM.AddVertexToBody(a,-b,+s,+x);JSM.AddVertexToBody(a,+b,+s,-x);JSM.AddVertexToBody(a,+b,-s,+x);JSM.AddVertexToBody(a,-b,-s,-x);JSM.AddPolygonToBody(a,[0,3,51]);JSM.AddPolygonToBody(a,[0,30,12]);JSM.AddPolygonToBody(a,[0,48,3]);JSM.AddPolygonToBody(a,[0,51,30]);JSM.AddPolygonToBody(a,[1,2,50]);JSM.AddPolygonToBody(a,[1,28,13]);JSM.AddPolygonToBody(a,[1,49,2]);JSM.AddPolygonToBody(a,[1,50,28]);
JSM.AddPolygonToBody(a,[2,29,14]);JSM.AddPolygonToBody(a,[2,49,29]);JSM.AddPolygonToBody(a,[3,31,15]);JSM.AddPolygonToBody(a,[3,48,31]);JSM.AddPolygonToBody(a,[4,7,55]);JSM.AddPolygonToBody(a,[4,34,16]);JSM.AddPolygonToBody(a,[4,52,7]);JSM.AddPolygonToBody(a,[4,55,34]);JSM.AddPolygonToBody(a,[5,6,54]);JSM.AddPolygonToBody(a,[5,32,17]);JSM.AddPolygonToBody(a,[5,53,6]);JSM.AddPolygonToBody(a,[5,54,32]);JSM.AddPolygonToBody(a,[6,33,18]);JSM.AddPolygonToBody(a,[6,53,33]);JSM.AddPolygonToBody(a,[7,35,
19]);JSM.AddPolygonToBody(a,[7,52,35]);JSM.AddPolygonToBody(a,[8,11,59]);JSM.AddPolygonToBody(a,[8,26,20]);JSM.AddPolygonToBody(a,[8,56,11]);JSM.AddPolygonToBody(a,[8,59,26]);JSM.AddPolygonToBody(a,[9,10,58]);JSM.AddPolygonToBody(a,[9,24,21]);JSM.AddPolygonToBody(a,[9,57,10]);JSM.AddPolygonToBody(a,[9,58,24]);JSM.AddPolygonToBody(a,[10,25,22]);JSM.AddPolygonToBody(a,[10,57,25]);JSM.AddPolygonToBody(a,[11,27,23]);JSM.AddPolygonToBody(a,[11,56,27]);JSM.AddPolygonToBody(a,[12,18,21]);JSM.AddPolygonToBody(a,
[12,21,24]);JSM.AddPolygonToBody(a,[12,30,18]);JSM.AddPolygonToBody(a,[13,16,22]);JSM.AddPolygonToBody(a,[13,22,25]);JSM.AddPolygonToBody(a,[13,28,16]);JSM.AddPolygonToBody(a,[14,17,20]);JSM.AddPolygonToBody(a,[14,20,26]);JSM.AddPolygonToBody(a,[14,29,17]);JSM.AddPolygonToBody(a,[15,19,23]);JSM.AddPolygonToBody(a,[15,23,27]);JSM.AddPolygonToBody(a,[15,31,19]);JSM.AddPolygonToBody(a,[16,34,22]);JSM.AddPolygonToBody(a,[17,32,20]);JSM.AddPolygonToBody(a,[18,33,21]);JSM.AddPolygonToBody(a,[19,35,23]);
JSM.AddPolygonToBody(a,[24,58,36]);JSM.AddPolygonToBody(a,[25,57,37]);JSM.AddPolygonToBody(a,[26,59,38]);JSM.AddPolygonToBody(a,[27,56,39]);JSM.AddPolygonToBody(a,[28,50,40]);JSM.AddPolygonToBody(a,[29,49,41]);JSM.AddPolygonToBody(a,[30,51,42]);JSM.AddPolygonToBody(a,[31,48,43]);JSM.AddPolygonToBody(a,[32,54,44]);JSM.AddPolygonToBody(a,[33,53,45]);JSM.AddPolygonToBody(a,[34,55,46]);JSM.AddPolygonToBody(a,[35,52,47]);JSM.AddPolygonToBody(a,[36,43,48]);JSM.AddPolygonToBody(a,[36,46,43]);JSM.AddPolygonToBody(a,
[36,58,46]);JSM.AddPolygonToBody(a,[37,41,49]);JSM.AddPolygonToBody(a,[37,45,41]);JSM.AddPolygonToBody(a,[37,57,45]);JSM.AddPolygonToBody(a,[38,40,50]);JSM.AddPolygonToBody(a,[38,47,40]);JSM.AddPolygonToBody(a,[38,59,47]);JSM.AddPolygonToBody(a,[39,42,51]);JSM.AddPolygonToBody(a,[39,44,42]);JSM.AddPolygonToBody(a,[39,56,44]);JSM.AddPolygonToBody(a,[40,47,52]);JSM.AddPolygonToBody(a,[41,45,53]);JSM.AddPolygonToBody(a,[42,44,54]);JSM.AddPolygonToBody(a,[43,46,55]);JSM.AddPolygonToBody(a,[0,12,24,36,
48]);JSM.AddPolygonToBody(a,[1,13,25,37,49]);JSM.AddPolygonToBody(a,[2,14,26,38,50]);JSM.AddPolygonToBody(a,[3,15,27,39,51]);JSM.AddPolygonToBody(a,[4,16,28,40,52]);JSM.AddPolygonToBody(a,[5,17,29,41,53]);JSM.AddPolygonToBody(a,[6,18,30,42,54]);JSM.AddPolygonToBody(a,[7,19,31,43,55]);JSM.AddPolygonToBody(a,[8,20,32,44,56]);JSM.AddPolygonToBody(a,[9,21,33,45,57]);JSM.AddPolygonToBody(a,[10,22,34,46,58]);JSM.AddPolygonToBody(a,[11,23,35,47,59]);return a};
JSM.AddCumulatedPolygonToBody=function(a,b,c){var d=new JSM.Coord(0,0,0),e=new JSM.Vector(0,0,0),f=d,g=[],h;for(h=0;h<b.length;h++)g.push(a.GetVertexPosition(b[h]));h=JSM.CalculateCentroid(g);g=JSM.CalculateNormal(g);f.Set(h.x,h.y,h.z);e.Set(g.x,g.y,g.z);d=JSM.CoordOffset(d,e,c);c=a.VertexCount();JSM.AddVertexToBody(a,d.x,d.y,d.z);d=b.length;for(e=0;e<d;e++)f=b[e],g=b[e<d-1?e+1:0],JSM.AddPolygonToBody(a,[f,g,c])};
JSM.GenerateCumulatedTetrahedron=function(a){var b=new JSM.Body;b.AddVertex(new JSM.BodyVertex(new JSM.Coord(1,1,1)));b.AddVertex(new JSM.BodyVertex(new JSM.Coord(-1,-1,1)));b.AddVertex(new JSM.BodyVertex(new JSM.Coord(-1,1,-1)));b.AddVertex(new JSM.BodyVertex(new JSM.Coord(1,-1,-1)));a*=2*Math.sqrt(2);JSM.AddCumulatedPolygonToBody(b,[0,1,3],a);JSM.AddCumulatedPolygonToBody(b,[0,2,1],a);JSM.AddCumulatedPolygonToBody(b,[0,3,2],a);JSM.AddCumulatedPolygonToBody(b,[1,2,3],a);return b};
JSM.GenerateCumulatedHexahedron=function(a){var b=new JSM.Body;JSM.AddVertexToBody(b,1,1,1);JSM.AddVertexToBody(b,1,1,-1);JSM.AddVertexToBody(b,1,-1,1);JSM.AddVertexToBody(b,-1,1,1);JSM.AddVertexToBody(b,1,-1,-1);JSM.AddVertexToBody(b,-1,1,-1);JSM.AddVertexToBody(b,-1,-1,1);JSM.AddVertexToBody(b,-1,-1,-1);a*=2;JSM.AddCumulatedPolygonToBody(b,[0,1,5,3],a);JSM.AddCumulatedPolygonToBody(b,[0,2,4,1],a);JSM.AddCumulatedPolygonToBody(b,[0,3,6,2],a);JSM.AddCumulatedPolygonToBody(b,[1,4,7,5],a);JSM.AddCumulatedPolygonToBody(b,
[2,6,7,4],a);JSM.AddCumulatedPolygonToBody(b,[3,5,7,6],a);return b};
JSM.GenerateCumulatedOctahedron=function(a){var b=new JSM.Body;JSM.AddVertexToBody(b,1,0,0);JSM.AddVertexToBody(b,-1,0,0);JSM.AddVertexToBody(b,0,1,0);JSM.AddVertexToBody(b,0,-1,0);JSM.AddVertexToBody(b,0,0,1);JSM.AddVertexToBody(b,0,0,-1);a*=Math.sqrt(2);JSM.AddCumulatedPolygonToBody(b,[0,2,4],a);JSM.AddCumulatedPolygonToBody(b,[0,3,5],a);JSM.AddCumulatedPolygonToBody(b,[0,4,3],a);JSM.AddCumulatedPolygonToBody(b,[0,5,2],a);JSM.AddCumulatedPolygonToBody(b,[1,2,5],a);JSM.AddCumulatedPolygonToBody(b,
[1,3,4],a);JSM.AddCumulatedPolygonToBody(b,[1,4,2],a);JSM.AddCumulatedPolygonToBody(b,[1,5,3],a);return b};
JSM.GenerateCumulatedDodecahedron=function(a){var b=new JSM.Body,c=(1+Math.sqrt(5))/2,d=1/c;JSM.AddVertexToBody(b,1,1,1);JSM.AddVertexToBody(b,1,1,-1);JSM.AddVertexToBody(b,1,-1,1);JSM.AddVertexToBody(b,-1,1,1);JSM.AddVertexToBody(b,1,-1,-1);JSM.AddVertexToBody(b,-1,1,-1);JSM.AddVertexToBody(b,-1,-1,1);JSM.AddVertexToBody(b,-1,-1,-1);JSM.AddVertexToBody(b,0,+d,+c);JSM.AddVertexToBody(b,0,+d,-c);JSM.AddVertexToBody(b,0,-d,+c);JSM.AddVertexToBody(b,0,-d,-c);JSM.AddVertexToBody(b,+d,+c,0);JSM.AddVertexToBody(b,
+d,-c,0);JSM.AddVertexToBody(b,-d,+c,0);JSM.AddVertexToBody(b,-d,-c,0);JSM.AddVertexToBody(b,+c,0,+d);JSM.AddVertexToBody(b,-c,0,+d);JSM.AddVertexToBody(b,+c,0,-d);JSM.AddVertexToBody(b,-c,0,-d);a*=Math.sqrt(5)-1;JSM.AddCumulatedPolygonToBody(b,[0,8,10,2,16],a);JSM.AddCumulatedPolygonToBody(b,[0,16,18,1,12],a);JSM.AddCumulatedPolygonToBody(b,[0,12,14,3,8],a);JSM.AddCumulatedPolygonToBody(b,[1,9,5,14,12],a);JSM.AddCumulatedPolygonToBody(b,[1,18,4,11,9],a);JSM.AddCumulatedPolygonToBody(b,[2,10,6,15,
13],a);JSM.AddCumulatedPolygonToBody(b,[2,13,4,18,16],a);JSM.AddCumulatedPolygonToBody(b,[3,14,5,19,17],a);JSM.AddCumulatedPolygonToBody(b,[3,17,6,10,8],a);JSM.AddCumulatedPolygonToBody(b,[4,13,15,7,11],a);JSM.AddCumulatedPolygonToBody(b,[5,9,11,7,19],a);JSM.AddCumulatedPolygonToBody(b,[6,17,19,7,15],a);return b};
JSM.GenerateCumulatedIcosahedron=function(a){var b=new JSM.Body,c=(1+Math.sqrt(5))/2;JSM.AddVertexToBody(b,0,1,+c);JSM.AddVertexToBody(b,0,1,-c);JSM.AddVertexToBody(b,0,-1,+c);JSM.AddVertexToBody(b,0,-1,-c);JSM.AddVertexToBody(b,1,+c,0);JSM.AddVertexToBody(b,1,-c,0);JSM.AddVertexToBody(b,-1,+c,0);JSM.AddVertexToBody(b,-1,-c,0);JSM.AddVertexToBody(b,+c,0,1);JSM.AddVertexToBody(b,-c,0,1);JSM.AddVertexToBody(b,+c,0,-1);JSM.AddVertexToBody(b,-c,0,-1);a*=2;JSM.AddCumulatedPolygonToBody(b,[0,2,8],a);JSM.AddCumulatedPolygonToBody(b,
[0,4,6],a);JSM.AddCumulatedPolygonToBody(b,[0,6,9],a);JSM.AddCumulatedPolygonToBody(b,[0,8,4],a);JSM.AddCumulatedPolygonToBody(b,[0,9,2],a);JSM.AddCumulatedPolygonToBody(b,[1,3,11],a);JSM.AddCumulatedPolygonToBody(b,[1,4,10],a);JSM.AddCumulatedPolygonToBody(b,[1,6,4],a);JSM.AddCumulatedPolygonToBody(b,[1,10,3],a);JSM.AddCumulatedPolygonToBody(b,[1,11,6],a);JSM.AddCumulatedPolygonToBody(b,[2,5,8],a);JSM.AddCumulatedPolygonToBody(b,[2,7,5],a);JSM.AddCumulatedPolygonToBody(b,[2,9,7],a);JSM.AddCumulatedPolygonToBody(b,
[3,5,7],a);JSM.AddCumulatedPolygonToBody(b,[3,7,11],a);JSM.AddCumulatedPolygonToBody(b,[3,10,5],a);JSM.AddCumulatedPolygonToBody(b,[4,8,10],a);JSM.AddCumulatedPolygonToBody(b,[6,11,9],a);JSM.AddCumulatedPolygonToBody(b,[5,10,8],a);JSM.AddCumulatedPolygonToBody(b,[7,9,11],a);return b};JSM.GenerateTetrakisHexahedron=function(){return JSM.GenerateCumulatedHexahedron(0.25)};JSM.GenerateRhombicDodecahedron=function(){return JSM.GenerateCumulatedHexahedron(0.5)};
JSM.GeneratePentakisDodecahedron=function(){var a=Math.sqrt((65+22*Math.sqrt(5))/5)/19;return JSM.GenerateCumulatedDodecahedron(a)};JSM.GenerateSmallStellatedDodecahedron=function(){var a=Math.sqrt((5+2*Math.sqrt(5))/5);return JSM.GenerateCumulatedDodecahedron(a)};JSM.GenerateGreatDodecahedron=function(){var a=Math.sqrt(3)*(Math.sqrt(5)-3)/6;return JSM.GenerateCumulatedIcosahedron(a)};JSM.GenerateSmallTriambicIcosahedron=function(){var a=Math.sqrt(15)/15;return JSM.GenerateCumulatedIcosahedron(a)};
JSM.GenerateGreatStellatedDodecahedron=function(){var a=Math.sqrt(3)*(3+Math.sqrt(5))/6;return JSM.GenerateCumulatedIcosahedron(a)};JSM.GenerateSmallTriakisOctahedron=function(){var a=Math.sqrt(3)-2*Math.sqrt(6)/3;return JSM.GenerateCumulatedOctahedron(a)};JSM.GenerateStellaOctangula=function(){var a=Math.sqrt(6)/3;return JSM.GenerateCumulatedOctahedron(a)};JSM.GenerateTriakisTetrahedron=function(){var a=Math.sqrt(6)/15;return JSM.GenerateCumulatedTetrahedron(a)};
JSM.LegoDimensions=function(){this.legoWidth=0.78;this.legoSmallHeight=0.32;this.legoLargeHeight=0.96;this.legoWallWidth=0.16;this.legoCylinderWidth=0.5;this.legoCylinderHeight=0.17;this.legoBottomSmallCylinderWidth=0.3;this.legoBottomLargeCylinderWidth=0.6;this.legoBottomLargeCylinderWallWidth=0.1};
JSM.GenerateLegoBrick=function(a,b,c,d,e,f,g){function h(a,b){var c,d;for(c=0;c<a.VertexCount();c++)d=a.GetVertex(c),d.position=JSM.CoordAdd(d.position,b)}var l=new JSM.LegoDimensions,k=new JSM.Vector(0,0,1),m=l.legoWidth,n=l.legoLargeHeight;c||(n=l.legoSmallHeight);c=l.legoWallWidth;var p=l.legoCylinderWidth,q=l.legoCylinderHeight,r=l.legoBottomSmallCylinderWidth,s=l.legoBottomLargeCylinderWidth,x=l.legoBottomLargeCylinderWallWidth,v=[];v.push(new JSM.Coord(0,0,0));v.push(new JSM.Coord(m*a,0,0));
v.push(new JSM.Coord(m*a,m*b,0));v.push(new JSM.Coord(0,m*b,0));var l=new JSM.Body,t=JSM.GeneratePrismShell(v,k,n-c,c,!0);l.Merge(t);for(t=0;4>t;t++)v[t].z=n-c;t=JSM.GeneratePrism(v,k,c,!0);l.Merge(t);if(d)for(t=0;t<a;t++)for(v=0;v<b;v++)d=new JSM.Coord(m*t+m/2,m*v+m/2,n+q/2),k=JSM.GenerateCylinder(p/2,q,f,!0,g),h(k,d),l.Merge(k);if(e)if(1===a&&1<b||1===b&&1<a){e=b;p=!0;a>b&&(e=a,p=!1);for(t=0;t<e-1;t++)d=p?new JSM.Coord(m/2,m*(t+1),(n-c)/2):new JSM.Coord(m*(t+1),m/2,(n-c)/2),k=JSM.GenerateCylinder(r/
2,n-c,f,!0,g),h(k,d),l.Merge(k)}else if(1<a&&1<b)for(t=0;t<a-1;t++)for(v=0;v<b-1;v++)d=new JSM.Coord(m*(t+1),m*(v+1),(n-c)/2),k=JSM.GenerateCylinderShell(s/2,n-c,x,f,!0,g),h(k,d),l.Merge(k);l.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return l};
JSM.GenerateConvexHullBody=function(a){var b=new JSM.Body,c=JSM.ConvexHull3D(a),d={},e,f,g,h;for(e=0;e<c.length;e++){g=c[e];for(f=0;f<g.length;f++)h=g[f],h in d||(d[h]=b.VertexCount(),b.AddVertex(new JSM.BodyVertex(a[h])))}for(e=0;e<c.length;e++){g=c[e];a=[];for(f=0;f<g.length;f++)h=g[f],a.push(d[h]);b.AddPolygon(new JSM.BodyPolygon(a))}return b};
JSM.GenerateSuperShape=function(a,b,c,d,e,f,g,h,l,k,m,n,p,q){function r(a){var b=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z),c=Math.asin(a.z/b);a=Math.atan2(a.y,a.x);return[b,c,a]}function s(a,b,c,d,e,f,g){b=Math.abs(Math.cos(d*a/4)/b);a=Math.abs(Math.sin(d*a/4)/c);return Math.pow(Math.pow(b,f)+Math.pow(a,g),-1/e)}function x(p,q){var x=new JSM.Coord(0,0,0),t=s(p,g,h,l,k,m,n),r=s(q,a,b,c,d,e,f);x.x=r*Math.cos(q)*t*Math.cos(p);x.y=r*Math.sin(q)*t*Math.cos(p);x.z=t*Math.sin(p);return x}p=JSM.GenerateSphere(1,
p,q);var v,t;for(q=0;q<p.VertexCount();q++)v=p.GetVertex(q),t=v.position,t=r(t),t=x(t[1],t[2]),v.SetPosition(t);return p};
JSM.OrderPolygons=function(a,b,c){var d=[],e=[],f=[],g=[],h=[],l=[],k=[],m=a.PolygonCount(),n,p;for(n=0;n<m;n++){l.push(n);k.push([]);for(p=0;p<m;p++)k[n].push(null)}(function(){var k=JSM.VectorNormalize(JSM.CoordSub(c,b)),k=JSM.GetPlaneFromCoordAndDirection(b,k),l,m,n,p,t,y;for(l=0;l<a.PolygonCount();l++){t=JSM.Inf;y=-JSM.Inf;n=a.GetPolygon(l);for(m=0;m<n.VertexIndexCount();m++)p=a.GetVertexPosition(n.GetVertexIndex(m)),p=JSM.CoordPlaneDistance(p,k),JSM.IsLower(p,t)&&(t=p),JSM.IsGreater(p,y)&&(y=
p);d.push(t);e.push(y);m=a.GetPolygon(l);n=new JSM.Coord(0,0,0);y=t=void 0;for(t=0;t<m.VertexIndexCount();t++)y=a.GetVertexPosition(m.GetVertexIndex(t)),n=JSM.CoordAdd(n,y);m=n=JSM.VectorMultiply(n,1/m.VertexIndexCount());n=JSM.CoordPlaneDistance(m,k);f.push(m);g.push(n);n=JSM.CalculateBodyPolygonNormal(a,l);t=JSM.VectorNormalize(JSM.CoordSub(m,b));t=JSM.VectorDot(n,t);JSM.IsGreaterOrEqual(t,0)&&(n=JSM.VectorMultiply(n,-1));m=JSM.GetPlaneFromCoordAndDirection(m,n);h.push(m)}})();(function(){var a=
l.length,b,c;for(b=0;b<a-1;b++)for(c=0;c<a-b-1;c++){var d;d=l[c];var f=l[c+1];d=JSM.IsLower(e[d],e[f])?!0:JSM.IsEqual(e[d],e[f])&&JSM.IsLower(g[d],g[f])?!0:!1;if(d){d=l;var f=c+1,h=d[c];d[c]=d[f];d[f]=h}}})();(function(){var b=l.length,c,f;for(c=0;c<b-1;c++)for(f=0;f<b-c-1;f++){var g;g=l[f];var m=l[f+1];if(null!==k[g][m])g=k[g][m];else{var n;if(n=JSM.IsLowerOrEqual(d[g],e[m])){var p=m;n=h[g];for(var F=h[p],C=void 0,u=void 0,H=!0,z=a.GetPolygon(g),C=0;C<z.VertexIndexCount();C++)if(u=a.GetVertexPosition(z.GetVertexIndex(C)),
"CoordInFrontOfPlane"===JSM.CoordPlanePosition(u,F)){H=!1;break}if(H)n=!1;else{F=!0;p=a.GetPolygon(p);for(C=0;C<p.VertexIndexCount();C++)if(u=a.GetVertexPosition(p.GetVertexIndex(C)),"CoordAtBackOfPlane"===JSM.CoordPlanePosition(u,n)){F=!1;break}n=F?!1:!0}}g=n?k[g][m]=!0:k[g][m]=!1}g&&(g=l,m=f+1,n=g[f],g[f]=g[m],g[m]=n)}})();return l};JSM.CanvasDrawer=function(a){this.canvas=a;this.context=this.canvas.getContext("2d")};JSM.CanvasDrawer.prototype.GetWidth=function(){return this.canvas.width};
JSM.CanvasDrawer.prototype.GetHeight=function(){return this.canvas.height};JSM.CanvasDrawer.prototype.BeginPath=function(){this.context.beginPath()};JSM.CanvasDrawer.prototype.EndPath=function(){this.context.stroke()};JSM.CanvasDrawer.prototype.Clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.fillStyle="#ffffff";this.context.fillRect(0,0,this.canvas.width,this.canvas.height)};
JSM.CanvasDrawer.prototype.DrawLine=function(a,b){this.context.moveTo(a.x,this.canvas.height-a.y);this.context.lineTo(b.x,this.canvas.height-b.y)};
JSM.CanvasDrawer.prototype.DrawPolygon=function(a,b){var c=this.context,d=JSM.HexColorToRGBComponents(b);c.fillStyle="rgb("+d[0]+","+d[1]+","+d[2]+")";this.context.beginPath();for(var e,c=0;c<a.VertexCount();c++)d=a.GetVertex(c),0===c?this.context.moveTo(d.x,this.canvas.height-d.y):this.context.lineTo(d.x,this.canvas.height-d.y);this.context.closePath();this.context.fill();this.BeginPath();for(c=0;c<a.VertexCount();c++)d=a.GetVertex(c),e=a.GetVertex(c<a.VertexCount()-1?c+1:0),this.DrawLine(d,e);this.EndPath()};
JSM.SVGDrawer=function(a){this.svgObject=a;this.svgNameSpace="http://www.w3.org/2000/svg"};JSM.SVGDrawer.prototype.GetWidth=function(){return this.svgObject.getAttribute("width")};JSM.SVGDrawer.prototype.GetHeight=function(){return this.svgObject.getAttribute("height")};JSM.SVGDrawer.prototype.BeginPath=function(){};JSM.SVGDrawer.prototype.EndPath=function(){};JSM.SVGDrawer.prototype.Clear=function(){for(;this.svgObject.lastChild;)this.svgObject.removeChild(this.svgObject.lastChild)};
JSM.SVGDrawer.prototype.DrawLine=function(a,b){var c=document.createElementNS(this.svgNameSpace,"line"),d=this.GetHeight();c.setAttributeNS(null,"stroke","black");c.setAttributeNS(null,"x1",a.x);c.setAttributeNS(null,"y1",d-a.y);c.setAttributeNS(null,"x2",b.x);c.setAttributeNS(null,"y2",d-b.y);this.svgObject.appendChild(c)};
JSM.SVGDrawer.prototype.DrawPolygon=function(a,b){var c="",d=this.GetHeight(),e,f;for(e=0;e<a.VertexCount();e++)f=a.GetVertex(e),c=c+f.x+", "+(d-f.y),e<a.VertexCount()-1&&(c+=", ");d=document.createElementNS(this.svgNameSpace,"polygon");d.setAttributeNS(null,"points",c);d.setAttributeNS(null,"fill",function(a){a=JSM.HexColorToRGBComponents(a);return"rgb("+a[0]+","+a[1]+","+a[2]+")"}(b));d.setAttributeNS(null,"fill-opacity","1.0");d.setAttributeNS(null,"stroke","black");this.svgObject.appendChild(d)};
JSM.DrawProjectedBody=function(a,b,c,d,e,f){function g(b){var c=new JSM.Polygon2D,d,e,f;for(d=0;d<b.VertexIndexCount();d++)e=a.GetVertexPosition(b.GetVertexIndex(d)),f=JSM.Project(e,l,k,m,n*JSM.DegRad,p,q,r,s),e=f.x,f=f.y,c.AddVertex(e,f);return c}e&&f.Clear();e=f.GetWidth();var h=f.GetHeight(),l=c.eye,k=c.center,m=c.up,n=c.fieldOfView,p=e/h,q=c.nearClippingPlane,r=c.farClippingPlane,s=[0,0,e,h];if("HiddenLinePainter"==d){h=JSM.OrderPolygons(a,l,k);if(void 0===b||null===b)b=new JSM.Materials;for(c=
0;c<h.length;c++)e=a.GetPolygon(h[c]),d=g(e),e=e.GetMaterialIndex(),e=b.GetMaterial(e).diffuse,f.DrawPolygon(d,e)}else if("HiddenLineFrontFacing"==d){if(void 0===b||null===b)b=new JSM.Materials;for(c=0;c<a.PolygonCount();c++)e=a.GetPolygon(c),d=g(e),"CounterClockwise"==JSM.PolygonOrientation2D(d)&&(e=e.GetMaterialIndex(),e=b.GetMaterial(e).diffuse,f.DrawPolygon(d,e))}else if("Wireframe"==d){var x,v,t;f.BeginPath();var y=[];for(c=0;c<a.PolygonCount();c++){v=x=null;e=a.GetPolygon(c);h=e.VertexIndexCount();
for(b=0;b<=h;b++)t=e.GetVertexIndex(b%h),d=a.GetVertexPosition(t),d=JSM.Project(d,l,k,m,n*JSM.DegRad,p,q,r,s),null!==x&&(null!==v&&void 0===y[[v,t]])&&(f.DrawLine(x,d),y[[v,t]]=!0,y[[t,v]]=!0),v=t,x=d}f.EndPath()}return!0};
JSM.CatmullClarkSubdivisionOneIteration=function(a){var b=new JSM.Body,c=JSM.CalculateAdjacencyInfo(a);(function(){var d,e;for(d=0;d<c.verts.length;d++)e=a.GetVertex(d).position,b.AddVertex(new JSM.BodyVertex(new JSM.Coord(e.x,e.y,e.z)))})();var d=[];(function(){var e,g,h,l,k;for(e=0;e<c.pgons.length;e++){h=c.pgons[e];k=new JSM.Coord(0,0,0);for(g=0;g<h.verts.length;g++)l=a.GetVertex(h.verts[g]).position,k=JSM.CoordAdd(k,l);k=JSM.VectorMultiply(k,1/h.verts.length);d.push(b.AddVertex(new JSM.BodyVertex(k)))}})();
var e=[];(function(){var f,g,h,l,k;for(f=0;f<c.edges.length;f++){h=c.edges[f];l=new JSM.Coord(0,0,0);l=JSM.CoordAdd(l,JSM.VectorMultiply(a.GetVertex(h.vert1).position,0.25));l=JSM.CoordAdd(l,JSM.VectorMultiply(a.GetVertex(h.vert2).position,0.25));for(g=0;2>g;g++)k=0===g?h.pgon1:h.pgon2,-1===k&&(k=0===g?h.pgon2:h.pgon1),k=b.GetVertex(d[k]).position,l=JSM.CoordAdd(l,JSM.VectorMultiply(k,0.25));e.push(b.AddVertex(new JSM.BodyVertex(l)))}})();(function(){var e=[],g,h,l,k;for(l=0;l<c.edges.length;l++)g=
c.edges[l],h=JSM.MidCoord(a.GetVertex(g.vert1).position,a.GetVertex(g.vert2).position),e.push(h);var m,n,p;for(l=0;l<c.verts.length;l++){m=c.verts[l];p=new JSM.Coord(0,0,0);g=new JSM.Coord(0,0,0);n=1/m.pgons.length;for(k=0;k<m.pgons.length;k++)h=b.GetVertex(d[m.pgons[k]]).position,p=JSM.CoordAdd(p,JSM.VectorMultiply(h,n));n=1/m.edges.length;for(k=0;k<m.edges.length;k++)h=e[m.edges[k]],g=JSM.CoordAdd(g,JSM.VectorMultiply(h,n));m=m.edges.length;k=b.GetVertex(l).position;k.x=(p.x+2*g.x+(m-3)*k.x)/m;
k.y=(p.y+2*g.y+(m-3)*k.y)/m;k.z=(p.z+2*g.z+(m-3)*k.z)/m}})();(function(){var f,g,h,l,k,m,n,p;for(m=0;m<c.pgons.length;m++){p=c.pgons[m];f=p.verts.length;for(n=0;n<f;n++)g=p.pedges[n],h=p.pedges[(n+1)%f],l=d[m],g=e[g.index],k=JSM.GetPolyEdgeStartVertex(h,c),h=e[h.index],l=new JSM.BodyPolygon([l,g,k,h]),h=a.GetPolygon(m),l.material=h.material,l.curved=h.curved,b.AddPolygon(l)}})();return b};
JSM.CatmullClarkSubdivision=function(a,b){var c=a,d;for(d=0;d<b;d++)c=JSM.CatmullClarkSubdivisionOneIteration(c);return c};
JSM.SvgToModel=function(a,b,c){function d(a,b){function c(a,b,d,e,f,g){a=a.createSVGPoint();a.x=f;a.y=g;e=a.matrixTransform(e.getCTM());a=new JSM.Coord2D(e.x,e.y);f=new JSM.Coord2D(f,g);g=b.VertexCount(d);if(0<g&&JSM.CoordIsEqual2DWithEps(b.GetVertex(d,g-1),a,0.1))return f;b.AddVertex(d,e.x,e.y);return f}function d(a,b,e,f,g,h,k){var l=document.createElementNS("http://www.w3.org/2000/svg","path"),m="M "+f.x+" "+f.y+" ",n,q,t,r,s;for(n=0;n<g.length;n++)if(q=g[n],q.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS||
q.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL)t=q.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS?"C":"c",m+=t+" "+q.x1+" "+q.y1+" "+q.x2+" "+q.y2+" "+q.x+" "+q.y+" ";else if(q.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS||q.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL)t=q.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS?"Q":"q",m+=t+" "+q.x1+" "+q.y1+" "+q.x+" "+q.y+" ";else if(q.pathSegType==SVGPathSeg.PATHSEG_ARC_ABS||q.pathSegType==SVGPathSeg.PATHSEG_ARC_REL)t=q.pathSegType==
SVGPathSeg.PATHSEG_ARC_ABS?"A":"a",r=q.largeArcFlag?1:0,s=q.sweepFlag?1:0,m+=t+" "+q.r1+" "+q.r2+" "+q.angle+" "+r+" "+s+" "+q.x+" "+q.y+" ";else if(q.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS||q.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL)t=q.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS?"S":"s",m+=t+" "+q.x2+" "+q.y2+" "+q.x+" "+q.y+" ";l.setAttributeNS(null,"d",m);m=l.getTotalLength();g=0;0<e&&(g=parseInt(m/e,10));3>g&&(g=3);e=m/g;for(m=1;m<=g;m++)f=l.getPointAtLength(m*
e),f=c(a,h,k,b,f.x,f.y);return f}function e(a,b){var c=a.VertexCount(b);if(0!==c){var d=a.GetVertex(b,0),c=a.GetVertex(b,c-1);JSM.CoordIsEqual2DWithEps(d,c,0.1)&&a.GetContour(b).vertices.pop()}}function f(a,b){return 0<a.VertexCount(b)?(e(a,b),a.AddContour(),b+1):b}var g=new JSM.ContourPolygon2D,h=document.createElementNS("http://www.w3.org/2000/svg","svg"),l;if(a instanceof SVGPathElement){var k=new JSM.Coord2D(0,0),F=new JSM.Coord2D(0,0),C=b;a.hasAttribute("segmentlength")&&(C=parseFloat(a.getAttribute("segmentlength")));
var u,H,z=0;for(l=0;l<a.pathSegList.numberOfItems;l++)if(u=a.pathSegList.getItem(l),u.pathSegType!=SVGPathSeg.PATHSEG_CLOSEPATH)if(u.pathSegType==SVGPathSeg.PATHSEG_MOVETO_ABS)z=f(g,z),k=c(h,g,z,a,u.x,u.y),F=k.Clone();else if(u.pathSegType==SVGPathSeg.PATHSEG_MOVETO_REL)z=f(g,z),k=c(h,g,z,a,F.x+u.x,F.y+u.y),F=k.Clone();else if(u.pathSegType==SVGPathSeg.PATHSEG_LINETO_ABS)k=c(h,g,z,a,u.x,u.y);else if(u.pathSegType==SVGPathSeg.PATHSEG_LINETO_REL)k=c(h,g,z,a,k.x+u.x,k.y+u.y);else if(u.pathSegType==SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS)k=
c(h,g,z,a,u.x,k.y);else if(u.pathSegType==SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS)k=c(h,g,z,a,k.x,u.y);else if(u.pathSegType==SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL)k=c(h,g,z,a,k.x+u.x,k.y);else if(u.pathSegType==SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL)k=c(h,g,z,a,k.x,k.y+u.y);else if(u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS||u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL||u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS||u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL||
u.pathSegType==SVGPathSeg.PATHSEG_ARC_ABS||u.pathSegType==SVGPathSeg.PATHSEG_ARC_REL||u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS||u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL){H=[];if(u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS||u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL){for(;l<a.pathSegList.numberOfItems;l++){u=a.pathSegList.getItem(l);if(!(u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS||u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL))break;
H.push(u)}l-=1}else H.push(u);k=d(h,a,C,k,H,g,z)}e(g,z)}else if(a instanceof SVGRectElement)c(h,g,0,a,a.x.baseVal.value,a.y.baseVal.value),c(h,g,0,a,a.x.baseVal.value+a.width.baseVal.value,a.y.baseVal.value),c(h,g,0,a,a.x.baseVal.value+a.width.baseVal.value,a.y.baseVal.value+a.height.baseVal.value),c(h,g,0,a,a.x.baseVal.value,a.y.baseVal.value+a.height.baseVal.value);else if(a instanceof SVGPolygonElement)for(l=0;l<a.points.numberOfItems;l++)k=a.points.getItem(l),c(h,g,0,a,k.x,k.y);g.color=function(a){for(var b=
"";null!==a&&void 0!==a&&0===b.length;)b=a.getAttribute("fill"),null===b&&(b=a.style.fill),a=a.parentElement;a=0;if(0===b.length)return a;if("#"==b[0])a=JSM.HexColorToRGBColor(b.substring(1));else{var c=b.indexOf("("),d=b.indexOf(")");if(-1==c||-1==d)return a;b=b.substring(c+1,d).split(", ");if(3!=b.length)return a;a=JSM.RGBComponentsToHexColor(b[0],b[1],b[2])}return a}(a);return g}function e(a,b){function c(a,b){var d=[],e,f;if("Clockwise"==b)for(e=0;e<a.VertexCount();e++)f=a.GetVertex(e),d.push(new JSM.Coord(f.x,
0,-f.y));else for(e=a.VertexCount()-1;0<=e;e--)f=a.GetVertex(e),d.push(new JSM.Coord(f.x,0,-f.y));return d}function d(a,b,c){a.push(null);var e;if("CounterClockwise"==c)for(c=0;c<b.VertexCount();c++)e=b.GetVertex(c),a.push(new JSM.Coord(e.x,0,-e.y));else for(c=b.VertexCount()-1;0<=c;c--)e=b.GetVertex(c),a.push(new JSM.Coord(e.x,0,-e.y))}var e=[],f=new JSM.Vector(0,-1,0),g,h;h=a.ContourCount();if(1==h)h=JSM.PolygonOrientation2D(a.GetContour(0)),g=c(a.GetContour(0),h),g=JSM.GeneratePrism(g,f,b,!0),
e.push(g);else if(1<h){h=JSM.PolygonOrientation2D(a.GetContour(0));var k=c(a.GetContour(0),h),l=!1,F;for(F=1;F<a.ContourCount();F++)g=JSM.PolygonOrientation2D(a.GetContour(F)),g==h?(g=c(a.GetContour(F),h),g=JSM.GeneratePrism(g,f,b,!0),e.push(g)):(d(k,a.GetContour(F),g),l=!0);g=l?JSM.GeneratePrismWithHole(k,f,b,!0):JSM.GeneratePrism(k,f,b,!0);e.push(g)}f=new JSM.Material({ambient:a.color,diffuse:a.color});return[e,f]}var f=new JSM.Model,g=new JSM.Materials;c=function(a,b){function c(a,b,d){a=a.getElementsByTagName(b);
for(b=0;b<a.length;b++)d.push(a[b])}var e=[],f=[];c(a,"path",f);c(a,"rect",f);c(a,"polygon",f);var g=b;a.hasAttribute("segmentlength")&&(g=parseFloat(a.getAttribute("segmentlength")));var h,k;for(h=0;h<f.length;h++)k=d(f[h],g),e.push(k);return e}(a,c);a.hasAttribute("modelheight")&&(b=parseFloat(a.getAttribute("modelheight")));var h,l,k;for(a=0;a<c.length;a++){h=e(c[a],b);l=h[0];h=h[1];g.AddMaterial(h);for(h=0;h<l.length;h++)k=l[h],k.SetPolygonsMaterialIndex(g.Count()-1),f.AddBody(k)}return[f,g]};
JSM.BSPPolygonUserData=function(){this.material=this.id=null};JSM.AddBodyToBSPTree=function(a,b,c){var d,e,f;for(d=0;d<a.PolygonCount();d++){f=new JSM.BSPPolygonUserData;f.id=c;e=a;var g=f,h=e.GetPolygon(d);g.material=h.GetMaterialIndex();for(var g=new JSM.Polygon,l=void 0,k=void 0,l=0;l<h.VertexIndexCount();l++)k=e.GetVertexPosition(h.GetVertexIndex(l)),g.AddVertex(k.x,k.y,k.z);e=g;b.AddPolygon(e,f)}};
JSM.BooleanOperation=function(a,b,c){function d(a,b,c){function d(a){b.AddVertex(new JSM.BodyVertex(a));return b.VertexCount()-1}var e=new JSM.BodyPolygon([]),f;if(c)for(c=a.VertexCount()-1;0<=c;c--)f=d(a.GetVertex(c)),e.AddVertexIndex(f);else for(c=0;c<a.VertexCount();c++)f=d(a.GetVertex(c)),e.AddVertexIndex(f);void 0!==a.userData&&e.SetMaterialIndex(a.userData.material);b.AddPolygon(e)}function e(a,b,c){var e;for(e=0;e<a.length;e++)d(a[e],b,c)}function f(a,b,c,d,e,f){function g(a,b){var c;for(c=
0;c<a.length;c++)a[c].userData=b}var h,k;for(h=0;h<a.length;h++)k=a[h],JSM.ClipPolygonWithBSPTree(k.polygon,b,c,d,e,f),g(c,k.userData),g(d,k.userData),g(e,k.userData),g(f,k.userData)}var g=new JSM.BSPTree,h=new JSM.BSPTree;JSM.AddBodyToBSPTree(b,g,"a");JSM.AddBodyToBSPTree(c,h,"b");b=new JSM.Body;c=[];var l=[],k=[],m=[];f(g.GetNodes(),h,c,l,k,m);var n=[],p=[],q=[];f(h.GetNodes(),g,n,p,q,[]);"Union"==a?(e(c,b,!1),e(k,b,!1),e(m,b,!1),e(n,b,!1),e(q,b,!1)):"Difference"==a?(e(c,b,!1),e(k,b,!1),e(p,b,!0)):
"Intersection"==a&&(e(l,b,!1),e(m,b,!1),e(p,b,!1));return b};
JSM.GenerateSurface=function(a,b,c,d,e,f,g,h){var l=new JSM.Body,k=a[0],m=b[0],n=(a[1]-a[0])/c,p=(b[1]-b[0])/d;(function(){var a,b,e,f;for(a=0;a<=d;a++)for(b=0;b<=c;b++)e=k+b*n,f=m+a*p,e=g(a,b,e,f,h),l.AddVertex(new JSM.BodyVertex(e))})();(function(){var a,b,g,h,k,m;for(b=0;b<d;b++)for(a=0;a<c;a++)g=b*(c+1)+a,h=g+1,k=g+c+1,m=k+1,e?(h=new JSM.BodyPolygon([g,h,m]),f&&h.SetCurveGroup(0),l.AddPolygon(h),h=new JSM.BodyPolygon([g,m,k])):h=new JSM.BodyPolygon([g,h,m,k]),f&&h.SetCurveGroup(0),l.AddPolygon(h)})();
return l};JSM.SurfaceControlPoints=function(a,b){this.n=a;this.m=b;this.points=[];var c,d;for(c=0;c<=this.n;c++){this.points.push([]);for(d=0;d<=this.m;d++)this.points[c].push(new JSM.Coord(0,0,0))}};JSM.SurfaceControlPoints.prototype.GetNValue=function(){return this.n};JSM.SurfaceControlPoints.prototype.GetMValue=function(){return this.m};JSM.SurfaceControlPoints.prototype.GetControlPoint=function(a,b){return this.points[a][b]};
JSM.SurfaceControlPoints.prototype.InitPlanar=function(a,b){var c=a/this.n,d=b/this.m,e,f,g;for(e=0;e<=this.n;e++)for(f=0;f<=this.m;f++)g=this.points[e][f],g.x=e*c,g.y=f*d};
JSM.GenerateBezierSurface=function(a,b,c,d){return JSM.GenerateSurface([0,1],[0,1],b,c,!1,d,function(a,b,c,d,l){function k(a,b,c){var d=1,e=JSM.Minimum(a,b-a),f;for(f=0;f<e;f++)d*=b-f,d/=f+1;return d*Math.pow(c,a)*Math.pow(1-c,b-a)}var m,n,p,q=l.GetNValue(),r=l.GetMValue();m=new JSM.Coord(0,0,0);for(a=0;a<=q;a++){n=new JSM.Coord(0,0,0);for(b=0;b<=r;b++)p=k(a,q,c)*k(b,r,d),p=JSM.VectorMultiply(l.GetControlPoint(a,b),p),n=JSM.CoordAdd(n,p);m=JSM.CoordAdd(m,n)}return m},a)};
JSM.RenderMaterial=function(a,b,c,d,e,f,g){this.ambient=a;this.diffuse=b;this.specular=c;this.shininess=d;this.texture=e;this.textureWidth=f;this.textureHeight=g;this.textureImage=this.textureBuffer=null;this.textureLoaded=!1};JSM.RenderMaterial.prototype.HasTexture=function(){return null!==this.texture&&this.textureLoaded};
JSM.RenderMaterial.prototype.Compile=function(a,b){if(null!==this.texture){var c=this;this.textureBuffer=a.createTexture();this.textureImage=new Image;this.textureImage.src=this.texture;this.textureImage.onload=function(){a.bindTexture(a.TEXTURE_2D,c.textureBuffer);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,c.textureImage);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR);a.generateMipmap(a.TEXTURE_2D);
a.bindTexture(a.TEXTURE_2D,null);c.textureLoaded=!0;void 0!==b&&null!==b&&b()}}};JSM.RenderGeometry=function(){this.transformation=new JSM.Transformation;this.uvBuffer=this.normalBuffer=this.vertexBuffer=this.uvArray=this.normalArray=this.vertexArray=this.material=null};JSM.RenderGeometry.prototype.SetMaterial=function(a){this.material=a};JSM.RenderGeometry.prototype.GetMaterial=function(){return this.material};JSM.RenderGeometry.prototype.SetVertexArray=function(a){this.vertexArray=new Float32Array(a)};
JSM.RenderGeometry.prototype.SetNormalArray=function(a){this.normalArray=new Float32Array(a)};JSM.RenderGeometry.prototype.SetUVArray=function(a){this.uvArray=new Float32Array(a)};JSM.RenderGeometry.prototype.GetTransformation=function(){return this.transformation};JSM.RenderGeometry.prototype.GetTransformationMatrix=function(){return this.transformation.matrix};JSM.RenderGeometry.prototype.SetTransformation=function(a){this.transformation=a};JSM.RenderGeometry.prototype.GetVertexBuffer=function(){return this.vertexBuffer};
JSM.RenderGeometry.prototype.GetNormalBuffer=function(){return this.normalBuffer};JSM.RenderGeometry.prototype.GetUVBuffer=function(){return this.uvBuffer};JSM.RenderGeometry.prototype.VertexCount=function(){return parseInt(this.vertexArray.length/3,10)};JSM.RenderGeometry.prototype.GetVertex=function(a){return new JSM.Coord(this.vertexArray[3*a],this.vertexArray[3*a+1],this.vertexArray[3*a+2])};JSM.RenderGeometry.prototype.GetTransformedVertex=function(a){a=this.GetVertex(a);return this.transformation.Apply(a)};
JSM.RenderGeometry.prototype.Compile=function(a,b){this.material.Compile(a,b);this.vertexBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertexArray,a.STATIC_DRAW);this.vertexBuffer.itemSize=3;this.vertexBuffer.numItems=parseInt(this.vertexArray.length/3,10);this.normalBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.normalBuffer);a.bufferData(a.ARRAY_BUFFER,this.normalArray,a.STATIC_DRAW);this.normalBuffer.itemSize=3;this.normalBuffer.numItems=
parseInt(this.normalArray.length/3,10);null!==this.uvArray&&(this.uvBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),a.bufferData(a.ARRAY_BUFFER,this.uvArray,a.STATIC_DRAW),this.uvBuffer.itemSize=2,this.uvBuffer.numItems=parseInt(this.uvArray.length/2,10))};JSM.Renderer=function(){this.geometries=this.light=this.camera=this.texShader=this.shader=this.context=this.canvas=null};
JSM.Renderer.prototype.Init=function(a,b,c){return!this.InitContext(a)||!this.InitView(b,c)||!this.InitShaders()||!this.InitBuffers()?!1:!0};
JSM.Renderer.prototype.InitContext=function(a){if(!window.WebGLRenderingContext)return!1;this.canvas=document.getElementById(a);if(null===this.canvas||void 0===this.canvas.getContext)return!1;this.context=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl");if(null===this.context)return!1;this.context.viewportWidth=this.canvas.width;this.context.viewportHeight=this.canvas.height;this.context.viewport(0,0,this.context.viewportWidth,this.context.viewportHeight);this.context.clearColor(1,
1,1,1);this.context.enable(this.context.DEPTH_TEST);this.context.depthFunc(this.context.LEQUAL);this.context.enable(this.context.BLEND);this.context.blendEquation(this.context.FUNC_ADD);this.context.blendFunc(this.context.SRC_ALPHA,this.context.ONE_MINUS_SRC_ALPHA);return!0};
JSM.Renderer.prototype.InitShaders=function(){function a(a,b,c){c=a.createShader(c);a.shaderSource(c,b);a.compileShader(c);return!a.getShaderParameter(c,a.COMPILE_STATUS)?null:c}function b(b,c,d){c=a(b,c,b.FRAGMENT_SHADER);d=a(b,d,b.VERTEX_SHADER);if(null===c||null===d)return null;var e=b.createProgram();b.attachShader(e,d);b.attachShader(e,c);b.linkProgram(e);return!b.getProgramParameter(e,b.LINK_STATUS)?null:e}function c(a){var b="";a&&(b="#define USETEXTURE");return[b,"uniform highp vec3 uPolygonAmbientColor;\nuniform highp vec3 uPolygonDiffuseColor;\nuniform highp vec3 uPolygonSpecularColor;\nuniform highp float uPolygonShininess;\nuniform highp vec3 uLightAmbientColor;\nuniform highp vec3 uLightDiffuseColor;\nuniform highp vec3 uLightSpecularColor;\nvarying highp vec3 vVertex;\nvarying highp vec3 vNormal;\nvarying highp vec3 vLight;\n#ifdef USETEXTURE\nvarying highp vec2 vUV;\nuniform sampler2D uSampler;\n#endif\nvoid main (void) {\n\thighp vec3 N = normalize (vNormal);\n\tif (!gl_FrontFacing) {\n\t\tN = -N;\n\t}\n\thighp vec3 L = normalize (-vLight);\n\thighp vec3 E = normalize (-vVertex);\n\thighp vec3 R = normalize (-reflect (L, N));\n\thighp vec3 ambientComponent = uPolygonAmbientColor * uLightAmbientColor;\n\thighp vec3 diffuseComponent = uPolygonDiffuseColor * uLightDiffuseColor * max (dot (N, L), 0.0);\n\thighp vec3 specularComponent = uPolygonSpecularColor * uLightSpecularColor * pow (max (dot (R, E), 0.0), uPolygonShininess);\n#ifdef USETEXTURE\n\thighp vec3 textureColor = texture2D (uSampler, vec2 (vUV.s, vUV.t)).xyz;\n\tambientComponent = textureColor * ambientComponent;\n\tdiffuseComponent = textureColor * diffuseComponent;\n\tspecularComponent = textureColor * specularComponent;\n#endif\n\tambientComponent = clamp (ambientComponent, 0.0, 1.0);\n\tdiffuseComponent = clamp (diffuseComponent, 0.0, 1.0);\n\tspecularComponent = clamp (specularComponent, 0.0, 1.0);\n\tgl_FragColor = vec4 (ambientComponent + diffuseComponent + specularComponent, 1.0);\n}"].join("\n")}
function d(a){var b="";a&&(b="#define USETEXTURE");return[b,"attribute highp vec3 aVertexPosition;\nattribute highp vec3 aVertexNormal;\nuniform highp mat4 uViewMatrix;\nuniform highp mat4 uModelViewMatrix;\nuniform highp mat4 uProjectionMatrix;\nuniform highp vec3 uLightDirection;\nvarying highp vec3 vVertex;\nvarying highp vec3 vNormal;\nvarying highp vec3 vLight;\n#ifdef USETEXTURE\nattribute highp vec2 aVertexUV;\nvarying highp vec2 vUV;\n#endif\nvoid main (void) {\n\tvVertex = vec3 (uModelViewMatrix * vec4 (aVertexPosition, 1.0));\n\tvNormal = normalize (vec3 (uModelViewMatrix * vec4 (aVertexNormal, 0.0)));\n\tvLight = normalize (vec3 (uViewMatrix * vec4 (uLightDirection, 0.0)));\n#ifdef USETEXTURE\n\tvUV = aVertexUV;\n#endif\n\tgl_Position = uProjectionMatrix * vec4 (vVertex, 1.0);\n}"].join("\n")}
function e(a,b){b.vertexPositionAttribute=a.getAttribLocation(b,"aVertexPosition");b.vertexNormalAttribute=a.getAttribLocation(b,"aVertexNormal");b.lightAmbientColorUniform=a.getUniformLocation(b,"uLightAmbientColor");b.lightDiffuseColorUniform=a.getUniformLocation(b,"uLightDiffuseColor");b.lightSpecularColorUniform=a.getUniformLocation(b,"uLightSpecularColor");b.lightDirectionUniform=a.getUniformLocation(b,"uLightDirection");b.vMatrixUniform=a.getUniformLocation(b,"uViewMatrix");b.mvMatrixUniform=
a.getUniformLocation(b,"uModelViewMatrix");b.pMatrixUniform=a.getUniformLocation(b,"uProjectionMatrix");b.polygonAmbientColorUniform=a.getUniformLocation(b,"uPolygonAmbientColor");b.polygonDiffuseColorUniform=a.getUniformLocation(b,"uPolygonDiffuseColor");b.polygonSpecularColorUniform=a.getUniformLocation(b,"uPolygonSpecularColor");b.polygonShininessUniform=a.getUniformLocation(b,"uPolygonShininess")}this.shader=function(a){var g=c(!1),h=d(!1),g=b(a,g,h);if(null===g)return null;a.useProgram(g);e(a,
g);return g}(this.context);if(null===this.shader)return!1;this.texShader=function(a){var g=c(!0),h=d(!0),g=b(a,g,h);if(null===g)return null;a.useProgram(g);e(a,g);g.vertexUVAttribute=a.getAttribLocation(g,"aVertexUV");g.samplerUniform=a.getUniformLocation(g,"uSampler");return g}(this.context);return null===this.texShader?!1:!0};JSM.Renderer.prototype.InitBuffers=function(){this.geometries=[];return!0};
JSM.Renderer.prototype.InitView=function(a,b){this.camera=JSM.ValueOrDefault(a,new JSM.Camera);if(!this.camera)return!1;this.light=JSM.ValueOrDefault(b,new JSM.Light);return!this.light?!1:!0};JSM.Renderer.prototype.SetClearColor=function(a,b,c){this.context.clearColor(a,b,c,1)};JSM.Renderer.prototype.AddGeometries=function(a){var b,c;for(b=0;b<a.length;b++)c=a[b],c.Compile(this.context,this.Render.bind(this)),this.geometries.push(c)};
JSM.Renderer.prototype.RemoveGeometries=function(){this.geometries=[]};JSM.Renderer.prototype.Resize=function(){this.context.viewportWidth=this.canvas.width;this.context.viewportHeight=this.canvas.height;this.context.viewport(0,0,this.context.viewportWidth,this.context.viewportHeight)};
JSM.Renderer.prototype.Render=function(){this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT);var a=JSM.MatrixPerspective(this.camera.fieldOfView*JSM.DegRad,this.context.viewportWidth/this.context.viewportHeight,this.camera.nearClippingPlane,this.camera.farClippingPlane),b=JSM.MatrixView(this.camera.eye,this.camera.center,this.camera.up),c=JSM.MatrixIdentity(),d=JSM.HexColorToNormalizedRGBComponents(this.light.ambient),e=JSM.HexColorToNormalizedRGBComponents(this.light.diffuse),
f=JSM.HexColorToNormalizedRGBComponents(this.light.specular);this.light.direction=JSM.VectorNormalize(JSM.CoordSub(this.camera.center,this.camera.eye));var g,h,l,k,m,n;for(g=0;g<this.geometries.length;g++)m=this.geometries[g],c=m.GetMaterial().HasTexture()?this.texShader:this.shader,n!=c&&(n=c,this.context.useProgram(n),this.context.uniformMatrix4fv(n.pMatrixUniform,!1,a),this.context.uniformMatrix4fv(n.vMatrixUniform,!1,b),this.context.uniform3f(n.lightDirectionUniform,this.light.direction.x,this.light.direction.y,
this.light.direction.z),this.context.uniform3f(n.lightAmbientColorUniform,d[0],d[1],d[2]),this.context.uniform3f(n.lightDiffuseColorUniform,e[0],e[1],e[2]),this.context.uniform3f(n.lightSpecularColorUniform,f[0],f[1],f[2])),c=m.material.ambient,h=m.material.diffuse,l=m.material.specular,k=m.material.shininess,this.context.uniform3f(n.polygonAmbientColorUniform,c[0],c[1],c[2]),this.context.uniform3f(n.polygonDiffuseColorUniform,h[0],h[1],h[2]),this.context.uniform3f(n.polygonSpecularColorUniform,l[0],
l[1],l[2]),this.context.uniform1f(n.polygonShininessUniform,k),n==this.texShader&&(c=m.GetUVBuffer(),this.context.activeTexture(this.context.TEXTURE0),this.context.bindTexture(this.context.TEXTURE_2D,m.material.textureBuffer),this.context.bindBuffer(this.context.ARRAY_BUFFER,c),this.context.vertexAttribPointer(n.vertexUVAttribute,c.itemSize,this.context.FLOAT,!1,0,0),this.context.enableVertexAttribArray(n.vertexUVAttribute),this.context.uniform1i(n.samplerUniform,0)),c=JSM.MatrixMultiply(m.GetTransformationMatrix(),
b),this.context.uniformMatrix4fv(n.mvMatrixUniform,!1,c),c=m.GetVertexBuffer(),this.context.bindBuffer(this.context.ARRAY_BUFFER,c),this.context.enableVertexAttribArray(n.vertexPositionAttribute),this.context.vertexAttribPointer(n.vertexPositionAttribute,c.itemSize,this.context.FLOAT,!1,0,0),m=m.GetNormalBuffer(),this.context.bindBuffer(this.context.ARRAY_BUFFER,m),this.context.enableVertexAttribArray(n.vertexNormalAttribute),this.context.vertexAttribPointer(n.vertexNormalAttribute,m.itemSize,this.context.FLOAT,
!1,0,0),this.context.drawArrays(this.context.TRIANGLES,0,c.numItems)};JSM.PointCloudRenderer=function(){this.pointSize=this.points=this.camera=this.shader=this.context=this.canvas=null};JSM.PointCloudRenderer.prototype.Init=function(a,b){return!this.InitContext(a)||!this.InitShaders()||!this.InitBuffers()||!this.InitView(b)?!1:!0};
JSM.PointCloudRenderer.prototype.InitContext=function(a){if(!window.WebGLRenderingContext)return!1;this.canvas=document.getElementById(a);if(null===this.canvas||void 0===this.canvas.getContext)return!1;this.context=this.canvas.getContext("experimental-webgl");if(null===this.context)return!1;this.context.viewportWidth=this.canvas.width;this.context.viewportHeight=this.canvas.height;this.context.clearColor(1,1,1,1);this.context.enable(this.context.DEPTH_TEST);return!0};
JSM.PointCloudRenderer.prototype.InitShaders=function(){function a(a,b,c){c=a.createShader(c);a.shaderSource(c,b);a.compileShader(c);return!a.getShaderParameter(c,a.COMPILE_STATUS)?null:c}var b=a(this.context,"varying highp vec3 vColor;\nvoid main (void) {\n\tgl_FragColor = vec4 (vColor, 1.0);\n}",this.context.FRAGMENT_SHADER),c=a(this.context,"attribute highp vec3 aVertexPosition;\nattribute highp vec3 aVertexColor;\nuniform highp mat4 uViewMatrix;\nuniform highp mat4 uProjectionMatrix;\nuniform highp float uPointSize;\nvarying highp vec3 vColor;\nvoid main (void) {\n\tvColor = aVertexColor;\n\tgl_PointSize = uPointSize;\n\tgl_Position = uProjectionMatrix * uViewMatrix * vec4 (aVertexPosition, 1.0);\n}",
this.context.VERTEX_SHADER);if(null===b||null===c)return!1;this.shader=this.context.createProgram();this.context.attachShader(this.shader,c);this.context.attachShader(this.shader,b);this.context.linkProgram(this.shader);if(!this.context.getProgramParameter(this.shader,this.context.LINK_STATUS))return!1;this.context.useProgram(this.shader);this.shader.vertexPositionAttribute=this.context.getAttribLocation(this.shader,"aVertexPosition");this.context.enableVertexAttribArray(this.shader.vertexPositionAttribute);
this.shader.vertexColorAttribute=this.context.getAttribLocation(this.shader,"aVertexColor");this.context.enableVertexAttribArray(this.shader.vertexColorAttribute);this.shader.pMatrixUniform=this.context.getUniformLocation(this.shader,"uProjectionMatrix");this.shader.vMatrixUniform=this.context.getUniformLocation(this.shader,"uViewMatrix");this.shader.pointSizeUniform=this.context.getUniformLocation(this.shader,"uPointSize");return!0};
JSM.PointCloudRenderer.prototype.InitBuffers=function(){this.points=[];this.pointSize=1;return!0};JSM.PointCloudRenderer.prototype.InitView=function(a){this.camera=JSM.ValueOrDefault(a,new JSM.Camera);return!this.camera?!1:!0};JSM.PointCloudRenderer.prototype.SetClearColor=function(a,b,c){this.context.clearColor(a,b,c,1)};JSM.PointCloudRenderer.prototype.SetPointSize=function(a){this.pointSize=a};
JSM.PointCloudRenderer.prototype.AddPoints=function(a,b){var c=this.context.createBuffer(),d=new Float32Array(a);this.context.bindBuffer(this.context.ARRAY_BUFFER,c);this.context.bufferData(this.context.ARRAY_BUFFER,d,this.context.STATIC_DRAW);c.itemSize=3;c.numItems=parseInt(d.length/3,10);var e=this.context.createBuffer(),f=new Float32Array(b);this.context.bindBuffer(this.context.ARRAY_BUFFER,e);this.context.bufferData(this.context.ARRAY_BUFFER,f,this.context.STATIC_DRAW);e.itemSize=3;e.numItems=
parseInt(f.length/3,10);this.points.push({pointArray:d,pointBuffer:c,colorBuffer:e})};JSM.PointCloudRenderer.prototype.RemovePoints=function(){this.points=[]};JSM.PointCloudRenderer.prototype.Resize=function(){this.context.viewportWidth=this.canvas.width;this.context.viewportHeight=this.canvas.height};
JSM.PointCloudRenderer.prototype.Render=function(){this.context.viewport(0,0,this.context.viewportWidth,this.context.viewportHeight);this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT);var a=JSM.MatrixPerspective(this.camera.fieldOfView*JSM.DegRad,this.context.viewportWidth/this.context.viewportHeight,this.camera.nearClippingPlane,this.camera.farClippingPlane);this.context.uniformMatrix4fv(this.shader.pMatrixUniform,!1,a);a=JSM.MatrixView(this.camera.eye,this.camera.center,
this.camera.up);this.context.uniformMatrix4fv(this.shader.vMatrixUniform,!1,a);this.context.uniform1f(this.shader.pointSizeUniform,this.pointSize);for(var b,c,a=0;a<this.points.length;a++)b=this.points[a].pointBuffer,c=this.points[a].colorBuffer,this.context.bindBuffer(this.context.ARRAY_BUFFER,b),this.context.vertexAttribPointer(this.shader.vertexPositionAttribute,b.itemSize,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,c),this.context.vertexAttribPointer(this.shader.vertexColorAttribute,
c.itemSize,this.context.FLOAT,!1,0,0),this.context.drawArrays(this.context.POINTS,0,b.numItems)};
JSM.ConvertBodyToRenderGeometries=function(a,b){var c=[],d=null,e=null,f=null,g=null;JSM.ExplodeBodyToTriangles(a,b,{hasConvexPolygons:!1,onGeometryStart:function(a){e=[];f=[];g=[];var b=JSM.HexColorToNormalizedRGBComponents(a.ambient),k=JSM.HexColorToNormalizedRGBComponents(a.diffuse),m=JSM.HexColorToNormalizedRGBComponents(a.specular);a=new JSM.RenderMaterial(b,k,m,a.shininess,a.texture,a.textureWidth,a.textureHeight);d=new JSM.RenderGeometry;d.SetMaterial(a);c.push(d)},onGeometryEnd:function(a){d.SetVertexArray(e);
d.SetNormalArray(f);null!==a.texture&&d.SetUVArray(g)},onTriangle:function(a,b,c,d,n,p,q,r,s){e.push(a.x,a.y,a.z);e.push(b.x,b.y,b.z);e.push(c.x,c.y,c.z);f.push(d.x,d.y,d.z);f.push(n.x,n.y,n.z);f.push(p.x,p.y,p.z);null!==q&&(null!==r&&null!==s)&&(g.push(q.x,q.y),g.push(r.x,r.y),g.push(s.x,s.y))}});return c};JSM.ConvertModelToRenderGeometries=function(a,b){var c=[],d,e;for(d=0;d<a.BodyCount();d++){e=a.GetBody(d);var f=JSM.ConvertBodyToRenderGeometries(e,b,c);for(e=0;e<f.length;e++)c.push(f[e])}return c};
JSM.JSONFileLoader=function(a){this.onReady=a};JSM.JSONFileLoader.prototype.Load=function(a){var b=this,c=new XMLHttpRequest;c.overrideMimeType("application/json");c.open("GET",a,!0);c.onreadystatechange=function(){4==c.readyState&&b.OnReady(c.responseText)};c.send(null)};JSM.JSONFileLoader.prototype.OnReady=function(a){null!==this.onReady&&(a=JSON.parse(a),this.onReady(a))};
JSM.Mouse=function(){this.down=!1;this.button=0;this.alt=this.ctrl=this.shift=!1;this.diffY=this.diffX=this.currY=this.currX=this.prevY=this.prevX=0};JSM.Mouse.prototype.Down=function(a,b){var c=a;void 0===c&&(c=window.event);this.down=!0;this.button=a.which;this.shift=a.shiftKey;this.ctrl=a.ctrlKey;this.alt=a.altKey;this.SetCurrent(c,b);this.prevX=this.currX;this.prevY=this.currY};
JSM.Mouse.prototype.Move=function(a,b){var c=a;void 0===c&&(c=window.event);this.shift=a.shiftKey;this.ctrl=a.ctrlKey;this.alt=a.altKey;this.SetCurrent(c,b);this.diffX=this.currX-this.prevX;this.diffY=this.currY-this.prevY;this.prevX=this.currX;this.prevY=this.currY};JSM.Mouse.prototype.Up=function(a,b){var c=a;void 0===c&&(c=window.event);this.down=!1;this.SetCurrent(c,b)};JSM.Mouse.prototype.Out=function(a,b){var c=a;void 0===c&&(c=window.event);this.down=!1;this.SetCurrent(c,b)};
JSM.Mouse.prototype.SetCurrent=function(a,b){this.currX=a.clientX;this.currY=a.clientY;void 0!==b&&(void 0!==b.offsetLeft&&void 0!==b.offsetTop)&&(this.currX-=b.offsetLeft,this.currY-=b.offsetTop)};JSM.Touch=function(){this.down=!1;this.diffY=this.diffX=this.currY=this.currX=this.prevY=this.prevX=0};JSM.Touch.prototype.Start=function(a,b){if(0!==a.touches.length){var c=a.touches[0];this.down=!0;this.SetCurrent(c,b);this.prevX=this.currX;this.prevY=this.currY}};
JSM.Touch.prototype.Move=function(a,b){0!==a.touches.length&&(this.SetCurrent(a.touches[0],b),this.diffX=this.currX-this.prevX,this.diffY=this.currY-this.prevY,this.prevX=this.currX,this.prevY=this.currY)};JSM.Touch.prototype.End=function(a,b){if(0!==a.touches.length){var c=a.touches[0];this.down=!1;this.SetCurrent(c,b)}};
JSM.Touch.prototype.SetCurrent=function(a,b){this.currX=a.pageX;this.currY=a.pageY;void 0!==b&&(void 0!==b.offsetLeft&&void 0!==b.offsetTop)&&(this.currX=a.pageX-b.offsetLeft,this.currY=a.pageY-b.offsetTop)};JSM.Navigation=function(){this.orbitCenter=this.cameraEnableZoom=this.cameraEnablePan=this.cameraEnableOrbit=this.cameraFixUp=this.touch=this.mouse=this.resizeCallback=this.drawCallback=this.camera=this.canvas=null};
JSM.Navigation.prototype.Init=function(a,b,c,d){this.canvas=a;this.camera=b;this.drawCallback=c;this.resizeCallback=d;this.mouse=new JSM.Mouse;this.touch=new JSM.Touch;this.cameraEnableZoom=this.cameraEnablePan=this.cameraEnableOrbit=this.cameraFixUp=!0;this.orbitCenter=this.camera.center.Clone();var e=this;document.addEventListener&&(document.addEventListener("mousemove",function(a){e.OnMouseMove(a)}),document.addEventListener("mouseup",function(a){e.OnMouseUp(a)}));this.canvas.addEventListener&&
(this.canvas.addEventListener("mousedown",function(a){e.OnMouseDown(a)},!1),this.canvas.addEventListener("DOMMouseScroll",function(a){e.OnMouseWheel(a)},!1),this.canvas.addEventListener("mousewheel",function(a){e.OnMouseWheel(a)},!1),this.canvas.addEventListener("touchstart",function(a){e.OnTouchStart(a)},!1),this.canvas.addEventListener("touchmove",function(a){e.OnTouchMove(a)},!1),this.canvas.addEventListener("touchend",function(a){e.OnTouchEnd(a)},!1),this.canvas.addEventListener("contextmenu",
function(a){e.OnContextMenu(a)},!1));window.addEventListener&&window.addEventListener("resize",function(a){e.OnResize(a)},!1);return!0};JSM.Navigation.prototype.SetCamera=function(a,b,c){this.camera.Set(a,b,c);this.orbitCenter=this.camera.center.Clone()};JSM.Navigation.prototype.EnableFixUp=function(a){this.cameraFixUp=a};JSM.Navigation.prototype.EnableOrbit=function(a){this.cameraEnableOrbit=a};JSM.Navigation.prototype.EnablePan=function(a){this.cameraEnablePan=a};
JSM.Navigation.prototype.EnableZoom=function(a){this.cameraEnableZoom=a};JSM.Navigation.prototype.SetOrbitCenter=function(a){this.orbitCenter=a};
JSM.Navigation.prototype.FitInWindow=function(a,b){var c=JSM.CoordSub(this.camera.center,a);this.camera.center=a;this.camera.eye=JSM.CoordSub(this.camera.eye,c);var c=JSM.VectorNormalize(JSM.CoordSub(this.camera.eye,this.camera.center)),d=this.camera.fieldOfView/2;this.canvas.width<this.canvas.height&&(d=d*this.canvas.width/this.canvas.height);d=b/Math.sin(d*JSM.DegRad);this.camera.eye=JSM.CoordOffset(this.camera.center,c,d);this.orbitCenter=this.camera.center.Clone()};
JSM.Navigation.prototype.Orbit=function(a,b){var c=a*JSM.DegRad,d=b*JSM.DegRad,e=JSM.VectorNormalize(JSM.CoordSub(this.camera.center,this.camera.eye)),f=JSM.VectorNormalize(JSM.VectorCross(e,this.camera.up)),g=!JSM.CoordIsEqual(this.orbitCenter,this.camera.center);this.cameraFixUp?(e=JSM.GetVectorsAngle(e,this.camera.up)+d,JSM.IsGreater(e,0)&&JSM.IsLower(e,Math.PI)&&(this.camera.eye=JSM.CoordRotate(this.camera.eye,f,-d,this.orbitCenter),g&&(this.camera.center=JSM.CoordRotate(this.camera.center,f,
-d,this.orbitCenter))),this.camera.eye=JSM.CoordRotate(this.camera.eye,this.camera.up,-c,this.orbitCenter),g&&(this.camera.center=JSM.CoordRotate(this.camera.center,this.camera.up,-c,this.orbitCenter))):(e=JSM.VectorNormalize(JSM.VectorCross(f,e)),this.camera.eye=JSM.CoordRotate(this.camera.eye,f,-d,this.orbitCenter),this.camera.eye=JSM.CoordRotate(this.camera.eye,e,-c,this.orbitCenter),g&&(this.camera.center=JSM.CoordRotate(this.camera.center,f,-d,this.orbitCenter),this.camera.center=JSM.CoordRotate(this.camera.center,
e,-c,this.orbitCenter)),this.camera.up=e)};JSM.Navigation.prototype.Pan=function(a,b){var c=JSM.VectorNormalize(JSM.CoordSub(this.camera.center,this.camera.eye)),d=JSM.VectorNormalize(JSM.VectorCross(c,this.camera.up)),c=JSM.VectorNormalize(JSM.VectorCross(d,c));this.camera.eye=JSM.CoordOffset(this.camera.eye,d,-a);this.camera.center=JSM.CoordOffset(this.camera.center,d,-a);this.camera.eye=JSM.CoordOffset(this.camera.eye,c,b);this.camera.center=JSM.CoordOffset(this.camera.center,c,b)};
JSM.Navigation.prototype.Zoom=function(a){var b=JSM.CoordSub(this.camera.center,this.camera.eye),c=JSM.VectorLength(b);if(a&&0.1>c)return 0;c*=0.1;a||(c*=-1);this.camera.eye=JSM.CoordOffset(this.camera.eye,b,c)};JSM.Navigation.prototype.DrawCallback=function(){void 0!==this.drawCallback&&null!==this.drawCallback&&this.drawCallback()};JSM.Navigation.prototype.ResizeCallback=function(){void 0!==this.resizeCallback&&null!==this.resizeCallback&&this.resizeCallback()};
JSM.Navigation.prototype.OnMouseDown=function(a){a.preventDefault();this.mouse.Down(a,this.canvas)};JSM.Navigation.prototype.OnMouseMove=function(a){a.preventDefault();this.mouse.Move(a,this.canvas);this.mouse.down&&(a=0,1==this.mouse.button?this.cameraEnableOrbit&&(a=0.5,this.Orbit(this.mouse.diffX*a,this.mouse.diffY*a),this.DrawCallback()):3==this.mouse.button&&this.cameraEnablePan&&(a=0.001*JSM.CoordDistance(this.camera.eye,this.camera.center),this.Pan(this.mouse.diffX*a,this.mouse.diffY*a),this.DrawCallback()))};
JSM.Navigation.prototype.OnMouseUp=function(a){a.preventDefault();this.mouse.Up(a,this.canvas)};JSM.Navigation.prototype.OnMouseOut=function(a){a.preventDefault();this.mouse.Out(a,this.canvas)};JSM.Navigation.prototype.OnMouseWheel=function(a){a.preventDefault();if(this.cameraEnableZoom){null===a&&(a=window.event);var b=0;a.detail?b=-a.detail:a.wheelDelta&&(b=a.wheelDelta/40);this.Zoom(0<b);this.DrawCallback()}};
JSM.Navigation.prototype.OnTouchStart=function(a){a.preventDefault();this.touch.Start(a,this.canvas)};JSM.Navigation.prototype.OnTouchMove=function(a){a.preventDefault();this.touch.Move(a,this.canvas);this.touch.down&&this.cameraEnableOrbit&&(this.Orbit(0.5*this.touch.diffX,0.5*this.touch.diffY),this.DrawCallback())};JSM.Navigation.prototype.OnTouchEnd=function(a){a.preventDefault();this.touch.End(a,this.canvas)};JSM.Navigation.prototype.OnContextMenu=function(a){a.preventDefault()};
JSM.Navigation.prototype.OnResize=function(a){a.preventDefault();this.ResizeCallback()};JSM.SoftwareViewer=function(){this.navigation=this.drawMode=this.drawer=this.bodies=this.camera=this.canvas=null};JSM.SoftwareViewer.prototype.Start=function(a,b){return!this.InitCanvas(a)||!this.InitCamera(b)?!1:!0};
JSM.SoftwareViewer.prototype.InitCanvas=function(a){this.bodies=[];this.canvas=document.getElementById(a);if(!this.canvas)return!1;this.canvas instanceof HTMLCanvasElement?this.drawer=new JSM.CanvasDrawer(this.canvas):this.canvas instanceof SVGSVGElement&&(this.drawer=new JSM.SVGDrawer(this.canvas));if(!this.drawer)return!1;this.drawMode="Wireframe";return!0};
JSM.SoftwareViewer.prototype.InitCamera=function(a){this.camera=JSM.ValueOrDefault(a,new JSM.Camera);if(!this.camera)return!1;this.navigation=new JSM.Navigation;return!this.navigation.Init(this.canvas,this.camera,this.Draw.bind(this),this.Resize.bind(this))?!1:!0};JSM.SoftwareViewer.prototype.AddBody=function(a,b){this.bodies.push([a,b])};JSM.SoftwareViewer.prototype.RemoveBodies=function(){this.bodies=[]};
JSM.SoftwareViewer.prototype.FitInWindow=function(){var a=this.GetCenter(),b=this.GetBoundingSphereRadius(a);this.navigation.FitInWindow(a,b);this.Draw()};JSM.SoftwareViewer.prototype.GetCenter=function(){var a=this.GetBoundingBox();return JSM.MidCoord(a[0],a[1])};
JSM.SoftwareViewer.prototype.GetBoundingBox=function(){var a=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf),b=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf),c,d,e,f;for(c=0;c<this.bodies.length;c++){e=this.bodies[c][0];for(d=0;d<e.VertexCount();d++)f=e.GetVertex(d),a.x=JSM.Minimum(a.x,f.position.x),a.y=JSM.Minimum(a.y,f.position.y),a.z=JSM.Minimum(a.z,f.position.z),b.x=JSM.Maximum(b.x,f.position.x),b.y=JSM.Maximum(b.y,f.position.y),b.z=JSM.Maximum(b.z,f.position.z)}return[a,b]};
JSM.SoftwareViewer.prototype.GetBoundingSphereRadius=function(a){if(void 0===a||null===a)a=this.GetCenter();var b=0,c,d,e,f;for(c=0;c<this.bodies.length;c++){e=this.bodies[c][0];for(d=0;d<e.VertexCount();d++)f=e.GetVertex(d),f=JSM.CoordDistance(a,f.position),JSM.IsGreater(f,b)&&(b=f)}return b};JSM.SoftwareViewer.prototype.Resize=function(){this.Draw()};
JSM.SoftwareViewer.prototype.Draw=function(){var a,b;this.drawer.Clear();for(a=0;a<this.bodies.length;a++)b=this.bodies[a],JSM.DrawProjectedBody(b[0],b[1],this.camera,this.drawMode,!1,this.drawer);return!0};JSM.SpriteViewer=function(){this.navigation=this.projected=this.points=this.callbacks=this.camera=this.canvas=null};JSM.SpriteViewer.prototype.Start=function(a,b,c){return!this.InitCanvas(a)||!this.InitCamera(b)||!this.InitCallbacks(c)?!1:!0};
JSM.SpriteViewer.prototype.InitCanvas=function(a){this.points=[];this.canvas=document.getElementById(a);return!this.canvas?!1:!0};JSM.SpriteViewer.prototype.InitCamera=function(a){this.camera=JSM.ValueOrDefault(a,new JSM.Camera);if(!this.camera)return!1;this.navigation=new JSM.Navigation;return!this.navigation.Init(this.canvas,this.camera,this.Draw.bind(this))?!1:!0};
JSM.SpriteViewer.prototype.InitCallbacks=function(a){this.callbacks={onPointDraw:null};void 0!==a&&(void 0!==a.onDrawStart&&(this.callbacks.onDrawStart=a.onDrawStart),void 0!==a.onPointDraw&&(this.callbacks.onPointDraw=a.onPointDraw),void 0!==a.onDrawEnd&&(this.callbacks.onDrawEnd=a.onDrawEnd));return!0};JSM.SpriteViewer.prototype.AddPoint=function(a){this.points.push(a)};JSM.SpriteViewer.prototype.RemovePoints=function(){this.points=[]};JSM.SpriteViewer.prototype.Resize=function(){this.Draw()};
JSM.SpriteViewer.prototype.NearestPointUnderPosition=function(a,b,c){b=new JSM.Coord2D(b,c);c=-1;var d=JSM.Inf,e,f,g;for(e=0;e<this.projected.length;e++)f=this.projected[e],g=JSM.CoordDistance2D(new JSM.Coord2D(f.position.x,f.position.y),b),JSM.IsLower(g,a)&&JSM.IsLower(g,d)&&(c=f.originalIndex,d=g);return c};JSM.SpriteViewer.prototype.NearestPointUnderMouse=function(a){return this.NearestPointUnderPosition(a,this.navigation.mouse.currX,this.navigation.mouse.currY)};
JSM.SpriteViewer.prototype.NearestPointUnderTouch=function(a){return this.NearestPointUnderPosition(a,this.navigation.touch.currX,this.navigation.touch.currY)};JSM.SpriteViewer.prototype.FitInWindow=function(){var a=this.GetCenter(),b=this.GetBoundingSphereRadius(a);this.navigation.FitInWindow(a,b);this.Draw()};JSM.SpriteViewer.prototype.GetCenter=function(){var a=this.GetBoundingBox();return JSM.MidCoord(a[0],a[1])};
JSM.SpriteViewer.prototype.GetBoundingBox=function(){var a=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf),b=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf),c,d;for(c=0;c<this.points.length;c++)d=this.points[c],a.x=JSM.Minimum(a.x,d.x),a.y=JSM.Minimum(a.y,d.y),a.z=JSM.Minimum(a.z,d.z),b.x=JSM.Maximum(b.x,d.x),b.y=JSM.Maximum(b.y,d.y),b.z=JSM.Maximum(b.z,d.z);return[a,b]};
JSM.SpriteViewer.prototype.GetBoundingSphereRadius=function(a){if(void 0===a||null===a)a=this.GetCenter();var b=0,c,d;for(c=0;c<this.points.length;c++)d=this.points[c],d=JSM.CoordDistance(a,d),JSM.IsGreater(d,b)&&(b=d);return b};
JSM.SpriteViewer.prototype.Draw=function(){if(null!==this.callbacks.onDrawStart)this.callbacks.onDrawStart(this.canvas);var a=this.canvas.width/this.canvas.height,b=[0,0,this.canvas.width,this.canvas.height];this.projected=[];var c,d;for(c=0;c<this.points.length;c++)d=this.points[c],d=JSM.Project(d,this.camera.eye,this.camera.center,this.camera.up,this.camera.fieldOfView*JSM.DegRad,a,this.camera.nearClippingPlane,this.camera.farClippingPlane,b),d.y=this.canvas.height-d.y,null!==d&&this.projected.push({position:d,
originalIndex:c});this.projected.sort(function(a,b){return a.position.z>b.position.z?-1:a.position.z<b.position.z?1:0});for(c=0;c<this.projected.length;c++)if(null!==this.callbacks.onPointDraw)this.callbacks.onPointDraw(this.canvas,this.projected[c].originalIndex,this.projected[c].position);if(null!==this.callbacks.onDrawEnd)this.callbacks.onDrawEnd(this.canvas);return!0};JSM.Viewer=function(){this.navigation=this.renderer=this.canvas=null};
JSM.Viewer.prototype.Init=function(a,b,c){return!this.InitRenderer(a,b,c)||!this.InitNavigation()?!1:!0};JSM.Viewer.prototype.InitRenderer=function(a,b,c){this.renderer=new JSM.Renderer;return!this.renderer.Init(a,b,c)?!1:!0};JSM.Viewer.prototype.InitNavigation=function(){this.navigation=new JSM.Navigation;return!this.navigation.Init(this.renderer.canvas,this.renderer.camera,this.Draw.bind(this),this.Resize.bind(this))?!1:!0};
JSM.Viewer.prototype.SetClearColor=function(a,b,c){this.renderer.SetClearColor(a,b,c);this.Draw()};JSM.Viewer.prototype.AddGeometries=function(a){this.renderer.AddGeometries(a);this.Draw()};JSM.Viewer.prototype.RemoveGeometries=function(){this.renderer.RemoveGeometries();this.Draw()};JSM.Viewer.prototype.FitInWindow=function(){var a=this.GetCenter(),b=this.GetBoundingSphereRadius(a);this.navigation.FitInWindow(a,b);this.Draw()};
JSM.Viewer.prototype.GetCenter=function(){var a=this.GetBoundingBox();return JSM.MidCoord(a[0],a[1])};
JSM.Viewer.prototype.GetBoundingBox=function(){var a=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf),b=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf),c,d,e,f;for(c=0;c<this.renderer.geometries.length;c++){e=this.renderer.geometries[c];for(d=0;d<e.VertexCount();d+=1)f=e.GetTransformedVertex(d),a.x=JSM.Minimum(a.x,f.x),a.y=JSM.Minimum(a.y,f.y),a.z=JSM.Minimum(a.z,f.z),b.x=JSM.Maximum(b.x,f.x),b.y=JSM.Maximum(b.y,f.y),b.z=JSM.Maximum(b.z,f.z)}return[a,b]};
JSM.Viewer.prototype.GetBoundingSphereRadius=function(a){if(void 0===a||null===a)a=this.GetCenter();var b=0,c,d,e,f;for(c=0;c<this.renderer.geometries.length;c++){e=this.renderer.geometries[c];for(d=0;d<e.VertexCount();d+=1)f=e.GetTransformedVertex(d),f=JSM.CoordDistance(a,f),JSM.IsGreater(f,b)&&(b=f)}return b};JSM.Viewer.prototype.Resize=function(){this.renderer.Resize();this.Draw()};JSM.Viewer.prototype.Draw=function(){this.renderer.Render()};
JSM.PointCloudViewer=function(){this.navigation=this.renderer=this.canvas=null};JSM.PointCloudViewer.prototype.Init=function(a,b){return!this.InitRenderer(a,b)||!this.InitNavigation()?!1:!0};JSM.PointCloudViewer.prototype.InitRenderer=function(a,b){this.renderer=new JSM.PointCloudRenderer;return!this.renderer.Init(a,b)?!1:!0};
JSM.PointCloudViewer.prototype.InitNavigation=function(){this.navigation=new JSM.Navigation;return!this.navigation.Init(this.renderer.canvas,this.renderer.camera,this.Draw.bind(this),this.Resize.bind(this))?!1:!0};JSM.PointCloudViewer.prototype.SetClearColor=function(a,b,c){this.renderer.SetClearColor(a,b,c)};JSM.PointCloudViewer.prototype.SetPointSize=function(a){this.renderer.SetPointSize(a)};JSM.PointCloudViewer.prototype.AddPoints=function(a,b){this.renderer.AddPoints(a,b)};
JSM.PointCloudViewer.prototype.RemovePoints=function(){this.renderer.RemovePoints()};JSM.PointCloudViewer.prototype.FitInWindow=function(){var a=this.GetCenter(),b=this.GetBoundingSphereRadius(a);this.navigation.FitInWindow(a,b);this.Draw()};JSM.PointCloudViewer.prototype.GetCenter=function(){var a=this.GetBoundingBox();return JSM.MidCoord(a[0],a[1])};
JSM.PointCloudViewer.prototype.GetBoundingBox=function(){var a=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf),b=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf),c,d,e,f;for(c=0;c<this.renderer.points.length;c++){e=this.renderer.points[c].pointArray;for(d=0;d<e.length;d+=3)f=new JSM.Coord(e[d],e[d+1],e[d+2]),a.x=JSM.Minimum(a.x,f.x),a.y=JSM.Minimum(a.y,f.y),a.z=JSM.Minimum(a.z,f.z),b.x=JSM.Maximum(b.x,f.x),b.y=JSM.Maximum(b.y,f.y),b.z=JSM.Maximum(b.z,f.z)}return[a,b]};
JSM.PointCloudViewer.prototype.GetBoundingSphereRadius=function(a){if(void 0===a||null===a)a=this.GetCenter();var b=0,c,d,e,f;for(c=0;c<this.renderer.points.length;c++){e=this.renderer.points[c].pointArray;for(d=0;d<e.length;d+=3)f=new JSM.Coord(e[d],e[d+1],e[d+2]),f=JSM.CoordDistance(a,f),JSM.IsGreater(f,b)&&(b=f)}return b};JSM.PointCloudViewer.prototype.Resize=function(){this.renderer.Resize();this.Draw()};JSM.PointCloudViewer.prototype.Draw=function(){this.renderer.Render()};
JSM.ConvertBodyToThreeMeshes=function(a,b,c){var d={textureLoadedCallback:null,hasConvexPolygons:!1,doubleSided:!0};void 0!==c&&null!==c&&(d.textureLoadedCallback=JSM.ValueOrDefault(c.textureLoadedCallback,d.textureLoadedCallback),d.hasConvexPolygons=JSM.ValueOrDefault(c.hasConvexPolygons,d.hasConvexPolygons),d.doubleSided=JSM.ValueOrDefault(c.doubleSided,d.doubleSided));var e=[],f=null;JSM.ExplodeBodyToTriangles(a,b,{hasConvexPolygons:d.hasConvexPolygons,onGeometryStart:function(){f=new THREE.Geometry},
onGeometryEnd:function(a){var b=null!==a.texture,c=1!==a.opacity,k=new THREE.MeshPhongMaterial({ambient:a.ambient,color:a.diffuse,specular:a.specular});d.doubleSided&&(k.side=THREE.DoubleSide);c&&(k.opacity=a.opacity,k.transparent=!0);b&&(a=THREE.ImageUtils.loadTexture(a.texture,new THREE.UVMapping,function(){null!==d.textureLoadedCallback&&d.textureLoadedCallback()}),a.wrapS=THREE.RepeatWrapping,a.wrapT=THREE.RepeatWrapping,k.map=a);f.computeFaceNormals();k=new THREE.Mesh(f,k);e.push(k)},onTriangle:function(a,
b,c,d,e,n,p,q,r){var s=f.vertices.length;f.vertices.push(new THREE.Vector3(a.x,a.y,a.z));f.vertices.push(new THREE.Vector3(b.x,b.y,b.z));f.vertices.push(new THREE.Vector3(c.x,c.y,c.z));a=new THREE.Face3(s+0,s+1,s+2);f.faces.push(a);null!==d&&(null!==e&&null!==n)&&(a=[],a.push(new THREE.Vector3(d.x,d.y,d.z)),a.push(new THREE.Vector3(e.x,e.y,e.z)),a.push(new THREE.Vector3(n.x,n.y,n.z)),f.faces[f.faces.length-1].vertexNormals=a);null!==p&&(null!==q&&null!==r)&&(d=[],d.push(new THREE.Vector2(p.x,-p.y)),
d.push(new THREE.Vector2(q.x,-q.y)),d.push(new THREE.Vector2(r.x,-r.y)),f.faceVertexUvs[0].push(d))}});return e};JSM.ConvertModelToThreeMeshes=function(a,b,c){var d=[],e=[],f,g;for(f=0;f<a.BodyCount();f++){e=a.GetBody(f);e=JSM.ConvertBodyToThreeMeshes(e,b,c);for(g=0;g<e.length;g++)d.push(e[g])}return d};
JSM.ConvertJSONDataToThreeMeshes=function(a,b,c){function d(a,c){function d(a){var l=a.parameters,m=f[a.material];a=m.texture;var r=m.offset,s=m.scale,C=new THREE.Color,u=new THREE.Color,H=new THREE.Color;C.setRGB(m.ambient[0],m.ambient[1],m.ambient[2]);u.setRGB(m.diffuse[0],m.diffuse[1],m.diffuse[2]);H.setRGB(m.specular[0],m.specular[1],m.specular[2]);void 0!==a&&(C.setRGB(1,1,1),u.setRGB(1,1,1),H.setRGB(1,1,1),void 0===r&&(r=[0,0]),void 0===s&&(s=[1,1]));C=new THREE.MeshPhongMaterial({ambient:u.getHex(),
color:u.getHex(),specular:H.getHex(),side:THREE.DoubleSide});1!==m.opacity&&(C.opacity=m.opacity,C.transparent=!0);void 0!==a&&(m=THREE.ImageUtils.loadTexture(a,new THREE.UVMapping,function(){void 0!==b&&null!==b&&b()}),m.wrapS=THREE.RepeatWrapping,m.wrapT=THREE.RepeatWrapping,C.map=m);var m=new THREE.Geometry,z,I,J,D,A,B,K,L,M,w;for(w=0;w<l.length;w+=9)z=3*l[w+0],I=3*l[w+1],J=3*l[w+2],D=3*l[w+3],A=3*l[w+4],B=3*l[w+5],u=2*l[w+6],H=2*l[w+7],K=2*l[w+8],L=m.vertices.length,M=m.faces.length,m.vertices.push(new THREE.Vector3(g[z+
0],g[z+1],g[z+2])),m.vertices.push(new THREE.Vector3(g[I+0],g[I+1],g[I+2])),m.vertices.push(new THREE.Vector3(g[J+0],g[J+1],g[J+2])),m.faces.push(new THREE.Face3(L+0,L+1,L+2)),z=[],z.push(new THREE.Vector3(h[D+0],h[D+1],h[D+2])),z.push(new THREE.Vector3(h[A+0],h[A+1],h[A+2])),z.push(new THREE.Vector3(h[B+0],h[B+1],h[B+2])),m.faces[M].vertexNormals=z,void 0!==a&&(D=[],D.push(new THREE.Vector2(r[0]+q[u+0]*s[0],r[1]+q[u+1]*s[1])),D.push(new THREE.Vector2(r[0]+q[H+0]*s[0],r[1]+q[H+1]*s[1])),D.push(new THREE.Vector2(r[0]+
q[K+0]*s[0],r[1]+q[K+1]*s[1])),m.faceVertexUvs[0].push(D));l=new THREE.Mesh(m,C);l.originalJsonIndex=c;e.push(l)}var g=a.vertices;if(void 0!==g){var h=a.normals;if(void 0!==h){var q=a.uvs;if(void 0!==q){var r=a.triangles,s;for(s=0;s<r.length;s++)d(r[s])}}}}var e=[],f=a.materials;if(void 0===f)return e;var g=a.meshes;if(void 0===g)return e;var h=0;JSM.AsyncRunTask(function(){d(g[h],h);h+=1;return!0},c,g.length,0,e);return e};JSM.JSONFileConverter=function(a,b){this.onReady=a;this.onTextureLoaded=b};
JSM.JSONFileConverter.prototype.Convert=function(a){(new JSM.JSONFileLoader(this.OnReady.bind(this))).Load(a)};JSM.JSONFileConverter.prototype.OnReady=function(a){null!==this.onReady&&(a=JSM.ConvertJSONDataToThreeMeshes(a,this.onTextureLoaded),this.onReady(a))};JSM.ThreeViewer=function(){this.enableDraw=this.drawLoop=this.settings=this.navigation=this.cameraMove=this.runAfterRender=this.runBeforeRender=this.directionalLight=this.ambientLight=this.renderer=this.camera=this.scene=this.canvas=null};
JSM.ThreeViewer.prototype.Start=function(a,b){if(!this.IsWebGLEnabled()||!this.InitSettings(b)||!this.InitThree(a)||!this.InitCamera(b)||!this.InitLights())return!1;this.drawLoop=!1;this.enableDraw=!0;this.DrawIfNeeded();return!0};JSM.ThreeViewer.prototype.IsWebGLEnabled=function(){return!window.WebGLRenderingContext||!document.createElement("canvas").getContext("experimental-webgl")?!1:!0};
JSM.ThreeViewer.prototype.InitSettings=function(a){this.settings={cameraEyePosition:new JSM.Coord(1,1,1),cameraCenterPosition:new JSM.Coord(0,0,0),cameraUpVector:new JSM.Coord(0,0,1),lightAmbientColor:[0.5,0.5,0.5],lightDiffuseColor:[0.5,0.5,0.5]};void 0!==a&&(void 0!==a.cameraEyePosition&&(this.settings.cameraEyePosition=JSM.CoordFromArray(a.cameraEyePosition)),void 0!==a.cameraCenterPosition&&(this.settings.cameraCenterPosition=JSM.CoordFromArray(a.cameraCenterPosition)),void 0!==a.cameraUpVector&&
(this.settings.cameraUpVector=JSM.CoordFromArray(a.cameraUpVector)),void 0!==a.lightAmbientColor&&(this.settings.lightAmbientColor=a.lightAmbientColor),void 0!==a.lightDiffuseColor&&(this.settings.lightDiffuseColor=a.lightDiffuseColor));return!0};
JSM.ThreeViewer.prototype.InitThree=function(a){this.canvas=document.getElementById(a);if(!this.canvas||!this.canvas.getContext)return!1;this.scene=new THREE.Scene;if(!this.scene)return!1;this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,antialias:!0});if(!this.renderer)return!1;this.renderer.setClearColor(new THREE.Color(16777215));this.renderer.setSize(this.canvas.width,this.canvas.height);return!0};
JSM.ThreeViewer.prototype.InitCamera=function(a){this.cameraMove=new JSM.Camera(JSM.CoordFromArray(a.cameraEyePosition),JSM.CoordFromArray(a.cameraCenterPosition),JSM.CoordFromArray(a.cameraUpVector),a.fieldOfView,a.nearClippingPlane,a.farClippingPlane);if(!this.cameraMove)return!1;this.navigation=new JSM.Navigation;if(!this.navigation.Init(this.canvas,this.cameraMove,this.DrawIfNeeded.bind(this),this.Resize.bind(this)))return!1;this.camera=new THREE.PerspectiveCamera(this.cameraMove.fieldOfView,
this.canvas.width/this.canvas.height,this.cameraMove.nearClippingPlane,this.cameraMove.farClippingPlane);if(!this.camera)return!1;this.scene.add(this.camera);return!0};
JSM.ThreeViewer.prototype.InitLights=function(){var a=new THREE.Color,b=new THREE.Color;a.setRGB(this.settings.lightAmbientColor[0],this.settings.lightAmbientColor[1],this.settings.lightAmbientColor[2]);b.setRGB(this.settings.lightDiffuseColor[0],this.settings.lightDiffuseColor[1],this.settings.lightDiffuseColor[2]);this.ambientLight=new THREE.AmbientLight(a.getHex());if(!this.ambientLight)return!1;this.scene.add(this.ambientLight);this.directionalLight=new THREE.DirectionalLight(b.getHex());if(!this.directionalLight)return!1;
a=(new THREE.Vector3).subVectors(this.cameraMove.eye,this.cameraMove.center);this.directionalLight.position.set(a.x,a.y,a.z);this.scene.add(this.directionalLight);return!0};JSM.ThreeViewer.prototype.SetRunBeforeRender=function(a){this.runBeforeRender=a};JSM.ThreeViewer.prototype.SetRunAfterRender=function(a){this.runAfterRender=a};JSM.ThreeViewer.prototype.SetClearColor=function(a){this.renderer.setClearColor(new THREE.Color(a));this.DrawIfNeeded()};
JSM.ThreeViewer.prototype.AddMesh=function(a){this.scene.add(a);this.DrawIfNeeded()};JSM.ThreeViewer.prototype.AddMeshes=function(a){var b;for(b=0;b<a.length;b++)this.scene.add(a[b]);this.DrawIfNeeded()};JSM.ThreeViewer.prototype.MeshCount=function(){var a=0;this.scene.traverse(function(b){b instanceof THREE.Mesh&&(a+=1)});return a};JSM.ThreeViewer.prototype.VertexCount=function(){var a=0;this.scene.traverse(function(b){b instanceof THREE.Mesh&&(a+=b.geometry.vertices.length)});return a};
JSM.ThreeViewer.prototype.FaceCount=function(){var a=0;this.scene.traverse(function(b){b instanceof THREE.Mesh&&(a+=b.geometry.faces.length)});return a};JSM.ThreeViewer.prototype.GetMesh=function(a){var b=null,c=0,d;for(d=0;d<this.scene.children.length;d++)if(b=this.scene.children[d],b instanceof THREE.Mesh){if(c==a)return b;c+=1}return null};JSM.ThreeViewer.prototype.RemoveMesh=function(a){this.scene.remove(a);this.DrawIfNeeded()};
JSM.ThreeViewer.prototype.RemoveMeshes=function(){var a,b;for(b=0;b<this.scene.children.length;b++)a=this.scene.children[b],a instanceof THREE.Mesh&&(this.scene.remove(a),b--);this.DrawIfNeeded()};JSM.ThreeViewer.prototype.RemoveLastMesh=function(){var a=null;this.scene.traverse(function(b){b instanceof THREE.Mesh&&(a=b)});null!==a&&this.scene.remove(a);this.DrawIfNeeded()};
JSM.ThreeViewer.prototype.SetCamera=function(a,b,c){this.navigation.SetCamera(a,b,c);this.navigation.SetOrbitCenter(b.Clone());this.DrawIfNeeded()};JSM.ThreeViewer.prototype.Resize=function(){this.camera.aspect=this.canvas.width/this.canvas.height;this.camera.updateProjectionMatrix();this.renderer.setSize(this.canvas.width,this.canvas.height);this.DrawIfNeeded()};
JSM.ThreeViewer.prototype.FitInWindow=function(){if(0!==this.MeshCount()){var a=this.GetCenter(),b=this.GetBoundingSphereRadius(a);this.navigation.FitInWindow(a,b);this.DrawIfNeeded()}};JSM.ThreeViewer.prototype.AdjustClippingPlanes=function(a){var b=this.GetCenter();this.GetBoundingSphereRadius(b)<a?(this.camera.near=0.1,this.camera.far=1E3):(this.camera.near=10,this.camera.far=1E6);this.camera.updateProjectionMatrix();this.Draw()};
JSM.ThreeViewer.prototype.GetCenter=function(){var a=this.GetBoundingBox();return JSM.MidCoord(a[0],a[1])};
JSM.ThreeViewer.prototype.GetBoundingBox=function(){var a=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf),b=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf),c,d;this.scene.traverse(function(e){if(e instanceof THREE.Mesh){c=e.geometry;var f;for(f=0;f<c.vertices.length;f++)d=c.vertices[f].clone(),d.add(e.position),a.x=JSM.Minimum(a.x,d.x),a.y=JSM.Minimum(a.y,d.y),a.z=JSM.Minimum(a.z,d.z),b.x=JSM.Maximum(b.x,d.x),b.y=JSM.Maximum(b.y,d.y),b.z=JSM.Maximum(b.z,d.z)}});return[a,b]};
JSM.ThreeViewer.prototype.GetBoundingSphereRadius=function(a){if(void 0===a||null===a)a=this.GetCenter();var b=0,c,d,e;this.scene.traverse(function(f){if(f instanceof THREE.Mesh){c=f.geometry;var g;for(g=0;g<c.vertices.length;g++)d=c.vertices[g].clone(),d.add(f.position),e=JSM.CoordDistance(a,new JSM.Coord(d.x,d.y,d.z)),JSM.IsGreater(e,b)&&(b=e)}});return b};
JSM.ThreeViewer.prototype.GetObjectsUnderPosition=function(a,b){var c=2*(a/this.canvas.width)-1,d=2*-(b/this.canvas.height)+1,e=new THREE.Projector,f=this.camera.position,c=new THREE.Vector3(c,d,0.5);e.unprojectVector(c,this.camera);c.sub(f);c.normalize();return(new THREE.Raycaster(f,c)).intersectObjects(this.scene.children)};JSM.ThreeViewer.prototype.GetObjectsUnderMouse=function(){return this.GetObjectsUnderPosition(this.navigation.mouse.currX,this.navigation.mouse.currY)};
JSM.ThreeViewer.prototype.GetObjectsUnderTouch=function(){return this.GetObjectsUnderPosition(this.navigation.touch.currX,this.navigation.touch.currY)};JSM.ThreeViewer.prototype.ProjectVector=function(a,b,c){var d=this.canvas.width/2,e=this.canvas.height/2,f=new THREE.Projector;a=new THREE.Vector3(a,b,c);f.projectVector(a,this.camera);a.x=a.x*d+d;a.y=-(a.y*e)+e;return a};JSM.ThreeViewer.prototype.EnableDraw=function(a){this.enableDraw=a};
JSM.ThreeViewer.prototype.Draw=function(){if(this.enableDraw){null!==this.runBeforeRender&&this.runBeforeRender();this.camera.position.set(this.cameraMove.eye.x,this.cameraMove.eye.y,this.cameraMove.eye.z);this.camera.up.set(this.cameraMove.up.x,this.cameraMove.up.y,this.cameraMove.up.z);this.camera.lookAt(new THREE.Vector3(this.cameraMove.center.x,this.cameraMove.center.y,this.cameraMove.center.z));var a=(new THREE.Vector3).subVectors(this.cameraMove.eye,this.cameraMove.center);this.directionalLight.position.set(a.x,
a.y,a.z);this.renderer.render(this.scene,this.camera);null!==this.runAfterRender&&this.runAfterRender();this.drawLoop&&requestAnimationFrame(this.Draw.bind(this))}};JSM.ThreeViewer.prototype.DrawIfNeeded=function(){this.drawLoop||this.Draw()};JSM.ThreeViewer.prototype.StartDrawLoop=function(){this.drawLoop=!0;this.Draw()};


// This is ammo.js, a port of Bullet Physics to JavaScript. zlib licensed.
var AmmoLib = function(Module) {
  Module = Module || {};

var Module;if(!Module)Module=(typeof AmmoLib!=="undefined"?AmmoLib:null)||{};var moduleOverrides={};for(var key in Module){if(Module.hasOwnProperty(key)){moduleOverrides[key]=Module[key]}}var ENVIRONMENT_IS_WEB=typeof window==="object";var ENVIRONMENT_IS_NODE=typeof process==="object"&&typeof require==="function"&&!ENVIRONMENT_IS_WEB;var ENVIRONMENT_IS_WORKER=typeof importScripts==="function";var ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;if(ENVIRONMENT_IS_NODE){if(!Module["print"])Module["print"]=function print(x){process["stdout"].write(x+"\n")};if(!Module["printErr"])Module["printErr"]=function printErr(x){process["stderr"].write(x+"\n")};var nodeFS=require("fs");var nodePath=require("path");Module["read"]=function read(filename,binary){filename=nodePath["normalize"](filename);var ret=nodeFS["readFileSync"](filename);if(!ret&&filename!=nodePath["resolve"](filename)){filename=path.join(__dirname,"..","src",filename);ret=nodeFS["readFileSync"](filename)}if(ret&&!binary)ret=ret.toString();return ret};Module["readBinary"]=function readBinary(filename){return Module["read"](filename,true)};Module["load"]=function load(f){globalEval(read(f))};if(!Module["thisProgram"]){if(process["argv"].length>1){Module["thisProgram"]=process["argv"][1].replace(/\\/g,"/")}else{Module["thisProgram"]="unknown-program"}}Module["arguments"]=process["argv"].slice(2);if(typeof module!=="undefined"){module["exports"]=Module}process["on"]("uncaughtException",(function(ex){if(!(ex instanceof ExitStatus)){throw ex}}));Module["inspect"]=(function(){return"[Emscripten Module object]"})}else if(ENVIRONMENT_IS_SHELL){if(!Module["print"])Module["print"]=print;if(typeof printErr!="undefined")Module["printErr"]=printErr;if(typeof read!="undefined"){Module["read"]=read}else{Module["read"]=function read(){throw"no read() available (jsc?)"}}Module["readBinary"]=function readBinary(f){if(typeof readbuffer==="function"){return new Uint8Array(readbuffer(f))}var data=read(f,"binary");assert(typeof data==="object");return data};if(typeof scriptArgs!="undefined"){Module["arguments"]=scriptArgs}else if(typeof arguments!="undefined"){Module["arguments"]=arguments}}else if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){Module["read"]=function read(url){var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.send(null);return xhr.responseText};if(typeof arguments!="undefined"){Module["arguments"]=arguments}if(typeof console!=="undefined"){if(!Module["print"])Module["print"]=function print(x){console.log(x)};if(!Module["printErr"])Module["printErr"]=function printErr(x){console.log(x)}}else{var TRY_USE_DUMP=false;if(!Module["print"])Module["print"]=TRY_USE_DUMP&&typeof dump!=="undefined"?(function(x){dump(x)}):(function(x){})}if(ENVIRONMENT_IS_WORKER){Module["load"]=importScripts}if(typeof Module["setWindowTitle"]==="undefined"){Module["setWindowTitle"]=(function(title){document.title=title})}}else{throw"Unknown runtime environment. Where are we?"}function globalEval(x){throw"NO_DYNAMIC_EXECUTION was set, cannot eval"}if(!Module["load"]&&Module["read"]){Module["load"]=function load(f){globalEval(Module["read"](f))}}if(!Module["print"]){Module["print"]=(function(){})}if(!Module["printErr"]){Module["printErr"]=Module["print"]}if(!Module["arguments"]){Module["arguments"]=[]}if(!Module["thisProgram"]){Module["thisProgram"]="./this.program"}Module.print=Module["print"];Module.printErr=Module["printErr"];Module["preRun"]=[];Module["postRun"]=[];for(var key in moduleOverrides){if(moduleOverrides.hasOwnProperty(key)){Module[key]=moduleOverrides[key]}}var Runtime={setTempRet0:(function(value){tempRet0=value}),getTempRet0:(function(){return tempRet0}),stackSave:(function(){return STACKTOP}),stackRestore:(function(stackTop){STACKTOP=stackTop}),getNativeTypeSize:(function(type){switch(type){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:{if(type[type.length-1]==="*"){return Runtime.QUANTUM_SIZE}else if(type[0]==="i"){var bits=parseInt(type.substr(1));assert(bits%8===0);return bits/8}else{return 0}}}}),getNativeFieldSize:(function(type){return Math.max(Runtime.getNativeTypeSize(type),Runtime.QUANTUM_SIZE)}),STACK_ALIGN:16,prepVararg:(function(ptr,type){if(type==="double"||type==="i64"){if(ptr&7){assert((ptr&7)===4);ptr+=4}}else{assert((ptr&3)===0)}return ptr}),getAlignSize:(function(type,size,vararg){if(!vararg&&(type=="i64"||type=="double"))return 8;if(!type)return Math.min(size,8);return Math.min(size||(type?Runtime.getNativeFieldSize(type):0),Runtime.QUANTUM_SIZE)}),dynCall:(function(sig,ptr,args){if(args&&args.length){if(!args.splice)args=Array.prototype.slice.call(args);args.splice(0,0,ptr);return Module["dynCall_"+sig].apply(null,args)}else{return Module["dynCall_"+sig].call(null,ptr)}}),functionPointers:[],addFunction:(function(func){for(var i=0;i<Runtime.functionPointers.length;i++){if(!Runtime.functionPointers[i]){Runtime.functionPointers[i]=func;return 2*(1+i)}}throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."}),removeFunction:(function(index){Runtime.functionPointers[(index-2)/2]=null}),warnOnce:(function(text){if(!Runtime.warnOnce.shown)Runtime.warnOnce.shown={};if(!Runtime.warnOnce.shown[text]){Runtime.warnOnce.shown[text]=1;Module.printErr(text)}}),funcWrappers:{},getFuncWrapper:(function(func,sig){assert(sig);if(!Runtime.funcWrappers[sig]){Runtime.funcWrappers[sig]={}}var sigCache=Runtime.funcWrappers[sig];if(!sigCache[func]){sigCache[func]=function dynCall_wrapper(){return Runtime.dynCall(sig,func,arguments)}}return sigCache[func]}),getCompilerSetting:(function(name){throw"You must build with -s RETAIN_COMPILER_SETTINGS=1 for Runtime.getCompilerSetting or emscripten_get_compiler_setting to work"}),stackAlloc:(function(size){var ret=STACKTOP;STACKTOP=STACKTOP+size|0;STACKTOP=STACKTOP+15&-16;return ret}),staticAlloc:(function(size){var ret=STATICTOP;STATICTOP=STATICTOP+size|0;STATICTOP=STATICTOP+15&-16;return ret}),dynamicAlloc:(function(size){var ret=DYNAMICTOP;DYNAMICTOP=DYNAMICTOP+size|0;DYNAMICTOP=DYNAMICTOP+15&-16;if(DYNAMICTOP>=TOTAL_MEMORY){var success=enlargeMemory();if(!success){DYNAMICTOP=ret;return 0}}return ret}),alignMemory:(function(size,quantum){var ret=size=Math.ceil(size/(quantum?quantum:16))*(quantum?quantum:16);return ret}),makeBigInt:(function(low,high,unsigned){var ret=unsigned?+(low>>>0)+ +(high>>>0)*+4294967296:+(low>>>0)+ +(high|0)*+4294967296;return ret}),GLOBAL_BASE:8,QUANTUM_SIZE:4,__dummy__:0};Module["Runtime"]=Runtime;var __THREW__=0;var ABORT=false;var EXITSTATUS=0;var undef=0;var tempValue,tempInt,tempBigInt,tempInt2,tempBigInt2,tempPair,tempBigIntI,tempBigIntR,tempBigIntS,tempBigIntP,tempBigIntD,tempDouble,tempFloat;var tempI64,tempI64b;var tempRet0,tempRet1,tempRet2,tempRet3,tempRet4,tempRet5,tempRet6,tempRet7,tempRet8,tempRet9;function assert(condition,text){if(!condition){abort("Assertion failed: "+text)}}var globalScope=this;function getCFunc(ident){var func=Module["_"+ident];if(!func){abort("NO_DYNAMIC_EXECUTION was set, cannot eval - ccall/cwrap are not functional")}assert(func,"Cannot call unknown function "+ident+" (perhaps LLVM optimizations or closure removed it?)");return func}var cwrap,ccall;((function(){var JSfuncs={"stackSave":(function(){Runtime.stackSave()}),"stackRestore":(function(){Runtime.stackRestore()}),"arrayToC":(function(arr){var ret=Runtime.stackAlloc(arr.length);writeArrayToMemory(arr,ret);return ret}),"stringToC":(function(str){var ret=0;if(str!==null&&str!==undefined&&str!==0){ret=Runtime.stackAlloc((str.length<<2)+1);writeStringToMemory(str,ret)}return ret})};var toC={"string":JSfuncs["stringToC"],"array":JSfuncs["arrayToC"]};ccall=function ccallFunc(ident,returnType,argTypes,args,opts){var func=getCFunc(ident);var cArgs=[];var stack=0;if(args){for(var i=0;i<args.length;i++){var converter=toC[argTypes[i]];if(converter){if(stack===0)stack=Runtime.stackSave();cArgs[i]=converter(args[i])}else{cArgs[i]=args[i]}}}var ret=func.apply(null,cArgs);if(returnType==="string")ret=Pointer_stringify(ret);if(stack!==0){if(opts&&opts.async){EmterpreterAsync.asyncFinalizers.push((function(){Runtime.stackRestore(stack)}));return}Runtime.stackRestore(stack)}return ret};cwrap=function cwrap(ident,returnType,argTypes){return(function(){return ccall(ident,returnType,argTypes,arguments)})}}))();Module["cwrap"]=cwrap;Module["ccall"]=ccall;function setValue(ptr,value,type,noSafe){type=type||"i8";if(type.charAt(type.length-1)==="*")type="i32";switch(type){case"i1":HEAP8[ptr>>0]=value;break;case"i8":HEAP8[ptr>>0]=value;break;case"i16":HEAP16[ptr>>1]=value;break;case"i32":HEAP32[ptr>>2]=value;break;case"i64":tempI64=[value>>>0,(tempDouble=value,+Math_abs(tempDouble)>=+1?tempDouble>+0?(Math_min(+Math_floor(tempDouble/+4294967296),+4294967295)|0)>>>0:~~+Math_ceil((tempDouble- +(~~tempDouble>>>0))/+4294967296)>>>0:0)],HEAP32[ptr>>2]=tempI64[0],HEAP32[ptr+4>>2]=tempI64[1];break;case"float":HEAPF32[ptr>>2]=value;break;case"double":HEAPF64[ptr>>3]=value;break;default:abort("invalid type for setValue: "+type)}}Module["setValue"]=setValue;function getValue(ptr,type,noSafe){type=type||"i8";if(type.charAt(type.length-1)==="*")type="i32";switch(type){case"i1":return HEAP8[ptr>>0];case"i8":return HEAP8[ptr>>0];case"i16":return HEAP16[ptr>>1];case"i32":return HEAP32[ptr>>2];case"i64":return HEAP32[ptr>>2];case"float":return HEAPF32[ptr>>2];case"double":return HEAPF64[ptr>>3];default:abort("invalid type for setValue: "+type)}return null}Module["getValue"]=getValue;var ALLOC_NORMAL=0;var ALLOC_STACK=1;var ALLOC_STATIC=2;var ALLOC_DYNAMIC=3;var ALLOC_NONE=4;Module["ALLOC_NORMAL"]=ALLOC_NORMAL;Module["ALLOC_STACK"]=ALLOC_STACK;Module["ALLOC_STATIC"]=ALLOC_STATIC;Module["ALLOC_DYNAMIC"]=ALLOC_DYNAMIC;Module["ALLOC_NONE"]=ALLOC_NONE;function allocate(slab,types,allocator,ptr){var zeroinit,size;if(typeof slab==="number"){zeroinit=true;size=slab}else{zeroinit=false;size=slab.length}var singleType=typeof types==="string"?types:null;var ret;if(allocator==ALLOC_NONE){ret=ptr}else{ret=[_malloc,Runtime.stackAlloc,Runtime.staticAlloc,Runtime.dynamicAlloc][allocator===undefined?ALLOC_STATIC:allocator](Math.max(size,singleType?1:types.length))}if(zeroinit){var ptr=ret,stop;assert((ret&3)==0);stop=ret+(size&~3);for(;ptr<stop;ptr+=4){HEAP32[ptr>>2]=0}stop=ret+size;while(ptr<stop){HEAP8[ptr++>>0]=0}return ret}if(singleType==="i8"){if(slab.subarray||slab.slice){HEAPU8.set(slab,ret)}else{HEAPU8.set(new Uint8Array(slab),ret)}return ret}var i=0,type,typeSize,previousType;while(i<size){var curr=slab[i];if(typeof curr==="function"){curr=Runtime.getFunctionIndex(curr)}type=singleType||types[i];if(type===0){i++;continue}if(type=="i64")type="i32";setValue(ret+i,curr,type);if(previousType!==type){typeSize=Runtime.getNativeTypeSize(type);previousType=type}i+=typeSize}return ret}Module["allocate"]=allocate;function Pointer_stringify(ptr,length){if(length===0||!ptr)return"";var hasUtf=0;var t;var i=0;while(1){t=HEAPU8[ptr+i>>0];hasUtf|=t;if(t==0&&!length)break;i++;if(length&&i==length)break}if(!length)length=i;var ret="";if(hasUtf<128){var MAX_CHUNK=1024;var curr;while(length>0){curr=String.fromCharCode.apply(String,HEAPU8.subarray(ptr,ptr+Math.min(length,MAX_CHUNK)));ret=ret?ret+curr:curr;ptr+=MAX_CHUNK;length-=MAX_CHUNK}return ret}return Module["UTF8ToString"](ptr)}Module["Pointer_stringify"]=Pointer_stringify;function AsciiToString(ptr){var str="";while(1){var ch=HEAP8[ptr++>>0];if(!ch)return str;str+=String.fromCharCode(ch)}}Module["AsciiToString"]=AsciiToString;function stringToAscii(str,outPtr){return writeAsciiToMemory(str,outPtr,false)}Module["stringToAscii"]=stringToAscii;function UTF8ArrayToString(u8Array,idx){var u0,u1,u2,u3,u4,u5;var str="";while(1){u0=u8Array[idx++];if(!u0)return str;if(!(u0&128)){str+=String.fromCharCode(u0);continue}u1=u8Array[idx++]&63;if((u0&224)==192){str+=String.fromCharCode((u0&31)<<6|u1);continue}u2=u8Array[idx++]&63;if((u0&240)==224){u0=(u0&15)<<12|u1<<6|u2}else{u3=u8Array[idx++]&63;if((u0&248)==240){u0=(u0&7)<<18|u1<<12|u2<<6|u3}else{u4=u8Array[idx++]&63;if((u0&252)==248){u0=(u0&3)<<24|u1<<18|u2<<12|u3<<6|u4}else{u5=u8Array[idx++]&63;u0=(u0&1)<<30|u1<<24|u2<<18|u3<<12|u4<<6|u5}}}if(u0<65536){str+=String.fromCharCode(u0)}else{var ch=u0-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}}}Module["UTF8ArrayToString"]=UTF8ArrayToString;function UTF8ToString(ptr){return UTF8ArrayToString(HEAPU8,ptr)}Module["UTF8ToString"]=UTF8ToString;function stringToUTF8Array(str,outU8Array,outIdx,maxBytesToWrite){if(!(maxBytesToWrite>0))return 0;var startIdx=outIdx;var endIdx=outIdx+maxBytesToWrite-1;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343)u=65536+((u&1023)<<10)|str.charCodeAt(++i)&1023;if(u<=127){if(outIdx>=endIdx)break;outU8Array[outIdx++]=u}else if(u<=2047){if(outIdx+1>=endIdx)break;outU8Array[outIdx++]=192|u>>6;outU8Array[outIdx++]=128|u&63}else if(u<=65535){if(outIdx+2>=endIdx)break;outU8Array[outIdx++]=224|u>>12;outU8Array[outIdx++]=128|u>>6&63;outU8Array[outIdx++]=128|u&63}else if(u<=2097151){if(outIdx+3>=endIdx)break;outU8Array[outIdx++]=240|u>>18;outU8Array[outIdx++]=128|u>>12&63;outU8Array[outIdx++]=128|u>>6&63;outU8Array[outIdx++]=128|u&63}else if(u<=67108863){if(outIdx+4>=endIdx)break;outU8Array[outIdx++]=248|u>>24;outU8Array[outIdx++]=128|u>>18&63;outU8Array[outIdx++]=128|u>>12&63;outU8Array[outIdx++]=128|u>>6&63;outU8Array[outIdx++]=128|u&63}else{if(outIdx+5>=endIdx)break;outU8Array[outIdx++]=252|u>>30;outU8Array[outIdx++]=128|u>>24&63;outU8Array[outIdx++]=128|u>>18&63;outU8Array[outIdx++]=128|u>>12&63;outU8Array[outIdx++]=128|u>>6&63;outU8Array[outIdx++]=128|u&63}}outU8Array[outIdx]=0;return outIdx-startIdx}Module["stringToUTF8Array"]=stringToUTF8Array;function stringToUTF8(str,outPtr,maxBytesToWrite){return stringToUTF8Array(str,HEAPU8,outPtr,maxBytesToWrite)}Module["stringToUTF8"]=stringToUTF8;function lengthBytesUTF8(str){var len=0;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343)u=65536+((u&1023)<<10)|str.charCodeAt(++i)&1023;if(u<=127){++len}else if(u<=2047){len+=2}else if(u<=65535){len+=3}else if(u<=2097151){len+=4}else if(u<=67108863){len+=5}else{len+=6}}return len}Module["lengthBytesUTF8"]=lengthBytesUTF8;function UTF16ToString(ptr){var i=0;var str="";while(1){var codeUnit=HEAP16[ptr+i*2>>1];if(codeUnit==0)return str;++i;str+=String.fromCharCode(codeUnit)}}Module["UTF16ToString"]=UTF16ToString;function stringToUTF16(str,outPtr,maxBytesToWrite){if(maxBytesToWrite===undefined){maxBytesToWrite=2147483647}if(maxBytesToWrite<2)return 0;maxBytesToWrite-=2;var startPtr=outPtr;var numCharsToWrite=maxBytesToWrite<str.length*2?maxBytesToWrite/2:str.length;for(var i=0;i<numCharsToWrite;++i){var codeUnit=str.charCodeAt(i);HEAP16[outPtr>>1]=codeUnit;outPtr+=2}HEAP16[outPtr>>1]=0;return outPtr-startPtr}Module["stringToUTF16"]=stringToUTF16;function lengthBytesUTF16(str){return str.length*2}Module["lengthBytesUTF16"]=lengthBytesUTF16;function UTF32ToString(ptr){var i=0;var str="";while(1){var utf32=HEAP32[ptr+i*4>>2];if(utf32==0)return str;++i;if(utf32>=65536){var ch=utf32-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}else{str+=String.fromCharCode(utf32)}}}Module["UTF32ToString"]=UTF32ToString;function stringToUTF32(str,outPtr,maxBytesToWrite){if(maxBytesToWrite===undefined){maxBytesToWrite=2147483647}if(maxBytesToWrite<4)return 0;var startPtr=outPtr;var endPtr=startPtr+maxBytesToWrite-4;for(var i=0;i<str.length;++i){var codeUnit=str.charCodeAt(i);if(codeUnit>=55296&&codeUnit<=57343){var trailSurrogate=str.charCodeAt(++i);codeUnit=65536+((codeUnit&1023)<<10)|trailSurrogate&1023}HEAP32[outPtr>>2]=codeUnit;outPtr+=4;if(outPtr+4>endPtr)break}HEAP32[outPtr>>2]=0;return outPtr-startPtr}Module["stringToUTF32"]=stringToUTF32;function lengthBytesUTF32(str){var len=0;for(var i=0;i<str.length;++i){var codeUnit=str.charCodeAt(i);if(codeUnit>=55296&&codeUnit<=57343)++i;len+=4}return len}Module["lengthBytesUTF32"]=lengthBytesUTF32;function demangle(func){var hasLibcxxabi=!!Module["___cxa_demangle"];if(hasLibcxxabi){try{var buf=_malloc(func.length);writeStringToMemory(func.substr(1),buf);var status=_malloc(4);var ret=Module["___cxa_demangle"](buf,0,0,status);if(getValue(status,"i32")===0&&ret){return Pointer_stringify(ret)}}catch(e){}finally{if(buf)_free(buf);if(status)_free(status);if(ret)_free(ret)}}var i=3;var basicTypes={"v":"void","b":"bool","c":"char","s":"short","i":"int","l":"long","f":"float","d":"double","w":"wchar_t","a":"signed char","h":"unsigned char","t":"unsigned short","j":"unsigned int","m":"unsigned long","x":"long long","y":"unsigned long long","z":"..."};var subs=[];var first=true;function dump(x){if(x)Module.print(x);Module.print(func);var pre="";for(var a=0;a<i;a++)pre+=" ";Module.print(pre+"^")}function parseNested(){i++;if(func[i]==="K")i++;var parts=[];while(func[i]!=="E"){if(func[i]==="S"){i++;var next=func.indexOf("_",i);var num=func.substring(i,next)||0;parts.push(subs[num]||"?");i=next+1;continue}if(func[i]==="C"){parts.push(parts[parts.length-1]);i+=2;continue}var size=parseInt(func.substr(i));var pre=size.toString().length;if(!size||!pre){i--;break}var curr=func.substr(i+pre,size);parts.push(curr);subs.push(curr);i+=pre+size}i++;return parts}function parse(rawList,limit,allowVoid){limit=limit||Infinity;var ret="",list=[];function flushList(){return"("+list.join(", ")+")"}var name;if(func[i]==="N"){name=parseNested().join("::");limit--;if(limit===0)return rawList?[name]:name}else{if(func[i]==="K"||first&&func[i]==="L")i++;var size=parseInt(func.substr(i));if(size){var pre=size.toString().length;name=func.substr(i+pre,size);i+=pre+size}}first=false;if(func[i]==="I"){i++;var iList=parse(true);var iRet=parse(true,1,true);ret+=iRet[0]+" "+name+"<"+iList.join(", ")+">"}else{ret=name}paramLoop:while(i<func.length&&limit-->0){var c=func[i++];if(c in basicTypes){list.push(basicTypes[c])}else{switch(c){case"P":list.push(parse(true,1,true)[0]+"*");break;case"R":list.push(parse(true,1,true)[0]+"&");break;case"L":{i++;var end=func.indexOf("E",i);var size=end-i;list.push(func.substr(i,size));i+=size+2;break};case"A":{var size=parseInt(func.substr(i));i+=size.toString().length;if(func[i]!=="_")throw"?";i++;list.push(parse(true,1,true)[0]+" ["+size+"]");break};case"E":break paramLoop;default:ret+="?"+c;break paramLoop}}}if(!allowVoid&&list.length===1&&list[0]==="void")list=[];if(rawList){if(ret){list.push(ret+"?")}return list}else{return ret+flushList()}}var parsed=func;try{if(func=="Object._main"||func=="_main"){return"main()"}if(typeof func==="number")func=Pointer_stringify(func);if(func[0]!=="_")return func;if(func[1]!=="_")return func;if(func[2]!=="Z")return func;switch(func[3]){case"n":return"operator new()";case"d":return"operator delete()"}parsed=parse()}catch(e){parsed+="?"}if(parsed.indexOf("?")>=0&&!hasLibcxxabi){Runtime.warnOnce("warning: a problem occurred in builtin C++ name demangling; build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling")}return parsed}function demangleAll(text){return text.replace(/__Z[\w\d_]+/g,(function(x){var y=demangle(x);return x===y?x:x+" ["+y+"]"}))}function jsStackTrace(){var err=new Error;if(!err.stack){try{throw new Error(0)}catch(e){err=e}if(!err.stack){return"(no stack trace available)"}}return err.stack.toString()}function stackTrace(){return demangleAll(jsStackTrace())}Module["stackTrace"]=stackTrace;var PAGE_SIZE=4096;function alignMemoryPage(x){if(x%4096>0){x+=4096-x%4096}return x}var HEAP;var HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64;var STATIC_BASE=0,STATICTOP=0,staticSealed=false;var STACK_BASE=0,STACKTOP=0,STACK_MAX=0;var DYNAMIC_BASE=0,DYNAMICTOP=0;function enlargeMemory(){var OLD_TOTAL_MEMORY=TOTAL_MEMORY;var LIMIT=Math.pow(2,31);if(DYNAMICTOP>=LIMIT)return false;while(TOTAL_MEMORY<=DYNAMICTOP){if(TOTAL_MEMORY<LIMIT/2){TOTAL_MEMORY=alignMemoryPage(2*TOTAL_MEMORY)}else{var last=TOTAL_MEMORY;TOTAL_MEMORY=alignMemoryPage((3*TOTAL_MEMORY+LIMIT)/4);if(TOTAL_MEMORY<=last)return false}}TOTAL_MEMORY=Math.max(TOTAL_MEMORY,16*1024*1024);if(TOTAL_MEMORY>=LIMIT)return false;try{if(ArrayBuffer.transfer){buffer=ArrayBuffer.transfer(buffer,TOTAL_MEMORY)}else{var oldHEAP8=HEAP8;buffer=new ArrayBuffer(TOTAL_MEMORY)}}catch(e){return false}var success=_emscripten_replace_memory(buffer);if(!success)return false;Module["buffer"]=buffer;Module["HEAP8"]=HEAP8=new Int8Array(buffer);Module["HEAP16"]=HEAP16=new Int16Array(buffer);Module["HEAP32"]=HEAP32=new Int32Array(buffer);Module["HEAPU8"]=HEAPU8=new Uint8Array(buffer);Module["HEAPU16"]=HEAPU16=new Uint16Array(buffer);Module["HEAPU32"]=HEAPU32=new Uint32Array(buffer);Module["HEAPF32"]=HEAPF32=new Float32Array(buffer);Module["HEAPF64"]=HEAPF64=new Float64Array(buffer);if(!ArrayBuffer.transfer){HEAP8.set(oldHEAP8)}return true}var byteLength;try{byteLength=Function.prototype.call.bind(Object.getOwnPropertyDescriptor(ArrayBuffer.prototype,"byteLength").get);byteLength(new ArrayBuffer(4))}catch(e){byteLength=(function(buffer){return buffer.byteLength})}var TOTAL_STACK=Module["TOTAL_STACK"]||5242880;var TOTAL_MEMORY=Module["TOTAL_MEMORY"]||16777216;var totalMemory=64*1024;while(totalMemory<TOTAL_MEMORY||totalMemory<2*TOTAL_STACK){if(totalMemory<16*1024*1024){totalMemory*=2}else{totalMemory+=16*1024*1024}}totalMemory=Math.max(totalMemory,16*1024*1024);if(totalMemory!==TOTAL_MEMORY){Module.printErr("increasing TOTAL_MEMORY to "+totalMemory+" to be compliant with the asm.js spec (and given that TOTAL_STACK="+TOTAL_STACK+")");TOTAL_MEMORY=totalMemory}assert(typeof Int32Array!=="undefined"&&typeof Float64Array!=="undefined"&&!!(new Int32Array(1))["subarray"]&&!!(new Int32Array(1))["set"],"JS engine does not provide full typed array support");var buffer=new ArrayBuffer(TOTAL_MEMORY);HEAP8=new Int8Array(buffer);HEAP16=new Int16Array(buffer);HEAP32=new Int32Array(buffer);HEAPU8=new Uint8Array(buffer);HEAPU16=new Uint16Array(buffer);HEAPU32=new Uint32Array(buffer);HEAPF32=new Float32Array(buffer);HEAPF64=new Float64Array(buffer);HEAP32[0]=255;assert(HEAPU8[0]===255&&HEAPU8[3]===0,"Typed arrays 2 must be run on a little-endian system");Module["HEAP"]=HEAP;Module["buffer"]=buffer;Module["HEAP8"]=HEAP8;Module["HEAP16"]=HEAP16;Module["HEAP32"]=HEAP32;Module["HEAPU8"]=HEAPU8;Module["HEAPU16"]=HEAPU16;Module["HEAPU32"]=HEAPU32;Module["HEAPF32"]=HEAPF32;Module["HEAPF64"]=HEAPF64;function callRuntimeCallbacks(callbacks){while(callbacks.length>0){var callback=callbacks.shift();if(typeof callback=="function"){callback();continue}var func=callback.func;if(typeof func==="number"){if(callback.arg===undefined){Runtime.dynCall("v",func)}else{Runtime.dynCall("vi",func,[callback.arg])}}else{func(callback.arg===undefined?null:callback.arg)}}}var __ATPRERUN__=[];var __ATINIT__=[];var __ATMAIN__=[];var __ATEXIT__=[];var __ATPOSTRUN__=[];var runtimeInitialized=false;var runtimeExited=false;function preRun(){if(Module["preRun"]){if(typeof Module["preRun"]=="function")Module["preRun"]=[Module["preRun"]];while(Module["preRun"].length){addOnPreRun(Module["preRun"].shift())}}callRuntimeCallbacks(__ATPRERUN__)}function ensureInitRuntime(){if(runtimeInitialized)return;runtimeInitialized=true;callRuntimeCallbacks(__ATINIT__)}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){callRuntimeCallbacks(__ATEXIT__);runtimeExited=true}function postRun(){if(Module["postRun"]){if(typeof Module["postRun"]=="function")Module["postRun"]=[Module["postRun"]];while(Module["postRun"].length){addOnPostRun(Module["postRun"].shift())}}callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(cb){__ATPRERUN__.unshift(cb)}Module["addOnPreRun"]=Module.addOnPreRun=addOnPreRun;function addOnInit(cb){__ATINIT__.unshift(cb)}Module["addOnInit"]=Module.addOnInit=addOnInit;function addOnPreMain(cb){__ATMAIN__.unshift(cb)}Module["addOnPreMain"]=Module.addOnPreMain=addOnPreMain;function addOnExit(cb){__ATEXIT__.unshift(cb)}Module["addOnExit"]=Module.addOnExit=addOnExit;function addOnPostRun(cb){__ATPOSTRUN__.unshift(cb)}Module["addOnPostRun"]=Module.addOnPostRun=addOnPostRun;function intArrayFromString(stringy,dontAddNull,length){var len=length>0?length:lengthBytesUTF8(stringy)+1;var u8array=new Array(len);var numBytesWritten=stringToUTF8Array(stringy,u8array,0,u8array.length);if(dontAddNull)u8array.length=numBytesWritten;return u8array}Module["intArrayFromString"]=intArrayFromString;function intArrayToString(array){var ret=[];for(var i=0;i<array.length;i++){var chr=array[i];if(chr>255){chr&=255}ret.push(String.fromCharCode(chr))}return ret.join("")}Module["intArrayToString"]=intArrayToString;function writeStringToMemory(string,buffer,dontAddNull){var array=intArrayFromString(string,dontAddNull);var i=0;while(i<array.length){var chr=array[i];HEAP8[buffer+i>>0]=chr;i=i+1}}Module["writeStringToMemory"]=writeStringToMemory;function writeArrayToMemory(array,buffer){for(var i=0;i<array.length;i++){HEAP8[buffer++>>0]=array[i]}}Module["writeArrayToMemory"]=writeArrayToMemory;function writeAsciiToMemory(str,buffer,dontAddNull){for(var i=0;i<str.length;++i){HEAP8[buffer++>>0]=str.charCodeAt(i)}if(!dontAddNull)HEAP8[buffer>>0]=0}Module["writeAsciiToMemory"]=writeAsciiToMemory;function unSign(value,bits,ignore){if(value>=0){return value}return bits<=32?2*Math.abs(1<<bits-1)+value:Math.pow(2,bits)+value}function reSign(value,bits,ignore){if(value<=0){return value}var half=bits<=32?Math.abs(1<<bits-1):Math.pow(2,bits-1);if(value>=half&&(bits<=32||value>half)){value=-2*half+value}return value}if(!Math["imul"]||Math["imul"](4294967295,5)!==-5)Math["imul"]=function imul(a,b){var ah=a>>>16;var al=a&65535;var bh=b>>>16;var bl=b&65535;return al*bl+(ah*bl+al*bh<<16)|0};Math.imul=Math["imul"];if(!Math["clz32"])Math["clz32"]=(function(x){x=x>>>0;for(var i=0;i<32;i++){if(x&1<<31-i)return i}return 32});Math.clz32=Math["clz32"];var Math_abs=Math.abs;var Math_cos=Math.cos;var Math_sin=Math.sin;var Math_tan=Math.tan;var Math_acos=Math.acos;var Math_asin=Math.asin;var Math_atan=Math.atan;var Math_atan2=Math.atan2;var Math_exp=Math.exp;var Math_log=Math.log;var Math_sqrt=Math.sqrt;var Math_ceil=Math.ceil;var Math_floor=Math.floor;var Math_pow=Math.pow;var Math_imul=Math.imul;var Math_fround=Math.fround;var Math_min=Math.min;var Math_clz32=Math.clz32;var runDependencies=0;var runDependencyWatcher=null;var dependenciesFulfilled=null;function addRunDependency(id){runDependencies++;if(Module["monitorRunDependencies"]){Module["monitorRunDependencies"](runDependencies)}}Module["addRunDependency"]=addRunDependency;function removeRunDependency(id){runDependencies--;if(Module["monitorRunDependencies"]){Module["monitorRunDependencies"](runDependencies)}if(runDependencies==0){if(runDependencyWatcher!==null){clearInterval(runDependencyWatcher);runDependencyWatcher=null}if(dependenciesFulfilled){var callback=dependenciesFulfilled;dependenciesFulfilled=null;callback()}}}Module["removeRunDependency"]=removeRunDependency;Module["preloadedImages"]={};Module["preloadedAudios"]={};var memoryInitializer=null;var ASM_CONSTS=[(function($0,$1,$2,$3,$4,$5,$6,$7){{var self=Module["getCache"](Module["ConcreteContactResultCallback"])[$0];if(!self.hasOwnProperty("addSingleResult"))throw"a JSImplementation must implement all functions, you forgot ConcreteContactResultCallback::addSingleResult.";return self["addSingleResult"]($1,$2,$3,$4,$5,$6,$7)}})];function _emscripten_asm_const_8(code,a0,a1,a2,a3,a4,a5,a6,a7){return ASM_CONSTS[code](a0,a1,a2,a3,a4,a5,a6,a7)|0}STATIC_BASE=8;STATICTOP=STATIC_BASE+21936;__ATINIT__.push({func:(function(){__GLOBAL__sub_I_btQuickprof_cpp()})});allocate([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,1,0,0,1,0,0,0,2,0,0,0,3,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,49,55,98,116,84,121,112,101,100,67,111,110,115,116,114,97,105,110,116,0,0,0,0,0,49,51,98,116,84,121,112,101,100,79,98,106,101,99,116,0,216,82,0,0,72,1,0,0,96,83,0,0,48,1,0,0,0,0,0,0,1,0,0,0,88,1,0,0,2,4,0,0,0,0,0,0,216,1,0,0,4,0,0,0,5,0,0,0,2,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,49,57,98,116,71,104,111,115,116,80,97,105,114,67,97,108,108,98,97,99,107,0,0,0,50,53,98,116,79,118,101,114,108,97,112,112,105,110,103,80,97,105,114,67,97,108,108,98,97,99,107,0,0,0,0,0,216,82,0,0,176,1,0,0,0,83,0,0,152,1,0,0,208,1,0,0,0,0,0,0,49,56,98,116,86,101,104,105,99,108,101,82,97,121,99,97,115,116,101,114,0,0,0,0,216,82,0,0,232,1,0,0,0,0,0,0,128,2,0,0,6,0,0,0,7,0,0,0,1,0,0,0,1,0,0,0,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,52,67,108,111,115,101,115,116,82,97,121,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,0,0,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,49,55,82,97,121,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,0,216,82,0,0,80,2,0,0,0,83,0,0,32,2,0,0,120,2,0,0,0,0,0,0,0,0,0,0,216,2,0,0,8,0,0,0,9,0,0,0,1,0,0,0,2,0,0,0,50,48,98,116,68,101,102,97,117,108,116,77,111,116,105,111,110,83,116,97,116,101,0,0,49,51,98,116,77,111,116,105,111,110,83,116,97,116,101,0,216,82,0,0,192,2,0,0,0,83,0,0,168,2,0,0,208,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,240,3,0,0,10,0,0,0,11,0,0,0,2,0,0,0,2,0,0,0,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,55,67,108,111,115,101,115,116,67,111,110,118,101,120,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,0,0,0,0,0,0,0,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,48,67,111,110,118,101,120,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,0,0,0,0,0,0,216,82,0,0,184,3,0,0,0,83,0,0,128,3,0,0,232,3,0,0,0,0,0,0,0,0,0,0,112,4,0,0,12,0,0,0,13,0,0,0,3,0,0,0,1,0,0,0,50,57,67,111,110,99,114,101,116,101,67,111,110,116,97,99,116,82,101,115,117,108,116,67,97,108,108,98,97,99,107,0,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,49,67,111,110,116,97,99,116,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,0,0,0,0,0,216,82,0,0,56,4,0,0,0,83,0,0,24,4,0,0,104,4,0,0,0,0,0,0,123,32,118,97,114,32,115,101,108,102,32,61,32,77,111,100,117,108,101,91,39,103,101,116,67,97,99,104,101,39,93,40,77,111,100,117,108,101,91,39,67,111,110,99,114,101,116,101,67,111,110,116,97,99,116,82,101,115,117,108,116,67,97,108,108,98,97,99,107,39,93,41,91,36,48,93,59,32,105,102,32,40,33,115,101,108,102,46,104,97,115,79,119,110,80,114,111,112,101,114,116,121,40,39,97,100,100,83,105,110,103,108,101,82,101,115,117,108,116,39,41,41,32,116,104,114,111,119,32,39,97,32,74,83,73,109,112,108,101,109,101,110,116,97,116,105,111,110,32,109,117,115,116,32,105,109,112,108,101,109,101,110,116,32,97,108,108,32,102,117,110,99,116,105,111,110,115,44,32,121,111,117,32,102,111,114,103,111,116,32,67,111,110,99,114,101,116,101,67,111,110,116,97,99,116,82,101,115,117,108,116,67,97,108,108,98,97,99,107,58,58,97,100,100,83,105,110,103,108,101,82,101,115,117,108,116,46,39,59,32,114,101,116,117,114,110,32,115,101,108,102,91,39,97,100,100,83,105,110,103,108,101,82,101,115,117,108,116,39,93,40,36,49,44,36,50,44,36,51,44,36,52,44,36,53,44,36,54,44,36,55,41,59,32,125,0,0,0,0,0,0,0,0,0,0,0,0,0,8,6,0,0,4,0,0,0,14,0,0,0,15,0,0,0,3,0,0,0,2,0,0,0,3,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,98,116,82,105,103,105,100,66,111,100,121,70,108,111,97,116,68,97,116,97,0,0,0,0,49,49,98,116,82,105,103,105,100,66,111,100,121,0,0,0,0,83,0,0,248,5,0,0,24,21,0,0,0,0,0,0,0,0,0,0,224,8,0,0,16,0,0,0,17,0,0,0,18,0,0,0,19,0,0,0,5,0,0,0,3,0,0,0,20,0,0,0,1,0,0,0,2,0,0,0,3,0,0,0,6,0,0,0,21,0,0,0,7,0,0,0,1,0,0,0,2,0,0,0,8,0,0,0,9,0,0,0,10,0,0,0,11,0,0,0,12,0,0,0,22,0,0,0,13,0,0,0,4,0,0,0,14,0,0,0,15,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,23,0,0,0,16,0,0,0,17,0,0,0,18,0,0,0,19,0,0,0,1,0,0,0,2,0,0,0,24,0,0,0,20,0,0,0,3,0,0,0,4,0,0,0,5,0,0,0,25,0,0,0,21,0,0,0,6,0,0,0,0,0,0,0,100,101,98,117,103,68,114,97,119,87,111,114,108,100,0,0,115,121,110,99,104,114,111,110,105,122,101,77,111,116,105,111,110,83,116,97,116,101,115,0,115,116,101,112,83,105,109,117,108,97,116,105,111,110,0,0,105,110,116,101,114,110,97,108,83,105,110,103,108,101,83,116,101,112,83,105,109,117,108,97,116,105,111,110,0,0,0,0,117,112,100,97,116,101,65,99,116,105,111,110,115,0,0,0,117,112,100,97,116,101,65,99,116,105,118,97,116,105,111,110,83,116,97,116,101,0,0,0,115,111,108,118,101,67,111,110,115,116,114,97,105,110,116,115,0,0,0,0,0,0,0,0,99,97,108,99,117,108,97,116,101,83,105,109,117,108,97,116,105,111,110,73,115,108,97,110,100,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,99,114,101,97,116,101,80,114,101,100,105,99,116,105,118,101,67,111,110,116,97,99,116,115,0,0,0,0,0,0,0,0,114,101,108,101,97,115,101,32,112,114,101,100,105,99,116,105,118,101,32,99,111,110,116,97,99,116,32,109,97,110,105,102,111,108,100,115,0,0,0,0,112,114,101,100,105,99,116,105,118,101,32,99,111,110,118,101,120,83,119,101,101,112,84,101,115,116,0,0,0,0,0,0,105,110,116,101,103,114,97,116,101,84,114,97,110,115,102,111,114,109,115,0,0,0,0,0,67,67,68,32,109,111,116,105,111,110,32,99,108,97,109,112,105,110,103,0,0,0,0,0,97,112,112,108,121,32,115,112,101,99,117,108,97,116,105,118,101,32,99,111,110,116,97,99,116,32,114,101,115,116,105,116,117,116,105,111,110,0,0,0,112,114,101,100,105,99,116,85,110,99,111,110,115,116,114,97,105,110,116,77,111,116,105,111,110,0,0,0,0,0,0,0,98,116,68,121,110,97,109,105,99,115,87,111,114,108,100,70,108,111,97,116,68,97,116,97,0,0,0,0,0,0,0,0,50,51,98,116,68,105,115,99,114,101,116,101,68,121,110,97,109,105,99,115,87,111,114,108,100,0,0,0,0,0,0,0,49,53,98,116,68,121,110,97,109,105,99,115,87,111,114,108,100,0,0,0,0,0,0,0,0,83,0,0,184,8,0,0,32,33,0,0,0,0,0,0,0,83,0,0,152,8,0,0,208,8,0,0,0,0,0,0,0,0,0,0,48,9,0,0,26,0,0,0,27,0,0,0,7,0,0,0,3,0,0,0,51,52,98,116,67,108,111,115,101,115,116,78,111,116,77,101,67,111,110,118,101,120,82,101,115,117,108,116,67,97,108,108,98,97,99,107,0,0,0,0,0,83,0,0,8,9,0,0,240,3,0,0,0,0,0,0,0,0,0,0,176,9,0,0,28,0,0,0,29,0,0,0,1,0,0,0,0,0,0,0,50,55,73,110,112,108,97,99,101,83,111,108,118,101,114,73,115,108,97,110,100,67,97,108,108,98,97,99,107,0,0,0,78,50,53,98,116,83,105,109,117,108,97,116,105,111,110,73,115,108,97,110,100,77,97,110,97,103,101,114,49,52,73,115,108,97,110,100,67,97,108,108,98,97,99,107,69,0,0,0,216,82,0,0,120,9,0,0,0,83,0,0,88,9,0,0,168,9,0,0,0,0,0,0,0,0,0,0,24,10,0,0,1,0,0,0,30,0,0,0,31,0,0,0,1,0,0,0,22,0,0,0,23,0,0,0,1,0,0,0,1,0,0,0,4,0,0,0,7,0,0,0,4,0,0,0,32,0,0,0,50,51,98,116,71,101,110,101,114,105,99,54,68,111,102,67,111,110,115,116,114,97,105,110,116,0,0,0,0,0,0,0,0,83,0,0,248,9,0,0,96,1,0,0,0,0,0,0,98,116,71,101,110,101,114,105,99,54,68,111,102,67,111,110,115,116,114,97,105,110,116,68,97,116,97,0,0,0,0,0,0,0,0,0,168,10,0,0,1,0,0,0,33,0,0,0,31,0,0,0,1,0,0,0,22,0,0,0,24,0,0,0,1,0,0,0,1,0,0,0,4,0,0,0,8,0,0,0,5,0,0,0,32,0,0,0,3,0,0,0,0,0,0,0,50,57,98,116,71,101,110,101,114,105,99,54,68,111,102,83,112,114,105,110,103,67,111,110,115,116,114,97,105,110,116,0,0,83,0,0,136,10,0,0,24,10,0,0,0,0,0,0,98,116,71,101,110,101,114,105,99,54,68,111,102,83,112,114,105,110,103,67,111,110,115,116,114,97,105,110,116,68,97,116,97,0,0,0,0,0,0,0,0,0,0,0,56,11,0,0,1,0,0,0,34,0,0,0,35,0,0,0,1,0,0,0,25,0,0,0,26,0,0,0,1,0,0,0,2,0,0,0,5,0,0,0,9,0,0,0,6,0,0,0,0,0,0,0,50,51,98,116,80,111,105,110,116,50,80,111,105,110,116,67,111,110,115,116,114,97,105,110,116,0,0,0,0,0,0,0,0,83,0,0,24,11,0,0,96,1,0,0,0,0,0,0,98,116,80,111,105,110,116,50,80,111,105,110,116,67,111,110,115,116,114,97,105,110,116,70,108,111,97,116,68,97,116,97,0,0,0,0,0,0,0,0,98,116,84,121,112,101,100,67,111,110,115,116,114,97,105,110,116,70,108,111,97,116,68,97,116,97,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,80,14,0,0,1,0,0,0,36,0,0,0,3,0,0,0,1,0,0,0,27,0,0,0,28,0,0,0,1,0,0,0,3,0,0,0,6,0,0,0,10,0,0,0,7,0,0,0,0,0,0,0,49,56,98,116,83,108,105,100,101,114,67,111,110,115,116,114,97,105,110,116,0,0,0,0,0,83,0,0,56,14,0,0,96,1,0,0,0,0,0,0,98,116,83,108,105,100,101,114,67,111,110,115,116,114,97,105,110,116,68,97,116,97,0,0,0,0,0,0,200,14,0,0,1,0,0,0,37,0,0,0,38,0,0,0,1,0,0,0,29,0,0,0,30,0,0,0,2,0,0,0,4,0,0,0,7,0,0,0,11,0,0,0,8,0,0,0,4,0,0,0,50,49,98,116,67,111,110,101,84,119,105,115,116,67,111,110,115,116,114,97,105,110,116,0,0,83,0,0,176,14,0,0,96,1,0,0,0,0,0,0,98,116,67,111,110,101,84,119,105,115,116,67,111,110,115,116,114,97,105,110,116,68,97,116,97,0,0,0,0,0,0,0,0,0,0,0,72,15,0,0,1,0,0,0,39,0,0,0,40,0,0,0,1,0,0,0,31,0,0,0,32,0,0,0,1,0,0,0,5,0,0,0,8,0,0,0,12,0,0,0,9,0,0,0,0,0,0,0,49,55,98,116,72,105,110,103,101,67,111,110,115,116,114,97,105,110,116,0,0,0,0,0,0,83,0,0,48,15,0,0,96,1,0,0,0,0,0,0,98,116,72,105,110,103,101,67,111,110,115,116,114,97,105,110,116,70,108,111,97,116,68,97,116,97,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,16,0,0,41,0,0,0,42,0,0,0,5,0,0,0,1,0,0,0,6,0,0,0,43,0,0,0,13,0,0,0,5,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,1,0,0,0,2,0,0,0,0,0,0,0,115,111,108,118,101,71,114,111,117,112,67,97,99,104,101,70,114,105,101,110,100,108,121,83,101,116,117,112,0,0,0,0,115,111,108,118,101,71,114,111,117,112,67,97,99,104,101,70,114,105,101,110,100,108,121,73,116,101,114,97,116,105,111,110,115,0,0,0,0,0,0,0,115,111,108,118,101,71,114,111,117,112,0,0,0,0,0,0,51,53,98,116,83,101,113,117,101,110,116,105,97,108,73,109,112,117,108,115,101,67,111,110,115,116,114,97,105,110,116,83,111,108,118,101,114,0,0,0,49,56,98,116,67,111,110,115,116,114,97,105,110,116,83,111,108,118,101,114,0,0,0,0,216,82,0,0,64,16,0,0,0,83,0,0,24,16,0,0,88,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,19,0,0,44,0,0,0,45,0,0,0,1,0,0,0,33,0,0,0,7,0,0,0,8,0,0,0,6,0,0,0,0,0,0,0,49,54,98,116,82,97,121,99,97,115,116,86,101,104,105,99,108,101,0,0,0,0,0,0,49,55,98,116,65,99,116,105,111,110,73,110,116,101,114,102,97,99,101,0,0,0,0,0,216,82,0,0,32,19,0,0,0,83,0,0,8,19,0,0,56,19,0,0,0,0,0,0,0,0,0,0,136,19,0,0,46,0,0,0,47,0,0,0,2,0,0,0,0,0,0,0,50,53,98,116,68,101,102,97,117,108,116,86,101,104,105,99,108,101,82,97,121,99,97,115,116,101,114,0,0,0,0,0,0,83,0,0,104,19,0,0,0,2,0,0,0,0,0,0,0,0,0,0,112,20,0,0,48,0,0,0,49,0,0,0,2,0,0,0,34,0,0,0,35,0,0,0,3,0,0,0,36,0,0,0,37,0,0,0,38,0,0,0,4,0,0,0,14,0,0,0,50,0,0,0,15,0,0,0,39,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,51,48,98,116,75,105,110,101,109,97,116,105,99,67,104,97,114,97,99,116,101,114,67,111,110,116,114,111,108,108,101,114,0,0,0,0,0,0,0,0,51,48,98,116,67,104,97,114,97,99,116,101,114,67,111,110,116,114,111,108,108,101,114,73,110,116,101,114,102,97,99,101,0,0,0,0,0,0,0,0,0,83,0,0,56,20,0,0,56,19,0,0,0,0,0,0,0,83,0,0,16,20,0,0,96,20,0,0,0,0,0,0,0,0,0,0,200,20,0,0,26,0,0,0,51,0,0,0,2,0,0,0,9,0,0,0,52,51,98,116,75,105,110,101,109,97,116,105,99,67,108,111,115,101,115,116,78,111,116,77,101,67,111,110,118,101,120,82,101,115,117,108,116,67,97,108,108,98,97,99,107,0,0,0,0,83,0,0,152,20,0,0,240,3,0,0,0,0,0,0,10,215,163,60,0,0,0,0,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,70,108,111,97,116,68,97,116,97,0,0,0,0,0,0,49,55,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,0,0,0,0,0,216,82,0,0,0,21,0,0,0,0,0,0,144,21,0,0,8,0,0,0,52,0,0,0,53,0,0,0,3,0,0,0,16,0,0,0,10,0,0,0,40,0,0,0,7,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,192,21,0,0,8,0,0,0,54,0,0,0,55,0,0,0,3,0,0,0,16,0,0,0,10,0,0,0,40,0,0,0,8,0,0,0,8,0,0,0,0,0,0,0,49,51,98,116,71,104,111,115,116,79,98,106,101,99,116,0,0,83,0,0,128,21,0,0,24,21,0,0,0,0,0,0,50,52,98,116,80,97,105,114,67,97,99,104,105,110,103,71,104,111,115,116,79,98,106,101,99,116,0,0,0,0,0,0,0,83,0,0,160,21,0,0,144,21,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,56,22,0,0,56,0,0,0,57,0,0,0,3,0,0,0,11,0,0,0,41,0,0,0,42,0,0,0,12,0,0,0,13,0,0,0,9,0,0,0,17,0,0,0,9,0,0,0,18,0,0,0,19,0,0,0,20,0,0,0,10,0,0,0,43,0,0,0,50,49,98,116,67,111,108,108,105,115,105,111,110,68,105,115,112,97,116,99,104,101,114,0,0,83,0,0,32,22,0,0,160,67,0,0,0,0,0,0,0,0,0,0,160,22,0,0,58,0,0,0,59,0,0,0,11,0,0,0,0,0,0,0,50,51,98,116,67,111,108,108,105,115,105,111,110,80,97,105,114,67,97,108,108,98,97,99,107,0,0,0,0,0,0,0,49,55,98,116,79,118,101,114,108,97,112,67,97,108,108,98,97,99,107,0,0,0,0,0,216,82,0,0,128,22,0,0,0,83,0,0,96,22,0,0,152,22,0,0,0,0,0,0,0,0,0,0,32,23,0,0,60,0,0,0,61,0,0,0,21,0,0,0,22,0,0,0,14,0,0,0,23,0,0,0,51,49,98,116,68,101,102,97,117,108,116,67,111,108,108,105,115,105,111,110,67,111,110,102,105,103,117,114,97,116,105,111,110,0,0,0,0,0,0,0,50,52,98,116,67,111,108,108,105,115,105,111,110,67,111,110,102,105,103,117,114,97,116,105,111,110,0,0,0,0,0,0,216,82,0,0,248,22,0,0,0,83,0,0,208,22,0,0,24,23,0,0,0,0,0,0,0,0,0,0,168,23,0,0,62,0,0,0,63,0,0,0,4,0,0,0,0,0,0,0,78,51,49,98,116,67,111,110,118,101,120,80,108,97,110,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,49,48,67,114,101,97,116,101,70,117,110,99,69,0,51,48,98,116,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,67,114,101,97,116,101,70,117,110,99,0,0,0,0,0,0,0,0,216,82,0,0,120,23,0,0,0,83,0,0,72,23,0,0,160,23,0,0,0,0,0,0,0,0,0,0,0,24,0,0,62,0,0,0,64,0,0,0,5,0,0,0,0,0,0,0,78,50,54,98,116,66,111,120,66,111,120,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,49,48,67,114,101,97,116,101,70,117,110,99,69,0,0,0,0,0,0,0,83,0,0,208,23,0,0,160,23,0,0,0,0,0,0,0,0,0,0,96,24,0,0,62,0,0,0,65,0,0,0,6,0,0,0,0,0,0,0,78,51,52,98,116,83,112,104,101,114,101,84,114,105,97,110,103,108,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,49,48,67,114,101,97,116,101,70,117,110,99,69,0,0,0,0,0,0,0,83,0,0,40,24,0,0,160,23,0,0,0,0,0,0,0,0,0,0,192,24,0,0,62,0,0,0,66,0,0,0,7,0,0,0,0,0,0,0,78,51,50,98,116,83,112,104,101,114,101,83,112,104,101,114,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,49,48,67,114,101,97,116,101,70,117,110,99,69,0,0,0,0,0,0,0,0,0,83,0,0,136,24,0,0,160,23,0,0,0,0,0,0,0,0,0,0,16,25,0,0,62,0,0,0,67,0,0,0,8,0,0,0,0,0,0,0,78,49,54,98,116,69,109,112,116,121,65,108,103,111,114,105,116,104,109,49,48,67,114,101,97,116,101,70,117,110,99,69,0,0,0,0,0,0,0,0,0,83,0,0,232,24,0,0,160,23,0,0,0,0,0,0,0,0,0,0,112,25,0,0,62,0,0,0,68,0,0,0,9,0,0,0,0,0,0,0,78,50,56,98,116,67,111,109,112,111,117,110,100,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,49,55,83,119,97,112,112,101,100,67,114,101,97,116,101,70,117,110,99,69,0,0,0,0,0,0,83,0,0,56,25,0,0,160,23,0,0,0,0,0,0,0,0,0,0,208,25,0,0,62,0,0,0,69,0,0,0,10,0,0,0,0,0,0,0,78,51,54,98,116,67,111,109,112,111,117,110,100,67,111,109,112,111,117,110,100,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,49,48,67,114,101,97,116,101,70,117,110,99,69,0,0,0,0,0,83,0,0,152,25,0,0,160,23,0,0,0,0,0,0,0,0,0,0,40,26,0,0,62,0,0,0,70,0,0,0,11,0,0,0,0,0,0,0,78,50,56,98,116,67,111,109,112,111,117,110,100,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,49,48,67,114,101,97,116,101,70,117,110,99,69,0,0,0,0,0,83,0,0,248,25,0,0,160,23,0,0,0,0,0,0,0,0,0,0,144,26,0,0,62,0,0,0,71,0,0,0,12,0,0,0,0,0,0,0,78,51,51,98,116,67,111,110,118,101,120,67,111,110,99,97,118,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,49,55,83,119,97,112,112,101,100,67,114,101,97,116,101,70,117,110,99,69,0,0,0,0,0,0,0,0,0,83,0,0,80,26,0,0,160,23,0,0,0,0,0,0,0,0,0,0,240,26,0,0,62,0,0,0,72,0,0,0,13,0,0,0,0,0,0,0,78,51,51,98,116,67,111,110,118,101,120,67,111,110,99,97,118,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,49,48,67,114,101,97,116,101,70,117,110,99,69,0,0,0,0,0,0,0,0,83,0,0,184,26,0,0,160,23,0,0,0,0,0,0,0,0,0,0,104,27,0,0,73,0,0,0,74,0,0,0,9,0,0,0,44,0,0,0,105,115,108,97,110,100,85,110,105,111,110,70,105,110,100,65,110,100,81,117,105,99,107,83,111,114,116,0,0,0,0,0,112,114,111,99,101,115,115,73,115,108,97,110,100,115,0,0,50,53,98,116,83,105,109,117,108,97,116,105,111,110,73,115,108,97,110,100,77,97,110,97,103,101,114,0,0,0,0,0,216,82,0,0,72,27,0,0,0,0,0,0,216,27,0,0,75,0,0,0,76,0,0,0,1,0,0,0,1,0,0,0,45,0,0,0,0,0,0,0,51,49,98,116,67,111,110,118,101,120,80,108,97,110,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,0,0,0,0,0,0,0,50,48,98,116,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,0,0,216,82,0,0,184,27,0,0,0,83,0,0,144,27,0,0,208,27,0,0,0,0,0,0,0,0,0,0,120,28,0,0,77,0,0,0,78,0,0,0,2,0,0,0,2,0,0,0,46,0,0,0,0,0,0,0,0,0,0,0,64,28,0,0,79,0,0,0,80,0,0,0,10,0,0,0,0,0,0,0,50,52,98,116,67,111,110,118,101,120,84,114,105,97,110,103,108,101,67,97,108,108,98,97,99,107,0,0,0,0,0,0,0,83,0,0,32,28,0,0,208,54,0,0,0,0,0,0,51,51,98,116,67,111,110,118,101,120,67,111,110,99,97,118,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,0,0,0,0,0,0,83,0,0,80,28,0,0,120,76,0,0,0,0,0,0,0,0,0,0,64,29,0,0,81,0,0,0,82,0,0,0,11,0,0,0,0,0,0,0,90,78,51,51,98,116,67,111,110,118,101,120,67,111,110,99,97,118,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,50,49,99,97,108,99,117,108,97,116,101,84,105,109,101,79,102,73,109,112,97,99,116,69,80,49,55,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,83,49,95,82,75,49,54,98,116,68,105,115,112,97,116,99,104,101,114,73,110,102,111,80,49,54,98,116,77,97,110,105,102,111,108,100,82,101,115,117,108,116,69,51,49,76,111,99,97,108,84,114,105,97,110,103,108,101,83,112,104,101,114,101,67,97,115,116,67,97,108,108,98,97,99,107,0,0,0,0,83,0,0,160,28,0,0,208,54,0,0,0,0,0,0,0,0,0,0,144,29,0,0,9,0,0,0,47,0,0,0,10,0,0,0,83,0,0,0,84,0,0,0,0,0,0,0,78,49,50,98,116,67,111,110,118,101,120,67,97,115,116,49,48,67,97,115,116,82,101,115,117,108,116,69,0,0,0,0,216,82,0,0,112,29,0,0,0,0,0,0,56,30,0,0,85,0,0,0,86,0,0,0,12,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,48,0,0,0,24,0,0,0,1,0,0,0,25,0,0,0,49,0,0,0,10,0,0,0,2,0,0,0,26,0,0,0,15,0,0,0,50,0,0,0,12,0,0,0,13,0,0,0,3,0,0,0,13,0,0,0,14,0,0,0,27,0,0,0,14,0,0,0,12,0,0,0,28,0,0,0,29,0,0,0,15,0,0,0,15,0,0,0,30,0,0,0,16,0,0,0,1,0,0,0,17,0,0,0,49,53,98,116,84,114,105,97,110,103,108,101,83,104,97,112,101,0,0,0,0,0,0,0,0,83,0,0,32,30,0,0,32,53,0,0,0,0,0,0,98,116,67,111,110,118,101,120,73,110,116,101,114,110,97,108,83,104,97,112,101,68,97,116,97,0,0,0,0,0,0,0,84,114,105,97,110,103,108,101,0,0,0,0,0,0,0,0,0,0,0,0,184,30,0,0,87,0,0,0,88,0,0,0,4,0,0,0,3,0,0,0,51,0,0,0,0,0,0,0,50,54,98,116,66,111,120,66,111,120,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,0,0,0,0,0,83,0,0,152,30,0,0,120,76,0,0,0,0,0,0,0,0,0,0,56,31,0,0,89,0,0,0,90,0,0,0,16,0,0,0,17,0,0,0,3,0,0,0,0,0,0,0,49,54,98,116,77,97,110,105,102,111,108,100,82,101,115,117,108,116,0,0,0,0,0,0,78,51,54,98,116,68,105,115,99,114,101,116,101,67,111,108,108,105,115,105,111,110,68,101,116,101,99,116,111,114,73,110,116,101,114,102,97,99,101,54,82,101,115,117,108,116,69,0,216,82,0,0,0,31,0,0,0,83,0,0,232,30,0,0,48,31,0,0,0,0,0,0,0,0,0,0,32,33,0,0,91,0,0,0,92,0,0,0,18,0,0,0,19,0,0,0,5,0,0,0,3,0,0,0,93,0,0,0,1,0,0,0,2,0,0,0,18,0,0,0,52,0,0,0,21,0,0,0,53,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,79,118,101,114,102,108,111,119,32,105,110,32,65,65,66,66,44,32,111,98,106,101,99,116,32,114,101,109,111,118,101,100,32,102,114,111,109,32,115,105,109,117,108,97,116,105,111,110,0,0,0,0,0,0,0,0,73,102,32,121,111,117,32,99,97,110,32,114,101,112,114,111,100,117,99,101,32,116,104,105,115,44,32,112,108,101,97,115,101,32,101,109,97,105,108,32,98,117,103,115,64,99,111,110,116,105,110,117,111,117,115,112,104,121,115,105,99,115,46,99,111,109,10,0,0,0,0,0,80,108,101,97,115,101,32,105,110,99,108,117,100,101,32,97,98,111,118,101,32,105,110,102,111,114,109,97,116,105,111,110,44,32,121,111,117,114,32,80,108,97,116,102,111,114,109,44,32,118,101,114,115,105,111,110,32,111,102,32,79,83,46,10,0,0,0,0,0,0,0,0,84,104,97,110,107,115,46,10,0,0,0,0,0,0,0,0,117,112,100,97,116,101,65,97,98,98,115,0,0,0,0,0,99,97,108,99,117,108,97,116,101,79,118,101,114,108,97,112,112,105,110,103,80,97,105,114,115,0,0,0,0,0,0,0,112,101,114,102,111,114,109,68,105,115,99,114,101,116,101,67,111,108,108,105,115,105,111,110,68,101,116,101,99,116,105,111,110,0,0,0,0,0,0,0,100,105,115,112,97,116,99,104,65,108,108,67,111,108,108,105,115,105,111,110,80,97,105,114,115,0,0,0,0,0,0,0,99,111,110,118,101,120,83,119,101,101,112,67,111,109,112,111,117,110,100,0,0,0,0,0,99,111,110,118,101,120,83,119,101,101,112,84,101,115,116,0,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,0,0,0,0,0,0,216,82,0,0,8,33,0,0,0,0,0,0,112,33,0,0,94,0,0,0,95,0,0,0,19,0,0,0,20,0,0,0,252,255,255,255,112,33,0,0,96,0,0,0,97,0,0,0,21,0,0,0,0,0,0,0,49,55,68,101,98,117,103,68,114,97,119,99,97,108,108,98,97,99,107,0,0,0,0,0,96,83,0,0,88,33,0,0,0,0,0,0,2,0,0,0,208,54,0,0,2,0,0,0,0,55,0,0,2,4,0,0,0,0,0,0,208,33,0,0,89,0,0,0,98,0,0,0,16,0,0,0,17,0,0,0,4,0,0,0,0,0,0,0,50,51,98,116,66,114,105,100,103,101,100,77,97,110,105,102,111,108,100,82,101,115,117,108,116,0,0,0,0,0,0,0,0,83,0,0,176,33,0,0,56,31,0,0,0,0,0,0,50,52,98,116,66,114,111,97,100,112,104,97,115,101,65,97,98,98,67,97,108,108,98,97,99,107,0,0,0,0,0,0,216,82,0,0,224,33,0,0,0,0,0,0,104,34,0,0,99,0,0,0,100,0,0,0,13,0,0,0,0,0,0,0,50,49,98,116,83,105,110,103,108,101,83,119,101,101,112,67,97,108,108,98,97,99,107,0,50,51,98,116,66,114,111,97,100,112,104,97,115,101,82,97,121,67,97,108,108,98,97,99,107,0,0,0,0,0,0,0,0,83,0,0,56,34,0,0,0,34,0,0,0,0,0,0,0,83,0,0,32,34,0,0,88,34,0,0,0,0,0,0,0,0,0,0,168,34,0,0,99,0,0,0,101,0,0,0,14,0,0,0,0,0,0,0,49,57,98,116,83,105,110,103,108,101,82,97,121,67,97,108,108,98,97,99,107,0,0,0,0,83,0,0,144,34,0,0,88,34,0,0,0,0,0,0,0,0,0,0,112,35,0,0,26,0,0,0,102,0,0,0,15,0,0,0,10,0,0,0,90,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,53,111,98,106,101,99,116,81,117,101,114,121,83,105,110,103,108,101,73,110,116,101,114,110,97,108,69,80,75,49,51,98,116,67,111,110,118,101,120,83,104,97,112,101,82,75,49,49,98,116,84,114,97,110,115,102,111,114,109,83,53,95,80,75,50,52,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,87,114,97,112,112,101,114,82,78,83,95,50,48,67,111,110,118,101,120,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,102,69,49,52,76,111,99,97,108,73,110,102,111,65,100,100,101,114,0,0,0,0,0,83,0,0,208,34,0,0,232,3,0,0,0,0,0,0,0,0,0,0,80,36,0,0,81,0,0,0,103,0,0,0,22,0,0,0,1,0,0,0,90,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,53,111,98,106,101,99,116,81,117,101,114,121,83,105,110,103,108,101,73,110,116,101,114,110,97,108,69,80,75,49,51,98,116,67,111,110,118,101,120,83,104,97,112,101,82,75,49,49,98,116,84,114,97,110,115,102,111,114,109,83,53,95,80,75,50,52,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,87,114,97,112,112,101,114,82,78,83,95,50,48,67,111,110,118,101,120,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,102,69,51,50,66,114,105,100,103,101,84,114,105,97,110,103,108,101,67,111,110,118,101,120,99,97,115,116,67,97,108,108,98,97,99,107,95,48,0,0,0,0,0,0,0,0,0,83,0,0,152,35,0,0,192,68,0,0,0,0,0,0,0,0,0,0,40,37,0,0,81,0,0,0,104,0,0,0,22,0,0,0,2,0,0,0,90,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,53,111,98,106,101,99,116,81,117,101,114,121,83,105,110,103,108,101,73,110,116,101,114,110,97,108,69,80,75,49,51,98,116,67,111,110,118,101,120,83,104,97,112,101,82,75,49,49,98,116,84,114,97,110,115,102,111,114,109,83,53,95,80,75,50,52,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,87,114,97,112,112,101,114,82,78,83,95,50,48,67,111,110,118,101,120,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,102,69,51,50,66,114,105,100,103,101,84,114,105,97,110,103,108,101,67,111,110,118,101,120,99,97,115,116,67,97,108,108,98,97,99,107,0,0,0,83,0,0,120,36,0,0,192,68,0,0,0,0,0,0,0,0,0,0,216,37,0,0,105,0,0,0,106,0,0,0,16,0,0,0,11,0,0,0,90,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,49,114,97,121,84,101,115,116,83,105,110,103,108,101,73,110,116,101,114,110,97,108,69,82,75,49,49,98,116,84,114,97,110,115,102,111,114,109,83,50,95,80,75,50,52,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,87,114,97,112,112,101,114,82,78,83,95,49,55,82,97,121,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,69,49,53,76,111,99,97,108,73,110,102,111,65,100,100,101,114,50,0,0,0,0,0,83,0,0,80,37,0,0,120,2,0,0,0,0,0,0,0,0,0,0,176,38,0,0,107,0,0,0,108,0,0,0,18,0,0,0,54,0,0,0,5,0,0,0,17,0,0,0,18,0,0,0,0,0,0,0,90,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,49,114,97,121,84,101,115,116,83,105,110,103,108,101,73,110,116,101,114,110,97,108,69,82,75,49,49,98,116,84,114,97,110,115,102,111,114,109,83,50,95,80,75,50,52,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,87,114,97,112,112,101,114,82,78,83,95,49,55,82,97,121,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,69,57,82,97,121,84,101,115,116,101,114,0,0,0,78,54,98,116,68,98,118,116,56,73,67,111,108,108,105,100,101,69,0,0,0,0,0,0,216,82,0,0,144,38,0,0,0,83,0,0,16,38,0,0,168,38,0,0,0,0,0,0,0,0,0,0,112,39,0,0,81,0,0,0,109,0,0,0,23,0,0,0,1,0,0,0,90,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,49,114,97,121,84,101,115,116,83,105,110,103,108,101,73,110,116,101,114,110,97,108,69,82,75,49,49,98,116,84,114,97,110,115,102,111,114,109,83,50,95,80,75,50,52,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,87,114,97,112,112,101,114,82,78,83,95,49,55,82,97,121,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,69,50,57,66,114,105,100,103,101,84,114,105,97,110,103,108,101,82,97,121,99,97,115,116,67,97,108,108,98,97,99,107,95,48,0,0,0,0,0,83,0,0,216,38,0,0,144,68,0,0,0,0,0,0,0,0,0,0,48,40,0,0,81,0,0,0,110,0,0,0,23,0,0,0,2,0,0,0,90,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,49,114,97,121,84,101,115,116,83,105,110,103,108,101,73,110,116,101,114,110,97,108,69,82,75,49,49,98,116,84,114,97,110,115,102,111,114,109,83,50,95,80,75,50,52,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,87,114,97,112,112,101,114,82,78,83,95,49,55,82,97,121,82,101,115,117,108,116,67,97,108,108,98,97,99],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE);allocate([107,69,69,50,57,66,114,105,100,103,101,84,114,105,97,110,103,108,101,82,97,121,99,97,115,116,67,97,108,108,98,97,99,107,0,0,0,0,0,0,0,83,0,0,152,39,0,0,144,68,0,0,0,0,0,0,0,0,0,0,136,40,0,0,111,0,0,0,112,0,0,0,5,0,0,0,4,0,0,0,55,0,0,0,0,0,0,0,51,52,98,116,83,112,104,101,114,101,84,114,105,97,110,103,108,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,0,0,0,0,0,83,0,0,96,40,0,0,120,76,0,0,0,0,0,0,0,0,0,0,248,40,0,0,113,0,0,0,114,0,0,0,14,0,0,0,0,0,0,0,0,0,0,0,40,41,0,0,115,0,0,0,116,0,0,0,6,0,0,0,5,0,0,0,56,0,0,0,0,0,0,0,78,50,51,98,116,67,111,110,118,101,120,67,111,110,118,101,120,65,108,103,111,114,105,116,104,109,49,48,67,114,101,97,116,101,70,117,110,99,69,0,0,83,0,0,208,40,0,0,160,23,0,0,0,0,0,0,50,51,98,116,67,111,110,118,101,120,67,111,110,118,101,120,65,108,103,111,114,105,116,104,109,0,0,0,0,0,0,0,0,83,0,0,8,41,0,0,120,76,0,0,0,0,0,0,0,0,0,0,232,41,0,0,89,0,0,0,117,0,0,0,19,0,0,0,20,0,0,0,5,0,0,0,0,0,0,0,90,78,50,51,98,116,67,111,110,118,101,120,67,111,110,118,101,120,65,108,103,111,114,105,116,104,109,49,54,112,114,111,99,101,115,115,67,111,108,108,105,115,105,111,110,69,80,75,50,52,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,87,114,97,112,112,101,114,83,50,95,82,75,49,54,98,116,68,105,115,112,97,116,99,104,101,114,73,110,102,111,80,49,54,98,116,77,97,110,105,102,111,108,100,82,101,115,117,108,116,69,50,49,98,116,87,105,116,104,111,117,116,77,97,114,103,105,110,82,101,115,117,108,116,0,0,0,0,0,83,0,0,88,41,0,0,48,31,0,0,0,0,0,0,0,0,0,0,56,42,0,0,89,0,0,0,118,0,0,0,16,0,0,0,17,0,0,0,6,0,0,0,0,0,0,0,50,52,98,116,80,101,114,116,117,114,98,101,100,67,111,110,116,97,99,116,82,101,115,117,108,116,0,0,0,0,0,0,0,83,0,0,24,42,0,0,56,31,0,0,0,0,0,0,0,0,0,0,240,42,0,0,89,0,0,0,119,0,0,0,21,0,0,0,22,0,0,0,7,0,0,0,0,0,0,0,90,78,50,51,98,116,67,111,110,118,101,120,67,111,110,118,101,120,65,108,103,111,114,105,116,104,109,49,54,112,114,111,99,101,115,115,67,111,108,108,105,115,105,111,110,69,80,75,50,52,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,87,114,97,112,112,101,114,83,50,95,82,75,49,54,98,116,68,105,115,112,97,116,99,104,101,114,73,110,102,111,80,49,54,98,116,77,97,110,105,102,111,108,100,82,101,115,117,108,116,69,49,51,98,116,68,117,109,109,121,82,101,115,117,108,116,0,0,0,0,0,83,0,0,104,42,0,0,48,31,0,0,0,0,0,0,0,0,0,0,64,43,0,0,120,0,0,0,121,0,0,0,7,0,0,0,6,0,0,0,57,0,0,0,0,0,0,0,50,56,98,116,67,111,109,112,111,117,110,100,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,0,0,0,83,0,0,32,43,0,0,120,76,0,0,0,0,0,0,0,0,0,0,152,43,0,0,107,0,0,0,122,0,0,0,18,0,0,0,58,0,0,0,5,0,0,0,17,0,0,0,18,0,0,0,0,0,0,0,50,50,98,116,67,111,109,112,111,117,110,100,76,101,97,102,67,97,108,108,98,97,99,107,0,0,0,0,0,0,0,0,0,83,0,0,120,43,0,0,168,38,0,0,0,0,0,0,0,0,0,0,240,43,0,0,123,0,0,0,124,0,0,0,8,0,0,0,7,0,0,0,59,0,0,0,0,0,0,0,51,54,98,116,67,111,109,112,111,117,110,100,67,111,109,112,111,117,110,100,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,0,0,0,83,0,0,200,43,0,0,120,76,0,0,0,0,0,0,0,0,0,0,80,44,0,0,107,0,0,0,125,0,0,0,23,0,0,0,60,0,0,0,5,0,0,0,17,0,0,0,18,0,0,0,0,0,0,0,51,48,98,116,67,111,109,112,111,117,110,100,67,111,109,112,111,117,110,100,76,101,97,102,67,97,108,108,98,97,99,107,0,0,0,0,0,0,0,0,0,83,0,0,40,44,0,0,168,38,0,0,0,0,0,0,0,0,0,0,0,45,0,0,126,0,0,0,127,0,0,0,24,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,61,0,0,0,31,0,0,0,2,0,0,0,32,0,0,0,49,0,0,0,11,0,0,0,3,0,0,0,33,0,0,0,16,0,0,0,50,0,0,0,62,0,0,0,128,0,0,0,98,116,67,111,109,112,111,117,110,100,83,104,97,112,101,67,104,105,108,100,68,97,116,97,0,0,0,0,0,0,0,0,98,116,67,111,109,112,111,117,110,100,83,104,97,112,101,68,97,116,97,0,0,0,0,0,49,53,98,116,67,111,109,112,111,117,110,100,83,104,97,112,101,0,0,0,0,0,0,0,0,83,0,0,232,44,0,0,152,53,0,0,0,0,0,0,67,111,109,112,111,117,110,100,0,0,0,0,0,0,0,0,0,0,0,0,104,46,0,0,129,0,0,0,130,0,0,0,25,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,63,0,0,0,24,0,0,0,3,0,0,0,34,0,0,0,64,0,0,0,10,0,0,0,2,0,0,0,35,0,0,0,17,0,0,0,50,0,0,0,24,0,0,0,25,0,0,0,3,0,0,0,26,0,0,0,14,0,0,0,36,0,0,0,26,0,0,0,0,0,0,0,0,0,0,0,136,46,0,0,129,0,0,0,131,0,0,0,25,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,63,0,0,0,24,0,0,0,3,0,0,0,37,0,0,0,65,0,0,0,10,0,0,0,2,0,0,0,35,0,0,0,17,0,0,0,50,0,0,0,24,0,0,0,25,0,0,0,3,0,0,0,26,0,0,0,14,0,0,0,36,0,0,0,26,0,0,0,0,0,0,0,0,0,0,0,168,46,0,0,129,0,0,0,132,0,0,0,25,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,63,0,0,0,24,0,0,0,3,0,0,0,38,0,0,0,66,0,0,0,10,0,0,0,2,0,0,0,35,0,0,0,17,0,0,0,50,0,0,0,24,0,0,0,25,0,0,0,3,0,0,0,26,0,0,0,14,0,0,0,36,0,0,0,26,0,0,0,0,0,0,0,49,49,98,116,67,111,110,101,83,104,97,112,101,0,0,0,0,83,0,0,88,46,0,0,216,53,0,0,0,0,0,0,49,50,98,116,67,111,110,101,83,104,97,112,101,90,0,0,0,83,0,0,120,46,0,0,104,46,0,0,0,0,0,0,49,50,98,116,67,111,110,101,83,104,97,112,101,88,0,0,0,83,0,0,152,46,0,0,104,46,0,0,0,0,0,0,67,111,110,101,88,0,0,0,67,111,110,101,90,0,0,0,98,116,67,111,110,101,83,104,97,112,101,68,97,116,97,0,67,111,110,101,0,0,0,0,0,0,0,0,88,47,0,0,129,0,0,0,133,0,0,0,27,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,48,0,0,0,24,0,0,0,4,0,0,0,39,0,0,0,49,0,0,0,12,0,0,0,4,0,0,0,26,0,0,0,15,0,0,0,50,0,0,0,27,0,0,0,28,0,0,0,3,0,0,0,28,0,0,0,14,0,0,0,36,0,0,0,26,0,0,0,0,0,0,0,49,51,98,116,83,112,104,101,114,101,83,104,97,112,101,0,0,83,0,0,72,47,0,0,216,53,0,0,0,0,0,0,83,80,72,69,82,69,0,0,0,0,0,0,8,48,0,0,134,0,0,0,135,0,0,0,29,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,67,0,0,0,40,0,0,0,5,0,0,0,41,0,0,0,49,0,0,0,13,0,0,0,5,0,0,0,42,0,0,0,18,0,0,0,50,0,0,0,30,0,0,0,29,0,0,0,30,0,0,0,68,0,0,0,69,0,0,0,0,0,0,0,98,116,84,114,105,97,110,103,108,101,77,101,115,104,83,104,97,112,101,68,97,116,97,0,50,50,98,116,66,118,104,84,114,105,97,110,103,108,101,77,101,115,104,83,104,97,112,101,0,0,0,0,0,0,0,0,0,83,0,0,232,47,0,0,128,50,0,0,0,0,0,0,66,86,72,84,82,73,65,78,71,76,69,77,69,83,72,0,0,0,0,0,208,48,0,0,136,0,0,0,137,0,0,0,31,0,0,0,0,0,0,0,90,78,75,50,50,98,116,66,118,104,84,114,105,97,110,103,108,101,77,101,115,104,83,104,97,112,101,49,57,112,114,111,99,101,115,115,65,108,108,84,114,105,97,110,103,108,101,115,69,80,49,56,98,116,84,114,105,97,110,103,108,101,67,97,108,108,98,97,99,107,82,75,57,98,116,86,101,99,116,111,114,51,83,52,95,69,50,49,77,121,78,111,100,101,79,118,101,114,108,97,112,67,97,108,108,98,97,99,107,0,0,0,50,49,98,116,78,111,100,101,79,118,101,114,108,97,112,67,97,108,108,98,97,99,107,0,216,82,0,0,176,48,0,0,0,83,0,0,64,48,0,0,200,48,0,0,0,0,0,0,0,0,0,0,112,49,0,0,136,0,0,0,138,0,0,0,32,0,0,0,0,0,0,0,90,78,50,50,98,116,66,118,104,84,114,105,97,110,103,108,101,77,101,115,104,83,104,97,112,101,49,55,112,101,114,102,111,114,109,67,111,110,118,101,120,99,97,115,116,69,80,49,56,98,116,84,114,105,97,110,103,108,101,67,97,108,108,98,97,99,107,82,75,57,98,116,86,101,99,116,111,114,51,83,52,95,83,52,95,83,52,95,69,50,49,77,121,78,111,100,101,79,118,101,114,108,97,112,67,97,108,108,98,97,99,107,0,0,0,0,0,0,0,0,0,83,0,0,248,48,0,0,200,48,0,0,0,0,0,0,0,0,0,0,0,50,0,0,136,0,0,0,139,0,0,0,33,0,0,0,0,0,0,0,90,78,50,50,98,116,66,118,104,84,114,105,97,110,103,108,101,77,101,115,104,83,104,97,112,101,49,52,112,101,114,102,111,114,109,82,97,121,99,97,115,116,69,80,49,56,98,116,84,114,105,97,110,103,108,101,67,97,108,108,98,97,99,107,82,75,57,98,116,86,101,99,116,111,114,51,83,52,95,69,50,49,77,121,78,111,100,101,79,118,101,114,108,97,112,67,97,108,108,98,97,99,107,0,0,83,0,0,152,49,0,0,200,48,0,0,0,0,0,0,0,0,0,0,128,50,0,0,140,0,0,0,141,0,0,0,29,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,70,0,0,0,40,0,0,0,5,0,0,0,43,0,0,0,49,0,0,0,13,0,0,0,5,0,0,0,44,0,0,0,19,0,0,0,50,0,0,0,31,0,0,0,29,0,0,0,30,0,0,0,0,0,0,0,49,57,98,116,84,114,105,97,110,103,108,101,77,101,115,104,83,104,97,112,101,0,0,0,0,83,0,0,104,50,0,0,40,58,0,0,0,0,0,0,84,82,73,65,78,71,76,69,77,69,83,72,0,0,0,0,0,0,0,0,208,50,0,0,81,0,0,0,142,0,0,0,32,0,0,0,0,0,0,0,50,49,83,117,112,112,111,114,116,86,101,114,116,101,120,67,97,108,108,98,97,99,107,0,0,83,0,0,184,50,0,0,208,54,0,0,0,0,0,0,0,0,0,0,96,51,0,0,143,0,0,0,144,0,0,0,33,0,0,0,0,0,0,0,90,78,75,49,57,98,116,84,114,105,97,110,103,108,101,77,101,115,104,83,104,97,112,101,49,57,112,114,111,99,101,115,115,65,108,108,84,114,105,97,110,103,108,101,115,69,80,49,56,98,116,84,114,105,97,110,103,108,101,67,97,108,108,98,97,99,107,82,75,57,98,116,86,101,99,116,111,114,51,83,52,95,69,49,54,70,105,108,116,101,114,101,100,67,97,108,108,98,97,99,107,0,0,0,0,83,0,0,248,50,0,0,0,55,0,0,0,0,0,0,0,0,0,0,216,51,0,0,145,0,0,0,146,0,0,0,34,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,71,0,0,0,45,0,0,0,6,0,0,0,46,0,0,0,49,0,0,0,13,0,0,0,5,0,0,0,47,0,0,0,20,0,0,0,50,0,0,0,35,0,0,0,0,0,0,0,49,56,98,116,83,116,97,116,105,99,80,108,97,110,101,83,104,97,112,101,0,0,0,0,0,83,0,0,192,51,0,0,40,58,0,0,0,0,0,0,98,116,83,116,97,116,105,99,80,108,97,110,101,83,104,97,112,101,68,97,116,97,0,0,83,84,65,84,73,67,80,76,65,78,69,0,0,0,0,0,0,0,0,0,32,53,0,0,85,0,0,0,147,0,0,0,25,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,48,0,0,0,24,0,0,0,7,0,0,0,1,0,0,0,49,0,0,0,10,0,0,0,2,0,0,0,26,0,0,0,15,0,0,0,50,0,0,0,12,0,0,0,34,0,0,0,3,0,0,0,36,0,0,0,14,0,0,0,36,0,0,0,26,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,50,51,98,116,80,111,108,121,104,101,100,114,97,108,67,111,110,118,101,120,83,104,97,112,101,0,0,0,0,0,0,0,0,83,0,0,0,53,0,0,216,53,0,0,0,0,0,0,51,52,98,116,80,111,108,121,104,101,100,114,97,108,67,111,110,118,101,120,65,97,98,98,67,97,99,104,105,110,103,83,104,97,112,101,0,0,0,0,0,83,0,0,48,53,0,0,32,53,0,0,0,0,0,0,98,116,67,111,108,108,105,115,105,111,110,83,104,97,112,101,68,97,116,97,0,0,0,0,49,54,98,116,67,111,108,108,105,115,105,111,110,83,104,97,112,101,0,0,0,0,0,0,216,82,0,0,128,53,0,0,49,51,98,116,67,111,110,118,101,120,83,104,97,112,101,0,0,83,0,0,160,53,0,0,152,53,0,0,0,0,0,0,50,49,98,116,67,111,110,118,101,120,73,110,116,101,114,110,97,108,83,104,97,112,101,0,0,83,0,0,192,53,0,0,176,53,0,0,0,0,0,0,0,0,0,0,160,54,0,0,148,0,0,0,149,0,0,0,37,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,72,0,0,0,24,0,0,0,7,0,0,0,48,0,0,0,49,0,0,0,10,0,0,0,2,0,0,0,49,0,0,0,21,0,0,0,50,0,0,0,35,0,0,0,36,0,0,0,3,0,0,0,38,0,0,0,14,0,0,0,36,0,0,0,26,0,0,0,12,0,0,0,50,0,0,0,51,0,0,0,39,0,0,0,37,0,0,0,52,0,0,0,40,0,0,0,2,0,0,0,1,0,0,0,98,116,67,111,110,118,101,120,72,117,108,108,83,104,97,112,101,68,97,116,97,0,0,0,49,55,98,116,67,111,110,118,101,120,72,117,108,108,83,104,97,112,101,0,0,0,0,0,0,83,0,0,136,54,0,0,88,53,0,0,0,0,0,0,67,111,110,118,101,120,0,0,49,56,98,116,84,114,105,97,110,103,108,101,67,97,108,108,98,97,99,107,0,0,0,0,216,82,0,0,184,54,0,0,51,49,98,116,73,110,116,101,114,110,97,108,84,114,105,97,110,103,108,101,73,110,100,101,120,67,97,108,108,98,97,99,107,0,0,0,0,0,0,0,216,82,0,0,216,54,0,0,0,0,0,0,88,56,0,0,129,0,0,0,150,0,0,0,41,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,73,0,0,0,24,0,0,0,8,0,0,0,53,0,0,0,74,0,0,0,14,0,0,0,2,0,0,0,54,0,0,0,22,0,0,0,50,0,0,0,12,0,0,0,38,0,0,0,3,0,0,0,42,0,0,0,14,0,0,0,36,0,0,0,26,0,0,0,0,0,0,0,0,0,0,0,128,56,0,0,129,0,0,0,151,0,0,0,41,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,73,0,0,0,24,0,0,0,8,0,0,0,55,0,0,0,74,0,0,0,14,0,0,0,2,0,0,0,54,0,0,0,22,0,0,0,50,0,0,0,12,0,0,0,38,0,0,0,3,0,0,0,42,0,0,0,14,0,0,0,36,0,0,0,26,0,0,0,0,0,0,0,0,0,0,0,168,56,0,0,129,0,0,0,152,0,0,0,41,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,73,0,0,0,24,0,0,0,8,0,0,0,56,0,0,0,74,0,0,0,14,0,0,0,2,0,0,0,54,0,0,0,22,0,0,0,50,0,0,0,12,0,0,0,38,0,0,0,3,0,0,0,42,0,0,0,14,0,0,0,36,0,0,0,26,0,0,0,0,0,0,0,49,52,98,116,67,97,112,115,117,108,101,83,104,97,112,101,0,0,0,0,0,0,0,0,0,83,0,0,64,56,0,0,216,53,0,0,0,0,0,0,49,53,98,116,67,97,112,115,117,108,101,83,104,97,112,101,88,0,0,0,0,0,0,0,0,83,0,0,104,56,0,0,88,56,0,0,0,0,0,0,49,53,98,116,67,97,112,115,117,108,101,83,104,97,112,101,90,0,0,0,0,0,0,0,0,83,0,0,144,56,0,0,88,56,0,0,0,0,0,0,67,97,112,115,117,108,101,90,0,0,0,0,0,0,0,0,67,97,112,115,117,108,101,88,0,0,0,0,0,0,0,0,98,116,67,97,112,115,117,108,101,83,104,97,112,101,68,97,116,97,0,0,0,0,0,0,67,97,112,115,117,108,101,83,104,97,112,101,0,0,0,0,0,0,0,0,168,57,0,0,85,0,0,0,153,0,0,0,37,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,75,0,0,0,57,0,0,0,7,0,0,0,58,0,0,0,49,0,0,0,10,0,0,0,2,0,0,0,26,0,0,0,15,0,0,0,50,0,0,0,39,0,0,0,40,0,0,0,3,0,0,0,43,0,0,0,14,0,0,0,36,0,0,0,26,0,0,0,12,0,0,0,59,0,0,0,60,0,0,0,44,0,0,0,41,0,0,0,61,0,0,0,45,0,0,0,3,0,0,0,0,0,0,0,50,53,98,116,67,111,110,118,101,120,84,114,105,97,110,103,108,101,77,101,115,104,83,104,97,112,101,0,0,0,0,0,0,83,0,0,136,57,0,0,88,53,0,0,0,0,0,0,67,111,110,118,101,120,84,114,105,109,101,115,104,0,0,0,0,0,0,0,0,58,0,0,143,0,0,0,154,0,0,0,46,0,0,0,0,0,0,0,50,54,76,111,99,97,108,83,117,112,112,111,114,116,86,101,114,116,101,120,67,97,108,108,98,97,99,107,0,0,0,0,0,83,0,0,224,57,0,0,0,55,0,0,0,0,0,0,49,52,98,116,67,111,110,99,97,118,101,83,104,97,112,101,0,0,0,0,0,0,0,0,0,83,0,0,16,58,0,0,152,53,0,0,0,0,0,0,0,0,0,0,208,58,0,0,85,0,0,0,155,0,0,0,47,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,76,0,0,0,24,0,0,0,9,0,0,0,62,0,0,0,49,0,0,0,15,0,0,0,2,0,0,0,26,0,0,0,15,0,0,0,50,0,0,0,42,0,0,0,43,0,0,0,3,0,0,0,48,0,0,0,14,0,0,0,63,0,0,0,44,0,0,0,12,0,0,0,64,0,0,0,65,0,0,0,49,0,0,0,45,0,0,0,66,0,0,0,50,0,0,0,4,0,0,0,46,0,0,0,49,48,98,116,66,111,120,83,104,97,112,101,0,0,0,0,0,83,0,0,192,58,0,0,32,53,0,0,0,0,0,0,66,111,120,0,0,0,0,0,0,0,0,0,40,59,0,0,156,0,0,0,157,0,0,0,15,0,0,0,67,0,0,0,23,0,0,0,77,0,0,0,78,0,0,0,16,0,0,0,49,52,98,116,79,112,116,105,109,105,122,101,100,66,118,104,0,0,0,0,0,0,0,0,0,83,0,0,16,59,0,0,80,68,0,0,0,0,0,0,0,0,0,0,184,59,0,0,143,0,0,0,158,0,0,0,51,0,0,0,0,0,0,0,90,78,49,52,98,116,79,112,116,105,109,105,122,101,100,66,118,104,53,98,117,105,108,100,69,80,50,51,98,116,83,116,114,105,100,105,110,103,77,101,115,104,73,110,116,101,114,102,97,99,101,98,82,75,57,98,116,86,101,99,116,111,114,51,83,52,95,69,50,57,81,117,97,110,116,105,122,101,100,78,111,100,101,84,114,105,97,110,103,108,101,67,97,108,108,98,97,99,107,0,0,0,0,0,0,83,0,0,80,59,0,0,0,55,0,0,0,0,0,0,0,0,0,0,64,60,0,0,143,0,0,0,159,0,0,0,52,0,0,0,0,0,0,0,90,78,49,52,98,116,79,112,116,105,109,105,122,101,100,66,118,104,53,98,117,105,108,100,69,80,50,51,98,116,83,116,114,105,100,105,110,103,77,101,115,104,73,110,116,101,114,102,97,99,101,98,82,75,57,98,116,86,101,99,116,111,114,51,83,52,95,69,50,48,78,111,100,101,84,114,105,97,110,103,108,101,67,97,108,108,98,97,99,107,0,0,0,0,0,0,0,83,0,0,224,59,0,0,0,55,0,0,0,0,0,0,0,0,0,0,160,61,0,0,129,0,0,0,160,0,0,0,53,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,79,0,0,0,24,0,0,0,10,0,0,0,68,0,0,0,80,0,0,0,16,0,0,0,2,0,0,0,69,0,0,0,24,0,0,0,50,0,0,0,47,0,0,0,48,0,0,0,3,0,0,0,54,0,0,0,14,0,0,0,36,0,0,0,26,0,0,0,6,0,0,0,0,0,0,0,200,61,0,0,129,0,0,0,161,0,0,0,53,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,79,0,0,0,24,0,0,0,10,0,0,0,70,0,0,0,80,0,0,0,16,0,0,0,2,0,0,0,69,0,0,0,24,0,0,0,50,0,0,0,47,0,0,0,49,0,0,0,3,0,0,0,55,0,0,0,14,0,0,0,36,0,0,0,26,0,0,0,7,0,0,0,0,0,0,0,240,61,0,0,129,0,0,0,162,0,0,0,53,0,0,0,11,0,0,0,1,0,0,0,1,0,0,0,79,0,0,0,24,0,0,0,10,0,0,0,71,0,0,0,80,0,0,0,16,0,0,0,2,0,0,0,69,0,0,0,24,0,0,0,50,0,0,0,47,0,0,0,50,0,0,0,3,0,0,0,56,0,0,0,14,0,0,0,36,0,0,0,26,0,0,0,8,0,0,0,49,53,98,116,67,121,108,105,110,100,101,114,83,104,97,112,101,0,0,0,0,0,0,0,0,83,0,0,136,61,0,0,216,53,0,0,0,0,0,0,49,54,98,116,67,121,108,105,110,100,101,114,83,104,97,112,101,88,0,0,0,0,0,0,0,83,0,0,176,61,0,0,160,61,0,0,0,0,0,0,49,54,98,116,67,121,108,105,110,100,101,114,83,104,97,112,101,90,0,0,0,0,0,0,0,83,0,0,216,61,0,0,160,61,0,0,0,0,0,0,67,121,108,105,110,100,101,114,90,0,0,0,0,0,0,0,67,121,108,105,110,100,101,114,88,0,0,0,0,0,0,0,98,116,67,121,108,105,110,100,101,114,83,104,97,112,101,68,97,116,97,0,0,0,0,0,67,121,108,105,110,100,101,114,89,0,0,0,0,0,0,0,0,0,0,0,168,62,0,0,163,0,0,0,164,0,0,0,57,0,0,0,1,0,0,0,2,0,0,0,81,0,0,0,82,0,0,0,72,0,0,0,83,0,0,0,84,0,0,0,73,0,0,0,51,0,0,0,52,0,0,0,74,0,0,0,25,0,0,0,0,0,0,0,49,52,98,116,84,114,105,97,110,103,108,101,77,101,115,104,0,0,0,0,0,0,0,0,0,83,0,0,144,62,0,0,168,78,0,0,0,0,0,0,0,0,0,0,88,63,0,0,165,0,0,0,166,0,0,0,1,0,0,0,53,0,0,0,9,0,0,0,58,0,0,0,2,0,0,0,59,0,0,0,85,0,0,0,75,0,0,0,76,0,0,0,54,0,0,0,86,0,0,0,167,0,0,0,49,50,98,116,65,120,105,115,83,119,101,101,112,51,0,0,50,48,98,116,65,120,105,115,83,119,101,101,112,51,73,110,116,101,114,110,97,108,73,116,69,0,0,0,0,0,0,0,50,49,98,116,66,114,111,97,100,112,104,97,115,101,73,110,116,101,114,102,97,99,101,0,216,82,0,0,40,63,0,0,0,83,0,0,8,63,0,0,64,63,0,0,0,0,0,0,0,83,0,0,248,62,0,0,72,63,0,0,0,0,0,0,0,0,0,0,72,63,0,0,165,0,0,0,168,0,0,0,1,0,0,0,53,0,0,0,9,0,0,0,58,0,0,0,2,0,0,0,59,0,0,0,85,0,0,0,75,0,0,0,76,0,0,0,54,0,0,0,86,0,0,0,167,0,0,0,0,0,0,0,64,64,0,0,169,0,0,0,170,0,0,0,26,0,0,0,17,0,0,0,55,0,0,0,77,0,0,0,78,0,0,0,79,0,0,0,56,0,0,0,80,0,0,0,57,0,0,0,87,0,0,0,58,0,0,0,27,0,0,0,81,0,0,0,88,0,0,0,89,0,0,0,0,0,0,0,49,53,98,116,78,117,108,108,80,97,105,114,67,97,99,104,101,0,0,0,0,0,0,0,50,50,98,116,79,118,101,114,108,97,112,112,105,110,103,80,97,105,114,67,97,99,104,101,0,0,0,0,0,0,0,0,0,83,0,0,16,64,0,0,208,1,0,0,0,0,0,0,0,83,0,0,248,63,0,0,48,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,224,64,0,0,171,0,0,0,172,0,0,0,28,0,0,0,18,0,0,0,59,0,0,0,82,0,0,0,83,0,0,0,84,0,0,0,60,0,0,0,85,0,0,0,61,0,0,0,90,0,0,0,62,0,0,0,29,0,0,0,86,0,0,0,91,0,0,0,92,0,0,0,0,0,0,0,50,56,98,116,72,97,115,104,101,100,79,118,101,114,108,97,112,112,105,110,103,80,97,105,114,67,97,99,104,101,0,0,0,83,0,0,192,64,0,0,48,64,0,0,0,0,0,0,0,0,0,0,144,65,0,0,58,0,0,0,173,0,0,0,19,0,0,0,0,0,0,0,90,78,50,56,98,116,72,97,115,104,101,100,79,118,101,114,108,97,112,112,105,110,103,80,97,105,114,67,97,99,104,101,51,55,114,101,109,111,118,101,79,118,101,114,108,97,112,112,105,110,103,80,97,105,114,115,67,111,110,116,97,105,110,105,110,103,80,114,111,120,121,69,80,49,55,98,116,66,114,111,97,100,112,104,97,115,101,80,114,111,120,121,80,49,50,98,116,68,105,115,112,97,116,99,104,101,114,69,49,56,82,101,109,111,118,101,80,97,105,114,67,97,108,108,98,97,99,107,0,0,0,0,0,0,0,0,0,83,0,0,8,65,0,0,152,22,0,0,0,0,0,0,0,0,0,0,40,66,0,0,58,0,0,0,174,0,0,0,20,0,0,0,0,0,0,0,90,78,50,56,98,116,72,97,115,104,101,100,79,118,101,114,108,97,112,112,105,110,103,80,97,105,114,67,97,99,104,101,49,57,99,108,101,97,110,80,114,111,120,121,70,114,111,109,80,97,105,114,115,69,80,49,55,98,116,66,114,111,97,100,112,104,97,115,101,80,114,111,120,121,80,49,50,98,116,68,105,115,112,97,116,99,104,101,114,69,49,55,67,108,101,97,110,80,97,105,114,67,97,108,108,98,97,99,107,0,0,0,0,83,0,0,184,65,0,0,152,22,0,0,0,0,0,0,0,0,0,0,144,66,0,0,175,0,0,0,176,0,0,0,2,0,0,0,63,0,0,0,10,0,0,0,60,0,0,0,3,0,0,0,61,0,0,0,93,0,0,0,87,0,0,0,88,0,0,0,64,0,0,0,94,0,0,0,177,0,0,0,49,54,98,116,68,98,118,116,66,114,111,97,100,112,104,97,115,101,0,0,0,0,0,0,0,83,0,0,120,66,0,0,64,63,0,0,0,0,0,0,0,0,0,0,224,66,0,0,107,0,0,0,178,0,0,0,18,0,0,0,95,0,0,0,5,0,0,0,17,0,0,0,18,0,0,0,0,0,0,0,50,48,66,114,111,97,100,112,104,97,115,101,65,97,98,98,84,101,115,116,101,114,0,0,0,83,0,0,200,66,0,0,168,38,0,0,0,0,0,0,0,0,0,0,48,67,0,0,107,0,0,0,179,0,0,0,18,0,0,0,96,0,0,0,5,0,0,0,17,0,0,0,18,0,0,0,0,0,0,0,49,57,66,114,111,97,100,112,104,97,115,101,82,97,121,84,101,115,116,101,114,0,0,0,0,83,0,0,24,67,0,0,168,38,0,0,0,0,0,0,0,0,0,0,128,67,0,0,107,0,0,0,180,0,0,0,65,0,0,0,97,0,0,0,5,0,0,0,17,0,0,0,18,0,0,0,0,0,0,0,49,56,98,116,68,98,118,116,84,114,101,101,67,111,108,108,105,100,101,114,0,0,0,0,0,83,0,0,104,67,0,0,168,38,0,0,0,0,0,0,49,50,98,116,68,105,115,112,97,116,99,104,101,114,0,0,216,82,0,0,144,67,0,0,0,0,0,0,80,68,0,0,181,0,0,0,182,0,0,0,15,0,0,0,67,0,0,0,23,0,0,0,77,0,0,0,78,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,98,116,79,112,116,105,109,105,122,101,100,66,118,104,78,111,100,101,68,97,116,97,0,0,98,116,81,117,97,110,116,105,122,101,100,66,118,104,78,111,100,101,68,97,116,97,0,0,98,116,66,118,104,83,117,98,116,114,101,101,73,110,102,111,68,97,116,97,0,0,0,0,98,116,81,117,97,110,116,105,122,101,100,66,118,104,70,108,111,97,116,68,97,116,97,0,49,52,98,116,81,117,97,110,116,105,122,101,100,66,118,104,0,0,0,0,0,0,0,0,216,82,0,0,56,68,0,0,0,0,0,0,192,68,0,0,81,0,0,0,183,0,0,0,22,0,0,0,1,0,0,0,50,53,98,116,84,114,105,97,110,103,108,101,82,97,121,99,97,115,116,67,97,108,108,98,97,99,107,0,0,0,0,0,0,83,0,0,112,68,0,0,208,54,0,0,0,0,0,0,50,56,98,116,84,114,105,97,110,103,108,101,67,111,110,118,101,120,99,97,115,116,67,97,108,108,98,97,99,107,0,0,0,83,0,0,160,68,0,0,208,54,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40,73,0,0,184,0,0,0,185,0,0,0,1,0,0,0,0,0,0,0,51,51,98,116,77,105,110,107,111,119,115,107,105,80,101,110,101,116,114,97,116,105,111,110,68,101,112,116,104,83,111,108,118,101,114,0,0,0,0,0,51,48,98,116,67,111,110,118,101,120,80,101,110,101,116,114,97,116,105,111,110,68,101,112,116,104,83,111,108,118,101,114,0,0,0,0,0,0,0,0,216,82,0,0,248,72,0,0,0,83,0,0,208,72,0,0,32,73,0,0,0,0,0,0,0,0,0,0,8,74,0,0,89,0,0,0,186,0,0,0,66,0,0,0,67,0,0,0,8,0,0,0,0,0,0,0,90,78,51,51,98,116,77,105,110,107,111,119,115,107,105,80,101,110,101,116,114,97,116,105,111,110,68,101,112,116,104,83,111,108,118,101,114,49,50,99,97,108,99,80,101,110,68,101,112,116,104,69,82,50,50,98,116,86,111,114,111,110,111,105,83,105,109,112,108,101,120,83,111,108,118,101,114,80,75,49,51,98,116,67,111,110,118,101,120,83,104,97,112,101,83,52,95,82,75,49,49,98,116,84,114,97,110,115,102,111,114,109,83,55,95,82,57,98,116,86,101,99,116,111,114,51,83,57,95,83,57,95,80,49,50,98,116,73,68,101,98,117,103,68,114,97,119,69,50,48,98,116,73,110,116,101,114,109,101,100,105,97,116,101,82,101,115,117,108,116,0,0,0,0,0,0,0,83,0,0,88,73,0,0,48,31,0,0,0,0,0,0,0,0,0,0,80,74,0,0,187,0,0,0,188,0,0,0,1,0,0,0,0,0,0,0,50,50,98,116,83,117,98,115,105,109,112,108,101,120,67,111,110,118,101,120,67,97,115,116,0,0,0,0,0,0,0,0,0,83,0,0,48,74,0,0,72,75,0,0,0,0,0,0,0,0,0,0,160,74,0,0,184,0,0,0,189,0,0,0,2,0,0,0,0,0,0,0,51,48,98,116,71,106,107,69,112,97,80,101,110,101,116,114,97,116,105,111,110,68,101,112,116,104,83,111,108,118,101,114,0,0,0,0,0,0,0,0,0,83,0,0,120,74,0,0,32,73,0,0,0,0,0,0,0,0,0,0,224,74,0,0,187,0,0,0,190,0,0,0,2,0,0,0,0,0,0,0,49,53,98,116,71,106,107,67,111,110,118,101,120,67,97,115,116,0,0,0,0,0,0,0,0,83,0,0,200,74,0,0,72,75,0,0,0,0,0,0,0,0,0,0,40,75,0,0,89,0,0,0,191,0,0,0,68,0,0,0,69,0,0,0,9,0,0,0,0,0,0,0,49,54,98,116,80,111,105,110,116,67,111,108,108,101,99,116,111,114,0,0,0,0,0,0,0,83,0,0,16,75,0,0,48,31,0,0,0,0,0,0,49,50,98,116,67,111,110,118,101,120,67,97,115,116,0,0,216,82,0,0,56,75,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,160,75,0,0,187,0,0,0,192,0,0,0,3,0,0,0,0,0,0,0,50,55,98,116,67,111,110,116,105,110,117,111,117,115,67,111,110,118,101,120,67,111,108,108,105,115,105,111,110,0,0,0,0,83,0,0,128,75,0,0,72,75,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,76,0,0,193,0,0,0,194,0,0,0,11,0,0,0,0,0,0,0,49,55,98,116,71,106,107,80,97,105,114,68,101,116,101,99,116,111,114,0,0,0,0,0,51,54,98,116,68,105,115,99,114,101,116,101,67,111,108,108,105,115,105,111,110,68,101,116,101,99,116,111,114,73,110,116,101,114,102,97,99,101,0,0,216,82,0,0,240,75,0,0,0,83,0,0,216,75,0,0,24,76,0,0,0,0,0,0,2,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,51,48,98,116,65,99,116,105,118,97,116,105,110,103,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,0,0,0,0,0,0,0,0,0,83,0,0,80,76,0,0,208,27,0,0,0,0,0,0,0,0,0,0,192,76,0,0,195,0,0,0,196,0,0,0,12,0,0,0,8,0,0,0,98,0,0,0,0,0,0,0,49,54,98,116,69,109,112,116,121,65,108,103,111,114,105,116,104,109,0,0,0,0,0,0,0,83,0,0,168,76,0,0,208,27,0,0,0,0,0,0,0,0,0,0,24,77,0,0,197,0,0,0,198,0,0,0,13,0,0,0,9,0,0,0,99,0,0,0,0,0,0,0,51,50,98,116,83,112,104,101,114,101,83,112,104,101,114,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,0,0,0,0,0,0,0,83,0,0,240,76,0,0,120,76,0,0,0,0,0,0,0,0,0,0,88,77,0,0,193,0,0,0,199,0,0,0,14,0,0,0,0,0,0,0,49,54,98,116,66,111,120,66,111,120,68,101,116,101,99,116,111,114,0,0,0,0,0,0,0,83,0,0,64,77,0,0,24,76,0,0,0,0,0,0,0,0,0,0,160,77,0,0,193,0,0,0,200,0,0,0,15,0,0,0,0,0,0,0,50,50,83,112,104,101,114,101,84,114,105,97,110,103,108,101,68,101,116,101,99,116,111,114,0,0,0,0,0,0,0,0,0,83,0,0,128,77,0,0,24,76,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,78,0,0,201,0,0,0,202,0,0,0,30,0,0,0,31,0,0,0,89,0,0,0,0,0,0,0,50,51,98,116,72,97,115,104,101,100,83,105,109,112,108,101,80,97,105,114,67,97,99,104,101,0,0,0,0,0,0,0,216,82,0,0,232,77,0,0,0,0,0,0,56,78,0,0,203,0,0,0,204,0,0,0,49,56,98,116,67,111,110,118,101,120,80,111,108,121,104,101,100,114,111,110,0,0,0,0,216,82,0,0,32,78,0,0,0,0,0,0,168,78,0,0,205,0,0,0,206,0,0,0,57,0,0,0,1,0,0,0,2,0,0,0,81,0,0,0,82,0,0,0,72,0,0,0,100,0,0,0,101,0,0,0,73,0,0,0,51,0,0,0,52,0,0,0,74,0,0,0,25,0,0,0,0,0,0,0,50,54,98,116,84,114,105,97,110,103,108,101,73,110,100,101,120,86,101,114,116,101,120,65,114,114,97,121,0,0,0,0,0,83,0,0,136,78,0,0,128,79,0,0,0,0,0,0,98,116,73,110,116,73,110,100,101,120,68,97,116,97,0,0,98,116,83,104,111,114,116,73,110,116,73,110,100,101,120,84,114,105,112,108,101,116,68,97,116,97,0,0,0,0,0,0,98,116,67,104,97,114,73,110,100,101,120,84,114,105,112,108,101,116,68,97,116,97,0,0,98,116,86,101,99,116,111,114,51,70,108,111,97,116,68,97,116,97,0,0,0,0,0,0,98,116,86,101,99,116,111,114,51,68,111,117,98,108,101,68,97,116,97,0,0,0,0,0,98,116,77,101,115,104,80,97,114,116,68,97,116,97,0,0,98,116,83,116,114,105,100,105,110,103,77,101,115,104,73,110,116,101,114,102,97,99,101,68,97,116,97,0,0,0,0,0,50,51,98,116,83,116,114,105,100,105,110,103,77,101,115,104,73,110,116,101,114,102,97,99,101,0,0,0,0,0,0,0,216,82,0,0,96,79,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,82,111,111,116,0,0,0,0,144,79,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,117,110,99,97,117,103,104,116,0,0,0,0,0,0,0,0,116,101,114,109,105,110,97,116,105,110,103,32,119,105,116,104],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE+10240);allocate([32,37,115,32,101,120,99,101,112,116,105,111,110,32,111,102,32,116,121,112,101,32,37,115,58,32,37,115,0,0,0,0,116,101,114,109,105,110,97,116,105,110,103,32,119,105,116,104,32,37,115,32,101,120,99,101,112,116,105,111,110,32,111,102,32,116,121,112,101,32,37,115,0,0,0,0,0,0,0,0,116,101,114,109,105,110,97,116,105,110,103,32,119,105,116,104,32,37,115,32,102,111,114,101,105,103,110,32,101,120,99,101,112,116,105,111,110,0,0,0,116,101,114,109,105,110,97,116,105,110,103,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,112,116,104,114,101,97,100,95,111,110,99,101,32,102,97,105,108,117,114,101,32,105,110,32,95,95,99,120,97,95,103,101,116,95,103,108,111,98,97,108,115,95,102,97,115,116,40,41,0,0,0,0,0,0,0,0,99,97,110,110,111,116,32,99,114,101,97,116,101,32,112,116,104,114,101,97,100,32,107,101,121,32,102,111,114,32,95,95,99,120,97,95,103,101,116,95,103,108,111,98,97,108,115,40,41,0,0,0,0,0,0,0,99,97,110,110,111,116,32,122,101,114,111,32,111,117,116,32,116,104,114,101,97,100,32,118,97,108,117,101,32,102,111,114,32,95,95,99,120,97,95,103,101,116,95,103,108,111,98,97,108,115,40,41,0,0,0,0,0,0,0,0,128,81,0,0,207,0,0,0,208,0,0,0,90,0,0,0,0,0,0,0,115,116,100,58,58,98,97,100,95,97,108,108,111,99,0,0,83,116,57,98,97,100,95,97,108,108,111,99,0,0,0,0,0,83,0,0,112,81,0,0,208,81,0,0,0,0,0,0,116,101,114,109,105,110,97,116,101,95,104,97,110,100,108,101,114,32,117,110,101,120,112,101,99,116,101,100,108,121,32,114,101,116,117,114,110,101,100,0,0,0,0,0,0,0,0,0,83,116,57,101,120,99,101,112,116,105,111,110,0,0,0,0,216,82,0,0,192,81,0,0,83,116,57,116,121,112,101,95,105,110,102,111,0,0,0,0,216,82,0,0,216,81,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,54,95,95,115,104,105,109,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,0,0,0,0,83,0,0,240,81,0,0,232,81,0,0,0,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,55,95,95,99,108,97,115,115,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,0,0,0,83,0,0,40,82,0,0,24,82,0,0,0,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,57,95,95,112,111,105,110,116,101,114,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,55,95,95,112,98,97,115,101,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,0,0,0,83,0,0,136,82,0,0,24,82,0,0,0,0,0,0,0,83,0,0,96,82,0,0,176,82,0,0,0,0,0,0,0,0,0,0,80,82,0,0,209,0,0,0,210,0,0,0,211,0,0,0,212,0,0,0,32,0,0,0,4,0,0,0,16,0,0,0,62,0,0,0,0,0,0,0,72,83,0,0,209,0,0,0,213,0,0,0,211,0,0,0,212,0,0,0,32,0,0,0,5,0,0,0,17,0,0,0,63,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,50,48,95,95,115,105,95,99,108,97,115,115,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,83,0,0,32,83,0,0,80,82,0,0,0,0,0,0,0,0,0,0,168,83,0,0,209,0,0,0,214,0,0,0,211,0,0,0,212,0,0,0,32,0,0,0,6,0,0,0,18,0,0,0,64,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,50,49,95,95,118,109,105,95,99,108,97,115,115,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,83,0,0,128,83,0,0,80,82,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE+20480);var tempDoublePtr=Runtime.alignMemory(allocate(12,"i8",ALLOC_STATIC),8);assert(tempDoublePtr%8==0);function copyTempFloat(ptr){HEAP8[tempDoublePtr]=HEAP8[ptr];HEAP8[tempDoublePtr+1]=HEAP8[ptr+1];HEAP8[tempDoublePtr+2]=HEAP8[ptr+2];HEAP8[tempDoublePtr+3]=HEAP8[ptr+3]}function copyTempDouble(ptr){HEAP8[tempDoublePtr]=HEAP8[ptr];HEAP8[tempDoublePtr+1]=HEAP8[ptr+1];HEAP8[tempDoublePtr+2]=HEAP8[ptr+2];HEAP8[tempDoublePtr+3]=HEAP8[ptr+3];HEAP8[tempDoublePtr+4]=HEAP8[ptr+4];HEAP8[tempDoublePtr+5]=HEAP8[ptr+5];HEAP8[tempDoublePtr+6]=HEAP8[ptr+6];HEAP8[tempDoublePtr+7]=HEAP8[ptr+7]}var _cosf=Math_cos;Module["_i64Subtract"]=_i64Subtract;var _fabsf=Math_abs;var ___errno_state=0;function ___setErrNo(value){HEAP32[___errno_state>>2]=value;return value}var ERRNO_CODES={EPERM:1,ENOENT:2,ESRCH:3,EINTR:4,EIO:5,ENXIO:6,E2BIG:7,ENOEXEC:8,EBADF:9,ECHILD:10,EAGAIN:11,EWOULDBLOCK:11,ENOMEM:12,EACCES:13,EFAULT:14,ENOTBLK:15,EBUSY:16,EEXIST:17,EXDEV:18,ENODEV:19,ENOTDIR:20,EISDIR:21,EINVAL:22,ENFILE:23,EMFILE:24,ENOTTY:25,ETXTBSY:26,EFBIG:27,ENOSPC:28,ESPIPE:29,EROFS:30,EMLINK:31,EPIPE:32,EDOM:33,ERANGE:34,ENOMSG:42,EIDRM:43,ECHRNG:44,EL2NSYNC:45,EL3HLT:46,EL3RST:47,ELNRNG:48,EUNATCH:49,ENOCSI:50,EL2HLT:51,EDEADLK:35,ENOLCK:37,EBADE:52,EBADR:53,EXFULL:54,ENOANO:55,EBADRQC:56,EBADSLT:57,EDEADLOCK:35,EBFONT:59,ENOSTR:60,ENODATA:61,ETIME:62,ENOSR:63,ENONET:64,ENOPKG:65,EREMOTE:66,ENOLINK:67,EADV:68,ESRMNT:69,ECOMM:70,EPROTO:71,EMULTIHOP:72,EDOTDOT:73,EBADMSG:74,ENOTUNIQ:76,EBADFD:77,EREMCHG:78,ELIBACC:79,ELIBBAD:80,ELIBSCN:81,ELIBMAX:82,ELIBEXEC:83,ENOSYS:38,ENOTEMPTY:39,ENAMETOOLONG:36,ELOOP:40,EOPNOTSUPP:95,EPFNOSUPPORT:96,ECONNRESET:104,ENOBUFS:105,EAFNOSUPPORT:97,EPROTOTYPE:91,ENOTSOCK:88,ENOPROTOOPT:92,ESHUTDOWN:108,ECONNREFUSED:111,EADDRINUSE:98,ECONNABORTED:103,ENETUNREACH:101,ENETDOWN:100,ETIMEDOUT:110,EHOSTDOWN:112,EHOSTUNREACH:113,EINPROGRESS:115,EALREADY:114,EDESTADDRREQ:89,EMSGSIZE:90,EPROTONOSUPPORT:93,ESOCKTNOSUPPORT:94,EADDRNOTAVAIL:99,ENETRESET:102,EISCONN:106,ENOTCONN:107,ETOOMANYREFS:109,EUSERS:87,EDQUOT:122,ESTALE:116,ENOTSUP:95,ENOMEDIUM:123,EILSEQ:84,EOVERFLOW:75,ECANCELED:125,ENOTRECOVERABLE:131,EOWNERDEAD:130,ESTRPIPE:86};function _sysconf(name){switch(name){case 30:return PAGE_SIZE;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 79:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:{if(typeof navigator==="object")return navigator["hardwareConcurrency"]||1;return 1}}___setErrNo(ERRNO_CODES.EINVAL);return-1}function __ZSt18uncaught_exceptionv(){return!!__ZSt18uncaught_exceptionv.uncaught_exception}var EXCEPTIONS={last:0,caught:[],infos:{},deAdjust:(function(adjusted){if(!adjusted||EXCEPTIONS.infos[adjusted])return adjusted;for(var ptr in EXCEPTIONS.infos){var info=EXCEPTIONS.infos[ptr];if(info.adjusted===adjusted){return ptr}}return adjusted}),addRef:(function(ptr){if(!ptr)return;var info=EXCEPTIONS.infos[ptr];info.refcount++}),decRef:(function(ptr){if(!ptr)return;var info=EXCEPTIONS.infos[ptr];assert(info.refcount>0);info.refcount--;if(info.refcount===0){if(info.destructor){Runtime.dynCall("vi",info.destructor,[ptr])}delete EXCEPTIONS.infos[ptr];___cxa_free_exception(ptr)}}),clearRef:(function(ptr){if(!ptr)return;var info=EXCEPTIONS.infos[ptr];info.refcount=0})};function ___resumeException(ptr){if(!EXCEPTIONS.last){EXCEPTIONS.last=ptr}EXCEPTIONS.clearRef(EXCEPTIONS.deAdjust(ptr));throw ptr+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}function ___cxa_find_matching_catch(){var thrown=EXCEPTIONS.last;if(!thrown){return(asm["setTempRet0"](0),0)|0}var info=EXCEPTIONS.infos[thrown];var throwntype=info.type;if(!throwntype){return(asm["setTempRet0"](0),thrown)|0}var typeArray=Array.prototype.slice.call(arguments);var pointer=Module["___cxa_is_pointer_type"](throwntype);if(!___cxa_find_matching_catch.buffer)___cxa_find_matching_catch.buffer=_malloc(4);HEAP32[___cxa_find_matching_catch.buffer>>2]=thrown;thrown=___cxa_find_matching_catch.buffer;for(var i=0;i<typeArray.length;i++){if(typeArray[i]&&Module["___cxa_can_catch"](typeArray[i],throwntype,thrown)){thrown=HEAP32[thrown>>2];info.adjusted=thrown;return(asm["setTempRet0"](typeArray[i]),thrown)|0}}thrown=HEAP32[thrown>>2];return(asm["setTempRet0"](throwntype),thrown)|0}function ___cxa_throw(ptr,type,destructor){EXCEPTIONS.infos[ptr]={ptr:ptr,adjusted:ptr,type:type,destructor:destructor,refcount:0};EXCEPTIONS.last=ptr;if(!("uncaught_exception"in __ZSt18uncaught_exceptionv)){__ZSt18uncaught_exceptionv.uncaught_exception=1}else{__ZSt18uncaught_exceptionv.uncaught_exception++}throw ptr+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}Module["_memset"]=_memset;function _abort(){Module["abort"]()}function _pthread_once(ptr,func){if(!_pthread_once.seen)_pthread_once.seen={};if(ptr in _pthread_once.seen)return;Runtime.dynCall("v",func);_pthread_once.seen[ptr]=1}var _acosf=Math_acos;Module["_strlen"]=_strlen;var _sqrtf=Math_sqrt;var FS=undefined;var SOCKFS=undefined;function _send(fd,buf,len,flags){var sock=SOCKFS.getSocket(fd);if(!sock){___setErrNo(ERRNO_CODES.EBADF);return-1}return _write(fd,buf,len)}function _pwrite(fildes,buf,nbyte,offset){var stream=FS.getStream(fildes);if(!stream){___setErrNo(ERRNO_CODES.EBADF);return-1}try{var slab=HEAP8;return FS.write(stream,slab,buf,nbyte,offset)}catch(e){FS.handleFSError(e);return-1}}function _write(fildes,buf,nbyte){var stream=FS.getStream(fildes);if(!stream){___setErrNo(ERRNO_CODES.EBADF);return-1}try{var slab=HEAP8;return FS.write(stream,slab,buf,nbyte)}catch(e){FS.handleFSError(e);return-1}}function _fileno(stream){stream=FS.getStreamFromPtr(stream);if(!stream)return-1;return stream.fd}function _fputc(c,stream){var chr=unSign(c&255);HEAP8[_fputc.ret>>0]=chr;var fd=_fileno(stream);var ret=_write(fd,_fputc.ret,1);if(ret==-1){var streamObj=FS.getStreamFromPtr(stream);if(streamObj)streamObj.error=true;return-1}else{return chr}}var PTHREAD_SPECIFIC={};function _pthread_getspecific(key){return PTHREAD_SPECIFIC[key]||0}Module["_i64Add"]=_i64Add;var PTHREAD_SPECIFIC_NEXT_KEY=1;function _pthread_key_create(key,destructor){if(key==0){return ERRNO_CODES.EINVAL}HEAP32[key>>2]=PTHREAD_SPECIFIC_NEXT_KEY;PTHREAD_SPECIFIC[PTHREAD_SPECIFIC_NEXT_KEY]=0;PTHREAD_SPECIFIC_NEXT_KEY++;return 0}var _llvm_pow_f32=Math_pow;function _pthread_setspecific(key,value){if(!(key in PTHREAD_SPECIFIC)){return ERRNO_CODES.EINVAL}PTHREAD_SPECIFIC[key]=value;return 0}var _atan2f=Math_atan2;function ___cxa_pure_virtual(){ABORT=true;throw"Pure virtual function called!"}function ___cxa_guard_release(){}var _asinf=Math_asin;function ___cxa_guard_acquire(variable){if(!HEAP8[variable>>0]){HEAP8[variable>>0]=1;return 1}return 0}function _gettimeofday(ptr){var now=Date.now();HEAP32[ptr>>2]=now/1e3|0;HEAP32[ptr+4>>2]=now%1e3*1e3|0;return 0}var _emscripten_asm_const_double=true;function ___cxa_begin_catch(ptr){__ZSt18uncaught_exceptionv.uncaught_exception--;EXCEPTIONS.caught.push(ptr);EXCEPTIONS.addRef(EXCEPTIONS.deAdjust(ptr));return ptr}var _sinf=Math_sin;function _emscripten_memcpy_big(dest,src,num){HEAPU8.set(HEAPU8.subarray(src,src+num),dest);return dest}Module["_memcpy"]=_memcpy;function _sbrk(bytes){var self=_sbrk;if(!self.called){DYNAMICTOP=alignMemoryPage(DYNAMICTOP);self.called=true;assert(Runtime.dynamicAlloc);self.alloc=Runtime.dynamicAlloc;Runtime.dynamicAlloc=(function(){abort("cannot dynamically allocate, sbrk now has control")})}var ret=DYNAMICTOP;if(bytes!=0){var success=self.alloc(bytes);if(!success)return-1>>>0}return ret}Module["_memmove"]=_memmove;function _malloc(bytes){var ptr=Runtime.dynamicAlloc(bytes+8);return ptr+8&4294967288}Module["_malloc"]=_malloc;function ___cxa_allocate_exception(size){return _malloc(size)}function ___errno_location(){return ___errno_state}Module["_llvm_bswap_i32"]=_llvm_bswap_i32;function _llvm_trap(){abort("trap!")}function _time(ptr){var ret=Date.now()/1e3|0;if(ptr){HEAP32[ptr>>2]=ret}return ret}var _UItoF=true;function _fwrite(ptr,size,nitems,stream){var bytesToWrite=nitems*size;if(bytesToWrite==0)return 0;var fd=_fileno(stream);var bytesWritten=_write(fd,ptr,bytesToWrite);if(bytesWritten==-1){var streamObj=FS.getStreamFromPtr(stream);if(streamObj)streamObj.error=true;return 0}else{return bytesWritten/size|0}}function __reallyNegative(x){return x<0||x===0&&1/x===-Infinity}function __formatString(format,varargs){assert((varargs&7)===0);var textIndex=format;var argIndex=0;function getNextArg(type){var ret;argIndex=Runtime.prepVararg(argIndex,type);if(type==="double"){ret=(HEAP32[tempDoublePtr>>2]=HEAP32[varargs+argIndex>>2],HEAP32[tempDoublePtr+4>>2]=HEAP32[varargs+(argIndex+4)>>2],+HEAPF64[tempDoublePtr>>3]);argIndex+=8}else if(type=="i64"){ret=[HEAP32[varargs+argIndex>>2],HEAP32[varargs+(argIndex+4)>>2]];argIndex+=8}else{assert((argIndex&3)===0);type="i32";ret=HEAP32[varargs+argIndex>>2];argIndex+=4}return ret}var ret=[];var curr,next,currArg;while(1){var startTextIndex=textIndex;curr=HEAP8[textIndex>>0];if(curr===0)break;next=HEAP8[textIndex+1>>0];if(curr==37){var flagAlwaysSigned=false;var flagLeftAlign=false;var flagAlternative=false;var flagZeroPad=false;var flagPadSign=false;flagsLoop:while(1){switch(next){case 43:flagAlwaysSigned=true;break;case 45:flagLeftAlign=true;break;case 35:flagAlternative=true;break;case 48:if(flagZeroPad){break flagsLoop}else{flagZeroPad=true;break};case 32:flagPadSign=true;break;default:break flagsLoop}textIndex++;next=HEAP8[textIndex+1>>0]}var width=0;if(next==42){width=getNextArg("i32");textIndex++;next=HEAP8[textIndex+1>>0]}else{while(next>=48&&next<=57){width=width*10+(next-48);textIndex++;next=HEAP8[textIndex+1>>0]}}var precisionSet=false,precision=-1;if(next==46){precision=0;precisionSet=true;textIndex++;next=HEAP8[textIndex+1>>0];if(next==42){precision=getNextArg("i32");textIndex++}else{while(1){var precisionChr=HEAP8[textIndex+1>>0];if(precisionChr<48||precisionChr>57)break;precision=precision*10+(precisionChr-48);textIndex++}}next=HEAP8[textIndex+1>>0]}if(precision<0){precision=6;precisionSet=false}var argSize;switch(String.fromCharCode(next)){case"h":var nextNext=HEAP8[textIndex+2>>0];if(nextNext==104){textIndex++;argSize=1}else{argSize=2}break;case"l":var nextNext=HEAP8[textIndex+2>>0];if(nextNext==108){textIndex++;argSize=8}else{argSize=4}break;case"L":case"q":case"j":argSize=8;break;case"z":case"t":case"I":argSize=4;break;default:argSize=null}if(argSize)textIndex++;next=HEAP8[textIndex+1>>0];switch(String.fromCharCode(next)){case"d":case"i":case"u":case"o":case"x":case"X":case"p":{var signed=next==100||next==105;argSize=argSize||4;var currArg=getNextArg("i"+argSize*8);var origArg=currArg;var argText;if(argSize==8){currArg=Runtime.makeBigInt(currArg[0],currArg[1],next==117)}if(argSize<=4){var limit=Math.pow(256,argSize)-1;currArg=(signed?reSign:unSign)(currArg&limit,argSize*8)}var currAbsArg=Math.abs(currArg);var prefix="";if(next==100||next==105){if(argSize==8&&i64Math)argText=i64Math.stringify(origArg[0],origArg[1],null);else argText=reSign(currArg,8*argSize,1).toString(10)}else if(next==117){if(argSize==8&&i64Math)argText=i64Math.stringify(origArg[0],origArg[1],true);else argText=unSign(currArg,8*argSize,1).toString(10);currArg=Math.abs(currArg)}else if(next==111){argText=(flagAlternative?"0":"")+currAbsArg.toString(8)}else if(next==120||next==88){prefix=flagAlternative&&currArg!=0?"0x":"";if(argSize==8&&i64Math){if(origArg[1]){argText=(origArg[1]>>>0).toString(16);var lower=(origArg[0]>>>0).toString(16);while(lower.length<8)lower="0"+lower;argText+=lower}else{argText=(origArg[0]>>>0).toString(16)}}else if(currArg<0){currArg=-currArg;argText=(currAbsArg-1).toString(16);var buffer=[];for(var i=0;i<argText.length;i++){buffer.push((15-parseInt(argText[i],16)).toString(16))}argText=buffer.join("");while(argText.length<argSize*2)argText="f"+argText}else{argText=currAbsArg.toString(16)}if(next==88){prefix=prefix.toUpperCase();argText=argText.toUpperCase()}}else if(next==112){if(currAbsArg===0){argText="(nil)"}else{prefix="0x";argText=currAbsArg.toString(16)}}if(precisionSet){while(argText.length<precision){argText="0"+argText}}if(currArg>=0){if(flagAlwaysSigned){prefix="+"+prefix}else if(flagPadSign){prefix=" "+prefix}}if(argText.charAt(0)=="-"){prefix="-"+prefix;argText=argText.substr(1)}while(prefix.length+argText.length<width){if(flagLeftAlign){argText+=" "}else{if(flagZeroPad){argText="0"+argText}else{prefix=" "+prefix}}}argText=prefix+argText;argText.split("").forEach((function(chr){ret.push(chr.charCodeAt(0))}));break};case"f":case"F":case"e":case"E":case"g":case"G":{var currArg=getNextArg("double");var argText;if(isNaN(currArg)){argText="nan";flagZeroPad=false}else if(!isFinite(currArg)){argText=(currArg<0?"-":"")+"inf";flagZeroPad=false}else{var isGeneral=false;var effectivePrecision=Math.min(precision,20);if(next==103||next==71){isGeneral=true;precision=precision||1;var exponent=parseInt(currArg.toExponential(effectivePrecision).split("e")[1],10);if(precision>exponent&&exponent>=-4){next=(next==103?"f":"F").charCodeAt(0);precision-=exponent+1}else{next=(next==103?"e":"E").charCodeAt(0);precision--}effectivePrecision=Math.min(precision,20)}if(next==101||next==69){argText=currArg.toExponential(effectivePrecision);if(/[eE][-+]\d$/.test(argText)){argText=argText.slice(0,-1)+"0"+argText.slice(-1)}}else if(next==102||next==70){argText=currArg.toFixed(effectivePrecision);if(currArg===0&&__reallyNegative(currArg)){argText="-"+argText}}var parts=argText.split("e");if(isGeneral&&!flagAlternative){while(parts[0].length>1&&parts[0].indexOf(".")!=-1&&(parts[0].slice(-1)=="0"||parts[0].slice(-1)==".")){parts[0]=parts[0].slice(0,-1)}}else{if(flagAlternative&&argText.indexOf(".")==-1)parts[0]+=".";while(precision>effectivePrecision++)parts[0]+="0"}argText=parts[0]+(parts.length>1?"e"+parts[1]:"");if(next==69)argText=argText.toUpperCase();if(currArg>=0){if(flagAlwaysSigned){argText="+"+argText}else if(flagPadSign){argText=" "+argText}}}while(argText.length<width){if(flagLeftAlign){argText+=" "}else{if(flagZeroPad&&(argText[0]=="-"||argText[0]=="+")){argText=argText[0]+"0"+argText.slice(1)}else{argText=(flagZeroPad?"0":" ")+argText}}}if(next<97)argText=argText.toUpperCase();argText.split("").forEach((function(chr){ret.push(chr.charCodeAt(0))}));break};case"s":{var arg=getNextArg("i8*");var argLength=arg?_strlen(arg):"(null)".length;if(precisionSet)argLength=Math.min(argLength,precision);if(!flagLeftAlign){while(argLength<width--){ret.push(32)}}if(arg){for(var i=0;i<argLength;i++){ret.push(HEAPU8[arg++>>0])}}else{ret=ret.concat(intArrayFromString("(null)".substr(0,argLength),true))}if(flagLeftAlign){while(argLength<width--){ret.push(32)}}break};case"c":{if(flagLeftAlign)ret.push(getNextArg("i8"));while(--width>0){ret.push(32)}if(!flagLeftAlign)ret.push(getNextArg("i8"));break};case"n":{var ptr=getNextArg("i32*");HEAP32[ptr>>2]=ret.length;break};case"%":{ret.push(curr);break};default:{for(var i=startTextIndex;i<textIndex+2;i++){ret.push(HEAP8[i>>0])}}}textIndex+=2}else{ret.push(curr);textIndex+=1}}return ret}function _fprintf(stream,format,varargs){var result=__formatString(format,varargs);var stack=Runtime.stackSave();var ret=_fwrite(allocate(result,"i8",ALLOC_STACK),1,result.length,stream);Runtime.stackRestore(stack);return ret}function _vfprintf(s,f,va_arg){return _fprintf(s,f,HEAP32[va_arg>>2])}var _stderr=allocate(1,"i32*",ALLOC_STATIC);___errno_state=Runtime.staticAlloc(4);HEAP32[___errno_state>>2]=0;_fputc.ret=allocate([0],"i8",ALLOC_STATIC);STACK_BASE=STACKTOP=Runtime.alignMemory(STATICTOP);staticSealed=true;STACK_MAX=STACK_BASE+TOTAL_STACK;DYNAMIC_BASE=DYNAMICTOP=Runtime.alignMemory(STACK_MAX);assert(DYNAMIC_BASE<TOTAL_MEMORY,"TOTAL_MEMORY not big enough for stack");var cttz_i8=allocate([8,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,7,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0],"i8",ALLOC_DYNAMIC);function invoke_viiiii(index,a1,a2,a3,a4,a5){try{Module["dynCall_viiiii"](index,a1,a2,a3,a4,a5)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_vid(index,a1,a2){try{Module["dynCall_vid"](index,a1,a2)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_vi(index,a1){try{Module["dynCall_vi"](index,a1)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiidii(index,a1,a2,a3,a4,a5,a6){try{Module["dynCall_viiidii"](index,a1,a2,a3,a4,a5,a6)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_vii(index,a1,a2){try{Module["dynCall_vii"](index,a1,a2)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_iiiiiiiiiii(index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10){try{return Module["dynCall_iiiiiiiiiii"](index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_ii(index,a1){try{return Module["dynCall_ii"](index,a1)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viidi(index,a1,a2,a3,a4){try{Module["dynCall_viidi"](index,a1,a2,a3,a4)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viddiii(index,a1,a2,a3,a4,a5,a6){try{Module["dynCall_viddiii"](index,a1,a2,a3,a4,a5,a6)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_vidii(index,a1,a2,a3,a4){try{Module["dynCall_vidii"](index,a1,a2,a3,a4)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_iiiii(index,a1,a2,a3,a4){try{return Module["dynCall_iiiii"](index,a1,a2,a3,a4)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_vidi(index,a1,a2,a3){try{Module["dynCall_vidi"](index,a1,a2,a3)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_diiiiiiii(index,a1,a2,a3,a4,a5,a6,a7,a8){try{return Module["dynCall_diiiiiiii"](index,a1,a2,a3,a4,a5,a6,a7,a8)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiiiddddiid(index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11){try{Module["dynCall_viiiiddddiid"](index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_diiiii(index,a1,a2,a3,a4,a5){try{return Module["dynCall_diiiii"](index,a1,a2,a3,a4,a5)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_iiii(index,a1,a2,a3){try{return Module["dynCall_iiii"](index,a1,a2,a3)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiiiii(index,a1,a2,a3,a4,a5,a6){try{Module["dynCall_viiiiii"](index,a1,a2,a3,a4,a5,a6)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_iiid(index,a1,a2,a3){try{return Module["dynCall_iiid"](index,a1,a2,a3)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_di(index,a1){try{return Module["dynCall_di"](index,a1)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_iiiiiii(index,a1,a2,a3,a4,a5,a6){try{return Module["dynCall_iiiiiii"](index,a1,a2,a3,a4,a5,a6)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_diiidii(index,a1,a2,a3,a4,a5,a6){try{return Module["dynCall_diiidii"](index,a1,a2,a3,a4,a5,a6)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viidii(index,a1,a2,a3,a4,a5){try{Module["dynCall_viidii"](index,a1,a2,a3,a4,a5)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiiiiii(index,a1,a2,a3,a4,a5,a6,a7){try{Module["dynCall_viiiiiii"](index,a1,a2,a3,a4,a5,a6,a7)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiiiiiiii(index,a1,a2,a3,a4,a5,a6,a7,a8,a9){try{Module["dynCall_viiiiiiiii"](index,a1,a2,a3,a4,a5,a6,a7,a8,a9)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiiiiiiiii(index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10){try{Module["dynCall_viiiiiiiiii"](index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_iii(index,a1,a2){try{return Module["dynCall_iii"](index,a1,a2)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_diii(index,a1,a2,a3){try{return Module["dynCall_diii"](index,a1,a2,a3)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_diiiiiiiiii(index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10){try{return Module["dynCall_diiiiiiiiii"](index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiiid(index,a1,a2,a3,a4,a5){try{Module["dynCall_viiiid"](index,a1,a2,a3,a4,a5)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_diiiiiiiii(index,a1,a2,a3,a4,a5,a6,a7,a8,a9){try{return Module["dynCall_diiiiiiiii"](index,a1,a2,a3,a4,a5,a6,a7,a8,a9)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_did(index,a1,a2){try{return Module["dynCall_did"](index,a1,a2)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiiidddddidi(index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11,a12){try{Module["dynCall_viiiidddddidi"](index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11,a12)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_diidii(index,a1,a2,a3,a4,a5){try{return Module["dynCall_diidii"](index,a1,a2,a3,a4,a5)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_diiii(index,a1,a2,a3,a4){try{return Module["dynCall_diiii"](index,a1,a2,a3,a4)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_iiiiiiiiii(index,a1,a2,a3,a4,a5,a6,a7,a8,a9){try{return Module["dynCall_iiiiiiiiii"](index,a1,a2,a3,a4,a5,a6,a7,a8,a9)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiid(index,a1,a2,a3,a4){try{Module["dynCall_viiid"](index,a1,a2,a3,a4)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viii(index,a1,a2,a3){try{Module["dynCall_viii"](index,a1,a2,a3)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_v(index){try{Module["dynCall_v"](index)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viid(index,a1,a2,a3){try{Module["dynCall_viid"](index,a1,a2,a3)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_iidid(index,a1,a2,a3,a4){try{return Module["dynCall_iidid"](index,a1,a2,a3,a4)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiii(index,a1,a2,a3,a4){try{Module["dynCall_viiii"](index,a1,a2,a3,a4)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}Module.asmGlobalArg={"Math":Math,"Int8Array":Int8Array,"Int16Array":Int16Array,"Int32Array":Int32Array,"Uint8Array":Uint8Array,"Uint16Array":Uint16Array,"Uint32Array":Uint32Array,"Float32Array":Float32Array,"Float64Array":Float64Array,"NaN":NaN,"Infinity":Infinity,"byteLength":byteLength};Module.asmLibraryArg={"abort":abort,"assert":assert,"invoke_viiiii":invoke_viiiii,"invoke_vid":invoke_vid,"invoke_vi":invoke_vi,"invoke_viiidii":invoke_viiidii,"invoke_vii":invoke_vii,"invoke_iiiiiiiiiii":invoke_iiiiiiiiiii,"invoke_ii":invoke_ii,"invoke_viidi":invoke_viidi,"invoke_viddiii":invoke_viddiii,"invoke_vidii":invoke_vidii,"invoke_iiiii":invoke_iiiii,"invoke_vidi":invoke_vidi,"invoke_diiiiiiii":invoke_diiiiiiii,"invoke_viiiiddddiid":invoke_viiiiddddiid,"invoke_diiiii":invoke_diiiii,"invoke_iiii":invoke_iiii,"invoke_viiiiii":invoke_viiiiii,"invoke_iiid":invoke_iiid,"invoke_di":invoke_di,"invoke_iiiiiii":invoke_iiiiiii,"invoke_diiidii":invoke_diiidii,"invoke_viidii":invoke_viidii,"invoke_viiiiiii":invoke_viiiiiii,"invoke_viiiiiiiii":invoke_viiiiiiiii,"invoke_viiiiiiiiii":invoke_viiiiiiiiii,"invoke_iii":invoke_iii,"invoke_diii":invoke_diii,"invoke_diiiiiiiiii":invoke_diiiiiiiiii,"invoke_viiiid":invoke_viiiid,"invoke_diiiiiiiii":invoke_diiiiiiiii,"invoke_did":invoke_did,"invoke_viiiidddddidi":invoke_viiiidddddidi,"invoke_diidii":invoke_diidii,"invoke_diiii":invoke_diiii,"invoke_iiiiiiiiii":invoke_iiiiiiiiii,"invoke_viiid":invoke_viiid,"invoke_viii":invoke_viii,"invoke_v":invoke_v,"invoke_viid":invoke_viid,"invoke_iidid":invoke_iidid,"invoke_viiii":invoke_viiii,"_cosf":_cosf,"_send":_send,"_sqrtf":_sqrtf,"___cxa_guard_acquire":___cxa_guard_acquire,"___setErrNo":___setErrNo,"_vfprintf":_vfprintf,"_atan2f":_atan2f,"__ZSt18uncaught_exceptionv":__ZSt18uncaught_exceptionv,"___cxa_guard_release":___cxa_guard_release,"_pwrite":_pwrite,"_acosf":_acosf,"_asinf":_asinf,"_fabsf":_fabsf,"_sbrk":_sbrk,"_llvm_pow_f32":_llvm_pow_f32,"___cxa_begin_catch":___cxa_begin_catch,"_sinf":_sinf,"_fileno":_fileno,"___resumeException":___resumeException,"___cxa_find_matching_catch":___cxa_find_matching_catch,"_sysconf":_sysconf,"__reallyNegative":__reallyNegative,"_pthread_getspecific":_pthread_getspecific,"_emscripten_memcpy_big":_emscripten_memcpy_big,"_pthread_once":_pthread_once,"_pthread_key_create":_pthread_key_create,"_write":_write,"___errno_location":___errno_location,"_pthread_setspecific":_pthread_setspecific,"_fputc":_fputc,"___cxa_throw":___cxa_throw,"_abort":_abort,"___cxa_allocate_exception":___cxa_allocate_exception,"_fwrite":_fwrite,"_time":_time,"_fprintf":_fprintf,"_gettimeofday":_gettimeofday,"__formatString":__formatString,"_emscripten_asm_const_8":_emscripten_asm_const_8,"_llvm_trap":_llvm_trap,"___cxa_pure_virtual":___cxa_pure_virtual,"STACKTOP":STACKTOP,"STACK_MAX":STACK_MAX,"tempDoublePtr":tempDoublePtr,"ABORT":ABORT,"cttz_i8":cttz_i8,"_stderr":_stderr};// EMSCRIPTEN_START_ASM
var asm=(function(global,env,buffer) {
"use asm";var a=global.Int8Array;var b=global.Int16Array;var c=global.Int32Array;var d=global.Uint8Array;var e=global.Uint16Array;var f=global.Uint32Array;var g=global.Float32Array;var h=global.Float64Array;var i=new a(buffer);var j=new b(buffer);var k=new c(buffer);var l=new d(buffer);var m=new e(buffer);var n=new f(buffer);var o=new g(buffer);var p=new h(buffer);var q=global.byteLength;var r=env.STACKTOP|0;var s=env.STACK_MAX|0;var t=env.tempDoublePtr|0;var u=env.ABORT|0;var v=env.cttz_i8|0;var w=env._stderr|0;var x=0;var y=0;var z=0;var A=0;var B=global.NaN,C=global.Infinity;var D=0,E=0,F=0,G=0,H=0.0,I=0,J=0,K=0,L=0.0;var M=0;var N=0;var O=0;var P=0;var Q=0;var R=0;var S=0;var T=0;var U=0;var V=0;var W=global.Math.floor;var X=global.Math.abs;var Y=global.Math.sqrt;var Z=global.Math.pow;var _=global.Math.cos;var $=global.Math.sin;var aa=global.Math.tan;var ba=global.Math.acos;var ca=global.Math.asin;var da=global.Math.atan;var ea=global.Math.atan2;var fa=global.Math.exp;var ga=global.Math.log;var ha=global.Math.ceil;var ia=global.Math.imul;var ja=global.Math.min;var ka=global.Math.clz32;var la=env.abort;var ma=env.assert;var na=env.invoke_viiiii;var oa=env.invoke_vid;var pa=env.invoke_vi;var qa=env.invoke_viiidii;var ra=env.invoke_vii;var sa=env.invoke_iiiiiiiiiii;var ta=env.invoke_ii;var ua=env.invoke_viidi;var va=env.invoke_viddiii;var wa=env.invoke_vidii;var xa=env.invoke_iiiii;var ya=env.invoke_vidi;var za=env.invoke_diiiiiiii;var Aa=env.invoke_viiiiddddiid;var Ba=env.invoke_diiiii;var Ca=env.invoke_iiii;var Da=env.invoke_viiiiii;var Ea=env.invoke_iiid;var Fa=env.invoke_di;var Ga=env.invoke_iiiiiii;var Ha=env.invoke_diiidii;var Ia=env.invoke_viidii;var Ja=env.invoke_viiiiiii;var Ka=env.invoke_viiiiiiiii;var La=env.invoke_viiiiiiiiii;var Ma=env.invoke_iii;var Na=env.invoke_diii;var Oa=env.invoke_diiiiiiiiii;var Pa=env.invoke_viiiid;var Qa=env.invoke_diiiiiiiii;var Ra=env.invoke_did;var Sa=env.invoke_viiiidddddidi;var Ta=env.invoke_diidii;var Ua=env.invoke_diiii;var Va=env.invoke_iiiiiiiiii;var Wa=env.invoke_viiid;var Xa=env.invoke_viii;var Ya=env.invoke_v;var Za=env.invoke_viid;var _a=env.invoke_iidid;var $a=env.invoke_viiii;var ab=env._cosf;var bb=env._send;var cb=env._sqrtf;var db=env.___cxa_guard_acquire;var eb=env.___setErrNo;var fb=env._vfprintf;var gb=env._atan2f;var hb=env.__ZSt18uncaught_exceptionv;var ib=env.___cxa_guard_release;var jb=env._pwrite;var kb=env._acosf;var lb=env._asinf;var mb=env._fabsf;var nb=env._sbrk;var ob=env._llvm_pow_f32;var pb=env.___cxa_begin_catch;var qb=env._sinf;var rb=env._fileno;var sb=env.___resumeException;var tb=env.___cxa_find_matching_catch;var ub=env._sysconf;var vb=env.__reallyNegative;var wb=env._pthread_getspecific;var xb=env._emscripten_memcpy_big;var yb=env._pthread_once;var zb=env._pthread_key_create;var Ab=env._write;var Bb=env.___errno_location;var Cb=env._pthread_setspecific;var Db=env._fputc;var Eb=env.___cxa_throw;var Fb=env._abort;var Gb=env.___cxa_allocate_exception;var Hb=env._fwrite;var Ib=env._time;var Jb=env._fprintf;var Kb=env._gettimeofday;var Lb=env.__formatString;var Mb=env._emscripten_asm_const_8;var Nb=env._llvm_trap;var Ob=env.___cxa_pure_virtual;var Pb=0.0;function _emscripten_replace_memory(newBuffer){if(q(newBuffer)&16777215||q(newBuffer)<=16777215||q(newBuffer)>2147483648)return false;i=new a(newBuffer);j=new b(newBuffer);k=new c(newBuffer);l=new d(newBuffer);m=new e(newBuffer);n=new f(newBuffer);o=new g(newBuffer);p=new h(newBuffer);buffer=newBuffer;return true}
// EMSCRIPTEN_START_FUNCS
function Dc(a){a=a|0;var b=0;b=r;r=r+a|0;r=r+15&-16;return b|0}function Ec(){return r|0}function Fc(a){a=a|0;r=a}function Gc(a,b){a=a|0;b=b|0;if(!x){x=a;y=b}}function Hc(a){a=a|0;i[t>>0]=i[a>>0];i[t+1>>0]=i[a+1>>0];i[t+2>>0]=i[a+2>>0];i[t+3>>0]=i[a+3>>0]}function Ic(a){a=a|0;i[t>>0]=i[a>>0];i[t+1>>0]=i[a+1>>0];i[t+2>>0]=i[a+2>>0];i[t+3>>0]=i[a+3>>0];i[t+4>>0]=i[a+4>>0];i[t+5>>0]=i[a+5>>0];i[t+6>>0]=i[a+6>>0];i[t+7>>0]=i[a+7>>0]}function Jc(a){a=a|0;M=a}function Kc(){return M|0}function Lc(a,b,c,d){a=a|0;b=+b;c=+c;d=+d;var e=0.0,f=0.0,g=0.0;e=+_(+b);f=+_(+c);g=+_(+d);b=+$(+b);c=+$(+c);d=+$(+d);o[a>>2]=f*g;o[a+4>>2]=c*(b*g)-e*d;o[a+8>>2]=c*(e*g)+b*d;o[a+12>>2]=0.0;o[a+16>>2]=f*d;o[a+20>>2]=c*(b*d)+e*g;o[a+24>>2]=c*(e*d)-b*g;o[a+28>>2]=0.0;o[a+32>>2]=-c;o[a+36>>2]=f*b;o[a+40>>2]=f*e;o[a+44>>2]=0.0;return}function Mc(a,b){a=a|0;b=b|0;Jw(a,b);return}function Nc(a){a=a|0;if(!a)return;jF(a);return}function Oc(){var a=0,b=0;while(1){a=iF(8)|0;if(a){b=6;break}a=k[5230]|0;k[5230]=a+0;if(!a){b=5;break}zc[a&3]()}if((b|0)==5){b=Gb(4)|0;k[b>>2]=20816;Eb(b|0,20864,207)}else if((b|0)==6){k[a>>2]=0;k[a+4>>2]=0;j[a+4>>1]=1;j[a+6>>1]=-1;k[a>>2]=1032;return a|0}return 0}function Pc(a,b,c,d,e,f,g,h){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;return +(+ac[k[(k[a>>2]|0)+12>>2]&1](a,b,c,d,e,f,g,h))}function Qc(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Rc(a,b){a=a|0;b=b|0;var c=0;k[5108]=(k[5108]|0)+1;c=iF(95)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}nt(c,a,b,1);return c|0}function Sc(a,b,c){a=a|0;b=b|0;c=c|0;var d=0;k[5108]=(k[5108]|0)+1;d=iF(95)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}nt(d,a,b,c);return d|0}function Tc(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function Uc(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function Vc(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Wc(){var a=0,b=0;while(1){a=iF(196)|0;if(a){b=6;break}a=k[5230]|0;k[5230]=a+0;if(!a){b=5;break}zc[a&3]()}if((b|0)==5){b=Gb(4)|0;k[b>>2]=20816;Eb(b|0,20864,207)}else if((b|0)==6){mv(a,0);return a|0}return 0}function Xc(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Yc(a){a=a|0;if(!a)return;jF(a);return}function Zc(){var a=0;k[5108]=(k[5108]|0)+1;a=iF(215)|0;if(!a)a=0;else{k[(a+4+15&-16)+-4>>2]=a;a=a+4+15&-16}k[a>>2]=3976;i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;i[a+40>>0]=1;k[a+36>>2]=0;k[a+28>>2]=0;k[a+32>>2]=0;i[a+60>>0]=1;k[a+56>>2]=0;k[a+48>>2]=0;k[a+52>>2]=0;i[a+80>>0]=1;k[a+76>>2]=0;k[a+68>>2]=0;k[a+72>>2]=0;i[a+100>>0]=1;k[a+96>>2]=0;k[a+88>>2]=0;k[a+92>>2]=0;i[a+120>>0]=1;k[a+116>>2]=0;k[a+108>>2]=0;k[a+112>>2]=0;i[a+140>>0]=1;k[a+136>>2]=0;k[a+128>>2]=0;k[a+132>>2]=0;i[a+160>>0]=1;k[a+156>>2]=0;k[a+148>>2]=0;k[a+152>>2]=0;i[a+180>>0]=1;k[a+176>>2]=0;k[a+168>>2]=0;k[a+172>>2]=0;k[a+192>>2]=0;return a|0}function _c(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function $c(a){a=a|0;return +(+o[a>>2])}function ad(a,b){a=a|0;b=+b;o[a>>2]=b;return}function bd(a){a=a|0;return k[a+4>>2]|0}function cd(a,b){a=a|0;b=b|0;k[a+4>>2]=b;return}function dd(a){a=a|0;return k[a+8>>2]|0}function ed(a,b){a=a|0;b=b|0;k[a+8>>2]=b;return}function fd(a){a=a|0;return +(+o[a+12>>2])}function gd(a,b){a=a|0;b=+b;o[a+12>>2]=b;return}function hd(a){a=a|0;return (i[a+16>>0]&1)!=0|0}function id(a,b){a=a|0;b=b|0;i[a+16>>0]=b&1;return}function jd(a){a=a|0;return (i[a+24>>0]&1)!=0|0}function kd(a,b){a=a|0;b=b|0;i[a+24>>0]=b&1;return}function ld(a){a=a|0;return (i[a+25>>0]&1)!=0|0}function md(a,b){a=a|0;b=b|0;i[a+25>>0]=b&1;return}function nd(a){a=a|0;return (i[a+26>>0]&1)!=0|0}function od(a,b){a=a|0;b=b|0;i[a+26>>0]=b&1;return}function pd(a){a=a|0;return +(+o[a+28>>2])}function qd(a,b){a=a|0;b=+b;o[a+28>>2]=b;return}function rd(a){a=a|0;return (i[a+32>>0]&1)!=0|0}function sd(a,b){a=a|0;b=b|0;i[a+32>>0]=b&1;return}function td(a){a=a|0;return +(+o[a+36>>2])}function ud(a,b){a=a|0;b=+b;o[a+36>>2]=b;return}function vd(a){a=a|0;if(!a)return;jF(a);return}function wd(a,b){a=+a;b=+b;var c=0;k[5108]=(k[5108]|0)+1;c=iF(75)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}k[c+8>>2]=0;o[c+12>>2]=1.0;o[c+16>>2]=1.0;o[c+20>>2]=1.0;o[c+24>>2]=0.0;o[c+44>>2]=.03999999910593033;k[c>>2]=14096;k[c+4>>2]=10;k[c+52>>2]=1;o[c+28>>2]=a;o[c+32>>2]=b*.5;o[c+36>>2]=a;o[c+40>>2]=0.0;return c|0}function xd(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function yd(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function zd(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Ad(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Bd(a,b){a=a|0;b=b|0;var c=0;k[5108]=(k[5108]|0)+1;c=iF(135)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}av(c,a,b,16384,0,0);return c|0}function Cd(a,b,c){a=a|0;b=b|0;c=c|0;var d=0;k[5108]=(k[5108]|0)+1;d=iF(135)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}av(d,a,b,c&65535,0,0);return d|0}function Dd(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;k[5108]=(k[5108]|0)+1;e=iF(135)|0;if(!e)e=0;else{k[(e+4+15&-16)+-4>>2]=e;e=e+4+15&-16}av(e,a,b,c&65535,d,0);return e|0}function Ed(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0;k[5108]=(k[5108]|0)+1;f=iF(135)|0;if(!f)f=0;else{k[(f+4+15&-16)+-4>>2]=f;f=f+4+15&-16}av(f,a,b,c&65535,d,e);return f|0}function Fd(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Gd(){var a=0,b=0,c=0;k[5108]=(k[5108]|0)+1;a=iF(307)|0;if(!a)b=0;else{k[(a+4+15&-16)+-4>>2]=a;b=a+4+15&-16}o[b+164>>2]=1.0;o[b+168>>2]=1.0;o[b+172>>2]=1.0;o[b+176>>2]=0.0;k[b+180>>2]=0;o[b+184>>2]=999999984306749440.0;a=b+188|0;k[a>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;k[b+204>>2]=1;k[b+208>>2]=-1;k[b+212>>2]=-1;k[b+216>>2]=1;o[b+220>>2]=0.0;o[b+224>>2]=.5;o[b+228>>2]=0.0;o[b+232>>2]=0.0;k[b+240>>2]=0;o[b+244>>2]=1.0;a=b+248|0;k[a>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;o[b+4>>2]=1.0;a=b+8|0;k[a>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;o[b+24>>2]=1.0;a=b+28|0;k[a>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;o[b+44>>2]=1.0;a=b+48|0;k[a>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;k[a+16>>2]=0;i[b+280>>0]=1;k[b+276>>2]=0;k[b+268>>2]=0;k[b+272>>2]=0;k[b+236>>2]=4;k[b>>2]=5464;k[5108]=(k[5108]|0)+1;a=iF(95)|0;if(!a){c=0;a=b+284|0;k[a>>2]=c;return b|0}k[(a+4+15&-16)+-4>>2]=a;if(!(a+4+15&-16)){a=0;c=b+284|0;k[c>>2]=a;return b|0}bv(a+4+15&-16);a=a+4+15&-16;c=b+284|0;k[c>>2]=a;return b|0}function Hd(a,b,c){a=a|0;b=b|0;c=c|0;k[a+164>>2]=k[b>>2];k[a+164+4>>2]=k[b+4>>2];k[a+164+8>>2]=k[b+8>>2];k[a+164+12>>2]=k[b+12>>2];if((!(+o[b>>2]!=1.0)?!(+o[b+4>>2]!=1.0):0)?!(+o[b+8>>2]!=1.0):0){c=0;a=a+180|0;k[a>>2]=c;return}a=a+180|0;k[a>>2]=c;return}function Id(a){a=a|0;return k[a+192>>2]|0}function Jd(a,b){a=a|0;b=+b;o[a+184>>2]=b;return}function Kd(a,b){a=a|0;b=b|0;if((k[a+216>>2]&-2|0)==4)return;k[a+216>>2]=b;return}function Ld(a,b){a=a|0;b=b|0;k[a+216>>2]=b;return}function Md(a){a=a|0;if(k[a+204>>2]&3)return;if((k[a+216>>2]&-2|0)!=4)k[a+216>>2]=1;o[a+220>>2]=0.0;return}function Nd(a,b){a=a|0;b=b|0;if(!b?(k[a+204>>2]&3|0)!=0:0)return;if((k[a+216>>2]&-2|0)!=4)k[a+216>>2]=1;o[a+220>>2]=0.0;return}function Od(a){a=a|0;a=k[a+216>>2]|0;return ((a|0)==2?0:(a|0)!=5)|0}function Pd(a){a=a|0;return (k[a+204>>2]&2|0)!=0|0}function Qd(a,b){a=a|0;b=+b;k[a+260>>2]=(k[a+260>>2]|0)+1;o[a+228>>2]=b;return}function Rd(a,b){a=a|0;b=+b;k[a+260>>2]=(k[a+260>>2]|0)+1;o[a+224>>2]=b;return}function Sd(a,b){a=a|0;b=+b;k[a+260>>2]=(k[a+260>>2]|0)+1;o[a+232>>2]=b;return}function Td(a){a=a|0;return a+4|0}function Ud(a){a=a|0;return k[a+204>>2]|0}function Vd(a,b){a=a|0;b=b|0;k[a+204>>2]=b;return}function Wd(a,b){a=a|0;b=b|0;k[a+260>>2]=(k[a+260>>2]|0)+1;k[a+4>>2]=k[b>>2];k[a+4+4>>2]=k[b+4>>2];k[a+4+8>>2]=k[b+8>>2];k[a+4+12>>2]=k[b+12>>2];k[a+20>>2]=k[b+16>>2];k[a+20+4>>2]=k[b+16+4>>2];k[a+20+8>>2]=k[b+16+8>>2];k[a+20+12>>2]=k[b+16+12>>2];k[a+36>>2]=k[b+32>>2];k[a+36+4>>2]=k[b+32+4>>2];k[a+36+8>>2]=k[b+32+8>>2];k[a+36+12>>2]=k[b+32+12>>2];k[a+52>>2]=k[b+48>>2];k[a+52+4>>2]=k[b+48+4>>2];k[a+52+8>>2]=k[b+48+8>>2];k[a+52+12>>2]=k[b+48+12>>2];return}function Xd(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+12>>2]&127](a,b);return}function Yd(a,b){a=a|0;b=+b;o[a+252>>2]=b;return}function Zd(a,b){a=a|0;b=+b;o[a+248>>2]=b;return}function _d(a){a=a|0;return k[a+268>>2]|0}function $d(a,b){a=a|0;b=b|0;return k[(k[a+276>>2]|0)+(b<<2)>>2]|0}function ae(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+8>>2]&255](a);return}function be(a,b,c){a=+a;b=b|0;c=c|0;var d=0,e=0;while(1){d=iF(140)|0;if(d){e=6;break}d=k[5230]|0;k[5230]=d+0;if(!d){e=5;break}zc[d&3]()}if((e|0)==5){c=Gb(4)|0;k[c>>2]=20816;Eb(c|0,20864,207)}else if((e|0)==6){o[d>>2]=a;k[d+4>>2]=b;k[d+72>>2]=c;k[d+76>>2]=0;k[d+76+4>>2]=0;k[d+76+8>>2]=0;k[d+76+12>>2]=0;k[d+76+16>>2]=0;k[d+76+20>>2]=0;o[d+100>>2]=.5;o[d+104>>2]=0.0;o[d+108>>2]=0.0;o[d+112>>2]=.800000011920929;o[d+116>>2]=1.0;i[d+120>>0]=0;o[d+124>>2]=.004999999888241291;o[d+128>>2]=.009999999776482582;o[d+132>>2]=.009999999776482582;o[d+136>>2]=.009999999776482582;Pw(d+8|0);return d|0}return 0}function ce(a,b,c,d){a=+a;b=b|0;c=c|0;d=d|0;var e=0,f=0;while(1){e=iF(140)|0;if(e){f=6;break}e=k[5230]|0;k[5230]=e+0;if(!e){f=5;break}zc[e&3]()}if((f|0)==5){c=Gb(4)|0;k[c>>2]=20816;Eb(c|0,20864,207)}else if((f|0)==6){o[e>>2]=a;k[e+4>>2]=b;k[e+72>>2]=c;k[e+76>>2]=k[d>>2];k[e+76+4>>2]=k[d+4>>2];k[e+76+8>>2]=k[d+8>>2];k[e+76+12>>2]=k[d+12>>2];o[e+92>>2]=0.0;o[e+96>>2]=0.0;o[e+100>>2]=.5;o[e+104>>2]=0.0;o[e+108>>2]=0.0;o[e+112>>2]=.800000011920929;o[e+116>>2]=1.0;i[e+120>>0]=0;o[e+124>>2]=.004999999888241291;o[e+128>>2]=.009999999776482582;o[e+132>>2]=.009999999776482582;o[e+136>>2]=.009999999776482582;Pw(e+8|0);return e|0}return 0}function de(a){a=a|0;return +(+o[a+92>>2])}function ee(a,b){a=a|0;b=+b;o[a+92>>2]=b;return}function fe(a){a=a|0;return +(+o[a+96>>2])}function ge(a,b){a=a|0;b=+b;o[a+96>>2]=b;return}function he(a){a=a|0;return +(+o[a+100>>2])}function ie(a,b){a=a|0;b=+b;o[a+100>>2]=b;return}function je(a){a=a|0;return +(+o[a+104>>2])}function ke(a,b){a=a|0;b=+b;o[a+104>>2]=b;return}function le(a){a=a|0;return +(+o[a+108>>2])}function me(a,b){a=a|0;b=+b;o[a+108>>2]=b;return}function ne(a){a=a|0;return +(+o[a+112>>2])}function oe(a,b){a=a|0;b=+b;o[a+112>>2]=b;return}function pe(a){a=a|0;return +(+o[a+116>>2])}function qe(a,b){a=a|0;b=+b;o[a+116>>2]=b;return}function re(a){a=a|0;return (i[a+120>>0]&1)!=0|0}function se(a,b){a=a|0;b=b|0;i[a+120>>0]=b&1;return}function te(a){a=a|0;return +(+o[a+124>>2])}function ue(a,b){a=a|0;b=+b;o[a+124>>2]=b;return}function ve(a){a=a|0;return +(+o[a+128>>2])}function we(a,b){a=a|0;b=+b;o[a+128>>2]=b;return}function xe(a){a=a|0;return +(+o[a+132>>2])}function ye(a,b){a=a|0;b=+b;o[a+132>>2]=b;return}function ze(a){a=a|0;return +(+o[a+136>>2])}function Ae(a,b){a=a|0;b=+b;o[a+136>>2]=b;return}function Be(a){a=a|0;if(!a)return;jF(a);return}function Ce(a){a=a|0;return a+48|0}function De(a){a=a|0;return a+32|0}function Ee(a){a=a|0;return +(+o[a+80>>2])}function Fe(a){a=a|0;return a|0}function Ge(a,b){a=a|0;b=b|0;k[a>>2]=k[b>>2];k[a+4>>2]=k[b+4>>2];k[a+8>>2]=k[b+8>>2];k[a+12>>2]=k[b+12>>2];return}function He(a){a=a|0;return a+16|0}function Ie(a,b){a=a|0;b=b|0;k[a+16>>2]=k[b>>2];k[a+16+4>>2]=k[b+4>>2];k[a+16+8>>2]=k[b+8>>2];k[a+16+12>>2]=k[b+12>>2];return}function Je(a){a=a|0;return a+32|0}function Ke(a,b){a=a|0;b=b|0;k[a+32>>2]=k[b>>2];k[a+32+4>>2]=k[b+4>>2];k[a+32+8>>2]=k[b+8>>2];k[a+32+12>>2]=k[b+12>>2];return}function Le(a){a=a|0;return a+48|0}function Me(a,b){a=a|0;b=b|0;k[a+48>>2]=k[b>>2];k[a+48+4>>2]=k[b+4>>2];k[a+48+8>>2]=k[b+8>>2];k[a+48+12>>2]=k[b+12>>2];return}function Ne(a){a=a|0;return a+64|0}function Oe(a,b){a=a|0;b=b|0;k[a+64>>2]=k[b>>2];k[a+64+4>>2]=k[b+4>>2];k[a+64+8>>2]=k[b+8>>2];k[a+64+12>>2]=k[b+12>>2];return}function Pe(a){a=a|0;if(!a)return;jF(a);return}function Qe(a,b,c){a=a|0;b=b|0;c=c|0;var d=0;k[5108]=(k[5108]|0)+1;d=iF(1331)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}Pp(d,a,b,c);return d|0}function Re(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0;k[5108]=(k[5108]|0)+1;f=iF(1331)|0;if(!f)f=0;else{k[(f+4+15&-16)+-4>>2]=f;f=f+4+15&-16}Op(f,a,b,c,d,e);return f|0}function Se(a,b){a=a|0;b=b|0;k[a+680>>2]=k[b>>2];k[a+680+4>>2]=k[b+4>>2];k[a+680+8>>2]=k[b+8>>2];k[a+680+12>>2]=k[b+12>>2];return}function Te(a,b){a=a|0;b=b|0;k[a+696>>2]=k[b>>2];k[a+696+4>>2]=k[b+4>>2];k[a+696+8>>2]=k[b+8>>2];k[a+696+12>>2]=k[b+12>>2];return}function Ue(a,b){a=a|0;b=b|0;var c=0.0,d=0;d=0;while(1){if((d|0)==3)break;c=+kF(+o[b+(d<<2)>>2],6.2831854820251465);if(!(c<-3.1415927410125732)){if(c>3.1415927410125732)c=c+-6.2831854820251465}else c=c+6.2831854820251465;o[a+868+(d<<6)>>2]=c;d=d+1|0}return}function Ve(a,b){a=a|0;b=b|0;var c=0.0,d=0;d=0;while(1){if((d|0)==3)break;c=+kF(+o[b+(d<<2)>>2],6.2831854820251465);if(!(c<-3.1415927410125732)){if(c>3.1415927410125732)c=c+-6.2831854820251465}else c=c+6.2831854820251465;o[a+868+(d<<6)+4>>2]=c;d=d+1|0}return}function We(a,b){a=a|0;b=b|0;i[a+21>>0]=b&1;return}function Xe(a){a=a|0;return +(+o[a+16>>2])}function Ye(a,b){a=a|0;b=+b;o[a+16>>2]=b;return}function Ze(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function _e(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function $e(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function af(a,b,c){a=a|0;b=b|0;c=c|0;k[a+164>>2]=k[b>>2];k[a+164+4>>2]=k[b+4>>2];k[a+164+8>>2]=k[b+8>>2];k[a+164+12>>2]=k[b+12>>2];if((!(+o[b>>2]!=1.0)?!(+o[b+4>>2]!=1.0):0)?!(+o[b+8>>2]!=1.0):0){c=0;a=a+180|0;k[a>>2]=c;return}a=a+180|0;k[a>>2]=c;return}function bf(a){a=a|0;return k[a+192>>2]|0}function cf(a,b){a=a|0;b=+b;o[a+184>>2]=b;return}function df(a,b){a=a|0;b=b|0;if((k[a+216>>2]&-2|0)==4)return;k[a+216>>2]=b;return}function ef(a,b){a=a|0;b=b|0;k[a+216>>2]=b;return}function ff(a){a=a|0;if(k[a+204>>2]&3)return;if((k[a+216>>2]&-2|0)!=4)k[a+216>>2]=1;o[a+220>>2]=0.0;return}function gf(a,b){a=a|0;b=b|0;if(!b?(k[a+204>>2]&3|0)!=0:0)return;if((k[a+216>>2]&-2|0)!=4)k[a+216>>2]=1;o[a+220>>2]=0.0;return}function hf(a){a=a|0;a=k[a+216>>2]|0;return ((a|0)==2?0:(a|0)!=5)|0}function jf(a){a=a|0;return (k[a+204>>2]&2|0)!=0|0}function kf(a,b){a=a|0;b=+b;k[a+260>>2]=(k[a+260>>2]|0)+1;o[a+228>>2]=b;return}function lf(a,b){a=a|0;b=+b;k[a+260>>2]=(k[a+260>>2]|0)+1;o[a+224>>2]=b;return}function mf(a,b){a=a|0;b=+b;k[a+260>>2]=(k[a+260>>2]|0)+1;o[a+232>>2]=b;return}function nf(a){a=a|0;return a+4|0}function of(a){a=a|0;return k[a+204>>2]|0}function pf(a,b){a=a|0;b=b|0;k[a+204>>2]=b;return}function qf(a,b){a=a|0;b=b|0;k[a+260>>2]=(k[a+260>>2]|0)+1;k[a+4>>2]=k[b>>2];k[a+4+4>>2]=k[b+4>>2];k[a+4+8>>2]=k[b+8>>2];k[a+4+12>>2]=k[b+12>>2];k[a+20>>2]=k[b+16>>2];k[a+20+4>>2]=k[b+16+4>>2];k[a+20+8>>2]=k[b+16+8>>2];k[a+20+12>>2]=k[b+16+12>>2];k[a+36>>2]=k[b+32>>2];k[a+36+4>>2]=k[b+32+4>>2];k[a+36+8>>2]=k[b+32+8>>2];k[a+36+12>>2]=k[b+32+12>>2];k[a+52>>2]=k[b+48>>2];k[a+52+4>>2]=k[b+48+4>>2];k[a+52+8>>2]=k[b+48+8>>2];k[a+52+12>>2]=k[b+48+12>>2];return}function rf(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+12>>2]&127](a,b);return}function sf(a,b){a=a|0;b=+b;o[a+252>>2]=b;return}function tf(a,b){a=a|0;b=+b;o[a+248>>2]=b;return}function uf(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+8>>2]&255](a);return}function vf(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0;k[5108]=(k[5108]|0)+1;d=iF(343)|0;if(!d)h=0;else{k[(d+4+15&-16)+-4>>2]=d;h=d+4+15&-16}i[h+20>>0]=1;k[h+16>>2]=0;k[h+8>>2]=0;k[h+12>>2]=0;k[h+24>>2]=a;o[h+28>>2]=0.0;k[h+32>>2]=0;k[h+36>>2]=1;o[h+40>>2]=1.0;i[h+44>>0]=1;k[h+48>>2]=0;i[h+52>>0]=0;i[h+53>>0]=1;i[h+54>>0]=1;o[h+56>>2]=.03999999910593033;i[h+60>>0]=0;o[h+64>>2]=0.0;k[h+68>>2]=b;k[h+72>>2]=0;i[h+76>>0]=1;k[h+80>>2]=0;k[h+84>>2]=0;k[h+88>>2]=0;o[h+92>>2]=.6000000238418579;o[h+96>>2]=1.0;o[h+100>>2]=.30000001192092896;o[h+104>>2]=.01666666753590107;o[h+108>>2]=0.0;o[h+116>>2]=20.0;k[h+112>>2]=10;o[h+124>>2]=.20000000298023224;o[h+128>>2]=.800000011920929;o[h+132>>2]=0.0;o[h+120>>2]=1.0;k[h+136>>2]=1;o[h+140>>2]=-.03999999910593033;o[h+144>>2]=.10000000149011612;o[h+148>>2]=0.0;o[h+152>>2]=.8500000238418579;k[h+156>>2]=260;k[h+160>>2]=2;k[h+164>>2]=128;o[h+168>>2]=100.0;o[h+172>>2]=1000000015047466219876688.0e6;k[h>>2]=1568;i[h+192>>0]=1;k[h+188>>2]=0;k[h+180>>2]=0;k[h+184>>2]=0;f=h+196|0;k[f>>2]=0;g=h+200|0;k[g>>2]=c;i[h+224>>0]=1;k[h+220>>2]=0;k[h+212>>2]=0;k[h+216>>2]=0;i[h+244>>0]=1;k[h+240>>2]=0;k[h+232>>2]=0;k[h+236>>2]=0;o[h+248>>2]=0.0;o[h+252>>2]=-10.0;b=h+256|0;i[h+274>>0]=0;i[h+275>>0]=0;k[b>>2]=0;k[b+4>>2]=0;k[b+8>>2]=0;k[b+12>>2]=0;i[h+292>>0]=1;k[h+288>>2]=0;k[h+280>>2]=0;k[h+284>>2]=0;k[h+296>>2]=0;i[h+300>>0]=1;i[h+320>>0]=1;k[h+316>>2]=0;k[h+308>>2]=0;k[h+312>>2]=0;if(!c){k[5108]=(k[5108]|0)+1;b=iF(215)|0;if(!b)b=0;else{k[(b+4+15&-16)+-4>>2]=b;b=b+4+15&-16}k[b>>2]=3976;i[b+20>>0]=1;k[b+16>>2]=0;k[b+8>>2]=0;k[b+12>>2]=0;i[b+40>>0]=1;k[b+36>>2]=0;k[b+28>>2]=0;k[b+32>>2]=0;i[b+60>>0]=1;k[b+56>>2]=0;k[b+48>>2]=0;k[b+52>>2]=0;i[b+80>>0]=1;k[b+76>>2]=0;k[b+68>>2]=0;k[b+72>>2]=0;i[b+100>>0]=1;k[b+96>>2]=0;k[b+88>>2]=0;k[b+92>>2]=0;i[b+120>>0]=1;k[b+116>>2]=0;k[b+108>>2]=0;k[b+112>>2]=0;i[b+140>>0]=1;k[b+136>>2]=0;k[b+128>>2]=0;k[b+132>>2]=0;i[b+160>>0]=1;k[b+156>>2]=0;k[b+148>>2]=0;k[b+152>>2]=0;i[b+180>>0]=1;k[b+176>>2]=0;k[b+168>>2]=0;k[b+172>>2]=0;k[b+192>>2]=0;k[g>>2]=b;i[h+273>>0]=1}else i[h+273>>0]=0;k[5108]=(k[5108]|0)+1;d=iF(87)|0;if((d|0)!=0?(e=d+4+15&-16,k[e+-4>>2]=d,(d+4+15&-16|0)!=0):0){k[(d+4+15&-16)>>2]=6920;i[e+20>>0]=1;k[e+16>>2]=0;k[e+8>>2]=0;k[e+12>>2]=0;i[e+40>>0]=1;k[e+36>>2]=0;k[e+28>>2]=0;k[e+32>>2]=0;i[e+60>>0]=1;k[e+56>>2]=0;k[e+48>>2]=0;k[e+52>>2]=0;i[e+64>>0]=1;d=d+4+15&-16}else d=0;k[h+204>>2]=d;i[h+272>>0]=1;k[5108]=(k[5108]|0)+1;d=iF(107)|0;if(!d){a=0;k[f>>2]=a;return h|0}b=d+4+15&-16;k[b+-4>>2]=d;if(!(d+4+15&-16)){a=0;k[f>>2]=a;return h|0}g=k[g>>2]|0;k[(d+4+15&-16)>>2]=2376;k[b+4>>2]=0;k[b+8>>2]=g;k[b+12>>2]=0;k[b+16>>2]=0;k[b+20>>2]=0;k[b+24>>2]=a;i[b+44>>0]=1;k[b+40>>2]=0;k[b+32>>2]=0;k[b+36>>2]=0;i[b+64>>0]=1;k[b+60>>2]=0;k[b+52>>2]=0;k[b+56>>2]=0;i[b+84>>0]=1;k[b+80>>2]=0;k[b+72>>2]=0;k[b+76>>2]=0;a=d+4+15&-16;k[f>>2]=a;return h|0}function wf(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+72>>2]&127](a,b);return}function xf(a){a=a|0;var b=0;b=r;r=r+16|0;if((i[24]|0)==0?(db(24)|0)!=0:0)ib(24);Ub[k[(k[a>>2]|0)+76>>2]&127](b,a);k[2]=k[b>>2];k[3]=k[b+4>>2];k[4]=k[b+8>>2];k[5]=k[b+12>>2];r=b;return 8}function yf(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+84>>2]&127](a,b);return}function zf(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;Cc[k[(k[a>>2]|0)+88>>2]&127](a,b,c,d);return}function Af(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+92>>2]&127](a,b);return}function Bf(a,b){a=a|0;b=b|0;yc[k[(k[a>>2]|0)+56>>2]&127](a,b,0);return}function Cf(a,b,c){a=a|0;b=b|0;c=c|0;yc[k[(k[a>>2]|0)+56>>2]&127](a,b,c);return}function Df(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+60>>2]&127](a,b);return}function Ef(a,b){a=a|0;b=+b;return Bc[k[(k[a>>2]|0)+52>>2]&1](a,b,1,.01666666753590107)|0}function Ff(a,b,c){a=a|0;b=+b;c=c|0;return Bc[k[(k[a>>2]|0)+52>>2]&1](a,b,c,.01666666753590107)|0}function Gf(a,b,c,d){a=a|0;b=+b;c=c|0;d=+d;return Bc[k[(k[a>>2]|0)+52>>2]&1](a,b,c,d)|0}function Hf(a){a=a|0;return k[a+24>>2]|0}function If(a){a=a|0;Sb[k[(k[a>>2]|0)+12>>2]&255](a);return}function Jf(a){a=a|0;Sb[k[(k[a>>2]|0)+44>>2]&255](a);return}function Kf(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;Cc[k[(k[a>>2]|0)+32>>2]&127](a,b,c,d);return}function Lf(a){a=a|0;a=k[a+68>>2]|0;return Wb[k[(k[a>>2]|0)+36>>2]&127](a)|0}function Mf(a){a=a|0;return a+28|0}function Nf(a,b){a=a|0;b=b|0;Cc[k[(k[a>>2]|0)+36>>2]&127](a,b,2,-3);return}function Of(a,b,c){a=a|0;b=b|0;c=c|0;Cc[k[(k[a>>2]|0)+36>>2]&127](a,b,c,-3);return}function Pf(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;Cc[k[(k[a>>2]|0)+36>>2]&127](a,b,c,d);return}function Qf(a){a=a|0;return k[a+68>>2]|0}function Rf(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=+f;ws(a,b,c,d,e,f);return}function Sf(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;xs(a,b,c,d);return}function Tf(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+64>>2]&127](a,b);return}function Uf(a){a=a|0;var b=0,c=0;if((i[120]|0)==0?(db(120)|0)!=0:0){o[8]=.6000000238418579;o[9]=1.0;o[10]=.30000001192092896;o[11]=.01666666753590107;o[12]=0.0;o[14]=20.0;k[13]=10;o[16]=.20000000298023224;o[17]=.800000011920929;o[18]=0.0;o[15]=1.0;k[19]=1;o[20]=-.03999999910593033;o[21]=.10000000149011612;o[22]=0.0;o[23]=.8500000238418579;k[24]=260;k[25]=2;k[26]=128;o[27]=100.0;o[28]=1000000015047466219876688.0e6;ib(120)}c=32;a=a+92|0;b=c+84|0;do{k[c>>2]=k[a>>2];c=c+4|0;a=a+4|0}while((c|0)<(b|0));return 32}function Vf(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Wf(a){a=a|0;var b=0;k[5108]=(k[5108]|0)+1;b=iF(115)|0;if(!b)b=0;else{k[(b+4+15&-16)+-4>>2]=b;b=b+4+15&-16}k[b+8>>2]=0;o[b+12>>2]=1.0;o[b+16>>2]=1.0;o[b+20>>2]=1.0;o[b+24>>2]=0.0;o[b+44>>2]=.03999999910593033;k[b+52>>2]=0;o[b+56>>2]=1.0;o[b+60>>2]=1.0;o[b+64>>2]=1.0;o[b+68>>2]=0.0;o[b+72>>2]=-1.0;o[b+76>>2]=-1.0;o[b+80>>2]=-1.0;o[b+84>>2]=0.0;i[b+88>>0]=0;k[b>>2]=14600;k[b+92>>2]=a;k[b+4>>2]=3;Qt(b);return b|0}function Xf(a,b){a=a|0;b=b|0;var c=0;k[5108]=(k[5108]|0)+1;c=iF(115)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}k[c+8>>2]=0;o[c+12>>2]=1.0;o[c+16>>2]=1.0;o[c+20>>2]=1.0;o[c+24>>2]=0.0;o[c+44>>2]=.03999999910593033;k[c+52>>2]=0;o[c+56>>2]=1.0;o[c+60>>2]=1.0;o[c+64>>2]=1.0;o[c+68>>2]=0.0;o[c+72>>2]=-1.0;o[c+76>>2]=-1.0;o[c+80>>2]=-1.0;o[c+84>>2]=0.0;i[c+88>>0]=0;k[c>>2]=14600;k[c+92>>2]=a;k[c+4>>2]=3;if(!b)return c|0;Qt(c);return c|0}function Yf(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function Zf(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function _f(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function $f(a){a=a|0;return +o[a+4>>2]<1.0|0}function ag(a){a=a|0;return j[a+8>>1]|0}function bg(a,b){a=a|0;b=b|0;j[a+8>>1]=b;return}function cg(a){a=a|0;return j[a+10>>1]|0}function dg(a,b){a=a|0;b=b|0;j[a+10>>1]=b;return}function eg(a){a=a|0;return +(+o[a+4>>2])}function fg(a,b){a=a|0;b=+b;o[a+4>>2]=b;return}function gg(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function hg(a,b){a=a|0;b=b|0;var c=0,d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,j=0;k[5108]=(k[5108]|0)+1;c=iF(379)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}k[c+4>>2]=3;k[c>>2]=256;k[c+8>>2]=-1;k[c+12>>2]=-1;o[c+16>>2]=3402823466385288598117041.0e14;i[c+20>>0]=1;i[c+21>>0]=0;k[c+24>>2]=-1;k[c+28>>2]=a;eq();k[c+32>>2]=2960;o[c+36>>2]=0.0;o[c+40>>2]=.30000001192092896;k[c+44>>2]=0;k[c>>2]=2792;j=c+300|0;k[j>>2]=k[b>>2];k[j+4>>2]=k[b+4>>2];k[j+8>>2]=k[b+8>>2];k[j+12>>2]=k[b+12>>2];h=+o[b>>2];g=+o[b+4>>2];f=+o[b+8>>2];e=h*+o[a+20>>2]+g*+o[a+24>>2]+f*+o[a+28>>2]+ +o[a+56>>2];d=h*+o[a+36>>2]+g*+o[a+40>>2]+f*+o[a+44>>2]+ +o[a+60>>2];o[c+316>>2]=h*+o[a+4>>2]+g*+o[a+8>>2]+f*+o[a+12>>2]+ +o[a+52>>2];o[c+320>>2]=e;o[c+324>>2]=d;o[c+328>>2]=0.0;k[c+332>>2]=0;i[c+344>>0]=0;o[c+348>>2]=.30000001192092896;o[c+352>>2]=1.0;o[c+356>>2]=0.0;return c|0}function ig(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;k[5108]=(k[5108]|0)+1;e=iF(379)|0;if(!e)e=0;else{k[(e+4+15&-16)+-4>>2]=e;e=e+4+15&-16}k[e+4>>2]=3;k[e+8>>2]=-1;k[e+12>>2]=-1;o[e+16>>2]=3402823466385288598117041.0e14;i[e+20>>0]=1;i[e+21>>0]=0;k[e+24>>2]=-1;k[e+28>>2]=a;k[e+32>>2]=b;o[e+36>>2]=0.0;o[e+40>>2]=.30000001192092896;k[e+44>>2]=0;k[e>>2]=2792;b=e+300|0;k[b>>2]=k[c>>2];k[b+4>>2]=k[c+4>>2];k[b+8>>2]=k[c+8>>2];k[b+12>>2]=k[c+12>>2];c=e+316|0;k[c>>2]=k[d>>2];k[c+4>>2]=k[d+4>>2];k[c+8>>2]=k[d+8>>2];k[c+12>>2]=k[d+12>>2];k[e+332>>2]=0;i[e+344>>0]=0;o[e+348>>2]=.30000001192092896;o[e+352>>2]=1.0;o[e+356>>2]=0.0;return e|0}function jg(a,b){a=a|0;b=b|0;k[a+300>>2]=k[b>>2];k[a+300+4>>2]=k[b+4>>2];k[a+300+8>>2]=k[b+8>>2];k[a+300+12>>2]=k[b+12>>2];return}function kg(a,b){a=a|0;b=b|0;k[a+316>>2]=k[b>>2];k[a+316+4>>2]=k[b+4>>2];k[a+316+8>>2]=k[b+8>>2];k[a+316+12>>2]=k[b+12>>2];return}function lg(a){a=a|0;return a+300|0}function mg(a){a=a|0;return a+316|0}function ng(a,b){a=a|0;b=b|0;i[a+21>>0]=b&1;return}function og(a){a=a|0;return +(+o[a+16>>2])}function pg(a,b){a=a|0;b=+b;o[a+16>>2]=b;return}function qg(a){a=a|0;return a+348|0}function rg(a,b){a=a|0;b=b|0;k[a+348>>2]=k[b>>2];k[a+348+4>>2]=k[b+4>>2];k[a+348+8>>2]=k[b+8>>2];return}function sg(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function tg(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+8>>2]&127](a,b);return}function ug(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+12>>2]&127](a,b);return}function vg(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function wg(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,j=0;e=r;r=r+64|0;k[5108]=(k[5108]|0)+1;d=iF(1147)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}eq();k[d+4>>2]=7;k[d+8>>2]=-1;k[d+12>>2]=-1;o[d+16>>2]=3402823466385288598117041.0e14;i[d+20>>0]=1;i[d+21>>0]=0;k[d+24>>2]=-1;g=d+28|0;k[g>>2]=2960;f=d+32|0;k[f>>2]=a;o[d+36>>2]=0.0;o[d+40>>2]=.30000001192092896;k[d+44>>2]=0;k[d>>2]=3592;i[d+48>>0]=0;h=d+116|0;k[h>>2]=k[b>>2];k[h+4>>2]=k[b+4>>2];k[h+8>>2]=k[b+8>>2];k[h+12>>2]=k[b+12>>2];j=d+132|0;k[j>>2]=k[b+16>>2];k[j+4>>2]=k[b+16+4>>2];k[j+8>>2]=k[b+16+8>>2];k[j+12>>2]=k[b+16+12>>2];j=d+148|0;k[j>>2]=k[b+32>>2];k[j+4>>2]=k[b+32+4>>2];k[j+8>>2]=k[b+32+8>>2];k[j+12>>2]=k[b+32+12>>2];j=d+164|0;k[j>>2]=k[b+48>>2];k[j+4>>2]=k[b+48+4>>2];k[j+8>>2]=k[b+48+8>>2];k[j+12>>2]=k[b+48+12>>2];i[d+180>>0]=c&1;c=d+52|0;Sw(e,a+4|0,h);k[c>>2]=k[e>>2];k[c+4>>2]=k[e+4>>2];k[c+8>>2]=k[e+8>>2];k[c+12>>2]=k[e+12>>2];c=d+68|0;k[c>>2]=k[e+16>>2];k[c+4>>2]=k[e+16+4>>2];k[c+8>>2]=k[e+16+8>>2];k[c+12>>2]=k[e+16+12>>2];c=d+84|0;k[c>>2]=k[e+32>>2];k[c+4>>2]=k[e+32+4>>2];k[c+8>>2]=k[e+32+8>>2];k[c+12>>2]=k[e+32+12>>2];c=d+100|0;k[c>>2]=k[e+48>>2];k[c+4>>2]=k[e+48+4>>2];k[c+8>>2]=k[e+48+8>>2];k[c+12>>2]=k[e+48+12>>2];o[d+184>>2]=1.0;o[d+188>>2]=-1.0;o[d+192>>2]=0.0;o[d+196>>2]=0.0;o[d+200>>2]=1.0;o[d+204>>2]=.699999988079071;o[d+208>>2]=0.0;o[d+212>>2]=0.0;o[d+216>>2]=1.0;o[d+220>>2]=.699999988079071;o[d+224>>2]=0.0;o[d+228>>2]=0.0;o[d+264>>2]=1.0;o[d+268>>2]=.699999988079071;o[d+272>>2]=1.0;o[d+276>>2]=0.0;o[d+280>>2]=1.0;o[d+284>>2]=.699999988079071;o[d+288>>2]=1.0;o[d+292>>2]=0.0;o[d+232>>2]=1.0;o[d+236>>2]=.699999988079071;o[d+240>>2]=1.0;o[d+244>>2]=0.0;o[d+248>>2]=1.0;o[d+252>>2]=.699999988079071;o[d+256>>2]=1.0;o[d+260>>2]=0.0;i[d+1096>>0]=0;c=d+1100|0;o[d+1116>>2]=0.0;o[d+1120>>2]=0.0;o[d+1124>>2]=0.0;k[d+300>>2]=0;k[c>>2]=0;k[c+4>>2]=0;k[c+8>>2]=0;i[c+12>>0]=0;i[d+49>>0]=1;gq(d,(k[g>>2]|0)+4|0,(k[f>>2]|0)+4|0);r=e;return d|0}function xg(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0,g=0;k[5108]=(k[5108]|0)+1;f=iF(1147)|0;if(!f)f=0;else{k[(f+4+15&-16)+-4>>2]=f;f=f+4+15&-16}k[f+4>>2]=7;k[f+8>>2]=-1;k[f+12>>2]=-1;o[f+16>>2]=3402823466385288598117041.0e14;i[f+20>>0]=1;i[f+21>>0]=0;k[f+24>>2]=-1;g=f+28|0;k[g>>2]=a;a=f+32|0;k[a>>2]=b;o[f+36>>2]=0.0;o[f+40>>2]=.30000001192092896;k[f+44>>2]=0;k[f>>2]=3592;i[f+48>>0]=0;b=f+52|0;k[b>>2]=k[c>>2];k[b+4>>2]=k[c+4>>2];k[b+8>>2]=k[c+8>>2];k[b+12>>2]=k[c+12>>2];b=f+68|0;k[b>>2]=k[c+16>>2];k[b+4>>2]=k[c+16+4>>2];k[b+8>>2]=k[c+16+8>>2];k[b+12>>2]=k[c+16+12>>2];b=f+84|0;k[b>>2]=k[c+32>>2];k[b+4>>2]=k[c+32+4>>2];k[b+8>>2]=k[c+32+8>>2];k[b+12>>2]=k[c+32+12>>2];b=f+100|0;k[b>>2]=k[c+48>>2];k[b+4>>2]=k[c+48+4>>2];k[b+8>>2]=k[c+48+8>>2];k[b+12>>2]=k[c+48+12>>2];c=f+116|0;k[c>>2]=k[d>>2];k[c+4>>2]=k[d+4>>2];k[c+8>>2]=k[d+8>>2];k[c+12>>2]=k[d+12>>2];c=f+132|0;k[c>>2]=k[d+16>>2];k[c+4>>2]=k[d+16+4>>2];k[c+8>>2]=k[d+16+8>>2];k[c+12>>2]=k[d+16+12>>2];c=f+148|0;k[c>>2]=k[d+32>>2];k[c+4>>2]=k[d+32+4>>2];k[c+8>>2]=k[d+32+8>>2];k[c+12>>2]=k[d+32+12>>2];c=f+164|0;k[c>>2]=k[d+48>>2];k[c+4>>2]=k[d+48+4>>2];k[c+8>>2]=k[d+48+8>>2];k[c+12>>2]=k[d+48+12>>2];i[f+180>>0]=e&1;o[f+184>>2]=1.0;o[f+188>>2]=-1.0;o[f+192>>2]=0.0;o[f+196>>2]=0.0;o[f+200>>2]=1.0;o[f+204>>2]=.699999988079071;o[f+208>>2]=0.0;o[f+212>>2]=0.0;o[f+216>>2]=1.0;o[f+220>>2]=.699999988079071;o[f+224>>2]=0.0;o[f+228>>2]=0.0;o[f+264>>2]=1.0;o[f+268>>2]=.699999988079071;o[f+272>>2]=1.0;o[f+276>>2]=0.0;o[f+280>>2]=1.0;o[f+284>>2]=.699999988079071;o[f+288>>2]=1.0;o[f+292>>2]=0.0;o[f+232>>2]=1.0;o[f+236>>2]=.699999988079071;o[f+240>>2]=1.0;o[f+244>>2]=0.0;o[f+248>>2]=1.0;o[f+252>>2]=.699999988079071;o[f+256>>2]=1.0;o[f+260>>2]=0.0;i[f+1096>>0]=0;e=f+1100|0;o[f+1116>>2]=0.0;o[f+1120>>2]=0.0;o[f+1124>>2]=0.0;k[f+300>>2]=0;k[e>>2]=0;k[e+4>>2]=0;k[e+8>>2]=0;i[e+12>>0]=0;i[f+49>>0]=1;gq(f,(k[g>>2]|0)+4|0,(k[a>>2]|0)+4|0);return f|0}function yg(a,b){a=a|0;b=+b;o[a+184>>2]=b;return}function zg(a,b){a=a|0;b=+b;o[a+188>>2]=b;return}function Ag(a,b){a=a|0;b=+b;b=+kF(b,6.2831854820251465);if(!(b<-3.1415927410125732)){if(b>3.1415927410125732)b=b+-6.2831854820251465}else b=b+6.2831854820251465;o[a+192>>2]=b;return}function Bg(a,b){a=a|0;b=+b;b=+kF(b,6.2831854820251465);if(!(b<-3.1415927410125732)){if(b>3.1415927410125732)b=b+-6.2831854820251465}else b=b+6.2831854820251465;o[a+196>>2]=b;return}function Cg(a,b){a=a|0;b=b|0;i[a+21>>0]=b&1;return}function Dg(a){a=a|0;return +(+o[a+16>>2])}function Eg(a,b){a=a|0;b=+b;o[a+16>>2]=b;return}function Fg(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Gg(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0;k[5108]=(k[5108]|0)+1;c=iF(627)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}k[c+4>>2]=5;k[c>>2]=256;k[c+8>>2]=-1;k[c+12>>2]=-1;o[c+16>>2]=3402823466385288598117041.0e14;i[c+20>>0]=1;i[c+21>>0]=0;k[c+24>>2]=-1;k[c+28>>2]=a;eq();k[c+32>>2]=2960;o[c+36>>2]=0.0;o[c+40>>2]=.30000001192092896;k[c+44>>2]=0;k[c>>2]=3712;e=c+300|0;k[e>>2]=k[b>>2];k[e+4>>2]=k[b+4>>2];k[e+8>>2]=k[b+8>>2];k[e+12>>2]=k[b+12>>2];d=c+316|0;k[d>>2]=k[b+16>>2];k[d+4>>2]=k[b+16+4>>2];k[d+8>>2]=k[b+16+8>>2];k[d+12>>2]=k[b+16+12>>2];a=c+332|0;k[a>>2]=k[b+32>>2];k[a+4>>2]=k[b+32+4>>2];k[a+8>>2]=k[b+32+8>>2];k[a+12>>2]=k[b+32+12>>2];f=c+348|0;k[f>>2]=k[b+48>>2];k[f+4>>2]=k[b+48+4>>2];k[f+8>>2]=k[b+48+8>>2];k[f+12>>2]=k[b+48+12>>2];b=c+364|0;i[c+527>>0]=0;k[b>>2]=k[e>>2];k[b+4>>2]=k[e+4>>2];k[b+8>>2]=k[e+8>>2];k[b+12>>2]=k[e+12>>2];b=c+380|0;k[b>>2]=k[d>>2];k[b+4>>2]=k[d+4>>2];k[b+8>>2]=k[d+8>>2];k[b+12>>2]=k[d+12>>2];b=c+396|0;k[b>>2]=k[a>>2];k[b+4>>2]=k[a+4>>2];k[b+8>>2]=k[a+8>>2];k[b+12>>2]=k[a+12>>2];b=c+412|0;i[c+524>>0]=0;i[c+525>>0]=0;i[c+526>>0]=0;i[c+552>>0]=0;k[b>>2]=0;k[b+4>>2]=0;k[b+8>>2]=0;k[b+12>>2]=0;o[c+572>>2]=-1.0;o[c+444>>2]=999999984306749440.0;o[c+448>>2]=999999984306749440.0;o[c+452>>2]=999999984306749440.0;o[c+428>>2]=1.0;o[c+432>>2]=.30000001192092896;o[c+436>>2]=1.0;o[c+440>>2]=.009999999776482582;o[c+456>>2]=.05000000074505806;k[c+592>>2]=0;o[c+596>>2]=0.0;o[c+600>>2]=.699999988079071;o[c+604>>2]=0.0;return c|0}function Hg(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;k[5108]=(k[5108]|0)+1;e=iF(627)|0;if(!e)e=0;else{k[(e+4+15&-16)+-4>>2]=e;e=e+4+15&-16}k[e+4>>2]=5;k[e+8>>2]=-1;k[e+12>>2]=-1;o[e+16>>2]=3402823466385288598117041.0e14;i[e+20>>0]=1;i[e+21>>0]=0;k[e+24>>2]=-1;k[e+28>>2]=a;k[e+32>>2]=b;o[e+36>>2]=0.0;o[e+40>>2]=.30000001192092896;k[e+44>>2]=0;k[e>>2]=3712;b=e+300|0;k[b>>2]=k[c>>2];k[b+4>>2]=k[c+4>>2];k[b+8>>2]=k[c+8>>2];k[b+12>>2]=k[c+12>>2];b=e+316|0;k[b>>2]=k[c+16>>2];k[b+4>>2]=k[c+16+4>>2];k[b+8>>2]=k[c+16+8>>2];k[b+12>>2]=k[c+16+12>>2];b=e+332|0;k[b>>2]=k[c+32>>2];k[b+4>>2]=k[c+32+4>>2];k[b+8>>2]=k[c+32+8>>2];k[b+12>>2]=k[c+32+12>>2];b=e+348|0;k[b>>2]=k[c+48>>2];k[b+4>>2]=k[c+48+4>>2];k[b+8>>2]=k[c+48+8>>2];k[b+12>>2]=k[c+48+12>>2];c=e+364|0;k[c>>2]=k[d>>2];k[c+4>>2]=k[d+4>>2];k[c+8>>2]=k[d+8>>2];k[c+12>>2]=k[d+12>>2];c=e+380|0;k[c>>2]=k[d+16>>2];k[c+4>>2]=k[d+16+4>>2];k[c+8>>2]=k[d+16+8>>2];k[c+12>>2]=k[d+16+12>>2];c=e+396|0;k[c>>2]=k[d+32>>2];k[c+4>>2]=k[d+32+4>>2];k[c+8>>2]=k[d+32+8>>2];k[c+12>>2]=k[d+32+12>>2];c=e+412|0;k[c>>2]=k[d+48>>2];k[c+4>>2]=k[d+48+4>>2];k[c+8>>2]=k[d+48+8>>2];k[c+12>>2]=k[d+48+12>>2];d=e+524|0;i[e+552>>0]=0;i[d>>0]=0;i[d+1>>0]=0;i[d+2>>0]=0;i[d+3>>0]=0;o[e+572>>2]=-1.0;o[e+444>>2]=999999984306749440.0;o[e+448>>2]=999999984306749440.0;o[e+452>>2]=999999984306749440.0;o[e+428>>2]=1.0;o[e+432>>2]=.30000001192092896;o[e+436>>2]=1.0;o[e+440>>2]=.009999999776482582;o[e+456>>2]=.05000000074505806;k[e+592>>2]=0;o[e+596>>2]=0.0;o[e+600>>2]=.699999988079071;o[e+604>>2]=0.0;return e|0}function Ig(a,b,c){a=a|0;b=b|0;c=+c;if((b|0)==4){o[a+448>>2]=c;return}else if((b|0)==5){o[a+444>>2]=c;return}else if((b|0)==3){o[a+452>>2]=c;return}else return}function Jg(a,b){a=a|0;b=b|0;i[a+524>>0]=b&1;return}function Kg(a,b){a=a|0;b=+b;o[a+440>>2]=b;return}function Lg(a,b){a=a|0;b=b|0;i[a+552>>0]=b&1;return}function Mg(a,b){a=a|0;b=+b;o[a+572>>2]=b;i[a+553>>0]=0;return}function Ng(a,b){a=a|0;b=+b;o[a+572>>2]=b;i[a+553>>0]=1;return}function Og(a,b){a=a|0;b=b|0;var c=0,d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,p=0.0;c=r;r=r+48|0;Jw(a+364|0,c+16|0);g=-+o[c+16>>2];e=-+o[c+16+4>>2];k=-+o[c+16+8>>2];j=+o[c+16+12>>2];f=+o[b>>2];l=+o[b+12>>2];i=+o[b+8>>2];h=+o[b+4>>2];Jw(a+300|0,c);n=+o[c>>2];p=+o[c+12>>2];d=+o[c+8>>2];m=+o[c+4>>2];o[c+32>>2]=n*(j*l-f*g-h*e-i*k)+(j*f+l*g+i*e-h*k)*p+(f*k+(l*e+j*h)-i*g)*d-(l*k+j*i+h*g-f*e)*m;o[c+32+4>>2]=n*(l*k+j*i+h*g-f*e)+(p*(f*k+(l*e+j*h)-i*g)+(j*l-f*g-h*e-i*k)*m)-(j*f+l*g+i*e-h*k)*d;o[c+32+8>>2]=p*(l*k+j*i+h*g-f*e)+(j*l-f*g-h*e-i*k)*d+(j*f+l*g+i*e-h*k)*m-n*(f*k+(l*e+j*h)-i*g);o[c+32+12>>2]=(j*l-f*g-h*e-i*k)*p-n*(j*f+l*g+i*e-h*k)-(f*k+(l*e+j*h)-i*g)*m-(l*k+j*i+h*g-f*e)*d;rq(a,c+32|0);r=c;return}function Pg(a,b){a=a|0;b=b|0;rq(a,b);return}function Qg(a,b){a=a|0;b=b|0;i[a+21>>0]=b&1;return}function Rg(a){a=a|0;return +(+o[a+16>>2])}function Sg(a,b){a=a|0;b=+b;o[a+16>>2]=b;return}function Tg(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Ug(a,b){a=+a;b=+b;var c=0;k[5108]=(k[5108]|0)+1;c=iF(95)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}k[c+8>>2]=0;o[c+12>>2]=1.0;o[c+16>>2]=1.0;o[c+20>>2]=1.0;o[c+24>>2]=0.0;o[c+44>>2]=.03999999910593033;k[c>>2]=11560;o[c+56>>2]=a;o[c+60>>2]=b;k[c+4>>2]=11;k[c+64>>2]=0;k[c+68>>2]=1;k[c+72>>2]=2;o[c+28>>2]=a;o[c+32>>2]=b;o[c+36>>2]=a;b=a/+Y(+(a*a+b*b));o[c+52>>2]=b;return c|0}function Vg(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function Wg(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function Xg(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Yg(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function Zg(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function _g(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function $g(){var a=0,b=0,c=0;c=r;r=r+32|0;while(1){a=iF(92)|0;if(a){b=6;break}a=k[5230]|0;k[5230]=a+0;if(!a){b=5;break}zc[a&3]()}if((b|0)==5){c=Gb(4)|0;k[c>>2]=20816;Eb(c|0,20864,207)}else if((b|0)==6){k[c>>2]=0;k[c+4>>2]=0;k[c+8>>2]=4096;k[c+12>>2]=4096;k[c+16>>2]=0;k[c+20>>2]=1;Pr(a,c);r=c;return a|0}return 0}function ah(a){a=a|0;var b=0,c=0;while(1){b=iF(92)|0;if(b){c=6;break}b=k[5230]|0;k[5230]=b+0;if(!b){c=5;break}zc[b&3]()}if((c|0)==5){a=Gb(4)|0;k[a>>2]=20816;Eb(a|0,20864,207)}else if((c|0)==6){Pr(b,a);return b|0}return 0}function bh(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function ch(a,b,c,d,e,f,g,h){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;return +(+ac[k[(k[a>>2]|0)+12>>2]&1](a,b,c,d,e,f,g,h))}function dh(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function eh(a,b){a=+a;b=+b;var c=0,d=0.0;k[5108]=(k[5108]|0)+1;c=iF(95)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}k[c+8>>2]=0;o[c+12>>2]=1.0;o[c+16>>2]=1.0;o[c+20>>2]=1.0;o[c+24>>2]=0.0;o[c+44>>2]=.03999999910593033;o[c+56>>2]=a;o[c+60>>2]=b;k[c+4>>2]=11;d=a/+Y(+(a*a+b*b));o[c+52>>2]=d;k[c>>2]=11664;k[c+64>>2]=0;k[c+68>>2]=2;k[c+72>>2]=1;o[c+28>>2]=a;o[c+36>>2]=b;o[c+32>>2]=a;return c|0}function fh(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function gh(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function hh(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function ih(a,b){a=+a;b=+b;var c=0,d=0.0;k[5108]=(k[5108]|0)+1;c=iF(95)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}k[c+8>>2]=0;o[c+12>>2]=1.0;o[c+16>>2]=1.0;o[c+20>>2]=1.0;o[c+24>>2]=0.0;o[c+44>>2]=.03999999910593033;o[c+56>>2]=a;o[c+60>>2]=b;k[c+4>>2]=11;d=a/+Y(+(a*a+b*b));o[c+52>>2]=d;k[c>>2]=11768;k[c+64>>2]=1;k[c+68>>2]=0;k[c+72>>2]=2;o[c+32>>2]=a;o[c+28>>2]=b;o[c+36>>2]=a;return c|0}function jh(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function kh(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function lh(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function mh(){var a=0;k[5108]=(k[5108]|0)+1;a=iF(191)|0;if(!a)a=0;else{k[(a+4+15&-16)+-4>>2]=a;a=a+4+15&-16}Xu(a,1,1);return a|0}function nh(a){a=a|0;var b=0;k[5108]=(k[5108]|0)+1;b=iF(191)|0;if(!b)b=0;else{k[(b+4+15&-16)+-4>>2]=b;b=b+4+15&-16}Xu(b,a,1);return b|0}function oh(a,b){a=a|0;b=b|0;var c=0;k[5108]=(k[5108]|0)+1;c=iF(191)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}Xu(c,a,b);return c|0}function ph(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;e=k[a+32>>2]|0;k[e>>2]=(k[e>>2]|0)+1;Yu(a,Zu(a,b,0)|0);Yu(a,Zu(a,c,0)|0);Yu(a,Zu(a,d,0)|0);return}function qh(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0;f=k[a+32>>2]|0;k[f>>2]=(k[f>>2]|0)+1;Yu(a,Zu(a,b,e)|0);Yu(a,Zu(a,c,e)|0);Yu(a,Zu(a,d,e)|0);return}function rh(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function sh(){var a=0;k[5108]=(k[5108]|0)+1;a=iF(131)|0;if(!a)a=0;else{k[(a+4+15&-16)+-4>>2]=a;a=a+4+15&-16}k[a+8>>2]=0;o[a+12>>2]=1.0;o[a+16>>2]=1.0;o[a+20>>2]=1.0;o[a+24>>2]=0.0;o[a+44>>2]=.03999999910593033;k[a+52>>2]=0;o[a+56>>2]=1.0;o[a+60>>2]=1.0;o[a+64>>2]=1.0;o[a+68>>2]=0.0;o[a+72>>2]=-1.0;o[a+76>>2]=-1.0;o[a+80>>2]=-1.0;o[a+84>>2]=0.0;i[a+88>>0]=0;k[a>>2]=13808;i[a+108>>0]=1;k[a+104>>2]=0;k[a+100>>2]=0;k[a+4>>2]=4;k[a+96>>2]=0;Qt(a);return a|0}function th(a,b){a=a|0;b=b|0;fu(a,b,1);return}function uh(a,b,c){a=a|0;b=b|0;c=c|0;fu(a,b,c);return}function vh(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function wh(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function xh(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function yh(){var a=0,b=0;k[5108]=(k[5108]|0)+1;a=iF(791)|0;if(!a)a=0;else{k[(a+4+15&-16)+-4>>2]=a;a=a+4+15&-16}k[a>>2]=1025;k[a+116>>2]=0;i[a+120>>0]=0;b=a+124|0;k[b>>2]=0;k[b+4>>2]=0;k[b+8>>2]=0;k[b+12>>2]=0;k[b+16>>2]=0;k[b+20>>2]=0;k[b+24>>2]=0;k[b+28>>2]=0;k[a+300>>2]=0;i[a+304>>0]=0;b=a+308|0;k[b>>2]=0;k[b+4>>2]=0;k[b+8>>2]=0;k[b+12>>2]=0;k[b+16>>2]=0;k[b+20>>2]=0;k[b+24>>2]=0;k[b+28>>2]=0;k[a+484>>2]=0;i[a+488>>0]=0;b=a+492|0;k[b>>2]=0;k[b+4>>2]=0;k[b+8>>2]=0;k[b+12>>2]=0;k[b+16>>2]=0;k[b+20>>2]=0;k[b+24>>2]=0;k[b+28>>2]=0;k[a+668>>2]=0;i[a+672>>0]=0;b=a+676|0;k[b>>2]=0;k[b+4>>2]=0;k[b+8>>2]=0;k[b+12>>2]=0;k[b+16>>2]=0;k[b+20>>2]=0;k[b+24>>2]=0;k[b+28>>2]=0;k[a+740>>2]=0;k[a+744>>2]=0;k[a+748>>2]=0;k[a+768>>2]=0;return a|0}function zh(a){a=a|0;return k[a+740>>2]|0}function Ah(a){a=a|0;return k[a+744>>2]|0}function Bh(a){a=a|0;return k[a+748>>2]|0}function Ch(a,b){a=a|0;b=b|0;return a+4+(b*184|0)|0}function Dh(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function Eh(a){a=a|0;var b=0,c=0.0,d=0.0,e=0.0,f=0,g=0,h=0,i=0,j=0,l=0,m=0.0,n=0,p=0.0;k[5108]=(k[5108]|0)+1;b=iF(75)|0;if(!b)j=0;else{k[(b+4+15&-16)+-4>>2]=b;j=b+4+15&-16}k[j+8>>2]=0;g=j+12|0;o[g>>2]=1.0;h=j+16|0;o[h>>2]=1.0;i=j+20|0;o[i>>2]=1.0;o[j+24>>2]=0.0;f=j+44|0;o[f>>2]=.03999999910593033;k[j+52>>2]=0;k[j>>2]=14912;k[j+4>>2]=0;c=+o[a>>2];d=+o[a+4>>2];e=+o[a+8>>2];if(c<d)b=c<e?0:2;else b=d<e?1:2;c=+o[a+(b<<2)>>2]*.10000000149011612;if(c<.03999999910593033){p=+hx(j);m=+gc[k[(k[j>>2]|0)+48>>2]&15](j);e=+gc[k[(k[j>>2]|0)+48>>2]&15](j);n=j+28|0;p=p+ +o[n>>2];l=j+32|0;m=m+ +o[l>>2];b=j+36|0;e=e+ +o[b>>2];o[f>>2]=c;c=+gc[k[(k[j>>2]|0)+48>>2]&15](j);d=+gc[k[(k[j>>2]|0)+48>>2]&15](j);e=e-+gc[k[(k[j>>2]|0)+48>>2]&15](j);o[n>>2]=p-c;o[l>>2]=m-d;o[b>>2]=e;o[j+40>>2]=0.0;b=k[j>>2]|0}else b=14912;d=+gc[k[b+48>>2]&15](j);e=+gc[k[(k[j>>2]|0)+48>>2]&15](j);p=+gc[k[(k[j>>2]|0)+48>>2]&15](j);e=+o[a+4>>2]*+o[h>>2]-e;p=+o[a+8>>2]*+o[i>>2]-p;o[j+28>>2]=+o[a>>2]*+o[g>>2]-d;o[j+32>>2]=e;o[j+36>>2]=p;o[j+40>>2]=0.0;return j|0}function Fh(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function Gh(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function Hh(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Ih(a){a=a|0;var b=0,c=0,d=0;while(1){d=iF(5260)|0;if(d)break;b=k[5230]|0;k[5230]=b+0;if(!b){c=5;break}zc[b&3]()}if((c|0)==5){d=Gb(4)|0;k[d>>2]=20816;Eb(d|0,20864,207)}k[d>>2]=5600;k[d+4>>2]=2;i[d+24>>0]=1;k[d+20>>2]=0;k[d+12>>2]=0;k[d+16>>2]=0;k[d+28>>2]=7888;k[d+5256>>2]=a;k[d+60>>2]=70;b=Wb[k[(k[a>>2]|0)+12>>2]&127](a)|0;k[d+64>>2]=b;b=Wb[k[(k[a>>2]|0)+8>>2]&127](a)|0;k[d+68>>2]=b;b=0;do{a=0;do{c=k[d+5256>>2]|0;c=dc[k[(k[c>>2]|0)+16>>2]&63](c,b,a)|0;k[d+72+(b*144|0)+(a<<2)>>2]=c;a=a+1|0}while((a|0)<36);b=b+1|0}while((b|0)<36);return d|0}function Jh(a){a=a|0;return Wb[k[(k[a>>2]|0)+36>>2]&127](a)|0}function Kh(a,b){a=a|0;b=b|0;return nc[k[(k[a>>2]|0)+40>>2]&31](a,b)|0}function Lh(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Mh(){var a=0,b=0;while(1){a=iF(24)|0;if(a){b=6;break}a=k[5230]|0;k[5230]=a+0;if(!a){b=5;break}zc[a&3]()}if((b|0)==5){b=Gb(4)|0;k[b>>2]=20816;Eb(b|0,20864,207)}else if((b|0)==6){o[a>>2]=5.880000114440918;o[a+4>>2]=.8299999833106995;o[a+8>>2]=.8799999952316284;o[a+12>>2]=500.0;o[a+16>>2]=10.5;o[a+20>>2]=6.0e3;return a|0}return 0}function Nh(a){a=a|0;return +(+o[a>>2])}function Oh(a,b){a=a|0;b=+b;o[a>>2]=b;return}function Ph(a){a=a|0;return +(+o[a+4>>2])}function Qh(a,b){a=a|0;b=+b;o[a+4>>2]=b;return}function Rh(a){a=a|0;return +(+o[a+8>>2])}function Sh(a,b){a=a|0;b=+b;o[a+8>>2]=b;return}function Th(a){a=a|0;return +(+o[a+12>>2])}function Uh(a,b){a=a|0;b=+b;o[a+12>>2]=b;return}function Vh(a){a=a|0;return +(+o[a+16>>2])}function Wh(a,b){a=a|0;b=+b;o[a+16>>2]=b;return}function Xh(a){a=a|0;return +(+o[a+20>>2])}function Yh(a,b){a=a|0;b=+b;o[a+20>>2]=b;return}function Zh(){var a=0;k[5108]=(k[5108]|0)+1;a=iF(111)|0;if(!a)a=0;else{k[(a+4+15&-16)+-4>>2]=a;a=a+4+15&-16}Xs(a,1);return a|0}function _h(a){a=a|0;var b=0;k[5108]=(k[5108]|0)+1;b=iF(111)|0;if(!b)b=0;else{k[(b+4+15&-16)+-4>>2]=b;b=b+4+15&-16}Xs(b,a);return b|0}function $h(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0,f=0,g=0,h=0,j=0,l=0,m=0.0,n=0,p=0,q=0,s=0;n=r;r=r+128|0;k[a+68>>2]=(k[a+68>>2]|0)+1;k[n>>2]=k[b>>2];k[n+4>>2]=k[b+4>>2];k[n+8>>2]=k[b+8>>2];k[n+12>>2]=k[b+12>>2];k[n+16>>2]=k[b+16>>2];k[n+16+4>>2]=k[b+16+4>>2];k[n+16+8>>2]=k[b+16+8>>2];k[n+16+12>>2]=k[b+16+12>>2];k[n+32>>2]=k[b+32>>2];k[n+32+4>>2]=k[b+32+4>>2];k[n+32+8>>2]=k[b+32+8>>2];k[n+32+12>>2]=k[b+32+12>>2];k[n+48>>2]=k[b+48>>2];k[n+48+4>>2]=k[b+48+4>>2];k[n+48+8>>2]=k[b+48+8>>2];k[n+48+12>>2]=k[b+48+12>>2];l=k[c+4>>2]|0;m=+gc[k[(k[c>>2]|0)+48>>2]&15](c);Cc[k[(k[c>>2]|0)+8>>2]&127](c,b,n+112|0,n+96|0);d=+o[n+112>>2];if(+o[a+32>>2]>d)o[a+32>>2]=d;d=+o[n+96>>2];if(+o[a+48>>2]<d)o[a+48>>2]=d;d=+o[n+112+4>>2];if(+o[a+36>>2]>d)o[a+36>>2]=d;d=+o[n+96+4>>2];if(+o[a+52>>2]<d)o[a+52>>2]=d;d=+o[n+112+8>>2];if(+o[a+40>>2]>d)o[a+40>>2]=d;d=+o[n+96+8>>2];if(+o[a+56>>2]<d)o[a+56>>2]=d;h=k[a+64>>2]|0;if(!h){f=a+16|0;g=0}else{k[n+64>>2]=k[n+112>>2];k[n+64+4>>2]=k[n+112+4>>2];k[n+64+8>>2]=k[n+112+8>>2];k[n+64+12>>2]=k[n+112+12>>2];k[n+64+16>>2]=k[n+96>>2];k[n+64+16+4>>2]=k[n+96+4>>2];k[n+64+16+8>>2]=k[n+96+8>>2];k[n+64+16+12>>2]=k[n+96+12>>2];g=k[a+16>>2]|0;b=k[h+4>>2]|0;if(!b){k[5108]=(k[5108]|0)+1;b=iF(63)|0;if((b|0)!=0?(k[(b+4+15&-16)+-4>>2]=b,(b+4+15&-16|0)!=0):0){e=b+4+15&-16;f=e+44|0;do{k[e>>2]=0;e=e+4|0}while((e|0)<(f|0));b=b+4+15&-16}else b=0}else k[h+4>>2]=0;k[b+32>>2]=0;k[b+36>>2]=g;k[b+40>>2]=0;k[b>>2]=k[n+64>>2];k[b+4>>2]=k[n+64+4>>2];k[b+8>>2]=k[n+64+8>>2];k[b+12>>2]=k[n+64+12>>2];k[b+16>>2]=k[n+64+16>>2];k[b+20>>2]=k[n+64+20>>2];k[b+24>>2]=k[n+64+24>>2];k[b+28>>2]=k[n+64+28>>2];px(h,k[h>>2]|0,b);k[h+12>>2]=(k[h+12>>2]|0)+1;f=a+16|0;g=b}b=k[f>>2]|0;if((b|0)==(k[a+20>>2]|0)?(j=(b|0)==0?1:b<<1,(b|0)<(j|0)):0){if(!j)h=0;else{k[5108]=(k[5108]|0)+1;b=iF((j*80|3)+16|0)|0;if(!b)b=0;else{k[(b+4+15&-16)+-4>>2]=b;b=b+4+15&-16}h=b;b=k[f>>2]|0}if((b|0)>0){b=b+-1|0;e=0;while(1){p=h+(e*80|0)|0;q=k[a+24>>2]|0;s=q+(e*80|0)|0;k[p>>2]=k[s>>2];k[p+4>>2]=k[s+4>>2];k[p+8>>2]=k[s+8>>2];k[p+12>>2]=k[s+12>>2];p=h+(e*80|0)+16|0;s=q+(e*80|0)+16|0;k[p>>2]=k[s>>2];k[p+4>>2]=k[s+4>>2];k[p+8>>2]=k[s+8>>2];k[p+12>>2]=k[s+12>>2];p=h+(e*80|0)+32|0;s=q+(e*80|0)+32|0;k[p>>2]=k[s>>2];k[p+4>>2]=k[s+4>>2];k[p+8>>2]=k[s+8>>2];k[p+12>>2]=k[s+12>>2];p=h+(e*80|0)+48|0;s=q+(e*80|0)+48|0;k[p>>2]=k[s>>2];k[p+4>>2]=k[s+4>>2];k[p+8>>2]=k[s+8>>2];k[p+12>>2]=k[s+12>>2];p=h+(e*80|0)+64|0;q=q+(e*80|0)+64|0;k[p>>2]=k[q>>2];k[p+4>>2]=k[q+4>>2];k[p+8>>2]=k[q+8>>2];k[p+12>>2]=k[q+12>>2];if((e|0)==(b|0))break;else e=e+1|0}}b=k[a+24>>2]|0;if(b){if(i[a+28>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+24>>2]=0}i[a+28>>0]=1;k[a+24>>2]=h;k[a+20>>2]=j;b=k[f>>2]|0}s=k[a+24>>2]|0;q=s+(b*80|0)|0;k[q>>2]=k[n>>2];k[q+4>>2]=k[n+4>>2];k[q+8>>2]=k[n+8>>2];k[q+12>>2]=k[n+12>>2];q=s+(b*80|0)+16|0;k[q>>2]=k[n+16>>2];k[q+4>>2]=k[n+16+4>>2];k[q+8>>2]=k[n+16+8>>2];k[q+12>>2]=k[n+16+12>>2];q=s+(b*80|0)+32|0;k[q>>2]=k[n+32>>2];k[q+4>>2]=k[n+32+4>>2];k[q+8>>2]=k[n+32+8>>2];k[q+12>>2]=k[n+32+12>>2];q=s+(b*80|0)+48|0;k[q>>2]=k[n+48>>2];k[q+4>>2]=k[n+48+4>>2];k[q+8>>2]=k[n+48+8>>2];k[q+12>>2]=k[n+48+12>>2];s=s+(b*80|0)+64|0;k[s>>2]=c;k[s+4>>2]=l;o[s+8>>2]=m;k[s+12>>2]=g;k[f>>2]=(k[f>>2]|0)+1;r=n;return}function ai(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function bi(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function ci(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function di(a,b){a=a|0;b=b|0;var c=0,d=0;while(1){c=iF(80)|0;if(c){d=6;break}c=k[5230]|0;k[5230]=c+0;if(!c){d=5;break}zc[c&3]()}if((d|0)==5){b=Gb(4)|0;k[b>>2]=20816;Eb(b|0,20864,207)}else if((d|0)==6){o[c+4>>2]=1.0;j[c+8>>1]=1;j[c+10>>1]=-1;k[c>>2]=880;k[c+12>>2]=k[a>>2];k[c+12+4>>2]=k[a+4>>2];k[c+12+8>>2]=k[a+8>>2];k[c+12+12>>2]=k[a+12>>2];k[c+28>>2]=k[b>>2];k[c+28+4>>2]=k[b+4>>2];k[c+28+8>>2]=k[b+8>>2];k[c+28+12>>2]=k[b+12>>2];k[c+76>>2]=0;return c|0}return 0}function ei(a){a=a|0;return +o[a+4>>2]<1.0|0}function fi(a){a=a|0;return a+12|0}function gi(a,b){a=a|0;b=b|0;k[a+12>>2]=k[b>>2];k[a+12+4>>2]=k[b+4>>2];k[a+12+8>>2]=k[b+8>>2];k[a+12+12>>2]=k[b+12>>2];return}function hi(a){a=a|0;return a+28|0}function ii(a,b){a=a|0;b=b|0;k[a+28>>2]=k[b>>2];k[a+28+4>>2]=k[b+4>>2];k[a+28+8>>2]=k[b+8>>2];k[a+28+12>>2]=k[b+12>>2];return}function ji(a){a=a|0;return a+44|0}function ki(a,b){a=a|0;b=b|0;k[a+44>>2]=k[b>>2];k[a+44+4>>2]=k[b+4>>2];k[a+44+8>>2]=k[b+8>>2];k[a+44+12>>2]=k[b+12>>2];return}function li(a){a=a|0;return a+60|0}function mi(a,b){a=a|0;b=b|0;k[a+60>>2]=k[b>>2];k[a+60+4>>2]=k[b+4>>2];k[a+60+8>>2]=k[b+8>>2];k[a+60+12>>2]=k[b+12>>2];return}function ni(a){a=a|0;return j[a+8>>1]|0}function oi(a,b){a=a|0;b=b|0;j[a+8>>1]=b;return}function pi(a){a=a|0;return j[a+10>>1]|0}function qi(a,b){a=a|0;b=b|0;j[a+10>>1]=b;return}function ri(a){a=a|0;return +(+o[a+4>>2])}function si(a,b){a=a|0;b=+b;o[a+4>>2]=b;return}function ti(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function ui(){var a=0;k[5108]=(k[5108]|0)+1;a=iF(219)|0;if(!a)a=0;else{k[(a+4+15&-16)+-4>>2]=a;a=a+4+15&-16}Lw();Lw();Mw(a,744,744);return a|0}function vi(a){a=a|0;var b=0;k[5108]=(k[5108]|0)+1;b=iF(219)|0;if(!b)b=0;else{k[(b+4+15&-16)+-4>>2]=b;b=b+4+15&-16}Lw();Mw(b,a,744);return b|0}function wi(a,b){a=a|0;b=b|0;var c=0;k[5108]=(k[5108]|0)+1;c=iF(219)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}Mw(c,a,b);return c|0}function xi(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+8>>2]&127](a,b);return}function yi(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+12>>2]&127](a,b);return}function zi(a){a=a|0;return a+4|0}function Ai(a,b){a=a|0;b=b|0;k[a+4>>2]=k[b>>2];k[a+4+4>>2]=k[b+4>>2];k[a+4+8>>2]=k[b+8>>2];k[a+4+12>>2]=k[b+12>>2];k[a+20>>2]=k[b+16>>2];k[a+20+4>>2]=k[b+16+4>>2];k[a+20+8>>2]=k[b+16+8>>2];k[a+20+12>>2]=k[b+16+12>>2];k[a+36>>2]=k[b+32>>2];k[a+36+4>>2]=k[b+32+4>>2];k[a+36+8>>2]=k[b+32+8>>2];k[a+36+12>>2]=k[b+32+12>>2];k[a+52>>2]=k[b+48>>2];k[a+52+4>>2]=k[b+48+4>>2];k[a+52+8>>2]=k[b+48+8>>2];k[a+52+12>>2]=k[b+48+12>>2];return}function Bi(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Ci(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function Di(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function Ei(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Fi(a){a=a|0;return Wb[k[(k[a>>2]|0)+36>>2]&127](a)|0}function Gi(a,b){a=a|0;b=b|0;return nc[k[(k[a>>2]|0)+40>>2]&31](a,b)|0}function Hi(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Ii(a,b){a=a|0;b=b|0;var c=0,d=0;while(1){c=iF(84)|0;if(c){d=6;break}c=k[5230]|0;k[5230]=c+0;if(!c){d=5;break}zc[c&3]()}if((d|0)==5){b=Gb(4)|0;k[b>>2]=20816;Eb(b|0,20864,207)}else if((d|0)==6){o[c+4>>2]=1.0;k[c+8>>2]=0;j[c+12>>1]=1;j[c+14>>1]=-1;k[c+16>>2]=0;k[c>>2]=528;k[c+20>>2]=k[a>>2];k[c+20+4>>2]=k[a+4>>2];k[c+20+8>>2]=k[a+8>>2];k[c+20+12>>2]=k[a+12>>2];k[c+36>>2]=k[b>>2];k[c+36+4>>2]=k[b+4>>2];k[c+36+8>>2]=k[b+8>>2];k[c+36+12>>2]=k[b+12>>2];return c|0}return 0}function Ji(a){a=a|0;return (k[a+8>>2]|0)!=0|0}function Ki(a){a=a|0;return a+20|0}function Li(a,b){a=a|0;b=b|0;k[a+20>>2]=k[b>>2];k[a+20+4>>2]=k[b+4>>2];k[a+20+8>>2]=k[b+8>>2];k[a+20+12>>2]=k[b+12>>2];return}function Mi(a){a=a|0;return a+36|0}function Ni(a,b){a=a|0;b=b|0;k[a+36>>2]=k[b>>2];k[a+36+4>>2]=k[b+4>>2];k[a+36+8>>2]=k[b+8>>2];k[a+36+12>>2]=k[b+12>>2];return}function Oi(a){a=a|0;return a+52|0}function Pi(a,b){a=a|0;b=b|0;k[a+52>>2]=k[b>>2];k[a+52+4>>2]=k[b+4>>2];k[a+52+8>>2]=k[b+8>>2];k[a+52+12>>2]=k[b+12>>2];return}function Qi(a){a=a|0;return a+68|0}function Ri(a,b){a=a|0;b=b|0;k[a+68>>2]=k[b>>2];k[a+68+4>>2]=k[b+4>>2];k[a+68+8>>2]=k[b+8>>2];k[a+68+12>>2]=k[b+12>>2];return}function Si(a){a=a|0;return j[a+12>>1]|0}function Ti(a,b){a=a|0;b=b|0;j[a+12>>1]=b;return}function Ui(a){a=a|0;return j[a+14>>1]|0}function Vi(a,b){a=a|0;b=b|0;j[a+14>>1]=b;return}function Wi(a){a=a|0;return k[a+8>>2]|0}function Xi(a,b){a=a|0;b=b|0;k[a+8>>2]=b;return}function Yi(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Zi(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+64>>2]&127](a,b);return}function _i(a){a=a|0;var b=0,c=0;if((i[216]|0)==0?(db(216)|0)!=0:0){o[32]=.6000000238418579;o[33]=1.0;o[34]=.30000001192092896;o[35]=.01666666753590107;o[36]=0.0;o[38]=20.0;k[37]=10;o[40]=.20000000298023224;o[41]=.800000011920929;o[42]=0.0;o[39]=1.0;k[43]=1;o[44]=-.03999999910593033;o[45]=.10000000149011612;o[46]=0.0;o[47]=.8500000238418579;k[48]=260;k[49]=2;k[50]=128;o[51]=100.0;o[52]=1000000015047466219876688.0e6;ib(216)}c=128;a=a+92|0;b=c+84|0;do{k[c>>2]=k[a>>2];c=c+4|0;a=a+4|0}while((c|0)<(b|0));return 128}function $i(a){a=a|0;return k[a+24>>2]|0}function aj(a){a=a|0;Sb[k[(k[a>>2]|0)+12>>2]&255](a);return}function bj(a){a=a|0;Sb[k[(k[a>>2]|0)+44>>2]&255](a);return}function cj(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;Cc[k[(k[a>>2]|0)+32>>2]&127](a,b,c,d);return}function dj(a){a=a|0;a=k[a+68>>2]|0;return Wb[k[(k[a>>2]|0)+36>>2]&127](a)|0}function ej(a){a=a|0;return a+28|0}function fj(a,b){a=a|0;b=b|0;Cc[k[(k[a>>2]|0)+36>>2]&127](a,b,1,-1);return}function gj(a,b,c){a=a|0;b=b|0;c=c|0;Cc[k[(k[a>>2]|0)+36>>2]&127](a,b,c,-1);return}function hj(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;Cc[k[(k[a>>2]|0)+36>>2]&127](a,b,c,d);return}function ij(a){a=a|0;return k[a+68>>2]|0}function jj(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=+f;ws(a,b,c,d,e,f);return}function kj(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;xs(a,b,c,d);return}function lj(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function mj(a,b){a=+a;b=+b;var c=0;k[5108]=(k[5108]|0)+1;c=iF(75)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}k[c+8>>2]=0;o[c+12>>2]=1.0;o[c+16>>2]=1.0;o[c+20>>2]=1.0;o[c+24>>2]=0.0;o[c+44>>2]=.03999999910593033;k[c+4>>2]=10;k[c>>2]=14200;k[c+52>>2]=0;o[c+28>>2]=b*.5;o[c+32>>2]=a;o[c+36>>2]=a;o[c+40>>2]=0.0;return c|0}function nj(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function oj(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function pj(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function qj(a,b,c,d){a=+a;b=+b;c=+c;d=+d;var e=0,f=0;while(1){e=iF(16)|0;if(e){f=6;break}e=k[5230]|0;k[5230]=e+0;if(!e){f=5;break}zc[e&3]()}if((f|0)==5){f=Gb(4)|0;k[f>>2]=20816;Eb(f|0,20864,207)}else if((f|0)==6){o[e>>2]=a;o[e+4>>2]=b;o[e+8>>2]=c;o[e+12>>2]=d;return e|0}return 0}function rj(a,b,c,d,e){a=a|0;b=+b;c=+c;d=+d;e=+e;o[a>>2]=b;o[a+4>>2]=c;o[a+8>>2]=d;o[a+12>>2]=e;return}function sj(a){a=a|0;return +(+o[a>>2])}function tj(a){a=a|0;return +(+o[a+4>>2])}function uj(a){a=a|0;return +(+o[a+8>>2])}function vj(a){a=a|0;return +(+o[a+12>>2])}function wj(a,b){a=a|0;b=+b;o[a>>2]=b;return}function xj(a,b){a=a|0;b=+b;o[a+4>>2]=b;return}function yj(a,b){a=a|0;b=+b;o[a+8>>2]=b;return}function zj(a,b){a=a|0;b=+b;o[a+12>>2]=b;return}function Aj(a){a=a|0;if(!a)return;jF(a);return}function Bj(a,b){a=+a;b=+b;var c=0;k[5108]=(k[5108]|0)+1;c=iF(75)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}k[c+8>>2]=0;o[c+12>>2]=1.0;o[c+16>>2]=1.0;o[c+20>>2]=1.0;o[c+24>>2]=0.0;o[c+44>>2]=.03999999910593033;k[c+4>>2]=10;k[c>>2]=14304;k[c+52>>2]=2;o[c+28>>2]=a;o[c+32>>2]=a;o[c+36>>2]=b*.5;o[c+40>>2]=0.0;return c|0}function Cj(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function Dj(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function Ej(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Fj(a){a=a|0;var b=0,c=0;while(1){b=iF(8)|0;if(b){c=6;break}b=k[5230]|0;k[5230]=b+0;if(!b){c=5;break}zc[b&3]()}if((c|0)==5){a=Gb(4)|0;k[a>>2]=20816;Eb(a|0,20864,207)}else if((c|0)==6){k[b>>2]=4952;k[b+4>>2]=a;return b|0}return 0}function Gj(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Hj(a){a=a|0;return (k[a+8>>2]|0)!=0|0}function Ij(a){a=a|0;return j[a+12>>1]|0}function Jj(a,b){a=a|0;b=b|0;j[a+12>>1]=b;return}function Kj(a){a=a|0;return j[a+14>>1]|0}function Lj(a,b){a=a|0;b=b|0;j[a+14>>1]=b;return}function Mj(a){a=a|0;return k[a+8>>2]|0}function Nj(a,b){a=a|0;b=b|0;k[a+8>>2]=b;return}function Oj(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Pj(a){a=a|0;return +(+o[a+216>>2])}function Qj(a,b){a=a|0;b=+b;o[a+216>>2]=b;return}function Rj(a){a=a|0;return +(+o[a+228>>2])}function Sj(a,b){a=a|0;b=+b;o[a+228>>2]=b;return}function Tj(a){a=a|0;return +(+o[a+244>>2])}function Uj(a,b){a=a|0;b=+b;o[a+244>>2]=b;return}function Vj(a){a=a|0;return +(+o[a+204>>2])}function Wj(a,b){a=a|0;b=+b;o[a+204>>2]=b;return}function Xj(a){a=a|0;return +(+o[a+212>>2])}function Yj(a,b){a=a|0;b=+b;o[a+212>>2]=b;return}function Zj(a){a=a|0;return +(+o[a+220>>2])}function _j(a,b){a=a|0;b=+b;o[a+220>>2]=b;return}function $j(a){a=a|0;return +(+o[a+224>>2])}function ak(a,b){a=a|0;b=+b;o[a+224>>2]=b;return}function bk(a){a=a|0;return +(+o[a+232>>2])}function ck(a,b){a=a|0;b=+b;o[a+232>>2]=b;return}function dk(a){a=a|0;return +(+o[a+248>>2])}function ek(a,b){a=a|0;b=+b;o[a+248>>2]=b;return}function fk(a){a=a|0;return +(+o[a+208>>2])}function gk(a,b){a=a|0;b=+b;o[a+208>>2]=b;return}function hk(a){a=a|0;return +(+o[a+276>>2])}function ik(a,b){a=a|0;b=+b;o[a+276>>2]=b;return}function jk(a){a=a|0;return (i[a+260>>0]&1)!=0|0}function kk(a,b){a=a|0;b=b|0;i[a+260>>0]=b&1;return}function lk(a){a=a|0;return a+156|0}function mk(a,b){a=a|0;b=b|0;k[a+156>>2]=k[b>>2];k[a+156+4>>2]=k[b+4>>2];k[a+156+8>>2]=k[b+8>>2];k[a+156+12>>2]=k[b+12>>2];return}function nk(a){a=a|0;if(!a)return;jF(a);return}function ok(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function pk(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function qk(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function rk(){var a=0;k[5108]=(k[5108]|0)+1;a=iF(35)|0;if(!a){a=0;return a|0}k[(a+4+15&-16)+-4>>2]=a;a=a+4+15&-16;return a|0}function sk(a,b,c,d){a=+a;b=+b;c=+c;d=+d;var e=0;k[5108]=(k[5108]|0)+1;e=iF(35)|0;if(!e)e=0;else{k[(e+4+15&-16)+-4>>2]=e;e=e+4+15&-16}o[e>>2]=a;o[e+4>>2]=b;o[e+8>>2]=c;o[e+12>>2]=d;return e|0}function tk(a){a=a|0;return +(+o[a+12>>2])}function uk(a,b,c,d,e){a=a|0;b=+b;c=+c;d=+d;e=+e;o[a>>2]=b;o[a+4>>2]=c;o[a+8>>2]=d;o[a+12>>2]=e;return}function vk(a){a=a|0;var b=0.0,c=0.0,d=0.0;d=+o[a>>2];c=+o[a+4>>2];b=+o[a+8>>2];return +(+Y(+(d*d+c*c+b*b)))}function wk(a){a=a|0;return +(+o[a>>2])}function xk(a){a=a|0;return +(+o[a+4>>2])}function yk(a){a=a|0;return +(+o[a+8>>2])}function zk(a,b){a=a|0;b=+b;o[a>>2]=b;return}function Ak(a,b){a=a|0;b=+b;o[a+4>>2]=b;return}function Bk(a,b){a=a|0;b=+b;o[a+8>>2]=b;return}function Ck(a,b){a=a|0;b=+b;o[a>>2]=+o[a>>2]*b;o[a+4>>2]=+o[a+4>>2]*b;o[a+8>>2]=+o[a+8>>2]*b;return a|0}function Dk(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function Ek(a,b,c){a=a|0;b=b|0;c=+c;var d=0,e=0;k[5108]=(k[5108]|0)+1;d=iF(203)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}k[d>>2]=5024;i[d+144>>0]=1;k[d+140>>2]=0;k[d+132>>2]=0;k[d+136>>2]=0;k[d+176>>2]=1;o[d+56>>2]=.019999999552965164;e=d+60|0;k[e>>2]=0;k[e+4>>2]=0;k[e+8>>2]=0;k[e+12>>2]=0;i[d+170>>0]=1;k[d+8>>2]=a;o[d+52>>2]=c;o[d+48>>2]=0.0;k[d+12>>2]=b;i[d+171>>0]=1;o[d+172>>2]=0.0;o[d+16>>2]=0.0;o[d+20>>2]=0.0;o[d+44>>2]=29.399999618530273;o[d+24>>2]=55.0;o[d+28>>2]=10.0;i[d+168>>0]=0;i[d+169>>0]=0;i[d+180>>0]=1;o[d+36>>2]=.7853981852531433;o[d+40>>2]=.7071067690849304;o[d+108>>2]=0.0;i[d+181>>0]=0;i[d+182>>0]=0;return d|0}function Fk(a,b,c,d){a=a|0;b=b|0;c=+c;d=d|0;var e=0;k[5108]=(k[5108]|0)+1;e=iF(203)|0;if(!e)e=0;else{k[(e+4+15&-16)+-4>>2]=e;e=e+4+15&-16}k[e>>2]=5024;i[e+144>>0]=1;k[e+140>>2]=0;k[e+132>>2]=0;k[e+136>>2]=0;k[e+176>>2]=d;o[e+56>>2]=.019999999552965164;d=e+60|0;k[d>>2]=0;k[d+4>>2]=0;k[d+8>>2]=0;k[d+12>>2]=0;i[e+170>>0]=1;k[e+8>>2]=a;o[e+52>>2]=c;o[e+48>>2]=0.0;k[e+12>>2]=b;i[e+171>>0]=1;o[e+172>>2]=0.0;o[e+16>>2]=0.0;o[e+20>>2]=0.0;o[e+44>>2]=29.399999618530273;o[e+24>>2]=55.0;o[e+28>>2]=10.0;i[e+168>>0]=0;i[e+169>>0]=0;i[e+180>>0]=1;o[e+36>>2]=.7853981852531433;o[e+40>>2]=.7071067690849304;o[e+108>>2]=0.0;i[e+181>>0]=0;i[e+182>>0]=0;return e|0}function Gk(a,b){a=a|0;b=b|0;if((b|0)<0)b=0;else b=(b|0)>2?2:b;k[a+176>>2]=b;return}function Hk(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+16>>2]&127](a,b);return}function Ik(a,b,c){a=a|0;b=b|0;c=+c;Ac[k[(k[a>>2]|0)+20>>2]&7](a,b,c);return}function Jk(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+28>>2]&127](a,b);return}function Kk(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+32>>2]&127](a,b);return}function Lk(a,b,c){a=a|0;b=b|0;c=+c;Ac[k[(k[a>>2]|0)+36>>2]&7](a,b,c);return}function Mk(a,b){a=a|0;b=+b;o[a+24>>2]=b;return}function Nk(a,b){a=a|0;b=+b;o[a+28>>2]=b;return}function Ok(a,b){a=a|0;b=+b;o[a+32>>2]=b;return}function Pk(a){a=a|0;return Wb[k[(k[a>>2]|0)+40>>2]&127](a)|0}function Qk(a){a=a|0;Sb[k[(k[a>>2]|0)+44>>2]&255](a);return}function Rk(a,b){a=a|0;b=+b;o[a+44>>2]=b;return}function Sk(a){a=a|0;return +(+o[a+44>>2])}function Tk(a,b){a=a|0;b=+b;o[a+36>>2]=b;b=+_(+b);o[a+40>>2]=b;return}function Uk(a){a=a|0;return +(+o[a+36>>2])}function Vk(a){a=a|0;return k[a+8>>2]|0}function Wk(a,b){a=a|0;b=b|0;i[a+170>>0]=b&1;return}function Xk(a){a=a|0;return Wb[k[(k[a>>2]|0)+48>>2]&127](a)|0}function Yk(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Zk(a,b){a=a|0;b=+b;var c=0,d=0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0;k[5108]=(k[5108]|0)+1;c=iF(103)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}d=c+4|0;k[d>>2]=35;k[c+8>>2]=0;o[c+12>>2]=0.0;k[c>>2]=13176;i=+o[a>>2];h=+o[a+4>>2];g=+o[a+8>>2];e=+o[a+12>>2];f=1.0/+Y(+(i*i+h*h+g*g));o[c+48>>2]=i*f;o[c+52>>2]=h*f;o[c+56>>2]=g*f;o[c+60>>2]=e;o[c+64>>2]=b;a=c+68|0;k[a>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;k[d>>2]=28;return c|0}function _k(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function $k(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function al(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function bl(a){a=a|0;return (k[a+44>>2]|0)!=0|0}function cl(a,b){a=a|0;b=b|0;k[a+44>>2]=b&1;return}function dl(a){a=a|0;return ~~+o[a+48>>2]|0}function el(a,b){a=a|0;b=b|0;o[a+48>>2]=+(b|0);return}function fl(a){a=a|0;if(!a)return;jF(a);return}function gl(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+60>>2]&127](a,b);return}function hl(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function il(){var a=0;k[5108]=(k[5108]|0)+1;a=iF(35)|0;if(!a){a=0;return a|0}k[(a+4+15&-16)+-4>>2]=a;a=a+4+15&-16;return a|0}function jl(a,b,c){a=+a;b=+b;c=+c;var d=0;k[5108]=(k[5108]|0)+1;d=iF(35)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}o[d>>2]=a;o[d+4>>2]=b;o[d+8>>2]=c;o[d+12>>2]=0.0;return d|0}function kl(a){a=a|0;var b=0.0,c=0.0,d=0.0;d=+o[a>>2];c=+o[a+4>>2];b=+o[a+8>>2];return +(+Y(+(d*d+c*c+b*b)))}function ll(a){a=a|0;return +(+o[a>>2])}function ml(a){a=a|0;return +(+o[a+4>>2])}function nl(a){a=a|0;return +(+o[a+8>>2])}function ol(a,b){a=a|0;b=+b;o[a>>2]=b;return}function pl(a,b){a=a|0;b=+b;o[a+4>>2]=b;return}function ql(a,b){a=a|0;b=+b;o[a+8>>2]=b;return}function rl(a,b,c,d){a=a|0;b=+b;c=+c;d=+d;o[a>>2]=b;o[a+4>>2]=c;o[a+8>>2]=d;o[a+12>>2]=0.0;return}function sl(a,b){a=a|0;b=+b;o[a>>2]=+o[a>>2]*b;o[a+4>>2]=+o[a+4>>2]*b;o[a+8>>2]=+o[a+8>>2]*b;return a|0}function tl(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function ul(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function vl(a){a=+a;var b=0;k[5108]=(k[5108]|0)+1;b=iF(71)|0;if(!b)b=0;else{k[(b+4+15&-16)+-4>>2]=b;b=b+4+15&-16}k[b+8>>2]=0;o[b+12>>2]=1.0;o[b+16>>2]=1.0;o[b+20>>2]=1.0;o[b+24>>2]=0.0;k[b>>2]=12008;k[b+4>>2]=8;o[b+28>>2]=a;o[b+44>>2]=a;return b|0}function wl(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function xl(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function yl(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function zl(){var a=0,b=0;while(1){a=iF(24)|0;if(a){b=6;break}a=k[5230]|0;k[5230]=a+0;if(!a){b=5;break}zc[a&3]()}if((b|0)==5){b=Gb(4)|0;k[b>>2]=20816;Eb(b|0,20864,207)}else if((b|0)==6){k[a>>2]=0;k[a+4>>2]=0;k[a+8>>2]=4096;k[a+12>>2]=4096;k[a+16>>2]=0;k[a+20>>2]=1;return a|0}return 0}function Al(a){a=a|0;if(!a)return;jF(a);return}function Bl(a,b){a=a|0;b=b|0;var c=0;k[5108]=(k[5108]|0)+1;c=iF(783)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}wq(c,a,b,0);return c|0}function Cl(a,b,c){a=a|0;b=b|0;c=c|0;var d=0;k[5108]=(k[5108]|0)+1;d=iF(783)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}wq(d,a,b,c);return d|0}function Dl(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;k[5108]=(k[5108]|0)+1;e=iF(783)|0;if(!e)e=0;else{k[(e+4+15&-16)+-4>>2]=e;e=e+4+15&-16}k[e+4>>2]=4;k[e+8>>2]=-1;k[e+12>>2]=-1;o[e+16>>2]=3402823466385288598117041.0e14;i[e+20>>0]=1;i[e+21>>0]=0;k[e+24>>2]=-1;k[e+28>>2]=a;k[e+32>>2]=b;o[e+36>>2]=0.0;o[e+40>>2]=.30000001192092896;k[e+44>>2]=0;k[e>>2]=3840;b=e+552|0;k[b>>2]=k[c>>2];k[b+4>>2]=k[c+4>>2];k[b+8>>2]=k[c+8>>2];k[b+12>>2]=k[c+12>>2];b=e+568|0;k[b>>2]=k[c+16>>2];k[b+4>>2]=k[c+16+4>>2];k[b+8>>2]=k[c+16+8>>2];k[b+12>>2]=k[c+16+12>>2];b=e+584|0;k[b>>2]=k[c+32>>2];k[b+4>>2]=k[c+32+4>>2];k[b+8>>2]=k[c+32+8>>2];k[b+12>>2]=k[c+32+12>>2];b=e+600|0;k[b>>2]=k[c+48>>2];k[b+4>>2]=k[c+48+4>>2];k[b+8>>2]=k[c+48+8>>2];k[b+12>>2]=k[c+48+12>>2];c=e+616|0;k[c>>2]=k[d>>2];k[c+4>>2]=k[d+4>>2];k[c+8>>2]=k[d+8>>2];k[c+12>>2]=k[d+12>>2];c=e+632|0;k[c>>2]=k[d+16>>2];k[c+4>>2]=k[d+16+4>>2];k[c+8>>2]=k[d+16+8>>2];k[c+12>>2]=k[d+16+12>>2];c=e+648|0;k[c>>2]=k[d+32>>2];k[c+4>>2]=k[d+32+4>>2];k[c+8>>2]=k[d+32+8>>2];k[c+12>>2]=k[d+32+12>>2];c=e+664|0;k[c>>2]=k[d+48>>2];k[c+4>>2]=k[d+48+4>>2];k[c+8>>2]=k[d+48+8>>2];k[c+12>>2]=k[d+48+12>>2];o[e+688>>2]=0.0;o[e+692>>2]=-1.0;o[e+696>>2]=.8999999761581421;o[e+700>>2]=.30000001192092896;o[e+704>>2]=1.0;o[e+708>>2]=0.0;o[e+712>>2]=0.0;i[e+716>>0]=0;i[e+736>>0]=0;i[e+737>>0]=0;i[e+738>>0]=0;i[e+739>>0]=1;i[e+740>>0]=0;k[e+748>>2]=0;o[e+732>>2]=1.0;return e|0}function El(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0;k[5108]=(k[5108]|0)+1;f=iF(783)|0;if(!f)f=0;else{k[(f+4+15&-16)+-4>>2]=f;f=f+4+15&-16}k[f+4>>2]=4;k[f+8>>2]=-1;k[f+12>>2]=-1;o[f+16>>2]=3402823466385288598117041.0e14;i[f+20>>0]=1;i[f+21>>0]=0;k[f+24>>2]=-1;k[f+28>>2]=a;k[f+32>>2]=b;o[f+36>>2]=0.0;o[f+40>>2]=.30000001192092896;k[f+44>>2]=0;k[f>>2]=3840;b=f+552|0;k[b>>2]=k[c>>2];k[b+4>>2]=k[c+4>>2];k[b+8>>2]=k[c+8>>2];k[b+12>>2]=k[c+12>>2];b=f+568|0;k[b>>2]=k[c+16>>2];k[b+4>>2]=k[c+16+4>>2];k[b+8>>2]=k[c+16+8>>2];k[b+12>>2]=k[c+16+12>>2];b=f+584|0;k[b>>2]=k[c+32>>2];k[b+4>>2]=k[c+32+4>>2];k[b+8>>2]=k[c+32+8>>2];k[b+12>>2]=k[c+32+12>>2];b=f+600|0;k[b>>2]=k[c+48>>2];k[b+4>>2]=k[c+48+4>>2];k[b+8>>2]=k[c+48+8>>2];k[b+12>>2]=k[c+48+12>>2];c=f+616|0;k[c>>2]=k[d>>2];k[c+4>>2]=k[d+4>>2];k[c+8>>2]=k[d+8>>2];k[c+12>>2]=k[d+12>>2];c=f+632|0;k[c>>2]=k[d+16>>2];k[c+4>>2]=k[d+16+4>>2];k[c+8>>2]=k[d+16+8>>2];k[c+12>>2]=k[d+16+12>>2];c=f+648|0;k[c>>2]=k[d+32>>2];k[c+4>>2]=k[d+32+4>>2];k[c+8>>2]=k[d+32+8>>2];k[c+12>>2]=k[d+32+12>>2];c=f+664|0;k[c>>2]=k[d+48>>2];k[c+4>>2]=k[d+48+4>>2];k[c+8>>2]=k[d+48+8>>2];k[c+12>>2]=k[d+48+12>>2];o[f+688>>2]=0.0;o[f+692>>2]=-1.0;o[f+696>>2]=.8999999761581421;o[f+700>>2]=.30000001192092896;o[f+704>>2]=1.0;o[f+708>>2]=0.0;o[f+712>>2]=0.0;i[f+716>>0]=0;i[f+736>>0]=0;i[f+737>>0]=0;i[f+738>>0]=0;i[f+739>>0]=1;i[f+740>>0]=e&1;k[f+748>>2]=0;o[f+732>>2]=e?-1.0:1.0;return f|0}function Fl(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;var g=0;k[5108]=(k[5108]|0)+1;g=iF(783)|0;if(!g)g=0;else{k[(g+4+15&-16)+-4>>2]=g;g=g+4+15&-16}vq(g,a,b,c,d,e,f,0);return g|0}function Gl(a,b,c,d,e,f,g){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;var h=0;k[5108]=(k[5108]|0)+1;h=iF(783)|0;if(!h)h=0;else{k[(h+4+15&-16)+-4>>2]=h;h=h+4+15&-16}vq(h,a,b,c,d,e,f,g);return h|0}function Hl(a,b,c,d,e){a=a|0;b=+b;c=+c;d=+d;e=+e;o[a+692>>2]=(c-b)*.5;b=+kF((c-b)*.5+b,6.2831854820251465);if(!(b<-3.1415927410125732)){if(b>3.1415927410125732)b=b+-6.2831854820251465}else b=b+6.2831854820251465;o[a+688>>2]=b;o[a+696>>2]=d;o[a+700>>2]=e;o[a+704>>2]=1.0;return}function Il(a,b,c,d,e,f){a=a|0;b=+b;c=+c;d=+d;e=+e;f=+f;o[a+692>>2]=(c-b)*.5;b=+kF((c-b)*.5+b,6.2831854820251465);if(!(b<-3.1415927410125732)){if(b>3.1415927410125732)b=b+-6.2831854820251465}else b=b+6.2831854820251465;o[a+688>>2]=b;o[a+696>>2]=d;o[a+700>>2]=e;o[a+704>>2]=f;return}function Jl(a,b,c,d){a=a|0;b=b|0;c=+c;d=+d;i[a+737>>0]=b&1;o[a+680>>2]=c;o[a+684>>2]=d;return}function Kl(a,b){a=a|0;b=b|0;i[a+21>>0]=b&1;return}function Ll(a){a=a|0;return +(+o[a+16>>2])}function Ml(a,b){a=a|0;b=+b;o[a+16>>2]=b;return}function Nl(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Ol(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function Pl(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function Ql(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Rl(){var a=0,b=0;while(1){a=iF(12)|0;if(a){b=6;break}a=k[5230]|0;k[5230]=a+0;if(!a){b=5;break}zc[a&3]()}if((b|0)==5){b=Gb(4)|0;k[b>>2]=20816;Eb(b|0,20864,207)}else if((b|0)==6){o[a>>2]=.30000001192092896;o[a+4>>2]=1.0;o[a+8>>2]=0.0;return a|0}return 0}function Sl(a){a=a|0;return +(+o[a>>2])}function Tl(a,b){a=a|0;b=+b;o[a>>2]=b;return}function Ul(a){a=a|0;return +(+o[a+4>>2])}function Vl(a,b){a=a|0;b=+b;o[a+4>>2]=b;return}function Wl(a){a=a|0;return +(+o[a+8>>2])}function Xl(a,b){a=a|0;b=+b;o[a+8>>2]=b;return}function Yl(a){a=a|0;if(!a)return;jF(a);return}function Zl(){var a=0,b=0;k[5108]=(k[5108]|0)+1;a=iF(303)|0;if(!a)a=0;else{k[(a+4+15&-16)+-4>>2]=a;a=a+4+15&-16}o[a+164>>2]=1.0;o[a+168>>2]=1.0;o[a+172>>2]=1.0;o[a+176>>2]=0.0;k[a+180>>2]=0;o[a+184>>2]=999999984306749440.0;b=a+188|0;k[b>>2]=0;k[b+4>>2]=0;k[b+8>>2]=0;k[b+12>>2]=0;k[a+204>>2]=1;k[a+208>>2]=-1;k[a+212>>2]=-1;k[a+216>>2]=1;o[a+220>>2]=0.0;o[a+224>>2]=.5;o[a+228>>2]=0.0;o[a+232>>2]=0.0;k[a+240>>2]=0;o[a+244>>2]=1.0;b=a+248|0;k[b>>2]=0;k[b+4>>2]=0;k[b+8>>2]=0;k[b+12>>2]=0;o[a+4>>2]=1.0;b=a+8|0;k[b>>2]=0;k[b+4>>2]=0;k[b+8>>2]=0;k[b+12>>2]=0;o[a+24>>2]=1.0;b=a+28|0;k[b>>2]=0;k[b+4>>2]=0;k[b+8>>2]=0;k[b+12>>2]=0;o[a+44>>2]=1.0;b=a+48|0;k[b>>2]=0;k[b+4>>2]=0;k[b+8>>2]=0;k[b+12>>2]=0;k[b+16>>2]=0;k[a>>2]=5416;i[a+280>>0]=1;k[a+276>>2]=0;k[a+268>>2]=0;k[a+272>>2]=0;k[a+236>>2]=4;return a|0}function _l(a){a=a|0;return k[a+268>>2]|0}function $l(a,b){a=a|0;b=b|0;return k[(k[a+276>>2]|0)+(b<<2)>>2]|0}function am(a,b,c){a=a|0;b=b|0;c=c|0;k[a+164>>2]=k[b>>2];k[a+164+4>>2]=k[b+4>>2];k[a+164+8>>2]=k[b+8>>2];k[a+164+12>>2]=k[b+12>>2];if((!(+o[b>>2]!=1.0)?!(+o[b+4>>2]!=1.0):0)?!(+o[b+8>>2]!=1.0):0){c=0;a=a+180|0;k[a>>2]=c;return}a=a+180|0;k[a>>2]=c;return}function bm(a){a=a|0;return k[a+192>>2]|0}function cm(a,b){a=a|0;b=+b;o[a+184>>2]=b;return}function dm(a,b){a=a|0;b=b|0;if((k[a+216>>2]&-2|0)==4)return;k[a+216>>2]=b;return}function em(a,b){a=a|0;b=b|0;k[a+216>>2]=b;return}function fm(a){a=a|0;if(k[a+204>>2]&3)return;if((k[a+216>>2]&-2|0)!=4)k[a+216>>2]=1;o[a+220>>2]=0.0;return}function gm(a,b){a=a|0;b=b|0;if(!b?(k[a+204>>2]&3|0)!=0:0)return;if((k[a+216>>2]&-2|0)!=4)k[a+216>>2]=1;o[a+220>>2]=0.0;return}function hm(a){a=a|0;a=k[a+216>>2]|0;return ((a|0)==2?0:(a|0)!=5)|0}function im(a){a=a|0;return (k[a+204>>2]&2|0)!=0|0}function jm(a,b){a=a|0;b=+b;k[a+260>>2]=(k[a+260>>2]|0)+1;o[a+228>>2]=b;return}function km(a,b){a=a|0;b=+b;k[a+260>>2]=(k[a+260>>2]|0)+1;o[a+224>>2]=b;return}function lm(a,b){a=a|0;b=+b;k[a+260>>2]=(k[a+260>>2]|0)+1;o[a+232>>2]=b;return}function mm(a){a=a|0;return a+4|0}function nm(a){a=a|0;return k[a+204>>2]|0}function om(a,b){a=a|0;b=b|0;k[a+204>>2]=b;return}function pm(a,b){a=a|0;b=b|0;k[a+260>>2]=(k[a+260>>2]|0)+1;k[a+4>>2]=k[b>>2];k[a+4+4>>2]=k[b+4>>2];k[a+4+8>>2]=k[b+8>>2];k[a+4+12>>2]=k[b+12>>2];k[a+20>>2]=k[b+16>>2];k[a+20+4>>2]=k[b+16+4>>2];k[a+20+8>>2]=k[b+16+8>>2];k[a+20+12>>2]=k[b+16+12>>2];k[a+36>>2]=k[b+32>>2];k[a+36+4>>2]=k[b+32+4>>2];k[a+36+8>>2]=k[b+32+8>>2];k[a+36+12>>2]=k[b+32+12>>2];k[a+52>>2]=k[b+48>>2];k[a+52+4>>2]=k[b+48+4>>2];k[a+52+8>>2]=k[b+48+8>>2];k[a+52+12>>2]=k[b+48+12>>2];return}function qm(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+12>>2]&127](a,b);return}function rm(a,b){a=a|0;b=+b;o[a+252>>2]=b;return}function sm(a,b){a=a|0;b=+b;o[a+248>>2]=b;return}function tm(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+8>>2]&255](a);return}function um(a){a=a|0;return k[a>>2]|0}function vm(a,b){a=a|0;b=b|0;k[a>>2]=b;return}function wm(a){a=a|0;return k[a+4>>2]|0}function xm(a,b){a=a|0;b=b|0;k[a+4>>2]=b;return}function ym(a){a=a|0;if(!a)return;jF(a);return}function zm(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Am(a,b,c){a=a|0;b=b|0;c=c|0;var d=0;k[5108]=(k[5108]|0)+1;d=iF(1407)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}Pp(d,a,b,c);k[d>>2]=2640;k[d+4>>2]=9;i[d+1309>>0]=0;o[d+1316>>2]=0.0;o[d+1340>>2]=0.0;o[d+1364>>2]=1.0;i[d+1310>>0]=0;o[d+1320>>2]=0.0;o[d+1344>>2]=0.0;o[d+1368>>2]=1.0;i[d+1311>>0]=0;o[d+1324>>2]=0.0;o[d+1348>>2]=0.0;o[d+1372>>2]=1.0;i[d+1312>>0]=0;o[d+1328>>2]=0.0;o[d+1352>>2]=0.0;o[d+1376>>2]=1.0;i[d+1313>>0]=0;o[d+1332>>2]=0.0;o[d+1356>>2]=0.0;o[d+1380>>2]=1.0;i[d+1314>>0]=0;o[d+1336>>2]=0.0;o[d+1360>>2]=0.0;o[d+1384>>2]=1.0;return d|0}function Bm(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0;k[5108]=(k[5108]|0)+1;f=iF(1407)|0;if(!f)f=0;else{k[(f+4+15&-16)+-4>>2]=f;f=f+4+15&-16}Op(f,a,b,c,d,e);k[f>>2]=2640;k[f+4>>2]=9;i[f+1309>>0]=0;o[f+1316>>2]=0.0;o[f+1340>>2]=0.0;o[f+1364>>2]=1.0;i[f+1310>>0]=0;o[f+1320>>2]=0.0;o[f+1344>>2]=0.0;o[f+1368>>2]=1.0;i[f+1311>>0]=0;o[f+1324>>2]=0.0;o[f+1348>>2]=0.0;o[f+1372>>2]=1.0;i[f+1312>>0]=0;o[f+1328>>2]=0.0;o[f+1352>>2]=0.0;o[f+1376>>2]=1.0;i[f+1313>>0]=0;o[f+1332>>2]=0.0;o[f+1356>>2]=0.0;o[f+1380>>2]=1.0;i[f+1314>>0]=0;o[f+1336>>2]=0.0;o[f+1360>>2]=0.0;o[f+1384>>2]=1.0;return f|0}function Cm(a,b,c){a=a|0;b=b|0;c=c|0;i[a+1309+b>>0]=c&1;if((b|0)<3){i[a+788+b>>0]=c&1;return}else{i[a+868+(b+-3<<6)+44>>0]=c&1;return}}function Dm(a,b,c){a=a|0;b=b|0;c=+c;o[a+1340+(b<<2)>>2]=c;return}function Em(a,b,c){a=a|0;b=b|0;c=+c;o[a+1364+(b<<2)>>2]=c;return}function Fm(a,b){a=a|0;b=b|0;k[a+680>>2]=k[b>>2];k[a+680+4>>2]=k[b+4>>2];k[a+680+8>>2]=k[b+8>>2];k[a+680+12>>2]=k[b+12>>2];return}function Gm(a,b){a=a|0;b=b|0;k[a+696>>2]=k[b>>2];k[a+696+4>>2]=k[b+4>>2];k[a+696+8>>2]=k[b+8>>2];k[a+696+12>>2]=k[b+12>>2];return}function Hm(a,b){a=a|0;b=b|0;var c=0.0,d=0;d=0;while(1){if((d|0)==3)break;c=+kF(+o[b+(d<<2)>>2],6.2831854820251465);if(!(c<-3.1415927410125732)){if(c>3.1415927410125732)c=c+-6.2831854820251465}else c=c+6.2831854820251465;o[a+868+(d<<6)>>2]=c;d=d+1|0}return}function Im(a,b){a=a|0;b=b|0;var c=0.0,d=0;d=0;while(1){if((d|0)==3)break;c=+kF(+o[b+(d<<2)>>2],6.2831854820251465);if(!(c<-3.1415927410125732)){if(c>3.1415927410125732)c=c+-6.2831854820251465}else c=c+6.2831854820251465;o[a+868+(d<<6)+4>>2]=c;d=d+1|0}return}function Jm(a,b){a=a|0;b=b|0;i[a+21>>0]=b&1;return}function Km(a){a=a|0;return +(+o[a+16>>2])}function Lm(a,b){a=a|0;b=+b;o[a+16>>2]=b;return}function Mm(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Nm(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=+e;var f=0,g=0;while(1){f=iF(44)|0;if(f){g=6;break}f=k[5230]|0;k[5230]=f+0;if(!f){g=5;break}zc[f&3]()}if((g|0)==5){d=Gb(4)|0;k[d>>2]=20816;Eb(d|0,20864,207)}else if((g|0)==6){k[f>>2]=a;k[f+4>>2]=b;k[f+8>>2]=k[c>>2];k[f+8+4>>2]=k[c+4>>2];k[f+8+8>>2]=k[c+8>>2];k[f+8+12>>2]=k[c+12>>2];k[f+24>>2]=k[d>>2];k[f+24+4>>2]=k[d+4>>2];k[f+24+8>>2]=k[d+8>>2];k[f+24+12>>2]=k[d+12>>2];o[f+40>>2]=e;return f|0}return 0}function Om(a){a=a|0;return k[a>>2]|0}function Pm(a,b){a=a|0;b=b|0;k[a>>2]=b;return}function Qm(a){a=a|0;return k[a+4>>2]|0}function Rm(a,b){a=a|0;b=b|0;k[a+4>>2]=b;return}function Sm(a){a=a|0;return a+8|0}function Tm(a,b){a=a|0;b=b|0;k[a+8>>2]=k[b>>2];k[a+8+4>>2]=k[b+4>>2];k[a+8+8>>2]=k[b+8>>2];k[a+8+12>>2]=k[b+12>>2];return}function Um(a){a=a|0;return a+24|0}function Vm(a,b){a=a|0;b=b|0;k[a+24>>2]=k[b>>2];k[a+24+4>>2]=k[b+4>>2];k[a+24+8>>2]=k[b+8>>2];k[a+24+12>>2]=k[b+12>>2];return}function Wm(a){a=a|0;return +(+o[a+40>>2])}function Xm(a,b){a=a|0;b=+b;o[a+40>>2]=b;return}function Ym(a){a=a|0;if(!a)return;jF(a);return}function Zm(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function _m(a){a=a|0;var b=0,c=0;k[5108]=(k[5108]|0)+1;b=iF(635)|0;if(!b)b=0;else{k[(b+4+15&-16)+-4>>2]=b;b=b+4+15&-16}o[b+164>>2]=1.0;o[b+168>>2]=1.0;o[b+172>>2]=1.0;o[b+176>>2]=0.0;k[b+180>>2]=0;o[b+184>>2]=999999984306749440.0;c=b+188|0;k[c>>2]=0;k[c+4>>2]=0;k[c+8>>2]=0;k[c+12>>2]=0;k[b+204>>2]=1;k[b+208>>2]=-1;k[b+212>>2]=-1;k[b+216>>2]=1;o[b+220>>2]=0.0;o[b+224>>2]=.5;o[b+228>>2]=0.0;o[b+232>>2]=0.0;k[b+236>>2]=1;k[b+240>>2]=0;o[b+244>>2]=1.0;c=b+248|0;k[c>>2]=0;k[c+4>>2]=0;k[c+8>>2]=0;k[c+12>>2]=0;o[b+4>>2]=1.0;c=b+8|0;k[c>>2]=0;k[c+4>>2]=0;k[c+8>>2]=0;k[c+12>>2]=0;o[b+24>>2]=1.0;c=b+28|0;k[c>>2]=0;k[c+4>>2]=0;k[c+8>>2]=0;k[c+12>>2]=0;o[b+44>>2]=1.0;c=b+48|0;k[c>>2]=0;k[c+4>>2]=0;k[c+8>>2]=0;k[c+12>>2]=0;k[c+16>>2]=0;k[b>>2]=1464;i[b+500>>0]=1;k[b+496>>2]=0;k[b+488>>2]=0;k[b+492>>2]=0;Zo(b,a);return b|0}function $m(a){a=a|0;return a+4|0}function an(a,b){a=a|0;b=b|0;$o(a,b);return}function bn(a,b,c){a=a|0;b=+b;c=+c;o[a+472>>2]=b;o[a+476>>2]=c;return}function cn(a,b,c){a=a|0;b=+b;c=+c;if(b<0.0)b=0.0;else b=b>1.0?1.0:b;o[a+444>>2]=b;if(c<0.0)b=0.0;else b=c>1.0?1.0:c;o[a+448>>2]=b;return}function dn(a,b,c){a=a|0;b=+b;c=c|0;var d=0,e=0.0,f=0.0,g=0.0;d=k[a+204>>2]|0;if(b==0.0){k[a+204>>2]=d|1;g=0.0}else{k[a+204>>2]=d&-2;g=1.0/b}o[a+344>>2]=g;e=+o[a+384>>2]*b;f=+o[a+388>>2]*b;o[a+364>>2]=+o[a+380>>2]*b;o[a+368>>2]=e;o[a+372>>2]=f;o[a+376>>2]=0.0;b=+o[c>>2];if(b!=0.0)f=1.0/b;else f=0.0;b=+o[c+4>>2];if(b!=0.0)e=1.0/b;else e=0.0;b=+o[c+8>>2];if(b!=0.0)b=1.0/b;else b=0.0;o[a+396>>2]=f;o[a+400>>2]=e;o[a+404>>2]=b;o[a+408>>2]=0.0;e=g*+o[a+352>>2];f=g*+o[a+356>>2];o[a+560>>2]=+o[a+348>>2]*g;o[a+564>>2]=e;o[a+568>>2]=f;o[a+572>>2]=0.0;return}function en(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0.0;k[a+348>>2]=k[b>>2];k[a+348+4>>2]=k[b+4>>2];k[a+348+8>>2]=k[b+8>>2];k[a+348+12>>2]=k[b+12>>2];e=+o[a+344>>2];d=+o[a+352>>2]*e;c=+o[a+356>>2]*e;o[a+560>>2]=+o[a+348>>2]*e;o[a+564>>2]=d;o[a+568>>2]=c;o[a+572>>2]=0.0;return}function fn(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0.0;c=+o[a+344>>2];if(c!=0.0){e=1.0/c*+o[b+4>>2];d=1.0/c*+o[b+8>>2];o[a+364>>2]=1.0/c*+o[b>>2];o[a+368>>2]=e;o[a+372>>2]=d;o[a+376>>2]=0.0}k[a+380>>2]=k[b>>2];k[a+380+4>>2]=k[b+4>>2];k[a+380+8>>2]=k[b+8>>2];k[a+380+12>>2]=k[b+12>>2];return}function gn(a,b){a=a|0;b=b|0;var c=0.0,d=0.0;d=+o[b+4>>2]*+o[a+548>>2];c=+o[b+8>>2]*+o[a+552>>2];o[a+428>>2]=+o[a+428>>2]+ +o[b>>2]*+o[a+544>>2];o[a+432>>2]=+o[a+432>>2]+d;o[a+436>>2]=+o[a+436>>2]+c;return}function hn(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0;d=+o[a+348>>2];f=+o[a+352>>2];g=+o[b+4>>2]*f;h=+o[a+356>>2];i=+o[b+8>>2]*h;o[a+412>>2]=+o[a+412>>2]+ +o[b>>2]*d;o[a+416>>2]=+o[a+416>>2]+g;o[a+420>>2]=+o[a+420>>2]+i;d=+o[b>>2]*d;f=+o[b+4>>2]*f;h=+o[b+8>>2]*h;i=+o[c+4>>2];g=+o[c+8>>2];j=+o[c>>2];e=(g*d-j*h)*+o[a+548>>2];d=(j*f-i*d)*+o[a+552>>2];o[a+428>>2]=+o[a+428>>2]+(i*h-g*f)*+o[a+544>>2];o[a+432>>2]=+o[a+432>>2]+e;o[a+436>>2]=+o[a+436>>2]+d;return}function jn(a,b){a=a|0;b=b|0;var c=0.0,d=0.0;d=+o[b+4>>2]*+o[a+352>>2];c=+o[b+8>>2]*+o[a+356>>2];o[a+412>>2]=+o[a+412>>2]+ +o[b>>2]*+o[a+348>>2];o[a+416>>2]=+o[a+416>>2]+d;o[a+420>>2]=+o[a+420>>2]+c;return}function kn(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0.0,f=0.0,g=0.0;g=+o[b>>2];f=+o[b+4>>2];e=+o[b+8>>2];d=(+o[a+280>>2]*g+ +o[a+284>>2]*f+ +o[a+288>>2]*e)*+o[a+548>>2];c=(+o[a+296>>2]*g+ +o[a+300>>2]*f+ +o[a+304>>2]*e)*+o[a+552>>2];o[a+328>>2]=+o[a+328>>2]+(+o[a+264>>2]*g+ +o[a+268>>2]*f+ +o[a+272>>2]*e)*+o[a+544>>2];o[a+332>>2]=+o[a+332>>2]+d;o[a+336>>2]=+o[a+336>>2]+c;return}function ln(a,b,c){a=a|0;b=b|0;c=c|0;Nw(a,b,c);return}function mn(a,b){a=a|0;b=b|0;Ow(a,b);return}function nn(a){a=a|0;var b=0.0,c=0.0,d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,k=0.0,l=0.0,m=0.0;m=+o[a+4>>2];g=+o[a+396>>2];l=+o[a+8>>2];e=+o[a+400>>2];k=+o[a+12>>2];c=+o[a+404>>2];j=+o[a+20>>2];i=+o[a+24>>2];h=+o[a+28>>2];f=+o[a+36>>2];d=+o[a+40>>2];b=+o[a+44>>2];o[a+264>>2]=m*(m*g)+l*(l*e)+k*(k*c);o[a+268>>2]=m*g*j+l*e*i+k*c*h;o[a+272>>2]=m*g*f+l*e*d+k*c*b;o[a+276>>2]=0.0;o[a+280>>2]=m*(g*j)+l*(e*i)+k*(c*h);o[a+284>>2]=j*(g*j)+i*(e*i)+h*(c*h);o[a+288>>2]=g*j*f+e*i*d+c*h*b;o[a+292>>2]=0.0;o[a+296>>2]=m*(g*f)+l*(e*d)+k*(c*b);o[a+300>>2]=j*(g*f)+i*(e*d)+h*(c*b);o[a+304>>2]=f*(g*f)+d*(e*d)+b*(c*b);o[a+308>>2]=0.0;return}function on(a){a=a|0;return a+312|0}function pn(a){a=a|0;return a+328|0}function qn(a){a=a|0;return a+380|0}function rn(a,b){a=a|0;b=b|0;k[a+260>>2]=(k[a+260>>2]|0)+1;k[a+312>>2]=k[b>>2];k[a+312+4>>2]=k[b+4>>2];k[a+312+8>>2]=k[b+8>>2];k[a+312+12>>2]=k[b+12>>2];return}function sn(a,b){a=a|0;b=b|0;k[a+260>>2]=(k[a+260>>2]|0)+1;k[a+328>>2]=k[b>>2];k[a+328+4>>2]=k[b+4>>2];k[a+328+8>>2]=k[b+8>>2];k[a+328+12>>2]=k[b+12>>2];return}function tn(a){a=a|0;return k[a+480>>2]|0}function un(a,b){a=a|0;b=b|0;k[a+260>>2]=(k[a+260>>2]|0)+1;k[a+544>>2]=k[b>>2];k[a+544+4>>2]=k[b+4>>2];k[a+544+8>>2]=k[b+8>>2];k[a+544+12>>2]=k[b+12>>2];return}function vn(a,b){a=a|0;b=b|0;return ((k[b+236>>2]&2|0)==0?0:b)|0}function wn(a,b,c){a=a|0;b=b|0;c=c|0;k[a+164>>2]=k[b>>2];k[a+164+4>>2]=k[b+4>>2];k[a+164+8>>2]=k[b+8>>2];k[a+164+12>>2]=k[b+12>>2];if((!(+o[b>>2]!=1.0)?!(+o[b+4>>2]!=1.0):0)?!(+o[b+8>>2]!=1.0):0){c=0;a=a+180|0;k[a>>2]=c;return}a=a+180|0;k[a>>2]=c;return}function xn(a){a=a|0;return k[a+192>>2]|0}function yn(a,b){a=a|0;b=+b;o[a+184>>2]=b;return}function zn(a,b){a=a|0;b=b|0;if((k[a+216>>2]&-2|0)==4)return;k[a+216>>2]=b;return}function An(a,b){a=a|0;b=b|0;k[a+216>>2]=b;return}function Bn(a){a=a|0;if(k[a+204>>2]&3)return;if((k[a+216>>2]&-2|0)!=4)k[a+216>>2]=1;o[a+220>>2]=0.0;return}function Cn(a,b){a=a|0;b=b|0;if(!b?(k[a+204>>2]&3|0)!=0:0)return;if((k[a+216>>2]&-2|0)!=4)k[a+216>>2]=1;o[a+220>>2]=0.0;return}function Dn(a){a=a|0;a=k[a+216>>2]|0;return ((a|0)==2?0:(a|0)!=5)|0}function En(a){a=a|0;return (k[a+204>>2]&2|0)!=0|0}function Fn(a,b){a=a|0;b=+b;k[a+260>>2]=(k[a+260>>2]|0)+1;o[a+228>>2]=b;return}function Gn(a,b){a=a|0;b=+b;k[a+260>>2]=(k[a+260>>2]|0)+1;o[a+224>>2]=b;return}function Hn(a,b){a=a|0;b=+b;k[a+260>>2]=(k[a+260>>2]|0)+1;o[a+232>>2]=b;return}function In(a){a=a|0;return a+4|0}function Jn(a){a=a|0;return k[a+204>>2]|0}function Kn(a,b){a=a|0;b=b|0;k[a+204>>2]=b;return}function Ln(a,b){a=a|0;b=b|0;k[a+260>>2]=(k[a+260>>2]|0)+1;k[a+4>>2]=k[b>>2];k[a+4+4>>2]=k[b+4>>2];k[a+4+8>>2]=k[b+8>>2];k[a+4+12>>2]=k[b+12>>2];k[a+20>>2]=k[b+16>>2];k[a+20+4>>2]=k[b+16+4>>2];k[a+20+8>>2]=k[b+16+8>>2];k[a+20+12>>2]=k[b+16+12>>2];k[a+36>>2]=k[b+32>>2];k[a+36+4>>2]=k[b+32+4>>2];k[a+36+8>>2]=k[b+32+8>>2];k[a+36+12>>2]=k[b+32+12>>2];k[a+52>>2]=k[b+48>>2];k[a+52+4>>2]=k[b+48+4>>2];k[a+52+8>>2]=k[b+48+8>>2];k[a+52+12>>2]=k[b+48+12>>2];return}function Mn(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+12>>2]&127](a,b);return}function Nn(a,b){a=a|0;b=+b;o[a+252>>2]=b;return}function On(a,b){a=a|0;b=+b;o[a+248>>2]=b;return}function Pn(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+8>>2]&255](a);return}function Qn(a){a=a|0;var b=0;k[5108]=(k[5108]|0)+1;b=iF(75)|0;if(!b)b=0;else{k[(b+4+15&-16)+-4>>2]=b;b=b+4+15&-16}Ou(b,a);k[b>>2]=15552;k[b+52>>2]=0;return b|0}function Rn(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function Sn(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function Tn(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Un(a){a=a|0;var b=0;k[5108]=(k[5108]|0)+1;b=iF(75)|0;if(!b)b=0;else{k[(b+4+15&-16)+-4>>2]=b;b=b+4+15&-16}Ou(b,a);k[b>>2]=15656;k[b+52>>2]=2;return b|0}function Vn(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function Wn(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function Xn(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Yn(){var a=0,b=0;while(1){a=iF(64)|0;if(a){b=6;break}a=k[5230]|0;k[5230]=a+0;if(!a){b=5;break}zc[a&3]()}if((b|0)==5){b=Gb(4)|0;k[b>>2]=20816;Eb(b|0,20864,207)}else if((b|0)==6)return a|0;return 0}function Zn(a,b){a=a|0;b=b|0;var c=0,d=0;while(1){c=iF(64)|0;if(c){d=6;break}c=k[5230]|0;k[5230]=c+0;if(!c){d=5;break}zc[c&3]()}if((d|0)==5){b=Gb(4)|0;k[b>>2]=20816;Eb(b|0,20864,207)}else if((d|0)==6){EE(c,a);k[c+48>>2]=k[b>>2];k[c+48+4>>2]=k[b+4>>2];k[c+48+8>>2]=k[b+8>>2];k[c+48+12>>2]=k[b+12>>2];return c|0}return 0}function _n(a){a=a|0;Pw(a);return}function $n(a,b){a=a|0;b=b|0;k[a+48>>2]=k[b>>2];k[a+48+4>>2]=k[b+4>>2];k[a+48+8>>2]=k[b+8>>2];k[a+48+12>>2]=k[b+12>>2];return}function ao(a,b){a=a|0;b=b|0;EE(a,b);return}function bo(a){a=a|0;return a+48|0}function co(a){a=a|0;var b=0;b=r;r=r+16|0;if((i[240]|0)==0?(db(240)|0)!=0:0)ib(240);Jw(a,b);k[56]=k[b>>2];k[57]=k[b+4>>2];k[58]=k[b+8>>2];k[59]=k[b+12>>2];r=b;return 224}function eo(a){a=a|0;return a|0}function fo(a){a=a|0;if(!a)return;jF(a);return}function go(a){a=a|0;return k[a+24>>2]|0}function ho(a){a=a|0;Sb[k[(k[a>>2]|0)+12>>2]&255](a);return}function io(a){a=a|0;Sb[k[(k[a>>2]|0)+44>>2]&255](a);return}function jo(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;Cc[k[(k[a>>2]|0)+32>>2]&127](a,b,c,d);return}function ko(a){a=a|0;a=k[a+68>>2]|0;return Wb[k[(k[a>>2]|0)+36>>2]&127](a)|0}function lo(a){a=a|0;return a+28|0}function mo(a,b){a=a|0;b=b|0;Cc[k[(k[a>>2]|0)+36>>2]&127](a,b,1,-1);return}function no(a,b,c){a=a|0;b=b|0;c=c|0;Cc[k[(k[a>>2]|0)+36>>2]&127](a,b,c,-1);return}function oo(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;Cc[k[(k[a>>2]|0)+36>>2]&127](a,b,c,d);return}function po(a){a=a|0;return k[a+68>>2]|0}function qo(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=+f;ws(a,b,c,d,e,f);return}function ro(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;xs(a,b,c,d);return}function so(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function to(a){a=a|0;return +(+o[a>>2])}function uo(a){a=a|0;return +(+o[a+4>>2])}function vo(a){a=a|0;return +(+o[a+8>>2])}function wo(a){a=a|0;return +(+o[a+12>>2])}function xo(a,b){a=a|0;b=+b;o[a>>2]=b;return}function yo(a,b){a=a|0;b=+b;o[a+4>>2]=b;return}function zo(a,b){a=a|0;b=+b;o[a+8>>2]=b;return}function Ao(a,b){a=a|0;b=+b;o[a+12>>2]=b;return}function Bo(a){a=a|0;if(!a)return;jF(a);return}function Co(a,b,c){a=a|0;b=b|0;c=c|0;var d=0;while(1){a=iF(152)|0;if(a){d=6;break}a=k[5230]|0;k[5230]=a+0;if(!a){d=5;break}zc[a&3]()}if((d|0)==5){c=Gb(4)|0;k[c>>2]=20816;Eb(c|0,20864,207)}else if((d|0)==6){k[a>>2]=4840;i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;i[a+40>>0]=1;k[a+36>>2]=0;k[a+28>>2]=0;k[a+32>>2]=0;i[a+60>>0]=1;k[a+56>>2]=0;k[a+48>>2]=0;k[a+52>>2]=0;i[a+80>>0]=1;k[a+76>>2]=0;k[a+68>>2]=0;k[a+72>>2]=0;k[a+100>>2]=c;o[a+104>>2]=0.0;i[a+148>>0]=1;k[a+144>>2]=0;k[a+136>>2]=0;k[a+140>>2]=0;k[a+116>>2]=b;k[a+120>>2]=0;k[a+124>>2]=2;k[a+128>>2]=1;o[a+112>>2]=0.0;o[a+108>>2]=0.0;return a|0}return 0}function Do(a,b,c){a=a|0;b=+b;c=c|0;o[(k[a+144>>2]|0)+(c*284|0)+252>>2]=b;return}function Eo(a,b,c){a=a|0;b=+b;c=c|0;o[(k[a+144>>2]|0)+(c*284|0)+232>>2]=b;return}function Fo(a,b){a=a|0;b=b|0;return (k[a+144>>2]|0)+(b*284|0)+92|0}function Go(a,b,c){a=a|0;b=b|0;c=c|0;Yq(k[a+116>>2]|0,k[a+144>>2]|0,b,c);return}function Ho(a,b,c,d,e,f,g,h){a=a|0;b=b|0;c=c|0;d=d|0;e=+e;f=+f;g=g|0;h=h|0;var j=0,l=0,m=0,n=0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0;w=r;r=r+288|0;k[w+208>>2]=k[b>>2];k[w+208+4>>2]=k[b+4>>2];k[w+208+8>>2]=k[b+8>>2];k[w+208+12>>2]=k[b+12>>2];m=w+208+16|0;k[m>>2]=k[c>>2];k[m+4>>2]=k[c+4>>2];k[m+8>>2]=k[c+8>>2];k[m+12>>2]=k[c+12>>2];c=w+208+32|0;k[c>>2]=k[d>>2];k[c+4>>2]=k[d+4>>2];k[c+8>>2]=k[d+8>>2];k[c+12>>2]=k[d+12>>2];s=+o[g>>2];t=+o[g+4>>2];u=+o[g+8>>2];v=+o[g+16>>2];q=+o[g+12>>2];p=+o[g+20>>2];k[w>>2]=k[w+208>>2];k[w+4>>2]=k[w+208+4>>2];k[w+8>>2]=k[w+208+8>>2];k[w+12>>2]=k[w+208+12>>2];k[w+16>>2]=k[m>>2];k[w+16+4>>2]=k[m+4>>2];k[w+16+8>>2]=k[m+8>>2];k[w+16+12>>2]=k[m+12>>2];k[w+32>>2]=k[c>>2];k[w+32+4>>2]=k[c+4>>2];k[w+32+8>>2]=k[c+8>>2];k[w+32+12>>2]=k[c+12>>2];c=k[a+136>>2]|0;if((c|0)==(k[a+140>>2]|0)?(n=(c|0)==0?1:c<<1,(c|0)<(n|0)):0){if(!n)d=0;else{k[5108]=(k[5108]|0)+1;d=iF((n*284|3)+16|0)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}c=k[a+136>>2]|0}if((c|0)>0){c=c+-1|0;j=0;while(1){g=d+(j*284|0)|0;if(g){b=k[a+144>>2]|0;l=b+(j*284|0)|0;m=g+92|0;do{k[g>>2]=k[l>>2];g=g+4|0;l=l+4|0}while((g|0)<(m|0));g=d+(j*284|0)+92|0;l=b+(j*284|0)+92|0;k[g>>2]=k[l>>2];k[g+4>>2]=k[l+4>>2];k[g+8>>2]=k[l+8>>2];k[g+12>>2]=k[l+12>>2];g=d+(j*284|0)+108|0;l=b+(j*284|0)+108|0;k[g>>2]=k[l>>2];k[g+4>>2]=k[l+4>>2];k[g+8>>2]=k[l+8>>2];k[g+12>>2]=k[l+12>>2];g=d+(j*284|0)+124|0;l=b+(j*284|0)+124|0;k[g>>2]=k[l>>2];k[g+4>>2]=k[l+4>>2];k[g+8>>2]=k[l+8>>2];k[g+12>>2]=k[l+12>>2];g=d+(j*284|0)+140|0;l=b+(j*284|0)+140|0;k[g>>2]=k[l>>2];k[g+4>>2]=k[l+4>>2];k[g+8>>2]=k[l+8>>2];k[g+12>>2]=k[l+12>>2];g=d+(j*284|0)+156|0;l=b+(j*284|0)+156|0;m=g+128|0;do{k[g>>2]=k[l>>2];g=g+4|0;l=l+4|0}while((g|0)<(m|0))}if((j|0)==(c|0))break;else j=j+1|0}}c=k[a+144>>2]|0;if(c){if(i[a+148>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[a+144>>2]=0}i[a+148>>0]=1;k[a+144>>2]=d;k[a+140>>2]=n;c=k[a+136>>2]|0}b=k[a+144>>2]|0;d=b+(c*284|0)|0;if(!d){n=c;h=b;m=n+1|0;k[a+136>>2]=m;n=h+(n*284|0)|0;h=a+116|0;m=k[h>>2]|0;Xq(m,n,0);m=k[a+136>>2]|0;m=m+-1|0;h=k[h>>2]|0;a=k[a+144>>2]|0;Yq(h,a,m,0);r=w;return n|0}g=d;l=w+48|0;m=g+92|0;do{k[g>>2]=k[l>>2];g=g+4|0;l=l+4|0}while((g|0)<(m|0));d=b+(c*284|0)+92|0;k[d>>2]=k[w+160>>2];k[d+4>>2]=k[w+160+4>>2];k[d+8>>2]=k[w+160+8>>2];k[d+12>>2]=k[w+160+12>>2];d=b+(c*284|0)+108|0;k[d>>2]=k[w+176>>2];k[d+4>>2]=k[w+176+4>>2];k[d+8>>2]=k[w+176+8>>2];k[d+12>>2]=k[w+176+12>>2];d=b+(c*284|0)+124|0;k[d>>2]=k[w+192>>2];k[d+4>>2]=k[w+192+4>>2];k[d+8>>2]=k[w+192+8>>2];k[d+12>>2]=k[w+192+12>>2];d=b+(c*284|0)+140|0;k[d>>2]=k[w+144>>2];k[d+4>>2]=k[w+144+4>>2];k[d+8>>2]=k[w+144+8>>2];k[d+12>>2]=k[w+144+12>>2];d=b+(c*284|0)+156|0;g=d;l=w;m=g+48|0;do{k[g>>2]=k[l>>2];g=g+4|0;l=l+4|0}while((g|0)<(m|0));o[d+48>>2]=e;o[d+52>>2]=q;o[d+56>>2]=f;o[d+60>>2]=s;o[d+64>>2]=t;o[d+68>>2]=u;o[d+72>>2]=v;o[d+76>>2]=0.0;o[d+80>>2]=0.0;o[d+84>>2]=0.0;o[d+88>>2]=.10000000149011612;o[d+92>>2]=p;o[d+96>>2]=0.0;o[d+100>>2]=0.0;i[d+104>>0]=h&1;g=d+105|0;l=w+256|0;m=g+23|0;do{i[g>>0]=i[l>>0]|0;g=g+1|0;l=l+1|0}while((g|0)<(m|0));n=k[a+136>>2]|0;h=k[a+144>>2]|0;m=n+1|0;k[a+136>>2]=m;n=h+(n*284|0)|0;h=a+116|0;m=k[h>>2]|0;Xq(m,n,0);m=k[a+136>>2]|0;m=m+-1|0;h=k[h>>2]|0;a=k[a+144>>2]|0;Yq(h,a,m,0);r=w;return n|0}function Io(a){a=a|0;return k[a+136>>2]|0}function Jo(a){a=a|0;return k[a+116>>2]|0}function Ko(a,b){a=a|0;b=b|0;return (k[a+144>>2]|0)+(b*284|0)|0}function Lo(a,b,c){a=a|0;b=+b;c=c|0;o[(k[a+144>>2]|0)+(c*284|0)+256>>2]=b;return}function Mo(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;Cc[k[(k[a>>2]|0)+24>>2]&127](a,b,c,d);return}function No(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Oo(a){a=a|0;var b=0;k[5108]=(k[5108]|0)+1;b=iF(75)|0;if(!b)b=0;else{k[(b+4+15&-16)+-4>>2]=b;b=b+4+15&-16}Ou(b,a);return b|0}function Po(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);return}function Qo(a,b,c){a=a|0;b=+b;c=c|0;$b[k[(k[a>>2]|0)+32>>2]&15](a,b,c);return}function Ro(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function So(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function To(){var a=0,b=0;while(1){a=iF(4)|0;if(a){b=6;break}a=k[5230]|0;k[5230]=a+0;if(!a){b=5;break}zc[a&3]()}if((b|0)==5){b=Gb(4)|0;k[b>>2]=20816;Eb(b|0,20864,207)}else if((b|0)==6){k[a>>2]=384;return a|0}return 0}function Uo(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Vo(a,b){a=a|0;b=b|0;i[a+21>>0]=b&1;return}function Wo(a){a=a|0;return +(+o[a+16>>2])}function Xo(a,b){a=a|0;b=+b;o[a+16>>2]=b;return}function Yo(a){a=a|0;if(!a)return;Sb[k[(k[a>>2]|0)+4>>2]&255](a);return}function Zo(a,b){a=a|0;b=b|0;var c=0.0,d=0,e=0,f=0.0,g=0,h=0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0;k[a+236>>2]=2;k[a+312>>2]=0;k[a+312+4>>2]=0;k[a+312+8>>2]=0;k[a+312+12>>2]=0;k[a+312+16>>2]=0;k[a+312+20>>2]=0;k[a+312+24>>2]=0;k[a+312+28>>2]=0;o[a+544>>2]=1.0;o[a+548>>2]=1.0;o[a+552>>2]=1.0;o[a+556>>2]=0.0;o[a+348>>2]=1.0;o[a+352>>2]=1.0;o[a+356>>2]=1.0;d=a+360|0;e=d+36|0;do{k[d>>2]=0;d=d+4|0}while((d|0)<(e|0));k[a+412>>2]=0;k[a+412+4>>2]=0;k[a+412+8>>2]=0;k[a+412+12>>2]=0;k[a+412+16>>2]=0;k[a+412+20>>2]=0;k[a+412+24>>2]=0;k[a+412+28>>2]=0;c=+o[b+92>>2];f=+o[b+96>>2];if(c<0.0)c=0.0;else c=c>1.0?1.0:c;o[a+444>>2]=c;if(f<0.0)c=0.0;else c=f>1.0?1.0:f;o[a+448>>2]=c;o[a+472>>2]=+o[b+112>>2];o[a+476>>2]=+o[b+116>>2];d=k[b+4>>2]|0;k[a+480>>2]=d;k[a+608>>2]=0;k[a+612>>2]=0;i[a+452>>0]=i[b+120>>0]|0;o[a+456>>2]=+o[b+124>>2];o[a+460>>2]=+o[b+128>>2];o[a+464>>2]=+o[b+132>>2];o[a+468>>2]=+o[b+136>>2];if(!d){k[a+4>>2]=k[b+8>>2];k[a+4+4>>2]=k[b+8+4>>2];k[a+4+8>>2]=k[b+8+8>>2];k[a+4+12>>2]=k[b+8+12>>2];k[a+20>>2]=k[b+24>>2];k[a+20+4>>2]=k[b+24+4>>2];k[a+20+8>>2]=k[b+24+8>>2];k[a+20+12>>2]=k[b+24+12>>2];k[a+36>>2]=k[b+40>>2];k[a+36+4>>2]=k[b+40+4>>2];k[a+36+8>>2]=k[b+40+8>>2];k[a+36+12>>2]=k[b+40+12>>2];k[a+52>>2]=k[b+56>>2];k[a+52+4>>2]=k[b+56+4>>2];k[a+52+8>>2]=k[b+56+8>>2];k[a+52+12>>2]=k[b+56+12>>2];e=a+52|0;d=a+20|0;g=a+36|0;h=a+4|0}else{Ub[k[(k[d>>2]|0)+8>>2]&127](d,a+4|0);e=a+52|0;d=a+20|0;g=a+36|0;h=a+4|0}k[a+68>>2]=k[h>>2];k[a+68+4>>2]=k[h+4>>2];k[a+68+8>>2]=k[h+8>>2];k[a+68+12>>2]=k[h+12>>2];k[a+84>>2]=k[d>>2];k[a+84+4>>2]=k[d+4>>2];k[a+84+8>>2]=k[d+8>>2];k[a+84+12>>2]=k[d+12>>2];k[a+100>>2]=k[g>>2];k[a+100+4>>2]=k[g+4>>2];k[a+100+8>>2]=k[g+8>>2];k[a+100+12>>2]=k[g+12>>2];k[a+116>>2]=k[e>>2];k[a+116+4>>2]=k[e+4>>2];k[a+116+8>>2]=k[e+8>>2];k[a+116+12>>2]=k[e+12>>2];k[a+132>>2]=0;k[a+132+4>>2]=0;k[a+132+8>>2]=0;k[a+132+12>>2]=0;k[a+132+16>>2]=0;k[a+132+20>>2]=0;k[a+132+24>>2]=0;k[a+132+28>>2]=0;o[a+224>>2]=+o[b+100>>2];o[a+232>>2]=+o[b+104>>2];o[a+228>>2]=+o[b+108>>2];Ub[k[(k[a>>2]|0)+12>>2]&127](a,k[b+72>>2]|0);d=k[374]|0;k[374]=d+1;k[a+508>>2]=d;f=+o[b>>2];d=k[a+204>>2]|0;if(f==0.0){k[a+204>>2]=d|1;l=0.0}else{k[a+204>>2]=d&-2;l=1.0/f}o[a+344>>2]=l;j=f*+o[a+384>>2];c=f*+o[a+388>>2];o[a+364>>2]=f*+o[a+380>>2];o[a+368>>2]=j;o[a+372>>2]=c;o[a+376>>2]=0.0;c=+o[b+76>>2];if(c!=0.0)j=1.0/c;else j=0.0;c=+o[b+80>>2];if(c!=0.0)f=1.0/c;else f=0.0;c=+o[b+84>>2];if(c!=0.0)c=1.0/c;else c=0.0;o[a+396>>2]=j;o[a+400>>2]=f;o[a+404>>2]=c;o[a+408>>2]=0.0;B=l*+o[a+352>>2];v=l*+o[a+356>>2];o[a+560>>2]=l*+o[a+348>>2];o[a+564>>2]=B;o[a+568>>2]=v;o[a+572>>2]=0.0;v=+o[a+4>>2];B=v*j;u=+o[a+8>>2];A=u*f;t=+o[a+12>>2];z=t*c;s=+o[a+20>>2];y=j*s;r=+o[a+24>>2];x=f*r;q=+o[a+28>>2];w=c*q;p=+o[a+36>>2];n=j*p;m=+o[a+40>>2];l=f*m;j=+o[a+44>>2];f=c*j;o[a+264>>2]=v*B+u*A+t*z;o[a+268>>2]=B*s+A*r+z*q;o[a+272>>2]=B*p+A*m+z*j;o[a+276>>2]=0.0;o[a+280>>2]=v*y+u*x+t*w;o[a+284>>2]=s*y+r*x+q*w;o[a+288>>2]=y*p+x*m+w*j;o[a+292>>2]=0.0;o[a+296>>2]=v*n+u*l+t*f;o[a+300>>2]=s*n+r*l+q*f;o[a+304>>2]=p*n+m*l+j*f;o[a+308>>2]=0.0;k[a+504>>2]=0;k[a+512>>2]=0;k[a+512+4>>2]=0;k[a+512+8>>2]=0;k[a+512+12>>2]=0;k[a+512+16>>2]=0;k[a+512+20>>2]=0;k[a+512+24>>2]=0;k[a+512+28>>2]=0;f=+o[a+344>>2];j=f*+o[a+352>>2];l=f*+o[a+356>>2];o[a+560>>2]=+o[a+348>>2]*f;o[a+564>>2]=j;o[a+568>>2]=l;d=a+572|0;e=d+36|0;do{k[d>>2]=0;d=d+4|0}while((d|0)<(e|0));return}function _o(a,b,c,d,e){a=a|0;b=+b;c=c|0;d=d|0;e=e|0;var f=0;f=r;r=r+144|0;o[a+164>>2]=1.0;o[a+168>>2]=1.0;o[a+172>>2]=1.0;o[a+176>>2]=0.0;k[a+180>>2]=0;o[a+184>>2]=999999984306749440.0;k[a+188>>2]=0;k[a+188+4>>2]=0;k[a+188+8>>2]=0;k[a+188+12>>2]=0;k[a+204>>2]=1;k[a+208>>2]=-1;k[a+212>>2]=-1;k[a+216>>2]=1;o[a+220>>2]=0.0;o[a+224>>2]=.5;o[a+228>>2]=0.0;o[a+232>>2]=0.0;k[a+236>>2]=1;k[a+240>>2]=0;o[a+244>>2]=1.0;k[a+248>>2]=0;k[a+248+4>>2]=0;k[a+248+8>>2]=0;k[a+248+12>>2]=0;o[a+4>>2]=1.0;k[a+8>>2]=0;k[a+8+4>>2]=0;k[a+8+8>>2]=0;k[a+8+12>>2]=0;o[a+24>>2]=1.0;k[a+28>>2]=0;k[a+28+4>>2]=0;k[a+28+8>>2]=0;k[a+28+12>>2]=0;o[a+44>>2]=1.0;k[a+48>>2]=0;k[a+48+4>>2]=0;k[a+48+8>>2]=0;k[a+48+12>>2]=0;k[a+48+16>>2]=0;k[a>>2]=1464;i[a+500>>0]=1;k[a+496>>2]=0;k[a+488>>2]=0;k[a+492>>2]=0;o[f>>2]=b;k[f+4>>2]=c;k[f+72>>2]=d;k[f+76>>2]=k[e>>2];k[f+76+4>>2]=k[e+4>>2];k[f+76+8>>2]=k[e+8>>2];k[f+76+12>>2]=k[e+12>>2];o[f+92>>2]=0.0;o[f+96>>2]=0.0;o[f+100>>2]=.5;o[f+104>>2]=0.0;o[f+108>>2]=0.0;o[f+112>>2]=.800000011920929;o[f+116>>2]=1.0;i[f+120>>0]=0;o[f+124>>2]=.004999999888241291;o[f+128>>2]=.009999999776482582;o[f+132>>2]=.009999999776482582;o[f+136>>2]=.009999999776482582;o[f+8>>2]=1.0;k[f+12>>2]=0;k[f+12+4>>2]=0;k[f+12+8>>2]=0;k[f+12+12>>2]=0;o[f+28>>2]=1.0;k[f+32>>2]=0;k[f+32+4>>2]=0;k[f+32+8>>2]=0;k[f+32+12>>2]=0;o[f+48>>2]=1.0;k[f+52>>2]=0;k[f+52+4>>2]=0;k[f+52+8>>2]=0;k[f+52+12>>2]=0;k[f+52+16>>2]=0;Zo(a,f);r=f;return}function $o(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0;if(!(k[a+204>>2]&2)){k[a+68>>2]=k[b>>2];k[a+68+4>>2]=k[b+4>>2];k[a+68+8>>2]=k[b+8>>2];k[a+68+12>>2]=k[b+12>>2];k[a+84>>2]=k[b+16>>2];k[a+84+4>>2]=k[b+16+4>>2];k[a+84+8>>2]=k[b+16+8>>2];k[a+84+12>>2]=k[b+16+12>>2];k[a+100>>2]=k[b+32>>2];k[a+100+4>>2]=k[b+32+4>>2];k[a+100+8>>2]=k[b+32+8>>2];k[a+100+12>>2]=k[b+32+12>>2];k[a+116>>2]=k[b+48>>2];k[a+116+4>>2]=k[b+48+4>>2];k[a+116+8>>2]=k[b+48+8>>2];k[a+116+12>>2]=k[b+48+12>>2];c=a+20|0;d=b+16|0;e=a+36|0;f=b+32|0;g=a+52|0;h=b+48|0;i=a+4|0}else{k[a+68>>2]=k[a+4>>2];k[a+68+4>>2]=k[a+4+4>>2];k[a+68+8>>2]=k[a+4+8>>2];k[a+68+12>>2]=k[a+4+12>>2];k[a+84>>2]=k[a+20>>2];k[a+84+4>>2]=k[a+20+4>>2];k[a+84+8>>2]=k[a+20+8>>2];k[a+84+12>>2]=k[a+20+12>>2];k[a+100>>2]=k[a+36>>2];k[a+100+4>>2]=k[a+36+4>>2];k[a+100+8>>2]=k[a+36+8>>2];k[a+100+12>>2]=k[a+36+12>>2];k[a+116>>2]=k[a+52>>2];k[a+116+4>>2]=k[a+52+4>>2];k[a+116+8>>2]=k[a+52+8>>2];k[a+116+12>>2]=k[a+52+12>>2];c=a+20|0;d=b+16|0;e=a+36|0;f=b+32|0;g=a+52|0;h=b+48|0;i=a+4|0}k[a+132>>2]=k[a+312>>2];k[a+132+4>>2]=k[a+312+4>>2];k[a+132+8>>2]=k[a+312+8>>2];k[a+132+12>>2]=k[a+312+12>>2];k[a+148>>2]=k[a+328>>2];k[a+148+4>>2]=k[a+328+4>>2];k[a+148+8>>2]=k[a+328+8>>2];k[a+148+12>>2]=k[a+328+12>>2];k[i>>2]=k[b>>2];k[i+4>>2]=k[b+4>>2];k[i+8>>2]=k[b+8>>2];k[i+12>>2]=k[b+12>>2];k[c>>2]=k[d>>2];k[c+4>>2]=k[d+4>>2];k[c+8>>2]=k[d+8>>2];k[c+12>>2]=k[d+12>>2];k[e>>2]=k[f>>2];k[e+4>>2]=k[f+4>>2];k[e+8>>2]=k[f+8>>2];k[e+12>>2]=k[f+12>>2];k[g>>2]=k[h>>2];k[g+4>>2]=k[h+4>>2];k[g+8>>2]=k[h+8>>2];k[g+12>>2]=k[h+12>>2];w=+o[a+4>>2];q=+o[a+396>>2];v=+o[a+8>>2];n=+o[a+400>>2];u=+o[a+12>>2];l=+o[a+404>>2];t=+o[a+20>>2];s=+o[a+24>>2];r=+o[a+28>>2];p=+o[a+36>>2];m=+o[a+40>>2];j=+o[a+44>>2];o[a+264>>2]=w*(w*q)+v*(v*n)+u*(u*l);o[a+268>>2]=w*q*t+v*n*s+u*l*r;o[a+272>>2]=w*q*p+v*n*m+u*l*j;o[a+276>>2]=0.0;o[a+280>>2]=w*(q*t)+v*(n*s)+u*(l*r);o[a+284>>2]=t*(q*t)+s*(n*s)+r*(l*r);o[a+288>>2]=q*t*p+n*s*m+l*r*j;o[a+292>>2]=0.0;o[a+296>>2]=w*(q*p)+v*(n*m)+u*(l*j);o[a+300>>2]=t*(q*p)+s*(n*m)+r*(l*j);o[a+304>>2]=p*(q*p)+m*(n*m)+j*(l*j);o[a+308>>2]=0.0;return}function ap(a,b){a=a|0;b=b|0;var c=0,d=0,e=0;if((b|0)==0?1:(k[b+236>>2]&2|0)==0){b=1;return b|0}e=k[a+488>>2]|0;if((e|0)<=0){b=1;return b|0}a=k[a+496>>2]|0;d=0;while(1){c=k[a+(d<<2)>>2]|0;if(i[c+20>>0]|0){if((k[c+28>>2]|0)==(b|0)){c=0;a=8;break}if((k[c+32>>2]|0)==(b|0)){c=0;a=8;break}}d=d+1|0;if((d|0)>=(e|0)){c=1;a=8;break}}if((a|0)==8)return c|0;return 0}function bp(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0;d=k[a+488>>2]|0;a:do if((d|0)>0){e=k[a+496>>2]|0;c=0;while(1){if((k[e+(c<<2)>>2]|0)==(b|0))break;c=c+1|0;if((c|0)>=(d|0))break a}if((c|0)!=(d|0)){a=a+256|0;k[a>>2]=1;return}}while(0);if((d|0)==(k[a+492>>2]|0)?(h=(d|0)==0?1:d<<1,(d|0)<(h|0)):0){if(!h)g=0;else{k[5108]=(k[5108]|0)+1;c=iF((h<<2|3)+16|0)|0;if(!c)d=0;else{k[(c+4+15&-16)+-4>>2]=c;d=c+4+15&-16}g=d;d=k[a+488>>2]|0}if((d|0)>0){e=d+-1|0;f=0;while(1){c=g+(f<<2)|0;if(c)k[c>>2]=k[(k[a+496>>2]|0)+(f<<2)>>2];if((f|0)==(e|0))break;else f=f+1|0}}c=k[a+496>>2]|0;if(c){if(i[a+500>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);d=k[a+488>>2]|0}k[a+496>>2]=0}i[a+500>>0]=1;k[a+496>>2]=g;k[a+492>>2]=h}c=(k[a+496>>2]|0)+(d<<2)|0;if(c)k[c>>2]=b;k[a+488>>2]=d+1;a=a+256|0;k[a>>2]=1;return}function cp(a){a=a|0;return 488}function dp(a,b,c){a=a|0;b=b|0;c=c|0;sr(a,b,c)|0;o[b+256>>2]=+o[a+264>>2];o[b+260>>2]=+o[a+268>>2];o[b+264>>2]=+o[a+272>>2];o[b+268>>2]=+o[a+276>>2];o[b+272>>2]=+o[a+280>>2];o[b+276>>2]=+o[a+284>>2];o[b+280>>2]=+o[a+288>>2];o[b+284>>2]=+o[a+292>>2];o[b+288>>2]=+o[a+296>>2];o[b+292>>2]=+o[a+300>>2];o[b+296>>2]=+o[a+304>>2];o[b+300>>2]=+o[a+308>>2];o[b+304>>2]=+o[a+312>>2];o[b+308>>2]=+o[a+316>>2];o[b+312>>2]=+o[a+320>>2];o[b+316>>2]=+o[a+324>>2];o[b+320>>2]=+o[a+328>>2];o[b+324>>2]=+o[a+332>>2];o[b+328>>2]=+o[a+336>>2];o[b+332>>2]=+o[a+340>>2];o[b+448>>2]=+o[a+344>>2];o[b+336>>2]=+o[a+544>>2];o[b+340>>2]=+o[a+548>>2];o[b+344>>2]=+o[a+552>>2];o[b+348>>2]=+o[a+556>>2];o[b+352>>2]=+o[a+348>>2];o[b+356>>2]=+o[a+352>>2];o[b+360>>2]=+o[a+356>>2];o[b+364>>2]=+o[a+360>>2];o[b+368>>2]=+o[a+364>>2];o[b+372>>2]=+o[a+368>>2];o[b+376>>2]=+o[a+372>>2];o[b+380>>2]=+o[a+376>>2];o[b+384>>2]=+o[a+380>>2];o[b+388>>2]=+o[a+384>>2];o[b+392>>2]=+o[a+388>>2];o[b+396>>2]=+o[a+392>>2];o[b+400>>2]=+o[a+396>>2];o[b+404>>2]=+o[a+400>>2];o[b+408>>2]=+o[a+404>>2];o[b+412>>2]=+o[a+408>>2];o[b+416>>2]=+o[a+412>>2];o[b+420>>2]=+o[a+416>>2];o[b+424>>2]=+o[a+420>>2];o[b+428>>2]=+o[a+424>>2];o[b+432>>2]=+o[a+428>>2];o[b+436>>2]=+o[a+432>>2];o[b+440>>2]=+o[a+436>>2];o[b+444>>2]=+o[a+440>>2];o[b+452>>2]=+o[a+444>>2];o[b+456>>2]=+o[a+448>>2];k[b+484>>2]=l[a+452>>0];o[b+460>>2]=+o[a+456>>2];o[b+464>>2]=+o[a+460>>2];o[b+468>>2]=+o[a+464>>2];o[b+472>>2]=+o[a+468>>2];o[b+476>>2]=+o[a+472>>2];o[b+480>>2]=+o[a+476>>2];return 1504}function ep(a,b){a=a|0;b=b|0;var c=0,d=0;c=k[(k[b>>2]|0)+16>>2]|0;d=Wb[k[(k[a>>2]|0)+16>>2]&127](a)|0;d=dc[c&63](b,d,1)|0;c=dc[k[(k[a>>2]|0)+20>>2]&63](a,k[d+8>>2]|0,b)|0;Qb[k[(k[b>>2]|0)+20>>2]&31](b,d,c,1497645650,a);return}function fp(a){a=a|0;var b=0,c=0,d=0;k[a>>2]=1568;if((i[a+272>>0]|0)!=0?(b=k[a+204>>2]|0,Sb[k[k[b>>2]>>2]&255](b),b=k[a+204>>2]|0,(b|0)!=0):0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+196>>2]|0;if((b|0)!=0?(Sb[k[k[b>>2]>>2]&255](b),c=k[a+196>>2]|0,(c|0)!=0):0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}if((i[a+273>>0]|0)!=0?(d=k[a+200>>2]|0,Sb[k[k[d>>2]>>2]&255](d),d=k[a+200>>2]|0,(d|0)!=0):0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}b=k[a+316>>2]|0;if(b){if(i[a+320>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+316>>2]=0}i[a+320>>0]=1;k[a+316>>2]=0;k[a+308>>2]=0;k[a+312>>2]=0;b=k[a+288>>2]|0;if(b){if(i[a+292>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+288>>2]=0}i[a+292>>0]=1;k[a+288>>2]=0;k[a+280>>2]=0;k[a+284>>2]=0;b=k[a+240>>2]|0;if(b){if(i[a+244>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+240>>2]=0}i[a+244>>0]=1;k[a+240>>2]=0;k[a+232>>2]=0;k[a+236>>2]=0;b=k[a+220>>2]|0;if(b){if(i[a+224>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+220>>2]=0}i[a+224>>0]=1;k[a+220>>2]=0;k[a+212>>2]=0;k[a+216>>2]=0;b=k[a+188>>2]|0;if(!b){i[a+192>>0]=1;k[a+188>>2]=0;k[a+180>>2]=0;d=a+184|0;k[d>>2]=0;ms(a);return}if(i[a+192>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+188>>2]=0;i[a+192>>0]=1;k[a+188>>2]=0;k[a+180>>2]=0;d=a+184|0;k[d>>2]=0;ms(a);return}function gp(a){a=a|0;fp(a);if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function hp(a,b){a=a|0;b=+b;var c=0,d=0,e=0,f=0,g=0.0,h=0.0,i=0.0;f=r;r=r+32|0;c=k[a+8>>2]|0;if((c|0)<=0){r=f;return}e=0;do{d=k[(k[a+16>>2]|0)+(e<<2)>>2]|0;if((!((d|0)==0?1:(k[d+236>>2]&2|0)==0)?(k[d+216>>2]|0)!=2:0)?!((k[d+204>>2]&2|0)==0|b!=0.0^1):0){c=k[d+480>>2]|0;if(!c)c=d+4|0;else{Ub[k[(k[c>>2]|0)+8>>2]&127](c,d+4|0);c=d+4|0}h=(+o[d+56>>2]-+o[d+120>>2])*(1.0/b);i=1.0/b*(+o[d+60>>2]-+o[d+124>>2]);o[d+312>>2]=(+o[d+52>>2]-+o[d+116>>2])*(1.0/b);o[d+316>>2]=h;o[d+320>>2]=i;o[d+324>>2]=0.0;Rw(d+68|0,c,f+8|0,f);i=+o[f>>2];h=1.0/b*(i*+o[f+8+4>>2]);g=1.0/b*(i*+o[f+8+8>>2]);o[d+328>>2]=1.0/b*(+o[f+8>>2]*i);o[d+332>>2]=h;o[d+336>>2]=g;o[d+340>>2]=0.0;k[d+132>>2]=k[d+312>>2];k[d+132+4>>2]=k[d+312+4>>2];k[d+132+8>>2]=k[d+312+8>>2];k[d+132+12>>2]=k[d+312+12>>2];k[d+148>>2]=k[d+328>>2];k[d+148+4>>2]=k[d+328+4>>2];k[d+148+8>>2]=k[d+328+8>>2];k[d+148+12>>2]=k[d+328+12>>2];k[d+68>>2]=k[c>>2];k[d+68+4>>2]=k[c+4>>2];k[d+68+8>>2]=k[c+8>>2];k[d+68+12>>2]=k[c+12>>2];k[d+84>>2]=k[d+20>>2];k[d+84+4>>2]=k[d+20+4>>2];k[d+84+8>>2]=k[d+20+8>>2];k[d+84+12>>2]=k[d+20+12>>2];k[d+100>>2]=k[d+36>>2];k[d+100+4>>2]=k[d+36+4>>2];k[d+100+8>>2]=k[d+36+8>>2];k[d+100+12>>2]=k[d+36+12>>2];k[d+116>>2]=k[d+52>>2];k[d+116+4>>2]=k[d+52+4>>2];k[d+116+8>>2]=k[d+52+8>>2];k[d+116+12>>2]=k[d+52+12>>2];c=k[a+8>>2]|0}e=e+1|0}while((e|0)<(c|0));r=f;return}function ip(a){a=a|0;var b=0,c=0.0,d=0.0,e=0.0,f=0.0,g=0,h=0,j=0,l=0,m=0,n=0.0,p=0,q=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0.0,N=0.0,O=0.0,P=0,Q=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0;L=r;r=r+752|0;Cw(1752);zs(a);a:do if((Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0)!=0?(K=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0,((Wb[k[(k[K>>2]|0)+48>>2]&127](K)|0)&6144|0)!=0):0){u=L+272+44|0;v=L+272+16|0;w=L+416+16|0;x=L+272+32|0;y=L+416+32|0;z=L+272+48|0;A=L+416+48|0;B=L+272+16|0;C=L+32+16|0;D=L+272+32|0;E=L+32+32|0;F=L+272+48|0;G=L+32+48|0;H=L+272+16|0;I=L+272+32|0;J=L+272+48|0;p=L+272+16|0;q=L+272+32|0;s=L+272+48|0;b=Wb[k[(k[a>>2]|0)+104>>2]&127](a)|0;while(1){K=b+-1|0;if((b|0)<=0)break a;m=nc[k[(k[a>>2]|0)+108>>2]&31](a,K)|0;b=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;b=(Wb[k[(k[b>>2]|0)+48>>2]&127](b)|0)>>>11;l=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;l=(Wb[k[(k[l>>2]|0)+48>>2]&127](l)|0)>>>12;n=+o[m+40>>2];b:do if(!(n<=0.0))switch(k[m+4>>2]|0){case 5:{Sw(L+272|0,(k[m+28>>2]|0)+4|0,m+300|0);if(!(b&1)){Sw(L+32|0,(k[m+32>>2]|0)+4|0,m+364|0);k[L+272>>2]=k[L+32>>2];k[L+272+4>>2]=k[L+32+4>>2];k[L+272+8>>2]=k[L+32+8>>2];k[L+272+12>>2]=k[L+32+12>>2];k[B>>2]=k[C>>2];k[B+4>>2]=k[C+4>>2];k[B+8>>2]=k[C+8>>2];k[B+12>>2]=k[C+12>>2];k[D>>2]=k[E>>2];k[D+4>>2]=k[E+4>>2];k[D+8>>2]=k[E+8>>2];k[D+12>>2]=k[E+12>>2];k[F>>2]=k[G>>2];k[F+4>>2]=k[G+4>>2];k[F+8>>2]=k[G+8>>2];k[F+12>>2]=k[G+12>>2]}else{j=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;Ac[k[(k[j>>2]|0)+56>>2]&7](j,L+272|0,n);Sw(L+32|0,(k[m+32>>2]|0)+4|0,m+364|0);k[L+272>>2]=k[L+32>>2];k[L+272+4>>2]=k[L+32+4>>2];k[L+272+8>>2]=k[L+32+8>>2];k[L+272+12>>2]=k[L+32+12>>2];k[B>>2]=k[C>>2];k[B+4>>2]=k[C+4>>2];k[B+8>>2]=k[C+8>>2];k[B+12>>2]=k[C+12>>2];k[D>>2]=k[E>>2];k[D+4>>2]=k[E+4>>2];k[D+8>>2]=k[E+8>>2];k[D+12>>2]=k[E+12>>2];k[F>>2]=k[G>>2];k[F+4>>2]=k[G+4>>2];k[F+8>>2]=k[G+8>>2];k[F+12>>2]=k[G+12>>2];j=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;Ac[k[(k[j>>2]|0)+56>>2]&7](j,L+272|0,n)}if(l&1){qq(L+96|0,m,6.0868353843688965,n);M=+o[L+96>>2];c=+o[L+96+4>>2];d=+o[L+96+8>>2];e=M*+o[L+272+16>>2]+c*+o[L+272+20>>2]+d*+o[L+272+24>>2]+ +o[L+272+52>>2];f=M*+o[L+272+32>>2]+c*+o[L+272+36>>2]+d*+o[L+272+40>>2]+ +o[L+272+56>>2];o[L+96>>2]=M*+o[L+272>>2]+c*+o[L+272+4>>2]+d*+o[L+272+8>>2]+ +o[L+272+48>>2];o[L+96+4>>2]=e;o[L+96+8>>2]=f;o[L+96+12>>2]=0.0;b=0;do{qq(L+480|0,m,+(b|0)*6.283185005187988*.03125,n);c=+o[L+480>>2];M=+o[L+480+4>>2];d=+o[L+480+8>>2];e=c*+o[L+272+16>>2]+M*+o[L+272+20>>2]+d*+o[L+272+24>>2]+ +o[L+272+52>>2];f=c*+o[L+272+32>>2]+M*+o[L+272+36>>2]+d*+o[L+272+40>>2]+ +o[L+272+56>>2];o[L+480>>2]=c*+o[L+272>>2]+M*+o[L+272+4>>2]+d*+o[L+272+8>>2]+ +o[L+272+48>>2];o[L+480+4>>2]=e;o[L+480+8>>2]=f;o[L+480+12>>2]=0.0;l=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;j=k[(k[l>>2]|0)+8>>2]|0;k[L+112>>2]=0;k[L+112+4>>2]=0;k[L+112+8>>2]=0;k[L+112+12>>2]=0;Cc[j&127](l,L+96|0,L+480|0,L+112|0);if(!(b&3)){l=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;j=k[(k[l>>2]|0)+8>>2]|0;k[L+128>>2]=0;k[L+128+4>>2]=0;k[L+128+8>>2]=0;k[L+128+12>>2]=0;Cc[j&127](l,F,L+480|0,L+128|0)};k[L+96>>2]=k[L+480>>2];k[L+96+4>>2]=k[L+480+4>>2];k[L+96+8>>2]=k[L+480+8>>2];k[L+96+12>>2]=k[L+480+12>>2];b=b+1|0}while((b|0)!=32);c=+o[m+452>>2];d=+o[m+512>>2];b=k[m+32>>2]|0;if(+o[b+344>>2]>0.0){Sw(L+144|0,b+4|0,m+364|0);k[L+272>>2]=k[L+144>>2];k[L+272+4>>2]=k[L+144+4>>2];k[L+272+8>>2]=k[L+144+8>>2];k[L+272+12>>2]=k[L+144+12>>2];k[B>>2]=k[L+144+16>>2];k[B+4>>2]=k[L+144+16+4>>2];k[B+8>>2]=k[L+144+16+8>>2];k[B+12>>2]=k[L+144+16+12>>2];k[D>>2]=k[L+144+32>>2];k[D+4>>2]=k[L+144+32+4>>2];k[D+8>>2]=k[L+144+32+8>>2];k[D+12>>2]=k[L+144+32+12>>2];k[F>>2]=k[L+144+48>>2];k[F+4>>2]=k[L+144+48+4>>2];k[F+8>>2]=k[L+144+48+8>>2];k[F+12>>2]=k[L+144+48+12>>2]}else{Sw(L+544|0,(k[m+28>>2]|0)+4|0,m+300|0);k[L+272>>2]=k[L+544>>2];k[L+272+4>>2]=k[L+544+4>>2];k[L+272+8>>2]=k[L+544+8>>2];k[L+272+12>>2]=k[L+544+12>>2];k[B>>2]=k[L+544+16>>2];k[B+4>>2]=k[L+544+16+4>>2];k[B+8>>2]=k[L+544+16+8>>2];k[B+12>>2]=k[L+544+16+12>>2];k[D>>2]=k[L+544+32>>2];k[D+4>>2]=k[L+544+32+4>>2];k[D+8>>2]=k[L+544+32+8>>2];k[D+12>>2]=k[L+544+32+12>>2];k[F>>2]=k[L+544+48>>2];k[F+4>>2]=k[L+544+48+4>>2];k[F+8>>2]=k[L+544+48+8>>2];k[F+12>>2]=k[L+544+48+12>>2]};k[L+624>>2]=k[F>>2];k[L+624+4>>2]=k[F+4>>2];k[L+624+8>>2]=k[F+8>>2];k[L+624+12>>2]=k[F+12>>2];o[L+656>>2]=+o[L+272>>2];o[L+656+4>>2]=+o[L+272+16>>2];o[L+656+8>>2]=+o[L+272+32>>2];o[L+656+12>>2]=0.0;o[L+688>>2]=+o[L+272+4>>2];o[L+688+4>>2]=+o[L+272+20>>2];o[L+688+8>>2]=+o[L+272+36>>2];o[L+688+12>>2]=0.0;m=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;l=k[(k[m>>2]|0)+60>>2]|0;k[L+720>>2]=0;k[L+720+4>>2]=0;k[L+720+8>>2]=0;k[L+720+12>>2]=0;bc[l&0](m,L+624|0,L+656|0,L+688|0,n,n,-d-c,c-d,L+720|0,1,10.0)}break b}case 3:{o[L+272>>2]=1.0;k[L+272+4>>2]=0;k[L+272+4+4>>2]=0;k[L+272+4+8>>2]=0;k[L+272+4+12>>2]=0;o[L+272+20>>2]=1.0;k[L+272+24>>2]=0;k[L+272+24+4>>2]=0;k[L+272+24+8>>2]=0;k[L+272+24+12>>2]=0;o[L+272+40>>2]=1.0;k[u>>2]=0;k[u+4>>2]=0;k[u+8>>2]=0;k[u+12>>2]=0;k[u+16>>2]=0;f=+o[m+300>>2];e=+o[m+304>>2];d=+o[m+308>>2];l=k[m+28>>2]|0;M=f*+o[l+20>>2]+e*+o[l+24>>2]+d*+o[l+28>>2]+ +o[l+56>>2];c=f*+o[l+36>>2]+e*+o[l+40>>2]+d*+o[l+44>>2]+ +o[l+60>>2];o[L+272+48>>2]=f*+o[l+4>>2]+e*+o[l+8>>2]+d*+o[l+12>>2]+ +o[l+52>>2];o[L+272+52>>2]=M;o[L+272+56>>2]=c;o[L+272+60>>2]=0.0;l=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;Ac[k[(k[l>>2]|0)+56>>2]&7](l,L+272|0,n);c=+o[m+316>>2];M=+o[m+320>>2];d=+o[m+324>>2];m=k[m+32>>2]|0;e=c*+o[m+20>>2]+M*+o[m+24>>2]+d*+o[m+28>>2]+ +o[m+56>>2];f=c*+o[m+36>>2]+M*+o[m+40>>2]+d*+o[m+44>>2]+ +o[m+60>>2];o[L+272+48>>2]=c*+o[m+4>>2]+M*+o[m+8>>2]+d*+o[m+12>>2]+ +o[m+52>>2];o[L+272+52>>2]=e;o[L+272+56>>2]=f;o[L+272+60>>2]=0.0;if(b&1){m=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;Ac[k[(k[m>>2]|0)+56>>2]&7](m,L+272|0,n)}break b}case 4:{Sw(L+272|0,(k[m+28>>2]|0)+4|0,m+552|0);if(!(b&1)){Sw(L+416|0,(k[m+32>>2]|0)+4|0,m+616|0);k[L+272>>2]=k[L+416>>2];k[L+272+4>>2]=k[L+416+4>>2];k[L+272+8>>2]=k[L+416+8>>2];k[L+272+12>>2]=k[L+416+12>>2];k[v>>2]=k[w>>2];k[v+4>>2]=k[w+4>>2];k[v+8>>2]=k[w+8>>2];k[v+12>>2]=k[w+12>>2];k[x>>2]=k[y>>2];k[x+4>>2]=k[y+4>>2];k[x+8>>2]=k[y+8>>2];k[x+12>>2]=k[y+12>>2];k[z>>2]=k[A>>2];k[z+4>>2]=k[A+4>>2];k[z+8>>2]=k[A+8>>2];k[z+12>>2]=k[A+12>>2]}else{j=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;Ac[k[(k[j>>2]|0)+56>>2]&7](j,L+272|0,n);Sw(L+416|0,(k[m+32>>2]|0)+4|0,m+616|0);k[L+272>>2]=k[L+416>>2];k[L+272+4>>2]=k[L+416+4>>2];k[L+272+8>>2]=k[L+416+8>>2];k[L+272+12>>2]=k[L+416+12>>2];k[v>>2]=k[w>>2];k[v+4>>2]=k[w+4>>2];k[v+8>>2]=k[w+8>>2];k[v+12>>2]=k[w+12>>2];k[x>>2]=k[y>>2];k[x+4>>2]=k[y+4>>2];k[x+8>>2]=k[y+8>>2];k[x+12>>2]=k[y+12>>2];k[z>>2]=k[A>>2];k[z+4>>2]=k[A+4>>2];k[z+8>>2]=k[A+8>>2];k[z+12>>2]=k[A+12>>2];j=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;Ac[k[(k[j>>2]|0)+56>>2]&7](j,L+272|0,n)}f=+o[m+688>>2];d=+o[m+688+4>>2];c=+kF(f-d,6.2831854820251465);if(!(c<-3.1415927410125732))if(c>3.1415927410125732)e=c+-6.2831854820251465;else e=c;else e=c+6.2831854820251465;c=+kF(f+d,6.2831854820251465);if(!(c<-3.1415927410125732)){if(c>3.1415927410125732)c=c+-6.2831854820251465}else c=c+6.2831854820251465;if(!(e==c)?(t=e>c,(l&1|0)!=0):0){o[L+224>>2]=+o[L+272+8>>2];o[L+224+4>>2]=+o[L+272+24>>2];o[L+224+8>>2]=+o[L+272+40>>2];o[L+224+12>>2]=0.0;o[L+672>>2]=+o[L+272>>2];o[L+672+4>>2]=+o[L+272+16>>2];o[L+672+8>>2]=+o[L+272+32>>2];o[L+672+12>>2]=0.0;m=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;l=k[(k[m>>2]|0)+60>>2]|0;k[L+704>>2]=0;k[L+704+4>>2]=0;k[L+704+8>>2]=0;k[L+704+12>>2]=0;bc[l&0](m,z,L+224|0,L+672|0,n,n,t?0.0:e,t?6.2831854820251465:c,L+704|0,t^1,10.0)}break b}case 6:case 9:{k[L+272>>2]=k[m+1064>>2];k[L+272+4>>2]=k[m+1064+4>>2];k[L+272+8>>2]=k[m+1064+8>>2];k[L+272+12>>2]=k[m+1064+12>>2];g=m+1064+16|0;k[H>>2]=k[g>>2];k[H+4>>2]=k[g+4>>2];k[H+8>>2]=k[g+8>>2];k[H+12>>2]=k[g+12>>2];h=m+1064+32|0;k[I>>2]=k[h>>2];k[I+4>>2]=k[h+4>>2];k[I+8>>2]=k[h+8>>2];k[I+12>>2]=k[h+12>>2];j=m+1064+48|0;k[J>>2]=k[j>>2];k[J+4>>2]=k[j+4>>2];k[J+8>>2]=k[j+8>>2];k[J+12>>2]=k[j+12>>2];if(!(b&1)){k[L+272>>2]=k[m+1128>>2];k[L+272+4>>2]=k[m+1128+4>>2];k[L+272+8>>2]=k[m+1128+8>>2];k[L+272+12>>2]=k[m+1128+12>>2];k[H>>2]=k[m+1128+16>>2];k[H+4>>2]=k[m+1128+16+4>>2];k[H+8>>2]=k[m+1128+16+8>>2];k[H+12>>2]=k[m+1128+16+12>>2];k[I>>2]=k[m+1128+32>>2];k[I+4>>2]=k[m+1128+32+4>>2];k[I+8>>2]=k[m+1128+32+8>>2];k[I+12>>2]=k[m+1128+32+12>>2];k[J>>2]=k[m+1128+48>>2];k[J+4>>2]=k[m+1128+48+4>>2];k[J+8>>2]=k[m+1128+48+8>>2];k[J+12>>2]=k[m+1128+48+12>>2]}else{b=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;Ac[k[(k[b>>2]|0)+56>>2]&7](b,L+272|0,n);k[L+272>>2]=k[m+1128>>2];k[L+272+4>>2]=k[m+1128+4>>2];k[L+272+8>>2]=k[m+1128+8>>2];k[L+272+12>>2]=k[m+1128+12>>2];k[H>>2]=k[m+1128+16>>2];k[H+4>>2]=k[m+1128+16+4>>2];k[H+8>>2]=k[m+1128+16+8>>2];k[H+12>>2]=k[m+1128+16+12>>2];k[I>>2]=k[m+1128+32>>2];k[I+4>>2]=k[m+1128+32+4>>2];k[I+8>>2]=k[m+1128+32+8>>2];k[I+12>>2]=k[m+1128+32+12>>2];k[J>>2]=k[m+1128+48>>2];k[J+4>>2]=k[m+1128+48+4>>2];k[J+8>>2]=k[m+1128+48+8>>2];k[J+12>>2]=k[m+1128+48+12>>2];b=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;Ac[k[(k[b>>2]|0)+56>>2]&7](b,L+272|0,n)}if(l&1){k[L+272>>2]=k[m+1064>>2];k[L+272+4>>2]=k[m+1064+4>>2];k[L+272+8>>2]=k[m+1064+8>>2];k[L+272+12>>2]=k[m+1064+12>>2];k[H>>2]=k[g>>2];k[H+4>>2]=k[g+4>>2];k[H+8>>2]=k[g+8>>2];k[H+12>>2]=k[g+12>>2];k[I>>2]=k[h>>2];k[I+4>>2]=k[h+4>>2];k[I+8>>2]=k[h+8>>2];k[I+12>>2]=k[h+12>>2];k[J>>2]=k[j>>2];k[J+4>>2]=k[j+4>>2];k[J+8>>2]=k[j+8>>2];k[J+12>>2]=k[j+12>>2];b=m+1128+48|0;o[L+736>>2]=+o[L+272+8>>2];o[L+736+4>>2]=+o[L+272+24>>2];o[L+736+8>>2]=+o[L+272+40>>2];o[L+736+12>>2]=0.0;o[L+336>>2]=+o[L+272>>2];o[L+336+4>>2]=+o[L+272+16>>2];o[L+336+8>>2]=+o[L+272+32>>2];o[L+336+12>>2]=0.0;c=+o[m+932>>2];e=+o[m+932+4>>2];d=+o[m+996>>2];N=+o[m+996+4>>2];l=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;P=k[(k[l>>2]|0)+64>>2]|0;k[L+352>>2]=0;k[L+352+4>>2]=0;k[L+352+8>>2]=0;k[L+352+12>>2]=0;tc[P&0](l,b,L+736|0,L+336|0,n*.8999999761581421,c,e,d,N,L+352|0,10.0,1);N=+o[L+272+4>>2];d=+o[L+272+20>>2];e=+o[L+272+36>>2];o[L+336>>2]=N;o[L+336+4>>2]=d;o[L+336+8>>2]=e;o[L+336+12>>2]=0.0;c=+o[m+1196>>2];M=+o[m+1200>>2];f=+_(+c);c=+$(+c);O=+_(+M);M=+$(+M);o[L+368>>2]=f*O*N+f*M*d-c*e;o[L+368+4>>2]=O*d-M*N;o[L+368+8>>2]=c*O*N+c*M*d+f*e;k[L+272>>2]=k[m+1128>>2];k[L+272+4>>2]=k[m+1128+4>>2];k[L+272+8>>2]=k[m+1128+8>>2];k[L+272+12>>2]=k[m+1128+12>>2];k[H>>2]=k[m+1128+16>>2];k[H+4>>2]=k[m+1128+16+4>>2];k[H+8>>2]=k[m+1128+16+8>>2];k[H+12>>2]=k[m+1128+16+12>>2];k[I>>2]=k[m+1128+32>>2];k[I+4>>2]=k[m+1128+32+4>>2];k[I+8>>2]=k[m+1128+32+8>>2];k[I+12>>2]=k[m+1128+32+12>>2];k[J>>2]=k[b>>2];k[J+4>>2]=k[b+4>>2];k[J+8>>2]=k[b+8>>2];k[J+12>>2]=k[b+12>>2];e=-+o[L+272+16>>2];f=-+o[L+272+32>>2];o[L+384>>2]=-+o[L+272>>2];o[L+384+4>>2]=e;o[L+384+8>>2]=f;o[L+384+12>>2]=0.0;f=+o[m+868>>2];e=+o[m+868+4>>2];if(!(f>e)){if(f<e){P=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;l=k[(k[P>>2]|0)+60>>2]|0;k[L+16>>2]=0;k[L+16+4>>2]=0;k[L+16+8>>2]=0;k[L+16+12>>2]=0;bc[l&0](P,b,L+384|0,L+368|0,n,n,f,e,L+16|0,1,10.0)}}else{P=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;l=k[(k[P>>2]|0)+60>>2]|0;k[L+400>>2]=0;k[L+400+4>>2]=0;k[L+400+8>>2]=0;k[L+400+12>>2]=0;bc[l&0](P,b,L+384|0,L+368|0,n,n,-3.1415927410125732,3.1415927410125732,L+400|0,0,10.0)};k[L+272>>2]=k[m+1064>>2];k[L+272+4>>2]=k[m+1064+4>>2];k[L+272+8>>2]=k[m+1064+8>>2];k[L+272+12>>2]=k[m+1064+12>>2];k[H>>2]=k[g>>2];k[H+4>>2]=k[g+4>>2];k[H+8>>2]=k[g+8>>2];k[H+12>>2]=k[g+12>>2];k[I>>2]=k[h>>2];k[I+4>>2]=k[h+4>>2];k[I+8>>2]=k[h+8>>2];k[I+12>>2]=k[h+12>>2];k[J>>2]=k[j>>2];k[J+4>>2]=k[j+4>>2];k[J+8>>2]=k[j+8>>2];k[J+12>>2]=k[j+12>>2];k[L+496>>2]=k[m+680>>2];k[L+496+4>>2]=k[m+680+4>>2];k[L+496+8>>2]=k[m+680+8>>2];k[L+496+12>>2]=k[m+680+12>>2];k[L+512>>2]=k[m+680+16>>2];k[L+512+4>>2]=k[m+680+16+4>>2];k[L+512+8>>2]=k[m+680+16+8>>2];k[L+512+12>>2]=k[m+680+16+12>>2];P=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;m=k[(k[P>>2]|0)+72>>2]|0;k[L>>2]=0;k[L+4>>2]=0;k[L+8>>2]=0;k[L+12>>2]=0;Qb[m&31](P,L+496|0,L+512|0,L+272|0,L)}break b}case 7:{k[L+272>>2]=k[m+824>>2];k[L+272+4>>2]=k[m+824+4>>2];k[L+272+8>>2]=k[m+824+8>>2];k[L+272+12>>2]=k[m+824+12>>2];k[p>>2]=k[m+824+16>>2];k[p+4>>2]=k[m+824+16+4>>2];k[p+8>>2]=k[m+824+16+8>>2];k[p+12>>2]=k[m+824+16+12>>2];k[q>>2]=k[m+824+32>>2];k[q+4>>2]=k[m+824+32+4>>2];k[q+8>>2]=k[m+824+32+8>>2];k[q+12>>2]=k[m+824+32+12>>2];k[s>>2]=k[m+824+48>>2];k[s+4>>2]=k[m+824+48+4>>2];k[s+8>>2]=k[m+824+48+8>>2];k[s+12>>2]=k[m+824+48+12>>2];if(!(b&1)){k[L+272>>2]=k[m+888>>2];k[L+272+4>>2]=k[m+888+4>>2];k[L+272+8>>2]=k[m+888+8>>2];k[L+272+12>>2]=k[m+888+12>>2];k[p>>2]=k[m+888+16>>2];k[p+4>>2]=k[m+888+16+4>>2];k[p+8>>2]=k[m+888+16+8>>2];k[p+12>>2]=k[m+888+16+12>>2];k[q>>2]=k[m+888+32>>2];k[q+4>>2]=k[m+888+32+4>>2];k[q+8>>2]=k[m+888+32+8>>2];k[q+12>>2]=k[m+888+32+12>>2];k[s>>2]=k[m+888+48>>2];k[s+4>>2]=k[m+888+48+4>>2];k[s+8>>2]=k[m+888+48+8>>2];k[s+12>>2]=k[m+888+48+12>>2]}else{P=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;Ac[k[(k[P>>2]|0)+56>>2]&7](P,L+272|0,n);k[L+272>>2]=k[m+888>>2];k[L+272+4>>2]=k[m+888+4>>2];k[L+272+8>>2]=k[m+888+8>>2];k[L+272+12>>2]=k[m+888+12>>2];k[p>>2]=k[m+888+16>>2];k[p+4>>2]=k[m+888+16+4>>2];k[p+8>>2]=k[m+888+16+8>>2];k[p+12>>2]=k[m+888+16+12>>2];k[q>>2]=k[m+888+32>>2];k[q+4>>2]=k[m+888+32+4>>2];k[q+8>>2]=k[m+888+32+8>>2];k[q+12>>2]=k[m+888+32+12>>2];k[s>>2]=k[m+888+48>>2];k[s+4>>2]=k[m+888+48+4>>2];k[s+8>>2]=k[m+888+48+8>>2];k[s+12>>2]=k[m+888+48+12>>2];P=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;Ac[k[(k[P>>2]|0)+56>>2]&7](P,L+272|0,n)}if(l&1){P=(i[m+180>>0]|0)!=0?m+824|0:m+888|0;M=+o[P>>2];e=+o[P+4>>2];d=+o[P+16>>2];f=+o[P+20>>2];N=+o[P+32>>2];O=+o[P+36>>2];V=+o[P+48>>2];T=+o[P+52>>2];R=+o[P+56>>2];c=+o[m+184>>2];U=+o[P+8>>2]*0.0;S=+o[P+24>>2]*0.0;Q=+o[P+40>>2]*0.0;o[L+528>>2]=V+(U+(e*0.0+M*c));o[L+528+4>>2]=T+(S+(f*0.0+d*c));o[L+528+8>>2]=R+(Q+(O*0.0+N*c));o[L+528+12>>2]=0.0;c=+o[m+188>>2];o[L+208>>2]=V+(U+(e*0.0+M*c));o[L+208+4>>2]=T+(S+(f*0.0+d*c));o[L+208+8>>2]=R+(Q+(O*0.0+N*c));o[L+208+12>>2]=0.0;P=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;l=k[(k[P>>2]|0)+8>>2]|0;k[L+608>>2]=0;k[L+608+4>>2]=0;k[L+608+8>>2]=0;k[L+608+12>>2]=0;Cc[l&127](P,L+528|0,L+208|0,L+608|0);o[L+240>>2]=M;o[L+240+4>>2]=d;o[L+240+8>>2]=N;o[L+240+12>>2]=0.0;o[L+640>>2]=e;o[L+640+4>>2]=f;o[L+640+8>>2]=O;o[L+640+12>>2]=0.0;O=+o[m+192>>2];f=+o[m+196>>2];P=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;l=k[(k[P>>2]|0)+60>>2]|0;k[L+256>>2]=0;k[L+256+4>>2]=0;k[L+256+8>>2]=0;k[L+256+12>>2]=0;bc[l&0](P,m+888+48|0,L+240|0,L+640|0,n,n,O,f,L+256|0,1,10.0)}break b}default:break b}while(0);b=K}}while(0);if(((((Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0)!=0?(P=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0,((Wb[k[(k[P>>2]|0)+48>>2]&127](P)|0)&16387|0)!=0):0)?(Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0)!=0:0)?(P=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0,(Wb[k[(k[P>>2]|0)+48>>2]&127](P)|0)!=0):0)?(k[a+280>>2]|0)>0:0){b=0;do{P=k[(k[a+288>>2]|0)+(b<<2)>>2]|0;Ub[k[(k[P>>2]|0)+12>>2]&127](P,k[a+72>>2]|0);b=b+1|0}while((b|0)<(k[a+280>>2]|0))}b=k[5104]|0;P=(k[b+16>>2]|0)+-1|0;k[b+16>>2]=P;if(P){r=L;return}do if(k[b+4>>2]|0){Kb(L+272|0,0)|0;P=k[5090]|0;o[b+8>>2]=+(((k[L+272+4>>2]|0)-(k[P+4>>2]|0)+(((k[L+272>>2]|0)-(k[P>>2]|0)|0)*1e6|0)-(k[b+12>>2]|0)|0)>>>0)/1.0e3+ +o[b+8>>2];if(!(k[b+16>>2]|0)){b=k[5104]|0;break}else{r=L;return}}while(0);k[5104]=k[b+20>>2];r=L;return}function jp(a){a=a|0;var b=0,c=0;if((k[a+232>>2]|0)<=0)return;b=0;do{c=(k[(k[a+240>>2]|0)+(b<<2)>>2]|0)+412|0;k[c>>2]=0;k[c+4>>2]=0;k[c+8>>2]=0;k[c+12>>2]=0;k[c+16>>2]=0;k[c+20>>2]=0;k[c+24>>2]=0;k[c+28>>2]=0;b=b+1|0}while((b|0)<(k[a+232>>2]|0));return}function kp(a){a=a|0;var b=0,c=0,d=0,e=0,f=0.0,g=0.0;d=k[a+232>>2]|0;if((d|0)<=0)return;a=k[a+240>>2]|0;c=0;while(1){b=k[a+(c<<2)>>2]|0;e=k[b+216>>2]|0;if(!((e|0)==2|(e|0)==5)?(k[b+204>>2]&3|0)==0:0){g=+o[b+368>>2]*+o[b+352>>2];f=+o[b+372>>2]*+o[b+356>>2];o[b+412>>2]=+o[b+364>>2]*+o[b+348>>2]+ +o[b+412>>2];o[b+416>>2]=g+ +o[b+416>>2];o[b+420>>2]=f+ +o[b+420>>2]}if((c|0)==(d+-1|0))break;else c=c+1|0}return}function lp(a){a=a|0;var b=0,c=0.0,d=0,e=0,f=0.0,g=0.0,h=0,j=0;h=r;r=r+64|0;Cw(1768);if(!(i[a+274>>0]|0)){b=k[a+232>>2]|0;if((b|0)>0){e=0;do{d=k[(k[a+240>>2]|0)+(e<<2)>>2]|0;j=k[d+216>>2]|0;if((!((j|0)==2|(j|0)==5)?(k[d+480>>2]|0)!=0:0)?(k[d+204>>2]&3|0)==0:0){if((i[a+300>>0]|0)!=0?(g=+o[a+268>>2],g!=0.0):0)c=+o[a+264>>2]-g;else c=+o[a+264>>2]*+o[d+244>>2];Qw(d+68|0,+o[d+132>>2],+o[d+136>>2],+o[d+140>>2],d+148|0,c,h);b=k[d+480>>2]|0;Ub[k[(k[b>>2]|0)+12>>2]&127](b,h);b=k[a+232>>2]|0}e=e+1|0}while((e|0)<(b|0))}}else{b=k[a+8>>2]|0;if((b|0)>0){e=0;do{d=k[(k[a+16>>2]|0)+(e<<2)>>2]|0;if((!((d|0)==0?1:(k[d+236>>2]&2|0)==0)?(k[d+480>>2]|0)!=0:0)?(k[d+204>>2]&3|0)==0:0){if((i[a+300>>0]|0)!=0?(f=+o[a+268>>2],f!=0.0):0)c=+o[a+264>>2]-f;else c=+o[a+264>>2]*+o[d+244>>2];Qw(d+68|0,+o[d+132>>2],+o[d+136>>2],+o[d+140>>2],d+148|0,c,h);b=k[d+480>>2]|0;Ub[k[(k[b>>2]|0)+12>>2]&127](b,h);b=k[a+8>>2]|0}e=e+1|0}while((e|0)<(b|0))}}b=k[5104]|0;j=(k[b+16>>2]|0)+-1|0;k[b+16>>2]=j;if(j){r=h;return}do if(k[b+4>>2]|0){Kb(h|0,0)|0;j=k[5090]|0;o[b+8>>2]=+(((k[h+4>>2]|0)-(k[j+4>>2]|0)+(((k[h>>2]|0)-(k[j>>2]|0)|0)*1e6|0)-(k[b+12>>2]|0)|0)>>>0)/1.0e3+ +o[b+8>>2];if(!(k[b+16>>2]|0)){b=k[5104]|0;break}else{r=h;return}}while(0);k[5104]=k[b+20>>2];r=h;return}function mp(a,b,c,d){a=a|0;b=+b;c=c|0;d=+d;var e=0,f=0.0,g=0,h=0;h=r;r=r+16|0;Kb(k[5090]|0,0)|0;Bw(20368);k[5093]=(k[5093]|0)+1;g=k[5096]|0;k[5096]=g+1;if(!g){Kb(h|0,0)|0;g=k[5090]|0;k[5095]=(k[h+4>>2]|0)-(k[g+4>>2]|0)+(((k[h>>2]|0)-(k[g>>2]|0)|0)*1e6|0)}k[5106]=0;Kb(h|0,0)|0;Cw(1792);if(c){o[a+268>>2]=d;f=+o[a+264>>2]+b;o[a+264>>2]=f;if(!(f>=d)){b=d;g=0}else{o[a+264>>2]=f-+(~~(f/d)|0)*d;b=d;g=~~(f/d)}}else{o[a+264>>2]=(i[a+300>>0]|0)!=0?0.0:b;o[a+268>>2]=0.0;g=!(+X(+b)<1.1920928955078125e-07)&1;c=g}if(Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0){e=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;e=(Wb[k[(k[e>>2]|0)+48>>2]&127](e)|0)>>>4&1;i[1448]=e}if(g){e=(g|0)>(c|0)?c:g;Rb[k[(k[a>>2]|0)+164>>2]&31](a,b*+(e|0));Sb[k[(k[a>>2]|0)+168>>2]&255](a);if((e|0)>0){c=0;do{Rb[k[(k[a>>2]|0)+160>>2]&31](a,b);Sb[k[(k[a>>2]|0)+80>>2]&255](a);c=c+1|0}while((c|0)<(e|0))}}else Sb[k[(k[a>>2]|0)+80>>2]&255](a);Sb[k[(k[a>>2]|0)+120>>2]&255](a);k[5106]=(k[5106]|0)+1;e=k[5104]|0;a=(k[e+16>>2]|0)+-1|0;k[e+16>>2]=a;if(a){r=h;return g|0}do if(k[e+4>>2]|0){Kb(h|0,0)|0;a=k[5090]|0;o[e+8>>2]=+(((k[h+4>>2]|0)-(k[a+4>>2]|0)+(((k[h>>2]|0)-(k[a>>2]|0)|0)*1e6|0)-(k[e+12>>2]|0)|0)>>>0)/1.0e3+ +o[e+8>>2];if(!(k[e+16>>2]|0)){e=k[5104]|0;break}else{r=h;return g|0}}while(0);k[5104]=k[e+20>>2];r=h;return g|0}function np(a,b){a=a|0;b=+b;var c=0,d=0,e=0,f=0,g=0,h=0,l=0.0,m=0.0,n=0.0,p=0.0,q=0,s=0,t=0,u=0,v=0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0;D=r;r=r+464|0;Cw(1808);c=k[a+84>>2]|0;if(c)Rb[c&31](a,b);Rb[k[(k[a>>2]|0)+140>>2]&31](a,b);o[a+28>>2]=b;k[a+32>>2]=0;c=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;k[a+48>>2]=c;Cw(1944);Cw(1976);c=k[a+316>>2]|0;if((k[a+308>>2]|0)>0){d=0;do{q=k[a+24>>2]|0;Ub[k[(k[q>>2]|0)+16>>2]&127](q,k[c+(d<<2)>>2]|0);d=d+1|0;c=k[a+316>>2]|0}while((d|0)<(k[a+308>>2]|0))}if(c){if(i[a+320>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[a+316>>2]=0}i[a+320>>0]=1;k[a+316>>2]=0;k[a+308>>2]=0;k[a+312>>2]=0;c=k[5104]|0;q=(k[c+16>>2]|0)+-1|0;k[c+16>>2]=q;do if(!q){if(k[c+4>>2]|0){Kb(D+368|0,0)|0;q=k[5090]|0;o[c+8>>2]=+(((k[D+368+4>>2]|0)-(k[q+4>>2]|0)+(((k[D+368>>2]|0)-(k[q>>2]|0)|0)*1e6|0)-(k[c+12>>2]|0)|0)>>>0)/1.0e3+ +o[c+8>>2];if(k[c+16>>2]|0)break;c=k[5104]|0}k[5104]=k[c+20>>2]}while(0);if((k[a+232>>2]|0)>0){s=D+304+48|0;t=D+368+44|0;u=0;do{h=k[(k[a+240>>2]|0)+(u<<2)>>2]|0;o[h+244>>2]=1.0;q=k[h+216>>2]|0;do if(((!((q|0)==2|(q|0)==5)?(k[h+204>>2]&3|0)==0:0)?(Qw(h+4|0,+o[h+312>>2],+o[h+316>>2],+o[h+320>>2],h+328|0,b,D+304|0),w=+o[s>>2],x=w-+o[h+52>>2],y=+o[D+304+52>>2],z=y-+o[h+56>>2],A=+o[D+304+56>>2],B=A-+o[h+60>>2],(i[a+44>>0]|0)!=0):0)?(p=+o[h+252>>2],p*p!=0.0?p*p<x*x+z*z+B*B:0):0){Cw(2016);if((k[(k[h+192>>2]|0)+4>>2]|0)<20?(k[484]=(k[484]|0)+1,g=k[a+68>>2]|0,g=Wb[k[(k[g>>2]|0)+36>>2]&127](g)|0,q=k[a+24>>2]|0,o[D+368+4>>2]=1.0,j[D+368+8>>1]=1,j[D+368+10>>1]=-1,k[D+368>>2]=880,k[D+368+12>>2]=k[h+52>>2],k[D+368+12+4>>2]=k[h+52+4>>2],k[D+368+12+8>>2]=k[h+52+8>>2],k[D+368+12+12>>2]=k[h+52+12>>2],k[D+368+28>>2]=k[s>>2],k[D+368+28+4>>2]=k[s+4>>2],k[D+368+28+8>>2]=k[s+8>>2],k[D+368+28+12>>2]=k[s+12>>2],k[D+368+76>>2]=0,k[D+368>>2]=2296,k[D+368+80>>2]=h,k[D+368+88>>2]=g,k[D+368+92>>2]=q,C=+o[h+248>>2],k[D+248+8>>2]=0,o[D+248+12>>2]=1.0,o[D+248+16>>2]=1.0,o[D+248+20>>2]=1.0,o[D+248+24>>2]=0.0,k[D+248>>2]=12008,k[D+248+4>>2]=8,o[D+248+28>>2]=C,o[D+248+44>>2]=C,o[D+368+84>>2]=+o[a+56>>2],q=k[h+188>>2]|0,j[D+368+8>>1]=j[q+4>>1]|0,j[D+368+10>>1]=j[q+6>>1]|0,k[D+184+48>>2]=k[s>>2],k[D+184+48+4>>2]=k[s+4>>2],k[D+184+48+8>>2]=k[s+8>>2],k[D+184+48+12>>2]=k[s+12>>2],k[D+184>>2]=k[h+4>>2],k[D+184+4>>2]=k[h+4+4>>2],k[D+184+8>>2]=k[h+4+8>>2],k[D+184+12>>2]=k[h+4+12>>2],k[D+184+16>>2]=k[h+20>>2],k[D+184+16+4>>2]=k[h+20+4>>2],k[D+184+16+8>>2]=k[h+20+8>>2],k[D+184+16+12>>2]=k[h+20+12>>2],k[D+184+32>>2]=k[h+36>>2],k[D+184+32+4>>2]=k[h+36+4>>2],k[D+184+32+8>>2]=k[h+36+8>>2],k[D+184+32+12>>2]=k[h+36+12>>2],ws(a,D+248|0,h+4|0,D+184|0,D+368|0,0.0),C=+o[D+368+4>>2],C<1.0):0){l=C*(w-+o[h+52>>2]);m=C*(y-+o[h+56>>2]);n=C*(A-+o[h+60>>2]);p=-(m*+o[D+368+48>>2])-l*+o[t>>2]-n*+o[D+368+52>>2];q=k[a+24>>2]|0;q=dc[k[(k[q>>2]|0)+12>>2]&63](q,h,k[D+368+76>>2]|0)|0;c=k[a+308>>2]|0;if((c|0)==(k[a+312>>2]|0)?(v=(c|0)==0?1:c<<1,(c|0)<(v|0)):0){if(!v)d=0;else{k[5108]=(k[5108]|0)+1;d=iF((v<<2|3)+16|0)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}c=k[a+308>>2]|0}if((c|0)>0){e=c+-1|0;g=0;while(1){f=d+(g<<2)|0;if(f)k[f>>2]=k[(k[a+316>>2]|0)+(g<<2)>>2];if((g|0)==(e|0))break;else g=g+1|0}}e=k[a+316>>2]|0;if(e){if(i[a+320>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0);c=k[a+308>>2]|0}k[a+316>>2]=0}i[a+320>>0]=1;k[a+316>>2]=d;k[a+312>>2]=v}d=(k[a+316>>2]|0)+(c<<2)|0;if(d)k[d>>2]=q;k[a+308>>2]=c+1;l=l+ +o[h+52>>2];m=m+ +o[h+56>>2];n=n+ +o[h+60>>2];g=k[D+368+76>>2]|0;P=+o[g+4>>2];O=+o[g+20>>2];N=+o[g+36>>2];M=+o[g+8>>2];L=+o[g+24>>2];K=+o[g+40>>2];J=+o[g+12>>2];H=+o[g+28>>2];F=+o[g+44>>2];I=-+o[g+52>>2];G=-+o[g+56>>2];E=-+o[g+60>>2];k[D>>2]=0;k[D+4>>2]=0;k[D+8>>2]=0;k[D+12>>2]=0;o[D+16>>2]=l*P+m*O+n*N+(P*I+O*G+N*E);o[D+20>>2]=l*M+m*L+n*K+(M*I+L*G+K*E);o[D+24>>2]=l*J+m*H+n*F+(J*I+H*G+F*E);o[D+28>>2]=0.0;k[D+64>>2]=k[t>>2];k[D+64+4>>2]=k[t+4>>2];k[D+64+8>>2]=k[t+8>>2];k[D+64+12>>2]=k[t+12>>2];o[D+80>>2]=p;o[D+84>>2]=0.0;o[D+88>>2]=0.0;o[D+92>>2]=0.0;k[D+112>>2]=0;i[D+116>>0]=0;k[D+120>>2]=0;k[D+120+4>>2]=0;k[D+120+8>>2]=0;k[D+120+12>>2]=0;k[D+120+16>>2]=0;k[D+120+20>>2]=0;k[D+120+24>>2]=0;k[D+120+28>>2]=0;g=qr(q,D)|0;o[q+4+(g*184|0)+92>>2]=0.0;p=+o[h+224>>2]*+o[(k[D+368+76>>2]|0)+224>>2];p=p<-10.0?-10.0:p;o[q+4+(g*184|0)+84>>2]=p>10.0?10.0:p;k[q+4+(g*184|0)+48>>2]=k[h+52>>2];k[q+4+(g*184|0)+48+4>>2]=k[h+52+4>>2];k[q+4+(g*184|0)+48+8>>2]=k[h+52+8>>2];k[q+4+(g*184|0)+48+12>>2]=k[h+52+12>>2];o[q+4+(g*184|0)+32>>2]=l;o[q+4+(g*184|0)+36>>2]=m;o[q+4+(g*184|0)+40>>2]=n;o[q+4+(g*184|0)+44>>2]=0.0}d=k[5104]|0;q=(k[d+16>>2]|0)+-1|0;k[d+16>>2]=q;if(!q){if(k[d+4>>2]|0){Kb(D+368|0,0)|0;q=k[5090]|0;o[d+8>>2]=+(((k[D+368+4>>2]|0)-(k[q+4>>2]|0)+(((k[D+368>>2]|0)-(k[q>>2]|0)|0)*1e6|0)-(k[d+12>>2]|0)|0)>>>0)/1.0e3+ +o[d+8>>2];if(k[d+16>>2]|0)break;d=k[5104]|0}k[5104]=k[d+20>>2]}}while(0);u=u+1|0}while((u|0)<(k[a+232>>2]|0))}c=k[5104]|0;q=(k[c+16>>2]|0)+-1|0;k[c+16>>2]=q;do if(!q){if(k[c+4>>2]|0){Kb(D+368|0,0)|0;q=k[5090]|0;o[c+8>>2]=+(((k[D+368+4>>2]|0)-(k[q+4>>2]|0)+(((k[D+368>>2]|0)-(k[q>>2]|0)|0)*1e6|0)-(k[c+12>>2]|0)|0)>>>0)/1.0e3+ +o[c+8>>2];if(k[c+16>>2]|0)break;c=k[5104]|0}k[5104]=k[c+20>>2]}while(0);Sb[k[(k[a>>2]|0)+44>>2]&255](a);Sb[k[(k[a>>2]|0)+148>>2]&255](a);o[a+104>>2]=b;Ub[k[(k[a>>2]|0)+152>>2]&127](a,a+92|0);Rb[k[(k[a>>2]|0)+144>>2]&31](a,b);Cw(1840);if((k[a+280>>2]|0)>0){c=0;do{q=k[(k[a+288>>2]|0)+(c<<2)>>2]|0;Ac[k[(k[q>>2]|0)+8>>2]&7](q,a,b);c=c+1|0}while((c|0)<(k[a+280>>2]|0))}c=k[5104]|0;q=(k[c+16>>2]|0)+-1|0;k[c+16>>2]=q;do if(!q){if(k[c+4>>2]|0){Kb(D+368|0,0)|0;q=k[5090]|0;o[c+8>>2]=+(((k[D+368+4>>2]|0)-(k[q+4>>2]|0)+(((k[D+368>>2]|0)-(k[q>>2]|0)|0)*1e6|0)-(k[c+12>>2]|0)|0)>>>0)/1.0e3+ +o[c+8>>2];if(k[c+16>>2]|0)break;c=k[5104]|0}k[5104]=k[c+20>>2]}while(0);Rb[k[(k[a>>2]|0)+156>>2]&31](a,b);c=k[a+80>>2]|0;if(c)Rb[c&31](a,b);c=k[5104]|0;a=(k[c+16>>2]|0)+-1|0;k[c+16>>2]=a;if(a){r=D;return}do if(k[c+4>>2]|0){Kb(D+368|0,0)|0;a=k[5090]|0;o[c+8>>2]=+(((k[D+368+4>>2]|0)-(k[a+4>>2]|0)+(((k[D+368>>2]|0)-(k[a>>2]|0)|0)*1e6|0)-(k[c+12>>2]|0)|0)>>>0)/1.0e3+ +o[c+8>>2];if(!(k[c+16>>2]|0)){c=k[5104]|0;break}else{r=D;return}}while(0);k[5104]=k[c+20>>2];r=D;return}function op(a,b){a=a|0;b=b|0;var c=0,d=0.0,e=0,f=0,g=0,h=0.0,i=0.0;k[a+248>>2]=k[b>>2];k[a+248+4>>2]=k[b+4>>2];k[a+248+8>>2]=k[b+8>>2];k[a+248+12>>2]=k[b+12>>2];c=k[a+232>>2]|0;if((c|0)<=0)return;f=0;do{e=k[(k[a+240>>2]|0)+(f<<2)>>2]|0;g=k[e+216>>2]|0;if(!((g|0)==2|(g|0)==5)?(k[e+504>>2]&1|0)==0:0){d=+o[e+344>>2];if(d!=0.0){i=1.0/d*+o[b+4>>2];h=1.0/d*+o[b+8>>2];o[e+364>>2]=1.0/d*+o[b>>2];o[e+368>>2]=i;o[e+372>>2]=h;o[e+376>>2]=0.0}k[e+380>>2]=k[b>>2];k[e+380+4>>2]=k[b+4>>2];k[e+380+8>>2]=k[b+8>>2];k[e+380+12>>2]=k[b+12>>2];c=k[a+232>>2]|0}f=f+1|0}while((f|0)<(c|0));return}function pp(a,b){a=a|0;b=b|0;k[a>>2]=k[b+248>>2];k[a+4>>2]=k[b+248+4>>2];k[a+8>>2]=k[b+248+8>>2];k[a+12>>2]=k[b+248+12>>2];return}function qp(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;os(a,b,c,d);return}function rp(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0;if(!((b|0)==0?1:(k[b+236>>2]&2|0)==0)){Ub[k[(k[a>>2]|0)+92>>2]&127](a,b);return}c=k[b+188>>2]|0;if(c){f=k[a+68>>2]|0;f=Wb[k[(k[f>>2]|0)+36>>2]&127](f)|0;yc[k[(k[f>>2]|0)+40>>2]&127](f,c,k[a+24>>2]|0);f=k[a+68>>2]|0;yc[k[(k[f>>2]|0)+12>>2]&127](f,c,k[a+24>>2]|0);k[b+188>>2]=0}e=k[a+8>>2]|0;if((e|0)<=0)return;f=k[a+16>>2]|0;c=0;while(1){d=f+(c<<2)|0;if((k[d>>2]|0)==(b|0))break;c=c+1|0;if((c|0)>=(e|0)){g=11;break}}if((g|0)==11)return;if((c|0)>=(e|0))return;k[d>>2]=k[f+(e+-1<<2)>>2];k[(k[a+16>>2]|0)+(e+-1<<2)>>2]=b;k[a+8>>2]=e+-1;return}function sp(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0;e=k[a+232>>2]|0;a:do if((e|0)>0){f=k[a+240>>2]|0;c=0;while(1){d=f+(c<<2)|0;if((k[d>>2]|0)==(b|0))break;c=c+1|0;if((c|0)>=(e|0))break a}if((c|0)<(e|0)){k[d>>2]=k[f+(e+-1<<2)>>2];k[(k[a+240>>2]|0)+(e+-1<<2)>>2]=b;k[a+232>>2]=e+-1}}while(0);c=k[b+188>>2]|0;if(c){f=k[a+68>>2]|0;f=Wb[k[(k[f>>2]|0)+36>>2]&127](f)|0;yc[k[(k[f>>2]|0)+40>>2]&127](f,c,k[a+24>>2]|0);f=k[a+68>>2]|0;yc[k[(k[f>>2]|0)+12>>2]&127](f,c,k[a+24>>2]|0);k[b+188>>2]=0}e=k[a+8>>2]|0;if((e|0)<=0)return;f=k[a+16>>2]|0;c=0;while(1){d=f+(c<<2)|0;if((k[d>>2]|0)==(b|0))break;c=c+1|0;if((c|0)>=(e|0)){g=15;break}}if((g|0)==15)return;if((c|0)>=(e|0))return;k[d>>2]=k[f+(e+-1<<2)>>2];k[(k[a+16>>2]|0)+(e+-1<<2)>>2]=b;k[a+8>>2]=e+-1;return}function tp(a,b){a=a|0;b=b|0;var c=0,d=0,e=0.0,f=0,g=0,h=0,j=0,l=0.0,m=0.0;c=k[b+204>>2]|0;if((c&3|0)==0?(k[b+504>>2]&1|0)==0:0){e=+o[b+344>>2];if(e!=0.0){m=1.0/e*+o[a+252>>2];l=1.0/e*+o[a+256>>2];o[b+364>>2]=1.0/e*+o[a+248>>2];o[b+368>>2]=m;o[b+372>>2]=l;o[b+376>>2]=0.0}k[b+380>>2]=k[a+248>>2];k[b+380+4>>2]=k[a+248+4>>2];k[b+380+8>>2]=k[a+248+8>>2];k[b+380+12>>2]=k[a+248+12>>2]}if(!(k[b+192>>2]|0))return;if(c&1){if((k[b+216>>2]&-2|0)!=4)k[b+216>>2]=2}else{d=k[a+232>>2]|0;if((d|0)==(k[a+236>>2]|0)?(j=(d|0)==0?1:d<<1,(d|0)<(j|0)):0){if(!j)h=0;else{k[5108]=(k[5108]|0)+1;c=iF((j<<2|3)+16|0)|0;if(!c)d=0;else{k[(c+4+15&-16)+-4>>2]=c;d=c+4+15&-16}h=d;d=k[a+232>>2]|0}if((d|0)>0){c=d+-1|0;g=0;while(1){f=h+(g<<2)|0;if(f)k[f>>2]=k[(k[a+240>>2]|0)+(g<<2)>>2];if((g|0)==(c|0))break;else g=g+1|0}}c=k[a+240>>2]|0;if(c){if(i[a+244>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);d=k[a+232>>2]|0}k[a+240>>2]=0}i[a+244>>0]=1;k[a+240>>2]=h;k[a+236>>2]=j}c=(k[a+240>>2]|0)+(d<<2)|0;if(c)k[c>>2]=b;k[a+232>>2]=d+1;c=k[b+204>>2]|0}if(!(c&1))c=(c&2|0)==0;else c=0;Cc[k[(k[a>>2]|0)+36>>2]&127](a,b,c?1:2,c?-1:-3);return}function up(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0.0,h=0,j=0,l=0,m=0,n=0.0,p=0.0;f=k[b+204>>2]|0;if((f&3|0)==0?(k[b+504>>2]&1|0)==0:0){g=+o[b+344>>2];if(g!=0.0){p=1.0/g*+o[a+252>>2];n=1.0/g*+o[a+256>>2];o[b+364>>2]=1.0/g*+o[a+248>>2];o[b+368>>2]=p;o[b+372>>2]=n;o[b+376>>2]=0.0}k[b+380>>2]=k[a+248>>2];k[b+380+4>>2]=k[a+248+4>>2];k[b+380+8>>2]=k[a+248+8>>2];k[b+380+12>>2]=k[a+248+12>>2]}if(!(k[b+192>>2]|0))return;if(f&1){if((k[b+216>>2]&-2|0)!=4)k[b+216>>2]=2}else{f=k[a+232>>2]|0;if((f|0)==(k[a+236>>2]|0)?(m=(f|0)==0?1:f<<1,(f|0)<(m|0)):0){if(!m)l=0;else{k[5108]=(k[5108]|0)+1;e=iF((m<<2|3)+16|0)|0;if(!e)f=0;else{k[(e+4+15&-16)+-4>>2]=e;f=e+4+15&-16}l=f;f=k[a+232>>2]|0}if((f|0)>0){e=f+-1|0;j=0;while(1){h=l+(j<<2)|0;if(h)k[h>>2]=k[(k[a+240>>2]|0)+(j<<2)>>2];if((j|0)==(e|0))break;else j=j+1|0}}e=k[a+240>>2]|0;if(e){if(i[a+244>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0);f=k[a+232>>2]|0}k[a+240>>2]=0}i[a+244>>0]=1;k[a+240>>2]=l;k[a+236>>2]=m}e=(k[a+240>>2]|0)+(f<<2)|0;if(e)k[e>>2]=b;k[a+232>>2]=f+1}Cc[k[(k[a>>2]|0)+36>>2]&127](a,b,c,d);return}
function Ot(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0.0,g=0.0,h=0.0,i=0.0,j=0,l=0,m=0,n=0,p=0,q=0,s=0,t=0,u=0,v=0,w=0,x=0.0,y=0;w=r;r=r+2048|0;if((d|0)<=0){r=w;return}e=0;while(1){o[c+(e<<4)+12>>2]=-999999984306749440.0;if((e|0)==(d+-1|0))break;else e=e+1|0}t=0;while(1){if((Wb[k[(k[a>>2]|0)+96>>2]&127](a)|0)>0){s=b+(t<<4)|0;m=b+(t<<4)+4|0;n=b+(t<<4)+8|0;p=c+(t<<4)+12|0;q=c+(t<<4)|0;u=0;do{if(((Wb[k[(k[a>>2]|0)+96>>2]&127](a)|0)-u|0)<128){e=(Wb[k[(k[a>>2]|0)+96>>2]&127](a)|0)-u|0;if((e|0)>0)v=9;else{f=-3402823466385288598117041.0e14;e=-1}}else{e=128;v=9}if((v|0)==9){v=0;l=e+-1|0;e=0;while(1){yc[k[(k[a>>2]|0)+108>>2]&127](a,e,w+(e<<4)|0);if((e|0)==(l|0))break;else e=e+1|0}g=+o[s>>2];h=+o[m>>2];i=+o[n>>2];j=0;f=-3402823466385288598117041.0e14;e=-1;while(1){x=g*+o[w+(j<<4)>>2]+h*+o[w+(j<<4)+4>>2]+i*+o[w+(j<<4)+8>>2];y=x>f;e=y?j:e;f=y?x:f;if((j|0)==(l|0))break;else j=j+1|0}}if(f>+o[p>>2]){y=w+(e<<4)|0;k[q>>2]=k[y>>2];k[q+4>>2]=k[y+4>>2];k[q+8>>2]=k[y+8>>2];k[q+12>>2]=k[y+12>>2];o[p>>2]=f}u=u+128|0}while((u|0)<(Wb[k[(k[a>>2]|0)+96>>2]&127](a)|0))}if((t|0)==(d+-1|0))break;else t=t+1|0}r=w;return}function Pt(a,b,c){a=a|0;b=+b;c=c|0;var d=0,e=0.0,f=0.0,g=0.0,h=0;d=r;r=r+96|0;g=+gc[k[(k[a>>2]|0)+48>>2]&15](a);o[d+32>>2]=1.0;k[d+32+4>>2]=0;k[d+32+4+4>>2]=0;k[d+32+4+8>>2]=0;k[d+32+4+12>>2]=0;o[d+32+20>>2]=1.0;k[d+32+24>>2]=0;k[d+32+24+4>>2]=0;k[d+32+24+8>>2]=0;k[d+32+24+12>>2]=0;o[d+32+40>>2]=1.0;h=d+32+44|0;k[h>>2]=0;k[h+4>>2]=0;k[h+8>>2]=0;k[h+12>>2]=0;k[h+16>>2]=0;Cc[k[(k[a>>2]|0)+8>>2]&127](a,d+32|0,d+16|0,d);f=(g+(+o[d>>2]-+o[d+16>>2])*.5)*2.0;e=(g+(+o[d+4>>2]-+o[d+16+4>>2])*.5)*2.0;g=(g+(+o[d+8>>2]-+o[d+16+8>>2])*.5)*2.0;o[c>>2]=b*.0833333283662796*(e*e+g*g);o[c+4>>2]=b*.0833333283662796*(f*f+g*g);o[c+8>>2]=b*.0833333283662796*(f*f+e*e);o[c+12>>2]=0.0;r=d;return}function Qt(a){a=a|0;var b=0,c=0,d=0,e=0.0;c=r;r=r+96|0;i[a+88>>0]=1;if((i[13560]|0)==0?(db(13560)|0)!=0:0){o[3366]=1.0;k[3367]=0;k[3368]=0;k[3369]=0;k[3370]=0;o[3371]=1.0;k[3372]=0;k[3373]=0;k[3374]=0;k[3375]=0;o[3376]=1.0;o[3377]=0.0;o[3378]=-1.0;k[3379]=0;k[3380]=0;k[3381]=0;k[3382]=0;o[3383]=-1.0;k[3384]=0;k[3385]=0;k[3386]=0;k[3387]=0;o[3388]=-1.0;o[3389]=0.0;ib(13560)}b=c;d=b+96|0;do{k[b>>2]=0;b=b+4|0}while((b|0)<(d|0));Cc[k[(k[a>>2]|0)+76>>2]&127](a,13464,c,6);e=+o[a+44>>2];o[a+72>>2]=+o[c>>2]+e;o[a+56>>2]=+o[c+48>>2]-e;o[a+76>>2]=+o[c+20>>2]+e;o[a+60>>2]=+o[c+68>>2]-e;o[a+80>>2]=+o[c+40>>2]+e;o[a+64>>2]=+o[c+88>>2]-e;r=c;return}function Rt(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0;n=+gc[k[(k[a>>2]|0)+48>>2]&15](a);u=+o[a+72>>2];t=+o[a+56>>2];r=+o[a+76>>2];q=+o[a+60>>2];m=+o[a+80>>2];l=+o[a+64>>2];E=+o[b>>2];y=+X(+E);D=+o[b+4>>2];x=+X(+D);i=+o[b+8>>2];j=+X(+i);C=+o[b+16>>2];w=+X(+C);B=+o[b+20>>2];v=+X(+B);g=+o[b+24>>2];h=+X(+g);A=+o[b+32>>2];s=+X(+A);z=+o[b+36>>2];p=+X(+z);e=+o[b+40>>2];f=+X(+e);i=(u+t)*.5*E+(r+q)*.5*D+(m+l)*.5*i+ +o[b+48>>2];g=(u+t)*.5*C+(r+q)*.5*B+(m+l)*.5*g+ +o[b+52>>2];e=(u+t)*.5*A+(r+q)*.5*z+(m+l)*.5*e+ +o[b+56>>2];j=(n+(u-t)*.5)*y+(n+(r-q)*.5)*x+(n+(m-l)*.5)*j;h=(n+(u-t)*.5)*w+(n+(r-q)*.5)*v+(n+(m-l)*.5)*h;f=(n+(u-t)*.5)*s+(n+(r-q)*.5)*p+(n+(m-l)*.5)*f;o[c>>2]=i-j;o[c+4>>2]=g-h;o[c+8>>2]=e-f;o[c+12>>2]=0.0;o[d>>2]=j+i;o[d+4>>2]=h+g;o[d+8>>2]=f+e;o[d+12>>2]=0.0;return}function St(a){a=a|0;var b=0;k[a>>2]=13336;b=k[a+52>>2]|0;if(!b)return;Sb[k[k[b>>2]>>2]&255](b);b=k[a+52>>2]|0;if(!b)return;k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0);return}function Tt(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0;d=r;r=r+96|0;o[d+32>>2]=1.0;k[d+32+4>>2]=0;k[d+32+4+4>>2]=0;k[d+32+4+8>>2]=0;k[d+32+4+12>>2]=0;o[d+32+20>>2]=1.0;k[d+32+24>>2]=0;k[d+32+24+4>>2]=0;k[d+32+24+8>>2]=0;k[d+32+24+12>>2]=0;o[d+32+40>>2]=1.0;m=d+32+44|0;k[m>>2]=0;k[m+4>>2]=0;k[m+8>>2]=0;k[m+12>>2]=0;k[m+16>>2]=0;Cc[k[(k[a>>2]|0)+8>>2]&127](a,d+32|0,d+16|0,d);i=+o[d>>2];j=+o[d+16>>2];g=+o[d+4>>2];h=+o[d+16+4>>2];e=+o[d+8>>2];f=+o[d+16+8>>2];l=+Y(+((i-j)*(i-j)+(g-h)*(g-h)+(e-f)*(e-f)))*.5;o[c>>2]=l;o[b>>2]=(j+i)*.5;o[b+4>>2]=(h+g)*.5;o[b+8>>2]=(f+e)*.5;o[b+12>>2]=0.0;r=d;return}function Ut(a,b){a=a|0;b=+b;return +(+gc[k[(k[a>>2]|0)+16>>2]&15](a)*b)}function Vt(a){a=a|0;var b=0,c=0.0,d=0.0,e=0.0;b=r;r=r+32|0;yc[k[(k[a>>2]|0)+12>>2]&127](a,b+8|0,b);e=+o[b+8>>2];d=+o[b+8+4>>2];c=+o[b+8+8>>2];c=+Y(+(e*e+d*d+c*c));r=b;return +(c+ +o[b>>2])}function Wt(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;var g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0;Cc[k[(k[a>>2]|0)+8>>2]&127](a,b,e,f);m=+o[f>>2];i=+o[f+4>>2];g=+o[f+8>>2];j=+o[e>>2];n=+o[e+4>>2];h=+o[e+8>>2];l=+o[c>>2];p=+o[c+4>>2];q=+o[c+8>>2];if(l>0.0)m=m+l;else j=j+l;if(p>0.0){l=n;i=i+p}else l=n+p;if(q>0.0)g=g+q;else h=h+q;n=+o[d>>2];p=+o[d+4>>2];q=+o[d+8>>2];q=+Y(+(n*n+p*p+q*q));q=q*+gc[k[(k[a>>2]|0)+16>>2]&15](a);o[e>>2]=j;o[e+4>>2]=l;o[e+8>>2]=h;o[e+12>>2]=0.0;o[f>>2]=m;o[f+4>>2]=i;o[f+8>>2]=g;o[f+12>>2]=0.0;o[e>>2]=+o[e>>2]-q;o[e+4>>2]=+o[e+4>>2]-q;o[e+8>>2]=+o[e+8>>2]-q;o[f>>2]=q+ +o[f>>2];o[f+4>>2]=q+ +o[f+4>>2];o[f+8>>2]=q+ +o[f+8>>2];return}function Xt(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0;d=nc[k[(k[c>>2]|0)+40>>2]&31](c,a)|0;e=nc[k[(k[c>>2]|0)+28>>2]&31](c,d)|0;k[b>>2]=e;if(e)Ub[k[(k[c>>2]|0)+48>>2]&127](c,d);k[b+4>>2]=k[a+4>>2];return 13672}function Yt(a,b){a=a|0;b=b|0;var c=0,d=0;d=Wb[k[(k[a>>2]|0)+52>>2]&127](a)|0;d=dc[k[(k[b>>2]|0)+16>>2]&63](b,d,1)|0;c=dc[k[(k[a>>2]|0)+56>>2]&63](a,k[d+8>>2]|0,b)|0;Qb[k[(k[b>>2]|0)+20>>2]&31](b,d,c,1346455635,a);return}function Zt(a){a=a|0;return}function _t(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0.0,g=0.0,h=0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0;h=r;r=r+64|0;l=+o[c>>2];m=+o[c+4>>2];j=+o[c+8>>2];n=l*+o[b+4>>2]+m*+o[b+20>>2]+j*+o[b+36>>2];p=l*+o[b+8>>2]+m*+o[b+24>>2]+j*+o[b+40>>2];o[h+48>>2]=+o[b>>2]*l+ +o[b+16>>2]*m+ +o[b+32>>2]*j;o[h+48+4>>2]=n;o[h+48+8>>2]=p;o[h+48+12>>2]=0.0;yc[k[(k[a>>2]|0)+64>>2]&127](h+32|0,a,h+48|0);p=+o[h+32>>2];n=+o[h+32+4>>2];j=+o[h+32+8>>2];m=p*+o[b>>2]+n*+o[b+4>>2]+j*+o[b+8>>2]+ +o[b+48>>2];l=p*+o[b+16>>2]+n*+o[b+20>>2]+j*+o[b+24>>2]+ +o[b+52>>2];j=p*+o[b+32>>2]+n*+o[b+36>>2]+j*+o[b+40>>2]+ +o[b+56>>2];q=k[(k[a>>2]|0)+64>>2]|0;n=-+o[h+48+4>>2];p=-+o[h+48+8>>2];o[h>>2]=-+o[h+48>>2];o[h+4>>2]=n;o[h+8>>2]=p;o[h+12>>2]=0.0;yc[q&127](h+16|0,a,h);p=+o[h+16>>2];n=+o[h+16+4>>2];f=+o[h+16+8>>2];i=p*+o[b>>2]+n*+o[b+4>>2]+f*+o[b+8>>2]+ +o[b+48>>2];g=p*+o[b+16>>2]+n*+o[b+20>>2]+f*+o[b+24>>2]+ +o[b+52>>2];f=p*+o[b+32>>2]+n*+o[b+36>>2]+f*+o[b+40>>2]+ +o[b+56>>2];o[d>>2]=m*+o[c>>2]+l*+o[c+4>>2]+j*+o[c+8>>2];f=i*+o[c>>2]+g*+o[c+4>>2]+f*+o[c+8>>2];o[e>>2]=f;g=+o[d>>2];if(!(g>f)){r=h;return}o[d>>2]=f;o[e>>2]=g;r=h;return}function $t(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0.0,g=0.0,h=0.0,i=0,j=0.0,l=0.0,m=0.0,n=0.0,p=0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0;x=r;r=r+80|0;switch(k[b+4>>2]|0){case 8:{k[a>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;r=x;return}case 4:{p=k[b+104>>2]|0;i=k[b+96>>2]|0;m=+o[b+12>>2];n=+o[b+16>>2];l=+o[b+20>>2];j=+o[c>>2]*m;e=+o[c+4>>2]*n;h=+o[c+8>>2]*l;if((i|0)>0){b=0;f=-3402823466385288598117041.0e14;d=-1;while(1){g=j*+o[p+(b<<4)>>2]+e*+o[p+(b<<4)+4>>2]+h*+o[p+(b<<4)+8>>2];c=g>f;d=c?b:d;if((b|0)==(i+-1|0))break;else{b=b+1|0;f=c?g:f}}}else d=-1;v=n*+o[p+(d<<4)+4>>2];w=l*+o[p+(d<<4)+8>>2];o[a>>2]=m*+o[p+(d<<4)>>2];o[a+4>>2]=v;o[a+8>>2]=w;o[a+12>>2]=0.0;r=x;return}case 10:{g=+o[c>>2];f=+o[c+4>>2];e=+o[c+8>>2];c=k[b+52>>2]|0;w=+o[b+28+(c<<2)>>2];h=+o[b+28+(((c+2|0)%3|0)<<2)>>2];if(g*g+f*f+e*e<9.999999747378752e-05){v=1.0;u=0.0;t=0.0}else{t=1.0/+Y(+(g*g+f*f+e*e));v=g*t;u=f*t;t=e*t}k[x+16>>2]=0;k[x+16+4>>2]=0;k[x+16+8>>2]=0;k[x+16+12>>2]=0;o[x+16+(c<<2)>>2]=w;q=h*v;s=h*u;e=h*t;j=+o[b+44>>2];n=v*j;m=u*j;j=t*j;f=+o[x+16>>2]+q-n;l=s+ +o[x+16+4>>2]-m;h=e+ +o[x+16+8>>2]-j;g=t*h+(v*f+u*l);if(!(g>-999999984306749440.0)){h=0.0;l=0.0;f=0.0;g=-999999984306749440.0}k[x>>2]=0;k[x+4>>2]=0;k[x+8>>2]=0;k[x+12>>2]=0;o[x+(c<<2)>>2]=-w;q=q+ +o[x>>2]-n;n=s+ +o[x+4>>2]-m;w=e+ +o[x+8>>2]-j;c=t*w+(v*q+u*n)>g;o[a>>2]=c?q:f;o[a+4>>2]=c?n:l;o[a+8>>2]=c?w:h;o[a+12>>2]=0.0;r=x;return}case 0:{u=+o[b+28>>2];v=+o[b+28+4>>2];v=+o[c+4>>2]>=0.0?v:-v;w=+o[b+28+8>>2];w=+o[c+8>>2]>=0.0?w:-w;o[a>>2]=+o[c>>2]>=0.0?u:-u;o[a+4>>2]=v;o[a+8>>2]=w;o[a+12>>2]=0.0;r=x;return}case 1:{v=+o[c>>2];w=+o[c+4>>2];g=+o[c+8>>2];e=v*+o[b+56>>2]+w*+o[b+56+4>>2]+g*+o[b+56+8>>2];f=v*+o[b+56+16>>2]+w*+o[b+56+20>>2]+g*+o[b+56+24>>2];g=v*+o[b+56+32>>2]+w*+o[b+56+36>>2]+g*+o[b+56+40>>2];if(e<f)d=f<g?2:1;else d=e<g?2:0;v=+o[b+56+(d<<4)+4>>2];w=+o[b+56+(d<<4)+8>>2];o[a>>2]=+o[b+56+(d<<4)>>2];o[a+4>>2]=v;o[a+8>>2]=w;o[a+12>>2]=0.0;r=x;return}case 13:{k[x+64>>2]=k[b+28>>2];k[x+64+4>>2]=k[b+28+4>>2];k[x+64+8>>2]=k[b+28+8>>2];k[x+64+12>>2]=k[b+28+12>>2];o[x+48>>2]=+o[c>>2];f=+o[c+4>>2];o[x+48+4>>2]=f;g=+o[c+8>>2];o[x+48+8>>2]=g;o[x+48+12>>2]=0.0;d=k[b+52>>2]|0;if((d|0)==1){i=0;b=d;c=2}else if((d|0)==2){g=f;i=0;b=d;c=1}else{i=1;b=0;c=2}j=+o[x+64+(i<<2)>>2];e=+o[x+64+(d<<2)>>2];f=+o[x+48+(i<<2)>>2];h=+Y(+(f*f+g*g));if(h!=0.0){o[x+32+(i<<2)>>2]=f*(j/h);if(+o[x+48+(b<<2)>>2]<0.0)e=-e;o[x+32+(b<<2)>>2]=e;o[x+32+(c<<2)>>2]=j/h*g;o[a>>2]=+o[x+32>>2];o[a+4>>2]=+o[x+32+4>>2];o[a+8>>2]=+o[x+32+8>>2];o[a+12>>2]=0.0;r=x;return}else{o[x+32+(i<<2)>>2]=j;if(+o[x+48+(b<<2)>>2]<0.0)e=-e;o[x+32+(b<<2)>>2]=e;o[x+32+(c<<2)>>2]=0.0;o[a>>2]=+o[x+32>>2];o[a+4>>2]=+o[x+32+4>>2];o[a+8>>2]=+o[x+32+8>>2];o[a+12>>2]=0.0;r=x;return}}case 5:{p=k[b+92>>2]|0;i=k[b+96>>2]|0;n=+o[b+12>>2];m=+o[b+16>>2];l=+o[b+20>>2];j=+o[c>>2]*n;e=+o[c+4>>2]*m;h=+o[c+8>>2]*l;if((i|0)>0){b=0;f=-3402823466385288598117041.0e14;d=-1;while(1){g=j*+o[p+(b<<4)>>2]+e*+o[p+(b<<4)+4>>2]+h*+o[p+(b<<4)+8>>2];c=g>f;d=c?b:d;if((b|0)==(i+-1|0))break;else{b=b+1|0;f=c?g:f}}}else d=-1;v=m*+o[p+(d<<4)+4>>2];w=l*+o[p+(d<<4)+8>>2];o[a>>2]=n*+o[p+(d<<4)>>2];o[a+4>>2]=v;o[a+8>>2]=w;o[a+12>>2]=0.0;r=x;return}default:{yc[k[(k[b>>2]|0)+68>>2]&127](a,b,c);r=x;return}}}function au(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0,h=0.0;g=r;r=r+32|0;k[g+16>>2]=k[c>>2];k[g+16+4>>2]=k[c+4>>2];k[g+16+8>>2]=k[c+8>>2];k[g+16+12>>2]=k[c+12>>2];d=+o[g+16>>2];f=+o[g+16+4>>2];e=+o[g+16+8>>2];if(d*d+f*f+e*e<1.4210854715202004e-14){o[g+16>>2]=-1.0;o[g+16+4>>2]=-1.0;o[g+16+8>>2]=-1.0;o[g+16+12>>2]=0.0;d=-1.0;f=-1.0;e=-1.0}h=1.0/+Y(+(d*d+f*f+e*e));o[g+16>>2]=d*h;o[g+16+4>>2]=f*h;o[g+16+8>>2]=e*h;$t(g,b,g+16|0);switch(k[b+4>>2]|0){case 13:{d=+o[b+44>>2];break}case 0:{d=+o[b+44>>2];break}case 10:{d=+o[b+44>>2];break}case 11:{d=+o[b+44>>2];break}case 4:case 5:{d=+o[b+44>>2];break}case 1:{d=+o[b+44>>2];break}case 8:{d=+o[b+28>>2]*+o[b+12>>2];break}default:d=+gc[k[(k[b>>2]|0)+48>>2]&15](b)}h=d*+o[g+16+4>>2]+ +o[g+4>>2];f=d*+o[g+16+8>>2]+ +o[g+8>>2];o[a>>2]=d*+o[g+16>>2]+ +o[g>>2];o[a+4>>2]=h;o[a+8>>2]=f;o[a+12>>2]=0.0;r=g;return}function bu(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0.0;e=+X(+(+o[b>>2]));d=+X(+(+o[b+4>>2]));c=+X(+(+o[b+8>>2]));o[a+12>>2]=e;o[a+16>>2]=d;o[a+20>>2]=c;o[a+24>>2]=0.0;return}function cu(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0,g=0,h=0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0;g=r;r=r+96|0;e=+gc[k[(k[a>>2]|0)+48>>2]&15](a);f=0;do{p=g+80+(f<<2)|0;k[g+80>>2]=0;k[g+80+4>>2]=0;k[g+80+8>>2]=0;k[g+80+12>>2]=0;o[p>>2]=1.0;h=k[(k[a>>2]|0)+64>>2]|0;i=+o[g+80>>2];j=+o[g+80+4>>2];l=+o[g+80+8>>2];m=i*+o[b+4>>2]+j*+o[b+20>>2]+l*+o[b+36>>2];n=i*+o[b+8>>2]+j*+o[b+24>>2]+l*+o[b+40>>2];o[g+48>>2]=+o[b>>2]*i+ +o[b+16>>2]*j+ +o[b+32>>2]*l;o[g+48+4>>2]=m;o[g+48+8>>2]=n;o[g+48+12>>2]=0.0;yc[h&127](g+64|0,a,g+48|0);n=+o[g+64>>2];m=+o[g+64+4>>2];l=+o[g+64+8>>2];j=n*+o[b+16>>2]+m*+o[b+20>>2]+l*+o[b+24>>2]+ +o[b+52>>2];i=n*+o[b+32>>2]+m*+o[b+36>>2]+l*+o[b+40>>2]+ +o[b+56>>2];o[g+32>>2]=n*+o[b>>2]+m*+o[b+4>>2]+l*+o[b+8>>2]+ +o[b+48>>2];o[g+32+4>>2]=j;o[g+32+8>>2]=i;o[g+32+12>>2]=0.0;h=g+32+(f<<2)|0;o[d+(f<<2)>>2]=e+ +o[h>>2];o[p>>2]=-1.0;p=k[(k[a>>2]|0)+64>>2]|0;i=+o[g+80>>2];j=+o[g+80+4>>2];l=+o[g+80+8>>2];m=i*+o[b+4>>2]+j*+o[b+20>>2]+l*+o[b+36>>2];n=i*+o[b+8>>2]+j*+o[b+24>>2]+l*+o[b+40>>2];o[g>>2]=+o[b>>2]*i+ +o[b+16>>2]*j+ +o[b+32>>2]*l;o[g+4>>2]=m;o[g+8>>2]=n;o[g+12>>2]=0.0;yc[p&127](g+16|0,a,g);n=+o[g+16>>2];m=+o[g+16+4>>2];l=+o[g+16+8>>2];j=n*+o[b+16>>2]+m*+o[b+20>>2]+l*+o[b+24>>2]+ +o[b+52>>2];i=n*+o[b+32>>2]+m*+o[b+36>>2]+l*+o[b+40>>2]+ +o[b+56>>2];o[g+32>>2]=n*+o[b>>2]+m*+o[b+4>>2]+l*+o[b+8>>2]+ +o[b+48>>2];o[g+32+4>>2]=j;o[g+32+8>>2]=i;o[g+32+12>>2]=0.0;o[c+(f<<2)>>2]=+o[h>>2]-e;f=f+1|0}while((f|0)!=3);r=g;return}function du(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0;yc[k[(k[b>>2]|0)+68>>2]&127](a,b,c);if(!(+gc[k[(k[b>>2]|0)+48>>2]&15](b)!=0.0))return;h=+o[c>>2];f=+o[c+4>>2];e=+o[c+8>>2];d=h*h+f*f+e*e<1.4210854715202004e-14?-1.0:e;g=h*h+f*f+e*e<1.4210854715202004e-14?-1.0:f;h=h*h+f*f+e*e<1.4210854715202004e-14?-1.0:h;e=1.0/+Y(+(d*d+(h*h+g*g)));f=+gc[k[(k[b>>2]|0)+48>>2]&15](b);o[a>>2]=e*h*f+ +o[a>>2];o[a+4>>2]=f*(e*g)+ +o[a+4>>2];o[a+8>>2]=f*(e*d)+ +o[a+8>>2];return}function eu(a,b){a=a|0;b=b|0;k[a+12>>2]=k[b>>2];k[a+12+4>>2]=k[b+4>>2];k[a+12+8>>2]=k[b+8>>2];k[a+12+12>>2]=k[b+12>>2];Qt(a);return}function fu(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,j=0;d=k[a+96>>2]|0;if((d|0)==(k[a+100>>2]|0)?(g=(d|0)==0?1:d<<1,(d|0)<(g|0)):0){if(!g)f=0;else{k[5108]=(k[5108]|0)+1;d=iF((g<<4|3)+16|0)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}f=d;d=k[a+96>>2]|0}if((d|0)>0){d=d+-1|0;e=0;while(1){h=f+(e<<4)|0;j=(k[a+104>>2]|0)+(e<<4)|0;k[h>>2]=k[j>>2];k[h+4>>2]=k[j+4>>2];k[h+8>>2]=k[j+8>>2];k[h+12>>2]=k[j+12>>2];if((e|0)==(d|0))break;else e=e+1|0}}d=k[a+104>>2]|0;if(d){if(i[a+108>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[a+104>>2]=0}i[a+108>>0]=1;k[a+104>>2]=f;k[a+100>>2]=g;d=k[a+96>>2]|0}j=(k[a+104>>2]|0)+(d<<4)|0;k[j>>2]=k[b>>2];k[j+4>>2]=k[b+4>>2];k[j+8>>2]=k[b+8>>2];k[j+12>>2]=k[b+12>>2];k[a+96>>2]=(k[a+96>>2]|0)+1;if(!c)return;Qt(a);return}function gu(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0,f=0.0,g=0,h=0.0,i=0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0;i=k[b+96>>2]|0;if((i|0)<=0){k[a>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;return}n=+o[b+12>>2];p=+o[c>>2]*n;j=+o[b+16>>2];l=+o[c+4>>2]*j;m=+o[b+20>>2];h=+o[c+8>>2]*m;b=k[b+104>>2]|0;e=0;f=-3402823466385288598117041.0e14;g=-1;while(1){d=p*+o[b+(e<<4)>>2]+l*+o[b+(e<<4)+4>>2]+h*+o[b+(e<<4)+8>>2];c=d>f;g=c?e:g;if((e|0)==(i+-1|0))break;else{e=e+1|0;f=c?d:f}}j=+o[b+(g<<4)+4>>2]*j;p=+o[b+(g<<4)+8>>2]*m;o[a>>2]=+o[b+(g<<4)>>2]*n;o[a+4>>2]=j;o[a+8>>2]=p;o[a+12>>2]=0.0;return}function hu(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0,n=0,p=0,q=0.0,r=0,s=0.0,t=0;if((d|0)<=0)return;e=0;while(1){o[c+(e<<4)+12>>2]=-999999984306749440.0;if((e|0)==(d+-1|0))break;else e=e+1|0}p=0;while(1){f=+o[a+12>>2];g=+o[b+(p<<4)>>2]*f;h=+o[a+16>>2];i=+o[b+(p<<4)+4>>2]*h;j=+o[a+20>>2];l=+o[b+(p<<4)+8>>2]*j;e=k[a+96>>2]|0;if((e|0)>0){m=k[a+104>>2]|0;n=0;q=-3402823466385288598117041.0e14;r=-1;while(1){s=g*+o[m+(n<<4)>>2]+i*+o[m+(n<<4)+4>>2]+l*+o[m+(n<<4)+8>>2];t=s>q;r=t?n:r;q=t?s:q;if((n|0)==(e+-1|0))break;else n=n+1|0}s=+o[m+(r<<4)+4>>2]*h;l=+o[m+(r<<4)+8>>2]*j;o[c+(p<<4)>>2]=+o[m+(r<<4)>>2]*f;o[c+(p<<4)+4>>2]=s;o[c+(p<<4)+8>>2]=l;o[c+(p<<4)+12>>2]=q}else o[c+(p<<4)+12>>2]=-999999984306749440.0;if((p|0)==(d+-1|0))break;else p=p+1|0}return}function iu(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0;yc[k[(k[b>>2]|0)+68>>2]&127](a,b,c);if(!(+gc[k[(k[b>>2]|0)+48>>2]&15](b)!=0.0))return;h=+o[c>>2];f=+o[c+4>>2];e=+o[c+8>>2];d=h*h+f*f+e*e<1.4210854715202004e-14?-1.0:e;g=h*h+f*f+e*e<1.4210854715202004e-14?-1.0:f;h=h*h+f*f+e*e<1.4210854715202004e-14?-1.0:h;e=1.0/+Y(+(d*d+(h*h+g*g)));f=+gc[k[(k[b>>2]|0)+48>>2]&15](b);o[a>>2]=e*h*f+ +o[a>>2];o[a+4>>2]=f*(e*g)+ +o[a+4>>2];o[a+8>>2]=f*(e*d)+ +o[a+8>>2];return}function ju(a){a=a|0;return k[a+96>>2]|0}function ku(a){a=a|0;return k[a+96>>2]|0}function lu(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0,h=0;g=k[a+96>>2]|0;h=k[a+104>>2]|0;e=+o[h+(((b|0)%(g|0)|0)<<4)+4>>2]*+o[a+16>>2];f=+o[h+(((b|0)%(g|0)|0)<<4)+8>>2]*+o[a+20>>2];o[c>>2]=+o[h+(((b|0)%(g|0)|0)<<4)>>2]*+o[a+12>>2];o[c+4>>2]=e;o[c+8>>2]=f;o[c+12>>2]=0.0;c=k[a+104>>2]|0;f=+o[c+(((b+1|0)%(g|0)|0)<<4)+4>>2]*+o[a+16>>2];e=+o[c+(((b+1|0)%(g|0)|0)<<4)+8>>2]*+o[a+20>>2];o[d>>2]=+o[c+(((b+1|0)%(g|0)|0)<<4)>>2]*+o[a+12>>2];o[d+4>>2]=f;o[d+8>>2]=e;o[d+12>>2]=0.0;return}function mu(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0;f=k[a+104>>2]|0;e=+o[f+(b<<4)+4>>2]*+o[a+16>>2];d=+o[f+(b<<4)+8>>2]*+o[a+20>>2];o[c>>2]=+o[f+(b<<4)>>2]*+o[a+12>>2];o[c+4>>2]=e;o[c+8>>2]=d;o[c+12>>2]=0.0;return}function nu(a){a=a|0;return 0}function ou(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;return}function pu(a,b,c){a=a|0;b=b|0;c=+c;return 0}function qu(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0;d=nc[k[(k[c>>2]|0)+40>>2]&31](c,a)|0;f=nc[k[(k[c>>2]|0)+28>>2]&31](c,d)|0;k[b>>2]=f;if(f)Ub[k[(k[c>>2]|0)+48>>2]&127](c,d);k[b+4>>2]=k[a+4>>2];o[b+28>>2]=+o[a+28>>2];o[b+32>>2]=+o[a+32>>2];o[b+36>>2]=+o[a+36>>2];o[b+40>>2]=+o[a+40>>2];o[b+12>>2]=+o[a+12>>2];o[b+16>>2]=+o[a+16>>2];o[b+20>>2]=+o[a+20>>2];o[b+24>>2]=+o[a+24>>2];o[b+44>>2]=+o[a+44>>2];e=k[a+96>>2]|0;k[b+60>>2]=e;if(!e){k[b+52>>2]=0;k[b+56>>2]=0;return 13936}f=nc[k[(k[c>>2]|0)+28>>2]&31](c,k[a+104>>2]|0)|0;k[b+52>>2]=f;k[b+56>>2]=0;f=dc[k[(k[c>>2]|0)+16>>2]&63](c,16,e)|0;if((e|0)>0){d=k[a+104>>2]|0;b=0;a=k[f+8>>2]|0;while(1){o[a>>2]=+o[d+(b<<4)>>2];o[a+4>>2]=+o[d+(b<<4)+4>>2];o[a+8>>2]=+o[d+(b<<4)+8>>2];o[a+12>>2]=+o[d+(b<<4)+12>>2];if((b|0)==(e+-1|0))break;else{b=b+1|0;a=a+16|0}}}else d=k[a+104>>2]|0;Qb[k[(k[c>>2]|0)+20>>2]&31](c,f,20224,1497453121,d);return 13936}function ru(a,b,c,d,e,f,g){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;var h=0.0,i=0.0,j=0,l=0.0,m=0.0,n=0,p=0,q=0.0,s=0;p=r;r=r+16|0;o[d>>2]=3402823466385288598117041.0e14;o[e>>2]=-3402823466385288598117041.0e14;j=k[a+96>>2]|0;if((j|0)>0){n=0;while(1){s=k[a+104>>2]|0;q=+o[s+(n<<4)>>2]*+o[a+12>>2];m=+o[s+(n<<4)+4>>2]*+o[a+16>>2];l=+o[s+(n<<4)+8>>2]*+o[a+20>>2];i=q*+o[b>>2]+m*+o[b+4>>2]+l*+o[b+8>>2]+ +o[b+48>>2];h=q*+o[b+16>>2]+m*+o[b+20>>2]+l*+o[b+24>>2]+ +o[b+52>>2];l=q*+o[b+32>>2]+m*+o[b+36>>2]+l*+o[b+40>>2]+ +o[b+56>>2];m=i*+o[c>>2]+h*+o[c+4>>2]+l*+o[c+8>>2];if(m<+o[d>>2]){o[d>>2]=m;o[f>>2]=i;o[f+4>>2]=h;o[f+8>>2]=l;o[f+12>>2]=0.0}if(m>+o[e>>2]){o[e>>2]=m;o[g>>2]=i;o[g+4>>2]=h;o[g+8>>2]=l;o[g+12>>2]=0.0}if((n|0)==(j+-1|0))break;else n=n+1|0}i=+o[e>>2]}else i=-3402823466385288598117041.0e14;h=+o[d>>2];if(!(h>i)){r=p;return}o[d>>2]=i;o[e>>2]=h;k[p>>2]=k[f>>2];k[p+4>>2]=k[f+4>>2];k[p+8>>2]=k[f+8>>2];k[p+12>>2]=k[f+12>>2];k[f>>2]=k[g>>2];k[f+4>>2]=k[g+4>>2];k[f+8>>2]=k[g+8>>2];k[f+12>>2]=k[g+12>>2];k[g>>2]=k[p>>2];k[g+4>>2]=k[p+4>>2];k[g+8>>2]=k[p+8>>2];k[g+12>>2]=k[p+12>>2];r=p;return}function su(a){a=a|0;return}function tu(a){a=a|0;return}function uu(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0;p=r;r=r+32|0;k[a>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;d=+o[c>>2];e=+o[c+4>>2];f=+o[c+8>>2];if(d*d+e*e+f*f<9.999999747378752e-05){n=1.0;m=0.0;l=0.0}else{l=1.0/+Y(+(d*d+e*e+f*f));n=d*l;m=e*l;l=f*l}c=k[b+52>>2]|0;j=+o[b+28+(((c+2|0)%3|0)<<2)>>2];k[p+16>>2]=0;k[p+16+4>>2]=0;k[p+16+8>>2]=0;k[p+16+12>>2]=0;o[p+16+(c<<2)>>2]=+o[b+28+(c<<2)>>2];h=n*j;i=m*j;j=l*j;f=h+ +o[p+16>>2];e=i+ +o[p+16+4>>2];g=j+ +o[p+16+8>>2];d=+gc[k[(k[b>>2]|0)+48>>2]&15](b);f=f-n*d;e=e-m*d;d=g-l*d;g=l*d+(n*f+m*e);if(g>-999999984306749440.0){o[a>>2]=f;o[a+4>>2]=e;o[a+8>>2]=d;o[a+12>>2]=0.0}else g=-999999984306749440.0;k[p>>2]=0;k[p+4>>2]=0;k[p+8>>2]=0;k[p+12>>2]=0;c=k[b+52>>2]|0;o[p+(c<<2)>>2]=-+o[b+28+(c<<2)>>2];f=h+ +o[p>>2];e=i+ +o[p+4>>2];j=j+ +o[p+8>>2];d=+gc[k[(k[b>>2]|0)+48>>2]&15](b);f=f-n*d;e=e-m*d;d=j-l*d;if(!(l*d+(n*f+m*e)>g)){r=p;return}o[a>>2]=f;o[a+4>>2]=e;o[a+8>>2]=d;o[a+12>>2]=0.0;r=p;return}function vu(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0,u=0,v=0,w=0.0,x=0,y=0;x=r;r=r+32|0;e=k[a+52>>2]|0;w=+o[a+28+(((e+2|0)%3|0)<<2)>>2];if((d|0)<=0){r=x;return}v=0;while(1){k[x+16>>2]=0;k[x+16+4>>2]=0;k[x+16+8>>2]=0;k[x+16+12>>2]=0;o[x+16+(e<<2)>>2]=+o[a+28+(e<<2)>>2];e=b+(v<<4)|0;t=b+(v<<4)+4|0;u=b+(v<<4)+8|0;l=w*+o[e>>2]+ +o[x+16>>2];j=w*+o[t>>2]+ +o[x+16+4>>2];i=w*+o[u>>2]+ +o[x+16+8>>2];h=+gc[k[(k[a>>2]|0)+48>>2]&15](a);g=+o[e>>2];f=+o[t>>2];m=+o[u>>2];if(g*(l-h*g)+f*(j-h*f)+m*(i-h*m)>-999999984306749440.0){o[c+(v<<4)>>2]=l-h*g;o[c+(v<<4)+4>>2]=j-h*f;o[c+(v<<4)+8>>2]=i-h*m;o[c+(v<<4)+12>>2]=0.0;n=+o[e>>2];q=+o[t>>2];s=+o[u>>2];p=g*(l-h*g)+f*(j-h*f)+m*(i-h*m)}else{n=g;q=f;s=m;p=-999999984306749440.0};k[x>>2]=0;k[x+4>>2]=0;k[x+8>>2]=0;k[x+12>>2]=0;y=k[a+52>>2]|0;o[x+(y<<2)>>2]=-+o[a+28+(y<<2)>>2];m=w*n+ +o[x>>2];l=w*q+ +o[x+4>>2];i=w*s+ +o[x+8>>2];j=+gc[k[(k[a>>2]|0)+48>>2]&15](a);h=+o[e>>2];g=+o[t>>2];f=+o[u>>2];if(h*(m-j*h)+g*(l-j*g)+f*(i-j*f)>p){o[c+(v<<4)>>2]=m-j*h;o[c+(v<<4)+4>>2]=l-j*g;o[c+(v<<4)+8>>2]=i-j*f;o[c+(v<<4)+12>>2]=0.0}if((v|0)==(d+-1|0))break;e=k[a+52>>2]|0;v=v+1|0}r=x;return}function wu(a,b,c){a=a|0;b=+b;c=c|0;var d=0,e=0.0,f=0.0,g=0.0,h=0;d=r;r=r+16|0;h=k[a+52>>2]|0;f=+o[a+28+(((h+2|0)%3|0)<<2)>>2];o[d>>2]=f;o[d+4>>2]=f;o[d+8>>2]=f;o[d+12>>2]=0.0;o[d+(h<<2)>>2]=+o[a+28+(h<<2)>>2]+ +o[d+(h<<2)>>2];f=(+o[d>>2]+.03999999910593033)*2.0;e=(+o[d+4>>2]+.03999999910593033)*2.0;g=(+o[d+8>>2]+.03999999910593033)*2.0;o[c>>2]=b*.0833333283662796*(e*e+g*g);o[c+4>>2]=b*.0833333283662796*(f*f+g*g);o[c+8>>2]=b*.0833333283662796*(f*f+e*e);r=d;return}function xu(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0,j=0.0;i=r;r=r+80|0;k[a>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;d=+o[c>>2];e=+o[c+4>>2];g=+o[c+8>>2];if(d*d+e*e+g*g<9.999999747378752e-05){h=1.0;f=0.0;e=0.0;d=0.0}else{j=1.0/+Y(+(d*d+e*e+g*g));h=d*j;f=e*j;e=g*j;d=+o[c+12>>2]}k[i+32>>2]=14800;k[i+32+4>>2]=0;k[i+32+4+4>>2]=0;k[i+32+4+8>>2]=0;k[i+32+4+12>>2]=0;o[i+32+20>>2]=-999999984306749440.0;o[i+32+24>>2]=h;o[i+32+28>>2]=f;o[i+32+32>>2]=e;o[i+32+36>>2]=d;o[i+16>>2]=999999984306749440.0;o[i+16+4>>2]=999999984306749440.0;o[i+16+8>>2]=999999984306749440.0;o[i+16+12>>2]=0.0;b=k[b+92>>2]|0;c=k[(k[b>>2]|0)+8>>2]|0;o[i>>2]=-999999984306749440.0;o[i+4>>2]=-999999984306749440.0;o[i+8>>2]=-999999984306749440.0;o[i+12>>2]=0.0;Cc[c&127](b,i+32|0,i,i+16|0);k[a>>2]=k[i+32+4>>2];k[a+4>>2]=k[i+32+4+4>>2];k[a+8>>2]=k[i+32+4+8>>2];k[a+12>>2]=k[i+32+4+12>>2];r=i;return}function yu(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0;f=r;r=r+80|0;if((d|0)<=0){r=f;return}e=0;while(1){o[c+(e<<4)+12>>2]=-999999984306749440.0;if((e|0)==(d+-1|0))break;else e=e+1|0}e=0;do{g=b+(e<<4)|0;k[f+32>>2]=14800;k[f+32+4>>2]=0;k[f+32+4+4>>2]=0;k[f+32+4+8>>2]=0;k[f+32+4+12>>2]=0;o[f+32+20>>2]=-999999984306749440.0;k[f+32+24>>2]=k[g>>2];k[f+32+24+4>>2]=k[g+4>>2];k[f+32+24+8>>2]=k[g+8>>2];k[f+32+24+12>>2]=k[g+12>>2];o[f+16>>2]=999999984306749440.0;o[f+16+4>>2]=999999984306749440.0;o[f+16+8>>2]=999999984306749440.0;o[f+16+12>>2]=0.0;g=k[a+92>>2]|0;h=k[(k[g>>2]|0)+8>>2]|0;o[f>>2]=-999999984306749440.0;o[f+4>>2]=-999999984306749440.0;o[f+8>>2]=-999999984306749440.0;o[f+12>>2]=0.0;Cc[h&127](g,f+32|0,f,f+16|0);g=c+(e<<4)|0;k[g>>2]=k[f+32+4>>2];k[g+4>>2]=k[f+32+4+4>>2];k[g+8>>2]=k[f+32+4+8>>2];k[g+12>>2]=k[f+32+4+12>>2];e=e+1|0}while((e|0)<(d|0));r=f;return}function zu(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0;yc[k[(k[b>>2]|0)+68>>2]&127](a,b,c);if(!(+gc[k[(k[b>>2]|0)+48>>2]&15](b)!=0.0))return;h=+o[c>>2];f=+o[c+4>>2];e=+o[c+8>>2];d=h*h+f*f+e*e<1.4210854715202004e-14?-1.0:e;g=h*h+f*f+e*e<1.4210854715202004e-14?-1.0:f;h=h*h+f*f+e*e<1.4210854715202004e-14?-1.0:h;e=1.0/+Y(+(d*d+(h*h+g*g)));f=+gc[k[(k[b>>2]|0)+48>>2]&15](b);o[a>>2]=e*h*f+ +o[a>>2];o[a+4>>2]=f*(e*g)+ +o[a+4>>2];o[a+8>>2]=f*(e*d)+ +o[a+8>>2];return}function Au(a){a=a|0;return 0}function Bu(a){a=a|0;return 0}function Cu(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;return}function Du(a,b,c){a=a|0;b=b|0;c=c|0;return}function Eu(a){a=a|0;return 0}function Fu(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;return}function Gu(a,b,c){a=a|0;b=b|0;c=+c;return 0}function Hu(a,b){a=a|0;b=b|0;var c=0;c=(k[a+92>>2]|0)+4|0;k[c>>2]=k[b>>2];k[c+4>>2]=k[b+4>>2];k[c+8>>2]=k[b+8>>2];k[c+12>>2]=k[b+12>>2];Qt(a);return}function Iu(a){a=a|0;return (k[a+92>>2]|0)+4|0}function Ju(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0;g=+gc[k[(k[a>>2]|0)+48>>2]&15](a);l=g+ +o[a+28>>2];i=g+ +o[a+32>>2];g=g+ +o[a+36>>2];u=+X(+(+o[b>>2]));t=+X(+(+o[b+4>>2]));s=+X(+(+o[b+8>>2]));q=+X(+(+o[b+16>>2]));p=+X(+(+o[b+20>>2]));n=+X(+(+o[b+24>>2]));j=+X(+(+o[b+32>>2]));h=+X(+(+o[b+36>>2]));f=+X(+(+o[b+40>>2]));r=+o[b+48>>2];m=+o[b+52>>2];e=+o[b+56>>2];o[c>>2]=r-(l*u+i*t+g*s);o[c+4>>2]=m-(l*q+i*p+g*n);o[c+8>>2]=e-(l*j+i*h+g*f);o[c+12>>2]=0.0;o[d>>2]=l*u+i*t+g*s+r;o[d+4>>2]=l*q+i*p+g*n+m;o[d+8>>2]=l*j+i*h+g*f+e;o[d+12>>2]=0.0;return}function Ku(a,b,c){a=a|0;b=+b;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0;g=+o[a+28>>2];e=+o[a+32>>2];h=+o[a+36>>2];f=+gc[k[(k[a>>2]|0)+48>>2]&15](a);d=+gc[k[(k[a>>2]|0)+48>>2]&15](a);h=(h+ +gc[k[(k[a>>2]|0)+48>>2]&15](a))*2.0;o[c>>2]=b/12.0*((e+d)*2.0*((e+d)*2.0)+h*h);o[c+4>>2]=b/12.0*((g+f)*2.0*((g+f)*2.0)+h*h);o[c+8>>2]=b/12.0*((g+f)*2.0*((g+f)*2.0)+(e+d)*2.0*((e+d)*2.0));o[c+12>>2]=0.0;return}function Lu(a){a=a|0;Cv(a);return}function Mu(a){a=a|0;Cv(a);if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function Nu(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0,g=0.0,h=0,l=0.0,m=0,n=0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0;A=r;r=r+176|0;i[a+60>>0]=c&1;if(c){q=+o[d>>2]+-1.0;u=+o[d+4>>2]+-1.0;s=+o[d+8>>2]+-1.0;o[a+4>>2]=q;o[a+8>>2]=u;o[a+12>>2]=s;o[a+16>>2]=0.0;v=+o[e>>2]+1.0;x=+o[e+4>>2]+1.0;y=+o[e+8>>2]+1.0;o[a+20>>2]=v;o[a+24>>2]=x;o[a+28>>2]=y;o[a+32>>2]=0.0;o[a+36>>2]=65533.0/(v-q);o[a+40>>2]=65533.0/(x-u);o[a+44>>2]=65533.0/(y-s);o[a+48>>2]=0.0;i[a+60>>0]=1;l=q+ +(~~((q-q)*(65533.0/(v-q)))&65534)/(65533.0/(v-q))+-1.0;p=u+ +(~~((u-u)*(65533.0/(x-u)))&65534)/(65533.0/(x-u))+-1.0;g=s+ +(~~((s-s)*(65533.0/(y-s)))&65534)/(65533.0/(y-s))+-1.0;if(l<q){o[a+4>>2]=l;z=l}else z=q;if(p<u){o[a+8>>2]=p;w=p}else w=u;if(g<s){o[a+12>>2]=g;t=g}else t=s;p=z+ +((~~((v-z)*(65533.0/(v-q))+1.0)&65535|1)&65535)/(65533.0/(v-q))+1.0;l=w+ +((~~((x-w)*(65533.0/(x-u))+1.0)&65535|1)&65535)/(65533.0/(x-u))+1.0;g=t+ +((~~((y-t)*(65533.0/(y-s))+1.0)&65535|1)&65535)/(65533.0/(y-s))+1.0;if(v<p)o[a+20>>2]=p;else p=v;if(x<l)o[a+24>>2]=l;else l=x;if(y<g)o[a+28>>2]=g;else g=y;o[a+36>>2]=65533.0/(p-z);o[a+40>>2]=65533.0/(l-w);o[a+44>>2]=65533.0/(g-t);o[a+48>>2]=0.0;k[A+80>>2]=15168;k[A+80+4>>2]=a+104;k[A+80+8>>2]=a;Cc[k[(k[b>>2]|0)+8>>2]&127](b,A+80|0,a+4|0,a+20|0);f=k[a+108>>2]|0;k[A+128>>2]=0;k[A+128+4>>2]=0;k[A+128+8>>2]=0;k[A+128+12>>2]=0;h=k[a+128>>2]|0;if((h|0)<(f<<1|0)){if((k[a+132>>2]|0)<(f<<1|0)){if(!f){e=0;c=h}else{k[5108]=(k[5108]|0)+1;e=iF(f<<5|19)|0;if(!e)e=0;else{k[(e+4+15&-16)+-4>>2]=e;e=e+4+15&-16}c=k[a+128>>2]|0}if((c|0)>0){c=c+-1|0;d=0;while(1){b=e+(d<<4)|0;n=(k[a+136>>2]|0)+(d<<4)|0;k[b>>2]=k[n>>2];k[b+4>>2]=k[n+4>>2];k[b+8>>2]=k[n+8>>2];k[b+12>>2]=k[n+12>>2];if((d|0)==(c|0))break;else d=d+1|0}}c=k[a+136>>2]|0;if(c){if(i[a+140>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[a+136>>2]=0}i[a+140>>0]=1;k[a+136>>2]=e;k[a+132>>2]=f<<1;c=a+136|0}else c=a+136|0;e=h;while(1){b=(k[c>>2]|0)+(e<<4)|0;k[b>>2]=k[A+128>>2];k[b+4>>2]=k[A+128+4>>2];k[b+8>>2]=k[A+128+8>>2];k[b+12>>2]=k[A+128+12>>2];if((e|0)==((f<<1)+-1|0))break;else e=e+1|0}}k[a+128>>2]=f<<1}else{k[A+144>>2]=15312;k[A+144+4>>2]=a+64;o[A+152>>2]=-999999984306749440.0;o[A+152+4>>2]=-999999984306749440.0;o[A+152+8>>2]=-999999984306749440.0;o[A+152+12>>2]=0.0;o[A+64>>2]=999999984306749440.0;o[A+64+4>>2]=999999984306749440.0;o[A+64+8>>2]=999999984306749440.0;o[A+64+12>>2]=0.0;Cc[k[(k[b>>2]|0)+8>>2]&127](b,A+144|0,A+152|0,A+64|0);f=k[a+68>>2]|0;m=A;b=m+64|0;do{k[m>>2]=0;m=m+4|0}while((m|0)<(b|0));d=k[a+88>>2]|0;if((d|0)<(f<<1|0)){if((k[a+92>>2]|0)<(f<<1|0)){if(!f){e=0;c=d}else{k[5108]=(k[5108]|0)+1;e=iF(f<<7|19)|0;if(!e)e=0;else{k[(e+4+15&-16)+-4>>2]=e;e=e+4+15&-16}c=k[a+88>>2]|0}if((c|0)>0){c=c+-1|0;h=0;while(1){m=e+(h<<6)|0;n=(k[a+96>>2]|0)+(h<<6)|0;b=m+64|0;do{k[m>>2]=k[n>>2];m=m+4|0;n=n+4|0}while((m|0)<(b|0));if((h|0)==(c|0))break;else h=h+1|0}}c=k[a+96>>2]|0;if(c){if(i[a+100>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[a+96>>2]=0}i[a+100>>0]=1;k[a+96>>2]=e;k[a+92>>2]=f<<1;c=a+96|0}else c=a+96|0;while(1){m=(k[c>>2]|0)+(d<<6)|0;n=A;b=m+64|0;do{k[m>>2]=k[n>>2];m=m+4|0;n=n+4|0}while((m|0)<(b|0));if((d|0)==((f<<1)+-1|0))break;else d=d+1|0}}k[a+88>>2]=f<<1}k[a+56>>2]=0;Bv(a,0,f);if((i[a+60>>0]|0)!=0?(k[a+152>>2]|0)==0:0){if(!(k[a+156>>2]|0)){k[5108]=(k[5108]|0)+1;f=iF(51)|0;if(!f)d=0;else{k[(f+4+15&-16)+-4>>2]=f;d=f+4+15&-16}f=k[a+152>>2]|0;if((f|0)>0){e=0;while(1){b=d+(e<<5)|0;n=(k[a+160>>2]|0)+(e<<5)|0;k[b>>2]=k[n>>2];k[b+4>>2]=k[n+4>>2];k[b+8>>2]=k[n+8>>2];k[b+12>>2]=k[n+12>>2];k[b+16>>2]=k[n+16>>2];k[b+20>>2]=k[n+20>>2];k[b+24>>2]=k[n+24>>2];k[b+28>>2]=k[n+28>>2];if((e|0)==(f+-1|0))break;else e=e+1|0}}f=k[a+160>>2]|0;if(f){if(i[a+164>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[f+-4>>2]|0)}k[a+160>>2]=0}i[a+164>>0]=1;k[a+160>>2]=d;k[a+156>>2]=1;e=(k[a+152>>2]|0)+1|0;f=d}else{e=1;f=k[a+160>>2]|0}k[a+152>>2]=e;k[f>>2]=k[A+96>>2];k[f+4>>2]=k[A+96+4>>2];k[f+8>>2]=k[A+96+8>>2];k[f+12>>2]=k[A+96+12>>2];k[f+16>>2]=k[A+96+16>>2];k[f+20>>2]=k[A+96+20>>2];k[f+24>>2]=k[A+96+24>>2];k[f+28>>2]=k[A+96+28>>2];b=k[a+160>>2]|0;n=k[a+136>>2]|0;j[b>>1]=j[n>>1]|0;j[b+2>>1]=j[n+2>>1]|0;j[b+4>>1]=j[n+4>>1]|0;j[b+6>>1]=j[n+6>>1]|0;j[b+8>>1]=j[n+8>>1]|0;j[b+10>>1]=j[n+10>>1]|0;k[b+12>>2]=0;n=k[n+12>>2]|0;k[b+16>>2]=(n|0)>-1?1:0-n|0}k[a+168>>2]=k[a+152>>2];f=k[a+116>>2]|0;if(f){if(i[a+120>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[f+-4>>2]|0)}k[a+116>>2]=0}i[a+120>>0]=1;k[a+116>>2]=0;k[a+108>>2]=0;k[a+112>>2]=0;f=k[a+76>>2]|0;if(!f){i[a+80>>0]=1;k[a+76>>2]=0;k[a+68>>2]=0;a=a+72|0;k[a>>2]=0;r=A;return}if(i[a+80>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[f+-4>>2]|0)}k[a+76>>2]=0;i[a+80>>0]=1;k[a+76>>2]=0;k[a+68>>2]=0;a=a+72|0;k[a>>2]=0;r=A;return}function Ou(a,b){a=a|0;b=b|0;var c=0,d=0.0,e=0.0,f=0.0,g=0.0,h=0.0;k[a+4>>2]=35;k[a+8>>2]=0;o[a+12>>2]=1.0;o[a+16>>2]=1.0;o[a+20>>2]=1.0;o[a+24>>2]=0.0;o[a+44>>2]=.03999999910593033;k[a>>2]=15448;k[a+52>>2]=1;f=+o[b>>2];d=+o[b+4>>2];e=+o[b+8>>2];if(f<d)c=f<e?0:2;else c=d<e?1:2;d=+o[b+(c<<2)>>2]*.10000000149011612;if(d<.03999999910593033){h=+hx(a);g=+gc[k[(k[a>>2]|0)+48>>2]&15](a);f=+gc[k[(k[a>>2]|0)+48>>2]&15](a);h=h+ +o[a+28>>2];g=g+ +o[a+32>>2];f=f+ +o[a+36>>2];o[a+44>>2]=d;d=+gc[k[(k[a>>2]|0)+48>>2]&15](a);e=+gc[k[(k[a>>2]|0)+48>>2]&15](a);f=f-+gc[k[(k[a>>2]|0)+48>>2]&15](a);o[a+28>>2]=h-d;o[a+32>>2]=g-e;o[a+36>>2]=f;o[a+40>>2]=0.0;c=k[a>>2]|0}else c=15448;e=+gc[k[c+48>>2]&15](a);h=+gc[k[(k[a>>2]|0)+48>>2]&15](a);f=+gc[k[(k[a>>2]|0)+48>>2]&15](a);h=+o[b+4>>2]*+o[a+16>>2]-h;f=+o[b+8>>2]*+o[a+20>>2]-f;o[a+28>>2]=+o[b>>2]*+o[a+12>>2]-e;o[a+32>>2]=h;o[a+36>>2]=f;o[a+40>>2]=0.0;k[a+4>>2]=13;return}function Pu(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0;g=+gc[k[(k[a>>2]|0)+48>>2]&15](a);l=g+ +o[a+28>>2];i=g+ +o[a+32>>2];g=g+ +o[a+36>>2];u=+X(+(+o[b>>2]));t=+X(+(+o[b+4>>2]));s=+X(+(+o[b+8>>2]));q=+X(+(+o[b+16>>2]));p=+X(+(+o[b+20>>2]));n=+X(+(+o[b+24>>2]));j=+X(+(+o[b+32>>2]));h=+X(+(+o[b+36>>2]));f=+X(+(+o[b+40>>2]));r=+o[b+48>>2];m=+o[b+52>>2];e=+o[b+56>>2];o[c>>2]=r-(l*u+i*t+g*s);o[c+4>>2]=m-(l*q+i*p+g*n);o[c+8>>2]=e-(l*j+i*h+g*f);o[c+12>>2]=0.0;o[d>>2]=l*u+i*t+g*s+r;o[d+4>>2]=l*q+i*p+g*n+m;o[d+8>>2]=l*j+i*h+g*f+e;o[d+12>>2]=0.0;return}function Qu(a,b,c){a=a|0;b=+b;c=c|0;var d=0.0,e=0.0,f=0,g=0,h=0,i=0.0;h=r;r=r+16|0;k[h>>2]=k[a+28>>2];k[h+4>>2]=k[a+28+4>>2];k[h+8>>2]=k[a+28+8>>2];k[h+12>>2]=k[a+28+12>>2];i=+gc[k[(k[a>>2]|0)+48>>2]&15](a);d=+gc[k[(k[a>>2]|0)+48>>2]&15](a);e=+gc[k[(k[a>>2]|0)+48>>2]&15](a);o[h>>2]=i+ +o[h>>2];o[h+4>>2]=d+ +o[h+4>>2];o[h+8>>2]=e+ +o[h+8>>2];g=k[a+52>>2]|0;if(!g){f=0;a=1}else if((g|0)==2){f=2;a=0}else{f=1;a=0}e=+o[h+(a<<2)>>2];d=+o[h+(f<<2)>>2];d=b*.25*(e*e)+b/12.0*(d*(d*4.0));if(!g){o[c>>2]=b*.5*(e*e);o[c+4>>2]=d;o[c+8>>2]=d;o[c+12>>2]=0.0;r=h;return}else if((g|0)==2){o[c>>2]=d;o[c+4>>2]=d;o[c+8>>2]=b*.5*(e*e);o[c+12>>2]=0.0;r=h;return}else{o[c>>2]=d;o[c+4>>2]=b*.5*(e*e);o[c+8>>2]=d;o[c+12>>2]=0.0;r=h;return}}function Ru(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0;h=+o[b+32>>2];d=+o[b+28>>2];e=+o[c+4>>2];g=+o[c+8>>2];f=+Y(+(e*e+g*g));if(f!=0.0){o[a+4>>2]=e*(h/f);if(+o[c>>2]<0.0)d=-d;o[a>>2]=d;o[a+8>>2]=g*(h/f);return}else{o[a+4>>2]=h;if(+o[c>>2]<0.0)d=-d;o[a>>2]=d;o[a+8>>2]=0.0;return}}function Su(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0;h=+o[b+28>>2];d=+o[b+36>>2];e=+o[c>>2];g=+o[c+4>>2];f=+Y(+(e*e+g*g));if(f!=0.0){o[a>>2]=e*(h/f);if(+o[c+8>>2]<0.0)d=-d;o[a+8>>2]=d;o[a+4>>2]=g*(h/f);return}else{o[a>>2]=h;if(+o[c+8>>2]<0.0)d=-d;o[a+8>>2]=d;o[a+4>>2]=0.0;return}}function Tu(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0;h=+o[b+28>>2];d=+o[b+32>>2];e=+o[c>>2];g=+o[c+8>>2];f=+Y(+(e*e+g*g));if(f!=0.0){o[a>>2]=e*(h/f);if(+o[c+4>>2]<0.0)d=-d;o[a+4>>2]=d;o[a+8>>2]=g*(h/f);return}else{o[a>>2]=h;if(+o[c+4>>2]<0.0)d=-d;o[a+4>>2]=d;o[a+8>>2]=0.0;return}}function Uu(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,k=0;if((d|0)<=0)return;k=0;while(1){j=+o[a+28>>2];f=+o[a+32>>2];e=+o[b+(k<<4)>>2];g=+o[b+(k<<4)+8>>2];h=+Y(+(e*e+g*g));if(!(h!=0.0))if(+o[b+(k<<4)+4>>2]<0.0){i=j;f=-f;e=0.0}else{i=j;e=0.0}else{if(+o[b+(k<<4)+4>>2]<0.0)f=-f;i=e*(j/h);e=g*(j/h)}o[c+(k<<4)>>2]=i;o[c+(k<<4)+4>>2]=f;o[c+(k<<4)+8>>2]=e;if((k|0)==(d+-1|0))break;else k=k+1|0}return}function Vu(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,k=0;if((d|0)<=0)return;k=0;while(1){i=+o[a+28>>2];e=+o[a+36>>2];f=+o[b+(k<<4)>>2];g=+o[b+(k<<4)+4>>2];h=+Y(+(f*f+g*g));if(!(h!=0.0))if(+o[b+(k<<4)+8>>2]<0.0){j=i;f=0.0;e=-e}else{j=i;f=0.0}else{if(+o[b+(k<<4)+8>>2]<0.0)e=-e;j=f*(i/h);f=g*(i/h)}o[c+(k<<4)>>2]=j;o[c+(k<<4)+4>>2]=f;o[c+(k<<4)+8>>2]=e;if((k|0)==(d+-1|0))break;else k=k+1|0}return}function Wu(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0,h=0.0,i=0.0,j=0.0,k=0.0,l=0;if((d|0)<=0)return;l=0;while(1){k=+o[a+32>>2];e=+o[a+28>>2];g=b+(l<<4)|0;f=+o[b+(l<<4)+4>>2];i=+o[b+(l<<4)+8>>2];j=+Y(+(f*f+i*i));if(!(j!=0.0))if(+o[g>>2]<0.0){h=-e;f=k;e=0.0}else{h=e;f=k;e=0.0}else{if(+o[g>>2]<0.0)e=-e;h=e;f=f*(k/j);e=i*(k/j)}o[c+(l<<4)>>2]=h;o[c+(l<<4)+4>>2]=f;o[c+(l<<4)+8>>2]=e;if((l|0)==(d+-1|0))break;else l=l+1|0}return}function Xu(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0;o[a+4>>2]=1.0;o[a+8>>2]=1.0;o[a+12>>2]=1.0;o[a+16>>2]=0.0;i[a+36>>0]=1;k[a+32>>2]=0;k[a+24>>2]=0;k[a+28>>2]=0;k[a+48>>2]=0;k[a>>2]=15952;i[a+100>>0]=1;k[a+96>>2]=0;k[a+88>>2]=0;k[a+92>>2]=0;i[a+120>>0]=1;k[a+116>>2]=0;k[a+108>>2]=0;k[a+112>>2]=0;i[a+140>>0]=1;k[a+136>>2]=0;k[a+128>>2]=0;k[a+132>>2]=0;i[a+160>>0]=1;k[a+156>>2]=0;k[a+148>>2]=0;k[a+152>>2]=0;i[a+164>>0]=b&1;i[a+165>>0]=c&1;o[a+168>>2]=0.0;k[5108]=(k[5108]|0)+1;b=iF(51)|0;if(!b)d=0;else{k[(b+4+15&-16)+-4>>2]=b;d=b+4+15&-16}c=k[a+24>>2]|0;if((c|0)>0){b=0;while(1){e=d+(b<<5)|0;f=(k[a+32>>2]|0)+(b<<5)|0;k[e>>2]=k[f>>2];k[e+4>>2]=k[f+4>>2];k[e+8>>2]=k[f+8>>2];k[e+12>>2]=k[f+12>>2];k[e+16>>2]=k[f+16>>2];k[e+20>>2]=k[f+20>>2];k[e+24>>2]=k[f+24>>2];k[e+28>>2]=k[f+28>>2];if((b|0)==(c+-1|0))break;else b=b+1|0}}b=k[a+32>>2]|0;if(b){if(i[a+36>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+32>>2]=0}i[a+36>>0]=1;k[a+32>>2]=d;k[a+28>>2]=1;f=k[a+24>>2]|0;k[d+(f<<5)>>2]=0;k[d+(f<<5)+4>>2]=0;k[d+(f<<5)+8>>2]=12;k[d+(f<<5)+12>>2]=0;k[d+(f<<5)+16>>2]=0;k[d+(f<<5)+20>>2]=16;k[d+(f<<5)+24>>2]=2;k[d+(f<<5)+28>>2]=0;k[a+24>>2]=(k[a+24>>2]|0)+1;if(!(i[a+164>>0]|0)){b=k[a+32>>2]|0;k[b>>2]=(k[a+148>>2]|0)/3|0;k[b+4>>2]=0;k[b+24>>2]=3;k[b+8>>2]=6}else{b=k[a+32>>2]|0;k[b>>2]=(k[a+128>>2]|0)/3|0;k[b+4>>2]=0;k[b+24>>2]=2;k[b+8>>2]=12}if(!(i[a+165>>0]|0)){e=12;a=(k[a+108>>2]|0)/3|0;f=b+12|0;k[f>>2]=a;f=b+16|0;k[f>>2]=0;f=b+20|0;k[f>>2]=e;return}else{e=16;a=k[a+88>>2]|0;f=b+12|0;k[f>>2]=a;f=b+16|0;k[f>>2]=0;f=b+20|0;k[f>>2]=e;return}}function Yu(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0;if(!(i[a+164>>0]|0)){d=k[a+148>>2]|0;if((d|0)==(k[a+152>>2]|0)?(h=(d|0)==0?1:d<<1,(d|0)<(h|0)):0){if(!h)c=0;else{k[5108]=(k[5108]|0)+1;c=iF((h<<1)+19|0)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}d=k[a+148>>2]|0}if((d|0)>0){e=d+-1|0;g=0;while(1){f=c+(g<<1)|0;if(f)j[f>>1]=j[(k[a+156>>2]|0)+(g<<1)>>1]|0;if((g|0)==(e|0))break;else g=g+1|0}}e=k[a+156>>2]|0;if(e){if(i[a+160>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0);d=k[a+148>>2]|0}k[a+156>>2]=0}i[a+160>>0]=1;k[a+156>>2]=c;k[a+152>>2]=h}c=k[a+156>>2]|0;e=c+(d<<1)|0;if(e)j[e>>1]=b;k[a+148>>2]=d+1;k[(k[a+32>>2]|0)+4>>2]=c;return}else{c=k[a+128>>2]|0;if((c|0)==(k[a+132>>2]|0)?(f=(c|0)==0?1:c<<1,(c|0)<(f|0)):0){if(!f)g=0;else{k[5108]=(k[5108]|0)+1;c=iF((f<<2|3)+16|0)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}g=c;c=k[a+128>>2]|0}if((c|0)>0){e=c+-1|0;c=0;while(1){d=g+(c<<2)|0;if(d)k[d>>2]=k[(k[a+136>>2]|0)+(c<<2)>>2];if((c|0)==(e|0))break;else c=c+1|0}}d=k[a+136>>2]|0;if(d){if(i[a+140>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[a+136>>2]=0}i[a+140>>0]=1;k[a+136>>2]=g;k[a+132>>2]=f;c=k[a+128>>2]|0}e=k[a+136>>2]|0;d=e+(c<<2)|0;if(d){k[d>>2]=b;c=k[a+128>>2]|0}k[a+128>>2]=c+1;k[(k[a+32>>2]|0)+4>>2]=e;return}}function Zu(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,j=0.0,l=0.0,m=0.0,n=0.0,p=0,q=0.0,r=0.0,s=0.0;if(i[a+165>>0]|0){f=k[a+88>>2]|0;a:do if((f|0)>0&c){h=k[a+96>>2]|0;n=+o[b>>2];j=+o[b+4>>2];l=+o[b+8>>2];m=+o[a+168>>2];d=0;while(1){s=+o[h+(d<<4)>>2]-n;r=+o[h+(d<<4)+4>>2]-j;q=+o[h+(d<<4)+8>>2]-l;if(s*s+r*r+q*q<=m)break;d=d+1|0;if((d|0)>=(f|0))break a}return d|0}while(0);p=(k[a+32>>2]|0)+12|0;k[p>>2]=(k[p>>2]|0)+1;if((f|0)==(k[a+92>>2]|0)?(g=(f|0)==0?1:f<<1,(f|0)<(g|0)):0){if(!g)d=0;else{k[5108]=(k[5108]|0)+1;d=iF((g<<4|3)+16|0)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}f=k[a+88>>2]|0}if((f|0)>0){c=f+-1|0;f=0;while(1){p=d+(f<<4)|0;h=(k[a+96>>2]|0)+(f<<4)|0;k[p>>2]=k[h>>2];k[p+4>>2]=k[h+4>>2];k[p+8>>2]=k[h+8>>2];k[p+12>>2]=k[h+12>>2];if((f|0)==(c|0))break;else f=f+1|0}}f=k[a+96>>2]|0;if(f){if(i[a+100>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[f+-4>>2]|0)}k[a+96>>2]=0}i[a+100>>0]=1;k[a+96>>2]=d;k[a+92>>2]=g;d=k[a+88>>2]|0}else d=f;p=(k[a+96>>2]|0)+(d<<4)|0;k[p>>2]=k[b>>2];k[p+4>>2]=k[b+4>>2];k[p+8>>2]=k[b+8>>2];k[p+12>>2]=k[b+12>>2];p=k[a+88>>2]|0;k[a+88>>2]=p+1;k[(k[a+32>>2]|0)+16>>2]=k[a+96>>2];return p|0}e=k[a+108>>2]|0;b:do if((e|0)>0&c){g=k[a+116>>2]|0;n=+o[b>>2];m=+o[b+4>>2];l=+o[b+8>>2];j=+o[a+168>>2];h=0;while(1){q=+o[g+(h<<2)>>2]-n;r=+o[g+(h+1<<2)>>2]-m;s=+o[g+(h+2<<2)>>2]-l;if(q*q+r*r+s*s<=j)break;h=h+3|0;if((h|0)>=(e|0)){p=b;break b}}p=(h|0)/3|0;return p|0}else p=b;while(0);f=k[a+112>>2]|0;if((e|0)==(f|0)){d=(e|0)==0?1:e<<1;if((e|0)<(d|0)){if(!d)f=0;else{k[5108]=(k[5108]|0)+1;f=iF((d<<2|3)+16|0)|0;if(!f)f=0;else{k[(f+4+15&-16)+-4>>2]=f;f=f+4+15&-16}e=k[a+108>>2]|0}if((e|0)>0){h=e+-1|0;c=0;while(1){g=f+(c<<2)|0;if(g)o[g>>2]=+o[(k[a+116>>2]|0)+(c<<2)>>2];if((c|0)==(h|0))break;else c=c+1|0}}c=k[a+116>>2]|0;if(c){if(i[a+120>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);e=k[a+108>>2]|0}k[a+116>>2]=0}i[a+120>>0]=1;k[a+116>>2]=f;k[a+112>>2]=d;h=e;g=d}else{h=e;g=e}}else{h=e;g=f}d=k[a+116>>2]|0;c=d+(h<<2)|0;if(c)o[c>>2]=+o[p>>2];f=h+1|0;k[a+108>>2]=f;if((f|0)==(g|0)){e=(g|0)==0?1:g<<1;if((g|0)<(e|0)){if(!e){d=0;f=g}else{k[5108]=(k[5108]|0)+1;d=iF((e<<2|3)+16|0)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}f=k[a+108>>2]|0}if((f|0)>0){c=f+-1|0;h=0;while(1){g=d+(h<<2)|0;if(g)o[g>>2]=+o[(k[a+116>>2]|0)+(h<<2)>>2];if((h|0)==(c|0))break;else h=h+1|0}}c=k[a+116>>2]|0;if(c){if(i[a+120>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);f=k[a+108>>2]|0}k[a+116>>2]=0}i[a+120>>0]=1;k[a+116>>2]=d;k[a+112>>2]=e}else{f=g;e=g}}else e=g;c=d+(f<<2)|0;if(c)o[c>>2]=+o[b+4>>2];c=f+1|0;k[a+108>>2]=c;if((c|0)==(e|0)){h=(e|0)==0?1:e<<1;if((e|0)<(h|0)){if(!h)d=0;else{k[5108]=(k[5108]|0)+1;d=iF((h<<2|3)+16|0)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}e=k[a+108>>2]|0}if((e|0)>0){g=e+-1|0;f=0;while(1){c=d+(f<<2)|0;if(c)o[c>>2]=+o[(k[a+116>>2]|0)+(f<<2)>>2];if((f|0)==(g|0))break;else f=f+1|0}}c=k[a+116>>2]|0;if(c){if(i[a+120>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);e=k[a+108>>2]|0}k[a+116>>2]=0}i[a+120>>0]=1;k[a+116>>2]=d;k[a+112>>2]=h}}else e=c;f=d+(e<<2)|0;if(f)o[f>>2]=+o[b+8>>2];p=e+1|0;k[a+108>>2]=p;h=k[a+32>>2]|0;k[h+12>>2]=(k[h+12>>2]|0)+1;k[h+16>>2]=d;p=((p|0)/3|0)+-1|0;return p|0}function _u(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0;if(i[a+165>>0]|0){if((k[a+92>>2]|0)>=(b|0))return;if((b|0)!=0?(k[5108]=(k[5108]|0)+1,c=iF((b<<4|3)+16|0)|0,(c|0)!=0):0){k[(c+4+15&-16)+-4>>2]=c;e=c+4+15&-16}else e=0;d=k[a+88>>2]|0;if((d|0)>0){c=0;while(1){f=e+(c<<4)|0;g=(k[a+96>>2]|0)+(c<<4)|0;k[f>>2]=k[g>>2];k[f+4>>2]=k[g+4>>2];k[f+8>>2]=k[g+8>>2];k[f+12>>2]=k[g+12>>2];if((c|0)==(d+-1|0))break;else c=c+1|0}}c=k[a+96>>2]|0;if(c){if(i[a+100>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[a+96>>2]=0}i[a+100>>0]=1;k[a+96>>2]=e;k[a+92>>2]=b;return}if((k[a+112>>2]|0)>=(b|0))return;if((b|0)!=0?(k[5108]=(k[5108]|0)+1,d=iF((b<<2|3)+16|0)|0,(d|0)!=0):0){k[(d+4+15&-16)+-4>>2]=d;f=d+4+15&-16}else f=0;e=k[a+108>>2]|0;if((e|0)>0){c=0;while(1){d=f+(c<<2)|0;if(d)o[d>>2]=+o[(k[a+116>>2]|0)+(c<<2)>>2];if((c|0)==(e+-1|0))break;else c=c+1|0}}d=k[a+116>>2]|0;if(d){if(i[a+120>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[a+116>>2]=0}i[a+120>>0]=1;k[a+116>>2]=f;k[a+112>>2]=b;return}function $u(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0;if(!(i[a+164>>0]|0)){if((k[a+152>>2]|0)>=(b|0))return;if((b|0)!=0?(k[5108]=(k[5108]|0)+1,d=iF((b<<1)+19|0)|0,(d|0)!=0):0){k[(d+4+15&-16)+-4>>2]=d;f=d+4+15&-16}else f=0;d=k[a+148>>2]|0;if((d|0)>0){e=0;while(1){c=f+(e<<1)|0;if(c)j[c>>1]=j[(k[a+156>>2]|0)+(e<<1)>>1]|0;if((e|0)==(d+-1|0))break;else e=e+1|0}}d=k[a+156>>2]|0;if(d){if(i[a+160>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[a+156>>2]=0}i[a+160>>0]=1;k[a+156>>2]=f;k[a+152>>2]=b;return}else{if((k[a+132>>2]|0)>=(b|0))return;if((b|0)!=0?(k[5108]=(k[5108]|0)+1,c=iF((b<<2|3)+16|0)|0,(c|0)!=0):0){k[(c+4+15&-16)+-4>>2]=c;f=c+4+15&-16}else f=0;d=k[a+128>>2]|0;if((d|0)>0){e=0;while(1){c=f+(e<<2)|0;if(c)k[c>>2]=k[(k[a+136>>2]|0)+(e<<2)>>2];if((e|0)==(d+-1|0))break;else e=e+1|0}}c=k[a+136>>2]|0;if(c){if(i[a+140>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[a+136>>2]=0}i[a+140>>0]=1;k[a+136>>2]=f;k[a+132>>2]=b;return}}function av(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;var g=0,h=0.0,l=0.0,n=0.0;k[a>>2]=16240;j[a+4>>1]=-2;j[a+6>>1]=-1;k[a+92>>2]=e;k[a+96>>2]=0;i[a+100>>0]=0;k[a+104>>2]=0;k[a+108>>2]=0;if(!e){k[5108]=(k[5108]|0)+1;e=iF(95)|0;if((e|0)!=0?(k[(e+4+15&-16)+-4>>2]=e,(e+4+15&-16|0)!=0):0){bv(e+4+15&-16);e=e+4+15&-16}else e=0;k[a+92>>2]=e;i[a+100>>0]=1}if(!f){k[5108]=(k[5108]|0)+1;e=iF(43)|0;if((e|0)!=0?(g=e+4+15&-16,k[g+-4>>2]=e,(e+4+15&-16|0)!=0):0){k[g>>2]=0;k[g+4>>2]=0;k[g+8>>2]=0;k[g+12>>2]=0;k[g+16>>2]=0;k[g+20>>2]=0;k[(e+4+15&-16)>>2]=16304;i[g+20>>0]=1;k[g+16>>2]=0;k[g+8>>2]=0;k[g+12>>2]=0;g=e+4+15&-16}else g=0;k[a+112>>2]=g;k[5108]=(k[5108]|0)+1;g=iF(215)|0;if((g|0)!=0?(k[(g+4+15&-16)+-4>>2]=g,(g+4+15&-16|0)!=0):0){mv(g+4+15&-16,k[a+112>>2]|0);g=g+4+15&-16}else g=0;k[a+108>>2]=g;i[g+193>>0]=1};k[a+8>>2]=k[b>>2];k[a+8+4>>2]=k[b+4>>2];k[a+8+8>>2]=k[b+8>>2];k[a+8+12>>2]=k[b+12>>2];k[a+24>>2]=k[c>>2];k[a+24+4>>2]=k[c+4>>2];k[a+24+8>>2]=k[c+8>>2];k[a+24+12>>2]=k[c+12>>2];n=+(m[a+6>>1]|0);l=n/(+o[a+28>>2]-+o[a+12>>2]);h=n/(+o[a+32>>2]-+o[a+16>>2]);o[a+40>>2]=n/(+o[a+24>>2]-+o[a+8>>2]);o[a+44>>2]=l;o[a+48>>2]=h;o[a+52>>2]=0.0;c=(d&65535)+1&65535;k[5108]=(k[5108]|0)+1;g=iF(c<<6|19)|0;if(!g)f=0;else{k[(g+4+15&-16)+-4>>2]=g;f=g+4+15&-16}if(c){e=f+(c<<6)|0;g=f;do{k[g>>2]=0;k[g+8>>2]=0;g=g+64|0}while((g|0)!=(e|0))}k[a+60>>2]=f;j[a+58>>1]=(d&65535)+1;j[a+56>>1]=0;j[a+64>>1]=1;if(c>>>0>1){g=1;e=1;do{j[f+(g<<6)+48>>1]=g+1;e=e+1<<16>>16;g=e&65535}while(g>>>0<c>>>0)}j[f+(c+-1<<6)+48>>1]=0;k[5108]=(k[5108]|0)+1;g=iF((c<<3|3)+16|0)|0;if(!g)g=0;else{k[(g+4+15&-16)+-4>>2]=g;g=g+4+15&-16}k[a+80>>2]=g;k[a+68>>2]=g;k[5108]=(k[5108]|0)+1;g=iF((c<<3|3)+16|0)|0;if(!g)g=0;else{k[(g+4+15&-16)+-4>>2]=g;g=g+4+15&-16}k[a+84>>2]=g;k[a+72>>2]=g;k[5108]=(k[5108]|0)+1;g=iF((c<<3|3)+16|0)|0;if(!g){c=0;d=a+88|0;k[d>>2]=c;d=a+76|0;k[d>>2]=c;c=k[a+60>>2]|0;k[c>>2]=0;b=c+48|0;j[b>>1]=0;b=c+54|0;j[b>>1]=1;b=k[a+68>>2]|0;j[b>>1]=0;f=b+2|0;j[f>>1]=0;f=j[a+6>>1]|0;e=b+4|0;j[e>>1]=f;b=b+6|0;j[b>>1]=0;b=c+50|0;j[b>>1]=0;b=c+56|0;j[b>>1]=1;b=k[a+72>>2]|0;j[b>>1]=0;e=b+2|0;j[e>>1]=0;e=j[a+6>>1]|0;f=b+4|0;j[f>>1]=e;b=b+6|0;j[b>>1]=0;b=c+52|0;j[b>>1]=0;c=c+58|0;j[c>>1]=1;d=k[d>>2]|0;j[d>>1]=0;c=d+2|0;j[c>>1]=0;c=j[a+6>>1]|0;b=d+4|0;j[b>>1]=c;d=d+6|0;j[d>>1]=0;k[a>>2]=16064;return}k[(g+4+15&-16)+-4>>2]=g;c=g+4+15&-16;d=a+88|0;k[d>>2]=c;d=a+76|0;k[d>>2]=c;c=k[a+60>>2]|0;k[c>>2]=0;b=c+48|0;j[b>>1]=0;b=c+54|0;j[b>>1]=1;b=k[a+68>>2]|0;j[b>>1]=0;f=b+2|0;j[f>>1]=0;f=j[a+6>>1]|0;e=b+4|0;j[e>>1]=f;b=b+6|0;j[b>>1]=0;b=c+50|0;j[b>>1]=0;b=c+56|0;j[b>>1]=1;b=k[a+72>>2]|0;j[b>>1]=0;e=b+2|0;j[e>>1]=0;e=j[a+6>>1]|0;f=b+4|0;j[f>>1]=e;b=b+6|0;j[b>>1]=0;b=c+52|0;j[b>>1]=0;c=c+58|0;j[c>>1]=1;d=k[d>>2]|0;j[d>>1]=0;c=d+2|0;j[c>>1]=0;c=j[a+6>>1]|0;b=d+4|0;j[b>>1]=c;d=d+6|0;j[d>>1]=0;k[a>>2]=16064;return}function bv(a){a=a|0;var b=0,c=0,d=0,e=0;k[a>>2]=16504;i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;k[a+24>>2]=0;i[a+28>>0]=0;i[a+48>>0]=1;k[a+44>>2]=0;k[a+36>>2]=0;k[a+40>>2]=0;i[a+68>>0]=1;k[a+64>>2]=0;k[a+56>>2]=0;k[a+60>>2]=0;k[a+72>>2]=0;k[5108]=(k[5108]|0)+1;b=iF(51)|0;if(!b)d=0;else{k[(b+4+15&-16)+-4>>2]=b;d=b+4+15&-16}b=k[a+8>>2]|0;if((b|0)>0){c=0;while(1){e=k[a+16>>2]|0;k[d+(c<<4)>>2]=k[e+(c<<4)>>2];k[d+(c<<4)+4>>2]=k[e+(c<<4)+4>>2];k[d+(c<<4)+8>>2]=k[e+(c<<4)+8>>2];k[d+(c<<4)+12>>2]=k[e+(c<<4)+12>>2];if((c|0)==(b+-1|0))break;else c=c+1|0}}b=k[a+16>>2]|0;if(!b){i[a+20>>0]=1;k[a+16>>2]=d;k[a+12>>2]=2;cv(a);return}if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+16>>2]=0;i[a+20>>0]=1;k[a+16>>2]=d;k[a+12>>2]=2;cv(a);return}function cv(a){a=a|0;var b=0,c=0,d=0,e=0,f=0,g=0,h=0;g=k[a+12>>2]|0;h=k[a+36>>2]|0;if((h|0)>=(g|0))return;if((h|0)<=(g|0)){if((k[a+40>>2]|0)<(g|0)){if(!g){b=0;c=h}else{k[5108]=(k[5108]|0)+1;b=iF((g<<2|3)+16|0)|0;if(!b)b=0;else{k[(b+4+15&-16)+-4>>2]=b;b=b+4+15&-16}c=k[a+36>>2]|0}if((c|0)>0){e=c+-1|0;c=0;while(1){d=b+(c<<2)|0;if(d)k[d>>2]=k[(k[a+44>>2]|0)+(c<<2)>>2];if((c|0)==(e|0))break;else c=c+1|0}}c=k[a+44>>2]|0;if(c){if(i[a+48>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[a+44>>2]=0}i[a+48>>0]=1;k[a+44>>2]=b;k[a+40>>2]=g}else b=k[a+44>>2]|0;e=h;while(1){c=b+(e<<2)|0;if(c)k[c>>2]=0;if((e|0)==(g+-1|0))break;else e=e+1|0}}k[a+36>>2]=g;e=k[a+56>>2]|0;if((e|0)<(g|0)){if((k[a+60>>2]|0)<(g|0)){if(!g){c=0;b=e}else{k[5108]=(k[5108]|0)+1;c=iF((g<<2|3)+16|0)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}b=k[a+56>>2]|0}if((b|0)>0){d=b+-1|0;f=0;while(1){b=c+(f<<2)|0;if(b)k[b>>2]=k[(k[a+64>>2]|0)+(f<<2)>>2];if((f|0)==(d|0))break;else f=f+1|0}}b=k[a+64>>2]|0;if(b){if(i[a+68>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+64>>2]=0}i[a+68>>0]=1;k[a+64>>2]=c;k[a+60>>2]=g}else c=k[a+64>>2]|0;while(1){b=c+(e<<2)|0;if(b)k[b>>2]=0;if((e|0)==(g+-1|0))break;else e=e+1|0}}k[a+56>>2]=g;if((g|0)>0){nF(k[a+44>>2]|0,-1,g<<2|0)|0;nF(k[a+64>>2]|0,-1,g<<2|0)|0}if((h|0)<=0)return;b=k[a+16>>2]|0;d=k[a+44>>2]|0;c=k[a+64>>2]|0;e=0;while(1){g=k[(k[b+(e<<4)+4>>2]|0)+12>>2]<<16|k[(k[b+(e<<4)>>2]|0)+12>>2];g=(g+~(g<<15)>>10^g+~(g<<15))*9|0;g=d+((((g>>6^g)+~((g>>6^g)<<11)>>16^(g>>6^g)+~((g>>6^g)<<11))&(k[a+12>>2]|0)+-1)<<2)|0;k[c+(e<<2)>>2]=k[g>>2];k[g>>2]=e;if((e|0)==(h+-1|0))break;else e=e+1|0}return}function dv(a){a=a|0;var b=0;k[a>>2]=16504;b=k[a+64>>2]|0;if(b){if(i[a+68>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+64>>2]=0}i[a+68>>0]=1;k[a+64>>2]=0;k[a+56>>2]=0;k[a+60>>2]=0;b=k[a+44>>2]|0;if(b){if(i[a+48>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+44>>2]=0}i[a+48>>0]=1;k[a+44>>2]=0;k[a+36>>2]=0;k[a+40>>2]=0;b=k[a+16>>2]|0;if(!b){i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;a=a+12|0;k[a>>2]=0;return}if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+16>>2]=0;i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;a=a+12|0;k[a>>2]=0;return}function ev(a){a=a|0;dv(a);jF(a);return}function fv(a,b,c){a=a|0;b=b|0;c=c|0;a=k[b+8>>2]|0;if(!((c|0)!=0&(a|0)!=0))return;Sb[k[k[a>>2]>>2]&255](a);Ub[k[(k[c>>2]|0)+60>>2]&127](c,k[b+8>>2]|0);k[b+8>>2]=0;return}function gv(a,b,c){a=a|0;b=b|0;c=c|0;var d=0;d=r;r=r+16|0;k[d>>2]=16808;k[d+4>>2]=b;k[d+8>>2]=a;k[d+12>>2]=c;yc[k[(k[a>>2]|0)+48>>2]&127](a,d,c);r=d;return}function hv(a,b,c){a=a|0;b=b|0;c=c|0;var d=0;d=r;r=r+16|0;k[d>>2]=16632;k[d+4>>2]=b;yc[k[(k[a>>2]|0)+48>>2]&127](a,d,c);r=d;return}function iv(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0;k[4122]=(k[4122]|0)+1;d=(k[b+12>>2]|0)>(k[c+12>>2]|0);e=k[(d?c:b)+12>>2]|0;d=k[(d?b:c)+12>>2]|0;b=((d<<16|e)+~((d<<16|e)<<15)>>10^(d<<16|e)+~((d<<16|e)<<15))*9|0;b=((b>>6^b)+~((b>>6^b)<<11)>>16^(b>>6^b)+~((b>>6^b)<<11))&(k[a+12>>2]|0)+-1;if((b|0)>=(k[a+36>>2]|0)){f=0;return f|0}c=k[(k[a+44>>2]|0)+(b<<2)>>2]|0;if((c|0)==-1){f=0;return f|0}b=k[a+16>>2]|0;while(1){if((k[(k[b+(c<<4)>>2]|0)+12>>2]|0)==(e|0)?(k[(k[b+(c<<4)+4>>2]|0)+12>>2]|0)==(d|0):0)break;c=k[(k[a+64>>2]|0)+(c<<2)>>2]|0;if((c|0)==-1){b=0;f=8;break}}if((f|0)==8)return b|0;f=b+(c<<4)|0;return f|0}function jv(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0,i=0,j=0,l=0,m=0,n=0,o=0;k[4118]=(k[4118]|0)+1;i=(k[b+12>>2]|0)>(k[c+12>>2]|0);l=i?c:b;i=i?b:c;f=k[l+12>>2]|0;e=k[i+12>>2]|0;h=((e<<16|f)+~((e<<16|f)<<15)>>10^(e<<16|f)+~((e<<16|f)<<15))*9|0;h=((h>>6^h)+~((h>>6^h)<<11)>>16^(h>>6^h)+~((h>>6^h)<<11))&(k[a+12>>2]|0)+-1;c=k[(k[a+44>>2]|0)+(h<<2)>>2]|0;if((c|0)==-1){o=0;return o|0}g=k[a+16>>2]|0;b=c;while(1){if((k[(k[g+(b<<4)>>2]|0)+12>>2]|0)==(f|0)?(k[(k[g+(b<<4)+4>>2]|0)+12>>2]|0)==(e|0):0)break;c=k[(k[a+64>>2]|0)+(b<<2)>>2]|0;if((c|0)==-1){b=0;o=24;break}else b=c}if((o|0)==24)return b|0;c=g+(b<<4)|0;if(!c){o=0;return o|0}yc[k[(k[a>>2]|0)+32>>2]&127](a,c,d);n=k[g+(b<<4)+12>>2]|0;m=c-(k[a+16>>2]|0)>>4;h=(k[a+44>>2]|0)+(h<<2)|0;c=k[h>>2]|0;e=k[a+64>>2]|0;if((c|0)!=(m|0)){b=c;while(1){g=e+(b<<2)|0;f=k[g>>2]|0;if((f|0)==(m|0))break;else b=f}c=k[e+(m<<2)>>2]|0;if((b|0)==-1)o=12;else k[g>>2]=c}else{c=k[e+(m<<2)>>2]|0;o=12}if((o|0)==12)k[h>>2]=c;j=(k[a+8>>2]|0)+-1|0;c=k[a+72>>2]|0;if(c)_b[k[(k[c>>2]|0)+12>>2]&31](c,l,i,d)|0;if((j|0)==(m|0)){k[a+8>>2]=(k[a+8>>2]|0)+-1;o=n;return o|0}i=k[a+16>>2]|0;d=k[(k[i+(j<<4)+4>>2]|0)+12>>2]<<16|k[(k[i+(j<<4)>>2]|0)+12>>2];d=(d+~(d<<15)>>10^d+~(d<<15))*9|0;d=((d>>6^d)+~((d>>6^d)<<11)>>16^(d>>6^d)+~((d>>6^d)<<11))&(k[a+12>>2]|0)+-1;h=(k[a+44>>2]|0)+(d<<2)|0;c=k[h>>2]|0;e=k[a+64>>2]|0;if((c|0)!=(j|0)){g=c;while(1){b=e+(g<<2)|0;f=k[b>>2]|0;if((f|0)==(j|0))break;else g=f}c=k[e+(j<<2)>>2]|0;if((g|0)==-1)o=22;else k[b>>2]=c}else{c=k[e+(j<<2)>>2]|0;o=22}if((o|0)==22)k[h>>2]=c;k[i+(m<<4)>>2]=k[i+(j<<4)>>2];k[i+(m<<4)+4>>2]=k[i+(j<<4)+4>>2];k[i+(m<<4)+8>>2]=k[i+(j<<4)+8>>2];k[i+(m<<4)+12>>2]=k[i+(j<<4)+12>>2];o=(k[a+44>>2]|0)+(d<<2)|0;k[(k[a+64>>2]|0)+(m<<2)>>2]=k[o>>2];k[o>>2]=m;k[a+8>>2]=(k[a+8>>2]|0)+-1;o=n;return o|0}function kv(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0;if((k[a+8>>2]|0)<=0)return;f=0;a:while(1){while(1){d=k[a+16>>2]|0;e=d+(f<<4)|0;if(!(nc[k[(k[b>>2]|0)+8>>2]&31](b,e)|0))break;_b[k[(k[a>>2]|0)+12>>2]&31](a,k[e>>2]|0,k[d+(f<<4)+4>>2]|0,c)|0;k[4116]=(k[4116]|0)+-1;if((f|0)>=(k[a+8>>2]|0)){d=7;break a}}f=f+1|0;if((f|0)>=(k[a+8>>2]|0)){d=7;break}}if((d|0)==7)return}function lv(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0,j=0,l=0,m=0,n=0,o=0,p=0,q=0,s=0,t=0;t=r;r=r+32|0;i[t+16>>0]=1;k[t+12>>2]=0;k[t+4>>2]=0;k[t+8>>2]=0;d=k[a+8>>2]|0;if((d|0)>0){j=0;g=0;e=0;f=0;l=0;h=d;d=0;c=0;q=0;do{p=k[a+16>>2]|0;if((d|0)==(c|0)){o=(c|0)==0?1:c<<1;if((c|0)<(o|0)){if(o){k[5108]=(k[5108]|0)+1;c=iF((o<<4|3)+16|0)|0;if(!c){m=0;e=d}else{k[(c+4+15&-16)+-4>>2]=c;m=c+4+15&-16;e=d}}else{m=0;e=c}if((e|0)>0){g=e+-1|0;f=0;while(1){n=k[t+12>>2]|0;k[m+(f<<4)>>2]=k[n+(f<<4)>>2];k[m+(f<<4)+4>>2]=k[n+(f<<4)+4>>2];k[m+(f<<4)+8>>2]=k[n+(f<<4)+8>>2];k[m+(f<<4)+12>>2]=k[n+(f<<4)+12>>2];if((f|0)==(g|0))break;else f=f+1|0}}g=k[t+12>>2]|0;if(!g)d=e;else{k[5110]=(k[5110]|0)+1;jF(k[g+-4>>2]|0);k[t+12>>2]=0}i[t+16>>0]=1;k[t+12>>2]=m;k[t+8>>2]=o;n=d;g=m;e=m;j=m;c=o;l=m;h=k[a+8>>2]|0;f=m}else n=c}else n=d;k[l+(n<<4)>>2]=k[p+(q<<4)>>2];k[l+(n<<4)+4>>2]=k[p+(q<<4)+4>>2];k[l+(n<<4)+8>>2]=k[p+(q<<4)+8>>2];k[l+(n<<4)+12>>2]=k[p+(q<<4)+12>>2];d=n+1|0;q=q+1|0}while((q|0)<(h|0));k[t+4>>2]=d;if((n|0)>-1){c=0;do{_b[k[(k[a>>2]|0)+12>>2]&31](a,k[f+(c<<4)>>2]|0,k[f+(c<<4)+4>>2]|0,b)|0;c=c+1|0}while((c|0)<(d|0));f=d}else f=d}else{g=0;f=0;e=0}if((k[a+56>>2]|0)>0){c=k[a+64>>2]|0;d=0;do{k[c+(d<<2)>>2]=-1;d=d+1|0}while((d|0)<(k[a+56>>2]|0))}if((f|0)<=1){if((f|0)>0)s=24}else{kx(t,0,f+-1|0);s=24}if((s|0)==24){c=0;do{dc[k[(k[a>>2]|0)+8>>2]&63](a,k[e+(c<<4)>>2]|0,k[e+(c<<4)+4>>2]|0)|0;c=c+1|0}while((c|0)<(f|0))}if(!g){r=t;return}k[5110]=(k[5110]|0)+1;jF(k[g+-4>>2]|0);k[t+12>>2]=0;r=t;return}function mv(a,b){a=a|0;b=b|0;var c=0;k[a>>2]=16960;i[a+40>>0]=1;k[a+36>>2]=0;k[a+28>>2]=0;k[a+32>>2]=0;i[a+60>>0]=1;k[a+56>>2]=0;k[a+48>>2]=0;k[a+52>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;k[a+12>>2]=-1;k[a+16>>2]=0;k[a+20>>2]=0;i[a+100>>0]=1;k[a+96>>2]=0;k[a+88>>2]=0;k[a+92>>2]=0;i[a+120>>0]=1;k[a+116>>2]=0;k[a+108>>2]=0;k[a+112>>2]=0;k[a+64>>2]=0;k[a+68>>2]=0;k[a+72>>2]=-1;k[a+76>>2]=0;k[a+80>>2]=0;i[a+193>>0]=0;i[a+194>>0]=1;i[a+192>>0]=(b|0)!=0^1;o[a+140>>2]=0.0;k[a+144>>2]=0;k[a+164>>2]=0;k[a+148>>2]=1;k[a+152>>2]=0;k[a+156>>2]=10;k[a+160>>2]=1;k[a+168>>2]=0;k[a+172>>2]=0;o[a+176>>2]=0.0;if(b){c=b;b=a+136|0;k[b>>2]=c;b=a+188|0;k[b>>2]=0;b=a+180|0;k[b>>2]=0;b=a+184|0;k[b>>2]=0;a=a+124|0;k[a>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;return}k[5108]=(k[5108]|0)+1;b=iF(95)|0;if((b|0)!=0?(k[(b+4+15&-16)+-4>>2]=b,(b+4+15&-16|0)!=0):0){bv(b+4+15&-16);b=b+4+15&-16}else b=0;c=a+136|0;k[c>>2]=b;c=a+188|0;k[c>>2]=0;c=a+180|0;k[c>>2]=0;c=a+184|0;k[c>>2]=0;c=a+124|0;k[c>>2]=0;k[c+4>>2]=0;k[c+8>>2]=0;return}function nv(a){a=a|0;var b=0;k[a>>2]=16960;if((i[a+192>>0]|0)!=0?(b=k[a+136>>2]|0,Sb[k[k[b>>2]>>2]&255](b),b=k[a+136>>2]|0,(b|0)!=0):0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}Lv(a+64|0);Lv(a+4|0);return}function ov(a){a=a|0;nv(a);jF(a);return}function pv(a,b,c,d,e,f,g,h,l){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;l=l|0;var m=0,n=0;n=r;r=r+48|0;k[5108]=(k[5108]|0)+1;h=iF(83)|0;if(!h)m=0;else{k[(h+4+15&-16)+-4>>2]=h;m=h+4+15&-16}k[m>>2]=e;j[m+4>>1]=f;j[m+6>>1]=g;e=m+16|0;k[e>>2]=k[b>>2];k[e+4>>2]=k[b+4>>2];k[e+8>>2]=k[b+8>>2];k[e+12>>2]=k[b+12>>2];e=m+32|0;k[e>>2]=k[c>>2];k[e+4>>2]=k[c+4>>2];k[e+8>>2]=k[c+8>>2];k[e+12>>2]=k[c+12>>2];k[m+8>>2]=0;e=m+56|0;k[e>>2]=0;g=m+52|0;k[g>>2]=0;k[n+16>>2]=k[b>>2];k[n+16+4>>2]=k[b+4>>2];k[n+16+8>>2]=k[b+8>>2];k[n+16+12>>2]=k[b+12>>2];k[n+16+16>>2]=k[c>>2];k[n+16+16+4>>2]=k[c+4>>2];k[n+16+16+8>>2]=k[c+8>>2];k[n+16+16+12>>2]=k[c+12>>2];k[m+60>>2]=k[a+144>>2];l=(k[a+188>>2]|0)+1|0;k[a+188>>2]=l;k[m+12>>2]=l;l=k[a+8>>2]|0;if(!l){k[5108]=(k[5108]|0)+1;h=iF(63)|0;if((h|0)!=0?(k[(h+4+15&-16)+-4>>2]=h,(h+4+15&-16|0)!=0):0){l=h+4+15&-16;d=l+44|0;do{k[l>>2]=0;l=l+4|0}while((l|0)<(d|0));l=h+4+15&-16}else l=0}else k[a+8>>2]=0;k[l+32>>2]=0;k[l+36>>2]=m;k[l+40>>2]=0;k[l>>2]=k[n+16>>2];k[l+4>>2]=k[n+16+4>>2];k[l+8>>2]=k[n+16+8>>2];k[l+12>>2]=k[n+16+12>>2];k[l+16>>2]=k[n+16+16>>2];k[l+20>>2]=k[n+16+20>>2];k[l+24>>2]=k[n+16+24>>2];k[l+28>>2]=k[n+16+28>>2];px(a+4|0,k[a+4>>2]|0,l);k[a+16>>2]=(k[a+16>>2]|0)+1;k[m+48>>2]=l;h=a+124+(k[a+144>>2]<<2)|0;k[g>>2]=0;k[e>>2]=k[h>>2];l=k[h>>2]|0;if(l)k[l+52>>2]=m;k[h>>2]=m;if(i[a+193>>0]|0){r=n;return m|0}k[n>>2]=17224;k[n+4>>2]=a;k[n+8>>2]=m;dx(k[a+4>>2]|0,n+16|0,n);dx(k[a+64>>2]|0,n+16|0,n);r=n;return m|0}function qv(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0;if((k[b+60>>2]|0)==2){e=k[b+48>>2]|0;ox(a+64|0,e)|0;d=k[a+68>>2]|0;if(d){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[a+68>>2]=e;k[a+76>>2]=(k[a+76>>2]|0)+-1}else{d=k[b+48>>2]|0;ox(a+4|0,d)|0;e=k[a+8>>2]|0;if(e){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0)}k[a+8>>2]=d;k[a+16>>2]=(k[a+16>>2]|0)+-1}e=k[b+52>>2]|0;d=k[b+56>>2]|0;if(!e)k[a+124+(k[b+60>>2]<<2)>>2]=d;else k[e+56>>2]=d;d=k[b+56>>2]|0;if(d)k[d+52>>2]=k[b+52>>2];e=k[a+136>>2]|0;yc[k[(k[e>>2]|0)+16>>2]&127](e,b,c);k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0);i[a+194>>0]=1;return}function rv(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;k[c>>2]=k[b+16>>2];k[c+4>>2]=k[b+16+4>>2];k[c+8>>2]=k[b+16+8>>2];k[c+12>>2]=k[b+16+12>>2];k[d>>2]=k[b+32>>2];k[d+4>>2]=k[b+32+4>>2];k[d+8>>2]=k[b+32+8>>2];k[d+12>>2]=k[b+32+12>>2];return}function sv(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;c=r;r=r+16|0;k[c>>2]=17144;k[c+4>>2]=d;lx(a+4|0,k[a+4>>2]|0,b,d+4|0,d+20|0,+o[d+32>>2],e,f,c);lx(a+64|0,k[a+64>>2]|0,b,d+4|0,d+20|0,+o[d+32>>2],e,f,c);r=c;return}function tv(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;e=r;r=r+48|0;k[e+32>>2]=17064;k[e+32+4>>2]=d;k[e>>2]=k[b>>2];k[e+4>>2]=k[b+4>>2];k[e+8>>2]=k[b+8>>2];k[e+12>>2]=k[b+12>>2];k[e+16>>2]=k[c>>2];k[e+16+4>>2]=k[c+4>>2];k[e+16+8>>2]=k[c+8>>2];k[e+16+12>>2]=k[c+12>>2];dx(k[a+4>>2]|0,e,e+32|0);dx(k[a+64>>2]|0,e,e+32|0);r=e;return}function uv(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0,E=0.0,F=0.0,G=0,H=0.0;G=r;r=r+16|0;x=+o[c>>2];A=+o[c+4>>2];B=+o[c+8>>2];F=+o[c+12>>2];y=+o[d>>2];z=+o[d+4>>2];C=+o[d+8>>2];E=+o[d+12>>2];do if((k[b+60>>2]|0)==2){g=k[b+48>>2]|0;ox(a+64|0,g)|0;e=k[a+68>>2]|0;if(e){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0)}k[a+68>>2]=g;k[a+76>>2]=(k[a+76>>2]|0)+-1;g=k[a+8>>2]|0;if(!g){k[5108]=(k[5108]|0)+1;g=iF(63)|0;if((g|0)!=0?(k[(g+4+15&-16)+-4>>2]=g,(g+4+15&-16|0)!=0):0){e=g+4+15&-16;f=e+44|0;do{k[e>>2]=0;e=e+4|0}while((e|0)<(f|0));g=g+4+15&-16}else g=0}else k[a+8>>2]=0;k[g+32>>2]=0;k[g+36>>2]=b;k[g+40>>2]=0;o[g>>2]=x;o[g+4>>2]=A;o[g+8>>2]=B;o[g+12>>2]=F;o[g+16>>2]=y;o[g+20>>2]=z;o[g+24>>2]=C;o[g+28>>2]=E;px(a+4|0,k[a+4>>2]|0,g);k[a+16>>2]=(k[a+16>>2]|0)+1;k[b+48>>2]=g;g=1}else{k[a+168>>2]=(k[a+168>>2]|0)+1;D=k[b+48>>2]|0;q=+o[D>>2];if(((((q<=y?(s=+o[D+16>>2],s>=x):0)?(t=+o[D+4>>2],t<=z):0)?(u=+o[D+20>>2],u>=A):0)?(v=+o[D+8>>2],v<=C):0)?(w=+o[D+24>>2],w>=B):0){H=+o[b+16>>2];l=+o[b+20>>2];j=+o[b+24>>2];p=+o[a+140>>2];m=(+o[b+32>>2]-H)*.5*p;n=p*((+o[b+36>>2]-l)*.5);p=p*((+o[b+40>>2]-j)*.5);if(x-H<0.0)m=-m;if(A-l<0.0)l=-n;else l=n;if(B-j<0.0)j=-p;else j=p;if(!(!(q<=x)|!(t<=A)|!(v<=B)|!(s>=y)|!(u>=z)|!(w>=C))){g=0;break}if(m>0.0){q=x+-.05000000074505806;p=m+(y+.05000000074505806)}else{q=m+(x+-.05000000074505806);p=y+.05000000074505806}if(l>0.0){n=l+(z+.05000000074505806);m=A+-.05000000074505806}else{n=z+.05000000074505806;m=l+(A+-.05000000074505806)}if(j>0.0){l=B+-.05000000074505806;j=j+(C+.05000000074505806)}else{l=j+(B+-.05000000074505806);j=C+.05000000074505806}g=ox(a+4|0,D)|0;a:do if(g){f=k[a+12>>2]|0;if((f|0)<=-1){g=k[a+4>>2]|0;break}if((f|0)>0){h=0;e=g;while(1){g=k[e+32>>2]|0;h=h+1|0;if(!g){g=e;break a}if((h|0)>=(f|0))break;else e=g}}}else g=0;while(0);o[D>>2]=q;o[D+4>>2]=m;o[D+8>>2]=l;o[D+12>>2]=F;o[D+16>>2]=p;o[D+20>>2]=n;o[D+24>>2]=j;o[D+28>>2]=E;px(a+4|0,g,D);k[a+172>>2]=(k[a+172>>2]|0)+1;g=1;break}g=ox(a+4|0,D)|0;b:do if(g){f=k[a+12>>2]|0;if((f|0)<=-1){g=k[a+4>>2]|0;break}if((f|0)>0){h=0;e=g;while(1){g=k[e+32>>2]|0;h=h+1|0;if(!g){g=e;break b}if((h|0)>=(f|0))break;else e=g}}}else g=0;while(0);o[D>>2]=x;o[D+4>>2]=A;o[D+8>>2]=B;o[D+12>>2]=F;o[D+16>>2]=y;o[D+20>>2]=z;o[D+24>>2]=C;o[D+28>>2]=E;px(a+4|0,g,D);k[a+172>>2]=(k[a+172>>2]|0)+1;g=1}while(0);e=k[b+52>>2]|0;f=k[b+56>>2]|0;if(!e)k[a+124+(k[b+60>>2]<<2)>>2]=f;else k[e+56>>2]=f;e=k[b+56>>2]|0;if(e)k[e+52>>2]=k[b+52>>2];k[b+16>>2]=k[c>>2];k[b+16+4>>2]=k[c+4>>2];k[b+16+8>>2]=k[c+8>>2];k[b+16+12>>2]=k[c+12>>2];k[b+32>>2]=k[d>>2];k[b+32+4>>2]=k[d+4>>2];k[b+32+8>>2]=k[d+8>>2];k[b+32+12>>2]=k[d+12>>2];f=k[a+144>>2]|0;k[b+60>>2]=f;k[b+52>>2]=0;k[b+56>>2]=k[a+124+(f<<2)>>2];e=k[a+124+(f<<2)>>2]|0;if(e)k[e+52>>2]=b;k[a+124+(f<<2)>>2]=b;if(!g){r=G;return}i[a+194>>0]=1;if(i[a+193>>0]|0){r=G;return}k[G>>2]=17224;k[G+4>>2]=a;mx(a+64|0,k[a+64>>2]|0,k[b+48>>2]|0,G);mx(a+4|0,k[a+4>>2]|0,k[b+48>>2]|0,G);r=G;return}function vv(a,b){a=a|0;b=b|0;var c=0,d=0,e=0.0,f=0,g=0,h=0,j=0,l=0,m=0,n=0,p=0,q=0;q=r;r=r+48|0;Mv(a+4|0,((ia(k[a+152>>2]|0,k[a+16>>2]|0)|0)/100|0)+1|0);if(k[a+164>>2]|0){n=((ia(k[a+148>>2]|0,k[a+76>>2]|0)|0)/100|0)+1|0;Mv(a+64|0,n);n=(k[a+164>>2]|0)-n|0;k[a+164>>2]=(n|0)<0?0:n}d=((k[a+144>>2]|0)+1|0)%2|0;k[a+144>>2]=d;d=k[a+124+(d<<2)>>2]|0;if(d){do{h=d+56|0;m=d;d=k[h>>2]|0;g=k[m+52>>2]|0;if(!g)k[a+124+(k[m+60>>2]<<2)>>2]=d;else k[g+56>>2]=d;g=k[h>>2]|0;if(g)k[g+52>>2]=k[m+52>>2];k[m+52>>2]=0;k[h>>2]=k[a+132>>2];c=k[a+132>>2]|0;if(c)k[c+52>>2]=m;k[a+132>>2]=m;g=k[m+48>>2]|0;ox(a+4|0,g)|0;h=k[a+8>>2]|0;if(h){k[5110]=(k[5110]|0)+1;jF(k[h+-4>>2]|0)}k[a+8>>2]=g;k[a+16>>2]=(k[a+16>>2]|0)+-1;k[q+16>>2]=k[m+16>>2];k[q+16+4>>2]=k[m+16+4>>2];k[q+16+8>>2]=k[m+16+8>>2];k[q+16+12>>2]=k[m+16+12>>2];k[q+16+16>>2]=k[m+32>>2];k[q+16+16+4>>2]=k[m+32+4>>2];k[q+16+16+8>>2]=k[m+32+8>>2];k[q+16+16+12>>2]=k[m+32+12>>2];c=k[a+68>>2]|0;if(!c){k[5108]=(k[5108]|0)+1;g=iF(63)|0;if((g|0)!=0?(k[(g+4+15&-16)+-4>>2]=g,(g+4+15&-16|0)!=0):0){h=g+4+15&-16;c=h+44|0;do{k[h>>2]=0;h=h+4|0}while((h|0)<(c|0));c=g+4+15&-16}else c=0}else k[a+68>>2]=0;k[c+32>>2]=0;k[c+36>>2]=m;k[c+40>>2]=0;k[c>>2]=k[q+16>>2];k[c+4>>2]=k[q+16+4>>2];k[c+8>>2]=k[q+16+8>>2];k[c+12>>2]=k[q+16+12>>2];k[c+16>>2]=k[q+16+16>>2];k[c+20>>2]=k[q+16+20>>2];k[c+24>>2]=k[q+16+24>>2];k[c+28>>2]=k[q+16+28>>2];px(a+64|0,k[a+64>>2]|0,c);g=(k[a+76>>2]|0)+1|0;k[a+76>>2]=g;k[m+48>>2]=c;k[m+60>>2]=2}while((d|0)!=0);k[a+164>>2]=g;i[a+194>>0]=1}k[q>>2]=17224;k[q+4>>2]=a;if((i[a+193>>0]|0)!=0?(mx(a+4|0,k[a+4>>2]|0,k[a+64>>2]|0,q),(i[a+193>>0]|0)!=0):0){n=k[a+4>>2]|0;mx(a+4|0,n,n,q)}do if((i[a+194>>0]|0)!=0?(l=k[a+136>>2]|0,l=Wb[k[(k[l>>2]|0)+28>>2]&127](l)|0,f=k[l+4>>2]|0,(f|0)>0):0){d=(ia(k[a+156>>2]|0,f)|0)/100|0;n=k[a+160>>2]|0;d=(n|0)>(d|0)?n:d;d=(f|0)<(d|0)?f:d;if((d|0)>0){c=0;do{h=((k[a+184>>2]|0)+c|0)%(f|0)|0;m=k[l+12>>2]|0;g=k[m+(h<<4)>>2]|0;h=k[m+(h<<4)+4>>2]|0;m=k[g+48>>2]|0;n=k[h+48>>2]|0;if(!(((((+o[m>>2]<=+o[n+16>>2]?+o[m+16>>2]>=+o[n>>2]:0)?+o[m+4>>2]<=+o[n+20>>2]:0)?+o[m+20>>2]>=+o[n+4>>2]:0)?+o[m+8>>2]<=+o[n+24>>2]:0)?+o[m+24>>2]>=+o[n+8>>2]:0)){f=k[a+136>>2]|0;_b[k[(k[f>>2]|0)+12>>2]&31](f,g,h,b)|0;f=k[l+4>>2]|0;c=c+-1|0;d=d+-1|0}c=c+1|0}while((c|0)<(d|0));if((f|0)<=0){k[a+184>>2]=0;break}}k[a+184>>2]=((k[a+184>>2]|0)+d|0)%(f|0)|0}while(0);k[a+180>>2]=(k[a+180>>2]|0)+1;k[a+160>>2]=1;i[a+194>>0]=0;c=k[a+168>>2]|0;d=k[a+172>>2]|0;if(!c)e=0.0;else e=+(d>>>0)/+(c>>>0);o[a+176>>2]=e;k[a+172>>2]=d>>>1;k[a+168>>2]=c>>>1;n=k[a+136>>2]|0;if(!(Wb[k[(k[n>>2]|0)+56>>2]&127](n)|0)){r=q;return}n=k[a+136>>2]|0;n=Wb[k[(k[n>>2]|0)+28>>2]&127](n)|0;d=k[n+4>>2]|0;if((d|0)>1){kx(n,0,d+-1|0);f=0;g=0;h=0;c=0;p=44}else{g=0;f=0;h=0;c=0}while(1){if((p|0)==44)d=k[n+4>>2]|0;if((h|0)>=(d|0))break;m=k[n+12>>2]|0;l=m+(h<<4)|0;d=k[l>>2]|0;m=m+(h<<4)+4|0;j=k[m>>2]|0;if((d|0)==(g|0))if((j|0)==(f|0))p=54;else p=48;else{g=d;p=48}if((p|0)==48){p=0;d=k[d+48>>2]|0;f=k[j+48>>2]|0;if(((((+o[d>>2]<=+o[f+16>>2]?+o[d+16>>2]>=+o[f>>2]:0)?+o[d+4>>2]<=+o[f+20>>2]:0)?+o[d+20>>2]>=+o[f+4>>2]:0)?+o[d+8>>2]<=+o[f+24>>2]:0)?+o[d+24>>2]>=+o[f+8>>2]:0){f=j;d=c}else{f=j;p=54}}if((p|0)==54){d=k[a+136>>2]|0;yc[k[(k[d>>2]|0)+32>>2]&127](d,l,b);k[l>>2]=0;k[m>>2]=0;d=c+1|0}h=h+1|0;c=d;p=44}if((d|0)>1){kx(n,0,d+-1|0);g=k[n+4>>2]|0}else g=d;j=g-c|0;if((c|0)<0){if((k[n+8>>2]|0)<(j|0)){if((g|0)!=(c|0)){k[5108]=(k[5108]|0)+1;c=iF((j<<4|3)+16|0)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}d=k[n+4>>2]|0;if((d|0)>0){f=0;while(1){p=k[n+12>>2]|0;k[c+(f<<4)>>2]=k[p+(f<<4)>>2];k[c+(f<<4)+4>>2]=k[p+(f<<4)+4>>2];k[c+(f<<4)+8>>2]=k[p+(f<<4)+8>>2];k[c+(f<<4)+12>>2]=k[p+(f<<4)+12>>2];if((f|0)==(d+-1|0)){d=n+12|0;break}else f=f+1|0}}else d=n+12|0}else{c=0;d=n+12|0}f=k[d>>2]|0;if(f){if(i[n+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[f+-4>>2]|0)}k[d>>2]=0}i[n+16>>0]=1;k[d>>2]=c;k[n+8>>2]=j}else d=n+12|0;c=g;while(1){p=(k[d>>2]|0)+(c<<4)|0;k[p>>2]=0;k[p+4>>2]=0;k[p+8>>2]=0;k[p+12>>2]=0;if((c|0)==(j+-1|0))break;else c=c+1|0}}k[n+4>>2]=j;r=q;return}function wv(a){a=a|0;return k[a+136>>2]|0}function xv(a){a=a|0;return k[a+136>>2]|0}function yv(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0,n=0.0,p=0.0,q=0.0,r=0.0;m=k[a+4>>2]|0;a=k[a+64>>2]|0;do if(!m)if(!a){d=0.0;l=0.0;f=0.0;j=0.0;i=0.0;h=0.0;g=0.0;e=0.0}else{d=+o[a>>2];l=+o[a+4>>2];f=+o[a+8>>2];j=+o[a+12>>2];i=+o[a+16>>2];h=+o[a+20>>2];g=+o[a+24>>2];e=+o[a+28>>2]}else{d=+o[m>>2];e=+o[m+4>>2];f=+o[m+8>>2];i=+o[m+16>>2];h=+o[m+20>>2];g=+o[m+24>>2];if(!a){l=e;j=+o[m+12>>2];e=+o[m+28>>2];break}else{r=+o[a>>2];q=+o[a+16>>2];l=+o[a+4>>2];p=+o[a+20>>2];j=+o[a+8>>2];n=+o[a+24>>2];d=d<r?d:r;l=e<l?e:l;f=f<j?f:j;j=0.0;i=i>q?i:q;h=h>p?h:p;g=g>n?g:n;e=0.0;break}}while(0);o[b>>2]=d;o[b+4>>2]=l;o[b+8>>2]=f;o[b+12>>2]=j;o[c>>2]=i;o[c+4>>2]=h;o[c+8>>2]=g;o[c+12>>2]=e;return}function zv(a,b){a=a|0;b=b|0;if((k[a+16>>2]|0)!=(0-(k[a+76>>2]|0)|0))return;b=k[a+4>>2]|0;if(b)nx(a+4|0,b);b=k[a+8>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+8>>2]=0;k[a+12>>2]=-1;b=k[a+36>>2]|0;if(b){if(i[a+40>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+36>>2]=0}i[a+40>>0]=1;k[a+36>>2]=0;k[a+28>>2]=0;k[a+32>>2]=0;k[a+20>>2]=0;b=k[a+64>>2]|0;if(b)nx(a+64|0,b);b=k[a+68>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+68>>2]=0;k[a+72>>2]=-1;b=k[a+96>>2]|0;if(b){if(i[a+100>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+96>>2]=0}i[a+100>>0]=1;k[a+96>>2]=0;k[a+88>>2]=0;k[a+92>>2]=0;k[a+80>>2]=0;i[a+193>>0]=0;i[a+194>>0]=1;k[a+144>>2]=0;k[a+164>>2]=0;k[a+148>>2]=1;k[a+152>>2]=0;k[a+156>>2]=10;k[a+160>>2]=1;k[a+124>>2]=0;k[a+124+4>>2]=0;k[a+124+8>>2]=0;k[a+168>>2]=0;k[a+168+4>>2]=0;k[a+168+8>>2]=0;k[a+168+12>>2]=0;k[a+168+16>>2]=0;k[a+168+20>>2]=0;return}function Av(a){a=a|0;return}function Bv(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0,g=0.0,h=0.0,l=0,n=0.0,p=0,q=0,s=0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0,z=0,A=0,B=0,C=0.0,D=0.0,E=0.0,F=0,G=0,H=0,I=0,J=0,K=0,L=0.0,M=0.0,N=0.0;K=r;r=r+128|0;H=k[a+56>>2]|0;if((c-b|0)==1){if(!(i[a+60>>0]|0)){p=(k[a+96>>2]|0)+(H<<6)|0;q=(k[a+76>>2]|0)+(b<<6)|0;s=p+64|0;do{k[p>>2]=k[q>>2];p=p+4|0;q=q+4|0}while((p|0)<(s|0))}else{I=(k[a+136>>2]|0)+(H<<4)|0;c=(k[a+116>>2]|0)+(b<<4)|0;k[I>>2]=k[c>>2];k[I+4>>2]=k[c+4>>2];k[I+8>>2]=k[c+8>>2];k[I+12>>2]=k[c+12>>2]}k[a+56>>2]=(k[a+56>>2]|0)+1;r=K;return}if((c|0)>(b|0)){y=(i[a+60>>0]|0)==0;t=0.0;w=0.0;x=0.0;s=b;while(1){if(y){A=k[a+76>>2]|0;u=+o[A+(s<<6)+16>>2];h=+o[A+(s<<6)>>2];g=+o[A+(s<<6)+20>>2];n=+o[A+(s<<6)+4>>2];e=+o[A+(s<<6)+24>>2];v=+o[A+(s<<6)+8>>2]}else{A=k[a+116>>2]|0;g=+o[a+36>>2];e=+o[a+40>>2];E=+o[a+44>>2];h=+o[a+4>>2];n=+o[a+8>>2];v=+o[a+12>>2];u=+(m[A+(s<<4)+6>>1]|0)/g+h;h=+(m[A+(s<<4)>>1]|0)/g+h;g=+(m[A+(s<<4)+8>>1]|0)/e+n;n=+(m[A+(s<<4)+2>>1]|0)/e+n;e=+(m[A+(s<<4)+10>>1]|0)/E+v;v=+(m[A+(s<<4)+4>>1]|0)/E+v}t=t+(u+h)*.5;w=w+(g+n)*.5;x=x+(e+v)*.5;if((s|0)==(c+-1|0))break;else s=s+1|0}C=1.0/+(c-b|0);E=t*C;D=w*C;C=x*C;if(y){s=k[a+76>>2]|0;e=0.0;n=0.0;t=0.0;q=b;while(1){h=(+o[s+(q<<6)+16>>2]+ +o[s+(q<<6)>>2])*.5-E;u=(+o[s+(q<<6)+20>>2]+ +o[s+(q<<6)+4>>2])*.5-D;w=(+o[s+(q<<6)+24>>2]+ +o[s+(q<<6)+8>>2])*.5-C;e=e+h*h;n=n+u*u;t=t+w*w;if((q|0)==(c+-1|0)){g=+(c-b|0);break}else q=q+1|0}}else{y=k[a+116>>2]|0;w=+o[a+36>>2];u=+o[a+40>>2];h=+o[a+44>>2];x=+o[a+4>>2];g=+o[a+8>>2];v=+o[a+12>>2];e=0.0;n=0.0;t=0.0;s=b;while(1){N=(+(m[y+(s<<4)+6>>1]|0)/w+x+(+(m[y+(s<<4)>>1]|0)/w+x))*.5-E;M=(+(m[y+(s<<4)+8>>1]|0)/u+g+(+(m[y+(s<<4)+2>>1]|0)/u+g))*.5-D;L=(+(m[y+(s<<4)+10>>1]|0)/h+v+(+(m[y+(s<<4)+4>>1]|0)/h+v))*.5-C;e=e+N*N;n=n+M*M;t=t+L*L;if((s|0)==(c+-1|0)){g=+(c-b|0);break}else s=s+1|0}}}else{t=0.0;n=0.0;e=0.0;g=+(c-b|0)}M=1.0/(g+-1.0);h=e*M;g=n*M;e=t*M;if(h<g)q=g<e?2:1;else q=h<e?2:0;k[K+16>>2]=0;k[K+16+4>>2]=0;k[K+16+8>>2]=0;k[K+16+12>>2]=0;if((c|0)>(b|0)){s=(i[a+60>>0]|0)==0;e=0.0;h=0.0;g=0.0;y=b;while(1){if(s){A=k[a+76>>2]|0;w=+o[A+(y<<6)+16>>2];u=+o[A+(y<<6)>>2];t=+o[A+(y<<6)+20>>2];n=+o[A+(y<<6)+4>>2];v=+o[A+(y<<6)+24>>2];x=+o[A+(y<<6)+8>>2]}else{A=k[a+116>>2]|0;t=+o[a+36>>2];v=+o[a+40>>2];M=+o[a+44>>2];u=+o[a+4>>2];n=+o[a+8>>2];x=+o[a+12>>2];w=+(m[A+(y<<4)+6>>1]|0)/t+u;u=+(m[A+(y<<4)>>1]|0)/t+u;t=+(m[A+(y<<4)+8>>1]|0)/v+n;n=+(m[A+(y<<4)+2>>1]|0)/v+n;v=+(m[A+(y<<4)+10>>1]|0)/M+x;x=+(m[A+(y<<4)+4>>1]|0)/M+x}e=e+(w+u)*.5;h=(t+n)*.5+h;g=(v+x)*.5+g;if((y|0)==(c+-1|0))break;else y=y+1|0}o[K+16>>2]=e;o[K+16+4>>2]=h;o[K+16+8>>2]=g}else{e=0.0;h=0.0;g=0.0}o[K+16>>2]=1.0/+(c-b|0)*e;o[K+16+4>>2]=1.0/+(c-b|0)*h;o[K+16+8>>2]=1.0/+(c-b|0)*g;w=+o[K+16+(q<<2)>>2];if((c|0)>(b|0)){y=K+(q<<2)|0;z=b;d=b;while(1){s=(i[a+60>>0]|0)==0;if(s){A=k[a+76>>2]|0;t=+o[A+(z<<6)+16>>2];h=+o[A+(z<<6)>>2];g=+o[A+(z<<6)+20>>2];n=+o[A+(z<<6)+4>>2];e=+o[A+(z<<6)+24>>2];u=+o[A+(z<<6)+8>>2]}else{A=k[a+116>>2]|0;g=+o[a+36>>2];e=+o[a+40>>2];M=+o[a+44>>2];h=+o[a+4>>2];n=+o[a+8>>2];u=+o[a+12>>2];t=+(m[A+(z<<4)+6>>1]|0)/g+h;h=+(m[A+(z<<4)>>1]|0)/g+h;g=+(m[A+(z<<4)+8>>1]|0)/e+n;n=+(m[A+(z<<4)+2>>1]|0)/e+n;e=+(m[A+(z<<4)+10>>1]|0)/M+u;u=+(m[A+(z<<4)+4>>1]|0)/M+u}o[K>>2]=(t+h)*.5;o[K+4>>2]=(g+n)*.5;o[K+8>>2]=(e+u)*.5;o[K+12>>2]=0.0;if(+o[y>>2]>w){if(s){f=k[a+76>>2]|0;l=f+(z<<6)|0;p=K+32|0;q=l;s=p+64|0;do{k[p>>2]=k[q>>2];p=p+4|0;q=q+4|0}while((p|0)<(s|0));p=l;q=f+(d<<6)|0;s=p+64|0;do{k[p>>2]=k[q>>2];p=p+4|0;q=q+4|0}while((p|0)<(s|0));p=(k[a+76>>2]|0)+(d<<6)|0;q=K+32|0;s=p+64|0;do{k[p>>2]=k[q>>2];p=p+4|0;q=q+4|0}while((p|0)<(s|0))}else{s=k[a+116>>2]|0;A=s+(z<<4)|0;k[K+96>>2]=k[A>>2];k[K+96+4>>2]=k[A+4>>2];k[K+96+8>>2]=k[A+8>>2];k[K+96+12>>2]=k[A+12>>2];s=s+(d<<4)|0;k[A>>2]=k[s>>2];k[A+4>>2]=k[s+4>>2];k[A+8>>2]=k[s+8>>2];k[A+12>>2]=k[s+12>>2];A=(k[a+116>>2]|0)+(d<<4)|0;k[A>>2]=k[K+96>>2];k[A+4>>2]=k[K+96+4>>2];k[A+8>>2]=k[K+96+8>>2];k[A+12>>2]=k[K+96+12>>2]}d=d+1|0}if((z|0)==(c+-1|0))break;else z=z+1|0}}else d=b;if(!((d|0)>(((c-b|0)/3|0)+b|0)?(d|0)<(c+-1-((c-b|0)/3|0)|0):0))d=(c-b>>1)+b|0;G=k[a+56>>2]|0;if(!(i[a+60>>0]|0)){A=(k[a+96>>2]|0)+(G<<6)|0;k[A>>2]=k[a+20>>2];k[A+4>>2]=k[a+20+4>>2];k[A+8>>2]=k[a+20+8>>2];k[A+12>>2]=k[a+20+12>>2]}else{A=k[a+136>>2]|0;L=(+o[a+24>>2]-+o[a+8>>2])*+o[a+40>>2];M=(+o[a+28>>2]-+o[a+12>>2])*+o[a+44>>2];j[A+(G<<4)>>1]=~~((+o[a+20>>2]-+o[a+4>>2])*+o[a+36>>2])&65534;j[A+(G<<4)+2>>1]=~~L&65534;j[A+(G<<4)+4>>1]=~~M&65534}f=k[a+56>>2]|0;if(!(i[a+60>>0]|0)){A=(k[a+96>>2]|0)+(f<<6)+16|0;k[A>>2]=k[a+4>>2];k[A+4>>2]=k[a+4+4>>2];k[A+8>>2]=k[a+4+8>>2];k[A+12>>2]=k[a+4+12>>2]}else{A=k[a+136>>2]|0;E=+o[a+4>>2];L=+o[a+8>>2];M=+o[a+12>>2];L=(L-L)*+o[a+40>>2];M=(M-M)*+o[a+44>>2];j[A+(f<<4)+6>>1]=~~((E-E)*+o[a+36>>2]+1.0)&65535|1;j[A+(f<<4)+8>>1]=~~(L+1.0)&65535|1;j[A+(f<<4)+10>>1]=~~(M+1.0)&65535|1}F=k[a+56>>2]|0;if((c|0)>(b|0)){A=i[a+60>>0]|0;B=b;while(1){do if(A<<24>>24){q=k[a+116>>2]|0;g=+o[a+36>>2];N=+o[a+40>>2];D=+o[a+44>>2];x=+o[a+4>>2];u=+o[a+8>>2];E=+o[a+12>>2];h=+o[a+4>>2];w=+o[a+8>>2];L=+o[a+12>>2];t=+o[a+36>>2];C=+o[a+40>>2];M=+o[a+44>>2];p=~~((+(m[q+(B<<4)>>1]|0)/g+x-h)*t)&65534;f=~~((+(m[q+(B<<4)+2>>1]|0)/N+u-w)*C)&65534;s=~~((+(m[q+(B<<4)+4>>1]|0)/D+E-L)*M)&65534;l=(~~((+(m[q+(B<<4)+6>>1]|0)/g+x-h)*t+1.0)&65535|1)&65535;y=(~~((+(m[q+(B<<4)+8>>1]|0)/N+u-w)*C+1.0)&65535|1)&65535;q=(~~((+(m[q+(B<<4)+10>>1]|0)/D+E-L)*M+1.0)&65535|1)&65535;z=k[a+136>>2]|0;if((m[z+(F<<4)>>1]|0)>(p&65535))j[z+(F<<4)>>1]=p;if((m[z+(F<<4)+6>>1]|0)<(l&65535))j[z+(F<<4)+6>>1]=l;if((m[z+(F<<4)+2>>1]|0)>(f&65535))j[z+(F<<4)+2>>1]=f;if((m[z+(F<<4)+8>>1]|0)<(y&65535))j[z+(F<<4)+8>>1]=y;if((m[z+(F<<4)+4>>1]|0)>(s&65535))j[z+(F<<4)+4>>1]=s;if((m[z+(F<<4)+10>>1]|0)<(q&65535))j[z+(F<<4)+10>>1]=q}else{y=k[a+76>>2]|0;w=+o[y+(B<<6)>>2];u=+o[y+(B<<6)+4>>2];t=+o[y+(B<<6)+8>>2];h=+o[y+(B<<6)+12>>2];x=+o[y+(B<<6)+16>>2];g=+o[y+(B<<6)+20>>2];n=+o[y+(B<<6)+24>>2];v=+o[y+(B<<6)+28>>2];y=k[a+96>>2]|0;if(w<+o[y+(F<<6)>>2])o[y+(F<<6)>>2]=w;if(u<+o[y+(F<<6)+4>>2])o[y+(F<<6)+4>>2]=u;if(t<+o[y+(F<<6)+8>>2])o[y+(F<<6)+8>>2]=t;if(h<+o[y+(F<<6)+12>>2])o[y+(F<<6)+12>>2]=h;if(+o[y+(F<<6)+16>>2]<x)o[y+(F<<6)+16>>2]=x;if(+o[y+(F<<6)+20>>2]<g)o[y+(F<<6)+20>>2]=g;if(+o[y+(F<<6)+24>>2]<n)o[y+(F<<6)+24>>2]=n;if(!(+o[y+(F<<6)+28>>2]<v))break;o[y+(F<<6)+28>>2]=v}while(0);if((B|0)==(c+-1|0))break;else B=B+1|0}}k[a+56>>2]=F+1;Bv(a,b,d);z=k[a+56>>2]|0;Bv(a,d,c);p=(k[a+56>>2]|0)-H|0;d=i[a+60>>0]|0;if(d<<24>>24!=0&(p<<4|0)>2048){A=k[a+136>>2]|0;y=k[A+(F+1<<4)+12>>2]|0;y=(y|0)>-1?1:0-y|0;B=k[A+(z<<4)+12>>2]|0;B=(B|0)>-1?1:0-B|0;if((y<<4|0)<2049){s=k[a+152>>2]|0;if((s|0)==(k[a+156>>2]|0)?(I=(s|0)==0?1:s<<1,(s|0)<(I|0)):0){if(!I){f=0;l=s}else{k[5108]=(k[5108]|0)+1;f=iF(I<<5|19)|0;if(!f)f=0;else{k[(f+4+15&-16)+-4>>2]=f;f=f+4+15&-16}l=k[a+152>>2]|0}if((l|0)>0){l=l+-1|0;d=0;while(1){c=f+(d<<5)|0;b=(k[a+160>>2]|0)+(d<<5)|0;k[c>>2]=k[b>>2];k[c+4>>2]=k[b+4>>2];k[c+8>>2]=k[b+8>>2];k[c+12>>2]=k[b+12>>2];k[c+16>>2]=k[b+16>>2];k[c+20>>2]=k[b+20>>2];k[c+24>>2]=k[b+24>>2];k[c+28>>2]=k[b+28>>2];if((d|0)==(l|0))break;else d=d+1|0}}l=k[a+160>>2]|0;if(l){if(i[a+164>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[l+-4>>2]|0)}k[a+160>>2]=0}i[a+164>>0]=1;k[a+160>>2]=f;k[a+156>>2]=I;f=k[a+152>>2]|0}else f=s;k[a+152>>2]=f+1;I=(k[a+160>>2]|0)+(s<<5)|0;k[I>>2]=k[K+96>>2];k[I+4>>2]=k[K+96+4>>2];k[I+8>>2]=k[K+96+8>>2];k[I+12>>2]=k[K+96+12>>2];k[I+16>>2]=k[K+96+16>>2];k[I+20>>2]=k[K+96+20>>2];k[I+24>>2]=k[K+96+24>>2];k[I+28>>2]=k[K+96+28>>2];I=k[a+160>>2]|0;j[I+(s<<5)>>1]=j[A+(F+1<<4)>>1]|0;j[I+(s<<5)+2>>1]=j[A+(F+1<<4)+2>>1]|0;j[I+(s<<5)+4>>1]=j[A+(F+1<<4)+4>>1]|0;j[I+(s<<5)+6>>1]=j[A+(F+1<<4)+6>>1]|0;j[I+(s<<5)+8>>1]=j[A+(F+1<<4)+8>>1]|0;j[I+(s<<5)+10>>1]=j[A+(F+1<<4)+10>>1]|0;k[I+(s<<5)+12>>2]=F+1;k[I+(s<<5)+16>>2]=y;s=a+152|0}else s=a+152|0;if((B<<4|0)<2049){q=k[s>>2]|0;if((q|0)==(k[a+156>>2]|0)?(J=(q|0)==0?1:q<<1,(q|0)<(J|0)):0){if(!J){f=0;d=q}else{k[5108]=(k[5108]|0)+1;f=iF(J<<5|19)|0;if(!f)f=0;else{k[(f+4+15&-16)+-4>>2]=f;f=f+4+15&-16}d=k[s>>2]|0}if((d|0)>0){d=d+-1|0;l=0;while(1){I=f+(l<<5)|0;c=(k[a+160>>2]|0)+(l<<5)|0;k[I>>2]=k[c>>2];k[I+4>>2]=k[c+4>>2];k[I+8>>2]=k[c+8>>2];k[I+12>>2]=k[c+12>>2];k[I+16>>2]=k[c+16>>2];k[I+20>>2]=k[c+20>>2];k[I+24>>2]=k[c+24>>2];k[I+28>>2]=k[c+28>>2];if((l|0)==(d|0))break;else l=l+1|0}}d=k[a+160>>2]|0;if(d){if(i[a+164>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[a+160>>2]=0}i[a+164>>0]=1;k[a+160>>2]=f;k[a+156>>2]=J;f=k[s>>2]|0}else f=q;k[s>>2]=f+1;I=(k[a+160>>2]|0)+(q<<5)|0;k[I>>2]=k[K+32>>2];k[I+4>>2]=k[K+32+4>>2];k[I+8>>2]=k[K+32+8>>2];k[I+12>>2]=k[K+32+12>>2];k[I+16>>2]=k[K+32+16>>2];k[I+20>>2]=k[K+32+20>>2];k[I+24>>2]=k[K+32+24>>2];k[I+28>>2]=k[K+32+28>>2];I=k[a+160>>2]|0;j[I+(q<<5)>>1]=j[A+(z<<4)>>1]|0;j[I+(q<<5)+2>>1]=j[A+(z<<4)+2>>1]|0;j[I+(q<<5)+4>>1]=j[A+(z<<4)+4>>1]|0;j[I+(q<<5)+6>>1]=j[A+(z<<4)+6>>1]|0;j[I+(q<<5)+8>>1]=j[A+(z<<4)+8>>1]|0;j[I+(q<<5)+10>>1]=j[A+(z<<4)+10>>1]|0;k[I+(q<<5)+12>>2]=z;k[I+(q<<5)+16>>2]=B}k[a+168>>2]=k[s>>2];d=i[a+60>>0]|0}if(!(d<<24>>24)){k[(k[a+96>>2]|0)+(G<<6)+32>>2]=p;r=K;return}else{k[(k[a+136>>2]|0)+(G<<4)+12>>2]=0-p;r=K;return}}function Cv(a){a=a|0;var b=0;k[a>>2]=17328;b=k[a+160>>2]|0;if(b){if(i[a+164>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+160>>2]=0}i[a+164>>0]=1;k[a+160>>2]=0;k[a+152>>2]=0;k[a+156>>2]=0;b=k[a+136>>2]|0;if(b){if(i[a+140>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+136>>2]=0}i[a+140>>0]=1;k[a+136>>2]=0;k[a+128>>2]=0;k[a+132>>2]=0;b=k[a+116>>2]|0;if(b){if(i[a+120>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+116>>2]=0}i[a+120>>0]=1;k[a+116>>2]=0;k[a+108>>2]=0;k[a+112>>2]=0;b=k[a+96>>2]|0;if(b){if(i[a+100>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+96>>2]=0}i[a+100>>0]=1;k[a+96>>2]=0;k[a+88>>2]=0;k[a+92>>2]=0;b=k[a+76>>2]|0;if(!b){i[a+80>>0]=1;k[a+76>>2]=0;k[a+68>>2]=0;a=a+72|0;k[a>>2]=0;return}if(i[a+80>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+76>>2]=0;i[a+80>>0]=1;k[a+76>>2]=0;k[a+68>>2]=0;a=a+72|0;k[a>>2]=0;return}function Dv(a){a=a|0;Cv(a);if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function Ev(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0;while(1){e=k[a+12>>2]|0;if(!(((m[d>>1]|0)>=(m[a>>1]|0)?(m[c>>1]|0)<=(m[a+6>>1]|0):0)&(m[c+4>>1]|0)<=(m[a+10>>1]|0)&(m[d+4>>1]|0)>=(m[a+4>>1]|0)&(m[c+2>>1]|0)<=(m[a+8>>1]|0)&(m[d+2>>1]|0)>=(m[a+2>>1]|0))){f=8;break}if((e|0)>-1)break;Ev(a+16|0,b,c,d);e=k[a+28>>2]|0;if((e|0)>-1){a=a+32|0;continue}else{a=a+(1-e<<4)|0;continue}}if((f|0)==8)return;yc[k[(k[b>>2]|0)+8>>2]&127](b,e>>21,e&2097151);return}function Fv(a,b,c,d,e,f,g,h){a=a|0;b=b|0;c=c|0;d=+d;e=+e;f=+f;g=g|0;h=h|0;var i=0,j=0,l=0,m=0.0,n=0,p=0.0,q=0,s=0.0,t=0.0,u=0.0,v=0,w=0.0,x=0,y=0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0,Q=0.0,R=0.0,S=0.0,T=0,U=0,V=0,W=0.0,X=0;X=r;r=r+32|0;G=+o[c>>2];N=+o[c+4>>2];P=+o[c+8>>2];w=+o[g>>2];H=(G>d?d:G)+w;m=+o[g+4>>2];I=(N>e?e:N)+m;p=+o[g+8>>2];J=(P>f?f:P)+p;s=+o[h>>2];K=(G<d?d:G)+s;t=+o[h+4>>2];L=(N<e?e:N)+t;u=+o[h+8>>2];M=(P<f?f:P)+u;O=1.0/+Y(+((d-G)*(d-G)+(e-N)*(e-N)+(f-P)*(f-P)));if((d-G)*O==0.0)Q=999999984306749440.0;else Q=1.0/((d-G)*O);if((e-N)*O==0.0)R=999999984306749440.0;else R=1.0/((e-N)*O);if((f-P)*O==0.0)S=999999984306749440.0;else S=1.0/((f-P)*O);T=Q<0.0&1;U=R<0.0&1;V=S<0.0&1;j=k[a+56>>2]|0;a:do if((j|0)>0){x=0;y=k[a+96>>2]|0;i=0;while(1){i=i+1|0;k[X>>2]=k[y>>2];k[X+4>>2]=k[y+4>>2];k[X+8>>2]=k[y+8>>2];k[X+12>>2]=k[y+12>>2];v=y+16|0;k[X+16>>2]=k[v>>2];k[X+16+4>>2]=k[v+4>>2];k[X+16+8>>2]=k[v+8>>2];k[X+16+12>>2]=k[v+12>>2];o[X>>2]=+o[X>>2]-s;o[X+4>>2]=+o[X+4>>2]-t;o[X+8>>2]=+o[X+8>>2]-u;o[X+16>>2]=+o[X+16>>2]-w;o[X+20>>2]=+o[X+20>>2]-m;o[X+24>>2]=+o[X+24>>2]-p;if(!(H>+o[v>>2])?!(K<+o[y>>2]):0)l=1;else l=0;if(!(!(J>+o[y+24>>2])?!(M<+o[y+8>>2]):0))l=0;if((((!(I>+o[y+20>>2])?!(L<+o[y+4>>2]|l^1):0)?(A=+o[c>>2],z=Q*(+o[X+(T<<4)>>2]-A),A=Q*(+o[X+((T^1)<<4)>>2]-A),C=+o[c+4>>2],B=R*(+o[X+(U<<4)+4>>2]-C),C=R*(+o[X+((U^1)<<4)+4>>2]-C),!(B>A|z>C)):0)?(D=B>z?B:z,W=C<A?C:A,F=+o[c+8>>2],E=S*(+o[X+(V<<4)+8>>2]-F),F=S*(+o[X+((V^1)<<4)+8>>2]-F),!(E>W|D>F)):0)?(E>D?E:D)<(f-P)*((f-P)*O)+((d-G)*((d-G)*O)+(e-N)*((e-N)*O)):0){l=(F<W?F:W)>0.0;n=k[y+32>>2]|0;if(l&(n|0)==-1){yc[k[(k[b>>2]|0)+8>>2]&127](b,k[y+36>>2]|0,k[y+40>>2]|0);j=k[a+56>>2]|0;v=24}else{q=(n|0)==-1;v=23}}else{n=k[y+32>>2]|0;q=(n|0)==-1;l=0;v=23}if((v|0)==23){v=0;if(q|l)v=24;else{l=n+x|0;n=y+(n<<6)|0}}if((v|0)==24){l=x+1|0;n=y+64|0}if((l|0)>=(j|0))break a;m=+o[g+4>>2];p=+o[g+8>>2];s=+o[h>>2];t=+o[h+4>>2];u=+o[h+8>>2];w=+o[g>>2];x=l;y=n}}else i=0;while(0);if((k[4340]|0)>=(i|0)){r=X;return}k[4340]=i;r=X;return}function Gv(a,b,c,d,e,f,g,h,i){a=a|0;b=b|0;c=c|0;d=+d;e=+e;f=+f;g=g|0;h=h|0;i=i|0;var l=0,n=0,p=0,q=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,P=0,Q=0.0,R=0,S=0.0,T=0,U=0.0,V=0.0,W=0.0,X=0,Z=0.0,_=0.0,$=0.0,aa=0.0,ba=0.0,ca=0.0,da=0.0,ea=0.0,fa=0.0,ga=0.0,ha=0.0,ia=0.0,ja=0.0,ka=0.0,la=0.0;X=r;r=r+32|0;G=+o[c>>2];U=+o[c+4>>2];V=+o[c+8>>2];F=1.0/+Y(+((d-G)*(d-G)+(e-U)*(e-U)+(f-V)*(f-V)));if((d-G)*F==0.0)O=999999984306749440.0;else O=1.0/((d-G)*F);if((e-U)*F==0.0)Q=999999984306749440.0;else Q=1.0/((e-U)*F);if((f-V)*F==0.0)S=999999984306749440.0;else S=1.0/((f-V)*F);P=O<0.0&1;R=Q<0.0&1;T=S<0.0&1;la=(G>d?d:G)+ +o[g>>2];ka=(U>e?e:U)+ +o[g+4>>2];ja=(V>f?f:V)+ +o[g+8>>2];ha=(G<d?d:G)+ +o[h>>2];da=(U<e?e:U)+ +o[h+4>>2];$=(V<f?f:V)+ +o[h+8>>2];ga=+o[a+4>>2];la=la<ga?ga:la;ca=+o[a+8>>2];ka=ka<ca?ca:ka;_=+o[a+12>>2];ja=ja<_?_:ja;ia=+o[a+20>>2];ea=+o[a+24>>2];aa=+o[a+28>>2];fa=+o[a+36>>2];ba=+o[a+40>>2];Z=+o[a+44>>2];B=~~(((ia<la?ia:la)-ga)*fa)&65534;C=~~(((ea<ka?ea:ka)-ca)*ba)&65534;A=~~(((aa<ja?aa:ja)-_)*Z)&65534;ha=ha<ga?ga:ha;da=da<ca?ca:da;$=$<_?_:$;D=(~~(((ia<ha?ia:ha)-ga)*fa+1.0)&65535|1)&65535;E=(~~(((ea<da?ea:da)-ca)*ba+1.0)&65535|1)&65535;z=(~~(((aa<$?aa:$)-_)*Z+1.0)&65535|1)&65535;if((i|0)>0){n=0;p=k[a+136>>2]|0;l=0;do{l=l+1|0;s=p+6|0;q=j[p>>1]|0;t=p+10|0;u=j[p+4>>1]|0;v=p+8|0;w=j[p+2>>1]|0;x=p+12|0;y=(k[x>>2]|0)>-1;if(((((D&65535)>=(q&65535)?(B&65535)<=(m[s>>1]|0):0)&(A&65535)<=(m[t>>1]|0)&(z&65535)>=(u&65535)&(C&65535)<=(m[v>>1]|0)&(E&65535)>=(w&65535)?(ha=+o[a+36>>2],ja=+o[a+40>>2],la=+o[a+44>>2],ia=+o[a+4>>2],ka=+o[a+8>>2],J=+o[a+12>>2],o[X+12>>2]=0.0,K=+(m[s>>1]|0)/ha+ia,H=+(m[v>>1]|0)/ja+ka,I=+(m[t>>1]|0)/la+J,o[X+28>>2]=0.0,o[X>>2]=+(q&65535)/ha+ia-+o[h>>2],o[X+4>>2]=+(w&65535)/ja+ka-+o[h+4>>2],o[X+8>>2]=+(u&65535)/la+J-+o[h+8>>2],o[X+16>>2]=K-+o[g>>2],o[X+20>>2]=H-+o[g+4>>2],o[X+24>>2]=I-+o[g+8>>2],I=+o[c>>2],H=O*(+o[X+(P<<4)>>2]-I),I=O*(+o[X+((P^1)<<4)>>2]-I),K=+o[c+4>>2],J=Q*(+o[X+(R<<4)+4>>2]-K),K=Q*(+o[X+((R^1)<<4)+4>>2]-K),!(J>I|H>K)):0)?(L=J>H?J:H,W=K<I?K:I,N=+o[c+8>>2],M=S*(+o[X+(T<<4)+8>>2]-N),N=S*(+o[X+((T^1)<<4)+8>>2]-N),!(M>W|L>N)):0)?(M>L?M:L)<(f-V)*((f-V)*F)+((d-G)*((d-G)*F)+(e-U)*((e-U)*F)):0){q=(N<W?N:W)>0.0;if(y&q){s=k[x>>2]|0;yc[k[(k[b>>2]|0)+8>>2]&127](b,s>>21,s&2097151);s=16}else s=15}else{q=0;s=15}if((s|0)==15){s=0;if(y|q)s=16;else{y=k[x>>2]|0;n=n-y|0;p=p+(0-y<<4)|0}}if((s|0)==16){n=n+1|0;p=p+16|0}}while((n|0)<(i|0))}else l=0;if((k[4340]|0)>=(l|0)){r=X;return}k[4340]=l;r=X;return}function Hv(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0,l=0,n=0;k[a+168>>2]=k[a+152>>2];k[b>>2]=17328;k[b+52>>2]=282;i[b+60>>0]=0;i[b+80>>0]=1;k[b+76>>2]=0;k[b+68>>2]=0;k[b+72>>2]=0;i[b+100>>0]=1;k[b+96>>2]=0;k[b+88>>2]=0;k[b+92>>2]=0;i[b+120>>0]=1;k[b+116>>2]=0;k[b+108>>2]=0;k[b+112>>2]=0;i[b+140>>0]=1;k[b+136>>2]=0;k[b+128>>2]=0;k[b+132>>2]=0;k[b+144>>2]=0;i[b+164>>0]=1;k[b+160>>2]=0;k[b+152>>2]=0;k[b+156>>2]=0;k[b+168>>2]=0;o[b+4>>2]=-3402823466385288598117041.0e14;o[b+8>>2]=-3402823466385288598117041.0e14;o[b+12>>2]=-3402823466385288598117041.0e14;o[b+16>>2]=0.0;o[b+20>>2]=3402823466385288598117041.0e14;o[b+24>>2]=3402823466385288598117041.0e14;o[b+28>>2]=3402823466385288598117041.0e14;o[b+32>>2]=0.0;c=k[a+56>>2]|0;if(d){c=sF(c|0)|0;k[b+56>>2]=c;i[b+4>>0]=i[a+4+3>>0]|0;i[b+5>>0]=i[a+4+2>>0]|0;i[b+6>>0]=i[a+4+1>>0]|0;i[b+7>>0]=i[a+4>>0]|0;i[b+8>>0]=i[a+8+3>>0]|0;i[b+9>>0]=i[a+8+2>>0]|0;i[b+10>>0]=i[a+8+1>>0]|0;i[b+11>>0]=i[a+8>>0]|0;i[b+12>>0]=i[a+12+3>>0]|0;i[b+13>>0]=i[a+12+2>>0]|0;i[b+14>>0]=i[a+12+1>>0]|0;i[b+15>>0]=i[a+12>>0]|0;i[b+16>>0]=i[a+16+3>>0]|0;i[b+17>>0]=i[a+16+2>>0]|0;i[b+18>>0]=i[a+16+1>>0]|0;i[b+19>>0]=i[a+16>>0]|0;i[b+20>>0]=i[a+20+3>>0]|0;i[b+21>>0]=i[a+20+2>>0]|0;i[b+22>>0]=i[a+20+1>>0]|0;i[b+23>>0]=i[a+20>>0]|0;i[b+24>>0]=i[a+24+3>>0]|0;i[b+25>>0]=i[a+24+2>>0]|0;i[b+26>>0]=i[a+24+1>>0]|0;i[b+27>>0]=i[a+24>>0]|0;i[b+28>>0]=i[a+28+3>>0]|0;i[b+29>>0]=i[a+28+2>>0]|0;i[b+30>>0]=i[a+28+1>>0]|0;i[b+31>>0]=i[a+28>>0]|0;i[b+32>>0]=i[a+32+3>>0]|0;i[b+33>>0]=i[a+32+2>>0]|0;i[b+34>>0]=i[a+32+1>>0]|0;i[b+35>>0]=i[a+32>>0]|0;i[b+36>>0]=i[a+36+3>>0]|0;i[b+37>>0]=i[a+36+2>>0]|0;i[b+38>>0]=i[a+36+1>>0]|0;i[b+39>>0]=i[a+36>>0]|0;i[b+40>>0]=i[a+40+3>>0]|0;i[b+41>>0]=i[a+40+2>>0]|0;i[b+42>>0]=i[a+40+1>>0]|0;i[b+43>>0]=i[a+40>>0]|0;i[b+44>>0]=i[a+44+3>>0]|0;i[b+45>>0]=i[a+44+2>>0]|0;i[b+46>>0]=i[a+44+1>>0]|0;i[b+47>>0]=i[a+44>>0]|0;i[b+48>>0]=i[a+48+3>>0]|0;i[b+49>>0]=i[a+48+2>>0]|0;i[b+50>>0]=i[a+48+1>>0]|0;i[b+51>>0]=i[a+48>>0]|0;c=sF(k[a+144>>2]|0)|0;k[b+144>>2]=c;c=sF(k[a+168>>2]|0)|0}else{k[b+56>>2]=c;k[b+4>>2]=k[a+4>>2];k[b+4+4>>2]=k[a+4+4>>2];k[b+4+8>>2]=k[a+4+8>>2];k[b+4+12>>2]=k[a+4+12>>2];k[b+20>>2]=k[a+20>>2];k[b+20+4>>2]=k[a+20+4>>2];k[b+20+8>>2]=k[a+20+8>>2];k[b+20+12>>2]=k[a+20+12>>2];k[b+36>>2]=k[a+36>>2];k[b+36+4>>2]=k[a+36+4>>2];k[b+36+8>>2]=k[a+36+8>>2];k[b+36+12>>2]=k[a+36+12>>2];k[b+144>>2]=k[a+144>>2];c=k[a+168>>2]|0}k[b+168>>2]=c;i[b+60>>0]=i[a+60>>0]|0;g=k[a+56>>2]|0;if(!(i[a+60>>0]|0)){c=k[b+96>>2]|0;if(c){if(i[b+100>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[b+96>>2]=0};k[b+88>>2]=0;k[b+88+4>>2]=0;k[b+88+8>>2]=0;i[b+88+12>>0]=0;k[b+96>>2]=b+172;k[b+88>>2]=g;k[b+92>>2]=g;if(d)if((g|0)>0){f=k[a+96>>2]|0;c=b+172|0;e=0;while(1){h=f+(e<<6)|0;n=c+(e<<6)|0;i[n>>0]=i[h+3>>0]|0;i[n+1>>0]=i[h+2>>0]|0;i[n+2>>0]=i[h+1>>0]|0;i[n+3>>0]=i[h>>0]|0;n=f+(e<<6)+4|0;h=c+(e<<6)+4|0;i[h>>0]=i[n+3>>0]|0;i[h+1>>0]=i[n+2>>0]|0;i[h+2>>0]=i[n+1>>0]|0;i[h+3>>0]=i[n>>0]|0;h=f+(e<<6)+8|0;n=c+(e<<6)+8|0;i[n>>0]=i[h+3>>0]|0;i[n+1>>0]=i[h+2>>0]|0;i[n+2>>0]=i[h+1>>0]|0;i[n+3>>0]=i[h>>0]|0;n=f+(e<<6)+12|0;c=c+(e<<6)+12|0;i[c>>0]=i[n+3>>0]|0;i[c+1>>0]=i[n+2>>0]|0;i[c+2>>0]=i[n+1>>0]|0;i[c+3>>0]=i[n>>0]|0;c=k[a+96>>2]|0;n=c+(e<<6)+16|0;h=k[b+96>>2]|0;l=h+(e<<6)+16|0;i[l>>0]=i[n+3>>0]|0;i[l+1>>0]=i[n+2>>0]|0;i[l+2>>0]=i[n+1>>0]|0;i[l+3>>0]=i[n>>0]|0;l=c+(e<<6)+20|0;n=h+(e<<6)+20|0;i[n>>0]=i[l+3>>0]|0;i[n+1>>0]=i[l+2>>0]|0;i[n+2>>0]=i[l+1>>0]|0;i[n+3>>0]=i[l>>0]|0;n=c+(e<<6)+24|0;l=h+(e<<6)+24|0;i[l>>0]=i[n+3>>0]|0;i[l+1>>0]=i[n+2>>0]|0;i[l+2>>0]=i[n+1>>0]|0;i[l+3>>0]=i[n>>0]|0;c=c+(e<<6)+28|0;h=h+(e<<6)+28|0;i[h>>0]=i[c+3>>0]|0;i[h+1>>0]=i[c+2>>0]|0;i[h+2>>0]=i[c+1>>0]|0;i[h+3>>0]=i[c>>0]|0;f=k[a+96>>2]|0;h=sF(k[f+(e<<6)+32>>2]|0)|0;c=k[b+96>>2]|0;k[c+(e<<6)+32>>2]=h;h=sF(k[f+(e<<6)+36>>2]|0)|0;k[c+(e<<6)+36>>2]=h;h=sF(k[f+(e<<6)+40>>2]|0)|0;k[c+(e<<6)+40>>2]=h;if((e|0)==(g+-1|0))break;else e=e+1|0}}else c=b+172|0;else if((g|0)>0){c=b+172|0;f=k[a+96>>2]|0;e=0;while(1){c=c+(e<<6)|0;n=f+(e<<6)|0;k[c>>2]=k[n>>2];k[c+4>>2]=k[n+4>>2];k[c+8>>2]=k[n+8>>2];k[c+12>>2]=k[n+12>>2];c=(k[b+96>>2]|0)+(e<<6)+16|0;n=(k[a+96>>2]|0)+(e<<6)+16|0;k[c>>2]=k[n>>2];k[c+4>>2]=k[n+4>>2];k[c+8>>2]=k[n+8>>2];k[c+12>>2]=k[n+12>>2];f=k[a+96>>2]|0;c=k[b+96>>2]|0;k[c+(e<<6)+32>>2]=k[f+(e<<6)+32>>2];k[c+(e<<6)+36>>2]=k[f+(e<<6)+36>>2];k[c+(e<<6)+40>>2]=k[f+(e<<6)+40>>2];if((e|0)==(g+-1|0))break;else e=e+1|0}}else c=b+172|0;if(c){if(i[b+100>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[b+96>>2]=0};k[b+88>>2]=0;k[b+88+4>>2]=0;k[b+88+8>>2]=0;i[b+88+12>>0]=0;c=g<<6}else{c=k[b+136>>2]|0;if(c){if(i[b+140>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[b+136>>2]=0};k[b+128>>2]=0;k[b+128+4>>2]=0;k[b+128+8>>2]=0;i[b+128+12>>0]=0;k[b+136>>2]=b+172;k[b+128>>2]=g;k[b+132>>2]=g;if(d){if((g|0)>0){e=k[a+136>>2]|0;c=0;while(1){n=m[e+(c<<4)>>1]|0;j[b+172+(c<<4)>>1]=n>>>8|n<<8;n=m[e+(c<<4)+2>>1]|0;j[b+172+(c<<4)+2>>1]=n>>>8|n<<8;n=m[e+(c<<4)+4>>1]|0;j[b+172+(c<<4)+4>>1]=n>>>8|n<<8;n=m[e+(c<<4)+6>>1]|0;j[b+172+(c<<4)+6>>1]=n>>>8|n<<8;n=m[e+(c<<4)+8>>1]|0;j[b+172+(c<<4)+8>>1]=n>>>8|n<<8;n=m[e+(c<<4)+10>>1]|0;j[b+172+(c<<4)+10>>1]=n>>>8|n<<8;n=sF(k[e+(c<<4)+12>>2]|0)|0;k[b+172+(c<<4)+12>>2]=n;if((c|0)==(g+-1|0))break;else c=c+1|0}}}else if((g|0)>0){e=k[a+136>>2]|0;c=0;while(1){j[b+172+(c<<4)>>1]=j[e+(c<<4)>>1]|0;j[b+172+(c<<4)+2>>1]=j[e+(c<<4)+2>>1]|0;j[b+172+(c<<4)+4>>1]=j[e+(c<<4)+4>>1]|0;j[b+172+(c<<4)+6>>1]=j[e+(c<<4)+6>>1]|0;j[b+172+(c<<4)+8>>1]=j[e+(c<<4)+8>>1]|0;j[b+172+(c<<4)+10>>1]=j[e+(c<<4)+10>>1]|0;k[b+172+(c<<4)+12>>2]=k[e+(c<<4)+12>>2];if((c|0)==(g+-1|0))break;else c=c+1|0}}k[b+128>>2]=0;k[b+128+4>>2]=0;k[b+128+8>>2]=0;i[b+128+12>>0]=0;c=g<<4}g=b+(c+172)|0;e=k[a+168>>2]|0;c=k[b+160>>2]|0;if(c){if(i[b+164>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[b+160>>2]=0};k[b+152>>2]=0;k[b+152+4>>2]=0;k[b+152+8>>2]=0;i[b+152+12>>0]=0;k[b+160>>2]=g;k[b+152>>2]=e;k[b+156>>2]=e;f=k[a+168>>2]|0;if(d){if((f|0)<=0){k[b>>2]=0;k[b+152>>2]=0;k[b+152+4>>2]=0;k[b+152+8>>2]=0;i[b+152+12>>0]=0;return 1}c=k[a+160>>2]|0;e=0;while(1){n=m[c+(e<<5)>>1]|0;j[g+(e<<5)>>1]=n>>>8|n<<8;n=m[c+(e<<5)+2>>1]|0;j[g+(e<<5)+2>>1]=n>>>8|n<<8;n=m[c+(e<<5)+4>>1]|0;j[g+(e<<5)+4>>1]=n>>>8|n<<8;n=m[c+(e<<5)+6>>1]|0;j[g+(e<<5)+6>>1]=n>>>8|n<<8;n=m[c+(e<<5)+8>>1]|0;j[g+(e<<5)+8>>1]=n>>>8|n<<8;n=m[c+(e<<5)+10>>1]|0;j[g+(e<<5)+10>>1]=n>>>8|n<<8;n=sF(k[c+(e<<5)+12>>2]|0)|0;k[g+(e<<5)+12>>2]=n;n=sF(k[c+(e<<5)+16>>2]|0)|0;k[g+(e<<5)+16>>2]=n;if((e|0)==(f+-1|0))break;else e=e+1|0}k[b>>2]=0;k[b+152>>2]=0;k[b+152+4>>2]=0;k[b+152+8>>2]=0;i[b+152+12>>0]=0;return 1}else{if((f|0)<=0){k[b>>2]=0;k[b+152>>2]=0;k[b+152+4>>2]=0;k[b+152+8>>2]=0;i[b+152+12>>0]=0;return 1}c=k[a+160>>2]|0;e=0;do{j[g+(e<<5)>>1]=j[c+(e<<5)>>1]|0;j[g+(e<<5)+2>>1]=j[c+(e<<5)+2>>1]|0;j[g+(e<<5)+4>>1]=j[c+(e<<5)+4>>1]|0;j[g+(e<<5)+6>>1]=j[c+(e<<5)+6>>1]|0;j[g+(e<<5)+8>>1]=j[c+(e<<5)+8>>1]|0;j[g+(e<<5)+10>>1]=j[c+(e<<5)+10>>1]|0;k[g+(e<<5)+12>>2]=k[c+(e<<5)+12>>2];k[g+(e<<5)+16>>2]=k[c+(e<<5)+16>>2];k[g+(e<<5)+20>>2]=0;k[g+(e<<5)+24>>2]=0;k[g+(e<<5)+28>>2]=0;e=e+1|0}while((e|0)<(k[a+168>>2]|0));k[b>>2]=0;k[b+152>>2]=0;k[b+152+4>>2]=0;k[b+152+8>>2]=0;i[b+152+12>>0]=0;return 1}return 0}function Iv(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0,l=0,m=0,n=0;n=r;r=r+112|0;o[a+20>>2]=+o[b+16>>2];o[a+24>>2]=+o[b+20>>2];o[a+28>>2]=+o[b+24>>2];o[a+32>>2]=+o[b+28>>2];o[a+4>>2]=+o[b>>2];o[a+8>>2]=+o[b+4>>2];o[a+12>>2]=+o[b+8>>2];o[a+16>>2]=+o[b+12>>2];o[a+36>>2]=+o[b+32>>2];o[a+40>>2]=+o[b+36>>2];o[a+44>>2]=+o[b+40>>2];o[a+48>>2]=+o[b+44>>2];k[a+56>>2]=k[b+48>>2];i[a+60>>0]=(k[b+52>>2]|0)!=0&1;m=k[b+56>>2]|0;g=n+48|0;l=g+64|0;do{k[g>>2]=0;g=g+4|0}while((g|0)<(l|0));f=k[a+88>>2]|0;if((f|0)<(m|0)){if((k[a+92>>2]|0)<(m|0)){if(!m){e=0;d=f}else{k[5108]=(k[5108]|0)+1;d=iF(m<<6|19)|0;if(!d)e=0;else{k[(d+4+15&-16)+-4>>2]=d;e=d+4+15&-16}d=k[a+88>>2]|0}if((d|0)>0){d=d+-1|0;c=0;while(1){g=e+(c<<6)|0;h=(k[a+96>>2]|0)+(c<<6)|0;l=g+64|0;do{k[g>>2]=k[h>>2];g=g+4|0;h=h+4|0}while((g|0)<(l|0));if((c|0)==(d|0))break;else c=c+1|0}}d=k[a+96>>2]|0;if(d){if(i[a+100>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[a+96>>2]=0}i[a+100>>0]=1;k[a+96>>2]=e;k[a+92>>2]=m;e=a+96|0}else e=a+96|0;while(1){g=(k[e>>2]|0)+(f<<6)|0;h=n+48|0;l=g+64|0;do{k[g>>2]=k[h>>2];g=g+4|0;h=h+4|0}while((g|0)<(l|0));if((f|0)==(m+-1|0))break;else f=f+1|0}}k[a+88>>2]=m;if((m|0)>0){e=k[a+96>>2]|0;d=0;c=k[b+64>>2]|0;while(1){o[e+(d<<6)+16>>2]=+o[c+16>>2];o[e+(d<<6)+20>>2]=+o[c+20>>2];o[e+(d<<6)+24>>2]=+o[c+24>>2];o[e+(d<<6)+28>>2]=+o[c+28>>2];o[e+(d<<6)>>2]=+o[c>>2];o[e+(d<<6)+4>>2]=+o[c+4>>2];o[e+(d<<6)+8>>2]=+o[c+8>>2];o[e+(d<<6)+12>>2]=+o[c+12>>2];k[e+(d<<6)+32>>2]=k[c+32>>2];k[e+(d<<6)+36>>2]=k[c+36>>2];k[e+(d<<6)+40>>2]=k[c+40>>2];if((d|0)==(m+-1|0))break;else{d=d+1|0;c=c+48|0}}}l=k[b+60>>2]|0;k[n+32>>2]=0;k[n+32+4>>2]=0;k[n+32+8>>2]=0;k[n+32+12>>2]=0;d=k[a+128>>2]|0;if((d|0)<(l|0)){if((k[a+132>>2]|0)<(l|0)){if(!l){e=0;c=d}else{k[5108]=(k[5108]|0)+1;c=iF((l<<4|3)+16|0)|0;if(!c)e=0;else{k[(c+4+15&-16)+-4>>2]=c;e=c+4+15&-16}c=k[a+128>>2]|0}if((c|0)>0){c=c+-1|0;f=0;while(1){m=e+(f<<4)|0;h=(k[a+136>>2]|0)+(f<<4)|0;k[m>>2]=k[h>>2];k[m+4>>2]=k[h+4>>2];k[m+8>>2]=k[h+8>>2];k[m+12>>2]=k[h+12>>2];if((f|0)==(c|0))break;else f=f+1|0}}c=k[a+136>>2]|0;if(c){if(i[a+140>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[a+136>>2]=0}i[a+140>>0]=1;k[a+136>>2]=e;k[a+132>>2]=l;e=a+136|0}else e=a+136|0;while(1){m=(k[e>>2]|0)+(d<<4)|0;k[m>>2]=k[n+32>>2];k[m+4>>2]=k[n+32+4>>2];k[m+8>>2]=k[n+32+8>>2];k[m+12>>2]=k[n+32+12>>2];if((d|0)==(l+-1|0))break;else d=d+1|0}}k[a+128>>2]=l;if((l|0)>0){e=k[a+136>>2]|0;d=0;c=k[b+68>>2]|0;while(1){k[e+(d<<4)+12>>2]=k[c+12>>2];j[e+(d<<4)+6>>1]=j[c+6>>1]|0;j[e+(d<<4)+8>>1]=j[c+8>>1]|0;j[e+(d<<4)+10>>1]=j[c+10>>1]|0;j[e+(d<<4)>>1]=j[c>>1]|0;j[e+(d<<4)+2>>1]=j[c+2>>1]|0;j[e+(d<<4)+4>>1]=j[c+4>>1]|0;if((d|0)==(l+-1|0))break;else{d=d+1|0;c=c+16|0}}}k[a+144>>2]=k[b+76>>2];l=k[b+80>>2]|0;d=k[a+152>>2]|0;if((d|0)<(l|0)){if((k[a+156>>2]|0)<(l|0)){if(!l){e=0;c=d}else{k[5108]=(k[5108]|0)+1;c=iF(l<<5|19)|0;if(!c)e=0;else{k[(c+4+15&-16)+-4>>2]=c;e=c+4+15&-16}c=k[a+152>>2]|0}if((c|0)>0){c=c+-1|0;f=0;while(1){m=e+(f<<5)|0;h=(k[a+160>>2]|0)+(f<<5)|0;k[m>>2]=k[h>>2];k[m+4>>2]=k[h+4>>2];k[m+8>>2]=k[h+8>>2];k[m+12>>2]=k[h+12>>2];k[m+16>>2]=k[h+16>>2];k[m+20>>2]=k[h+20>>2];k[m+24>>2]=k[h+24>>2];k[m+28>>2]=k[h+28>>2];if((f|0)==(c|0))break;else f=f+1|0}}c=k[a+160>>2]|0;if(c){if(i[a+164>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[a+160>>2]=0}i[a+164>>0]=1;k[a+160>>2]=e;k[a+156>>2]=l;e=a+160|0}else e=a+160|0;while(1){m=(k[e>>2]|0)+(d<<5)|0;k[m>>2]=k[n>>2];k[m+4>>2]=k[n+4>>2];k[m+8>>2]=k[n+8>>2];k[m+12>>2]=k[n+12>>2];k[m+16>>2]=k[n+16>>2];k[m+20>>2]=k[n+20>>2];k[m+24>>2]=k[n+24>>2];k[m+28>>2]=k[n+28>>2];if((d|0)==(l+-1|0))break;else d=d+1|0}}k[a+152>>2]=l;if((l|0)<=0){r=n;return}d=k[a+160>>2]|0;e=0;c=k[b+72>>2]|0;while(1){j[d+(e<<5)+6>>1]=j[c+14>>1]|0;j[d+(e<<5)+8>>1]=j[c+16>>1]|0;j[d+(e<<5)+10>>1]=j[c+18>>1]|0;j[d+(e<<5)>>1]=j[c+8>>1]|0;j[d+(e<<5)+2>>1]=j[c+10>>1]|0;j[d+(e<<5)+4>>1]=j[c+12>>1]|0;k[d+(e<<5)+12>>2]=k[c>>2];k[d+(e<<5)+16>>2]=k[c+4>>2];if((e|0)==(l+-1|0))break;else{e=e+1|0;c=c+20|0}}r=n;return}function Jv(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0,l=0,m=0,n=0;n=r;r=r+112|0;o[a+20>>2]=+p[b+32>>3];o[a+24>>2]=+p[b+40>>3];o[a+28>>2]=+p[b+48>>3];o[a+32>>2]=+p[b+56>>3];o[a+4>>2]=+p[b>>3];o[a+8>>2]=+p[b+8>>3];o[a+12>>2]=+p[b+16>>3];o[a+16>>2]=+p[b+24>>3];o[a+36>>2]=+p[b+64>>3];o[a+40>>2]=+p[b+72>>3];o[a+44>>2]=+p[b+80>>3];o[a+48>>2]=+p[b+88>>3];k[a+56>>2]=k[b+96>>2];i[a+60>>0]=(k[b+100>>2]|0)!=0&1;m=k[b+104>>2]|0;g=n+48|0;l=g+64|0;do{k[g>>2]=0;g=g+4|0}while((g|0)<(l|0));f=k[a+88>>2]|0;if((f|0)<(m|0)){if((k[a+92>>2]|0)<(m|0)){if(!m){e=0;d=f}else{k[5108]=(k[5108]|0)+1;d=iF(m<<6|19)|0;if(!d)e=0;else{k[(d+4+15&-16)+-4>>2]=d;e=d+4+15&-16}d=k[a+88>>2]|0}if((d|0)>0){d=d+-1|0;c=0;while(1){g=e+(c<<6)|0;h=(k[a+96>>2]|0)+(c<<6)|0;l=g+64|0;do{k[g>>2]=k[h>>2];g=g+4|0;h=h+4|0}while((g|0)<(l|0));if((c|0)==(d|0))break;else c=c+1|0}}d=k[a+96>>2]|0;if(d){if(i[a+100>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[a+96>>2]=0}i[a+100>>0]=1;k[a+96>>2]=e;k[a+92>>2]=m;e=a+96|0}else e=a+96|0;while(1){g=(k[e>>2]|0)+(f<<6)|0;h=n+48|0;l=g+64|0;do{k[g>>2]=k[h>>2];g=g+4|0;h=h+4|0}while((g|0)<(l|0));if((f|0)==(m+-1|0))break;else f=f+1|0}}k[a+88>>2]=m;if((m|0)>0){e=k[a+96>>2]|0;d=0;c=k[b+112>>2]|0;while(1){o[e+(d<<6)+16>>2]=+p[c+32>>3];o[e+(d<<6)+20>>2]=+p[c+40>>3];o[e+(d<<6)+24>>2]=+p[c+48>>3];o[e+(d<<6)+28>>2]=+p[c+56>>3];o[e+(d<<6)>>2]=+p[c>>3];o[e+(d<<6)+4>>2]=+p[c+8>>3];o[e+(d<<6)+8>>2]=+p[c+16>>3];o[e+(d<<6)+12>>2]=+p[c+24>>3];k[e+(d<<6)+32>>2]=k[c+64>>2];k[e+(d<<6)+36>>2]=k[c+68>>2];k[e+(d<<6)+40>>2]=k[c+72>>2];if((d|0)==(m+-1|0))break;else{d=d+1|0;c=c+80|0}}}l=k[b+108>>2]|0;k[n+32>>2]=0;k[n+32+4>>2]=0;k[n+32+8>>2]=0;k[n+32+12>>2]=0;d=k[a+128>>2]|0;if((d|0)<(l|0)){if((k[a+132>>2]|0)<(l|0)){if(!l){e=0;c=d}else{k[5108]=(k[5108]|0)+1;c=iF((l<<4|3)+16|0)|0;if(!c)e=0;else{k[(c+4+15&-16)+-4>>2]=c;e=c+4+15&-16}c=k[a+128>>2]|0}if((c|0)>0){c=c+-1|0;f=0;while(1){m=e+(f<<4)|0;h=(k[a+136>>2]|0)+(f<<4)|0;k[m>>2]=k[h>>2];k[m+4>>2]=k[h+4>>2];k[m+8>>2]=k[h+8>>2];k[m+12>>2]=k[h+12>>2];if((f|0)==(c|0))break;else f=f+1|0}}c=k[a+136>>2]|0;if(c){if(i[a+140>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[a+136>>2]=0}i[a+140>>0]=1;k[a+136>>2]=e;k[a+132>>2]=l;e=a+136|0}else e=a+136|0;while(1){m=(k[e>>2]|0)+(d<<4)|0;k[m>>2]=k[n+32>>2];k[m+4>>2]=k[n+32+4>>2];k[m+8>>2]=k[n+32+8>>2];k[m+12>>2]=k[n+32+12>>2];if((d|0)==(l+-1|0))break;else d=d+1|0}}k[a+128>>2]=l;if((l|0)>0){e=k[a+136>>2]|0;d=0;c=k[b+116>>2]|0;while(1){k[e+(d<<4)+12>>2]=k[c+12>>2];j[e+(d<<4)+6>>1]=j[c+6>>1]|0;j[e+(d<<4)+8>>1]=j[c+8>>1]|0;j[e+(d<<4)+10>>1]=j[c+10>>1]|0;j[e+(d<<4)>>1]=j[c>>1]|0;j[e+(d<<4)+2>>1]=j[c+2>>1]|0;j[e+(d<<4)+4>>1]=j[c+4>>1]|0;if((d|0)==(l+-1|0))break;else{d=d+1|0;c=c+16|0}}}k[a+144>>2]=k[b+120>>2];l=k[b+124>>2]|0;d=k[a+152>>2]|0;if((d|0)<(l|0)){if((k[a+156>>2]|0)<(l|0)){if(!l){e=0;c=d}else{k[5108]=(k[5108]|0)+1;c=iF(l<<5|19)|0;if(!c)e=0;else{k[(c+4+15&-16)+-4>>2]=c;e=c+4+15&-16}c=k[a+152>>2]|0}if((c|0)>0){c=c+-1|0;f=0;while(1){m=e+(f<<5)|0;h=(k[a+160>>2]|0)+(f<<5)|0;k[m>>2]=k[h>>2];k[m+4>>2]=k[h+4>>2];k[m+8>>2]=k[h+8>>2];k[m+12>>2]=k[h+12>>2];k[m+16>>2]=k[h+16>>2];k[m+20>>2]=k[h+20>>2];k[m+24>>2]=k[h+24>>2];k[m+28>>2]=k[h+28>>2];if((f|0)==(c|0))break;else f=f+1|0}}c=k[a+160>>2]|0;if(c){if(i[a+164>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[a+160>>2]=0}i[a+164>>0]=1;k[a+160>>2]=e;k[a+156>>2]=l;e=a+160|0}else e=a+160|0;while(1){m=(k[e>>2]|0)+(d<<5)|0;k[m>>2]=k[n>>2];k[m+4>>2]=k[n+4>>2];k[m+8>>2]=k[n+8>>2];k[m+12>>2]=k[n+12>>2];k[m+16>>2]=k[n+16>>2];k[m+20>>2]=k[n+20>>2];k[m+24>>2]=k[n+24>>2];k[m+28>>2]=k[n+28>>2];if((d|0)==(l+-1|0))break;else d=d+1|0}}k[a+152>>2]=l;if((l|0)<=0){r=n;return}d=k[a+160>>2]|0;e=0;c=k[b+128>>2]|0;while(1){j[d+(e<<5)+6>>1]=j[c+14>>1]|0;j[d+(e<<5)+8>>1]=j[c+16>>1]|0;j[d+(e<<5)+10>>1]=j[c+18>>1]|0;j[d+(e<<5)>>1]=j[c+8>>1]|0;j[d+(e<<5)+2>>1]=j[c+10>>1]|0;j[d+(e<<5)+4>>1]=j[c+12>>1]|0;k[d+(e<<5)+12>>2]=k[c>>2];k[d+(e<<5)+16>>2]=k[c+4>>2];if((e|0)==(l+-1|0))break;else{e=e+1|0;c=c+20|0}}r=n;return}function Kv(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0;o[b+16>>2]=+o[a+20>>2];o[b+20>>2]=+o[a+24>>2];o[b+24>>2]=+o[a+28>>2];o[b+28>>2]=+o[a+32>>2];o[b>>2]=+o[a+4>>2];o[b+4>>2]=+o[a+8>>2];o[b+8>>2]=+o[a+12>>2];o[b+12>>2]=+o[a+16>>2];o[b+32>>2]=+o[a+36>>2];o[b+36>>2]=+o[a+40>>2];o[b+40>>2]=+o[a+44>>2];o[b+44>>2]=+o[a+48>>2];k[b+48>>2]=k[a+56>>2];k[b+52>>2]=l[a+60>>0];h=k[a+88>>2]|0;k[b+56>>2]=h;if(h){h=nc[k[(k[c>>2]|0)+28>>2]&31](c,k[a+96>>2]|0)|0;k[b+64>>2]=h;if(h){h=k[a+88>>2]|0;e=dc[k[(k[c>>2]|0)+16>>2]&63](c,48,h)|0;if((h|0)>0){d=k[a+96>>2]|0;g=0;f=k[e+8>>2]|0;while(1){o[f+16>>2]=+o[d+(g<<6)+16>>2];o[f+20>>2]=+o[d+(g<<6)+20>>2];o[f+24>>2]=+o[d+(g<<6)+24>>2];o[f+28>>2]=+o[d+(g<<6)+28>>2];o[f>>2]=+o[d+(g<<6)>>2];o[f+4>>2]=+o[d+(g<<6)+4>>2];o[f+8>>2]=+o[d+(g<<6)+8>>2];o[f+12>>2]=+o[d+(g<<6)+12>>2];k[f+32>>2]=k[d+(g<<6)+32>>2];k[f+36>>2]=k[d+(g<<6)+36>>2];k[f+40>>2]=k[d+(g<<6)+40>>2];if((g|0)==(h+-1|0))break;else{g=g+1|0;f=f+48|0}}}else d=k[a+96>>2]|0;Qb[k[(k[c>>2]|0)+20>>2]&31](c,e,17368,1497453121,d)}}else k[b+64>>2]=0;h=k[a+128>>2]|0;k[b+60>>2]=h;if(h){h=nc[k[(k[c>>2]|0)+28>>2]&31](c,k[a+136>>2]|0)|0;k[b+68>>2]=h;if(h){g=k[a+128>>2]|0;e=dc[k[(k[c>>2]|0)+16>>2]&63](c,16,g)|0;if((g|0)>0){d=k[a+136>>2]|0;h=0;f=k[e+8>>2]|0;while(1){k[f+12>>2]=k[d+(h<<4)+12>>2];j[f+6>>1]=j[d+(h<<4)+6>>1]|0;j[f+8>>1]=j[d+(h<<4)+8>>1]|0;j[f+10>>1]=j[d+(h<<4)+10>>1]|0;j[f>>1]=j[d+(h<<4)>>1]|0;j[f+2>>1]=j[d+(h<<4)+2>>1]|0;j[f+4>>1]=j[d+(h<<4)+4>>1]|0;if((h|0)==(g+-1|0))break;else{h=h+1|0;f=f+16|0}}}else d=k[a+136>>2]|0;Qb[k[(k[c>>2]|0)+20>>2]&31](c,e,17392,1497453121,d)}}else k[b+68>>2]=0;k[b+76>>2]=k[a+144>>2];h=k[a+152>>2]|0;k[b+80>>2]=h;if(!h){k[b+72>>2]=0;return 17440}h=nc[k[(k[c>>2]|0)+28>>2]&31](c,k[a+160>>2]|0)|0;k[b+72>>2]=h;if(!h)return 17440;g=k[a+152>>2]|0;h=dc[k[(k[c>>2]|0)+16>>2]&63](c,20,g)|0;if((g|0)>0){d=k[a+160>>2]|0;e=0;f=k[h+8>>2]|0;while(1){j[f+14>>1]=j[d+(e<<5)+6>>1]|0;j[f+16>>1]=j[d+(e<<5)+8>>1]|0;j[f+18>>1]=j[d+(e<<5)+10>>1]|0;j[f+8>>1]=j[d+(e<<5)>>1]|0;j[f+10>>1]=j[d+(e<<5)+2>>1]|0;j[f+12>>1]=j[d+(e<<5)+4>>1]|0;k[f>>2]=k[d+(e<<5)+12>>2];k[f+4>>2]=k[d+(e<<5)+16>>2];if((e|0)==(g+-1|0))break;else{e=e+1|0;f=f+20|0}}}else d=k[a+160>>2]|0;Qb[k[(k[c>>2]|0)+20>>2]&31](c,h,17416,1497453121,d);return 17440}function Lv(a){a=a|0;var b=0;b=k[a>>2]|0;if(b)nx(a,b);b=k[a+4>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+4>>2]=0;k[a+8>>2]=-1;b=k[a+32>>2]|0;if(b){if(i[a+36>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+32>>2]=0}i[a+36>>0]=1;k[a+32>>2]=0;k[a+24>>2]=0;k[a+28>>2]=0;k[a+16>>2]=0;b=k[a+52>>2]|0;if(!b){i[a+56>>0]=1;k[a+52>>2]=0;k[a+44>>2]=0;k[a+48>>2]=0;i[a+36>>0]=1;k[a+32>>2]=0;k[a+24>>2]=0;k[a+28>>2]=0;return}if(!(i[a+56>>0]|0)){i[a+56>>0]=1;k[a+52>>2]=0;k[a+44>>2]=0;k[a+48>>2]=0;i[a+36>>0]=1;k[a+32>>2]=0;k[a+24>>2]=0;k[a+28>>2]=0;return}k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0);b=k[a+32>>2]|0;i[a+56>>0]=1;k[a+52>>2]=0;k[a+44>>2]=0;k[a+48>>2]=0;if(!b){i[a+36>>0]=1;k[a+32>>2]=0;k[a+24>>2]=0;k[a+28>>2]=0;return}if(i[a+36>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+32>>2]=0;i[a+36>>0]=1;k[a+32>>2]=0;k[a+24>>2]=0;k[a+28>>2]=0;return}function Mv(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,l=0,m=0;m=r;r=r+32|0;if((b|0)<0)b=k[a+12>>2]|0;c=k[a>>2]|0;if(!((b|0)>0&(c|0)!=0)){r=m;return}while(1){d=c+40|0;if(k[d>>2]|0){l=0;while(1){j=(k[a+16>>2]|0)>>>l&1;e=c+32|0;f=k[e>>2]|0;if(f>>>0>c>>>0){g=(k[f+40>>2]|0)==(c|0)&1;h=k[f+36+((g^1)<<2)>>2]|0;i=k[f+32>>2]|0;if(!i)k[a>>2]=c;else k[i+36+(((k[i+40>>2]|0)==(f|0)&1)<<2)>>2]=c;k[h+32>>2]=c;k[f+32>>2]=c;k[e>>2]=i;i=c+36|0;k[f+36>>2]=k[i>>2];k[f+40>>2]=k[d>>2];k[(k[i>>2]|0)+32>>2]=f;k[(k[d>>2]|0)+32>>2]=f;k[c+36+(g<<2)>>2]=f;k[c+36+((g^1)<<2)>>2]=h;k[m>>2]=k[f>>2];k[m+4>>2]=k[f+4>>2];k[m+8>>2]=k[f+8>>2];k[m+12>>2]=k[f+12>>2];k[m+16>>2]=k[f+16>>2];k[m+20>>2]=k[f+20>>2];k[m+24>>2]=k[f+24>>2];k[m+28>>2]=k[f+28>>2];k[f>>2]=k[c>>2];k[f+4>>2]=k[c+4>>2];k[f+8>>2]=k[c+8>>2];k[f+12>>2]=k[c+12>>2];k[f+16>>2]=k[c+16>>2];k[f+20>>2]=k[c+20>>2];k[f+24>>2]=k[c+24>>2];k[f+28>>2]=k[c+28>>2];k[c>>2]=k[m>>2];k[c+4>>2]=k[m+4>>2];k[c+8>>2]=k[m+8>>2];k[c+12>>2]=k[m+12>>2];k[c+16>>2]=k[m+16>>2];k[c+20>>2]=k[m+20>>2];k[c+24>>2]=k[m+24>>2];k[c+28>>2]=k[m+28>>2];c=f}c=k[c+36+(j<<2)>>2]|0;d=c+40|0;if(!(k[d>>2]|0))break;else l=l+1&31}}if(!(ox(a,c)|0))d=0;else d=k[a>>2]|0;px(a,d,c);k[a+16>>2]=(k[a+16>>2]|0)+1;b=b+-1|0;if(!b)break;c=k[a>>2]|0}r=m;return}function Nv(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0,G=0.0,H=0;H=r;r=r+32|0;h=+o[b+16>>2];g=+o[b>>2];i=+o[b+20>>2];f=+o[b+4>>2];l=+o[b+24>>2];e=+o[b+8>>2];q=+o[b+32>>2];v=+o[b+36>>2];w=+o[b+40>>2];B=(i-f)*(w-e)-(l-e)*(v-f);C=(l-e)*(q-g)-(h-g)*(w-e);D=(h-g)*(v-f)-(i-f)*(q-g);o[H+16>>2]=B;o[H+16+4>>2]=C;o[H+16+8>>2]=D;o[H+16+12>>2]=0.0;m=+o[a+4>>2];s=+o[a+8>>2];x=+o[a+12>>2];E=B*m+C*s+D*x-(g*B+f*C+e*D);n=+o[a+20>>2];t=+o[a+24>>2];y=+o[a+28>>2];if(E*(B*n+C*t+D*y-(g*B+f*C+e*D))>=0.0){r=H;return}F=k[a+36>>2]|0;if(E<=0.0&(F&1|0)!=0){r=H;return}G=E/(E-(B*n+C*t+D*y-(g*B+f*C+e*D)));if(!(G<+o[a+40>>2])){r=H;return}A=(B*B+C*C+D*D)*-9.999999747378752e-05;z=g-(n*G+m*(1.0-G));u=f-(t*G+s*(1.0-G));p=e-(y*G+x*(1.0-G));j=h-(n*G+m*(1.0-G));i=i-(t*G+s*(1.0-G));h=l-(y*G+x*(1.0-G));if(!(D*(z*i-u*j)+(B*(u*h-p*i)+C*(p*j-z*h))>=A)){r=H;return}g=q-(n*G+m*(1.0-G));f=v-(t*G+s*(1.0-G));e=w-(y*G+x*(1.0-G));if(!(D*(j*f-i*g)+(B*(i*e-h*f)+C*(h*g-j*e))>=A)){r=H;return}if(!(D*(u*g-z*f)+(B*(p*f-u*e)+C*(z*e-p*g))>=A)){r=H;return}e=1.0/+Y(+(B*B+C*C+D*D));o[H+16>>2]=B*e;o[H+16+4>>2]=C*e;o[H+16+8>>2]=D*e;b=k[(k[a>>2]|0)+12>>2]|0;if(E<=0.0&(F&2|0)==0){o[H>>2]=-(B*e);o[H+4>>2]=-(C*e);o[H+8>>2]=-(D*e);o[H+12>>2]=0.0;G=+uc[b&3](a,H,G,c,d);o[a+40>>2]=G;r=H;return}else{G=+uc[b&3](a,H+16|0,G,c,d);o[a+40>>2]=G;r=H;return}}function Ov(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,j=0,l=0.0;j=r;r=r+672|0;k[j+568+8>>2]=0;o[j+568+12>>2]=1.0;o[j+568+16>>2]=1.0;o[j+568+20>>2]=1.0;o[j+568+24>>2]=0.0;k[j+568+52>>2]=0;k[j+568>>2]=7584;k[j+568+4>>2]=1;k[j+568+56>>2]=k[b>>2];k[j+568+56+4>>2]=k[b+4>>2];k[j+568+56+8>>2]=k[b+8>>2];k[j+568+56+12>>2]=k[b+12>>2];k[j+568+72>>2]=k[b+16>>2];k[j+568+72+4>>2]=k[b+16+4>>2];k[j+568+72+8>>2]=k[b+16+8>>2];k[j+568+72+12>>2]=k[b+16+12>>2];k[j+568+88>>2]=k[b+32>>2];k[j+568+88+4>>2]=k[b+32+4>>2];k[j+568+88+8>>2]=k[b+32+8>>2];k[j+568+88+12>>2]=k[b+32+12>>2];o[j+568+44>>2]=+o[a+204>>2];o[j+208+308>>2]=9.999999747378752e-05;i[j+208+332>>0]=0;k[j+200>>2]=19048;b=k[a+4>>2]|0;k[j+176>>2]=19312;k[j+176+4>>2]=j+208;k[j+176+8>>2]=j+200;k[j+176+12>>2]=b;k[j+176+16>>2]=j+568;k[j+176+20>>2]=0;k[j>>2]=7512;k[j+168>>2]=0;o[j+164>>2]=1.0;o[j+172>>2]=+o[a+208>>2];if((Yv(j+176|0,a+8|0,a+72|0,a+136|0,a+136|0,j)|0?(e=+o[j+132>>2],f=+o[j+136>>2],g=+o[j+140>>2],e*e+f*f+g*g>9.999999747378752e-05):0)?(h=+o[j+164>>2],h<+o[a+200>>2]):0){l=1.0/+Y(+(e*e+f*f+g*g));o[j+132>>2]=e*l;o[j+136>>2]=f*l;o[j+140>>2]=g*l;+ic[k[(k[a>>2]|0)+12>>2]&3](a,j+132|0,j+148|0,h,c,d)}k[j+568>>2]=13336;c=k[j+568+52>>2]|0;if(!c){r=j;return}Sb[k[k[c>>2]>>2]&255](c);c=k[j+568+52>>2]|0;if(!c){r=j;return}k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);r=j;return}function Pv(a,b,c,d,e,f,g,h,j,l){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;j=j|0;l=l|0;var m=0.0,n=0,p=0,q=0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0,y=0.0,z=0.0,A=0.0,B=0.0,C=0,D=0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0;C=r;r=r+4256|0;if(((k[c+4>>2]|0)+-17|0)>>>0<2)x=((k[d+4>>2]|0)+-17|0)>>>0<2;else x=0;a=0;do{Qv();t=+o[17616+(a<<4)>>2];u=+o[17616+(a<<4)+4>>2];v=+o[17616+(a<<4)+8>>2];z=+o[e+4>>2]*-t+ +o[e+20>>2]*-u+ +o[e+36>>2]*-v;w=+o[e+8>>2]*-t+ +o[e+24>>2]*-u+ +o[e+40>>2]*-v;o[C+16+(a<<4)>>2]=+o[e>>2]*-t+ +o[e+16>>2]*-u+ +o[e+32>>2]*-v;o[C+16+(a<<4)+4>>2]=z;o[C+16+(a<<4)+8>>2]=w;o[C+16+(a<<4)+12>>2]=0.0;w=t*+o[f+4>>2]+u*+o[f+20>>2]+v*+o[f+36>>2];z=t*+o[f+8>>2]+u*+o[f+24>>2]+v*+o[f+40>>2];o[C+1008+(a<<4)>>2]=t*+o[f>>2]+u*+o[f+16>>2]+v*+o[f+32>>2];o[C+1008+(a<<4)+4>>2]=w;o[C+1008+(a<<4)+8>>2]=z;o[C+1008+(a<<4)+12>>2]=0.0;a=a+1|0}while((a|0)!=42);a=Wb[k[(k[c>>2]|0)+84>>2]&127](c)|0;if((a|0)>0){n=0;p=42;while(1){yc[k[(k[c>>2]|0)+88>>2]&127](c,n,C+4240|0);w=+o[C+4240>>2];z=+o[C+4240+4>>2];v=+o[C+4240+8>>2];u=w*+o[e+16>>2]+z*+o[e+20>>2]+v*+o[e+24>>2];t=w*+o[e+32>>2]+z*+o[e+36>>2]+v*+o[e+40>>2];o[C+4240>>2]=+o[e>>2]*w+ +o[e+4>>2]*z+ +o[e+8>>2]*v;o[C+4240+4>>2]=u;o[C+4240+8>>2]=t;o[C+4240+12>>2]=0.0;Qv();q=17616+(p<<4)|0;k[q>>2]=k[C+4240>>2];k[q+4>>2]=k[C+4240+4>>2];k[q+8>>2]=k[C+4240+8>>2];k[q+12>>2]=k[C+4240+12>>2];t=+o[C+4240>>2];u=+o[C+4240+4>>2];v=+o[C+4240+8>>2];z=+o[e+4>>2]*-t+ +o[e+20>>2]*-u+ +o[e+36>>2]*-v;w=+o[e+8>>2]*-t+ +o[e+24>>2]*-u+ +o[e+40>>2]*-v;o[C+16+(p<<4)>>2]=+o[e>>2]*-t+ +o[e+16>>2]*-u+ +o[e+32>>2]*-v;o[C+16+(p<<4)+4>>2]=z;o[C+16+(p<<4)+8>>2]=w;o[C+16+(p<<4)+12>>2]=0.0;w=t*+o[f+4>>2]+u*+o[f+20>>2]+v*+o[f+36>>2];z=t*+o[f+8>>2]+u*+o[f+24>>2]+v*+o[f+40>>2];o[C+1008+(p<<4)>>2]=+o[f>>2]*t+ +o[f+16>>2]*u+ +o[f+32>>2]*v;o[C+1008+(p<<4)+4>>2]=w;o[C+1008+(p<<4)+8>>2]=z;o[C+1008+(p<<4)+12>>2]=0.0;if((n|0)==(a+-1|0))break;else{n=n+1|0;p=p+1|0}}a=a+42|0}else a=42;p=Wb[k[(k[d>>2]|0)+84>>2]&127](d)|0;if((p|0)>0){n=0;q=a;while(1){yc[k[(k[d>>2]|0)+88>>2]&127](d,n,C);w=+o[C>>2];z=+o[C+4>>2];v=+o[C+8>>2];u=w*+o[f+16>>2]+z*+o[f+20>>2]+v*+o[f+24>>2];t=w*+o[f+32>>2]+z*+o[f+36>>2]+v*+o[f+40>>2];o[C>>2]=+o[f>>2]*w+ +o[f+4>>2]*z+ +o[f+8>>2]*v;o[C+4>>2]=u;o[C+8>>2]=t;o[C+12>>2]=0.0;Qv();D=17616+(q<<4)|0;k[D>>2]=k[C>>2];k[D+4>>2]=k[C+4>>2];k[D+8>>2]=k[C+8>>2];k[D+12>>2]=k[C+12>>2];t=+o[C>>2];u=+o[C+4>>2];v=+o[C+8>>2];z=+o[e+4>>2]*-t+ +o[e+20>>2]*-u+ +o[e+36>>2]*-v;w=+o[e+8>>2]*-t+ +o[e+24>>2]*-u+ +o[e+40>>2]*-v;o[C+16+(q<<4)>>2]=+o[e>>2]*-t+ +o[e+16>>2]*-u+ +o[e+32>>2]*-v;o[C+16+(q<<4)+4>>2]=z;o[C+16+(q<<4)+8>>2]=w;o[C+16+(q<<4)+12>>2]=0.0;w=t*+o[f+4>>2]+u*+o[f+20>>2]+v*+o[f+36>>2];z=t*+o[f+8>>2]+u*+o[f+24>>2]+v*+o[f+40>>2];o[C+1008+(q<<4)>>2]=+o[f>>2]*t+ +o[f+16>>2]*u+ +o[f+32>>2]*v;o[C+1008+(q<<4)+4>>2]=w;o[C+1008+(q<<4)+8>>2]=z;o[C+1008+(q<<4)+12>>2]=0.0;if((n|0)==(p+-1|0))break;else{n=n+1|0;q=q+1|0}}a=p+a|0}Cc[k[(k[c>>2]|0)+76>>2]&127](c,C+16|0,C+3248|0,a);Cc[k[(k[d>>2]|0)+76>>2]&127](d,C+1008|0,C+2080|0,a);if((a|0)>0){q=a+-1|0;if(x){y=0.0;w=0.0;u=0.0;x=0;t=999999984306749440.0;while(1){Qv();v=+o[17616+(x<<4)>>2];m=+o[17616+(x<<4)+4>>2];s=+o[17616+(x<<4)+12>>2];if(v*v+m*m+0.0>.01?(z=+o[C+3248+(x<<4)>>2],B=+o[C+3248+(x<<4)+4>>2],A=+o[C+3248+(x<<4)+8>>2],G=+o[C+2080+(x<<4)>>2],F=+o[C+2080+(x<<4)+4>>2],E=+o[C+2080+(x<<4)+8>>2],A=v*(G*+o[f>>2]+F*+o[f+4>>2]+E*+o[f+8>>2]+ +o[f+48>>2]-(z*+o[e>>2]+B*+o[e+4>>2]+A*+o[e+8>>2]+ +o[e+48>>2]))+m*(G*+o[f+16>>2]+F*+o[f+20>>2]+E*+o[f+24>>2]+ +o[f+52>>2]-(z*+o[e+16>>2]+B*+o[e+20>>2]+A*+o[e+24>>2]+ +o[e+52>>2]))+0.0,A<t):0){u=v;t=A}else{s=u;m=w;u=y}if((x|0)==(q|0)){v=s;w=0.0;y=m;break}else{y=u;w=m;u=s;x=x+1|0}}}else{A=0.0;z=0.0;m=0.0;s=0.0;x=0;t=999999984306749440.0;while(1){Qv();u=+o[17616+(x<<4)>>2];y=+o[17616+(x<<4)+4>>2];w=+o[17616+(x<<4)+8>>2];v=+o[17616+(x<<4)+12>>2];if(u*u+y*y+w*w>.01?(E=+o[C+3248+(x<<4)>>2],F=+o[C+3248+(x<<4)+4>>2],B=+o[C+3248+(x<<4)+8>>2],I=+o[C+2080+(x<<4)>>2],H=+o[C+2080+(x<<4)+4>>2],G=+o[C+2080+(x<<4)+8>>2],B=u*(I*+o[f>>2]+H*+o[f+4>>2]+G*+o[f+8>>2]+ +o[f+48>>2]-(E*+o[e>>2]+F*+o[e+4>>2]+B*+o[e+8>>2]+ +o[e+48>>2]))+y*(I*+o[f+16>>2]+H*+o[f+20>>2]+G*+o[f+24>>2]+ +o[f+52>>2]-(E*+o[e+16>>2]+F*+o[e+20>>2]+B*+o[e+24>>2]+ +o[e+52>>2]))+w*(I*+o[f+32>>2]+H*+o[f+36>>2]+G*+o[f+40>>2]+ +o[f+56>>2]-(E*+o[e+32>>2]+F*+o[e+36>>2]+B*+o[e+40>>2]+ +o[e+56>>2])),B<t):0){s=y;t=B}else{v=s;w=m;s=z;u=A}if((x|0)==(q|0)){y=s;break}else{A=u;z=s;m=w;s=v;x=x+1|0}}}}else{v=0.0;w=0.0;y=0.0;u=0.0;t=999999984306749440.0}switch(k[c+4>>2]|0){case 4:case 5:case 10:case 11:case 13:case 1:case 0:case 8:break;default:+gc[k[(k[c>>2]|0)+48>>2]&15](c)}switch(k[d+4>>2]|0){case 4:case 5:case 10:case 11:case 13:case 1:case 0:case 8:break;default:+gc[k[(k[d>>2]|0)+48>>2]&15](d)}if(t<0.0){j=0;r=C;return j|0}switch(k[c+4>>2]|0){case 8:{m=+o[c+28>>2]*+o[c+12>>2];break}case 0:{m=+o[c+44>>2];break}case 1:{m=+o[c+44>>2];break}case 13:{m=+o[c+44>>2];break}case 11:{m=+o[c+44>>2];break}case 10:{m=+o[c+44>>2];break}case 4:case 5:{m=+o[c+44>>2];break}default:m=+gc[k[(k[c>>2]|0)+48>>2]&15](c)}q=k[d+4>>2]|0;switch(q|0){case 8:{s=+o[d+28>>2]*+o[d+12>>2];q=8;break}case 0:{s=+o[d+44>>2];q=0;break}case 1:{s=+o[d+44>>2];q=1;break}case 13:{s=+o[d+44>>2];q=13;break}case 11:{s=+o[d+44>>2];q=11;break}case 10:{s=+o[d+44>>2];q=10;break}case 4:case 5:{s=+o[d+44>>2];break}default:{s=+gc[k[(k[d>>2]|0)+48>>2]&15](d);q=k[d+4>>2]|0}}m=t+(m+s+.5);k[C+2e3>>2]=19400;o[C+2e3+4>>2]=0.0;o[C+2e3+8>>2]=1.0;o[C+2e3+12>>2]=0.0;o[C+2e3+16>>2]=0.0;k[C+2e3+20>>2]=0;k[C+2e3+24>>2]=b;k[C+2e3+28>>2]=c;k[C+2e3+32>>2]=d;k[C+2e3+36>>2]=k[c+4>>2];k[C+2e3+40>>2]=q;B=+gc[k[(k[c>>2]|0)+48>>2]&15](c);o[C+2e3+44>>2]=B;B=+gc[k[(k[d>>2]|0)+48>>2]&15](d);o[C+2e3+48>>2]=B;i[C+2e3+52>>0]=0;k[C+2e3+60>>2]=-1;k[C+2e3+72>>2]=1;k[C+2e3+76>>2]=1;B=+o[e+48>>2]+u*m;E=y*m+ +o[e+52>>2];F=w*m+ +o[e+56>>2];k[C+3116>>2]=k[e>>2];k[C+3116+4>>2]=k[e+4>>2];k[C+3116+8>>2]=k[e+8>>2];k[C+3116+12>>2]=k[e+12>>2];k[C+3116+16>>2]=k[e+16>>2];k[C+3116+16+4>>2]=k[e+16+4>>2];k[C+3116+16+8>>2]=k[e+16+8>>2];k[C+3116+16+12>>2]=k[e+16+12>>2];k[C+3116+32>>2]=k[e+32>>2];k[C+3116+32+4>>2]=k[e+32+4>>2];k[C+3116+32+8>>2]=k[e+32+8>>2];k[C+3116+32+12>>2]=k[e+32+12>>2];o[C+3116+48>>2]=B;o[C+3116+52>>2]=E;o[C+3116+56>>2]=F;o[C+3116+60>>2]=0.0;k[C+3116+64>>2]=k[f>>2];k[C+3116+64+4>>2]=k[f+4>>2];k[C+3116+64+8>>2]=k[f+8>>2];k[C+3116+64+12>>2]=k[f+12>>2];k[C+3116+80>>2]=k[f+16>>2];k[C+3116+80+4>>2]=k[f+16+4>>2];k[C+3116+80+8>>2]=k[f+16+8>>2];k[C+3116+80+12>>2]=k[f+16+12>>2];k[C+3116+96>>2]=k[f+32>>2];k[C+3116+96+4>>2]=k[f+32+4>>2];k[C+3116+96+8>>2]=k[f+32+8>>2];k[C+3116+96+12>>2]=k[f+32+12>>2];k[C+3116+112>>2]=k[f+48>>2];k[C+3116+112+4>>2]=k[f+48+4>>2];k[C+3116+112+8>>2]=k[f+48+8>>2];k[C+3116+112+12>>2]=k[f+48+12>>2];o[C+3116+128>>2]=999999984306749440.0;k[C+3072>>2]=18752;i[C+3072+40>>0]=0;o[C+2e3+4>>2]=-u;o[C+2e3+8>>2]=-y;o[C+2e3+12>>2]=-w;o[C+2e3+16>>2]=0.0;Zv(C+2e3|0,C+3116|0,C+3072|0,l,0);m=m-+o[C+3072+36>>2];a=i[C+3072+40>>0]|0;if(a<<24>>24){f=C+3072+20|0;E=+o[C+3072+24>>2]-y*m;F=+o[C+3072+28>>2]-w*m;o[h>>2]=+o[f>>2]-u*m;o[h+4>>2]=E;o[h+8>>2]=F;o[h+12>>2]=0.0;k[j>>2]=k[f>>2];k[j+4>>2]=k[f+4>>2];k[j+8>>2]=k[f+8>>2];k[j+12>>2]=k[f+12>>2];o[g>>2]=u;o[g+4>>2]=y;o[g+8>>2]=w;o[g+12>>2]=v}j=a<<24>>24!=0;r=C;return j|0}function Qv(){if(i[18608]|0)return;if(!(db(18608)|0))return;o[4404]=0.0;o[4405]=-0.0;o[4406]=-1.0;o[4407]=0.0;o[4408]=.7236080169677734;o[4409]=-.5257250070571899;o[4410]=-.44721901416778564;o[4411]=0.0;o[4412]=-.2763879895210266;o[4413]=-.8506489992141724;o[4414]=-.44721901416778564;o[4415]=0.0;o[4416]=-.8944259881973267;o[4417]=-0.0;o[4418]=-.4472160041332245;o[4419]=0.0;o[4420]=-.2763879895210266;o[4421]=.8506489992141724;o[4422]=-.44721999764442444;o[4423]=0.0;o[4424]=.7236080169677734;o[4425]=.5257250070571899;o[4426]=-.44721901416778564;o[4427]=0.0;o[4428]=.2763879895210266;o[4429]=-.8506489992141724;o[4430]=.44721999764442444;o[4431]=0.0;o[4432]=-.7236080169677734;o[4433]=-.5257250070571899;o[4434]=.44721901416778564;o[4435]=0.0;o[4436]=-.7236080169677734;o[4437]=.5257250070571899;o[4438]=.44721901416778564;o[4439]=0.0;o[4440]=.2763879895210266;o[4441]=.8506489992141724;o[4442]=.44721901416778564;o[4443]=0.0;o[4444]=.8944259881973267;o[4445]=0.0;o[4446]=.4472160041332245;o[4447]=0.0;o[4448]=-0.0;o[4449]=0.0;o[4450]=1.0;o[4451]=0.0;o[4452]=.4253230094909668;o[4453]=-.3090110123157501;o[4454]=-.8506540060043335;o[4455]=0.0;o[4456]=-.16245600581169128;o[4457]=-.49999499320983887;o[4458]=-.8506540060043335;o[4459]=0.0;o[4460]=.2628690004348755;o[4461]=-.8090119957923889;o[4462]=-.525738000869751;o[4463]=0.0;o[4464]=.4253230094909668;o[4465]=.3090110123157501;o[4466]=-.8506540060043335;o[4467]=0.0;o[4468]=.8506479859352112;o[4469]=-0.0;o[4470]=-.5257359743118286;o[4471]=0.0;o[4472]=-.5257300138473511;o[4473]=-0.0;o[4474]=-.8506519794464111;o[4475]=0.0;o[4476]=-.6881899833679199;o[4477]=-.49999698996543884;o[4478]=-.5257359743118286;o[4479]=0.0;o[4480]=-.16245600581169128;o[4481]=.49999499320983887;o[4482]=-.8506540060043335;o[4483]=0.0;o[4484]=-.6881899833679199;o[4485]=.49999698996543884;o[4486]=-.5257359743118286;o[4487]=0.0;o[4488]=.2628690004348755;o[4489]=.8090119957923889;o[4490]=-.525738000869751;o[4491]=0.0;o[4492]=.9510579705238342;o[4493]=.3090130090713501;o[4494]=0.0;o[4495]=0.0;o[4496]=.9510579705238342;o[4497]=-.3090130090713501;o[4498]=0.0;o[4499]=0.0;o[4500]=.5877860188484192;o[4501]=-.80901700258255;o[4502]=0.0;o[4503]=0.0;o[4504]=0.0;o[4505]=-1.0;o[4506]=0.0;o[4507]=0.0;o[4508]=-.5877860188484192;o[4509]=-.80901700258255;o[4510]=0.0;o[4511]=0.0;o[4512]=-.9510579705238342;o[4513]=-.3090130090713501;o[4514]=-0.0;o[4515]=0.0;o[4516]=-.9510579705238342;o[4517]=.3090130090713501;o[4518]=-0.0;o[4519]=0.0;o[4520]=-.5877860188484192;o[4521]=.80901700258255;o[4522]=-0.0;o[4523]=0.0;o[4524]=-0.0;o[4525]=1.0;o[4526]=-0.0;o[4527]=0.0;o[4528]=.5877860188484192;o[4529]=.80901700258255;o[4530]=-0.0;o[4531]=0.0;o[4532]=.6881899833679199;o[4533]=-.49999698996543884;o[4534]=.5257359743118286;o[4535]=0.0;o[4536]=-.2628690004348755;o[4537]=-.8090119957923889;o[4538]=.525738000869751;o[4539]=0.0;o[4540]=-.8506479859352112;o[4541]=0.0;o[4542]=.5257359743118286;o[4543]=0.0;o[4544]=-.2628690004348755;o[4545]=.8090119957923889;o[4546]=.525738000869751;o[4547]=0.0;o[4548]=.6881899833679199;o[4549]=.49999698996543884;o[4550]=.5257359743118286;o[4551]=0.0;o[4552]=.5257300138473511;o[4553]=0.0;o[4554]=.8506519794464111;o[4555]=0.0;o[4556]=.16245600581169128;o[4557]=-.49999499320983887;o[4558]=.8506540060043335;o[4559]=0.0;o[4560]=-.4253230094909668;o[4561]=-.3090110123157501;o[4562]=.8506540060043335;o[4563]=0.0;o[4564]=-.4253230094909668;o[4565]=.3090110123157501;o[4566]=.8506540060043335;o[4567]=0.0;o[4568]=.16245600581169128;o[4569]=.49999499320983887;o[4570]=.8506540060043335;o[4571]=0.0;ib(18608);return}function Rv(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;var g=0,h=0.0,j=0.0,l=0.0,m=0.0,n=0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0,x=0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0,Q=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0.0,X=0.0,Z=0.0,_=0.0,$=0.0,aa=0.0,ba=0.0,ca=0.0,da=0.0,ea=0.0,fa=0,ga=0.0;fa=r;r=r+128|0;K=k[a+4>>2]|0;i[K+312>>0]=0;k[K>>2]=0;i[K+356>>0]=1;o[K+292>>2]=999999984306749440.0;o[K+296>>2]=999999984306749440.0;o[K+300>>2]=999999984306749440.0;o[K+304>>2]=0.0;k[K+336>>2]=0;k[K+336+4>>2]=0;k[K+336+8>>2]=0;k[K+336+12>>2]=0;i[K+336+16>>0]=0;i[K+332>>0]=i[K+332>>0]&-16;q=+o[b+48>>2];m=+o[b+52>>2];l=+o[b+56>>2];j=+o[d+48>>2];p=+o[d+52>>2];h=+o[d+56>>2];L=+o[b>>2];M=+o[b+4>>2];N=+o[b+8>>2];O=+o[b+16>>2];P=+o[b+20>>2];Q=+o[b+24>>2];R=+o[b+32>>2];S=+o[b+36>>2];T=+o[b+40>>2];U=+o[d>>2];V=+o[d+4>>2];W=+o[d+8>>2];X=+o[d+16>>2];Z=+o[d+20>>2];_=+o[d+24>>2];$=+o[d+32>>2];aa=+o[d+36>>2];ba=+o[d+40>>2];ca=+o[c+48>>2]-q-(+o[e+48>>2]-j);da=+o[c+52>>2]-m-(+o[e+52>>2]-p);ea=+o[c+56>>2]-l-(+o[e+56>>2]-h);K=k[a+8>>2]|0;g=k[(k[K>>2]|0)+64>>2]|0;o[fa+64>>2]=L*-ca+O*-da+R*-ea;o[fa+64+4>>2]=M*-ca+P*-da+S*-ea;o[fa+64+8>>2]=N*-ca+Q*-da+T*-ea;o[fa+64+12>>2]=0.0;yc[g&127](fa+16|0,K,fa+64|0);G=+o[fa+16>>2];H=+o[fa+16+4>>2];F=+o[fa+16+8>>2];s=G*+o[b>>2]+H*+o[b+4>>2]+F*+o[b+8>>2]+ +o[b+48>>2];u=G*+o[b+16>>2]+H*+o[b+20>>2]+F*+o[b+24>>2]+ +o[b+52>>2];F=G*+o[b+32>>2]+H*+o[b+36>>2]+F*+o[b+40>>2]+ +o[b+56>>2];K=k[a+12>>2]|0;g=k[(k[K>>2]|0)+64>>2]|0;H=ca*+o[d+4>>2]+da*+o[d+20>>2]+ea*+o[d+36>>2];G=ca*+o[d+8>>2]+da*+o[d+24>>2]+ea*+o[d+40>>2];o[fa+80>>2]=ca*+o[d>>2]+da*+o[d+16>>2]+ea*+o[d+32>>2];o[fa+80+4>>2]=H;o[fa+80+8>>2]=G;o[fa+80+12>>2]=0.0;yc[g&127](fa+32|0,K,fa+80|0);G=+o[fa+32>>2];H=+o[fa+32+4>>2];t=+o[fa+32+8>>2];s=s-(G*+o[d>>2]+H*+o[d+4>>2]+t*+o[d+8>>2]+ +o[d+48>>2]);u=u-(G*+o[d+16>>2]+H*+o[d+20>>2]+t*+o[d+24>>2]+ +o[d+52>>2]);t=F-(G*+o[d+32>>2]+H*+o[d+36>>2]+t*+o[d+40>>2]+ +o[d+56>>2]);a:do if(s*s+u*u+t*t>9.999999747378752e-05){C=q;D=m;B=l;A=p;z=h;h=0.0;p=0.0;q=0.0;y=0.0;l=0.0;K=32;m=0.0;while(1){if(!K){m=y;break a}K=K+-1|0;g=k[a+8>>2]|0;x=k[(k[g>>2]|0)+64>>2]|0;G=-s;ga=-u;v=-t;o[fa>>2]=L*G+O*ga+R*v;o[fa+4>>2]=M*G+P*ga+S*v;o[fa+8>>2]=N*G+Q*ga+T*v;o[fa+12>>2]=0.0;yc[x&127](fa+112|0,g,fa);v=+o[fa+112>>2];ga=+o[fa+112+4>>2];G=+o[fa+112+8>>2];E=C+(L*v+M*ga+N*G);F=D+(O*v+P*ga+Q*G);G=B+(R*v+S*ga+T*G);g=k[a+12>>2]|0;x=k[(k[g>>2]|0)+64>>2]|0;o[fa+96>>2]=U*s+X*u+$*t;o[fa+96+4>>2]=V*s+Z*u+aa*t;o[fa+96+8>>2]=W*s+_*u+ba*t;o[fa+96+12>>2]=0.0;yc[x&127](fa+48|0,g,fa+96|0);ga=+o[fa+48>>2];v=+o[fa+48+4>>2];J=+o[fa+48+8>>2];H=j+(U*ga+V*v+W*J);I=A+(X*ga+Z*v+_*J);J=z+($*ga+aa*v+ba*J);v=s*(E-H)+u*(F-I)+t*(G-J);if(l>1.0){g=0;n=23;break}if(v>0.0){q=ca*s+da*u+ea*t;if(q>=-1.4210854715202004e-14){g=0;n=23;break}l=l-v/q;B=(1.0-l)*+o[b+56>>2]+l*+o[c+56>>2];D=(1.0-l)*+o[b+52>>2]+l*+o[c+52>>2];C=+o[b+48>>2]*(1.0-l)+l*+o[c+48>>2];z=(1.0-l)*+o[d+56>>2]+l*+o[e+56>>2];A=(1.0-l)*+o[d+52>>2]+l*+o[e+52>>2];j=(1.0-l)*+o[d+48>>2]+l*+o[e+48>>2];q=t;p=u;h=s}else m=y;w=k[a+4>>2]|0;x=k[w>>2]|0;if((x|0)>0){v=+o[w+308>>2];g=0;n=0;while(1){ga=E-H-+o[w+4+(n<<4)>>2];t=F-I-+o[w+4+(n<<4)+4>>2];u=G-J-+o[w+4+(n<<4)+8>>2];g=g|ga*ga+t*t+u*u<=v;if((n|0)==(x+-1|0))break;else n=n+1|0}}else g=0;if((+o[w+304>>2]==0.0?G-J==+o[w+300>>2]:0)?F-I==+o[w+296>>2]:0)n=E-H==+o[w+292>>2];else n=0;if(!(g|n)){o[w+292>>2]=E-H;o[w+296>>2]=F-I;o[w+300>>2]=G-J;o[w+304>>2]=0.0;i[w+356>>0]=1;o[w+4+(x<<4)>>2]=E-H;o[w+4+(x<<4)+4>>2]=F-I;o[w+4+(x<<4)+8>>2]=G-J;o[w+4+(x<<4)+12>>2]=0.0;g=k[w>>2]|0;o[w+84+(g<<4)>>2]=E;o[w+84+(g<<4)+4>>2]=F;o[w+84+(g<<4)+8>>2]=G;o[w+84+(g<<4)+12>>2]=0.0;g=k[w>>2]|0;o[w+164+(g<<4)>>2]=H;o[w+164+(g<<4)+4>>2]=I;o[w+164+(g<<4)+8>>2]=J;o[w+164+(g<<4)+12>>2]=0.0;k[w>>2]=(k[w>>2]|0)+1;w=k[a+4>>2]|0}g=$v(w)|0;s=+o[w+276>>2];u=+o[w+280>>2];t=+o[w+284>>2];if(!g)break a;if(!(s*s+u*u+t*t>9.999999747378752e-05))break a;else{y=m;m=+o[w+288>>2]}}if((n|0)==23){r=fa;return g|0}}else{m=0.0;q=0.0;p=0.0;h=0.0;l=0.0}while(0);o[f+164>>2]=l;j=q*q+(p*p+h*h);if(!(j>=1.4210854715202004e-14)){m=0.0;l=0.0;j=0.0;h=0.0}else{ba=1.0/+Y(+j);l=q*ba;j=p*ba;h=h*ba}o[f+132>>2]=h;o[f+136>>2]=j;o[f+140>>2]=l;o[f+144>>2]=m;if(ca*h+da*j+ea*l>=-+o[f+172>>2]){a=0;r=fa;return a|0}a=k[a+4>>2]|0;$v(a)|0;rF(f+148|0,a+260|0,16)|0;a=1;r=fa;return a|0}
function Hw(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0,g=0,h=0,i=0,j=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,N=0,O=0,P=0,Q=0,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=0,Z=0,_=0,$=0,aa=0;P=k[d>>2]|0;aa=k[e>>2]|0;if(P)f=k[P+12>>2]|0;else f=b;g=k[f+88>>2]|0;m=k[f+92>>2]|0;h=k[f+96>>2]|0;if(!aa)f=c;else f=k[aa+12>>2]|0;D=k[f+88>>2]|0;o=k[f+92>>2]|0;p=k[f+96>>2]|0;W=k[b+88>>2]|0;_=(k[c+88>>2]|0)-W|0;B=k[b+92>>2]|0;$=(k[c+92>>2]|0)-B|0;Z=k[b+96>>2]|0;T=(k[c+96>>2]|0)-Z|0;V=k[((P|0)!=0?P:aa)+12>>2]|0;X=(k[V+88>>2]|0)-W|0;O=(k[V+92>>2]|0)-B|0;V=(k[V+96>>2]|0)-Z|0;U=(ia(O,T)|0)-(ia(V,$)|0)|0;V=(ia(V,_)|0)-(ia(X,T)|0)|0;O=(ia(X,$)|0)-(ia(O,_)|0)|0;W=AF(U|0,((U|0)<0)<<31>>31|0,W|0,((W|0)<0)<<31>>31|0)|0;X=M;B=AF(V|0,((V|0)<0)<<31>>31|0,B|0,((B|0)<0)<<31>>31|0)|0;C=M;c=AF(O|0,((O|0)<0)<<31>>31|0,Z|0,((Z|0)<0)<<31>>31|0)|0;c=pF(W|0,X|0,c|0,M|0)|0;C=pF(c|0,M|0,B|0,C|0)|0;B=M;c=AF(O|0,((O|0)<0)<<31>>31|0,$|0,(($|0)<0)<<31>>31|0)|0;X=M;W=AF(V|0,((V|0)<0)<<31>>31|0,T|0,((T|0)<0)<<31>>31|0)|0;W=mF(c|0,X|0,W|0,M|0)|0;X=M;c=AF(U|0,((U|0)<0)<<31>>31|0,T|0,((T|0)<0)<<31>>31|0)|0;Z=M;Y=AF(O|0,((O|0)<0)<<31>>31|0,_|0,((_|0)<0)<<31>>31|0)|0;Y=mF(c|0,Z|0,Y|0,M|0)|0;Z=M;c=AF(V|0,((V|0)<0)<<31>>31|0,_|0,((_|0)<0)<<31>>31|0)|0;S=M;R=AF(U|0,((U|0)<0)<<31>>31|0,$|0,(($|0)<0)<<31>>31|0)|0;R=mF(c|0,S|0,R|0,M|0)|0;S=M;c=AF(W|0,X|0,g|0,((g|0)<0)<<31>>31|0)|0;N=M;b=AF(Y|0,Z|0,m|0,((m|0)<0)<<31>>31|0)|0;N=pF(b|0,M|0,c|0,N|0)|0;c=M;b=AF(R|0,S|0,h|0,((h|0)<0)<<31>>31|0)|0;b=pF(N|0,c|0,b|0,M|0)|0;c=M;if((P|0)!=0?(k[P+12>>2]|0)!=0:0){q=P;s=c;l=g;while(1){q=k[(k[q+8>>2]|0)+4>>2]|0;j=q+12|0;g=k[j>>2]|0;c=k[g+88>>2]|0;L=AF(c|0,((c|0)<0)<<31>>31|0,U|0,((U|0)<0)<<31>>31|0)|0;K=M;f=k[g+92>>2]|0;N=AF(f|0,((f|0)<0)<<31>>31|0,V|0,((V|0)<0)<<31>>31|0)|0;K=pF(N|0,M|0,L|0,K|0)|0;L=M;g=k[g+96>>2]|0;N=AF(g|0,((g|0)<0)<<31>>31|0,O|0,((O|0)<0)<<31>>31|0)|0;N=pF(K|0,L|0,N|0,M|0)|0;L=M;if((L|0)<(B|0)|(L|0)==(B|0)&N>>>0<C>>>0){f=m;g=l;c=s;break}if((k[q+20>>2]|0)==(k[a+100>>2]|0)){f=m;g=l;c=s;break}c=AF(c|0,((c|0)<0)<<31>>31|0,W|0,X|0)|0;N=M;n=AF(f|0,((f|0)<0)<<31>>31|0,Y|0,Z|0)|0;N=pF(n|0,M|0,c|0,N|0)|0;c=M;n=AF(g|0,((g|0)<0)<<31>>31|0,R|0,S|0)|0;n=pF(N|0,c|0,n|0,M|0)|0;c=M;if(!((c|0)>(s|0)|(c|0)==(s|0)&n>>>0>b>>>0)){f=m;g=l;c=s;break}k[d>>2]=q;N=k[j>>2]|0;g=k[N+88>>2]|0;f=k[N+92>>2]|0;h=k[N+96>>2]|0;if(!N){b=n;break}else{s=c;b=n;l=g;m=f}}q=k[e>>2]|0}else{q=aa;f=m}j=AF(W|0,X|0,D|0,((D|0)<0)<<31>>31|0)|0;N=M;i=AF(Y|0,Z|0,o|0,((o|0)<0)<<31>>31|0)|0;N=pF(i|0,M|0,j|0,N|0)|0;j=M;i=AF(R|0,S|0,p|0,((p|0)<0)<<31>>31|0)|0;i=pF(N|0,j|0,i|0,M|0)|0;j=M;a:do if(q)if(!(k[q+12>>2]|0))N=D;else{r=q;s=D;while(1){q=k[k[r+8>>2]>>2]|0;n=k[q+12>>2]|0;l=k[n+88>>2]|0;L=AF(l|0,((l|0)<0)<<31>>31|0,U|0,((U|0)<0)<<31>>31|0)|0;K=M;m=k[n+92>>2]|0;N=AF(m|0,((m|0)<0)<<31>>31|0,V|0,((V|0)<0)<<31>>31|0)|0;K=pF(N|0,M|0,L|0,K|0)|0;L=M;n=k[n+96>>2]|0;N=AF(n|0,((n|0)<0)<<31>>31|0,O|0,((O|0)<0)<<31>>31|0)|0;N=pF(K|0,L|0,N|0,M|0)|0;L=M;if((L|0)<(B|0)|(L|0)==(B|0)&N>>>0<C>>>0){q=r;N=s;break a}if((k[q+20>>2]|0)==(k[a+100>>2]|0)){q=r;N=s;break a}L=AF(l|0,((l|0)<0)<<31>>31|0,W|0,X|0)|0;N=M;m=AF(m|0,((m|0)<0)<<31>>31|0,Y|0,Z|0)|0;N=pF(m|0,M|0,L|0,N|0)|0;m=M;n=AF(n|0,((n|0)<0)<<31>>31|0,R|0,S|0)|0;n=pF(N|0,m|0,n|0,M|0)|0;m=M;if(!((m|0)>(j|0)|(m|0)==(j|0)&n>>>0>i>>>0)){q=r;N=s;break a}k[e>>2]=q;N=k[q+12>>2]|0;l=k[N+88>>2]|0;o=k[N+92>>2]|0;p=k[N+96>>2]|0;if(!N){i=n;j=m;N=l;break}else{r=q;j=m;i=n;s=l}}}else{q=0;N=D}while(0);L=mF(i|0,j|0,b|0,c|0)|0;j=M;if((j|0)>0|(j|0)==0&L>>>0>0){J=mF(0,0,O|0,((O|0)<0)<<31>>31|0)|0;K=M;G=h;H=f;I=g;l=p;m=o;n=N;c=L;i=j;b:while(1){F=i;c:while(1){E=(ia(m-H|0,$)|0)+(ia(l-G|0,T)|0)+(ia(n-I|0,_)|0)|0;i=k[d>>2]|0;do if(((i|0)!=0?(k[i+12>>2]|0)!=0:0)?(Q=k[(k[i>>2]|0)+8>>2]|0,(k[Q+20>>2]|0)>(k[a+100>>2]|0)):0){C=k[Q+12>>2]|0;b=k[C+88>>2]|0;D=b-I|0;B=k[C+92>>2]|0;A=B-H|0;C=k[C+96>>2]|0;s=C-G|0;r=AF(D|0,((D|0)<0)<<31>>31|0,W|0,X|0)|0;z=M;u=AF(A|0,((A|0)<0)<<31>>31|0,Y|0,Z|0)|0;z=pF(u|0,M|0,r|0,z|0)|0;r=M;u=AF(s|0,((s|0)<0)<<31>>31|0,R|0,S|0)|0;u=pF(z|0,r|0,u|0,M|0)|0;r=M;s=(ia(A,$)|0)+(ia(D,_)|0)+(ia(s,T)|0)|0;if((u|0)==0&(r|0)==0)if((s|0)<0)break c;else break;if((r|0)<0){if((s|0)>0){t=1;D=s;A=((s|0)<0)<<31>>31}else{D=mF(0,0,s|0,((s|0)<0)<<31>>31|0)|0;t=(s|0)<0?-1:0;D=(s|0)<0?D:0;A=(s|0)<0?M:0}z=0-t|0;y=mF(0,0,u|0,r|0)|0;x=M;if((E|0)>0){v=1;u=1;t=E;s=((E|0)<0)<<31>>31}else{t=mF(0,0,E|0,((E|0)<0)<<31>>31|0)|0;v=(E|0)<0?-1:0;u=(E|0)<0?-1:0;t=(E|0)<0?t:0;s=(E|0)<0?M:0}if(!((F|0)>0|(F|0)==0&c>>>0>0))if((F|0)<0){w=mF(0,0,c|0,F|0)|0;v=0-u|0;u=M}else{w=0;u=0}else{w=c;u=F}if((Dw(D,A,y,x,z,t,s,w,u,v)|0)>-1)break c}}while(0);i=k[e>>2]|0;if(!i){c=89;break b}if(!(k[i+12>>2]|0)){c=89;break b}D=k[k[i+8>>2]>>2]|0;if((k[D+20>>2]|0)<=(k[a+100>>2]|0)){c=89;break b}r=k[D+12>>2]|0;t=k[r+88>>2]|0;s=t-n|0;i=k[r+92>>2]|0;m=i-m|0;r=k[r+96>>2]|0;n=r-l|0;C=AF(s|0,((s|0)<0)<<31>>31|0,U|0,((U|0)<0)<<31>>31|0)|0;A=M;B=AF(m|0,((m|0)<0)<<31>>31|0,V|0,((V|0)<0)<<31>>31|0)|0;A=pF(B|0,M|0,C|0,A|0)|0;C=M;B=AF(n|0,((n|0)<0)<<31>>31|0,J|0,K|0)|0;if(!((A|0)==(B|0)&(C|0)==(M|0))){c=89;break b}u=AF(s|0,((s|0)<0)<<31>>31|0,W|0,X|0)|0;z=M;v=AF(m|0,((m|0)<0)<<31>>31|0,Y|0,Z|0)|0;z=pF(v|0,M|0,u|0,z|0)|0;u=M;v=AF(n|0,((n|0)<0)<<31>>31|0,R|0,S|0)|0;v=pF(z|0,u|0,v|0,M|0)|0;u=M;s=(ia(m,$)|0)+(ia(s,_)|0)+(ia(n,T)|0)|0;z=t-I|0;B=i-H|0;A=r-G|0;z=AF(z|0,((z|0)<0)<<31>>31|0,W|0,X|0)|0;C=M;B=AF(B|0,((B|0)<0)<<31>>31|0,Y|0,Z|0)|0;C=pF(B|0,M|0,z|0,C|0)|0;z=M;A=AF(A|0,((A|0)<0)<<31>>31|0,R|0,S|0)|0;A=pF(C|0,z|0,A|0,M|0)|0;z=M;if(!((z|0)>0|(z|0)==0&A>>>0>0)){c=89;break b}if((v|0)==0&(u|0)==0){if((s|0)>=0){c=89;break b}}else{if((u|0)>=0){c=89;break b}if((s|0)>0){n=1;y=s;x=((s|0)<0)<<31>>31}else{y=mF(0,0,s|0,((s|0)<0)<<31>>31|0)|0;n=(s|0)<0?-1:0;y=(s|0)<0?y:0;x=(s|0)<0?M:0}w=0-n|0;v=mF(0,0,v|0,u|0)|0;t=M;if((E|0)>0){s=1;r=1;m=E;u=((E|0)<0)<<31>>31}else{m=mF(0,0,E|0,((E|0)<0)<<31>>31|0)|0;s=(E|0)<0?-1:0;r=(E|0)<0?-1:0;m=(E|0)<0?m:0;u=(E|0)<0?M:0}do if((F|0)>0|(F|0)==0&c>>>0>0)n=F;else{if((F|0)>=0){c=0;n=0;break}c=mF(0,0,c|0,F|0)|0;s=0-r|0;n=M}while(0);if((Dw(y,x,v,t,w,m,u,c,n,s)|0)<=0){c=89;break b}}k[e>>2]=D;l=k[D+12>>2]|0;n=k[l+88>>2]|0;m=k[l+92>>2]|0;l=k[l+96>>2]|0;F=z;c=A}G=n-b|0;I=m-B|0;c=l-C|0;G=AF(G|0,((G|0)<0)<<31>>31|0,W|0,X|0)|0;H=M;I=AF(I|0,((I|0)<0)<<31>>31|0,Y|0,Z|0)|0;H=pF(I|0,M|0,G|0,H|0)|0;G=M;c=AF(c|0,((c|0)<0)<<31>>31|0,R|0,S|0)|0;c=pF(H|0,G|0,c|0,M|0)|0;k[d>>2]=(i|0)==(P|0)?0:Q;G=C;H=B;I=b;i=M}if((c|0)==89)return}if((j|0)>=0)return;K=mF(0,0,O|0,((O|0)<0)<<31>>31|0)|0;J=M;l=p;n=o;i=N;c=q;q=L;while(1){m=(ia(n-f|0,$)|0)+(ia(l-h|0,T)|0)+(ia(i-g|0,_)|0)|0;d:do if(!c){x=l;y=n;z=i;s=m;D=m;t=((m|0)<0)<<31>>31}else{D=m;B=m;C=((m|0)<0)<<31>>31;A=q;while(1){if(!(k[c+12>>2]|0)){x=l;y=n;z=i;s=D;D=B;t=C;q=A;break d}w=k[(k[c+4>>2]|0)+8>>2]|0;if((k[w+20>>2]|0)<=(k[a+100>>2]|0)){x=l;y=n;z=i;s=D;D=B;t=C;q=A;break d}x=k[w+12>>2]|0;z=k[x+88>>2]|0;Q=z-i|0;y=k[x+92>>2]|0;P=y-n|0;x=k[x+96>>2]|0;m=x-l|0;b=AF(Q|0,((Q|0)<0)<<31>>31|0,W|0,X|0)|0;O=M;o=AF(P|0,((P|0)<0)<<31>>31|0,Y|0,Z|0)|0;O=pF(o|0,M|0,b|0,O|0)|0;b=M;o=AF(m|0,((m|0)<0)<<31>>31|0,R|0,S|0)|0;o=pF(O|0,b|0,o|0,M|0)|0;b=M;m=(ia(P,$)|0)+(ia(Q,_)|0)+(ia(m,T)|0)|0;if((o|0)==0&(b|0)==0){if((m|0)<=0){x=l;y=n;z=i;s=D;D=B;t=C;q=A;break d}}else{if((b|0)>=0){x=l;y=n;z=i;s=D;D=B;t=C;q=A;break d}if((m|0)>0){p=1;v=m;u=((m|0)<0)<<31>>31}else{v=mF(0,0,m|0,((m|0)<0)<<31>>31|0)|0;p=(m|0)<0?-1:0;v=(m|0)<0?v:0;u=(m|0)<0?M:0}t=0-p|0;m=mF(0,0,o|0,b|0)|0;b=M;if((D|0)>0){p=1;q=1;r=B;s=C}else{s=(D|0)<0;r=mF(0,0,B|0,C|0)|0;p=s?-1:0;q=s?-1:0;r=s?r:0;s=s?M:0}if(!((j|0)>0|(j|0)==0&A>>>0>0))if((j|0)<0){o=mF(0,0,A|0,j|0)|0;p=0-q|0;q=o;o=M}else{q=0;o=0}else{q=A;o=j}if((Dw(v,u,m,b,t,r,s,q,o,p)|0)>=1){x=l;y=n;z=i;s=D;D=B;t=C;q=A;break d}}m=z-g|0;P=y-f|0;Q=x-h|0;j=AF(m|0,((m|0)<0)<<31>>31|0,W|0,X|0)|0;O=M;q=AF(P|0,((P|0)<0)<<31>>31|0,Y|0,Z|0)|0;O=pF(q|0,M|0,j|0,O|0)|0;j=M;q=AF(Q|0,((Q|0)<0)<<31>>31|0,R|0,S|0)|0;q=pF(O|0,j|0,q|0,M|0)|0;j=M;c=(c|0)==(aa|0)?0:w;k[e>>2]=c;m=(ia(P,$)|0)+(ia(Q,T)|0)+(ia(m,_)|0)|0;if(!c){s=m;D=m;t=((m|0)<0)<<31>>31;break}else{i=z;n=y;l=x;D=m;B=m;C=((m|0)<0)<<31>>31;A=q}}}while(0);c=k[d>>2]|0;if(!c){c=89;break}if(!(k[c+12>>2]|0)){c=89;break}u=k[(k[c+8>>2]|0)+4>>2]|0;if((k[u+20>>2]|0)<=(k[a+100>>2]|0)){c=89;break}l=k[u+12>>2]|0;c=k[l+88>>2]|0;m=c-g|0;g=k[l+92>>2]|0;n=g-f|0;l=k[l+96>>2]|0;i=l-h|0;Q=AF(m|0,((m|0)<0)<<31>>31|0,U|0,((U|0)<0)<<31>>31|0)|0;O=M;P=AF(n|0,((n|0)<0)<<31>>31|0,V|0,((V|0)<0)<<31>>31|0)|0;O=pF(P|0,M|0,Q|0,O|0)|0;Q=M;P=AF(i|0,((i|0)<0)<<31>>31|0,K|0,J|0)|0;if(!((O|0)==(P|0)&(Q|0)==(M|0))){c=89;break}o=AF(m|0,((m|0)<0)<<31>>31|0,W|0,X|0)|0;v=M;p=AF(n|0,((n|0)<0)<<31>>31|0,Y|0,Z|0)|0;v=pF(p|0,M|0,o|0,v|0)|0;o=M;p=AF(i|0,((i|0)<0)<<31>>31|0,R|0,S|0)|0;p=pF(v|0,o|0,p|0,M|0)|0;o=M;n=(ia(n,$)|0)+(ia(m,_)|0)+(ia(i,T)|0)|0;v=z-c|0;P=y-g|0;w=x-l|0;v=AF(v|0,((v|0)<0)<<31>>31|0,W|0,X|0)|0;Q=M;P=AF(P|0,((P|0)<0)<<31>>31|0,Y|0,Z|0)|0;Q=pF(P|0,M|0,v|0,Q|0)|0;v=M;w=AF(w|0,((w|0)<0)<<31>>31|0,R|0,S|0)|0;w=pF(Q|0,v|0,w|0,M|0)|0;v=M;if((v|0)>=0){c=89;break}if((p|0)==0&(o|0)==0){if((n|0)<=0){c=89;break}}else{if((o|0)>=0){c=89;break}if((n|0)>0){i=1;b=n;c=((n|0)<0)<<31>>31}else{b=mF(0,0,n|0,((n|0)<0)<<31>>31|0)|0;i=(n|0)<0?-1:0;b=(n|0)<0?b:0;c=(n|0)<0?M:0}g=0-i|0;p=mF(0,0,p|0,o|0)|0;o=M;if((s|0)>0){h=1;n=1;l=D;m=t}else{m=(s|0)<0;l=mF(0,0,D|0,t|0)|0;h=m?-1:0;n=m?-1:0;l=m?l:0;m=m?M:0}do if((j|0)>0|(j|0)==0&q>>>0>0)i=q;else{if((j|0)>=0){i=0;j=0;break}i=mF(0,0,q|0,j|0)|0;h=0-n|0;j=M}while(0);if((Dw(b,c,p,o,g,l,m,i,j,h)|0)>=0){c=89;break}}k[d>>2]=u;g=k[u+12>>2]|0;h=k[g+96>>2]|0;f=k[g+92>>2]|0;g=k[g+88>>2]|0;l=x;n=y;i=z;c=k[e>>2]|0;q=w;j=v}if((c|0)==89)return}function Iw(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0.0,h=0,j=0,l=0,m=0,n=0.0,p=0.0,q=0,s=0,t=0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0,C=0,D=0,E=0,F=0,G=0,H=0;H=r;r=r+256|0;if((c|0)<1){d=k[a+12>>2]|0;if(d){if(i[a+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[a+12>>2]=0}i[a+16>>0]=1;k[a+12>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;d=k[a+32>>2]|0;if(d){if(i[a+36>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[a+32>>2]=0}i[a+36>>0]=1;k[a+32>>2]=0;k[a+24>>2]=0;k[a+28>>2]=0;d=k[a+52>>2]|0;if(d){if(i[a+56>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[a+52>>2]=0}i[a+56>>0]=1;k[a+52>>2]=0;k[a+44>>2]=0;k[a+48>>2]=0;r=H;return}k[H+128+32>>2]=0;k[H+128+36>>2]=0;E=H+128+40|0;k[E>>2]=0;k[H+128+44>>2]=256;k[H+128+48>>2]=0;k[H+128+52>>2]=0;k[H+128+56>>2]=0;k[H+128+60>>2]=256;k[H+128+64>>2]=0;k[H+128+68>>2]=0;k[H+128+72>>2]=0;k[H+128+76>>2]=256;i[H+128+96>>0]=1;D=H+128+92|0;k[D>>2]=0;k[H+128+84>>2]=0;k[H+128+88>>2]=0;v=1000000015047466219876688.0e6;u=1000000015047466219876688.0e6;x=1000000015047466219876688.0e6;y=-1000000015047466219876688.0e6;z=-1000000015047466219876688.0e6;A=-1000000015047466219876688.0e6;h=0;f=b;while(1){p=+o[f>>2];g=+o[f+4>>2];w=+o[f+8>>2];v=p<v?p:v;u=g<u?g:u;x=w<x?w:x;y=y<p?p:y;z=z<g?g:z;A=A<w?w:A;if((h|0)==(c+-1|0))break;else{h=h+1|0;f=f+16|0}}p=y-v;n=z-u;w=A-x;if(p<n){k[H+128+112>>2]=n<w?2:1;m=p<w?0:2;e=H+128+112|0}else{k[H+128+112>>2]=p<w?2:0;m=n<w?1:2;e=H+128+112|0}k[H+128+104>>2]=m;l=k[e>>2]|0;if((m|0)==(l|0)){m=((m+1|0)>>>0)%3|0;k[H+128+104>>2]=m;l=k[e>>2]|0}C=3-l-m|0;k[H+128+108>>2]=C;if(((C+1|0)%3|0|0)==(k[e>>2]|0)){g=p*9.788566967472434e-05;n=n*9.788566967472434e-05;p=w*9.788566967472434e-05}else{g=-(p*9.788566967472434e-05);n=-(n*9.788566967472434e-05);p=-(w*9.788566967472434e-05)}o[H+128>>2]=g;o[H+128+4>>2]=n;o[H+128+8>>2]=p;o[H+128+12>>2]=0.0;if(g!=0.0)g=1.0/g;if(n!=0.0)n=1.0/n;if(p!=0.0)p=1.0/p;o[H+128+16>>2]=(v+y)*.5;o[H+128+20>>2]=(u+z)*.5;o[H+128+24>>2]=(x+A)*.5;o[H+128+28>>2]=0.0;B=H+104+16|0;i[B>>0]=1;s=H+104+12|0;k[s>>2]=0;C=H+104+4|0;k[C>>2]=0;k[H+104+8>>2]=0;if((c|0)>0){k[5108]=(k[5108]|0)+1;h=iF((c<<4|3)+16|0)|0;if(!h)q=0;else{k[(h+4+15&-16)+-4>>2]=h;q=h+4+15&-16}m=k[C>>2]|0;if((m|0)>0){l=k[s>>2]|0;f=0;while(1){h=q+(f<<4)|0;if(h){t=l+(f<<4)|0;k[h>>2]=k[t>>2];k[h+4>>2]=k[t+4>>2];k[h+8>>2]=k[t+8>>2];k[h+12>>2]=k[t+12>>2]}if((f|0)==(m+-1|0))break;else f=f+1|0}}else l=k[s>>2]|0;if(l){if(i[B>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[l+-4>>2]|0)}k[s>>2]=0}i[B>>0]=1;k[s>>2]=q;k[H+104+8>>2]=c;l=q;m=0;while(1){l=l+(m<<4)|0;if(l){k[l>>2]=k[H+64>>2];k[l+4>>2]=k[H+64+4>>2];k[l+8>>2]=k[H+64+8>>2];k[l+12>>2]=k[H+64+12>>2]}if((m|0)==(c+-1|0))break;l=k[s>>2]|0;m=m+1|0}k[C>>2]=c;f=k[s>>2]|0;u=+o[H+128+16>>2];v=+o[H+128+20>>2];w=+o[H+128+24>>2];t=H+16+(k[H+128+108>>2]<<2)|0;m=H+16+(k[e>>2]<<2)|0;l=H+16+(k[H+128+104>>2]<<2)|0;h=0;q=b;while(1){A=+o[q>>2];o[H+16>>2]=A;x=+o[q+4>>2];o[H+16+4>>2]=x;y=p*(+o[q+8>>2]-w);o[H+16>>2]=g*(A-u);o[H+16+4>>2]=n*(x-v);o[H+16+8>>2]=y;o[H+16+12>>2]=0.0;k[f+(h<<4)>>2]=~~+o[t>>2];k[f+(h<<4)+4>>2]=~~+o[m>>2];k[f+(h<<4)+8>>2]=~~+o[l>>2];k[f+(h<<4)+12>>2]=h;if((h|0)==(c+-1|0))break;else{h=h+1|0;q=q+16|0}}if((c|0)>1)rx(H+104|0,0,c+-1|0)}else k[C>>2]=c;k[H+128+36>>2]=k[H+128+32>>2];k[E>>2]=0;k[H+128+44>>2]=c;e=k[H+128+84>>2]|0;if((e|0)<(c|0)){if((k[H+128+88>>2]|0)<(c|0)){if(!c){f=0;d=e}else{k[5108]=(k[5108]|0)+1;f=iF((c<<2|3)+16|0)|0;if(!f)f=0;else{k[(f+4+15&-16)+-4>>2]=f;f=f+4+15&-16}d=k[H+128+84>>2]|0}if((d|0)>0){h=d+-1|0;d=0;while(1){j=f+(d<<2)|0;if(j)k[j>>2]=k[(k[D>>2]|0)+(d<<2)>>2];if((d|0)==(h|0))break;else d=d+1|0}}d=k[D>>2]|0;if(d){if(i[H+128+96>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[D>>2]=0}i[H+128+96>>0]=1;k[D>>2]=f;k[H+128+88>>2]=c}while(1){f=(k[D>>2]|0)+(e<<2)|0;if(f)k[f>>2]=0;if((e|0)==(c+-1|0))break;else e=e+1|0}}k[H+128+84>>2]=c;if((c|0)>0){q=0;while(1){f=k[E>>2]|0;if(!f){f=k[H+128+36>>2]|0;if(!f){k[5108]=(k[5108]|0)+1;e=iF(31)|0;if((e|0)!=0?(F=e+4+15&-16,k[F+-4>>2]=e,(e+4+15&-16|0)!=0):0){f=k[H+128+44>>2]|0;k[F+4>>2]=f;k[F+8>>2]=0;k[5108]=(k[5108]|0)+1;f=iF((f*112|3)+16|0)|0;if(!f)h=0;else{k[(f+4+15&-16)+-4>>2]=f;h=f+4+15&-16}k[(e+4+15&-16)>>2]=h;f=e+4+15&-16}else f=0;k[f+8>>2]=k[H+128+32>>2];k[H+128+32>>2]=f}else k[H+128+36>>2]=k[f+8>>2];j=k[f+4>>2]|0;f=k[f>>2]|0;if((j|0)>0){h=0;e=f;do{m=h;h=h+1|0;l=e;e=e+112|0;k[l>>2]=(h|0)<(j|0)?e:0}while((m|0)!=(j+-1|0))}k[E>>2]=k[f>>2];if(!f)f=0;else G=88}else{k[E>>2]=k[f>>2];G=88}if((G|0)==88){G=0;k[f>>2]=0;k[f+4>>2]=0;k[f+8>>2]=0;k[f+12>>2]=0;k[f+16>>2]=0;k[f+104>>2]=-1}k[f+8>>2]=0;m=f+88|0;l=(k[s>>2]|0)+(q<<4)|0;k[m>>2]=k[l>>2];k[m+4>>2]=k[l+4>>2];k[m+8>>2]=k[l+8>>2];k[m+12>>2]=k[l+12>>2];k[f+104>>2]=-1;k[(k[D>>2]|0)+(q<<2)>>2]=f;if((q|0)==(c+-1|0))break;else q=q+1|0}}f=k[s>>2]|0;if(f){if(i[B>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[f+-4>>2]|0)}k[s>>2]=0}i[B>>0]=1;k[s>>2]=0;k[C>>2]=0;k[H+104+8>>2]=0;k[H+128+52>>2]=k[H+128+48>>2];k[H+128+56>>2]=0;k[H+128+60>>2]=c*6;k[H+128+116>>2]=0;k[H+128+120>>2]=0;k[H+128+100>>2]=-3;k[H+32>>2]=0;k[H+32+4>>2]=0;k[H+32+8>>2]=0;k[H+32+12>>2]=0;Fw(H+128|0,0,c,H+32|0);k[H+128+124>>2]=k[H+32>>2];e=k[s>>2]|0;if(e){if(i[B>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0)}k[s>>2]=0}d=k[a+4>>2]|0;if((d|0)<0){if((k[a+8>>2]|0)<0){e=k[a+12>>2]|0;if(e){if(i[a+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0)}k[a+12>>2]=0}i[a+16>>0]=1;k[a+12>>2]=0;k[a+8>>2]=0}while(1){G=(k[a+12>>2]|0)+(d<<4)|0;k[G>>2]=k[H>>2];k[G+4>>2]=k[H+4>>2];k[G+8>>2]=k[H+8>>2];k[G+12>>2]=k[H+12>>2];if((d|0)==-1)break;else d=d+1|0}}k[a+4>>2]=0;k[H+48>>2]=0;k[H+48+4>>2]=0;k[H+48+8>>2]=0;e=k[a+24>>2]|0;if((e|0)<0){if((k[a+28>>2]|0)<0){d=k[a+32>>2]|0;if(d){if(i[a+36>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[a+32>>2]=0}i[a+36>>0]=1;k[a+32>>2]=0;k[a+28>>2]=0}while(1){d=(k[a+32>>2]|0)+(e*12|0)|0;if(d){k[d>>2]=k[H+48>>2];k[d+4>>2]=k[H+48+4>>2];k[d+8>>2]=k[H+48+8>>2]}if((e|0)==-1)break;else e=e+1|0}}k[a+24>>2]=0;d=k[a+44>>2]|0;if((d|0)<0){e=k[a+52>>2]|0;if((k[a+48>>2]|0)<0){if(e){if(i[a+56>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0)}k[a+52>>2]=0}i[a+56>>0]=1;k[a+52>>2]=0;k[a+48>>2]=0;e=0}while(1){f=e+(d<<2)|0;if(f)k[f>>2]=0;if((d|0)==-1)break;else d=d+1|0}}k[a+44>>2]=0;f=k[H+128+124>>2]|0;if((k[f+104>>2]|0)<0){k[f+104>>2]=0;k[5108]=(k[5108]|0)+1;e=iF(23)|0;if(e){k[(e+4+15&-16)+-4>>2]=e;d=e+4+15&-16;if(e+4+15&-16)k[d>>2]=f}else d=0;j=1;f=1;G=0;while(1){q=k[d+(G<<2)>>2]|0;if((k[q+100>>2]|0)>-1){o[H+104+(k[H+128+108>>2]<<2)>>2]=+(k[q+88>>2]|0);o[H+104+(k[H+128+112>>2]<<2)>>2]=+(k[q+92>>2]|0);g=+(k[q+96>>2]|0)}else{y=+sx(k[q+24>>2]|0,k[q+24+4>>2]|0,k[q+32>>2]|0,k[q+32+4>>2]|0);g=+sx(k[q+72>>2]|0,k[q+72+4>>2]|0,k[q+80>>2]|0,k[q+80+4>>2]|0);o[H+104+(k[H+128+108>>2]<<2)>>2]=y/g;y=+sx(k[q+40>>2]|0,k[q+40+4>>2]|0,k[q+48>>2]|0,k[q+48+4>>2]|0)/g;o[H+104+(k[H+128+112>>2]<<2)>>2]=y;g=+sx(k[q+56>>2]|0,k[q+56+4>>2]|0,k[q+64>>2]|0,k[q+64+4>>2]|0)/g}o[H+104+(k[H+128+104>>2]<<2)>>2]=g;p=+o[H+104>>2]*+o[H+128>>2]+ +o[H+128+16>>2];n=+o[H+104+4>>2]*+o[H+128+4>>2]+ +o[H+128+20>>2];g=+o[H+104+8>>2]*+o[H+128+8>>2]+ +o[H+128+24>>2];e=k[a+4>>2]|0;do if((e|0)==(k[a+8>>2]|0)){m=(e|0)==0?1:e<<1;if((e|0)>=(m|0))break;if(!m)l=0;else{k[5108]=(k[5108]|0)+1;e=iF((m<<4|3)+16|0)|0;if(!e)e=0;else{k[(e+4+15&-16)+-4>>2]=e;e=e+4+15&-16}l=e;e=k[a+4>>2]|0}if((e|0)>0){h=e+-1|0;e=0;while(1){C=l+(e<<4)|0;B=(k[a+12>>2]|0)+(e<<4)|0;k[C>>2]=k[B>>2];k[C+4>>2]=k[B+4>>2];k[C+8>>2]=k[B+8>>2];k[C+12>>2]=k[B+12>>2];if((e|0)==(h|0))break;else e=e+1|0}}e=k[a+12>>2]|0;if(e){if(i[a+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0)}k[a+12>>2]=0}i[a+16>>0]=1;k[a+12>>2]=l;k[a+8>>2]=m;e=k[a+4>>2]|0}while(0);F=k[a+12>>2]|0;o[F+(e<<4)>>2]=p;o[F+(e<<4)+4>>2]=n;o[F+(e<<4)+8>>2]=g;o[F+(e<<4)+12>>2]=0.0;k[a+4>>2]=(k[a+4>>2]|0)+1;F=k[q+8>>2]|0;if(!F)e=j;else{s=f;b=d;E=F;h=-1;D=-1;while(1){C=E+20|0;f=k[C>>2]|0;if((f|0)<0){B=k[a+24>>2]|0;k[H+92>>2]=0;k[H+92+4>>2]=0;k[H+92+8>>2]=0;f=k[a+28>>2]|0;do if((B|0)==(f|0)){f=(B|0)==0?1:B<<1;if((B|0)>=(f|0)){l=B;f=B;break}if(!f){e=0;d=B}else{k[5108]=(k[5108]|0)+1;e=iF((f*12|3)+16|0)|0;if(!e)e=0;else{k[(e+4+15&-16)+-4>>2]=e;e=e+4+15&-16}d=k[a+24>>2]|0}if((d|0)>0){l=d+-1|0;m=0;while(1){d=e+(m*12|0)|0;if(d){q=(k[a+32>>2]|0)+(m*12|0)|0;k[d>>2]=k[q>>2];k[d+4>>2]=k[q+4>>2];k[d+8>>2]=k[q+8>>2]}if((m|0)==(l|0))break;else m=m+1|0}}d=k[a+32>>2]|0;if(d){if(i[a+36>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[a+32>>2]=0}i[a+36>>0]=1;k[a+32>>2]=e;k[a+28>>2]=f;l=k[a+24>>2]|0}else l=B;while(0);e=(k[a+32>>2]|0)+(l*12|0)|0;if(!e)e=l;else{k[e>>2]=k[H+92>>2];k[e+4>>2]=k[H+92+4>>2];k[e+8>>2]=k[H+92+8>>2];e=k[a+24>>2]|0;f=k[a+28>>2]|0}e=e+1|0;k[a+24>>2]=e;k[H+80>>2]=0;k[H+80+4>>2]=0;k[H+80+8>>2]=0;do if((e|0)==(f|0)){q=(f|0)==0?1:f<<1;if((f|0)>=(q|0))break;if(!q)e=0;else{k[5108]=(k[5108]|0)+1;f=iF((q*12|3)+16|0)|0;if(!f)f=0;else{k[(f+4+15&-16)+-4>>2]=f;f=f+4+15&-16}e=f;f=k[a+24>>2]|0}if((f|0)>0){l=f+-1|0;m=0;while(1){f=e+(m*12|0)|0;if(f){c=(k[a+32>>2]|0)+(m*12|0)|0;k[f>>2]=k[c>>2];k[f+4>>2]=k[c+4>>2];k[f+8>>2]=k[c+8>>2]}if((m|0)==(l|0))break;else m=m+1|0}}f=k[a+32>>2]|0;if(f){if(i[a+36>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[f+-4>>2]|0)}k[a+32>>2]=0}i[a+36>>0]=1;k[a+32>>2]=e;k[a+28>>2]=q;f=k[a+24>>2]|0}else f=e;while(0);d=k[a+32>>2]|0;e=d+(f*12|0)|0;if(!e)t=d;else{k[e>>2]=k[H+80>>2];k[e+4>>2]=k[H+80+4>>2];k[e+8>>2]=k[H+80+8>>2];f=k[a+24>>2]|0;t=k[a+32>>2]|0}k[a+24>>2]=f+1;k[C>>2]=B;k[(k[E+8>>2]|0)+20>>2]=B+1;k[t+(B*12|0)+4>>2]=1;k[t+((B+1|0)*12|0)+4>>2]=-1;q=k[E+12>>2]|0;m=k[q+104>>2]|0;if((m|0)<0){k[q+104>>2]=j;do if((j|0)==(s|0)){f=(s|0)==0?1:s<<1;if((s|0)>=(f|0)){d=b;f=s;break}do if(!f)d=0;else{k[5108]=(k[5108]|0)+1;e=iF((f<<2|3)+16|0)|0;if(!e){d=0;break}k[(e+4+15&-16)+-4>>2]=e;d=e+4+15&-16}while(0);if((s|0)>0){m=s+-1|0;e=0;while(1){l=d+(e<<2)|0;if(l)k[l>>2]=k[b+(e<<2)>>2];if((e|0)==(m|0))break;else e=e+1|0}}if(!b)break;k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}else{d=b;f=s}while(0);e=d+(j<<2)|0;if(e)k[e>>2]=q;e=j+1|0}else{d=b;f=s;e=j;j=m}k[t+(B*12|0)+8>>2]=j;k[t+((B+1|0)*12|0)+8>>2]=G;m=k[C>>2]|0}else{m=f;d=b;f=s;e=j}if((D|0)>-1)k[(k[a+32>>2]|0)+(m*12|0)>>2]=D-m;else h=m;E=k[E>>2]|0;if((E|0)==(F|0))break;else{j=e;s=f;b=d;D=m}}k[(k[a+32>>2]|0)+(h*12|0)>>2]=m-h}b=G+1|0;if((b|0)<(e|0)){j=e;G=b}else break}if((G|0)>-1){t=0;do{q=k[(k[d+(t<<2)>>2]|0)+8>>2]|0;if(q){s=q;do{l=s+20|0;if((k[l>>2]|0)>-1){f=k[a+44>>2]|0;do if((f|0)==(k[a+48>>2]|0)){m=(f|0)==0?1:f<<1;if((f|0)>=(m|0))break;if(!m)j=0;else{k[5108]=(k[5108]|0)+1;f=iF((m<<2|3)+16|0)|0;if(!f)f=0;else{k[(f+4+15&-16)+-4>>2]=f;f=f+4+15&-16}j=f;f=k[a+44>>2]|0}if((f|0)>0){f=f+-1|0;h=0;while(1){e=j+(h<<2)|0;if(e)k[e>>2]=k[(k[a+52>>2]|0)+(h<<2)>>2];if((h|0)==(f|0))break;else h=h+1|0}}f=k[a+52>>2]|0;if(f){if(i[a+56>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[f+-4>>2]|0)}k[a+52>>2]=0}i[a+56>>0]=1;k[a+52>>2]=j;k[a+48>>2]=m;f=k[a+44>>2]|0}while(0);e=(k[a+52>>2]|0)+(f<<2)|0;if(e){k[e>>2]=k[l>>2];f=k[a+44>>2]|0}k[a+44>>2]=f+1;f=s;do{k[f+20>>2]=-1;f=k[(k[f+8>>2]|0)+4>>2]|0}while((f|0)!=(s|0))}s=k[s>>2]|0}while((s|0)!=(q|0))}t=t+1|0}while((t|0)<(b|0))}if(d){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}}tx(H+128|0);r=H;return}function Jw(a,b){a=a|0;b=b|0;var c=0,d=0.0,e=0.0,f=0.0,g=0,h=0.0,i=0,j=0;g=r;r=r+16|0;d=+o[a>>2];e=+o[a+20>>2];f=+o[a+40>>2];if(d+e+f>0.0){f=+Y(+(d+e+f+1.0));o[g+12>>2]=f*.5;h=(+o[a+36>>2]-+o[a+24>>2])*(.5/f);o[g>>2]=h;d=(+o[a+8>>2]-+o[a+32>>2])*(.5/f);o[g+4>>2]=d;e=(+o[a+16>>2]-+o[a+4>>2])*(.5/f);o[g+8>>2]=e;f=f*.5;o[b>>2]=h;a=b+4|0;o[a>>2]=d;a=b+8|0;o[a>>2]=e;b=b+12|0;o[b>>2]=f;r=g;return}if(d<e)c=e<f?2:1;else c=d<f?2:0;j=((c+1|0)>>>0)%3|0;i=((c+2|0)>>>0)%3|0;d=+Y(+(+o[a+(c<<4)+(c<<2)>>2]-+o[a+(j<<4)+(j<<2)>>2]-+o[a+(i<<4)+(i<<2)>>2]+1.0));o[g+(c<<2)>>2]=d*.5;o[g+12>>2]=(+o[a+(i<<4)+(j<<2)>>2]-+o[a+(j<<4)+(i<<2)>>2])*(.5/d);o[g+(j<<2)>>2]=(+o[a+(j<<4)+(c<<2)>>2]+ +o[a+(c<<4)+(j<<2)>>2])*(.5/d);o[g+(i<<2)>>2]=(+o[a+(i<<4)+(c<<2)>>2]+ +o[a+(c<<4)+(i<<2)>>2])*(.5/d);d=+o[g>>2];e=+o[g+4>>2];h=+o[g+8>>2];f=+o[g+12>>2];o[b>>2]=d;a=b+4|0;o[a>>2]=e;a=b+8|0;o[a>>2]=h;b=b+12|0;o[b>>2]=f;r=g;return}function Kw(a){a=a|0;var b=0,c=0;b=r;r=r+16|0;pb(a|0)|0;if(yb(20632,3)|0)FE(20640,b);a=wb(k[5156]|0)|0;if(((a|0)!=0?(c=k[a>>2]|0,(c|0)!=0):0)?((k[c+48>>2]&-256|0)==1126902528?(k[c+48+4>>2]|0)==1129074247:0):0)JE(k[c+12>>2]|0);c=k[5112]|0;k[5112]=c+0;JE(c)}function Lw(){if(i[808]|0)return;if(!(db(808)|0))return;if((i[864]|0)==0?(db(864)|0)!=0:0){o[204]=1.0;k[205]=0;k[206]=0;k[207]=0;k[208]=0;o[209]=1.0;k[210]=0;k[211]=0;k[212]=0;k[213]=0;o[214]=1.0;o[215]=0.0;ib(864)};k[186]=k[204];k[187]=k[205];k[188]=k[206];k[189]=k[207];k[190]=k[208];k[191]=k[209];k[192]=k[210];k[193]=k[211];k[194]=k[212];k[195]=k[213];k[196]=k[214];k[197]=k[215];k[198]=0;k[199]=0;k[200]=0;k[201]=0;ib(808);return}function Mw(a,b,c){a=a|0;b=b|0;c=c|0;k[a>>2]=664;k[a+4>>2]=k[b>>2];k[a+4+4>>2]=k[b+4>>2];k[a+4+8>>2]=k[b+8>>2];k[a+4+12>>2]=k[b+12>>2];k[a+20>>2]=k[b+16>>2];k[a+20+4>>2]=k[b+16+4>>2];k[a+20+8>>2]=k[b+16+8>>2];k[a+20+12>>2]=k[b+16+12>>2];k[a+36>>2]=k[b+32>>2];k[a+36+4>>2]=k[b+32+4>>2];k[a+36+8>>2]=k[b+32+8>>2];k[a+36+12>>2]=k[b+32+12>>2];k[a+52>>2]=k[b+48>>2];k[a+52+4>>2]=k[b+48+4>>2];k[a+52+8>>2]=k[b+48+8>>2];k[a+52+12>>2]=k[b+48+12>>2];k[a+68>>2]=k[c>>2];k[a+68+4>>2]=k[c+4>>2];k[a+68+8>>2]=k[c+8>>2];k[a+68+12>>2]=k[c+12>>2];k[a+84>>2]=k[c+16>>2];k[a+84+4>>2]=k[c+16+4>>2];k[a+84+8>>2]=k[c+16+8>>2];k[a+84+12>>2]=k[c+16+12>>2];k[a+100>>2]=k[c+32>>2];k[a+100+4>>2]=k[c+32+4>>2];k[a+100+8>>2]=k[c+32+8>>2];k[a+100+12>>2]=k[c+32+12>>2];k[a+116>>2]=k[c+48>>2];k[a+116+4>>2]=k[c+48+4>>2];k[a+116+8>>2]=k[c+48+8>>2];k[a+116+12>>2]=k[c+48+12>>2];k[a+132>>2]=k[b>>2];k[a+132+4>>2]=k[b+4>>2];k[a+132+8>>2]=k[b+8>>2];k[a+132+12>>2]=k[b+12>>2];k[a+148>>2]=k[b+16>>2];k[a+148+4>>2]=k[b+16+4>>2];k[a+148+8>>2]=k[b+16+8>>2];k[a+148+12>>2]=k[b+16+12>>2];k[a+164>>2]=k[b+32>>2];k[a+164+4>>2]=k[b+32+4>>2];k[a+164+8>>2]=k[b+32+8>>2];k[a+164+12>>2]=k[b+32+12>>2];k[a+180>>2]=k[b+48>>2];k[a+180+4>>2]=k[b+48+4>>2];k[a+180+8>>2]=k[b+48+8>>2];k[a+180+12>>2]=k[b+48+12>>2];k[a+196>>2]=0;return}function Nw(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,k=0.0;if(!(+o[a+344>>2]!=0.0))return;Ow(a,b);f=+o[b>>2]*+o[a+348>>2];h=+o[b+4>>2]*+o[a+352>>2];j=+o[b+8>>2]*+o[a+356>>2];g=+o[c+4>>2];k=+o[c+8>>2];i=+o[c>>2];e=(+o[a+280>>2]*(g*j-k*h)+ +o[a+284>>2]*(k*f-i*j)+ +o[a+288>>2]*(i*h-g*f))*+o[a+548>>2];d=(+o[a+296>>2]*(g*j-k*h)+ +o[a+300>>2]*(k*f-i*j)+ +o[a+304>>2]*(i*h-g*f))*+o[a+552>>2];o[a+328>>2]=+o[a+328>>2]+(+o[a+264>>2]*(g*j-k*h)+ +o[a+268>>2]*(k*f-i*j)+ +o[a+272>>2]*(i*h-g*f))*+o[a+544>>2];o[a+332>>2]=+o[a+332>>2]+e;o[a+336>>2]=+o[a+336>>2]+d;return}function Ow(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0.0;e=+o[a+344>>2];d=+o[b+4>>2]*+o[a+352>>2]*e;c=+o[b+8>>2]*+o[a+356>>2]*e;o[a+312>>2]=+o[a+312>>2]+ +o[b>>2]*+o[a+348>>2]*e;o[a+316>>2]=+o[a+316>>2]+d;o[a+320>>2]=+o[a+320>>2]+c;return}function Pw(a){a=a|0;o[a>>2]=1.0;k[a+4>>2]=0;k[a+4+4>>2]=0;k[a+4+8>>2]=0;k[a+4+12>>2]=0;o[a+20>>2]=1.0;k[a+24>>2]=0;k[a+24+4>>2]=0;k[a+24+8>>2]=0;k[a+24+12>>2]=0;o[a+40>>2]=1.0;o[a+44>>2]=0.0;k[a+48>>2]=0;k[a+48+4>>2]=0;k[a+48+8>>2]=0;k[a+48+12>>2]=0;return}function Qw(a,b,c,d,e,f,g){a=a|0;b=+b;c=+c;d=+d;e=e|0;f=+f;g=g|0;var h=0.0,i=0.0,j=0,k=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0;j=r;r=r+16|0;i=c*f+ +o[a+52>>2];h=d*f+ +o[a+56>>2];o[g+48>>2]=b*f+ +o[a+48>>2];o[g+52>>2]=i;o[g+56>>2]=h;o[g+60>>2]=0.0;h=+o[e>>2];i=+o[e+4>>2];c=+o[e+8>>2];b=+Y(+(h*h+i*i+c*c));if(b*f>.7853981852531433)b=.7853981852531433/f;if(b<1.0000000474974513e-03)d=f*.5-b*(f*f*f*.02083333395421505*b);else d=+$(+(b*.5*f))/b;m=d*h;i=d*i;d=d*c;p=+_(+(b*f*.5));Jw(a,j);l=+o[j>>2];n=+o[j+12>>2];b=+o[j+8>>2];f=+o[j+4>>2];q=1.0/+Y(+((p*n-m*l-i*f-d*b)*(p*n-m*l-i*f-d*b)+((d*n+p*b+m*f-i*l)*(d*n+p*b+m*f-i*l)+((p*l+m*n+i*b-d*f)*(p*l+m*n+i*b-d*f)+(d*l+(i*n+p*f)-m*b)*(d*l+(i*n+p*f)-m*b)))));c=(p*l+m*n+i*b-d*f)*q;h=q*(d*l+(i*n+p*f)-m*b);k=q*(d*n+p*b+m*f-i*l);b=q*(p*n-m*l-i*f-d*b);d=c*(2.0/(b*b+(k*k+(c*c+h*h))));f=2.0/(b*b+(k*k+(c*c+h*h)))*h;i=2.0/(b*b+(k*k+(c*c+h*h)))*k;o[g>>2]=1.0-(k*i+h*f);o[g+4>>2]=c*f-b*i;o[g+8>>2]=c*i+b*f;o[g+12>>2]=0.0;o[g+16>>2]=b*i+c*f;o[g+20>>2]=1.0-(c*d+k*i);o[g+24>>2]=h*i-b*d;o[g+28>>2]=0.0;o[g+32>>2]=c*i-b*f;o[g+36>>2]=b*d+h*i;o[g+40>>2]=1.0-(c*d+h*f);o[g+44>>2]=0.0;r=j;return}function Rw(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0;i=r;r=r+64|0;h=+o[a+20>>2];t=+o[a+40>>2];m=+o[a+24>>2];q=+o[a+36>>2];s=+o[a+32>>2];g=+o[a+16>>2];j=+o[a>>2];f=+o[a+4>>2];n=+o[a+8>>2];k=1.0/((h*t-m*q)*j+f*(m*s-t*g)+(q*g-h*s)*n);z=+o[b>>2];y=+o[b+4>>2];x=+o[b+8>>2];w=+o[b+16>>2];v=+o[b+20>>2];u=+o[b+24>>2];p=+o[b+32>>2];l=+o[b+36>>2];e=+o[b+40>>2];o[i+16>>2]=(h*t-m*q)*k*z+(m*s-t*g)*k*y+(q*g-h*s)*k*x;o[i+16+4>>2]=z*(k*(q*n-t*f))+y*(k*(t*j-s*n))+k*(s*f-q*j)*x;o[i+16+8>>2]=z*(k*(m*f-h*n))+y*(k*(g*n-m*j))+k*(h*j-g*f)*x;o[i+16+12>>2]=0.0;o[i+16+16>>2]=(h*t-m*q)*k*w+(m*s-t*g)*k*v+(q*g-h*s)*k*u;o[i+16+20>>2]=k*(q*n-t*f)*w+k*(t*j-s*n)*v+k*(s*f-q*j)*u;o[i+16+24>>2]=k*(m*f-h*n)*w+k*(g*n-m*j)*v+k*(h*j-g*f)*u;o[i+16+28>>2]=0.0;o[i+16+32>>2]=(h*t-m*q)*k*p+(m*s-t*g)*k*l+(q*g-h*s)*k*e;o[i+16+36>>2]=k*(q*n-t*f)*p+k*(t*j-s*n)*l+k*(s*f-q*j)*e;o[i+16+40>>2]=k*(m*f-h*n)*p+k*(g*n-m*j)*l+k*(h*j-g*f)*e;o[i+16+44>>2]=0.0;Jw(i+16|0,i);e=+o[i>>2];f=+o[i+4>>2];g=+o[i+8>>2];j=+o[i+12>>2];h=1.0/+Y(+(e*e+f*f+g*g+j*j));o[i>>2]=e*h;o[i+4>>2]=f*h;o[i+8>>2]=g*h;o[i+12>>2]=j*h;j=j*h<-1.0?-1.0:j*h;j=+ba(+(j>1.0?1.0:j))*2.0;o[d>>2]=j;o[c>>2]=e*h;o[c+4>>2]=f*h;o[c+8>>2]=g*h;o[c+12>>2]=0.0;if(e*h*(e*h)+f*h*(f*h)+g*h*(g*h)<1.4210854715202004e-14){o[c>>2]=1.0;o[c+4>>2]=0.0;o[c+8>>2]=0.0;o[c+12>>2]=0.0;r=i;return}else{z=1.0/+Y(+(e*h*(e*h)+f*h*(f*h)+g*h*(g*h)));o[c>>2]=e*h*z;o[c+4>>2]=z*(f*h);o[c+8>>2]=z*(g*h);r=i;return}}function Sw(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0;d=r;r=r+48|0;y=+o[c>>2];s=+o[b>>2];x=+o[c+16>>2];q=+o[b+4>>2];w=+o[c+32>>2];g=+o[b+8>>2];v=+o[c+4>>2];u=+o[c+20>>2];t=+o[c+36>>2];h=+o[c+8>>2];j=+o[c+24>>2];m=+o[c+40>>2];p=+o[b+16>>2];n=+o[b+20>>2];f=+o[b+24>>2];l=+o[b+32>>2];i=+o[b+36>>2];e=+o[b+40>>2];o[d>>2]=y*s+x*q+w*g;o[d+4>>2]=v*s+u*q+t*g;o[d+8>>2]=h*s+j*q+m*g;o[d+12>>2]=0.0;o[d+16>>2]=y*p+x*n+w*f;o[d+20>>2]=v*p+u*n+t*f;o[d+24>>2]=h*p+j*n+m*f;o[d+28>>2]=0.0;o[d+32>>2]=y*l+x*i+w*e;o[d+36>>2]=v*l+u*i+t*e;o[d+40>>2]=h*l+j*i+m*e;o[d+44>>2]=0.0;m=+o[c+48>>2];j=+o[c+52>>2];h=+o[c+56>>2];g=m*s+j*q+h*g+ +o[b+48>>2];f=m*p+j*n+h*f+ +o[b+52>>2];e=m*l+j*i+h*e+ +o[b+56>>2];k[a>>2]=k[d>>2];k[a+4>>2]=k[d+4>>2];k[a+8>>2]=k[d+8>>2];k[a+12>>2]=k[d+12>>2];k[a+16>>2]=k[d+16>>2];k[a+16+4>>2]=k[d+16+4>>2];k[a+16+8>>2]=k[d+16+8>>2];k[a+16+12>>2]=k[d+16+12>>2];k[a+32>>2]=k[d+32>>2];k[a+32+4>>2]=k[d+32+4>>2];k[a+32+8>>2]=k[d+32+8>>2];k[a+32+12>>2]=k[d+32+12>>2];o[a+48>>2]=g;o[a+52>>2]=f;o[a+56>>2]=e;o[a+60>>2]=0.0;r=d;return}function Tw(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,i=0,j=0,l=0;while(1){j=k[a+12>>2]|0;l=k[j+(((b+c|0)/2|0)<<2)>>2]|0;d=b;e=c;while(1){i=k[(k[l+28>>2]|0)+208>>2]|0;if((i|0)>-1)while(1){g=k[j+(d<<2)>>2]|0;f=k[(k[g+28>>2]|0)+208>>2]|0;if((f|0)<=-1)f=k[(k[g+32>>2]|0)+208>>2]|0;if((f|0)<(i|0))d=d+1|0;else break}else{h=k[(k[l+32>>2]|0)+208>>2]|0;while(1){g=k[j+(d<<2)>>2]|0;f=k[(k[g+28>>2]|0)+208>>2]|0;if((f|0)<=-1)f=k[(k[g+32>>2]|0)+208>>2]|0;if((f|0)<(h|0))d=d+1|0;else break}}if((i|0)>-1)while(1){h=k[j+(e<<2)>>2]|0;f=k[(k[h+28>>2]|0)+208>>2]|0;if((f|0)<=-1)f=k[(k[h+32>>2]|0)+208>>2]|0;if((i|0)<(f|0))e=e+-1|0;else{f=h;break}}else{i=k[(k[l+32>>2]|0)+208>>2]|0;while(1){h=k[j+(e<<2)>>2]|0;f=k[(k[h+28>>2]|0)+208>>2]|0;if((f|0)<=-1)f=k[(k[h+32>>2]|0)+208>>2]|0;if((i|0)<(f|0))e=e+-1|0;else{f=h;break}}}if((d|0)<=(e|0)){k[j+(d<<2)>>2]=f;k[(k[a+12>>2]|0)+(e<<2)>>2]=g;d=d+1|0;e=e+-1|0}if((d|0)>(e|0))break;j=k[a+12>>2]|0}if((e|0)>(b|0))Tw(a,b,e);if((d|0)<(c|0))b=d;else break}return}function Uw(a){a=a|0;var b=0,c=0,d=0,e=0,f=0,g=0,h=0;c=k[a+32>>2]|0;if(!c)d=0;else d=k[a+40>>2]|0;g=k[a+52>>2]|0;if(!g)e=0;else e=k[a+60>>2]|0;b=k[a+72>>2]|0;if(!b)f=0;else f=k[a+80>>2]|0;h=k[a+8>>2]|0;+pc[k[(k[h>>2]|0)+12>>2]&3](h,d,c,e,g,f,b,k[a+4>>2]|0,k[a+20>>2]|0,k[a+24>>2]|0);b=k[a+32>>2]|0;if((b|0)<0){if((k[a+36>>2]|0)<0){c=k[a+40>>2]|0;if(c){if(i[a+44>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[a+40>>2]=0}i[a+44>>0]=1;k[a+40>>2]=0;k[a+36>>2]=0}while(1){c=(k[a+40>>2]|0)+(b<<2)|0;if(c)k[c>>2]=0;if((b|0)==-1)break;else b=b+1|0}}k[a+32>>2]=0;c=k[a+52>>2]|0;if((c|0)<0){if((k[a+56>>2]|0)<0){b=k[a+60>>2]|0;if(b){if(i[a+64>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+60>>2]=0}i[a+64>>0]=1;k[a+60>>2]=0;k[a+56>>2]=0}while(1){b=(k[a+60>>2]|0)+(c<<2)|0;if(b)k[b>>2]=0;if((c|0)==-1)break;else c=c+1|0}}k[a+52>>2]=0;c=k[a+72>>2]|0;if((c|0)>=0){k[a+72>>2]=0;return}if((k[a+76>>2]|0)<0){b=k[a+80>>2]|0;if(b){if(i[a+84>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+80>>2]=0}i[a+84>>0]=1;k[a+80>>2]=0;k[a+76>>2]=0}while(1){b=(k[a+80>>2]|0)+(c<<2)|0;if(b)k[b>>2]=0;if((c|0)==-1)break;else c=c+1|0}k[a+72>>2]=0;return}function Vw(a,b,c,d,e,f,g,h,i,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=+h;i=i|0;j=+j;var l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0;k[a>>2]=k[f>>2];k[a+4>>2]=k[f+4>>2];k[a+8>>2]=k[f+8>>2];k[a+12>>2]=k[f+12>>2];s=+o[d+4>>2];v=+o[a+8>>2];w=+o[d+8>>2];p=+o[a+4>>2];l=+o[a>>2];r=+o[d>>2];u=(s*v-w*p)*+o[b>>2]+ +o[b+4>>2]*(w*l-v*r)+(p*r-s*l)*+o[b+8>>2];t=(s*v-w*p)*+o[b+16>>2]+(w*l-v*r)*+o[b+20>>2]+(p*r-s*l)*+o[b+24>>2];s=(s*v-w*p)*+o[b+32>>2]+(w*l-v*r)*+o[b+36>>2]+(p*r-s*l)*+o[b+40>>2];o[a+16>>2]=u;o[a+20>>2]=t;o[a+24>>2]=s;o[a+28>>2]=0.0;r=+o[e+4>>2];w=+o[e+8>>2];m=+o[e>>2];q=+o[c>>2]*(r*-v-w*-p)+ +o[c+4>>2]*(w*-l-m*-v)+(m*-p-r*-l)*+o[c+8>>2];n=(r*-v-w*-p)*+o[c+16>>2]+(w*-l-m*-v)*+o[c+20>>2]+(m*-p-r*-l)*+o[c+24>>2];l=(r*-v-w*-p)*+o[c+32>>2]+(w*-l-m*-v)*+o[c+36>>2]+(m*-p-r*-l)*+o[c+40>>2];o[a+32>>2]=q;o[a+36>>2]=n;o[a+40>>2]=l;o[a+44>>2]=0.0;u=+o[g>>2]*u;t=+o[g+4>>2]*t;s=+o[g+8>>2]*s;o[a+48>>2]=u;o[a+52>>2]=t;o[a+56>>2]=s;o[a+60>>2]=0.0;r=+o[i>>2]*q;p=+o[i+4>>2]*n;m=+o[i+8>>2]*l;o[a+64>>2]=r;o[a+68>>2]=p;o[a+72>>2]=m;o[a+76>>2]=0.0;o[a+80>>2]=u*+o[a+16>>2]+t*+o[a+20>>2]+s*+o[a+24>>2]+h+j+(r*q+p*n+m*l);return}function Ww(a,b,c){a=+a;b=+b;c=+c;var d=0.0,e=0.0;if(b>=c)return +a;if(a<b){d=+kF(b-a,6.2831854820251465);if(!(d<-3.1415927410125732)){if(d>3.1415927410125732)d=d+-6.2831854820251465}else d=d+6.2831854820251465;e=+X(+d);d=+kF(c-a,6.2831854820251465);if(!(d<-3.1415927410125732)){if(d>3.1415927410125732)d=d+-6.2831854820251465}else d=d+6.2831854820251465;if(e<+X(+d))return +a;a=a+6.2831854820251465;return +a}if(!(a>c))return +a;d=+kF(a-c,6.2831854820251465);if(!(d<-3.1415927410125732)){if(d>3.1415927410125732)d=d+-6.2831854820251465}else d=d+6.2831854820251465;e=+X(+d);d=+kF(a-b,6.2831854820251465);if(!(d<-3.1415927410125732)){if(d>3.1415927410125732)d=d+-6.2831854820251465}else d=d+6.2831854820251465;if(!(+X(+d)<e))return +a;a=a+-6.2831854820251465;return +a}function Xw(a){a=a|0;var b=0;k[a>>2]=1464;b=k[a+496>>2]|0;if(b){if(i[a+500>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+496>>2]=0}i[a+500>>0]=1;k[a+496>>2]=0;k[a+488>>2]=0;k[a+492>>2]=0;return}function Yw(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0,j=0,l=0;g=k[a+4>>2]|0;if((g|0)==(k[a+8>>2]|0)?(f=(g|0)==0?1:g<<1,(g|0)<(f|0)):0){if(!f){c=0;d=g}else{k[5108]=(k[5108]|0)+1;c=iF((f*244|3)+16|0)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}d=k[a+4>>2]|0}if((d|0)>0){d=d+-1|0;e=0;while(1){j=c+(e*244|0)|0;h=k[a+12>>2]|0;l=h+(e*244|0)|0;k[j>>2]=k[l>>2];k[j+4>>2]=k[l+4>>2];k[j+8>>2]=k[l+8>>2];k[j+12>>2]=k[l+12>>2];j=c+(e*244|0)+16|0;l=h+(e*244|0)+16|0;k[j>>2]=k[l>>2];k[j+4>>2]=k[l+4>>2];k[j+8>>2]=k[l+8>>2];k[j+12>>2]=k[l+12>>2];j=c+(e*244|0)+32|0;l=h+(e*244|0)+32|0;k[j>>2]=k[l>>2];k[j+4>>2]=k[l+4>>2];k[j+8>>2]=k[l+8>>2];k[j+12>>2]=k[l+12>>2];j=c+(e*244|0)+48|0;l=h+(e*244|0)+48|0;k[j>>2]=k[l>>2];k[j+4>>2]=k[l+4>>2];k[j+8>>2]=k[l+8>>2];k[j+12>>2]=k[l+12>>2];qF(c+(e*244|0)+64|0,h+(e*244|0)+64|0,180)|0;if((e|0)==(d|0))break;else e=e+1|0}}d=k[a+12>>2]|0;if(d){if(i[a+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[a+12>>2]=0}i[a+16>>0]=1;k[a+12>>2]=c;k[a+8>>2]=f;c=k[a+4>>2]|0}else c=g;k[a+4>>2]=c+1;l=k[a+12>>2]|0;k[l+(g*244|0)>>2]=k[b>>2];k[l+(g*244|0)+4>>2]=k[b+4>>2];k[l+(g*244|0)+8>>2]=k[b+8>>2];k[l+(g*244|0)+12>>2]=k[b+12>>2];k[l+(g*244|0)+16>>2]=k[b+16>>2];k[l+(g*244|0)+16+4>>2]=k[b+16+4>>2];k[l+(g*244|0)+16+8>>2]=k[b+16+8>>2];k[l+(g*244|0)+16+12>>2]=k[b+16+12>>2];k[l+(g*244|0)+32>>2]=k[b+32>>2];k[l+(g*244|0)+32+4>>2]=k[b+32+4>>2];k[l+(g*244|0)+32+8>>2]=k[b+32+8>>2];k[l+(g*244|0)+32+12>>2]=k[b+32+12>>2];k[l+(g*244|0)+48>>2]=k[b+48>>2];k[l+(g*244|0)+48+4>>2]=k[b+48+4>>2];k[l+(g*244|0)+48+8>>2]=k[b+48+8>>2];k[l+(g*244|0)+48+12>>2]=k[b+48+12>>2];qF(l+(g*244|0)+64|0,b+64|0,180)|0;return (k[a+12>>2]|0)+(g*244|0)|0}function Zw(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,i=0,j=0,l=0;while(1){j=k[a+12>>2]|0;l=k[j+(((b+c|0)/2|0)<<2)>>2]|0;d=b;e=c;while(1){i=k[(k[l+740>>2]|0)+208>>2]|0;if((i|0)>-1)while(1){g=k[j+(d<<2)>>2]|0;f=k[(k[g+740>>2]|0)+208>>2]|0;if((f|0)<=-1)f=k[(k[g+744>>2]|0)+208>>2]|0;if((f|0)<(i|0))d=d+1|0;else break}else{h=k[(k[l+744>>2]|0)+208>>2]|0;while(1){g=k[j+(d<<2)>>2]|0;f=k[(k[g+740>>2]|0)+208>>2]|0;if((f|0)<=-1)f=k[(k[g+744>>2]|0)+208>>2]|0;if((f|0)<(h|0))d=d+1|0;else break}}if((i|0)>-1)while(1){h=k[j+(e<<2)>>2]|0;f=k[(k[h+740>>2]|0)+208>>2]|0;if((f|0)<=-1)f=k[(k[h+744>>2]|0)+208>>2]|0;if((i|0)<(f|0))e=e+-1|0;else{f=h;break}}else{i=k[(k[l+744>>2]|0)+208>>2]|0;while(1){h=k[j+(e<<2)>>2]|0;f=k[(k[h+740>>2]|0)+208>>2]|0;if((f|0)<=-1)f=k[(k[h+744>>2]|0)+208>>2]|0;if((i|0)<(f|0))e=e+-1|0;else{f=h;break}}}if((d|0)<=(e|0)){k[j+(d<<2)>>2]=f;k[(k[a+12>>2]|0)+(e<<2)>>2]=g;d=d+1|0;e=e+-1|0}if((d|0)>(e|0))break;j=k[a+12>>2]|0}if((e|0)>(b|0))Zw(a,b,e);if((d|0)<(c|0))b=d;else break}return}function _w(a,b){a=a|0;b=+b;o[a+44>>2]=b;return}function $w(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0;i=+o[c+48>>2]-+o[b+48>>2];g=+o[c+52>>2]-+o[b+52>>2];e=+o[c+56>>2]-+o[b+56>>2];p=+o[b>>2];y=+o[c>>2];n=+o[b+16>>2];x=+o[c+16>>2];m=+o[b+32>>2];w=+o[c+32>>2];v=+o[c+4>>2];u=+o[c+20>>2];t=+o[c+36>>2];s=+o[c+8>>2];r=+o[c+24>>2];q=+o[c+40>>2];l=+o[b+4>>2];k=+o[b+20>>2];j=+o[b+36>>2];h=+o[b+8>>2];f=+o[b+24>>2];d=+o[b+40>>2];o[a>>2]=p*y+n*x+m*w;o[a+4>>2]=p*v+n*u+m*t;o[a+8>>2]=p*s+n*r+m*q;o[a+12>>2]=0.0;o[a+16>>2]=y*l+x*k+w*j;o[a+20>>2]=v*l+u*k+t*j;o[a+24>>2]=s*l+r*k+q*j;o[a+28>>2]=0.0;o[a+32>>2]=y*h+x*f+w*d;o[a+36>>2]=v*h+u*f+t*d;o[a+40>>2]=s*h+r*f+q*d;o[a+44>>2]=0.0;o[a+48>>2]=i*p+g*n+e*m;o[a+52>>2]=i*l+g*k+e*j;o[a+56>>2]=i*h+g*f+e*d;o[a+60>>2]=0.0;return}function ax(a){a=a|0;return}function bx(a){a=a|0;var b=0;b=k[a+72>>2]|0;if(b){if(i[a+76>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+72>>2]=0}i[a+76>>0]=1;k[a+72>>2]=0;k[a+64>>2]=0;k[a+68>>2]=0;b=k[a+52>>2]|0;if(b){if(i[a+56>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+52>>2]=0}i[a+56>>0]=1;k[a+52>>2]=0;k[a+44>>2]=0;k[a+48>>2]=0;b=k[a+32>>2]|0;if(b){if(i[a+36>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+32>>2]=0}i[a+36>>0]=1;k[a+32>>2]=0;k[a+24>>2]=0;k[a+28>>2]=0;b=k[a+12>>2]|0;if(!b){i[a+16>>0]=1;k[a+12>>2]=0;k[a+4>>2]=0;a=a+8|0;k[a>>2]=0;return}if(i[a+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+12>>2]=0;i[a+16>>0]=1;k[a+12>>2]=0;k[a+4>>2]=0;a=a+8|0;k[a>>2]=0;return}function cx(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,i=0,j=0,l=0,m=0;while(1){i=k[a+12>>2]|0;j=k[i+(((b+c|0)/2|0)<<3)>>2]|0;d=b;e=c;while(1){h=d;while(1){d=h+1|0;if((k[i+(h<<3)>>2]|0)<(j|0))h=d;else break}while(1){f=i+(e<<3)|0;g=e+-1|0;if((j|0)<(k[f>>2]|0))e=g;else break}if((h|0)>(e|0))d=h;else{l=i+(h<<3)|0;h=k[l>>2]|0;i=k[l+4>>2]|0;m=k[f+4>>2]|0;k[l>>2]=k[f>>2];k[l+4>>2]=m;e=(k[a+12>>2]|0)+(e<<3)|0;k[e>>2]=h;k[e+4>>2]=i;e=g}if((d|0)>(e|0))break;i=k[a+12>>2]|0}if((e|0)>(b|0))cx(a,b,e);if((d|0)<(c|0))b=d;else break}return}function dx(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,i=0,j=0,l=0.0,m=0,n=0.0,p=0.0,q=0.0,r=0,s=0.0,t=0.0,u=0;if(!a)return;n=+o[b>>2];p=+o[b+4>>2];q=+o[b+8>>2];s=+o[b+16>>2];t=+o[b+20>>2];l=+o[b+24>>2];k[5108]=(k[5108]|0)+1;d=iF(275)|0;if(d){k[(d+4+15&-16)+-4>>2]=d;b=d+4+15&-16;if(d+4+15&-16)k[b>>2]=a}else b=0;d=1;a=64;do{j=d+-1|0;h=k[b+(j<<2)>>2]|0;do if(((((+o[h>>2]<=s?+o[h+16>>2]>=n:0)?+o[h+4>>2]<=t:0)?+o[h+20>>2]>=p:0)?+o[h+8>>2]<=l:0)?+o[h+24>>2]>=q:0){if(!(k[h+40>>2]|0)){Ub[k[(k[c>>2]|0)+12>>2]&127](c,h);d=j;break}i=k[h+36>>2]|0;if((j|0)==(a|0)?(m=(a|0)==0?1:a<<1,(d|0)<=(m|0)):0){if((m|0)!=0?(k[5108]=(k[5108]|0)+1,r=iF((m<<2|3)+16|0)|0,(r|0)!=0):0){k[(r+4+15&-16)+-4>>2]=r;g=r+4+15&-16}else g=0;if((d|0)>1){f=d+-2|0;a=0;while(1){e=g+(a<<2)|0;if(e)k[e>>2]=k[b+(a<<2)>>2];if((a|0)==(f|0))break;else a=a+1|0}}if(!b){b=g;a=m}else{k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0);b=g;a=m}}e=b+(j<<2)|0;if(e)k[e>>2]=i;h=k[h+40>>2]|0;if((d|0)==(a|0)){e=(d|0)==0?1:d<<1;if((d|0)<(e|0)){if((e|0)!=0?(k[5108]=(k[5108]|0)+1,u=iF((e<<2|3)+16|0)|0,(u|0)!=0):0){k[(u+4+15&-16)+-4>>2]=u;a=u+4+15&-16}else a=0;if((d|0)>0){g=0;while(1){f=a+(g<<2)|0;if(f)k[f>>2]=k[b+(g<<2)>>2];if((g|0)==(j|0))break;else g=g+1|0}}if(!b)b=a;else{k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0);b=a}}else e=d}else e=a;a=b+(d<<2)|0;if(a)k[a>>2]=h;d=d+1|0;a=e}else d=j;while(0)}while((d|0)>0);if(!b)return;k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0);return}function ex(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0;f=r;r=r+160|0;d=k[a+4>>2]|0;e=k[d+12>>2]|0;D=+o[e>>2];C=+o[e+4>>2];B=+o[e+8>>2];A=+o[e+16>>2];z=+o[e+20>>2];y=+o[e+24>>2];q=+o[e+32>>2];n=+o[e+36>>2];l=+o[e+40>>2];d=k[(k[d+4>>2]|0)+24>>2]|0;x=+o[d+(c*80|0)>>2];w=+o[d+(c*80|0)+16>>2];v=+o[d+(c*80|0)+32>>2];u=+o[d+(c*80|0)+4>>2];t=+o[d+(c*80|0)+20>>2];s=+o[d+(c*80|0)+36>>2];p=+o[d+(c*80|0)+8>>2];m=+o[d+(c*80|0)+24>>2];j=+o[d+(c*80|0)+40>>2];F=+o[d+(c*80|0)+48>>2];E=+o[d+(c*80|0)+52>>2];g=+o[d+(c*80|0)+56>>2];i=+o[e+48>>2]+(D*F+C*E+B*g);h=+o[e+52>>2]+(A*F+z*E+y*g);g=+o[e+56>>2]+(q*F+n*E+l*g);o[f+88>>2]=D*x+C*w+B*v;o[f+88+4>>2]=D*u+C*t+B*s;o[f+88+8>>2]=D*p+C*m+B*j;o[f+88+12>>2]=0.0;o[f+88+16>>2]=A*x+z*w+y*v;o[f+88+20>>2]=A*u+z*t+y*s;o[f+88+24>>2]=A*p+z*m+y*j;o[f+88+28>>2]=0.0;o[f+88+32>>2]=q*x+n*w+l*v;o[f+88+36>>2]=q*u+n*t+l*s;o[f+88+40>>2]=q*p+n*m+l*j;o[f+88+44>>2]=0.0;o[f+88+48>>2]=i;o[f+88+52>>2]=h;o[f+88+56>>2]=g;o[f+88+60>>2]=0.0;Cc[k[(k[b>>2]|0)+8>>2]&127](b,f+88|0,f+72|0,f+56|0);e=k[a+8>>2]|0;d=k[e+4>>2]|0;Cc[k[(k[d>>2]|0)+8>>2]&127](d,k[e+12>>2]|0,f+40|0,f+24|0);if(!(+o[f+72>>2]>+o[f+24>>2])?!(+o[f+56>>2]<+o[f+40>>2]):0)d=1;else d=0;if(!(!(+o[f+72+8>>2]>+o[f+24+8>>2])?!(+o[f+56+8>>2]<+o[f+40+8>>2]):0))d=0;if(+o[f+72+4>>2]>+o[f+24+4>>2]){r=f;return}if(+o[f+56+4>>2]<+o[f+40+4>>2]|d^1){r=f;return}d=k[a+4>>2]|0;e=k[d+8>>2]|0;k[f>>2]=d;k[f+4>>2]=b;k[f+8>>2]=e;k[f+12>>2]=f+88;k[f+16>>2]=-1;k[f+20>>2]=c;if(!(k[(k[a+24>>2]|0)+(c<<2)>>2]|0)){d=k[a+12>>2]|0;d=_b[k[(k[d>>2]|0)+8>>2]&31](d,f,k[a+8>>2]|0,k[a+28>>2]|0)|0;k[(k[a+24>>2]|0)+(c<<2)>>2]=d;d=k[a+4>>2]|0}b=k[a+20>>2]|0;e=k[b+8>>2]|0;if((k[e+8>>2]|0)==(k[d+8>>2]|0)){k[b+8>>2]=f;yc[k[(k[b>>2]|0)+8>>2]&127](b,-1,c)}else{e=k[b+12>>2]|0;k[b+12>>2]=f;yc[k[(k[b>>2]|0)+12>>2]&127](b,-1,c)}d=k[(k[a+24>>2]|0)+(c<<2)>>2]|0;Qb[k[(k[d>>2]|0)+8>>2]&31](d,f,k[a+8>>2]|0,k[a+16>>2]|0,k[a+20>>2]|0);d=k[a+20>>2]|0;if((k[(k[d+8>>2]|0)+8>>2]|0)==(k[(k[a+4>>2]|0)+8>>2]|0)){k[d+8>>2]=e;r=f;return}else{k[d+12>>2]=e;r=f;return}}function fx(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0,j=0,l=0;if((k[a+8>>2]|0)>=(b|0))return;if((b|0)!=0?(k[5108]=(k[5108]|0)+1,c=iF((b*36|3)+16|0)|0,(c|0)!=0):0){k[(c+4+15&-16)+-4>>2]=c;l=c+4+15&-16}else l=0;d=k[a+4>>2]|0;if((d|0)>0){e=0;while(1){c=l+(e*36|0)|0;if(c)gx(c,(k[a+12>>2]|0)+(e*36|0)|0);if((e|0)==(d+-1|0))break;else e=e+1|0}e=k[a+4>>2]|0;if((e|0)>0){j=0;while(1){c=k[a+12>>2]|0;f=c+(j*36|0)+4|0;g=c+(j*36|0)+12|0;h=k[g>>2]|0;d=c+(j*36|0)+16|0;if(h){if(i[d>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[h+-4>>2]|0)}k[g>>2]=0}i[d>>0]=1;k[g>>2]=0;k[f>>2]=0;k[c+(j*36|0)+8>>2]=0;if((j|0)==(e+-1|0)){c=a+12|0;break}else j=j+1|0}}else c=a+12|0}else c=a+12|0;d=k[c>>2]|0;if(d){if(i[a+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[c>>2]=0}i[a+16>>0]=1;k[c>>2]=l;k[a+8>>2]=b;return}function gx(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0;i[a+16>>0]=1;k[a+12>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;g=k[b+4>>2]|0;if((g|0)<=0){k[a+4>>2]=g;a=a+20|0;g=b+20|0;k[a>>2]=k[g>>2];k[a+4>>2]=k[g+4>>2];k[a+8>>2]=k[g+8>>2];k[a+12>>2]=k[g+12>>2];return}k[5108]=(k[5108]|0)+1;c=iF((g<<2|3)+16|0)|0;if(!c)f=0;else{k[(c+4+15&-16)+-4>>2]=c;f=c+4+15&-16}d=k[a+4>>2]|0;if((d|0)>0){e=0;while(1){c=f+(e<<2)|0;if(c)k[c>>2]=k[(k[a+12>>2]|0)+(e<<2)>>2];if((e|0)==(d+-1|0))break;else e=e+1|0}}c=k[a+12>>2]|0;if(c){if(i[a+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[a+12>>2]=0}i[a+16>>0]=1;k[a+12>>2]=f;k[a+8>>2]=g;d=0;while(1){c=f+(d<<2)|0;if(c)k[c>>2]=0;if((d|0)==(g+-1|0))break;else d=d+1|0}k[a+4>>2]=g;d=k[b+12>>2]|0;e=0;while(1){c=f+(e<<2)|0;if(c)k[c>>2]=k[d+(e<<2)>>2];if((e|0)==(g+-1|0))break;else e=e+1|0}a=a+20|0;g=b+20|0;k[a>>2]=k[g>>2];k[a+4>>2]=k[g+4>>2];k[a+8>>2]=k[g+8>>2];k[a+12>>2]=k[g+12>>2];return}function hx(a){a=a|0;return +(+o[a+44>>2])}function ix(a,b){a=a|0;b=+b;var c=0.0,d=0.0,e=0.0,f=0.0,g=0.0;f=+gc[k[(k[a>>2]|0)+48>>2]&15](a);d=+gc[k[(k[a>>2]|0)+48>>2]&15](a);g=+gc[k[(k[a>>2]|0)+48>>2]&15](a);f=f+ +o[a+28>>2];d=d+ +o[a+32>>2];g=g+ +o[a+36>>2];o[a+44>>2]=b;e=+gc[k[(k[a>>2]|0)+48>>2]&15](a);c=+gc[k[(k[a>>2]|0)+48>>2]&15](a);b=g-+gc[k[(k[a>>2]|0)+48>>2]&15](a);o[a+28>>2]=f-e;o[a+32>>2]=d-c;o[a+36>>2]=b;o[a+40>>2]=0.0;return}function jx(a,b){a=a|0;b=+b;var c=0.0,d=0.0,e=0.0,f=0.0,g=0.0;f=+gc[k[(k[a>>2]|0)+48>>2]&15](a);d=+gc[k[(k[a>>2]|0)+48>>2]&15](a);g=+gc[k[(k[a>>2]|0)+48>>2]&15](a);f=f+ +o[a+28>>2];d=d+ +o[a+32>>2];g=g+ +o[a+36>>2];o[a+44>>2]=b;e=+gc[k[(k[a>>2]|0)+48>>2]&15](a);c=+gc[k[(k[a>>2]|0)+48>>2]&15](a);b=g-+gc[k[(k[a>>2]|0)+48>>2]&15](a);o[a+28>>2]=f-e;o[a+32>>2]=d-c;o[a+36>>2]=b;o[a+40>>2]=0.0;return}function kx(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,i=0,j=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0;while(1){r=(b+c|0)/2|0;o=k[a+12>>2]|0;p=k[o+(r<<4)>>2]|0;q=k[o+(r<<4)+4>>2]|0;r=k[o+(r<<4)+8>>2]|0;d=b;e=c;while(1){a:do if(!p)while(1){i=k[o+(d<<4)>>2]|0;if(!i)f=-1;else f=k[i+12>>2]|0;j=k[o+(d<<4)+4>>2]|0;if(!j)g=-1;else g=k[j+12>>2]|0;if(!q)h=-1;else h=k[q+12>>2]|0;do if((f|0)<=-1){f=(g|0)>(h|0);if(f|(i|0)==0^1)if((i|0)==0&f)break;else break a;if((j|0)!=(q|0))break a;if((k[o+(d<<4)+8>>2]|0)>>>0<=r>>>0)break a}while(0);d=d+1|0}else{m=k[p+12>>2]|0;while(1){l=k[o+(d<<4)>>2]|0;if(!l)i=-1;else i=k[l+12>>2]|0;j=k[o+(d<<4)+4>>2]|0;if(!j)h=-1;else h=k[j+12>>2]|0;if(!q)g=-1;else g=k[q+12>>2]|0;do if((i|0)<=(m|0)){f=(h|0)>(g|0);if(f|(l|0)==(p|0)^1)if((l|0)==(p|0)&f)break;else break a;if((j|0)!=(q|0))break a;if((k[o+(d<<4)+8>>2]|0)>>>0<=r>>>0)break a}while(0);d=d+1|0}}while(0);b:while(1){if(!p)l=-1;else l=k[p+12>>2]|0;m=k[o+(e<<4)>>2]|0;if(!m)i=-1;else i=k[m+12>>2]|0;if(!q)h=-1;else h=k[q+12>>2]|0;n=k[o+(e<<4)+4>>2]|0;if(!n)g=-1;else g=k[n+12>>2]|0;do if((l|0)<=(i|0)){f=(h|0)>(g|0);if(f|(p|0)==(m|0)^1)if((p|0)==(m|0)&f)break;else break b;if((q|0)!=(n|0))break b;if(r>>>0<=(k[o+(e<<4)+8>>2]|0)>>>0)break b}while(0);e=e+-1|0}if((d|0)<=(e|0)){i=o+(d<<4)|0;l=k[i>>2]|0;m=k[o+(d<<4)+8>>2]|0;n=k[o+(d<<4)+12>>2]|0;o=o+(e<<4)|0;k[i>>2]=k[o>>2];k[i+4>>2]=k[o+4>>2];k[i+8>>2]=k[o+8>>2];k[i+12>>2]=k[o+12>>2];o=k[a+12>>2]|0;k[o+(e<<4)>>2]=l;k[o+(e<<4)+4>>2]=j;k[o+(e<<4)+8>>2]=m;k[o+(e<<4)+12>>2]=n;d=d+1|0;e=e+-1|0}if((d|0)>(e|0))break;o=k[a+12>>2]|0}if((e|0)>(b|0))kx(a,b,e);if((d|0)<(c|0))b=d;else break}return}function lx(a,b,c,d,e,f,g,h,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=+f;g=g|0;h=h|0;j=j|0;var l=0,m=0,n=0,p=0,q=0,s=0.0,t=0.0,u=0.0,v=0.0,w=0,x=0,y=0,z=0.0,A=0.0,B=0.0,C=0.0,D=0,E=0.0;D=r;r=r+32|0;if(!b){r=D;return}m=k[a+44>>2]|0;if((m|0)<128){if((k[a+48>>2]|0)<128){k[5108]=(k[5108]|0)+1;l=iF(531)|0;if(!l)q=0;else{k[(l+4+15&-16)+-4>>2]=l;q=l+4+15&-16}n=k[a+44>>2]|0;if((n|0)>0){p=0;while(1){l=q+(p<<2)|0;if(l)k[l>>2]=k[(k[a+52>>2]|0)+(p<<2)>>2];if((p|0)==(n+-1|0))break;else p=p+1|0}}l=k[a+52>>2]|0;if(l){if(i[a+56>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[l+-4>>2]|0)}k[a+52>>2]=0}i[a+56>>0]=1;k[a+52>>2]=q;k[a+48>>2]=128;n=a+52|0}else n=a+52|0;while(1){l=(k[n>>2]|0)+(m<<2)|0;if(l)k[l>>2]=0;if((m|0)==127){y=a+48|0;break}else m=m+1|0}}else y=a+48|0;k[a+44>>2]=128;k[k[a+52>>2]>>2]=b;n=1;m=126;do{w=n+-1|0;q=k[a+52>>2]|0;x=k[q+(w<<2)>>2]|0;v=+o[x+4>>2]-+o[h+4>>2];t=+o[x+8>>2]-+o[h+8>>2];o[D>>2]=+o[x>>2]-+o[h>>2];o[D+4>>2]=v;o[D+8>>2]=t;o[D+12>>2]=0.0;t=+o[x+20>>2]-+o[g+4>>2];v=+o[x+24>>2]-+o[g+8>>2];o[D+16>>2]=+o[x+16>>2]-+o[g>>2];o[D+20>>2]=t;o[D+24>>2]=v;o[D+28>>2]=0.0;b=k[e>>2]|0;v=+o[c>>2];t=+o[d>>2];u=(+o[D+(b<<4)>>2]-v)*t;v=t*(+o[D+(1-b<<4)>>2]-v);b=k[e+4>>2]|0;t=+o[c+4>>2];E=+o[d+4>>2];s=(+o[D+(b<<4)+4>>2]-t)*E;t=E*(+o[D+(1-b<<4)+4>>2]-t);do if(((!(s>v|u>t)?(z=s>u?s:u,C=t<v?t:v,b=k[e+8>>2]|0,B=+o[c+8>>2],E=+o[d+8>>2],A=(+o[D+(b<<4)+8>>2]-B)*E,B=E*(+o[D+(1-b<<4)+8>>2]-B),!(A>C|z>B)):0)?(A>z?A:z)<f:0)?(B<C?B:C)>0.0:0){if(!(k[x+40>>2]|0)){Ub[k[(k[j>>2]|0)+12>>2]&127](j,x);n=w;break}if((w|0)>(m|0)){b=k[a+44>>2]|0;if((b|0)<(b<<1|0)){if((k[y>>2]|0)<(b<<1|0)){if(b){k[5108]=(k[5108]|0)+1;m=iF((b<<3|3)+16|0)|0;if(!m)m=0;else{k[(m+4+15&-16)+-4>>2]=m;m=m+4+15&-16}q=k[a+44>>2]|0;if((q|0)>0){l=0;while(1){p=m+(l<<2)|0;if(p)k[p>>2]=k[(k[a+52>>2]|0)+(l<<2)>>2];if((l|0)==(q+-1|0))break;else l=l+1|0}}}else m=0;p=k[a+52>>2]|0;if(p){if(i[a+56>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[p+-4>>2]|0)}k[a+52>>2]=0}i[a+56>>0]=1;k[a+52>>2]=m;k[y>>2]=b<<1}else m=q;q=b;while(1){p=m+(q<<2)|0;if(p)k[p>>2]=0;if((q|0)==((b<<1)+-1|0))break;m=k[a+52>>2]|0;q=q+1|0}m=k[a+52>>2]|0}else m=q;k[a+44>>2]=b<<1;q=m;m=(b<<1)+-2|0}k[q+(w<<2)>>2]=k[x+36>>2];k[(k[a+52>>2]|0)+(n<<2)>>2]=k[x+40>>2];n=n+1|0}else n=w;while(0)}while((n|0)!=0);r=D;return}function mx(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,l=0,m=0,n=0,p=0,q=0;if(!((b|0)!=0&(c|0)!=0))return;if((k[a+24>>2]|0)<128?(k[a+28>>2]|0)<128:0){k[5108]=(k[5108]|0)+1;e=iF(1043)|0;if(!e)h=0;else{k[(e+4+15&-16)+-4>>2]=e;h=e+4+15&-16}e=k[a+24>>2]|0;if((e|0)>0){g=0;while(1){f=h+(g<<3)|0;if(f){m=(k[a+32>>2]|0)+(g<<3)|0;n=k[m+4>>2]|0;k[f>>2]=k[m>>2];k[f+4>>2]=n}if((g|0)==(e+-1|0))break;else g=g+1|0}}e=k[a+32>>2]|0;if(e){if(i[a+36>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0)}k[a+32>>2]=0}i[a+36>>0]=1;k[a+32>>2]=h;k[a+28>>2]=128;n=a+28|0}else n=a+28|0;k[a+24>>2]=128;e=k[a+32>>2]|0;k[e>>2]=b;k[e+4>>2]=c;e=1;h=124;while(1){j=e+-1|0;g=k[a+32>>2]|0;l=k[g+(j<<3)>>2]|0;m=k[g+(j<<3)+4>>2]|0;if((j|0)>(h|0)){f=k[a+24>>2]|0;if((f|0)<(f<<1|0)?(k[n>>2]|0)<(f<<1|0):0){if(f){k[5108]=(k[5108]|0)+1;g=iF((f<<4|3)+16|0)|0;if(!g)g=0;else{k[(g+4+15&-16)+-4>>2]=g;g=g+4+15&-16}c=k[a+24>>2]|0;if((c|0)>0){h=0;while(1){b=g+(h<<3)|0;if(b){q=(k[a+32>>2]|0)+(h<<3)|0;p=k[q+4>>2]|0;k[b>>2]=k[q>>2];k[b+4>>2]=p}if((h|0)==(c+-1|0))break;else h=h+1|0}}}else g=0;h=k[a+32>>2]|0;if(h){if(i[a+36>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[h+-4>>2]|0)}k[a+32>>2]=0}i[a+36>>0]=1;k[a+32>>2]=g;k[n>>2]=f<<1}k[a+24>>2]=f<<1;b=(f<<1)+-4|0}else b=h;do if((l|0)==(m|0))if(!(k[l+40>>2]|0))e=j;else{p=k[l+36>>2]|0;q=g+(j<<3)|0;k[q>>2]=p;k[q+4>>2]=p;q=k[l+40>>2]|0;p=(k[a+32>>2]|0)+(e<<3)|0;k[p>>2]=q;k[p+4>>2]=q;p=k[l+40>>2]|0;q=(k[a+32>>2]|0)+(e+1<<3)|0;k[q>>2]=k[l+36>>2];k[q+4>>2]=p;e=e+2|0}else if(((((+o[l>>2]<=+o[m+16>>2]?+o[l+16>>2]>=+o[m>>2]:0)?+o[l+4>>2]<=+o[m+20>>2]:0)?+o[l+20>>2]>=+o[m+4>>2]:0)?+o[l+8>>2]<=+o[m+24>>2]:0)?+o[l+24>>2]>=+o[m+8>>2]:0){c=(k[m+40>>2]|0)!=0;if(!(k[l+40>>2]|0))if(c){q=k[m+36>>2]|0;p=g+(j<<3)|0;k[p>>2]=l;k[p+4>>2]=q;p=k[m+40>>2]|0;q=(k[a+32>>2]|0)+(e<<3)|0;k[q>>2]=l;k[q+4>>2]=p;e=e+1|0;break}else{yc[k[(k[d>>2]|0)+8>>2]&127](d,l,m);e=j;break}else{h=g+(j<<3)|0;g=k[l+36>>2]|0;if(c){p=k[m+36>>2]|0;k[h>>2]=g;k[h+4>>2]=p;p=k[m+36>>2]|0;q=(k[a+32>>2]|0)+(e<<3)|0;k[q>>2]=k[l+40>>2];k[q+4>>2]=p;q=k[m+40>>2]|0;p=(k[a+32>>2]|0)+(e+1<<3)|0;k[p>>2]=k[l+36>>2];k[p+4>>2]=q;p=k[m+40>>2]|0;q=(k[a+32>>2]|0)+(e+2<<3)|0;k[q>>2]=k[l+40>>2];k[q+4>>2]=p;e=e+3|0;break}else{k[h>>2]=g;k[h+4>>2]=m;q=(k[a+32>>2]|0)+(e<<3)|0;k[q>>2]=k[l+40>>2];k[q+4>>2]=m;e=e+1|0;break}}}else e=j;while(0);if(!e)break;else h=b}return}function nx(a,b){a=a|0;b=b|0;var c=0;if(k[b+40>>2]|0){nx(a,k[b+36>>2]|0);nx(a,k[b+40>>2]|0)}if((k[a>>2]|0)==(b|0))k[a>>2]=0;c=k[a+4>>2]|0;if(!c){k[a+4>>2]=b;return}k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);k[a+4>>2]=b;return}function ox(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0,v=0,w=0,x=0,y=0;if((k[a>>2]|0)==(b|0)){k[a>>2]=0;a=0;return a|0}d=k[b+32>>2]|0;c=k[d+32>>2]|0;b=k[d+36+(((k[d+40>>2]|0)!=(b|0)&1)<<2)>>2]|0;if(!c){k[a>>2]=b;k[b+32>>2]=0;c=k[a+4>>2]|0;if(!c)c=b;else{k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);c=k[a>>2]|0}k[a+4>>2]=d;a=c;return a|0}k[c+36+(((k[c+40>>2]|0)==(d|0)&1)<<2)>>2]=b;k[b+32>>2]=c;b=k[a+4>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+4>>2]=d;do{s=+o[c>>2];x=c+4|0;q=+o[x>>2];v=c+8|0;n=+o[v>>2];y=c+16|0;l=+o[y>>2];w=c+20|0;g=+o[w>>2];d=c+24|0;i=+o[d>>2];u=k[c+36>>2]|0;b=k[c+40>>2]|0;t=+o[u>>2];r=+o[b>>2];r=t<r?t:r;o[c>>2]=r;t=+o[u+16>>2];j=+o[b+16>>2];j=t>j?t:j;o[y>>2]=j;t=+o[u+4>>2];p=+o[b+4>>2];p=t<p?t:p;o[x>>2]=p;t=+o[u+20>>2];f=+o[b+20>>2];f=t>f?t:f;o[w>>2]=f;t=+o[u+8>>2];m=+o[b+8>>2];m=t<m?t:m;o[v>>2]=m;t=+o[u+24>>2];h=+o[b+24>>2];h=t>h?t:h;o[d>>2]=h;if(!(s!=r|q!=p|n!=m|l!=j)?!(i!=h|g!=f):0){e=14;break}c=k[c+32>>2]|0}while((c|0)!=0);if((e|0)==14)return c|0;x=k[a>>2]|0;return x|0}function px(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0,n=0,p=0,q=0.0;if(!(k[a>>2]|0)){k[a>>2]=c;k[c+32>>2]=0;return}d=k[b+40>>2]|0;if(!d)m=b;else{h=+o[c>>2]+ +o[c+16>>2];f=+o[c+4>>2]+ +o[c+20>>2];g=+o[c+8>>2]+ +o[c+24>>2];do{m=k[b+36>>2]|0;l=+X(+(h-(+o[m>>2]+ +o[m+16>>2])))+ +X(+(f-(+o[m+4>>2]+ +o[m+20>>2])))+ +X(+(g-(+o[m+8>>2]+ +o[m+24>>2])));b=b+36+((!(l<+X(+(h-(+o[d>>2]+ +o[d+16>>2])))+ +X(+(f-(+o[d+4>>2]+ +o[d+20>>2])))+ +X(+(g-(+o[d+8>>2]+ +o[d+24>>2]))))&1)<<2)|0;b=k[b>>2]|0;d=k[b+40>>2]|0}while((d|0)!=0);m=b}n=m+32|0;p=k[n>>2]|0;b=k[a+4>>2]|0;if(!b){k[5108]=(k[5108]|0)+1;d=iF(63)|0;if((d|0)!=0?(k[(d+4+15&-16)+-4>>2]=d,(d+4+15&-16|0)!=0):0){b=d+4+15&-16;e=b+44|0;do{k[b>>2]=0;b=b+4|0}while((b|0)<(e|0));b=d+4+15&-16}else b=0}else k[a+4>>2]=0;k[b+32>>2]=p;k[b+36>>2]=0;e=b+40|0;k[e>>2]=0;q=+o[c>>2];j=+o[m>>2];j=q<j?q:j;o[b>>2]=j;q=+o[c+16>>2];h=+o[m+16>>2];h=q>h?q:h;o[b+16>>2]=h;q=+o[c+4>>2];l=+o[m+4>>2];l=q<l?q:l;o[b+4>>2]=l;q=+o[c+20>>2];g=+o[m+20>>2];g=q>g?q:g;o[b+20>>2]=g;q=+o[c+8>>2];i=+o[m+8>>2];i=q<i?q:i;o[b+8>>2]=i;q=+o[c+24>>2];f=+o[m+24>>2];f=q>f?q:f;o[b+24>>2]=f;if(!p){k[b+36>>2]=m;k[n>>2]=b;k[e>>2]=c;k[c+32>>2]=b;k[a>>2]=b;return}k[p+36+(((k[(k[n>>2]|0)+40>>2]|0)==(m|0)&1)<<2)>>2]=b;k[b+36>>2]=m;k[n>>2]=b;k[e>>2]=c;k[c+32>>2]=b;d=p;while(1){b=d+4|0;if(((((+o[d>>2]<=j?+o[b>>2]<=l:0)?+o[d+8>>2]<=i:0)?+o[d+16>>2]>=h:0)?+o[d+20>>2]>=g:0)?+o[d+24>>2]>=f:0){b=21;break}a=k[d+36>>2]|0;m=k[d+40>>2]|0;q=+o[a>>2];j=+o[m>>2];j=q<j?q:j;o[d>>2]=j;q=+o[a+16>>2];h=+o[m+16>>2];h=q>h?q:h;o[d+16>>2]=h;q=+o[a+4>>2];l=+o[m+4>>2];l=q<l?q:l;o[b>>2]=l;q=+o[a+20>>2];g=+o[m+20>>2];g=q>g?q:g;o[d+20>>2]=g;q=+o[a+8>>2];i=+o[m+8>>2];i=q<i?q:i;o[d+8>>2]=i;q=+o[a+24>>2];f=+o[m+24>>2];f=q>f?q:f;o[d+24>>2]=f;d=k[d+32>>2]|0;if(!d){b=21;break}}if((b|0)==21)return}function qx(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0,l=0,m=0,n=0.0,p=0.0,q=0,s=0.0,t=0,u=0.0,v=0,w=0,x=0.0,y=0,z=0,A=0.0,B=0.0,C=0.0,D=0.0,E=0;z=r;r=r+176|0;k[a+348>>2]=a+220;k[a+352>>2]=a+252;k[a+356>>2]=a+284;k[a+360>>2]=a+316;k[a+364>>2]=4;k[a+368>>2]=0;k[a+376>>2]=0;w=k[b+4>>2]|0;k[a>>2]=k[b>>2];k[a+4>>2]=w;k[a+8>>2]=k[b+8>>2];k[a+8+4>>2]=k[b+8+4>>2];k[a+8+8>>2]=k[b+8+8>>2];k[a+8+12>>2]=k[b+8+12>>2];k[a+24>>2]=k[b+24>>2];k[a+24+4>>2]=k[b+24+4>>2];k[a+24+8>>2]=k[b+24+8>>2];k[a+24+12>>2]=k[b+24+12>>2];k[a+40>>2]=k[b+40>>2];k[a+40+4>>2]=k[b+40+4>>2];k[a+40+8>>2]=k[b+40+8>>2];k[a+40+12>>2]=k[b+40+12>>2];k[a+56>>2]=k[b+56>>2];k[a+56+4>>2]=k[b+56+4>>2];k[a+56+8>>2]=k[b+56+8>>2];k[a+56+12>>2]=k[b+56+12>>2];k[a+72>>2]=k[b+72>>2];k[a+72+4>>2]=k[b+72+4>>2];k[a+72+8>>2]=k[b+72+8>>2];k[a+72+12>>2]=k[b+72+12>>2];k[a+88>>2]=k[b+88>>2];k[a+88+4>>2]=k[b+88+4>>2];k[a+88+8>>2]=k[b+88+8>>2];k[a+88+12>>2]=k[b+88+12>>2];k[a+104>>2]=k[b+104>>2];k[a+104+4>>2]=k[b+104+4>>2];k[a+104+8>>2]=k[b+104+8>>2];k[a+104+12>>2]=k[b+104+12>>2];w=k[b+120+4>>2]|0;k[a+120>>2]=k[b+120>>2];k[a+120+4>>2]=w;o[a+144>>2]=0.0;k[a+180>>2]=0;k[a+128>>2]=k[c>>2];k[a+128+4>>2]=k[c+4>>2];k[a+128+8>>2]=k[c+8>>2];k[a+128+12>>2]=k[c+12>>2];g=+o[a+128>>2];h=+o[a+132>>2];i=+o[a+136>>2];if(g*g+h*h+i*i>0.0){d=-i;e=-h;f=-g}else{d=0.0;e=0.0;f=1.0}o[a+164>>2]=0.0;k[a+364>>2]=3;k[a+148>>2]=a+316;k[a+180>>2]=1;$D(a,f,e,d,a+316|0);o[a+164>>2]=1.0;v=(k[a+148>>2]|0)+16|0;k[a+128>>2]=k[v>>2];k[a+128+4>>2]=k[v+4>>2];k[a+128+8>>2]=k[v+8>>2];k[a+128+12>>2]=k[v+12>>2];k[z+16+48>>2]=k[v>>2];k[z+16+48+4>>2]=k[v+4>>2];k[z+16+48+8>>2]=k[v+8>>2];k[z+16+48+12>>2]=k[v+12>>2];k[z+16+32>>2]=k[v>>2];k[z+16+32+4>>2]=k[v+4>>2];k[z+16+32+8>>2]=k[v+8>>2];k[z+16+32+12>>2]=k[v+12>>2];k[z+16+16>>2]=k[v>>2];k[z+16+16+4>>2]=k[v+4>>2];k[z+16+16+8>>2]=k[v+8>>2];k[z+16+16+12>>2]=k[v+12>>2];k[z+16>>2]=k[v>>2];k[z+16+4>>2]=k[v+4>>2];k[z+16+8>>2]=k[v+8>>2];k[z+16+12>>2]=k[v+12>>2];u=0.0;v=0;w=0;d=g*g+h*h+i*i;do{t=k[a+368>>2]|0;i=+o[a+128>>2];h=+o[a+132>>2];f=+o[a+136>>2];e=+Y(+(i*i+h*h+f*f));if(e<9.999999747378752e-05){y=5;break}o[a+148+(t*36|0)+16+(k[a+148+(t*36|0)+32>>2]<<2)>>2]=0.0;l=(k[a+364>>2]|0)+-1|0;k[a+364>>2]=l;k[a+148+(t*36|0)+(k[a+148+(t*36|0)+32>>2]<<2)>>2]=k[a+348+(l<<2)>>2];l=k[a+148+(t*36|0)+32>>2]|0;k[a+148+(t*36|0)+32>>2]=l+1;$D(a,-i,-h,-f,k[a+148+(t*36|0)+(l<<2)>>2]|0);l=k[a+148+(t*36|0)+32>>2]|0;j=k[a+148+(t*36|0)+(l+-1<<2)>>2]|0;i=+o[j+16>>2];h=+o[j+20>>2];g=+o[j+24>>2];f=i-+o[z+16>>2];n=h-+o[z+16+4>>2];p=g-+o[z+16+8>>2];if(f*f+n*n+p*p<9.999999747378752e-05){y=8;break}f=i-+o[z+16+16>>2];n=h-+o[z+16+20>>2];p=g-+o[z+16+24>>2];if(f*f+n*n+p*p<9.999999747378752e-05){y=8;break}f=i-+o[z+16+32>>2];n=h-+o[z+16+36>>2];p=g-+o[z+16+40>>2];if(f*f+n*n+p*p<9.999999747378752e-05){y=8;break}f=i-+o[z+16+48>>2];n=h-+o[z+16+52>>2];p=g-+o[z+16+56>>2];if(f*f+n*n+p*p<9.999999747378752e-05){y=8;break}v=v+1&3;q=z+16+(v<<4)|0;k[q>>2]=k[j+16>>2];k[q+4>>2]=k[j+16+4>>2];k[q+8>>2]=k[j+16+8>>2];k[q+12>>2]=k[j+16+12>>2];p=(+o[a+128>>2]*i+ +o[a+132>>2]*h+ +o[a+136>>2]*g)/e;u=p>u?p:u;if(e-u-e*9.999999747378752e-05<=0.0){y=9;break}k[z+96>>2]=0;if((l|0)==3)d=+dE((k[a+148+(t*36|0)>>2]|0)+16|0,(k[a+148+(t*36|0)+4>>2]|0)+16|0,(k[a+148+(t*36|0)+8>>2]|0)+16|0,z,z+96|0);else if((l|0)==4){b=k[a+148+(t*36|0)>>2]|0;m=k[a+148+(t*36|0)+4>>2]|0;c=k[a+148+(t*36|0)+8>>2]|0;q=k[a+148+(t*36|0)+12>>2]|0;k[z+80>>2]=b+16;k[z+80+4>>2]=m+16;k[z+80+8>>2]=c+16;k[z+80+12>>2]=q+16;g=+o[b+16>>2];f=+o[q+16>>2];i=+o[b+20>>2];e=+o[q+20>>2];h=+o[b+24>>2];d=+o[q+24>>2];o[z+104>>2]=g-f;o[z+104+4>>2]=i-e;o[z+104+8>>2]=h-d;o[z+104+12>>2]=0.0;A=+o[m+16>>2];C=+o[m+20>>2];p=+o[m+24>>2];o[z+104+16>>2]=A-f;o[z+104+20>>2]=C-e;o[z+104+24>>2]=p-d;o[z+104+28>>2]=0.0;n=+o[c+16>>2];D=+o[c+20>>2];B=+o[c+24>>2];o[z+104+32>>2]=n-f;o[z+104+36>>2]=D-e;o[z+104+40>>2]=B-d;o[z+104+44>>2]=0.0;s=(i-e)*(p-d)*(n-f)+(h-d)*(A-f)*(D-e)-(D-e)*((p-d)*(g-f))-(i-e)*(A-f)*(B-d)+(B-d)*((g-f)*(C-e))-(n-f)*((h-d)*(C-e));if(!(s!=s|0.0!=0.0|s==0.0|!(s*(h*((A-n)*(i-C)-(C-D)*(g-A))+(g*((C-D)*(h-p)-(p-B)*(i-C))+i*((p-B)*(g-A)-(A-n)*(h-p))))<=0.0))){k[z+152>>2]=0;k[z+152+4>>2]=0;k[z+152+8>>2]=0;k[z+164>>2]=0;p=i-e;n=h-d;h=g-f;i=d;l=0;d=-1.0;while(1){j=k[19520+(l<<2)>>2]|0;g=+o[z+104+(j<<4)+8>>2];A=+o[z+104+(j<<4)+4>>2];B=+o[z+104+(j<<4)>>2];if(s*((p*g-n*A)*f+e*(n*B-g*h)+(A*h-p*B)*i)>0.0?(x=+dE(k[z+80+(l<<2)>>2]|0,k[z+80+(j<<2)>>2]|0,q+16|0,z+152|0,z+164|0),d<0.0|x<d):0){E=k[z+164>>2]|0;k[z+96>>2]=((E&2|0)==0?0:1<<j)+(E<<1&8)+((E&1|0)==0?0:1<<l);o[z+(l<<2)>>2]=+o[z+152>>2];o[z+(j<<2)>>2]=+o[z+152+4>>2];o[z+(k[19520+(j<<2)>>2]<<2)>>2]=0.0;o[z+12>>2]=+o[z+152+8>>2];d=x}l=l+1|0;if((l|0)==3)break;p=+o[z+104+(l<<4)+4>>2];n=+o[z+104+(l<<4)+8>>2];h=+o[z+104+(l<<4)>>2];f=+o[q+16>>2];e=+o[q+20>>2];i=+o[q+24>>2]}if(d<0.0){k[z+96>>2]=15;d=+o[c+20>>2];C=+o[m+24>>2];A=+o[q+16>>2];g=+o[c+24>>2];e=+o[m+16>>2];f=+o[q+20>>2];i=+o[c+16>>2];n=+o[q+24>>2];D=+o[m+20>>2];o[z>>2]=(d*C*A+g*e*f-f*(C*i)-d*e*n+n*(i*D)-A*(g*D))/s;h=+o[b+20>>2];B=+o[b+24>>2];p=+o[b+16>>2];o[z+4>>2]=(h*g*A+B*i*f-f*(g*p)-h*i*n+n*(p*d)-A*(B*d))/s;o[z+8>>2]=(D*B*A+C*p*f-f*(B*e)-D*p*n+n*(e*h)-A*(C*h))/s;o[z+12>>2]=1.0-((D*B*A+C*p*f-f*(B*e)-D*p*n+n*(e*h)-A*(C*h))/s+((d*C*A+g*e*f-f*(C*i)-d*e*n+n*(i*D)-A*(g*D))/s+(h*g*A+B*i*f-f*(g*p)-h*i*n+n*(p*d)-A*(B*d))/s));d=0.0}}else d=-1.0}else if((l|0)==2)d=+eE((k[a+148+(t*36|0)>>2]|0)+16|0,(k[a+148+(t*36|0)+4>>2]|0)+16|0,z,z+96|0);if(!(d>=0.0)){y=31;break}k[a+148+((1-t|0)*36|0)+32>>2]=0;k[a+128>>2]=0;k[a+128+4>>2]=0;k[a+128+8>>2]=0;k[a+128+12>>2]=0;k[a+368>>2]=1-t;b=k[a+148+(t*36|0)+32>>2]|0;c=k[z+96>>2]|0;if(b){m=0;do{j=a+148+(t*36|0)+(m<<2)|0;l=k[j>>2]|0;if(!(c&1<<m)){E=k[a+364>>2]|0;k[a+364>>2]=E+1;k[a+348+(E<<2)>>2]=l}else{k[a+148+((1-t|0)*36|0)+(k[a+148+((1-t|0)*36|0)+32>>2]<<2)>>2]=l;p=+o[z+(m<<2)>>2];E=k[a+148+((1-t|0)*36|0)+32>>2]|0;k[a+148+((1-t|0)*36|0)+32>>2]=E+1;o[a+148+((1-t|0)*36|0)+16+(E<<2)>>2]=p;E=k[j>>2]|0;A=p*+o[E+20>>2];B=p*+o[E+24>>2];o[a+128>>2]=+o[E+16>>2]*p+ +o[a+128>>2];o[a+132>>2]=A+ +o[a+132>>2];o[a+136>>2]=B+ +o[a+136>>2]}m=m+1|0}while((m|0)!=(b|0))}if((c|0)==15)k[a+376>>2]=1;w=w+1|0;if(w>>>0>=128){y=33;break}}while((k[a+376>>2]|0)==0);if((y|0)==5)k[a+376>>2]=1;else if((y|0)==8){E=k[a+368>>2]|0;w=(k[a+148+(E*36|0)+32>>2]|0)+-1|0;k[a+148+(E*36|0)+32>>2]=w;w=k[a+148+(E*36|0)+(w<<2)>>2]|0;E=k[a+364>>2]|0;k[a+364>>2]=E+1;k[a+348+(E<<2)>>2]=w}else if((y|0)==9){E=k[a+368>>2]|0;w=(k[a+148+(E*36|0)+32>>2]|0)+-1|0;k[a+148+(E*36|0)+32>>2]=w;w=k[a+148+(E*36|0)+(w<<2)>>2]|0;E=k[a+364>>2]|0;k[a+364>>2]=E+1;k[a+348+(E<<2)>>2]=w}else if((y|0)==31){E=k[a+368>>2]|0;w=(k[a+148+(E*36|0)+32>>2]|0)+-1|0;k[a+148+(E*36|0)+32>>2]=w;w=k[a+148+(E*36|0)+(w<<2)>>2]|0;E=k[a+364>>2]|0;k[a+364>>2]=E+1;k[a+348+(E<<2)>>2]=w}else if((y|0)==33)k[a+376>>2]=2;k[a+372>>2]=a+148+((k[a+368>>2]|0)*36|0);c=k[a+376>>2]|0;if(!c){x=+o[a+128>>2];A=+o[a+132>>2];B=+o[a+136>>2];B=+Y(+(x*x+A*A+B*B));o[a+144>>2]=B;r=z;return c|0}else if((c|0)==1){o[a+144>>2]=0.0;r=z;return c|0}else{r=z;return c|0}return 0}function rx(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,i=0,j=0,l=0;l=r;r=r+16|0;g=k[a+12>>2]|0;h=k[g+(((c+b|0)/2|0)<<4)>>2]|0;i=k[g+(((c+b|0)/2|0)<<4)+4>>2]|0;j=k[g+(((c+b|0)/2|0)<<4)+8>>2]|0;d=b;e=c;while(1){f=d;while(1){d=k[g+(f<<4)+4>>2]|0;if((d|0)>=(i|0)){if((d|0)!=(i|0))break;d=k[g+(f<<4)>>2]|0;if((d|0)>=(h|0)){if((d|0)!=(h|0))break;if((k[g+(f<<4)+8>>2]|0)>=(j|0))break}}f=f+1|0}while(1){d=k[g+(e<<4)+4>>2]|0;if((i|0)>=(d|0)){if((i|0)!=(d|0))break;d=k[g+(e<<4)>>2]|0;if((h|0)>=(d|0)){if((h|0)!=(d|0))break;if((j|0)>=(k[g+(e<<4)+8>>2]|0))break}}e=e+-1|0}if((f|0)>(e|0))d=f;else{d=g+(f<<4)|0;k[l>>2]=k[d>>2];k[l+4>>2]=k[d+4>>2];k[l+8>>2]=k[d+8>>2];k[l+12>>2]=k[d+12>>2];g=g+(e<<4)|0;k[d>>2]=k[g>>2];k[d+4>>2]=k[g+4>>2];k[d+8>>2]=k[g+8>>2];k[d+12>>2]=k[g+12>>2];d=(k[a+12>>2]|0)+(e<<4)|0;k[d>>2]=k[l>>2];k[d+4>>2]=k[l+4>>2];k[d+8>>2]=k[l+8>>2];k[d+12>>2]=k[l+12>>2];d=f+1|0;e=e+-1|0}if((d|0)>(e|0))break;g=k[a+12>>2]|0}if((e|0)>(b|0))rx(a,b,e);if((d|0)>=(c|0)){r=l;return}rx(a,d,c);r=l;return}function sx(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0,g=0;if((d|0)>-1|(d|0)==-1&c>>>0>4294967295){e=(+(c>>>0)+4294967296.0*+(d>>>0))*18446744073709551616.0+(+(a>>>0)+4294967296.0*+(b>>>0));return +e}else{g=mF(0,0,a|0,b|0)|0;f=M;d=pF((a|0)==0&(b|0)==0&1|0,0,~c|0,~d|0)|0;e=-+sx(g,f,d,M);return +e}return 0.0}function tx(a){a=a|0;var b=0,c=0;b=k[a+92>>2]|0;if(b){if(i[a+96>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+92>>2]=0}i[a+96>>0]=1;k[a+92>>2]=0;k[a+84>>2]=0;k[a+88>>2]=0;b=k[a+64>>2]|0;if(b)do{k[a+64>>2]=k[b+8>>2];c=k[b>>2]|0;if(c){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0);b=k[a+64>>2]|0}while((b|0)!=0);b=k[a+48>>2]|0;if(b)do{k[a+48>>2]=k[b+8>>2];c=k[b>>2]|0;if(c){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0);b=k[a+48>>2]|0}while((b|0)!=0);b=k[a+32>>2]|0;if(!b)return;do{k[a+32>>2]=k[b+8>>2];c=k[b>>2]|0;if(c){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0);b=k[a+32>>2]|0}while((b|0)!=0);return}function ux(a,b){a=a|0;b=b|0;k[a+260>>2]=(k[a+260>>2]|0)+1;k[a+192>>2]=b;k[a+200>>2]=b;return}function vx(a){a=a|0;var b=0;k[a>>2]=1464;b=k[a+496>>2]|0;if(b){if(i[a+500>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+496>>2]=0}i[a+500>>0]=1;k[a+496>>2]=0;k[a+488>>2]=0;k[a+492>>2]=0;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function wx(a,b){a=a|0;b=+b;var c=0,d=0,e=0;d=r;r=r+16|0;Cw(1840);if((k[a+280>>2]|0)>0){c=0;do{e=k[(k[a+288>>2]|0)+(c<<2)>>2]|0;Ac[k[(k[e>>2]|0)+8>>2]&7](e,a,b);c=c+1|0}while((c|0)<(k[a+280>>2]|0))}c=k[5104]|0;e=(k[c+16>>2]|0)+-1|0;k[c+16>>2]=e;if(e){r=d;return}do if(k[c+4>>2]|0){Kb(d|0,0)|0;e=k[5090]|0;o[c+8>>2]=+(((k[d+4>>2]|0)-(k[e+4>>2]|0)+(((k[d>>2]|0)-(k[e>>2]|0)|0)*1e6|0)-(k[c+12>>2]|0)|0)>>>0)/1.0e3+ +o[c+8>>2];if(!(k[c+16>>2]|0)){c=k[5104]|0;break}else{r=d;return}}while(0);k[5104]=k[c+20>>2];r=d;return}function xx(a,b){a=a|0;b=b|0;return}function yx(a){a=a|0;return 2}function zx(a){a=a|0;return k[a+72>>2]|0}function Ax(a,b){a=a|0;b=b|0;k[a+72>>2]=b;return}function Bx(a){a=a|0;return}function Cx(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0;d=k[b>>2]|0;if((d|0)==(k[a+80>>2]|0)){e=1.0;return +e}if(k[d+204>>2]&4){e=1.0;return +e}if((+o[a+28>>2]-+o[a+12>>2])*+o[b+8>>2]+(+o[a+32>>2]-+o[a+16>>2])*+o[b+12>>2]+(+o[a+36>>2]-+o[a+20>>2])*+o[b+16>>2]>=-+o[a+84>>2]){e=1.0;return +e}o[a+4>>2]=+o[b+40>>2];k[a+76>>2]=d;if(c){k[a+44>>2]=k[b+8>>2];k[a+44+4>>2]=k[b+8+4>>2];k[a+44+8>>2]=k[b+8+8>>2];k[a+44+12>>2]=k[b+8+12>>2]}else{i=+o[b+8>>2];h=+o[b+12>>2];g=+o[b+16>>2];f=i*+o[d+20>>2]+h*+o[d+24>>2]+g*+o[d+28>>2];e=i*+o[d+36>>2]+h*+o[d+40>>2]+g*+o[d+44>>2];o[a+44>>2]=+o[d+4>>2]*i+ +o[d+8>>2]*h+ +o[d+12>>2]*g;o[a+48>>2]=f;o[a+52>>2]=e;o[a+56>>2]=0.0}k[a+60>>2]=k[b+24>>2];k[a+60+4>>2]=k[b+24+4>>2];k[a+60+8>>2]=k[b+24+8>>2];k[a+60+12>>2]=k[b+24+12>>2];i=+o[b+40>>2];return +i}function Dx(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0;o[a+4>>2]=+o[b+40>>2];d=k[b>>2]|0;k[a+76>>2]=d;if(c){k[a+44>>2]=k[b+8>>2];k[a+44+4>>2]=k[b+8+4>>2];k[a+44+8>>2]=k[b+8+8>>2];k[a+44+12>>2]=k[b+8+12>>2];a=a+60|0;c=b+24|0;k[a>>2]=k[c>>2];k[a+4>>2]=k[c+4>>2];k[a+8>>2]=k[c+8>>2];k[a+12>>2]=k[c+12>>2];e=+o[b+40>>2];return +e}else{i=+o[b+8>>2];h=+o[b+12>>2];g=+o[b+16>>2];f=+o[d+20>>2]*i+ +o[d+24>>2]*h+ +o[d+28>>2]*g;e=+o[d+36>>2]*i+ +o[d+40>>2]*h+ +o[d+44>>2]*g;o[a+44>>2]=+o[d+4>>2]*i+ +o[d+8>>2]*h+ +o[d+12>>2]*g;o[a+48>>2]=f;o[a+52>>2]=e;o[a+56>>2]=0.0;a=a+60|0;c=b+24|0;k[a>>2]=k[c>>2];k[a+4>>2]=k[c+4>>2];k[a+8>>2]=k[c+8>>2];k[a+12>>2]=k[c+12>>2];e=+o[b+40>>2];return +e}return 0.0}function Ex(a,b){a=a|0;b=b|0;var c=0,d=0;c=k[b>>2]|0;d=k[a+80>>2]|0;if((c|0)==(d|0)){a=0;return a|0}if(!((j[a+10>>1]&j[b+4>>1])<<16>>16)){a=0;return a|0}if(!((j[b+6>>1]&j[a+8>>1])<<16>>16)){a=0;return a|0}a=k[a+92>>2]|0;a=dc[k[(k[a>>2]|0)+28>>2]&63](a,d,c)|0;return a|0}function Fx(a,b){a=a|0;b=b|0;if(!((j[b+4>>1]&j[a+10>>1])<<16>>16)){a=0;return a|0}a=(j[a+8>>1]&j[b+6>>1])<<16>>16!=0;return a|0}function Gx(a){a=a|0;jF(a);return}function Hx(a){a=a|0;jF(a);return}function Ix(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;var g=0,h=0,j=0,l=0,m=0,n=0,o=0,p=0,q=0;if((f|0)<0){q=k[a+8>>2]|0;+pc[k[(k[q>>2]|0)+12>>2]&3](q,b,c,d,e,k[a+12>>2]|0,k[a+16>>2]|0,k[a+4>>2]|0,k[a+20>>2]|0,k[a+24>>2]|0);return}o=k[a+16>>2]|0;a:do if((o|0)>0){g=k[a+12>>2]|0;h=0;while(1){m=g+(h<<2)|0;l=k[m>>2]|0;j=k[(k[l+28>>2]|0)+208>>2]|0;if((j|0)<=-1)j=k[(k[l+32>>2]|0)+208>>2]|0;if((j|0)==(f|0)){q=m;break a}h=h+1|0;if((h|0)>=(o|0)){q=0;break}}}else{h=0;q=0}while(0);if((h|0)<(o|0)){m=k[a+12>>2]|0;j=0;while(1){g=k[m+(h<<2)>>2]|0;l=k[(k[g+28>>2]|0)+208>>2]|0;if((l|0)<=-1)l=k[(k[g+32>>2]|0)+208>>2]|0;j=((l|0)==(f|0)&1)+j|0;if((h|0)==(o+-1|0)){p=j;break}else h=h+1|0}}else p=0;h=k[a+4>>2]|0;if((k[h+72>>2]|0)<2){o=k[a+8>>2]|0;+pc[k[(k[o>>2]|0)+12>>2]&3](o,b,c,d,e,q,p,h,k[a+20>>2]|0,k[a+24>>2]|0);return}if((c|0)>0){l=k[a+32>>2]|0;j=k[a+36>>2]|0;f=0;while(1){o=b+(f<<2)|0;if((l|0)==(j|0)){n=(j|0)==0?1:j<<1;if((j|0)<(n|0)){if(!n)l=0;else{k[5108]=(k[5108]|0)+1;j=iF((n<<2|3)+16|0)|0;if(!j)l=0;else{k[(j+4+15&-16)+-4>>2]=j;l=j+4+15&-16}j=k[a+32>>2]|0}if((j|0)>0){m=j+-1|0;g=0;while(1){h=l+(g<<2)|0;if(h)k[h>>2]=k[(k[a+40>>2]|0)+(g<<2)>>2];if((g|0)==(m|0))break;else g=g+1|0}}h=k[a+40>>2]|0;if(h){if(i[a+44>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[h+-4>>2]|0);j=k[a+32>>2]|0}k[a+40>>2]=0}i[a+44>>0]=1;k[a+40>>2]=l;k[a+36>>2]=n;m=j;j=n}else m=j}else m=l;l=(k[a+40>>2]|0)+(m<<2)|0;if(l)k[l>>2]=k[o>>2];l=m+1|0;k[a+32>>2]=l;if((f|0)==(c+-1|0))break;else f=f+1|0}}if((e|0)>0){h=k[a+52>>2]|0;g=k[a+56>>2]|0;f=0;while(1){o=d+(f<<2)|0;if((h|0)==(g|0)){b=(g|0)==0?1:g<<1;if((g|0)<(b|0)){if(!b)h=0;else{k[5108]=(k[5108]|0)+1;h=iF((b<<2|3)+16|0)|0;if(!h)h=0;else{k[(h+4+15&-16)+-4>>2]=h;h=h+4+15&-16}g=k[a+52>>2]|0}if((g|0)>0){l=g+-1|0;m=0;while(1){j=h+(m<<2)|0;if(j)k[j>>2]=k[(k[a+60>>2]|0)+(m<<2)>>2];if((m|0)==(l|0))break;else m=m+1|0}}j=k[a+60>>2]|0;if(j){if(i[a+64>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[j+-4>>2]|0);g=k[a+52>>2]|0}k[a+60>>2]=0}i[a+64>>0]=1;k[a+60>>2]=h;k[a+56>>2]=b;h=g;g=b}else h=g}j=(k[a+60>>2]|0)+(h<<2)|0;if(j)k[j>>2]=k[o>>2];h=h+1|0;k[a+52>>2]=h;if((f|0)==(e+-1|0))break;else f=f+1|0}}if((p|0)>0){f=p+-1|0;g=k[a+72>>2]|0;j=k[a+76>>2]|0;o=0;while(1){n=q+(o<<2)|0;if((g|0)==(j|0)){b=(j|0)==0?1:j<<1;if((j|0)<(b|0)){if(!b){m=0;g=j}else{k[5108]=(k[5108]|0)+1;g=iF((b<<2|3)+16|0)|0;if(!g)g=0;else{k[(g+4+15&-16)+-4>>2]=g;g=g+4+15&-16}m=g;g=k[a+72>>2]|0}if((g|0)>0){j=g+-1|0;l=0;while(1){h=m+(l<<2)|0;if(h)k[h>>2]=k[(k[a+80>>2]|0)+(l<<2)>>2];if((l|0)==(j|0))break;else l=l+1|0}}h=k[a+80>>2]|0;if(h){if(i[a+84>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[h+-4>>2]|0);g=k[a+72>>2]|0}k[a+80>>2]=0}i[a+84>>0]=1;k[a+80>>2]=m;k[a+76>>2]=b;j=b}else g=j}h=(k[a+80>>2]|0)+(g<<2)|0;if(h)k[h>>2]=k[n>>2];g=g+1|0;k[a+72>>2]=g;if((o|0)==(f|0))break;else o=o+1|0}}else g=k[a+72>>2]|0;if(((k[a+52>>2]|0)+g|0)<=(k[(k[a+4>>2]|0)+72>>2]|0))return;Uw(a);return}function Jx(a){a=a|0;Kx(a);jF(a);return}function Kx(a){a=a|0;var b=0;k[a>>2]=2376;b=k[a+80>>2]|0;if(b){if(i[a+84>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+80>>2]=0}i[a+84>>0]=1;k[a+80>>2]=0;k[a+72>>2]=0;k[a+76>>2]=0;b=k[a+60>>2]|0;if(b){if(i[a+64>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+60>>2]=0}i[a+64>>0]=1;k[a+60>>2]=0;k[a+52>>2]=0;k[a+56>>2]=0;b=k[a+40>>2]|0;if(!b){i[a+44>>0]=1;k[a+40>>2]=0;k[a+32>>2]=0;a=a+36|0;k[a>>2]=0;return}if(i[a+44>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+40>>2]=0;i[a+44>>0]=1;k[a+40>>2]=0;k[a+32>>2]=0;a=a+36|0;k[a>>2]=0;return}function Lx(a,b,c){a=a|0;b=b|0;c=c|0;fq(a,b,c)|0;o[b+52>>2]=+o[a+48>>2];o[b+56>>2]=+o[a+52>>2];o[b+60>>2]=+o[a+56>>2];o[b+64>>2]=+o[a+60>>2];o[b+68>>2]=+o[a+64>>2];o[b+72>>2]=+o[a+68>>2];o[b+76>>2]=+o[a+72>>2];o[b+80>>2]=+o[a+76>>2];o[b+84>>2]=+o[a+80>>2];o[b+88>>2]=+o[a+84>>2];o[b+92>>2]=+o[a+88>>2];o[b+96>>2]=+o[a+92>>2];o[b+100>>2]=+o[a+96>>2];o[b+104>>2]=+o[a+100>>2];o[b+108>>2]=+o[a+104>>2];o[b+112>>2]=+o[a+108>>2];o[b+116>>2]=+o[a+112>>2];o[b+120>>2]=+o[a+116>>2];o[b+124>>2]=+o[a+120>>2];o[b+128>>2]=+o[a+124>>2];o[b+132>>2]=+o[a+128>>2];o[b+136>>2]=+o[a+132>>2];o[b+140>>2]=+o[a+136>>2];o[b+144>>2]=+o[a+140>>2];o[b+148>>2]=+o[a+144>>2];o[b+152>>2]=+o[a+148>>2];o[b+156>>2]=+o[a+152>>2];o[b+160>>2]=+o[a+156>>2];o[b+164>>2]=+o[a+160>>2];o[b+168>>2]=+o[a+164>>2];o[b+172>>2]=+o[a+168>>2];o[b+176>>2]=+o[a+172>>2];o[b+228>>2]=+o[a+868>>2];o[b+212>>2]=+o[a+872>>2];o[b+196>>2]=+o[a+680>>2];o[b+180>>2]=+o[a+696>>2];o[b+232>>2]=+o[a+932>>2];o[b+216>>2]=+o[a+936>>2];o[b+200>>2]=+o[a+684>>2];o[b+184>>2]=+o[a+700>>2];o[b+236>>2]=+o[a+996>>2];o[b+220>>2]=+o[a+1e3>>2];o[b+204>>2]=+o[a+688>>2];o[b+188>>2]=+o[a+704>>2];k[b+244>>2]=l[a+1300>>0];k[b+248>>2]=l[a+1301>>0];return 2600}function Mx(a){a=a|0;return 252}function Nx(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function Ox(a,b,c,d){a=a|0;b=b|0;c=c|0;d=+d;return}function Px(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=+e;return}function Qx(a){a=a|0;return}function Rx(a,b,c){a=a|0;b=b|0;c=c|0;Lx(a,b,c)|0;o[b+276>>2]=+o[a+1316>>2];o[b+324>>2]=+o[a+1364>>2];k[b+252>>2]=l[a+1309>>0];o[b+300>>2]=+o[a+1340>>2];o[b+280>>2]=+o[a+1320>>2];o[b+328>>2]=+o[a+1368>>2];k[b+256>>2]=l[a+1310>>0];o[b+304>>2]=+o[a+1344>>2];o[b+284>>2]=+o[a+1324>>2];o[b+332>>2]=+o[a+1372>>2];k[b+260>>2]=l[a+1311>>0];o[b+308>>2]=+o[a+1348>>2];o[b+288>>2]=+o[a+1328>>2];o[b+336>>2]=+o[a+1376>>2];k[b+264>>2]=l[a+1312>>0];o[b+312>>2]=+o[a+1352>>2];o[b+292>>2]=+o[a+1332>>2];o[b+340>>2]=+o[a+1380>>2];k[b+268>>2]=l[a+1313>>0];o[b+316>>2]=+o[a+1356>>2];o[b+296>>2]=+o[a+1336>>2];o[b+344>>2]=+o[a+1384>>2];k[b+272>>2]=l[a+1314>>0];o[b+320>>2]=+o[a+1360>>2];return 2744}function Sx(a){a=a|0;return 348}function Tx(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function Ux(a,b,c){a=a|0;b=b|0;c=c|0;fq(a,b,c)|0;o[b+52>>2]=+o[a+300>>2];o[b+56>>2]=+o[a+304>>2];o[b+60>>2]=+o[a+308>>2];o[b+64>>2]=+o[a+312>>2];o[b+68>>2]=+o[a+316>>2];o[b+72>>2]=+o[a+320>>2];o[b+76>>2]=+o[a+324>>2];o[b+80>>2]=+o[a+328>>2];return 2888}function Vx(a){a=a|0;return 84}function Wx(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function Xx(a){a=a|0;return 52}function Yx(a){a=a|0;return}function Zx(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function _x(a,b,c){a=a|0;b=b|0;c=c|0;fq(a,b,c)|0;o[b+52>>2]=+o[a+52>>2];o[b+56>>2]=+o[a+56>>2];o[b+60>>2]=+o[a+60>>2];o[b+64>>2]=+o[a+64>>2];o[b+68>>2]=+o[a+68>>2];o[b+72>>2]=+o[a+72>>2];o[b+76>>2]=+o[a+76>>2];o[b+80>>2]=+o[a+80>>2];o[b+84>>2]=+o[a+84>>2];o[b+88>>2]=+o[a+88>>2];o[b+92>>2]=+o[a+92>>2];o[b+96>>2]=+o[a+96>>2];o[b+100>>2]=+o[a+100>>2];o[b+104>>2]=+o[a+104>>2];o[b+108>>2]=+o[a+108>>2];o[b+112>>2]=+o[a+112>>2];o[b+116>>2]=+o[a+116>>2];o[b+120>>2]=+o[a+120>>2];o[b+124>>2]=+o[a+124>>2];o[b+128>>2]=+o[a+128>>2];o[b+132>>2]=+o[a+132>>2];o[b+136>>2]=+o[a+136>>2];o[b+140>>2]=+o[a+140>>2];o[b+144>>2]=+o[a+144>>2];o[b+148>>2]=+o[a+148>>2];o[b+152>>2]=+o[a+152>>2];o[b+156>>2]=+o[a+156>>2];o[b+160>>2]=+o[a+160>>2];o[b+164>>2]=+o[a+164>>2];o[b+168>>2]=+o[a+168>>2];o[b+172>>2]=+o[a+172>>2];o[b+176>>2]=+o[a+176>>2];o[b+180>>2]=+o[a+188>>2];o[b+184>>2]=+o[a+184>>2];o[b+188>>2]=+o[a+196>>2];o[b+192>>2]=+o[a+192>>2];k[b+196>>2]=l[a+180>>0];k[b+200>>2]=l[a+49>>0];return 3680}function $x(a){a=a|0;return 204}function ay(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function by(a,b,c){a=a|0;b=b|0;c=c|0;fq(a,b,c)|0;o[b+52>>2]=+o[a+300>>2];o[b+56>>2]=+o[a+304>>2];o[b+60>>2]=+o[a+308>>2];o[b+64>>2]=+o[a+312>>2];o[b+68>>2]=+o[a+316>>2];o[b+72>>2]=+o[a+320>>2];o[b+76>>2]=+o[a+324>>2];o[b+80>>2]=+o[a+328>>2];o[b+84>>2]=+o[a+332>>2];o[b+88>>2]=+o[a+336>>2];o[b+92>>2]=+o[a+340>>2];o[b+96>>2]=+o[a+344>>2];o[b+100>>2]=+o[a+348>>2];o[b+104>>2]=+o[a+352>>2];o[b+108>>2]=+o[a+356>>2];o[b+112>>2]=+o[a+360>>2];o[b+116>>2]=+o[a+364>>2];o[b+120>>2]=+o[a+368>>2];o[b+124>>2]=+o[a+372>>2];o[b+128>>2]=+o[a+376>>2];o[b+132>>2]=+o[a+380>>2];o[b+136>>2]=+o[a+384>>2];o[b+140>>2]=+o[a+388>>2];o[b+144>>2]=+o[a+392>>2];o[b+148>>2]=+o[a+396>>2];o[b+152>>2]=+o[a+400>>2];o[b+156>>2]=+o[a+404>>2];o[b+160>>2]=+o[a+408>>2];o[b+164>>2]=+o[a+412>>2];o[b+168>>2]=+o[a+416>>2];o[b+172>>2]=+o[a+420>>2];o[b+176>>2]=+o[a+424>>2];o[b+180>>2]=+o[a+444>>2];o[b+184>>2]=+o[a+448>>2];o[b+188>>2]=+o[a+452>>2];o[b+192>>2]=+o[a+428>>2];o[b+196>>2]=+o[a+432>>2];o[b+200>>2]=+o[a+436>>2];o[b+204>>2]=+o[a+440>>2];return 3800}function cy(a){a=a|0;return 212}function dy(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function ey(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0;fq(a,b,c)|0;o[b+52>>2]=+o[a+552>>2];o[b+56>>2]=+o[a+556>>2];o[b+60>>2]=+o[a+560>>2];o[b+64>>2]=+o[a+564>>2];o[b+68>>2]=+o[a+568>>2];o[b+72>>2]=+o[a+572>>2];o[b+76>>2]=+o[a+576>>2];o[b+80>>2]=+o[a+580>>2];o[b+84>>2]=+o[a+584>>2];o[b+88>>2]=+o[a+588>>2];o[b+92>>2]=+o[a+592>>2];o[b+96>>2]=+o[a+596>>2];o[b+100>>2]=+o[a+600>>2];o[b+104>>2]=+o[a+604>>2];o[b+108>>2]=+o[a+608>>2];o[b+112>>2]=+o[a+612>>2];o[b+116>>2]=+o[a+616>>2];o[b+120>>2]=+o[a+620>>2];o[b+124>>2]=+o[a+624>>2];o[b+128>>2]=+o[a+628>>2];o[b+132>>2]=+o[a+632>>2];o[b+136>>2]=+o[a+636>>2];o[b+140>>2]=+o[a+640>>2];o[b+144>>2]=+o[a+644>>2];o[b+148>>2]=+o[a+648>>2];o[b+152>>2]=+o[a+652>>2];o[b+156>>2]=+o[a+656>>2];o[b+160>>2]=+o[a+660>>2];o[b+164>>2]=+o[a+664>>2];o[b+168>>2]=+o[a+668>>2];o[b+172>>2]=+o[a+672>>2];o[b+176>>2]=+o[a+676>>2];k[b+184>>2]=l[a+736>>0];k[b+188>>2]=l[a+737>>0];o[b+196>>2]=+o[a+684>>2];o[b+192>>2]=+o[a+680>>2];k[b+180>>2]=l[a+740>>0];e=+o[a+688>>2];f=+o[a+692>>2];d=+kF(e-f,6.2831854820251465);if(!(d<-3.1415927410125732)){if(d>3.1415927410125732)d=d+-6.2831854820251465}else d=d+6.2831854820251465;o[b+200>>2]=d;d=+kF(e+f,6.2831854820251465);if(d<-3.1415927410125732){f=d+6.2831854820251465;c=b+204|0;o[c>>2]=f;c=a+696|0;f=+o[c>>2];c=b+208|0;o[c>>2]=f;c=a+700|0;f=+o[c>>2];c=b+212|0;o[c>>2]=f;a=a+704|0;f=+o[a>>2];a=b+216|0;o[a>>2]=f;return 3928}if(!(d>3.1415927410125732)){f=d;c=b+204|0;o[c>>2]=f;c=a+696|0;f=+o[c>>2];c=b+208|0;o[c>>2]=f;c=a+700|0;f=+o[c>>2];c=b+212|0;o[c>>2]=f;a=a+704|0;f=+o[a>>2];a=b+216|0;o[a>>2]=f;return 3928}f=d+-6.2831854820251465;c=b+204|0;o[c>>2]=f;c=a+696|0;f=+o[c>>2];c=b+208|0;o[c>>2]=f;c=a+700|0;f=+o[c>>2];c=b+212|0;o[c>>2]=f;a=a+704|0;f=+o[a>>2];a=b+216|0;o[a>>2]=f;return 3928}function fy(a){a=a|0;return 220}function gy(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function hy(a){a=a|0;return 1}function iy(a,b,c){a=a|0;b=b|0;c=c|0;return}function jy(a,b,c){a=a|0;b=b|0;c=c|0;return}function ky(a){a=a|0;jF(a);return}function ly(a){a=a|0;return}function my(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;k[a+120>>2]=b;k[a+124>>2]=c;k[a+128>>2]=d;return}function ny(a,b,c){a=a|0;b=b|0;c=+c;Rb[k[(k[a>>2]|0)+16>>2]&31](a,c);return}function oy(a){a=a|0;return}function py(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0;o[a+4>>2]=+o[b+24>>2];d=k[b>>2]|0;k[a+8>>2]=d;if(c){k[a+52>>2]=k[b+8>>2];k[a+52+4>>2]=k[b+8+4>>2];k[a+52+8>>2]=k[b+8+8>>2];k[a+52+12>>2]=k[b+8+12>>2]}else{i=+o[b+8>>2];h=+o[b+12>>2];g=+o[b+16>>2];f=+o[d+20>>2]*i+ +o[d+24>>2]*h+ +o[d+28>>2]*g;e=+o[d+36>>2]*i+ +o[d+40>>2]*h+ +o[d+44>>2]*g;o[a+52>>2]=+o[d+4>>2]*i+ +o[d+8>>2]*h+ +o[d+12>>2]*g;o[a+56>>2]=f;o[a+60>>2]=e;o[a+64>>2]=0.0}i=+o[b+24>>2];o[a+68>>2]=(1.0-i)*+o[a+20>>2]+ +o[a+36>>2]*i;o[a+72>>2]=(1.0-i)*+o[a+24>>2]+i*+o[a+40>>2];o[a+76>>2]=(1.0-i)*+o[a+28>>2]+i*+o[a+44>>2];return +(+o[b+24>>2])}function qy(a,b){a=a|0;b=b|0;if(!((j[b+4>>1]&j[a+14>>1])<<16>>16)){a=0;return a|0}a=(j[a+12>>1]&j[b+6>>1])<<16>>16!=0;return a|0}function ry(a){a=a|0;jF(a);return}function sy(a,b,c){a=a|0;b=b|0;c=+c;Ub[k[(k[a>>2]|0)+32>>2]&127](a,b);Ac[k[(k[a>>2]|0)+36>>2]&7](a,b,c);return}function ty(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0,h=0.0,i=0.0;g=k[b>>2]|0;if((g|0)==(k[a+80>>2]|0)){h=1.0;return +h}if(k[g+204>>2]&4){h=1.0;return +h}f=+o[b+8>>2];e=+o[b+12>>2];d=+o[b+16>>2];if(c){h=f;i=e}else{h=+o[g+4>>2]*f+ +o[g+8>>2]*e+ +o[g+12>>2]*d;i=f*+o[g+20>>2]+e*+o[g+24>>2]+d*+o[g+28>>2];d=f*+o[g+36>>2]+e*+o[g+40>>2]+d*+o[g+44>>2]}if(h*+o[a+84>>2]+i*+o[a+88>>2]+d*+o[a+92>>2]<+o[a+100>>2]){h=1.0;return +h}o[a+4>>2]=+o[b+40>>2];k[a+76>>2]=g;if(c){k[a+44>>2]=k[b+8>>2];k[a+44+4>>2]=k[b+8+4>>2];k[a+44+8>>2]=k[b+8+8>>2];k[a+44+12>>2]=k[b+8+12>>2]}else{d=+o[b+8>>2];i=+o[b+12>>2];e=+o[b+16>>2];f=d*+o[g+20>>2]+i*+o[g+24>>2]+e*+o[g+28>>2];h=d*+o[g+36>>2]+i*+o[g+40>>2]+e*+o[g+44>>2];o[a+44>>2]=+o[g+4>>2]*d+ +o[g+8>>2]*i+ +o[g+12>>2]*e;o[a+48>>2]=f;o[a+52>>2]=h;o[a+56>>2]=0.0}k[a+60>>2]=k[b+24>>2];k[a+60+4>>2]=k[b+24+4>>2];k[a+60+8>>2]=k[b+24+8>>2];k[a+60+12>>2]=k[b+24+12>>2];h=+o[b+40>>2];return +h}function uy(a){a=a|0;jF(a);return}function vy(a){a=a|0;return 256}function wy(a,b){a=a|0;b=b|0;return 1}function xy(a){a=a|0;return k[a+68>>2]|0}function yy(a){a=a|0;return k[a+68>>2]|0}function zy(a){a=a|0;if(!(k[a+12>>2]|0)){a=0;return a|0}a=k[a+20>>2]|0;return a|0}function Ay(a,b){a=a|0;b=b|0;return k[(k[a+20>>2]|0)+(b<<2)>>2]|0}function By(a){a=a|0;return k[a+12>>2]|0}function Cy(a){a=a|0;return}function Dy(a,b){a=a|0;b=b|0;var c=0;c=k[a+8>>2]|0;yc[k[c+60>>2]&127](b,c,k[a+4>>2]|0);return 0}function Ey(a){a=a|0;jF(a);return}function Fy(a){a=a|0;return k[a+24>>2]|0}function Gy(a){a=a|0;return k[a+16>>2]|0}function Hy(a){a=a|0;return k[a+8>>2]|0}function Iy(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0;e=k[b>>2]|0;e=nc[k[(k[e>>2]|0)+56>>2]&31](e,28)|0;if(!(i[a+4>>0]|0)){if(!e){a=0;return a|0}g=k[a+8>>2]|0;f=k[a+12>>2]|0;a=k[b>>2]|0;k[e+4>>2]=a;k[e>>2]=7032;i[e+8>>0]=0;k[e+12>>2]=0;i[e+16>>0]=0;k[e+20>>2]=g;k[e+24>>2]=f;if(!(dc[k[(k[a>>2]|0)+24>>2]&63](a,k[c+8>>2]|0,k[d+8>>2]|0)|0)){g=e;return g|0}g=k[e+4>>2]|0;g=dc[k[(k[g>>2]|0)+12>>2]&63](g,k[c+8>>2]|0,k[d+8>>2]|0)|0;k[e+12>>2]=g;i[e+8>>0]=1;g=e;return g|0}else{if(!e){g=0;return g|0}h=k[a+8>>2]|0;f=k[a+12>>2]|0;g=k[b>>2]|0;k[e+4>>2]=g;k[e>>2]=7032;i[e+8>>0]=0;k[e+12>>2]=0;i[e+16>>0]=1;k[e+20>>2]=h;k[e+24>>2]=f;if(!(dc[k[(k[g>>2]|0)+24>>2]&63](g,k[d+8>>2]|0,k[c+8>>2]|0)|0)){h=e;return h|0}h=k[e+4>>2]|0;h=dc[k[(k[h>>2]|0)+12>>2]&63](h,k[d+8>>2]|0,k[c+8>>2]|0)|0;k[e+12>>2]=h;i[e+8>>0]=1;h=e;return h|0}return 0}function Jy(a){a=a|0;jF(a);return}function Ky(a){a=a|0;return}function Ly(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;a=k[b>>2]|0;a=nc[k[(k[a>>2]|0)+56>>2]&31](a,16)|0;if(!a){b=0;return b|0}b=k[b>>2]|0;k[a+4>>2]=b;k[a>>2]=7808;i[a+8>>0]=0;k[a+12>>2]=0;if(!(dc[k[(k[b>>2]|0)+24>>2]&63](b,k[c+8>>2]|0,k[d+8>>2]|0)|0)){b=a;return b|0}b=k[a+4>>2]|0;b=dc[k[(k[b>>2]|0)+12>>2]&63](b,k[c+8>>2]|0,k[d+8>>2]|0)|0;k[a+12>>2]=b;i[a+8>>0]=1;b=a;return b|0}function My(a){a=a|0;jF(a);return}function Ny(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0;e=k[b>>2]|0;e=nc[k[(k[e>>2]|0)+56>>2]&31](e,20)|0;if(!e){d=0;return d|0}f=k[b+4>>2]|0;a=i[a+4>>0]|0;b=k[b>>2]|0;k[e+4>>2]=b;k[e>>2]=10312;i[e+8>>0]=0;k[e+12>>2]=f;i[e+16>>0]=a;if(f){f=e;return f|0}f=dc[k[(k[b>>2]|0)+12>>2]&63](b,k[c+8>>2]|0,k[d+8>>2]|0)|0;k[e+12>>2]=f;i[e+8>>0]=1;f=e;return f|0}function Oy(a){a=a|0;jF(a);return}function Py(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;a=k[b>>2]|0;a=nc[k[(k[a>>2]|0)+56>>2]&31](a,16)|0;if(!a){d=0;return d|0}b=k[b>>2]|0;k[a+4>>2]=b;k[a>>2]=19672;i[a+8>>0]=0;k[a+12>>2]=0;d=dc[k[(k[b>>2]|0)+12>>2]&63](b,k[c+8>>2]|0,k[d+8>>2]|0)|0;k[a+12>>2]=d;i[a+8>>0]=1;d=a;return d|0}function Qy(a){a=a|0;jF(a);return}function Ry(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;c=k[b>>2]|0;c=nc[k[(k[c>>2]|0)+56>>2]&31](c,8)|0;if(!c){b=0;return b|0}k[c+4>>2]=k[b>>2];k[c>>2]=19600;b=c;return b|0}function Sy(a){a=a|0;jF(a);return}function Ty(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;a=k[b>>2]|0;a=nc[k[(k[a>>2]|0)+56>>2]&31](a,44)|0;if(!a){b=0;return b|0}Ms(a,k[b>>2]|0,k[b+4>>2]|0,c,d,1);b=a;return b|0}function Uy(a){a=a|0;jF(a);return}function Vy(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,l=0;j=k[b>>2]|0;j=nc[k[(k[j>>2]|0)+56>>2]&31](j,48)|0;if(!j){d=0;return d|0}k[j+4>>2]=k[b>>2];k[j>>2]=11184;i[j+28>>0]=1;k[j+24>>2]=0;k[j+16>>2]=0;k[j+20>>2]=0;k[j+32>>2]=k[b+4>>2];i[j+36>>0]=0;k[5108]=(k[5108]|0)+1;g=iF(87)|0;if((g|0)!=0?(h=g+4+15&-16,k[h+-4>>2]=g,(g+4+15&-16|0)!=0):0){k[(g+4+15&-16)>>2]=19920;i[h+20>>0]=1;k[h+16>>2]=0;k[h+8>>2]=0;k[h+12>>2]=0;i[h+24>>0]=0;i[h+44>>0]=1;k[h+40>>2]=0;k[h+32>>2]=0;k[h+36>>2]=0;i[h+64>>0]=1;k[h+60>>2]=0;k[h+52>>2]=0;k[h+56>>2]=0;k[5108]=(k[5108]|0)+1;a=iF(43)|0;if(!a)f=0;else{k[(a+4+15&-16)+-4>>2]=a;f=a+4+15&-16}b=k[h+8>>2]|0;if((b|0)>0){e=0;while(1){a=f+(e*12|0)|0;if(a){l=(k[h+16>>2]|0)+(e*12|0)|0;k[a>>2]=k[l>>2];k[a+4>>2]=k[l+4>>2];k[a+8>>2]=k[l+8>>2]}if((e|0)==(b+-1|0))break;else e=e+1|0}}b=k[h+16>>2]|0;if(b){if(i[h+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[h+16>>2]=0}i[h+20>>0]=1;k[h+16>>2]=f;k[h+12>>2]=2;jw(g+4+15&-16);a=g+4+15&-16}else a=0;k[j+8>>2]=a;k[j+40>>2]=k[(k[c+4>>2]|0)+68>>2];k[j+44>>2]=k[(k[d+4>>2]|0)+68>>2];l=j;return l|0}function Wy(a){a=a|0;jF(a);return}function Xy(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;a=k[b>>2]|0;a=nc[k[(k[a>>2]|0)+56>>2]&31](a,44)|0;if(!a){b=0;return b|0}Ms(a,k[b>>2]|0,k[b+4>>2]|0,c,d,0);b=a;return b|0}function Yy(a){a=a|0;jF(a);return}function Zy(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;a=k[b>>2]|0;a=nc[k[(k[a>>2]|0)+56>>2]&31](a,80)|0;if(!a){b=0;return b|0}b=k[b>>2]|0;k[a+4>>2]=b;k[a>>2]=7152;i[a+8>>0]=1;k[a+12>>2]=7184;k[a+60>>2]=b;k[a+64>>2]=0;k[a+16>>2]=d;k[a+20>>2]=c;b=dc[k[(k[b>>2]|0)+12>>2]&63](b,k[d+8>>2]|0,k[c+8>>2]|0)|0;k[a+76>>2]=b;d=k[a+60>>2]|0;Ub[k[(k[d>>2]|0)+20>>2]&127](d,b);b=a;return b|0}function _y(a){a=a|0;jF(a);return}function $y(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;a=k[b>>2]|0;a=nc[k[(k[a>>2]|0)+56>>2]&31](a,80)|0;if(!a){b=0;return b|0}b=k[b>>2]|0;k[a+4>>2]=b;k[a>>2]=7152;i[a+8>>0]=0;k[a+12>>2]=7184;k[a+60>>2]=b;k[a+64>>2]=0;k[a+16>>2]=c;k[a+20>>2]=d;b=dc[k[(k[b>>2]|0)+12>>2]&63](b,k[c+8>>2]|0,k[d+8>>2]|0)|0;k[a+76>>2]=b;d=k[a+60>>2]|0;Ub[k[(k[d>>2]|0)+20>>2]&127](d,b);b=a;return b|0}function az(a){a=a|0;jF(a);return}function bz(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0;if(!(k[a+12>>2]|0))return;if(!(i[a+8>>0]|0))return;d=k[b+4>>2]|0;if((d|0)==(k[b+8>>2]|0)?(h=(d|0)==0?1:d<<1,(d|0)<(h|0)):0){if(!h)g=0;else{k[5108]=(k[5108]|0)+1;c=iF((h<<2|3)+16|0)|0;if(!c)d=0;else{k[(c+4+15&-16)+-4>>2]=c;d=c+4+15&-16}g=d;d=k[b+4>>2]|0}if((d|0)>0){c=d+-1|0;f=0;while(1){e=g+(f<<2)|0;if(e)k[e>>2]=k[(k[b+12>>2]|0)+(f<<2)>>2];if((f|0)==(c|0))break;else f=f+1|0}}c=k[b+12>>2]|0;if(c){if(i[b+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);d=k[b+4>>2]|0}k[b+12>>2]=0}i[b+16>>0]=1;k[b+12>>2]=g;k[b+8>>2]=h}c=(k[b+12>>2]|0)+(d<<2)|0;if(c)k[c>>2]=k[a+12>>2];k[b+4>>2]=d+1;return}function cz(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0;d=r;r=r+784|0;o[d+712>>2]=1.0;k[d+712+4>>2]=0;k[d+712+4+4>>2]=0;k[d+712+4+8>>2]=0;k[d+712+4+12>>2]=0;o[d+712+20>>2]=1.0;k[d+712+24>>2]=0;k[d+712+24+4>>2]=0;k[d+712+24+8>>2]=0;k[d+712+24+12>>2]=0;o[d+712+40>>2]=1.0;c=d+712+44|0;k[c>>2]=0;k[c+4>>2]=0;k[c+8>>2]=0;k[c+12>>2]=0;k[c+16>>2]=0;k[d+536>>2]=7512;k[d+536+168>>2]=0;o[d+536+172>>2]=0.0;o[d+536+164>>2]=+o[a+200>>2];f=+o[a+196>>2];k[d+480+8>>2]=0;o[d+480+12>>2]=1.0;o[d+480+16>>2]=1.0;o[d+480+20>>2]=1.0;o[d+480+24>>2]=0.0;k[d+480>>2]=12008;k[d+480+4>>2]=8;o[d+480+28>>2]=f;o[d+480+44>>2]=f;k[d+376+8>>2]=0;o[d+376+12>>2]=1.0;o[d+376+16>>2]=1.0;o[d+376+20>>2]=1.0;o[d+376+24>>2]=0.0;o[d+376+44>>2]=.03999999910593033;k[d+376+52>>2]=0;k[d+376>>2]=7584;k[d+376+4>>2]=1;k[d+376+56>>2]=k[b>>2];k[d+376+56+4>>2]=k[b+4>>2];k[d+376+56+8>>2]=k[b+8>>2];k[d+376+56+12>>2]=k[b+12>>2];k[d+376+72>>2]=k[b+16>>2];k[d+376+72+4>>2]=k[b+16+4>>2];k[d+376+72+8>>2]=k[b+16+8>>2];k[d+376+72+12>>2]=k[b+16+12>>2];k[d+376+88>>2]=k[b+32>>2];k[d+376+88+4>>2]=k[b+32+4>>2];k[d+376+88+8>>2]=k[b+32+8>>2];k[d+376+88+12>>2]=k[b+32+12>>2];o[d+16+308>>2]=9.999999747378752e-05;i[d+16+332>>0]=0;k[d>>2]=18976;k[d+4>>2]=d+16;k[d+8>>2]=d+480;k[d+12>>2]=d+376;if(Rv(d,a+4|0,a+68|0,d+712|0,d+712|0,d+536|0)|0?(e=+o[d+536+164>>2],+o[a+200>>2]>e):0)o[a+200>>2]=e;k[d+376>>2]=13336;c=k[d+376+52>>2]|0;if(!c){r=d;return}Sb[k[k[c>>2]>>2]&255](c);c=k[d+376+52>>2]|0;if(!c){r=d;return}k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);r=d;return}function dz(a){a=a|0;return}function ez(a){a=a|0;jF(a);return}function fz(a,b,c){a=a|0;b=b|0;c=c|0;return}function gz(a,b){a=a|0;b=b|0;return}function hz(a,b){a=a|0;b=+b;return}function iz(a){a=a|0;jF(a);return}function jz(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0;f=+o[a+56>>2];i=+o[a+72>>2]-f;h=+o[a+60>>2];g=+o[a+76>>2]-h;j=+o[a+64>>2];l=+o[a+80>>2]-j;f=+o[a+88>>2]-f;h=+o[a+92>>2]-h;j=+o[a+96>>2]-j;o[c+12>>2]=0.0;e=1.0/+Y(+((i*h-g*f)*(i*h-g*f)+((g*j-l*h)*(g*j-l*h)+(l*f-i*j)*(l*f-i*j))));o[c>>2]=e*(g*j-l*h);o[c+4>>2]=e*(l*f-i*j);o[c+8>>2]=(i*h-g*f)*e;k[d>>2]=k[a+56>>2];k[d+4>>2]=k[a+56+4>>2];k[d+8>>2]=k[a+56+8>>2];k[d+12>>2]=k[a+56+12>>2];return}function kz(a,b,c){a=a|0;b=b|0;c=+c;var d=0,e=0.0,f=0.0,g=0.0,h=0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0;h=r;r=r+32|0;l=+o[a+56>>2];q=+o[a+72>>2]-l;j=+o[a+60>>2];n=+o[a+76>>2]-j;i=+o[a+64>>2];s=+o[a+80>>2]-i;m=+o[a+88>>2]-l;p=+o[a+92>>2]-j;f=+o[a+96>>2]-i;g=1.0/+Y(+((q*p-n*m)*(q*p-n*m)+((n*f-s*p)*(n*f-s*p)+(s*m-q*f)*(s*m-q*f))));e=g*(n*f-s*p);f=g*(s*m-q*f);g=(q*p-n*m)*g;i=+o[b>>2]*e+ +o[b+4>>2]*f+g*+o[b+8>>2]-(e*l+f*j+g*i);if(!(i>=-c)|!(i<=c)){d=0;r=h;return d|0}d=0;while(1){Cc[k[(k[a>>2]|0)+104>>2]&127](a,d,h+16|0,h);i=+o[h+16>>2];s=+o[h>>2]-i;l=+o[h+16+4>>2];j=+o[h+4>>2]-l;q=+o[h+16+8>>2];n=+o[h+8>>2]-q;m=1.0/+Y(+((f*s-e*j)*(f*s-e*j)+((g*j-f*n)*(g*j-f*n)+(e*n-g*s)*(e*n-g*s))));d=d+1|0;if(+o[b>>2]*(m*(g*j-f*n))+ +o[b+4>>2]*(m*(e*n-g*s))+(f*s-e*j)*m*+o[b+8>>2]-(q*((f*s-e*j)*m)+(i*(m*(g*j-f*n))+l*(m*(e*n-g*s))))<-c){b=0;d=5;break}if((d|0)>=3){b=1;d=5;break}}if((d|0)==5){r=h;return b|0}return 0}function lz(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;Cc[k[(k[a>>2]|0)+124>>2]&127](a,d,b,c);return}function mz(a){a=a|0;return 1}function nz(a,b,c){a=a|0;b=b|0;c=c|0;k[c>>2]=k[a+56+(b<<4)>>2];k[c+4>>2]=k[a+56+(b<<4)+4>>2];k[c+8>>2]=k[a+56+(b<<4)+8>>2];k[c+12>>2]=k[a+56+(b<<4)+12>>2];return}function oz(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;yc[k[(k[a>>2]|0)+108>>2]&127](a,b,c);yc[k[(k[a>>2]|0)+108>>2]&127](a,(b+1|0)%3|0,d);return}function pz(a){a=a|0;return 3}function qz(a){a=a|0;return 3}function rz(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0;g=+o[a+56>>2];i=+o[a+72>>2]-g;h=+o[a+60>>2];j=+o[a+76>>2]-h;d=+o[a+64>>2];f=+o[a+80>>2]-d;g=+o[a+88>>2]-g;h=+o[a+92>>2]-h;d=+o[a+96>>2]-d;o[c+12>>2]=0.0;e=1.0/+Y(+((i*h-j*g)*(i*h-j*g)+((j*d-f*h)*(j*d-f*h)+(f*g-i*d)*(f*g-i*d))));o[c>>2]=e*(j*d-f*h);o[c+4>>2]=e*(f*g-i*d);o[c+8>>2]=(i*h-j*g)*e;if(!b)return;o[c>>2]=-(e*(j*d-f*h));o[c+4>>2]=-(e*(f*g-i*d));o[c+8>>2]=-((i*h-j*g)*e);return}function sz(a){a=a|0;return 2}function tz(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0.0,g=0.0,h=0.0,i=0,j=0,l=0.0,m=0.0;if((d|0)<=0)return;j=0;while(1){m=+o[b+(j<<4)>>2];l=+o[b+(j<<4)+4>>2];h=+o[b+(j<<4)+8>>2];f=m*+o[a+56>>2]+l*+o[a+60>>2]+h*+o[a+64>>2];g=m*+o[a+72>>2]+l*+o[a+76>>2]+h*+o[a+80>>2];h=m*+o[a+88>>2]+l*+o[a+92>>2]+h*+o[a+96>>2];i=c+(j<<4)|0;if(f<g)e=g<h?2:1;else e=f<h?2:0;e=a+56+(e<<4)|0;k[i>>2]=k[e>>2];k[i+4>>2]=k[e+4>>2];k[i+8>>2]=k[e+8>>2];k[i+12>>2]=k[e+12>>2];if((j|0)==(d+-1|0))break;else j=j+1|0}return}function uz(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0;h=+o[c>>2];g=+o[c+4>>2];f=+o[c+8>>2];d=h*+o[b+56>>2]+g*+o[b+60>>2]+f*+o[b+64>>2];e=h*+o[b+72>>2]+g*+o[b+76>>2]+f*+o[b+80>>2];f=h*+o[b+88>>2]+g*+o[b+92>>2]+f*+o[b+96>>2];if(d<e)c=e<f?2:1;else c=d<f?2:0;b=b+56+(c<<4)|0;k[a>>2]=k[b>>2];k[a+4>>2]=k[b+4>>2];k[a+8>>2]=k[b+8>>2];k[a+12>>2]=k[b+12>>2];return}function vz(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0;d=nc[k[(k[c>>2]|0)+40>>2]&31](c,a)|0;e=nc[k[(k[c>>2]|0)+28>>2]&31](c,d)|0;k[b>>2]=e;if(e)Ub[k[(k[c>>2]|0)+48>>2]&127](c,d);k[b+4>>2]=k[a+4>>2];o[b+28>>2]=+o[a+28>>2];o[b+32>>2]=+o[a+32>>2];o[b+36>>2]=+o[a+36>>2];o[b+40>>2]=+o[a+40>>2];o[b+12>>2]=+o[a+12>>2];o[b+16>>2]=+o[a+16>>2];o[b+20>>2]=+o[a+20>>2];o[b+24>>2]=+o[a+24>>2];o[b+44>>2]=+o[a+44>>2];return 7752}function wz(a){a=a|0;return 52}function xz(a,b){a=a|0;b=b|0;o[a>>2]=1.0;o[a+4>>2]=1.0;o[a+8>>2]=1.0;o[a+12>>2]=0.0;return}function yz(a){a=a|0;return 7784}function zz(a,b,c){a=a|0;b=+b;c=c|0;k[c>>2]=0;k[c+4>>2]=0;k[c+8>>2]=0;k[c+12>>2]=0;return}function Az(a){a=a|0;return a+12|0}function Bz(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;Cc[k[(k[a>>2]|0)+80>>2]&127](a,b,c,d);return}function Cz(a){a=a|0;var b=0,c=0;k[a>>2]=13336;b=k[a+52>>2]|0;if((b|0)!=0?(Sb[k[k[b>>2]>>2]&255](b),c=k[a+52>>2]|0,(c|0)!=0):0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function Dz(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0;if(!(k[a+12>>2]|0))return;if(!(i[a+8>>0]|0))return;d=k[b+4>>2]|0;if((d|0)==(k[b+8>>2]|0)?(h=(d|0)==0?1:d<<1,(d|0)<(h|0)):0){if(!h)g=0;else{k[5108]=(k[5108]|0)+1;c=iF((h<<2|3)+16|0)|0;if(!c)d=0;else{k[(c+4+15&-16)+-4>>2]=c;d=c+4+15&-16}g=d;d=k[b+4>>2]|0}if((d|0)>0){c=d+-1|0;f=0;while(1){e=g+(f<<2)|0;if(e)k[e>>2]=k[(k[b+12>>2]|0)+(f<<2)>>2];if((f|0)==(c|0))break;else f=f+1|0}}c=k[b+12>>2]|0;if(c){if(i[b+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);d=k[b+4>>2]|0}k[b+12>>2]=0}i[b+16>>0]=1;k[b+12>>2]=g;k[b+8>>2]=h}c=(k[b+12>>2]|0)+(d<<2)|0;if(c)k[c>>2]=k[a+12>>2];k[b+4>>2]=d+1;return}function Ez(a,b,c){a=a|0;b=b|0;c=c|0;k[a+20>>2]=b;k[a+28>>2]=c;return}function Fz(a,b,c){a=a|0;b=b|0;c=c|0;k[a+16>>2]=b;k[a+24>>2]=c;return}function Gz(a){a=a|0;jF(a);return}function Hz(a){a=a|0;return}function Iz(a){a=a|0;return}function Jz(a){a=a|0;jF(a+-4|0);return}function Kz(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;Cc[k[(k[a+-4>>2]|0)+8>>2]&127](a+-4|0,b,c,d);return}function Lz(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;Cc[k[(k[a>>2]|0)+8>>2]&127](a,b,c,d);return}function Mz(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0,G=0.0,H=0.0;d=r;r=r+96|0;i=+o[b>>2];s=+o[a+28>>2];B=+o[b+4>>2];D=+o[a+32>>2];j=+o[b+8>>2];l=+o[a+36>>2];m=+o[a+44>>2];n=+o[a+48>>2];p=+o[a+52>>2];q=+o[a+60>>2];t=+o[a+64>>2];u=+o[a+68>>2];v=+o[a+76>>2];w=+o[a+80>>2];x=+o[a+84>>2];o[d+80>>2]=i*s+B*D+j*l+v;o[d+80+4>>2]=i*m+B*n+j*p+w;o[d+80+8>>2]=i*q+B*t+j*u+x;o[d+80+12>>2]=0.0;y=+o[b+16>>2];z=+o[b+20>>2];A=+o[b+24>>2];o[d+64>>2]=y*s+z*D+A*l+v;o[d+64+4>>2]=y*m+z*n+A*p+w;o[d+64+8>>2]=y*q+z*t+A*u+x;o[d+64+12>>2]=0.0;C=+o[b+32>>2];E=+o[b+36>>2];h=+o[b+40>>2];o[d+48>>2]=C*s+E*D+h*l+v;o[d+48+4>>2]=C*m+E*n+h*p+w;o[d+48+8>>2]=C*q+E*t+h*u+x;o[d+48+12>>2]=0.0;e=(i*s+B*D+j*l+v+(y*s+z*D+A*l+v)+(C*s+E*D+h*l+v))*.3333333432674408;f=(i*m+B*n+j*p+w+(y*m+z*n+A*p+w)+(C*m+E*n+h*p+w))*.3333333432674408;g=(i*q+B*t+j*u+x+(y*q+z*t+A*u+x)+(C*q+E*t+h*u+x))*.3333333432674408;o[d+32>>2]=e;o[d+32+4>>2]=f;o[d+32+8>>2]=g;o[d+32+12>>2]=0.0;b=k[a+8>>2]|0;if(!((Wb[k[(k[b>>2]|0)+48>>2]&127](b)|0)&16384)){c=k[a+8>>2]|0;F=k[c>>2]|0;F=F+8|0;F=k[F>>2]|0;b=a+12|0;Cc[F&127](c,d+80|0,d+64|0,b);c=k[a+8>>2]|0;F=k[c>>2]|0;F=F+8|0;F=k[F>>2]|0;Cc[F&127](c,d+64|0,d+48|0,b);a=k[a+8>>2]|0;c=k[a>>2]|0;c=c+8|0;c=k[c>>2]|0;Cc[c&127](a,d+48|0,d+80|0,b);r=d;return}H=y*s+z*D+A*l+v-(i*s+B*D+j*l+v);G=y*m+z*n+A*p+w-(i*m+B*n+j*p+w);z=y*q+z*t+A*u+x-(i*q+B*t+j*u+x);D=C*s+E*D+h*l+v-(i*s+B*D+j*l+v);A=C*m+E*n+h*p+w-(i*m+B*n+j*p+w);C=C*q+E*t+h*u+x-(i*q+B*t+j*u+x);E=1.0/+Y(+((H*A-G*D)*(H*A-G*D)+((G*C-z*A)*(G*C-z*A)+(z*D-H*C)*(z*D-H*C))));o[d+16>>2]=1.0;o[d+16+4>>2]=1.0;o[d+16+8>>2]=0.0;o[d+16+12>>2]=0.0;b=k[a+8>>2]|0;c=k[(k[b>>2]|0)+8>>2]|0;o[d>>2]=E*(G*C-z*A)+e;o[d+4>>2]=E*(z*D-H*C)+f;o[d+8>>2]=E*(H*A-G*D)+g;o[d+12>>2]=0.0;Cc[c&127](b,d+32|0,d,d+16|0);b=k[a+8>>2]|0;c=k[b>>2]|0;c=c+8|0;c=k[c>>2]|0;F=a+12|0;Cc[c&127](b,d+80|0,d+64|0,F);b=k[a+8>>2]|0;c=k[b>>2]|0;c=c+8|0;c=k[c>>2]|0;Cc[c&127](b,d+64|0,d+48|0,F);a=k[a+8>>2]|0;b=k[a>>2]|0;b=b+8|0;b=k[b>>2]|0;Cc[b&127](a,d+48|0,d+80|0,F);r=d;return}function Nz(a){a=a|0;jF(a);return}function Oz(a,b,c,d){a=a|0;b=b|0;c=c|0;d=+d;var e=0.0,f=0.0,g=0.0,h=0.0,j=0.0,l=0.0,m=0.0,n=0,p=0.0,q=0.0,s=0.0,t=0.0,u=0,v=0,w=0,x=0.0,y=0,z=0;w=r;r=r+192|0;u=k[(k[a+4>>2]|0)+740>>2]|0;v=k[(k[a+8>>2]|0)+8>>2]|0;m=+o[c>>2];q=+o[b>>2]*d+m;e=+o[c+4>>2];s=+o[b+4>>2]*d+e;f=+o[c+8>>2];t=+o[b+8>>2]*d+f;n=k[(k[a+12>>2]|0)+8>>2]|0;p=+o[n+52>>2];if((u|0)!=(v|0)){j=s-+o[n+56>>2];h=t-+o[n+60>>2];x=m-+o[v+52>>2];m=e-+o[v+56>>2];f=f-+o[v+60>>2];e=(q-p)*+o[n+4>>2]+j*+o[n+20>>2]+h*+o[n+36>>2];g=(q-p)*+o[n+8>>2]+j*+o[n+24>>2]+h*+o[n+40>>2];h=(q-p)*+o[n+12>>2]+j*+o[n+28>>2]+h*+o[n+44>>2];j=x*+o[v+4>>2]+m*+o[v+20>>2]+f*+o[v+36>>2];l=x*+o[v+8>>2]+m*+o[v+24>>2]+f*+o[v+40>>2];f=x*+o[v+12>>2]+m*+o[v+28>>2]+f*+o[v+44>>2]}else{l=q-+o[u+52>>2];j=s-+o[u+56>>2];h=t-+o[u+60>>2];x=e-+o[n+56>>2];f=f-+o[n+60>>2];e=l*+o[u+4>>2]+j*+o[u+20>>2]+h*+o[u+36>>2];g=l*+o[u+8>>2]+j*+o[u+24>>2]+h*+o[u+40>>2];h=l*+o[u+12>>2]+j*+o[u+28>>2]+h*+o[u+44>>2];j=(m-p)*+o[n+4>>2]+x*+o[n+20>>2]+f*+o[n+36>>2];l=(m-p)*+o[n+8>>2]+x*+o[n+24>>2]+f*+o[n+40>>2];f=(m-p)*+o[n+12>>2]+x*+o[n+28>>2]+f*+o[n+44>>2]}o[w>>2]=e;o[w+4>>2]=g;o[w+8>>2]=h;o[w+12>>2]=0.0;o[w+16>>2]=j;o[w+20>>2]=l;o[w+24>>2]=f;o[w+28>>2]=0.0;k[w+64>>2]=k[b>>2];k[w+64+4>>2]=k[b+4>>2];k[w+64+8>>2]=k[b+8>>2];k[w+64+12>>2]=k[b+12>>2];o[w+80>>2]=d;o[w+84>>2]=0.0;o[w+88>>2]=0.0;o[w+92>>2]=0.0;k[w+112>>2]=0;i[w+116>>0]=0;k[w+120>>2]=0;k[w+120+4>>2]=0;k[w+120+8>>2]=0;k[w+120+12>>2]=0;k[w+120+16>>2]=0;k[w+120+20>>2]=0;k[w+120+24>>2]=0;k[w+120+28>>2]=0;o[w+48>>2]=q;o[w+52>>2]=s;o[w+56>>2]=t;o[w+60>>2]=0.0;k[w+32>>2]=k[c>>2];k[w+32+4>>2]=k[c+4>>2];k[w+32+8>>2]=k[c+8>>2];k[w+32+12>>2]=k[c+12>>2];b=k[a+20>>2]|0;n=k[a+16>>2]|0;c=k[a+28>>2]|0;z=k[a+24>>2]|0;y=(u|0)!=(v|0)?b:n;b=(u|0)!=(v|0)?n:b;n=(u|0)!=(v|0)?c:z;c=(u|0)!=(v|0)?z:c;k[w+96>>2]=y;k[w+100>>2]=b;k[w+104>>2]=n;k[w+108>>2]=c;z=k[a+32>>2]|0;+ac[k[(k[z>>2]|0)+12>>2]&1](z,w,k[((u|0)!=(v|0)?a+12|0:a+8|0)>>2]|0,y,n,k[((u|0)!=(v|0)?a+8|0:a+12|0)>>2]|0,b,c);r=w;return}function Pz(a){a=a|0;jF(a);return}function Qz(a){a=a|0;return}function Rz(a,b){a=a|0;b=b|0;var c=0,d=0,e=0.0,f=0,g=0;d=r;r=r+32|0;c=k[a+184>>2]|0;if(+o[c+4>>2]==0.0){a=0;r=d;return a|0}b=k[b>>2]|0;if(!(nc[k[(k[c>>2]|0)+8>>2]&31](c,k[b+188>>2]|0)|0)){a=1;r=d;return a|0}f=k[a+192>>2]|0;g=k[b+192>>2]|0;c=k[a+184>>2]|0;e=+o[a+188>>2];k[d>>2]=0;k[d+4>>2]=g;k[d+8>>2]=b;k[d+12>>2]=b+4;k[d+16>>2]=-1;k[d+20>>2]=-1;us(f,a+36|0,a+100|0,d,c,e);a=1;r=d;return a|0}function Sz(a){a=a|0;jF(a);return}function Tz(a,b){a=a|0;b=b|0;var c=0,d=0,e=0;d=r;r=r+32|0;c=k[a+216>>2]|0;if(+o[c+4>>2]==0.0){a=0;r=d;return a|0}b=k[b>>2]|0;if(!(nc[k[(k[c>>2]|0)+8>>2]&31](c,k[b+188>>2]|0)|0)){a=1;r=d;return a|0}e=k[b+192>>2]|0;c=k[a+216>>2]|0;k[d>>2]=0;k[d+4>>2]=e;k[d+8>>2]=b;k[d+12>>2]=b+4;k[d+16>>2]=-1;k[d+20>>2]=-1;ts(a+68|0,a+132|0,d,c);a=1;r=d;return a|0}function Uz(a){a=a|0;jF(a);return}function Vz(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0;d=r;r=r+16|0;k[d>>2]=-1;k[d+4>>2]=k[a+16>>2];if(!(k[b+4>>2]|0))k[b+4>>2]=d;f=k[a+12>>2]|0;e=+oc[k[(k[f>>2]|0)+12>>2]&15](f,b,c);o[a+4>>2]=+o[(k[a+12>>2]|0)+4>>2];r=d;return +e}function Wz(a,b){a=a|0;b=b|0;a=k[a+12>>2]|0;return nc[k[(k[a>>2]|0)+8>>2]&31](a,b)|0}function Xz(a){a=a|0;jF(a);return}function Yz(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=+d;e=e|0;f=f|0;var g=0;g=r;r=r+64|0;k[g+48>>2]=e;k[g+48+4>>2]=f;e=k[a+212>>2]|0;if(!(+o[e+4>>2]>=d)){r=g;return +d}k[g>>2]=k[a+216>>2];k[g+4>>2]=g+48;k[g+8>>2]=k[b>>2];k[g+8+4>>2]=k[b+4>>2];k[g+8+8>>2]=k[b+8>>2];k[g+8+12>>2]=k[b+12>>2];k[g+24>>2]=k[c>>2];k[g+24+4>>2]=k[c+4>>2];k[g+24+8>>2]=k[c+8>>2];k[g+24+12>>2]=k[c+12>>2];o[g+40>>2]=d;d=+oc[k[(k[e>>2]|0)+12>>2]&15](e,g,0);r=g;return +d}function Zz(a){a=a|0;jF(a);return}function _z(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=+d;e=e|0;f=f|0;var g=0;g=r;r=r+64|0;k[g+48>>2]=e;k[g+48+4>>2]=f;e=k[a+212>>2]|0;if(!(+o[e+4>>2]>=d)){r=g;return +d}k[g>>2]=k[a+216>>2];k[g+4>>2]=g+48;k[g+8>>2]=k[b>>2];k[g+8+4>>2]=k[b+4>>2];k[g+8+8>>2]=k[b+8>>2];k[g+8+12>>2]=k[b+12>>2];k[g+24>>2]=k[c>>2];k[g+24+4>>2]=k[c+4>>2];k[g+24+8>>2]=k[c+8>>2];k[g+24+12>>2]=k[c+12>>2];o[g+40>>2]=d;d=+oc[k[(k[e>>2]|0)+12>>2]&15](e,g,1);r=g;return +d}function $z(a){a=a|0;jF(a);return}function aA(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0;d=r;r=r+16|0;k[d>>2]=-1;k[d+4>>2]=k[a+24>>2];if(!(k[b+4>>2]|0))k[b+4>>2]=d;f=k[a+20>>2]|0;e=+oc[k[(k[f>>2]|0)+12>>2]&15](f,b,c);o[a+4>>2]=+o[(k[a+20>>2]|0)+4>>2];r=d;return +e}function bA(a,b){a=a|0;b=b|0;a=k[a+20>>2]|0;return nc[k[(k[a>>2]|0)+8>>2]&31](a,b)|0}function cA(a){a=a|0;jF(a);return}function dA(a,b){a=a|0;b=b|0;return 1}function eA(a,b){a=a|0;b=b|0;return 1}function fA(a,b,c){a=a|0;b=b|0;c=+c;Ub[k[(k[a>>2]|0)+12>>2]&127](a,b);return}function gA(a,b){a=a|0;b=b|0;var c=0,d=0,e=0;c=r;r=r+128|0;d=k[b+36>>2]|0;b=k[(k[a+8>>2]|0)+24>>2]|0;e=k[b+(d*80|0)+64>>2]|0;Sw(c+56|0,k[a+12>>2]|0,b+(d*80|0)|0);b=k[a+4>>2]|0;k[c+32>>2]=0;k[c+32+4>>2]=e;k[c+32+8>>2]=b;k[c+32+12>>2]=c+56;k[c+32+16>>2]=-1;k[c+32+20>>2]=d;b=k[a+24>>2]|0;o[c+4>>2]=1.0;k[c+8>>2]=0;j[c+12>>1]=1;j[c+14>>1]=-1;k[c+16>>2]=0;k[c>>2]=9536;k[c+20>>2]=b;k[c+24>>2]=d;o[c+4>>2]=+o[b+4>>2];k[c+16>>2]=k[b+16>>2];ts(k[a+16>>2]|0,k[a+20>>2]|0,c+32|0,c);r=c;return}function hA(a,b,c){a=a|0;b=b|0;c=c|0;return}function iA(a){a=a|0;jF(a);return}function jA(a){a=a|0;return}function kA(a,b,c,d,e){a=a|0;b=b|0;c=+c;d=d|0;e=e|0;var f=0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0;f=r;r=r+48|0;k[f+32>>2]=d;k[f+32+4>>2]=e;l=+o[b>>2];j=+o[b+4>>2];g=+o[b+8>>2];i=+o[a+56>>2]*l+ +o[a+60>>2]*j+ +o[a+64>>2]*g;h=l*+o[a+72>>2]+j*+o[a+76>>2]+g*+o[a+80>>2];g=l*+o[a+88>>2]+j*+o[a+92>>2]+g*+o[a+96>>2];k[f>>2]=k[a+48>>2];k[f+4>>2]=f+32;o[f+8>>2]=i;o[f+12>>2]=h;o[f+16>>2]=g;o[f+20>>2]=0.0;o[f+24>>2]=c;e=k[a+44>>2]|0;c=+oc[k[(k[e>>2]|0)+12>>2]&15](e,f,1);r=f;return +c}function lA(a){a=a|0;jF(a);return}function mA(a,b,c,d,e){a=a|0;b=b|0;c=+c;d=d|0;e=e|0;var f=0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0;f=r;r=r+48|0;k[f+32>>2]=d;k[f+32+4>>2]=e;l=+o[b>>2];j=+o[b+4>>2];g=+o[b+8>>2];i=+o[a+56>>2]*l+ +o[a+60>>2]*j+ +o[a+64>>2]*g;h=l*+o[a+72>>2]+j*+o[a+76>>2]+g*+o[a+80>>2];g=l*+o[a+88>>2]+j*+o[a+92>>2]+g*+o[a+96>>2];k[f>>2]=k[a+48>>2];k[f+4>>2]=f+32;o[f+8>>2]=i;o[f+12>>2]=h;o[f+16>>2]=g;o[f+20>>2]=0.0;o[f+24>>2]=c;e=k[a+44>>2]|0;c=+oc[k[(k[e>>2]|0)+12>>2]&15](e,f,1);r=f;return +c}function nA(a){a=a|0;jF(a);return}function oA(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0;if(!(k[a+12>>2]|0))return;if(!(i[a+8>>0]|0))return;d=k[b+4>>2]|0;if((d|0)==(k[b+8>>2]|0)?(h=(d|0)==0?1:d<<1,(d|0)<(h|0)):0){if(!h)g=0;else{k[5108]=(k[5108]|0)+1;c=iF((h<<2|3)+16|0)|0;if(!c)d=0;else{k[(c+4+15&-16)+-4>>2]=c;d=c+4+15&-16}g=d;d=k[b+4>>2]|0}if((d|0)>0){c=d+-1|0;f=0;while(1){e=g+(f<<2)|0;if(e)k[e>>2]=k[(k[b+12>>2]|0)+(f<<2)>>2];if((f|0)==(c|0))break;else f=f+1|0}}c=k[b+12>>2]|0;if(c){if(i[b+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);d=k[b+4>>2]|0}k[b+12>>2]=0}i[b+16>>0]=1;k[b+12>>2]=g;k[b+8>>2]=h}c=(k[b+12>>2]|0)+(d<<2)|0;if(c)k[c>>2]=k[a+12>>2];k[b+4>>2]=d+1;return}function pA(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0;if(!(k[a+20>>2]|0))return;if(!(i[a+16>>0]|0))return;d=k[b+4>>2]|0;if((d|0)==(k[b+8>>2]|0)?(h=(d|0)==0?1:d<<1,(d|0)<(h|0)):0){if(!h)g=0;else{k[5108]=(k[5108]|0)+1;c=iF((h<<2|3)+16|0)|0;if(!c)d=0;else{k[(c+4+15&-16)+-4>>2]=c;d=c+4+15&-16}g=d;d=k[b+4>>2]|0}if((d|0)>0){c=d+-1|0;f=0;while(1){e=g+(f<<2)|0;if(e)k[e>>2]=k[(k[b+12>>2]|0)+(f<<2)>>2];if((f|0)==(c|0))break;else f=f+1|0}}c=k[b+12>>2]|0;if(c){if(i[b+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);d=k[b+4>>2]|0}k[b+12>>2]=0}i[b+16>>0]=1;k[b+12>>2]=g;k[b+8>>2]=h}c=(k[b+12>>2]|0)+(d<<2)|0;if(c)k[c>>2]=k[a+20>>2];k[b+4>>2]=d+1;return}function qA(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0;c=k[b>>2]|0;c=nc[k[(k[c>>2]|0)+56>>2]&31](c,36)|0;if(!c){a=0;return a|0}e=k[b+4>>2]|0;g=k[a+12>>2]|0;f=k[a+8>>2]|0;d=k[a+16>>2]|0;a=k[a+20>>2]|0;k[c+4>>2]=k[b>>2];k[c>>2]=10424;k[c+8>>2]=g;k[c+12>>2]=f;i[c+16>>0]=0;k[c+20>>2]=e;i[c+24>>0]=0;k[c+28>>2]=d;k[c+32>>2]=a;a=c;return a|0}function rA(a,b,c,d){a=a|0;b=b|0;c=c|0;d=+d;var e=0,f=0.0,g=0.0,h=0.0;e=r;r=r+16|0;o[a+32>>2]=d;k[a+8>>2]=k[b>>2];k[a+8+4>>2]=k[b+4>>2];k[a+8+8>>2]=k[b+8>>2];k[a+8+12>>2]=k[b+12>>2];f=+o[a+28>>2];h=+o[c+4>>2]-f*+o[b+4>>2];g=+o[c+8>>2]-f*+o[b+8>>2];o[e>>2]=+o[c>>2]-+o[b>>2]*f;o[e+4>>2]=h;o[e+8>>2]=g;o[e+12>>2]=0.0;d=+o[a+24>>2]+f+d;o[a+32>>2]=d;if(!(d<0.0)){a=a+4|0;a=k[a>>2]|0;c=k[a>>2]|0;c=c+16|0;c=k[c>>2]|0;xc[c&15](a,b,e,d);r=e;return}i[a+36>>0]=1;a=a+4|0;a=k[a>>2]|0;c=k[a>>2]|0;c=c+16|0;c=k[c>>2]|0;xc[c&15](a,b,e,d);r=e;return}function sA(a,b,c){a=a|0;b=b|0;c=c|0;return}function tA(a,b,c){a=a|0;b=b|0;c=c|0;return}function uA(a){a=a|0;jF(a);return}function vA(a,b,c,d){a=a|0;b=b|0;c=c|0;d=+d;var e=0.0,f=0.0,g=0.0,h=0.0,j=0.0,l=0.0,m=0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0;m=r;r=r+16|0;h=+o[b>>2];j=+o[b+4>>2];l=+o[b+8>>2];f=+o[c>>2];g=+o[c+4>>2];e=+o[c+8>>2];if(!(i[a+228>>0]|0)){z=+o[a+100>>2];w=+o[a+116>>2];C=+o[a+132>>2];y=+o[a+104>>2];u=+o[a+120>>2];B=+o[a+136>>2];x=+o[a+108>>2];s=+o[a+124>>2];A=+o[a+140>>2];F=-+o[a+148>>2];E=-+o[a+152>>2];D=-+o[a+156>>2];J=+o[a+164>>2];I=+o[a+168>>2];q=+o[a+172>>2];H=+o[a+180>>2];G=+o[a+184>>2];p=+o[a+188>>2];v=+o[a+196>>2];t=+o[a+200>>2];n=+o[a+204>>2];q=e*(C*J+B*I+A*q)+(f*(z*J+y*I+x*q)+g*(w*J+u*I+s*q))+(J*(z*F+w*E+C*D)+(y*F+u*E+B*D)*I+(x*F+s*E+A*D)*q+ +o[a+212>>2]);p=e*(C*H+B*G+A*p)+(f*(z*H+y*G+x*p)+g*(w*H+u*G+s*p))+((z*F+w*E+C*D)*H+(y*F+u*E+B*D)*G+(x*F+s*E+A*D)*p+ +o[a+216>>2]);n=(z*F+w*E+C*D)*v+(y*F+u*E+B*D)*t+(x*F+s*E+A*D)*n+ +o[a+220>>2]+(e*(C*v+B*t+A*n)+(f*(z*v+y*t+x*n)+g*(w*v+u*t+s*n)));o[m>>2]=q;o[m+4>>2]=p;o[m+8>>2]=n;o[m+12>>2]=0.0;d=(h*d+f-q)*+o[b>>2]+(j*d+g-p)*+o[b+4>>2]+(l*d+e-n)*+o[b+8>>2];a=a+32|0;a=k[a>>2]|0;c=k[a>>2]|0;c=c+16|0;c=k[c>>2]|0;xc[c&15](a,b,m,d);r=m;return}else{w=+o[a+36>>2];z=+o[a+52>>2];t=+o[a+68>>2];x=+o[a+40>>2];C=+o[a+56>>2];u=+o[a+72>>2];y=+o[a+44>>2];G=+o[a+60>>2];v=+o[a+76>>2];E=-+o[a+84>>2];s=-+o[a+88>>2];p=-+o[a+92>>2];B=+o[a+164>>2];n=+o[a+168>>2];H=+o[a+172>>2];D=+o[a+180>>2];q=+o[a+184>>2];I=+o[a+188>>2];A=+o[a+196>>2];F=+o[a+200>>2];J=+o[a+204>>2];H=(l*d+e)*(t*B+u*n+v*H)+((h*d+f)*(w*B+x*n+y*H)+(j*d+g)*(z*B+C*n+G*H))+(B*(w*E+z*s+t*p)+(x*E+C*s+u*p)*n+(y*E+G*s+v*p)*H+ +o[a+212>>2]);I=(l*d+e)*(t*D+u*q+v*I)+((h*d+f)*(w*D+x*q+y*I)+(j*d+g)*(z*D+C*q+G*I))+((w*E+z*s+t*p)*D+(x*E+C*s+u*p)*q+(y*E+G*s+v*p)*I+ +o[a+216>>2]);J=(w*E+z*s+t*p)*A+(x*E+C*s+u*p)*F+(y*E+G*s+v*p)*J+ +o[a+220>>2]+((l*d+e)*(t*A+u*F+v*J)+((h*d+f)*(w*A+x*F+y*J)+(j*d+g)*(z*A+C*F+G*J)));o[m>>2]=H+h*(h*(H-f)+j*(I-g)+l*(J-e));o[m+4>>2]=I+j*(h*(H-f)+j*(I-g)+l*(J-e));o[m+8>>2]=J+l*(h*(H-f)+j*(I-g)+l*(J-e));o[m+12>>2]=0.0;J=h*(H-f)+j*(I-g)+l*(J-e);a=a+32|0;a=k[a>>2]|0;c=k[a>>2]|0;c=c+16|0;c=k[c>>2]|0;xc[c&15](a,b,m,J);r=m;return}}function wA(a){a=a|0;jF(a);return}function xA(a,b,c,d){a=a|0;b=b|0;c=c|0;d=+d;return}function yA(a,b,c){a=a|0;b=b|0;c=c|0;return}function zA(a,b,c){a=a|0;b=b|0;c=c|0;return}function AA(a){a=a|0;jF(a);return}function BA(a,b){a=a|0;b=b|0;var c=0,d=0,e=0;c=k[a+12>>2]|0;if((c|0)<=0)return;e=0;do{d=k[(k[a+20>>2]|0)+(e<<2)>>2]|0;if(d){Ub[k[(k[d>>2]|0)+16>>2]&127](d,b);c=k[a+12>>2]|0}e=e+1|0}while((e|0)<(c|0));return}function CA(a,b){a=a|0;b=b|0;b=k[b+36>>2]|0;ex(a,k[(k[(k[(k[a+4>>2]|0)+4>>2]|0)+24>>2]|0)+(b*80|0)+64>>2]|0,b);return}function DA(a){a=a|0;jF(a);return}function EA(a,b){a=a|0;b=b|0;return}function FA(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,i=0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0,K=0;i=r;r=r+240|0;k[a+4>>2]=(k[a+4>>2]|0)+1;g=k[b+36>>2]|0;f=k[c+36>>2]|0;c=k[a+8>>2]|0;K=k[(k[c+4>>2]|0)+24>>2]|0;b=k[K+(g*80|0)+64>>2]|0;J=(k[(k[a+12>>2]|0)+4>>2]|0)+24|0;d=k[(k[J>>2]|0)+(f*80|0)+64>>2]|0;c=k[c+12>>2]|0;j=+o[c>>2];H=+o[c+4>>2];I=+o[c+8>>2];n=+o[c+16>>2];q=+o[c+20>>2];t=+o[c+24>>2];p=+o[c+32>>2];u=+o[c+36>>2];C=+o[c+40>>2];v=+o[K+(g*80|0)>>2];w=+o[K+(g*80|0)+16>>2];x=+o[K+(g*80|0)+32>>2];y=+o[K+(g*80|0)+4>>2];z=+o[K+(g*80|0)+20>>2];A=+o[K+(g*80|0)+36>>2];s=+o[K+(g*80|0)+8>>2];B=+o[K+(g*80|0)+24>>2];D=+o[K+(g*80|0)+40>>2];l=+o[K+(g*80|0)+48>>2];m=+o[K+(g*80|0)+52>>2];G=+o[K+(g*80|0)+56>>2];E=+o[c+48>>2]+(j*l+H*m+I*G);F=+o[c+52>>2]+(n*l+q*m+t*G);G=+o[c+56>>2]+(p*l+u*m+C*G);o[i+16>>2]=j*v+H*w+I*x;o[i+16+4>>2]=j*y+H*z+I*A;o[i+16+8>>2]=j*s+H*B+I*D;o[i+16+12>>2]=0.0;o[i+16+16>>2]=n*v+q*w+t*x;o[i+16+20>>2]=n*y+q*z+t*A;o[i+16+24>>2]=n*s+q*B+t*D;o[i+16+28>>2]=0.0;o[i+16+32>>2]=p*v+u*w+C*x;o[i+16+36>>2]=p*y+u*z+C*A;o[i+16+40>>2]=p*s+u*B+C*D;o[i+16+44>>2]=0.0;o[i+16+48>>2]=E;o[i+16+52>>2]=F;o[i+16+56>>2]=G;o[i+16+60>>2]=0.0;c=k[(k[a+12>>2]|0)+12>>2]|0;G=+o[c>>2];F=+o[c+4>>2];E=+o[c+8>>2];D=+o[c+16>>2];C=+o[c+20>>2];B=+o[c+24>>2];u=+o[c+32>>2];s=+o[c+36>>2];p=+o[c+40>>2];J=k[J>>2]|0;A=+o[J+(f*80|0)>>2];z=+o[J+(f*80|0)+16>>2];y=+o[J+(f*80|0)+32>>2];x=+o[J+(f*80|0)+4>>2];w=+o[J+(f*80|0)+20>>2];v=+o[J+(f*80|0)+36>>2];t=+o[J+(f*80|0)+8>>2];q=+o[J+(f*80|0)+24>>2];n=+o[J+(f*80|0)+40>>2];I=+o[J+(f*80|0)+48>>2];H=+o[J+(f*80|0)+52>>2];j=+o[J+(f*80|0)+56>>2];m=+o[c+48>>2]+(G*I+F*H+E*j);l=+o[c+52>>2]+(D*I+C*H+B*j);j=+o[c+56>>2]+(u*I+s*H+p*j);o[i+120>>2]=G*A+F*z+E*y;o[i+120+4>>2]=G*x+F*w+E*v;o[i+120+8>>2]=G*t+F*q+E*n;o[i+120+12>>2]=0.0;o[i+120+16>>2]=D*A+C*z+B*y;o[i+120+20>>2]=D*x+C*w+B*v;o[i+120+24>>2]=D*t+C*q+B*n;o[i+120+28>>2]=0.0;o[i+120+32>>2]=u*A+s*z+p*y;o[i+120+36>>2]=u*x+s*w+p*v;o[i+120+40>>2]=u*t+s*q+p*n;o[i+120+44>>2]=0.0;o[i+120+48>>2]=m;o[i+120+52>>2]=l;o[i+120+56>>2]=j;o[i+120+60>>2]=0.0;Cc[k[(k[b>>2]|0)+8>>2]&127](b,i+16|0,i+80|0,i+184|0);Cc[k[(k[d>>2]|0)+8>>2]&127](d,i+120|0,i+224|0,i);if(!(+o[i+80>>2]>+o[i>>2])?!(+o[i+184>>2]<+o[i+224>>2]):0)c=1;else c=0;if(!(!(+o[i+80+8>>2]>+o[i+8>>2])?!(+o[i+184+8>>2]<+o[i+224+8>>2]):0))c=0;if(+o[i+80+4>>2]>+o[i+4>>2]){r=i;return}if(+o[i+184+4>>2]<+o[i+224+4>>2]|c^1){r=i;return}J=k[a+8>>2]|0;c=k[J+8>>2]|0;k[i+96>>2]=J;k[i+96+4>>2]=b;k[i+96+8>>2]=c;k[i+96+12>>2]=i+16;k[i+96+16>>2]=-1;k[i+96+20>>2]=g;c=k[a+12>>2]|0;b=k[c+8>>2]|0;k[i+200>>2]=c;k[i+200+4>>2]=d;k[i+200+8>>2]=b;k[i+200+12>>2]=i+120;k[i+200+16>>2]=-1;k[i+200+20>>2]=f;b=k[a+28>>2]|0;k[4976]=(k[4976]|0)+1;c=((f<<16|g)+~((f<<16|g)<<15)>>10^(f<<16|g)+~((f<<16|g)<<15))*9|0;c=(k[b+12>>2]|0)+-1&((c>>6^c)+~((c>>6^c)<<11)>>16^(c>>6^c)+~((c>>6^c)<<11));a:do if((c|0)<(k[b+32>>2]|0)?(e=k[(k[b+40>>2]|0)+(c<<2)>>2]|0,(e|0)!=-1):0){d=k[b+16>>2]|0;c=e;while(1){if((k[d+(c*12|0)>>2]|0)==(g|0)?(k[d+(c*12|0)+4>>2]|0)==(f|0):0)break;c=k[(k[b+60>>2]|0)+(c<<2)>>2]|0;if((c|0)==-1){h=17;break a}}if(d+(c*12|0)|0)b=k[d+(c*12|0)+8>>2]|0;else h=17}else h=17;while(0);if((h|0)==17){b=k[a+16>>2]|0;b=_b[k[(k[b>>2]|0)+8>>2]&31](b,i+96|0,i+200|0,k[a+32>>2]|0)|0;J=k[a+28>>2]|0;J=(dc[k[(k[J>>2]|0)+12>>2]&63](J,g,f)|0)+8|0;k[J>>2]=b}J=k[a+24>>2]|0;e=k[J+8>>2]|0;h=k[J+12>>2]|0;k[J+8>>2]=i+96;k[J+12>>2]=i+200;yc[k[(k[J>>2]|0)+8>>2]&127](J,-1,g);J=k[a+24>>2]|0;yc[k[(k[J>>2]|0)+12>>2]&127](J,-1,f);Qb[k[(k[b>>2]|0)+8>>2]&31](b,i+96|0,i+200|0,k[a+20>>2]|0,k[a+24>>2]|0);J=k[a+24>>2]|0;k[J+8>>2]=e;k[J+12>>2]=h;r=i;return}function GA(a){a=a|0;jF(a);return}function HA(a){a=a|0;return 24}function IA(a){a=a|0;return +(+o[a+72>>2])}function JA(a,b){a=a|0;b=+b;o[a+72>>2]=b;return}function KA(a){a=a|0;return 11536}function LA(a){a=a|0;return a+76|0}function MA(a,b){a=a|0;b=b|0;o[a>>2]=1.0;o[a+4>>2]=0.0;o[a+8>>2]=0.0;o[a+12>>2]=0.0;return}function NA(a){a=a|0;return 11960}function OA(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function PA(a,b){a=a|0;b=b|0;o[a>>2]=0.0;o[a+4>>2]=0.0;o[a+8>>2]=1.0;o[a+12>>2]=0.0;return}function QA(a){a=a|0;return 11968}function RA(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function SA(a,b,c){a=a|0;b=b|0;c=c|0;return}function TA(a){a=a|0;return 0}function UA(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0;d=nc[k[(k[c>>2]|0)+40>>2]&31](c,a)|0;e=nc[k[(k[c>>2]|0)+28>>2]&31](c,d)|0;k[b>>2]=e;if(e)Ub[k[(k[c>>2]|0)+48>>2]&127](c,d);k[b+4>>2]=k[a+4>>2];o[b+28>>2]=+o[a+28>>2];o[b+32>>2]=+o[a+32>>2];o[b+36>>2]=+o[a+36>>2];o[b+40>>2]=+o[a+40>>2];o[b+12>>2]=+o[a+12>>2];o[b+16>>2]=+o[a+16>>2];o[b+20>>2]=+o[a+20>>2];o[b+24>>2]=+o[a+24>>2];o[b+44>>2]=+o[a+44>>2];k[b+52>>2]=k[a+68>>2];return 11976}function VA(a){a=a|0;return 60}function WA(a,b){a=a|0;b=b|0;o[a>>2]=0.0;o[a+4>>2]=1.0;o[a+8>>2]=0.0;o[a+12>>2]=0.0;return}function XA(a){a=a|0;return 11992}function YA(a,b,c){a=a|0;b=+b;c=c|0;var d=0,e=0.0,f=0.0,g=0.0,h=0.0,i=0;d=r;r=r+96|0;o[d+32>>2]=1.0;k[d+32+4>>2]=0;k[d+32+4+4>>2]=0;k[d+32+4+8>>2]=0;k[d+32+4+12>>2]=0;o[d+32+20>>2]=1.0;k[d+32+24>>2]=0;k[d+32+24+4>>2]=0;k[d+32+24+8>>2]=0;k[d+32+24+12>>2]=0;o[d+32+40>>2]=1.0;i=d+32+44|0;k[i>>2]=0;k[i+4>>2]=0;k[i+8>>2]=0;k[i+12>>2]=0;k[i+16>>2]=0;Cc[k[(k[a>>2]|0)+8>>2]&127](a,d+32|0,d+16|0,d);g=(+o[d>>2]-+o[d+16>>2])*.5;f=(+o[d+4>>2]-+o[d+16+4>>2])*.5;h=(+o[d+8>>2]-+o[d+16+8>>2])*.5;e=+gc[k[(k[a>>2]|0)+48>>2]&15](a);o[c>>2]=b*.0833333283662796*((f+e)*2.0*((f+e)*2.0)+(h+e)*2.0*((h+e)*2.0));o[c+4>>2]=b*.0833333283662796*((g+e)*2.0*((g+e)*2.0)+(h+e)*2.0*((h+e)*2.0));o[c+8>>2]=b*.0833333283662796*((g+e)*2.0*((g+e)*2.0)+(f+e)*2.0*((f+e)*2.0));o[c+12>>2]=0.0;r=d;return}function ZA(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;Cc[k[(k[a>>2]|0)+80>>2]&127](a,b,c,d);return}function _A(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function $A(a){a=a|0;return +(+o[a+28>>2]*+o[a+12>>2])}function aB(a,b){a=a|0;b=+b;o[a+44>>2]=b;return}function bB(a){a=a|0;return 12136}function cB(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function dB(a,b,c){a=a|0;b=b|0;c=c|0;yc[k[(k[b>>2]|0)+68>>2]&127](a,b,c);return}function eB(a){a=a|0;return 60}function fB(a){a=a|0;return +(+o[a+12>>2])}function gB(a,b){a=a|0;b=+b;o[a+12>>2]=b;return}function hB(a){a=a|0;return 12312}function iB(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0.0,g=0.0,h=0,i=0,j=0,n=0,q=0,s=0,t=0;t=r;r=r+32|0;j=k[a+4>>2]|0;mc[k[(k[j>>2]|0)+16>>2]&3](j,t+4|0,t+16|0,t+8|0,t+20|0,t+28|0,t,t+12|0,t+24|0,b);j=k[t+28>>2]|0;n=ia(k[t>>2]|0,c)|0;q=k[a+4>>2]|0;i=k[t+24>>2]|0;s=2;while(1){if((i|0)==2)d=k[j+n+(s<<2)>>2]|0;else if((i|0)==3)d=m[j+n+(s<<1)>>1]|0;else d=l[j+(s+n)>>0]|0;h=k[t+4>>2]|0;d=ia(k[t+20>>2]|0,d)|0;if(!(k[t+8>>2]|0)){f=+o[h+(d+8)>>2]*+o[q+12>>2];g=+o[h+(d+4)>>2]*+o[q+8>>2];e=+o[h+d>>2]*+o[q+4>>2]}else{f=+p[h+(d+16)>>3]*+o[q+12>>2];g=+p[h+(d+8)>>3]*+o[q+8>>2];e=+p[h+d>>3]*+o[q+4>>2]}o[a+12+(s<<4)>>2]=e;o[a+12+(s<<4)+4>>2]=g;o[a+12+(s<<4)+8>>2]=f;o[a+12+(s<<4)+12>>2]=0.0;if((s|0)>0)s=s+-1|0;else break}s=k[a+8>>2]|0;Cc[k[(k[s>>2]|0)+8>>2]&127](s,a+12|0,b,c);a=k[a+4>>2]|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);r=t;return}function jB(a){a=a|0;jF(a);return}function kB(a){a=a|0;return}
function vp(a,b){a=a|0;b=+b;var c=0,d=0,e=0,f=0,g=0,h=0,j=0,l=0.0,m=0.0,n=0.0,p=0.0;j=r;r=r+16|0;Cw(1856);c=k[a+232>>2]|0;if((c|0)>0){h=(i[1448]|0)==0;g=0;do{f=k[(k[a+240>>2]|0)+(g<<2)>>2]|0;a:do if(f){d=k[f+216>>2]|0;do if((d|0)==4|(d|0)==2)if((d|0)==4)break a;else e=d;else{p=+o[f+312>>2];n=+o[f+316>>2];m=+o[f+320>>2];l=+o[f+472>>2];if(p*p+n*n+m*m<l*l?(p=+o[f+328>>2],l=+o[f+332>>2],m=+o[f+336>>2],n=+o[f+476>>2],p*p+l*l+m*m<n*n):0){o[f+220>>2]=+o[f+220>>2]+b;e=d;break}o[f+220>>2]=0.0;if((d&-2|0)==4)e=d;else{k[f+216>>2]=0;e=0}}while(0);d=e&-2;do if(h){if((d|0)!=2?!(+o[f+220>>2]>2.0):0)break;if(k[f+204>>2]&3){if((d|0)==4)break a;k[f+216>>2]=2;break a}if((e|0)==1){if((d|0)==4)break a;k[f+216>>2]=3;break a}else{if((e|0)!=2)break a;c=(k[f+260>>2]|0)+2|0;k[f+328>>2]=0;k[f+328+4>>2]=0;k[f+328+8>>2]=0;k[f+328+12>>2]=0;k[f+260>>2]=c;k[f+312>>2]=0;k[f+312+4>>2]=0;k[f+312+8>>2]=0;k[f+312+12>>2]=0;c=k[a+232>>2]|0;break a}}while(0);if((d|0)!=4)k[f+216>>2]=1}while(0);g=g+1|0}while((g|0)<(c|0))}c=k[5104]|0;a=(k[c+16>>2]|0)+-1|0;k[c+16>>2]=a;if(a){r=j;return}do if(k[c+4>>2]|0){Kb(j|0,0)|0;a=k[5090]|0;o[c+8>>2]=+(((k[j+4>>2]|0)-(k[a+4>>2]|0)+(((k[j>>2]|0)-(k[a>>2]|0)|0)*1e6|0)-(k[c+12>>2]|0)|0)>>>0)/1.0e3+ +o[c+8>>2];if(!(k[c+16>>2]|0)){c=k[5104]|0;break}else{r=j;return}}while(0);k[5104]=k[c+20>>2];r=j;return}function wp(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,j=0;e=k[a+212>>2]|0;if((e|0)==(k[a+216>>2]|0)?(j=(e|0)==0?1:e<<1,(e|0)<(j|0)):0){if(!j)h=0;else{k[5108]=(k[5108]|0)+1;d=iF((j<<2|3)+16|0)|0;if(!d)e=0;else{k[(d+4+15&-16)+-4>>2]=d;e=d+4+15&-16}h=e;e=k[a+212>>2]|0}if((e|0)>0){d=e+-1|0;g=0;while(1){f=h+(g<<2)|0;if(f)k[f>>2]=k[(k[a+220>>2]|0)+(g<<2)>>2];if((g|0)==(d|0))break;else g=g+1|0}}d=k[a+220>>2]|0;if(d){if(i[a+224>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0);e=k[a+212>>2]|0}k[a+220>>2]=0}i[a+224>>0]=1;k[a+220>>2]=h;k[a+216>>2]=j}d=(k[a+220>>2]|0)+(e<<2)|0;if(d)k[d>>2]=b;k[a+212>>2]=e+1;if(!c)return;bp(k[b+28>>2]|0,b);bp(k[b+32>>2]|0,b);return}function xp(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0;c=k[a+212>>2]|0;a:do if((c|0)>0){f=k[a+220>>2]|0;d=0;while(1){e=f+(d<<2)|0;if((k[e>>2]|0)==(b|0))break;d=d+1|0;if((d|0)>=(c|0))break a}if((d|0)<(c|0)){k[e>>2]=k[f+(c+-1<<2)>>2];k[(k[a+220>>2]|0)+(c+-1<<2)>>2]=b;k[a+212>>2]=c+-1}}while(0);a=k[b+28>>2]|0;c=k[a+488>>2]|0;b:do if((c|0)>0){f=k[a+496>>2]|0;d=0;while(1){e=f+(d<<2)|0;if((k[e>>2]|0)==(b|0))break;d=d+1|0;if((d|0)>=(c|0))break b}if((d|0)<(c|0)){k[e>>2]=k[f+(c+-1<<2)>>2];k[(k[a+496>>2]|0)+(c+-1<<2)>>2]=b;k[a+488>>2]=c+-1;c=c+-1|0}}while(0);k[a+256>>2]=(c|0)>0&1;a=k[b+32>>2]|0;c=k[a+488>>2]|0;if((c|0)<=0){b=c;b=(b|0)>0;b=b&1;g=a+256|0;k[g>>2]=b;return}f=k[a+496>>2]|0;d=0;while(1){e=f+(d<<2)|0;if((k[e>>2]|0)==(b|0))break;d=d+1|0;if((d|0)>=(c|0)){g=19;break}}if((g|0)==19){b=(c|0)>0;b=b&1;g=a+256|0;k[g>>2]=b;return}if((d|0)>=(c|0)){b=c;b=(b|0)>0;b=b&1;g=a+256|0;k[g>>2]=b;return}k[e>>2]=k[f+(c+-1<<2)>>2];k[(k[a+496>>2]|0)+(c+-1<<2)>>2]=b;k[a+488>>2]=c+-1;b=c+-1|0;b=(b|0)>0;b=b&1;g=a+256|0;k[g>>2]=b;return}function yp(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0;d=k[a+280>>2]|0;if((d|0)==(k[a+284>>2]|0)?(h=(d|0)==0?1:d<<1,(d|0)<(h|0)):0){if(!h)g=0;else{k[5108]=(k[5108]|0)+1;c=iF((h<<2|3)+16|0)|0;if(!c)d=0;else{k[(c+4+15&-16)+-4>>2]=c;d=c+4+15&-16}g=d;d=k[a+280>>2]|0}if((d|0)>0){c=d+-1|0;f=0;while(1){e=g+(f<<2)|0;if(e)k[e>>2]=k[(k[a+288>>2]|0)+(f<<2)>>2];if((f|0)==(c|0))break;else f=f+1|0}}c=k[a+288>>2]|0;if(c){if(i[a+292>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);d=k[a+280>>2]|0}k[a+288>>2]=0}i[a+292>>0]=1;k[a+288>>2]=g;k[a+284>>2]=h}c=(k[a+288>>2]|0)+(d<<2)|0;if(!c){b=d+1|0;k[a+280>>2]=b;return}k[c>>2]=b;b=d+1|0;k[a+280>>2]=b;return}function zp(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0;e=k[a+280>>2]|0;if((e|0)<=0)return;f=k[a+288>>2]|0;c=0;while(1){d=f+(c<<2)|0;if((k[d>>2]|0)==(b|0))break;c=c+1|0;if((c|0)>=(e|0)){g=7;break}}if((g|0)==7)return;if((c|0)>=(e|0))return;k[d>>2]=k[f+(e+-1<<2)>>2];k[(k[a+288>>2]|0)+(e+-1<<2)>>2]=b;k[a+280>>2]=e+-1;return}function Ap(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+64>>2]&127](a,b);return}function Bp(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+68>>2]&127](a,b);return}function Cp(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+64>>2]&127](a,b);return}function Dp(a,b){a=a|0;b=b|0;Ub[k[(k[a>>2]|0)+68>>2]&127](a,b);return}function Ep(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0,j=0,l=0,m=0,n=0,p=0,q=0,s=0,t=0,u=0,v=0,w=0,x=0;x=r;r=r+16|0;Cw(1880);j=k[a+212>>2]|0;g=k[a+180>>2]|0;if((g|0)<(j|0)){if((k[a+184>>2]|0)<(j|0)){if(!j){d=0;c=g}else{k[5108]=(k[5108]|0)+1;d=iF((j<<2|3)+16|0)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}c=k[a+180>>2]|0}if((c|0)>0){e=c+-1|0;f=0;while(1){c=d+(f<<2)|0;if(c)k[c>>2]=k[(k[a+188>>2]|0)+(f<<2)>>2];if((f|0)==(e|0))break;else f=f+1|0}}c=k[a+188>>2]|0;if(c){if(i[a+192>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[a+188>>2]=0}i[a+192>>0]=1;k[a+188>>2]=d;k[a+184>>2]=j;e=a+188|0}else e=a+188|0;c=g;while(1){d=(k[e>>2]|0)+(c<<2)|0;if(d)k[d>>2]=0;if((c|0)==(j+-1|0))break;else c=c+1|0}}k[a+180>>2]=j;c=0;while(1){if((c|0)>=(Wb[k[(k[a>>2]|0)+104>>2]&127](a)|0))break;k[(k[a+188>>2]|0)+(c<<2)>>2]=k[(k[a+220>>2]|0)+(c<<2)>>2];c=c+1|0}c=k[a+180>>2]|0;if((c|0)>1)Tw(a+176|0,0,c+-1|0);if(!(Wb[k[(k[a>>2]|0)+104>>2]&127](a)|0))c=0;else c=k[a+188>>2]|0;j=k[a+196>>2]|0;w=k[a+180>>2]|0;d=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;k[j+4>>2]=b;k[j+12>>2]=c;k[j+16>>2]=w;k[j+20>>2]=d;d=k[j+32>>2]|0;if((d|0)<0){if((k[j+36>>2]|0)<0){c=k[j+40>>2]|0;if(c){if(i[j+44>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[j+40>>2]=0}i[j+44>>0]=1;k[j+40>>2]=0;k[j+36>>2]=0}while(1){c=(k[j+40>>2]|0)+(d<<2)|0;if(c)k[c>>2]=0;if((d|0)==-1)break;else d=d+1|0}}k[j+32>>2]=0;c=k[j+52>>2]|0;if((c|0)<0){if((k[j+56>>2]|0)<0){d=k[j+60>>2]|0;if(d){if(i[j+64>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[j+60>>2]=0}i[j+64>>0]=1;k[j+60>>2]=0;k[j+56>>2]=0}while(1){d=(k[j+60>>2]|0)+(c<<2)|0;if(d)k[d>>2]=0;if((c|0)==-1)break;else c=c+1|0}}k[j+52>>2]=0;d=k[j+72>>2]|0;if((d|0)<0){if((k[j+76>>2]|0)<0){c=k[j+80>>2]|0;if(c){if(i[j+84>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[j+80>>2]=0}i[j+84>>0]=1;k[j+80>>2]=0;k[j+76>>2]=0}while(1){c=(k[j+80>>2]|0)+(d<<2)|0;if(c)k[c>>2]=0;if((d|0)==-1)break;else d=d+1|0}}k[j+72>>2]=0;w=k[a+200>>2]|0;e=k[(k[w>>2]|0)+8>>2]|0;t=k[a+8>>2]|0;v=k[a+24>>2]|0;v=Wb[k[(k[v>>2]|0)+36>>2]&127](v)|0;yc[e&127](w,t,v);v=k[a+204>>2]|0;t=k[a+24>>2]|0;w=k[a+196>>2]|0;Cw(6936);e=k[v+28>>2]|0;if((e|0)<0){if((k[v+32>>2]|0)<0){d=k[v+36>>2]|0;if(d){if(i[v+40>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[v+36>>2]=0}i[v+40>>0]=1;k[v+36>>2]=0;k[v+32>>2]=0}while(1){d=(k[v+36>>2]|0)+(e<<2)|0;if(d)k[d>>2]=0;if((e|0)==-1)break;else e=e+1|0}}k[v+28>>2]=0;g=k[v+8>>2]|0;if((g|0)>0){c=k[v+16>>2]|0;j=0;while(1){h=c+(j<<3)|0;f=k[h>>2]|0;if((f|0)==(j|0))f=j;else{e=f;d=h;do{f=c+(e<<3)|0;k[d>>2]=k[f>>2];f=k[f>>2]|0;d=c+(f<<3)|0;e=k[d>>2]|0}while((f|0)!=(e|0))}k[h>>2]=f;if((j|0)==(g+-1|0))break;else j=j+1|0}if((g|0)>1){cx(v+4|0,0,g+-1|0);g=k[v+8>>2]|0}if((g|0)>0){p=k[v+16>>2]|0;f=p;j=0;while(1){l=k[p+(j<<3)>>2]|0;d=j;while(1){q=d+1|0;if((q|0)>=(g|0)){n=0;break}if((k[p+(q<<3)>>2]|0)==(l|0))d=q;else{n=1;break}}if((j|0)<(q|0)){m=k[a+16>>2]|0;h=1;c=j;while(1){e=k[m+(k[p+(c<<3)+4>>2]<<2)>>2]|0;if((k[e+208>>2]|0)==(l|0)){s=k[e+216>>2]|0;h=(s|0)!=4&(h&(s|0)!=1)}if((c|0)==(d|0))break;else c=c+1|0}if(h){h=p;while(1){h=k[m+(k[h+(j<<3)+4>>2]<<2)>>2]|0;if((k[h+208>>2]|0)==(l|0)?(k[h+216>>2]&-2|0)!=4:0)k[h+216>>2]=2;j=j+1|0;if((j|0)>=(q|0))break;else h=f}}else while(1){h=k[m+(k[p+(j<<3)+4>>2]<<2)>>2]|0;if((k[h+208>>2]|0)==(l|0)?(k[h+216>>2]|0)==2:0){k[h+216>>2]=3;o[h+220>>2]=0.0}j=j+1|0;if((j|0)>=(q|0))break;else f=p}}if(n)j=q;else break}}}p=Wb[k[(k[t>>2]|0)+36>>2]&127](t)|0;if((p|0)>0){q=0;do{n=nc[k[(k[t>>2]|0)+40>>2]&31](t,q)|0;e=k[n+740>>2]|0;d=k[n+744>>2]|0;if((e|0)!=0?(k[e+216>>2]|0)!=2:0)f=102;else f=100;if(((f|0)==100?(f=0,(d|0)!=0):0)?(k[d+216>>2]|0)!=2:0)f=102;if((f|0)==102){f=k[e+204>>2]|0;if(((f&2|0)!=0?((f&4|0)==0?(k[e+216>>2]|0)!=2:0):0)?(k[d+204>>2]&3|0)==0:0){if((k[d+216>>2]&-2|0)!=4)k[d+216>>2]=1;o[d+220>>2]=0.0}s=k[d+204>>2]|0;if((s&2|0)!=0?((s&4|0)==0?(k[d+216>>2]|0)!=2:0)&(f&3|0)==0:0){if((k[e+216>>2]&-2|0)!=4)k[e+216>>2]=1;o[e+220>>2]=0.0}if((i[v+64>>0]|0)!=0?dc[k[(k[t>>2]|0)+28>>2]&63](t,e,d)|0:0){e=k[v+28>>2]|0;if((e|0)==(k[v+32>>2]|0)?(u=(e|0)==0?1:e<<1,(e|0)<(u|0)):0){if(!u)f=0;else{k[5108]=(k[5108]|0)+1;f=iF((u<<2|3)+16|0)|0;if(!f)f=0;else{k[(f+4+15&-16)+-4>>2]=f;f=f+4+15&-16}e=k[v+28>>2]|0}if((e|0)>0){d=e+-1|0;g=0;while(1){c=f+(g<<2)|0;if(c)k[c>>2]=k[(k[v+36>>2]|0)+(g<<2)>>2];if((g|0)==(d|0))break;else g=g+1|0}}d=k[v+36>>2]|0;if(d){if(i[v+40>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0);e=k[v+28>>2]|0}k[v+36>>2]=0}i[v+40>>0]=1;k[v+36>>2]=f;k[v+32>>2]=u}f=(k[v+36>>2]|0)+(e<<2)|0;if(f)k[f>>2]=n;k[v+28>>2]=e+1}}q=q+1|0}while((q|0)<(p|0))}d=k[5104]|0;u=(k[d+16>>2]|0)+-1|0;k[d+16>>2]=u;do if(!u){if(k[d+4>>2]|0){Kb(x|0,0)|0;u=k[5090]|0;o[d+8>>2]=+(((k[x+4>>2]|0)-(k[u+4>>2]|0)+(((k[x>>2]|0)-(k[u>>2]|0)|0)*1e6|0)-(k[d+12>>2]|0)|0)>>>0)/1.0e3+ +o[d+8>>2];if(k[d+16>>2]|0)break;d=k[5104]|0}k[5104]=k[d+20>>2]}while(0);u=k[v+8>>2]|0;Cw(6968);if(i[v+64>>0]|0){s=k[v+28>>2]|0;if((s|0)>1)Zw(v+24|0,0,s+-1|0);if((u|0)>0){m=1;e=0;t=0;while(1){f=k[v+16>>2]|0;l=k[f+(e<<3)>>2]|0;a:do if((e|0)<(u|0)){j=l;n=1;while(1){if((j|0)!=(l|0)){q=e;d=n;break a}p=k[(k[a+16>>2]|0)+(k[f+(e<<3)+4>>2]<<2)>>2]|0;f=k[v+48>>2]|0;do if((f|0)==(k[v+52>>2]|0)){c=(f|0)==0?1:f<<1;if((f|0)>=(c|0))break;if(!c)g=0;else{k[5108]=(k[5108]|0)+1;g=iF((c<<2|3)+16|0)|0;if(!g)g=0;else{k[(g+4+15&-16)+-4>>2]=g;g=g+4+15&-16}f=k[v+48>>2]|0}if((f|0)>0){j=f+-1|0;d=0;while(1){h=g+(d<<2)|0;if(h)k[h>>2]=k[(k[v+56>>2]|0)+(d<<2)>>2];if((d|0)==(j|0))break;else d=d+1|0}}j=k[v+56>>2]|0;if(j){if(i[v+60>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[j+-4>>2]|0);f=k[v+48>>2]|0}k[v+56>>2]=0}i[v+60>>0]=1;k[v+56>>2]=g;k[v+52>>2]=c}while(0);g=(k[v+56>>2]|0)+(f<<2)|0;if(g)k[g>>2]=p;k[v+48>>2]=f+1;g=k[p+216>>2]|0;g=n&((g|0)==2|(g|0)==5);e=e+1|0;if((e|0)>=(u|0)){q=e;d=g;break a}f=k[v+16>>2]|0;j=k[f+(e<<3)>>2]|0;n=g}}else{q=e;d=1}while(0);if((t|0)<(s|0)){e=k[v+36>>2]|0;f=e+(t<<2)|0;h=k[f>>2]|0;g=k[(k[h+740>>2]|0)+208>>2]|0;if((g|0)<=-1)g=k[(k[h+744>>2]|0)+208>>2]|0;if((g|0)==(l|0)){j=t;do{j=j+1|0;if((j|0)>=(s|0))break;h=k[e+(j<<2)>>2]|0;g=k[(k[h+740>>2]|0)+208>>2]|0;if((g|0)<=-1)g=k[(k[h+744>>2]|0)+208>>2]|0}while((l|0)==(g|0));h=j;g=j-t|0}else{h=m;g=0;f=0}}else{h=m;g=0;f=0}if(!d)ec[k[(k[w>>2]|0)+8>>2]&7](w,k[v+56>>2]|0,k[v+48>>2]|0,f,g,l);t=(g|0)==0?t:h;f=k[v+48>>2]|0;if((f|0)<0){if((k[v+52>>2]|0)<0){e=k[v+56>>2]|0;if(e){if(i[v+60>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0)}k[v+56>>2]=0}i[v+60>>0]=1;k[v+56>>2]=0;k[v+52>>2]=0}while(1){e=(k[v+56>>2]|0)+(f<<2)|0;if(e)k[e>>2]=0;if((f|0)==-1)break;else f=f+1|0}}k[v+48>>2]=0;if((q|0)>=(u|0))break;else{m=h;e=q}}}}else{u=Wb[k[(k[t>>2]|0)+44>>2]&127](t)|0;v=Wb[k[(k[t>>2]|0)+36>>2]&127](t)|0;ec[k[(k[w>>2]|0)+8>>2]&7](w,k[a+16>>2]|0,k[a+8>>2]|0,u,v,-1)}c=k[5104]|0;w=(k[c+16>>2]|0)+-1|0;k[c+16>>2]=w;do if(!w){if(k[c+4>>2]|0){Kb(x|0,0)|0;w=k[5090]|0;o[c+8>>2]=+(((k[x+4>>2]|0)-(k[w+4>>2]|0)+(((k[x>>2]|0)-(k[w>>2]|0)|0)*1e6|0)-(k[c+12>>2]|0)|0)>>>0)/1.0e3+ +o[c+8>>2];if(k[c+16>>2]|0)break;c=k[5104]|0}k[5104]=k[c+20>>2]}while(0);Uw(k[a+196>>2]|0);c=k[a+200>>2]|0;yc[k[(k[c>>2]|0)+16>>2]&127](c,b,k[a+72>>2]|0);c=k[5104]|0;a=(k[c+16>>2]|0)+-1|0;k[c+16>>2]=a;if(a){r=x;return}do if(k[c+4>>2]|0){Kb(x|0,0)|0;a=k[5090]|0;o[c+8>>2]=+(((k[x+4>>2]|0)-(k[a+4>>2]|0)+(((k[x>>2]|0)-(k[a>>2]|0)|0)*1e6|0)-(k[c+12>>2]|0)|0)>>>0)/1.0e3+ +o[c+8>>2];if(!(k[c+16>>2]|0)){c=k[5104]|0;break}else{r=x;return}}while(0);k[5104]=k[c+20>>2];r=x;return}function Fp(a){a=a|0;var b=0,c=0,d=0,e=0,f=0,g=0,h=0,j=0,l=0,m=0,n=0;n=r;r=r+16|0;Cw(1904);h=k[a+204>>2]|0;yc[k[(k[h>>2]|0)+8>>2]&127](h,a,k[a+24>>2]|0);h=k[a+308>>2]|0;if((h|0)>0){j=k[a+316>>2]|0;g=0;while(1){c=k[j+(g<<2)>>2]|0;b=k[c+740>>2]|0;c=k[c+744>>2]|0;if(((b|0)!=0?((c|0)!=0?(k[b+204>>2]&3|0)==0:0):0)?(k[c+204>>2]&3|0)==0:0){e=k[b+208>>2]|0;b=k[c+208>>2]|0;f=k[(k[a+204>>2]|0)+16>>2]|0;c=k[f+(e<<3)>>2]|0;if((c|0)!=(e|0)){d=f+(e<<3)|0;do{e=f+(c<<3)|0;k[d>>2]=k[e>>2];e=k[e>>2]|0;d=f+(e<<3)|0;c=k[d>>2]|0}while((e|0)!=(c|0))}c=k[f+(b<<3)>>2]|0;if((c|0)!=(b|0)){d=f+(b<<3)|0;do{b=f+(c<<3)|0;k[d>>2]=k[b>>2];b=k[b>>2]|0;d=f+(b<<3)|0;c=k[d>>2]|0}while((b|0)!=(c|0))}if((e|0)!=(b|0)){k[f+(e<<3)>>2]=b;d=f+(b<<3)+4|0;k[d>>2]=(k[d>>2]|0)+(k[f+(e<<3)+4>>2]|0)}}if((g|0)==(h+-1|0))break;else g=g+1|0}}h=k[a+212>>2]|0;if((h|0)>0){g=k[a+220>>2]|0;j=0;while(1){b=k[g+(j<<2)>>2]|0;if(((i[b+20>>0]|0)!=0?(l=k[b+28>>2]|0,(k[l+204>>2]&3|0)==0):0)?(m=k[b+32>>2]|0,(k[m+204>>2]&3|0)==0):0){c=k[l+208>>2]|0;b=k[m+208>>2]|0;f=k[(k[a+204>>2]|0)+16>>2]|0;e=k[f+(c<<3)>>2]|0;if((e|0)==(c|0))e=c;else{d=f+(c<<3)|0;do{c=f+(e<<3)|0;k[d>>2]=k[c>>2];c=k[c>>2]|0;d=f+(c<<3)|0;e=k[d>>2]|0}while((c|0)!=(e|0));e=c}c=k[f+(b<<3)>>2]|0;if((c|0)!=(b|0)){d=f+(b<<3)|0;do{b=f+(c<<3)|0;k[d>>2]=k[b>>2];b=k[b>>2]|0;d=f+(b<<3)|0;c=k[d>>2]|0}while((b|0)!=(c|0))}if((e|0)!=(b|0)){k[f+(e<<3)>>2]=b;d=f+(b<<3)+4|0;k[d>>2]=(k[d>>2]|0)+(k[f+(e<<3)+4>>2]|0)}}if((j|0)==(h+-1|0))break;else j=j+1|0}}b=k[a+204>>2]|0;Ub[k[(k[b>>2]|0)+12>>2]&127](b,a);b=k[5104]|0;a=(k[b+16>>2]|0)+-1|0;k[b+16>>2]=a;if(a){r=n;return}do if(k[b+4>>2]|0){Kb(n|0,0)|0;a=k[5090]|0;o[b+8>>2]=+(((k[n+4>>2]|0)-(k[a+4>>2]|0)+(((k[n>>2]|0)-(k[a>>2]|0)|0)*1e6|0)-(k[b+12>>2]|0)|0)>>>0)/1.0e3+ +o[b+8>>2];if(!(k[b+16>>2]|0)){b=k[5104]|0;break}else{r=n;return}}while(0);k[5104]=k[b+20>>2];r=n;return}function Gp(a,b){a=a|0;b=+b;var c=0,d=0,e=0.0,f=0.0,g=0.0,h=0,l=0,m=0,n=0,p=0.0,q=0.0,s=0,t=0.0,u=0;s=r;r=r+352|0;Cw(2048);if((k[a+232>>2]|0)>0){l=s+184+48|0;m=0;do{h=k[(k[a+240>>2]|0)+(m<<2)>>2]|0;o[h+244>>2]=1.0;d=k[h+216>>2]|0;do if(!((d|0)==2|(d|0)==5)?(k[h+204>>2]&3|0)==0:0){Qw(h+4|0,+o[h+312>>2],+o[h+316>>2],+o[h+320>>2],h+328|0,b,s+184|0);e=+o[l>>2]-+o[h+52>>2];f=+o[s+184+52>>2]-+o[h+56>>2];g=+o[s+184+56>>2]-+o[h+60>>2];if((i[a+44>>0]|0)!=0?(t=+o[h+252>>2],t*t!=0.0?t*t<e*e+f*f+g*g:0):0){Cw(2072);if((k[(k[h+192>>2]|0)+4>>2]|0)<20){k[484]=(k[484]|0)+1;c=k[a+68>>2]|0;c=Wb[k[(k[c>>2]|0)+36>>2]&127](c)|0;d=k[a+24>>2]|0;o[s+16+4>>2]=1.0;j[s+16+8>>1]=1;j[s+16+10>>1]=-1;k[s+16>>2]=880;k[s+16+12>>2]=k[h+52>>2];k[s+16+12+4>>2]=k[h+52+4>>2];k[s+16+12+8>>2]=k[h+52+8>>2];k[s+16+12+12>>2]=k[h+52+12>>2];k[s+16+28>>2]=k[l>>2];k[s+16+28+4>>2]=k[l+4>>2];k[s+16+28+8>>2]=k[l+8>>2];k[s+16+28+12>>2]=k[l+12>>2];k[s+16+76>>2]=0;k[s+16>>2]=2296;k[s+16+80>>2]=h;k[s+16+88>>2]=c;k[s+16+92>>2]=d;e=+o[h+248>>2];k[s+112+8>>2]=0;o[s+112+12>>2]=1.0;o[s+112+16>>2]=1.0;o[s+112+20>>2]=1.0;o[s+112+24>>2]=0.0;k[s+112>>2]=12008;k[s+112+4>>2]=8;o[s+112+28>>2]=e;o[s+112+44>>2]=e;o[s+16+84>>2]=+o[a+56>>2];d=k[h+188>>2]|0;j[s+16+8>>1]=j[d+4>>1]|0;j[s+16+10>>1]=j[d+6>>1]|0;k[s+248+48>>2]=k[l>>2];k[s+248+48+4>>2]=k[l+4>>2];k[s+248+48+8>>2]=k[l+8>>2];k[s+248+48+12>>2]=k[l+12>>2];k[s+248>>2]=k[h+4>>2];k[s+248+4>>2]=k[h+4+4>>2];k[s+248+8>>2]=k[h+4+8>>2];k[s+248+12>>2]=k[h+4+12>>2];k[s+248+16>>2]=k[h+20>>2];k[s+248+16+4>>2]=k[h+20+4>>2];k[s+248+16+8>>2]=k[h+20+8>>2];k[s+248+16+12>>2]=k[h+20+12>>2];k[s+248+32>>2]=k[h+36>>2];k[s+248+32+4>>2]=k[h+36+4>>2];k[s+248+32+8>>2]=k[h+36+8>>2];k[s+248+32+12>>2]=k[h+36+12>>2];ws(a,s+112|0,h+4|0,s+248|0,s+16|0,0.0);e=+o[s+16+4>>2];if(e<1.0){o[h+244>>2]=e;Qw(h+4|0,+o[h+312>>2],+o[h+316>>2],+o[h+320>>2],h+328|0,e*b,s+184|0);o[h+244>>2]=0.0;$o(h,s+184|0);c=4}else c=0;if(!c)n=11}else n=11;if((n|0)==11){n=0;c=0}d=k[5104]|0;u=(k[d+16>>2]|0)+-1|0;k[d+16>>2]=u;do if(!u){if(k[d+4>>2]|0){Kb(s+16|0,0)|0;u=k[5090]|0;o[d+8>>2]=+(((k[s+16+4>>2]|0)-(k[u+4>>2]|0)+(((k[s+16>>2]|0)-(k[u>>2]|0)|0)*1e6|0)-(k[d+12>>2]|0)|0)>>>0)/1.0e3+ +o[d+8>>2];if(k[d+16>>2]|0)break;d=k[5104]|0}k[5104]=k[d+20>>2]}while(0);if((c|0)==4)break}$o(h,s+184|0)}while(0);m=m+1|0}while((m|0)<(k[a+232>>2]|0))}do if(i[a+275>>0]|0){Cw(2096);c=k[a+308>>2]|0;if((c|0)>0){h=0;do{l=k[(k[a+316>>2]|0)+(h<<2)>>2]|0;m=k[l+740>>2]|0;m=(k[m+236>>2]&2|0)==0?0:m;n=k[l+744>>2]|0;n=(k[n+236>>2]&2|0)==0?0:n;d=k[l+748>>2]|0;if((d|0)>0){if(!m){c=0;do{e=+o[57]*+o[n+228>>2];if(e>0.0?(p=+o[l+4+(c*184|0)+120>>2],p!=0.0):0){t=e*(p*+o[l+4+(c*184|0)+64>>2]);b=e*(p*+o[l+4+(c*184|0)+68>>2]);g=e*(p*+o[l+4+(c*184|0)+72>>2]);o[s+328>>2]=-t;o[s+328+4>>2]=-b;o[s+328+8>>2]=-g;o[s+328+12>>2]=0.0;f=+o[l+4+(c*184|0)+52>>2]-+o[m+56>>2];e=+o[l+4+(c*184|0)+56>>2]-+o[m+60>>2];o[s>>2]=+o[l+4+(c*184|0)+48>>2]-+o[m+52>>2];o[s+4>>2]=f;o[s+8>>2]=e;o[s+12>>2]=0.0;e=+o[l+4+(c*184|0)+36>>2]-+o[n+56>>2];f=+o[l+4+(c*184|0)+40>>2]-+o[n+60>>2];o[s+168>>2]=+o[l+4+(c*184|0)+32>>2]-+o[n+52>>2];o[s+168+4>>2]=e;o[s+168+8>>2]=f;o[s+168+12>>2]=0.0;o[s+312>>2]=t;o[s+312+4>>2]=b;o[s+312+8>>2]=g;o[s+312+12>>2]=0.0;Nw(n,s+312|0,s+168|0);d=k[l+748>>2]|0}c=c+1|0}while((c|0)<(d|0))}else{c=0;do{e=+o[m+228>>2]*+o[n+228>>2];if(e>0.0?(q=+o[l+4+(c*184|0)+120>>2],q!=0.0):0){t=e*(q*+o[l+4+(c*184|0)+64>>2]);b=e*(q*+o[l+4+(c*184|0)+68>>2]);g=e*(q*+o[l+4+(c*184|0)+72>>2]);o[s+328>>2]=-t;o[s+328+4>>2]=-b;o[s+328+8>>2]=-g;o[s+328+12>>2]=0.0;f=+o[l+4+(c*184|0)+52>>2]-+o[m+56>>2];e=+o[l+4+(c*184|0)+56>>2]-+o[m+60>>2];o[s>>2]=+o[l+4+(c*184|0)+48>>2]-+o[m+52>>2];o[s+4>>2]=f;o[s+8>>2]=e;o[s+12>>2]=0.0;e=+o[l+4+(c*184|0)+36>>2]-+o[n+56>>2];f=+o[l+4+(c*184|0)+40>>2]-+o[n+60>>2];o[s+168>>2]=+o[l+4+(c*184|0)+32>>2]-+o[n+52>>2];o[s+168+4>>2]=e;o[s+168+8>>2]=f;o[s+168+12>>2]=0.0;Nw(m,s+328|0,s);o[s+312>>2]=t;o[s+312+4>>2]=b;o[s+312+8>>2]=g;o[s+312+12>>2]=0.0;Nw(n,s+312|0,s+168|0);d=k[l+748>>2]|0}c=c+1|0}while((c|0)<(d|0))}c=k[a+308>>2]|0}h=h+1|0}while((h|0)<(c|0))}c=k[5104]|0;u=(k[c+16>>2]|0)+-1|0;k[c+16>>2]=u;if(!u){if(k[c+4>>2]|0){Kb(s+16|0,0)|0;u=k[5090]|0;o[c+8>>2]=+(((k[s+16+4>>2]|0)-(k[u+4>>2]|0)+(((k[s+16>>2]|0)-(k[u>>2]|0)|0)*1e6|0)-(k[c+12>>2]|0)|0)>>>0)/1.0e3+ +o[c+8>>2];if(k[c+16>>2]|0)break;c=k[5104]|0}k[5104]=k[c+20>>2]}}while(0);c=k[5104]|0;u=(k[c+16>>2]|0)+-1|0;k[c+16>>2]=u;if(u){r=s;return}do if(k[c+4>>2]|0){Kb(s+16|0,0)|0;u=k[5090]|0;o[c+8>>2]=+(((k[s+16+4>>2]|0)-(k[u+4>>2]|0)+(((k[s+16>>2]|0)-(k[u>>2]|0)|0)*1e6|0)-(k[c+12>>2]|0)|0)>>>0)/1.0e3+ +o[c+8>>2];if(!(k[c+16>>2]|0)){c=k[5104]|0;break}else{r=s;return}}while(0);k[5104]=k[c+20>>2];r=s;return}function Hp(a,b){a=a|0;b=+b;var c=0,d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0,q=0,s=0,t=0.0;s=r;r=r+16|0;Cw(2136);c=k[a+232>>2]|0;if((c|0)>0){q=0;do{p=k[(k[a+240>>2]|0)+(q<<2)>>2]|0;if(!(k[p+204>>2]&3)){l=+o[p+444>>2];d=+Z(+(1.0-l),+b);f=d*+o[p+312>>2];o[p+312>>2]=f;e=d*+o[p+316>>2];o[p+316>>2]=e;d=d*+o[p+320>>2];o[p+320>>2]=d;n=+o[p+448>>2];j=+Z(+(1.0-n),+b);g=j*+o[p+328>>2];o[p+328>>2]=g;h=j*+o[p+332>>2];o[p+332>>2]=h;j=j*+o[p+336>>2];o[p+336>>2]=j;do if(i[p+452>>0]|0){if(j*j+(g*g+h*h)<+o[p+464>>2]?f*f+e*e+d*d<+o[p+460>>2]:0){t=+o[p+456>>2];o[p+328>>2]=g*t;o[p+332>>2]=t*h;o[p+336>>2]=t*j;o[p+312>>2]=t*f;o[p+316>>2]=t*e;o[p+320>>2]=t*d;f=t*f;e=t*e;d=t*d;m=g*t;h=t*h;j=t*j}else m=g;g=+Y(+(f*f+e*e+d*d));do if(g<l)if(g>.004999999888241291){f=f-f*(1.0/g)*.004999999888241291;o[p+312>>2]=f;e=e-e*(1.0/g)*.004999999888241291;o[p+316>>2]=e;d=d-d*(1.0/g)*.004999999888241291;o[p+320>>2]=d;break}else{k[p+312>>2]=0;k[p+312+4>>2]=0;k[p+312+8>>2]=0;k[p+312+12>>2]=0;f=0.0;e=0.0;d=0.0;break}while(0);g=+Y(+(m*m+h*h+j*j));if(g<n)if(g>.004999999888241291){o[p+328>>2]=m-m*(1.0/g)*.004999999888241291;o[p+332>>2]=h-h*(1.0/g)*.004999999888241291;o[p+336>>2]=j-j*(1.0/g)*.004999999888241291;break}else{k[p+328>>2]=0;k[p+328+4>>2]=0;k[p+328+8>>2]=0;k[p+328+12>>2]=0;break}}while(0);Qw(p+4|0,f,e,d,p+328|0,b,p+68|0);c=k[a+232>>2]|0}q=q+1|0}while((q|0)<(c|0))}c=k[5104]|0;a=(k[c+16>>2]|0)+-1|0;k[c+16>>2]=a;if(a){r=s;return}do if(k[c+4>>2]|0){Kb(s|0,0)|0;a=k[5090]|0;o[c+8>>2]=+(((k[s+4>>2]|0)-(k[a+4>>2]|0)+(((k[s>>2]|0)-(k[a>>2]|0)|0)*1e6|0)-(k[c+12>>2]|0)|0)>>>0)/1.0e3+ +o[c+8>>2];if(!(k[c+16>>2]|0)){c=k[5104]|0;break}else{r=s;return}}while(0);k[5104]=k[c+20>>2];r=s;return}function Ip(a,b){a=a|0;b=b|0;var c=0;if((i[a+273>>0]|0)!=0?(c=k[a+200>>2]|0,(c|0)!=0):0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}i[a+273>>0]=0;k[a+200>>2]=b;k[(k[a+196>>2]|0)+8>>2]=b;return}function Jp(a){a=a|0;return k[a+200>>2]|0}function Kp(a){a=a|0;return k[a+212>>2]|0}function Lp(a,b){a=a|0;b=b|0;return k[(k[a+220>>2]|0)+(b<<2)>>2]|0}function Mp(a,b){a=a|0;b=b|0;return k[(k[a+220>>2]|0)+(b<<2)>>2]|0}function Np(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0;Sb[k[(k[b>>2]|0)+32>>2]&255](b);d=dc[k[(k[b>>2]|0)+16>>2]&63](b,104,1)|0;c=k[d+8>>2]|0;e=c;f=e+104|0;do{k[e>>2]=0;e=e+4|0}while((e|0)<(f|0));o[c+88>>2]=+o[a+248>>2];o[c+92>>2]=+o[a+252>>2];o[c+96>>2]=+o[a+256>>2];o[c+100>>2]=+o[a+260>>2];o[c>>2]=+o[a+92>>2];o[c+4>>2]=+o[a+96>>2];o[c+8>>2]=+o[a+100>>2];o[c+12>>2]=+o[a+104>>2];o[c+16>>2]=+o[a+108>>2];o[c+20>>2]=+o[a+116>>2];o[c+24>>2]=+o[a+120>>2];o[c+28>>2]=+o[a+124>>2];o[c+32>>2]=+o[a+128>>2];o[c+36>>2]=+o[a+132>>2];o[c+40>>2]=+o[a+140>>2];o[c+44>>2]=+o[a+144>>2];o[c+48>>2]=+o[a+148>>2];o[c+52>>2]=+o[a+152>>2];o[c+56>>2]=+o[a+168>>2];o[c+60>>2]=+o[a+172>>2];k[c+64>>2]=k[a+112>>2];k[c+68>>2]=k[a+156>>2];k[c+72>>2]=k[a+160>>2];k[c+76>>2]=k[a+164>>2];k[c+80>>2]=k[a+136>>2];Qb[k[(k[b>>2]|0)+20>>2]&31](b,d,2168,1145853764,c);c=k[a+8>>2]|0;if((c|0)>0){e=0;do{d=k[(k[a+16>>2]|0)+(e<<2)>>2]|0;if(k[d+236>>2]&2){f=Wb[k[(k[d>>2]|0)+16>>2]&127](d)|0;f=dc[k[(k[b>>2]|0)+16>>2]&63](b,f,1)|0;c=dc[k[(k[d>>2]|0)+20>>2]&63](d,k[f+8>>2]|0,b)|0;Qb[k[(k[b>>2]|0)+20>>2]&31](b,f,c,1497645650,d);c=k[a+8>>2]|0}e=e+1|0}while((e|0)<(c|0))}if((k[a+212>>2]|0)<=0){As(a,b);a=k[b>>2]|0;a=a+36|0;a=k[a>>2]|0;Sb[a&255](b);return}c=0;do{f=k[(k[a+220>>2]|0)+(c<<2)>>2]|0;d=Wb[k[(k[f>>2]|0)+36>>2]&127](f)|0;d=dc[k[(k[b>>2]|0)+16>>2]&63](b,d,1)|0;e=dc[k[(k[f>>2]|0)+40>>2]&63](f,k[d+8>>2]|0,b)|0;Qb[k[(k[b>>2]|0)+20>>2]&31](b,d,e,1397641027,f);c=c+1|0}while((c|0)<(k[a+212>>2]|0));As(a,b);a=k[b>>2]|0;a=a+36|0;a=k[a>>2]|0;Sb[a&255](b);return}function Op(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;k[a+4>>2]=6;k[a+8>>2]=-1;k[a+12>>2]=-1;o[a+16>>2]=3402823466385288598117041.0e14;i[a+20>>0]=1;i[a+21>>0]=0;k[a+24>>2]=-1;k[a+28>>2]=b;k[a+32>>2]=c;o[a+36>>2]=0.0;o[a+40>>2]=.30000001192092896;k[a+44>>2]=0;k[a>>2]=2504;k[a+48>>2]=k[d>>2];k[a+48+4>>2]=k[d+4>>2];k[a+48+8>>2]=k[d+8>>2];k[a+48+12>>2]=k[d+12>>2];k[a+64>>2]=k[d+16>>2];k[a+64+4>>2]=k[d+16+4>>2];k[a+64+8>>2]=k[d+16+8>>2];k[a+64+12>>2]=k[d+16+12>>2];k[a+80>>2]=k[d+32>>2];k[a+80+4>>2]=k[d+32+4>>2];k[a+80+8>>2]=k[d+32+8>>2];k[a+80+12>>2]=k[d+32+12>>2];k[a+96>>2]=k[d+48>>2];k[a+96+4>>2]=k[d+48+4>>2];k[a+96+8>>2]=k[d+48+8>>2];k[a+96+12>>2]=k[d+48+12>>2];k[a+112>>2]=k[e>>2];k[a+112+4>>2]=k[e+4>>2];k[a+112+8>>2]=k[e+8>>2];k[a+112+12>>2]=k[e+12>>2];k[a+128>>2]=k[e+16>>2];k[a+128+4>>2]=k[e+16+4>>2];k[a+128+8>>2]=k[e+16+8>>2];k[a+128+12>>2]=k[e+16+12>>2];k[a+144>>2]=k[e+32>>2];k[a+144+4>>2]=k[e+32+4>>2];k[a+144+8>>2]=k[e+32+8>>2];k[a+144+12>>2]=k[e+32+12>>2];k[a+160>>2]=k[e+48>>2];k[a+160+4>>2]=k[e+48+4>>2];k[a+160+8>>2]=k[e+48+8>>2];k[a+160+12>>2]=k[e+48+12>>2];e=a+680|0;d=e+48|0;do{k[e>>2]=0;e=e+4|0}while((e|0)<(d|0));k[a+740>>2]=0;k[a+740+4>>2]=0;k[a+740+8>>2]=0;k[a+740+12>>2]=0;o[a+756>>2]=.20000000298023224;o[a+760>>2]=.20000000298023224;o[a+764>>2]=.20000000298023224;k[a+768>>2]=0;k[a+768+4>>2]=0;k[a+768+8>>2]=0;k[a+768+12>>2]=0;k[a+768+16>>2]=0;o[a+728>>2]=.699999988079071;o[a+732>>2]=1.0;o[a+736>>2]=.5;i[a+788>>0]=0;o[a+792>>2]=0.0;o[a+808>>2]=0.0;i[a+789>>0]=0;o[a+796>>2]=0.0;o[a+812>>2]=0.0;i[a+790>>0]=0;o[a+800>>2]=0.0;o[a+816>>2]=0.0;o[a+928>>2]=0.0;o[a+876>>2]=0.0;o[a+880>>2]=.10000000149011612;o[a+884>>2]=300.0;o[a+868>>2]=1.0;o[a+872>>2]=-1.0;o[a+896>>2]=0.0;o[a+900>>2]=.20000000298023224;o[a+904>>2]=0.0;o[a+908>>2]=0.0;o[a+888>>2]=1.0;o[a+892>>2]=.5;k[a+924>>2]=0;o[a+916>>2]=0.0;i[a+912>>0]=0;o[a+992>>2]=0.0;o[a+940>>2]=0.0;o[a+944>>2]=.10000000149011612;o[a+948>>2]=300.0;o[a+932>>2]=1.0;o[a+936>>2]=-1.0;o[a+960>>2]=0.0;o[a+964>>2]=.20000000298023224;o[a+968>>2]=0.0;o[a+972>>2]=0.0;o[a+952>>2]=1.0;o[a+956>>2]=.5;k[a+988>>2]=0;o[a+980>>2]=0.0;i[a+976>>0]=0;o[a+1056>>2]=0.0;o[a+1004>>2]=0.0;o[a+1008>>2]=.10000000149011612;o[a+1012>>2]=300.0;o[a+996>>2]=1.0;o[a+1e3>>2]=-1.0;o[a+1024>>2]=0.0;o[a+1028>>2]=.20000000298023224;o[a+1032>>2]=0.0;o[a+1036>>2]=0.0;o[a+1016>>2]=1.0;o[a+1020>>2]=.5;k[a+1052>>2]=0;o[a+1044>>2]=0.0;i[a+1040>>0]=0;i[a+1300>>0]=f&1;i[a+1301>>0]=1;k[a+1304>>2]=0;i[a+1308>>0]=0;Qp(a,(k[a+28>>2]|0)+4|0,(k[a+32>>2]|0)+4|0);return}function Pp(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0;f=r;r=r+64|0;eq();k[a+4>>2]=6;k[a+8>>2]=-1;k[a+12>>2]=-1;o[a+16>>2]=3402823466385288598117041.0e14;i[a+20>>0]=1;i[a+21>>0]=0;k[a+24>>2]=-1;k[a+28>>2]=2960;k[a+32>>2]=b;o[a+36>>2]=0.0;o[a+40>>2]=.30000001192092896;k[a+44>>2]=0;k[a>>2]=2504;k[a+112>>2]=k[c>>2];k[a+112+4>>2]=k[c+4>>2];k[a+112+8>>2]=k[c+8>>2];k[a+112+12>>2]=k[c+12>>2];k[a+128>>2]=k[c+16>>2];k[a+128+4>>2]=k[c+16+4>>2];k[a+128+8>>2]=k[c+16+8>>2];k[a+128+12>>2]=k[c+16+12>>2];k[a+144>>2]=k[c+32>>2];k[a+144+4>>2]=k[c+32+4>>2];k[a+144+8>>2]=k[c+32+8>>2];k[a+144+12>>2]=k[c+32+12>>2];k[a+160>>2]=k[c+48>>2];k[a+160+4>>2]=k[c+48+4>>2];k[a+160+8>>2]=k[c+48+8>>2];k[a+160+12>>2]=k[c+48+12>>2];c=a+680|0;e=c+48|0;do{k[c>>2]=0;c=c+4|0}while((c|0)<(e|0));k[a+740>>2]=0;k[a+740+4>>2]=0;k[a+740+8>>2]=0;k[a+740+12>>2]=0;o[a+756>>2]=.20000000298023224;o[a+760>>2]=.20000000298023224;o[a+764>>2]=.20000000298023224;k[a+768>>2]=0;k[a+768+4>>2]=0;k[a+768+8>>2]=0;k[a+768+12>>2]=0;k[a+768+16>>2]=0;o[a+728>>2]=.699999988079071;o[a+732>>2]=1.0;o[a+736>>2]=.5;i[a+788>>0]=0;o[a+792>>2]=0.0;o[a+808>>2]=0.0;i[a+789>>0]=0;o[a+796>>2]=0.0;o[a+812>>2]=0.0;i[a+790>>0]=0;o[a+800>>2]=0.0;o[a+816>>2]=0.0;o[a+928>>2]=0.0;o[a+876>>2]=0.0;o[a+880>>2]=.10000000149011612;o[a+884>>2]=300.0;o[a+868>>2]=1.0;o[a+872>>2]=-1.0;o[a+896>>2]=0.0;o[a+900>>2]=.20000000298023224;o[a+904>>2]=0.0;o[a+908>>2]=0.0;o[a+888>>2]=1.0;o[a+892>>2]=.5;k[a+924>>2]=0;o[a+916>>2]=0.0;i[a+912>>0]=0;o[a+992>>2]=0.0;o[a+940>>2]=0.0;o[a+944>>2]=.10000000149011612;o[a+948>>2]=300.0;o[a+932>>2]=1.0;o[a+936>>2]=-1.0;o[a+960>>2]=0.0;o[a+964>>2]=.20000000298023224;o[a+968>>2]=0.0;o[a+972>>2]=0.0;o[a+952>>2]=1.0;o[a+956>>2]=.5;k[a+988>>2]=0;o[a+980>>2]=0.0;i[a+976>>0]=0;o[a+1056>>2]=0.0;o[a+1004>>2]=0.0;o[a+1008>>2]=.10000000149011612;o[a+1012>>2]=300.0;o[a+996>>2]=1.0;o[a+1e3>>2]=-1.0;o[a+1024>>2]=0.0;o[a+1028>>2]=.20000000298023224;o[a+1032>>2]=0.0;o[a+1036>>2]=0.0;o[a+1016>>2]=1.0;o[a+1020>>2]=.5;k[a+1052>>2]=0;o[a+1044>>2]=0.0;i[a+1040>>0]=0;i[a+1300>>0]=d&1;i[a+1301>>0]=1;k[a+1304>>2]=0;i[a+1308>>0]=0;Sw(f,b+4|0,a+112|0);k[a+48>>2]=k[f>>2];k[a+48+4>>2]=k[f+4>>2];k[a+48+8>>2]=k[f+8>>2];k[a+48+12>>2]=k[f+12>>2];k[a+64>>2]=k[f+16>>2];k[a+64+4>>2]=k[f+16+4>>2];k[a+64+8>>2]=k[f+16+8>>2];k[a+64+12>>2]=k[f+16+12>>2];k[a+80>>2]=k[f+32>>2];k[a+80+4>>2]=k[f+32+4>>2];k[a+80+8>>2]=k[f+32+8>>2];k[a+80+12>>2]=k[f+32+12>>2];k[a+96>>2]=k[f+48>>2];k[a+96+4>>2]=k[f+48+4>>2];k[a+96+8>>2]=k[f+48+8>>2];k[a+96+12>>2]=k[f+48+12>>2];Qp(a,(k[a+28>>2]|0)+4|0,(k[a+32>>2]|0)+4|0);r=f;return}function Qp(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0;C=r;r=r+128|0;Sw(C+64|0,b,a+48|0);k[a+1064>>2]=k[C+64>>2];k[a+1064+4>>2]=k[C+64+4>>2];k[a+1064+8>>2]=k[C+64+8>>2];k[a+1064+12>>2]=k[C+64+12>>2];k[a+1080>>2]=k[C+64+16>>2];k[a+1080+4>>2]=k[C+64+16+4>>2];k[a+1080+8>>2]=k[C+64+16+8>>2];k[a+1080+12>>2]=k[C+64+16+12>>2];k[a+1096>>2]=k[C+64+32>>2];k[a+1096+4>>2]=k[C+64+32+4>>2];k[a+1096+8>>2]=k[C+64+32+8>>2];k[a+1096+12>>2]=k[C+64+32+12>>2];k[a+1112>>2]=k[C+64+48>>2];k[a+1112+4>>2]=k[C+64+48+4>>2];k[a+1112+8>>2]=k[C+64+48+8>>2];k[a+1112+12>>2]=k[C+64+48+12>>2];Sw(C,c,a+112|0);k[a+1128>>2]=k[C>>2];k[a+1128+4>>2]=k[C+4>>2];k[a+1128+8>>2]=k[C+8>>2];k[a+1128+12>>2]=k[C+12>>2];k[a+1144>>2]=k[C+16>>2];k[a+1144+4>>2]=k[C+16+4>>2];k[a+1144+8>>2]=k[C+16+8>>2];k[a+1144+12>>2]=k[C+16+12>>2];k[a+1160>>2]=k[C+32>>2];k[a+1160+4>>2]=k[C+32+4>>2];k[a+1160+8>>2]=k[C+32+8>>2];k[a+1160+12>>2]=k[C+32+12>>2];k[a+1176>>2]=k[C+48>>2];k[a+1176+4>>2]=k[C+48+4>>2];k[a+1176+8>>2]=k[C+48+8>>2];k[a+1176+12>>2]=k[C+48+12>>2];f=+o[a+1176>>2]-+o[a+1112>>2];d=+o[a+1180>>2]-+o[a+1116>>2];h=+o[a+1184>>2]-+o[a+1120>>2];q=+o[a+1084>>2];s=+o[a+1104>>2];t=+o[a+1088>>2];u=+o[a+1100>>2];v=+o[a+1096>>2];w=+o[a+1080>>2];x=+o[a+1064>>2];y=+o[a+1068>>2];z=+o[a+1072>>2];A=1.0/((q*s-t*u)*x+y*(t*v-s*w)+(u*w-q*v)*z);B=(u*w-q*v)*A;e=(q*s-t*u)*A*f+A*(u*z-s*y)*d+A*(t*y-q*z)*h;g=f*((t*v-s*w)*A)+d*(A*(s*x-v*z))+A*(w*z-t*x)*h;h=f*B+A*(v*y-u*x)*d+A*(q*x-w*y)*h;o[a+1256>>2]=e;o[a+1260>>2]=g;o[a+1264>>2]=h;o[a+1268>>2]=0.0;o[a+840>>2]=e;d=+o[a+680>>2];f=+o[a+696>>2];do if(!(d>f)){if(d>e){k[a+856>>2]=2;o[a+824>>2]=e-d;break}if(f<e){k[a+856>>2]=1;o[a+824>>2]=e-f;break}else{k[a+856>>2]=0;o[a+824>>2]=0.0;break}}else{k[a+856>>2]=0;o[a+824>>2]=0.0}while(0);o[a+844>>2]=g;e=+o[a+684>>2];d=+o[a+700>>2];do if(!(e>d)){if(e>g){k[a+860>>2]=2;o[a+828>>2]=g-e;break}if(d<g){k[a+860>>2]=1;o[a+828>>2]=g-d;break}else{k[a+860>>2]=0;o[a+828>>2]=0.0;break}}else{k[a+860>>2]=0;o[a+828>>2]=0.0}while(0);o[a+848>>2]=h;e=+o[a+688>>2];d=+o[a+704>>2];do if(!(e>d)){if(e>h){k[a+864>>2]=2;o[a+832>>2]=h-e;break}if(d<h){k[a+864>>2]=1;o[a+832>>2]=h-d;break}else{k[a+864>>2]=0;o[a+832>>2]=0.0;break}}else{k[a+864>>2]=0;o[a+832>>2]=0.0}while(0);h=+o[a+1128>>2];f=+o[a+1144>>2];e=+o[a+1160>>2];g=+o[a+1132>>2];d=+o[a+1148>>2];j=+o[a+1164>>2];l=(q*s-t*u)*A*g+A*(u*z-s*y)*d+A*(t*y-q*z)*j;m=(t*v-s*w)*A*g+A*(s*x-v*z)*d+A*(w*z-t*x)*j;n=h*B+A*(v*y-u*x)*f+A*(q*x-w*y)*e;p=B*+o[a+1136>>2]+A*(v*y-u*x)*+o[a+1152>>2]+A*(q*x-w*y)*+o[a+1168>>2];do if(n<1.0)if(n>-1.0){B=+ea(+-(B*g+A*(v*y-u*x)*d+A*(q*x-w*y)*j),+p);o[a+1192>>2]=B;B=n<-1.0?-1.0:n;B=+ca(+(B>1.0?1.0:B));o[a+1196>>2]=B;B=+ea(+-(h*((t*v-s*w)*A)+f*(A*(s*x-v*z))+A*(w*z-t*x)*e),+(h*((q*s-t*u)*A)+f*(A*(u*z-s*y))+A*(t*y-q*z)*e));o[a+1200>>2]=B;break}else{B=-+ea(+l,+m);o[a+1192>>2]=B;o[a+1196>>2]=-1.5707963705062866;o[a+1200>>2]=0.0;break}else{B=+ea(+l,+m);o[a+1192>>2]=B;o[a+1196>>2]=1.5707963705062866;o[a+1200>>2]=0.0}while(0);o[a+1236>>2]=0.0;u=s*(h*s-e*z)-t*(f*z-h*t);v=z*(f*z-h*t)-s*(e*t-f*s);w=t*(e*t-f*s)-z*(h*s-e*z);o[a+1220>>2]=0.0;x=f*(f*z-h*t)-e*(h*s-e*z);y=e*(e*t-f*s)-h*(f*z-h*t);A=h*(h*s-e*z)-f*(e*t-f*s);o[a+1252>>2]=0.0;B=1.0/+Y(+(u*u+v*v+w*w));o[a+1208>>2]=u*B;o[a+1212>>2]=v*B;o[a+1216>>2]=w*B;B=1.0/+Y(+((e*t-f*s)*(e*t-f*s)+(h*s-e*z)*(h*s-e*z)+(f*z-h*t)*(f*z-h*t)));o[a+1224>>2]=(e*t-f*s)*B;o[a+1228>>2]=(h*s-e*z)*B;o[a+1232>>2]=(f*z-h*t)*B;B=1.0/+Y(+(x*x+y*y+A*A));o[a+1240>>2]=x*B;o[a+1244>>2]=y*B;o[a+1248>>2]=A*B;if(!(i[a+1301>>0]|0)){r=C;return}d=+o[(k[a+28>>2]|0)+344>>2];e=+o[(k[a+32>>2]|0)+344>>2];if(d<1.1920928955078125e-07)c=1;else c=e<1.1920928955078125e-07&1;i[a+1280>>0]=c;if(d+e>0.0)d=e/(d+e);else d=.5;o[a+1272>>2]=d;o[a+1276>>2]=1.0-d;r=C;return}function Rp(a){a=a|0;var b=0,c=0.0,d=0.0,e=0.0,f=0,g=0,h=0,j=0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0;j=r;r=r+144|0;if(!(i[a+1308>>0]|0)){r=j;return}o[a+928>>2]=0.0;o[a+992>>2]=0.0;o[a+1056>>2]=0.0;k[a+712>>2]=0;k[a+712+4>>2]=0;k[a+712+8>>2]=0;k[a+712+12>>2]=0;Qp(a,(k[a+28>>2]|0)+4|0,(k[a+32>>2]|0)+4|0);Sb[k[(k[a>>2]|0)+44>>2]&255](a);e=+o[a+1284>>2];d=+o[a+1288>>2];c=+o[a+1292>>2];b=0;do{if(+o[a+696+(b<<2)>>2]>=+o[a+680+(b<<2)>>2]){if(!(i[a+1300>>0]|0)){f=a+1160+(b<<2)|0;g=a+1144+(b<<2)|0;h=a+1128+(b<<2)|0}else{f=a+1096+(b<<2)|0;g=a+1080+(b<<2)|0;h=a+1064+(b<<2)|0}l=+o[f>>2];m=+o[g>>2];o[j>>2]=+o[h>>2];o[j+4>>2]=m;o[j+8>>2]=l;o[j+12>>2]=0.0;f=k[a+28>>2]|0;o[j+96>>2]=+o[f+4>>2];o[j+96+4>>2]=+o[f+20>>2];o[j+96+8>>2]=+o[f+36>>2];o[j+96+12>>2]=0.0;o[j+96+16>>2]=+o[f+8>>2];o[j+96+20>>2]=+o[f+24>>2];o[j+96+24>>2]=+o[f+40>>2];o[j+96+28>>2]=0.0;o[j+96+32>>2]=+o[f+12>>2];o[j+96+36>>2]=+o[f+28>>2];o[j+96+40>>2]=+o[f+44>>2];o[j+96+44>>2]=0.0;h=k[a+32>>2]|0;o[j+48>>2]=+o[h+4>>2];o[j+48+4>>2]=+o[h+20>>2];o[j+48+8>>2]=+o[h+36>>2];o[j+48+12>>2]=0.0;o[j+48+16>>2]=+o[h+8>>2];o[j+48+20>>2]=+o[h+24>>2];o[j+48+24>>2]=+o[h+40>>2];o[j+48+28>>2]=0.0;o[j+48+32>>2]=+o[h+12>>2];o[j+48+36>>2]=+o[h+28>>2];o[j+48+40>>2]=+o[h+44>>2];o[j+48+44>>2]=0.0;l=d-+o[f+56>>2];m=c-+o[f+60>>2];o[j+32>>2]=e-+o[f+52>>2];o[j+32+4>>2]=l;o[j+32+8>>2]=m;o[j+32+12>>2]=0.0;m=d-+o[h+56>>2];l=c-+o[h+60>>2];o[j+16>>2]=e-+o[h+52>>2];o[j+16+4>>2]=m;o[j+16+8>>2]=l;o[j+16+12>>2]=0.0;Vw(a+176+(b*84|0)|0,j+96|0,j+48|0,j+32|0,j+16|0,j,f+396|0,+o[f+344>>2],h+396|0,+o[h+344>>2])}b=b+1|0}while((b|0)!=3);h=0;do{c=+o[a+868+(h<<6)>>2];d=+o[a+868+(h<<6)+4>>2];e=+Ww(+o[a+1192+(h<<2)>>2],c,d);o[a+868+(h<<6)+52>>2]=e;do if(!(c>d)){if(c>e){k[a+868+(h<<6)+56>>2]=1;b=a+868+(h<<6)+48|0;o[b>>2]=e-c;if(e-c>3.1415927410125732){o[b>>2]=e-c+-6.2831854820251465;b=24;break}if(!(e-c<-3.1415927410125732)){b=24;break}o[b>>2]=e-c+6.2831854820251465;b=24;break}b=a+868+(h<<6)+56|0;if(!(d<e)){k[b>>2]=0;b=23;break}k[b>>2]=2;b=a+868+(h<<6)+48|0;o[b>>2]=e-d;if(e-d>3.1415927410125732){o[b>>2]=e-d+-6.2831854820251465;b=24;break}if(e-d<-3.1415927410125732){o[b>>2]=e-d+6.2831854820251465;b=24}else b=24}else{k[a+868+(h<<6)+56>>2]=0;b=23}while(0);if((b|0)==23?(b=0,(i[a+868+(h<<6)+44>>0]|0)!=0):0)b=24;if((b|0)==24){b=a+1208+(h<<4)|0;k[j>>2]=k[b>>2];k[j+4>>2]=k[b+4>>2];k[j+8>>2]=k[b+8>>2];k[j+12>>2]=k[b+12>>2];b=a+428+(h*84|0)|0;g=k[a+28>>2]|0;K=+o[g+4>>2];J=+o[g+20>>2];I=+o[g+36>>2];G=+o[g+8>>2];F=+o[g+24>>2];E=+o[g+40>>2];C=+o[g+12>>2];B=+o[g+28>>2];A=+o[g+44>>2];f=k[a+32>>2]|0;y=+o[f+4>>2];x=+o[f+20>>2];w=+o[f+36>>2];u=+o[f+8>>2];t=+o[f+24>>2];s=+o[f+40>>2];p=+o[f+12>>2];c=+o[f+28>>2];e=+o[f+44>>2];k[b>>2]=0;k[b+4>>2]=0;k[b+8>>2]=0;k[b+12>>2]=0;n=+o[j>>2];d=+o[j+4>>2];l=+o[j+8>>2];o[a+428+(h*84|0)+16>>2]=K*n+J*d+I*l;o[a+428+(h*84|0)+20>>2]=G*n+F*d+E*l;o[a+428+(h*84|0)+24>>2]=C*n+B*d+A*l;o[a+428+(h*84|0)+28>>2]=0.0;o[a+428+(h*84|0)+32>>2]=y*-n+x*-d+w*-l;o[a+428+(h*84|0)+36>>2]=u*-n+t*-d+s*-l;o[a+428+(h*84|0)+40>>2]=p*-n+c*-d+e*-l;o[a+428+(h*84|0)+44>>2]=0.0;H=(K*n+J*d+I*l)*+o[g+396>>2];D=(G*n+F*d+E*l)*+o[g+400>>2];z=(C*n+B*d+A*l)*+o[g+404>>2];o[a+428+(h*84|0)+48>>2]=H;o[a+428+(h*84|0)+52>>2]=D;o[a+428+(h*84|0)+56>>2]=z;o[a+428+(h*84|0)+60>>2]=0.0;v=(y*-n+x*-d+w*-l)*+o[f+396>>2];q=(u*-n+t*-d+s*-l)*+o[f+400>>2];m=(p*-n+c*-d+e*-l)*+o[f+404>>2];o[a+428+(h*84|0)+64>>2]=v;o[a+428+(h*84|0)+68>>2]=q;o[a+428+(h*84|0)+72>>2]=m;o[a+428+(h*84|0)+76>>2]=0.0;o[a+428+(h*84|0)+80>>2]=(K*n+J*d+I*l)*H+(G*n+F*d+E*l)*D+(C*n+B*d+A*l)*z+((y*-n+x*-d+w*-l)*v+(u*-n+t*-d+s*-l)*q+(p*-n+c*-d+e*-l)*m)}h=h+1|0}while((h|0)!=3);r=j;return}function Sp(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0.0,g=0.0,h=0.0,j=0;if(i[a+1308>>0]|0){k[b>>2]=0;k[b+4>>2]=0;return}Qp(a,(k[a+28>>2]|0)+4|0,(k[a+32>>2]|0)+4|0);k[b>>2]=0;k[b+4>>2]=6;if((k[a+856>>2]|0)==0?(i[a+788>>0]|0)==0:0){c=0;d=6}else{k[b>>2]=1;k[b+4>>2]=5;c=1;d=5}if(!((k[a+860>>2]|0)==0?(i[a+789>>0]|0)==0:0)){c=c+1|0;k[b>>2]=c;d=d+-1|0;k[b+4>>2]=d}if((k[a+864>>2]|0)==0?(i[a+790>>0]|0)==0:0)j=0;else{c=c+1|0;k[b>>2]=c;d=d+-1|0;k[b+4>>2]=d;j=0}do{f=+o[a+868+(j<<6)>>2];g=+o[a+868+(j<<6)+4>>2];h=+Ww(+o[a+1192+(j<<2)>>2],f,g);o[a+868+(j<<6)+52>>2]=h;do if(!(f>g)){if(f>h){k[a+868+(j<<6)+56>>2]=1;e=a+868+(j<<6)+48|0;o[e>>2]=h-f;if(h-f>3.1415927410125732){o[e>>2]=h-f+-6.2831854820251465;e=21;break}if(!(h-f<-3.1415927410125732)){e=21;break}o[e>>2]=h-f+6.2831854820251465;e=21;break}e=a+868+(j<<6)+56|0;if(!(g<h)){k[e>>2]=0;e=20;break}k[e>>2]=2;e=a+868+(j<<6)+48|0;o[e>>2]=h-g;if(h-g>3.1415927410125732){o[e>>2]=h-g+-6.2831854820251465;e=21;break}if(h-g<-3.1415927410125732){o[e>>2]=h-g+6.2831854820251465;e=21}else e=21}else{k[a+868+(j<<6)+56>>2]=0;e=20}while(0);if((e|0)==20){e=0;if(i[a+868+(j<<6)+44>>0]|0)e=21}if((e|0)==21){c=c+1|0;k[b>>2]=c;d=d+-1|0;k[b+4>>2]=d}j=j+1|0}while((j|0)!=3);return}function Tp(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0,j=0;j=r;r=r+16|0;g=k[a+28>>2]|0;h=k[a+32>>2]|0;if(!(i[a+1301>>0]|0)){f=0;c=Up(a,b,0,g+4|0,h+4|0,g+312|0,h+312|0,g+328|0,h+328|0)|0;do{e=a+868+(f<<6)|0;if(!((k[a+868+(f<<6)+56>>2]|0)==0?(i[a+868+(f<<6)+44>>0]|0)==0:0)){d=a+1208+(f<<4)|0;k[j>>2]=k[d>>2];k[j+4>>2]=k[d+4>>2];k[j+8>>2]=k[d+8>>2];k[j+12>>2]=k[d+12>>2];d=k[a+1304>>2]>>(f*3|0)+9;if(!(d&1))o[a+868+(f<<6)+28>>2]=+o[k[b+32>>2]>>2];if(!(d&2))o[a+868+(f<<6)+36>>2]=+o[k[b+32>>2]>>2];if(!(d&4))o[a+868+(f<<6)+32>>2]=+o[b+4>>2];c=(Vp(a,e,g+4|0,h+4|0,g+312|0,h+312|0,g+328|0,h+328|0,b,c,j,1,0)|0)+c|0}f=f+1|0}while((f|0)!=3);r=j;return}else{f=0;c=0;do{d=a+868+(f<<6)|0;if(!((k[a+868+(f<<6)+56>>2]|0)==0?(i[a+868+(f<<6)+44>>0]|0)==0:0)){e=a+1208+(f<<4)|0;k[j>>2]=k[e>>2];k[j+4>>2]=k[e+4>>2];k[j+8>>2]=k[e+8>>2];k[j+12>>2]=k[e+12>>2];e=k[a+1304>>2]>>(f*3|0)+9;if(!(e&1))o[a+868+(f<<6)+28>>2]=+o[k[b+32>>2]>>2];if(!(e&2))o[a+868+(f<<6)+36>>2]=+o[k[b+32>>2]>>2];if(!(e&4))o[a+868+(f<<6)+32>>2]=+o[b+4>>2];c=(Vp(a,d,g+4|0,h+4|0,g+312|0,h+312|0,g+328|0,h+328|0,b,c,j,1,0)|0)+c|0}f=f+1|0}while((f|0)!=3);Up(a,b,c,g+4|0,h+4|0,g+312|0,h+312|0,g+328|0,h+328|0)|0;r=j;return}}function Up(a,b,c,d,e,f,g,h,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;j=j|0;var l=0,m=0,n=0,p=0;p=r;r=r+80|0;o[p+16+60>>2]=0.0;o[p+16+8>>2]=0.0;o[p+16+12>>2]=.10000000149011612;o[p+16+16>>2]=300.0;o[p+16>>2]=1.0;o[p+16+4>>2]=-1.0;o[p+16+28>>2]=0.0;o[p+16+32>>2]=.20000000298023224;o[p+16+36>>2]=0.0;o[p+16+40>>2]=0.0;o[p+16+20>>2]=1.0;o[p+16+24>>2]=.5;k[p+16+56>>2]=0;o[p+16+48>>2]=0.0;i[p+16+44>>0]=0;n=0;do{l=k[a+856+(n<<2)>>2]|0;m=i[a+788+n>>0]|0;do if(!((l|0)==0&m<<24>>24==0)){o[p+16+40>>2]=0.0;k[p+16+56>>2]=l;o[p+16+52>>2]=+o[a+840+(n<<2)>>2];o[p+16+48>>2]=+o[a+824+(n<<2)>>2];o[p+16+20>>2]=+o[a+732>>2];i[p+16+44>>0]=m;o[p+16+4>>2]=+o[a+696+(n<<2)>>2];o[p+16+24>>2]=+o[a+728>>2];o[p+16>>2]=+o[a+680+(n<<2)>>2];o[p+16+16>>2]=0.0;o[p+16+12>>2]=+o[a+808+(n<<2)>>2];o[p+16+8>>2]=+o[a+792+(n<<2)>>2];o[p>>2]=+o[a+1064+(n<<2)>>2];o[p+4>>2]=+o[a+1080+(n<<2)>>2];o[p+8>>2]=+o[a+1096+(n<<2)>>2];o[p+12>>2]=0.0;m=k[a+1304>>2]>>n*3;if(!(m&1))l=k[b+32>>2]|0;else l=a+740+(n<<2)|0;o[p+16+28>>2]=+o[l>>2];if(!(m&2))l=k[b+32>>2]|0;else l=a+772+(n<<2)|0;o[p+16+36>>2]=+o[l>>2];if(!(m&4))l=b+4|0;else l=a+756+(n<<2)|0;o[p+16+32>>2]=+o[l>>2];if(!(i[a+1301>>0]|0)){c=(Vp(a,p+16|0,d,e,f,g,h,j,b,c,p,0,0)|0)+c|0;break}m=n+1|0;if(!(k[a+868+(((m|0)==3?0:m)<<6)+56>>2]|0))l=1;else l=(k[a+868+(((n+2|0)%3|0)<<6)+56>>2]|0)==0&1;c=(Vp(a,p+16|0,d,e,f,g,h,j,b,c,p,0,l)|0)+c|0}while(0);n=n+1|0}while((n|0)!=3);r=p;return c|0}function Vp(a,b,c,d,e,f,g,h,j,l,m,n,p){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;j=j|0;l=l|0;m=m|0;n=n|0;p=p|0;var q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0,z=0,A=0,B=0,C=0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0;B=ia(k[j+24>>2]|0,l)|0;y=i[b+44>>0]|0;A=k[b+56>>2]|0;if(!(y<<24>>24!=0|(A|0)!=0)){B=0;return B|0}C=k[((n|0)!=0?j+12|0:j+8|0)>>2]|0;l=k[((n|0)!=0?j+20|0:j+16|0)>>2]|0;o[C+(B<<2)>>2]=+o[m>>2];o[C+(B+1<<2)>>2]=+o[m+4>>2];o[C+(B+2<<2)>>2]=+o[m+8>>2];o[l+(B<<2)>>2]=-+o[m>>2];o[l+(B+1<<2)>>2]=-+o[m+4>>2];o[l+(B+2<<2)>>2]=-+o[m+8>>2];do if(!n){r=+o[a+1176>>2];if(!(i[a+1301>>0]|0)){s=r-+o[c+48>>2];v=+o[a+1180>>2]-+o[c+52>>2];w=+o[a+1184>>2]-+o[c+56>>2];u=+o[m+8>>2];r=+o[m+4>>2];t=+o[m>>2];C=k[j+12>>2]|0;o[C+(B<<2)>>2]=v*u-w*r;o[C+(B+1<<2)>>2]=w*t-s*u;o[C+(B+2<<2)>>2]=s*r-v*t;t=+o[a+1176>>2]-+o[d+48>>2];v=+o[a+1180>>2]-+o[d+52>>2];r=+o[a+1184>>2]-+o[d+56>>2];s=+o[m+8>>2];u=+o[m+4>>2];w=+o[m>>2];C=k[j+20>>2]|0;o[C+(B<<2)>>2]=-(v*s-r*u);o[C+(B+1<<2)>>2]=-(r*w-t*s);o[C+(B+2<<2)>>2]=-(t*u-v*w);break}I=r-+o[d+48>>2];G=+o[a+1180>>2]-+o[d+52>>2];E=+o[a+1184>>2]-+o[d+56>>2];H=+o[m>>2];F=+o[m+4>>2];D=+o[m+8>>2];K=+o[a+1112>>2]-+o[c+48>>2];s=+o[a+1116>>2]-+o[c+52>>2];u=+o[a+1120>>2]-+o[c+56>>2];q=+o[b+52>>2]-+o[b+48>>2];J=H*(H*K+F*s+D*u)+H*q-H*(I*H+G*F+E*D);r=F*(H*K+F*s+D*u)+F*q-F*(I*H+G*F+E*D);q=D*(H*K+F*s+D*u)+D*q-D*(I*H+G*F+E*D);x=+o[a+1272>>2];w=+o[a+1276>>2];t=D*(s-F*(H*K+F*s+D*u)+x*r)-F*(u-D*(H*K+F*s+D*u)+x*q);v=H*(u-D*(H*K+F*s+D*u)+x*q)-D*(K-H*(H*K+F*s+D*u)+x*J);u=F*(K-H*(H*K+F*s+D*u)+x*J)-H*(s-F*(H*K+F*s+D*u)+x*r);s=D*(G-F*(I*H+G*F+E*D)-w*r)-F*(E-D*(I*H+G*F+E*D)-w*q);q=H*(E-D*(I*H+G*F+E*D)-w*q)-D*(I-H*(I*H+G*F+E*D)-w*J);r=F*(I-H*(I*H+G*F+E*D)-w*J)-H*(G-F*(I*H+G*F+E*D)-w*r);if(!((p|0)!=0|(i[a+1280>>0]|0)==0)){s=w*s;q=w*q;r=w*r;t=x*t;v=x*v;u=x*u}C=k[j+12>>2]|0;o[C+(B<<2)>>2]=t;o[C+(B+1<<2)>>2]=v;o[C+(B+2<<2)>>2]=u;C=k[j+20>>2]|0;o[C+(B<<2)>>2]=-s;o[C+(B+1<<2)>>2]=-q;o[C+(B+2<<2)>>2]=-r}while(0);if((A|0)!=0?+o[b>>2]==+o[b+4>>2]:0){l=k[j+28>>2]|0;o[l+(B<<2)>>2]=0.0;d=j+28|0}else z=11;do if((z|0)==11){l=k[j+28>>2]|0;o[l+(B<<2)>>2]=0.0;if(y<<24>>24){o[(k[j+32>>2]|0)+(B<<2)>>2]=+o[b+28>>2];if(A){d=j+28|0;break}v=+o[b+8>>2];if(n)q=v;else q=-v;s=+o[b+52>>2];t=+o[b>>2];u=+o[b+4>>2];r=+o[j>>2]*+o[b+32>>2];do if(!(t>u))if(!(t==u)){r=q/r;if(r<0.0)if(s>=t&t-r>s){r=(t-s)/r;break}else{r=s<t?0.0:1.0;break}if(r>0.0)if(s<=u&u-r<s){r=(u-s)/r;break}else{r=s>u?0.0:1.0;break}else r=0.0}else r=0.0;else r=1.0;while(0);o[l+(B<<2)>>2]=r*v+ +o[l+(B<<2)>>2];o[(k[j+36>>2]|0)+(B<<2)>>2]=-+o[b+12>>2];o[(k[j+40>>2]|0)+(B<<2)>>2]=+o[b+12>>2]}if(A)d=j+28|0;else{C=1;return C|0}}while(0);q=+o[j>>2]*+o[b+32>>2]*+o[b+48>>2];l=l+(B<<2)|0;r=+o[l>>2];if(n)r=r-q;else r=q+r;o[l>>2]=r;o[(k[j+32>>2]|0)+(B<<2)>>2]=+o[b+36>>2];if(+o[b>>2]==+o[b+4>>2]){o[(k[j+36>>2]|0)+(B<<2)>>2]=-3402823466385288598117041.0e14;o[(k[j+40>>2]|0)+(B<<2)>>2]=3402823466385288598117041.0e14;C=1;return C|0}C=k[j+40>>2]|0;o[(k[j+36>>2]|0)+(B<<2)>>2]=(A|0)==1?0.0:-3402823466385288598117041.0e14;o[C+(B<<2)>>2]=(A|0)==1?3402823466385288598117041.0e14:0.0;r=+o[b+40>>2];if(!(r>0.0)){C=1;return C|0}if(n){H=+o[m>>2];K=+o[m+4>>2];q=+o[m+8>>2];q=+o[g>>2]*H+ +o[g+4>>2]*K+ +o[g+8>>2]*q-(H*+o[h>>2]+K*+o[h+4>>2]+q*+o[h+8>>2])}else{H=+o[m>>2];K=+o[m+4>>2];q=+o[m+8>>2];q=+o[e>>2]*H+ +o[e+4>>2]*K+ +o[e+8>>2]*q-(H*+o[f>>2]+K*+o[f+4>>2]+q*+o[f+8>>2])}if((A|0)==1){if(!(q<0.0)){C=1;return C|0}q=-(q*r);l=(k[d>>2]|0)+(B<<2)|0;if(!(+o[l>>2]<q)){C=1;return C|0}o[l>>2]=q;C=1;return C|0}else{if(!(q>0.0)){C=1;return C|0}q=-(q*r);l=(k[d>>2]|0)+(B<<2)|0;if(!(+o[l>>2]>q)){C=1;return C|0}o[l>>2]=q;C=1;return C|0}return 0}function Wp(a){a=a|0;var b=0.0,c=0.0,d=0.0,e=0.0;b=+o[(k[a+28>>2]|0)+344>>2];c=+o[(k[a+32>>2]|0)+344>>2];if(c==0.0)b=1.0;else b=b/(b+c);e=1.0-b;d=b*+o[a+1116>>2]+e*+o[a+1180>>2];c=b*+o[a+1120>>2]+e*+o[a+1184>>2];o[a+1284>>2]=b*+o[a+1112>>2]+e*+o[a+1176>>2];o[a+1288>>2]=d;o[a+1292>>2]=c;o[a+1296>>2]=0.0;return}function Xp(a,b,c,d){a=a|0;b=b|0;c=+c;d=d|0;if(d>>>0<3)if((b|0)==2){o[a+756+(d<<2)>>2]=c;k[a+1304>>2]=k[a+1304>>2]|4<<d*3;return}else if((b|0)==4){o[a+772+(d<<2)>>2]=c;k[a+1304>>2]=k[a+1304>>2]|2<<d*3;return}else if((b|0)==3){o[a+740+(d<<2)>>2]=c;k[a+1304>>2]=k[a+1304>>2]|1<<d*3;return}else return;if((d+-3|0)>>>0>=3)return;if((b|0)==4){o[a+868+(d+-3<<6)+36>>2]=c;k[a+1304>>2]=k[a+1304>>2]|2<<d*3;return}else if((b|0)==3){o[a+868+(d+-3<<6)+28>>2]=c;k[a+1304>>2]=k[a+1304>>2]|1<<d*3;return}else if((b|0)==2){o[a+868+(d+-3<<6)+32>>2]=c;k[a+1304>>2]=k[a+1304>>2]|4<<d*3;return}else return}function Yp(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0;do if(c>>>0<3)if((b|0)==2){d=+o[a+756+(c<<2)>>2];break}else if((b|0)==4){d=+o[a+772+(c<<2)>>2];break}else if((b|0)==3){d=+o[a+740+(c<<2)>>2];break}else{d=0.0;break}else if((c+-3|0)>>>0<3)if((b|0)==3){d=+o[a+868+(c+-3<<6)+28>>2];break}else if((b|0)==2){d=+o[a+868+(c+-3<<6)+32>>2];break}else if((b|0)==4){d=+o[a+868+(c+-3<<6)+36>>2];break}else{d=0.0;break}else d=0.0;while(0);return +d}function Zp(a,b){a=a|0;b=b|0;var c=0.0,d=0.0;if(i[a+1309>>0]|0){c=(+o[a+1256>>2]-+o[a+1316>>2])*+o[a+1340>>2];o[a+792>>2]=c*(+o[b>>2]*+o[a+1364>>2]/+(k[b+48>>2]|0));c=+X(+c);o[a+808>>2]=c/+o[b>>2]}if(i[a+1310>>0]|0){c=(+o[a+1260>>2]-+o[a+1320>>2])*+o[a+1344>>2];o[a+796>>2]=c*(+o[b>>2]*+o[a+1368>>2]/+(k[b+48>>2]|0));c=+X(+c);o[a+812>>2]=c/+o[b>>2]}if(i[a+1311>>0]|0){c=(+o[a+1264>>2]-+o[a+1324>>2])*+o[a+1348>>2];o[a+800>>2]=c*(+o[b>>2]*+o[a+1372>>2]/+(k[b+48>>2]|0));c=+X(+c);o[a+816>>2]=c/+o[b>>2]}if(i[a+1312>>0]|0){d=-((+o[a+1192>>2]-+o[a+1328>>2])*+o[a+1352>>2]);c=+o[b>>2];o[a+876>>2]=c*+o[a+1376>>2]/+(k[b+48>>2]|0)*d;c=+X(+d)/c;o[a+880>>2]=c}if(i[a+1313>>0]|0){c=-((+o[a+1196>>2]-+o[a+1332>>2])*+o[a+1356>>2]);d=+o[b>>2];o[a+940>>2]=d*+o[a+1380>>2]/+(k[b+48>>2]|0)*c;d=+X(+c)/d;o[a+944>>2]=d}if(!(i[a+1314>>0]|0)){Tp(a,b);return}c=-((+o[a+1200>>2]-+o[a+1336>>2])*+o[a+1360>>2]);d=+o[b>>2];o[a+1004>>2]=d*+o[a+1384>>2]/+(k[b+48>>2]|0)*c;d=+X(+c)/d;o[a+1008>>2]=d;Tp(a,b);return}function _p(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0;u=+o[b>>2];t=+o[b+4>>2];s=+o[b+8>>2];r=1.0/+Y(+(u*u+t*t+s*s));y=+o[c>>2];x=+o[c+4>>2];w=+o[c+8>>2];v=1.0/+Y(+(y*y+x*x+w*w));B=s*r*(x*v)-t*r*(w*v);A=u*r*(w*v)-s*r*(y*v);z=t*r*(y*v)-u*r*(x*v);c=k[a+28>>2]|0;d=+o[c+4>>2];f=+o[c+20>>2];h=+o[c+36>>2];e=+o[c+8>>2];g=+o[c+24>>2];i=+o[c+40>>2];j=+o[c+12>>2];m=+o[c+28>>2];p=+o[c+44>>2];l=-+o[c+52>>2];n=-+o[c+56>>2];q=-+o[c+60>>2];o[a+48>>2]=d*B+A*f+z*h;o[a+52>>2]=y*v*d+x*v*f+w*v*h;o[a+56>>2]=u*r*d+t*r*f+s*r*h;o[a+60>>2]=0.0;o[a+64>>2]=B*e+A*g+z*i;o[a+68>>2]=y*v*e+x*v*g+w*v*i;o[a+72>>2]=u*r*e+t*r*g+s*r*i;o[a+76>>2]=0.0;o[a+80>>2]=B*j+A*m+z*p;o[a+84>>2]=y*v*j+x*v*m+w*v*p;o[a+88>>2]=u*r*j+t*r*m+s*r*p;o[a+92>>2]=0.0;o[a+96>>2]=d*0.0+f*0.0+h*0.0+(d*l+f*n+h*q);o[a+100>>2]=e*0.0+g*0.0+i*0.0+(e*l+g*n+i*q);o[a+104>>2]=j*0.0+m*0.0+p*0.0+(j*l+m*n+p*q);o[a+108>>2]=0.0;c=k[a+32>>2]|0;q=+o[c+4>>2];p=+o[c+20>>2];n=+o[c+36>>2];m=+o[c+8>>2];l=+o[c+24>>2];j=+o[c+40>>2];i=+o[c+12>>2];g=+o[c+28>>2];e=+o[c+44>>2];h=-+o[c+52>>2];f=-+o[c+56>>2];d=-+o[c+60>>2];o[a+112>>2]=B*q+A*p+z*n;o[a+116>>2]=y*v*q+x*v*p+w*v*n;o[a+120>>2]=u*r*q+t*r*p+s*r*n;o[a+124>>2]=0.0;o[a+128>>2]=B*m+A*l+z*j;o[a+132>>2]=y*v*m+x*v*l+w*v*j;o[a+136>>2]=u*r*m+t*r*l+s*r*j;o[a+140>>2]=0.0;o[a+144>>2]=B*i+A*g+z*e;o[a+148>>2]=y*v*i+x*v*g+w*v*e;o[a+152>>2]=u*r*i+t*r*g+s*r*e;o[a+156>>2]=0.0;o[a+160>>2]=q*0.0+p*0.0+n*0.0+(q*h+p*f+n*d);o[a+164>>2]=m*0.0+l*0.0+j*0.0+(m*h+l*f+j*d);o[a+168>>2]=i*0.0+g*0.0+e*0.0+(i*h+g*f+e*d);o[a+172>>2]=0.0;Qp(a,(k[a+28>>2]|0)+4|0,(k[a+32>>2]|0)+4|0);return}function $p(a){a=a|0;var b=0,c=0,d=0,e=0,f=0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0;c=r;r=r+144|0;o[a+36>>2]=0.0;k[c+128>>2]=0;k[c+128+4>>2]=0;k[c+128+8>>2]=0;k[c+128+12>>2]=0;b=0;do{d=c+128+(b<<2)|0;o[d>>2]=1.0;e=k[a+28>>2]|0;G=+o[e+4>>2];o[c+80>>2]=G;C=+o[e+20>>2];o[c+80+4>>2]=C;g=+o[e+36>>2];o[c+80+8>>2]=g;o[c+80+12>>2]=0.0;F=+o[e+8>>2];o[c+80+16>>2]=F;B=+o[e+24>>2];o[c+80+20>>2]=B;u=+o[e+40>>2];o[c+80+24>>2]=u;o[c+80+28>>2]=0.0;E=+o[e+12>>2];o[c+80+32>>2]=E;A=+o[e+28>>2];o[c+80+36>>2]=A;l=+o[e+44>>2];o[c+80+40>>2]=l;o[c+80+44>>2]=0.0;f=k[a+32>>2]|0;x=+o[f+4>>2];o[c+32>>2]=x;t=+o[f+20>>2];o[c+32+4>>2]=t;m=+o[f+36>>2];o[c+32+8>>2]=m;o[c+32+12>>2]=0.0;w=+o[f+8>>2];o[c+32+16>>2]=w;s=+o[f+24>>2];o[c+32+20>>2]=s;j=+o[f+40>>2];o[c+32+24>>2]=j;o[c+32+28>>2]=0.0;v=+o[f+12>>2];o[c+32+32>>2]=v;q=+o[f+28>>2];o[c+32+36>>2]=q;h=+o[f+44>>2];o[c+32+40>>2]=h;o[c+32+44>>2]=0.0;y=+o[a+300>>2];p=+o[a+304>>2];i=+o[a+308>>2];D=+o[e+52>>2];z=+o[e+56>>2];n=+o[e+60>>2];o[c+16>>2]=y*G+p*F+i*E+D-D;o[c+16+4>>2]=y*C+p*B+i*A+z-z;o[c+16+8>>2]=y*g+p*u+i*l+n-n;o[c+16+12>>2]=0.0;n=+o[a+316>>2];l=+o[a+320>>2];i=+o[a+324>>2];u=+o[f+52>>2];p=+o[f+56>>2];g=+o[f+60>>2];o[c>>2]=n*x+l*w+i*v+u-u;o[c+4>>2]=n*t+l*s+i*q+p-p;o[c+8>>2]=n*m+l*j+i*h+g-g;o[c+12>>2]=0.0;f=k[a+28>>2]|0;e=k[a+32>>2]|0;Vw(a+48+(b*84|0)|0,c+80|0,c+32|0,c+16|0,c,c+128|0,f+396|0,+o[f+344>>2],e+396|0,+o[e+344>>2]);o[d>>2]=0.0;b=b+1|0}while((b|0)!=3);r=c;return}function aq(a,b){a=a|0;b=b|0;a=(i[a+344>>0]|0)==0?3:0;k[b>>2]=a;k[b+4>>2]=a;return}function bq(a,b){a=a|0;b=b|0;var c=0.0,d=0,e=0.0,f=0,g=0,h=0,i=0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0;h=k[a+28>>2]|0;i=k[a+32>>2]|0;d=k[b+8>>2]|0;o[d>>2]=1.0;f=k[b+24>>2]|0;o[d+(f+1<<2)>>2]=1.0;o[d+((f<<1)+2<<2)>>2]=1.0;j=+o[a+300>>2];q=+o[a+304>>2];e=+o[a+308>>2];n=+o[h+4>>2]*j+ +o[h+8>>2]*q+ +o[h+12>>2]*e;l=j*+o[h+20>>2]+q*+o[h+24>>2]+e*+o[h+28>>2];e=j*+o[h+36>>2]+q*+o[h+40>>2]+e*+o[h+44>>2];d=k[b+12>>2]|0;o[d>>2]=0.0;o[d+4>>2]=e;o[d+8>>2]=-l;o[d+12>>2]=0.0;o[d+(f<<2)>>2]=-e;o[d+(f+1<<2)>>2]=0.0;o[d+(f+2<<2)>>2]=n;o[d+(f+3<<2)>>2]=0.0;o[d+(f<<1<<2)>>2]=l;o[d+((f<<1|1)<<2)>>2]=-n;o[d+((f<<1)+2<<2)>>2]=0.0;o[d+((f<<1)+3<<2)>>2]=0.0;d=k[b+16>>2]|0;o[d>>2]=-1.0;o[d+(f+1<<2)>>2]=-1.0;o[d+((f<<1)+2<<2)>>2]=-1.0;q=+o[a+316>>2];j=+o[a+320>>2];c=+o[a+324>>2];p=+o[i+4>>2]*q+ +o[i+8>>2]*j+ +o[i+12>>2]*c;m=q*+o[i+20>>2]+j*+o[i+24>>2]+c*+o[i+28>>2];c=q*+o[i+36>>2]+j*+o[i+40>>2]+c*+o[i+44>>2];f=k[b+20>>2]|0;d=k[b+24>>2]|0;o[f>>2]=0.0;o[f+4>>2]=-c;o[f+8>>2]=m;o[f+12>>2]=0.0;o[f+(d<<2)>>2]=c;o[f+(d+1<<2)>>2]=0.0;o[f+(d+2<<2)>>2]=-p;o[f+(d+3<<2)>>2]=0.0;o[f+(d<<1<<2)>>2]=-m;o[f+((d<<1|1)<<2)>>2]=p;o[f+((d<<1)+2<<2)>>2]=0.0;o[f+((d<<1)+3<<2)>>2]=0.0;f=k[a+332>>2]|0;j=+o[((f&1|0)==0?b+4|0:a+336|0)>>2]*+o[b>>2];g=k[b+28>>2]|0;o[g>>2]=j*(p+ +o[i+52>>2]-n-+o[h+52>>2]);o[g+(d<<2)>>2]=j*(m+ +o[i+56>>2]-l-+o[h+56>>2]);o[g+(d<<1<<2)>>2]=j*(c+ +o[i+60>>2]-e-+o[h+60>>2]);if(f&2){i=k[b+32>>2]|0;o[i>>2]=+o[a+340>>2];o[i+(d<<2)>>2]=+o[a+340>>2];o[i+(d<<1<<2)>>2]=+o[a+340>>2]}e=+o[a+356>>2];if(e>0.0){o[k[b+36>>2]>>2]=-e;o[k[b+40>>2]>>2]=e;c=+o[a+356>>2]}else c=e;if(c>0.0){o[(k[b+36>>2]|0)+(d<<2)>>2]=-e;o[(k[b+40>>2]|0)+(d<<2)>>2]=e;c=+o[a+356>>2]}if(!(c>0.0)){i=a+352|0;q=+o[i>>2];i=b+52|0;o[i>>2]=q;return}o[(k[b+36>>2]|0)+(d<<1<<2)>>2]=-e;o[(k[b+40>>2]|0)+(d<<1<<2)>>2]=e;i=a+352|0;q=+o[i>>2];i=b+52|0;o[i>>2]=q;return}function cq(a,b,c,d){a=a|0;b=b|0;c=+c;d=d|0;if((d|0)!=-1)return;if((b|0)==4|(b|0)==3){o[a+340>>2]=c;k[a+332>>2]=k[a+332>>2]|2;return}else if((b|0)==2|(b|0)==1){o[a+336>>2]=c;k[a+332>>2]=k[a+332>>2]|1;return}else return}function dq(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0;do if((c|0)==-1)if((b|0)==2|(b|0)==1){d=+o[a+336>>2];break}else if((b|0)==4|(b|0)==3){d=+o[a+340>>2];break}else{d=3402823466385288598117041.0e14;break}else d=3402823466385288598117041.0e14;while(0);return +d}function eq(){var a=0,b=0.0,c=0.0;a=r;r=r+16|0;if((i[3576]|0)==0?(db(3576)|0)!=0:0){k[a>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;_o(2960,0.0,0,0,a);ib(3576)}k[791]=k[791]|1;o[826]=0.0;b=+o[836]*0.0;c=+o[837]*0.0;o[831]=+o[835]*0.0;o[832]=b;o[833]=c;o[834]=0.0;k[839]=0;k[840]=0;k[841]=0;k[842]=0;c=+o[828]*0.0;b=+o[829]*0.0;o[880]=+o[827]*0.0;o[881]=c;o[882]=b;o[883]=0.0;r=a;return}function fq(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0;d=nc[k[(k[c>>2]|0)+28>>2]&31](c,k[a+28>>2]|0)|0;k[b>>2]=d;d=nc[k[(k[c>>2]|0)+28>>2]&31](c,k[a+32>>2]|0)|0;k[b+4>>2]=d;d=nc[k[(k[c>>2]|0)+40>>2]&31](c,a)|0;e=nc[k[(k[c>>2]|0)+28>>2]&31](c,d)|0;k[b+8>>2]=e;if(e)Ub[k[(k[c>>2]|0)+48>>2]&127](c,d);k[b+12>>2]=k[a+4>>2];k[b+24>>2]=l[a+21>>0];k[b+40>>2]=k[a+24>>2];o[b+44>>2]=+o[a+16>>2];k[b+48>>2]=l[a+20>>0];k[b+20>>2]=k[a+12>>2];k[b+16>>2]=k[a+8>>2];o[b+28>>2]=+o[a+36>>2];o[b+32>>2]=+o[a+40>>2];k[b+36>>2]=0;d=k[a+28>>2]|0;if((k[d+488>>2]|0)>0){c=0;do{if((k[(k[d+496>>2]|0)+(c<<2)>>2]|0)==(a|0)){k[b+36>>2]=1;d=k[a+28>>2]|0}c=c+1|0}while((c|0)<(k[d+488>>2]|0))}d=k[a+32>>2]|0;if((k[d+488>>2]|0)>0)c=0;else return 2928;do{if((k[(k[d+496>>2]|0)+(c<<2)>>2]|0)==(a|0)){k[b+36>>2]=1;d=k[a+32>>2]|0}c=c+1|0}while((c|0)<(k[d+488>>2]|0));return 2928}function gq(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0,h=0.0,j=0.0,l=0.0,m=0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0;g=r;r=r+256|0;if((i[a+180>>0]|0)==0?(i[a+48>>0]|0)!=0:0){Sw(g+64|0,c,a+116|0);k[a+824>>2]=k[g+64>>2];k[a+824+4>>2]=k[g+64+4>>2];k[a+824+8>>2]=k[g+64+8>>2];k[a+824+12>>2]=k[g+64+12>>2];k[a+840>>2]=k[g+64+16>>2];k[a+840+4>>2]=k[g+64+16+4>>2];k[a+840+8>>2]=k[g+64+16+8>>2];k[a+840+12>>2]=k[g+64+16+12>>2];k[a+856>>2]=k[g+64+32>>2];k[a+856+4>>2]=k[g+64+32+4>>2];k[a+856+8>>2]=k[g+64+32+8>>2];k[a+856+12>>2]=k[g+64+32+12>>2];k[a+872>>2]=k[g+64+48>>2];k[a+872+4>>2]=k[g+64+48+4>>2];k[a+872+8>>2]=k[g+64+48+8>>2];k[a+872+12>>2]=k[g+64+48+12>>2];Sw(g,b,a+52|0);k[a+888>>2]=k[g>>2];k[a+888+4>>2]=k[g+4>>2];k[a+888+8>>2]=k[g+8>>2];k[a+888+12>>2]=k[g+12>>2];k[a+904>>2]=k[g+16>>2];k[a+904+4>>2]=k[g+16+4>>2];k[a+904+8>>2]=k[g+16+8>>2];k[a+904+12>>2]=k[g+16+12>>2];k[a+920>>2]=k[g+32>>2];k[a+920+4>>2]=k[g+32+4>>2];k[a+920+8>>2]=k[g+32+8>>2];k[a+920+12>>2]=k[g+32+12>>2];k[a+936>>2]=k[g+48>>2];k[a+936+4>>2]=k[g+48+4>>2];k[a+936+8>>2]=k[g+48+8>>2];k[a+936+12>>2]=k[g+48+12>>2]}else{Sw(g+192|0,b,a+52|0);k[a+824>>2]=k[g+192>>2];k[a+824+4>>2]=k[g+192+4>>2];k[a+824+8>>2]=k[g+192+8>>2];k[a+824+12>>2]=k[g+192+12>>2];k[a+840>>2]=k[g+192+16>>2];k[a+840+4>>2]=k[g+192+16+4>>2];k[a+840+8>>2]=k[g+192+16+8>>2];k[a+840+12>>2]=k[g+192+16+12>>2];k[a+856>>2]=k[g+192+32>>2];k[a+856+4>>2]=k[g+192+32+4>>2];k[a+856+8>>2]=k[g+192+32+8>>2];k[a+856+12>>2]=k[g+192+32+12>>2];k[a+872>>2]=k[g+192+48>>2];k[a+872+4>>2]=k[g+192+48+4>>2];k[a+872+8>>2]=k[g+192+48+8>>2];k[a+872+12>>2]=k[g+192+48+12>>2];Sw(g+128|0,c,a+116|0);k[a+888>>2]=k[g+128>>2];k[a+888+4>>2]=k[g+128+4>>2];k[a+888+8>>2]=k[g+128+8>>2];k[a+888+12>>2]=k[g+128+12>>2];k[a+904>>2]=k[g+128+16>>2];k[a+904+4>>2]=k[g+128+16+4>>2];k[a+904+8>>2]=k[g+128+16+8>>2];k[a+904+12>>2]=k[g+128+16+12>>2];k[a+920>>2]=k[g+128+32>>2];k[a+920+4>>2]=k[g+128+32+4>>2];k[a+920+8>>2]=k[g+128+32+8>>2];k[a+920+12>>2]=k[g+128+32+12>>2];k[a+936>>2]=k[g+128+48>>2];k[a+936+4>>2]=k[g+128+48+4>>2];k[a+936+8>>2]=k[g+128+48+8>>2];k[a+936+12>>2]=k[g+128+48+12>>2]}k[a+968>>2]=k[a+872>>2];k[a+968+4>>2]=k[a+872+4>>2];k[a+968+8>>2]=k[a+872+8>>2];k[a+968+12>>2]=k[a+872+12>>2];k[a+984>>2]=k[a+936>>2];k[a+984+4>>2]=k[a+936+4>>2];k[a+984+8>>2]=k[a+936+8>>2];k[a+984+12>>2]=k[a+936+12>>2];d=+o[a+824>>2];e=+o[a+840>>2];f=+o[a+856>>2];o[a+952>>2]=d;o[a+956>>2]=e;o[a+960>>2]=f;o[a+964>>2]=0.0;if((i[a+180>>0]|0)==0?(i[a+48>>0]|0)==0:0){s=+o[a+968>>2];l=s-+o[a+984>>2];q=+o[a+972>>2];j=q-+o[a+988>>2];p=+o[a+976>>2];h=p-+o[a+992>>2];o[a+1016>>2]=l;o[a+1020>>2]=j;o[a+1024>>2]=h;o[a+1028>>2]=0.0;n=d*l;t=e*j;t=n+t;n=f*h;n=t+n;d=d*n;e=e*n;f=f*n;d=s+d;e=q+e;f=p+f;c=a+1e3|0;o[c>>2]=d;c=a+1004|0;o[c>>2]=e;c=a+1008|0;o[c>>2]=f;c=a+1012|0;o[c>>2]=0.0;c=a+1032|0;o[c>>2]=n;c=a+828|0;b=a+844|0;m=a+860|0;f=+o[c>>2];e=+o[b>>2];d=+o[m>>2];f=f*l;e=e*j;e=f+e;d=d*h;d=e+d;m=a+1036|0;o[m>>2]=d;m=a+832|0;b=a+848|0;c=a+864|0;d=+o[m>>2];e=+o[b>>2];f=+o[c>>2];d=d*l;e=e*j;e=d+e;f=f*h;f=e+f;c=a+1040|0;o[c>>2]=f;r=g;return}u=+o[a+968>>2];t=+o[a+984>>2]-u;q=+o[a+972>>2];n=+o[a+988>>2]-q;h=+o[a+976>>2];p=+o[a+992>>2]-h;o[a+1016>>2]=t;o[a+1020>>2]=n;o[a+1024>>2]=p;o[a+1028>>2]=0.0;l=d*t;s=e*n;s=l+s;l=f*p;l=s+l;s=d*l;j=e*l;f=f*l;s=u+s;j=q+j;f=h+f;c=a+1e3|0;o[c>>2]=s;c=a+1004|0;o[c>>2]=j;c=a+1008|0;o[c>>2]=f;c=a+1012|0;o[c>>2]=0.0;c=a+1032|0;o[c>>2]=l;c=a+828|0;m=a+844|0;b=a+860|0;l=+o[c>>2];f=+o[m>>2];j=+o[b>>2];l=l*t;f=f*n;f=l+f;j=j*p;j=f+j;b=a+1036|0;o[b>>2]=j;b=a+832|0;m=a+848|0;c=a+864|0;j=+o[b>>2];f=+o[m>>2];l=+o[c>>2];t=j*t;n=f*n;n=t+n;p=l*p;p=n+p;c=a+1040|0;o[c>>2]=p;r=g;return}function hq(a,b){a=a|0;b=b|0;var c=0,d=0.0,e=0.0,f=0.0,g=0,h=0.0,j=0.0;if(i[a+48>>0]|0){k[b>>2]=0;k[b+4>>2]=0;return}k[b>>2]=4;k[b+4>>2]=2;gq(a,(k[a+28>>2]|0)+4|0,(k[a+32>>2]|0)+4|0);o[a+1088>>2]=0.0;i[a+297>>0]=0;d=+o[a+192>>2];e=+o[a+196>>2];do if(d<=e){j=+o[a+892>>2];h=+o[a+908>>2];f=+o[a+924>>2];f=+Ww(+ea(+(+o[a+832>>2]*j+ +o[a+848>>2]*h+ +o[a+864>>2]*f),+(+o[a+828>>2]*j+ +o[a+844>>2]*h+ +o[a+860>>2]*f)),d,e);o[a+1084>>2]=f;if(f<d){o[a+1088>>2]=f-d;i[a+297>>0]=1;g=1;break}if(f>e){o[a+1088>>2]=f-e;i[a+297>>0]=1;g=1}else g=0}else g=0;while(0);i[a+296>>0]=0;f=+o[a+1032>>2];o[a+1080>>2]=f;e=+o[a+184>>2];d=+o[a+188>>2];do if(e<=d){if(f>d){o[a+1032>>2]=f-d;i[a+296>>0]=1;c=14;break}if(f<e){o[a+1032>>2]=f-e;i[a+296>>0]=1;c=14}else c=13}else c=13;while(0);if((c|0)==13?(o[a+1032>>2]=0.0,(i[a+1096>>0]|0)!=0):0)c=14;if((c|0)==14){k[b>>2]=(k[b>>2]|0)+1;k[b+4>>2]=(k[b+4>>2]|0)+-1}if(g<<24>>24==0?(i[a+1112>>0]|0)==0:0)return;k[b>>2]=(k[b>>2]|0)+1;k[b+4>>2]=(k[b+4>>2]|0)+-1;return}function iq(a,b){a=a|0;b=b|0;var c=0.0,d=0,e=0.0,f=0,g=0.0,h=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0,q=0.0,r=0,s=0,t=0,u=0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0,M=0,N=0.0,O=0.0,P=0.0,Q=0.0,R=0.0,S=0,T=0.0,U=0,V=0.0,W=0.0,Z=0.0;S=k[a+28>>2]|0;U=k[a+32>>2]|0;e=+o[S+344>>2];c=+o[U+344>>2];s=k[b+24>>2]|0;T=(i[a+180>>0]|0)!=0?1.0:-1.0;N=+o[a+936>>2]-+o[a+872>>2];O=+o[a+940>>2]-+o[a+876>>2];P=+o[a+944>>2]-+o[a+880>>2];if(e<1.1920928955078125e-07)f=1;else f=c<1.1920928955078125e-07;if(e+c>0.0)R=c/(e+c);else R=.5;Q=1.0-R;e=+o[a+824>>2];h=+o[a+840>>2];c=+o[a+856>>2];v=+o[a+888>>2];w=+o[a+904>>2];x=+o[a+920>>2];d=(i[a+49>>0]|0)==0;do if(!d){n=R*e+Q*v;m=R*h+Q*w;l=R*c+Q*x;j=1.0/+Y(+(n*n+m*m+l*l));if(+X(+(l*j))>.7071067690849304){q=1.0/+Y(+(l*j*(l*j)+m*j*(m*j)));V=n*j;W=m*j;Z=l*j;g=0.0;J=m*j*q;I=-(l*j*q);G=(l*j*(l*j)+m*j*(m*j))*q;B=n*j*-(l*j*q);q=-(n*j*(m*j*q));break}else{q=1.0/+Y(+(n*j*(n*j)+m*j*(m*j)));V=n*j;W=m*j;Z=l*j;g=-(m*j*q);J=0.0;I=n*j*q;G=-(l*j*(n*j*q));B=(n*j*(n*j)+m*j*(m*j))*q;q=l*j*-(m*j*q);break}}else{V=e;W=h;Z=c;g=+o[a+828>>2];J=+o[a+860>>2];I=+o[a+844>>2];G=+o[a+832>>2];B=+o[a+864>>2];q=+o[a+848>>2]}while(0);p=k[b+12>>2]|0;o[p>>2]=g;o[p+4>>2]=I;o[p+8>>2]=J;o[p+(s<<2)>>2]=G;o[p+(s+1<<2)>>2]=q;o[p+(s+2<<2)>>2]=B;m=-g;u=k[b+20>>2]|0;o[u>>2]=m;l=-I;o[u+4>>2]=l;j=-J;o[u+8>>2]=j;y=-G;o[u+(s<<2)>>2]=y;z=-q;o[u+(s+1<<2)>>2]=z;A=-B;o[u+(s+2<<2)>>2]=A;r=k[a+300>>2]|0;n=+o[a+280>>2];if(!(r&128))n=n*+o[b+4>>2];K=n*+o[b>>2];M=k[b+28>>2]|0;o[M>>2]=K*((h*x-c*w)*g+(c*v-e*x)*I+(e*w-h*v)*J);o[M+(s<<2)>>2]=K*((h*x-c*w)*G+(c*v-e*x)*q+(e*w-h*v)*B);if(r&64){M=k[b+32>>2]|0;o[M>>2]=+o[a+292>>2];o[M+(s<<2)>>2]=+o[a+292>>2]}c=+o[S+52>>2];v=+o[S+56>>2];h=+o[S+60>>2];w=+o[U+52>>2];n=+o[U+56>>2];e=+o[U+60>>2];if(d){x=(n-v)*J-(e-h)*I;K=(e-h)*g-(w-c)*J;D=(w-c)*I-(n-v)*g;o[p+(s<<1<<2)>>2]=R*x;o[p+((s<<1|1)<<2)>>2]=R*K;o[p+((s<<1)+2<<2)>>2]=R*D;o[u+(s<<1<<2)>>2]=Q*x;o[u+((s<<1|1)<<2)>>2]=Q*K;o[u+((s<<1)+2<<2)>>2]=Q*D;D=(n-v)*B-(e-h)*q;K=(e-h)*G-(w-c)*B;x=(w-c)*q-(n-v)*G;o[p+(s*3<<2)>>2]=R*D;o[p+((s*3|0)+1<<2)>>2]=R*K;o[p+((s*3|0)+2<<2)>>2]=R*x;o[u+(s*3<<2)>>2]=Q*D;o[u+((s*3|0)+1<<2)>>2]=Q*K;o[u+((s*3|0)+2<<2)>>2]=Q*x;d=k[b+8>>2]|0;o[d+(s<<1<<2)>>2]=g;o[d+((s<<1|1)<<2)>>2]=I;o[d+((s<<1)+2<<2)>>2]=J;d=k[b+8>>2]|0;o[d+(s*3<<2)>>2]=G;o[d+((s*3|0)+1<<2)>>2]=q;o[d+((s*3|0)+2<<2)>>2]=B;d=k[b+16>>2]|0;o[d+(s<<1<<2)>>2]=m;o[d+((s<<1|1)<<2)>>2]=l;o[d+((s<<1)+2<<2)>>2]=j;o[d+(s*3<<2)>>2]=y;o[d+((s*3|0)+1<<2)>>2]=z;o[d+((s*3|0)+2<<2)>>2]=A;x=B;K=0.0;z=0.0;B=0.0;D=0.0;F=0.0;C=0.0;v=n-v;y=e-h;A=w-c;j=J;l=I;m=G}else{J=+o[a+936>>2]-w;D=+o[a+940>>2]-n;E=+o[a+944>>2]-e;F=V*J+W*D+Z*E;G=V*F;C=W*F;F=Z*F;I=+o[a+872>>2]-c;x=+o[a+876>>2]-v;K=+o[a+880>>2]-h;m=V*I+W*x+Z*K;n=V*m;l=W*m;m=Z*m;w=+o[a+1080>>2]-+o[a+1032>>2];v=n+V*w-G;y=l+W*w-C;w=m+Z*w-F;B=I-n+R*v;A=x-l+R*y;z=K-m+R*w;n=R*(J-G)+Q*(I-n);l=R*(D-C)+Q*(x-l);m=R*(E-F)+Q*(K-m);if(n*n+l*l+m*m>1.1920928955078125e-07){I=1.0/+Y(+(n*n+l*l+m*m));c=n*I;H=I*m;I=I*l}else{c=+o[a+828>>2];H=+o[a+860>>2];I=+o[a+844>>2]}m=W*H-Z*I;q=Z*c-V*H;x=V*I-W*c;o[p+(s<<1<<2)>>2]=A*H-z*I;o[p+((s<<1|1)<<2)>>2]=z*c-B*H;o[p+((s<<1)+2<<2)>>2]=B*I-A*c;p=k[b+20>>2]|0;o[p+(s<<1<<2)>>2]=-((D-C-Q*y)*H-(E-F-Q*w)*I);o[p+((s<<1|1)<<2)>>2]=-((E-F-Q*w)*c-(J-G-Q*v)*H);o[p+((s<<1)+2<<2)>>2]=-((J-G-Q*v)*I-(D-C-Q*y)*c);n=(D-C-Q*y)*x-(E-F-Q*w)*q;l=(E-F-Q*w)*m-(J-G-Q*v)*x;j=(J-G-Q*v)*q-(D-C-Q*y)*m;if(f?(i[a+297>>0]|0)!=0:0){n=Q*n;l=Q*l;j=Q*j;g=R*(A*x-z*q);e=R*(B*q-A*m);h=R*(z*m-B*x)}else{g=A*x-z*q;e=B*q-A*m;h=z*m-B*x}d=k[b+12>>2]|0;o[d+(s*3<<2)>>2]=g;o[d+((s*3|0)+1<<2)>>2]=h;o[d+((s*3|0)+2<<2)>>2]=e;d=k[b+20>>2]|0;o[d+(s*3<<2)>>2]=-n;o[d+((s*3|0)+1<<2)>>2]=-l;o[d+((s*3|0)+2<<2)>>2]=-j;d=k[b+8>>2]|0;o[d+(s<<1<<2)>>2]=c;o[d+((s<<1|1)<<2)>>2]=I;o[d+((s<<1)+2<<2)>>2]=H;d=k[b+8>>2]|0;o[d+(s*3<<2)>>2]=m;o[d+((s*3|0)+1<<2)>>2]=q;o[d+((s*3|0)+2<<2)>>2]=x;d=k[b+16>>2]|0;o[d+(s<<1<<2)>>2]=-c;o[d+((s<<1|1)<<2)>>2]=-I;o[d+((s<<1)+2<<2)>>2]=-H;o[d+(s*3<<2)>>2]=-m;o[d+((s*3|0)+1<<2)>>2]=-q;o[d+((s*3|0)+2<<2)>>2]=-x;K=A;D=D-C-Q*y;F=E-F-Q*w;C=J-G-Q*v;v=0.0;y=0.0;A=0.0;g=c;j=H;l=I}L=k[a+300>>2]|0;n=+o[a+264>>2];if(!(L&32))n=n*+o[b+4>>2];J=n*+o[b>>2];M=k[b+28>>2]|0;o[M+(s<<1<<2)>>2]=J*(N*g+O*l+P*j);o[M+(s*3<<2)>>2]=J*(N*m+O*q+P*x);if(L&16){p=k[b+32>>2]|0;o[p+(s<<1<<2)>>2]=+o[a+276>>2];o[p+(s*3<<2)>>2]=+o[a+276>>2]}if(!(i[a+296>>0]|0)){u=0;q=0.0}else{q=T*+o[a+1032>>2];u=q>0.0?2:1}r=i[a+1096>>0]|0;s=(u|0)!=0;if(r&255|u){t=k[b+24>>2]<<2;p=k[b+8>>2]|0;o[p+(t<<2)>>2]=V;o[p+((t|1)<<2)>>2]=W;o[p+((t|2)<<2)>>2]=Z;o[d+(t<<2)>>2]=-V;o[d+((t|1)<<2)>>2]=-W;o[d+((t|2)<<2)>>2]=-Z;if(i[a+49>>0]|0){if(!f){p=k[b+12>>2]|0;o[p+(t<<2)>>2]=Z*K-W*z;o[p+((t|1)<<2)>>2]=V*z-Z*B;o[p+((t|2)<<2)>>2]=W*B-V*K;p=k[b+20>>2]|0;o[p+(t<<2)>>2]=-(Z*D-W*F);o[p+((t|1)<<2)>>2]=-(V*F-Z*C);o[p+((t|2)<<2)>>2]=-(W*C-V*D)}}else{N=Z*v-W*y;O=V*y-Z*A;P=W*A-V*v;p=k[b+12>>2]|0;o[p+(t<<2)>>2]=R*N;o[p+((t|1)<<2)>>2]=R*O;o[p+((t|2)<<2)>>2]=R*P;p=k[b+20>>2]|0;o[p+(t<<2)>>2]=Q*N;o[p+((t|1)<<2)>>2]=Q*O;o[p+((t|2)<<2)>>2]=Q*P}p=+o[a+184>>2]==+o[a+188>>2];o[M+(t<<2)>>2]=0.0;f=(k[b+36>>2]|0)+(t<<2)|0;o[f>>2]=0.0;d=(k[b+40>>2]|0)+(t<<2)|0;o[d>>2]=0.0;h=+o[((L&512|0)==0?b+4|0:a+232|0)>>2];if(!(r<<24>>24==0|s&p)){if(L&1)o[(k[b+32>>2]|0)+(t<<2)>>2]=+o[a+212>>2];e=+o[a+1100>>2];n=+o[a+1080>>2];m=+o[a+184>>2];l=+o[a+188>>2];j=h*+o[b>>2];do if(!(m>l))if(!(m==l)){if(e/j<0.0)if(n>=m?m-e/j>n:0){g=(m-n)/(e/j);break}else{g=n<m?0.0:1.0;break}if(e/j>0.0)if(n<=l?l-e/j<n:0){g=(l-n)/(e/j);break}else{g=n>l?0.0:1.0;break}else g=0.0}else g=0.0;else g=1.0;while(0);o[M+(t<<2)>>2]=+o[M+(t<<2)>>2]-T*g*e;o[f>>2]=+o[f>>2]-+o[a+1104>>2]*+o[b>>2];o[d>>2]=+o[a+1104>>2]*+o[b>>2]+ +o[d>>2]}if(s){o[M+(t<<2)>>2]=+o[M+(t<<2)>>2]+q*(h*+o[b>>2]);if(L&256)o[(k[b+32>>2]|0)+(t<<2)>>2]=+o[a+244>>2];do if(!p)if((u|0)==1){o[f>>2]=-3402823466385288598117041.0e14;o[d>>2]=0.0;break}else{o[f>>2]=0.0;o[d>>2]=3402823466385288598117041.0e14;break}else{o[f>>2]=-3402823466385288598117041.0e14;o[d>>2]=3402823466385288598117041.0e14}while(0);R=1.0-+o[a+240>>2];c=+X(+R);do if(!(R!=R|0.0!=0.0|R==0.0)){e=T*(V*+o[S+312>>2]+W*+o[S+316>>2]+Z*+o[S+320>>2]-(V*+o[U+312>>2]+W*+o[U+316>>2]+Z*+o[U+320>>2]));if((u|0)==1){if(!(e<0.0))break;if(!(+o[M+(t<<2)>>2]<-(c*e)))break;o[M+(t<<2)>>2]=-(c*e);break}else{if(!(e>0.0))break;if(!(+o[M+(t<<2)>>2]>-(c*e)))break;o[M+(t<<2)>>2]=-(c*e);break}}while(0);o[M+(t<<2)>>2]=+o[a+232>>2]*+o[M+(t<<2)>>2];f=5}else f=5}else f=4;if(!(i[a+297>>0]|0)){s=0;q=0.0}else{q=+o[a+1088>>2];s=q>0.0?1:2}d=i[a+1112>>0]|0;p=(s|0)!=0;if(!(d&255|s))return;r=ia(k[b+24>>2]|0,f)|0;U=k[b+12>>2]|0;o[U+(r<<2)>>2]=V;o[U+(r+1<<2)>>2]=W;o[U+(r+2<<2)>>2]=Z;U=k[b+20>>2]|0;o[U+(r<<2)>>2]=-V;o[U+(r+1<<2)>>2]=-W;o[U+(r+2<<2)>>2]=-Z;l=+o[a+192>>2];m=+o[a+196>>2];n=+o[((L&2048|0)==0?b+4|0:a+248|0)>>2];if(!(d<<24>>24==0|p&l==m)){if(!(L&4)){g=l;h=m}else{o[(k[b+32>>2]|0)+(r<<2)>>2]=+o[a+228>>2];g=+o[a+192>>2];h=+o[a+196>>2]}e=+o[a+1084>>2];j=+o[a+1116>>2];c=n*+o[b>>2];do if(!(g>h))if(!(g==h)){if(j/c<0.0)if(e>=g?g-j/c>e:0){e=(g-e)/(j/c);break}else{e=e<g?0.0:1.0;break}if(j/c>0.0)if(e<=h?h-j/c<e:0){e=(h-e)/(j/c);break}else{e=e>h?0.0:1.0;break}else e=0.0}else e=0.0;else e=1.0;while(0);o[M+(r<<2)>>2]=e*j;o[(k[b+36>>2]|0)+(r<<2)>>2]=-(+o[a+1120>>2]*+o[b>>2]);o[(k[b+40>>2]|0)+(r<<2)>>2]=+o[a+1120>>2]*+o[b>>2]}if(!p)return;o[M+(r<<2)>>2]=+o[M+(r<<2)>>2]+q*(n*+o[b>>2]);if(L&1024)o[(k[b+32>>2]|0)+(r<<2)>>2]=+o[a+260>>2];do if(!(l==m)){f=(k[b+36>>2]|0)+(r<<2)|0;d=k[b+40>>2]|0;if((s|0)==1){o[f>>2]=0.0;o[d+(r<<2)>>2]=3402823466385288598117041.0e14;break}else{o[f>>2]=-3402823466385288598117041.0e14;o[d+(r<<2)>>2]=0.0;break}}else{o[(k[b+36>>2]|0)+(r<<2)>>2]=-3402823466385288598117041.0e14;o[(k[b+40>>2]|0)+(r<<2)>>2]=3402823466385288598117041.0e14}while(0);T=1.0-+o[a+256>>2];e=+X(+T);do if(!(T!=T|0.0!=0.0|T==0.0)){U=k[a+28>>2]|0;b=k[a+32>>2]|0;c=V*+o[U+328>>2]+W*+o[U+332>>2]+Z*+o[U+336>>2]-(V*+o[b+328>>2]+W*+o[b+332>>2]+Z*+o[b+336>>2]);if((s|0)==1){if(!(c<0.0))break;if(!(+o[M+(r<<2)>>2]<-(e*c)))break;o[M+(r<<2)>>2]=-(e*c);break}else{if(!(c>0.0))break;if(!(+o[M+(r<<2)>>2]>-(e*c)))break;o[M+(r<<2)>>2]=-(e*c);break}}while(0);o[M+(r<<2)>>2]=+o[a+248>>2]*+o[M+(r<<2)>>2];return}function jq(a,b,c,d){a=a|0;b=b|0;c=+c;d=d|0;if((b|0)==3){if((d|0)<1){o[a+212>>2]=c;k[a+300>>2]=k[a+300>>2]|1;return}if((d|0)!=3)return;o[a+228>>2]=c;k[a+300>>2]=k[a+300>>2]|4;return}else if((b|0)==2){if((d|0)<1){o[a+232>>2]=c;k[a+300>>2]=k[a+300>>2]|512;return}if((d|0)<3){o[a+264>>2]=c;k[a+300>>2]=k[a+300>>2]|32;return}if((d|0)==3){o[a+248>>2]=c;k[a+300>>2]=k[a+300>>2]|2048;return}if((d|0)>=6)return;o[a+280>>2]=c;k[a+300>>2]=k[a+300>>2]|128;return}else if((b|0)==4){if((d|0)<1){o[a+244>>2]=c;k[a+300>>2]=k[a+300>>2]|256;return}if((d|0)<3){o[a+276>>2]=c;k[a+300>>2]=k[a+300>>2]|16;return}if((d|0)==3){o[a+260>>2]=c;k[a+300>>2]=k[a+300>>2]|1024;return}if((d|0)>=6)return;o[a+292>>2]=c;k[a+300>>2]=k[a+300>>2]|64;return}else return}function kq(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0;do if((b|0)==4){if((c|0)<1){d=+o[a+244>>2];break}if((c|0)<3){d=+o[a+276>>2];break}if((c|0)==3){d=+o[a+260>>2];break}if((c|0)<6)d=+o[a+292>>2];else d=3402823466385288598117041.0e14}else if((b|0)==2){if((c|0)<1){d=+o[a+232>>2];break}if((c|0)<3){d=+o[a+264>>2];break}if((c|0)==3){d=+o[a+248>>2];break}if((c|0)<6)d=+o[a+280>>2];else d=3402823466385288598117041.0e14}else if((b|0)==3){if((c|0)<1){d=+o[a+212>>2];break}if((c|0)==3)d=+o[a+228>>2];else d=3402823466385288598117041.0e14}else d=3402823466385288598117041.0e14;while(0);return +d}function lq(a,b){a=a|0;b=b|0;var c=0,d=0,e=0.0,f=0,g=0;if(i[a+527>>0]|0){k[b>>2]=0;k[b+4>>2]=0;return}k[b>>2]=3;k[b+4>>2]=3;g=k[a+28>>2]|0;f=k[a+32>>2]|0;mq(a,g+4|0,f+4|0,g+264|0,f+264|0);if(((i[a+526>>0]|0)!=0?(c=k[b>>2]|0,k[b>>2]=c+1,d=k[b+4>>2]|0,k[b+4>>2]=d+-1,e=+o[a+456>>2],+o[a+444>>2]<e):0)?+o[a+448>>2]<e:0){k[b>>2]=c+2;k[b+4>>2]=d+-2}if(!(i[a+525>>0]|0))return;k[b>>2]=(k[b>>2]|0)+1;k[b+4>>2]=(k[b+4>>2]|0)+-1;return}function mq(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0.0,g=0.0,h=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0,O=0.0,P=0.0,Q=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0.0,Z=0.0,aa=0.0,ca=0.0,da=0.0,fa=0.0,ga=0.0,ha=0.0,ia=0.0,ja=0.0,ka=0.0,la=0.0,ma=0;ma=r;r=r+272|0;o[a+504>>2]=0.0;o[a+500>>2]=0.0;i[a+525>>0]=0;i[a+526>>0]=0;if((i[a+552>>0]|0)!=0?(i[a+527>>0]|0)==0:0){da=+o[a+556>>2];T=+o[a+560>>2];fa=+o[a+564>>2];U=+o[a+568>>2];W=da*(2.0/(da*da+T*T+fa*fa+U*U));ka=T*(2.0/(da*da+T*T+fa*fa+U*U));Z=fa*(2.0/(da*da+T*T+fa*fa+U*U));Sw(ma+16|0,b,a+300|0);Sw(ma+160|0,c,a+364|0);C=+o[ma+160>>2];D=+o[ma+160+4>>2];h=+o[ma+160+8>>2];M=(1.0-(T*ka+fa*Z))*C+(da*ka+U*Z)*D+(da*Z-U*ka)*h;O=(da*ka-U*Z)*C+(1.0-(da*W+fa*Z))*D+(T*Z+U*W)*h;P=(da*Z+U*ka)*C+(T*Z-U*W)*D+(1.0-(da*W+T*ka))*h;E=+o[ma+160+16>>2];F=+o[ma+160+20>>2];g=+o[ma+160+24>>2];Q=(1.0-(T*ka+fa*Z))*E+(da*ka+U*Z)*F+(da*Z-U*ka)*g;R=(da*ka-U*Z)*E+(1.0-(da*W+fa*Z))*F+(T*Z+U*W)*g;S=(da*Z+U*ka)*E+(T*Z-U*W)*F+(1.0-(da*W+T*ka))*g;H=+o[ma+160+32>>2];I=+o[ma+160+36>>2];J=+o[ma+160+40>>2];ca=(1.0-(T*ka+fa*Z))*H+(da*ka+U*Z)*I+(da*Z-U*ka)*J;fa=(da*ka-U*Z)*H+(1.0-(da*W+fa*Z))*I+(T*Z+U*W)*J;ka=(da*Z+U*ka)*H+(T*Z-U*W)*I+(1.0-(da*W+T*ka))*J;T=+o[ma+16>>2];W=+o[ma+16+16>>2];da=+o[ma+16+32>>2];U=+o[ma+16+4>>2];Z=+o[ma+16+20>>2];ga=+o[ma+16+36>>2];V=+o[ma+16+8>>2];aa=+o[ma+16+24>>2];la=+o[ma+16+40>>2];K=-+o[ma+16+48>>2];L=-+o[ma+16+52>>2];f=-+o[ma+16+56>>2];h=C*0.0+D*0.0+h*0.0+ +o[ma+160+48>>2]+(P*(V*K+aa*L+la*f)+(M*(T*K+W*L+da*f)+O*(U*K+Z*L+ga*f)));g=E*0.0+F*0.0+g*0.0+ +o[ma+160+52>>2]+(S*(V*K+aa*L+la*f)+(Q*(T*K+W*L+da*f)+R*(U*K+Z*L+ga*f)));f=H*0.0+I*0.0+J*0.0+ +o[ma+160+56>>2]+(ka*(V*K+aa*L+la*f)+(ca*(T*K+W*L+da*f)+fa*(U*K+Z*L+ga*f)));o[ma+80>>2]=M*T+O*U+P*V;o[ma+80+4>>2]=M*W+O*Z+P*aa;o[ma+80+8>>2]=M*da+O*ga+P*la;o[ma+80+12>>2]=0.0;o[ma+80+16>>2]=Q*T+R*U+S*V;o[ma+80+20>>2]=Q*W+R*Z+S*aa;o[ma+80+24>>2]=Q*da+R*ga+S*la;o[ma+80+28>>2]=0.0;o[ma+80+32>>2]=ca*T+fa*U+ka*V;o[ma+80+36>>2]=ca*W+fa*Z+ka*aa;o[ma+80+40>>2]=ca*da+fa*ga+ka*la;o[ma+80+44>>2]=0.0;o[ma+80+48>>2]=h;o[ma+80+52>>2]=g;o[ma+80+56>>2]=f;o[ma+80+60>>2]=0.0;Jw(ma+80|0,ma+224|0);f=+o[ma+224>>2];g=+o[ma+224+4>>2];h=+o[ma+224+8>>2];if(!(+X(+(f*f+g*g+h*h))<1.1920928955078125e-07)?(o[a+472>>2]=0.0,la=1.0/+Y(+(f*f+g*g+h*h)),o[a+460>>2]=f*la,o[a+464>>2]=g*la,o[a+468>>2]=h*la,la=+o[ma+224+12>>2],la=la<-1.0?-1.0:la,la=+ba(+(la>1.0?1.0:la))*2.0,o[a+504>>2]=la,!(+X(+la)<1.1920928955078125e-07)):0)i[a+526>>0]=1;r=ma;return}Jw(b,ma+256|0);Jw(a+300|0,ma);P=+o[ma+256+12>>2];Q=+o[ma>>2];R=+o[ma+256>>2];S=+o[ma+12>>2];T=+o[ma+256+4>>2];U=+o[ma+8>>2];V=+o[ma+256+8>>2];W=+o[ma+4>>2];Jw(c,ma+144|0);Jw(a+364|0,ma+240|0);Z=+o[ma+144+12>>2];aa=+o[ma+240>>2];ca=+o[ma+144>>2];da=+o[ma+240+12>>2];fa=+o[ma+144+4>>2];ga=+o[ma+240+8>>2];ha=+o[ma+144+8>>2];ia=+o[ma+240+4>>2];ja=-(Z*aa+ca*da+fa*ga-ha*ia);ka=-(aa*ha+(da*fa+Z*ia)-ca*ga);la=-(Z*ga+da*ha+ca*ia-aa*fa);s=(P*S-Q*R-T*W-U*V)*ja+(P*Q+R*S+T*U-V*W)*(Z*da-aa*ca-fa*ia-ga*ha)+(P*U+S*V+R*W-Q*T)*ka-(Q*V+(S*T+P*W)-R*U)*la;q=(P*Q+R*S+T*U-V*W)*la+((Q*V+(S*T+P*W)-R*U)*(Z*da-aa*ca-fa*ia-ga*ha)+(P*S-Q*R-T*W-U*V)*ka)-(P*U+S*V+R*W-Q*T)*ja;t=(Q*V+(S*T+P*W)-R*U)*ja+((P*U+S*V+R*W-Q*T)*(Z*da-aa*ca-fa*ia-ga*ha)+(P*S-Q*R-T*W-U*V)*la)-(P*Q+R*S+T*U-V*W)*ka;u=(P*S-Q*R-T*W-U*V)*(Z*da-aa*ca-fa*ia-ga*ha)-(P*Q+R*S+T*U-V*W)*ja-(Q*V+(S*T+P*W)-R*U)*ka-(P*U+S*V+R*W-Q*T)*la;n=-s-q*0.0-t*0.0;m=(t+u*0.0-s*0.0)*-t+(u*(u+q*0.0-t*0.0)+n*-s)-(u*0.0+s*0.0-q)*-q;l=(u*0.0+s*0.0-q)*-s+(u*(t+u*0.0-s*0.0)+n*-q)-(u+q*0.0-t*0.0)*-t;n=(u+q*0.0-t*0.0)*-q+(u*(u*0.0+s*0.0-q)+n*-t)-(t+u*0.0-s*0.0)*-s;j=1.0/+Y(+(n*n+(m*m+l*l)));if(j*n*0.0+(j*l*0.0+j*m)<-.9999998807907104)if(+X(0.0)>.7071067690849304){p=0.0;h=B;n=B;m=0.0}else{p=-0.0;h=1.0;n=0.0;m=0.0}else{O=+Y(+((j*n*0.0+(j*l*0.0+j*m)+1.0)*2.0));p=(j*n*0.0-j*l*0.0)*(1.0/O);h=(j*m*0.0-j*n)*(1.0/O);n=(j*l-j*m*0.0)*(1.0/O);m=O*.5}O=1.0/+Y(+(m*m+(n*n+(h*h+p*p))));w=p*O;l=h*O;v=n*O;p=m*O;O=1.0/+Y(+((u*p-s*-w-q*-l-t*-v)*(u*p-s*-w-q*-l-t*-v)+((q*-w+(t*p+u*-v)-s*-l)*(q*-w+(t*p+u*-v)-s*-l)+((t*-l+(s*p+u*-w)-q*-v)*(t*-l+(s*p+u*-w)-q*-v)+(s*-v+(u*-l+q*p)-t*-w)*(s*-v+(u*-l+q*p)-t*-w)))));g=O*(t*-l+(s*p+u*-w)-q*-v);f=O*(s*-v+(u*-l+q*p)-t*-w);j=O*(q*-w+(t*p+u*-v)-s*-l);O=O*(u*p-s*-w-q*-l-t*-v);u=+o[a+444>>2];n=+o[a+456>>2];if(u>=n?(x=+o[a+448>>2],x>=n):0){s=p<-1.0?-1.0:p;s=+ba(+(s>1.0?1.0:s))*2.0;if(s>1.1920928955078125e-07){n=1.0/+Y(+(v*v+(w*w+l*l)));if(+X(+(l*n))>1.1920928955078125e-07){q=+Y(+((v*n*(v*n)/(l*n*(l*n))+1.0)/(1.0/(x*x)+v*n*(v*n)/(l*n*(l*n))/(u*u))));h=l*n;m=v*n;n=w*n}else{q=u;h=l*n;m=v*n;n=w*n}}else{q=0.0;h=0.0;m=0.0;n=0.0}l=+o[a+428>>2];p=q*l;if(s>p){i[a+526>>0]=1;if(s<q&l<.9999998807907104)l=(s-p)/(q-p);else l=1.0;o[a+528>>2]=l;o[a+504>>2]=s-p;if(+X(+h)>1.1920928955078125e-07){l=+X(+(h*(-m/h*(x/u))));if(!(m<-0.0))l=-l;m=1.0/+Y(+(h*h+n*n+l*l));n=n*m;h=h*m;m=-(l*m)}L=-n;K=-h;J=-m;H=(aa*ha+(da*fa+Z*ia)-ca*ga)*J+(Z*da-aa*ca-fa*ia-ga*ha)*L-(Z*ga+da*ha+ca*ia-aa*fa)*K;M=(Z*da-aa*ca-fa*ia-ga*ha)*K+(Z*ga+da*ha+ca*ia-aa*fa)*L-(Z*aa+ca*da+fa*ga-ha*ia)*J;I=(Z*da-aa*ca-fa*ia-ga*ha)*J+(Z*aa+ca*da+fa*ga-ha*ia)*K-(aa*ha+(da*fa+Z*ia)-ca*ga)*L;J=-((Z*aa+ca*da+fa*ga-ha*ia)*L)-(aa*ha+(da*fa+Z*ia)-ca*ga)*K-(Z*ga+da*ha+ca*ia-aa*fa)*J;K=M*la+((Z*da-aa*ca-fa*ia-ga*ha)*H+J*ja)-I*ka;L=I*ja+((Z*da-aa*ca-fa*ia-ga*ha)*M+J*ka)-H*la;M=H*ka+((Z*da-aa*ca-fa*ia-ga*ha)*I+J*la)-M*ja;o[a+460>>2]=K;o[a+464>>2]=L;o[a+468>>2]=M;o[a+472>>2]=0.0;k[a+536>>2]=0;k[a+536+4>>2]=0;k[a+536+8>>2]=0;k[a+536+12>>2]=0;o[a+492>>2]=1.0/(K*(+o[d>>2]*K+ +o[d+16>>2]*L+ +o[d+32>>2]*M)+L*(K*+o[d+4>>2]+L*+o[d+20>>2]+M*+o[d+36>>2])+M*(K*+o[d+8>>2]+L*+o[d+24>>2]+M*+o[d+40>>2])+(K*(K*+o[e>>2]+L*+o[e+16>>2]+M*+o[e+32>>2])+L*(K*+o[e+4>>2]+L*+o[e+20>>2]+M*+o[e+36>>2])+M*(K*+o[e+8>>2]+L*+o[e+24>>2]+M*+o[e+40>>2])))}}else N=24;a:do if((N|0)==24){C=+o[a+300>>2];D=+o[a+316>>2];E=+o[a+332>>2];F=+o[b>>2];G=+o[b+4>>2];H=+o[b+8>>2];I=+o[b+16>>2];J=+o[b+20>>2];K=+o[b+24>>2];L=+o[b+32>>2];M=+o[b+36>>2];q=+o[b+40>>2];p=+o[a+304>>2];n=+o[a+320>>2];m=+o[a+336>>2];l=+o[a+308>>2];h=+o[a+324>>2];y=+o[a+340>>2];v=+o[a+364>>2];s=+o[a+380>>2];x=+o[a+396>>2];z=v*+o[c>>2]+s*+o[c+4>>2]+x*+o[c+8>>2];A=v*+o[c+16>>2]+s*+o[c+20>>2]+x*+o[c+24>>2];x=v*+o[c+32>>2]+s*+o[c+36>>2]+x*+o[c+40>>2];s=(C*F+D*G+E*H)*z+(C*I+D*J+E*K)*A+(C*L+D*M+E*q)*x;v=(F*p+G*n+H*m)*z+(I*p+J*n+K*m)*A+(L*p+M*n+q*m)*x;w=(F*l+G*h+H*y)*z+(I*l+J*h+K*y)*A+(L*l+M*h+q*y)*x;t=+o[a+444>>2];u=+o[a+456>>2];do if(t<u){t=+o[a+448>>2];if(t<u){if(+X(+v)<1.1920928955078125e-07?+X(+w)<1.1920928955078125e-07:0)break a;i[a+526>>0]=1;o[a+460>>2]=-((C*L+D*M+E*q)*A-(C*I+D*J+E*K)*x);o[a+464>>2]=-((C*F+D*G+E*H)*x-(C*L+D*M+E*q)*z);o[a+468>>2]=-((C*I+D*J+E*K)*z-(C*F+D*G+E*H)*A);o[a+472>>2]=0.0;break a}if(+X(+s)<1.1920928955078125e-07?+X(+w)<1.1920928955078125e-07:0){u=s;break}i[a+526>>0]=1;if(t>=u){v=+ea(+w,+s);if(v>t){u=+_(+t);v=0.0;w=+$(+t);break}if(v<-t){u=+_(+t);v=0.0;w=-+$(+t)}else{u=s;v=0.0}}else u=s}else{if(+X(+s)<1.1920928955078125e-07?+X(+v)<1.1920928955078125e-07:0){u=s;break}i[a+526>>0]=1;if(t>=u){w=+ea(+v,+s);if(w>t){u=+_(+t);v=+$(+t);w=0.0;break}if(w<-t){u=+_(+t);v=-+$(+t);w=0.0}else{u=s;w=0.0}}else u=s}while(0);H=(F*l+G*h+H*y)*w+((F*p+G*n+H*m)*v+(C*F+D*G+E*H)*u);K=(I*l+J*h+K*y)*w+((I*p+J*n+K*m)*v+(C*I+D*J+E*K)*u);J=(L*l+M*h+q*y)*w+((L*p+M*n+q*m)*v+(C*L+D*M+E*q)*u);L=1.0/+Y(+(J*J+(H*H+K*K)));o[a+472>>2]=0.0;M=+Y(+((A*(L*J)-x*(L*K))*(A*(L*J)-x*(L*K))+(x*(L*H)-z*(L*J))*(x*(L*H)-z*(L*J))+(z*(L*K)-A*(L*H))*(z*(L*K)-A*(L*H))));o[a+504>>2]=M;o[a+460>>2]=-((A*(L*J)-x*(L*K))*(1.0/M));o[a+464>>2]=-((x*(L*H)-z*(L*J))*(1.0/M));o[a+468>>2]=-((z*(L*K)-A*(L*H))*(1.0/M))}while(0);p=+o[a+452>>2];if(!(p>=0.0)){o[a+512>>2]=0.0;r=ma;return}h=O<-1.0?-1.0:O;h=+ba(+(h>1.0?1.0:h))*2.0;if(h>3.1415927410125732){h=O>1.0?-1.0:-O;h=+ba(+(h>1.0?1.0:h))*2.0;g=-g;f=-f;j=-j}o[a+512>>2]=h;if(h>1.1920928955078125e-07){O=1.0/+Y(+(j*j+(f*f+g*g)));g=g*O;f=f*O;j=j*O}l=+o[a+428>>2];if(h>p*l){i[a+525>>0]=1;m=h-p*l;if(h<p&l<.9999998807907104)h=m/(p-p*l);else h=1.0;o[a+532>>2]=h;o[a+508>>2]=m;O=-g;M=-f;K=-j;I=(aa*ha+(da*fa+Z*ia)-ca*ga)*K+(Z*da-aa*ca-fa*ia-ga*ha)*O-(Z*ga+da*ha+ca*ia-aa*fa)*M;L=(Z*da-aa*ca-fa*ia-ga*ha)*M+(Z*ga+da*ha+ca*ia-aa*fa)*O-(Z*aa+ca*da+fa*ga-ha*ia)*K;J=(Z*da-aa*ca-fa*ia-ga*ha)*K+(Z*aa+ca*da+fa*ga-ha*ia)*M-(aa*ha+(da*fa+Z*ia)-ca*ga)*O;K=-((Z*aa+ca*da+fa*ga-ha*ia)*O)-(aa*ha+(da*fa+Z*ia)-ca*ga)*M-(Z*ga+da*ha+ca*ia-aa*fa)*K;M=L*la+((Z*da-aa*ca-fa*ia-ga*ha)*I+K*ja)-J*ka;O=J*ja+((Z*da-aa*ca-fa*ia-ga*ha)*L+K*ka)-I*la;la=I*ka+((Z*da-aa*ca-fa*ia-ga*ha)*J+K*la)-L*ja;o[a+476>>2]=M;o[a+480>>2]=O;o[a+484>>2]=la;o[a+488>>2]=0.0;o[a+496>>2]=1.0/(M*(+o[d>>2]*M+ +o[d+16>>2]*O+ +o[d+32>>2]*la)+O*(M*+o[d+4>>2]+O*+o[d+20>>2]+la*+o[d+36>>2])+la*(M*+o[d+8>>2]+O*+o[d+24>>2]+la*+o[d+40>>2])+(M*(M*+o[e>>2]+O*+o[e+16>>2]+la*+o[e+32>>2])+O*(M*+o[e+4>>2]+O*+o[e+20>>2]+la*+o[e+36>>2])+la*(M*+o[e+8>>2]+O*+o[e+24>>2]+la*+o[e+40>>2])))}if(!(i[a+526>>0]|0)){r=ma;return}ca=-g;la=-f;fa=-j;aa=(Q*V+(S*T+P*W)-R*U)*fa+(P*S-Q*R-T*W-U*V)*ca-(P*U+S*V+R*W-Q*T)*la;ka=(P*S-Q*R-T*W-U*V)*la+(P*U+S*V+R*W-Q*T)*ca-(P*Q+R*S+T*U-V*W)*fa;da=(P*S-Q*R-T*W-U*V)*fa+(P*Q+R*S+T*U-V*W)*la-(Q*V+(S*T+P*W)-R*U)*ca;fa=-((P*Q+R*S+T*U-V*W)*ca)-(Q*V+(S*T+P*W)-R*U)*la-(P*U+S*V+R*W-Q*T)*fa;la=-(P*Q+R*S+T*U-V*W);ca=-(Q*V+(S*T+P*W)-R*U);ga=-(P*U+S*V+R*W-Q*T);o[a+536>>2]=ka*ga+((P*S-Q*R-T*W-U*V)*aa+fa*la)-da*ca;o[a+540>>2]=da*la+((P*S-Q*R-T*W-U*V)*ka+fa*ca)-aa*ga;o[a+544>>2]=aa*ca+((P*S-Q*R-T*W-U*V)*da+fa*ga)-ka*la;o[a+548>>2]=0.0;r=ma;return}function nq(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0.0,h=0.0,j=0.0,l=0.0,m=0.0,n=0,p=0,q=0,s=0,t=0,u=0.0,v=0.0,w=0.0,x=0;t=r;r=r+64|0;n=k[a+28>>2]|0;e=k[a+32>>2]|0;mq(a,n+4|0,e+4|0,n+264|0,e+264|0);s=k[b+8>>2]|0;o[s>>2]=1.0;p=k[b+24>>2]|0;o[s+(p+1<<2)>>2]=1.0;o[s+((p<<1)+2<<2)>>2]=1.0;j=+o[a+348>>2];w=+o[a+352>>2];m=+o[a+356>>2];u=+o[n+4>>2]*j+ +o[n+8>>2]*w+ +o[n+12>>2]*m;l=j*+o[n+20>>2]+w*+o[n+24>>2]+m*+o[n+28>>2];m=j*+o[n+36>>2]+w*+o[n+40>>2]+m*+o[n+44>>2];s=k[b+12>>2]|0;o[s>>2]=0.0;o[s+4>>2]=m;o[s+8>>2]=-l;o[s+12>>2]=0.0;o[s+(p<<2)>>2]=-m;o[s+(p+1<<2)>>2]=0.0;o[s+(p+2<<2)>>2]=u;o[s+(p+3<<2)>>2]=0.0;o[s+(p<<1<<2)>>2]=l;o[s+((p<<1|1)<<2)>>2]=-u;o[s+((p<<1)+2<<2)>>2]=0.0;o[s+((p<<1)+3<<2)>>2]=0.0;s=k[b+16>>2]|0;o[s>>2]=-1.0;o[s+(p+1<<2)>>2]=-1.0;o[s+((p<<1)+2<<2)>>2]=-1.0;w=+o[a+412>>2];j=+o[a+416>>2];h=+o[a+420>>2];v=+o[e+4>>2]*w+ +o[e+8>>2]*j+ +o[e+12>>2]*h;g=w*+o[e+20>>2]+j*+o[e+24>>2]+h*+o[e+28>>2];h=w*+o[e+36>>2]+j*+o[e+40>>2]+h*+o[e+44>>2];p=k[b+20>>2]|0;s=k[b+24>>2]|0;o[p>>2]=0.0;o[p+4>>2]=-h;o[p+8>>2]=g;o[p+12>>2]=0.0;o[p+(s<<2)>>2]=h;o[p+(s+1<<2)>>2]=0.0;o[p+(s+2<<2)>>2]=-v;o[p+(s+3<<2)>>2]=0.0;o[p+(s<<1<<2)>>2]=-g;o[p+((s<<1|1)<<2)>>2]=v;o[p+((s<<1)+2<<2)>>2]=0.0;o[p+((s<<1)+3<<2)>>2]=0.0;q=k[a+592>>2]|0;j=+o[((q&2|0)==0?b+4|0:a+600|0)>>2]*+o[b>>2];f=k[b+28>>2]|0;c=k[b+36>>2]|0;d=k[b+40>>2]|0;o[f>>2]=j*(v+ +o[e+52>>2]-u-+o[n+52>>2]);o[c>>2]=-3402823466385288598117041.0e14;o[d>>2]=3402823466385288598117041.0e14;if(!(q&1)){o[f+(s<<2)>>2]=j*(g+ +o[e+56>>2]-l-+o[n+56>>2]);o[c+(s<<2)>>2]=-3402823466385288598117041.0e14;o[d+(s<<2)>>2]=3402823466385288598117041.0e14;o[f+(s<<1<<2)>>2]=j*(h+ +o[e+60>>2]-m-+o[n+60>>2]);o[c+(s<<1<<2)>>2]=-3402823466385288598117041.0e14;o[d+(s<<1<<2)>>2]=3402823466385288598117041.0e14}else{x=k[b+32>>2]|0;o[x>>2]=+o[a+596>>2];o[f+(s<<2)>>2]=j*(g+ +o[e+56>>2]-l-+o[n+56>>2]);o[c+(s<<2)>>2]=-3402823466385288598117041.0e14;o[d+(s<<2)>>2]=3402823466385288598117041.0e14;o[x+(s<<2)>>2]=+o[a+596>>2];o[f+(s<<1<<2)>>2]=j*(h+ +o[e+60>>2]-m-+o[n+60>>2]);o[c+(s<<1<<2)>>2]=-3402823466385288598117041.0e14;o[d+(s<<1<<2)>>2]=3402823466385288598117041.0e14;o[x+(s<<1<<2)>>2]=+o[a+596>>2]}do if(!(i[a+526>>0]|0))e=s*3|0;else{e=k[b+12>>2]|0;m=+o[a+456>>2];if(+o[a+444>>2]<m?+o[a+448>>2]<m:0){Sw(t,n+4|0,a+300|0);h=+o[t+4>>2];u=+o[t+20>>2];j=+o[t+36>>2];l=+o[t+8>>2];w=+o[t+24>>2];m=+o[t+40>>2];n=k[b+24>>2]|0;x=n+(s*3|0)|0;o[e+(s*3<<2)>>2]=h;o[e+((s*3|0)+1<<2)>>2]=u;o[e+((s*3|0)+2<<2)>>2]=j;o[e+(x<<2)>>2]=l;o[e+(x+1<<2)>>2]=w;o[e+(x+2<<2)>>2]=m;o[p+(s*3<<2)>>2]=-h;o[p+((s*3|0)+1<<2)>>2]=-u;o[p+((s*3|0)+2<<2)>>2]=-j;o[p+(x<<2)>>2]=-l;o[p+(x+1<<2)>>2]=-w;o[p+(x+2<<2)>>2]=-m;v=+o[b>>2]*+o[a+436>>2];f=k[b+28>>2]|0;o[f+(s*3<<2)>>2]=v*(h*+o[a+460>>2]+u*+o[a+464>>2]+j*+o[a+468>>2]);o[f+(x<<2)>>2]=v*(l*+o[a+460>>2]+w*+o[a+464>>2]+m*+o[a+468>>2]);c=k[b+36>>2]|0;o[c+(s*3<<2)>>2]=-3402823466385288598117041.0e14;d=k[b+40>>2]|0;o[d+(s*3<<2)>>2]=3402823466385288598117041.0e14;o[c+(x<<2)>>2]=-3402823466385288598117041.0e14;o[d+(x<<2)>>2]=3402823466385288598117041.0e14;e=n+x|0;break}m=+o[a+436>>2];l=m*(+o[a+460>>2]*m);w=m*(m*+o[a+464>>2]);m=m*(m*+o[a+468>>2]);o[e+(s*3<<2)>>2]=l;o[e+((s*3|0)+1<<2)>>2]=w;o[e+((s*3|0)+2<<2)>>2]=m;o[p+(s*3<<2)>>2]=-l;o[p+((s*3|0)+1<<2)>>2]=-w;o[p+((s*3|0)+2<<2)>>2]=-m;o[f+(s*3<<2)>>2]=+o[b>>2]*+o[a+432>>2]*+o[a+504>>2];if(q&4)o[(k[b+32>>2]|0)+(s*3<<2)>>2]=+o[a+604>>2];o[c+(s*3<<2)>>2]=0.0;o[d+(s*3<<2)>>2]=3402823466385288598117041.0e14;e=s<<2}while(0);if(!(i[a+525>>0]|0)){r=t;return}m=+o[a+436>>2];l=m*(+o[a+476>>2]*m);w=m*(m*+o[a+480>>2]);m=m*(m*+o[a+484>>2]);s=k[b+12>>2]|0;p=k[b+20>>2]|0;o[s+(e<<2)>>2]=l;n=e+1|0;o[s+(n<<2)>>2]=w;x=e+2|0;o[s+(x<<2)>>2]=m;o[p+(e<<2)>>2]=-l;o[p+(n<<2)>>2]=-w;o[p+(x<<2)>>2]=-m;o[f+(e<<2)>>2]=+o[b>>2]*+o[a+432>>2]*+o[a+508>>2];if(k[a+592>>2]&4)o[(k[b+32>>2]|0)+(e<<2)>>2]=+o[a+604>>2];if(!(+o[a+452>>2]>0.0)){o[c+(e<<2)>>2]=-3402823466385288598117041.0e14;o[d+(e<<2)>>2]=3402823466385288598117041.0e14;r=t;return}d=c+(e<<2)|0;c=k[b+40>>2]|0;if(+o[a+508>>2]>0.0){o[d>>2]=0.0;o[c+(e<<2)>>2]=3402823466385288598117041.0e14;r=t;return}else{o[d>>2]=-3402823466385288598117041.0e14;o[c+(e<<2)>>2]=0.0;r=t;return}}function oq(a){a=a|0;var b=0,c=0.0,d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,j=0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0,M=0;L=r;r=r+176|0;if(!(i[a+527>>0]|0)){r=L;return}o[a+36>>2]=0.0;o[a+520>>2]=0.0;o[a+516>>2]=0.0;k[a+576>>2]=0;k[a+576+4>>2]=0;k[a+576+8>>2]=0;k[a+576+12>>2]=0;if(!(i[a+524>>0]|0)){b=k[a+28>>2]|0;e=+o[a+348>>2];c=+o[a+352>>2];v=+o[a+356>>2];w=e*+o[b+20>>2]+c*+o[b+24>>2]+v*+o[b+28>>2]+ +o[b+56>>2];j=k[a+32>>2]|0;x=+o[a+412>>2];y=+o[j+4>>2];z=+o[a+416>>2];A=+o[j+8>>2];B=+o[a+420>>2];C=+o[j+12>>2];D=+o[j+20>>2];E=+o[j+24>>2];F=+o[j+28>>2];G=+o[j+36>>2];H=+o[j+40>>2];I=+o[j+44>>2];J=+o[j+52>>2];K=+o[j+56>>2];t=+o[j+60>>2];d=x*D+z*E+B*F+K-w;u=e*+o[b+4>>2]+c*+o[b+8>>2]+v*+o[b+12>>2]+ +o[b+52>>2];v=e*+o[b+36>>2]+c*+o[b+40>>2]+v*+o[b+44>>2]+ +o[b+60>>2];c=x*y+z*A+B*C+J-u;e=x*G+z*H+B*I+t-v;if(c*c+d*d+e*e>1.1920928955078125e-07){s=1.0/+Y(+(c*c+d*d+e*e));f=c*s;d=d*s;e=e*s}else{f=1.0;d=0.0;e=0.0}o[L+128>>2]=f;o[L+128+4>>2]=d;o[L+128+8>>2]=e;o[L+128+12>>2]=0.0;if(+X(+e)>.7071067690849304){p=e*e+d*d;s=1.0/+Y(+p);c=-(s*e);d=s*d;h=-(f*d);g=f*c;e=p*s;f=0.0}else{p=f*f+d*d;g=1.0/+Y(+p);s=-(d*g);c=g*f;h=e*s;g=p*g;e=-(e*c);d=0.0;f=s}o[L+128+16>>2]=f;o[L+128+20>>2]=c;o[L+128+24>>2]=d;o[L+128+32>>2]=e;o[L+128+36>>2]=h;o[L+128+40>>2]=g;h=y;g=D;f=G;e=A;d=E;c=H;l=C;m=F;n=I;p=J;q=K;s=t;b=0;while(1){M=k[a+28>>2]|0;o[L+80>>2]=+o[M+4>>2];o[L+80+4>>2]=+o[M+20>>2];o[L+80+8>>2]=+o[M+36>>2];o[L+80+12>>2]=0.0;o[L+80+16>>2]=+o[M+8>>2];o[L+80+20>>2]=+o[M+24>>2];o[L+80+24>>2]=+o[M+40>>2];o[L+80+28>>2]=0.0;o[L+80+32>>2]=+o[M+12>>2];o[L+80+36>>2]=+o[M+28>>2];o[L+80+40>>2]=+o[M+44>>2];o[L+80+44>>2]=0.0;o[L+32>>2]=h;o[L+32+4>>2]=g;o[L+32+8>>2]=f;o[L+32+12>>2]=0.0;o[L+32+16>>2]=e;o[L+32+20>>2]=d;o[L+32+24>>2]=c;o[L+32+28>>2]=0.0;o[L+32+32>>2]=l;o[L+32+36>>2]=m;o[L+32+40>>2]=n;o[L+32+44>>2]=0.0;m=w-+o[M+56>>2];n=v-+o[M+60>>2];o[L+16>>2]=u-+o[M+52>>2];o[L+16+4>>2]=m;o[L+16+8>>2]=n;o[L+16+12>>2]=0.0;o[L>>2]=x*y+z*A+B*C+J-p;o[L+4>>2]=x*D+z*E+B*F+K-q;o[L+8>>2]=x*G+z*H+B*I+t-s;o[L+12>>2]=0.0;Vw(a+48+(b*84|0)|0,L+80|0,L+32|0,L+16|0,L,L+128+(b<<4)|0,M+396|0,+o[M+344>>2],j+396|0,+o[j+344>>2]);b=b+1|0;if((b|0)==3)break;j=k[a+32>>2]|0;h=+o[j+4>>2];g=+o[j+20>>2];f=+o[j+36>>2];e=+o[j+8>>2];d=+o[j+24>>2];c=+o[j+40>>2];l=+o[j+12>>2];m=+o[j+28>>2];n=+o[j+44>>2];p=+o[j+52>>2];q=+o[j+56>>2];s=+o[j+60>>2]}b=a+32|0}else b=a+32|0;j=k[a+28>>2]|0;M=k[b>>2]|0;mq(a,j+4|0,M+4|0,j+264|0,M+264|0);r=L;return}function pq(a,b,c,d){a=a|0;b=b|0;c=c|0;d=+d;var e=0,f=0.0,g=0.0,h=0.0,j=0.0,l=0,m=0.0,n=0.0,p=0.0,q=0,s=0,t=0,u=0.0,v=0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0.0,Q=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0.0,X=0.0,Z=0.0,_=0.0,$=0.0,aa=0.0;O=r;r=r+448|0;if(!(i[a+527>>0]|0)){r=O;return}N=k[a+28>>2]|0;C=+o[a+348>>2];z=+o[a+352>>2];D=+o[a+356>>2];h=+o[N+52>>2];g=C*+o[N+4>>2]+z*+o[N+8>>2]+D*+o[N+12>>2]+h;m=+o[N+56>>2];u=C*+o[N+20>>2]+z*+o[N+24>>2]+D*+o[N+28>>2]+m;f=+o[N+60>>2];D=C*+o[N+36>>2]+z*+o[N+40>>2]+D*+o[N+44>>2]+f;N=k[a+32>>2]|0;z=+o[a+412>>2];C=+o[a+416>>2];A=+o[a+420>>2];E=+o[N+52>>2];F=z*+o[N+4>>2]+C*+o[N+8>>2]+A*+o[N+12>>2]+E;G=+o[N+56>>2];H=z*+o[N+20>>2]+C*+o[N+24>>2]+A*+o[N+28>>2]+G;B=+o[N+60>>2];A=z*+o[N+36>>2]+C*+o[N+40>>2]+A*+o[N+44>>2]+B;if(!(i[a+524>>0]|0)){x=+o[b+192>>2]+ +o[b+80>>2];n=+o[b+196>>2]+ +o[b+84>>2];j=+o[b+200>>2]+ +o[b+88>>2];C=+o[c+192>>2]+ +o[c+80>>2];p=+o[c+196>>2]+ +o[c+84>>2];y=+o[c+200>>2]+ +o[c+88>>2];z=+o[b+176>>2]+ +o[b+64>>2]+((D-f)*n-(u-m)*j)-(+o[c+176>>2]+ +o[c+64>>2]+((A-B)*p-(H-G)*y));y=+o[b+180>>2]+ +o[b+68>>2]+((g-h)*j-(D-f)*x)-(+o[c+180>>2]+ +o[c+68>>2]+((F-E)*y-(A-B)*C));p=+o[b+184>>2]+ +o[b+72>>2]+((u-m)*x-(g-h)*n)-(+o[c+184>>2]+ +o[c+72>>2]+((H-G)*C-(F-E)*p));e=(k[b+240>>2]|0)==0;l=0;do{w=1.0/+o[a+48+(l*84|0)+80>>2];t=a+48+(l*84|0)|0;j=+o[t>>2];q=a+48+(l*84|0)+4|0;x=+o[q>>2];s=a+48+(l*84|0)+8|0;n=+o[s>>2];n=w*(((g-F)*j+(u-H)*x+(D-A)*n)*-.30000001192092896/d)-w*(z*j+y*x+p*n);o[a+36>>2]=+o[a+36>>2]+n;x=+o[s>>2];j=+o[q>>2];w=+o[t>>2];v=k[a+28>>2]|0;C=+o[v+344>>2];if(!e){R=((u-m)*x-(D-f)*j)*+o[v+296>>2]+((D-f)*w-(g-h)*x)*+o[v+300>>2]+((g-h)*j-(u-m)*w)*+o[v+304>>2];P=((u-m)*x-(D-f)*j)*+o[v+280>>2]+((D-f)*w-(g-h)*x)*+o[v+284>>2]+((g-h)*j-(u-m)*w)*+o[v+288>>2];Q=((u-m)*x-(D-f)*j)*+o[v+264>>2]+((D-f)*w-(g-h)*x)*+o[v+268>>2]+((g-h)*j-(u-m)*w)*+o[v+272>>2];T=n*(j*C)*+o[b+116>>2];S=n*(x*C)*+o[b+120>>2];o[b+64>>2]=n*(w*C)*+o[b+112>>2]+ +o[b+64>>2];o[b+68>>2]=T+ +o[b+68>>2];o[b+72>>2]=S+ +o[b+72>>2];P=P*(n*+o[b+100>>2]);C=R*(n*+o[b+104>>2]);o[b+80>>2]=Q*(n*+o[b+96>>2])+ +o[b+80>>2];o[b+84>>2]=P+ +o[b+84>>2];o[b+88>>2]=C+ +o[b+88>>2]}v=k[a+32>>2]|0;C=+o[v+344>>2];if(k[c+240>>2]|0){T=((H-G)*x-(A-B)*j)*+o[v+296>>2]+((A-B)*w-(F-E)*x)*+o[v+300>>2]+((F-E)*j-(H-G)*w)*+o[v+304>>2];S=((H-G)*x-(A-B)*j)*+o[v+280>>2]+((A-B)*w-(F-E)*x)*+o[v+284>>2]+((F-E)*j-(H-G)*w)*+o[v+288>>2];R=((H-G)*x-(A-B)*j)*+o[v+264>>2]+((A-B)*w-(F-E)*x)*+o[v+268>>2]+((F-E)*j-(H-G)*w)*+o[v+272>>2];x=C*+o[q>>2]*-n*+o[c+116>>2];Q=C*+o[s>>2]*-n*+o[c+120>>2];o[c+64>>2]=+o[c+112>>2]*(C*+o[t>>2]*-n)+ +o[c+64>>2];o[c+68>>2]=x+ +o[c+68>>2];o[c+72>>2]=Q+ +o[c+72>>2];S=S*(+o[c+100>>2]*-n);T=T*(+o[c+104>>2]*-n);o[c+80>>2]=R*(+o[c+96>>2]*-n)+ +o[c+80>>2];o[c+84>>2]=S+ +o[c+84>>2];o[c+88>>2]=T+ +o[c+88>>2]}l=l+1|0}while((l|0)!=3)}do if(!(i[a+552>>0]|0)){p=+o[a+440>>2];if(!(p>1.1920928955078125e-07)){I=b+80|0;l=b+196|0;J=b+84|0;q=b+200|0;K=b+88|0;s=c+192|0;L=c+80|0;t=c+196|0;M=c+84|0;v=c+200|0;N=c+88|0;e=b+192|0;break}n=+o[c+192>>2]+ +o[c+80>>2]-(+o[b+192>>2]+ +o[b+80>>2]);j=+o[c+196>>2]+ +o[c+84>>2]-(+o[b+196>>2]+ +o[b+84>>2]);h=+o[c+200>>2]+ +o[c+88>>2]-(+o[b+200>>2]+ +o[b+88>>2]);if(n*n+j*j+h*h>1.1920928955078125e-07){C=1.0/+Y(+(n*n+j*j+h*h));e=k[a+28>>2]|0;w=+o[e+264>>2];m=+o[e+280>>2];u=+o[e+296>>2];f=+o[e+268>>2];x=+o[e+284>>2];y=+o[e+300>>2];z=+o[e+272>>2];A=+o[e+288>>2];B=+o[e+304>>2];e=k[a+32>>2]|0;p=p*(1.0/(n*C*(n*C*w+j*C*m+h*C*u)+j*C*(n*C*f+j*C*x+h*C*y)+h*C*(n*C*z+j*C*A+h*C*B)+(n*C*(n*C*+o[e+264>>2]+j*C*+o[e+280>>2]+h*C*+o[e+296>>2])+j*C*(n*C*+o[e+268>>2]+j*C*+o[e+284>>2]+h*C*+o[e+300>>2])+h*C*(n*C*+o[e+272>>2]+j*C*+o[e+288>>2]+h*C*+o[e+304>>2]))));C=+Y(+(h*p*(h*p)+(n*p*(n*p)+j*p*(j*p))));g=1.0/C*(n*p);n=1.0/C*(j*p);p=1.0/C*(h*p);if(k[b+240>>2]|0){T=C*0.0*+o[b+116>>2];S=C*0.0*+o[b+120>>2];o[b+64>>2]=C*0.0*+o[b+112>>2]+ +o[b+64>>2];o[b+68>>2]=T+ +o[b+68>>2];o[b+72>>2]=S+ +o[b+72>>2];S=(g*m+n*x+p*A)*(C*+o[b+100>>2]);T=(g*u+n*y+p*B)*(C*+o[b+104>>2]);o[b+80>>2]=(g*w+n*f+p*z)*(C*+o[b+96>>2])+ +o[b+80>>2];o[b+84>>2]=S+ +o[b+84>>2];o[b+88>>2]=T+ +o[b+88>>2];e=k[a+32>>2]|0}if(k[c+240>>2]|0){T=g*+o[e+296>>2]+n*+o[e+300>>2]+p*+o[e+304>>2];S=g*+o[e+280>>2]+n*+o[e+284>>2]+p*+o[e+288>>2];R=g*+o[e+264>>2]+n*+o[e+268>>2]+p*+o[e+272>>2];E=C*-0.0*+o[c+116>>2];F=C*-0.0*+o[c+120>>2];o[c+64>>2]=C*-0.0*+o[c+112>>2]+ +o[c+64>>2];o[c+68>>2]=E+ +o[c+68>>2];o[c+72>>2]=F+ +o[c+72>>2];S=S*(+o[c+100>>2]*-C);T=T*(+o[c+104>>2]*-C);o[c+80>>2]=R*(+o[c+96>>2]*-C)+ +o[c+80>>2];o[c+84>>2]=S+ +o[c+84>>2];o[c+88>>2]=T+ +o[c+88>>2];I=b+80|0;l=b+196|0;J=b+84|0;q=b+200|0;K=b+88|0;s=c+192|0;L=c+80|0;t=c+196|0;M=c+84|0;v=c+200|0;N=c+88|0;e=b+192|0}else{I=b+80|0;l=b+196|0;J=b+84|0;q=b+200|0;K=b+88|0;s=c+192|0;L=c+80|0;t=c+196|0;M=c+84|0;v=c+200|0;N=c+88|0;e=b+192|0}}else{I=b+80|0;l=b+196|0;J=b+84|0;q=b+200|0;K=b+88|0;s=c+192|0;L=c+80|0;t=c+196|0;M=c+84|0;v=c+200|0;N=c+88|0;e=b+192|0}}else{M=k[a+28>>2]|0;k[O+344>>2]=k[M+4>>2];k[O+344+4>>2]=k[M+4+4>>2];k[O+344+8>>2]=k[M+4+8>>2];k[O+344+12>>2]=k[M+4+12>>2];k[O+344+16>>2]=k[M+20>>2];k[O+344+16+4>>2]=k[M+20+4>>2];k[O+344+16+8>>2]=k[M+20+8>>2];k[O+344+16+12>>2]=k[M+20+12>>2];k[O+344+32>>2]=k[M+36>>2];k[O+344+32+4>>2]=k[M+36+4>>2];k[O+344+32+8>>2]=k[M+36+8>>2];k[O+344+32+12>>2]=k[M+36+12>>2];k[O+344+48>>2]=k[M+52>>2];k[O+344+48+4>>2]=k[M+52+4>>2];k[O+344+48+8>>2]=k[M+52+8>>2];k[O+344+48+12>>2]=k[M+52+12>>2];M=k[a+32>>2]|0;k[O+16>>2]=k[M+4>>2];k[O+16+4>>2]=k[M+4+4>>2];k[O+16+8>>2]=k[M+4+8>>2];k[O+16+12>>2]=k[M+4+12>>2];k[O+16+16>>2]=k[M+20>>2];k[O+16+16+4>>2]=k[M+20+4>>2];k[O+16+16+8>>2]=k[M+20+8>>2];k[O+16+16+12>>2]=k[M+20+12>>2];k[O+16+32>>2]=k[M+36>>2];k[O+16+32+4>>2]=k[M+36+4>>2];k[O+16+32+8>>2]=k[M+36+8>>2];k[O+16+32+12>>2]=k[M+36+12>>2];k[O+16+48>>2]=k[M+52>>2];k[O+16+48+4>>2]=k[M+52+4>>2];k[O+16+48+8>>2]=k[M+52+8>>2];k[O+16+48+12>>2]=k[M+52+12>>2];R=+o[b+196>>2]+ +o[b+84>>2];w=+o[b+200>>2]+ +o[b+88>>2];o[O+408>>2]=+o[b+192>>2]+ +o[b+80>>2];o[O+408+4>>2]=R;o[O+408+8>>2]=w;o[O+408+12>>2]=0.0;w=+o[c+196>>2]+ +o[c+84>>2];R=+o[c+200>>2]+ +o[c+88>>2];o[O+424>>2]=+o[c+192>>2]+ +o[c+80>>2];o[O+424+4>>2]=w;o[O+424+8>>2]=R;o[O+424+12>>2]=0.0;o[O+144>>2]=1.0;M=O+144+4|0;k[M>>2]=0;k[M+4>>2]=0;k[M+8>>2]=0;k[M+12>>2]=0;o[O+144+20>>2]=1.0;N=O+144+24|0;k[N>>2]=0;k[N+4>>2]=0;k[N+8>>2]=0;k[N+12>>2]=0;o[O+144+40>>2]=1.0;l=O+144+44|0;k[l>>2]=0;k[l+4>>2]=0;k[l+8>>2]=0;k[l+12>>2]=0;k[l+16>>2]=0;Qw(O+344|0,0.0,0.0,0.0,O+408|0,d,O+144|0);o[O+280>>2]=1.0;l=O+280+4|0;k[l>>2]=0;k[l+4>>2]=0;k[l+8>>2]=0;k[l+12>>2]=0;o[O+280+20>>2]=1.0;L=O+280+24|0;k[L>>2]=0;k[L+4>>2]=0;k[L+8>>2]=0;k[L+12>>2]=0;o[O+280+40>>2]=1.0;K=O+280+44|0;k[K>>2]=0;k[K+4>>2]=0;k[K+8>>2]=0;k[K+12>>2]=0;k[K+16>>2]=0;Qw(O+16|0,0.0,0.0,0.0,O+424|0,d,O+280|0);R=+o[a+556>>2];w=+o[a+560>>2];S=+o[a+564>>2];P=+o[a+568>>2];n=R*(2.0/(R*R+w*w+S*S+P*P));z=w*(2.0/(R*R+w*w+S*S+P*P));p=S*(2.0/(R*R+w*w+S*S+P*P));V=+o[a+364>>2];U=+o[a+368>>2];Z=+o[a+372>>2];G=(R*p-P*z)*Z+(U*(R*z+P*p)+V*(1.0-(w*z+S*p)));u=Z*(w*p+P*n)+(V*(R*z-P*p)+U*(1.0-(R*n+S*p)));m=V*(R*p+P*z)+U*(w*p-P*n)+Z*(1.0-(R*n+w*z));f=+o[a+380>>2];Q=+o[a+384>>2];y=+o[a+388>>2];g=(1.0-(w*z+S*p))*f+(R*z+P*p)*Q+(R*p-P*z)*y;H=(R*z-P*p)*f+(1.0-(R*n+S*p))*Q+(w*p+P*n)*y;h=(R*p+P*z)*f+(w*p-P*n)*Q+(1.0-(R*n+w*z))*y;E=+o[a+396>>2];x=+o[a+400>>2];A=+o[a+404>>2];F=(1.0-(w*z+S*p))*E+(R*z+P*p)*x+(R*p-P*z)*A;S=(R*z-P*p)*E+(1.0-(R*n+S*p))*x+(w*p+P*n)*A;z=(R*p+P*z)*E+(w*p-P*n)*x+(1.0-(R*n+w*z))*A;w=+o[a+300>>2];n=+o[a+316>>2];R=+o[a+332>>2];P=+o[a+304>>2];p=+o[a+320>>2];T=+o[a+336>>2];j=+o[a+308>>2];D=+o[a+324>>2];B=+o[a+340>>2];C=-+o[a+348>>2];aa=-+o[a+352>>2];X=-+o[a+356>>2];Z=V*0.0+U*0.0+Z*0.0+ +o[a+412>>2]+(m*(j*C+D*aa+B*X)+(G*(w*C+n*aa+R*X)+u*(P*C+p*aa+T*X)));y=f*0.0+Q*0.0+y*0.0+ +o[a+416>>2]+(h*(j*C+D*aa+B*X)+(g*(w*C+n*aa+R*X)+H*(P*C+p*aa+T*X)));X=E*0.0+x*0.0+A*0.0+ +o[a+420>>2]+(z*(j*C+D*aa+B*X)+(F*(w*C+n*aa+R*X)+S*(P*C+p*aa+T*X)));aa=+o[O+280>>2];C=+o[l>>2];A=+o[O+280+8>>2];x=+o[O+280+16>>2];E=+o[O+280+20>>2];Q=+o[L>>2];f=+o[O+280+32>>2];U=+o[O+280+36>>2];V=+o[O+280+40>>2];W=A*X+(aa*Z+C*y)+ +o[O+280+48>>2];_=x*Z+y*E+X*Q+ +o[O+280+52>>2];$=Z*f+y*U+X*V+ +o[O+280+56>>2];o[O+216>>2]=(G*w+u*P+m*j)*aa+(g*w+H*P+h*j)*C+(F*w+S*P+z*j)*A;o[O+216+4>>2]=(G*n+u*p+m*D)*aa+(g*n+H*p+h*D)*C+(F*n+S*p+z*D)*A;o[O+216+8>>2]=(G*R+u*T+m*B)*aa+(g*R+H*T+h*B)*C+(F*R+S*T+z*B)*A;o[O+216+12>>2]=0.0;o[O+216+16>>2]=(G*w+u*P+m*j)*x+(g*w+H*P+h*j)*E+(F*w+S*P+z*j)*Q;o[O+216+20>>2]=(G*n+u*p+m*D)*x+(g*n+H*p+h*D)*E+(F*n+S*p+z*D)*Q;o[O+216+24>>2]=(G*R+u*T+m*B)*x+(g*R+H*T+h*B)*E+(F*R+S*T+z*B)*Q;o[O+216+28>>2]=0.0;o[O+216+32>>2]=(G*w+u*P+m*j)*f+(g*w+H*P+h*j)*U+(F*w+S*P+z*j)*V;o[O+216+36>>2]=(G*n+u*p+m*D)*f+(g*n+H*p+h*D)*U+(F*n+S*p+z*D)*V;o[O+216+40>>2]=(G*R+u*T+m*B)*f+(g*R+H*T+h*B)*U+(F*R+S*T+z*B)*V;o[O+216+44>>2]=0.0;o[O+216+48>>2]=W;o[O+216+52>>2]=_;o[O+216+56>>2]=$;o[O+216+60>>2]=0.0;$=(F*w+S*P+z*j)*-X+((G*w+u*P+m*j)*-Z+(g*w+H*P+h*j)*-y);_=(F*n+S*p+z*D)*-X+((G*n+u*p+m*D)*-Z+(g*n+H*p+h*D)*-y);y=(F*R+S*T+z*B)*-X+((G*R+u*T+m*B)*-Z+(g*R+H*T+h*B)*-y);Z=+o[O+144>>2];X=+o[M>>2];W=+o[O+144+8>>2];V=+o[O+144+16>>2];U=+o[O+144+20>>2];f=+o[N>>2];Q=+o[O+144+32>>2];E=+o[O+144+36>>2];x=+o[O+144+40>>2];A=$*Z+_*X+y*W+ +o[O+144+48>>2];C=$*V+_*U+y*f+ +o[O+144+52>>2];y=$*Q+_*E+y*x+ +o[O+144+56>>2];o[O+80>>2]=(G*w+u*P+m*j)*Z+(G*n+u*p+m*D)*X+(G*R+u*T+m*B)*W;o[O+80+4>>2]=(g*w+H*P+h*j)*Z+(g*n+H*p+h*D)*X+(g*R+H*T+h*B)*W;o[O+80+8>>2]=(F*w+S*P+z*j)*Z+(F*n+S*p+z*D)*X+(F*R+S*T+z*B)*W;o[O+80+12>>2]=0.0;o[O+80+16>>2]=(G*w+u*P+m*j)*V+(G*n+u*p+m*D)*U+(G*R+u*T+m*B)*f;o[O+80+20>>2]=(g*w+H*P+h*j)*V+(g*n+H*p+h*D)*U+(g*R+H*T+h*B)*f;o[O+80+24>>2]=(F*w+S*P+z*j)*V+(F*n+S*p+z*D)*U+(F*R+S*T+z*B)*f;o[O+80+28>>2]=0.0;o[O+80+32>>2]=(G*w+u*P+m*j)*Q+(G*n+u*p+m*D)*E+(G*R+u*T+m*B)*x;o[O+80+36>>2]=(g*w+H*P+h*j)*Q+(g*n+H*p+h*D)*E+(g*R+H*T+h*B)*x;o[O+80+40>>2]=(F*w+S*P+z*j)*Q+(F*n+S*p+z*D)*E+(F*R+S*T+z*B)*x;o[O+80+44>>2]=0.0;o[O+80+48>>2]=A;o[O+80+52>>2]=C;o[O+80+56>>2]=y;o[O+80+60>>2]=0.0;Rw(O+344|0,O+216|0,O,O+208|0);y=+o[O+208>>2];C=1.0/d*(+o[O>>2]*y);A=1.0/d*(y*+o[O+4>>2]);y=1.0/d*(y*+o[O+8>>2]);Rw(O+16|0,O+80|0,O,O+208|0);x=+o[O+208>>2];C=C-+o[O+408>>2];A=A-+o[O+408+4>>2];y=y-+o[O+408+8>>2];B=1.0/d*(+o[O>>2]*x)-+o[O+424>>2];z=1.0/d*(x*+o[O+4>>2])-+o[O+424+4>>2];x=1.0/d*(x*+o[O+8>>2])-+o[O+424+8>>2];if(C*C+A*A+y*y>1.1920928955078125e-07){m=1.0/+Y(+(C*C+A*A+y*y));N=k[a+28>>2]|0;p=C*m;g=C*m*(C*m*+o[N+264>>2]+A*m*+o[N+280>>2]+y*m*+o[N+296>>2])+A*m*(C*m*+o[N+268>>2]+A*m*+o[N+284>>2]+y*m*+o[N+300>>2])+y*m*(C*m*+o[N+272>>2]+A*m*+o[N+288>>2]+y*m*+o[N+304>>2]);j=A*m;m=y*m}else{p=0.0;g=0.0;j=0.0;m=0.0}if(B*B+z*z+x*x>1.1920928955078125e-07){u=1.0/+Y(+(B*B+z*z+x*x));N=k[a+32>>2]|0;n=B*u;f=B*u*(B*u*+o[N+264>>2]+z*u*+o[N+280>>2]+x*u*+o[N+296>>2])+z*u*(B*u*+o[N+268>>2]+z*u*+o[N+284>>2]+x*u*+o[N+300>>2])+x*u*(B*u*+o[N+272>>2]+z*u*+o[N+288>>2]+x*u*+o[N+304>>2]);h=z*u;u=x*u}else{n=0.0;f=0.0;h=0.0;u=0.0}w=p*g+n*f;p=j*g+h*f;j=m*g+u*f;if(j*j+(w*w+p*p)>1.1920928955078125e-07){u=1.0/+Y(+(j*j+(w*w+p*p)));v=k[a+28>>2]|0;n=w*u*(w*u*+o[v+264>>2]+p*u*+o[v+280>>2]+j*u*+o[v+296>>2])+p*u*(w*u*+o[v+268>>2]+p*u*+o[v+284>>2]+j*u*+o[v+300>>2])+j*u*(w*u*+o[v+272>>2]+p*u*+o[v+288>>2]+j*u*+o[v+304>>2]);e=k[a+32>>2]|0;u=w*u*(w*u*+o[e+264>>2]+p*u*+o[e+280>>2]+j*u*+o[e+296>>2])+p*u*(w*u*+o[e+268>>2]+p*u*+o[e+284>>2]+j*u*+o[e+300>>2])+j*u*(w*u*+o[e+272>>2]+p*u*+o[e+288>>2]+j*u*+o[e+304>>2]);h=1.0/((n+u)*(n+u))*(C*n-B*u);g=1.0/((n+u)*(n+u))*(A*n-z*u);u=1.0/((n+u)*(n+u))*(y*n-x*u);f=+o[a+572>>2];if(!(f>=0.0))f=u;else{if(i[a+553>>0]|0)f=f/n;m=+o[a+576>>2];n=+o[a+580>>2];p=+o[a+584>>2];j=+Y(+((h+m)*(h+m)+(g+n)*(g+n)+(u+p)*(u+p)));if(j>f){h=f*((h+m)*(1.0/j))-m;g=f*((g+n)*(1.0/j))-n;f=f*((u+p)*(1.0/j))-p}else f=u;o[a+576>>2]=h+m;o[a+580>>2]=g+n;o[a+584>>2]=f+p}j=+Y(+(f*f+(g*g+h*h)));h=h*(1.0/j);g=g*(1.0/j);f=f*(1.0/j);if(k[b+240>>2]|0){_=h*+o[v+296>>2]+g*+o[v+300>>2]+f*+o[v+304>>2];Z=h*+o[v+280>>2]+g*+o[v+284>>2]+f*+o[v+288>>2];X=h*+o[v+264>>2]+g*+o[v+268>>2]+f*+o[v+272>>2];V=j*0.0*+o[b+116>>2];W=j*0.0*+o[b+120>>2];o[b+64>>2]=j*0.0*+o[b+112>>2]+ +o[b+64>>2];o[b+68>>2]=V+ +o[b+68>>2];o[b+72>>2]=W+ +o[b+72>>2];Z=Z*(j*+o[b+100>>2]);_=_*(j*+o[b+104>>2]);o[b+80>>2]=X*(j*+o[b+96>>2])+ +o[b+80>>2];o[b+84>>2]=Z+ +o[b+84>>2];o[b+88>>2]=_+ +o[b+88>>2];e=k[a+32>>2]|0}if(k[c+240>>2]|0){_=h*+o[e+296>>2]+g*+o[e+300>>2]+f*+o[e+304>>2];Z=h*+o[e+280>>2]+g*+o[e+284>>2]+f*+o[e+288>>2];X=h*+o[e+264>>2]+g*+o[e+268>>2]+f*+o[e+272>>2];V=j*-0.0*+o[c+116>>2];W=j*-0.0*+o[c+120>>2];o[c+64>>2]=j*-0.0*+o[c+112>>2]+ +o[c+64>>2];o[c+68>>2]=V+ +o[c+68>>2];o[c+72>>2]=W+ +o[c+72>>2];Z=Z*(+o[c+100>>2]*-j);_=_*(+o[c+104>>2]*-j);o[c+80>>2]=X*(+o[c+96>>2]*-j)+ +o[c+80>>2];o[c+84>>2]=Z+ +o[c+84>>2];o[c+88>>2]=_+ +o[c+88>>2]}}I=b+80|0;l=b+196|0;J=b+84|0;q=b+200|0;K=b+88|0;s=c+192|0;L=c+80|0;t=c+196|0;M=c+84|0;v=c+200|0;N=c+88|0;e=b+192|0}while(0);H=+o[e>>2]+ +o[I>>2];w=+o[l>>2]+ +o[J>>2];x=+o[q>>2]+ +o[K>>2];D=+o[s>>2]+ +o[L>>2];E=+o[t>>2]+ +o[M>>2];F=+o[v>>2]+ +o[N>>2];if(i[a+526>>0]|0){n=+o[a+528>>2];p=n*+o[a+504>>2]*+o[a+432>>2]/d;C=+o[a+460>>2];B=+o[a+464>>2];z=+o[a+468>>2];if((D-H)*C+(E-w)*B+(F-x)*z>0.0)p=p+n*((D-H)*C+(E-w)*B+(F-x)*z)*+o[a+436>>2];X=+o[a+516>>2];W=X+p*+o[a+492>>2];W=W>0.0?W:0.0;o[a+516>>2]=W;A=+o[a+536>>2];V=+o[a+540>>2];Z=+o[a+544>>2];_=A*(C*(W-X))+B*(W-X)*V+z*(W-X)*Z;y=+Y(+((z*(W-X)-Z*_)*(z*(W-X)-Z*_)+((C*(W-X)-A*_)*(C*(W-X)-A*_)+(B*(W-X)-V*_)*(B*(W-X)-V*_))));A=1.0/y*(C*(W-X)-A*_);B=1.0/y*(B*(W-X)-V*_);C=1.0/y*(z*(W-X)-Z*_);v=k[a+28>>2]|0;if(k[b+240>>2]|0){_=A*+o[v+296>>2]+B*+o[v+300>>2]+C*+o[v+304>>2];Z=A*+o[v+280>>2]+B*+o[v+284>>2]+C*+o[v+288>>2];X=A*+o[v+264>>2]+B*+o[v+268>>2]+C*+o[v+272>>2];V=y*0.0*+o[b+116>>2];W=y*0.0*+o[b+120>>2];o[b+64>>2]=y*0.0*+o[b+112>>2]+ +o[b+64>>2];o[b+68>>2]=V+ +o[b+68>>2];o[b+72>>2]=W+ +o[b+72>>2];Z=Z*(y*+o[b+100>>2]);_=_*(y*+o[b+104>>2]);o[I>>2]=X*(y*+o[b+96>>2])+ +o[I>>2];o[J>>2]=Z+ +o[J>>2];o[K>>2]=_+ +o[K>>2]}v=k[a+32>>2]|0;if(k[c+240>>2]|0){_=A*+o[v+296>>2]+B*+o[v+300>>2]+C*+o[v+304>>2];Z=A*+o[v+280>>2]+B*+o[v+284>>2]+C*+o[v+288>>2];X=A*+o[v+264>>2]+B*+o[v+268>>2]+C*+o[v+272>>2];V=y*-0.0*+o[c+116>>2];W=y*-0.0*+o[c+120>>2];o[c+64>>2]=y*-0.0*+o[c+112>>2]+ +o[c+64>>2];o[c+68>>2]=V+ +o[c+68>>2];o[c+72>>2]=W+ +o[c+72>>2];Z=Z*(+o[c+100>>2]*-y);_=_*(+o[c+104>>2]*-y);o[L>>2]=X*(+o[c+96>>2]*-y)+ +o[L>>2];o[M>>2]=Z+ +o[M>>2];o[N>>2]=_+ +o[N>>2]}}if(!(i[a+525>>0]|0)){r=O;return}p=+o[a+532>>2];j=p*+o[a+508>>2]*+o[a+432>>2]/d;h=+o[a+476>>2];g=+o[a+480>>2];f=+o[a+484>>2];if((D-H)*h+(E-w)*g+(F-x)*f>0.0)j=j+p*((D-H)*h+(E-w)*g+(F-x)*f)*+o[a+436>>2];n=+o[a+520>>2];p=n+j*+o[a+496>>2];p=p>0.0?p:0.0;o[a+520>>2]=p;e=k[a+28>>2]|0;if(k[b+240>>2]|0){_=h*+o[e+296>>2]+g*+o[e+300>>2]+f*+o[e+304>>2];Z=h*+o[e+280>>2]+g*+o[e+284>>2]+f*+o[e+288>>2];f=h*+o[e+264>>2]+g*+o[e+268>>2]+f*+o[e+272>>2];h=(p-n)*0.0*+o[b+116>>2];g=(p-n)*0.0*+o[b+120>>2];o[b+64>>2]=(p-n)*0.0*+o[b+112>>2]+ +o[b+64>>2];o[b+68>>2]=h+ +o[b+68>>2];o[b+72>>2]=g+ +o[b+72>>2];g=Z*((p-n)*+o[b+100>>2]);h=_*((p-n)*+o[b+104>>2]);o[I>>2]=f*((p-n)*+o[b+96>>2])+ +o[I>>2];o[J>>2]=g+ +o[J>>2];o[K>>2]=h+ +o[K>>2];h=+o[a+476>>2];g=+o[a+480>>2];f=+o[a+484>>2]}e=k[a+32>>2]|0;if(!(k[c+240>>2]|0)){r=O;return}_=h*+o[e+296>>2]+g*+o[e+300>>2]+f*+o[e+304>>2];Z=h*+o[e+280>>2]+g*+o[e+284>>2]+f*+o[e+288>>2];X=h*+o[e+264>>2]+g*+o[e+268>>2]+f*+o[e+272>>2];V=(p-n)*-0.0*+o[c+116>>2];W=(p-n)*-0.0*+o[c+120>>2];o[c+64>>2]=(p-n)*-0.0*+o[c+112>>2]+ +o[c+64>>2];o[c+68>>2]=V+ +o[c+68>>2];o[c+72>>2]=W+ +o[c+72>>2];Z=Z*(+o[c+100>>2]*-(p-n));_=_*(+o[c+104>>2]*-(p-n));o[L>>2]=X*(+o[c+96>>2]*-(p-n))+ +o[L>>2];o[M>>2]=Z+ +o[M>>2];o[N>>2]=_+ +o[N>>2];r=O;return}function qq(a,b,c,d){a=a|0;b=b|0;c=+c;d=+d;var e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0;h=+_(+c);g=+$(+c);c=+o[b+444>>2];if(+X(+h)>1.1920928955078125e-07){i=+o[b+448>>2];e=g*g;f=h*h;c=+Y(+((g*g/(h*h)+1.0)/(1.0/(i*i)+g*g/(h*h)/(c*c))))}else{e=g*g;f=h*h}c=c*.5;i=+$(+c)/+Y(+(f+0.0+e));c=+_(+c);j=c*d+h*i*0.0-g*i*-0.0;f=c*0.0-g*i*d-i*0.0*0.0;e=c*0.0+i*0.0*0.0-h*i*d;d=-(i*0.0*d)-h*i*0.0-g*i*-0.0;o[a>>2]=g*i*f+(c*j+d*-(i*0.0))-e*-(h*i);o[a+4>>2]=e*-(i*0.0)+(c*f+d*-(h*i))-g*i*j;o[a+8>>2]=j*-(h*i)+(g*i*d+c*e)-f*-(i*0.0);o[a+12>>2]=0.0;return}function rq(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0;k[a+556>>2]=k[b>>2];k[a+556+4>>2]=k[b+4>>2];k[a+556+8>>2]=k[b+8>>2];k[a+556+12>>2]=k[b+12>>2];g=+o[a+568>>2];i=+o[a+560>>2];j=+o[a+564>>2];h=+o[a+556>>2];d=-h-i*0.0-j*0.0;c=(j+g*0.0-h*0.0)*-j+(g*(g+i*0.0-j*0.0)+d*-h)-(g*0.0+h*0.0-i)*-i;e=(g*0.0+h*0.0-i)*-h+(g*(j+g*0.0-h*0.0)+d*-i)-(g+i*0.0-j*0.0)*-j;d=(g+i*0.0-j*0.0)*-i+(d*-j+g*(g*0.0+h*0.0-i))-(j+g*0.0-h*0.0)*-h;if(d*0.0+(e*0.0+c)<-.9999998807907104)if(+X(0.0)>.7071067690849304){f=0.0;d=B;e=B;c=0.0}else{f=-0.0;d=1.0;e=0.0;c=0.0}else{t=+Y(+((d*0.0+(e*0.0+c)+1.0)*2.0));f=(d*0.0-e*0.0)*(1.0/t);d=(c*0.0-d)*(1.0/t);e=(e-c*0.0)*(1.0/t);c=t*.5}q=1.0/+Y(+(c*c+(e*e+(d*d+f*f))));m=f*q;n=d*q;p=e*q;d=c*q;q=1.0/+Y(+((d*g-h*-m-i*-n-j*-p)*(d*g-h*-m-i*-n-j*-p)+((g*-p+d*j+i*-m-h*-n)*(g*-p+d*j+i*-m-h*-n)+((d*h+g*-m+j*-n-i*-p)*(d*h+g*-m+j*-n-i*-p)+(h*-p+(g*-n+d*i)-j*-m)*(h*-p+(g*-n+d*i)-j*-m)))));r=(d*h+g*-m+j*-n-i*-p)*q;t=q*(h*-p+(g*-n+d*i)-j*-m);s=q*(g*-p+d*j+i*-m-h*-n);q=q*(d*g-h*-m-i*-n-j*-p);e=+o[a+444>>2];if(e>=.05000000074505806?(l=+o[a+448>>2],l>=.05000000074505806):0){c=d<-1.0?-1.0:d;c=+ba(+(c>1.0?1.0:c))*2.0;if(c>1.1920928955078125e-07){f=1.0/+Y(+(p*p+(m*m+n*n)));if(+X(+(n*f))>1.1920928955078125e-07){e=+Y(+((p*f*(p*f)/(n*f*(n*f))+1.0)/(1.0/(l*l)+p*f*(p*f)/(n*f*(n*f))/(e*e))));g=m*f;h=n*f;f=p*f}else{g=m*f;h=n*f;f=p*f}}else{e=0.0;g=0.0;h=0.0;f=0.0}if(+X(+c)>1.1920928955078125e-07){if(!(c>e)){d=-e;if(c<d)c=d}else c=e;i=c*.5;j=+$(+i)/+Y(+(f*f+(h*h+g*g)));i=+_(+i);m=g*j;l=h*j;j=f*j}else{i=d;l=n;j=p}}else{i=d;l=n;j=p}g=+o[a+452>>2];if(g>=.05000000074505806){c=q<-1.0?-1.0:q;c=+ba(+(c>1.0?1.0:c))*2.0;if(c>3.1415927410125732){c=q>1.0?-1.0:-q;c=+ba(+(c>1.0?1.0:c))*2.0;f=-r;e=-t;d=-s}else{f=r;e=t;d=s}if(c>1.1920928955078125e-07){p=1.0/+Y(+(d*d+(e*e+f*f)));f=f*p;h=e*p;d=d*p}else h=e;if(+X(+c)>1.1920928955078125e-07){if(!(c>g)){if(c<-g)c=-g}else c=g;e=c*.5;c=+$(+e)/+Y(+(d*d+(h*h+f*f)));f=f*c;e=+_(+e);d=d*c;c=h*c}else{f=r;e=q;d=s;c=t}}else{f=r;e=q;d=s;c=t}o[a+556>>2]=l*d+(m*e+i*f)-j*c;o[a+560>>2]=j*f+(l*e+i*c)-m*d;o[a+564>>2]=j*e+i*d+m*c-l*f;o[a+568>>2]=i*e-m*f-l*c-j*d;return}function sq(a,b,c,d){a=a|0;b=b|0;c=+c;d=d|0;if((b|0)==4|(b|0)==3)if(d>>>0<3){o[a+596>>2]=c;k[a+592>>2]=k[a+592>>2]|1;return}else{o[a+604>>2]=c;k[a+592>>2]=k[a+592>>2]|4;return}else if((b|0)==2|(b|0)==1)if(d>>>0<3){o[a+600>>2]=c;k[a+592>>2]=k[a+592>>2]|2;return}else{o[a+432>>2]=c;return}else return}function tq(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0;do if((b|0)==2|(b|0)==1){if(c>>>0<3){d=+o[a+600>>2];break}if((c+-3|0)>>>0<3)d=+o[a+432>>2];else d=0.0}else if((b|0)==4|(b|0)==3){if(c>>>0<3){d=+o[a+596>>2];break}if((c+-3|0)>>>0<3)d=+o[a+604>>2];else d=0.0}else d=0.0;while(0);return +d}function uq(a,b,c){a=a|0;b=b|0;c=c|0;k[a+300>>2]=k[b>>2];k[a+300+4>>2]=k[b+4>>2];k[a+300+8>>2]=k[b+8>>2];k[a+300+12>>2]=k[b+12>>2];k[a+316>>2]=k[b+16>>2];k[a+316+4>>2]=k[b+16+4>>2];k[a+316+8>>2]=k[b+16+8>>2];k[a+316+12>>2]=k[b+16+12>>2];k[a+332>>2]=k[b+32>>2];k[a+332+4>>2]=k[b+32+4>>2];k[a+332+8>>2]=k[b+32+8>>2];k[a+332+12>>2]=k[b+32+12>>2];k[a+348>>2]=k[b+48>>2];k[a+348+4>>2]=k[b+48+4>>2];k[a+348+8>>2]=k[b+48+8>>2];k[a+348+12>>2]=k[b+48+12>>2];k[a+364>>2]=k[c>>2];k[a+364+4>>2]=k[c+4>>2];k[a+364+8>>2]=k[c+8>>2];k[a+364+12>>2]=k[c+12>>2];k[a+380>>2]=k[c+16>>2];k[a+380+4>>2]=k[c+16+4>>2];k[a+380+8>>2]=k[c+16+8>>2];k[a+380+12>>2]=k[c+16+12>>2];k[a+396>>2]=k[c+32>>2];k[a+396+4>>2]=k[c+32+4>>2];k[a+396+8>>2]=k[c+32+8>>2];k[a+396+12>>2]=k[c+32+12>>2];k[a+412>>2]=k[c+48>>2];k[a+412+4>>2]=k[c+48+4>>2];k[a+412+8>>2]=k[c+48+8>>2];k[a+412+12>>2]=k[c+48+12>>2];Sb[k[(k[a>>2]|0)+8>>2]&255](a);return}function vq(a,b,c,d,e,f,g,h){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;var j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0;k[a+4>>2]=4;k[a+8>>2]=-1;k[a+12>>2]=-1;o[a+16>>2]=3402823466385288598117041.0e14;i[a+20>>0]=1;i[a+21>>0]=0;k[a+24>>2]=-1;k[a+28>>2]=b;k[a+32>>2]=c;o[a+36>>2]=0.0;o[a+40>>2]=.30000001192092896;k[a+44>>2]=0;k[a>>2]=3840;o[a+688>>2]=0.0;o[a+692>>2]=-1.0;o[a+696>>2]=.8999999761581421;o[a+700>>2]=.30000001192092896;o[a+704>>2]=1.0;o[a+708>>2]=0.0;o[a+712>>2]=0.0;i[a+716>>0]=0;i[a+736>>0]=0;i[a+737>>0]=0;i[a+738>>0]=0;i[a+739>>0]=1;i[a+740>>0]=h&1;k[a+748>>2]=0;k[a+600>>2]=k[d>>2];k[a+600+4>>2]=k[d+4>>2];k[a+600+8>>2]=k[d+8>>2];k[a+600+12>>2]=k[d+12>>2];q=+o[b+4>>2];p=+o[b+20>>2];n=+o[b+36>>2];m=+o[f>>2];l=+o[f+4>>2];j=+o[f+8>>2];do if(!(q*m+p*l+n*j>=.9999998807907104))if(!(q*m+p*l+n*j<=-.9999998807907104)){r=q*j-n*m;v=l*(n*l-p*j)-m*(q*j-n*m);s=p*m-q*l;w=j*(q*j-n*m)-l*(p*m-q*l);t=n*l-p*j;u=m*(p*m-q*l)-j*(n*l-p*j);break}else{r=+o[b+24>>2];v=+o[b+44>>2];s=+o[b+40>>2];w=+o[b+12>>2];t=+o[b+8>>2];u=+o[b+28>>2];break}else{r=+o[b+24>>2];v=-+o[b+44>>2];s=+o[b+40>>2];w=-+o[b+12>>2];t=+o[b+8>>2];u=-+o[b+28>>2]}while(0);o[a+552>>2]=w;o[a+556>>2]=t;o[a+560>>2]=+o[f>>2];o[a+564>>2]=0.0;o[a+568>>2]=u;o[a+572>>2]=r;o[a+576>>2]=+o[f+4>>2];o[a+580>>2]=0.0;o[a+584>>2]=v;o[a+588>>2]=s;o[a+592>>2]=+o[f+8>>2];o[a+596>>2]=0.0;m=+o[f+4>>2];s=+o[g+8>>2];n=+o[f+8>>2];r=+o[g+4>>2];t=+o[g>>2];j=+o[f>>2];do if(s*n+(m*r+t*j)<-.9999998807907104)if(+X(+n)>.7071067690849304){l=1.0/+Y(+(m*m+n*n));p=0.0;q=-(n*l);l=m*l;j=0.0;break}else{n=1.0/+Y(+(m*m+j*j));p=0.0;q=j*n;l=0.0;j=-(m*n);break}else{x=+Y(+((s*n+(m*r+t*j)+1.0)*2.0));p=x*.5;q=(n*t-s*j)*(1.0/x);l=(r*j-m*t)*(1.0/x);j=(m*s-n*r)*(1.0/x)}while(0);y=w*p+v*q-u*l;n=u*p+w*l-v*j;m=v*p+u*j-w*q;v=-(w*j)-u*q-v*l;u=-j;j=-q;q=-l;x=n*q+(p*y+v*u)-m*j;w=m*u+(p*n+v*j)-y*q;u=y*j+(v*q+p*m)-n*u;k[a+664>>2]=k[e>>2];k[a+664+4>>2]=k[e+4>>2];k[a+664+8>>2]=k[e+8>>2];k[a+664+12>>2]=k[e+12>>2];o[a+616>>2]=x;o[a+620>>2]=r*u-s*w;o[a+624>>2]=+o[g>>2];o[a+628>>2]=0.0;o[a+632>>2]=w;o[a+636>>2]=s*x-t*u;o[a+640>>2]=+o[g+4>>2];o[a+644>>2]=0.0;o[a+648>>2]=u;o[a+652>>2]=t*w-r*x;o[a+656>>2]=+o[g+8>>2];o[a+660>>2]=0.0;o[a+732>>2]=h?-1.0:1.0;return}function wq(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,j=0.0;k[a+4>>2]=4;k[a>>2]=256;k[a+8>>2]=-1;k[a+12>>2]=-1;o[a+16>>2]=3402823466385288598117041.0e14;i[a+20>>0]=1;i[a+21>>0]=0;k[a+24>>2]=-1;k[a+28>>2]=b;eq();k[a+32>>2]=2960;o[a+36>>2]=0.0;o[a+40>>2]=.30000001192092896;k[a+44>>2]=0;k[a>>2]=3840;k[a+552>>2]=k[c>>2];k[a+552+4>>2]=k[c+4>>2];k[a+552+8>>2]=k[c+8>>2];k[a+552+12>>2]=k[c+12>>2];k[a+568>>2]=k[c+16>>2];k[a+568+4>>2]=k[c+16+4>>2];k[a+568+8>>2]=k[c+16+8>>2];k[a+568+12>>2]=k[c+16+12>>2];k[a+584>>2]=k[c+32>>2];k[a+584+4>>2]=k[c+32+4>>2];k[a+584+8>>2]=k[c+32+8>>2];k[a+584+12>>2]=k[c+32+12>>2];k[a+600>>2]=k[c+48>>2];k[a+600+4>>2]=k[c+48+4>>2];k[a+600+8>>2]=k[c+48+8>>2];k[a+600+12>>2]=k[c+48+12>>2];k[a+616>>2]=k[c>>2];k[a+616+4>>2]=k[c+4>>2];k[a+616+8>>2]=k[c+8>>2];k[a+616+12>>2]=k[c+12>>2];k[a+632>>2]=k[c+16>>2];k[a+632+4>>2]=k[c+16+4>>2];k[a+632+8>>2]=k[c+16+8>>2];k[a+632+12>>2]=k[c+16+12>>2];k[a+648>>2]=k[c+32>>2];k[a+648+4>>2]=k[c+32+4>>2];k[a+648+8>>2]=k[c+32+8>>2];k[a+648+12>>2]=k[c+32+12>>2];k[a+664>>2]=k[c+48>>2];k[a+664+4>>2]=k[c+48+4>>2];k[a+664+8>>2]=k[c+48+8>>2];k[a+664+12>>2]=k[c+48+12>>2];o[a+688>>2]=0.0;o[a+692>>2]=-1.0;o[a+696>>2]=.8999999761581421;o[a+700>>2]=.30000001192092896;o[a+704>>2]=1.0;o[a+708>>2]=0.0;o[a+712>>2]=0.0;i[a+716>>0]=0;i[a+736>>0]=0;i[a+737>>0]=0;i[a+738>>0]=0;i[a+739>>0]=1;i[a+740>>0]=d&1;k[a+748>>2]=0;c=k[a+28>>2]|0;j=+o[a+600>>2];h=+o[a+604>>2];g=+o[a+608>>2];f=j*+o[c+20>>2]+h*+o[c+24>>2]+g*+o[c+28>>2]+ +o[c+56>>2];e=j*+o[c+36>>2]+h*+o[c+40>>2]+g*+o[c+44>>2]+ +o[c+60>>2];o[a+664>>2]=j*+o[c+4>>2]+h*+o[c+8>>2]+g*+o[c+12>>2]+ +o[c+52>>2];o[a+668>>2]=f;o[a+672>>2]=e;o[a+676>>2]=0.0;o[a+732>>2]=d?-1.0:1.0;return}
function Sv(a,b,c,d,e,f,g,h,j,m){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;j=j|0;m=m|0;var n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0,z=0.0,A=0.0,B=0,C=0,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0,Q=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0.0;K=r;r=r+10240|0;S=+o[f+52>>2]-+o[e+52>>2];t=+o[f+56>>2]-+o[e+56>>2];o[K+9328>>2]=+o[f+48>>2]-+o[e+48>>2];o[K+9328+4>>2]=S;o[K+9328+8>>2]=t;o[K+9328+12>>2]=0.0;k[K+9344>>2]=c;k[K+9344+4>>2]=d;t=+o[f>>2];S=+o[e>>2];q=+o[f+16>>2];s=+o[e+16>>2];p=+o[f+32>>2];T=+o[e+32>>2];n=+o[e+4>>2];U=+o[e+20>>2];L=+o[e+36>>2];z=+o[e+8>>2];w=+o[e+24>>2];u=+o[e+40>>2];R=+o[f+4>>2];Q=+o[f+20>>2];P=+o[f+36>>2];O=+o[f+8>>2];N=+o[f+24>>2];M=+o[f+40>>2];o[K+9344+8>>2]=t*S+q*s+p*T;o[K+9344+12>>2]=t*n+q*U+p*L;o[K+9344+16>>2]=t*z+q*w+p*u;o[K+9344+20>>2]=0.0;o[K+9344+24>>2]=S*R+s*Q+T*P;o[K+9344+28>>2]=n*R+U*Q+L*P;o[K+9344+32>>2]=z*R+w*Q+u*P;o[K+9344+36>>2]=0.0;o[K+9344+40>>2]=S*O+s*N+T*M;o[K+9344+44>>2]=n*O+U*N+L*M;o[K+9344+48>>2]=z*O+w*N+u*M;o[K+9344+52>>2]=0.0;u=+o[f+48>>2]-+o[e+48>>2];w=+o[f+52>>2]-+o[e+52>>2];z=+o[f+56>>2]-+o[e+56>>2];L=+o[e>>2];U=+o[f>>2];n=+o[e+16>>2];T=+o[f+16>>2];s=+o[e+32>>2];S=+o[f+32>>2];p=+o[e+4>>2];q=+o[e+20>>2];t=+o[e+36>>2];v=+o[e+8>>2];A=+o[e+24>>2];x=+o[e+40>>2];o[K+9344+56>>2]=L*U+n*T+s*S;o[K+9344+60>>2]=L*R+n*Q+s*P;o[K+9344+64>>2]=L*O+n*N+s*M;o[K+9344+68>>2]=0.0;o[K+9344+72>>2]=U*p+T*q+S*t;o[K+9344+76>>2]=R*p+Q*q+P*t;o[K+9344+80>>2]=O*p+N*q+M*t;o[K+9344+84>>2]=0.0;o[K+9344+88>>2]=U*v+T*A+S*x;o[K+9344+92>>2]=R*v+Q*A+P*x;o[K+9344+96>>2]=O*v+N*A+M*x;o[K+9344+100>>2]=0.0;o[K+9344+104>>2]=u*L+w*n+z*s;o[K+9344+108>>2]=u*p+w*q+z*t;o[K+9344+112>>2]=u*v+w*A+z*x;o[K+9344+116>>2]=0.0;k[K+9344+120>>2]=71;k[K+9344+124>>2]=0;k[K+9472+364>>2]=0;k[K+9472+128>>2]=0;k[K+9472+128+4>>2]=0;k[K+9472+128+8>>2]=0;k[K+9472+128+12>>2]=0;k[K+9472+376>>2]=2;k[K+9472+368>>2]=0;o[K+9472+144>>2]=0.0;x=+o[K+9328>>2];z=+o[K+9328+4>>2];A=+o[K+9328+8>>2];o[K+9852>>2]=-x;o[K+9852+4>>2]=-z;o[K+9852+8>>2]=-A;o[K+9852+12>>2]=0.0;a:do if((qx(K+9472|0,K+9344|0,K+9852|0)|0)==1){F=K+16+9280|0;G=K+16+9288|0;H=K+16+9292|0;k[F>>2]=0;k[F+4>>2]=0;k[F+8>>2]=0;k[F+12>>2]=0;k[K+16>>2]=9;J=K+16+40|0;k[K+16+9276>>2]=0;k[J>>2]=0;k[J+4>>2]=0;k[J+8>>2]=0;k[J+12>>2]=0;k[J+16>>2]=0;m=0;do{a=128-m+-1|0;k[K+16+2108+(a*56|0)+44>>2]=0;b=k[G>>2]|0;k[K+16+2108+(a*56|0)+48>>2]=b;if(b)k[b+44>>2]=K+16+2108+(a*56|0);k[G>>2]=K+16+2108+(a*56|0);k[H>>2]=(k[H>>2]|0)+1;m=m+1|0}while((m|0)!=128);E=k[K+9472+372>>2]|0;do if((k[E+32>>2]|0)>>>0>1?cE(K+9472|0)|0:0){a=k[F>>2]|0;if(a){B=k[K+16+9284>>2]|0;C=k[H>>2]|0;do{m=a+48|0;y=k[m>>2]|0;b=a+44|0;if(y)k[y+44>>2]=k[b>>2];y=k[b>>2]|0;if(y)k[y+48>>2]=k[m>>2];if((k[F>>2]|0)==(a|0))k[F>>2]=k[m>>2];B=B+-1|0;k[b>>2]=0;k[m>>2]=k[G>>2];b=k[G>>2]|0;if(b)k[b+44>>2]=a;k[G>>2]=a;C=C+1|0;a=k[F>>2]|0}while((a|0)!=0);k[K+16+9284>>2]=B;k[H>>2]=C}k[K+16>>2]=0;k[K+16+9276>>2]=0;a=k[E>>2]|0;b=k[E+12>>2]|0;U=+o[b+16>>2];M=+o[a+16>>2]-U;P=+o[b+20>>2];Q=+o[a+20>>2]-P;R=+o[b+24>>2];S=+o[a+24>>2]-R;b=k[E+4>>2]|0;O=+o[b+16>>2]-U;T=+o[b+20>>2]-P;N=+o[b+24>>2]-R;y=k[E+8>>2]|0;U=+o[y+16>>2]-U;P=+o[y+20>>2]-P;R=+o[y+24>>2]-R;if(M*T*R+(Q*N*U+S*O*P-M*N*P-Q*O*R)-S*T*U<0.0){k[E>>2]=b;k[E+4>>2]=a;U=+o[E+16>>2];o[E+16>>2]=+o[E+20>>2];o[E+20>>2]=U;m=b}else{m=a;a=b}C=aE(K+16|0,m,a,y,1)|0;B=aE(K+16|0,k[E+4>>2]|0,k[E>>2]|0,k[E+12>>2]|0,1)|0;m=aE(K+16|0,k[E+8>>2]|0,k[E+4>>2]|0,k[E+12>>2]|0,1)|0;D=aE(K+16|0,k[E>>2]|0,k[E+8>>2]|0,k[E+12>>2]|0,1)|0;if((k[K+16+9284>>2]|0)==4){y=k[F>>2]|0;u=+o[y+16>>2];a=k[y+48>>2]|0;if(!a)b=y;else{z=u*u;b=y;while(1){A=+o[a+16>>2];y=A*A<z;b=y?a:b;a=k[a+48>>2]|0;if(!a)break;else z=y?A*A:z}u=+o[b+16>>2]}A=+o[b>>2];x=+o[b+4>>2];w=+o[b+8>>2];z=+o[b+12>>2];y=k[b+20>>2]|0;E=k[b+24>>2]|0;a=k[b+28>>2]|0;i[C+52>>0]=0;k[C+32>>2]=B;i[B+52>>0]=0;k[B+32>>2]=C;i[C+53>>0]=0;k[C+36>>2]=m;i[m+52>>0]=1;k[m+32>>2]=C;i[C+54>>0]=0;k[C+40>>2]=D;i[D+52>>0]=2;k[D+32>>2]=C;i[B+53>>0]=2;k[B+36>>2]=D;i[D+54>>0]=1;k[D+40>>2]=B;i[B+54>>0]=1;k[B+40>>2]=m;i[m+53>>0]=2;k[m+36>>2]=B;i[m+54>>0]=1;k[m+40>>2]=D;i[D+53>>0]=2;k[D+36>>2]=m;k[K+16>>2]=0;m=E;D=b;E=0;while(1){C=k[K+16+9276>>2]|0;if(C>>>0>=64){I=47;break}k[K+9312>>2]=0;k[K+9312+4>>2]=0;k[K+9312+8>>2]=0;k[K+16+9276>>2]=C+1;E=E+1|0;i[D+55>>0]=E;B=D+4|0;b=D+8|0;$D(K+9472|0,+o[D>>2],+o[B>>2],+o[b>>2],K+16+60+(C<<5)|0);if(+o[D>>2]*+o[K+16+60+(C<<5)+16>>2]+ +o[B>>2]*+o[K+16+60+(C<<5)+20>>2]+ +o[b>>2]*+o[K+16+60+(C<<5)+24>>2]-+o[D+16>>2]>9.999999747378752e-05){b=0;B=1}else{I=46;break}do{B=B&(_D(K+16|0,E,K+16+60+(C<<5)|0,k[D+32+(b<<2)>>2]|0,l[D+52+b>>0]|0,K+9312|0)|0);b=b+1|0}while(!(b>>>0>2|B^1));if(!(B&(k[K+9312+8>>2]|0)>>>0>2)){I=45;break}a=k[K+9312>>2]|0;m=k[K+9312+4>>2]|0;i[a+53>>0]=2;k[a+36>>2]=m;i[m+54>>0]=1;k[m+40>>2]=a;m=D+48|0;a=k[m>>2]|0;b=D+44|0;if(a)k[a+44>>2]=k[b>>2];a=k[b>>2]|0;if(a)k[a+48>>2]=k[m>>2];if((k[F>>2]|0)==(D|0))k[F>>2]=k[m>>2];k[K+16+9284>>2]=(k[K+16+9284>>2]|0)+-1;k[b>>2]=0;k[m>>2]=k[G>>2];a=k[G>>2]|0;if(a)k[a+44>>2]=D;k[G>>2]=D;k[H>>2]=(k[H>>2]|0)+1;b=k[F>>2]|0;u=+o[b+16>>2];a=k[b+48>>2]|0;if(a){x=u*u;m=b;while(1){u=+o[a+16>>2];b=u*u<x;m=b?a:m;a=k[a+48>>2]|0;if(!a)break;else x=b?u*u:x}u=+o[m+16>>2];b=m}A=+o[b>>2];x=+o[b+4>>2];w=+o[b+8>>2];z=+o[b+12>>2];y=k[b+20>>2]|0;m=k[b+24>>2]|0;a=k[b+28>>2]|0;if(E>>>0>=255){b=m;break}else D=b}if((I|0)==45){k[K+16>>2]=4;b=m}else if((I|0)==46){k[K+16>>2]=7;b=m}else if((I|0)==47){k[K+16>>2]=6;b=m}O=u*A;N=u*x;S=u*w;o[J>>2]=A;o[K+16+44>>2]=x;o[K+16+48>>2]=w;o[K+16+52>>2]=z;o[K+16+56>>2]=u;k[K+16+36>>2]=3;k[K+16+4>>2]=y;k[K+16+8>>2]=b;k[K+16+12>>2]=a;F=b+16|0;R=+o[F>>2]-O;G=b+20|0;A=+o[G>>2]-N;H=b+24|0;Q=+o[H>>2]-S;E=a+16|0;z=+o[E>>2]-O;D=a+20|0;P=+o[D>>2]-N;C=a+24|0;T=+o[C>>2]-S;T=+Y(+((R*P-A*z)*(R*P-A*z)+((A*T-Q*P)*(A*T-Q*P)+(Q*z-R*T)*(Q*z-R*T))));o[K+16+20>>2]=T;R=+o[E>>2]-O;z=+o[D>>2]-N;Q=+o[C>>2]-S;C=y+16|0;P=+o[C>>2]-O;D=y+20|0;A=+o[D>>2]-N;E=y+24|0;U=+o[E>>2]-S;U=+Y(+((R*A-z*P)*(R*A-z*P)+((z*U-Q*A)*(z*U-Q*A)+(Q*P-R*U)*(Q*P-R*U))));o[K+16+24>>2]=U;R=+o[C>>2]-O;P=+o[D>>2]-N;Q=+o[E>>2]-S;O=+o[F>>2]-O;A=+o[G>>2]-N;S=+o[H>>2]-S;S=+Y(+((R*A-P*O)*(R*A-P*O)+((P*S-Q*A)*(P*S-Q*A)+(Q*O-R*S)*(Q*O-R*S))));o[K+16+20>>2]=T/(S+(T+U));o[K+16+24>>2]=U/(S+(T+U));o[K+16+28>>2]=S/(S+(T+U));if((k[K+16>>2]|0)!=9)if(!(k[K+16+36>>2]|0)){u=0.0;t=0.0;q=0.0;break}else{y=K+16+36|0;I=53;break}else{a=0;x=0.0;w=0.0;v=0.0;p=0.0;s=0.0;n=0.0;z=0.0;A=0.0;u=0.0;break a}}else I=48}else I=48;while(0);if((I|0)==48){k[K+16>>2]=8;o[J>>2]=x;o[K+16+44>>2]=z;o[K+16+48>>2]=A;o[K+16+52>>2]=0.0;u=+Y(+(x*x+z*z+A*A));if(u>0.0){p=1.0/u*A;t=1.0/u*z;q=1.0/u*x}else{p=0.0;t=0.0;q=1.0}o[J>>2]=q;o[K+16+44>>2]=t;o[K+16+48>>2]=p;o[K+16+52>>2]=0.0;o[K+16+56>>2]=0.0;k[K+16+36>>2]=1;k[K+16+4>>2]=k[E>>2];o[K+16+20>>2]=1.0;y=K+16+36|0;I=53}if((I|0)==53){q=0.0;t=0.0;u=0.0;m=0;do{a=k[K+9344+120>>2]|0;I=k[K+9344+124>>2]|0;b=(k[K+9344>>2]|0)+(I>>1)|0;if(I&1)a=k[(k[b>>2]|0)+a>>2]|0;yc[a&127](K,b,k[K+16+4+(m<<2)>>2]|0);U=+o[K+16+20+(m<<2)>>2];q=q+ +o[K>>2]*U;t=t+U*+o[K+4>>2];u=u+U*+o[K+8>>2];m=m+1|0}while(m>>>0<(k[y>>2]|0)>>>0)}L=+o[e>>2];M=+o[e+4>>2];N=+o[e+8>>2];R=+o[e+16>>2];S=+o[e+20>>2];T=+o[e+24>>2];P=+o[e+32>>2];Q=+o[e+36>>2];O=+o[e+40>>2];z=+o[e+48>>2];U=+o[e+52>>2];A=+o[e+56>>2];p=+o[J>>2];v=+o[K+16+56>>2];s=+o[K+16+44>>2];n=+o[K+16+48>>2];W=q-p*v;V=t-v*s;v=u-v*n;a=1;x=W*L+V*M+v*N+z;w=W*R+V*S+v*T+U;v=W*P+V*Q+v*O+A;p=-p;s=-s;n=-n;z=q*L+t*M+u*N+z;A=q*P+t*Q+u*O+A;u=q*R+t*S+u*T+U}else{a=0;x=0.0;w=0.0;v=0.0;p=0.0;s=0.0;n=0.0;z=0.0;A=0.0;u=0.0}while(0);if(a){o[h>>2]=z;o[h+4>>2]=u;o[h+8>>2]=A;o[h+12>>2]=0.0;o[j>>2]=x;o[j+4>>2]=w;o[j+8>>2]=v;o[j+12>>2]=0.0;o[g>>2]=p;o[g+4>>2]=s;o[g+8>>2]=n;o[g+12>>2]=0.0;j=1;r=K;return j|0}k[K+9472>>2]=c;k[K+9472+4>>2]=d;p=+o[f>>2];N=+o[e>>2];q=+o[f+16>>2];z=+o[e+16>>2];t=+o[f+32>>2];P=+o[e+32>>2];A=+o[e+4>>2];Q=+o[e+20>>2];O=+o[e+36>>2];S=+o[e+8>>2];U=+o[e+24>>2];W=+o[e+40>>2];u=+o[f+4>>2];v=+o[f+20>>2];L=+o[f+36>>2];w=+o[f+8>>2];M=+o[f+24>>2];x=+o[f+40>>2];o[K+9472+8>>2]=p*N+q*z+t*P;o[K+9472+12>>2]=p*A+q*Q+t*O;o[K+9472+16>>2]=p*S+q*U+t*W;o[K+9472+20>>2]=0.0;o[K+9472+24>>2]=N*u+z*v+P*L;o[K+9472+28>>2]=A*u+Q*v+O*L;o[K+9472+32>>2]=S*u+U*v+W*L;o[K+9472+36>>2]=0.0;o[K+9472+40>>2]=N*w+z*M+P*x;o[K+9472+44>>2]=A*w+Q*M+O*x;o[K+9472+48>>2]=S*w+U*M+W*x;o[K+9472+52>>2]=0.0;R=+o[f+48>>2]-+o[e+48>>2];T=+o[f+52>>2]-+o[e+52>>2];V=+o[f+56>>2]-+o[e+56>>2];o[K+9472+56>>2]=p*N+q*z+t*P;o[K+9472+60>>2]=N*u+z*v+P*L;o[K+9472+64>>2]=N*w+z*M+P*x;o[K+9472+68>>2]=0.0;o[K+9472+72>>2]=p*A+q*Q+t*O;o[K+9472+76>>2]=A*u+Q*v+O*L;o[K+9472+80>>2]=A*w+Q*M+O*x;o[K+9472+84>>2]=0.0;o[K+9472+88>>2]=p*S+q*U+t*W;o[K+9472+92>>2]=S*u+U*v+W*L;o[K+9472+96>>2]=S*w+U*M+W*x;o[K+9472+100>>2]=0.0;o[K+9472+104>>2]=R*N+T*z+V*P;o[K+9472+108>>2]=R*A+T*Q+V*O;o[K+9472+112>>2]=R*S+T*U+V*W;o[K+9472+116>>2]=0.0;k[K+9472+120>>2]=72;k[K+9472+124>>2]=0;k[K+9852+364>>2]=0;k[K+9852+128>>2]=0;k[K+9852+128+4>>2]=0;k[K+9852+128+8>>2]=0;k[K+9852+128+12>>2]=0;k[K+9852+376>>2]=2;k[K+9852+368>>2]=0;o[K+9852+144>>2]=0.0;if(qx(K+9852|0,K+9472|0,K+9328|0)|0){j=0;r=K;return j|0}m=k[K+9852+372>>2]|0;if(!(k[m+32>>2]|0)){u=0.0;t=0.0;s=0.0;q=0.0;p=0.0;n=0.0}else{s=0.0;t=0.0;u=0.0;n=0.0;p=0.0;q=0.0;C=0;do{A=+o[m+16+(C<<2)>>2];a=k[K+9472+120>>2]|0;c=k[K+9472+124>>2]|0;b=(k[K+9472>>2]|0)+(c>>1)|0;if(c&1)a=k[(k[b>>2]|0)+a>>2]|0;yc[a&127](K+16|0,b,k[m+(C<<2)>>2]|0);s=s+A*+o[K+16>>2];t=t+A*+o[K+16+4>>2];u=u+A*+o[K+16+8>>2];a=k[(k[K+9852+372>>2]|0)+(C<<2)>>2]|0;v=-+o[a>>2];w=-+o[a+4>>2];x=-+o[a+8>>2];a=k[K+9472+120>>2]|0;c=k[K+9472+124>>2]|0;b=(k[K+9472+4>>2]|0)+(c>>1)|0;if(c&1)a=k[(k[b>>2]|0)+a>>2]|0;V=+o[K+9472+24>>2]*v+ +o[K+9472+28>>2]*w+ +o[K+9472+32>>2]*x;U=+o[K+9472+40>>2]*v+ +o[K+9472+44>>2]*w+ +o[K+9472+48>>2]*x;o[K+9344>>2]=+o[K+9472+8>>2]*v+ +o[K+9472+12>>2]*w+ +o[K+9472+16>>2]*x;o[K+9344+4>>2]=V;o[K+9344+8>>2]=U;o[K+9344+12>>2]=0.0;yc[a&127](K+9312|0,b,K+9344|0);U=+o[K+9312>>2];V=+o[K+9312+4>>2];W=+o[K+9312+8>>2];n=n+A*(U*+o[K+9472+56>>2]+V*+o[K+9472+60>>2]+W*+o[K+9472+64>>2]+ +o[K+9472+104>>2]);p=p+A*(U*+o[K+9472+72>>2]+V*+o[K+9472+76>>2]+W*+o[K+9472+80>>2]+ +o[K+9472+108>>2]);q=q+A*(U*+o[K+9472+88>>2]+V*+o[K+9472+92>>2]+W*+o[K+9472+96>>2]+ +o[K+9472+112>>2]);C=C+1|0;m=k[K+9852+372>>2]|0}while(C>>>0<(k[m+32>>2]|0)>>>0)}L=+o[e>>2];w=+o[e+4>>2];M=+o[e+8>>2];N=+o[e+16>>2];z=+o[e+20>>2];P=+o[e+24>>2];Q=+o[e+32>>2];O=+o[e+36>>2];R=+o[e+40>>2];x=+o[e+48>>2];A=+o[e+52>>2];S=+o[e+56>>2];T=s-n;U=t-p;W=u-q;V=+Y(+(T*T+U*U+W*W));V=V>9.999999747378752e-05?1.0/V:1.0;o[h>>2]=s*L+t*w+u*M+x;o[h+4>>2]=s*N+t*z+u*P+A;o[h+8>>2]=s*Q+t*O+u*R+S;o[h+12>>2]=0.0;o[j>>2]=n*L+p*w+q*M+x;o[j+4>>2]=n*N+p*z+q*P+A;o[j+8>>2]=n*Q+p*O+q*R+S;o[j+12>>2]=0.0;o[g>>2]=V*T;o[g+4>>2]=V*U;o[g+8>>2]=V*W;o[g+12>>2]=0.0;j=0;r=K;return j|0}function Tv(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;var g=0.0,h=0.0,j=0.0,l=0.0,m=0.0,n=0,p=0.0,q=0.0,s=0.0,t=0,u=0,v=0.0;t=r;r=r+288|0;u=k[a+4>>2]|0;i[u+312>>0]=0;k[u>>2]=0;i[u+356>>0]=1;o[u+292>>2]=999999984306749440.0;o[u+296>>2]=999999984306749440.0;o[u+300>>2]=999999984306749440.0;o[u+304>>2]=0.0;k[u+336>>2]=0;k[u+336+4>>2]=0;k[u+336+8>>2]=0;k[u+336+12>>2]=0;i[u+336+16>>0]=0;i[u+332>>0]=i[u+332>>0]&-16;p=+o[c+48>>2]-+o[b+48>>2]-(+o[e+48>>2]-+o[d+48>>2]);q=+o[c+52>>2]-+o[b+52>>2]-(+o[e+52>>2]-+o[d+52>>2]);s=+o[c+56>>2]-+o[b+56>>2]-(+o[e+56>>2]-+o[d+56>>2]);k[t+216>>2]=19192;o[t+216+36>>2]=999999984306749440.0;i[t+216+40>>0]=0;u=k[a+8>>2]|0;n=k[a+12>>2]|0;a=k[a+4>>2]|0;k[t+136>>2]=19400;o[t+136+4>>2]=0.0;o[t+136+8>>2]=1.0;o[t+136+12>>2]=0.0;o[t+136+16>>2]=0.0;k[t+136+20>>2]=0;k[t+136+24>>2]=a;k[t+136+28>>2]=u;k[t+136+32>>2]=n;k[t+136+36>>2]=k[u+4>>2];k[t+136+40>>2]=k[n+4>>2];m=+gc[k[(k[u>>2]|0)+48>>2]&15](u);o[t+136+44>>2]=m;m=+gc[k[(k[n>>2]|0)+48>>2]&15](n);o[t+136+48>>2]=m;i[t+136+52>>0]=0;k[t+136+60>>2]=-1;k[t+136+72>>2]=1;k[t+136+76>>2]=1;o[t+128>>2]=999999984306749440.0;k[t>>2]=k[b>>2];k[t+4>>2]=k[b+4>>2];k[t+8>>2]=k[b+8>>2];k[t+12>>2]=k[b+12>>2];k[t+16>>2]=k[b+16>>2];k[t+16+4>>2]=k[b+16+4>>2];k[t+16+8>>2]=k[b+16+8>>2];k[t+16+12>>2]=k[b+16+12>>2];k[t+32>>2]=k[b+32>>2];k[t+32+4>>2]=k[b+32+4>>2];k[t+32+8>>2]=k[b+32+8>>2];k[t+32+12>>2]=k[b+32+12>>2];k[t+48>>2]=k[b+48>>2];k[t+48+4>>2]=k[b+48+4>>2];k[t+48+8>>2]=k[b+48+8>>2];k[t+48+12>>2]=k[b+48+12>>2];k[t+64>>2]=k[d>>2];k[t+64+4>>2]=k[d+4>>2];k[t+64+8>>2]=k[d+8>>2];k[t+64+12>>2]=k[d+12>>2];k[t+80>>2]=k[d+16>>2];k[t+80+4>>2]=k[d+16+4>>2];k[t+80+8>>2]=k[d+16+8>>2];k[t+80+12>>2]=k[d+16+12>>2];k[t+96>>2]=k[d+32>>2];k[t+96+4>>2]=k[d+32+4>>2];k[t+96+8>>2]=k[d+32+8>>2];k[t+96+12>>2]=k[d+32+12>>2];k[t+112>>2]=k[d+48>>2];k[t+112+4>>2]=k[d+48+4>>2];k[t+112+8>>2]=k[d+48+8>>2];k[t+112+12>>2]=k[d+48+12>>2];Zv(t+136|0,t,t+216|0,0,0);a=(i[t+216+40>>0]|0)==0;n=t+216+20|0;k[t+264>>2]=k[n>>2];k[t+264+4>>2]=k[n+4>>2];k[t+264+8>>2]=k[n+8>>2];k[t+264+12>>2]=k[n+12>>2];if(a){u=0;r=t;return u|0}m=+o[t+216+36>>2];h=+o[t+216+4>>2];j=+o[t+216+8>>2];l=+o[t+216+12>>2];g=+o[t+216+16>>2];do if(m>1.0000000474974513e-03){g=0.0;a=0;while(1){if((a|0)>31){a=0;b=13;break}v=g;g=g-m/(s*l+(q*j+p*h));if(!(!(g<=v)&(!(g<0.0)&!(g>1.0)))){a=0;b=13;break}Rb[k[k[f>>2]>>2]&31](f,g);v=1.0-g;o[t+48>>2]=v*+o[b+48>>2]+g*+o[c+48>>2];o[t+52>>2]=v*+o[b+52>>2]+g*+o[c+52>>2];o[t+56>>2]=v*+o[b+56>>2]+g*+o[c+56>>2];o[t+112>>2]=v*+o[d+48>>2]+g*+o[e+48>>2];o[t+116>>2]=v*+o[d+52>>2]+g*+o[e+52>>2];o[t+120>>2]=v*+o[d+56>>2]+g*+o[e+56>>2];Zv(t+136|0,t,t+216|0,0,0);if(!(i[t+216+40>>0]|0)){a=0;b=13;break}m=+o[t+216+36>>2];if(m<0.0){b=8;break};k[t+264>>2]=k[n>>2];k[t+264+4>>2]=k[n+4>>2];k[t+264+8>>2]=k[n+8>>2];k[t+264+12>>2]=k[n+12>>2];h=+o[t+216+4>>2];j=+o[t+216+8>>2];l=+o[t+216+12>>2];if(!(m>1.0000000474974513e-03)){b=10;break}else a=a+1|0}if((b|0)==8){o[f+164>>2]=g;m=+o[t+216+8>>2];p=+o[t+216+12>>2];v=+o[t+216+16>>2];o[f+132>>2]=+o[t+216+4>>2];o[f+136>>2]=m;o[f+140>>2]=p;o[f+144>>2]=v;k[f+148>>2]=k[n>>2];k[f+148+4>>2]=k[n+4>>2];k[f+148+8>>2]=k[n+8>>2];k[f+148+12>>2]=k[n+12>>2];u=1;r=t;return u|0}else if((b|0)==10){m=+o[t+216+16>>2];break}else if((b|0)==13){r=t;return a|0}}else{m=g;g=0.0}while(0);if(s*l+(q*j+p*h)>=-+o[f+172>>2]){u=0;r=t;return u|0}o[f+164>>2]=g;o[f+132>>2]=h;o[f+136>>2]=j;o[f+140>>2]=l;o[f+144>>2]=m;k[f+148>>2]=k[t+264>>2];k[f+148+4>>2]=k[t+264+4>>2];k[f+148+8>>2]=k[t+264+8>>2];k[f+148+12>>2]=k[t+264+12>>2];u=1;r=t;return u|0}function Uv(a){a=a|0;return}function Vv(a,b,c,d,e,f,g,h,i,j,k){a=a|0;b=b|0;c=+c;d=+d;e=+e;f=+f;g=+g;h=+h;i=i|0;j=j|0;k=+k;var l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0;w=+o[a>>2]*f+ +o[a+16>>2]*g+ +o[a+32>>2]*h;x=+o[a+4>>2]*f+ +o[a+20>>2]*g+ +o[a+36>>2]*h;t=+o[a+8>>2]*f+ +o[a+24>>2]*g+ +o[a+40>>2]*h;u=+o[b>>2]*f+ +o[b+16>>2]*g+ +o[b+32>>2]*h;v=+o[b+4>>2]*f+ +o[b+20>>2]*g+ +o[b+36>>2]*h;s=+o[b+8>>2]*f+ +o[b+24>>2]*g+ +o[b+40>>2]*h;l=+o[i+80>>2];if(w<0.0)l=-l;m=+o[i+84>>2];if(x<0.0)m=-m;n=+o[i+88>>2];if(t<0.0)n=-n;p=+o[j+80>>2];if(u<0.0)p=-p;q=+o[j+84>>2];if(v<0.0)q=-q;r=+o[j+88>>2];if(!(s<0.0)){w=w*l;x=x*m;x=w+x;t=t*n;t=x+t;u=u*p;x=v*q;x=u+x;u=s*r;u=x+u;i=i+96|0;x=+o[i>>2];i=t>x;x=i?t:x;j=j+96|0;v=+o[j>>2];j=u>v;v=j?u:v;v=x+v;x=c*f+d*g+e*h+v;e=v-(c*f+d*g+e*h);j=x<e;e=j?x:e;j=!(e>k);return j|0}r=-r;w=w*l;x=x*m;x=w+x;t=t*n;t=x+t;u=u*p;x=v*q;x=u+x;u=s*r;u=x+u;i=i+96|0;x=+o[i>>2];i=t>x;x=i?t:x;j=j+96|0;v=+o[j>>2];j=u>v;v=j?u:v;v=x+v;x=c*f+d*g+e*h+v;e=v-(c*f+d*g+e*h);j=x<e;e=j?x:e;j=!(e>k);return j|0}function Wv(a,b,c,d,e,f,g){a=a|0;b=b|0;c=c|0;d=d|0;e=+e;f=+f;g=g|0;var h=0,j=0,l=0.0,m=0,n=0.0,p=0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0,D=0,E=0.0,F=0.0,G=0.0,H=0,I=0,J=0,K=0,L=0,M=0.0,N=0.0,O=0.0,P=0.0,Q=0.0,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=0,Z=0,_=0,$=0,aa=0,ba=0,ca=0,da=0,ea=0;da=r;r=r+64|0;i[da+32+16>>0]=1;k[da+32+12>>2]=0;k[da+32+4>>2]=0;k[da+32+8>>2]=0;j=k[d+4>>2]|0;if((j|0)>0){k[5108]=(k[5108]|0)+1;h=iF((j<<4|3)+16|0)|0;if(!h)h=0;else{k[(h+4+15&-16)+-4>>2]=h;h=h+4+15&-16}i[da+32+16>>0]=1;k[da+32+12>>2]=h;k[da+32+8>>2]=j}else h=0;m=k[b+28>>2]|0;if((m|0)>0){ba=k[b+36>>2]|0;A=+o[c>>2];B=+o[c+4>>2];E=+o[c+8>>2];F=+o[c+16>>2];G=+o[c+20>>2];s=+o[c+24>>2];l=+o[c+32>>2];q=+o[c+36>>2];n=+o[c+40>>2];t=+o[a>>2];u=+o[a+4>>2];v=+o[a+8>>2];ca=-1;z=3402823466385288598117041.0e14;j=0;while(1){w=+o[ba+(j*36|0)+20>>2];x=+o[ba+(j*36|0)+24>>2];y=+o[ba+(j*36|0)+28>>2];p=(w*A+x*B+y*E)*t+(w*F+x*G+y*s)*u+(w*l+x*q+y*n)*v<z;ca=p?j:ca;if((j|0)==(m+-1|0))break;else{z=p?(w*A+x*B+y*E)*t+(w*F+x*G+y*s)*u+(w*l+x*q+y*n)*v:z;j=j+1|0}}if((ca|0)>=0){T=k[ba+(ca*36|0)+4>>2]|0;if((T|0)>0){U=ba+(ca*36|0)+12|0;X=ba+(ca*36|0)+20|0;V=ba+(ca*36|0)+24|0;W=ba+(ca*36|0)+28|0;z=A;u=B;w=E;y=F;v=G;S=0;R=d;Y=da+32|0;while(1){L=k[U>>2]|0;j=k[L+(S<<2)>>2]|0;d=k[b+16>>2]|0;S=S+1|0;L=k[L+(((S|0)==(T|0)?0:S)<<2)>>2]|0;E=+o[d+(j<<4)>>2];B=E-+o[d+(L<<4)>>2];F=+o[d+(j<<4)+4>>2];A=F-+o[d+(L<<4)+4>>2];G=+o[d+(j<<4)+8>>2];N=G-+o[d+(L<<4)+8>>2];x=B*z+A*u+N*w;M=B*y+A*v+N*s;N=B*l+A*q+N*n;A=+o[X>>2];B=+o[V>>2];Q=+o[W>>2];O=z*A+u*B+w*Q;P=y*A+v*B+s*Q;Q=l*A+q*B+n*Q;w=(E*z+F*u+G*w+ +o[c+48>>2])*-(M*Q-N*P)+(E*y+F*v+G*s+ +o[c+52>>2])*-(N*O-x*Q)+(E*l+F*q+G*n+ +o[c+56>>2])*-(x*P-M*O);L=R+4|0;d=k[L>>2]|0;if((d|0)>=2){h=R+12|0;m=k[h>>2]|0;F=+o[m+(d+-1<<4)>>2];G=+o[m+(d+-1<<4)+4>>2];z=+o[m+(d+-1<<4)+8>>2];H=Y+4|0;I=Y+8|0;J=Y+12|0;C=Y+16|0;A=F;B=G;E=z;z=F*-(M*Q-N*P)+G*-(N*O-x*Q)+z*-(x*P-M*O)-w;K=0;while(1){v=+o[m+(K<<4)>>2];u=+o[m+(K<<4)+4>>2];t=+o[m+(K<<4)+8>>2];y=+o[m+(K<<4)+12>>2];s=v*-(M*Q-N*P)+u*-(N*O-x*Q)+t*-(x*P-M*O)-w;do if(z<0.0)if(s<0.0){m=k[H>>2]|0;if((m|0)==(k[I>>2]|0)?(aa=(m|0)==0?1:m<<1,(m|0)<(aa|0)):0){if(!aa)j=0;else{k[5108]=(k[5108]|0)+1;m=iF((aa<<4|3)+16|0)|0;if(!m)m=0;else{k[(m+4+15&-16)+-4>>2]=m;m=m+4+15&-16}j=m;m=k[H>>2]|0}if((m|0)>0){m=m+-1|0;p=0;while(1){D=j+(p<<4)|0;ea=(k[J>>2]|0)+(p<<4)|0;k[D>>2]=k[ea>>2];k[D+4>>2]=k[ea+4>>2];k[D+8>>2]=k[ea+8>>2];k[D+12>>2]=k[ea+12>>2];if((p|0)==(m|0))break;else p=p+1|0}}m=k[J>>2]|0;if(m){if(i[C>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[m+-4>>2]|0)}k[J>>2]=0}i[C>>0]=1;k[J>>2]=j;k[I>>2]=aa;m=k[H>>2]|0}ea=k[J>>2]|0;o[ea+(m<<4)>>2]=v;o[ea+(m<<4)+4>>2]=u;o[ea+(m<<4)+8>>2]=t;o[ea+(m<<4)+12>>2]=y;k[H>>2]=(k[H>>2]|0)+1;break}else{F=z/(z-s);G=A+(v-A)*F;B=B+(u-B)*F;F=E+(t-E)*F;m=k[H>>2]|0;if((m|0)==(k[I>>2]|0)?($=(m|0)==0?1:m<<1,(m|0)<($|0)):0){if(!$)D=0;else{k[5108]=(k[5108]|0)+1;m=iF(($<<4|3)+16|0)|0;if(!m)m=0;else{k[(m+4+15&-16)+-4>>2]=m;m=m+4+15&-16}D=m;m=k[H>>2]|0}if((m|0)>0){m=m+-1|0;p=0;while(1){ea=D+(p<<4)|0;j=(k[J>>2]|0)+(p<<4)|0;k[ea>>2]=k[j>>2];k[ea+4>>2]=k[j+4>>2];k[ea+8>>2]=k[j+8>>2];k[ea+12>>2]=k[j+12>>2];if((p|0)==(m|0))break;else p=p+1|0}}m=k[J>>2]|0;if(m){if(i[C>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[m+-4>>2]|0)}k[J>>2]=0}i[C>>0]=1;k[J>>2]=D;k[I>>2]=$;m=k[H>>2]|0}ea=k[J>>2]|0;o[ea+(m<<4)>>2]=G;o[ea+(m<<4)+4>>2]=B;o[ea+(m<<4)+8>>2]=F;o[ea+(m<<4)+12>>2]=0.0;k[H>>2]=(k[H>>2]|0)+1;break}else if(s<0.0){G=z/(z-s);A=A+(v-A)*G;F=B+(u-B)*G;G=E+(t-E)*G;m=k[H>>2]|0;if((m|0)==(k[I>>2]|0)?(_=(m|0)==0?1:m<<1,(m|0)<(_|0)):0){if(!_)D=0;else{k[5108]=(k[5108]|0)+1;m=iF((_<<4|3)+16|0)|0;if(!m)m=0;else{k[(m+4+15&-16)+-4>>2]=m;m=m+4+15&-16}D=m;m=k[H>>2]|0}if((m|0)>0){m=m+-1|0;p=0;while(1){ea=D+(p<<4)|0;j=(k[J>>2]|0)+(p<<4)|0;k[ea>>2]=k[j>>2];k[ea+4>>2]=k[j+4>>2];k[ea+8>>2]=k[j+8>>2];k[ea+12>>2]=k[j+12>>2];if((p|0)==(m|0))break;else p=p+1|0}}m=k[J>>2]|0;if(m){if(i[C>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[m+-4>>2]|0)}k[J>>2]=0}i[C>>0]=1;k[J>>2]=D;k[I>>2]=_;m=k[H>>2]|0}ea=k[J>>2]|0;o[ea+(m<<4)>>2]=A;o[ea+(m<<4)+4>>2]=F;o[ea+(m<<4)+8>>2]=G;o[ea+(m<<4)+12>>2]=0.0;m=(k[H>>2]|0)+1|0;k[H>>2]=m;if((m|0)==(k[I>>2]|0)?(Z=(m|0)==0?1:m<<1,(m|0)<(Z|0)):0){if(!Z)j=0;else{k[5108]=(k[5108]|0)+1;m=iF((Z<<4|3)+16|0)|0;if(!m)m=0;else{k[(m+4+15&-16)+-4>>2]=m;m=m+4+15&-16}j=m;m=k[H>>2]|0}if((m|0)>0){m=m+-1|0;p=0;while(1){ea=j+(p<<4)|0;D=(k[J>>2]|0)+(p<<4)|0;k[ea>>2]=k[D>>2];k[ea+4>>2]=k[D+4>>2];k[ea+8>>2]=k[D+8>>2];k[ea+12>>2]=k[D+12>>2];if((p|0)==(m|0))break;else p=p+1|0}}m=k[J>>2]|0;if(m){if(i[C>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[m+-4>>2]|0)}k[J>>2]=0}i[C>>0]=1;k[J>>2]=j;k[I>>2]=Z;m=k[H>>2]|0}ea=k[J>>2]|0;o[ea+(m<<4)>>2]=v;o[ea+(m<<4)+4>>2]=u;o[ea+(m<<4)+8>>2]=t;o[ea+(m<<4)+12>>2]=y;k[H>>2]=(k[H>>2]|0)+1}while(0);if((K|0)==(d+-1|0))break;m=k[h>>2]|0;A=v;B=u;E=t;z=s;K=K+1|0}d=k[L>>2]|0}if((d|0)<0){p=R+8|0;h=R+12|0;if((k[p>>2]|0)<0){j=k[h>>2]|0;m=R+16|0;if(j){if(i[m>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[j+-4>>2]|0)}k[h>>2]=0}i[m>>0]=1;k[h>>2]=0;k[p>>2]=0}while(1){ea=(k[h>>2]|0)+(d<<4)|0;k[ea>>2]=k[da+16>>2];k[ea+4>>2]=k[da+16+4>>2];k[ea+8>>2]=k[da+16+8>>2];k[ea+12>>2]=k[da+16+12>>2];if((d|0)==-1)break;else d=d+1|0}}k[L>>2]=0;z=+o[c>>2];u=+o[c+4>>2];w=+o[c+8>>2];y=+o[c+16>>2];v=+o[c+20>>2];s=+o[c+24>>2];l=+o[c+32>>2];q=+o[c+36>>2];n=+o[c+40>>2];if((S|0)>=(T|0)){j=V;p=W;C=c+48|0;D=c+52|0;h=c+56|0;m=X;d=Y;break}else{ea=Y;Y=R;R=ea}}}else{j=ba+(ca*36|0)+24|0;p=ba+(ca*36|0)+28|0;C=c+48|0;D=c+52|0;h=c+56|0;m=ba+(ca*36|0)+20|0;z=A;u=B;w=E;y=F;v=G}F=+o[m>>2];G=+o[j>>2];N=+o[p>>2];t=F*z+G*u+N*w;s=F*y+G*v+N*s;q=F*l+G*q+N*n;n=+o[ba+(ca*36|0)+32>>2]-(t*+o[C>>2]+s*+o[D>>2]+q*+o[h>>2]);p=d+4|0;h=k[p>>2]|0;if((h|0)>0){d=d+12|0;m=0;do{ea=k[d>>2]|0;j=ea+(m<<4)|0;l=n+(t*+o[j>>2]+s*+o[ea+(m<<4)+4>>2]+q*+o[ea+(m<<4)+8>>2]);l=l<=e?e:l;if(l<=f){k[da>>2]=k[j>>2];k[da+4>>2]=k[j+4>>2];k[da+8>>2]=k[j+8>>2];k[da+12>>2]=k[j+12>>2];xc[k[(k[g>>2]|0)+16>>2]&15](g,a,da,l);h=k[p>>2]|0}m=m+1|0}while((m|0)<(h|0))}h=k[da+32+12>>2]|0}}if(!h){r=da;return}if(i[da+32+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[h+-4>>2]|0)}k[da+32+12>>2]=0;r=da;return}function Xv(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0.0,g=0.0,h=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0,L=0,M=0,N=0,O=0;e=r;r=r+288|0;if(!(k[a+16>>2]|0)){K=k[a+12>>2]|0;a=k[a+20>>2]|0;l=+o[b>>2];p=+o[b+4>>2];u=+o[b+8>>2];g=+o[b+16>>2];q=+o[b+20>>2];f=+o[b+24>>2];j=+o[b+32>>2];s=+o[b+36>>2];h=+o[b+40>>2];F=+o[b+48>>2];E=+o[b+52>>2];D=+o[b+56>>2];J=+o[c>>2];I=+o[c+16>>2];y=+o[c+32>>2];H=+o[c+4>>2];G=+o[c+20>>2];w=+o[c+36>>2];v=+o[c+8>>2];z=+o[c+24>>2];x=+o[c+40>>2];C=-+o[c+48>>2];B=-+o[c+52>>2];n=-+o[c+56>>2];b=k[(k[K>>2]|0)+64>>2]|0;A=-+o[a+48>>2];t=-+o[a+52>>2];m=-+o[a+56>>2];o[e+32>>2]=(l*J+g*I+j*y)*A+(l*H+g*G+j*w)*t+(l*v+g*z+j*x)*m;o[e+32+4>>2]=(p*J+q*I+s*y)*A+(p*H+q*G+s*w)*t+(p*v+q*z+s*x)*m;o[e+32+8>>2]=(u*J+f*I+h*y)*A+(u*H+f*G+h*w)*t+(u*v+f*z+h*x)*m;o[e+32+12>>2]=0.0;yc[b&127](e+48|0,K,e+32|0);m=+o[e+48>>2];t=+o[e+48+4>>2];A=+o[e+48+8>>2];y=F*J+E*I+D*y+(J*C+I*B+y*n)+((l*J+g*I+j*y)*m+(p*J+q*I+s*y)*t+(u*J+f*I+h*y)*A);w=F*H+E*G+D*w+(H*C+G*B+w*n)+((l*H+g*G+j*w)*m+(p*H+q*G+s*w)*t+(u*H+f*G+h*w)*A);A=F*v+E*z+D*x+(v*C+z*B+x*n)+((l*v+g*z+j*x)*m+(p*v+q*z+s*x)*t+(u*v+f*z+h*x)*A);x=+o[a+48>>2];h=+o[a+52>>2];z=+o[a+56>>2];f=z*A+(x*y+h*w)-+o[a+64>>2];v=+o[c>>2];u=+o[c+4>>2];t=+o[c+8>>2];s=+o[c+16>>2];q=+o[c+20>>2];p=+o[c+24>>2];m=+o[c+32>>2];j=+o[c+36>>2];g=+o[c+40>>2];l=s*(y-x*f)+(w-h*f)*q+(A-z*f)*p+ +o[c+52>>2];n=(y-x*f)*m+(w-h*f)*j+(A-z*f)*g+ +o[c+56>>2];o[e+16>>2]=t*(A-z*f)+(v*(y-x*f)+u*(w-h*f))+ +o[c+48>>2];o[e+16+4>>2]=l;o[e+16+8>>2]=n;o[e+16+12>>2]=0.0;n=+o[a+48>>2];l=+o[a+52>>2];h=+o[a+56>>2];o[e>>2]=v*n+u*l+t*h;o[e+4>>2]=n*s+l*q+h*p;o[e+8>>2]=n*m+l*j+h*g;o[e+12>>2]=0.0;xc[k[(k[d>>2]|0)+16>>2]&15](d,e,e+16|0,f);r=e;return}else{N=k[a+4>>2]|0;i[N+312>>0]=0;k[N>>2]=0;i[N+356>>0]=1;o[N+292>>2]=999999984306749440.0;o[N+296>>2]=999999984306749440.0;o[N+300>>2]=999999984306749440.0;o[N+304>>2]=0.0;k[N+336>>2]=0;k[N+336+4>>2]=0;k[N+336+8>>2]=0;k[N+336+12>>2]=0;i[N+336+16>>0]=0;i[N+332>>0]=i[N+332>>0]&-16;N=k[a+12>>2]|0;M=k[a+16>>2]|0;L=k[N+4>>2]|0;K=k[M+4>>2]|0;I=+gc[k[(k[N>>2]|0)+48>>2]&15](N);O=k[a+16>>2]|0;J=+gc[k[(k[O>>2]|0)+48>>2]&15](O);O=k[a+4>>2]|0;a=k[a+8>>2]|0;k[e+200>>2]=19400;o[e+200+4>>2]=0.0;o[e+200+8>>2]=1.0;o[e+200+12>>2]=0.0;o[e+200+16>>2]=0.0;k[e+200+20>>2]=a;k[e+200+24>>2]=O;k[e+200+28>>2]=N;k[e+200+32>>2]=M;k[e+200+36>>2]=L;k[e+200+40>>2]=K;o[e+200+44>>2]=I;o[e+200+48>>2]=J;i[e+200+52>>0]=0;k[e+200+60>>2]=-1;k[e+200+72>>2]=1;k[e+200+76>>2]=1;o[e+64+128>>2]=999999984306749440.0;k[e+64>>2]=k[b>>2];k[e+64+4>>2]=k[b+4>>2];k[e+64+8>>2]=k[b+8>>2];k[e+64+12>>2]=k[b+12>>2];k[e+64+16>>2]=k[b+16>>2];k[e+64+16+4>>2]=k[b+16+4>>2];k[e+64+16+8>>2]=k[b+16+8>>2];k[e+64+16+12>>2]=k[b+16+12>>2];k[e+64+32>>2]=k[b+32>>2];k[e+64+32+4>>2]=k[b+32+4>>2];k[e+64+32+8>>2]=k[b+32+8>>2];k[e+64+32+12>>2]=k[b+32+12>>2];k[e+64+48>>2]=k[b+48>>2];k[e+64+48+4>>2]=k[b+48+4>>2];k[e+64+48+8>>2]=k[b+48+8>>2];k[e+64+48+12>>2]=k[b+48+12>>2];k[e+64+64>>2]=k[c>>2];k[e+64+64+4>>2]=k[c+4>>2];k[e+64+64+8>>2]=k[c+8>>2];k[e+64+64+12>>2]=k[c+12>>2];k[e+64+80>>2]=k[c+16>>2];k[e+64+80+4>>2]=k[c+16+4>>2];k[e+64+80+8>>2]=k[c+16+8>>2];k[e+64+80+12>>2]=k[c+16+12>>2];k[e+64+96>>2]=k[c+32>>2];k[e+64+96+4>>2]=k[c+32+4>>2];k[e+64+96+8>>2]=k[c+32+8>>2];k[e+64+96+12>>2]=k[c+32+12>>2];k[e+64+112>>2]=k[c+48>>2];k[e+64+112+4>>2]=k[c+48+4>>2];k[e+64+112+8>>2]=k[c+48+8>>2];k[e+64+112+12>>2]=k[c+48+12>>2];Zv(e+200|0,e+64|0,d,0,0);r=e;return}}function Yv(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;var g=0.0,h=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0;D=r;r=r+304|0;C=+o[c+48>>2]-+o[b+48>>2];A=+o[c+52>>2]-+o[b+52>>2];B=+o[c+56>>2]-+o[b+56>>2];Rw(b,c,D+240|0,D+112|0);q=+o[D+112>>2];n=+o[D+240>>2]*q;p=q*+o[D+240+4>>2];q=q*+o[D+240+8>>2];o[D+16>>2]=n;o[D+16+4>>2]=p;o[D+16+8>>2]=q;o[D+16+12>>2]=0.0;x=+o[e+48>>2]-+o[d+48>>2];y=+o[e+52>>2]-+o[d+52>>2];z=+o[e+56>>2]-+o[d+56>>2];Rw(d,e,D+240|0,D+112|0);l=+o[D+112>>2];g=+o[D+240>>2]*l;j=l*+o[D+240+4>>2];l=l*+o[D+240+8>>2];o[D+32>>2]=g;o[D+32+4>>2]=j;o[D+32+8>>2]=l;o[D+32+12>>2]=0.0;e=k[a+12>>2]|0;m=+gc[k[(k[e>>2]|0)+16>>2]&15](e);e=k[a+16>>2]|0;if(!e)h=0.0;else h=+gc[k[(k[e>>2]|0)+16>>2]&15](e);w=m*+Y(+(n*n+p*p+q*q))+h*+Y(+(g*g+j*j+l*l));if(w+ +Y(+((x-C)*(x-C)+(y-A)*(y-A)+(z-B)*(z-B)))==0.0){b=0;r=D;return b|0}k[D+240>>2]=19192;o[D+240+36>>2]=999999984306749440.0;i[D+240+40>>0]=0;Xv(a,b,d,D+240|0);c=(i[D+240+40>>0]|0)==0;k[D+288>>2]=k[D+240+20>>2];k[D+288+4>>2]=k[D+240+20+4>>2];k[D+288+8>>2]=k[D+240+20+8>>2];k[D+288+12>>2]=k[D+240+20+12>>2];a:do if(!c?(s=+o[D+240+4>>2],t=+o[D+240+8>>2],v=+o[D+240+12>>2],!(w+((x-C)*s+(y-A)*t+(z-B)*v)<=1.1920928955078125e-07)):0){n=t;p=v;m=+o[D+240+16>>2];l=+o[D+240+36>>2]+ +o[f+172>>2];q=0.0;u=0;while(1){if(!(l>1.0000000474974513e-03)){c=20;break}c=k[f+168>>2]|0;if(c){e=k[(k[c>>2]|0)+20>>2]|0;o[D>>2]=1.0;o[D+4>>2]=1.0;o[D+8>>2]=1.0;o[D+12>>2]=0.0;Xb[e&7](c,D+288|0,.20000000298023224,D)}g=w+((z-B)*p+((y-A)*n+(x-C)*s));if(g<=1.1920928955078125e-07){c=0;break a}j=q+l/g;if(!(!(j<=q)&(!(j<0.0)&!(j>1.0)))){c=0;break a}Qw(b,C,A,B,D+16|0,j,D+112|0);Qw(d,x,y,z,D+32|0,j,D+48|0);c=k[f+168>>2]|0;if(c){e=k[(k[c>>2]|0)+20>>2]|0;o[D+224>>2]=1.0;o[D+224+4>>2]=0.0;o[D+224+8>>2]=0.0;o[D+224+12>>2]=0.0;Xb[e&7](c,D+112+48|0,.20000000298023224,D+224|0)}Rb[k[k[f>>2]>>2]&31](f,j);k[D+176>>2]=19192;o[D+176+36>>2]=999999984306749440.0;i[D+176+40>>0]=0;Xv(a,D+112|0,D+48|0,D+176|0);if(!(i[D+176+40>>0]|0)){c=16;break}g=+o[D+176+36>>2];h=+o[f+172>>2];k[D+288>>2]=k[D+176+20>>2];k[D+288+4>>2]=k[D+176+20+4>>2];k[D+288+8>>2]=k[D+176+20+8>>2];k[D+288+12>>2]=k[D+176+20+12>>2];e=u+1|0;if((u|0)>63){c=17;break}s=+o[D+176+4>>2];n=+o[D+176+8>>2];p=+o[D+176+12>>2];m=+o[D+176+16>>2];l=g+h;q=j;u=e}if((c|0)==16)yc[k[(k[f>>2]|0)+8>>2]&127](f,-1,u);else if((c|0)==17)yc[k[(k[f>>2]|0)+8>>2]&127](f,-2,e);else if((c|0)==20){o[f+164>>2]=q;o[f+132>>2]=s;o[f+136>>2]=n;o[f+140>>2]=p;o[f+144>>2]=m;k[f+148>>2]=k[D+288>>2];k[f+148+4>>2]=k[D+288+4>>2];k[f+148+8>>2]=k[D+288+8>>2];k[f+148+12>>2]=k[D+288+12>>2];c=1;break}c=0}else c=0;while(0);b=c;r=D;return b|0}function Zv(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0.0,g=0.0,h=0.0,j=0.0,l=0.0,m=0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0,v=0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0,K=0.0,L=0.0,M=0.0,N=0,O=0.0;J=r;r=r+288|0;o[a+56>>2]=0.0;k[J>>2]=0;k[J+4>>2]=0;k[J+8>>2]=0;k[J+12>>2]=0;k[J+32>>2]=k[b>>2];k[J+32+4>>2]=k[b+4>>2];k[J+32+8>>2]=k[b+8>>2];k[J+32+12>>2]=k[b+12>>2];k[J+32+16>>2]=k[b+16>>2];k[J+32+16+4>>2]=k[b+16+4>>2];k[J+32+16+8>>2]=k[b+16+8>>2];k[J+32+16+12>>2]=k[b+16+12>>2];k[J+32+32>>2]=k[b+32>>2];k[J+32+32+4>>2]=k[b+32+4>>2];k[J+32+32+8>>2]=k[b+32+8>>2];k[J+32+32+12>>2]=k[b+32+12>>2];u=J+32+48|0;k[u>>2]=k[b+48>>2];k[u+4>>2]=k[b+48+4>>2];k[u+8>>2]=k[b+48+8>>2];k[u+12>>2]=k[b+48+12>>2];k[J+192>>2]=k[b+64>>2];k[J+192+4>>2]=k[b+64+4>>2];k[J+192+8>>2]=k[b+64+8>>2];k[J+192+12>>2]=k[b+64+12>>2];k[J+192+16>>2]=k[b+80>>2];k[J+192+16+4>>2]=k[b+80+4>>2];k[J+192+16+8>>2]=k[b+80+8>>2];k[J+192+16+12>>2]=k[b+80+12>>2];k[J+192+32>>2]=k[b+96>>2];k[J+192+32+4>>2]=k[b+96+4>>2];k[J+192+32+8>>2]=k[b+96+8>>2];k[J+192+32+12>>2]=k[b+96+12>>2];v=J+192+48|0;k[v>>2]=k[b+112>>2];k[v+4>>2]=k[b+112+4>>2];k[v+8>>2]=k[b+112+8>>2];k[v+12>>2]=k[b+112+12>>2];D=+o[u>>2];E=+o[v>>2];F=+o[J+32+52>>2];G=+o[J+192+52>>2];H=+o[J+32+56>>2];I=+o[J+192+56>>2];o[u>>2]=D-(D+E)*.5;o[J+32+52>>2]=F-(F+G)*.5;o[J+32+56>>2]=H-(H+I)*.5;o[v>>2]=E-(D+E)*.5;o[J+192+52>>2]=G-(F+G)*.5;o[J+192+56>>2]=I-(H+I)*.5;if(((k[(k[a+28>>2]|0)+4>>2]|0)+-17|0)>>>0<2)e=((k[(k[a+32>>2]|0)+4>>2]|0)+-17|0)>>>0<2;else e=0;w=+o[a+44>>2];C=+o[a+48>>2];k[4846]=(k[4846]|0)+1;v=(i[a+52>>0]|0)==0;C=v?C:0.0;k[a+64>>2]=0;o[a+4>>2]=0.0;o[a+8>>2]=1.0;o[a+12>>2]=0.0;o[a+16>>2]=0.0;k[a+68>>2]=0;k[a+60>>2]=-1;w=(v?w:0.0)+C;v=k[a+24>>2]|0;i[v+312>>0]=0;k[v>>2]=0;i[v+356>>0]=1;o[v+292>>2]=999999984306749440.0;o[v+296>>2]=999999984306749440.0;o[v+300>>2]=999999984306749440.0;o[v+304>>2]=0.0;k[v+336>>2]=0;k[v+336+4>>2]=0;k[v+336+8>>2]=0;k[v+336+12>>2]=0;i[v+336+16>>0]=0;i[v+332>>0]=i[v+332>>0]&-16;g=+o[a+4>>2];f=+o[a+8>>2];h=+o[a+12>>2];a:do if(e){j=f;f=999999984306749440.0;while(1){l=-g;t=-j;s=-h;q=+o[b+4>>2]*l+ +o[b+20>>2]*t+ +o[b+36>>2]*s;A=+o[b+8>>2]*l+ +o[b+24>>2]*t+ +o[b+40>>2]*s;o[J+112>>2]=+o[b>>2]*l+ +o[b+16>>2]*t+ +o[b+32>>2]*s;o[J+112+4>>2]=q;o[J+112+8>>2]=A;o[J+112+12>>2]=0.0;A=g*+o[b+68>>2]+j*+o[b+84>>2]+h*+o[b+100>>2];q=g*+o[b+72>>2]+j*+o[b+88>>2]+h*+o[b+104>>2];o[J+176>>2]=+o[b+64>>2]*g+ +o[b+80>>2]*j+ +o[b+96>>2]*h;o[J+176+4>>2]=A;o[J+176+8>>2]=q;o[J+176+12>>2]=0.0;$t(J+256|0,k[a+28>>2]|0,J+112|0);$t(J+272|0,k[a+32>>2]|0,J+176|0);q=+o[J+256>>2];A=+o[J+256+4>>2];s=+o[J+256+8>>2];t=q*+o[J+32>>2]+A*+o[J+32+4>>2]+s*+o[J+32+8>>2]+ +o[J+32+48>>2];s=q*+o[J+32+16>>2]+A*+o[J+32+20>>2]+s*+o[J+32+24>>2]+ +o[J+32+52>>2];A=+o[J+272>>2];q=+o[J+272+4>>2];l=+o[J+272+8>>2];n=A*+o[J+192>>2]+q*+o[J+192+4>>2]+l*+o[J+192+8>>2]+ +o[J+192+48>>2];l=A*+o[J+192+16>>2]+q*+o[J+192+20>>2]+l*+o[J+192+24>>2]+ +o[J+192+52>>2];q=+o[a+4>>2]*(t-n)+ +o[a+8>>2]*(s-l)+ +o[a+12>>2]*0.0;if(q>0.0?q*q>f*+o[b+128>>2]:0){N=22;break a}u=k[a+24>>2]|0;v=k[u>>2]|0;if((v|0)>0){p=+o[u+308>>2];m=0;e=0;while(1){y=t-n-+o[u+4+(e<<4)>>2];z=s-l-+o[u+4+(e<<4)+4>>2];A=0.0-+o[u+4+(e<<4)+8>>2];m=m|y*y+z*z+A*A<=p;if((e|0)==(v+-1|0))break;else e=e+1|0}}else m=0;if((+o[u+304>>2]==0.0?+o[u+300>>2]==0.0:0)?s-l==+o[u+296>>2]:0)e=t-n==+o[u+292>>2];else e=0;if(m|e){N=31;break a}g=f-q;if(g<=f*9.999999974752427e-07){N=33;break a}o[u+292>>2]=t-n;o[u+296>>2]=s-l;o[u+300>>2]=0.0;o[u+304>>2]=0.0;i[u+356>>0]=1;o[u+4+(v<<4)>>2]=t-n;o[u+4+(v<<4)+4>>2]=s-l;o[u+4+(v<<4)+8>>2]=0.0;o[u+4+(v<<4)+12>>2]=0.0;v=k[u>>2]|0;o[u+84+(v<<4)>>2]=t;o[u+84+(v<<4)+4>>2]=s;o[u+84+(v<<4)+8>>2]=0.0;o[u+84+(v<<4)+12>>2]=0.0;v=k[u>>2]|0;o[u+164+(v<<4)>>2]=n;o[u+164+(v<<4)+4>>2]=l;o[u+164+(v<<4)+8>>2]=0.0;o[u+164+(v<<4)+12>>2]=0.0;k[u>>2]=(k[u>>2]|0)+1;u=k[a+24>>2]|0;v=$v(u)|0;g=+o[u+276>>2];j=+o[u+280>>2];h=+o[u+284>>2];l=+o[u+288>>2];if(!v){N=35;break a}n=f;f=g*g+j*j+h*h;if(f<9.999999974752427e-07){f=n;N=37;break a}if(n-f<=n*1.1920928955078125e-07){N=39;break a}o[a+4>>2]=g;o[a+8>>2]=j;o[a+12>>2]=h;o[a+16>>2]=l;v=k[a+64>>2]|0;k[a+64>>2]=v+1;if((v|0)>1e3){A=0.0;u=0;l=0.0;h=0.0;n=0.0;break a}if((k[k[a+24>>2]>>2]|0)==4){N=42;break}}}else{j=f;f=999999984306749440.0;while(1){x=-g;z=-j;t=-h;y=+o[b+4>>2]*x+ +o[b+20>>2]*z+ +o[b+36>>2]*t;A=+o[b+8>>2]*x+ +o[b+24>>2]*z+ +o[b+40>>2]*t;o[J+112>>2]=+o[b>>2]*x+ +o[b+16>>2]*z+ +o[b+32>>2]*t;o[J+112+4>>2]=y;o[J+112+8>>2]=A;o[J+112+12>>2]=0.0;A=g*+o[b+68>>2]+j*+o[b+84>>2]+h*+o[b+100>>2];y=g*+o[b+72>>2]+j*+o[b+88>>2]+h*+o[b+104>>2];o[J+176>>2]=+o[b+64>>2]*g+ +o[b+80>>2]*j+ +o[b+96>>2]*h;o[J+176+4>>2]=A;o[J+176+8>>2]=y;o[J+176+12>>2]=0.0;$t(J+256|0,k[a+28>>2]|0,J+112|0);$t(J+272|0,k[a+32>>2]|0,J+176|0);y=+o[J+256>>2];A=+o[J+256+4>>2];t=+o[J+256+8>>2];z=y*+o[J+32>>2]+A*+o[J+32+4>>2]+t*+o[J+32+8>>2]+ +o[J+32+48>>2];x=y*+o[J+32+16>>2]+A*+o[J+32+20>>2]+t*+o[J+32+24>>2]+ +o[J+32+52>>2];t=y*+o[J+32+32>>2]+A*+o[J+32+36>>2]+t*+o[J+32+40>>2]+ +o[J+32+56>>2];A=+o[J+272>>2];y=+o[J+272+4>>2];n=+o[J+272+8>>2];s=A*+o[J+192>>2]+y*+o[J+192+4>>2]+n*+o[J+192+8>>2]+ +o[J+192+48>>2];p=A*+o[J+192+16>>2]+y*+o[J+192+20>>2]+n*+o[J+192+24>>2]+ +o[J+192+52>>2];n=A*+o[J+192+32>>2]+y*+o[J+192+36>>2]+n*+o[J+192+40>>2]+ +o[J+192+56>>2];y=+o[a+4>>2]*(z-s)+ +o[a+8>>2]*(x-p)+ +o[a+12>>2]*(t-n);if(y>0.0?y*y>f*+o[b+128>>2]:0){N=22;break a}v=k[a+24>>2]|0;u=k[v>>2]|0;if((u|0)>0){q=+o[v+308>>2];e=0;m=0;while(1){j=z-s-+o[v+4+(m<<4)>>2];l=x-p-+o[v+4+(m<<4)+4>>2];A=t-n-+o[v+4+(m<<4)+8>>2];e=e|j*j+l*l+A*A<=q;if((m|0)==(u+-1|0))break;else m=m+1|0}}else e=0;if((+o[v+304>>2]==0.0?t-n==+o[v+300>>2]:0)?x-p==+o[v+296>>2]:0)m=z-s==+o[v+292>>2];else m=0;if(e|m){N=31;break a}g=f-y;if(g<=f*9.999999974752427e-07){N=33;break a}o[v+292>>2]=z-s;o[v+296>>2]=x-p;o[v+300>>2]=t-n;o[v+304>>2]=0.0;i[v+356>>0]=1;o[v+4+(u<<4)>>2]=z-s;o[v+4+(u<<4)+4>>2]=x-p;o[v+4+(u<<4)+8>>2]=t-n;o[v+4+(u<<4)+12>>2]=0.0;u=k[v>>2]|0;o[v+84+(u<<4)>>2]=z;o[v+84+(u<<4)+4>>2]=x;o[v+84+(u<<4)+8>>2]=t;o[v+84+(u<<4)+12>>2]=0.0;u=k[v>>2]|0;o[v+164+(u<<4)>>2]=s;o[v+164+(u<<4)+4>>2]=p;o[v+164+(u<<4)+8>>2]=n;o[v+164+(u<<4)+12>>2]=0.0;k[v>>2]=(k[v>>2]|0)+1;u=k[a+24>>2]|0;v=$v(u)|0;g=+o[u+276>>2];j=+o[u+280>>2];h=+o[u+284>>2];l=+o[u+288>>2];if(!v){N=35;break a}n=f;f=g*g+j*j+h*h;if(f<9.999999974752427e-07){f=n;N=37;break a}if(n-f<=n*1.1920928955078125e-07){N=39;break a}o[a+4>>2]=g;o[a+8>>2]=j;o[a+12>>2]=h;o[a+16>>2]=l;v=k[a+64>>2]|0;k[a+64>>2]=v+1;if((v|0)>1e3){A=0.0;u=0;l=0.0;h=0.0;n=0.0;break a}if((k[k[a+24>>2]>>2]|0)==4){N=42;break}}}while(0);if((N|0)==22){k[a+68>>2]=10;N=43}else if((N|0)==31){k[a+68>>2]=1;N=43}else if((N|0)==33){k[a+68>>2]=!(g<=0.0)?11:2;N=43}else if((N|0)==35){k[a+68>>2]=3;N=43}else if((N|0)==37){o[a+4>>2]=g;o[a+8>>2]=j;o[a+12>>2]=h;o[a+16>>2]=l;k[a+68>>2]=6;N=43}else if((N|0)==39){k[a+68>>2]=12;N=43}else if((N|0)==42){k[a+68>>2]=13;A=0.0;u=0;l=0.0;h=0.0;n=0.0}do if((N|0)==43){v=k[a+24>>2]|0;$v(v)|0;l=+o[v+260>>2];h=+o[v+264>>2];n=+o[v+268>>2];k[J>>2]=k[a+4>>2];k[J+4>>2]=k[a+4+4>>2];k[J+8>>2]=k[a+4+8>>2];k[J+12>>2]=k[a+4+12>>2];j=+o[a+4>>2];g=+o[a+8>>2];p=+o[a+12>>2];if(j*j+g*g+p*p<.0001)k[a+68>>2]=5;if(j*j+g*g+p*p>1.4210854715202004e-14){A=1.0/+Y(+(j*j+g*g+p*p));o[J>>2]=A*+o[J>>2];o[J+4>>2]=A*+o[J+4>>2];o[J+8>>2]=A*+o[J+8>>2];z=C/+Y(+f);k[a+60>>2]=1;A=1.0/A-w;u=1;l=z*j+l;h=z*g+h;n=z*p+n;break}else{k[a+60>>2]=2;A=0.0;u=0;break}}while(0);if(((k[a+72>>2]|0)!=0?(k[a+20>>2]|0)!=0:0)?(k[a+68>>2]|0)!=0:0)e=w+A<.01;else e=0;v=u^1;do if(e|v?(B=k[a+20>>2]|0,(B|0)!=0):0){k[4844]=(k[4844]|0)+1;k[a+4>>2]=0;k[a+4+4>>2]=0;k[a+4+8>>2]=0;k[a+4+12>>2]=0;if(!(Vb[k[(k[B>>2]|0)+8>>2]&3](B,k[a+24>>2]|0,k[a+28>>2]|0,k[a+32>>2]|0,J+32|0,J+192|0,a+4|0,J+144|0,J+128|0,d)|0)){p=+o[a+4>>2];f=+o[a+8>>2];s=+o[a+12>>2];if(!(p*p+f*f+s*s>0.0)){N=66;break}g=+o[J+128>>2];y=+o[J+144>>2]-g;q=+o[J+128+4>>2];z=+o[J+144+4>>2]-q;t=+o[J+128+8>>2];j=+o[J+144+8>>2]-t;j=+Y(+(y*y+z*z+j*j))-w;if(j<A|v){k[J>>2]=k[a+4>>2];k[J+4>>2]=k[a+4+4>>2];k[J+8>>2]=k[a+4+8>>2];k[J+12>>2]=k[a+4+12>>2];y=+o[J>>2];z=+o[J+4>>2];A=+o[J+8>>2];l=1.0/+Y(+(y*y+z*z+A*A));o[J>>2]=y*l;o[J+4>>2]=z*l;o[J+8>>2]=A*l;k[a+60>>2]=6;l=C*p+g;g=C*f+q;f=C*s+t;break}k[a+60>>2]=5;if(u){j=A;g=h;f=n;break}r=J;return}z=+o[J+128>>2];p=+o[J+144>>2];g=+o[J+128+4>>2];j=+o[J+144+4>>2];f=+o[J+128+8>>2];s=+o[J+144+8>>2];if(!((z-p)*(z-p)+(g-j)*(g-j)+(f-s)*(f-s)<=1.4210854715202004e-14)){t=f-s;w=g-j;x=z-p;y=0.0;q=(z-p)*(z-p)+(g-j)*(g-j)+(f-s)*(f-s)}else{O=+o[a+4>>2];C=+o[a+8>>2];q=+o[a+12>>2];t=q;w=C;x=O;y=+o[a+16>>2];q=O*O+C*C+q*q}if(!(q>1.4210854715202004e-14)){k[a+60>>2]=9;if(u){j=A;g=h;f=n;break}r=J;return}q=1.0/+Y(+q);j=-+Y(+((p-z)*(p-z)+(j-g)*(j-g)+(s-f)*(s-f)));if(A>j|v){o[J>>2]=x*q;o[J+4>>2]=w*q;o[J+8>>2]=t*q;o[J+12>>2]=y;k[a+60>>2]=3;l=z;break}k[a+60>>2]=8;if(u){j=A;g=h;f=n}else{r=J;return}}else N=66;while(0);if((N|0)==66)if(u){j=A;g=h;f=n}else{r=J;return}if(!(j<0.0)?!(j*j<+o[b+128>>2]):0){r=J;return}if((k[a+76>>2]|0)!=0?(b=k[a+28>>2]|0,Cc[k[(k[b>>2]|0)+8>>2]&127](b,J+32|0,J+96|0,J+16|0),A=(+o[J+16>>2]+ +o[J+96>>2])*.5,C=(+o[J+16+4>>2]+ +o[J+96+4>>2])*.5,O=(+o[J+16+8>>2]+ +o[J+96+8>>2])*.5,b=k[a+32>>2]|0,Cc[k[(k[b>>2]|0)+8>>2]&127](b,J+192|0,J+96|0,J+16|0),K=+o[J>>2],L=+o[J+4>>2],M=+o[J+8>>2],(A-(+o[J+96>>2]+ +o[J+16>>2])*.5)*K+(C-(+o[J+96+4>>2]+ +o[J+16+4>>2])*.5)*L+(O-(+o[J+96+8>>2]+ +o[J+16+8>>2])*.5)*M<0.0):0){o[J>>2]=-K;o[J+4>>2]=-L;o[J+8>>2]=-M};k[a+4>>2]=k[J>>2];k[a+4+4>>2]=k[J+4>>2];k[a+4+8>>2]=k[J+8>>2];k[a+4+12>>2]=k[J+12>>2];o[a+56>>2]=j;b=k[(k[c>>2]|0)+16>>2]|0;o[J+160>>2]=(D+E)*.5+l;o[J+160+4>>2]=(F+G)*.5+g;o[J+160+8>>2]=(H+I)*.5+f;o[J+160+12>>2]=0.0;xc[b&15](c,J,J+160|0,j);r=J;return}function _v(a,b){a=a|0;b=b|0;var c=0,d=0;c=k[a>>2]|0;do if((c|0)>3)if(!(i[b>>0]&8)){k[a>>2]=c+-1;d=a+4+(c+-1<<4)|0;k[a+52>>2]=k[d>>2];k[a+52+4>>2]=k[d+4>>2];k[a+52+8>>2]=k[d+8>>2];k[a+52+12>>2]=k[d+12>>2];d=a+84+(c+-1<<4)|0;k[a+132>>2]=k[d>>2];k[a+132+4>>2]=k[d+4>>2];k[a+132+8>>2]=k[d+8>>2];k[a+132+12>>2]=k[d+12>>2];d=a+164+(c+-1<<4)|0;k[a+212>>2]=k[d>>2];k[a+212+4>>2]=k[d+4>>2];k[a+212+8>>2]=k[d+8>>2];k[a+212+12>>2]=k[d+12>>2];c=c+-1|0;d=6}else d=6;else{if((c|0)>2){c=3;d=6;break}if((c|0)>1){c=2;d=10;break}if((c|0)>0){c=1;break}else return}while(0);if((d|0)==6)if(!(i[b>>0]&4)){c=c+-1|0;k[a>>2]=c;k[a+36>>2]=k[a+4+(c<<4)>>2];k[a+36+4>>2]=k[a+4+(c<<4)+4>>2];k[a+36+8>>2]=k[a+4+(c<<4)+8>>2];k[a+36+12>>2]=k[a+4+(c<<4)+12>>2];k[a+116>>2]=k[a+84+(c<<4)>>2];k[a+116+4>>2]=k[a+84+(c<<4)+4>>2];k[a+116+8>>2]=k[a+84+(c<<4)+8>>2];k[a+116+12>>2]=k[a+84+(c<<4)+12>>2];k[a+196>>2]=k[a+164+(c<<4)>>2];k[a+196+4>>2]=k[a+164+(c<<4)+4>>2];k[a+196+8>>2]=k[a+164+(c<<4)+8>>2];k[a+196+12>>2]=k[a+164+(c<<4)+12>>2];d=10}else d=10;if((d|0)==10)if(!(i[b>>0]&2)){c=c+-1|0;k[a>>2]=c;k[a+20>>2]=k[a+4+(c<<4)>>2];k[a+20+4>>2]=k[a+4+(c<<4)+4>>2];k[a+20+8>>2]=k[a+4+(c<<4)+8>>2];k[a+20+12>>2]=k[a+4+(c<<4)+12>>2];k[a+100>>2]=k[a+84+(c<<4)>>2];k[a+100+4>>2]=k[a+84+(c<<4)+4>>2];k[a+100+8>>2]=k[a+84+(c<<4)+8>>2];k[a+100+12>>2]=k[a+84+(c<<4)+12>>2];k[a+180>>2]=k[a+164+(c<<4)>>2];k[a+180+4>>2]=k[a+164+(c<<4)+4>>2];k[a+180+8>>2]=k[a+164+(c<<4)+8>>2];k[a+180+12>>2]=k[a+164+(c<<4)+12>>2]}if(i[b>>0]&1)return;d=c+-1|0;k[a>>2]=d;k[a+4>>2]=k[a+4+(d<<4)>>2];k[a+4+4>>2]=k[a+4+(d<<4)+4>>2];k[a+4+8>>2]=k[a+4+(d<<4)+8>>2];k[a+4+12>>2]=k[a+4+(d<<4)+12>>2];k[a+84>>2]=k[a+84+(d<<4)>>2];k[a+84+4>>2]=k[a+84+(d<<4)+4>>2];k[a+84+8>>2]=k[a+84+(d<<4)+8>>2];k[a+84+12>>2]=k[a+84+(d<<4)+12>>2];k[a+164>>2]=k[a+164+(d<<4)>>2];k[a+164+4>>2]=k[a+164+(d<<4)+4>>2];k[a+164+8>>2]=k[a+164+(d<<4)+8>>2];k[a+164+12>>2]=k[a+164+(d<<4)+12>>2];return}function $v(a){a=a|0;var b=0,c=0.0,d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,j=0,l=0,m=0,n=0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0,Q=0,R=0.0,S=0.0,T=0.0,U=0;U=r;r=r+80|0;if(!(i[a+356>>0]|0)){Q=i[a+312>>0]|0;Q=Q<<24>>24!=0;r=U;return Q|0}k[a+336>>2]=0;k[a+336+4>>2]=0;k[a+336+8>>2]=0;k[a+336+12>>2]=0;i[a+336+16>>0]=0;b=i[a+332>>0]|0;i[a+332>>0]=b&-16;i[a+356>>0]=0;switch(k[a>>2]|0){case 2:{c=+o[a+4>>2];d=+o[a+8>>2];e=+o[a+12>>2];f=+o[a+20>>2]-c;g=+o[a+24>>2]-d;h=+o[a+28>>2]-e;do if((0.0-c)*f+(0.0-d)*g+(0.0-e)*h>0.0)if((0.0-c)*f+(0.0-d)*g+(0.0-e)*h<f*f+g*g+h*h){i[a+332>>0]=b&-16|3;c=((0.0-c)*f+(0.0-d)*g+(0.0-e)*h)/(f*f+g*g+h*h);break}else{i[a+332>>0]=b&-16|2;c=1.0;break}else{i[a+332>>0]=b&-16|1;c=0.0}while(0);o[a+336>>2]=1.0-c;o[a+340>>2]=c;o[a+344>>2]=0.0;o[a+348>>2]=0.0;N=+o[a+84>>2];P=+o[a+88>>2];S=+o[a+92>>2];N=N+c*(+o[a+100>>2]-N);P=P+c*(+o[a+104>>2]-P);S=S+c*(+o[a+108>>2]-S);o[a+244>>2]=N;o[a+248>>2]=P;o[a+252>>2]=S;o[a+256>>2]=0.0;O=+o[a+164>>2];R=+o[a+168>>2];T=+o[a+172>>2];O=O+c*(+o[a+180>>2]-O);R=R+c*(+o[a+184>>2]-R);T=T+c*(+o[a+188>>2]-T);o[a+260>>2]=O;o[a+264>>2]=R;o[a+268>>2]=T;o[a+272>>2]=0.0;o[a+276>>2]=N-O;o[a+280>>2]=P-R;o[a+284>>2]=S-T;o[a+288>>2]=0.0;_v(a,a+332|0);if((+o[a+336>>2]>=0.0?+o[a+340>>2]>=0.0:0)?+o[a+344>>2]>=0.0:0)b=+o[a+348>>2]>=0.0&1;else b=0;i[a+312>>0]=b;Q=b;Q=Q<<24>>24!=0;r=U;return Q|0}case 4:{k[U>>2]=0;k[U+4>>2]=0;k[U+8>>2]=0;k[U+12>>2]=0;Q=U+32+16|0;i[Q>>0]=0;k[a+316>>2]=k[U>>2];k[a+316+4>>2]=k[U+4>>2];k[a+316+8>>2]=k[U+8>>2];k[a+316+12>>2]=k[U+12>>2];i[a+332>>0]=b|15;d=+o[a+20>>2];g=+o[a+4>>2];c=+o[a+24>>2];f=+o[a+8>>2];p=+o[a+28>>2];e=+o[a+12>>2];q=+o[a+36>>2];s=+o[a+40>>2];t=+o[a+44>>2];u=+o[a+52>>2];v=+o[a+56>>2];w=+o[a+60>>2];h=(u-g)*((c-f)*(t-e)-(p-e)*(s-f))+(v-f)*((p-e)*(q-g)-(d-g)*(t-e))+((d-g)*(s-f)-(c-f)*(q-g))*(w-e);if(h*h<9.99999905104687e-09)x=-1;else x=h*(((c-f)*(t-e)-(p-e)*(s-f))*(0.0-g)+((p-e)*(q-g)-(d-g)*(t-e))*(0.0-f)+((d-g)*(s-f)-(c-f)*(q-g))*(0.0-e))<0.0&1;h=(d-g)*((s-f)*(w-e)-(t-e)*(v-f))+(c-f)*((t-e)*(u-g)-(q-g)*(w-e))+((q-g)*(v-f)-(s-f)*(u-g))*(p-e);if(h*h<9.99999905104687e-09)m=-1;else m=h*(((s-f)*(w-e)-(t-e)*(v-f))*(0.0-g)+((t-e)*(u-g)-(q-g)*(w-e))*(0.0-f)+((q-g)*(v-f)-(s-f)*(u-g))*(0.0-e))<0.0&1;h=(q-g)*((v-f)*(p-e)-(w-e)*(c-f))+(s-f)*((w-e)*(d-g)-(u-g)*(p-e))+((u-g)*(c-f)-(v-f)*(d-g))*(t-e);if(h*h<9.99999905104687e-09)n=-1;else n=h*(((v-f)*(p-e)-(w-e)*(c-f))*(0.0-g)+((w-e)*(d-g)-(u-g)*(p-e))*(0.0-f)+((u-g)*(c-f)-(v-f)*(d-g))*(0.0-e))<0.0&1;h=(g-d)*((v-c)*(t-p)-(w-p)*(s-c))+(f-c)*((w-p)*(q-d)-(u-d)*(t-p))+((u-d)*(s-c)-(v-c)*(q-d))*(e-p);if(h*h<9.99999905104687e-09)b=-1;else b=h*(((v-c)*(t-p)-(w-p)*(s-c))*(0.0-d)+((w-p)*(q-d)-(u-d)*(t-p))*(0.0-c)+((u-d)*(s-c)-(v-c)*(q-d))*(0.0-p))<0.0&1;j=m|x|n|b;if((j|0)<0){i[a+352>>0]=1;i[a+312>>0]=0;Q=0;Q=Q<<24>>24!=0;r=U;return Q|0}l=(m|0)==0;m=(n|0)==0;b=(b|0)==0;if(!j){i[a+312>>0]=1;k[a+276>>2]=0;k[a+276+4>>2]=0;k[a+276+8>>2]=0;k[a+276+12>>2]=0;Q=1;Q=Q<<24>>24!=0;r=U;return Q|0}if((x|0)!=0?(aw(U,a+4|0,a+20|0,a+36|0,U+32|0),y=+o[U+32>>2],z=+o[U+32+4>>2],A=+o[U+32+8>>2],B=y-+o[U>>2],C=z-+o[U+4>>2],D=A-+o[U+8>>2],B*B+C*C+D*D<3402823466385288598117041.0e14):0){c=+o[U+32+12>>2];o[a+316>>2]=y;o[a+320>>2]=z;o[a+324>>2]=A;o[a+328>>2]=c;x=i[Q>>0]|0;i[a+332>>0]=x&1|i[a+332>>0]&-16|x&2|x&4;A=+o[U+32+24>>2];c=+o[U+32+28>>2];o[a+336>>2]=+o[U+32+20>>2];o[a+340>>2]=A;o[a+344>>2]=c;o[a+348>>2]=0.0;c=B*B+C*C+D*D}else c=3402823466385288598117041.0e14;if(!l?(aw(U,a+4|0,a+36|0,a+52|0,U+32|0),E=+o[U+32>>2],F=+o[U+32+4>>2],G=+o[U+32+8>>2],H=E-+o[U>>2],I=F-+o[U+4>>2],J=G-+o[U+8>>2],H*H+I*I+J*J<c):0){C=+o[U+32+12>>2];o[a+316>>2]=E;o[a+320>>2]=F;o[a+324>>2]=G;o[a+328>>2]=C;l=i[Q>>0]|0;i[a+332>>0]=l<<1&4|(l&1|i[a+332>>0]&-16)|l<<1&8;C=+o[U+32+24>>2];c=+o[U+32+28>>2];o[a+336>>2]=+o[U+32+20>>2];o[a+340>>2]=0.0;o[a+344>>2]=C;o[a+348>>2]=c;c=H*H+I*I+J*J}if(!m?(aw(U,a+4|0,a+52|0,a+20|0,U+32|0),K=+o[U+32>>2],L=+o[U+32+4>>2],M=+o[U+32+8>>2],N=K-+o[U>>2],O=L-+o[U+4>>2],P=M-+o[U+8>>2],N*N+O*O+P*P<c):0){c=+o[U+32+12>>2];o[a+316>>2]=K;o[a+320>>2]=L;o[a+324>>2]=M;o[a+328>>2]=c;m=i[Q>>0]|0;i[a+332>>0]=(m&255)>>>1&2|(m&1|i[a+332>>0]&-16)|m<<2&8;M=+o[U+32+28>>2];c=+o[U+32+24>>2];o[a+336>>2]=+o[U+32+20>>2];o[a+340>>2]=M;o[a+344>>2]=0.0;o[a+348>>2]=c;c=N*N+O*O+P*P}if(!b?(aw(U,a+20|0,a+52|0,a+36|0,U+32|0),R=+o[U+32>>2],S=+o[U+32+4>>2],T=+o[U+32+8>>2],N=R-+o[U>>2],O=S-+o[U+4>>2],P=T-+o[U+8>>2],N*N+O*O+P*P<c):0){P=+o[U+32+12>>2];o[a+316>>2]=R;o[a+320>>2]=S;o[a+324>>2]=T;o[a+328>>2]=P;Q=i[Q>>0]|0;i[a+332>>0]=Q<<1&2|i[a+332>>0]&-16|Q&4|Q<<2&8;R=+o[U+32+20>>2];S=+o[U+32+28>>2];T=+o[U+32+24>>2];o[a+336>>2]=0.0;o[a+340>>2]=R;o[a+344>>2]=S;o[a+348>>2]=T}K=+o[a+336>>2];L=+o[a+340>>2];M=+o[a+344>>2];T=+o[a+348>>2];N=+o[a+84>>2]*K+ +o[a+100>>2]*L+ +o[a+116>>2]*M+ +o[a+132>>2]*T;P=K*+o[a+88>>2]+L*+o[a+104>>2]+M*+o[a+120>>2]+T*+o[a+136>>2];S=K*+o[a+92>>2]+L*+o[a+108>>2]+M*+o[a+124>>2]+T*+o[a+140>>2];o[a+244>>2]=N;o[a+248>>2]=P;o[a+252>>2]=S;o[a+256>>2]=0.0;O=+o[a+164>>2]*K+ +o[a+180>>2]*L+ +o[a+196>>2]*M+ +o[a+212>>2]*T;R=K*+o[a+168>>2]+L*+o[a+184>>2]+M*+o[a+200>>2]+T*+o[a+216>>2];T=K*+o[a+172>>2]+L*+o[a+188>>2]+M*+o[a+204>>2]+T*+o[a+220>>2];o[a+260>>2]=O;o[a+264>>2]=R;o[a+268>>2]=T;o[a+272>>2]=0.0;o[a+276>>2]=N-O;o[a+280>>2]=P-R;o[a+284>>2]=S-T;o[a+288>>2]=0.0;_v(a,a+332|0);if((+o[a+336>>2]>=0.0?+o[a+340>>2]>=0.0:0)?+o[a+344>>2]>=0.0:0)b=+o[a+348>>2]>=0.0&1;else b=0;i[a+312>>0]=b;Q=b;Q=Q<<24>>24!=0;r=U;return Q|0}case 1:{k[a+244>>2]=k[a+84>>2];k[a+244+4>>2]=k[a+84+4>>2];k[a+244+8>>2]=k[a+84+8>>2];k[a+244+12>>2]=k[a+84+12>>2];k[a+260>>2]=k[a+164>>2];k[a+260+4>>2]=k[a+164+4>>2];k[a+260+8>>2]=k[a+164+8>>2];k[a+260+12>>2]=k[a+164+12>>2];S=+o[a+248>>2]-+o[a+264>>2];T=+o[a+252>>2]-+o[a+268>>2];o[a+276>>2]=+o[a+244>>2]-+o[a+260>>2];o[a+280>>2]=S;o[a+284>>2]=T;o[a+288>>2]=0.0;k[a+336>>2]=0;k[a+336+4>>2]=0;k[a+336+8>>2]=0;k[a+336+12>>2]=0;i[a+336+16>>0]=0;i[a+332>>0]=b&-16;o[a+336>>2]=1.0;o[a+340>>2]=0.0;o[a+344>>2]=0.0;o[a+348>>2]=0.0;i[a+312>>0]=1;Q=1;Q=Q<<24>>24!=0;r=U;return Q|0}case 0:{i[a+312>>0]=0;Q=0;Q=Q<<24>>24!=0;r=U;return Q|0}case 3:{k[U+16>>2]=0;k[U+16+4>>2]=0;k[U+16+8>>2]=0;k[U+16+12>>2]=0;aw(U+16|0,a+4|0,a+20|0,a+36|0,a+316|0);L=+o[a+336>>2];M=+o[a+340>>2];T=+o[a+344>>2];N=+o[a+84>>2]*L+ +o[a+100>>2]*M+ +o[a+116>>2]*T;P=L*+o[a+88>>2]+M*+o[a+104>>2]+T*+o[a+120>>2];S=L*+o[a+92>>2]+M*+o[a+108>>2]+T*+o[a+124>>2];o[a+244>>2]=N;o[a+248>>2]=P;o[a+252>>2]=S;o[a+256>>2]=0.0;O=+o[a+164>>2]*L+ +o[a+180>>2]*M+ +o[a+196>>2]*T;R=L*+o[a+168>>2]+M*+o[a+184>>2]+T*+o[a+200>>2];T=L*+o[a+172>>2]+M*+o[a+188>>2]+T*+o[a+204>>2];o[a+260>>2]=O;o[a+264>>2]=R;o[a+268>>2]=T;o[a+272>>2]=0.0;o[a+276>>2]=N-O;o[a+280>>2]=P-R;o[a+284>>2]=S-T;o[a+288>>2]=0.0;_v(a,a+332|0);if((+o[a+336>>2]>=0.0?+o[a+340>>2]>=0.0:0)?+o[a+344>>2]>=0.0:0)b=+o[a+348>>2]>=0.0&1;else b=0;i[a+312>>0]=b;Q=b;Q=Q<<24>>24!=0;r=U;return Q|0}default:{i[a+312>>0]=0;Q=0;Q=Q<<24>>24!=0;r=U;return Q|0}}return 0}function aw(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0.0,g=0.0,h=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0;u=i[e+16>>0]&-16;i[e+16>>0]=u;w=+o[c>>2];x=+o[b>>2];y=+o[c+4>>2];z=+o[b+4>>2];q=+o[c+8>>2];r=+o[b+8>>2];s=+o[d>>2];t=+o[d+4>>2];v=+o[d+8>>2];l=+o[a>>2];m=+o[a+4>>2];f=+o[a+8>>2];n=(w-x)*(l-x)+(y-z)*(m-z)+(q-r)*(f-r);p=(s-x)*(l-x)+(t-z)*(m-z)+(v-r)*(f-r);if(n<=0.0&p<=0.0){k[e>>2]=k[b>>2];k[e+4>>2]=k[b+4>>2];k[e+8>>2]=k[b+8>>2];k[e+12>>2]=k[b+12>>2];i[e+16>>0]=u|1;o[e+20>>2]=1.0;o[e+24>>2]=0.0;o[e+28>>2]=0.0;o[e+32>>2]=0.0;return}h=(w-x)*(l-w)+(y-z)*(m-y)+(q-r)*(f-q);j=(s-x)*(l-w)+(t-z)*(m-y)+(v-r)*(f-q);if(!(!(h>=0.0)|!(j<=h))){k[e>>2]=k[c>>2];k[e+4>>2]=k[c+4>>2];k[e+8>>2]=k[c+8>>2];k[e+12>>2]=k[c+12>>2];i[e+16>>0]=u|2;o[e+20>>2]=0.0;o[e+24>>2]=1.0;o[e+28>>2]=0.0;o[e+32>>2]=0.0;return}if(h<=0.0&(n>=0.0?n*j-h*p<=0.0:0)){o[e>>2]=x+(w-x)*(n/(n-h));o[e+4>>2]=z+(y-z)*(n/(n-h));o[e+8>>2]=r+(q-r)*(n/(n-h));o[e+12>>2]=0.0;i[e+16>>0]=u|3;o[e+20>>2]=1.0-n/(n-h);o[e+24>>2]=n/(n-h);o[e+28>>2]=0.0;o[e+32>>2]=0.0;return}g=(w-x)*(l-s)+(y-z)*(m-t)+(q-r)*(f-v);f=(s-x)*(l-s)+(t-z)*(m-t)+(v-r)*(f-v);if(!(!(f>=0.0)|!(g<=f))){k[e>>2]=k[d>>2];k[e+4>>2]=k[d+4>>2];k[e+8>>2]=k[d+8>>2];k[e+12>>2]=k[d+12>>2];i[e+16>>0]=u|4;o[e+20>>2]=0.0;o[e+24>>2]=0.0;o[e+28>>2]=1.0;o[e+32>>2]=0.0;return}if(f<=0.0&(p>=0.0?g*p-n*f<=0.0:0)){o[e>>2]=x+(s-x)*(p/(p-f));o[e+4>>2]=z+(t-z)*(p/(p-f));o[e+8>>2]=r+(v-r)*(p/(p-f));o[e+12>>2]=0.0;i[e+16>>0]=u|5;o[e+20>>2]=1.0-p/(p-f);o[e+24>>2]=0.0;o[e+28>>2]=p/(p-f);o[e+32>>2]=0.0;return}if((h*f-g*j<=0.0?j-h>=0.0:0)?g-f>=0.0:0){z=(j-h)/(j-h+(g-f));o[e>>2]=w+(s-w)*z;o[e+4>>2]=y+(t-y)*z;o[e+8>>2]=q+(v-q)*z;o[e+12>>2]=0.0;i[e+16>>0]=u|6;o[e+20>>2]=0.0;o[e+24>>2]=1.0-z;o[e+28>>2]=z;o[e+32>>2]=0.0;return}l=1.0/(n*j-h*p+(h*f-g*j+(g*p-n*f)));m=(g*p-n*f)*l;p=(n*j-h*p)*l;o[e>>2]=(s-x)*p+(x+(w-x)*m);o[e+4>>2]=(t-z)*p+(z+(y-z)*m);o[e+8>>2]=(v-r)*p+((q-r)*m+r);o[e+12>>2]=0.0;i[e+16>>0]=u|7;o[e+20>>2]=1.0-m-p;o[e+24>>2]=m;o[e+28>>2]=p;o[e+32>>2]=0.0;return}function bw(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;return}function cw(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;return 1.0}function dw(a){a=a|0;var b=0;k[a>>2]=19672;if(!(i[a+8>>0]|0))return;b=k[a+12>>2]|0;if(!b)return;a=k[a+4>>2]|0;Ub[k[(k[a>>2]|0)+16>>2]&127](a,b);return}function ew(a){a=a|0;var b=0,c=0;k[a>>2]=19672;if(!(i[a+8>>0]|0)){jF(a);return}b=k[a+12>>2]|0;if(!b){jF(a);return}c=k[a+4>>2]|0;Ub[k[(k[c>>2]|0)+16>>2]&127](c,b);jF(a);return}function fw(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0,p=0,q=0;p=r;r=r+32|0;n=k[a+12>>2]|0;if(!n){r=p;return}k[e+4>>2]=n;d=k[b+4>>2]|0;q=k[c+4>>2]|0;b=k[b+12>>2]|0;a=k[c+12>>2]|0;f=+o[b+48>>2]-+o[a+48>>2];g=+o[b+52>>2]-+o[a+52>>2];i=+o[b+56>>2]-+o[a+56>>2];j=+Y(+(f*f+g*g+i*i));l=+o[q+28>>2]*+o[q+12>>2];m=+o[d+28>>2]*+o[d+12>>2]+l;if(j>m){if(!(k[n+748>>2]|0)){r=p;return}c=k[n+740>>2]|0;b=k[(k[e+8>>2]|0)+8>>2]|0;d=k[(k[e+12>>2]|0)+8>>2]|0;if((c|0)==(b|0)){rr(n,c+4|0,d+4|0);r=p;return}else{rr(n,d+4|0,b+4|0);r=p;return}}o[p+16>>2]=1.0;o[p+16+4>>2]=0.0;o[p+16+8>>2]=0.0;o[p+16+12>>2]=0.0;if(j>1.1920928955078125e-07){o[p+16>>2]=f*(1.0/j);o[p+16+4>>2]=g*(1.0/j);o[p+16+8>>2]=i*(1.0/j);o[p+16+12>>2]=0.0;h=f*(1.0/j);g=g*(1.0/j);f=i*(1.0/j)}else{h=1.0;g=0.0;f=0.0}g=l*g+ +o[a+52>>2];i=l*f+ +o[a+56>>2];o[p>>2]=l*h+ +o[a+48>>2];o[p+4>>2]=g;o[p+8>>2]=i;o[p+12>>2]=0.0;xc[k[(k[e>>2]|0)+16>>2]&15](e,p+16|0,p,j-m);b=k[e+4>>2]|0;if(!(k[b+748>>2]|0)){r=p;return}c=k[b+740>>2]|0;a=k[(k[e+8>>2]|0)+8>>2]|0;d=k[(k[e+12>>2]|0)+8>>2]|0;if((c|0)==(a|0)){rr(b,c+4|0,d+4|0);r=p;return}else{rr(b,d+4|0,a+4|0);r=p;return}}function gw(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;return 1.0}function hw(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0.0,g=0.0,h=0.0,i=0,j=0.0,l=0,m=0.0,n=0.0,p=0.0,q=0.0,s=0,t=0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0,C=0,D=0,E=0,F=0.0,G=0,H=0.0,I=0.0,J=0,K=0,L=0,M=0,N=0,O=0,P=0.0,Q=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0.0,Z=0.0,_=0,$=0.0,aa=0.0,ba=0.0,ca=0.0,da=0.0,fa=0.0,ga=0.0,ha=0.0,ia=0.0,ja=0.0,ka=0.0,la=0.0,ma=0,na=0,oa=0.0,pa=0.0,qa=0.0,ra=0.0,sa=0.0,ta=0.0,ua=0.0,va=0.0,wa=0.0,xa=0.0,ya=0.0,za=0.0,Aa=0.0,Ba=0.0,Ca=0,Da=0.0,Ea=0,Fa=0.0,Ga=0,Ha=0;Ha=r;r=r+672|0;o[Ha+344>>2]=+o[b>>2];o[Ha+96>>2]=+o[b+64>>2];L=Ha+344+4|0;o[L>>2]=+o[b+4>>2];o[Ha+96+4>>2]=+o[b+68>>2];o[Ha+344+8>>2]=+o[b+8>>2];o[Ha+96+8>>2]=+o[b+72>>2];K=Ha+344+16|0;o[K>>2]=+o[b+16>>2];o[Ha+96+16>>2]=+o[b+80>>2];N=Ha+344+20|0;o[N>>2]=+o[b+20>>2];o[Ha+96+20>>2]=+o[b+84>>2];o[Ha+344+24>>2]=+o[b+24>>2];o[Ha+96+24>>2]=+o[b+88>>2];E=Ha+344+32|0;o[E>>2]=+o[b+32>>2];o[Ha+96+32>>2]=+o[b+96>>2];M=Ha+344+36|0;o[M>>2]=+o[b+36>>2];o[Ha+96+36>>2]=+o[b+100>>2];o[Ha+344+40>>2]=+o[b+40>>2];o[Ha+96+40>>2]=+o[b+104>>2];Ea=k[a+4>>2]|0;oa=+o[Ea+28>>2];pa=+o[Ea+32>>2];sa=+o[Ea+36>>2];qa=+gc[k[(k[Ea>>2]|0)+48>>2]&15](Ea);ra=+gc[k[(k[Ea>>2]|0)+48>>2]&15](Ea);sa=(sa+ +gc[k[(k[Ea>>2]|0)+48>>2]&15](Ea))*2.0;Ea=k[a+8>>2]|0;ua=+o[Ea+28>>2];va=+o[Ea+32>>2];ya=+o[Ea+36>>2];wa=+gc[k[(k[Ea>>2]|0)+48>>2]&15](Ea);ta=+gc[k[(k[Ea>>2]|0)+48>>2]&15](Ea);ya=(ya+ +gc[k[(k[Ea>>2]|0)+48>>2]&15](Ea))*2.0;S=+o[b+112>>2]-+o[b+48>>2];R=+o[b+116>>2]-+o[b+52>>2];Q=+o[b+120>>2]-+o[b+56>>2];la=+o[Ha+344>>2];ja=+o[K>>2];ka=+o[E>>2];ia=+o[L>>2];ga=+o[N>>2];ha=+o[M>>2];n=+o[Ha+344+8>>2];x=+o[Ha+344+24>>2];xa=+o[Ha+344+40>>2];o[Ha>>2]=(oa+qa)*2.0*.5;o[Ha+4>>2]=(pa+ra)*2.0*.5;o[Ha+8>>2]=sa*.5;o[Ha+144>>2]=(ua+wa)*2.0*.5;o[Ha+144+4>>2]=(va+ta)*2.0*.5;o[Ha+144+8>>2]=ya*.5;q=+o[Ha+96>>2];v=+o[Ha+96+16>>2];p=+o[Ha+96+32>>2];Ba=+o[Ha+96+4>>2];za=+o[Ha+96+20>>2];m=+o[Ha+96+36>>2];Aa=+o[Ha+96+8>>2];Da=+o[Ha+96+24>>2];Fa=+o[Ha+96+40>>2];aa=+X(+(la*q+ja*v+ka*p));U=+X(+(la*Ba+ja*za+ka*m));ba=+X(+(la*Aa+ja*Da+ka*Fa));$=+X(+(q*ia+v*ga+p*ha));P=+X(+(Ba*ia+za*ga+m*ha));ca=+X(+(Aa*ia+Da*ga+Fa*ha));da=+X(+(q*n+v*x+p*xa));fa=+X(+(Ba*n+za*x+m*xa));T=+X(+(Aa*n+Da*x+Fa*xa));z=+X(+(S*la+R*ja+Q*ka))-(ya*.5*ba+((oa+qa)*2.0*.5+aa*((ua+wa)*2.0*.5)+U*((va+ta)*2.0*.5)));if(z>0.0){r=Ha;return}if(z>-3402823466385288598117041.0e14){s=1;t=S*la+R*ja+Q*ka<0.0&1;l=Ha+344|0}else{s=0;t=0;l=0;z=-3402823466385288598117041.0e14}A=+X(+(S*ia+R*ga+Q*ha))-((pa+ra)*2.0*.5+$*((ua+wa)*2.0*.5)+P*((va+ta)*2.0*.5)+ca*(ya*.5));if(A>0.0){r=Ha;return}if(A>z){s=2;t=S*ia+R*ga+Q*ha<0.0&1;l=L;z=A}A=+X(+(S*n+R*x+Q*xa))-(sa*.5+da*((ua+wa)*2.0*.5)+fa*((va+ta)*2.0*.5)+T*(ya*.5));if(A>0.0){r=Ha;return}if(A>z){s=3;t=S*n+R*x+Q*xa<0.0&1;l=Ha+344+8|0;z=A}A=+X(+(S*q+R*v+Q*p))-((ua+wa)*2.0*.5+(aa*((oa+qa)*2.0*.5)+$*((pa+ra)*2.0*.5)+da*(sa*.5)));if(A>0.0){r=Ha;return}if(A>z){s=4;t=S*q+R*v+Q*p<0.0&1;l=Ha+96|0;z=A}A=+X(+(S*Ba+R*za+Q*m))-((va+ta)*2.0*.5+(U*((oa+qa)*2.0*.5)+P*((pa+ra)*2.0*.5)+fa*(sa*.5)));if(A>0.0){r=Ha;return}if(A>z){s=5;t=S*Ba+R*za+Q*m<0.0&1;l=Ha+96+4|0;z=A}y=+X(+(S*Aa+R*Da+Q*Fa))-(ya*.5+(ba*((oa+qa)*2.0*.5)+ca*((pa+ra)*2.0*.5)+T*(sa*.5)));if(y>0.0){r=Ha;return}if(y>z){s=6;t=S*Aa+R*Da+Q*Fa<0.0&1;l=Ha+96+8|0}else y=z;A=(S*n+R*x+Q*xa)*(q*ia+v*ga+p*ha)-(S*ia+R*ga+Q*ha)*(q*n+v*x+p*xa);w=+X(+A)-((da+9.999999747378752e-06)*((pa+ra)*2.0*.5)+($+9.999999747378752e-06)*(sa*.5)+(ba+9.999999747378752e-06)*((va+ta)*2.0*.5)+(U+9.999999747378752e-06)*(ya*.5));if(w>1.1920928955078125e-07){r=Ha;return}j=(q*n+v*x+p*xa)*(q*n+v*x+p*xa)+0.0;Z=(q*ia+v*ga+p*ha)*(q*ia+v*ga+p*ha);u=+Y(+(Z+j));if(u>1.1920928955078125e-07?w/u*1.0499999523162842>y:0){z=(q*ia+v*ga+p*ha)/u;h=-(q*n+v*x+p*xa)/u;g=0.0/u;s=7;t=A<0.0&1;l=0;y=w/u}else{z=0.0;h=0.0;g=0.0}A=(S*n+R*x+Q*xa)*(Ba*ia+za*ga+m*ha)-(S*ia+R*ga+Q*ha)*(Ba*n+za*x+m*xa);w=+X(+A)-((fa+9.999999747378752e-06)*((pa+ra)*2.0*.5)+(P+9.999999747378752e-06)*(sa*.5)+(ba+9.999999747378752e-06)*((ua+wa)*2.0*.5)+(aa+9.999999747378752e-06)*(ya*.5));if(w>1.1920928955078125e-07){r=Ha;return}f=(Ba*n+za*x+m*xa)*(Ba*n+za*x+m*xa)+0.0;W=(Ba*ia+za*ga+m*ha)*(Ba*ia+za*ga+m*ha);u=+Y(+(W+f));if(u>1.1920928955078125e-07?w/u*1.0499999523162842>y:0){z=(Ba*ia+za*ga+m*ha)/u;h=-(Ba*n+za*x+m*xa)/u;g=0.0/u;s=8;t=A<0.0&1;l=0;y=w/u}A=(S*n+R*x+Q*xa)*(Aa*ia+Da*ga+Fa*ha)-(S*ia+R*ga+Q*ha)*(Aa*n+Da*x+Fa*xa);w=+X(+A)-((T+9.999999747378752e-06)*((pa+ra)*2.0*.5)+(ca+9.999999747378752e-06)*(sa*.5)+(U+9.999999747378752e-06)*((ua+wa)*2.0*.5)+(aa+9.999999747378752e-06)*((va+ta)*2.0*.5));if(w>1.1920928955078125e-07){r=Ha;return}H=(Aa*n+Da*x+Fa*xa)*(Aa*n+Da*x+Fa*xa)+0.0;V=(Aa*ia+Da*ga+Fa*ha)*(Aa*ia+Da*ga+Fa*ha);u=+Y(+(V+H));if(u>1.1920928955078125e-07?w/u*1.0499999523162842>y:0){z=(Aa*ia+Da*ga+Fa*ha)/u;h=-(Aa*n+Da*x+Fa*xa)/u;g=0.0/u;s=9;t=A<0.0&1;l=0;y=w/u}A=(S*la+R*ja+Q*ka)*(q*n+v*x+p*xa)-(S*n+R*x+Q*xa)*(la*q+ja*v+ka*p);u=+X(+A)-((da+9.999999747378752e-06)*((oa+qa)*2.0*.5)+(aa+9.999999747378752e-06)*(sa*.5)+(ca+9.999999747378752e-06)*((va+ta)*2.0*.5)+(P+9.999999747378752e-06)*(ya*.5));if(u>1.1920928955078125e-07){r=Ha;return}I=(la*q+ja*v+ka*p)*(la*q+ja*v+ka*p);w=+Y(+(I+j));do if(w>1.1920928955078125e-07){if(!(u/w*1.0499999523162842>y))break;z=-(la*q+ja*v+ka*p)/w;h=0.0/w;g=(q*n+v*x+p*xa)/w;s=10;t=A<0.0&1;l=0;y=u/w}while(0);A=(S*la+R*ja+Q*ka)*(Ba*n+za*x+m*xa)-(S*n+R*x+Q*xa)*(la*Ba+ja*za+ka*m);u=+X(+A)-((fa+9.999999747378752e-06)*((oa+qa)*2.0*.5)+(U+9.999999747378752e-06)*(sa*.5)+(ca+9.999999747378752e-06)*((ua+wa)*2.0*.5)+($+9.999999747378752e-06)*(ya*.5));if(u>1.1920928955078125e-07){r=Ha;return}F=(la*Ba+ja*za+ka*m)*(la*Ba+ja*za+ka*m);w=+Y(+(F+f));do if(w>1.1920928955078125e-07){if(!(u/w*1.0499999523162842>y))break;z=-(la*Ba+ja*za+ka*m)/w;h=0.0/w;g=(Ba*n+za*x+m*xa)/w;s=11;t=A<0.0&1;l=0;y=u/w}while(0);A=(S*la+R*ja+Q*ka)*(Aa*n+Da*x+Fa*xa)-(S*n+R*x+Q*xa)*(la*Aa+ja*Da+ka*Fa);u=+X(+A)-((T+9.999999747378752e-06)*((oa+qa)*2.0*.5)+(ba+9.999999747378752e-06)*(sa*.5)+(P+9.999999747378752e-06)*((ua+wa)*2.0*.5)+($+9.999999747378752e-06)*((va+ta)*2.0*.5));if(u>1.1920928955078125e-07){r=Ha;return}j=(la*Aa+ja*Da+ka*Fa)*(la*Aa+ja*Da+ka*Fa);w=+Y(+(j+H));do if(w>1.1920928955078125e-07){if(!(u/w*1.0499999523162842>y))break;z=-(la*Aa+ja*Da+ka*Fa)/w;h=0.0/w;g=(Aa*n+Da*x+Fa*xa)/w;s=12;t=A<0.0&1;l=0;y=u/w}while(0);w=(S*ia+R*ga+Q*ha)*(la*q+ja*v+ka*p)-(S*la+R*ja+Q*ka)*(q*ia+v*ga+p*ha);u=+X(+w)-(($+9.999999747378752e-06)*((oa+qa)*2.0*.5)+(aa+9.999999747378752e-06)*((pa+ra)*2.0*.5)+(T+9.999999747378752e-06)*((va+ta)*2.0*.5)+(fa+9.999999747378752e-06)*(ya*.5));if(u>1.1920928955078125e-07){r=Ha;return}A=+Y(+(I+Z+0.0));do if(A>1.1920928955078125e-07){if(!(u/A*1.0499999523162842>y))break;z=0.0/A;h=(la*q+ja*v+ka*p)/A;g=-(q*ia+v*ga+p*ha)/A;s=13;t=w<0.0&1;l=0;y=u/A}while(0);u=(S*ia+R*ga+Q*ha)*(la*Ba+ja*za+ka*m)-(S*la+R*ja+Q*ka)*(Ba*ia+za*ga+m*ha);w=+X(+u)-((P+9.999999747378752e-06)*((oa+qa)*2.0*.5)+(U+9.999999747378752e-06)*((pa+ra)*2.0*.5)+(T+9.999999747378752e-06)*((ua+wa)*2.0*.5)+(da+9.999999747378752e-06)*(ya*.5));if(w>1.1920928955078125e-07){r=Ha;return}A=+Y(+(F+W+0.0));do if(A>1.1920928955078125e-07){if(!(w/A*1.0499999523162842>y))break;z=0.0/A;h=(la*Ba+ja*za+ka*m)/A;g=-(Ba*ia+za*ga+m*ha)/A;s=14;t=u<0.0&1;l=0;y=w/A}while(0);A=(S*ia+R*ga+Q*ha)*(la*Aa+ja*Da+ka*Fa)-(S*la+R*ja+Q*ka)*(Aa*ia+Da*ga+Fa*ha);u=+X(+A)-((ca+9.999999747378752e-06)*((oa+qa)*2.0*.5)+(ba+9.999999747378752e-06)*((pa+ra)*2.0*.5)+(fa+9.999999747378752e-06)*((ua+wa)*2.0*.5)+(da+9.999999747378752e-06)*((va+ta)*2.0*.5));if(u>1.1920928955078125e-07){r=Ha;return}w=+Y(+(j+V+0.0));do if(w>1.1920928955078125e-07){if(!(u/w*1.0499999523162842>y)){Ga=55;break}g=-(Aa*ia+Da*ga+Fa*ha)/w;h=(la*Aa+ja*Da+ka*Fa)/w;z=0.0/w;s=15;t=A<0.0&1;y=u/w;Ga=58}else Ga=55;while(0);do if((Ga|0)==55){if(!s){r=Ha;return}if(!l){Ga=58;break}w=+o[l>>2];u=+o[l+16>>2];z=+o[l+32>>2];A=y}while(0);if((Ga|0)==58){w=g*+o[Ha+344>>2]+h*+o[L>>2]+z*n;u=g*+o[K>>2]+h*+o[N>>2]+z*x;z=g*+o[E>>2]+h*+o[M>>2]+z*xa;A=y}if(!t){ia=w;ga=u;fa=z}else{ia=-w;ga=-u;fa=-z}if((s|0)>6){aa=+o[Ha+344>>2];j=+o[K>>2];u=+o[E>>2];f=(ia*aa+ga*j+fa*u>0.0?1.0:-1.0)*((oa+qa)*2.0*.5);z=+o[L>>2];y=+o[N>>2];h=+o[M>>2];w=(ia*z+ga*y+fa*h>0.0?1.0:-1.0)*((pa+ra)*2.0*.5);g=(ia*n+ga*x+fa*xa>0.0?1.0:-1.0)*(sa*.5);z=+o[b+48>>2]+f*aa+w*z+g*n;y=+o[b+52>>2]+f*j+w*y+g*x;x=+o[b+56>>2]+f*u+w*h+g*xa;k[Ha+456>>2]=k[b+112>>2];k[Ha+456+4>>2]=k[b+112+4>>2];k[Ha+456+8>>2]=k[b+112+8>>2];g=(ia*q+ga*v+fa*p>0.0?-1.0:1.0)*((ua+wa)*2.0*.5);h=(ia*Ba+ga*za+fa*m>0.0?-1.0:1.0)*((va+ta)*2.0*.5);w=+o[Ha+456+4>>2]+g*v+h*za;v=+o[Ha+456+8>>2]+g*p+h*m;u=(ia*Aa+ga*Da+fa*Fa>0.0?-1.0:1.0)*(ya*.5);q=+o[Ha+456>>2]+g*q+h*Ba+u*Aa;o[Ha+456>>2]=q;o[Ha+456+4>>2]=w+u*Da;o[Ha+456+8>>2]=v+u*Fa;Ea=s+-7|0;h=+o[Ha+344+(((Ea|0)/3|0)<<2)>>2];g=+o[Ha+344+(((Ea|0)/3|0)+4<<2)>>2];f=+o[Ha+344+(((Ea|0)/3|0)+8<<2)>>2];m=+o[Ha+96+(((Ea|0)%3|0)<<2)>>2];n=+o[Ha+96+(((Ea|0)%3|0)+4<<2)>>2];p=+o[Ha+96+(((Ea|0)%3|0)+8<<2)>>2];j=1.0-(h*m+g*n+f*p)*(h*m+g*n+f*p);if(!(j<=9.999999747378752e-05))h=(((q-z)*h+(w+u*Da-y)*g+(v+u*Fa-x)*f)*(h*m+g*n+f*p)-((q-z)*m+(w+u*Da-y)*n+(v+u*Fa-x)*p))*(1.0/j);else h=0.0;o[Ha+456>>2]=q+h*m;o[Ha+456+4>>2]=w+u*Da+h*n;o[Ha+456+8>>2]=v+u*Fa+h*p;Ea=k[(k[c>>2]|0)+16>>2]|0;o[Ha+32>>2]=-ia;o[Ha+32+4>>2]=-ga;o[Ha+32+8>>2]=-fa;o[Ha+32+12>>2]=0.0;xc[Ea&15](c,Ha+32|0,Ha+456|0,A);r=Ha;return}Ea=(s|0)<4;if(Ea){x=Da;z=Fa;y=za;n=Aa;w=Ba;$=ia;aa=ga;ba=fa;d=Ha+144|0;i=b+112|0;Ca=b+48|0;B=Ha+96|0;e=Ha+344|0;_=Ha}else{z=xa;y=+o[N>>2];m=+o[M>>2];w=+o[L>>2];$=-ia;aa=-ga;ba=-fa;d=Ha;i=b+48|0;Ca=b+112|0;B=Ha+344|0;e=Ha+96|0;_=Ha+144|0;v=+o[K>>2];p=+o[E>>2];q=+o[Ha+344>>2]}h=$*q+aa*v+ba*p;o[Ha+48>>2]=h;g=$*w+aa*y+ba*m;o[Ha+48+4>>2]=g;j=$*n+aa*x+ba*z;o[Ha+48+8>>2]=j;h=+X(+h);g=+X(+g);j=+X(+j);if(g>h){l=g>j;a=0;t=g>j?1:2}else{l=h>j;a=h>j&1;t=h>j?0:2}l=l?2:1;u=+o[d+(t<<2)>>2];v=+o[i>>2]-+o[Ca>>2];q=u*+o[B+(t<<2)>>2];w=+o[i+4>>2];na=Ca+4|0;p=+o[na>>2];n=+o[i+8>>2];ma=Ca+8|0;m=+o[ma>>2];if(+o[Ha+48+(t<<2)>>2]<0.0){Z=v+q;W=w-p+u*+o[B+((t|4)<<2)>>2];V=n-m+u*+o[B+((t|8)<<2)>>2]}else{Z=v-q;W=w-p-u*+o[B+((t|4)<<2)>>2];V=n-m-u*+o[B+((t|8)<<2)>>2]}G=(Ea?-1:-4)+s|0;if((G|0)==1){t=0;s=2}else if(!G){t=1;s=2}else{t=0;s=1}T=+o[e+(t<<2)>>2];Q=+o[e+((t|4)<<2)>>2];R=+o[e+((t|8)<<2)>>2];U=Z*T+W*Q+V*R;S=+o[e+(s<<2)>>2];P=+o[e+((s|4)<<2)>>2];g=+o[e+((s|8)<<2)>>2];f=Z*S+W*P+V*g;J=B+(a<<2)|0;j=+o[J>>2];L=B+((a|4)<<2)|0;F=+o[L>>2];O=B+((a|8)<<2)|0;h=+o[O>>2];K=B+(l<<2)|0;I=+o[K>>2];M=B+((l|4)<<2)|0;A=+o[M>>2];N=B+((l|8)<<2)|0;H=+o[N>>2];Da=+o[d+(a<<2)>>2];Fa=+o[d+(l<<2)>>2];Ba=(T*I+Q*A+R*H)*Fa;Fa=(S*I+P*A+g*H)*Fa;o[Ha+208>>2]=U-(T*j+Q*F+R*h)*Da-Ba;o[Ha+208+4>>2]=f-(S*j+P*F+g*h)*Da-Fa;o[Ha+208+8>>2]=U-(T*j+Q*F+R*h)*Da+Ba;o[Ha+208+12>>2]=f-(S*j+P*F+g*h)*Da+Fa;o[Ha+208+16>>2]=U+(T*j+Q*F+R*h)*Da+Ba;o[Ha+208+20>>2]=f+(S*j+P*F+g*h)*Da+Fa;o[Ha+208+24>>2]=U+(T*j+Q*F+R*h)*Da-Ba;o[Ha+208+28>>2]=f+(S*j+P*F+g*h)*Da-Fa;o[Ha+336>>2]=+o[_+(t<<2)>>2];o[Ha+336+4>>2]=+o[_+(s<<2)>>2];E=0;s=4;d=Ha+208|0;b=Ha+392|0;a:while(1){C=Ha+336+(E<<2)|0;D=1-E|0;do if((s|0)>0){a=s;s=0;B=d;t=b;while(1){l=B+(E<<2)|0;z=+o[l>>2];y=+o[C>>2];if(y>-z){o[t>>2]=+o[B>>2];o[t+4>>2]=+o[B+4>>2];s=s+1|0;if(s&8){t=b;break a}z=+o[l>>2];y=+o[C>>2];t=t+8|0}e=(a|0)>1;i=B;B=B+8|0;l=e?B:d;x=+o[l+(E<<2)>>2];if(y>-z^y>-x){Fa=+o[i+(D<<2)>>2];o[t+(D<<2)>>2]=Fa+(-y-z)*((+o[l+(D<<2)>>2]-Fa)/(x-z));o[t+(E<<2)>>2]=-+o[C>>2];s=s+1|0;if(!(s&8))t=t+8|0;else{t=b;break a}}if(!e)break;else a=a+-1|0}t=(b|0)==(Ha+392|0)?Ha+568|0:Ha+392|0;if((s|0)>0){d=s;s=0;B=b;l=t}else{s=0;break}while(1){i=B+(E<<2)|0;z=+o[i>>2];y=+o[C>>2];if(z<y){o[l>>2]=+o[B>>2];o[l+4>>2]=+o[B+4>>2];s=s+1|0;if(s&8)break a;z=+o[i>>2];y=+o[C>>2];l=l+8|0}a=(d|0)>1;e=B;B=B+8|0;i=a?B:b;x=+o[i+(E<<2)>>2];if(z<y^x<y){Fa=+o[e+(D<<2)>>2];o[l+(D<<2)>>2]=Fa+(y-z)*((+o[i+(D<<2)>>2]-Fa)/(x-z));o[l+(E<<2)>>2]=+o[C>>2];s=s+1|0;if(!(s&8))l=l+8|0;else break a}if(!a)break;else d=d+-1|0}}else{t=(b|0)==(Ha+392|0)?Ha+568|0:Ha+392|0;s=0}while(0);E=E+1|0;if((E|0)>=2)break;else{d=t;b=(t|0)==(Ha+392|0)?Ha+568|0:Ha+392|0}}if((t|0)!=(Ha+392|0))qF(Ha+392|0,t|0,s<<3|0)|0;if((s|0)>=1){u=1.0/((T*j+Q*F+R*h)*(S*I+P*A+g*H)-(S*j+P*F+g*h)*(T*I+Q*A+R*H));m=+o[_+(G<<2)>>2];s=s+-1|0;n=+o[J>>2];p=+o[K>>2];q=+o[L>>2];v=+o[M>>2];w=+o[O>>2];x=+o[N>>2];a=0;t=0;while(1){N=t<<1;z=+o[Ha+392+(N<<2)>>2];y=+o[Ha+392+((N|1)<<2)>>2];Aa=(S*I+P*A+g*H)*u*(z-U)-(T*I+Q*A+R*H)*u*(y-f);Fa=(T*j+Q*F+R*h)*u*(y-f)-(S*j+P*F+g*h)*u*(z-U);N=a*3|0;Ba=Z+Aa*n+Fa*p;o[Ha+472+(N<<2)>>2]=Ba;Da=W+Aa*q+Fa*v;o[Ha+472+(N+1<<2)>>2]=Da;Fa=V+Aa*w+Fa*x;o[Ha+472+(N+2<<2)>>2]=Fa;Fa=m-($*Ba+aa*Da+ba*Fa);o[Ha+632+(a<<2)>>2]=Fa;if(Fa>=0.0){N=a<<1;o[Ha+392+(N<<2)>>2]=z;o[Ha+392+((N|1)<<2)>>2]=y;a=a+1|0}if((t|0)==(s|0))break;else t=t+1|0}b:do if((a|0)>=1){B=(a|0)<4?a:4;B=(B|0)<1?1:B;if((a|0)<=(B|0))if(Ea){d=a+-1|0;h=-ia;g=-ga;f=-fa;e=0;while(1){Ea=e*3|0;o[Ha+160>>2]=+o[Ha+472+(Ea<<2)>>2]+ +o[Ca>>2];o[Ha+160+4>>2]=+o[Ha+472+(Ea+1<<2)>>2]+ +o[na>>2];o[Ha+160+8>>2]=+o[Ha+472+(Ea+2<<2)>>2]+ +o[ma>>2];Ea=k[(k[c>>2]|0)+16>>2]|0;o[Ha+176>>2]=h;o[Ha+176+4>>2]=g;o[Ha+176+8>>2]=f;o[Ha+176+12>>2]=0.0;xc[Ea&15](c,Ha+176|0,Ha+160|0,-+o[Ha+632+(e<<2)>>2]);if((e|0)==(d|0))break b;else e=e+1|0}}else{e=a+-1|0;h=-ia;g=-ga;f=-fa;d=0;while(1){Ea=d*3|0;Fa=+o[Ha+632+(d<<2)>>2];o[Ha+192>>2]=+o[Ha+472+(Ea<<2)>>2]+ +o[Ca>>2]-ia*Fa;o[Ha+192+4>>2]=+o[Ha+472+(Ea+1<<2)>>2]+ +o[na>>2]-ga*Fa;o[Ha+192+8>>2]=+o[Ha+472+(Ea+2<<2)>>2]+ +o[ma>>2]-fa*Fa;Ea=k[(k[c>>2]|0)+16>>2]|0;o[Ha+240>>2]=h;o[Ha+240+4>>2]=g;o[Ha+240+8>>2]=f;o[Ha+240+12>>2]=0.0;xc[Ea&15](c,Ha+240|0,Ha+192|0,-Fa);if((d|0)==(e|0))break b;else d=d+1|0}}do if((a|0)>1){d=a+-1|0;i=1;l=0;g=+o[Ha+632>>2];while(1){h=+o[Ha+632+(i<<2)>>2];e=h>g;l=e?i:l;if((i|0)==(d|0))break;else{i=i+1|0;g=e?h:g}}if((a|0)==1){e=Ha+288|0;a=1;i=l;Ga=112;break}else if((a|0)==2){e=Ha+288|0;a=2;j=(+o[Ha+392>>2]+ +o[Ha+392+8>>2])*.5;h=(+o[Ha+392+4>>2]+ +o[Ha+392+12>>2])*.5;Ga=118;break}else{h=0.0;j=0.0;u=0.0;i=0}do{N=i<<1;Aa=+o[Ha+392+(N<<2)>>2];Ba=+o[Ha+392+(N+3<<2)>>2];Da=+o[Ha+392+(N+2<<2)>>2];Fa=+o[Ha+392+((N|1)<<2)>>2];h=h+(Aa*Ba-Da*Fa);j=j+(Aa+Da)*(Aa*Ba-Da*Fa);u=u+(Ba+Fa)*(Aa*Ba-Da*Fa);i=i+1|0}while((i|0)<(d|0));N=a<<1;q=+o[Ha+392+(N+-2<<2)>>2];n=+o[Ha+392+4>>2];m=+o[Ha+392>>2];g=+o[Ha+392+(N+-1<<2)>>2];h=h+(q*n-m*g);if(+X(+h)>1.1920928955078125e-07)p=1.0/(h*3.0);else p=999999984306749440.0;if((a|0)>0){e=Ha+288|0;j=p*(j+(q*n-m*g)*(q+m));h=p*(u+(q*n-m*g)*(g+n));Ga=118}else{e=Ha+288|0;d=0}}else{e=Ha+288|0;i=0;Ga=112}while(0);if((Ga|0)==112){j=+o[Ha+392>>2];h=+o[Ha+392+4>>2];l=i;Ga=118}if((Ga|0)==118){i=a+-1|0;d=0;while(1){N=d<<1;Fa=+ea(+(+o[Ha+392+((N|1)<<2)>>2]-h),+(+o[Ha+392+(N<<2)>>2]-j));o[Ha+568+(d<<2)>>2]=Fa;if((d|0)==(i|0)){d=0;break}else d=d+1|0}while(1){k[Ha+256+(d<<2)>>2]=1;if((d|0)==(i|0)){d=1;break}else d=d+1|0}}i=Ha+256+(l<<2)|0;k[i>>2]=0;k[e>>2]=l;c:do if((B|0)>1){v=+o[Ha+568+(l<<2)>>2];if(!d){a=Ha+288+4|0;d=1;while(1){k[a>>2]=l;k[i>>2]=0;if((d|0)==(B+-1|0))break c;else{N=a;a=e+8|0;d=d+1|0;e=N}}}t=a+-1|0;s=Ha+288+4|0;d=1;while(1){h=+(d|0)*(6.2831854820251465/+(B|0))+v;if(h>3.1415927410125732)h=h+-6.2831854820251465;k[s>>2]=l;i=l;a=0;p=1.0e9;while(1){do if(!(k[Ha+256+(a<<2)>>2]|0))g=p;else{g=+X(+(+o[Ha+568+(a<<2)>>2]-h));if(g>3.1415927410125732)g=6.2831854820251465-g;if(!(g<p)){g=p;break}k[s>>2]=a;i=a}while(0);if((a|0)==(t|0))break;else{a=a+1|0;p=g}}k[Ha+256+(i<<2)>>2]=0;if((d|0)==(B+-1|0))break;else{N=s;s=e+8|0;d=d+1|0;e=N}}}while(0);if((B|0)<=0)break;h=-fa;g=-ga;f=-ia;if(Ea){e=0;do{Ea=k[Ha+288+(e<<2)>>2]|0;o[Ha+64>>2]=+o[Ha+472+(Ea*3<<2)>>2]+ +o[Ca>>2];o[Ha+64+4>>2]=+o[Ha+472+((Ea*3|0)+1<<2)>>2]+ +o[na>>2];o[Ha+64+8>>2]=+o[Ha+472+((Ea*3|0)+2<<2)>>2]+ +o[ma>>2];N=k[(k[c>>2]|0)+16>>2]|0;o[Ha+320>>2]=f;o[Ha+320+4>>2]=g;o[Ha+320+8>>2]=h;o[Ha+320+12>>2]=0.0;xc[N&15](c,Ha+320|0,Ha+64|0,-+o[Ha+632+(Ea<<2)>>2]);e=e+1|0}while((e|0)<(B|0))}else{e=0;do{N=k[Ha+288+(e<<2)>>2]|0;Aa=+o[Ha+472+(N*3<<2)>>2]+ +o[Ca>>2];o[Ha+64>>2]=Aa;Ba=+o[Ha+472+((N*3|0)+1<<2)>>2]+ +o[na>>2];o[Ha+64+4>>2]=Ba;Da=+o[Ha+472+((N*3|0)+2<<2)>>2]+ +o[ma>>2];o[Ha+64+8>>2]=Da;Ea=k[(k[c>>2]|0)+16>>2]|0;o[Ha+16>>2]=f;o[Ha+16+4>>2]=g;o[Ha+16+8>>2]=h;o[Ha+16+12>>2]=0.0;Fa=+o[Ha+632+(N<<2)>>2];o[Ha+80>>2]=Aa-ia*Fa;o[Ha+80+4>>2]=Ba-Fa*ga;o[Ha+80+8>>2]=Da-Fa*fa;o[Ha+80+12>>2]=0.0;xc[Ea&15](c,Ha+16|0,Ha+80|0,-Fa);e=e+1|0}while((e|0)<(B|0))}}while(0)}r=Ha;return}function iw(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0,B=0.0,C=0.0,D=0.0,E=0.0,F=0,G=0;F=r;r=r+96|0;B=+o[b+48>>2]-+o[b+112>>2];f=+o[b+52>>2]-+o[b+116>>2];E=+o[b+56>>2]-+o[b+120>>2];C=B*+o[b+64>>2]+f*+o[b+80>>2]+E*+o[b+96>>2];D=B*+o[b+68>>2]+f*+o[b+84>>2]+E*+o[b+100>>2];E=B*+o[b+72>>2]+f*+o[b+88>>2]+E*+o[b+104>>2];d=k[a+8>>2]|0;A=k[a+4>>2]|0;f=+o[A+28>>2]*+o[A+12>>2];B=f+ +o[a+12>>2];v=+o[d+72>>2];u=+o[d+56>>2];m=+o[d+76>>2];l=+o[d+60>>2];j=+o[d+80>>2];w=+o[d+64>>2];x=+o[d+88>>2];y=+o[d+92>>2];z=+o[d+96>>2];t=(m-l)*(z-w)-(j-w)*(y-l);q=(j-w)*(x-u)-(v-u)*(z-w);s=(v-u)*(y-l)-(m-l)*(x-u);n=1.0/+Y(+(s*s+(t*t+q*q)));p=(C-u)*(n*t)+n*q*(D-l)+n*s*(E-w);if(p<0.0){p=-p;g=-(n*s);h=-(n*q);i=-(n*t)}else{g=n*s;h=n*q;i=n*t}do if(p<B){t=(E-w)*((v-u)*h-(m-l)*i)+((C-u)*((m-l)*g-(j-w)*h)+(D-l)*((j-w)*i-(v-u)*g));v=(E-j)*((x-v)*h-(y-m)*i)+((C-v)*((y-m)*g-(z-j)*h)+(D-m)*((z-j)*i-(x-v)*g));z=(E-z)*((u-x)*h-(l-y)*i)+((C-x)*((l-y)*g-(w-z)*h)+(D-y)*((w-z)*i-(u-x)*g));if(!(z>0.0&(t>0.0&v>0.0))?!(z<=0.0&(t<=0.0&v<=0.0)):0){if((Wb[k[(k[d>>2]|0)+100>>2]&127](d)|0)<=0)break;m=0.0;q=0.0;p=0.0;d=0;A=0;do{G=k[a+8>>2]|0;Cc[k[(k[G>>2]|0)+104>>2]&127](G,A,F+80|0,F+64|0);z=+o[F+80>>2];u=+o[F+80+4>>2];s=+o[F+80+8>>2];y=+o[F+64>>2]-z;v=+o[F+64+4>>2]-u;n=+o[F+64+8>>2]-s;do if((C-z)*y+(D-u)*v+(E-s)*n>0.0)if((C-z)*y+(D-u)*v+(E-s)*n<y*y+v*v+n*n){x=((C-z)*y+(D-u)*v+(E-s)*n)/(y*y+v*v+n*n);l=C-z-y*x;j=D-u-v*x;t=E-s-n*x;break}else{l=C-z-y;j=D-u-v;t=E-s-n;x=1.0;break}else{l=C-z;j=D-u;t=E-s;x=0.0}while(0);if(t*t+(j*j+l*l)<B*B){p=s+n*x;q=u+v*x;m=z+y*x;d=1}A=A+1|0;G=k[a+8>>2]|0}while((A|0)<(Wb[k[(k[G>>2]|0)+100>>2]&127](G)|0));if(!(d&1))break;else{n=B*B;s=m}}else{n=B*B;s=C-i*p;q=D-h*p;p=E-g*p}j=C-s;l=D-q;m=E-p;if(j*j+l*l+m*m<n){if(j*j+l*l+m*m>1.1920928955078125e-07){g=+Y(+(j*j+l*l+m*m));f=f-g;i=j*(1.0/g);h=l*(1.0/g);g=m*(1.0/g)}f=-f;if(e){x=+o[b+64>>2];y=+o[b+68>>2];z=+o[b+72>>2];B=x*i+y*h+z*g;m=+o[b+80>>2];n=+o[b+84>>2];t=+o[b+88>>2];C=i*m+h*n+g*t;u=+o[b+96>>2];v=+o[b+100>>2];w=+o[b+104>>2];D=i*u+h*v+g*w;o[F+48>>2]=-B;o[F+48+4>>2]=-C;o[F+48+8>>2]=-D;o[F+48+12>>2]=0.0;C=s*m+q*n+p*t+ +o[b+116>>2]+C*f;D=s*u+q*v+p*w+ +o[b+120>>2]+D*f;o[F+32>>2]=s*x+q*y+p*z+ +o[b+112>>2]+B*f;o[F+32+4>>2]=C;o[F+32+8>>2]=D;o[F+32+12>>2]=0.0;xc[k[(k[c>>2]|0)+16>>2]&15](c,F+48|0,F+32|0,f);r=F;return}else{G=k[(k[c>>2]|0)+16>>2]|0;y=+o[b+64>>2];z=+o[b+68>>2];B=+o[b+72>>2];u=+o[b+80>>2];v=+o[b+84>>2];C=+o[b+88>>2];w=+o[b+96>>2];x=+o[b+100>>2];D=+o[b+104>>2];o[F+16>>2]=y*i+z*h+B*g;o[F+16+4>>2]=i*u+h*v+g*C;o[F+16+8>>2]=i*w+h*x+g*D;o[F+16+12>>2]=0.0;C=s*u+q*v+p*C+ +o[b+116>>2];D=s*w+q*x+p*D+ +o[b+120>>2];o[F>>2]=s*y+q*z+p*B+ +o[b+112>>2];o[F+4>>2]=C;o[F+8>>2]=D;o[F+12>>2]=0.0;xc[G&15](c,F+16|0,F,f);r=F;return}}}while(0);r=F;return}function jw(a){a=a|0;var b=0,c=0,d=0,e=0,f=0,g=0,h=0;g=k[a+12>>2]|0;h=k[a+32>>2]|0;if((h|0)>=(g|0))return;if((h|0)<=(g|0)){if((k[a+36>>2]|0)<(g|0)){if(!g){b=0;c=h}else{k[5108]=(k[5108]|0)+1;b=iF((g<<2|3)+16|0)|0;if(!b)b=0;else{k[(b+4+15&-16)+-4>>2]=b;b=b+4+15&-16}c=k[a+32>>2]|0}if((c|0)>0){e=c+-1|0;c=0;while(1){d=b+(c<<2)|0;if(d)k[d>>2]=k[(k[a+40>>2]|0)+(c<<2)>>2];if((c|0)==(e|0))break;else c=c+1|0}}c=k[a+40>>2]|0;if(c){if(i[a+44>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[a+40>>2]=0}i[a+44>>0]=1;k[a+40>>2]=b;k[a+36>>2]=g}else b=k[a+40>>2]|0;e=h;while(1){c=b+(e<<2)|0;if(c)k[c>>2]=0;if((e|0)==(g+-1|0))break;else e=e+1|0}}k[a+32>>2]=g;e=k[a+52>>2]|0;if((e|0)<(g|0)){if((k[a+56>>2]|0)<(g|0)){if(!g){c=0;b=e}else{k[5108]=(k[5108]|0)+1;c=iF((g<<2|3)+16|0)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}b=k[a+52>>2]|0}if((b|0)>0){d=b+-1|0;f=0;while(1){b=c+(f<<2)|0;if(b)k[b>>2]=k[(k[a+60>>2]|0)+(f<<2)>>2];if((f|0)==(d|0))break;else f=f+1|0}}b=k[a+60>>2]|0;if(b){if(i[a+64>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+60>>2]=0}i[a+64>>0]=1;k[a+60>>2]=c;k[a+56>>2]=g}else c=k[a+60>>2]|0;while(1){b=c+(e<<2)|0;if(b)k[b>>2]=0;if((e|0)==(g+-1|0))break;else e=e+1|0}}k[a+52>>2]=g;if((g|0)>0){nF(k[a+40>>2]|0,-1,g<<2|0)|0;nF(k[a+60>>2]|0,-1,g<<2|0)|0}if((h|0)<=0)return;b=k[a+16>>2]|0;d=k[a+40>>2]|0;c=k[a+60>>2]|0;e=0;while(1){g=k[b+(e*12|0)+4>>2]<<16|k[b+(e*12|0)>>2];g=(g+~(g<<15)>>10^g+~(g<<15))*9|0;g=d+((((g>>6^g)+~((g>>6^g)<<11)>>16^(g>>6^g)+~((g>>6^g)<<11))&(k[a+12>>2]|0)+-1)<<2)|0;k[c+(e<<2)>>2]=k[g>>2];k[g>>2]=e;if((e|0)==(h+-1|0))break;else e=e+1|0}return}function kw(a){a=a|0;var b=0;k[a>>2]=19920;b=k[a+60>>2]|0;if(b){if(i[a+64>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+60>>2]=0}i[a+64>>0]=1;k[a+60>>2]=0;k[a+52>>2]=0;k[a+56>>2]=0;b=k[a+40>>2]|0;if(b){if(i[a+44>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+40>>2]=0}i[a+44>>0]=1;k[a+40>>2]=0;k[a+32>>2]=0;k[a+36>>2]=0;b=k[a+16>>2]|0;if(!b){i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;a=a+12|0;k[a>>2]=0;return}if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+16>>2]=0;i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;a=a+12|0;k[a>>2]=0;return}function lw(a){a=a|0;kw(a);jF(a);return}function mw(a){a=a|0;var b=0,c=0,d=0,e=0,f=0;b=k[a+16>>2]|0;if(b){if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+16>>2]=0}i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;b=k[a+40>>2]|0;if(b){if(i[a+44>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+40>>2]=0}i[a+44>>0]=1;k[a+40>>2]=0;k[a+32>>2]=0;k[a+36>>2]=0;b=k[a+60>>2]|0;if(b){if(i[a+64>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+60>>2]=0}i[a+64>>0]=1;k[a+60>>2]=0;k[a+52>>2]=0;k[a+56>>2]=0;if((k[a+12>>2]|0)>=2){jw(a);return}k[5108]=(k[5108]|0)+1;b=iF(43)|0;if(!b)e=0;else{k[(b+4+15&-16)+-4>>2]=b;e=b+4+15&-16}b=k[a+8>>2]|0;if((b|0)>0){d=0;while(1){c=e+(d*12|0)|0;if(c){f=(k[a+16>>2]|0)+(d*12|0)|0;k[c>>2]=k[f>>2];k[c+4>>2]=k[f+4>>2];k[c+8>>2]=k[f+8>>2]}if((d|0)==(b+-1|0))break;else d=d+1|0}}b=k[a+16>>2]|0;if(b){if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+16>>2]=0}i[a+20>>0]=1;k[a+16>>2]=e;k[a+12>>2]=2;jw(a);return}function nw(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,i=0,j=0,l=0,m=0,n=0,o=0;k[4972]=(k[4972]|0)+1;g=((c<<16|b)+~((c<<16|b)<<15)>>10^(c<<16|b)+~((c<<16|b)<<15))*9|0;m=k[a+40>>2]|0;g=m+(((k[a+12>>2]|0)+-1&((g>>6^g)+~((g>>6^g)<<11)>>16^(g>>6^g)+~((g>>6^g)<<11)))<<2)|0;e=k[g>>2]|0;if((e|0)==-1){o=0;return o|0}n=k[a+16>>2]|0;d=e;while(1){if((k[n+(d*12|0)>>2]|0)==(b|0)?(k[n+(d*12|0)+4>>2]|0)==(c|0):0)break;d=k[(k[a+60>>2]|0)+(d<<2)>>2]|0;if((d|0)==-1){d=0;o=22;break}}if((o|0)==22)return d|0;j=n+(d*12|0)|0;if(!j){o=0;return o|0}l=k[n+(d*12|0)+8>>2]|0;i=(d*12|0)/12|0;h=k[a+60>>2]|0;if((e|0)!=(i|0)){while(1){b=h+(e<<2)|0;c=k[b>>2]|0;if((c|0)==(i|0))break;else e=c}d=k[h+(i<<2)>>2]|0;if((e|0)==-1)o=12;else k[b>>2]=d}else{d=k[h+(e<<2)>>2]|0;o=12}if((o|0)==12)k[g>>2]=d;f=(k[a+8>>2]|0)+-1|0;if((f|0)==(i|0)){k[a+8>>2]=i;o=l;return o|0}g=k[n+(f*12|0)+4>>2]<<16|k[n+(f*12|0)>>2];g=(g+~(g<<15)>>10^g+~(g<<15))*9|0;g=((g>>6^g)+~((g>>6^g)<<11)>>16^(g>>6^g)+~((g>>6^g)<<11))&(k[a+12>>2]|0)+-1;c=k[m+(g<<2)>>2]|0;if((c|0)!=(f|0)){while(1){b=h+(c<<2)|0;e=k[b>>2]|0;if((e|0)==(f|0))break;else c=e}d=k[h+(f<<2)>>2]|0;if((c|0)==-1)o=20;else k[b>>2]=d}else{d=k[h+(f<<2)>>2]|0;o=20}if((o|0)==20)k[m+(g<<2)>>2]=d;k[j>>2]=k[n+(f*12|0)>>2];k[j+4>>2]=k[n+(f*12|0)+4>>2];k[j+8>>2]=k[n+(f*12|0)+8>>2];o=(k[a+40>>2]|0)+(g<<2)|0;k[(k[a+60>>2]|0)+(i<<2)>>2]=k[o>>2];k[o>>2]=i;k[a+8>>2]=(k[a+8>>2]|0)+-1;o=l;return o|0}function ow(a){a=a|0;var b=0,c=0,d=0,e=0,f=0,g=0,h=0;k[a>>2]=19992;b=k[a+56>>2]|0;if(b){if(i[a+60>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+56>>2]=0}i[a+60>>0]=1;k[a+56>>2]=0;k[a+48>>2]=0;k[a+52>>2]=0;c=k[a+28>>2]|0;if((c|0)>0){h=0;while(1){d=k[a+36>>2]|0;e=d+(h*36|0)+4|0;f=d+(h*36|0)+12|0;g=k[f>>2]|0;b=d+(h*36|0)+16|0;if(g){if(i[b>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[g+-4>>2]|0)}k[f>>2]=0}i[b>>0]=1;k[f>>2]=0;k[e>>2]=0;k[d+(h*36|0)+8>>2]=0;if((h|0)==(c+-1|0))break;else h=h+1|0}}b=k[a+36>>2]|0;if(b){if(i[a+40>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+36>>2]=0}i[a+40>>0]=1;k[a+36>>2]=0;k[a+28>>2]=0;k[a+32>>2]=0;b=k[a+16>>2]|0;if(!b){i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;a=a+12|0;k[a>>2]=0;return}if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+16>>2]=0;i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;a=a+12|0;k[a>>2]=0;return}function pw(a){a=a|0;ow(a);if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function qw(a){a=a|0;var b=0,c=0,d=0.0,e=0.0,f=0.0,g=0,h=0;g=k[a+28>>2]|0;if((g|0)<=0){a=1;return a|0}b=k[a+36>>2]|0;e=0.0;f=0.0;d=0.0;h=0;a:while(1){switch(h|0){case 5:{d=+o[a+72>>2]-+o[a+88>>2];f=+o[a+84>>2]+ +o[a+68>>2];e=+o[a+64>>2]-+o[a+80>>2];break}case 6:{d=+o[a+88>>2]+ +o[a+72>>2];f=+o[a+68>>2]-+o[a+84>>2];e=+o[a+64>>2]-+o[a+80>>2];break}case 2:{d=+o[a+88>>2]+ +o[a+72>>2];f=+o[a+68>>2]-+o[a+84>>2];e=+o[a+80>>2]+ +o[a+64>>2];break}case 0:{d=+o[a+88>>2]+ +o[a+72>>2];f=+o[a+84>>2]+ +o[a+68>>2];e=+o[a+80>>2]+ +o[a+64>>2];break}case 7:{d=+o[a+72>>2]-+o[a+88>>2];f=+o[a+68>>2]-+o[a+84>>2];e=+o[a+64>>2]-+o[a+80>>2];break}case 4:{d=+o[a+88>>2]+ +o[a+72>>2];f=+o[a+84>>2]+ +o[a+68>>2];e=+o[a+64>>2]-+o[a+80>>2];break}case 1:{d=+o[a+72>>2]-+o[a+88>>2];f=+o[a+84>>2]+ +o[a+68>>2];e=+o[a+80>>2]+ +o[a+64>>2];break}case 3:{d=+o[a+72>>2]-+o[a+88>>2];f=+o[a+68>>2]-+o[a+84>>2];e=+o[a+80>>2]+ +o[a+64>>2];break}default:{}}c=0;do{if(+o[b+(c*36|0)+32>>2]+(e*+o[b+(c*36|0)+20>>2]+f*+o[b+(c*36|0)+24>>2]+d*+o[b+(c*36|0)+28>>2])>0.0){b=0;c=16;break a}c=c+1|0}while((c|0)<(g|0));h=h+1|0;if((h|0)>=8){b=1;c=16;break}}if((c|0)==16)return b|0;return 0}function rw(a,b,c,d,e,f,g){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;var h=0.0,i=0.0,j=0,l=0.0,m=0.0,n=0,p=0,q=0.0,s=0;p=r;r=r+16|0;o[d>>2]=3402823466385288598117041.0e14;o[e>>2]=-3402823466385288598117041.0e14;j=k[a+8>>2]|0;if((j|0)>0){n=0;while(1){s=k[a+16>>2]|0;q=+o[s+(n<<4)>>2];m=+o[s+(n<<4)+4>>2];l=+o[s+(n<<4)+8>>2];i=q*+o[b>>2]+m*+o[b+4>>2]+l*+o[b+8>>2]+ +o[b+48>>2];h=q*+o[b+16>>2]+m*+o[b+20>>2]+l*+o[b+24>>2]+ +o[b+52>>2];l=q*+o[b+32>>2]+m*+o[b+36>>2]+l*+o[b+40>>2]+ +o[b+56>>2];m=i*+o[c>>2]+h*+o[c+4>>2]+l*+o[c+8>>2];if(m<+o[d>>2]){o[d>>2]=m;o[f>>2]=i;o[f+4>>2]=h;o[f+8>>2]=l;o[f+12>>2]=0.0}if(m>+o[e>>2]){o[e>>2]=m;o[g>>2]=i;o[g+4>>2]=h;o[g+8>>2]=l;o[g+12>>2]=0.0}if((n|0)==(j+-1|0))break;else n=n+1|0}i=+o[e>>2]}else i=-3402823466385288598117041.0e14;h=+o[d>>2];if(!(h>i)){r=p;return}o[d>>2]=i;o[e>>2]=h;k[p>>2]=k[f>>2];k[p+4>>2]=k[f+4>>2];k[p+8>>2]=k[f+8>>2];k[p+12>>2]=k[f+12>>2];k[f>>2]=k[g>>2];k[f+4>>2]=k[g+4>>2];k[f+8>>2]=k[g+8>>2];k[f+12>>2]=k[g+12>>2];k[g>>2]=k[p>>2];k[g+4>>2]=k[p+4>>2];k[g+8>>2]=k[p+8>>2];k[g+12>>2]=k[p+12>>2];r=p;return}function sw(a){a=a|0;var b=0;k[a>>2]=20040;b=k[a+32>>2]|0;if(b){if(i[a+36>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+32>>2]=0}i[a+36>>0]=1;k[a+32>>2]=0;k[a+24>>2]=0;k[a+28>>2]=0;return}function tw(a){a=a|0;var b=0;k[a>>2]=20040;b=k[a+32>>2]|0;if(b){if(i[a+36>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+32>>2]=0}i[a+36>>0]=1;k[a+32>>2]=0;k[a+24>>2]=0;k[a+28>>2]=0;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function uw(a,b,c,d,e,f,g,h,i,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;a=k[a+32>>2]|0;k[c>>2]=k[a+(j<<5)+12>>2];k[b>>2]=k[a+(j<<5)+16>>2];k[d>>2]=k[a+(j<<5)+28>>2];k[e>>2]=k[a+(j<<5)+20>>2];k[h>>2]=k[a+(j<<5)>>2];k[f>>2]=k[a+(j<<5)+4>>2];k[g>>2]=k[a+(j<<5)+8>>2];k[i>>2]=k[a+(j<<5)+24>>2];return}function vw(a,b,c,d,e,f,g,h,i,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;a=k[a+32>>2]|0;k[c>>2]=k[a+(j<<5)+12>>2];k[b>>2]=k[a+(j<<5)+16>>2];k[d>>2]=k[a+(j<<5)+28>>2];k[e>>2]=k[a+(j<<5)+20>>2];k[h>>2]=k[a+(j<<5)>>2];k[f>>2]=k[a+(j<<5)+4>>2];k[g>>2]=k[a+(j<<5)+8>>2];k[i>>2]=k[a+(j<<5)+24>>2];return}function ww(a){a=a|0;return (k[a+48>>2]|0)==1|0}function xw(a,b,c){a=a|0;b=b|0;c=c|0;k[a+52>>2]=k[b>>2];k[a+52+4>>2]=k[b+4>>2];k[a+52+8>>2]=k[b+8>>2];k[a+52+12>>2]=k[b+12>>2];k[a+68>>2]=k[c>>2];k[a+68+4>>2]=k[c+4>>2];k[a+68+8>>2]=k[c+8>>2];k[a+68+12>>2]=k[c+12>>2];k[a+48>>2]=1;return}function yw(a,b,c){a=a|0;b=b|0;c=c|0;k[b>>2]=k[a+52>>2];k[b+4>>2]=k[a+52+4>>2];k[b+8>>2]=k[a+52+8>>2];k[b+12>>2]=k[a+52+12>>2];k[c>>2]=k[a+68>>2];k[c+4>>2]=k[a+68+4>>2];k[c+8>>2]=k[a+68+8>>2];k[c+12>>2]=k[a+68+12>>2];return}function zw(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0,i=0,j=0,n=0,q=0,s=0,t=0,u=0,v=0.0,w=0.0,x=0.0,y=0,z=0,A=0.0,B=0.0,C=0,D=0,E=0,F=0,G=0;z=r;r=r+96|0;u=Wb[k[(k[a>>2]|0)+28>>2]&127](a)|0;v=+o[a+4>>2];w=+o[a+8>>2];x=+o[a+12>>2];if((u|0)<=0){r=z;return}d=z+24+4|0;e=z+24+8|0;f=z+24+12|0;g=z+24+16|0;h=z+24+20|0;i=z+24+24|0;j=z+24+28|0;n=z+24+32|0;q=z+24+36|0;s=z+24+40|0;t=z+24+44|0;y=0;while(1){mc[k[(k[a>>2]|0)+16>>2]&3](a,z+76|0,z+12|0,z+8|0,z,z+16|0,z+4|0,z+72|0,z+80|0,y);c=k[z+8>>2]|0;do if((c|0)==1){c=k[z+80>>2]|0;if((c|0)==2){if((k[z+72>>2]|0)>0)c=0;else break;do{E=k[z+16>>2]|0;C=ia(k[z+4>>2]|0,c)|0;D=k[z+76>>2]|0;F=k[z>>2]|0;G=ia(F,k[E+C>>2]|0)|0;B=w*+p[D+(G+8)>>3];A=x*+p[D+(G+16)>>3];o[z+24>>2]=v*+p[D+G>>3];o[d>>2]=B;o[e>>2]=A;o[f>>2]=0.0;G=ia(F,k[E+(C+4)>>2]|0)|0;A=w*+p[D+(G+8)>>3];B=x*+p[D+(G+16)>>3];o[g>>2]=v*+p[D+G>>3];o[h>>2]=A;o[i>>2]=B;o[j>>2]=0.0;C=ia(F,k[E+(C+8)>>2]|0)|0;B=w*+p[D+(C+8)>>3];A=x*+p[D+(C+16)>>3];o[n>>2]=v*+p[D+C>>3];o[q>>2]=B;o[s>>2]=A;o[t>>2]=0.0;Cc[k[(k[b>>2]|0)+8>>2]&127](b,z+24|0,y,c);c=c+1|0}while((c|0)<(k[z+72>>2]|0))}else if((c|0)==3){if((k[z+72>>2]|0)>0)c=0;else break;do{E=k[z+16>>2]|0;F=ia(k[z+4>>2]|0,c)|0;G=k[z+76>>2]|0;C=k[z>>2]|0;D=ia(m[E+F>>1]|0,C)|0;A=w*+p[G+(D+8)>>3];B=x*+p[G+(D+16)>>3];o[z+24>>2]=v*+p[G+D>>3];o[d>>2]=A;o[e>>2]=B;o[f>>2]=0.0;D=ia(m[E+(F+2)>>1]|0,C)|0;B=w*+p[G+(D+8)>>3];A=x*+p[G+(D+16)>>3];o[g>>2]=v*+p[G+D>>3];o[h>>2]=B;o[i>>2]=A;o[j>>2]=0.0;C=ia(m[E+(F+4)>>1]|0,C)|0;A=w*+p[G+(C+8)>>3];B=x*+p[G+(C+16)>>3];o[n>>2]=v*+p[G+C>>3];o[q>>2]=A;o[s>>2]=B;o[t>>2]=0.0;Cc[k[(k[b>>2]|0)+8>>2]&127](b,z+24|0,y,c);c=c+1|0}while((c|0)<(k[z+72>>2]|0))}else if((c|0)==5){if((k[z+72>>2]|0)>0)c=0;else break;do{E=k[z+16>>2]|0;F=ia(k[z+4>>2]|0,c)|0;G=k[z+76>>2]|0;C=k[z>>2]|0;D=ia(l[E+F>>0]|0,C)|0;A=w*+p[G+(D+8)>>3];B=x*+p[G+(D+16)>>3];o[z+24>>2]=v*+p[G+D>>3];o[d>>2]=A;o[e>>2]=B;o[f>>2]=0.0;D=ia(l[E+(F+1)>>0]|0,C)|0;B=w*+p[G+(D+8)>>3];A=x*+p[G+(D+16)>>3];o[g>>2]=v*+p[G+D>>3];o[h>>2]=B;o[i>>2]=A;o[j>>2]=0.0;C=ia(l[E+(F+2)>>0]|0,C)|0;A=w*+p[G+(C+8)>>3];B=x*+p[G+(C+16)>>3];o[n>>2]=v*+p[G+C>>3];o[q>>2]=A;o[s>>2]=B;o[t>>2]=0.0;Cc[k[(k[b>>2]|0)+8>>2]&127](b,z+24|0,y,c);c=c+1|0}while((c|0)<(k[z+72>>2]|0))}else break}else if(!c){c=k[z+80>>2]|0;if((c|0)==2){if((k[z+72>>2]|0)>0)c=0;else break;do{F=k[z+16>>2]|0;C=ia(k[z+4>>2]|0,c)|0;G=k[z+76>>2]|0;E=k[z>>2]|0;D=ia(E,k[F+C>>2]|0)|0;A=w*+o[G+(D+4)>>2];B=x*+o[G+(D+8)>>2];o[z+24>>2]=v*+o[G+D>>2];o[d>>2]=A;o[e>>2]=B;o[f>>2]=0.0;D=ia(E,k[F+(C+4)>>2]|0)|0;B=w*+o[G+(D+4)>>2];A=x*+o[G+(D+8)>>2];o[g>>2]=v*+o[G+D>>2];o[h>>2]=B;o[i>>2]=A;o[j>>2]=0.0;C=ia(E,k[F+(C+8)>>2]|0)|0;A=w*+o[G+(C+4)>>2];B=x*+o[G+(C+8)>>2];o[n>>2]=v*+o[G+C>>2];o[q>>2]=A;o[s>>2]=B;o[t>>2]=0.0;Cc[k[(k[b>>2]|0)+8>>2]&127](b,z+24|0,y,c);c=c+1|0}while((c|0)<(k[z+72>>2]|0))}else if((c|0)==5){if((k[z+72>>2]|0)>0)c=0;else break;do{E=k[z+16>>2]|0;F=ia(k[z+4>>2]|0,c)|0;G=k[z+76>>2]|0;C=k[z>>2]|0;D=ia(l[E+F>>0]|0,C)|0;A=w*+o[G+(D+4)>>2];B=x*+o[G+(D+8)>>2];o[z+24>>2]=v*+o[G+D>>2];o[d>>2]=A;o[e>>2]=B;o[f>>2]=0.0;D=ia(l[E+(F+1)>>0]|0,C)|0;B=w*+o[G+(D+4)>>2];A=x*+o[G+(D+8)>>2];o[g>>2]=v*+o[G+D>>2];o[h>>2]=B;o[i>>2]=A;o[j>>2]=0.0;C=ia(l[E+(F+2)>>0]|0,C)|0;A=w*+o[G+(C+4)>>2];B=x*+o[G+(C+8)>>2];o[n>>2]=v*+o[G+C>>2];o[q>>2]=A;o[s>>2]=B;o[t>>2]=0.0;Cc[k[(k[b>>2]|0)+8>>2]&127](b,z+24|0,y,c);c=c+1|0}while((c|0)<(k[z+72>>2]|0))}else if((c|0)==3){if((k[z+72>>2]|0)>0)c=0;else break;do{E=k[z+16>>2]|0;F=ia(k[z+4>>2]|0,c)|0;G=k[z+76>>2]|0;C=k[z>>2]|0;D=ia(m[E+F>>1]|0,C)|0;A=w*+o[G+(D+4)>>2];B=x*+o[G+(D+8)>>2];o[z+24>>2]=v*+o[G+D>>2];o[d>>2]=A;o[e>>2]=B;o[f>>2]=0.0;D=ia(m[E+(F+2)>>1]|0,C)|0;B=w*+o[G+(D+4)>>2];A=x*+o[G+(D+8)>>2];o[g>>2]=v*+o[G+D>>2];o[h>>2]=B;o[i>>2]=A;o[j>>2]=0.0;C=ia(m[E+(F+4)>>1]|0,C)|0;A=w*+o[G+(C+4)>>2];B=x*+o[G+(C+8)>>2];o[n>>2]=v*+o[G+C>>2];o[q>>2]=A;o[s>>2]=B;o[t>>2]=0.0;Cc[k[(k[b>>2]|0)+8>>2]&127](b,z+24|0,y,c);c=c+1|0}while((c|0)<(k[z+72>>2]|0))}else break}while(0);Ub[k[(k[a>>2]|0)+24>>2]&127](a,y);if((y|0)==(u+-1|0))break;else y=y+1|0}r=z;return}function Aw(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,l=0,m=0,n=0,q=0,s=0,t=0,u=0,v=0,w=0,x=0.0,y=0;w=r;r=r+32|0;d=Wb[k[(k[a>>2]|0)+28>>2]&127](a)|0;k[b+20>>2]=d;k[b>>2]=0;if(!d){c=b+4|0;v=a+4|0;x=+o[v>>2];o[c>>2]=x;c=a+8|0;x=+o[c>>2];c=b+8|0;o[c>>2]=x;c=a+12|0;x=+o[c>>2];c=b+12|0;o[c>>2]=x;a=a+16|0;x=+o[a>>2];a=b+16|0;o[a>>2]=x;r=w;return 20288}v=dc[k[(k[c>>2]|0)+16>>2]&63](c,32,d)|0;d=k[v+8>>2]|0;s=nc[k[(k[c>>2]|0)+28>>2]&31](c,d)|0;k[b>>2]=s;s=Wb[k[(k[a>>2]|0)+28>>2]&127](a)|0;if((s|0)>0){q=0;while(1){mc[k[(k[a>>2]|0)+16>>2]&3](a,w+4|0,w+12|0,w+20|0,w,w+16|0,w+8|0,w+24|0,w+28|0,q);k[d+24>>2]=k[w+24>>2];k[d+28>>2]=k[w+12>>2];f=d+8|0;l=d+12|0;m=d+16|0;n=d+4|0;k[d>>2]=0;k[d+4>>2]=0;k[d+8>>2]=0;k[d+12>>2]=0;k[d+16>>2]=0;k[d+20>>2]=0;g=k[w+28>>2]|0;if((g|0)==3){e=k[w+24>>2]|0;if(e){f=dc[k[(k[c>>2]|0)+16>>2]&63](c,8,e)|0;e=k[f+8>>2]|0;m=nc[k[(k[c>>2]|0)+28>>2]&31](c,e)|0;k[l>>2]=m;m=k[w+24>>2]|0;if((m|0)>0){l=k[w+16>>2]|0;h=k[w+8>>2]|0;g=0;while(1){y=ia(h,g)|0;j[e+(g<<3)>>1]=j[l+y>>1]|0;j[e+(g<<3)+2>>1]=j[l+(y+2)>>1]|0;j[e+(g<<3)+4>>1]=j[l+(y+4)>>1]|0;if((g|0)==(m+-1|0))break;else g=g+1|0}}Qb[k[(k[c>>2]|0)+20>>2]&31](c,f,20168,1497453121,k[f+8>>2]|0)}}else if((g|0)==2){e=k[w+24>>2]|0;if(e){l=dc[k[(k[c>>2]|0)+16>>2]&63](c,4,e*3|0)|0;h=k[l+8>>2]|0;y=nc[k[(k[c>>2]|0)+28>>2]&31](c,h)|0;k[f>>2]=y;if((k[w+24>>2]|0)>0){g=k[w+16>>2]|0;f=0;do{m=ia(k[w+8>>2]|0,f)|0;y=f*3|0;k[h+(y<<2)>>2]=k[g+m>>2];k[h+(y+1<<2)>>2]=k[g+(m+4)>>2];k[h+(y+2<<2)>>2]=k[g+(m+8)>>2];f=f+1|0}while((f|0)<(k[w+24>>2]|0))}Qb[k[(k[c>>2]|0)+20>>2]&31](c,l,20152,1497453121,k[l+8>>2]|0)}}else if((g|0)==5?(t=k[w+24>>2]|0,(t|0)!=0):0){f=dc[k[(k[c>>2]|0)+16>>2]&63](c,4,t)|0;g=k[f+8>>2]|0;y=nc[k[(k[c>>2]|0)+28>>2]&31](c,g)|0;k[m>>2]=y;if((k[w+24>>2]|0)>0){e=0;do{m=k[w+16>>2]|0;y=ia(k[w+8>>2]|0,e)|0;i[g+(e<<2)>>0]=i[m+y>>0]|0;i[g+(e<<2)+1>>0]=i[m+(y+1)>>0]|0;i[g+(e<<2)+2>>0]=i[m+(y+2)>>0]|0;e=e+1|0}while((e|0)<(k[w+24>>2]|0))}Qb[k[(k[c>>2]|0)+20>>2]&31](c,f,20200,1497453121,k[f+8>>2]|0)}e=k[w+20>>2]|0;if(!e){e=k[w+12>>2]|0;if(e){g=dc[k[(k[c>>2]|0)+16>>2]&63](c,16,e)|0;f=k[g+8>>2]|0;e=nc[k[(k[c>>2]|0)+28>>2]&31](c,f)|0;k[d>>2]=e;e=k[w+12>>2]|0;if((e|0)>0){h=k[w+4>>2]|0;l=k[w>>2]|0;m=0;while(1){y=ia(l,m)|0;o[f+(m<<4)>>2]=+o[h+y>>2];o[f+(m<<4)+4>>2]=+o[h+(y+4)>>2];o[f+(m<<4)+8>>2]=+o[h+(y+8)>>2];if((m|0)==(e+-1|0))break;else m=m+1|0}}Qb[k[(k[c>>2]|0)+20>>2]&31](c,g,20224,1497453121,k[g+8>>2]|0)}}else if((e|0)==1?(u=k[w+12>>2]|0,(u|0)!=0):0){f=dc[k[(k[c>>2]|0)+16>>2]&63](c,32,u)|0;e=k[f+8>>2]|0;l=nc[k[(k[c>>2]|0)+28>>2]&31](c,e)|0;k[n>>2]=l;l=k[w+12>>2]|0;if((l|0)>0){h=k[w+4>>2]|0;g=k[w>>2]|0;m=0;while(1){y=ia(g,m)|0;p[e+(m<<5)>>3]=+p[h+y>>3];p[e+(m<<5)+8>>3]=+p[h+(y+8)>>3];p[e+(m<<5)+16>>3]=+p[h+(y+16)>>3];if((m|0)==(l+-1|0))break;else m=m+1|0}}Qb[k[(k[c>>2]|0)+20>>2]&31](c,f,20248,1497453121,k[f+8>>2]|0)}Ub[k[(k[a>>2]|0)+24>>2]&127](a,q);if((q|0)==(s+-1|0)){d=c;break}else{d=d+32|0;q=q+1|0}}}else d=c;Qb[k[(k[d>>2]|0)+20>>2]&31](c,v,20272,1497453121,k[v+8>>2]|0);y=b+4|0;c=a+4|0;x=+o[c>>2];o[y>>2]=x;y=a+8|0;x=+o[y>>2];y=b+8|0;o[y>>2]=x;y=a+12|0;x=+o[y>>2];y=b+12|0;o[y>>2]=x;y=a+16|0;x=+o[y>>2];y=b+16|0;o[y>>2]=x;r=w;return 20288}function Bw(a){a=a|0;var b=0;do{k[a+4>>2]=0;o[a+8>>2]=0.0;b=k[a+24>>2]|0;if(b)Bw(b);a=k[a+28>>2]|0}while((a|0)!=0);return}function Cw(a){a=a|0;var b=0,c=0,d=0,e=0;e=r;r=r+16|0;c=k[5104]|0;if((k[c>>2]|0)==(a|0))b=c;else{b=k[c+24>>2]|0;a:do if(!b)d=5;else while(1){if((k[b>>2]|0)==(a|0))break a;b=k[b+28>>2]|0;if(!b){d=5;break}}while(0);do if((d|0)==5){while(1){b=iF(36)|0;if(b){d=9;break}b=k[5230]|0;k[5230]=b+0;if(!b){d=8;break}zc[b&3]();d=5}if((d|0)==8){e=Gb(4)|0;k[e>>2]=20816;Eb(e|0,20864,207)}else if((d|0)==9){k[b>>2]=a;k[b+4>>2]=0;k[b+4+4>>2]=0;k[b+4+8>>2]=0;k[b+4+12>>2]=0;k[b+20>>2]=c;k[b+24>>2]=0;k[b+28>>2]=0;k[b+32>>2]=0;Bw(b);k[b+28>>2]=k[c+24>>2];k[c+24>>2]=b;break}}while(0);k[5104]=b}a=b+4|0;k[a>>2]=(k[a>>2]|0)+1;a=b+16|0;d=k[a>>2]|0;k[a>>2]=d+1;if(d){r=e;return}Kb(e|0,0)|0;d=k[5090]|0;k[b+12>>2]=(k[e+4>>2]|0)-(k[d+4>>2]|0)+(((k[e>>2]|0)-(k[d>>2]|0)|0)*1e6|0);r=e;return}function Dw(a,b,c,d,e,f,g,h,i,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;var k=0,l=0,m=0,n=0,o=0;if((e|0)!=(j|0)){e=e-j|0;return e|0}if(!e){e=0;return e|0}m=AF(h|0,0,a|0,0)|0;n=M;l=AF(i|0,0,a|0,0)|0;o=M;j=AF(h|0,0,b|0,0)|0;a=M;k=AF(i|0,0,b|0,0)|0;b=M;j=pF(l|0,0,j|0,0)|0;l=M;b=pF(o|0,0,k|0,b|0)|0;b=pF(b|0,M|0,a|0,0)|0;a=M;j=pF(m|0,n|0,0,j|0)|0;k=M;m=pF(b|0,a|0,(k>>>0<n>>>0|(k|0)==(n|0)&j>>>0<m>>>0)&1|0,0)|0;l=pF(m|0,M|0,l|0,0)|0;m=M;a=AF(f|0,0,c|0,0)|0;n=M;b=AF(g|0,0,c|0,0)|0;c=M;i=AF(f|0,0,d|0,0)|0;f=M;h=AF(g|0,0,d|0,0)|0;g=M;i=pF(b|0,0,i|0,0)|0;b=M;g=pF(c|0,0,h|0,g|0)|0;f=pF(g|0,M|0,f|0,0)|0;g=M;i=pF(a|0,n|0,0,i|0)|0;h=M;a=pF(f|0,g|0,(h>>>0<n>>>0|(h|0)==(n|0)&i>>>0<a>>>0)&1|0,0)|0;b=pF(a|0,M|0,b|0,0)|0;a=M;if(!(m>>>0<a>>>0|(m|0)==(a|0)&l>>>0<b>>>0))if(!(m>>>0>a>>>0|(m|0)==(a|0)&l>>>0>b>>>0))if(k>>>0<h>>>0|(k|0)==(h|0)&j>>>0<i>>>0)i=-1;else i=(k>>>0>h>>>0|(k|0)==(h|0)&j>>>0>i>>>0)&1;else i=1;else i=-1;o=ia(i,e)|0;return o|0}function Ew(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,i=0,j=0,l=0;d=k[a+56>>2]|0;if(!d){d=k[a+52>>2]|0;if(!d){k[5108]=(k[5108]|0)+1;e=iF(31)|0;if((e|0)!=0?(f=e+4+15&-16,k[f+-4>>2]=e,(e+4+15&-16|0)!=0):0){d=k[a+60>>2]|0;k[f+4>>2]=d;k[f+8>>2]=0;k[5108]=(k[5108]|0)+1;d=iF((d*24|3)+16|0)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}k[(e+4+15&-16)>>2]=d;d=e+4+15&-16}else d=0;k[d+8>>2]=k[a+48>>2];k[a+48>>2]=d}else k[a+52>>2]=k[d+8>>2];g=k[d+4>>2]|0;h=k[d>>2]|0;if((g|0)>0){f=0;e=h;do{d=f;f=f+1|0;l=e;e=e+24|0;k[l>>2]=(f|0)<(g|0)?e:0}while((d|0)!=(g+-1|0))}d=k[h>>2]|0;k[a+56>>2]=d;if(!h)g=0;else{d=h;j=15}}else{k[a+56>>2]=k[d>>2];j=15}if((j|0)==15){k[d>>2]=0;k[d+4>>2]=0;k[d+8>>2]=0;k[d+12>>2]=0;k[d+16>>2]=0;k[d+20>>2]=0;g=d;d=k[a+56>>2]|0}if(!d){d=k[a+52>>2]|0;if(!d){k[5108]=(k[5108]|0)+1;f=iF(31)|0;if((f|0)!=0?(i=f+4+15&-16,k[i+-4>>2]=f,(f+4+15&-16|0)!=0):0){d=k[a+60>>2]|0;k[i+4>>2]=d;k[i+8>>2]=0;k[5108]=(k[5108]|0)+1;d=iF((d*24|3)+16|0)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}k[(f+4+15&-16)>>2]=d;d=f+4+15&-16}else d=0;k[d+8>>2]=k[a+48>>2];k[a+48>>2]=d}else k[a+52>>2]=k[d+8>>2];h=k[d+4>>2]|0;d=k[d>>2]|0;if((h|0)>0){f=0;e=d;do{l=f;f=f+1|0;i=e;e=e+24|0;k[i>>2]=(f|0)<(h|0)?e:0}while((l|0)!=(h+-1|0))}k[a+56>>2]=k[d>>2];if(!d)d=0;else j=30}else{k[a+56>>2]=k[d>>2];j=30}if((j|0)==30){k[d>>2]=0;k[d+4>>2]=0;k[d+8>>2]=0;k[d+12>>2]=0;k[d+16>>2]=0;k[d+20>>2]=0}k[g+8>>2]=d;k[d+8>>2]=g;l=k[a+100>>2]|0;k[g+20>>2]=l;k[d+20>>2]=l;k[g+12>>2]=c;k[d+12>>2]=b;k[g+16>>2]=0;k[d+16>>2]=0;d=k[a+116>>2]|0;k[a+116>>2]=d+1;if((d|0)<(k[a+120>>2]|0))return g|0;k[a+120>>2]=d+1;return g|0}function Fw(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0,i=0,j=0,l=0,m=0,n=0,o=0,p=0,q=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0;K=r;r=r+160|0;do if((c-b|0)==1)e=k[(k[a+92>>2]|0)+(b<<2)>>2]|0;else if((c-b|0)==2){e=k[(k[a+92>>2]|0)+(b<<2)>>2]|0;i=k[e+88>>2]|0;j=k[e+200>>2]|0;h=k[e+92>>2]|0;g=k[e+204>>2]|0;if((i|0)==(j|0)){if((h|0)==(g|0))if((k[e+96>>2]|0)==(k[e+208>>2]|0))break;else f=h;else f=g;if((h|0)==(f|0)){I=(k[e+96>>2]|0)>(k[e+208>>2]|0);f=I?e+112|0:e;k[f>>2]=f;k[f+4>>2]=f;k[d>>2]=f;k[d+4>>2]=f;k[d+8>>2]=f;k[d+12>>2]=f;e=I?e:e+112|0}else{g=0;J=9}}else{f=g;g=(h|0)==(g|0);J=9}do if((J|0)==9){k[e>>2]=e+112;k[e+4>>2]=e+112;k[e+112>>2]=e;k[e+116>>2]=e;J=(h-f|0)<0;I=(i-j|0)<0|(i|0)==(j|0)&J;k[d>>2]=I?e:e+112|0;k[d+4>>2]=I?e+112|0:e;if(J|(i-j|0)<0&g){k[d+8>>2]=e;k[d+12>>2]=e+112;f=e;e=e+112|0;break}else{k[d+8>>2]=e+112;k[d+12>>2]=e;f=e;e=e+112|0;break}}while(0);a=Ew(a,f,e)|0;k[a>>2]=a;k[a+4>>2]=a;k[f+8>>2]=a;a=k[a+8>>2]|0;k[a>>2]=a;k[a+4>>2]=a;k[e+8>>2]=a;r=K;return}else if(!(c-b|0)){k[d>>2]=0;k[d+4>>2]=0;k[d+8>>2]=0;k[d+12>>2]=0;r=K;return}else{l=((c-b|0)/2|0)+b|0;h=k[a+92>>2]|0;e=k[h+(l+-1<<2)>>2]|0;g=k[e+88>>2]|0;f=k[e+92>>2]|0;e=k[e+96>>2]|0;a:do if((l|0)<(c|0)){j=l;do{i=k[h+(j<<2)>>2]|0;if((k[i+88>>2]|0)!=(g|0))break a;if((k[i+92>>2]|0)!=(f|0))break a;if((k[i+96>>2]|0)!=(e|0))break a;j=j+1|0}while((j|0)<(c|0))}else j=l;while(0);Fw(a,b,l,d);k[K+136>>2]=0;k[K+136+4>>2]=0;k[K+136+8>>2]=0;k[K+136+12>>2]=0;Fw(a,j,c,K+136|0);e=k[K+136+4>>2]|0;do if(e){w=k[d+4>>2]|0;if(!w){k[d>>2]=k[K+136>>2];k[d+4>>2]=k[K+136+4>>2];k[d+8>>2]=k[K+136+8>>2];k[d+12>>2]=k[K+136+12>>2];break}k[a+100>>2]=(k[a+100>>2]|0)+-1;f=k[d+12>>2]|0;c=k[K+136+8>>2]|0;g=k[f+88>>2]|0;b:do if((g|0)==(k[c+88>>2]|0)?(k[f+92>>2]|0)==(k[c+92>>2]|0):0){l=k[c+4>>2]|0;if((l|0)==(c|0)){e=k[c+8>>2]|0;if(!e)e=c;else{e=k[e+12>>2]|0;g=k[e+88>>2]|0}i=k[e+96>>2]|0;j=g+1|0;g=e;break}h=k[c>>2]|0;k[l>>2]=h;k[h+4>>2]=l;c:do if((c|0)==(k[K+136>>2]|0)){j=k[h+88>>2]|0;i=k[l+88>>2]|0;do if((j|0)>=(i|0)){if((j|0)==(i|0)?(k[h+92>>2]|0)<(k[l+92>>2]|0):0)break;k[K+136>>2]=l;break c}while(0);k[K+136>>2]=h}while(0);if((c|0)==(e|0)){j=k[h+88>>2]|0;i=k[l+88>>2]|0;do if((j|0)<=(i|0)){if((j|0)==(i|0)?(k[h+92>>2]|0)>(k[l+92>>2]|0):0)break;k[K+136+4>>2]=l;h=l;J=39;break b}while(0);k[K+136+4>>2]=h;J=39}else{h=e;J=39}}else{h=e;J=39}while(0);if((J|0)==39){z=k[d>>2]|0;y=k[K+136>>2]|0;m=0;x=1;n=w;G=0;b=h;g=0;d:while(1)while(1){s=k[n+88>>2]|0;c=ia((k[b+88>>2]|0)-s|0,x)|0;e:do if((c|0)<=0){if((c|0)<0){t=(m|0)!=0;q=k[n+92>>2]|0;u=k[b+92>>2]|0;while(1){i=k[(t?b+4|0:b)>>2]|0;f=(i|0)==(b|0);e=b+88|0;while(1){p=n+88|0;s=u-q|0;if(!f?(v=k[i+88>>2]|0,D=ia(v-(k[e>>2]|0)|0,x)|0,E=k[i+92>>2]|0,F=E-u|0,(F|0)>-1):0){if(!D)break;if((D|0)<0?(ia(F,c)|0)<=(ia(D,s)|0):0)break}j=k[(t?n+4|0:n)>>2]|0;if((j|0)==(n|0)){l=n;c=b;break e}C=k[j+88>>2]|0;o=ia(C-(k[p>>2]|0)|0,x)|0;l=k[j+92>>2]|0;q=l-q|0;p=c;c=ia((k[e>>2]|0)-C|0,x)|0;if(!((q|0)>0&(c|0)<0)){l=n;c=b;break e}if(!o){q=l;n=j;continue}if((o|0)>=0){l=n;c=b;break e}if((ia(q,p)|0)>=(ia(o,s)|0)){l=n;c=b;break e}else{q=l;n=j}}u=E;c=ia(v-(k[p>>2]|0)|0,x)|0;b=i}}c=k[n+92>>2]|0;p=(m|0)!=0;f:do if(p){j=n;while(1){l=k[j>>2]|0;if((l|0)==(n|0))break f;if((k[l+88>>2]|0)!=(s|0))break f;C=c;c=k[l+92>>2]|0;if((c|0)>(C|0))break;else j=l}}else{j=n;while(1){l=k[j+4>>2]|0;if((l|0)==(n|0))break f;if((k[l+88>>2]|0)!=(s|0))break f;C=c;c=k[l+92>>2]|0;if((c|0)>(C|0))break;else j=l}}while(0);l=k[b+92>>2]|0;if(p){c=b;while(1){n=k[c+4>>2]|0;if((n|0)==(b|0)){l=j;break e}if((k[n+88>>2]|0)!=(s|0)){l=j;break e}C=l;l=k[n+92>>2]|0;if((l|0)<(C|0)){l=j;break}else c=n}}else{c=b;while(1){n=k[c>>2]|0;if((n|0)==(b|0)){l=j;break e}if((k[n+88>>2]|0)!=(s|0)){l=j;break e}C=l;l=k[n+92>>2]|0;if((l|0)<(C|0)){l=j;break}else c=n}}}else{B=(m|0)!=0;A=k[b+92>>2]|0;while(1){C=b+88|0;p=n+88|0;j=k[n+92>>2]|0;o=A-j|0;l=k[(B?n:n+4|0)>>2]|0;g:do if((l|0)==(n|0))s=c;else{f=k[n+88>>2]|0;s=c;while(1){q=f;f=k[l+88>>2]|0;q=ia(f-q|0,x)|0;i=j;j=k[l+92>>2]|0;i=j-i|0;if((i|0)>=1)break g;if(q){if((q|0)>=0)break g;if((ia(i,s)|0)>(ia(q,o)|0))break g}s=ia((k[C>>2]|0)-f|0,x)|0;p=l+88|0;o=A-j|0;n=k[(B?l:l+4|0)>>2]|0;if((n|0)==(l|0)){n=l;break}else{u=l;l=n;n=u}}}while(0);i=k[(B?b:b+4|0)>>2]|0;if((i|0)==(b|0)){l=n;c=b;break e}c=k[i+88>>2]|0;l=ia(c-(k[C>>2]|0)|0,x)|0;j=A;A=k[i+92>>2]|0;j=A-j|0;c=ia(c-(k[p>>2]|0)|0,x)|0;if(!((j|0)<0&(c|0)>0)){l=n;c=b;break e}if(!l){b=i;continue}if((l|0)>=0){l=n;c=b;break e}if((ia(j,s)|0)>=(ia(l,o)|0)){l=n;c=b;break}else b=i}}while(0);if(!m){m=1;x=-1;n=z;G=l;b=y;g=c;continue d}m=m+1|0;if((m|0)==2)break d;else{n=l;b=c}}k[l+4>>2]=c;k[c>>2]=l;k[G>>2]=g;k[g+4>>2]=G;if((k[y+88>>2]|0)<(k[z+88>>2]|0))k[d>>2]=y;if((k[h+88>>2]|0)>=(k[w+88>>2]|0))k[d+4>>2]=h;k[d+12>>2]=k[K+136+12>>2];u=k[g+88>>2]|0;p=k[G+88>>2]|0;t=k[g+92>>2]|0;s=k[G+92>>2]|0;e=k[g+96>>2]|0;o=k[G+96>>2]|0;v=((t-s|0)<0)<<31>>31;w=0-(u-p)|0;x=mF(0,0,w|0,((w|0)<0)<<31>>31|0)|0;x=AF(e-o|0,((e-o|0)<0)<<31>>31|0,x|0,M|0)|0;y=M;z=AF(e-o|0,((e-o|0)<0)<<31>>31|0,t-s|0,v|0)|0;A=M;j=AF(u-p|0,((u-p|0)<0)<<31>>31|0,w|0,((w|0)<0)<<31>>31|0)|0;C=M;B=AF(t-s|0,v|0,t-s|0,v|0)|0;B=mF(j|0,C|0,B|0,M|0)|0;C=M;j=k[G+8>>2]|0;k[K+104>>2]=0;if(!j)n=0;else{i=mF(0,0,t-s|0,v|0)|0;h=M;n=0;q=j;do{c=k[q+12>>2]|0;m=k[c+88>>2]|0;b=k[c+92>>2]|0;c=k[c+96>>2]|0;E=AF(b-s|0,((b-s|0)<0)<<31>>31|0,w|0,((w|0)<0)<<31>>31|0)|0;d=M;F=AF(m-p|0,((m-p|0)<0)<<31>>31|0,i|0,h|0)|0;h:do if((E|0)==(F|0)&(d|0)==(M|0)?(F=AF(m-p|0,((m-p|0)<0)<<31>>31|0,x|0,y|0)|0,E=M,d=AF(b-s|0,((b-s|0)<0)<<31>>31|0,z|0,A|0)|0,E=pF(d|0,M|0,F|0,E|0)|0,F=M,d=AF(c-o|0,((c-o|0)<0)<<31>>31|0,B|0,C|0)|0,d=pF(E|0,F|0,d|0,M|0)|0,F=M,(F|0)>0|(F|0)==0&d>>>0>0):0){do if(n){l=(k[n+4>>2]|0)==(q|0);if((k[n>>2]|0)!=(q|0))if(l)break;else break h;if(!l)break h;F=k[n+12>>2]|0;D=k[(k[q+8>>2]|0)+12>>2]|0;d=k[D+88>>2]|0;E=k[D+92>>2]|0;D=k[D+96>>2]|0;l=(k[F+96>>2]|0)-D|0;E=(ia(c-D|0,(k[F+92>>2]|0)-E|0)|0)-(ia(l,b-E|0)|0)|0;d=(ia(l,m-d|0)|0)-(ia(c-D|0,(k[F+88>>2]|0)-d|0)|0)|0;E=AF(E|0,((E|0)<0)<<31>>31|0,t-s|0,v|0)|0;F=M;d=AF(d|0,((d|0)<0)<<31>>31|0,w|0,((w|0)<0)<<31>>31|0)|0;d=pF(E|0,F|0,d|0,M|0)|0;F=M;if((F|0)>0|(F|0)==0&d>>>0>0)break h}while(0);k[K+104>>2]=q;n=q}while(0);q=k[q>>2]|0}while((q|0)!=(j|0))}l=k[g+8>>2]|0;k[K+100>>2]=0;if(!l)f=0;else{j=mF(0,0,t-s|0,v|0)|0;i=M;f=0;h=l;do{c=k[h+12>>2]|0;m=k[c+88>>2]|0;b=k[c+92>>2]|0;c=k[c+96>>2]|0;E=AF(b-t|0,((b-t|0)<0)<<31>>31|0,w|0,((w|0)<0)<<31>>31|0)|0;d=M;F=AF(m-u|0,((m-u|0)<0)<<31>>31|0,j|0,i|0)|0;do if((E|0)==(F|0)&(d|0)==(M|0)?(F=AF(m-u|0,((m-u|0)<0)<<31>>31|0,x|0,y|0)|0,E=M,d=AF(b-t|0,((b-t|0)<0)<<31>>31|0,z|0,A|0)|0,E=pF(d|0,M|0,F|0,E|0)|0,F=M,d=AF(c-e|0,((c-e|0)<0)<<31>>31|0,B|0,C|0)|0,d=pF(E|0,F|0,d|0,M|0)|0,F=M,(F|0)>0|(F|0)==0&d>>>0>0):0){if(f){if((k[f>>2]|0)!=(h|0))break;if((k[f+4>>2]|0)==(h|0)?(F=k[f+12>>2]|0,D=k[(k[h+8>>2]|0)+12>>2]|0,d=k[D+88>>2]|0,E=k[D+92>>2]|0,D=k[D+96>>2]|0,q=(k[F+96>>2]|0)-D|0,E=(ia(c-D|0,(k[F+92>>2]|0)-E|0)|0)-(ia(q,b-E|0)|0)|0,d=(ia(q,m-d|0)|0)-(ia(c-D|0,(k[F+88>>2]|0)-d|0)|0)|0,E=AF(E|0,((E|0)<0)<<31>>31|0,t-s|0,v|0)|0,F=M,d=AF(d|0,((d|0)<0)<<31>>31|0,w|0,((w|0)<0)<<31>>31|0)|0,d=pF(E|0,F|0,d|0,M|0)|0,F=M,!((F|0)>0|(F|0)==0&d>>>0>0)):0)break}k[K+100>>2]=h;f=h}while(0);h=k[h>>2]|0}while((h|0)!=(l|0))}if((n|0)!=0|(f|0)!=0){Hw(a,G,g,K+104|0,K+100|0);f=k[K+104>>2]|0;if(!f)f=G;else f=k[f+12>>2]|0;e=k[K+100>>2]|0;if(e)g=k[e+12>>2]|0}else f=G;i=(k[g+96>>2]|0)+1|0;j=k[g+88>>2]|0}q=k[g+92>>2]|0;s=q;v=f;x=g;c=0;n=0;p=1;l=0;m=0;o=0;C=0;B=0;b=0;while(1){A=v+88|0;E=(k[x+88>>2]|0)-(k[A>>2]|0)|0;G=v+92|0;w=s-(k[G>>2]|0)|0;D=v+96|0;y=(k[x+96>>2]|0)-(k[D>>2]|0)|0;k[K+112>>2]=E;k[K+112+4>>2]=w;k[K+112+8>>2]=y;k[K+112+12>>2]=-1;A=j-(k[A>>2]|0)|0;G=q-(k[G>>2]|0)|0;D=i-(k[D>>2]|0)|0;z=(ia(y,G)|0)-(ia(w,D)|0)|0;D=(ia(E,D)|0)-(ia(y,A)|0)|0;G=(ia(w,A)|0)-(ia(E,G)|0)|0;k[K+72>>2]=z;k[K+72+4>>2]=((z|0)<0)<<31>>31;k[K+72+8>>2]=D;k[K+72+8+4>>2]=((D|0)<0)<<31>>31;k[K+72+16>>2]=G;k[K+72+16+4>>2]=((G|0)<0)<<31>>31;A=AF(G|0,((G|0)<0)<<31>>31|0,w|0,((w|0)<0)<<31>>31|0)|0;d=M;F=AF(y|0,((y|0)<0)<<31>>31|0,D|0,((D|0)<0)<<31>>31|0)|0;F=mF(A|0,d|0,F|0,M|0)|0;d=M;y=AF(z|0,((z|0)<0)<<31>>31|0,y|0,((y|0)<0)<<31>>31|0)|0;A=M;G=AF(E|0,((E|0)<0)<<31>>31|0,G|0,((G|0)<0)<<31>>31|0)|0;G=mF(y|0,A|0,G|0,M|0)|0;A=M;D=AF(E|0,((E|0)<0)<<31>>31|0,D|0,((D|0)<0)<<31>>31|0)|0;E=M;w=AF(z|0,((z|0)<0)<<31>>31|0,w|0,((w|0)<0)<<31>>31|0)|0;w=mF(D|0,E|0,w|0,M|0)|0;k[K+48>>2]=F;k[K+48+4>>2]=d;k[K+48+8>>2]=G;k[K+48+8+4>>2]=A;k[K+48+16>>2]=w;k[K+48+16+4>>2]=M;k[K>>2]=0;k[K+4>>2]=0;k[K+8>>2]=0;k[K+12>>2]=0;k[K+16>>2]=0;w=Gw(a,0,v,K+112|0,K+72|0,K+48|0,K)|0;k[K+24>>2]=0;k[K+24+4>>2]=0;k[K+24+8>>2]=0;k[K+24+12>>2]=0;k[K+24+16>>2]=0;A=Gw(a,1,x,K+112|0,K+72|0,K+48|0,K+24|0)|0;if(!((w|0)!=0|(A|0)!=0)){J=119;break}if((w|0)!=0&(A|0)!=0)y=Dw(k[K>>2]|0,k[K+4>>2]|0,k[K+8>>2]|0,k[K+8+4>>2]|0,k[K+16>>2]|0,k[K+24>>2]|0,k[K+24+4>>2]|0,k[K+24+8>>2]|0,k[K+24+8+4>>2]|0,k[K+24+16>>2]|0)|0;else y=(w|0)!=0?-1:1;do if(!p){if((y|0)>-1)if((k[K+24+16>>2]|0)<0&((k[K+24+8>>2]|0)==0?(k[K+24+8+4>>2]|0)==0:0)){z=m;e=o;h=C;J=132;break}else{J=127;break}if((k[K+16>>2]|0)<0&((k[K+8>>2]|0)==0?(k[K+8+4>>2]|0)==0:0)){k[K+96>>2]=w;k[K+128>>2]=A;A=n;z=m;e=o}else J=127}else J=127;while(0);if((J|0)==127){e=Ew(a,v,x)|0;if(!o)l=e;else k[o+4>>2]=e;k[e>>2]=o;h=k[e+8>>2]|0;if(!C)m=h;else k[C>>2]=h;k[h+4>>2]=C;z=m;J=132}if((J|0)==132){J=0;k[K+96>>2]=w;k[K+128>>2]=A;if(!y){Hw(a,v,x,K+96|0,K+128|0);s=k[K+128>>2]|0}else s=A;if((y|0)>-1&(s|0)!=0){q=(b|0)!=0;if(q?(H=k[b>>2]|0,(H|0)!=(A|0)):0){o=H;do{p=o;o=k[o>>2]|0;i=k[p+8>>2]|0;j=k[i+12>>2]|0;if((o|0)==(p|0))m=0;else{k[o+4>>2]=k[p+4>>2];k[k[p+4>>2]>>2]=o;m=o}k[j+8>>2]=m;m=k[i>>2]|0;j=k[p+12>>2]|0;if((m|0)==(i|0))m=0;else{k[m+4>>2]=k[i+4>>2];k[k[i+4>>2]>>2]=m}k[j+8>>2]=m;k[p>>2]=0;k[p+4>>2]=0;k[p+8>>2]=0;k[p+12>>2]=0;k[p+16>>2]=0;k[p>>2]=k[a+56>>2];k[a+56>>2]=p;k[i>>2]=0;k[i+4>>2]=0;k[i+8>>2]=0;k[i+12>>2]=0;k[i+16>>2]=0;k[i>>2]=k[a+56>>2];k[a+56>>2]=i;k[a+116>>2]=(k[a+116>>2]|0)+-1}while((o|0)!=(A|0))}if(!h){p=s;n=q?n:A;m=z}else{if(q){k[b>>2]=z;m=A+4|0}else{b=k[A+4>>2]|0;k[b>>2]=z;m=A+4|0;n=z}k[z+4>>2]=b;k[h>>2]=A;k[m>>2]=h;p=k[K+128>>2]|0;m=0}i=k[x+96>>2]|0;q=k[x+92>>2]|0;j=k[x+88>>2]|0;x=k[p+12>>2]|0;A=n;z=m;C=0;b=k[p+8>>2]|0}else{A=n;C=h}}s=k[K+96>>2]|0;if((y|0)<1&(s|0)!=0){q=(B|0)!=0;if(q?(I=k[B+4>>2]|0,(I|0)!=(w|0)):0){p=I;do{m=p+4|0;o=p;p=k[m>>2]|0;n=k[o>>2]|0;i=k[o+8>>2]|0;j=k[i+12>>2]|0;if((n|0)==(o|0))n=0;else{k[n+4>>2]=p;k[k[m>>2]>>2]=n}k[j+8>>2]=n;n=k[i>>2]|0;m=k[o+12>>2]|0;if((n|0)==(i|0))n=0;else{k[n+4>>2]=k[i+4>>2];k[k[i+4>>2]>>2]=n}k[m+8>>2]=n;k[o>>2]=0;k[o+4>>2]=0;k[o+8>>2]=0;k[o+12>>2]=0;k[o+16>>2]=0;k[o>>2]=k[a+56>>2];k[a+56>>2]=o;k[i>>2]=0;k[i+4>>2]=0;k[i+8>>2]=0;k[i+12>>2]=0;k[i+16>>2]=0;k[i>>2]=k[a+56>>2];k[a+56>>2]=i;k[a+116>>2]=(k[a+116>>2]|0)+-1}while((p|0)!=(w|0))}if(!e){n=s;c=q?c:w}else{if(q){k[B+4>>2]=l;i=w;j=B}else{j=k[w>>2]|0;k[j+4>>2]=l;i=w;c=l}k[l>>2]=j;k[i>>2]=e;k[e+4>>2]=w;n=k[K+96>>2]|0;l=0}i=k[v+96>>2]|0;q=k[v+92>>2]|0;j=k[v+88>>2]|0;p=k[n+12>>2]|0;o=0;B=k[n+8>>2]|0}else{p=v;o=e}if((p|0)==(f|0)&(x|0)==(g|0))break;s=k[x+92>>2]|0;v=p;n=A;p=0;m=z}if((J|0)==119){a=Ew(a,v,x)|0;k[a>>2]=a;k[a+4>>2]=a;k[v+8>>2]=a;a=k[a+8>>2]|0;k[a>>2]=a;k[a+4>>2]=a;k[x+8>>2]=a;break}if(B){n=B+4|0;j=k[n>>2]|0;if((j|0)!=(c|0))do{h=j+4|0;m=j;j=k[h>>2]|0;i=k[m>>2]|0;e=k[m+8>>2]|0;f=k[e+12>>2]|0;if((i|0)==(m|0))i=0;else{k[i+4>>2]=j;k[k[h>>2]>>2]=i}k[f+8>>2]=i;i=k[e>>2]|0;h=k[m+12>>2]|0;if((i|0)==(e|0))i=0;else{k[i+4>>2]=k[e+4>>2];k[k[e+4>>2]>>2]=i}k[h+8>>2]=i;k[m>>2]=0;k[m+4>>2]=0;k[m+8>>2]=0;k[m+12>>2]=0;k[m+16>>2]=0;k[m>>2]=k[a+56>>2];k[a+56>>2]=m;k[e>>2]=0;k[e+4>>2]=0;k[e+8>>2]=0;k[e+12>>2]=0;k[e+16>>2]=0;k[e>>2]=k[a+56>>2];k[a+56>>2]=e;k[a+116>>2]=(k[a+116>>2]|0)+-1}while((j|0)!=(c|0));if(o){k[l>>2]=B;k[n>>2]=l;k[c>>2]=o;k[o+4>>2]=c}}else{k[l>>2]=o;k[o+4>>2]=l;k[p+8>>2]=o}if(!b){k[C>>2]=z;k[z+4>>2]=C;k[g+8>>2]=C;break}f=k[b>>2]|0;if((f|0)!=(A|0))do{h=f;f=k[f>>2]|0;j=k[h+8>>2]|0;e=k[j+12>>2]|0;if((f|0)==(h|0))g=0;else{k[f+4>>2]=k[h+4>>2];k[k[h+4>>2]>>2]=f;g=f}k[e+8>>2]=g;g=k[j>>2]|0;i=k[h+12>>2]|0;if((g|0)==(j|0))g=0;else{k[g+4>>2]=k[j+4>>2];k[k[j+4>>2]>>2]=g}k[i+8>>2]=g;k[h>>2]=0;k[h+4>>2]=0;k[h+8>>2]=0;k[h+12>>2]=0;k[h+16>>2]=0;k[h>>2]=k[a+56>>2];k[a+56>>2]=h;k[j>>2]=0;k[j+4>>2]=0;k[j+8>>2]=0;k[j+12>>2]=0;k[j+16>>2]=0;k[j>>2]=k[a+56>>2];k[a+56>>2]=j;k[a+116>>2]=(k[a+116>>2]|0)+-1}while((f|0)!=(A|0));if(C){k[b>>2]=z;k[z+4>>2]=b;k[C>>2]=A;k[A+4>>2]=C}}while(0);r=K;return}while(0);k[e+8>>2]=0;k[e>>2]=e;k[e+4>>2]=e;k[d>>2]=e;k[d+4>>2]=e;k[d+8>>2]=e;k[d+12>>2]=e;r=K;return}function Gw(a,b,c,d,e,f,g){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;var h=0,i=0,j=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0;h=k[c+8>>2]|0;if(!h){a=0;return a|0}v=h;h=0;do{do if((k[v+20>>2]|0)>(k[a+100>>2]|0)){t=k[v+12>>2]|0;p=k[t+88>>2]|0;q=p-(k[c+88>>2]|0)|0;r=k[t+92>>2]|0;s=r-(k[c+92>>2]|0)|0;t=k[t+96>>2]|0;u=t-(k[c+96>>2]|0)|0;l=AF(q|0,((q|0)<0)<<31>>31|0,k[f>>2]|0,k[f+4>>2]|0)|0;n=M;i=AF(s|0,((s|0)<0)<<31>>31|0,k[f+8>>2]|0,k[f+8+4>>2]|0)|0;n=pF(i|0,M|0,l|0,n|0)|0;l=M;i=AF(u|0,((u|0)<0)<<31>>31|0,k[f+16>>2]|0,k[f+16+4>>2]|0)|0;i=pF(n|0,l|0,i|0,M|0)|0;l=M;n=AF(k[e>>2]|0,k[e+4>>2]|0,q|0,((q|0)<0)<<31>>31|0)|0;o=M;m=AF(k[e+8>>2]|0,k[e+8+4>>2]|0,s|0,((s|0)<0)<<31>>31|0)|0;o=pF(m|0,M|0,n|0,o|0)|0;n=M;m=AF(k[e+16>>2]|0,k[e+16+4>>2]|0,u|0,((u|0)<0)<<31>>31|0)|0;m=pF(o|0,n|0,m|0,M|0)|0;n=M;if((l|0)>0|(l|0)==0&i>>>0>0){j=1;o=l;l=1}else{i=mF(0,0,i|0,l|0)|0;j=(l|0)<0?-1:0;i=(l|0)<0?i:0;o=(l|0)<0?M:0;l=(l|0)<0?-1:0}if(!((n|0)>0|(n|0)==0&m>>>0>0)){if((n|0)<0){l=0-j|0;m=mF(0,0,m|0,n|0)|0;j=l;n=M}else{m=0;n=0}if((j|0)==0&((m|0)==0&(n|0)==0))break}if(!h){k[g>>2]=i;k[g+4>>2]=o;k[g+8>>2]=m;k[g+8+4>>2]=n;k[g+16>>2]=l;h=v;break}j=Dw(i,o,m,n,l,k[g>>2]|0,k[g+4>>2]|0,k[g+8>>2]|0,k[g+8+4>>2]|0,k[g+16>>2]|0)|0;if((j|0)<0){k[g>>2]=i;k[g+4>>2]=o;k[g+8>>2]=m;k[g+8+4>>2]=n;k[g+16>>2]=l;h=v;break}if(!j){i=(k[h+4>>2]|0)==(v|0);if((k[h>>2]|0)==(v|0))if(i){m=k[d+8>>2]|0;o=ia(m,s)|0;i=k[d+4>>2]|0;o=o-(ia(i,u)|0)|0;w=k[d>>2]|0;u=(ia(w,u)|0)-(ia(q,m)|0)|0;q=(ia(q,i)|0)-(ia(w,s)|0)|0;w=k[h+12>>2]|0;i=k[(k[v+8>>2]|0)+12>>2]|0;m=k[i+88>>2]|0;l=(k[w+88>>2]|0)-m|0;j=k[i+92>>2]|0;n=(k[w+92>>2]|0)-j|0;i=k[i+96>>2]|0;w=(k[w+96>>2]|0)-i|0;s=(ia(t-i|0,n)|0)-(ia(r-j|0,w)|0)|0;i=(ia(p-m|0,w)|0)-(ia(t-i|0,l)|0)|0;t=(ia(r-j|0,l)|0)-(ia(p-m|0,n)|0)|0;r=AF(s|0,((s|0)<0)<<31>>31|0,o|0,((o|0)<0)<<31>>31|0)|0;s=M;u=AF(i|0,((i|0)<0)<<31>>31|0,u|0,((u|0)<0)<<31>>31|0)|0;i=M;t=AF(t|0,((t|0)<0)<<31>>31|0,q|0,((q|0)<0)<<31>>31|0)|0;t=pF(r|0,s|0,t|0,M|0)|0;i=pF(t|0,M|0,u|0,i|0)|0;u=M;i=(u|0)>0|(u|0)==0&i>>>0>0?2:1}else i=2;else i=i&1;h=(i|0)==2^b?h:v}}while(0);v=k[v>>2]|0}while((v|0)!=(k[c+8>>2]|0));return h|0}
function kr(a,b,c){a=a|0;b=b|0;c=+c;var d=0,e=0.0,f=0.0,g=0.0,h=0,l=0.0,m=0,n=0,p=0.0,q=0.0,s=0.0,t=0,u=0,v=0,w=0;w=r;r=r+528|0;if((i[a+171>>0]|0)==0?+o[a+172>>2]<=0.0:0){r=w;return}v=(Wb[k[(k[a>>2]|0)+48>>2]&127](a)|0)&1;i[a+168>>0]=v;f=+o[a+16>>2]-+o[a+44>>2]*c;o[a+16>>2]=f;if(f>0.0?(e=+o[a+28>>2],f>e):0)o[a+16>>2]=e;else e=f;if(e<0.0?(s=+X(+e),g=+X(+(+o[a+24>>2])),s>g):0){o[a+16>>2]=-g;e=-g}o[a+20>>2]=e*c;d=k[a+8>>2]|0;k[w+272>>2]=k[d+4>>2];k[w+272+4>>2]=k[d+4+4>>2];k[w+272+8>>2]=k[d+4+8>>2];k[w+272+12>>2]=k[d+4+12>>2];t=w+272+16|0;k[t>>2]=k[d+20>>2];k[t+4>>2]=k[d+20+4>>2];k[t+8>>2]=k[d+20+8>>2];k[t+12>>2]=k[d+20+12>>2];u=w+272+32|0;k[u>>2]=k[d+36>>2];k[u+4>>2]=k[d+36+4>>2];k[u+8>>2]=k[d+36+8>>2];k[u+12>>2]=k[d+36+12>>2];v=w+272+48|0;k[v>>2]=k[d+52>>2];k[v+4>>2]=k[d+52+4>>2];k[v+8>>2]=k[d+52+8>>2];k[v+12>>2]=k[d+52+12>>2];d=k[a+176>>2]|0;if((i[5128]|0)==0?(db(5128)|0)!=0:0){o[1270]=1.0;k[1271]=0;k[1272]=0;k[1273]=0;k[1274]=0;o[1275]=1.0;k[1276]=0;k[1277]=0;k[1278]=0;k[1279]=0;o[1280]=1.0;o[1281]=0.0;ib(5128)}p=+o[a+20>>2];p=+o[a+52>>2]+(p>0.0?p:0.0);q=+o[5080+(d<<4)+4>>2]*p+ +o[a+96>>2];s=p*+o[5080+(d<<4)+8>>2]+ +o[a+100>>2];o[a+112>>2]=+o[a+92>>2]+ +o[5080+(d<<4)>>2]*p;o[a+116>>2]=q;o[a+120>>2]=s;o[a+124>>2]=0.0;o[w+208>>2]=1.0;k[w+208+4>>2]=0;k[w+208+4+4>>2]=0;k[w+208+4+8>>2]=0;k[w+208+4+12>>2]=0;o[w+208+20>>2]=1.0;k[w+208+24>>2]=0;k[w+208+24+4>>2]=0;k[w+208+24+8>>2]=0;k[w+208+24+12>>2]=0;o[w+208+40>>2]=1.0;d=w+208+44|0;k[d>>2]=0;k[d+4>>2]=0;k[d+8>>2]=0;k[d+12>>2]=0;k[d+16>>2]=0;o[w+336>>2]=1.0;k[w+336+4>>2]=0;k[w+336+4+4>>2]=0;k[w+336+4+8>>2]=0;k[w+336+4+12>>2]=0;o[w+336+20>>2]=1.0;k[w+336+24>>2]=0;k[w+336+24+4>>2]=0;k[w+336+24+8>>2]=0;k[w+336+24+12>>2]=0;o[w+336+40>>2]=1.0;d=w+336+44|0;k[d>>2]=0;k[d+4>>2]=0;k[d+8>>2]=0;k[d+12>>2]=0;k[d+16>>2]=0;d=k[a+176>>2]|0;if((i[5128]|0)==0?(db(5128)|0)!=0:0){o[1270]=1.0;k[1271]=0;k[1272]=0;k[1273]=0;k[1274]=0;o[1275]=1.0;k[1276]=0;k[1277]=0;k[1278]=0;k[1279]=0;o[1280]=1.0;o[1281]=0.0;ib(5128)}h=k[a+12>>2]|0;p=+gc[k[(k[h>>2]|0)+48>>2]&15](h);p=p+ +o[a+56>>2];q=p*+o[5080+(d<<4)+4>>2]+ +o[a+96>>2];s=p*+o[5080+(d<<4)+8>>2]+ +o[a+100>>2];o[w+208+48>>2]=+o[5080+(d<<4)>>2]*p+ +o[a+92>>2];o[w+208+52>>2]=q;o[w+208+56>>2]=s;o[w+208+60>>2]=0.0;k[w+336+48>>2]=k[a+112>>2];k[w+336+48+4>>2]=k[a+112+4>>2];k[w+336+48+8>>2]=k[a+112+8>>2];k[w+336+48+12>>2]=k[a+112+12>>2];d=k[a+8>>2]|0;h=k[a+176>>2]|0;if((i[5128]|0)==0?(db(5128)|0)!=0:0){o[1270]=1.0;k[1271]=0;k[1272]=0;k[1273]=0;k[1274]=0;o[1275]=1.0;k[1276]=0;k[1277]=0;k[1278]=0;k[1279]=0;o[1280]=1.0;o[1281]=0.0;ib(5128)}p=-+o[5080+(h<<4)>>2];q=-+o[5080+(h<<4)+4>>2];s=-+o[5080+(h<<4)+8>>2];o[w+400+4>>2]=1.0;n=w+400+12|0;k[w+400+76>>2]=0;k[n>>2]=0;k[n+4>>2]=0;k[n+8>>2]=0;k[n+12>>2]=0;k[n+16>>2]=0;k[n+20>>2]=0;k[n+24>>2]=0;k[n+28>>2]=0;k[w+400>>2]=5256;k[w+400+80>>2]=d;o[w+400+84>>2]=p;o[w+400+88>>2]=q;o[w+400+92>>2]=s;o[w+400+96>>2]=0.0;o[w+400+100>>2]=.707099974155426;d=k[a+8>>2]|0;n=k[d+188>>2]|0;j[w+400+8>>1]=j[n+4>>1]|0;j[w+400+10>>1]=j[n+6>>1]|0;if(!(i[a+170>>0]|0))ws(b,k[a+12>>2]|0,w+208|0,w+336|0,w+400|0,0.0);else Cr(d,k[a+12>>2]|0,w+208|0,w+336|0,w+400|0,+o[b+56>>2]);if(+o[w+400+4>>2]<1.0){d=k[a+176>>2]|0;if((i[5128]|0)==0?(db(5128)|0)!=0:0){o[1270]=1.0;k[1271]=0;k[1272]=0;k[1273]=0;k[1274]=0;o[1275]=1.0;k[1276]=0;k[1277]=0;k[1278]=0;k[1279]=0;o[1280]=1.0;o[1281]=0.0;ib(5128)}do if(+o[w+400+44>>2]*+o[5080+(d<<4)>>2]+ +o[w+400+48>>2]*+o[5080+(d<<4)+4>>2]+ +o[w+400+52>>2]*+o[5080+(d<<4)+8>>2]>0.0){f=+o[w+400+4>>2];o[a+108>>2]=+o[a+52>>2]*f;if(!(i[a+180>>0]|0)){k[a+92>>2]=k[a+112>>2];k[a+92+4>>2]=k[a+112+4>>2];k[a+92+8>>2]=k[a+112+8>>2];k[a+92+12>>2]=k[a+112+12>>2];break}else{o[a+92>>2]=(1.0-f)*+o[a+92>>2]+f*+o[a+112>>2];o[a+96>>2]=(1.0-f)*+o[a+96>>2]+f*+o[a+116>>2];o[a+100>>2]=(1.0-f)*+o[a+100>>2]+f*+o[a+120>>2];break}}while(0);o[a+16>>2]=0.0;o[a+20>>2]=0.0}else{o[a+108>>2]=+o[a+52>>2];k[a+92>>2]=k[a+112>>2];k[a+92+4>>2]=k[a+112+4>>2];k[a+92+8>>2]=k[a+112+8>>2];k[a+92+12>>2]=k[a+112+12>>2]}if(!(i[a+171>>0]|0)){q=+o[a+172>>2];s=q>c?c:q;o[a+172>>2]=q-c;er(a,b,+o[a+60>>2]*s,s*+o[a+64>>2],s*+o[a+68>>2])}else er(a,b,+o[a+60>>2],+o[a+64>>2],+o[a+68>>2]);k[w+504>>2]=k[a+112>>2];k[w+504+4>>2]=k[a+112+4>>2];k[w+504+8>>2]=k[a+112+8>>2];k[w+504+12>>2]=k[a+112+12>>2];f=+o[a+16>>2];if(f<0.0)f=-f;else f=0.0;f=f*c;do if(f>0.0?(l=+o[a+24>>2],f>l):0){if((i[a+168>>0]|0)==0?(i[a+169>>0]|0)!=0:0)break;f=l}while(0);h=k[a+176>>2]|0;if((i[5128]|0)==0?(db(5128)|0)!=0:0){o[1270]=1.0;k[1271]=0;k[1272]=0;k[1273]=0;k[1274]=0;o[1275]=1.0;k[1276]=0;k[1277]=0;k[1278]=0;k[1279]=0;o[1280]=1.0;o[1281]=0.0;ib(5128)}p=f+ +o[a+108>>2];q=+o[5080+(h<<4)>>2]*p;s=p*+o[5080+(h<<4)+4>>2];p=p*+o[5080+(h<<4)+8>>2];o[a+112>>2]=+o[a+112>>2]-q;o[a+116>>2]=+o[a+116>>2]-s;o[a+120>>2]=+o[a+120>>2]-p;h=k[a+8>>2]|0;d=k[a+176>>2]|0;if((i[5128]|0)==0?(db(5128)|0)!=0:0){o[1270]=1.0;k[1271]=0;k[1272]=0;k[1273]=0;k[1274]=0;o[1275]=1.0;k[1276]=0;k[1277]=0;k[1278]=0;k[1279]=0;o[1280]=1.0;o[1281]=0.0;ib(5128)}l=+o[a+40>>2];n=w+104+4|0;o[n>>2]=1.0;m=w+104+12|0;k[w+104+76>>2]=0;k[m>>2]=0;k[m+4>>2]=0;k[m+8>>2]=0;k[m+12>>2]=0;k[m+16>>2]=0;k[m+20>>2]=0;k[m+24>>2]=0;k[m+28>>2]=0;k[w+104>>2]=5256;k[w+104+80>>2]=h;k[w+104+84>>2]=k[5080+(d<<4)>>2];k[w+104+84+4>>2]=k[5080+(d<<4)+4>>2];k[w+104+84+8>>2]=k[5080+(d<<4)+8>>2];k[w+104+84+12>>2]=k[5080+(d<<4)+12>>2];o[w+104+100>>2]=l;h=k[a+8>>2]|0;d=k[h+188>>2]|0;j[w+104+8>>1]=j[d+4>>1]|0;j[w+104+10>>1]=j[d+6>>1]|0;d=k[a+176>>2]|0;if((i[5128]|0)==0?(db(5128)|0)!=0:0){o[1270]=1.0;k[1271]=0;k[1272]=0;k[1273]=0;k[1274]=0;o[1275]=1.0;k[1276]=0;k[1277]=0;k[1278]=0;k[1279]=0;o[1280]=1.0;o[1281]=0.0;ib(5128)}g=+o[a+40>>2];o[w+4>>2]=1.0;k[w+76>>2]=0;k[w+12>>2]=0;k[w+12+4>>2]=0;k[w+12+8>>2]=0;k[w+12+12>>2]=0;k[w+12+16>>2]=0;k[w+12+20>>2]=0;k[w+12+24>>2]=0;k[w+12+28>>2]=0;k[w>>2]=5256;k[w+80>>2]=h;k[w+84>>2]=k[5080+(d<<4)>>2];k[w+84+4>>2]=k[5080+(d<<4)+4>>2];k[w+84+8>>2]=k[5080+(d<<4)+8>>2];k[w+84+12>>2]=k[5080+(d<<4)+12>>2];o[w+100>>2]=g;h=k[(k[a+8>>2]|0)+188>>2]|0;j[w+8>>1]=j[h+4>>1]|0;j[w+10>>1]=j[h+6>>1]|0;g=+o[a+112>>2];f=+o[a+116>>2];e=+o[a+120>>2];h=0;while(1){o[w+208>>2]=1.0;k[w+208+4>>2]=0;k[w+208+4+4>>2]=0;k[w+208+4+8>>2]=0;k[w+208+4+12>>2]=0;o[w+208+20>>2]=1.0;k[w+208+24>>2]=0;k[w+208+24+4>>2]=0;k[w+208+24+8>>2]=0;k[w+208+24+12>>2]=0;o[w+208+40>>2]=1.0;k[w+208+44>>2]=0;o[w+336>>2]=1.0;k[w+336+4>>2]=0;k[w+336+4+4>>2]=0;k[w+336+4+8>>2]=0;k[w+336+4+12>>2]=0;o[w+336+20>>2]=1.0;k[w+336+24>>2]=0;k[w+336+24+4>>2]=0;k[w+336+24+8>>2]=0;k[w+336+24+12>>2]=0;o[w+336+40>>2]=1.0;k[w+336+44>>2]=0;o[w+400>>2]=1.0;k[w+400+4>>2]=0;k[w+400+4+4>>2]=0;k[w+400+4+8>>2]=0;k[w+400+4+12>>2]=0;o[w+400+20>>2]=1.0;k[w+400+24>>2]=0;k[w+400+24+4>>2]=0;k[w+400+24+8>>2]=0;k[w+400+24+12>>2]=0;o[w+400+40>>2]=1.0;k[w+400+44>>2]=0;k[w+400+44+4>>2]=0;k[w+400+44+8>>2]=0;k[w+208+48>>2]=k[a+92>>2];k[w+208+48+4>>2]=k[a+92+4>>2];k[w+208+48+8>>2]=k[a+92+8>>2];k[w+208+48+12>>2]=k[a+92+12>>2];k[w+336+48>>2]=k[a+112>>2];k[w+336+48+4>>2]=k[a+112+4>>2];k[w+336+48+8>>2]=k[a+112+8>>2];k[w+336+48+12>>2]=k[a+112+12>>2];o[w+400+48>>2]=g-q;o[w+400+52>>2]=f-s;o[w+400+56>>2]=e-p;o[w+400+60>>2]=0.0;if(!(i[a+170>>0]|0)){ws(b,k[a+12>>2]|0,w+208|0,w+336|0,w+104|0,+o[b+56>>2]);if(!(+o[n>>2]<1.0))ws(b,k[a+12>>2]|0,w+208|0,w+400|0,w,+o[b+56>>2])}else{Cr(k[a+8>>2]|0,k[a+12>>2]|0,w+208|0,w+336|0,w+104|0,+o[b+56>>2]);if(!(+o[n>>2]<1.0))Cr(k[a+8>>2]|0,k[a+12>>2]|0,w+208|0,w+400|0,w,+o[b+56>>2])}l=+o[a+16>>2];if(l<0.0)g=-l;else g=0.0;g=g*c;m=(i[a+182>>0]|0)==0;if(!m?+o[n>>2]<1.0:0)d=1;else d=+o[w+4>>2]<1.0;if(!(g>0.0))break;f=+o[a+52>>2];if(h|(!(g<f)|d^1))break;if((i[a+168>>0]|0)==0?(i[a+169>>0]|0)!=0:0){h=0;break};k[a+112>>2]=k[w+504>>2];k[a+112+4>>2]=k[w+504+4>>2];k[a+112+8>>2]=k[w+504+8>>2];k[a+112+12>>2]=k[w+504+12>>2];h=k[a+176>>2]|0;do if(!(i[5128]|0)){if(!(db(5128)|0))break;o[1270]=1.0;k[1271]=0;k[1272]=0;k[1273]=0;k[1274]=0;o[1275]=1.0;k[1276]=0;k[1277]=0;k[1278]=0;k[1279]=0;o[1280]=1.0;o[1281]=0.0;ib(5128)}while(0);g=f+ +o[a+108>>2];f=g*+o[5080+(h<<4)+4>>2];e=g*+o[5080+(h<<4)+8>>2];g=+o[a+112>>2]-+o[5080+(h<<4)>>2]*g;o[a+112>>2]=g;f=+o[a+116>>2]-f;o[a+116>>2]=f;e=+o[a+120>>2]-e;o[a+120>>2]=e;h=1}e=+o[n>>2];if(h|e<1.0){g=+o[a+96>>2];f=(g-+o[w+104+64>>2])*.5;do if(!m)if(!(i[a+181>>0]|0)){o[a+92>>2]=(1.0-f)*+o[a+92>>2]+f*+o[a+112>>2];o[a+96>>2]=(1.0-f)*g+f*+o[a+116>>2];o[a+100>>2]=(1.0-f)*+o[a+100>>2]+f*+o[a+120>>2];d=a+181|0;break}else{o[a+92>>2]=(1.0-e)*+o[a+92>>2]+e*+o[a+112>>2];o[a+96>>2]=(1.0-e)*g+e*+o[a+116>>2];o[a+100>>2]=(1.0-e)*+o[a+100>>2]+e*+o[a+120>>2];d=a+181|0;break}else{o[a+92>>2]=(1.0-e)*+o[a+92>>2]+e*+o[a+112>>2];o[a+96>>2]=(1.0-e)*g+e*+o[a+116>>2];o[a+100>>2]=(1.0-e)*+o[a+100>>2]+e*+o[a+120>>2];d=a+181|0}while(0);i[d>>0]=0;o[a+16>>2]=0.0;o[a+20>>2]=0.0;i[a+169>>0]=0}else{i[a+181>>0]=1;do if(!m){if(l<0.0)g=-l;else g=0.0;f=+o[a+24>>2];if(g*c>f){if((i[a+168>>0]|0)==0?(i[a+169>>0]|0)!=0:0)break;o[a+112>>2]=q+ +o[a+112>>2];o[a+116>>2]=s+ +o[a+116>>2];o[a+120>>2]=p+ +o[a+120>>2];d=k[a+176>>2]|0;do if(!(i[5128]|0)){if(!(db(5128)|0))break;o[1270]=1.0;k[1271]=0;k[1272]=0;k[1273]=0;k[1274]=0;o[1275]=1.0;k[1276]=0;k[1277]=0;k[1278]=0;k[1279]=0;o[1280]=1.0;o[1281]=0.0;ib(5128)}while(0);q=f+ +o[a+108>>2];s=q*+o[5080+(d<<4)+4>>2];c=q*+o[5080+(d<<4)+8>>2];o[a+112>>2]=+o[a+112>>2]-+o[5080+(d<<4)>>2]*q;o[a+116>>2]=+o[a+116>>2]-s;o[a+120>>2]=+o[a+120>>2]-c}}while(0);k[a+92>>2]=k[a+112>>2];k[a+92+4>>2]=k[a+112+4>>2];k[a+92+8>>2]=k[a+112+8>>2];k[a+92+12>>2]=k[a+112+12>>2]};k[v>>2]=k[a+92>>2];k[v+4>>2]=k[a+92+4>>2];k[v+8>>2]=k[a+92+8>>2];k[v+12>>2]=k[a+92+12>>2];a=k[a+8>>2]|0;k[a+260>>2]=(k[a+260>>2]|0)+1;k[a+4>>2]=k[w+272>>2];k[a+4+4>>2]=k[w+272+4>>2];k[a+4+8>>2]=k[w+272+8>>2];k[a+4+12>>2]=k[w+272+12>>2];k[a+20>>2]=k[t>>2];k[a+20+4>>2]=k[t+4>>2];k[a+20+8>>2]=k[t+8>>2];k[a+20+12>>2]=k[t+12>>2];k[a+36>>2]=k[u>>2];k[a+36+4>>2]=k[u+4>>2];k[a+36+8>>2]=k[u+8>>2];k[a+36+12>>2]=k[u+12>>2];k[a+52>>2]=k[v>>2];k[a+52+4>>2]=k[v+4>>2];k[a+52+8>>2]=k[v+8>>2];k[a+52+12>>2]=k[v+12>>2];r=w;return}function lr(a){a=a|0;return Wb[k[(k[a>>2]|0)+48>>2]&127](a)|0}function mr(a){a=a|0;if(!(Wb[k[(k[a>>2]|0)+40>>2]&127](a)|0))return;o[a+16>>2]=+o[a+28>>2];i[a+169>>0]=1;return}function nr(a){a=a|0;if(!(+o[a+16>>2]==0.0)){a=0;return a|0}a=+o[a+20>>2]==0.0;return a|0}function or(a,b){a=a|0;b=b|0;return}function pr(a,b){a=a|0;b=b|0;i[a+180>>0]=b&1;return}function qr(a,b){a=a|0;b=b|0;var c=0,d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0,x=0,y=0.0,z=0.0,A=0.0,B=0.0;c=k[a+748>>2]|0;if((c|0)!=4){k[a+748>>2]=c+1;x=c;w=(x|0)<0;x=w?0:x;a=a+4+(x*184|0)|0;qF(a|0,b|0,184)|0;return x|0}y=+o[b+80>>2];v=+o[a+84>>2];u=v<y?v:y;t=+o[a+268>>2];s=t<u?t:u;r=+o[a+452>>2];w=+o[a+636>>2]<(r<s?r:s);c=w?3:r<s?2:t<u?1:(v<y^1)<<31>>31;y=+o[b>>2];if(c){f=+o[a+188>>2];i=+o[b+4>>2];d=+o[a+192>>2];e=+o[b+8>>2];h=+o[a+196>>2];j=+o[a+556>>2];t=+o[a+372>>2];p=+o[a+560>>2];q=+o[a+376>>2];s=+o[a+564>>2];l=+o[a+380>>2];g=((y-f)*(p-q)-(i-d)*(j-t))*((y-f)*(p-q)-(i-d)*(j-t))+(((i-d)*(s-l)-(e-h)*(p-q))*((i-d)*(s-l)-(e-h)*(p-q))+((e-h)*(j-t)-(y-f)*(s-l))*((e-h)*(j-t)-(y-f)*(s-l)));if((c|0)==1){n=+o[a+12>>2];r=j;v=f;u=p;p=d;f=0.0;m=+o[a+4>>2];j=+o[a+8>>2];x=7}else{u=f;r=j;x=6}}else{u=+o[a+188>>2];d=+o[a+192>>2];h=+o[a+196>>2];g=0.0;i=+o[b+4>>2];e=+o[b+8>>2];r=+o[a+556>>2];t=+o[a+372>>2];p=+o[a+560>>2];q=+o[a+376>>2];s=+o[a+564>>2];l=+o[a+380>>2];x=6}if((x|0)==6){m=+o[a+4>>2];j=+o[a+8>>2];B=i-j;n=+o[a+12>>2];z=e-n;v=r-t;A=p-q;f=s-l;f=((y-m)*A-B*v)*((y-m)*A-B*v)+((B*f-z*A)*(B*f-z*A)+(z*v-(y-m)*f)*(z*v-(y-m)*f));if((c|0)==2){r=t;s=u;p=d;d=0.0;x=8}else{v=u;u=p;p=d;x=7}}if((x|0)==7){z=y-m;A=i-j;B=e-n;r=r-v;u=u-p;d=s-h;d=(z*u-A*r)*(z*u-A*r)+((A*d-B*u)*(A*d-B*u)+(B*r-z*d)*(B*r-z*d));if(w)e=0.0;else{r=t;s=v;x=8}}if((x|0)==8){z=y-m;t=i-j;v=e-n;y=r-s;u=q-p;e=l-h;e=(z*u-t*y)*(z*u-t*y)+((t*e-v*u)*(t*e-v*u)+(v*y-z*e)*(v*y-z*e))}z=+X(+g);v=+X(+f);t=+X(+d);s=+X(+e);y=z>-999999984306749440.0?z:-999999984306749440.0;u=v>y?v:y;x=s>(t>u?t:u)?3:t>u?2:v>y?1:(z>-999999984306749440.0^1)<<31>>31;w=(x|0)<0;x=w?0:x;a=a+4+(x*184|0)|0;qF(a|0,b|0,184)|0;return x|0}function rr(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0.0,g=0,h=0,j=0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0;d=k[a+748>>2]|0;if((d|0)<=0)return;do{j=d;d=d+-1|0;q=+o[a+4+(d*184|0)>>2];r=+o[a+4+(d*184|0)+4>>2];e=+o[a+4+(d*184|0)+8>>2];p=q*+o[b>>2]+r*+o[b+4>>2]+e*+o[b+8>>2]+ +o[b+48>>2];m=q*+o[b+16>>2]+r*+o[b+20>>2]+e*+o[b+24>>2]+ +o[b+52>>2];e=q*+o[b+32>>2]+r*+o[b+36>>2]+e*+o[b+40>>2]+ +o[b+56>>2];o[a+4+(d*184|0)+48>>2]=p;o[a+4+(d*184|0)+52>>2]=m;o[a+4+(d*184|0)+56>>2]=e;o[a+4+(d*184|0)+60>>2]=0.0;r=+o[a+4+(d*184|0)+16>>2];q=+o[a+4+(d*184|0)+20>>2];f=+o[a+4+(d*184|0)+24>>2];n=r*+o[c>>2]+q*+o[c+4>>2]+f*+o[c+8>>2]+ +o[c+48>>2];l=r*+o[c+16>>2]+q*+o[c+20>>2]+f*+o[c+24>>2]+ +o[c+52>>2];f=r*+o[c+32>>2]+q*+o[c+36>>2]+f*+o[c+40>>2]+ +o[c+56>>2];o[a+4+(d*184|0)+32>>2]=n;o[a+4+(d*184|0)+36>>2]=l;o[a+4+(d*184|0)+40>>2]=f;o[a+4+(d*184|0)+44>>2]=0.0;o[a+4+(d*184|0)+80>>2]=(p-n)*+o[a+4+(d*184|0)+64>>2]+(m-l)*+o[a+4+(d*184|0)+68>>2]+(e-f)*+o[a+4+(d*184|0)+72>>2];h=a+4+(d*184|0)+148|0;k[h>>2]=(k[h>>2]|0)+1}while((j|0)>1);d=k[a+748>>2]|0;if((d|0)<=0)return;g=d;h=d;while(1){j=h;h=h+-1|0;b=a+4+(h*184|0)|0;e=+o[a+4+(h*184|0)+80>>2];f=+o[a+752>>2];if(e<=f){n=+o[a+4+(h*184|0)+32>>2]-(+o[a+4+(h*184|0)+48>>2]-+o[a+4+(h*184|0)+64>>2]*e);p=+o[a+4+(h*184|0)+36>>2]-(+o[a+4+(h*184|0)+52>>2]-e*+o[a+4+(h*184|0)+68>>2]);q=+o[a+4+(h*184|0)+40>>2]-(+o[a+4+(h*184|0)+56>>2]-e*+o[a+4+(h*184|0)+72>>2]);if(n*n+p*p+q*q>f*f){c=g+-1|0;if((c|0)==(h|0))d=g;else{qF(b|0,a+4+(c*184|0)|0,184)|0;k[a+4+(c*184|0)+112>>2]=0;o[a+4+(c*184|0)+120>>2]=0.0;i[a+4+(c*184|0)+116>>0]=0;o[a+4+(c*184|0)+124>>2]=0.0;o[a+4+(c*184|0)+128>>2]=0.0;k[a+4+(c*184|0)+148>>2]=0;d=k[a+748>>2]|0}d=d+-1|0;k[a+748>>2]=d}else d=g}else{c=g+-1|0;if((c|0)==(h|0))d=g;else{qF(b|0,a+4+(c*184|0)|0,184)|0;k[a+4+(c*184|0)+112>>2]=0;o[a+4+(c*184|0)+120>>2]=0.0;i[a+4+(c*184|0)+116>>0]=0;o[a+4+(c*184|0)+124>>2]=0.0;o[a+4+(c*184|0)+128>>2]=0.0;k[a+4+(c*184|0)+148>>2]=0;d=k[a+748>>2]|0}d=d+-1|0;k[a+748>>2]=d}if((j|0)<=1)break;else g=d}return}function sr(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0.0;o[b+16>>2]=+o[a+4>>2];o[b+20>>2]=+o[a+8>>2];o[b+24>>2]=+o[a+12>>2];o[b+28>>2]=+o[a+16>>2];o[b+32>>2]=+o[a+20>>2];o[b+36>>2]=+o[a+24>>2];o[b+40>>2]=+o[a+28>>2];o[b+44>>2]=+o[a+32>>2];o[b+48>>2]=+o[a+36>>2];o[b+52>>2]=+o[a+40>>2];o[b+56>>2]=+o[a+44>>2];o[b+60>>2]=+o[a+48>>2];o[b+64>>2]=+o[a+52>>2];o[b+68>>2]=+o[a+56>>2];o[b+72>>2]=+o[a+60>>2];o[b+76>>2]=+o[a+64>>2];o[b+80>>2]=+o[a+68>>2];o[b+84>>2]=+o[a+72>>2];o[b+88>>2]=+o[a+76>>2];o[b+92>>2]=+o[a+80>>2];o[b+96>>2]=+o[a+84>>2];o[b+100>>2]=+o[a+88>>2];o[b+104>>2]=+o[a+92>>2];o[b+108>>2]=+o[a+96>>2];o[b+112>>2]=+o[a+100>>2];o[b+116>>2]=+o[a+104>>2];o[b+120>>2]=+o[a+108>>2];o[b+124>>2]=+o[a+112>>2];o[b+128>>2]=+o[a+116>>2];o[b+132>>2]=+o[a+120>>2];o[b+136>>2]=+o[a+124>>2];o[b+140>>2]=+o[a+128>>2];o[b+144>>2]=+o[a+132>>2];o[b+148>>2]=+o[a+136>>2];o[b+152>>2]=+o[a+140>>2];o[b+156>>2]=+o[a+144>>2];o[b+160>>2]=+o[a+148>>2];o[b+164>>2]=+o[a+152>>2];o[b+168>>2]=+o[a+156>>2];o[b+172>>2]=+o[a+160>>2];o[b+176>>2]=+o[a+164>>2];o[b+180>>2]=+o[a+168>>2];o[b+184>>2]=+o[a+172>>2];o[b+188>>2]=+o[a+176>>2];k[b+224>>2]=k[a+180>>2];o[b+192>>2]=+o[a+184>>2];k[b>>2]=0;d=nc[k[(k[c>>2]|0)+28>>2]&31](c,k[a+192>>2]|0)|0;k[b+4>>2]=d;k[b+8>>2]=0;k[b+228>>2]=k[a+204>>2];k[b+232>>2]=k[a+208>>2];k[b+236>>2]=k[a+212>>2];k[b+240>>2]=k[a+216>>2];o[b+196>>2]=+o[a+220>>2];o[b+200>>2]=+o[a+224>>2];o[b+204>>2]=+o[a+232>>2];o[b+208>>2]=+o[a+228>>2];k[b+244>>2]=k[a+236>>2];d=nc[k[(k[c>>2]|0)+40>>2]&31](c,a)|0;e=nc[k[(k[c>>2]|0)+28>>2]&31](c,d)|0;k[b+12>>2]=e;if(!e){e=a+244|0;f=+o[e>>2];e=b+212|0;o[e>>2]=f;e=a+248|0;f=+o[e>>2];e=b+216|0;o[e>>2]=f;e=a+252|0;f=+o[e>>2];e=b+220|0;o[e>>2]=f;a=a+256|0;a=k[a>>2]|0;e=b+248|0;k[e>>2]=a;return 5344}Ub[k[(k[c>>2]|0)+48>>2]&127](c,d);e=a+244|0;f=+o[e>>2];e=b+212|0;o[e>>2]=f;e=a+248|0;f=+o[e>>2];e=b+216|0;o[e>>2]=f;e=a+252|0;f=+o[e>>2];e=b+220|0;o[e>>2]=f;a=a+256|0;a=k[a>>2]|0;e=b+248|0;k[e>>2]=a;return 5344}function tr(a,b){a=a|0;b=b|0;var c=0,d=0;d=Wb[k[(k[a>>2]|0)+16>>2]&127](a)|0;d=dc[k[(k[b>>2]|0)+16>>2]&63](b,d,1)|0;c=dc[k[(k[a>>2]|0)+20>>2]&63](a,k[d+8>>2]|0,b)|0;Qb[k[(k[b>>2]|0)+20>>2]&31](b,d,c,1245859651,a);return}function ur(a){a=a|0;var b=0;k[a>>2]=5416;b=k[a+276>>2]|0;if(b){if(i[a+280>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+276>>2]=0}i[a+280>>0]=1;k[a+276>>2]=0;k[a+268>>2]=0;k[a+272>>2]=0;return}function vr(a){a=a|0;var b=0;k[a>>2]=5416;b=k[a+276>>2]|0;if(b){if(i[a+280>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+276>>2]=0}i[a+280>>0]=1;k[a+276>>2]=0;k[a+268>>2]=0;k[a+272>>2]=0;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function wr(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0;h=k[b>>2]|0;b=k[a+268>>2]|0;a:do if((b|0)>0){d=k[a+276>>2]|0;c=0;while(1){if((k[d+(c<<2)>>2]|0)==(h|0))break;c=c+1|0;if((c|0)>=(b|0))break a}if((c|0)!=(b|0))return}while(0);if((b|0)==(k[a+272>>2]|0)?(g=(b|0)==0?1:b<<1,(b|0)<(g|0)):0){if(!g)f=0;else{k[5108]=(k[5108]|0)+1;c=iF((g<<2|3)+16|0)|0;if(!c)b=0;else{k[(c+4+15&-16)+-4>>2]=c;b=c+4+15&-16}f=b;b=k[a+268>>2]|0}if((b|0)>0){d=b+-1|0;e=0;while(1){c=f+(e<<2)|0;if(c)k[c>>2]=k[(k[a+276>>2]|0)+(e<<2)>>2];if((e|0)==(d|0))break;else e=e+1|0}}c=k[a+276>>2]|0;if(c){if(i[a+280>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);b=k[a+268>>2]|0}k[a+276>>2]=0}i[a+280>>0]=1;k[a+276>>2]=f;k[a+272>>2]=g}c=(k[a+276>>2]|0)+(b<<2)|0;if(c)k[c>>2]=h;k[a+268>>2]=b+1;return}function xr(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0;c=k[b>>2]|0;e=k[a+268>>2]|0;if((e|0)<=0)return;f=k[a+276>>2]|0;d=0;while(1){b=f+(d<<2)|0;if((k[b>>2]|0)==(c|0))break;d=d+1|0;if((d|0)>=(e|0)){g=7;break}}if((g|0)==7)return;if((d|0)>=(e|0))return;k[b>>2]=k[f+(e+-1<<2)>>2];k[a+268>>2]=e+-1;return}function yr(a){a=a|0;var b=0;k[a>>2]=5464;b=k[a+284>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+284>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a>>2]=5416;b=k[a+276>>2]|0;if(!b){i[a+280>>0]=1;k[a+276>>2]=0;k[a+268>>2]=0;a=a+272|0;k[a>>2]=0;return}if(i[a+280>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+276>>2]=0;i[a+280>>0]=1;k[a+276>>2]=0;k[a+268>>2]=0;a=a+272|0;k[a>>2]=0;return}function zr(a){a=a|0;yr(a);if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function Ar(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,j=0,l=0;if(!c)c=k[a+188>>2]|0;l=k[b>>2]|0;e=k[a+268>>2]|0;a:do if((e|0)>0){f=k[a+276>>2]|0;d=0;while(1){if((k[f+(d<<2)>>2]|0)==(l|0))break;d=d+1|0;if((d|0)>=(e|0))break a}if((d|0)!=(e|0))return}while(0);if((e|0)==(k[a+272>>2]|0)?(j=(e|0)==0?1:e<<1,(e|0)<(j|0)):0){if(!j)h=0;else{k[5108]=(k[5108]|0)+1;d=iF((j<<2|3)+16|0)|0;if(!d)e=0;else{k[(d+4+15&-16)+-4>>2]=d;e=d+4+15&-16}h=e;e=k[a+268>>2]|0}if((e|0)>0){f=e+-1|0;g=0;while(1){d=h+(g<<2)|0;if(d)k[d>>2]=k[(k[a+276>>2]|0)+(g<<2)>>2];if((g|0)==(f|0))break;else g=g+1|0}}d=k[a+276>>2]|0;if(d){if(i[a+280>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0);e=k[a+268>>2]|0}k[a+276>>2]=0}i[a+280>>0]=1;k[a+276>>2]=h;k[a+272>>2]=j}d=(k[a+276>>2]|0)+(e<<2)|0;if(d)k[d>>2]=l;k[a+268>>2]=e+1;a=k[a+284>>2]|0;dc[k[(k[a>>2]|0)+8>>2]&63](a,c,b)|0;return}function Br(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0,i=0,j=0;i=k[b>>2]|0;if(!d)d=k[a+188>>2]|0;g=k[a+268>>2]|0;if((g|0)<=0)return;h=k[a+276>>2]|0;e=0;while(1){f=h+(e<<2)|0;if((k[f>>2]|0)==(i|0))break;e=e+1|0;if((e|0)>=(g|0)){j=9;break}}if((j|0)==9)return;if((e|0)>=(g|0))return;k[f>>2]=k[h+(g+-1<<2)>>2];k[a+268>>2]=g+-1;j=k[a+284>>2]|0;_b[k[(k[j>>2]|0)+12>>2]&31](j,d,b,c)|0;return}function Cr(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=+f;var g=0.0,h=0.0,i=0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0,z=0,A=0,B=0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0;B=r;r=r+320|0;k[B>>2]=k[c>>2];k[B+4>>2]=k[c+4>>2];k[B+8>>2]=k[c+8>>2];k[B+12>>2]=k[c+12>>2];k[B+16>>2]=k[c+16>>2];k[B+16+4>>2]=k[c+16+4>>2];k[B+16+8>>2]=k[c+16+8>>2];k[B+16+12>>2]=k[c+16+12>>2];k[B+32>>2]=k[c+32>>2];k[B+32+4>>2]=k[c+32+4>>2];k[B+32+8>>2]=k[c+32+8>>2];k[B+32+12>>2]=k[c+32+12>>2];k[B+48>>2]=k[c+48>>2];k[B+48+4>>2]=k[c+48+4>>2];k[B+48+8>>2]=k[c+48+8>>2];k[B+48+12>>2]=k[c+48+12>>2];k[B+152>>2]=k[d>>2];k[B+152+4>>2]=k[d+4>>2];k[B+152+8>>2]=k[d+8>>2];k[B+152+12>>2]=k[d+12>>2];k[B+152+16>>2]=k[d+16>>2];k[B+152+16+4>>2]=k[d+16+4>>2];k[B+152+16+8>>2]=k[d+16+8>>2];k[B+152+16+12>>2]=k[d+16+12>>2];k[B+152+32>>2]=k[d+32>>2];k[B+152+32+4>>2]=k[d+32+4>>2];k[B+152+32+8>>2]=k[d+32+8>>2];k[B+152+32+12>>2]=k[d+32+12>>2];k[B+152+48>>2]=k[d+48>>2];k[B+152+48+4>>2]=k[d+48+4>>2];k[B+152+48+8>>2]=k[d+48+8>>2];k[B+152+48+12>>2]=k[d+48+12>>2];g=+o[B+152+52>>2]-+o[B+52>>2];G=+o[B+152+56>>2]-+o[B+56>>2];o[B+96>>2]=+o[B+152+48>>2]-+o[B+48>>2];o[B+96+4>>2]=g;o[B+96+8>>2]=G;o[B+96+12>>2]=0.0;Rw(B,B+152|0,B+232|0,B+112|0);G=+o[B+112>>2];g=G*+o[B+232+4>>2];D=G*+o[B+232+8>>2];o[B+136>>2]=+o[B+232>>2]*G;o[B+136+4>>2]=g;o[B+136+8>>2]=D;o[B+136+12>>2]=0.0;k[B+232+4>>2]=0;k[B+232+4+4>>2]=0;k[B+232+24>>2]=0;k[B+232+24+4>>2]=0;A=B+232+44|0;k[A>>2]=0;k[A+4>>2]=0;k[A+8>>2]=0;k[A+12>>2]=0;k[A+16>>2]=0;Jw(B,B+120|0);D=+o[B+120>>2];g=+o[B+120+4>>2];G=+o[B+120+8>>2];E=+o[B+120+12>>2];C=D*(2.0/(D*D+g*g+G*G+E*E));h=g*(2.0/(D*D+g*g+G*G+E*E));F=G*(2.0/(D*D+g*g+G*G+E*E));o[B+232>>2]=1.0-(g*h+G*F);o[B+232+4>>2]=D*h-E*F;o[B+232+8>>2]=D*F+E*h;o[B+232+12>>2]=0.0;o[B+232+16>>2]=D*h+E*F;o[B+232+20>>2]=1.0-(D*C+G*F);o[B+232+24>>2]=g*F-E*C;o[B+232+28>>2]=0.0;o[B+232+32>>2]=D*F-E*h;o[B+232+36>>2]=g*F+E*C;o[B+232+40>>2]=1.0-(D*C+g*h);o[A>>2]=0.0;Wt(b,B+232|0,B+96|0,B+136|0,B+216|0,B+296|0);if((k[a+268>>2]|0)<=0){r=B;return}A=0;do{i=k[(k[a+276>>2]|0)+(A<<2)>>2]|0;if(nc[k[(k[e>>2]|0)+8>>2]&31](e,k[i+188>>2]|0)|0?(y=k[i+192>>2]|0,Cc[k[(k[y>>2]|0)+8>>2]&127](y,i+4|0,B+80|0,B+64|0),j=+o[B+80>>2]+ +o[B+216>>2],l=+o[B+80+4>>2]+ +o[B+216+4>>2],m=+o[B+80+8>>2]+ +o[B+216+8>>2],o[B+80>>2]=j,o[B+80+4>>2]=l,o[B+80+8>>2]=m,o[B+80+12>>2]=0.0,n=+o[B+64>>2]+ +o[B+296>>2],p=+o[B+64+4>>2]+ +o[B+296+4>>2],q=+o[B+64+8>>2]+ +o[B+296+8>>2],o[B+64>>2]=n,o[B+64+4>>2]=p,o[B+64+8>>2]=q,o[B+64+12>>2]=0.0,s=+o[c+48>>2]-(n+j)*.5,t=+o[c+52>>2]-(p+l)*.5,u=+o[c+56>>2]-(q+m)*.5,v=+o[d+48>>2]-(n+j)*.5,w=+o[d+52>>2]-(p+l)*.5,x=+o[d+56>>2]-(q+m)*.5,y=s<-((n-j)*.5)|(s>(n-j)*.5?8:0)|(t<-((p-l)*.5)?2:0)|(t>(p-l)*.5?16:0)|(u<-((q-m)*.5)?4:0)|(u>(q-m)*.5?32:0),z=v<-((n-j)*.5)|(v>(n-j)*.5?8:0)|(w<-((p-l)*.5)?2:0)|(w>(p-l)*.5?16:0)|(x<-((q-m)*.5)?4:0)|(x>(q-m)*.5?32:0),(y&z|0)==0):0){if(s<-((n-j)*.5))if(!((-s-(n-j)*.5)/(v-s)>=0.0)){g=1.0;h=0.0}else{g=1.0;h=(-s-(n-j)*.5)/(v-s)}else if(v<-((n-j)*.5)?(-s-(n-j)*.5)/(v-s)<1.0:0){g=(-s-(n-j)*.5)/(v-s);h=0.0}else{g=1.0;h=0.0}if(t<-((p-l)*.5)){if(h<=(-t-(p-l)*.5)/(w-t))h=(-t-(p-l)*.5)/(w-t)}else if(w<-((p-l)*.5)?(-t-(p-l)*.5)/(w-t)<g:0)g=(-t-(p-l)*.5)/(w-t);if(u<-((q-m)*.5)){if(h<=(-u-(q-m)*.5)/(x-u))h=(-u-(q-m)*.5)/(x-u)}else if(x<-((q-m)*.5)?(-u-(q-m)*.5)/(x-u)<g:0)g=(-u-(q-m)*.5)/(x-u);if(s>(n-j)*.5){if(h<=((n-j)*.5-s)/(v-s))h=((n-j)*.5-s)/(v-s)}else if(v>(n-j)*.5?((n-j)*.5-s)/(v-s)<g:0)g=((n-j)*.5-s)/(v-s);if(t>(p-l)*.5){if(h<=((p-l)*.5-t)/(w-t))h=((p-l)*.5-t)/(w-t)}else if(w>(p-l)*.5?((p-l)*.5-t)/(w-t)<g:0)g=((p-l)*.5-t)/(w-t);if(!(y&32)){if((z&32|0)!=0?((q-m)*.5-u)/(x-u)<g:0)g=((q-m)*.5-u)/(x-u)}else if(h<=((q-m)*.5-u)/(x-u))h=((q-m)*.5-u)/(x-u);if(h<=g){H=k[i+192>>2]|0;k[B+232>>2]=0;k[B+232+4>>2]=H;k[B+232+8>>2]=i;k[B+232+12>>2]=i+4;k[B+232+16>>2]=-1;k[B+232+20>>2]=-1;us(b,B,B+152|0,B+232|0,e,f)}}A=A+1|0}while((A|0)<(k[a+268>>2]|0));r=B;return}function Dr(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0,f=0,g=0,h=0;h=r;r=r+80|0;f=k[k[a>>2]>>2]|0;g=k[k[a+4>>2]>>2]|0;if(!(dc[k[(k[b>>2]|0)+24>>2]&63](b,f,g)|0)){r=h;return}e=k[f+192>>2]|0;k[h+56>>2]=0;k[h+56+4>>2]=e;k[h+56+8>>2]=f;k[h+56+12>>2]=f+4;k[h+56+16>>2]=-1;k[h+56+20>>2]=-1;e=k[g+192>>2]|0;k[h+32>>2]=0;k[h+32+4>>2]=e;k[h+32+8>>2]=g;k[h+32+12>>2]=g+4;k[h+32+16>>2]=-1;k[h+32+20>>2]=-1;e=k[a+8>>2]|0;if(!e){e=_b[k[(k[b>>2]|0)+8>>2]&31](b,h+56|0,h+32|0,0)|0;k[a+8>>2]=e;if(!e){r=h;return}}k[h>>2]=7888;k[h+4>>2]=0;k[h+8>>2]=h+56;k[h+12>>2]=h+32;if((k[c+8>>2]|0)==1){Qb[k[(k[e>>2]|0)+8>>2]&31](e,h+56|0,h+32|0,c,h);r=h;return}d=+cc[k[(k[e>>2]|0)+12>>2]&15](e,f,g,c,h);if(!(+o[c+12>>2]>d)){r=h;return}o[c+12>>2]=d;r=h;return}function Er(a){a=a|0;var b=0;k[a>>2]=5600;b=k[a+20>>2]|0;if(b){if(i[a+24>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+20>>2]=0}i[a+24>>0]=1;k[a+20>>2]=0;k[a+12>>2]=0;k[a+16>>2]=0;return}function Fr(a){a=a|0;var b=0;k[a>>2]=5600;b=k[a+20>>2]|0;if(b){if(i[a+24>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+20>>2]=0}i[a+24>>0]=1;k[a+20>>2]=0;k[a+12>>2]=0;k[a+16>>2]=0;jF(a);return}function Gr(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0.0,g=0.0,h=0,j=0,l=0,m=0,n=0.0;m=r;r=r+16|0;k[1396]=(k[1396]|0)+1;if(!(k[a+4>>2]&2))e=5336;else{e=k[b+192>>2]|0;f=+sc[k[(k[e>>2]|0)+20>>2]&1](e,.019999999552965164);o[m+4>>2]=f;e=k[c+192>>2]|0;g=+sc[k[(k[e>>2]|0)+20>>2]&1](e,.019999999552965164);o[m>>2]=g;e=f<g?m+4|0:m}f=+o[e>>2];n=+o[b+184>>2];g=+o[c+184>>2];g=n<g?n:g;e=k[a+68>>2]|0;d=k[e+8>>2]|0;if(!d){if(k[a+4>>2]&4){a=0;r=m;return a|0}k[5108]=(k[5108]|0)+1;e=iF(791)|0;if(!e)j=0;else{k[(e+4+15&-16)+-4>>2]=e;j=e+4+15&-16}}else{j=k[e+12>>2]|0;k[e+12>>2]=k[j>>2];k[e+8>>2]=d+-1}k[j>>2]=1025;k[j+116>>2]=0;i[j+120>>0]=0;e=j+124|0;k[e>>2]=0;k[e+4>>2]=0;k[e+8>>2]=0;k[e+12>>2]=0;k[e+16>>2]=0;k[e+20>>2]=0;k[e+24>>2]=0;k[e+28>>2]=0;k[j+300>>2]=0;i[j+304>>0]=0;e=j+308|0;k[e>>2]=0;k[e+4>>2]=0;k[e+8>>2]=0;k[e+12>>2]=0;k[e+16>>2]=0;k[e+20>>2]=0;k[e+24>>2]=0;k[e+28>>2]=0;k[j+484>>2]=0;i[j+488>>0]=0;e=j+492|0;k[e>>2]=0;k[e+4>>2]=0;k[e+8>>2]=0;k[e+12>>2]=0;k[e+16>>2]=0;k[e+20>>2]=0;k[e+24>>2]=0;k[e+28>>2]=0;k[j+668>>2]=0;i[j+672>>0]=0;e=j+676|0;k[e>>2]=0;k[e+4>>2]=0;k[e+8>>2]=0;k[e+12>>2]=0;k[e+16>>2]=0;k[e+20>>2]=0;k[e+24>>2]=0;k[e+28>>2]=0;k[j+740>>2]=b;k[j+744>>2]=c;k[j+748>>2]=0;o[j+752>>2]=f;o[j+756>>2]=g;e=k[a+12>>2]|0;k[j+768>>2]=e;if((e|0)==(k[a+16>>2]|0)?(l=(e|0)==0?1:e<<1,(e|0)<(l|0)):0){if(!l)h=0;else{k[5108]=(k[5108]|0)+1;e=iF((l<<2|3)+16|0)|0;if(!e)e=0;else{k[(e+4+15&-16)+-4>>2]=e;e=e+4+15&-16}h=e;e=k[a+12>>2]|0}if((e|0)>0){d=e+-1|0;b=0;while(1){c=h+(b<<2)|0;if(c)k[c>>2]=k[(k[a+20>>2]|0)+(b<<2)>>2];if((b|0)==(d|0))break;else b=b+1|0}}d=k[a+20>>2]|0;if(d){if(i[a+24>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0);e=k[a+12>>2]|0}k[a+20>>2]=0}i[a+24>>0]=1;k[a+20>>2]=h;k[a+16>>2]=l}d=(k[a+20>>2]|0)+(e<<2)|0;if(d)k[d>>2]=j;k[a+12>>2]=e+1;a=j;r=m;return a|0}function Hr(a,b){a=a|0;b=b|0;k[b+748>>2]=0;return}function Ir(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0;k[1396]=(k[1396]|0)+-1;Ub[k[(k[a>>2]|0)+20>>2]&127](a,b);d=k[b+768>>2]|0;c=(k[a+12>>2]|0)+-1|0;f=k[a+20>>2]|0;e=k[f+(d<<2)>>2]|0;k[f+(d<<2)>>2]=k[f+(c<<2)>>2];k[(k[a+20>>2]|0)+(c<<2)>>2]=e;k[(k[(k[a+20>>2]|0)+(d<<2)>>2]|0)+768>>2]=d;k[a+12>>2]=c;a=k[a+68>>2]|0;if(!b)return;f=k[a+16>>2]|0;if(f>>>0<=b>>>0?(f+(ia(k[a>>2]|0,k[a+4>>2]|0)|0)|0)>>>0>b>>>0:0){k[b>>2]=k[a+12>>2];k[a+12>>2]=b;k[a+8>>2]=(k[a+8>>2]|0)+1;return}k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0);return}function Jr(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;e=r;r=r+16|0;k[e>>2]=a;k[e+4>>2]=d;a=k[a+72+((k[(k[b+4>>2]|0)+4>>2]|0)*144|0)+(k[(k[c+4>>2]|0)+4>>2]<<2)>>2]|0;a=_b[k[(k[a>>2]|0)+8>>2]&31](a,e,b,c)|0;r=e;return a|0}function Kr(a,b,c){a=a|0;b=b|0;c=c|0;b=k[b+204>>2]|0;if(b&4){c=0;return c|0}a=k[c+204>>2]|0;if(a&4){c=0;return c|0}if(!(b&3)){c=1;return c|0}c=(a&3|0)==0;return c|0}function Lr(a,b,c){a=a|0;b=b|0;c=c|0;a=k[b+216>>2]|0;if((a|0)==2|(a|0)==5?(a=k[c+216>>2]|0,(a|0)==2|(a|0)==5):0){a=0;return a|0}if(!(k[b+256>>2]|0)){a=1;return a|0}a=nc[k[k[b>>2]>>2]&31](b,c)|0;return a|0}function Mr(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;e=r;r=r+16|0;k[e>>2]=5712;k[e+4>>2]=c;k[e+8>>2]=a;yc[k[(k[b>>2]|0)+48>>2]&127](b,e,d);r=e;return}function Nr(a,b){a=a|0;b=b|0;var c=0;a=k[a+64>>2]|0;c=k[a+8>>2]|0;if(c){b=k[a+12>>2]|0;k[a+12>>2]=k[b>>2];k[a+8>>2]=c+-1;return b|0}k[5108]=(k[5108]|0)+1;a=iF(b+19|0)|0;if(!a){b=0;return b|0}k[(a+4+15&-16)+-4>>2]=a;b=a+4+15&-16;return b|0}function Or(a,b){a=a|0;b=b|0;var c=0;a=k[a+64>>2]|0;if(!b)return;c=k[a+16>>2]|0;if(c>>>0<=b>>>0?(c+(ia(k[a>>2]|0,k[a+4>>2]|0)|0)|0)>>>0>b>>>0:0){k[b>>2]=k[a+12>>2];k[a+12>>2]=b;k[a+8>>2]=(k[a+8>>2]|0)+1;return}k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0);return}function Pr(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0,j=0,l=0;k[a>>2]=5816;k[5108]=(k[5108]|0)+1;c=iF(379)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}o[c+308>>2]=9.999999747378752e-05;g=c+332|0;i[g>>0]=i[g>>0]&-16;k[a+24>>2]=c;g=(k[b+20>>2]|0)==0;k[5108]=(k[5108]|0)+1;c=iF(23)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}f=(c|0)==0;if(g){if(f)c=0;else k[c>>2]=18624;k[a+28>>2]=c}else{if(f)c=0;else k[c>>2]=19048;k[a+28>>2]=c}k[5108]=(k[5108]|0)+1;c=iF(43)|0;if((c|0)!=0?(h=c+4+15&-16,k[h+-4>>2]=c,(c+4+15&-16|0)!=0):0){f=k[a+24>>2]|0;g=k[a+28>>2]|0;i[h+4>>0]=0;k[(c+4+15&-16)>>2]=10400;k[h+16>>2]=0;k[h+20>>2]=3;k[h+12>>2]=f;k[h+8>>2]=g;c=c+4+15&-16}else c=0;k[a+32>>2]=c;k[5108]=(k[5108]|0)+1;c=iF(27)|0;if((c|0)!=0?(k[(c+4+15&-16)+-4>>2]=c,(c+4+15&-16|0)!=0):0){i[(c+4+15&-16)+4>>0]=0;k[(c+4+15&-16)>>2]=6824;c=c+4+15&-16}else c=0;k[a+36>>2]=c;k[5108]=(k[5108]|0)+1;c=iF(27)|0;if((c|0)!=0?(k[(c+4+15&-16)+-4>>2]=c,(c+4+15&-16|0)!=0):0){i[(c+4+15&-16)+4>>0]=0;k[(c+4+15&-16)>>2]=6720;c=c+4+15&-16}else c=0;k[a+40>>2]=c;k[5108]=(k[5108]|0)+1;c=iF(27)|0;if((c|0)!=0?(k[(c+4+15&-16)+-4>>2]=c,(c+4+15&-16|0)!=0):0){i[(c+4+15&-16)+4>>0]=0;k[(c+4+15&-16)>>2]=6632;c=c+4+15&-16}else c=0;k[a+44>>2]=c;k[5108]=(k[5108]|0)+1;c=iF(27)|0;if((c|0)!=0?(k[(c+4+15&-16)+-4>>2]=c,(c+4+15&-16|0)!=0):0){i[(c+4+15&-16)+4>>0]=0;k[(c+4+15&-16)>>2]=6536;c=c+4+15&-16}else c=0;k[a+48>>2]=c;k[5108]=(k[5108]|0)+1;c=iF(27)|0;if((c|0)!=0?(k[(c+4+15&-16)+-4>>2]=c,(c+4+15&-16|0)!=0):0){i[(c+4+15&-16)+4>>0]=0;k[(c+4+15&-16)>>2]=6440;c=c+4+15&-16}else c=0;k[a+52>>2]=c;k[5108]=(k[5108]|0)+1;c=iF(27)|0;if((c|0)!=0?(k[(c+4+15&-16)+-4>>2]=c,(c+4+15&-16|0)!=0):0){i[(c+4+15&-16)+4>>0]=0;k[(c+4+15&-16)>>2]=6360;c=c+4+15&-16}else c=0;k[a+56>>2]=c;k[5108]=(k[5108]|0)+1;c=iF(27)|0;if((c|0)!=0?(k[(c+4+15&-16)+-4>>2]=c,(c+4+15&-16|0)!=0):0){i[(c+4+15&-16)+4>>0]=0;k[(c+4+15&-16)>>2]=6264;c=c+4+15&-16}else c=0;k[a+60>>2]=c;k[5108]=(k[5108]|0)+1;c=iF(27)|0;if((c|0)!=0?(k[(c+4+15&-16)+-4>>2]=c,(c+4+15&-16|0)!=0):0){i[(c+4+15&-16)+4>>0]=0;k[(c+4+15&-16)>>2]=6168;c=c+4+15&-16}else c=0;k[a+76>>2]=c;k[5108]=(k[5108]|0)+1;c=iF(27)|0;if((c|0)!=0?(k[(c+4+15&-16)+-4>>2]=c,(c+4+15&-16|0)!=0):0){i[(c+4+15&-16)+4>>0]=0;k[(c+4+15&-16)>>2]=6168;c=c+4+15&-16}else c=0;k[a+80>>2]=c;i[c+4>>0]=1;k[5108]=(k[5108]|0)+1;c=iF(27)|0;if((c|0)!=0?(k[(c+4+15&-16)+-4>>2]=c,(c+4+15&-16|0)!=0):0){i[(c+4+15&-16)+4>>0]=0;k[(c+4+15&-16)>>2]=6080;c=c+4+15&-16}else c=0;k[a+72>>2]=c;k[5108]=(k[5108]|0)+1;c=iF(35)|0;if((c|0)!=0?(j=c+4+15&-16,k[j+-4>>2]=c,(c+4+15&-16|0)!=0):0){i[j+4>>0]=0;k[(c+4+15&-16)>>2]=5944;k[j+8>>2]=1;k[j+12>>2]=0;c=c+4+15&-16}else c=0;k[a+88>>2]=c;k[5108]=(k[5108]|0)+1;c=iF(35)|0;if((c|0)!=0?(e=c+4+15&-16,k[e+-4>>2]=c,(c+4+15&-16|0)!=0):0){i[e+4>>0]=0;k[(c+4+15&-16)>>2]=5944;k[e+8>>2]=1;k[e+12>>2]=0;c=c+4+15&-16}else c=0;k[a+84>>2]=c;i[c+4>>0]=1;j=k[b+16>>2]|0;j=(j|0)>80?j:80;c=k[b>>2]|0;if(!c){i[a+12>>0]=1;k[5108]=(k[5108]|0)+1;h=iF(39)|0;do if(!h)c=0;else{f=h+4+15&-16;k[f+-4>>2]=h;if(!(h+4+15&-16)){c=0;break}c=k[b+8>>2]|0;k[(h+4+15&-16)>>2]=772;k[f+4>>2]=c;k[5108]=(k[5108]|0)+1;c=iF((c*772|3)+16|0)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}k[f+16>>2]=c;k[f+12>>2]=c;d=k[f+4>>2]|0;k[f+8>>2]=d;if(d+-1|0){g=k[(h+4+15&-16)>>2]|0;f=d+-1|0;e=c;do{l=e;e=e+g|0;k[l>>2]=e;f=f+-1|0}while((f|0)!=0);c=c+(ia(g,d+-1|0)|0)|0}k[c>>2]=0;c=h+4+15&-16}while(0);k[a+8>>2]=c}else{i[a+12>>0]=0;k[a+8>>2]=c}c=k[b+4>>2]|0;if(c){i[a+20>>0]=0;k[a+16>>2]=c;return}i[a+20>>0]=1;k[5108]=(k[5108]|0)+1;h=iF(39)|0;do if(!h)c=0;else{f=h+4+15&-16;k[f+-4>>2]=h;if(!(h+4+15&-16)){c=0;break}c=k[b+12>>2]|0;k[(h+4+15&-16)>>2]=j;k[f+4>>2]=c;c=ia(c,j)|0;k[5108]=(k[5108]|0)+1;c=iF(c+19|0)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}k[f+16>>2]=c;k[f+12>>2]=c;g=k[f+4>>2]|0;k[f+8>>2]=g;if(g+-1|0){d=k[(h+4+15&-16)>>2]|0;e=g+-1|0;f=c;do{l=f;f=f+d|0;k[l>>2]=f;e=e+-1|0}while((e|0)!=0);c=c+(ia(d,g+-1|0)|0)|0}k[c>>2]=0;c=h+4+15&-16}while(0);k[a+16>>2]=c;return}function Qr(a){a=a|0;var b=0,c=0;k[a>>2]=5816;if(i[a+20>>0]|0){b=k[a+16>>2]|0;c=k[b+16>>2]|0;if(c){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);b=k[a+16>>2]|0}if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}}if(i[a+12>>0]|0){b=k[a+8>>2]|0;c=k[b+16>>2]|0;if(c){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);b=k[a+8>>2]|0}if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}}b=k[a+32>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+32>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+36>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+36>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+40>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+40>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+44>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+44>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+48>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+48>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+52>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+52>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+56>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+56>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+60>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+60>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+76>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+76>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+80>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+80>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+72>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+72>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+88>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+88>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+84>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+84>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+24>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+28>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+28>>2]|0;if(!b)return;k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0);return}function Rr(a){a=a|0;Qr(a);jF(a);return}function Sr(a,b,c){a=a|0;b=b|0;c=c|0;do if(!((b|0)==8&(c|0)==8)){if((b|0)==8&(c|0)==1){b=a+76|0;break}if((b|0)==1&(c|0)==8){b=a+80|0;break}if(!(c|b)){b=a+72|0;break}if((b|0)<20&(c|0)==28){b=a+88|0;break}if((b|0)==28&(c|0)<20){b=a+84|0;break}if((b|0)<20){if((c|0)<20){b=a+32|0;break}if((c+-21|0)>>>0<9){b=a+36|0;break}}else{if((c|0)<20&(b+-21|0)>>>0<9){b=a+40|0;break}if((b|0)==31)if((c|0)==31){b=a+48|0;break}else{b=a+44|0;break}}if((c|0)==31){b=a+52|0;break}else{b=a+56|0;break}}else b=a+60|0;while(0);return k[b>>2]|0}function Tr(a){a=a|0;var b=0;k[a>>2]=6920;b=k[a+56>>2]|0;if(b){if(i[a+60>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+56>>2]=0}i[a+60>>0]=1;k[a+56>>2]=0;k[a+48>>2]=0;k[a+52>>2]=0;b=k[a+36>>2]|0;if(b){if(i[a+40>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+36>>2]=0}i[a+40>>0]=1;k[a+36>>2]=0;k[a+28>>2]=0;k[a+32>>2]=0;b=k[a+16>>2]|0;if(!b){b=a+12|0;i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;k[b>>2]=0;return}if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+16>>2]=0;b=a+12|0;i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;k[b>>2]=0;return}function Ur(a){a=a|0;Tr(a);jF(a);return}function Vr(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,j=0,l=0;d=k[b+8>>2]|0;if((d|0)>0){c=k[b+16>>2]|0;g=0;e=0;while(1){f=k[c+(g<<2)>>2]|0;if(!(k[f+204>>2]&3)){k[f+208>>2]=e;e=e+1|0}k[f+212>>2]=-1;o[f+244>>2]=1.0;if((g|0)==(d+-1|0)){j=e;break}else g=g+1|0}}else j=0;h=k[a+8>>2]|0;if((h|0)<(j|0)){if((k[a+12>>2]|0)<(j|0)){if(!j){d=0;c=h}else{k[5108]=(k[5108]|0)+1;c=iF((j<<3|3)+16|0)|0;if(!c)d=0;else{k[(c+4+15&-16)+-4>>2]=c;d=c+4+15&-16}c=k[a+8>>2]|0}if((c|0)>0){e=c+-1|0;g=0;while(1){c=d+(g<<3)|0;if(c){l=(k[a+16>>2]|0)+(g<<3)|0;f=k[l+4>>2]|0;k[c>>2]=k[l>>2];k[c+4>>2]=f}if((g|0)==(e|0))break;else g=g+1|0}}c=k[a+16>>2]|0;if(c){if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[a+16>>2]=0}i[a+20>>0]=1;k[a+16>>2]=d;k[a+12>>2]=j;c=a+16|0}else c=a+16|0;f=j+-1|0;d=h;while(1){e=(k[c>>2]|0)+(d<<3)|0;if(e){k[e>>2]=0;k[e+4>>2]=0}if((d|0)==(f|0))break;else d=d+1|0}}k[a+8>>2]=j;if((j|0)>0){e=k[a+16>>2]|0;c=j+-1|0;d=0;while(1){k[e+(d<<3)>>2]=d;k[e+(d<<3)+4>>2]=1;if((d|0)==(c|0))break;else d=d+1|0}}c=k[b+68>>2]|0;c=Wb[k[(k[c>>2]|0)+36>>2]&127](c)|0;b=Wb[k[(k[c>>2]|0)+36>>2]&127](c)|0;if(!b)return;j=Wb[k[(k[c>>2]|0)+20>>2]&127](c)|0;if((b|0)<=0)return;c=0;while(1){d=k[k[j+(c<<4)>>2]>>2]|0;e=k[k[j+(c<<4)+4>>2]>>2]|0;if(((d|0)!=0?((e|0)!=0?(k[d+204>>2]&7|0)==0:0):0)?(k[e+204>>2]&7|0)==0:0){f=k[d+208>>2]|0;e=k[e+208>>2]|0;h=k[a+16>>2]|0;d=k[h+(f<<3)>>2]|0;if((d|0)!=(f|0)){g=h+(f<<3)|0;do{f=h+(d<<3)|0;k[g>>2]=k[f>>2];f=k[f>>2]|0;g=h+(f<<3)|0;d=k[g>>2]|0}while((f|0)!=(d|0))}d=k[h+(e<<3)>>2]|0;if((d|0)!=(e|0)){g=h+(e<<3)|0;do{e=h+(d<<3)|0;k[g>>2]=k[e>>2];e=k[e>>2]|0;g=h+(e<<3)|0;d=k[g>>2]|0}while((e|0)!=(d|0))}if((f|0)!=(e|0)){k[h+(f<<3)>>2]=e;l=h+(e<<3)+4|0;k[l>>2]=(k[l>>2]|0)+(k[h+(f<<3)+4>>2]|0)}}if((c|0)==(b+-1|0))break;else c=c+1|0}return}function Wr(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0;j=k[b+8>>2]|0;if((j|0)<=0)return;h=k[b+16>>2]|0;i=0;b=0;while(1){g=k[h+(i<<2)>>2]|0;if(!(k[g+204>>2]&3)){f=k[a+16>>2]|0;d=f+(b<<3)|0;c=k[d>>2]|0;if((c|0)==(b|0))c=b;else{e=c;do{c=f+(e<<3)|0;k[d>>2]=k[c>>2];c=k[c>>2]|0;d=f+(c<<3)|0;e=k[d>>2]|0}while((c|0)!=(e|0))}k[g+208>>2]=c;k[f+(b<<3)+4>>2]=i;k[g+212>>2]=-1;b=b+1|0}else{k[g+208>>2]=-1;k[g+212>>2]=-2}if((i|0)==(j+-1|0))break;else i=i+1|0}return}function Xr(a){a=a|0;var b=0;k[a>>2]=7032;if(!(i[a+8>>0]|0))return;b=k[a+12>>2]|0;if(!b)return;a=k[a+4>>2]|0;Ub[k[(k[a>>2]|0)+16>>2]&127](a,b);return}function Yr(a){a=a|0;var b=0,c=0;k[a>>2]=7032;if(!(i[a+8>>0]|0)){jF(a);return}b=k[a+12>>2]|0;if(!b){jF(a);return}c=k[a+4>>2]|0;Ub[k[(k[c>>2]|0)+16>>2]&127](c,b);jF(a);return}function Zr(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0,K=0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0,Q=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0.0,Z=0,aa=0.0,ba=0.0,ca=0.0,da=0.0,ea=0.0,fa=0.0,ga=0.0;J=r;r=r+128|0;if(!(k[a+12>>2]|0)){r=J;return}h=(i[a+16>>0]|0)!=0;K=h?c:b;h=h?b:c;g=k[K+4>>2]|0;f=k[h+4>>2]|0;K=k[K+12>>2]|0;C=+o[K>>2];B=+o[K+16>>2];A=+o[K+32>>2];y=+o[K+4>>2];x=+o[K+20>>2];w=+o[K+36>>2];u=+o[K+8>>2];s=+o[K+24>>2];p=+o[K+40>>2];F=+o[K+48>>2];G=+o[K+52>>2];H=+o[K+56>>2];K=k[h+12>>2]|0;O=+o[K>>2];N=+o[K+16>>2];m=+o[K+32>>2];M=+o[K+4>>2];L=+o[K+20>>2];l=+o[K+36>>2];t=+o[K+8>>2];q=+o[K+24>>2];n=+o[K+40>>2];I=-+o[K+48>>2];E=-+o[K+52>>2];D=-+o[K+56>>2];K=k[(k[g>>2]|0)+64>>2]|0;j=-+o[f+48>>2];v=-+o[f+52>>2];z=-+o[f+56>>2];o[J>>2]=(C*O+B*N+A*m)*j+(C*M+B*L+A*l)*v+(C*t+B*q+A*n)*z;o[J+4>>2]=(y*O+x*N+w*m)*j+(y*M+x*L+w*l)*v+(y*t+x*q+w*n)*z;o[J+8>>2]=(u*O+s*N+p*m)*j+(u*M+s*L+p*l)*v+(u*t+s*q+p*n)*z;o[J+12>>2]=0.0;yc[K&127](J+112|0,g,J);z=+o[J+112>>2];v=+o[J+112+4>>2];j=+o[J+112+8>>2];m=F*O+G*N+H*m+(O*I+N*E+m*D)+((C*O+B*N+A*m)*z+(y*O+x*N+w*m)*v+(u*O+s*N+p*m)*j);l=F*M+G*L+H*l+(M*I+L*E+l*D)+((C*M+B*L+A*l)*z+(y*M+x*L+w*l)*v+(u*M+s*L+p*l)*j);j=F*t+G*q+H*n+(t*I+q*E+n*D)+((C*t+B*q+A*n)*z+(y*t+x*q+w*n)*v+(u*t+s*q+p*n)*j);n=+o[f+48>>2];p=+o[f+52>>2];q=+o[f+56>>2];s=q*j+(n*m+p*l)-+o[f+64>>2];K=k[h+12>>2]|0;t=+o[K>>2];u=+o[K+4>>2];v=+o[K+8>>2];w=+o[K+16>>2];x=+o[K+20>>2];y=+o[K+24>>2];z=+o[K+32>>2];A=+o[K+36>>2];B=+o[K+40>>2];C=+o[K+48>>2];D=+o[K+52>>2];E=+o[K+56>>2];K=k[a+12>>2]|0;d=s<+o[K+752>>2];k[e+4>>2]=K;if(d){K=k[h+12>>2]|0;N=n*+o[K+16>>2]+p*+o[K+20>>2]+q*+o[K+24>>2];O=n*+o[K+32>>2]+p*+o[K+36>>2]+q*+o[K+40>>2];o[J+48>>2]=+o[K>>2]*n+ +o[K+4>>2]*p+ +o[K+8>>2]*q;o[J+48+4>>2]=N;o[J+48+8>>2]=O;o[J+48+12>>2]=0.0;o[J+96>>2]=v*(j-q*s)+(t*(m-n*s)+u*(l-p*s))+C;o[J+96+4>>2]=(m-n*s)*w+(l-p*s)*x+(j-q*s)*y+D;o[J+96+8>>2]=(m-n*s)*z+(l-p*s)*A+(j-q*s)*B+E;o[J+96+12>>2]=0.0;xc[k[(k[e>>2]|0)+16>>2]&15](e,J+48|0,J+96|0,s)}if((k[g+4>>2]|0)<7?(k[(k[e+4>>2]|0)+748>>2]|0)<(k[a+24>>2]|0):0){j=+o[f+56>>2];if(+X(+j)>.7071067690849304){O=+o[f+52>>2];m=1.0/+Y(+(j*j+O*O));l=0.0;j=-(j*m);m=O*m}else{m=+o[f+48>>2];l=+o[f+52>>2];j=1.0/+Y(+(m*m+l*l));l=-(l*j);j=m*j;m=0.0}G=.019999999552965164/+gc[k[(k[g>>2]|0)+16>>2]&15](g);F=+Y(+(m*m+(j*j+l*l)));G=G>.39269909262657166?.19634954631328583:G*.5;F=+$(+G)/F;I=l*F;H=j*F;F=m*F;G=+_(+G);h=k[a+20>>2]|0;if((h|0)>0){g=0;do{u=+o[f+48>>2];O=+o[f+52>>2];m=+o[f+56>>2];p=+(g|0)*(6.2831854820251465/+(h|0))*.5;N=+$(+p)/+Y(+(u*u+O*O+m*m));p=+_(+p);n=F*-(O*N)+(I*p+G*-(u*N))-H*-(m*N);s=I*-(m*N)+(G*-(O*N)+H*p)-F*-(u*N);fa=H*-(u*N)+(F*p+G*-(m*N))-I*-(O*N);j=G*p-I*-(u*N)-H*-(O*N)-F*-(m*N);C=m*N*s+(u*N*j+p*n)-O*N*fa;D=u*N*fa+(p*s+O*N*j)-m*N*n;ba=O*N*n+(m*N*j+p*fa)-u*N*s;fa=p*j-u*N*n-O*N*s-m*N*fa;h=(i[a+16>>0]|0)!=0;Z=h?c:b;h=h?b:c;K=k[Z+4>>2]|0;d=k[h+4>>2]|0;Z=k[Z+12>>2]|0;N=+o[Z>>2];m=+o[Z+4>>2];s=+o[Z+8>>2];O=+o[Z+16>>2];n=+o[Z+20>>2];u=+o[Z+24>>2];j=+o[Z+32>>2];p=+o[Z+36>>2];w=+o[Z+40>>2];S=+o[Z+48>>2];R=+o[Z+52>>2];Q=+o[Z+56>>2];Z=k[h+12>>2]|0;W=+o[Z>>2];V=+o[Z+16>>2];A=+o[Z+32>>2];U=+o[Z+4>>2];T=+o[Z+20>>2];z=+o[Z+36>>2];t=+o[Z+8>>2];v=+o[Z+24>>2];x=+o[Z+40>>2];P=-+o[Z+48>>2];L=-+o[Z+52>>2];M=-+o[Z+56>>2];l=C*(2.0/(C*C+D*D+ba*ba+fa*fa));E=D*(2.0/(C*C+D*D+ba*ba+fa*fa));ga=ba*(2.0/(C*C+D*D+ba*ba+fa*fa));da=s*(C*ga-fa*E)+(m*(C*E+fa*ga)+N*(1.0-(D*E+ba*ga)));aa=s*(D*ga+fa*l)+(N*(C*E-fa*ga)+m*(1.0-(C*l+ba*ga)));y=N*(C*ga+fa*E)+m*(D*ga-fa*l)+s*(1.0-(C*l+D*E));ca=u*(C*ga-fa*E)+(n*(C*E+fa*ga)+O*(1.0-(D*E+ba*ga)));B=u*(D*ga+fa*l)+(O*(C*E-fa*ga)+n*(1.0-(C*l+ba*ga)));q=O*(C*ga+fa*E)+n*(D*ga-fa*l)+u*(1.0-(C*l+D*E));ea=w*(C*ga-fa*E)+(p*(C*E+fa*ga)+j*(1.0-(D*E+ba*ga)));ba=w*(D*ga+fa*l)+(j*(C*E-fa*ga)+p*(1.0-(C*l+ba*ga)));E=j*(C*ga+fa*E)+p*(D*ga-fa*l)+w*(1.0-(C*l+D*E));Z=k[(k[K>>2]|0)+64>>2]|0;D=-+o[d+48>>2];l=-+o[d+52>>2];C=-+o[d+56>>2];o[J+64>>2]=(x*ea+(t*da+v*ca))*C+((A*ea+(W*da+V*ca))*D+(z*ea+(U*da+T*ca))*l);o[J+64+4>>2]=(x*ba+(t*aa+v*B))*C+((A*ba+(W*aa+V*B))*D+(z*ba+(U*aa+T*B))*l);o[J+64+8>>2]=(x*E+(t*y+v*q))*C+((A*E+(W*y+V*q))*D+(z*E+(U*y+T*q))*l);o[J+64+12>>2]=0.0;yc[Z&127](J+16|0,K,J+64|0);l=+o[J+16>>2];q=+o[J+16+4>>2];y=+o[J+16+8>>2];E=+o[d+48>>2];D=+o[d+52>>2];C=+o[d+56>>2];B=C*(S*t+R*v+Q*x+(t*P+v*L+x*M)+((N*t+O*v+j*x)*l+(m*t+n*v+p*x)*q+(s*t+u*v+w*x)*y))+(E*(S*W+R*V+Q*A+(W*P+V*L+A*M)+((N*W+O*V+j*A)*l+(m*W+n*V+p*A)*q+(s*W+u*V+w*A)*y))+D*(S*U+R*T+Q*z+(U*P+T*L+z*M)+((N*U+O*T+j*z)*l+(m*U+n*T+p*z)*q+(s*U+u*T+w*z)*y)))-+o[d+64>>2];A=S*W+R*V+Q*A+(W*P+V*L+A*M)+((N*W+O*V+j*A)*l+(m*W+n*V+p*A)*q+(s*W+u*V+w*A)*y)-E*B;z=S*U+R*T+Q*z+(U*P+T*L+z*M)+((N*U+O*T+j*z)*l+(m*U+n*T+p*z)*q+(s*U+u*T+w*z)*y)-D*B;y=S*t+R*v+Q*x+(t*P+v*L+x*M)+((N*t+O*v+j*x)*l+(m*t+n*v+p*x)*q+(s*t+u*v+w*x)*y)-C*B;d=k[h+12>>2]|0;x=+o[d>>2];w=+o[d+4>>2];v=+o[d+8>>2];u=+o[d+16>>2];t=+o[d+20>>2];s=+o[d+24>>2];q=+o[d+32>>2];p=+o[d+36>>2];n=+o[d+40>>2];m=+o[d+48>>2];l=+o[d+52>>2];j=+o[d+56>>2];d=k[a+12>>2]|0;K=B<+o[d+752>>2];k[e+4>>2]=d;if(K){K=k[h+12>>2]|0;da=E*+o[K+16>>2]+D*+o[K+20>>2]+C*+o[K+24>>2];ea=E*+o[K+32>>2]+D*+o[K+36>>2]+C*+o[K+40>>2];o[J+32>>2]=+o[K>>2]*E+ +o[K+4>>2]*D+ +o[K+8>>2]*C;o[J+32+4>>2]=da;o[J+32+8>>2]=ea;o[J+32+12>>2]=0.0;o[J+80>>2]=v*y+(x*A+w*z)+m;o[J+80+4>>2]=A*u+z*t+y*s+l;o[J+80+8>>2]=A*q+z*p+y*n+j;o[J+80+12>>2]=0.0;xc[k[(k[e>>2]|0)+16>>2]&15](e,J+32|0,J+80|0,B)}g=g+1|0;h=k[a+20>>2]|0}while((g|0)<(h|0))}}if(!(i[a+8>>0]|0)){r=J;return}if(!(k[(k[a+12>>2]|0)+748>>2]|0)){r=J;return}f=k[e+4>>2]|0;if(!(k[f+748>>2]|0)){r=J;return}g=k[f+740>>2]|0;h=k[(k[e+8>>2]|0)+8>>2]|0;d=k[(k[e+12>>2]|0)+8>>2]|0;if((g|0)==(h|0)){rr(f,g+4|0,d+4|0);r=J;return}else{rr(f,d+4|0,h+4|0);r=J;return}}function _r(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;return 1.0}function $r(a){a=a|0;var b=0;k[a>>2]=7152;k[a+12>>2]=7184;b=k[a+60>>2]|0;Ub[k[(k[b>>2]|0)+20>>2]&127](b,k[a+76>>2]|0);b=k[a+60>>2]|0;Ub[k[(k[b>>2]|0)+16>>2]&127](b,k[a+76>>2]|0);return}function as(a){a=a|0;var b=0;k[a>>2]=7152;k[a+12>>2]=7184;b=k[a+60>>2]|0;Ub[k[(k[b>>2]|0)+20>>2]&127](b,k[a+76>>2]|0);b=k[a+60>>2]|0;Ub[k[(k[b>>2]|0)+16>>2]&127](b,k[a+76>>2]|0);jF(a);return}function bs(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0;if(!(k[a+76>>2]|0))return;d=k[b+4>>2]|0;if((d|0)==(k[b+8>>2]|0)?(h=(d|0)==0?1:d<<1,(d|0)<(h|0)):0){if(!h)g=0;else{k[5108]=(k[5108]|0)+1;c=iF((h<<2|3)+16|0)|0;if(!c)d=0;else{k[(c+4+15&-16)+-4>>2]=c;d=c+4+15&-16}g=d;d=k[b+4>>2]|0}if((d|0)>0){c=d+-1|0;f=0;while(1){e=g+(f<<2)|0;if(e)k[e>>2]=k[(k[b+12>>2]|0)+(f<<2)>>2];if((f|0)==(c|0))break;else f=f+1|0}}c=k[b+12>>2]|0;if(c){if(i[b+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);d=k[b+4>>2]|0}k[b+12>>2]=0}i[b+16>>0]=1;k[b+12>>2]=g;k[b+8>>2]=h}c=(k[b+12>>2]|0)+(d<<2)|0;if(c)k[c>>2]=k[a+76>>2];k[b+4>>2]=d+1;return}function cs(a){a=a|0;var b=0;k[a>>2]=7184;b=k[a+48>>2]|0;Ub[k[(k[b>>2]|0)+20>>2]&127](b,k[a+64>>2]|0);b=k[a+48>>2]|0;Ub[k[(k[b>>2]|0)+16>>2]&127](b,k[a+64>>2]|0);return}function ds(a){a=a|0;var b=0;k[a>>2]=7184;b=k[a+48>>2]|0;Ub[k[(k[b>>2]|0)+20>>2]&127](b,k[a+64>>2]|0);b=k[a+48>>2]|0;Ub[k[(k[b>>2]|0)+16>>2]&127](b,k[a+64>>2]|0);jF(a);return}function es(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0.0,h=0.0,i=0.0,j=0,l=0,m=0,n=0.0,p=0;m=r;r=r+128|0;g=+o[b>>2];h=+o[b+16>>2];n=g<h?g:h;i=+o[b+32>>2];if((n<i?n:i)>+o[a+28>>2]){r=m;return}j=g>h?b:b+16|0;if(+o[(+o[j>>2]>i?j:b+32|0)>>2]<+o[a+12>>2]){r=m;return}h=+o[b+8>>2];g=+o[b+24>>2];n=h<g?h:g;i=+o[b+40>>2];if((n<i?n:i)>+o[a+36>>2]){r=m;return}j=h>g?b+8|0:b+24|0;if(+o[(+o[j>>2]>i?j:b+40|0)>>2]<+o[a+20>>2]){r=m;return}i=+o[b+4>>2];h=+o[b+20>>2];n=i<h?i:h;g=+o[b+36>>2];if((n<g?n:g)>+o[a+32>>2]){r=m;return}j=i>h?b+4|0:b+20|0;if(+o[(+o[j>>2]>g?j:b+36|0)>>2]<+o[a+16>>2]){r=m;return}j=k[a+48>>2]|0;f=k[a+4>>2]|0;if((k[(k[f+4>>2]|0)+4>>2]|0)>=20){r=m;return}k[m+24+8>>2]=0;o[m+24+12>>2]=1.0;o[m+24+16>>2]=1.0;o[m+24+20>>2]=1.0;o[m+24+24>>2]=0.0;k[m+24+52>>2]=0;k[m+24>>2]=7584;k[m+24+4>>2]=1;k[m+24+56>>2]=k[b>>2];k[m+24+56+4>>2]=k[b+4>>2];k[m+24+56+8>>2]=k[b+8>>2];k[m+24+56+12>>2]=k[b+12>>2];k[m+24+72>>2]=k[b+16>>2];k[m+24+72+4>>2]=k[b+16+4>>2];k[m+24+72+8>>2]=k[b+16+8>>2];k[m+24+72+12>>2]=k[b+16+12>>2];k[m+24+88>>2]=k[b+32>>2];k[m+24+88+4>>2]=k[b+32+4>>2];k[m+24+88+8>>2]=k[b+32+8>>2];k[m+24+88+12>>2]=k[b+32+12>>2];o[m+24+44>>2]=+o[a+56>>2];p=k[a+8>>2]|0;e=k[p+8>>2]|0;b=k[p+12>>2]|0;k[m>>2]=p;k[m+4>>2]=m+24;k[m+8>>2]=e;k[m+12>>2]=b;k[m+16>>2]=c;k[m+20>>2]=d;b=_b[k[(k[j>>2]|0)+8>>2]&31](j,f,m,k[a+64>>2]|0)|0;e=k[a+44>>2]|0;f=k[e+8>>2]|0;if((k[f+8>>2]|0)==(k[(k[a+8>>2]|0)+8>>2]|0)){k[e+8>>2]=m;yc[k[(k[e>>2]|0)+8>>2]&127](e,c,d)}else{f=k[e+12>>2]|0;k[e+12>>2]=m;yc[k[(k[e>>2]|0)+12>>2]&127](e,c,d)}Qb[k[(k[b>>2]|0)+8>>2]&31](b,k[a+4>>2]|0,m,k[a+52>>2]|0,k[a+44>>2]|0);e=k[a+44>>2]|0;if((k[(k[e+8>>2]|0)+8>>2]|0)==(k[(k[a+8>>2]|0)+8>>2]|0))k[e+8>>2]=f;else k[e+12>>2]=f;Sb[k[k[b>>2]>>2]&255](b);Ub[k[(k[j>>2]|0)+60>>2]&127](j,b);k[m+24>>2]=13336;e=k[m+24+52>>2]|0;if((e|0)!=0?(Sb[k[k[e>>2]>>2]&255](e),l=k[m+24+52>>2]|0,(l|0)!=0):0){k[5110]=(k[5110]|0)+1;jF(k[l+-4>>2]|0)}r=m;return}function fs(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0;g=r;r=r+64|0;h=(i[a+8>>0]|0)!=0;f=h?c:b;b=h?b:c;c=k[b+4>>2]|0;if(((k[c+4>>2]|0)+-21|0)>>>0>=9){r=g;return}if((k[(k[f+4>>2]|0)+4>>2]|0)>=20){r=g;return}j=+gc[k[(k[c>>2]|0)+48>>2]&15](c);k[e+4>>2]=k[a+76>>2];k[a+16>>2]=f;k[a+20>>2]=b;k[a+64>>2]=d;o[a+68>>2]=j;k[a+56>>2]=e;h=k[b+12>>2]|0;B=+o[h>>2];A=+o[h+16>>2];z=+o[h+32>>2];y=+o[h+4>>2];x=+o[h+20>>2];w=+o[h+36>>2];s=+o[h+8>>2];p=+o[h+24>>2];m=+o[h+40>>2];v=-+o[h+48>>2];u=-+o[h+52>>2];t=-+o[h+56>>2];h=k[f+12>>2]|0;K=+o[h>>2];J=+o[h+16>>2];I=+o[h+32>>2];H=+o[h+4>>2];G=+o[h+20>>2];F=+o[h+36>>2];E=+o[h+8>>2];D=+o[h+24>>2];C=+o[h+40>>2];q=+o[h+48>>2];n=+o[h+52>>2];l=+o[h+56>>2];o[g>>2]=B*K+A*J+z*I;o[g+4>>2]=B*H+A*G+z*F;o[g+8>>2]=B*E+A*D+z*C;o[g+12>>2]=0.0;o[g+16>>2]=y*K+x*J+w*I;o[g+20>>2]=y*H+x*G+w*F;o[g+24>>2]=y*E+x*D+w*C;o[g+28>>2]=0.0;o[g+32>>2]=s*K+p*J+m*I;o[g+36>>2]=s*H+p*G+m*F;o[g+40>>2]=s*E+p*D+m*C;o[g+44>>2]=0.0;o[g+48>>2]=B*v+A*u+z*t+(B*q+A*n+z*l);o[g+52>>2]=y*v+x*u+w*t+(y*q+x*n+w*l);o[g+56>>2]=s*v+p*u+m*t+(s*q+p*n+m*l);o[g+60>>2]=0.0;h=k[(k[a+16>>2]|0)+4>>2]|0;Cc[k[(k[h>>2]|0)+8>>2]&127](h,g,a+24|0,a+40|0);o[a+40>>2]=+o[a+40>>2]+j;o[a+44>>2]=+o[a+44>>2]+j;o[a+48>>2]=+o[a+48>>2]+j;o[a+24>>2]=+o[a+24>>2]-j;o[a+28>>2]=+o[a+28>>2]-j;o[a+32>>2]=+o[a+32>>2]-j;h=k[a+76>>2]|0;b=k[b+8>>2]|0;k[h+740>>2]=k[f+8>>2];k[h+744>>2]=b;Cc[k[(k[c>>2]|0)+64>>2]&127](c,a+12|0,a+24|0,a+40|0);f=k[e+4>>2]|0;do if(k[f+748>>2]|0){c=k[f+740>>2]|0;b=k[(k[e+8>>2]|0)+8>>2]|0;d=k[(k[e+12>>2]|0)+8>>2]|0;if((c|0)==(b|0)){rr(f,c+4|0,d+4|0);break}else{rr(f,d+4|0,b+4|0);break}}while(0);k[a+16>>2]=0;k[a+20>>2]=0;r=g;return}function gs(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0.0,g=0.0,h=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0,Q=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0.0,X=0.0;e=r;r=r+240|0;d=(i[a+8>>0]|0)!=0;a=d?c:b;c=d?b:c;S=+o[a+116>>2]-+o[a+52>>2];T=+o[a+120>>2]-+o[a+56>>2];U=+o[a+124>>2]-+o[a+60>>2];V=+o[a+252>>2];if(S*S+T*T+U*U<V*V){W=1.0;r=e;return +W}F=+o[c+4>>2];G=+o[c+20>>2];H=+o[c+36>>2];I=+o[c+8>>2];J=+o[c+24>>2];K=+o[c+40>>2];L=+o[c+12>>2];M=+o[c+28>>2];N=+o[c+44>>2];g=-+o[c+52>>2];h=-+o[c+56>>2];j=-+o[c+60>>2];O=+o[a+4>>2];P=+o[a+20>>2];Q=+o[a+36>>2];R=+o[a+8>>2];S=+o[a+24>>2];T=+o[a+40>>2];U=+o[a+12>>2];V=+o[a+28>>2];n=+o[a+44>>2];u=+o[a+52>>2];t=+o[a+56>>2];s=+o[a+60>>2];p=F*g+G*h+H*j+(F*u+G*t+H*s);q=I*g+J*h+K*j+(I*u+J*t+K*s);s=L*g+M*h+N*j+(L*u+M*t+N*s);t=+o[a+68>>2];u=+o[a+84>>2];v=+o[a+100>>2];w=+o[a+72>>2];x=+o[a+88>>2];y=+o[a+104>>2];z=+o[a+76>>2];A=+o[a+92>>2];B=+o[a+108>>2];l=+o[a+116>>2];m=+o[a+120>>2];E=+o[a+124>>2];C=F*g+G*h+H*j+(F*l+G*m+H*E);D=I*g+J*h+K*j+(I*l+J*m+K*E);E=L*g+M*h+N*j+(L*l+M*m+N*E);c=k[c+192>>2]|0;if(((k[c+4>>2]|0)+-21|0)>>>0>=9){W=1.0;r=e;return +W}o[e+224>>2]=p;o[e+224+4>>2]=q;o[e+224+8>>2]=s;o[e+224+12>>2]=0.0;if(C<p){o[e+224>>2]=C;f=C}else f=p;if(D<q){o[e+224+4>>2]=D;g=D}else g=q;if(E<s){o[e+224+8>>2]=E;h=E}else h=s;o[e+208>>2]=p;o[e+208+4>>2]=q;o[e+208+8>>2]=s;o[e+208+12>>2]=0.0;if(p<C){o[e+208>>2]=C;j=C}else j=p;if(q<D){o[e+208+4>>2]=D;l=D}else l=q;if(s<E){o[e+208+8>>2]=E;m=E}else m=s;X=+o[a+248>>2];o[e+224>>2]=f-X;o[e+224+4>>2]=g-X;o[e+224+8>>2]=h-X;o[e+208>>2]=X+j;o[e+208+4>>2]=X+l;o[e+208+8>>2]=X+m;k[e>>2]=7312;o[e+4>>2]=F*O+G*P+H*Q;o[e+8>>2]=F*R+G*S+H*T;o[e+12>>2]=F*U+G*V+H*n;o[e+16>>2]=0.0;o[e+20>>2]=I*O+J*P+K*Q;o[e+24>>2]=I*R+J*S+K*T;o[e+28>>2]=I*U+J*V+K*n;o[e+32>>2]=0.0;o[e+36>>2]=L*O+M*P+N*Q;o[e+40>>2]=L*R+M*S+N*T;o[e+44>>2]=L*U+M*V+N*n;o[e+48>>2]=0.0;o[e+52>>2]=p;o[e+56>>2]=q;o[e+60>>2]=s;o[e+64>>2]=0.0;o[e+68>>2]=F*t+G*u+H*v;o[e+72>>2]=F*w+G*x+H*y;o[e+76>>2]=F*z+G*A+H*B;o[e+80>>2]=0.0;o[e+84>>2]=I*t+J*u+K*v;o[e+88>>2]=I*w+J*x+K*y;o[e+92>>2]=I*z+J*A+K*B;o[e+96>>2]=0.0;o[e+100>>2]=L*t+M*u+N*v;o[e+104>>2]=L*w+M*x+N*y;o[e+108>>2]=L*z+M*A+N*B;o[e+112>>2]=0.0;o[e+116>>2]=C;o[e+120>>2]=D;o[e+124>>2]=E;o[e+128>>2]=0.0;o[e+196>>2]=X;o[e+200>>2]=+o[a+244>>2];if((c|0)!=0?(Cc[k[(k[c>>2]|0)+64>>2]&127](c,e,e+224|0,e+208|0),W=+o[e+200>>2],W<+o[a+244>>2]):0){o[a+244>>2]=W;X=W;r=e;return +X}X=1.0;r=e;return +X}function hs(a){a=a|0;var b=0;k[a>>2]=7808;if(!(i[a+8>>0]|0))return;b=k[a+12>>2]|0;if(!b)return;a=k[a+4>>2]|0;Ub[k[(k[a>>2]|0)+16>>2]&127](a,b);return}function is(a){a=a|0;var b=0,c=0;k[a>>2]=7808;if(!(i[a+8>>0]|0)){jF(a);return}b=k[a+12>>2]|0;if(!b){jF(a);return}c=k[a+4>>2]|0;Ub[k[(k[c>>2]|0)+16>>2]&127](c,b);jF(a);return}function js(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,l=0;h=r;r=r+144|0;f=k[a+12>>2]|0;if(!f){r=h;return}l=k[b+4>>2]|0;j=k[c+4>>2]|0;k[e+4>>2]=f;o[h+12+128>>2]=999999984306749440.0;f=k[b+12>>2]|0;k[h+12>>2]=k[f>>2];k[h+12+4>>2]=k[f+4>>2];k[h+12+8>>2]=k[f+8>>2];k[h+12+12>>2]=k[f+12>>2];k[h+12+16>>2]=k[f+16>>2];k[h+12+16+4>>2]=k[f+16+4>>2];k[h+12+16+8>>2]=k[f+16+8>>2];k[h+12+16+12>>2]=k[f+16+12>>2];k[h+12+32>>2]=k[f+32>>2];k[h+12+32+4>>2]=k[f+32+4>>2];k[h+12+32+8>>2]=k[f+32+8>>2];k[h+12+32+12>>2]=k[f+32+12>>2];k[h+12+48>>2]=k[f+48>>2];k[h+12+48+4>>2]=k[f+48+4>>2];k[h+12+48+8>>2]=k[f+48+8>>2];k[h+12+48+12>>2]=k[f+48+12>>2];f=k[c+12>>2]|0;k[h+12+64>>2]=k[f>>2];k[h+12+64+4>>2]=k[f+4>>2];k[h+12+64+8>>2]=k[f+8>>2];k[h+12+64+12>>2]=k[f+12>>2];k[h+12+80>>2]=k[f+16>>2];k[h+12+80+4>>2]=k[f+16+4>>2];k[h+12+80+8>>2]=k[f+16+8>>2];k[h+12+80+12>>2]=k[f+16+12>>2];k[h+12+96>>2]=k[f+32>>2];k[h+12+96+4>>2]=k[f+32+4>>2];k[h+12+96+8>>2]=k[f+32+8>>2];k[h+12+96+12>>2]=k[f+32+12>>2];k[h+12+112>>2]=k[f+48>>2];k[h+12+112+4>>2]=k[f+48+4>>2];k[h+12+112+8>>2]=k[f+48+8>>2];k[h+12+112+12>>2]=k[f+48+12>>2];k[h>>2]=19760;k[h+4>>2]=l;k[h+8>>2]=j;hw(h,h+12|0,e,k[d+20>>2]|0,0);do if((i[a+8>>0]|0)!=0?(g=k[e+4>>2]|0,(k[g+748>>2]|0)!=0):0){b=k[g+740>>2]|0;f=k[(k[e+8>>2]|0)+8>>2]|0;c=k[(k[e+12>>2]|0)+8>>2]|0;if((b|0)==(f|0)){rr(g,b+4|0,c+4|0);break}else{rr(g,c+4|0,f+4|0);break}}while(0);r=h;return}function ks(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;return 1.0}function ls(a,b,c,d){a=a|0;b=b|0;c=c|0;d=+d;var e=0.0,f=0.0,g=0.0,h=0,j=0.0,l=0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0,w=0,x=0,y=0,z=0,A=0,B=0.0,C=0.0;A=r;r=r+192|0;x=k[a+4>>2]|0;if(+o[x+752>>2]<d){r=A;return}z=k[x+740>>2]|0;w=(k[a+8>>2]|0)+8|0;y=k[w>>2]|0;e=+o[c>>2];n=+o[b>>2]*d+e;g=+o[c+4>>2];p=+o[b+4>>2]*d+g;f=+o[c+8>>2];q=+o[b+8>>2]*d+f;v=(k[a+12>>2]|0)+8|0;l=k[v>>2]|0;m=+o[l+52>>2];if((z|0)!=(y|0)){j=p-+o[l+56>>2];u=q-+o[l+60>>2];B=e-+o[y+52>>2];e=g-+o[y+56>>2];g=f-+o[y+60>>2];s=(n-m)*+o[l+4>>2]+j*+o[l+20>>2]+u*+o[l+36>>2];t=(n-m)*+o[l+8>>2]+j*+o[l+24>>2]+u*+o[l+40>>2];u=(n-m)*+o[l+12>>2]+j*+o[l+28>>2]+u*+o[l+44>>2];f=B*+o[y+4>>2]+e*+o[y+20>>2]+g*+o[y+36>>2];j=B*+o[y+8>>2]+e*+o[y+24>>2]+g*+o[y+40>>2];g=B*+o[y+12>>2]+e*+o[y+28>>2]+g*+o[y+44>>2]}else{C=n-+o[z+52>>2];j=p-+o[z+56>>2];u=q-+o[z+60>>2];B=g-+o[l+56>>2];g=f-+o[l+60>>2];s=C*+o[z+4>>2]+j*+o[z+20>>2]+u*+o[z+36>>2];t=C*+o[z+8>>2]+j*+o[z+24>>2]+u*+o[z+40>>2];u=C*+o[z+12>>2]+j*+o[z+28>>2]+u*+o[z+44>>2];f=(e-m)*+o[l+4>>2]+B*+o[l+20>>2]+g*+o[l+36>>2];j=(e-m)*+o[l+8>>2]+B*+o[l+24>>2]+g*+o[l+40>>2];g=(e-m)*+o[l+12>>2]+B*+o[l+28>>2]+g*+o[l+44>>2]}o[A>>2]=s;o[A+4>>2]=t;o[A+8>>2]=u;o[A+12>>2]=0.0;o[A+16>>2]=f;o[A+20>>2]=j;o[A+24>>2]=g;o[A+28>>2]=0.0;k[A+64>>2]=k[b>>2];k[A+64+4>>2]=k[b+4>>2];k[A+64+8>>2]=k[b+8>>2];k[A+64+12>>2]=k[b+12>>2];o[A+80>>2]=d;o[A+84>>2]=0.0;o[A+88>>2]=0.0;o[A+92>>2]=0.0;k[A+112>>2]=0;i[A+116>>0]=0;k[A+120>>2]=0;k[A+120+4>>2]=0;k[A+120+8>>2]=0;k[A+120+12>>2]=0;k[A+120+16>>2]=0;k[A+120+20>>2]=0;k[A+120+24>>2]=0;k[A+120+28>>2]=0;o[A+48>>2]=n;o[A+52>>2]=p;o[A+56>>2]=q;o[A+60>>2]=0.0;k[A+32>>2]=k[c>>2];k[A+32+4>>2]=k[c+4>>2];k[A+32+8>>2]=k[c+8>>2];k[A+32+12>>2]=k[c+12>>2];g=+o[x+752>>2];b=k[x+748>>2]|0;if((b|0)>0){l=0;h=-1;j=g*g;while(1){g=+o[x+4+(l*184|0)>>2]-s;f=+o[x+4+(l*184|0)+4>>2]-t;e=+o[x+4+(l*184|0)+8>>2]-u;c=g*g+f*f+e*e<j;h=c?l:h;if((l|0)==(b+-1|0))break;else{l=l+1|0;j=c?g*g+f*f+e*e:j}}}else h=-1;w=k[w>>2]|0;l=k[v>>2]|0;e=+o[w+224>>2]*+o[l+224>>2];e=e<-10.0?-10.0:e;o[A+84>>2]=e>10.0?10.0:e;o[A+92>>2]=+o[w+228>>2]*+o[l+228>>2];e=+o[w+232>>2]*+o[l+232>>2];e=e<-10.0?-10.0:e;o[A+88>>2]=e>10.0?10.0:e;e=+o[A+72>>2];l=+X(+e)>.7071067690849304;f=+o[A+68>>2];if(l){u=1.0/+Y(+(e*e+f*f));o[A+152>>2]=0.0;o[A+156>>2]=-(u*e);o[A+160>>2]=u*f;o[A+168>>2]=(e*e+f*f)*u;t=+o[A+64>>2];g=-(t*(u*f));e=t*-(u*e)}else{t=+o[A+64>>2];u=1.0/+Y(+(t*t+f*f));o[A+152>>2]=-(f*u);o[A+156>>2]=u*t;o[A+160>>2]=0.0;o[A+168>>2]=-(e*(u*t));g=e*-(f*u);e=(t*t+f*f)*u}o[A+172>>2]=g;o[A+176>>2]=e;v=k[a+20>>2]|0;w=k[a+16>>2]|0;l=k[a+28>>2]|0;a=k[a+24>>2]|0;k[A+96>>2]=(z|0)!=(y|0)?v:w;k[A+100>>2]=(z|0)!=(y|0)?w:v;k[A+104>>2]=(z|0)!=(y|0)?l:a;k[A+108>>2]=(z|0)!=(y|0)?a:l;if((h|0)>-1){a=x+4+(h*184|0)+148|0;z=k[a>>2]|0;v=x+4+(h*184|0)+120|0;p=+o[v>>2];l=x+4+(h*184|0)+124|0;t=+o[l>>2];y=x+4+(h*184|0)+128|0;u=+o[y>>2];w=x+4+(h*184|0)+112|0;b=k[w>>2]|0;qF(x+4+(h*184|0)|0,A|0,184)|0;k[w>>2]=b;o[v>>2]=p;o[l>>2]=t;o[y>>2]=u;k[a>>2]=z}else qr(x,A)|0;r=A;return}function ms(a){a=a|0;var b=0,c=0,d=0,e=0,f=0;k[a>>2]=8016;c=k[a+8>>2]|0;b=k[a+16>>2]|0;if((c|0)>0){f=0;do{d=(k[b+(f<<2)>>2]|0)+188|0;e=k[d>>2]|0;if(e){c=k[a+68>>2]|0;c=Wb[k[(k[c>>2]|0)+36>>2]&127](c)|0;yc[k[(k[c>>2]|0)+40>>2]&127](c,e,k[a+24>>2]|0);c=k[a+68>>2]|0;yc[k[(k[c>>2]|0)+12>>2]&127](c,e,k[a+24>>2]|0);k[d>>2]=0;c=k[a+8>>2]|0;b=k[a+16>>2]|0}f=f+1|0}while((f|0)<(c|0))}if(!b){i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;a=a+12|0;k[a>>2]=0;return}if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+16>>2]=0;i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;a=a+12|0;k[a>>2]=0;return}function ns(a){a=a|0;ms(a);jF(a);return}function os(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,l=0,m=0;m=r;r=r+96|0;f=k[a+8>>2]|0;if((f|0)==(k[a+12>>2]|0)?(l=(f|0)==0?1:f<<1,(f|0)<(l|0)):0){if(!l)j=0;else{k[5108]=(k[5108]|0)+1;e=iF((l<<2|3)+16|0)|0;if(!e)f=0;else{k[(e+4+15&-16)+-4>>2]=e;f=e+4+15&-16}j=f;f=k[a+8>>2]|0}if((f|0)>0){e=f+-1|0;h=0;while(1){g=j+(h<<2)|0;if(g)k[g>>2]=k[(k[a+16>>2]|0)+(h<<2)>>2];if((h|0)==(e|0))break;else h=h+1|0}}e=k[a+16>>2]|0;if(e){if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0);f=k[a+8>>2]|0}k[a+16>>2]=0}i[a+20>>0]=1;k[a+16>>2]=j;k[a+12>>2]=l}e=(k[a+16>>2]|0)+(f<<2)|0;if(e)k[e>>2]=b;k[a+8>>2]=f+1;k[m+32>>2]=k[b+4>>2];k[m+32+4>>2]=k[b+4+4>>2];k[m+32+8>>2]=k[b+4+8>>2];k[m+32+12>>2]=k[b+4+12>>2];k[m+32+16>>2]=k[b+20>>2];k[m+32+16+4>>2]=k[b+20+4>>2];k[m+32+16+8>>2]=k[b+20+8>>2];k[m+32+16+12>>2]=k[b+20+12>>2];k[m+32+32>>2]=k[b+36>>2];k[m+32+32+4>>2]=k[b+36+4>>2];k[m+32+32+8>>2]=k[b+36+8>>2];k[m+32+32+12>>2]=k[b+36+12>>2];k[m+32+48>>2]=k[b+52>>2];k[m+32+48+4>>2]=k[b+52+4>>2];k[m+32+48+8>>2]=k[b+52+8>>2];k[m+32+48+12>>2]=k[b+52+12>>2];l=k[b+192>>2]|0;Cc[k[(k[l>>2]|0)+8>>2]&127](l,m+32|0,m+16|0,m);l=k[a+68>>2]|0;a=wc[k[(k[l>>2]|0)+8>>2]&3](l,m+16|0,m,k[(k[b+192>>2]|0)+4>>2]|0,b,c,d,k[a+24>>2]|0,0)|0;k[b+188>>2]=a;r=m;return}function ps(a){a=a|0;var b=0,c=0.0,d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,j=0.0,l=0.0,m=0.0,n=0,p=0,q=0,s=0,t=0;s=r;r=r+64|0;Cw(8296);b=k[a+8>>2]|0;if((b|0)>0){p=0;do{n=k[(k[a+16>>2]|0)+(p<<2)>>2]|0;if(!((i[a+76>>0]|0)==0?(t=k[n+216>>2]|0,(t|0)==2|(t|0)==5):0)){t=k[n+192>>2]|0;Cc[k[(k[t>>2]|0)+8>>2]&127](t,n+4|0,s+48|0,s+32|0);e=+o[s+48>>2]+-.019999999552965164;o[s+48>>2]=e;c=+o[s+48+4>>2]+-.019999999552965164;o[s+48+4>>2]=c;f=+o[s+48+8>>2]+-.019999999552965164;o[s+48+8>>2]=f;g=+o[s+32>>2]+.019999999552965164;o[s+32>>2]=g;h=+o[s+32+4>>2]+.019999999552965164;o[s+32+4>>2]=h;d=+o[s+32+8>>2]+.019999999552965164;o[s+32+8>>2]=d;if(((i[a+44>>0]|0)!=0?(k[n+236>>2]|0)==2:0)?(k[n+204>>2]&3|0)==0:0){t=k[n+192>>2]|0;Cc[k[(k[t>>2]|0)+8>>2]&127](t,n+68|0,s+16|0,s);c=+o[s+16>>2]+-.019999999552965164;o[s+16>>2]=c;j=+o[s+16+4>>2]+-.019999999552965164;o[s+16+4>>2]=j;h=+o[s+16+8>>2]+-.019999999552965164;o[s+16+8>>2]=h;l=+o[s>>2]+.019999999552965164;o[s>>2]=l;m=+o[s+4>>2]+.019999999552965164;o[s+4>>2]=m;d=+o[s+8>>2]+.019999999552965164;o[s+8>>2]=d;e=+o[s+48>>2];if(c<e){o[s+48>>2]=c;e=c}c=+o[s+48+4>>2];if(j<c){o[s+48+4>>2]=j;c=j}f=+o[s+48+8>>2];if(h<f){o[s+48+8>>2]=h;f=h}g=+o[s+16+12>>2];if(g<+o[s+48+12>>2])o[s+48+12>>2]=g;g=+o[s+32>>2];if(g<l){o[s+32>>2]=l;g=l}h=+o[s+32+4>>2];if(h<m){o[s+32+4>>2]=m;h=m}j=+o[s+32+8>>2];if(j<d)o[s+32+8>>2]=d;else d=j;j=+o[s+12>>2];if(+o[s+32+12>>2]<j)o[s+32+12>>2]=j}b=k[a+68>>2]|0;if((k[n+204>>2]&1|0)==0?(j=g-e,l=h-c,m=d-f,!(j*j+l*l+m*m<999999995904.0)):0){if((k[n+216>>2]&-2|0)!=4)k[n+216>>2]=5;if((i[8072]|0)!=0?(q=k[a+72>>2]|0,(q|0)!=0):0){i[8072]=0;Ub[k[(k[q>>2]|0)+36>>2]&127](q,8080);t=k[a+72>>2]|0;Ub[k[(k[t>>2]|0)+36>>2]&127](t,8136);t=k[a+72>>2]|0;Ub[k[(k[t>>2]|0)+36>>2]&127](t,8208);t=k[a+72>>2]|0;Ub[k[(k[t>>2]|0)+36>>2]&127](t,8280)}}else Qb[k[(k[b>>2]|0)+16>>2]&31](b,k[n+188>>2]|0,s+48|0,s+32|0,k[a+24>>2]|0);b=k[a+8>>2]|0}p=p+1|0}while((p|0)<(b|0))}b=k[5104]|0;t=(k[b+16>>2]|0)+-1|0;k[b+16>>2]=t;if(t){r=s;return}do if(k[b+4>>2]|0){Kb(s+48|0,0)|0;t=k[5090]|0;o[b+8>>2]=+(((k[s+48+4>>2]|0)-(k[t+4>>2]|0)+(((k[s+48>>2]|0)-(k[t>>2]|0)|0)*1e6|0)-(k[b+12>>2]|0)|0)>>>0)/1.0e3+ +o[b+8>>2];if(!(k[b+16>>2]|0)){b=k[5104]|0;break}else{r=s;return}}while(0);k[5104]=k[b+20>>2];r=s;return}function qs(a){a=a|0;var b=0,c=0;b=r;r=r+16|0;Cw(8312);c=k[a+68>>2]|0;Ub[k[(k[c>>2]|0)+32>>2]&127](c,k[a+24>>2]|0);a=k[5104]|0;c=(k[a+16>>2]|0)+-1|0;k[a+16>>2]=c;if(c){r=b;return}do if(k[a+4>>2]|0){Kb(b|0,0)|0;c=k[5090]|0;o[a+8>>2]=+(((k[b+4>>2]|0)-(k[c+4>>2]|0)+(((k[b>>2]|0)-(k[c>>2]|0)|0)*1e6|0)-(k[a+12>>2]|0)|0)>>>0)/1.0e3+ +o[a+8>>2];if(!(k[a+16>>2]|0)){a=k[5104]|0;break}else{r=b;return}}while(0);k[5104]=k[a+20>>2];r=b;return}function rs(a){a=a|0;var b=0,c=0,d=0,e=0;c=r;r=r+16|0;Cw(8344);Sb[k[(k[a>>2]|0)+8>>2]&255](a);Sb[k[(k[a>>2]|0)+12>>2]&255](a);b=k[a+24>>2]|0;Cw(8384);if(b){e=k[(k[b>>2]|0)+32>>2]|0;d=k[a+68>>2]|0;d=Wb[k[(k[d>>2]|0)+36>>2]&127](d)|0;Cc[e&127](b,d,a+28|0,k[a+24>>2]|0)}b=k[5104]|0;e=(k[b+16>>2]|0)+-1|0;k[b+16>>2]=e;do if(!e){if(k[b+4>>2]|0){Kb(c|0,0)|0;a=k[5090]|0;o[b+8>>2]=+(((k[c+4>>2]|0)-(k[a+4>>2]|0)+(((k[c>>2]|0)-(k[a>>2]|0)|0)*1e6|0)-(k[b+12>>2]|0)|0)>>>0)/1.0e3+ +o[b+8>>2];a=k[5104]|0;if(k[b+16>>2]|0)break}else a=b;a=k[a+20>>2]|0;k[5104]=a}else a=b;while(0);b=a+16|0;e=(k[b>>2]|0)+-1|0;k[b>>2]=e;if(e){r=c;return}do if(k[a+4>>2]|0){Kb(c|0,0)|0;d=k[5090]|0;e=a+8|0;o[e>>2]=+(((k[c+4>>2]|0)-(k[d+4>>2]|0)+(((k[c>>2]|0)-(k[d>>2]|0)|0)*1e6|0)-(k[a+12>>2]|0)|0)>>>0)/1.0e3+ +o[e>>2];if(!(k[b>>2]|0)){a=k[5104]|0;break}else{r=c;return}}while(0);k[5104]=k[a+20>>2];r=c;return}function ss(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0;c=k[b+188>>2]|0;if(c){f=k[a+68>>2]|0;f=Wb[k[(k[f>>2]|0)+36>>2]&127](f)|0;yc[k[(k[f>>2]|0)+40>>2]&127](f,c,k[a+24>>2]|0);f=k[a+68>>2]|0;yc[k[(k[f>>2]|0)+12>>2]&127](f,c,k[a+24>>2]|0);k[b+188>>2]=0}e=k[a+8>>2]|0;if((e|0)<=0)return;f=k[a+16>>2]|0;c=0;while(1){d=f+(c<<2)|0;if((k[d>>2]|0)==(b|0))break;c=c+1|0;if((c|0)>=(e|0)){g=9;break}}if((g|0)==9)return;if((c|0)>=(e|0))return;k[d>>2]=k[f+(e+-1<<2)>>2];k[(k[a+16>>2]|0)+(e+-1<<2)>>2]=b;k[a+8>>2]=e+-1;return}function ts(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0,z=0,A=0,B=0,C=0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0,L=0.0,M=0.0,N=0.0;K=r;r=r+1040|0;k[K+96+8>>2]=0;o[K+96+12>>2]=1.0;o[K+96+16>>2]=1.0;o[K+96+20>>2]=1.0;o[K+96+24>>2]=0.0;k[K+96>>2]=12008;k[K+96+4>>2]=8;o[K+96+28>>2]=0.0;o[K+96+44>>2]=0.0;g=k[c+4>>2]|0;f=k[c+12>>2]|0;h=k[g+4>>2]|0;if((h|0)<20){k[K+840>>2]=7512;k[K+840+168>>2]=0;o[K+840+172>>2]=0.0;o[K+840+164>>2]=+o[d+4>>2];o[K+448+308>>2]=9.999999747378752e-05;i[K+448+332>>0]=0;k[K+16>>2]=18976;k[K+16+4>>2]=K+448;k[K+16+8>>2]=K+96;k[K+16+12>>2]=g;k[K+432>>2]=19128;k[K+432+4>>2]=K+448;k[K+432+8>>2]=K+96;k[K+432+12>>2]=g;B=(k[d+16>>2]&4|0)==0?K+432|0:K+16|0;if((hc[k[(k[B>>2]|0)+8>>2]&3](B,a,b,f,f,K+840|0)|0?(e=K+840+132|0,s=+o[e>>2],q=+o[K+840+136>>2],p=+o[K+840+140>>2],s*s+q*q+p*p>9.999999747378752e-05):0)?(n=+o[K+840+164>>2],n<+o[d+4>>2]):0){F=1.0/+Y(+(s*s+q*q+p*p));o[e>>2]=s*F;o[K+840+136>>2]=q*F;o[K+840+140>>2]=p*F;k[K+808>>2]=k[c+8>>2];k[K+808+4>>2]=0;k[K+808+8>>2]=k[e>>2];k[K+808+8+4>>2]=k[e+4>>2];k[K+808+8+8>>2]=k[e+8>>2];k[K+808+8+12>>2]=k[e+12>>2];o[K+808+24>>2]=n;+oc[k[(k[d>>2]|0)+12>>2]&15](d,K+808|0,1)}r=K;return}if((h+-21|0)>>>0<9){G=+o[f>>2];H=+o[f+16>>2];p=+o[f+32>>2];I=+o[f+4>>2];J=+o[f+20>>2];n=+o[f+36>>2];E=+o[f+8>>2];F=+o[f+24>>2];m=+o[f+40>>2];q=-+o[f+48>>2];s=-+o[f+52>>2];D=-+o[f+56>>2];t=+o[a+48>>2];u=+o[a+52>>2];l=+o[a+56>>2];o[K+1016>>2]=G*q+H*s+p*D+(G*t+H*u+p*l);o[K+1016+4>>2]=I*q+J*s+n*D+(I*t+J*u+n*l);o[K+1016+8>>2]=E*q+F*s+m*D+(E*t+F*u+m*l);o[K+1016+12>>2]=0.0;w=+o[b+48>>2];x=+o[b+52>>2];v=+o[b+56>>2];p=G*q+H*s+p*D+(G*w+H*x+p*v);n=I*q+J*s+n*D+(I*w+J*x+n*v);m=E*q+F*s+m*D+(E*w+F*x+m*v);o[K+152>>2]=p;o[K+152+4>>2]=n;o[K+152+8>>2]=m;o[K+152+12>>2]=0.0;h=k[g+4>>2]|0;if((h|0)==21){e=k[c+8>>2]|0;B=k[d+16>>2]|0;k[K+200+4>>2]=k[K+1016>>2];k[K+200+4+4>>2]=k[K+1016+4>>2];k[K+200+4+8>>2]=k[K+1016+8>>2];k[K+200+4+12>>2]=k[K+1016+12>>2];k[K+200+20>>2]=k[K+152>>2];k[K+200+20+4>>2]=k[K+152+4>>2];k[K+200+20+8>>2]=k[K+152+8>>2];k[K+200+20+12>>2]=k[K+152+12>>2];k[K+200+36>>2]=B;o[K+200+40>>2]=1.0;k[K+200>>2]=10120;k[K+200+44>>2]=d;k[K+200+48>>2]=e;k[K+200+52>>2]=g;k[K+200+56>>2]=k[f>>2];k[K+200+56+4>>2]=k[f+4>>2];k[K+200+56+8>>2]=k[f+8>>2];k[K+200+56+12>>2]=k[f+12>>2];k[K+200+72>>2]=k[f+16>>2];k[K+200+72+4>>2]=k[f+16+4>>2];k[K+200+72+8>>2]=k[f+16+8>>2];k[K+200+72+12>>2]=k[f+16+12>>2];k[K+200+88>>2]=k[f+32>>2];k[K+200+88+4>>2]=k[f+32+4>>2];k[K+200+88+8>>2]=k[f+32+8>>2];k[K+200+88+12>>2]=k[f+32+12>>2];k[K+200+104>>2]=k[f+48>>2];k[K+200+104+4>>2]=k[f+48+4>>2];k[K+200+104+8>>2]=k[f+48+8>>2];k[K+200+104+12>>2]=k[f+48+12>>2];o[K+200+40>>2]=+o[d+4>>2];e=k[g+48>>2]|0;k[K+168>>2]=12680;k[K+168+4>>2]=e;k[K+168+8>>2]=K+200;e=k[g+52>>2]|0;k[K+840>>2]=0;k[K+840+4>>2]=0;k[K+840+8>>2]=0;k[K+840+12>>2]=0;k[K+448>>2]=0;k[K+448+4>>2]=0;k[K+448+8>>2]=0;k[K+448+12>>2]=0;if(!(i[e+60>>0]|0))Fv(e,K+168|0,K+1016|0,p,n,m,K+840|0,K+448|0);else Gv(e,K+168|0,K+1016|0,p,n,m,K+840|0,K+448|0,k[e+56>>2]|0);r=K;return}else if((h|0)==25){B=k[c+8>>2]|0;A=k[d+16>>2]|0;k[K+840+4>>2]=k[K+1016>>2];k[K+840+4+4>>2]=k[K+1016+4>>2];k[K+840+4+8>>2]=k[K+1016+8>>2];k[K+840+4+12>>2]=k[K+1016+12>>2];k[K+840+20>>2]=k[K+152>>2];k[K+840+20+4>>2]=k[K+152+4>>2];k[K+840+20+8>>2]=k[K+152+8>>2];k[K+840+20+12>>2]=k[K+152+12>>2];k[K+840+36>>2]=A;o[K+840+40>>2]=1.0;k[K+840>>2]=10120;k[K+840+44>>2]=d;k[K+840+48>>2]=B;k[K+840+52>>2]=g;k[K+840+56>>2]=k[f>>2];k[K+840+56+4>>2]=k[f+4>>2];k[K+840+56+8>>2]=k[f+8>>2];k[K+840+56+12>>2]=k[f+12>>2];k[K+840+72>>2]=k[f+16>>2];k[K+840+72+4>>2]=k[f+16+4>>2];k[K+840+72+8>>2]=k[f+16+8>>2];k[K+840+72+12>>2]=k[f+16+12>>2];k[K+840+88>>2]=k[f+32>>2];k[K+840+88+4>>2]=k[f+32+4>>2];k[K+840+88+8>>2]=k[f+32+8>>2];k[K+840+88+12>>2]=k[f+32+12>>2];k[K+840+104>>2]=k[f+48>>2];k[K+840+104+4>>2]=k[f+48+4>>2];k[K+840+104+8>>2]=k[f+48+8>>2];k[K+840+104+12>>2]=k[f+48+12>>2];o[K+840+40>>2]=+o[d+4>>2];Cc[k[(k[g>>2]|0)+144>>2]&127](g,K+840|0,K+1016|0,K+152|0);r=K;return}else{N=+o[f>>2];M=+o[f+16>>2];n=+o[f+32>>2];L=+o[f+4>>2];G=+o[f+20>>2];p=+o[f+36>>2];D=+o[f+8>>2];E=+o[f+24>>2];F=+o[f+40>>2];H=-+o[f+48>>2];I=-+o[f+52>>2];J=-+o[f+56>>2];q=N*H+M*I+n*J+(N*t+M*u+n*l);s=L*H+G*I+p*J+(L*t+G*u+p*l);m=D*H+E*I+F*J+(D*t+E*u+F*l);n=N*H+M*I+n*J+(N*w+M*x+n*v);p=L*H+G*I+p*J+(L*w+G*x+p*v);l=D*H+E*I+F*J+(D*w+E*x+F*v);B=k[c+8>>2]|0;A=k[d+16>>2]|0;o[K+840+4>>2]=q;o[K+840+8>>2]=s;o[K+840+12>>2]=m;o[K+840+16>>2]=0.0;o[K+840+20>>2]=n;o[K+840+24>>2]=p;o[K+840+28>>2]=l;o[K+840+32>>2]=0.0;k[K+840+36>>2]=A;o[K+840+40>>2]=1.0;k[K+840>>2]=9928;k[K+840+44>>2]=d;k[K+840+48>>2]=B;k[K+840+52>>2]=g;k[K+840+56>>2]=k[f>>2];k[K+840+56+4>>2]=k[f+4>>2];k[K+840+56+8>>2]=k[f+8>>2];k[K+840+56+12>>2]=k[f+12>>2];k[K+840+72>>2]=k[f+16>>2];k[K+840+72+4>>2]=k[f+16+4>>2];k[K+840+72+8>>2]=k[f+16+8>>2];k[K+840+72+12>>2]=k[f+16+12>>2];k[K+840+88>>2]=k[f+32>>2];k[K+840+88+4>>2]=k[f+32+4>>2];k[K+840+88+8>>2]=k[f+32+8>>2];k[K+840+88+12>>2]=k[f+32+12>>2];k[K+840+104>>2]=k[f+48>>2];k[K+840+104+4>>2]=k[f+48+4>>2];k[K+840+104+8>>2]=k[f+48+8>>2];k[K+840+104+12>>2]=k[f+48+12>>2];o[K+840+40>>2]=+o[d+4>>2];o[K>>2]=q;o[K+4>>2]=s;o[K+8>>2]=m;o[K+12>>2]=0.0;if(n<q)o[K>>2]=n;if(p<s)o[K+4>>2]=p;if(l<m)o[K+8>>2]=l;o[K+352>>2]=q;o[K+352+4>>2]=s;o[K+352+8>>2]=m;o[K+352+12>>2]=0.0;if(q<n)o[K+352>>2]=n;if(s<p)o[K+352+4>>2]=p;if(m<l)o[K+352+8>>2]=l;Cc[k[(k[g>>2]|0)+64>>2]&127](g,K+840|0,K,K+352|0);r=K;return}}if((h|0)!=31){r=K;return}h=k[g+64>>2]|0;B=k[c+8>>2]|0;k[K+320>>2]=9712;k[K+320+4>>2]=B;k[K+320+8>>2]=g;k[K+320+12>>2]=f;k[K+320+16>>2]=a;k[K+320+20>>2]=b;k[K+320+24>>2]=d;if(!h){h=k[g+16>>2]|0;if((h|0)<=0){r=K;return}e=0;while(1){B=k[g+24>>2]|0;A=k[B+(e*80|0)+64>>2]|0;Sw(K+840|0,f,B+(e*80|0)|0);B=k[K+320+4>>2]|0;k[K+448>>2]=0;k[K+448+4>>2]=A;k[K+448+8>>2]=B;k[K+448+12>>2]=K+840;k[K+448+16>>2]=-1;k[K+448+20>>2]=e;B=k[K+320+24>>2]|0;o[K+168+4>>2]=1.0;k[K+168+8>>2]=0;j[K+168+12>>1]=1;j[K+168+14>>1]=-1;k[K+168+16>>2]=0;k[K+168>>2]=9536;k[K+168+20>>2]=B;k[K+168+24>>2]=e;o[K+168+4>>2]=+o[B+4>>2];k[K+168+16>>2]=k[B+16>>2];ts(k[K+320+16>>2]|0,k[K+320+20>>2]|0,K+448|0,K+168|0);e=e+1|0;if((e|0)>=(h|0))break;g=k[K+320+8>>2]|0;f=k[K+320+12>>2]|0}r=K;return}$w(K+32|0,f,a);D=+o[K+32+48>>2];E=+o[K+32+52>>2];F=+o[K+32+56>>2];$w(K+368|0,f,b);f=k[h>>2]|0;if(f){s=+o[K+368+48>>2]-D;q=+o[K+368+52>>2]-E;p=+o[K+368+56>>2]-F;n=1.0/+Y(+(s*s+q*q+p*p));if(s*n==0.0)m=999999984306749440.0;else m=1.0/(s*n);if(q*n==0.0)x=999999984306749440.0;else x=1.0/(q*n);if(p*n==0.0)l=999999984306749440.0;else l=1.0/(p*n);A=m<0.0&1;B=x<0.0&1;C=l<0.0&1;k[5108]=(k[5108]|0)+1;h=iF(531)|0;if(!h)g=0;else{k[(h+4+15&-16)+-4>>2]=h;g=h+4+15&-16}h=0;while(1){a=g+(h<<2)|0;if(a)k[a>>2]=0;if((h|0)==127)break;else h=h+1|0}k[g>>2]=f;f=128;a=128;z=1;b=126;while(1){y=z+-1|0;c=k[g+(y<<2)>>2]|0;k[K+840>>2]=k[c>>2];k[K+840+4>>2]=k[c+4>>2];k[K+840+8>>2]=k[c+8>>2];k[K+840+12>>2]=k[c+12>>2];k[K+840+16>>2]=k[c+16>>2];k[K+840+16+4>>2]=k[c+16+4>>2];k[K+840+16+8>>2]=k[c+16+8>>2];k[K+840+16+12>>2]=k[c+16+12>>2];w=m*(+o[K+840+(A<<4)>>2]-D);v=m*(+o[K+840+((A^1)<<4)>>2]-D);u=x*(+o[K+840+(B<<4)+4>>2]-E);t=x*(+o[K+840+((B^1)<<4)+4>>2]-E);do if(((!(u>v|w>t)?(G=u>w?u:w,J=t<v?t:v,H=l*(+o[K+840+(C<<4)+8>>2]-F),I=l*(+o[K+840+((C^1)<<4)+8>>2]-F),!(H>J|G>I)):0)?(H>G?H:G)<s*n*s+q*n*q+p*n*p:0)?(I<J?I:J)>0.0:0){if(!(k[c+40>>2]|0)){Ub[k[(k[K+320>>2]|0)+12>>2]&127](K+320|0,c);h=y;break}if((y|0)>(b|0)){d=f<<1;if((f|0)<(d|0)){do if((a|0)<(d|0)){do if(!f)a=0;else{k[5108]=(k[5108]|0)+1;a=iF((f<<3|3)+16|0)|0;if(!a)a=0;else{k[(a+4+15&-16)+-4>>2]=a;a=a+4+15&-16}if((f|0)<=0)break;b=f+-1|0;e=0;while(1){h=a+(e<<2)|0;if(h)k[h>>2]=k[g+(e<<2)>>2];if((e|0)==(b|0))break;else e=e+1|0}}while(0);if(!g){g=a;a=d;break}k[5110]=(k[5110]|0)+1;jF(k[g+-4>>2]|0);g=a;a=d}while(0);while(1){h=g+(f<<2)|0;if(h)k[h>>2]=0;if((f|0)==(d+-1|0))break;else f=f+1|0}}f=d;b=d+-2|0}k[g+(y<<2)>>2]=k[c+36>>2];k[g+(z<<2)>>2]=k[c+40>>2];h=z+1|0}else h=y;while(0);if(!h)break;else z=h}if(g){k[5110]=(k[5110]|0)+1;jF(k[g+-4>>2]|0)}}r=K;return}function us(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=+f;var g=0,h=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0,v=0.0,w=0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0,E=0,F=0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0;F=r;r=r+976|0;E=k[d+4>>2]|0;D=k[d+12>>2]|0;w=k[E+4>>2]|0;if((w|0)<20){k[F+784>>2]=7512;k[F+784+168>>2]=0;o[F+784+172>>2]=f;o[F+784+164>>2]=+o[e+4>>2];o[F+408+308>>2]=9.999999747378752e-05;i[F+408+332>>0]=0;k[F+312>>2]=19048;k[F+264>>2]=19312;k[F+264+4>>2]=F+408;k[F+264+8>>2]=F+312;k[F+264+12>>2]=a;k[F+264+16>>2]=E;k[F+264+20>>2]=0;if((Yv(F+264|0,b,c,D,D,F+784|0)|0?(g=F+784+132|0,t=+o[g>>2],s=+o[F+784+136>>2],p=+o[F+784+140>>2],t*t+s*s+p*p>9.999999747378752e-05):0)?(h=+o[F+784+164>>2],h<+o[e+4>>2]):0){f=1.0/+Y(+(t*t+s*s+p*p));o[g>>2]=t*f;o[F+784+136>>2]=s*f;o[F+784+140>>2]=p*f;k[F+16>>2]=k[d+8>>2];k[F+16+4>>2]=0;k[F+16+8>>2]=k[g>>2];k[F+16+8+4>>2]=k[g+4>>2];k[F+16+8+8>>2]=k[g+8>>2];k[F+16+8+12>>2]=k[g+12>>2];k[F+16+24>>2]=k[F+784+148>>2];k[F+16+24+4>>2]=k[F+784+148+4>>2];k[F+16+24+8>>2]=k[F+784+148+8>>2];k[F+16+24+12>>2]=k[F+784+148+12>>2];o[F+16+40>>2]=h;+oc[k[(k[e>>2]|0)+12>>2]&15](e,F+16|0,1)}r=F;return}if((w+-21|0)>>>0>=9){if((w|0)!=31){r=F;return}Cw(8416);if((k[E+16>>2]|0)>0){g=0;do{u=k[E+24>>2]|0;h=+o[u+(g*80|0)>>2];y=+o[u+(g*80|0)+4>>2];p=+o[u+(g*80|0)+8>>2];x=+o[u+(g*80|0)+16>>2];m=+o[u+(g*80|0)+20>>2];s=+o[u+(g*80|0)+24>>2];l=+o[u+(g*80|0)+32>>2];n=+o[u+(g*80|0)+36>>2];v=+o[u+(g*80|0)+40>>2];N=+o[u+(g*80|0)+48>>2];M=+o[u+(g*80|0)+52>>2];C=+o[u+(g*80|0)+56>>2];u=k[u+(g*80|0)+64>>2]|0;L=+o[D>>2];K=+o[D+4>>2];J=+o[D+8>>2];I=+o[D+16>>2];H=+o[D+20>>2];G=+o[D+24>>2];q=+o[D+32>>2];t=+o[D+36>>2];z=+o[D+40>>2];A=N*L+M*K+C*J+ +o[D+48>>2];B=N*I+M*H+C*G+ +o[D+52>>2];C=N*q+M*t+C*z+ +o[D+56>>2];o[F+784>>2]=h*L+x*K+l*J;o[F+784+4>>2]=y*L+m*K+n*J;o[F+784+8>>2]=p*L+s*K+v*J;o[F+784+12>>2]=0.0;o[F+784+16>>2]=h*I+x*H+l*G;o[F+784+20>>2]=y*I+m*H+n*G;o[F+784+24>>2]=p*I+s*H+v*G;o[F+784+28>>2]=0.0;o[F+784+32>>2]=h*q+x*t+l*z;o[F+784+36>>2]=y*q+m*t+n*z;o[F+784+40>>2]=p*q+s*t+v*z;o[F+784+44>>2]=0.0;o[F+784+48>>2]=A;o[F+784+52>>2]=B;o[F+784+56>>2]=C;o[F+784+60>>2]=0.0;j[F+240+8>>1]=1;j[F+240+10>>1]=-1;k[F+240>>2]=8896;k[F+240+12>>2]=e;k[F+240+16>>2]=g;o[F+240+4>>2]=+o[e+4>>2];w=k[d+8>>2]|0;k[F+368>>2]=d;k[F+368+4>>2]=u;k[F+368+8>>2]=w;k[F+368+12>>2]=F+784;k[F+368+16>>2]=-1;k[F+368+20>>2]=g;us(a,b,c,F+368|0,F+240|0,f);g=g+1|0}while((g|0)<(k[E+16>>2]|0))}g=k[5104]|0;E=(k[g+16>>2]|0)+-1|0;k[g+16>>2]=E;if(E){r=F;return}do if(k[g+4>>2]|0){Kb(F+784|0,0)|0;E=k[5090]|0;o[g+8>>2]=+(((k[F+784+4>>2]|0)-(k[E+4>>2]|0)+(((k[F+784>>2]|0)-(k[E>>2]|0)|0)*1e6|0)-(k[g+12>>2]|0)|0)>>>0)/1.0e3+ +o[g+8>>2];if(!(k[g+16>>2]|0)){g=k[5104]|0;break}else{r=F;return}}while(0);k[5104]=k[g+20>>2];r=F;return}if((w|0)==21){q=+o[D>>2];p=+o[D+16>>2];n=+o[D+32>>2];m=+o[D+4>>2];l=+o[D+20>>2];h=+o[D+36>>2];x=+o[D+8>>2];y=+o[D+24>>2];z=+o[D+40>>2];A=-+o[D+48>>2];B=-+o[D+52>>2];C=-+o[D+56>>2];s=+o[b+48>>2];t=+o[b+52>>2];v=+o[b+56>>2];o[F+392>>2]=q*A+p*B+n*C+(q*s+p*t+n*v);o[F+392+4>>2]=m*A+l*B+h*C+(m*s+l*t+h*v);o[F+392+8>>2]=x*A+y*B+z*C+(x*s+y*t+z*v);o[F+392+12>>2]=0.0;v=+o[c+48>>2];t=+o[c+52>>2];s=+o[c+56>>2];O=+o[c>>2];G=+o[c+16>>2];H=+o[c+32>>2];I=+o[c+4>>2];J=+o[c+20>>2];K=+o[c+36>>2];M=+o[c+8>>2];L=+o[c+24>>2];N=+o[c+40>>2];o[F+408>>2]=q*O+p*G+n*H;o[F+408+4>>2]=q*I+p*J+n*K;o[F+408+8>>2]=q*M+p*L+n*N;o[F+408+12>>2]=0.0;o[F+408+16>>2]=m*O+l*G+h*H;o[F+408+20>>2]=m*I+l*J+h*K;o[F+408+24>>2]=m*M+l*L+h*N;o[F+408+28>>2]=0.0;o[F+408+32>>2]=x*O+y*G+z*H;o[F+408+36>>2]=x*I+y*J+z*K;o[F+408+40>>2]=x*M+y*L+z*N;g=F+408+44|0;k[g>>2]=0;k[g+4>>2]=0;k[g+8>>2]=0;k[g+12>>2]=0;k[g+16>>2]=0;g=k[d+8>>2]|0;N=+gc[k[(k[E>>2]|0)+48>>2]&15](E);k[F+16>>2]=17504;k[F+16+4>>2]=a;k[F+16+8>>2]=k[b>>2];k[F+16+8+4>>2]=k[b+4>>2];k[F+16+8+8>>2]=k[b+8>>2];k[F+16+8+12>>2]=k[b+12>>2];k[F+16+24>>2]=k[b+16>>2];k[F+16+24+4>>2]=k[b+16+4>>2];k[F+16+24+8>>2]=k[b+16+8>>2];k[F+16+24+12>>2]=k[b+16+12>>2];k[F+16+40>>2]=k[b+32>>2];k[F+16+40+4>>2]=k[b+32+4>>2];k[F+16+40+8>>2]=k[b+32+8>>2];k[F+16+40+12>>2]=k[b+32+12>>2];k[F+16+56>>2]=k[b+48>>2];k[F+16+56+4>>2]=k[b+48+4>>2];k[F+16+56+8>>2]=k[b+48+8>>2];k[F+16+56+12>>2]=k[b+48+12>>2];k[F+16+72>>2]=k[c>>2];k[F+16+72+4>>2]=k[c+4>>2];k[F+16+72+8>>2]=k[c+8>>2];k[F+16+72+12>>2]=k[c+12>>2];k[F+16+88>>2]=k[c+16>>2];k[F+16+88+4>>2]=k[c+16+4>>2];k[F+16+88+8>>2]=k[c+16+8>>2];k[F+16+88+12>>2]=k[c+16+12>>2];k[F+16+104>>2]=k[c+32>>2];k[F+16+104+4>>2]=k[c+32+4>>2];k[F+16+104+8>>2]=k[c+32+8>>2];k[F+16+104+12>>2]=k[c+32+12>>2];k[F+16+120>>2]=k[c+48>>2];k[F+16+120+4>>2]=k[c+48+4>>2];k[F+16+120+8>>2]=k[c+48+8>>2];k[F+16+120+12>>2]=k[c+48+12>>2];k[F+16+136>>2]=k[D>>2];k[F+16+136+4>>2]=k[D+4>>2];k[F+16+136+8>>2]=k[D+8>>2];k[F+16+136+12>>2]=k[D+12>>2];k[F+16+152>>2]=k[D+16>>2];k[F+16+152+4>>2]=k[D+16+4>>2];k[F+16+152+8>>2]=k[D+16+8>>2];k[F+16+152+12>>2]=k[D+16+12>>2];k[F+16+168>>2]=k[D+32>>2];k[F+16+168+4>>2]=k[D+32+4>>2];k[F+16+168+8>>2]=k[D+32+8>>2];k[F+16+168+12>>2]=k[D+32+12>>2];k[F+16+184>>2]=k[D+48>>2];k[F+16+184+4>>2]=k[D+48+4>>2];k[F+16+184+8>>2]=k[D+48+8>>2];k[F+16+184+12>>2]=k[D+48+12>>2];o[F+16+204>>2]=N;k[F+16>>2]=9320;k[F+16+212>>2]=e;k[F+16+216>>2]=g;k[F+16+220>>2]=E;o[F+16+200>>2]=+o[e+4>>2];o[F+16+208>>2]=f;Cc[k[(k[a>>2]|0)+8>>2]&127](a,F+408|0,F+768|0,F+960|0);g=k[E+48>>2]|0;k[F+784>>2]=12520;k[F+784+4>>2]=g;k[F+784+8>>2]=F+16;g=k[E+52>>2]|0;if(!(i[g+60>>0]|0))Fv(g,F+784|0,F+392|0,q*A+p*B+n*C+(q*v+p*t+n*s),m*A+l*B+h*C+(m*v+l*t+h*s),x*A+y*B+z*C+(x*v+y*t+z*s),F+768|0,F+960|0);else Gv(g,F+784|0,F+392|0,q*A+p*B+n*C+(q*v+p*t+n*s),m*A+l*B+h*C+(m*v+l*t+h*s),x*A+y*B+z*C+(x*v+y*t+z*s),F+768|0,F+960|0,k[g+56>>2]|0);r=F;return}else if((w|0)==28){k[F+784>>2]=7512;k[F+784+168>>2]=0;o[F+784+172>>2]=f;o[F+784+164>>2]=+o[e+4>>2];k[F+288>>2]=19312;k[F+288+4>>2]=0;k[F+288+8>>2]=0;k[F+288+12>>2]=a;k[F+288+16>>2]=0;k[F+288+20>>2]=E;if((Yv(F+288|0,b,c,D,D,F+784|0)|0?(u=F+784+132|0,q=+o[u>>2],n=+o[F+784+136>>2],m=+o[F+784+140>>2],q*q+n*n+m*m>9.999999747378752e-05):0)?(l=+o[F+784+164>>2],l<+o[e+4>>2]):0){O=1.0/+Y(+(q*q+n*n+m*m));o[u>>2]=q*O;o[F+784+136>>2]=n*O;o[F+784+140>>2]=m*O;k[F+408>>2]=k[d+8>>2];k[F+408+4>>2]=0;k[F+408+8>>2]=k[u>>2];k[F+408+8+4>>2]=k[u+4>>2];k[F+408+8+8>>2]=k[u+8>>2];k[F+408+8+12>>2]=k[u+12>>2];k[F+408+24>>2]=k[F+784+148>>2];k[F+408+24+4>>2]=k[F+784+148+4>>2];k[F+408+24+8>>2]=k[F+784+148+8>>2];k[F+408+24+12>>2]=k[F+784+148+12>>2];o[F+408+40>>2]=l;+oc[k[(k[e>>2]|0)+12>>2]&15](e,F+408|0,1)}r=F;return}else{x=+o[D>>2];y=+o[D+16>>2];n=+o[D+32>>2];G=+o[D+4>>2];p=+o[D+20>>2];H=+o[D+36>>2];A=+o[D+8>>2];C=+o[D+24>>2];N=+o[D+40>>2];M=-+o[D+48>>2];K=-+o[D+52>>2];J=-+o[D+56>>2];q=+o[b+48>>2];I=+o[b+52>>2];h=+o[b+56>>2];s=x*M+y*K+n*J+(x*q+y*I+n*h);l=G*M+p*K+H*J+(G*q+p*I+H*h);h=A*M+C*K+N*J+(A*q+C*I+N*h);I=+o[c+48>>2];q=+o[c+52>>2];v=+o[c+56>>2];m=x*M+y*K+n*J+(x*I+y*q+n*v);t=G*M+p*K+H*J+(G*I+p*q+H*v);v=A*M+C*K+N*J+(A*I+C*q+N*v);q=+o[c>>2];I=+o[c+16>>2];J=+o[c+32>>2];K=+o[c+4>>2];M=+o[c+20>>2];z=+o[c+36>>2];B=+o[c+8>>2];L=+o[c+24>>2];O=+o[c+40>>2];o[F+784>>2]=x*q+y*I+n*J;o[F+784+4>>2]=x*K+y*M+n*z;o[F+784+8>>2]=x*B+y*L+n*O;o[F+784+12>>2]=0.0;o[F+784+16>>2]=G*q+p*I+H*J;o[F+784+20>>2]=G*K+p*M+H*z;o[F+784+24>>2]=G*B+p*L+H*O;o[F+784+28>>2]=0.0;o[F+784+32>>2]=A*q+C*I+N*J;o[F+784+36>>2]=A*K+C*M+N*z;o[F+784+40>>2]=A*B+C*L+N*O;g=F+784+44|0;k[g>>2]=0;k[g+4>>2]=0;k[g+8>>2]=0;k[g+12>>2]=0;k[g+16>>2]=0;d=k[d+8>>2]|0;O=+gc[k[(k[E>>2]|0)+48>>2]&15](E);k[F+408>>2]=17504;k[F+408+4>>2]=a;k[F+408+8>>2]=k[b>>2];k[F+408+8+4>>2]=k[b+4>>2];k[F+408+8+8>>2]=k[b+8>>2];k[F+408+8+12>>2]=k[b+12>>2];k[F+408+24>>2]=k[b+16>>2];k[F+408+24+4>>2]=k[b+16+4>>2];k[F+408+24+8>>2]=k[b+16+8>>2];k[F+408+24+12>>2]=k[b+16+12>>2];k[F+408+40>>2]=k[b+32>>2];k[F+408+40+4>>2]=k[b+32+4>>2];k[F+408+40+8>>2]=k[b+32+8>>2];k[F+408+40+12>>2]=k[b+32+12>>2];k[F+408+56>>2]=k[b+48>>2];k[F+408+56+4>>2]=k[b+48+4>>2];k[F+408+56+8>>2]=k[b+48+8>>2];k[F+408+56+12>>2]=k[b+48+12>>2];k[F+408+72>>2]=k[c>>2];k[F+408+72+4>>2]=k[c+4>>2];k[F+408+72+8>>2]=k[c+8>>2];k[F+408+72+12>>2]=k[c+12>>2];k[F+408+88>>2]=k[c+16>>2];k[F+408+88+4>>2]=k[c+16+4>>2];k[F+408+88+8>>2]=k[c+16+8>>2];k[F+408+88+12>>2]=k[c+16+12>>2];k[F+408+104>>2]=k[c+32>>2];k[F+408+104+4>>2]=k[c+32+4>>2];k[F+408+104+8>>2]=k[c+32+8>>2];k[F+408+104+12>>2]=k[c+32+12>>2];k[F+408+120>>2]=k[c+48>>2];k[F+408+120+4>>2]=k[c+48+4>>2];k[F+408+120+8>>2]=k[c+48+8>>2];k[F+408+120+12>>2]=k[c+48+12>>2];k[F+408+136>>2]=k[D>>2];k[F+408+136+4>>2]=k[D+4>>2];k[F+408+136+8>>2]=k[D+8>>2];k[F+408+136+12>>2]=k[D+12>>2];k[F+408+152>>2]=k[D+16>>2];k[F+408+152+4>>2]=k[D+16+4>>2];k[F+408+152+8>>2]=k[D+16+8>>2];k[F+408+152+12>>2]=k[D+16+12>>2];k[F+408+168>>2]=k[D+32>>2];k[F+408+168+4>>2]=k[D+32+4>>2];k[F+408+168+8>>2]=k[D+32+8>>2];k[F+408+168+12>>2]=k[D+32+12>>2];k[F+408+184>>2]=k[D+48>>2];k[F+408+184+4>>2]=k[D+48+4>>2];k[F+408+184+8>>2]=k[D+48+8>>2];k[F+408+184+12>>2]=k[D+48+12>>2];o[F+408+204>>2]=O;k[F+408>>2]=9096;k[F+408+212>>2]=e;k[F+408+216>>2]=d;k[F+408+220>>2]=E;o[F+408+200>>2]=+o[e+4>>2];o[F+408+208>>2]=f;Cc[k[(k[a>>2]|0)+8>>2]&127](a,F+784|0,F+320|0,F);o[F+352>>2]=s;o[F+352+4>>2]=l;o[F+352+8>>2]=h;o[F+352+12>>2]=0.0;if(m<s){o[F+352>>2]=m;n=m}else n=s;if(t<l){o[F+352+4>>2]=t;p=t}else p=l;if(v<h){o[F+352+8>>2]=v;q=v}else q=h;o[F+336>>2]=s;o[F+336+4>>2]=l;o[F+336+8>>2]=h;o[F+336+12>>2]=0.0;if(s<m)o[F+336>>2]=m;else m=s;if(l<t){o[F+336+4>>2]=t;l=t}if(h<v){o[F+336+8>>2]=v;h=v}o[F+352>>2]=+o[F+320>>2]+n;o[F+352+4>>2]=+o[F+320+4>>2]+p;o[F+352+8>>2]=+o[F+320+8>>2]+q;o[F+336>>2]=+o[F>>2]+m;o[F+336+4>>2]=+o[F+4>>2]+l;o[F+336+8>>2]=+o[F+8>>2]+h;Cc[k[(k[E>>2]|0)+64>>2]&127](E,F+408|0,F+352|0,F+336|0);r=F;return}}function vs(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0,n=0,p=0;p=r;r=r+256|0;k[p+32>>2]=8832;m=p+32+36|0;k[m>>2]=k[b>>2];k[m+4>>2]=k[b+4>>2];k[m+8>>2]=k[b+8>>2];k[m+12>>2]=k[b+12>>2];n=p+32+52|0;k[n>>2]=k[c>>2];k[n+4>>2]=k[c+4>>2];k[n+8>>2]=k[c+8>>2];k[n+12>>2]=k[c+12>>2];k[p+32+212>>2]=a;k[p+32+216>>2]=d;o[p+32+68>>2]=1.0;k[p+32+72>>2]=0;k[p+32+72+4>>2]=0;k[p+32+72+8>>2]=0;k[p+32+72+12>>2]=0;o[p+32+88>>2]=1.0;k[p+32+92>>2]=0;k[p+32+92+4>>2]=0;k[p+32+92+8>>2]=0;k[p+32+92+12>>2]=0;o[p+32+108>>2]=1.0;k[p+32+112>>2]=0;k[p+32+116>>2]=k[m>>2];k[p+32+116+4>>2]=k[m+4>>2];k[p+32+116+8>>2]=k[m+8>>2];k[p+32+116+12>>2]=k[m+12>>2];o[p+32+132>>2]=1.0;k[p+32+136>>2]=0;k[p+32+136+4>>2]=0;k[p+32+136+8>>2]=0;k[p+32+136+12>>2]=0;o[p+32+152>>2]=1.0;k[p+32+156>>2]=0;k[p+32+156+4>>2]=0;k[p+32+156+8>>2]=0;k[p+32+156+12>>2]=0;o[p+32+172>>2]=1.0;k[p+32+176>>2]=0;k[p+32+180>>2]=k[c>>2];k[p+32+180+4>>2]=k[c+4>>2];k[p+32+180+8>>2]=k[c+8>>2];k[p+32+180+12>>2]=k[c+12>>2];e=+o[c>>2]-+o[b>>2];f=+o[c+4>>2]-+o[b+4>>2];g=+o[c+8>>2]-+o[b+8>>2];h=1.0/+Y(+(e*e+f*f+g*g));if(e*h==0.0)i=999999984306749440.0;else i=1.0/(e*h);o[p+32+4>>2]=i;if(f*h==0.0)j=999999984306749440.0;else j=1.0/(f*h);o[p+32+8>>2]=j;if(g*h==0.0)l=999999984306749440.0;else l=1.0/(g*h);o[p+32+12>>2]=l;k[p+32+20>>2]=i<0.0&1;k[p+32+24>>2]=j<0.0&1;k[p+32+28>>2]=l<0.0&1;o[p+32+32>>2]=e*h*(+o[n>>2]-+o[m>>2])+f*h*(+o[p+32+56>>2]-+o[p+32+40>>2])+g*h*(+o[p+32+60>>2]-+o[p+32+44>>2]);a=k[a+68>>2]|0;d=k[(k[a>>2]|0)+24>>2]|0;k[p+16>>2]=0;k[p+16+4>>2]=0;k[p+16+8>>2]=0;k[p+16+12>>2]=0;k[p>>2]=0;k[p+4>>2]=0;k[p+8>>2]=0;k[p+12>>2]=0;ec[d&7](a,b,c,p+32|0,p+16|0,p);r=p;return}function ws(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=+f;var g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0,p=0,q=0,s=0,t=0.0;q=r;r=r+416|0;Cw(8440);k[q+16>>2]=k[c>>2];k[q+16+4>>2]=k[c+4>>2];k[q+16+8>>2]=k[c+8>>2];k[q+16+12>>2]=k[c+12>>2];k[q+16+16>>2]=k[c+16>>2];k[q+16+16+4>>2]=k[c+16+4>>2];k[q+16+16+8>>2]=k[c+16+8>>2];k[q+16+16+12>>2]=k[c+16+12>>2];k[q+16+32>>2]=k[c+32>>2];k[q+16+32+4>>2]=k[c+32+4>>2];k[q+16+32+8>>2]=k[c+32+8>>2];k[q+16+32+12>>2]=k[c+32+12>>2];p=q+16+48|0;k[p>>2]=k[c+48>>2];k[p+4>>2]=k[c+48+4>>2];k[p+8>>2]=k[c+48+8>>2];k[p+12>>2]=k[c+48+12>>2];k[q+80>>2]=k[d>>2];k[q+80+4>>2]=k[d+4>>2];k[q+80+8>>2]=k[d+8>>2];k[q+80+12>>2]=k[d+12>>2];k[q+80+16>>2]=k[d+16>>2];k[q+80+16+4>>2]=k[d+16+4>>2];k[q+80+16+8>>2]=k[d+16+8>>2];k[q+80+16+12>>2]=k[d+16+12>>2];k[q+80+32>>2]=k[d+32>>2];k[q+80+32+4>>2]=k[d+32+4>>2];k[q+80+32+8>>2]=k[d+32+8>>2];k[q+80+32+12>>2]=k[d+32+12>>2];n=q+80+48|0;k[n>>2]=k[d+48>>2];k[n+4>>2]=k[d+48+4>>2];k[n+8>>2]=k[d+48+8>>2];k[n+12>>2]=k[d+48+12>>2];Rw(q+16|0,q+80|0,q+200|0,q+160|0);t=+o[q+160>>2];g=t*+o[q+200+4>>2];l=t*+o[q+200+8>>2];o[q+144>>2]=+o[q+200>>2]*t;o[q+144+4>>2]=g;o[q+144+8>>2]=l;o[q+144+12>>2]=0.0;k[q+184>>2]=0;k[q+184+4>>2]=0;k[q+184+8>>2]=0;k[q+184+12>>2]=0;k[q+200+4>>2]=0;k[q+200+4+4>>2]=0;k[q+200+24>>2]=0;k[q+200+24+4>>2]=0;s=q+200+44|0;k[s>>2]=0;k[s+4>>2]=0;k[s+8>>2]=0;k[s+12>>2]=0;k[s+16>>2]=0;Jw(q+16|0,q+168|0);l=+o[q+168>>2];g=+o[q+168+4>>2];t=+o[q+168+8>>2];j=+o[q+168+12>>2];h=l*(2.0/(l*l+g*g+t*t+j*j));m=g*(2.0/(l*l+g*g+t*t+j*j));i=t*(2.0/(l*l+g*g+t*t+j*j));o[q+200>>2]=1.0-(g*m+t*i);o[q+200+4>>2]=l*m-j*i;o[q+200+8>>2]=l*i+j*m;o[q+200+12>>2]=0.0;o[q+200+16>>2]=l*m+j*i;o[q+200+20>>2]=1.0-(l*h+t*i);o[q+200+24>>2]=g*i-j*h;o[q+200+28>>2]=0.0;o[q+200+32>>2]=l*i-j*m;o[q+200+36>>2]=g*i+j*h;o[q+200+40>>2]=1.0-(l*h+g*m);o[s>>2]=0.0;Wt(b,q+200|0,q+184|0,q+144|0,q+400|0,q);k[q+200>>2]=8720;k[q+200+36>>2]=k[c>>2];k[q+200+36+4>>2]=k[c+4>>2];k[q+200+36+8>>2]=k[c+8>>2];k[q+200+36+12>>2]=k[c+12>>2];k[q+200+52>>2]=k[c+16>>2];k[q+200+52+4>>2]=k[c+16+4>>2];k[q+200+52+8>>2]=k[c+16+8>>2];k[q+200+52+12>>2]=k[c+16+12>>2];k[q+200+68>>2]=k[c+32>>2];k[q+200+68+4>>2]=k[c+32+4>>2];k[q+200+68+8>>2]=k[c+32+8>>2];k[q+200+68+12>>2]=k[c+32+12>>2];s=q+200+84|0;k[s>>2]=k[c+48>>2];k[s+4>>2]=k[c+48+4>>2];k[s+8>>2]=k[c+48+8>>2];k[s+12>>2]=k[c+48+12>>2];k[q+200+100>>2]=k[d>>2];k[q+200+100+4>>2]=k[d+4>>2];k[q+200+100+8>>2]=k[d+8>>2];k[q+200+100+12>>2]=k[d+12>>2];k[q+200+116>>2]=k[d+16>>2];k[q+200+116+4>>2]=k[d+16+4>>2];k[q+200+116+8>>2]=k[d+16+8>>2];k[q+200+116+12>>2]=k[d+16+12>>2];k[q+200+132>>2]=k[d+32>>2];k[q+200+132+4>>2]=k[d+32+4>>2];k[q+200+132+8>>2]=k[d+32+8>>2];k[q+200+132+12>>2]=k[d+32+12>>2];c=q+200+148|0;k[c>>2]=k[d+48>>2];k[c+4>>2]=k[d+48+4>>2];k[c+8>>2]=k[d+48+8>>2];k[c+12>>2]=k[d+48+12>>2];k[q+200+180>>2]=a;k[q+200+184>>2]=e;o[q+200+188>>2]=f;k[q+200+192>>2]=b;m=+o[c>>2]-+o[s>>2];f=+o[q+200+152>>2]-+o[q+200+88>>2];g=+o[q+200+156>>2]-+o[q+200+92>>2];h=1.0/+Y(+(m*m+f*f+g*g));if(m*h==0.0)i=999999984306749440.0;else i=1.0/(m*h);o[q+200+4>>2]=i;if(f*h==0.0)j=999999984306749440.0;else j=1.0/(f*h);o[q+200+8>>2]=j;if(g*h==0.0)l=999999984306749440.0;else l=1.0/(g*h);o[q+200+12>>2]=l;k[q+200+20>>2]=i<0.0&1;k[q+200+24>>2]=j<0.0&1;k[q+200+28>>2]=l<0.0&1;o[q+200+32>>2]=g*(g*h)+(m*(m*h)+f*(f*h));b=k[a+68>>2]|0;ec[k[(k[b>>2]|0)+24>>2]&7](b,p,n,q+200|0,q+400|0,q);b=k[5104]|0;p=(k[b+16>>2]|0)+-1|0;k[b+16>>2]=p;if(p){r=q;return}do if(k[b+4>>2]|0){Kb(q+200|0,0)|0;p=k[5090]|0;o[b+8>>2]=+(((k[q+200+4>>2]|0)-(k[p+4>>2]|0)+(((k[q+200>>2]|0)-(k[p>>2]|0)|0)*1e6|0)-(k[b+12>>2]|0)|0)>>>0)/1.0e3+ +o[b+8>>2];if(!(k[b+16>>2]|0)){b=k[5104]|0;break}else{r=q;return}}while(0);k[5104]=k[b+20>>2];r=q;return}function xs(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0;e=r;r=r+96|0;f=k[b+192>>2]|0;k[e+64>>2]=0;k[e+64+4>>2]=f;k[e+64+8>>2]=b;k[e+64+12>>2]=b+4;k[e+64+16>>2]=-1;k[e+64+20>>2]=-1;b=k[c+192>>2]|0;k[e+40>>2]=0;k[e+40+4>>2]=b;k[e+40+8>>2]=c;k[e+40+12>>2]=c+4;k[e+40+16>>2]=-1;k[e+40+20>>2]=-1;b=k[a+24>>2]|0;b=_b[k[(k[b>>2]|0)+8>>2]&31](b,e+64|0,e+40|0,0)|0;if(!b){r=e;return}k[e+4>>2]=0;k[e+8>>2]=e+64;k[e+12>>2]=e+40;k[e>>2]=8600;k[e+32>>2]=d;Qb[k[(k[b>>2]|0)+8>>2]&31](b,e+64|0,e+40|0,a+28|0,e);Sb[k[k[b>>2]>>2]&255](b);f=k[a+24>>2]|0;Ub[k[(k[f>>2]|0)+60>>2]&127](f,b);r=e;return}function ys(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0.0,g=0.0,h=0.0,i=0,j=0,l=0,m=0,n=0,p=0,q=0,s=0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0;s=r;r=r+480|0;e=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;Ac[k[(k[e>>2]|0)+56>>2]&7](e,b,1.0);e=k[c+4>>2]|0;switch(e|0){case 0:{k[s+224>>2]=k[c+28>>2];k[s+224+4>>2]=k[c+28+4>>2];k[s+224+8>>2]=k[c+28+8>>2];k[s+224+12>>2]=k[c+28+12>>2];f=+gc[k[(k[c>>2]|0)+48>>2]&15](c);g=+gc[k[(k[c>>2]|0)+48>>2]&15](c);h=+gc[k[(k[c>>2]|0)+48>>2]&15](c);f=f+ +o[s+224>>2];o[s+224>>2]=f;g=g+ +o[s+224+4>>2];o[s+224+4>>2]=g;h=h+ +o[s+224+8>>2];o[s+224+8>>2]=h;a=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;c=k[(k[a>>2]|0)+72>>2]|0;o[s+160>>2]=-f;o[s+160+4>>2]=-g;o[s+160+8>>2]=-h;o[s+160+12>>2]=0.0;Qb[c&31](a,s+160|0,s+224|0,b,d);r=s;return}case 9:{e=k[c+92>>2]|0;if((e|0)<=0){r=s;return}do{q=e;e=e+-1|0;p=k[c+100>>2]|0;E=+o[p+(e<<4)>>2];D=+o[p+(e<<4)+4>>2];g=+o[p+(e<<4)+8>>2];p=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;n=k[(k[p>>2]|0)+16>>2]|0;h=+o[(k[c+120>>2]|0)+(e<<2)>>2];B=+o[b>>2];A=+o[b+4>>2];C=+o[b+8>>2];y=+o[b+16>>2];x=+o[b+20>>2];z=+o[b+24>>2];v=+o[b+32>>2];u=+o[b+36>>2];w=+o[b+40>>2];t=E*B+D*A+g*C+ +o[b+48>>2];f=E*y+D*x+g*z+ +o[b+52>>2];g=E*v+D*u+g*w+ +o[b+56>>2];o[s+80>>2]=B+A*0.0+C*0.0;o[s+80+4>>2]=B*0.0+A+C*0.0;o[s+80+8>>2]=C+(B*0.0+A*0.0);o[s+80+12>>2]=0.0;o[s+80+16>>2]=y+x*0.0+z*0.0;o[s+80+20>>2]=y*0.0+x+z*0.0;o[s+80+24>>2]=z+(y*0.0+x*0.0);o[s+80+28>>2]=0.0;o[s+80+32>>2]=v+u*0.0+w*0.0;o[s+80+36>>2]=v*0.0+u+w*0.0;o[s+80+40>>2]=w+(v*0.0+u*0.0);o[s+80+44>>2]=0.0;o[s+80+48>>2]=t;o[s+80+52>>2]=f;o[s+80+56>>2]=g;o[s+80+60>>2]=0.0;Zb[n&0](p,h,s+80|0,d)}while((q|0)>1);r=s;return}case 31:{e=k[c+16>>2]|0;if((e|0)<=0){r=s;return}do{q=e;e=e+-1|0;p=k[c+24>>2]|0;f=+o[p+(e*80|0)>>2];t=+o[p+(e*80|0)+4>>2];u=+o[p+(e*80|0)+8>>2];B=+o[p+(e*80|0)+16>>2];g=+o[p+(e*80|0)+20>>2];D=+o[p+(e*80|0)+24>>2];A=+o[p+(e*80|0)+32>>2];C=+o[p+(e*80|0)+36>>2];w=+o[p+(e*80|0)+40>>2];M=+o[p+(e*80|0)+48>>2];L=+o[p+(e*80|0)+52>>2];E=+o[p+(e*80|0)+56>>2];p=k[p+(e*80|0)+64>>2]|0;n=k[(k[a>>2]|0)+28>>2]|0;K=+o[b>>2];J=+o[b+4>>2];I=+o[b+8>>2];H=+o[b+16>>2];G=+o[b+20>>2];F=+o[b+24>>2];h=+o[b+32>>2];v=+o[b+36>>2];x=+o[b+40>>2];y=M*K+L*J+E*I+ +o[b+48>>2];z=M*H+L*G+E*F+ +o[b+52>>2];E=M*h+L*v+E*x+ +o[b+56>>2];o[s+400>>2]=f*K+B*J+A*I;o[s+400+4>>2]=t*K+g*J+C*I;o[s+400+8>>2]=u*K+D*J+w*I;o[s+400+12>>2]=0.0;o[s+400+16>>2]=f*H+B*G+A*F;o[s+400+20>>2]=t*H+g*G+C*F;o[s+400+24>>2]=u*H+D*G+w*F;o[s+400+28>>2]=0.0;o[s+400+32>>2]=f*h+B*v+A*x;o[s+400+36>>2]=t*h+g*v+C*x;o[s+400+40>>2]=u*h+D*v+w*x;o[s+400+44>>2]=0.0;o[s+400+48>>2]=y;o[s+400+52>>2]=z;o[s+400+56>>2]=E;o[s+400+60>>2]=0.0;Cc[n&127](a,s+400|0,p,d)}while((q|0)>1);r=s;return}case 8:{M=+gc[k[(k[c>>2]|0)+48>>2]&15](c);a=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;Zb[k[(k[a>>2]|0)+16>>2]&0](a,M,b,d);r=s;return}case 13:{q=k[c+52>>2]|0;L=+gc[k[(k[c>>2]|0)+92>>2]&15](c);k[s+16>>2]=k[c+28>>2];k[s+16+4>>2]=k[c+28+4>>2];k[s+16+8>>2]=k[c+28+8>>2];k[s+16+12>>2]=k[c+28+12>>2];J=+gc[k[(k[c>>2]|0)+48>>2]&15](c);K=+gc[k[(k[c>>2]|0)+48>>2]&15](c);M=+gc[k[(k[c>>2]|0)+48>>2]&15](c);o[s+16>>2]=J+ +o[s+16>>2];o[s+16+4>>2]=K+ +o[s+16+4>>2];o[s+16+8>>2]=M+ +o[s+16+8>>2];M=+o[s+16+(q<<2)>>2];a=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;Yb[k[(k[a>>2]|0)+80>>2]&0](a,L,M,q,b,d);r=s;return}case 28:{M=+o[c+64>>2];a=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;jc[k[(k[a>>2]|0)+88>>2]&0](a,c+48|0,M,b,d);r=s;return}case 10:{q=k[c+52>>2]|0;L=+o[c+28+(((q+2|0)%3|0)<<2)>>2];M=+o[c+28+(q<<2)>>2];a=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;Yb[k[(k[a>>2]|0)+76>>2]&0](a,L,M,q,b,d);r=s;return}case 11:{L=+o[c+56>>2];M=+o[c+60>>2];c=k[c+68>>2]|0;a=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;Yb[k[(k[a>>2]|0)+84>>2]&0](a,L,M,c,b,d);r=s;return}default:{a:do if((e|0)<7){p=k[c+52>>2]|0;if(!p){if((Wb[k[(k[c>>2]|0)+100>>2]&127](c)|0)<=0)break;e=0;while(1){Cc[k[(k[c>>2]|0)+104>>2]&127](c,e,s+144|0,s+176|0);K=+o[s+144>>2];D=+o[b>>2];I=+o[s+144+4>>2];v=+o[b+4>>2];G=+o[s+144+8>>2];w=+o[b+8>>2];y=+o[b+16>>2];z=+o[b+20>>2];E=+o[b+24>>2];H=+o[b+32>>2];J=+o[b+36>>2];L=+o[b+40>>2];x=+o[b+48>>2];F=+o[b+52>>2];M=+o[b+56>>2];o[s+192>>2]=K*D+I*v+G*w+x;o[s+192+4>>2]=K*y+I*z+G*E+F;o[s+192+8>>2]=K*H+I*J+G*L+M;o[s+192+12>>2]=0.0;G=+o[s+176>>2];I=+o[s+176+4>>2];K=+o[s+176+8>>2];o[s>>2]=G*D+I*v+K*w+x;o[s+4>>2]=G*y+I*z+K*E+F;o[s+8>>2]=G*H+I*J+K*L+M;o[s+12>>2]=0.0;q=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;Cc[k[(k[q>>2]|0)+8>>2]&127](q,s+192|0,s,d);e=e+1|0;if((e|0)>=(Wb[k[(k[c>>2]|0)+100>>2]&127](c)|0))break a}}if((k[p+28>>2]|0)>0){q=0;do{e=k[p+36>>2]|0;n=k[e+(q*36|0)+4>>2]|0;b:do if((n|0)>0){l=k[e+(q*36|0)+12>>2]|0;i=l;h=0.0;g=0.0;f=0.0;l=k[l+(n+-1<<2)>>2]|0;e=0;while(1){m=k[i+(e<<2)>>2]|0;j=k[p+16>>2]|0;h=h+ +o[j+(m<<4)>>2];g=g+ +o[j+(m<<4)+4>>2];f=f+ +o[j+(m<<4)+8>>2];j=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;i=k[(k[j>>2]|0)+8>>2]|0;N=k[p+16>>2]|0;K=+o[N+(l<<4)>>2];D=+o[b>>2];I=+o[N+(l<<4)+4>>2];v=+o[b+4>>2];G=+o[N+(l<<4)+8>>2];w=+o[b+8>>2];y=+o[b+16>>2];z=+o[b+20>>2];E=+o[b+24>>2];H=+o[b+32>>2];J=+o[b+36>>2];L=+o[b+40>>2];x=+o[b+48>>2];F=+o[b+52>>2];M=+o[b+56>>2];o[s+32>>2]=K*D+I*v+G*w+x;o[s+32+4>>2]=K*y+I*z+G*E+F;o[s+32+8>>2]=K*H+I*J+G*L+M;o[s+32+12>>2]=0.0;G=+o[N+(m<<4)>>2];I=+o[N+(m<<4)+4>>2];K=+o[N+(m<<4)+8>>2];o[s+240>>2]=G*D+I*v+K*w+x;o[s+240+4>>2]=G*y+I*z+K*E+F;o[s+240+8>>2]=G*H+I*J+K*L+M;o[s+240+12>>2]=0.0;Cc[i&127](j,s+32|0,s+240|0,d);j=e+1|0;e=k[p+36>>2]|0;if((j|0)>=(k[e+(q*36|0)+4>>2]|0))break b;i=k[e+(q*36|0)+12>>2]|0;l=m;e=j}}else{h=0.0;g=0.0;f=0.0}while(0);h=h*(1.0/+(n|0));g=g*(1.0/+(n|0));f=f*(1.0/+(n|0));N=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;if((Wb[k[(k[N>>2]|0)+48>>2]&127](N)|0)&16384){o[s+352>>2]=1.0;o[s+352+4>>2]=1.0;o[s+352+8>>2]=0.0;o[s+352+12>>2]=0.0;N=k[p+36>>2]|0;G=+o[N+(q*36|0)+20>>2];I=+o[N+(q*36|0)+24>>2];K=+o[N+(q*36|0)+28>>2];N=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;n=k[(k[N>>2]|0)+8>>2]|0;D=+o[b>>2];v=+o[b+4>>2];w=+o[b+8>>2];y=+o[b+16>>2];z=+o[b+20>>2];E=+o[b+24>>2];H=+o[b+32>>2];J=+o[b+36>>2];L=+o[b+40>>2];x=+o[b+48>>2];F=+o[b+52>>2];M=+o[b+56>>2];o[s+384>>2]=h*D+g*v+f*w+x;o[s+384+4>>2]=h*y+g*z+f*E+F;o[s+384+8>>2]=h*H+g*J+f*L+M;o[s+384+12>>2]=0.0;o[s+464>>2]=(h+G)*D+(g+I)*v+(f+K)*w+x;o[s+464+4>>2]=(h+G)*y+(g+I)*z+(f+K)*E+F;o[s+464+8>>2]=(h+G)*H+(g+I)*J+(f+K)*L+M;o[s+464+12>>2]=0.0;Cc[n&127](N,s+384|0,s+464|0,s+352|0)}q=q+1|0}while((q|0)<(k[p+28>>2]|0))}}while(0);e=k[c+4>>2]|0;if((e+-21|0)>>>0<9){o[s+208>>2]=999999984306749440.0;o[s+208+4>>2]=999999984306749440.0;o[s+208+8>>2]=999999984306749440.0;o[s+208+12>>2]=0.0;o[s+48>>2]=-999999984306749440.0;o[s+48+4>>2]=-999999984306749440.0;o[s+48+8>>2]=-999999984306749440.0;o[s+48+12>>2]=0.0;e=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;k[s+256>>2]=8496;k[s+256+4>>2]=8520;k[s+256+8>>2]=e;k[s+256+12>>2]=k[d>>2];k[s+256+12+4>>2]=k[d+4>>2];k[s+256+12+8>>2]=k[d+8>>2];k[s+256+12+12>>2]=k[d+12>>2];k[s+256+28>>2]=k[b>>2];k[s+256+28+4>>2]=k[b+4>>2];k[s+256+28+8>>2]=k[b+8>>2];k[s+256+28+12>>2]=k[b+12>>2];k[s+256+44>>2]=k[b+16>>2];k[s+256+44+4>>2]=k[b+16+4>>2];k[s+256+44+8>>2]=k[b+16+8>>2];k[s+256+44+12>>2]=k[b+16+12>>2];k[s+256+60>>2]=k[b+32>>2];k[s+256+60+4>>2]=k[b+32+4>>2];k[s+256+60+8>>2]=k[b+32+8>>2];k[s+256+60+12>>2]=k[b+32+12>>2];k[s+256+76>>2]=k[b+48>>2];k[s+256+76+4>>2]=k[b+48+4>>2];k[s+256+76+8>>2]=k[b+48+8>>2];k[s+256+76+12>>2]=k[b+48+12>>2];Cc[k[(k[c>>2]|0)+64>>2]&127](c,s+256|0,s+48|0,s+208|0);e=k[c+4>>2]|0}if((e|0)!=3){r=s;return}o[s+64>>2]=999999984306749440.0;o[s+64+4>>2]=999999984306749440.0;o[s+64+8>>2]=999999984306749440.0;o[s+64+12>>2]=0.0;o[s+368>>2]=-999999984306749440.0;o[s+368+4>>2]=-999999984306749440.0;o[s+368+8>>2]=-999999984306749440.0;o[s+368+12>>2]=0.0;N=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;k[s+256>>2]=8496;k[s+256+4>>2]=8520;k[s+256+8>>2]=N;k[s+256+12>>2]=k[d>>2];k[s+256+12+4>>2]=k[d+4>>2];k[s+256+12+8>>2]=k[d+8>>2];k[s+256+12+12>>2]=k[d+12>>2];k[s+256+28>>2]=k[b>>2];k[s+256+28+4>>2]=k[b+4>>2];k[s+256+28+8>>2]=k[b+8>>2];k[s+256+28+12>>2]=k[b+12>>2];k[s+256+44>>2]=k[b+16>>2];k[s+256+44+4>>2]=k[b+16+4>>2];k[s+256+44+8>>2]=k[b+16+8>>2];k[s+256+44+12>>2]=k[b+16+12>>2];k[s+256+60>>2]=k[b+32>>2];k[s+256+60+4>>2]=k[b+32+4>>2];k[s+256+60+8>>2]=k[b+32+8>>2];k[s+256+60+12>>2]=k[b+32+12>>2];k[s+256+76>>2]=k[b+48>>2];k[s+256+76+4>>2]=k[b+48+4>>2];k[s+256+76+8>>2]=k[b+48+8>>2];k[s+256+76+12>>2]=k[b+48+12>>2];b=k[c+92>>2]|0;Cc[k[(k[b>>2]|0)+8>>2]&127](b,s+256+4|0,s+368|0,s+64|0);r=s;return}}}function zs(a){a=a|0;var b=0.0,c=0,d=0,e=0,f=0,g=0,h=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0,q=0;q=r;r=r+112|0;if(((Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0)!=0?(p=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0,((Wb[k[(k[p>>2]|0)+48>>2]&127](p)|0)&8|0)!=0):0)?(c=k[a+24>>2]|0,c=Wb[k[(k[c>>2]|0)+36>>2]&127](c)|0,o[q+32>>2]=1.0,o[q+32+4>>2]=1.0,o[q+32+8>>2]=0.0,o[q+32+12>>2]=0.0,(c|0)>0):0){f=0;while(1){d=k[a+24>>2]|0;d=nc[k[(k[d>>2]|0)+40>>2]&31](d,f)|0;e=k[d+748>>2]|0;if((e|0)>0){g=0;while(1){p=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;Tb[k[(k[p>>2]|0)+32>>2]&0](p,d+4+(g*184|0)+32|0,d+4+(g*184|0)+64|0,+o[d+4+(g*184|0)+80>>2],k[d+4+(g*184|0)+148>>2]|0,q+32|0);if((g|0)==(e+-1|0))break;else g=g+1|0}}if((f|0)==(c+-1|0))break;else f=f+1|0}}if(!(Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0)){r=q;return}p=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0;if(!((Wb[k[(k[p>>2]|0)+48>>2]&127](p)|0)&3)){r=q;return}if((k[a+8>>2]|0)<=0){r=q;return}e=q+64+4|0;d=q+64+8|0;c=q+64+12|0;p=0;do{f=k[(k[a+16>>2]|0)+(p<<2)>>2]|0;if(!(k[f+204>>2]&32)){if((Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0)!=0?(g=Wb[k[(k[a>>2]|0)+20>>2]&127](a)|0,((Wb[k[(k[g>>2]|0)+48>>2]&127](g)|0)&1|0)!=0):0){o[q+64>>2]=1.0;o[e>>2]=1.0;o[d>>2]=1.0;o[c>>2]=0.0;switch(k[f+216>>2]|0){case 1:{o[q+64>>2]=1.0;o[e>>2]=1.0;o[d>>2]=1.0;o[c>>2]=0.0;break}case 2:{o[q+64>>2]=0.0;o[e>>2]=1.0;o[d>>2]=0.0;o[c>>2]=0.0;break}case 4:{o[q+64>>2]=1.0;o[e>>2]=0.0;o[d>>2]=0.0;o[c>>2]=0.0;break}case 3:{o[q+64>>2]=0.0;o[e>>2]=1.0;o[d>>2]=1.0;o[c>>2]=0.0;break}case 5:{o[q+64>>2]=1.0;o[e>>2]=1.0;o[d>>2]=0.0;o[c>>2]=0.0;break}default:{o[q+64>>2]=1.0;o[e>>2]=0.0;o[d>>2]=0.0;o[c>>2]=0.0}}Cc[k[(k[a>>2]|0)+28>>2]&127](a,f+4|0,k[f+192>>2]|0,q+64|0)}g=k[a+72>>2]|0;if((g|0)!=0?((Wb[k[(k[g>>2]|0)+48>>2]&127](g)|0)&2|0)!=0:0){o[q+16>>2]=1.0;o[q+16+4>>2]=0.0;o[q+16+8>>2]=0.0;o[q+16+12>>2]=0.0;g=k[f+192>>2]|0;Cc[k[(k[g>>2]|0)+8>>2]&127](g,f+4|0,q+80|0,q+96|0);o[q+80>>2]=+o[q+80>>2]+-.019999999552965164;o[q+80+4>>2]=+o[q+80+4>>2]+-.019999999552965164;o[q+80+8>>2]=+o[q+80+8>>2]+-.019999999552965164;o[q+96>>2]=+o[q+96>>2]+.019999999552965164;o[q+96+4>>2]=+o[q+96+4>>2]+.019999999552965164;o[q+96+8>>2]=+o[q+96+8>>2]+.019999999552965164;do if(((i[a+44>>0]|0)!=0?(k[f+236>>2]|0)==2:0)?(k[f+204>>2]&3|0)==0:0){g=k[f+192>>2]|0;Cc[k[(k[g>>2]|0)+8>>2]&127](g,f+68|0,q,q+48|0);b=+o[q>>2]+-.019999999552965164;o[q>>2]=b;h=+o[q+4>>2]+-.019999999552965164;o[q+4>>2]=h;j=+o[q+8>>2]+-.019999999552965164;o[q+8>>2]=j;l=+o[q+48>>2]+.019999999552965164;o[q+48>>2]=l;m=+o[q+48+4>>2]+.019999999552965164;o[q+48+4>>2]=m;n=+o[q+48+8>>2]+.019999999552965164;o[q+48+8>>2]=n;if(b<+o[q+80>>2])o[q+80>>2]=b;if(h<+o[q+80+4>>2])o[q+80+4>>2]=h;if(j<+o[q+80+8>>2])o[q+80+8>>2]=j;b=+o[q+12>>2];if(b<+o[q+80+12>>2])o[q+80+12>>2]=b;if(+o[q+96>>2]<l)o[q+96>>2]=l;if(+o[q+96+4>>2]<m)o[q+96+4>>2]=m;if(+o[q+96+8>>2]<n)o[q+96+8>>2]=n;b=+o[q+48+12>>2];if(!(+o[q+96+12>>2]<b))break;o[q+96+12>>2]=b}while(0);g=k[a+72>>2]|0;Cc[k[(k[g>>2]|0)+52>>2]&127](g,q+80|0,q+96|0,q+16|0)}}p=p+1|0}while((p|0)<(k[a+8>>2]|0));r=q;return}function As(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0,j=0,l=0,m=0,n=0,o=0,p=0,q=0,s=0,t=0,u=0,v=0,w=0;w=r;r=r+80|0;c=k[a+8>>2]|0;if((c|0)>0){e=0;do{d=k[(k[a+16>>2]|0)+(e<<2)>>2]|0;if((k[d+236>>2]|0)==1){Ub[k[(k[d>>2]|0)+24>>2]&127](d,b);c=k[a+8>>2]|0}e=e+1|0}while((e|0)<(c|0))}i[w+16>>0]=1;k[w+12>>2]=0;k[w+4>>2]=0;k[w+8>>2]=0;i[w+36>>0]=1;k[w+32>>2]=0;k[w+24>>2]=0;k[w+28>>2]=0;i[w+56>>0]=1;k[w+52>>2]=0;k[w+44>>2]=0;k[w+48>>2]=0;i[w+76>>0]=1;k[w+72>>2]=0;k[w+64>>2]=0;k[w+68>>2]=0;if((c|0)<=0){bx(w);r=w;return}n=0;h=0;f=0;d=0;q=0;while(1){p=k[(k[(k[a+16>>2]|0)+(q<<2)>>2]|0)+192>>2]|0;o=(p+~(p<<15)>>10^p+~(p<<15))*9|0;o=(o>>6^o)+~((o>>6^o)<<11)>>16^(o>>6^o)+~((o>>6^o)<<11);m=n+-1|0;e=(o&m)>>>0<h>>>0;a:do if(e){h=k[f+((o&m)<<2)>>2]|0;if((h|0)!=-1){j=k[w+72>>2]|0;while(1){if((p|0)==(k[j+(h<<3)>>2]|0)){l=13;break}g=k[d+(h<<2)>>2]|0;if((g|0)==-1)break;else h=g}if((l|0)==13?(l=0,((k[w+52>>2]|0)+(h<<2)|0)!=0):0){e=n;break}if(!e){l=20;break}}e=k[f+((o&m)<<2)>>2]|0;if((e|0)!=-1){g=k[w+72>>2]|0;while(1){if((p|0)==(k[g+(e<<3)>>2]|0))break;e=k[d+(e<<2)>>2]|0;if((e|0)==-1){l=20;break a}}k[(k[w+52>>2]|0)+(e<<2)>>2]=p;e=n;l=105}else l=20}else l=20;while(0);if((l|0)==20){l=k[w+44>>2]|0;if((l|0)==(n|0)){g=(n|0)==0?1:n<<1;if((n|0)<(g|0)){if((g|0)!=0?(k[5108]=(k[5108]|0)+1,v=iF((g<<2|3)+16|0)|0,(v|0)!=0):0){k[(v+4+15&-16)+-4>>2]=v;d=v+4+15&-16}else d=0;if((n|0)>0){e=0;while(1){f=d+(e<<2)|0;if(f)k[f>>2]=k[(k[w+52>>2]|0)+(e<<2)>>2];if((e|0)==(m|0))break;else e=e+1|0}}e=k[w+52>>2]|0;if(e){if(i[w+56>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0)}k[w+52>>2]=0}i[w+56>>0]=1;k[w+52>>2]=d;k[w+48>>2]=g;d=n}else d=n}else d=l;e=(k[w+52>>2]|0)+(d<<2)|0;if(e)k[e>>2]=p;k[w+44>>2]=d+1;e=k[w+64>>2]|0;if((e|0)==(k[w+68>>2]|0)?(s=(e|0)==0?1:e<<1,(e|0)<(s|0)):0){if((s|0)!=0?(k[5108]=(k[5108]|0)+1,t=iF((s<<3|3)+16|0)|0,(t|0)!=0):0){k[(t+4+15&-16)+-4>>2]=t;g=t+4+15&-16}else g=0;if((e|0)>0){d=0;while(1){f=g+(d<<3)|0;if(f){h=(k[w+72>>2]|0)+(d<<3)|0;j=k[h+4>>2]|0;k[f>>2]=k[h>>2];k[f+4>>2]=j}if((d|0)==(e+-1|0))break;else d=d+1|0}}e=k[w+72>>2]|0;if(e){if(i[w+76>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0)}k[w+72>>2]=0}i[w+76>>0]=1;k[w+72>>2]=g;k[w+68>>2]=s;e=k[w+64>>2]|0}d=(k[w+72>>2]|0)+(e<<3)|0;if(d){k[d>>2]=p;k[d+4>>2]=0}k[w+64>>2]=e+1;e=k[w+48>>2]|0;if((n|0)<(e|0)){j=k[w+4>>2]|0;do if((j|0)<(e|0)){if((j|0)<=(e|0)){if((k[w+8>>2]|0)<(e|0)){if((e|0)!=0?(k[5108]=(k[5108]|0)+1,u=iF((e<<2|3)+16|0)|0,(u|0)!=0):0){k[(u+4+15&-16)+-4>>2]=u;c=u+4+15&-16}else c=0;if((j|0)>0){d=k[w+12>>2]|0;g=0;while(1){f=c+(g<<2)|0;if(f)k[f>>2]=k[d+(g<<2)>>2];if((g|0)==(j+-1|0))break;else g=g+1|0}}else d=k[w+12>>2]|0;if(d){if(i[w+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[w+12>>2]=0}i[w+16>>0]=1;k[w+12>>2]=c;k[w+8>>2]=e}else c=k[w+12>>2]|0;f=j;while(1){d=c+(f<<2)|0;if(d)k[d>>2]=0;if((f|0)==(e+-1|0))break;else f=f+1|0}}k[w+4>>2]=e;f=k[w+24>>2]|0;if((f|0)<(e|0)){if((k[w+28>>2]|0)<(e|0)){do if(!e)c=0;else{k[5108]=(k[5108]|0)+1;d=iF((e<<2|3)+16|0)|0;if(!d){c=0;break}k[(d+4+15&-16)+-4>>2]=d;c=d+4+15&-16}while(0);if((f|0)>0){d=k[w+32>>2]|0;h=0;while(1){g=c+(h<<2)|0;if(g)k[g>>2]=k[d+(h<<2)>>2];if((h|0)==(f+-1|0))break;else h=h+1|0}}else d=k[w+32>>2]|0;if(d){if(i[w+36>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[w+32>>2]=0}i[w+36>>0]=1;k[w+32>>2]=c;k[w+28>>2]=e}else c=k[w+32>>2]|0;while(1){d=c+(f<<2)|0;if(d)k[d>>2]=0;if((f|0)==(e+-1|0))break;else f=f+1|0}}k[w+24>>2]=e;if((e|0)>0){nF(k[w+12>>2]|0,-1,e<<2|0)|0;nF(k[w+32>>2]|0,-1,e<<2|0)|0}if((j|0)<=0){e=k[w+48>>2]|0;break}f=k[w+72>>2]|0;d=k[w+12>>2]|0;c=k[w+32>>2]|0;e=k[w+48>>2]|0;g=0;while(1){n=k[f+(g<<3)>>2]|0;n=(n+~(n<<15)>>10^n+~(n<<15))*9|0;n=d+((((n>>6^n)+~((n>>6^n)<<11)>>16^(n>>6^n)+~((n>>6^n)<<11))&e+-1)<<2)|0;k[c+(g<<2)>>2]=k[n>>2];k[n>>2]=g;if((g|0)==(j+-1|0))break;else g=g+1|0}}while(0);c=e;d=o&e+-1}else{c=e;d=o&m}f=k[w+12>>2]|0;e=f+(d<<2)|0;d=k[w+32>>2]|0;k[d+(l<<2)>>2]=k[e>>2];k[e>>2]=l;e=c;l=105}if((l|0)==105){l=0;Ub[k[(k[p>>2]|0)+60>>2]&127](p,b);c=k[a+8>>2]|0}g=q+1|0;if((g|0)>=(c|0))break;n=e;h=k[w+4>>2]|0;q=g}bx(w);r=w;return}function Bs(a,b){a=a|0;b=b|0;Sb[k[(k[b>>2]|0)+32>>2]&255](b);As(a,b);Sb[k[(k[b>>2]|0)+36>>2]&255](b);return}function Cs(a){a=a|0;var b=0;k[a>>2]=10312;if(!(i[a+8>>0]|0))return;b=k[a+12>>2]|0;if(!b)return;a=k[a+4>>2]|0;Ub[k[(k[a>>2]|0)+16>>2]&127](a,b);return}function Ds(a){a=a|0;var b=0,c=0;k[a>>2]=10312;if(!(i[a+8>>0]|0)){jF(a);return}b=k[a+12>>2]|0;if(!b){jF(a);return}c=k[a+4>>2]|0;Ub[k[(k[c>>2]|0)+16>>2]&127](c,b);jF(a);return}function Es(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,l=0,m=0.0,n=0;h=r;r=r+160|0;f=k[a+12>>2]|0;if(!f){r=h;return}j=(i[a+16>>0]|0)!=0;l=j?c:b;b=j?b:c;n=k[l+4>>2]|0;c=k[b+4>>2]|0;k[e+4>>2]=f;m=+o[f+752>>2];k[h+136>>2]=19824;k[h+136+4>>2]=n;k[h+136+8>>2]=c;o[h+136+12>>2]=m;o[h+128>>2]=999999984306749440.0;f=k[l+12>>2]|0;k[h>>2]=k[f>>2];k[h+4>>2]=k[f+4>>2];k[h+8>>2]=k[f+8>>2];k[h+12>>2]=k[f+12>>2];k[h+16>>2]=k[f+16>>2];k[h+16+4>>2]=k[f+16+4>>2];k[h+16+8>>2]=k[f+16+8>>2];k[h+16+12>>2]=k[f+16+12>>2];k[h+32>>2]=k[f+32>>2];k[h+32+4>>2]=k[f+32+4>>2];k[h+32+8>>2]=k[f+32+8>>2];k[h+32+12>>2]=k[f+32+12>>2];k[h+48>>2]=k[f+48>>2];k[h+48+4>>2]=k[f+48+4>>2];k[h+48+8>>2]=k[f+48+8>>2];k[h+48+12>>2]=k[f+48+12>>2];f=k[b+12>>2]|0;k[h+64>>2]=k[f>>2];k[h+64+4>>2]=k[f+4>>2];k[h+64+8>>2]=k[f+8>>2];k[h+64+12>>2]=k[f+12>>2];k[h+80>>2]=k[f+16>>2];k[h+80+4>>2]=k[f+16+4>>2];k[h+80+8>>2]=k[f+16+8>>2];k[h+80+12>>2]=k[f+16+12>>2];k[h+96>>2]=k[f+32>>2];k[h+96+4>>2]=k[f+32+4>>2];k[h+96+8>>2]=k[f+32+8>>2];k[h+96+12>>2]=k[f+32+12>>2];k[h+112>>2]=k[f+48>>2];k[h+112+4>>2]=k[f+48+4>>2];k[h+112+8>>2]=k[f+48+8>>2];k[h+112+12>>2]=k[f+48+12>>2];iw(h+136|0,h,e,k[d+20>>2]|0,j);do if((i[a+8>>0]|0)!=0?(g=k[e+4>>2]|0,(k[g+748>>2]|0)!=0):0){b=k[g+740>>2]|0;f=k[(k[e+8>>2]|0)+8>>2]|0;c=k[(k[e+12>>2]|0)+8>>2]|0;if((b|0)==(f|0)){rr(g,b+4|0,c+4|0);break}else{rr(g,c+4|0,f+4|0);break}}while(0);r=h;return}function Fs(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;return 1.0}function Gs(a){a=a|0;return}function Hs(a){a=a|0;jF(a);return}function Is(a){a=a|0;var b=0;k[a>>2]=10424;if(!(i[a+16>>0]|0))return;b=k[a+20>>2]|0;if(!b)return;a=k[a+4>>2]|0;Ub[k[(k[a>>2]|0)+16>>2]&127](a,b);return}function Js(a){a=a|0;var b=0,c=0;k[a>>2]=10424;if(!(i[a+16>>0]|0)){jF(a);return}b=k[a+20>>2]|0;if(!b){jF(a);return}c=k[a+4>>2]|0;Ub[k[(k[c>>2]|0)+16>>2]&127](c,b);jF(a);return}
function xq(a){a=a|0;var b=0.0,c=0,d=0,e=0.0,f=0.0,g=0.0,h=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0,M=0,N=0.0,O=0.0,P=0.0,Q=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0;L=r;r=r+176|0;if(!(i[a+738>>0]|0)){r=L;return}o[a+36>>2]=0.0;o[a+744>>2]=0.0;if(!(i[a+736>>0]|0)){d=k[a+28>>2]|0;l=+o[a+600>>2];n=+o[a+604>>2];u=+o[a+608>>2];v=l*+o[d+20>>2]+n*+o[d+24>>2]+u*+o[d+28>>2]+ +o[d+56>>2];c=k[a+32>>2]|0;w=+o[a+664>>2];x=+o[c+4>>2];y=+o[a+668>>2];z=+o[c+8>>2];A=+o[a+672>>2];B=+o[c+12>>2];C=+o[c+20>>2];D=+o[c+24>>2];E=+o[c+28>>2];F=+o[c+36>>2];G=+o[c+40>>2];H=+o[c+44>>2];I=+o[c+52>>2];J=+o[c+56>>2];K=+o[c+60>>2];m=w*C+y*D+A*E+J-v;t=l*+o[d+4>>2]+n*+o[d+8>>2]+u*+o[d+12>>2]+ +o[d+52>>2];u=l*+o[d+36>>2]+n*+o[d+40>>2]+u*+o[d+44>>2]+ +o[d+60>>2];n=w*x+y*z+A*B+I-t;l=w*F+y*G+A*H+K-u;if(n*n+m*m+l*l>1.1920928955078125e-07){s=1.0/+Y(+(n*n+m*m+l*l));j=n*s;n=m*s;m=l*s}else{j=1.0;n=0.0;m=0.0}o[L+128>>2]=j;o[L+128+4>>2]=n;o[L+128+8>>2]=m;o[L+128+12>>2]=0.0;if(+X(+m)>.7071067690849304){q=m*m+n*n;s=1.0/+Y(+q);l=-(s*m);m=s*n;f=-(j*m);h=j*l;n=q*s;j=0.0}else{q=j*j+n*n;h=1.0/+Y(+q);s=-(n*h);l=h*j;f=m*s;h=q*h;n=-(m*l);m=0.0;j=s}o[L+128+16>>2]=j;o[L+128+20>>2]=l;o[L+128+24>>2]=m;o[L+128+32>>2]=n;o[L+128+36>>2]=f;o[L+128+40>>2]=h;n=x;m=C;l=F;j=z;h=D;f=G;e=B;g=E;b=H;p=I;q=J;s=K;d=0;while(1){M=k[a+28>>2]|0;o[L+80>>2]=+o[M+4>>2];o[L+80+4>>2]=+o[M+20>>2];o[L+80+8>>2]=+o[M+36>>2];o[L+80+12>>2]=0.0;o[L+80+16>>2]=+o[M+8>>2];o[L+80+20>>2]=+o[M+24>>2];o[L+80+24>>2]=+o[M+40>>2];o[L+80+28>>2]=0.0;o[L+80+32>>2]=+o[M+12>>2];o[L+80+36>>2]=+o[M+28>>2];o[L+80+40>>2]=+o[M+44>>2];o[L+80+44>>2]=0.0;o[L+32>>2]=n;o[L+32+4>>2]=m;o[L+32+8>>2]=l;o[L+32+12>>2]=0.0;o[L+32+16>>2]=j;o[L+32+20>>2]=h;o[L+32+24>>2]=f;o[L+32+28>>2]=0.0;o[L+32+32>>2]=e;o[L+32+36>>2]=g;o[L+32+40>>2]=b;o[L+32+44>>2]=0.0;m=v-+o[M+56>>2];n=u-+o[M+60>>2];o[L+16>>2]=t-+o[M+52>>2];o[L+16+4>>2]=m;o[L+16+8>>2]=n;o[L+16+12>>2]=0.0;o[L>>2]=w*x+y*z+A*B+I-p;o[L+4>>2]=w*C+y*D+A*E+J-q;o[L+8>>2]=w*F+y*G+A*H+K-s;o[L+12>>2]=0.0;Vw(a+48+(d*84|0)|0,L+80|0,L+32|0,L+16|0,L,L+128+(d<<4)|0,M+396|0,+o[M+344>>2],c+396|0,+o[c+344>>2]);d=d+1|0;if((d|0)==3)break;c=k[a+32>>2]|0;n=+o[c+4>>2];m=+o[c+20>>2];l=+o[c+36>>2];j=+o[c+8>>2];h=+o[c+24>>2];f=+o[c+40>>2];e=+o[c+12>>2];g=+o[c+28>>2];b=+o[c+44>>2];p=+o[c+52>>2];q=+o[c+56>>2];s=+o[c+60>>2]}}b=+o[a+560>>2];f=+o[a+576>>2];g=+o[a+592>>2];if(+X(+g)>.7071067690849304){n=1.0/+Y(+(f*f+g*g));e=b*-(g*n);h=0.0;j=-(g*n);l=f*n;m=(f*f+g*g)*n;n=-(b*(f*n))}else{n=1.0/+Y(+(b*b+f*f));e=(b*b+f*f)*n;h=-(f*n);j=b*n;l=0.0;m=-(g*(b*n));n=g*-(f*n)}d=k[a+28>>2]|0;C=+o[d+4>>2];p=+o[d+8>>2];H=+o[d+12>>2];P=h*C+j*p+l*H;F=+o[d+20>>2];A=+o[d+24>>2];J=+o[d+28>>2];R=h*F+j*A+l*J;w=+o[d+36>>2];u=+o[d+40>>2];s=+o[d+44>>2];U=h*w+j*u+l*s;t=m*C+n*p+e*H;l=m*F+n*A+e*J;j=m*w+n*u+e*s;c=k[a+32>>2]|0;v=+o[c+4>>2];x=+o[c+20>>2];y=+o[c+36>>2];D=+o[c+8>>2];E=+o[c+24>>2];I=+o[c+40>>2];N=+o[c+12>>2];Q=+o[c+28>>2];T=+o[c+44>>2];k[a+300>>2]=0;k[a+300+4>>2]=0;k[a+300+8>>2]=0;k[a+300+12>>2]=0;o[a+316>>2]=C*P+F*R+w*U;o[a+320>>2]=p*P+A*R+u*U;o[a+324>>2]=H*P+J*R+s*U;o[a+328>>2]=0.0;o[a+332>>2]=v*-P+x*-R+y*-U;o[a+336>>2]=D*-P+E*-R+I*-U;o[a+340>>2]=N*-P+Q*-R+T*-U;o[a+344>>2]=0.0;q=(C*P+F*R+w*U)*+o[d+396>>2];m=(p*P+A*R+u*U)*+o[d+400>>2];n=(H*P+J*R+s*U)*+o[d+404>>2];o[a+348>>2]=q;o[a+352>>2]=m;o[a+356>>2]=n;o[a+360>>2]=0.0;B=(v*-P+x*-R+y*-U)*+o[c+396>>2];K=(D*-P+E*-R+I*-U)*+o[c+400>>2];V=(N*-P+Q*-R+T*-U)*+o[c+404>>2];o[a+364>>2]=B;o[a+368>>2]=K;o[a+372>>2]=V;o[a+376>>2]=0.0;o[a+380>>2]=(C*P+F*R+w*U)*q+(p*P+A*R+u*U)*m+(H*P+J*R+s*U)*n+((v*-P+x*-R+y*-U)*B+(D*-P+E*-R+I*-U)*K+(N*-P+Q*-R+T*-U)*V);c=k[a+28>>2]|0;V=+o[c+4>>2];U=+o[c+20>>2];T=+o[c+36>>2];R=+o[c+8>>2];Q=+o[c+24>>2];P=+o[c+40>>2];N=+o[c+12>>2];K=+o[c+28>>2];I=+o[c+44>>2];d=k[a+32>>2]|0;E=+o[d+4>>2];D=+o[d+20>>2];B=+o[d+36>>2];y=+o[d+8>>2];x=+o[d+24>>2];v=+o[d+40>>2];n=+o[d+12>>2];m=+o[d+28>>2];q=+o[d+44>>2];k[a+384>>2]=0;k[a+384+4>>2]=0;k[a+384+8>>2]=0;k[a+384+12>>2]=0;o[a+400>>2]=t*V+l*U+j*T;o[a+404>>2]=t*R+l*Q+j*P;o[a+408>>2]=t*N+l*K+j*I;o[a+412>>2]=0.0;o[a+416>>2]=E*-t+D*-l+B*-j;o[a+420>>2]=y*-t+x*-l+v*-j;o[a+424>>2]=n*-t+m*-l+q*-j;o[a+428>>2]=0.0;S=(t*V+l*U+j*T)*+o[c+396>>2];O=(t*R+l*Q+j*P)*+o[c+400>>2];G=(t*N+l*K+j*I)*+o[c+404>>2];o[a+432>>2]=S;o[a+436>>2]=O;o[a+440>>2]=G;o[a+444>>2]=0.0;z=(E*-t+D*-l+B*-j)*+o[d+396>>2];e=(y*-t+x*-l+v*-j)*+o[d+400>>2];h=(n*-t+m*-l+q*-j)*+o[d+404>>2];o[a+448>>2]=z;o[a+452>>2]=e;o[a+456>>2]=h;o[a+460>>2]=0.0;o[a+464>>2]=(t*V+l*U+j*T)*S+(t*R+l*Q+j*P)*O+(t*N+l*K+j*I)*G+((E*-t+D*-l+B*-j)*z+(y*-t+x*-l+v*-j)*e+(n*-t+m*-l+q*-j)*h);d=k[a+28>>2]|0;h=+o[d+4>>2];j=+o[d+20>>2];q=+o[d+36>>2];l=+o[d+8>>2];m=+o[d+24>>2];t=+o[d+40>>2];n=+o[d+12>>2];e=+o[d+28>>2];v=+o[d+44>>2];c=k[a+32>>2]|0;x=+o[c+4>>2];y=+o[c+20>>2];z=+o[c+36>>2];B=+o[c+8>>2];D=+o[c+24>>2];E=+o[c+40>>2];G=+o[c+12>>2];I=+o[c+28>>2];K=+o[c+44>>2];k[a+468>>2]=0;k[a+468+4>>2]=0;k[a+468+8>>2]=0;k[a+468+12>>2]=0;q=(C*b+p*f+H*g)*h+(F*b+A*f+J*g)*j+(w*b+u*f+s*g)*q;t=(C*b+p*f+H*g)*l+(F*b+A*f+J*g)*m+(w*b+u*f+s*g)*t;v=(C*b+p*f+H*g)*n+(F*b+A*f+J*g)*e+(w*b+u*f+s*g)*v;o[a+484>>2]=q;o[a+488>>2]=t;o[a+492>>2]=v;o[a+496>>2]=0.0;H=-(C*b+p*f+H*g);J=-(F*b+A*f+J*g);e=-(w*b+u*f+s*g);o[a+500>>2]=x*H+y*J+z*e;o[a+504>>2]=B*H+D*J+E*e;o[a+508>>2]=G*H+I*J+K*e;o[a+512>>2]=0.0;s=q*+o[d+396>>2];u=t*+o[d+400>>2];w=v*+o[d+404>>2];o[a+516>>2]=s;o[a+520>>2]=u;o[a+524>>2]=w;o[a+528>>2]=0.0;A=(x*H+y*J+z*e)*+o[c+396>>2];F=(B*H+D*J+E*e)*+o[c+400>>2];b=(G*H+I*J+K*e)*+o[c+404>>2];o[a+532>>2]=A;o[a+536>>2]=F;o[a+540>>2]=b;o[a+544>>2]=0.0;o[a+548>>2]=q*s+t*u+v*w+((x*H+y*J+z*e)*A+(B*H+D*J+E*e)*F+(G*H+I*J+K*e)*b);o[a+724>>2]=0.0;c=k[a+28>>2]|0;d=k[a+32>>2]|0;b=+Aq(a,c+4|0,d+4|0);o[a+728>>2]=b;o[a+708>>2]=0.0;o[a+712>>2]=0.0;i[a+716>>0]=0;e=+o[a+692>>2];do if(e>=0.0){b=+kF(b-+o[a+688>>2],6.2831854820251465);if(!(b<-3.1415927410125732)){if(b>3.1415927410125732)b=b+-6.2831854820251465}else b=b+6.2831854820251465;if(b<-e){i[a+716>>0]=1;o[a+708>>2]=-(b+e);o[a+712>>2]=1.0;break}if(b>e){i[a+716>>0]=1;o[a+708>>2]=e-b;o[a+712>>2]=-1.0}}while(0);R=+o[a+560>>2];S=+o[a+576>>2];V=+o[a+592>>2];T=R*+o[c+4>>2]+S*+o[c+8>>2]+V*+o[c+12>>2];U=R*+o[c+20>>2]+S*+o[c+24>>2]+V*+o[c+28>>2];V=R*+o[c+36>>2]+S*+o[c+40>>2]+V*+o[c+44>>2];o[a+720>>2]=1.0/(T*(T*+o[c+264>>2]+U*+o[c+280>>2]+V*+o[c+296>>2])+U*(T*+o[c+268>>2]+U*+o[c+284>>2]+V*+o[c+300>>2])+V*(T*+o[c+272>>2]+U*+o[c+288>>2]+V*+o[c+304>>2])+(T*(T*+o[d+264>>2]+U*+o[d+280>>2]+V*+o[d+296>>2])+U*(T*+o[d+268>>2]+U*+o[d+284>>2]+V*+o[d+300>>2])+V*(T*+o[d+272>>2]+U*+o[d+288>>2]+V*+o[d+304>>2])));r=L;return}function yq(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0;if(i[a+738>>0]|0){k[b>>2]=0;k[b+4>>2]=0;return}k[b>>2]=5;k[b+4>>2]=1;c=+Aq(a,(k[a+28>>2]|0)+4|0,(k[a+32>>2]|0)+4|0);o[a+728>>2]=c;o[a+708>>2]=0.0;o[a+712>>2]=0.0;i[a+716>>0]=0;d=+o[a+692>>2];do if(d>=0.0){c=+kF(c-+o[a+688>>2],6.2831854820251465);if(!(c<-3.1415927410125732)){if(c>3.1415927410125732)c=c+-6.2831854820251465}else c=c+6.2831854820251465;if(c<-d){i[a+716>>0]=1;o[a+708>>2]=-(c+d);o[a+712>>2]=1.0;break}if(c>d){i[a+716>>0]=1;o[a+708>>2]=d-c;o[a+712>>2]=-1.0}else e=12}else e=12;while(0);if((e|0)==12?(i[a+737>>0]|0)==0:0)return;k[b>>2]=6;k[b+4>>2]=0;return}function zq(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0,f=0,g=0,h=0.0,j=0.0,l=0.0,m=0.0,n=0,p=0.0,q=0.0,s=0,t=0,u=0.0,v=0,w=0.0,x=0.0,y=0.0,z=0,A=0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0,Q=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0.0,X=0.0,Z=0.0,_=0,$=0,aa=0;aa=r;r=r+128|0;_=k[a+28>>2]|0;$=k[a+32>>2]|0;A=k[b+24>>2]|0;if(!(i[a+739>>0]|0)){Sw(aa+64|0,_+4|0,a+552|0);Sw(aa,$+4|0,a+616|0);d=+o[aa+64+48>>2];h=+o[aa+64+52>>2];c=+o[aa+64+56>>2];j=+o[aa+48>>2];l=+o[aa+52>>2];m=+o[aa+56>>2];n=(i[a+736>>0]|0)==0;if(n){f=k[b+8>>2]|0;o[f>>2]=1.0;o[f+(A+1<<2)>>2]=1.0;o[f+((A<<1)+2<<2)>>2]=1.0;f=k[b+16>>2]|0;o[f>>2]=-1.0;o[f+(A+1<<2)>>2]=-1.0;o[f+((A<<1)+2<<2)>>2]=-1.0;f=A<<1;e=A+1|0;g=(A<<1)+2|0}else{f=A<<1;e=A+1|0;g=(A<<1)+2|0}p=d-+o[_+52>>2];Z=h-+o[_+56>>2];X=c-+o[_+60>>2];s=k[b+12>>2]|0;o[s>>2]=0.0;o[s+4>>2]=X;o[s+8>>2]=-Z;o[s+12>>2]=0.0;o[s+(A<<2)>>2]=-X;o[s+(e<<2)>>2]=0.0;o[s+(A+2<<2)>>2]=p;o[s+(A+3<<2)>>2]=0.0;o[s+(f<<2)>>2]=Z;v=f|1;o[s+(v<<2)>>2]=-p;o[s+(g<<2)>>2]=0.0;z=f+3|0;o[s+(z<<2)>>2]=0.0;p=j-+o[$+52>>2];Z=l-+o[$+56>>2];X=m-+o[$+60>>2];t=k[b+20>>2]|0;o[t>>2]=0.0;o[t+4>>2]=-X;o[t+8>>2]=Z;o[t+12>>2]=0.0;o[t+(A<<2)>>2]=X;o[t+(e<<2)>>2]=0.0;o[t+(A+2<<2)>>2]=-p;o[t+(A+3<<2)>>2]=0.0;o[t+(f<<2)>>2]=-Z;o[t+(v<<2)>>2]=p;o[t+(g<<2)>>2]=0.0;o[t+(z<<2)>>2]=0.0;p=+o[b>>2]*+o[b+4>>2];g=k[b+28>>2]|0;if(n){o[g>>2]=p*(j-d);o[g+(A<<2)>>2]=p*(l-h);o[g+(A<<1<<2)>>2]=p*(m-c)}w=+o[aa+64+8>>2];x=+o[aa+64+24>>2];y=+o[aa+64+40>>2];R=+o[aa+64>>2];S=+o[aa+64+16>>2];Q=+o[aa+64+32>>2];U=+o[aa+64+4>>2];W=+o[aa+64+20>>2];T=+o[aa+64+36>>2];v=k[b+24>>2]|0;o[s+(v*3<<2)>>2]=R;o[s+((v*3|0)+1<<2)>>2]=S;o[s+((v*3|0)+2<<2)>>2]=Q;o[s+(v<<2<<2)>>2]=U;o[s+((v<<2|1)<<2)>>2]=W;o[s+((v<<2|2)<<2)>>2]=T;o[t+(v*3<<2)>>2]=-R;o[t+((v*3|0)+1<<2)>>2]=-S;o[t+((v*3|0)+2<<2)>>2]=-Q;o[t+(v<<2<<2)>>2]=-U;o[t+((v<<2|1)<<2)>>2]=-W;o[t+((v<<2|2)<<2)>>2]=-T;X=+o[aa+8>>2];V=+o[aa+24>>2];Z=+o[aa+40>>2];o[g+(v*3<<2)>>2]=p*(Q*(w*V-x*X)+(R*(x*Z-y*V)+S*(y*X-w*Z)));o[g+(v<<2<<2)>>2]=p*(T*(w*V-x*X)+(U*(x*Z-y*V)+W*(y*X-w*Z)));if(!(i[a+716>>0]|0)){z=0;u=0.0}else{u=+o[a+708>>2]*+o[a+732>>2];z=u>0.0?1:2}n=i[a+737>>0]|0;e=(z|0)!=0;if(n&255|z){o[s+(v*5<<2)>>2]=w;o[s+((v*5|0)+1<<2)>>2]=x;o[s+((v*5|0)+2<<2)>>2]=y;o[t+(v*5<<2)>>2]=-w;o[t+((v*5|0)+1<<2)>>2]=-x;o[t+((v*5|0)+2<<2)>>2]=-y;c=+o[a+688>>2];h=+o[a+692>>2];d=+kF(c-h,6.2831854820251465);if(!(d<-3.1415927410125732))if(d>3.1415927410125732)q=d+-6.2831854820251465;else q=d;else q=d+6.2831854820251465;d=+kF(c+h,6.2831854820251465);if(!(d<-3.1415927410125732)){if(d>3.1415927410125732)d=d+-6.2831854820251465}else d=d+6.2831854820251465;f=q==d;s=g+(v*5<<2)|0;o[s>>2]=0.0;g=k[a+748>>2]|0;j=+o[((g&2|0)==0?b+4|0:a+760|0)>>2];if(!(n<<24>>24==0|e&f)){if(g&4)o[(k[b+32>>2]|0)+(v*5<<2)>>2]=+o[a+752>>2];m=+o[a+728>>2];l=+o[a+680>>2];n=q>d;do if(!(n|f)){p=l/(j*+o[b>>2]);if(p<0.0)if(m>=q&q-p>m){d=(q-m)/p;break}else{d=m<q?0.0:1.0;break}if(p>0.0)if(m<=d&d-p<m){d=(d-m)/p;break}else{d=m>d?0.0:1.0;break}else d=0.0}else d=n?1.0:0.0;while(0);o[s>>2]=d*l*+o[a+732>>2]+ +o[s>>2];o[(k[b+36>>2]|0)+(v*5<<2)>>2]=-+o[a+684>>2];o[(k[b+40>>2]|0)+(v*5<<2)>>2]=+o[a+684>>2]}if(e){o[s>>2]=+o[s>>2]+u*(j*+o[b>>2]);if(g&1)o[(k[b+32>>2]|0)+(v*5<<2)>>2]=+o[a+756>>2];do if(!f){f=(k[b+36>>2]|0)+(v*5<<2)|0;e=k[b+40>>2]|0;if((z|0)==1){o[f>>2]=0.0;o[e+(v*5<<2)>>2]=3402823466385288598117041.0e14;break}else{o[f>>2]=-3402823466385288598117041.0e14;o[e+(v*5<<2)>>2]=0.0;break}}else{o[(k[b+36>>2]|0)+(v*5<<2)>>2]=-3402823466385288598117041.0e14;o[(k[b+40>>2]|0)+(v*5<<2)>>2]=3402823466385288598117041.0e14}while(0);d=+o[a+704>>2];do if(d>0.0){c=w*+o[_+328>>2]+x*+o[_+332>>2]+y*+o[_+336>>2]-(w*+o[$+328>>2]+x*+o[$+332>>2]+y*+o[$+336>>2]);if((z|0)==1){if(!(c<0.0))break;if(!(+o[s>>2]<-(d*c)))break;o[s>>2]=-(d*c);break}else{if(!(c>0.0))break;if(!(+o[s>>2]>-(d*c)))break;o[s>>2]=-(d*c);break}}while(0);o[s>>2]=+o[a+700>>2]*+o[s>>2]}}r=aa;return}Sw(aa+64|0,_+4|0,a+552|0);Sw(aa,$+4|0,a+616|0);D=+o[aa+48>>2];E=+o[aa+64+48>>2];F=+o[aa+52>>2];G=+o[aa+64+52>>2];H=+o[aa+56>>2];I=+o[aa+64+56>>2];d=+o[(k[a+28>>2]|0)+344>>2];c=+o[(k[a+32>>2]|0)+344>>2];if(d<1.1920928955078125e-07)z=1;else z=c<1.1920928955078125e-07;if(d+c>0.0)C=c/(d+c);else C=.5;h=1.0-C;P=+o[aa+64+8>>2];Q=+o[aa+64+24>>2];R=+o[aa+64+40>>2];S=+o[aa+8>>2];T=+o[aa+24>>2];U=+o[aa+40>>2];V=C*P+h*S;W=C*Q+h*T;X=C*R+h*U;Z=1.0/+Y(+(V*V+W*W+X*X));J=D-+o[$+52>>2];K=F-+o[$+56>>2];M=H-+o[$+60>>2];x=V*Z*(J*(V*Z)+K*(W*Z)+M*(X*Z));m=W*Z*(J*(V*Z)+K*(W*Z)+M*(X*Z));N=X*Z*(J*(V*Z)+K*(W*Z)+M*(X*Z));l=E-+o[_+52>>2];L=G-+o[_+56>>2];O=I-+o[_+60>>2];u=V*Z*(V*Z*l+W*Z*L+X*Z*O);p=W*Z*(V*Z*l+W*Z*L+X*Z*O);y=X*Z*(V*Z*l+W*Z*L+X*Z*O);c=l-u+C*(u-x);B=L-p+C*(p-m);q=O-y+C*(y-N);d=J-x-h*(u-x);w=K-m-h*(p-m);j=M-N-h*(y-N);u=C*(J-x)+h*(l-u);p=C*(K-m)+h*(L-p);y=C*(M-N)+h*(O-y);if(u*u+p*p+y*y>1.1920928955078125e-07){M=1.0/+Y(+(u*u+p*p+y*y));O=u*M;N=M*p;M=M*y}else{O=+o[aa+64+4>>2];N=+o[aa+64+20>>2];M=+o[aa+64+36>>2]}J=W*Z*M-X*Z*N;K=X*Z*O-M*(V*Z);L=N*(V*Z)-W*Z*O;n=k[b+12>>2]|0;o[n>>2]=B*M-q*N;o[n+4>>2]=q*O-c*M;o[n+8>>2]=c*N-B*O;n=k[b+20>>2]|0;o[n>>2]=-(w*M-j*N);o[n+4>>2]=-(j*O-d*M);o[n+8>>2]=-(d*N-w*O);if(z?(i[a+716>>0]|0)!=0:0){y=h*(w*L-j*K);u=h*(j*J-d*L);p=h*(d*K-w*J);m=C*(B*L-q*K);l=C*(q*J-c*L);x=C*(c*K-B*J)}else{y=w*L-j*K;u=j*J-d*L;p=d*K-w*J;m=B*L-q*K;l=q*J-c*L;x=c*K-B*J}n=k[b+12>>2]|0;o[n+(A<<2)>>2]=m;o[n+(A+1<<2)>>2]=l;o[n+(A+2<<2)>>2]=x;n=k[b+20>>2]|0;o[n+(A<<2)>>2]=-y;o[n+(A+1<<2)>>2]=-u;o[n+(A+2<<2)>>2]=-p;if(z){x=h*(w*(X*Z)-j*(W*Z));l=h*(j*(V*Z)-d*(X*Z));m=h*(d*(W*Z)-w*(V*Z));p=C*(B*(X*Z)-q*(W*Z));y=C*(q*(V*Z)-c*(X*Z));u=C*(c*(W*Z)-B*(V*Z))}else{x=w*(X*Z)-j*(W*Z);l=j*(V*Z)-d*(X*Z);m=d*(W*Z)-w*(V*Z);p=B*(X*Z)-q*(W*Z);y=q*(V*Z)-c*(X*Z);u=c*(W*Z)-B*(V*Z)}g=k[b+12>>2]|0;o[g+(A<<1<<2)>>2]=p;o[g+((A<<1|1)<<2)>>2]=y;o[g+((A<<1)+2<<2)>>2]=u;g=k[b+20>>2]|0;o[g+(A<<1<<2)>>2]=-x;o[g+((A<<1|1)<<2)>>2]=-l;o[g+((A<<1)+2<<2)>>2]=-m;p=+o[b>>2]*+o[b+4>>2];if(!(i[a+736>>0]|0)){s=k[b+8>>2]|0;o[s>>2]=O;o[s+4>>2]=N;o[s+8>>2]=M;s=k[b+8>>2]|0;o[s+(A<<2)>>2]=J;o[s+(A+1<<2)>>2]=K;o[s+(A+2<<2)>>2]=L;s=k[b+8>>2]|0;o[s+(A<<1<<2)>>2]=V*Z;o[s+((A<<1|1)<<2)>>2]=W*Z;o[s+((A<<1)+2<<2)>>2]=X*Z;s=k[b+16>>2]|0;u=-O;o[s>>2]=u;l=-N;o[s+4>>2]=l;m=-M;o[s+8>>2]=m;o[s+(A<<2)>>2]=-J;o[s+(A+1<<2)>>2]=-K;o[s+(A+2<<2)>>2]=-L;o[s+(A<<1<<2)>>2]=-(V*Z);o[s+((A<<1|1)<<2)>>2]=-(W*Z);o[s+((A<<1)+2<<2)>>2]=-(X*Z);s=k[b+28>>2]|0;o[s>>2]=p*((D-E)*O+(F-G)*N+(H-I)*M);o[s+(A<<2)>>2]=p*((D-E)*J+(F-G)*K+(H-I)*L);o[s+(A<<1<<2)>>2]=p*((D-E)*(V*Z)+(F-G)*(W*Z)+(H-I)*(X*Z));p=l;l=-J;j=-K;d=-L;g=k[b+20>>2]|0}else{u=-O;p=-N;m=-M;l=-J;j=-K;d=-L;s=k[b+28>>2]|0}z=k[b+12>>2]|0;o[z+(A*3<<2)>>2]=O;o[z+((A*3|0)+1<<2)>>2]=N;o[z+((A*3|0)+2<<2)>>2]=M;o[z+(A<<2<<2)>>2]=J;o[z+((A<<2|1)<<2)>>2]=K;o[z+((A<<2|2)<<2)>>2]=L;o[g+(A*3<<2)>>2]=u;o[g+((A*3|0)+1<<2)>>2]=p;o[g+((A*3|0)+2<<2)>>2]=m;o[g+(A<<2<<2)>>2]=l;o[g+((A<<2|1)<<2)>>2]=j;o[g+((A<<2|2)<<2)>>2]=d;H=+o[b>>2]*+o[b+4>>2];o[s+(A*3<<2)>>2]=H*((Q*U-R*T)*O+(R*S-P*U)*N+(P*T-Q*S)*M);o[s+(A<<2<<2)>>2]=H*((Q*U-R*T)*J+(R*S-P*U)*K+(P*T-Q*S)*L);if(!(i[a+716>>0]|0)){A=0;u=0.0}else{u=+o[a+708>>2]*+o[a+732>>2];A=u>0.0?1:2}n=i[a+737>>0]|0;t=(A|0)!=0;if(n&255|A){v=(k[b+24>>2]|0)*5|0;o[z+(v<<2)>>2]=V*Z;o[z+(v+1<<2)>>2]=W*Z;o[z+(v+2<<2)>>2]=X*Z;o[g+(v<<2)>>2]=-(V*Z);o[g+(v+1<<2)>>2]=-(W*Z);o[g+(v+2<<2)>>2]=-(X*Z);h=+o[a+688>>2];c=+o[a+692>>2];d=+kF(h-c,6.2831854820251465);if(!(d<-3.1415927410125732))if(d>3.1415927410125732)q=d+-6.2831854820251465;else q=d;else q=d+6.2831854820251465;d=+kF(h+c,6.2831854820251465);if(!(d<-3.1415927410125732)){if(d>3.1415927410125732)d=d+-6.2831854820251465}else d=d+6.2831854820251465;f=q==d;s=s+(v<<2)|0;o[s>>2]=0.0;g=k[a+748>>2]|0;j=+o[((g&2|0)==0?b+4|0:a+760|0)>>2];if(!(n<<24>>24==0|t&f)){if(g&4)o[(k[b+32>>2]|0)+(v<<2)>>2]=+o[a+752>>2];m=+o[a+728>>2];l=+o[a+680>>2];n=q>d;do if(!(n|f)){p=l/(j*+o[b>>2]);if(p<0.0)if(m>=q&q-p>m){d=(q-m)/p;break}else{d=m<q?0.0:1.0;break}if(p>0.0)if(m<=d&d-p<m){d=(d-m)/p;break}else{d=m>d?0.0:1.0;break}else d=0.0}else d=n?1.0:0.0;while(0);o[s>>2]=d*l*+o[a+732>>2]+ +o[s>>2];o[(k[b+36>>2]|0)+(v<<2)>>2]=-+o[a+684>>2];o[(k[b+40>>2]|0)+(v<<2)>>2]=+o[a+684>>2]}if(t){o[s>>2]=+o[s>>2]+u*(j*+o[b>>2]);if(g&1)o[(k[b+32>>2]|0)+(v<<2)>>2]=+o[a+756>>2];do if(!f){f=(k[b+36>>2]|0)+(v<<2)|0;e=k[b+40>>2]|0;if((A|0)==1){o[f>>2]=0.0;o[e+(v<<2)>>2]=3402823466385288598117041.0e14;break}else{o[f>>2]=-3402823466385288598117041.0e14;o[e+(v<<2)>>2]=0.0;break}}else{o[(k[b+36>>2]|0)+(v<<2)>>2]=-3402823466385288598117041.0e14;o[(k[b+40>>2]|0)+(v<<2)>>2]=3402823466385288598117041.0e14}while(0);d=+o[a+704>>2];do if(d>0.0){c=+o[_+328>>2]*(V*Z)+ +o[_+332>>2]*(W*Z)+ +o[_+336>>2]*(X*Z)-(V*Z*+o[$+328>>2]+W*Z*+o[$+332>>2]+X*Z*+o[$+336>>2]);if((A|0)==1){if(!(c<0.0))break;if(!(+o[s>>2]<-(d*c)))break;o[s>>2]=-(d*c);break}else{if(!(c>0.0))break;if(!(+o[s>>2]>-(d*c)))break;o[s>>2]=-(d*c);break}}while(0);o[s>>2]=+o[a+700>>2]*+o[s>>2]}}r=aa;return}function Aq(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0;v=+o[a+552>>2];u=+o[a+568>>2];t=+o[a+584>>2];s=+o[b>>2];r=+o[b+4>>2];q=+o[b+8>>2];n=+o[b+16>>2];m=+o[b+20>>2];l=+o[b+24>>2];j=+o[b+32>>2];h=+o[b+36>>2];f=+o[b+40>>2];i=+o[a+556>>2];g=+o[a+572>>2];e=+o[a+588>>2];x=+o[a+620>>2];w=+o[a+636>>2];d=+o[a+652>>2];p=x*+o[c>>2]+w*+o[c+4>>2]+d*+o[c+8>>2];k=x*+o[c+16>>2]+w*+o[c+20>>2]+d*+o[c+24>>2];d=x*+o[c+32>>2]+w*+o[c+36>>2]+d*+o[c+40>>2];d=+ea(+((v*s+u*r+t*q)*p+(v*n+u*m+t*l)*k+(v*j+u*h+t*f)*d),+((s*i+r*g+q*e)*p+(n*i+m*g+l*e)*k+(j*i+h*g+f*e)*d));return +(d*+o[a+732>>2])}function Bq(a,b,c,d){a=a|0;b=b|0;c=+c;d=d|0;if(!((d|0)==5|(d|0)==-1))return;if((b|0)==3){o[a+752>>2]=c;k[a+748>>2]=k[a+748>>2]|4;return}else if((b|0)==4){o[a+756>>2]=c;k[a+748>>2]=k[a+748>>2]|1;return}else if((b|0)==2){o[a+760>>2]=c;k[a+748>>2]=k[a+748>>2]|2;return}else return}function Cq(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0;do if((c|0)==5|(c|0)==-1)if((b|0)==2){d=+o[a+760>>2];break}else if((b|0)==3){d=+o[a+752>>2];break}else if((b|0)==4){d=+o[a+756>>2];break}else{d=0.0;break}else d=0.0;while(0);return +d}function Dq(a){a=a|0;var b=0;k[a>>2]=3976;b=k[a+176>>2]|0;if(b){if(i[a+180>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+176>>2]=0}i[a+180>>0]=1;k[a+176>>2]=0;k[a+168>>2]=0;k[a+172>>2]=0;b=k[a+156>>2]|0;if(b){if(i[a+160>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+156>>2]=0}i[a+160>>0]=1;k[a+156>>2]=0;k[a+148>>2]=0;k[a+152>>2]=0;b=k[a+136>>2]|0;if(b){if(i[a+140>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+136>>2]=0}i[a+140>>0]=1;k[a+136>>2]=0;k[a+128>>2]=0;k[a+132>>2]=0;b=k[a+116>>2]|0;if(b){if(i[a+120>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+116>>2]=0}i[a+120>>0]=1;k[a+116>>2]=0;k[a+108>>2]=0;k[a+112>>2]=0;b=k[a+96>>2]|0;if(b){if(i[a+100>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+96>>2]=0}i[a+100>>0]=1;k[a+96>>2]=0;k[a+88>>2]=0;k[a+92>>2]=0;b=k[a+76>>2]|0;if(b){if(i[a+80>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+76>>2]=0}i[a+80>>0]=1;k[a+76>>2]=0;k[a+68>>2]=0;k[a+72>>2]=0;b=k[a+56>>2]|0;if(b){if(i[a+60>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+56>>2]=0}i[a+60>>0]=1;k[a+56>>2]=0;k[a+48>>2]=0;k[a+52>>2]=0;b=k[a+36>>2]|0;if(b){if(i[a+40>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+36>>2]=0}i[a+40>>0]=1;k[a+36>>2]=0;k[a+28>>2]=0;k[a+32>>2]=0;b=k[a+16>>2]|0;if(!b){i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;a=a+12|0;k[a>>2]=0;return}if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+16>>2]=0;i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;a=a+12|0;k[a>>2]=0;return}function Eq(a){a=a|0;Dq(a);if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function Fq(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0;f=+o[c+100>>2];i=+o[c+16>>2];g=+o[c+20>>2];h=+o[c+24>>2];d=+o[c+108>>2];d=+o[c+112>>2]-f*+o[c+116>>2]-(i*+o[a+64>>2]+g*+o[a+68>>2]+h*+o[a+72>>2]+(+o[c>>2]*+o[a+80>>2]+ +o[c+4>>2]*+o[a+84>>2]+ +o[c+8>>2]*+o[a+88>>2]))*d-d*(+o[c+48>>2]*+o[b+64>>2]+ +o[c+52>>2]*+o[b+68>>2]+ +o[c+56>>2]*+o[b+72>>2]+(+o[c+32>>2]*+o[b+80>>2]+ +o[c+36>>2]*+o[b+84>>2]+ +o[c+40>>2]*+o[b+88>>2]));e=+o[c+120>>2];do if(!(f+d<e)){e=+o[c+124>>2];if(f+d>e){o[c+100>>2]=e;d=e-f;break}else{o[c+100>>2]=f+d;break}}else{o[c+100>>2]=e;d=e-f}while(0);if(k[a+240>>2]|0){g=d*(g*+o[a+132>>2])*+o[a+116>>2];h=d*(h*+o[a+136>>2])*+o[a+120>>2];o[a+64>>2]=+o[a+112>>2]*(d*(i*+o[a+128>>2]))+ +o[a+64>>2];o[a+68>>2]=g+ +o[a+68>>2];o[a+72>>2]=h+ +o[a+72>>2];h=d*+o[a+100>>2]*+o[c+68>>2];i=d*+o[a+104>>2]*+o[c+72>>2];o[a+80>>2]=d*+o[a+96>>2]*+o[c+64>>2]+ +o[a+80>>2];o[a+84>>2]=h+ +o[a+84>>2];o[a+88>>2]=i+ +o[a+88>>2]}if(!(k[b+240>>2]|0))return;i=d*(+o[c+52>>2]*+o[b+132>>2])*+o[b+116>>2];h=d*(+o[c+56>>2]*+o[b+136>>2])*+o[b+120>>2];o[b+64>>2]=+o[b+112>>2]*(d*(+o[c+48>>2]*+o[b+128>>2]))+ +o[b+64>>2];o[b+68>>2]=i+ +o[b+68>>2];o[b+72>>2]=h+ +o[b+72>>2];h=d*+o[b+100>>2]*+o[c+84>>2];i=d*+o[b+104>>2]*+o[c+88>>2];o[b+80>>2]=d*+o[b+96>>2]*+o[c+80>>2]+ +o[b+80>>2];o[b+84>>2]=h+ +o[b+84>>2];o[b+88>>2]=i+ +o[b+88>>2];return}function Gq(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0;e=+o[c+100>>2];i=+o[c+16>>2];g=+o[c+20>>2];h=+o[c+24>>2];f=+o[c+108>>2];f=+o[c+112>>2]-e*+o[c+116>>2]-(i*+o[a+64>>2]+g*+o[a+68>>2]+h*+o[a+72>>2]+(+o[c>>2]*+o[a+80>>2]+ +o[c+4>>2]*+o[a+84>>2]+ +o[c+8>>2]*+o[a+88>>2]))*f-f*(+o[c+48>>2]*+o[b+64>>2]+ +o[c+52>>2]*+o[b+68>>2]+ +o[c+56>>2]*+o[b+72>>2]+(+o[c+32>>2]*+o[b+80>>2]+ +o[c+36>>2]*+o[b+84>>2]+ +o[c+40>>2]*+o[b+88>>2]));d=+o[c+120>>2];if(e+f<d)j=d-e;else{j=f;d=e+f}o[c+100>>2]=d;if(k[a+240>>2]|0){g=j*(g*+o[a+132>>2])*+o[a+116>>2];h=j*(h*+o[a+136>>2])*+o[a+120>>2];o[a+64>>2]=+o[a+112>>2]*(j*(i*+o[a+128>>2]))+ +o[a+64>>2];o[a+68>>2]=g+ +o[a+68>>2];o[a+72>>2]=h+ +o[a+72>>2];h=j*+o[a+100>>2]*+o[c+68>>2];i=j*+o[a+104>>2]*+o[c+72>>2];o[a+80>>2]=j*+o[a+96>>2]*+o[c+64>>2]+ +o[a+80>>2];o[a+84>>2]=h+ +o[a+84>>2];o[a+88>>2]=i+ +o[a+88>>2]}if(!(k[b+240>>2]|0))return;i=j*(+o[c+52>>2]*+o[b+132>>2])*+o[b+116>>2];h=j*(+o[c+56>>2]*+o[b+136>>2])*+o[b+120>>2];o[b+64>>2]=+o[b+112>>2]*(j*(+o[c+48>>2]*+o[b+128>>2]))+ +o[b+64>>2];o[b+68>>2]=i+ +o[b+68>>2];o[b+72>>2]=h+ +o[b+72>>2];h=j*+o[b+100>>2]*+o[c+84>>2];i=j*+o[b+104>>2]*+o[c+88>>2];o[b+80>>2]=j*+o[b+96>>2]*+o[c+80>>2]+ +o[b+80>>2];o[b+84>>2]=h+ +o[b+84>>2];o[b+88>>2]=i+ +o[b+88>>2];return}function Hq(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0;d=+o[c+128>>2];if(!(d!=0.0))return;k[990]=(k[990]|0)+1;f=+o[c+96>>2];h=+o[c+16>>2];i=+o[c+20>>2];j=+o[c+24>>2];e=+o[c+108>>2];e=d-f*+o[c+116>>2]-(h*+o[a+144>>2]+i*+o[a+148>>2]+j*+o[a+152>>2]+(+o[c>>2]*+o[a+160>>2]+ +o[c+4>>2]*+o[a+164>>2]+ +o[c+8>>2]*+o[a+168>>2]))*e-e*(+o[c+48>>2]*+o[b+144>>2]+ +o[c+52>>2]*+o[b+148>>2]+ +o[c+56>>2]*+o[b+152>>2]+(+o[c+32>>2]*+o[b+160>>2]+ +o[c+36>>2]*+o[b+164>>2]+ +o[c+40>>2]*+o[b+168>>2]));d=+o[c+120>>2];if(f+e<d)g=d-f;else{g=e;d=f+e}o[c+96>>2]=d;if(k[a+240>>2]|0){f=g*(i*+o[a+132>>2])*+o[a+116>>2];i=g*(j*+o[a+136>>2])*+o[a+120>>2];o[a+144>>2]=+o[a+112>>2]*(g*(h*+o[a+128>>2]))+ +o[a+144>>2];o[a+148>>2]=f+ +o[a+148>>2];o[a+152>>2]=i+ +o[a+152>>2];i=g*+o[a+100>>2]*+o[c+68>>2];j=g*+o[a+104>>2]*+o[c+72>>2];o[a+160>>2]=g*+o[a+96>>2]*+o[c+64>>2]+ +o[a+160>>2];o[a+164>>2]=i+ +o[a+164>>2];o[a+168>>2]=j+ +o[a+168>>2]}if(!(k[b+240>>2]|0))return;j=g*(+o[c+52>>2]*+o[b+132>>2])*+o[b+116>>2];i=g*(+o[c+56>>2]*+o[b+136>>2])*+o[b+120>>2];o[b+144>>2]=+o[b+112>>2]*(g*(+o[c+48>>2]*+o[b+128>>2]))+ +o[b+144>>2];o[b+148>>2]=j+ +o[b+148>>2];o[b+152>>2]=i+ +o[b+152>>2];i=g*+o[b+100>>2]*+o[c+84>>2];j=g*+o[b+104>>2]*+o[c+88>>2];o[b+160>>2]=g*+o[b+96>>2]*+o[c+80>>2]+ +o[b+160>>2];o[b+164>>2]=i+ +o[b+164>>2];o[b+168>>2]=j+ +o[b+168>>2];return}function Iq(a,b,c){a=a|0;b=b|0;c=+c;var d=0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0,l=0;if(!b)b=0;else b=(k[b+236>>2]&2|0)==0?0:b;k[a+64>>2]=0;k[a+64+4>>2]=0;k[a+64+8>>2]=0;k[a+64+12>>2]=0;k[a+64+16>>2]=0;k[a+64+20>>2]=0;k[a+64+24>>2]=0;k[a+64+28>>2]=0;k[a+144>>2]=0;k[a+144+4>>2]=0;k[a+144+8>>2]=0;k[a+144+12>>2]=0;k[a+144+16>>2]=0;k[a+144+20>>2]=0;k[a+144+24>>2]=0;k[a+144+28>>2]=0;if(!b){o[a>>2]=1.0;k[a+4>>2]=0;k[a+4+4>>2]=0;k[a+4+8>>2]=0;k[a+4+12>>2]=0;o[a+20>>2]=1.0;k[a+24>>2]=0;k[a+24+4>>2]=0;k[a+24+8>>2]=0;k[a+24+12>>2]=0;o[a+40>>2]=1.0;k[a+44>>2]=0;k[a+44+4>>2]=0;k[a+44+8>>2]=0;k[a+44+12>>2]=0;k[a+44+16>>2]=0;k[a+240>>2]=0;k[a+128>>2]=0;k[a+128+4>>2]=0;k[a+128+8>>2]=0;k[a+128+12>>2]=0;o[a+96>>2]=1.0;o[a+100>>2]=1.0;o[a+104>>2]=1.0;o[a+108>>2]=0.0;o[a+112>>2]=1.0;o[a+116>>2]=1.0;o[a+120>>2]=1.0;o[a+124>>2]=0.0;b=a+176|0;d=b+60|0;do{k[b>>2]=0;b=b+4|0}while((b|0)<(d|0));a=a+236|0;o[a>>2]=0.0;return}else{d=b+4|0;k[a>>2]=k[d>>2];k[a+4>>2]=k[d+4>>2];k[a+8>>2]=k[d+8>>2];k[a+12>>2]=k[d+12>>2];d=b+20|0;k[a+16>>2]=k[d>>2];k[a+16+4>>2]=k[d+4>>2];k[a+16+8>>2]=k[d+8>>2];k[a+16+12>>2]=k[d+12>>2];d=b+36|0;k[a+32>>2]=k[d>>2];k[a+32+4>>2]=k[d+4>>2];k[a+32+8>>2]=k[d+8>>2];k[a+32+12>>2]=k[d+12>>2];d=b+52|0;k[a+48>>2]=k[d>>2];k[a+48+4>>2]=k[d+4>>2];k[a+48+8>>2]=k[d+8>>2];k[a+48+12>>2]=k[d+12>>2];d=b+344|0;i=+o[d>>2];j=b+348|0;h=i*+o[b+352>>2];g=i*+o[b+356>>2];o[a+128>>2]=i*+o[j>>2];o[a+132>>2]=h;o[a+136>>2]=g;o[a+140>>2]=0.0;k[a+240>>2]=b;l=b+544|0;k[a+96>>2]=k[l>>2];k[a+96+4>>2]=k[l+4>>2];k[a+96+8>>2]=k[l+8>>2];k[a+96+12>>2]=k[l+12>>2];k[a+112>>2]=k[j>>2];k[a+112+4>>2]=k[j+4>>2];k[a+112+8>>2]=k[j+8>>2];k[a+112+12>>2]=k[j+12>>2];j=b+312|0;k[a+176>>2]=k[j>>2];k[a+176+4>>2]=k[j+4>>2];k[a+176+8>>2]=k[j+8>>2];k[a+176+12>>2]=k[j+12>>2];j=b+328|0;k[a+192>>2]=k[j>>2];k[a+192+4>>2]=k[j+4>>2];k[a+192+8>>2]=k[j+8>>2];k[a+192+12>>2]=k[j+12>>2];g=+o[d>>2];h=g*+o[b+416>>2]*c;i=g*+o[b+420>>2]*c;o[a+208>>2]=g*+o[b+412>>2]*c;o[a+212>>2]=h;o[a+216>>2]=i;o[a+220>>2]=0.0;i=+o[b+428>>2];h=+o[b+432>>2];g=+o[b+436>>2];f=(i*+o[b+268>>2]+h*+o[b+284>>2]+g*+o[b+300>>2])*c;e=(i*+o[b+272>>2]+h*+o[b+288>>2]+g*+o[b+304>>2])*c;o[a+224>>2]=(+o[b+264>>2]*i+ +o[b+280>>2]*h+ +o[b+296>>2]*g)*c;o[a+228>>2]=f;o[a+232>>2]=e;a=a+236|0;o[a>>2]=0.0;return}}function Jq(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0;if(!a)return;if(!(k[a+180>>2]&1))return;p=+o[a+4>>2];r=+o[b>>2];l=+o[a+20>>2];q=+o[b+4>>2];h=+o[a+36>>2];c=+o[b+8>>2];n=+o[a+8>>2];j=+o[a+24>>2];f=+o[a+40>>2];m=+o[a+12>>2];i=+o[a+28>>2];d=+o[a+44>>2];g=(p*r+l*q+h*c)*+o[a+164>>2];e=(r*n+q*j+c*f)*+o[a+168>>2];c=(r*m+q*i+c*d)*+o[a+172>>2];o[b>>2]=p*g+n*e+m*c;o[b+4>>2]=l*g+j*e+i*c;o[b+8>>2]=h*g+f*e+d*c;o[b+12>>2]=0.0;return}function Kq(a,b,c,d,e,f,g,h,j,l,m){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;j=+j;l=+l;m=+m;var n=0,p=0,q=0.0,r=0,s=0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0,M=0.0,N=0.0,O=0.0,P=0.0;L=k[a+68>>2]|0;if((L|0)==(k[a+72>>2]|0)?(s=(L|0)==0?1:L<<1,(L|0)<(s|0)):0){if(!s){n=0;p=L}else{k[5108]=(k[5108]|0)+1;n=iF((s*152|3)+16|0)|0;if(!n)n=0;else{k[(n+4+15&-16)+-4>>2]=n;n=n+4+15&-16}p=k[a+68>>2]|0}if((p|0)>0){p=p+-1|0;r=0;while(1){qF(n+(r*152|0)|0,(k[a+76>>2]|0)+(r*152|0)|0,152)|0;if((r|0)==(p|0))break;else r=r+1|0}}p=k[a+76>>2]|0;if(p){if(i[a+80>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[p+-4>>2]|0)}k[a+76>>2]=0}i[a+80>>0]=1;k[a+76>>2]=n;k[a+72>>2]=s;n=k[a+68>>2]|0}else n=L;k[a+68>>2]=n+1;p=k[a+76>>2]|0;k[p+(L*152|0)+140>>2]=e;s=k[a+16>>2]|0;a=k[s+(c*244|0)+240>>2]|0;r=k[s+(d*244|0)+240>>2]|0;k[p+(L*152|0)+144>>2]=c;k[p+(L*152|0)+148>>2]=d;K=+o[f+84>>2];o[p+(L*152|0)+104>>2]=K;k[p+(L*152|0)+132>>2]=0;o[p+(L*152|0)+100>>2]=0.0;o[p+(L*152|0)+96>>2]=0.0;if(a){k[p+(L*152|0)+16>>2]=k[b>>2];k[p+(L*152|0)+16+4>>2]=k[b+4>>2];k[p+(L*152|0)+16+8>>2]=k[b+8>>2];k[p+(L*152|0)+16+12>>2]=k[b+12>>2];J=+o[g+4>>2];C=+o[p+(L*152|0)+24>>2];G=+o[g+8>>2];H=+o[p+(L*152|0)+20>>2];D=+o[p+(L*152|0)+16>>2];I=+o[g>>2];o[p+(L*152|0)>>2]=J*C-G*H;o[p+(L*152|0)+4>>2]=G*D-C*I;o[p+(L*152|0)+8>>2]=H*I-J*D;o[p+(L*152|0)+12>>2]=0.0;u=((J*C-G*H)*+o[a+264>>2]+ +o[a+268>>2]*(G*D-C*I)+(H*I-J*D)*+o[a+272>>2])*+o[a+544>>2];w=((J*C-G*H)*+o[a+280>>2]+(G*D-C*I)*+o[a+284>>2]+(H*I-J*D)*+o[a+288>>2])*+o[a+548>>2];v=((J*C-G*H)*+o[a+296>>2]+(G*D-C*I)*+o[a+300>>2]+(H*I-J*D)*+o[a+304>>2])*+o[a+552>>2];o[p+(L*152|0)+64>>2]=u;o[p+(L*152|0)+68>>2]=w;o[p+(L*152|0)+72>>2]=v;o[p+(L*152|0)+76>>2]=0.0;y=D;z=H;A=C;B=J*C-G*H;C=G*D-C*I;D=H*I-J*D}else{k[p+(L*152|0)+64>>2]=0;k[p+(L*152|0)+64+4>>2]=0;k[p+(L*152|0)+64+8>>2]=0;k[p+(L*152|0)+64+12>>2]=0;k[p+(L*152|0)>>2]=0;k[p+(L*152|0)+4>>2]=0;k[p+(L*152|0)+8>>2]=0;k[p+(L*152|0)+12>>2]=0;k[p+(L*152|0)+16>>2]=0;k[p+(L*152|0)+20>>2]=0;k[p+(L*152|0)+24>>2]=0;k[p+(L*152|0)+28>>2]=0;w=0.0;v=0.0;u=0.0;y=0.0;z=0.0;A=0.0;B=0.0;C=0.0;D=0.0}if(r){J=-+o[b>>2];N=-+o[b+4>>2];I=-+o[b+8>>2];o[p+(L*152|0)+48>>2]=J;o[p+(L*152|0)+52>>2]=N;o[p+(L*152|0)+56>>2]=I;o[p+(L*152|0)+60>>2]=0.0;M=+o[h+4>>2];P=+o[h+8>>2];O=+o[h>>2];o[p+(L*152|0)+32>>2]=M*I-P*N;o[p+(L*152|0)+36>>2]=P*J-O*I;o[p+(L*152|0)+40>>2]=O*N-M*J;o[p+(L*152|0)+44>>2]=0.0;t=((M*I-P*N)*+o[r+264>>2]+ +o[r+268>>2]*(P*J-O*I)+(O*N-M*J)*+o[r+272>>2])*+o[r+544>>2];q=((M*I-P*N)*+o[r+280>>2]+(P*J-O*I)*+o[r+284>>2]+(O*N-M*J)*+o[r+288>>2])*+o[r+548>>2];x=((M*I-P*N)*+o[r+296>>2]+(P*J-O*I)*+o[r+300>>2]+(O*N-M*J)*+o[r+304>>2])*+o[r+552>>2];o[p+(L*152|0)+80>>2]=t;o[p+(L*152|0)+84>>2]=q;o[p+(L*152|0)+88>>2]=x;o[p+(L*152|0)+92>>2]=0.0;E=J;F=N;G=I;H=M*I-P*N;I=P*J-O*I;J=O*N-M*J}else{k[p+(L*152|0)+80>>2]=0;k[p+(L*152|0)+80+4>>2]=0;k[p+(L*152|0)+80+8>>2]=0;k[p+(L*152|0)+80+12>>2]=0;k[p+(L*152|0)+32>>2]=0;k[p+(L*152|0)+32+4>>2]=0;k[p+(L*152|0)+32+8>>2]=0;k[p+(L*152|0)+32+12>>2]=0;k[p+(L*152|0)+32+16>>2]=0;k[p+(L*152|0)+32+20>>2]=0;k[p+(L*152|0)+32+24>>2]=0;k[p+(L*152|0)+32+28>>2]=0;t=0.0;q=0.0;x=0.0;E=0.0;F=0.0;G=0.0;H=0.0;I=0.0;J=0.0}if(a){N=+o[g+8>>2];O=+o[g+4>>2];P=+o[g>>2];w=+o[a+344>>2]+((w*N-v*O)*+o[b>>2]+(v*P-N*u)*+o[b+4>>2]+(O*u-w*P)*+o[b+8>>2])}else w=0.0;if(r){O=-t;q=-q;x=-x;M=+o[h+8>>2];N=+o[h+4>>2];P=+o[h>>2];q=+o[r+344>>2]+((M*q-N*x)*+o[b>>2]+(P*x-M*O)*+o[b+4>>2]+(N*O-P*q)*+o[b+8>>2])}else q=0.0;w=j/(w+q);o[p+(L*152|0)+108>>2]=w;if(a){t=+o[s+(c*244|0)+192>>2];u=+o[s+(c*244|0)+196>>2];v=+o[s+(c*244|0)+200>>2];q=(+o[s+(c*244|0)+176>>2]+ +o[s+(c*244|0)+208>>2])*y+(+o[s+(c*244|0)+180>>2]+ +o[s+(c*244|0)+212>>2])*z+(+o[s+(c*244|0)+184>>2]+ +o[s+(c*244|0)+216>>2])*A}else{t=0.0;u=0.0;v=0.0;q=y*0.0+z*0.0+A*0.0}q=q+(t*B+u*C+v*D);if(r){j=+o[s+(d*244|0)+192>>2];N=+o[s+(d*244|0)+196>>2];P=+o[s+(d*244|0)+200>>2];O=(+o[s+(d*244|0)+176>>2]+ +o[s+(d*244|0)+208>>2])*E+(+o[s+(d*244|0)+180>>2]+ +o[s+(d*244|0)+212>>2])*F+(+o[s+(d*244|0)+184>>2]+ +o[s+(d*244|0)+216>>2])*G;j=j*H;N=N*I;N=j+N;P=P*J;P=N+P;P=O+P;P=q+P;P=l-P;P=w*P;d=p+(L*152|0)+112|0;o[d>>2]=P;d=p+(L*152|0)+116|0;o[d>>2]=m;P=-K;d=p+(L*152|0)+120|0;o[d>>2]=P;d=p+(L*152|0)+124|0;o[d>>2]=K;return}else{j=0.0;N=0.0;P=0.0;O=E*0.0+F*0.0+G*0.0;j=j*H;N=N*I;N=j+N;P=P*J;P=N+P;P=O+P;P=q+P;P=l-P;P=w*P;d=p+(L*152|0)+112|0;o[d>>2]=P;d=p+(L*152|0)+116|0;o[d>>2]=m;P=-K;d=p+(L*152|0)+120|0;o[d>>2]=P;d=p+(L*152|0)+124|0;o[d>>2]=K;return}}function Lq(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;var g=0,h=0,j=0.0,l=0,m=0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0;A=k[a+88>>2]|0;if((A|0)==(k[a+92>>2]|0)?(m=(A|0)==0?1:A<<1,(A|0)<(m|0)):0){if(!m){g=0;h=A}else{k[5108]=(k[5108]|0)+1;g=iF((m*152|3)+16|0)|0;if(!g)g=0;else{k[(g+4+15&-16)+-4>>2]=g;g=g+4+15&-16}h=k[a+88>>2]|0}if((h|0)>0){h=h+-1|0;l=0;while(1){qF(g+(l*152|0)|0,(k[a+96>>2]|0)+(l*152|0)|0,152)|0;if((l|0)==(h|0))break;else l=l+1|0}}h=k[a+96>>2]|0;if(h){if(i[a+100>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[h+-4>>2]|0)}k[a+96>>2]=0}i[a+100>>0]=1;k[a+96>>2]=g;k[a+92>>2]=m;g=k[a+88>>2]|0}else g=A;k[a+88>>2]=g+1;l=k[a+96>>2]|0;k[l+(A*152|0)+140>>2]=e;k[l+(A*152|0)+16>>2]=0;k[l+(A*152|0)+16+4>>2]=0;k[l+(A*152|0)+16+8>>2]=0;k[l+(A*152|0)+16+12>>2]=0;o[l+(A*152|0)+48>>2]=-0.0;o[l+(A*152|0)+52>>2]=-0.0;o[l+(A*152|0)+56>>2]=-0.0;o[l+(A*152|0)+60>>2]=0.0;e=k[a+16>>2]|0;a=k[e+(c*244|0)+240>>2]|0;m=k[e+(d*244|0)+240>>2]|0;k[l+(A*152|0)+144>>2]=c;k[l+(A*152|0)+148>>2]=d;z=+o[f+88>>2];o[l+(A*152|0)+104>>2]=z;k[l+(A*152|0)+132>>2]=0;o[l+(A*152|0)+100>>2]=0.0;o[l+(A*152|0)+96>>2]=0.0;w=-+o[b>>2];x=-+o[b+4>>2];y=-+o[b+8>>2];o[l+(A*152|0)>>2]=w;o[l+(A*152|0)+4>>2]=x;o[l+(A*152|0)+8>>2]=y;o[l+(A*152|0)+12>>2]=0.0;if(a){j=(+o[a+264>>2]*w+ +o[a+268>>2]*x+ +o[a+272>>2]*y)*+o[a+544>>2];n=(+o[a+280>>2]*w+ +o[a+284>>2]*x+ +o[a+288>>2]*y)*+o[a+548>>2];p=(+o[a+296>>2]*w+ +o[a+300>>2]*x+ +o[a+304>>2]*y)*+o[a+552>>2]}else{j=0.0;n=0.0;p=0.0}o[l+(A*152|0)+64>>2]=j;o[l+(A*152|0)+68>>2]=n;o[l+(A*152|0)+72>>2]=p;o[l+(A*152|0)+76>>2]=0.0;t=+o[b>>2];u=+o[b+4>>2];v=+o[b+8>>2];s=+o[b+12>>2];o[l+(A*152|0)+32>>2]=t;o[l+(A*152|0)+36>>2]=u;o[l+(A*152|0)+40>>2]=v;o[l+(A*152|0)+44>>2]=s;if(m){p=(t*+o[m+264>>2]+u*+o[m+268>>2]+v*+o[m+272>>2])*+o[m+544>>2];n=(t*+o[m+280>>2]+u*+o[m+284>>2]+v*+o[m+288>>2])*+o[m+548>>2];j=(t*+o[m+296>>2]+u*+o[m+300>>2]+v*+o[m+304>>2])*+o[m+552>>2]}else{p=0.0;n=0.0;j=0.0}o[l+(A*152|0)+80>>2]=p;o[l+(A*152|0)+84>>2]=n;o[l+(A*152|0)+88>>2]=j;o[l+(A*152|0)+92>>2]=0.0;if(a){q=+o[a+264>>2]*w+ +o[a+268>>2]*x+ +o[a+272>>2]*y;p=+o[a+280>>2]*w+ +o[a+284>>2]*x+ +o[a+288>>2]*y;n=+o[a+296>>2]*w+ +o[a+300>>2]*x+ +o[a+304>>2]*y}else{q=0.0;p=0.0;n=0.0}if(m){j=+o[m+264>>2]*t+ +o[m+268>>2]*u+ +o[m+272>>2]*v;r=t*+o[m+280>>2]+u*+o[m+284>>2]+v*+o[m+288>>2];s=t*+o[m+296>>2]+u*+o[m+300>>2]+v*+o[m+304>>2]}else{j=0.0;r=0.0;s=0.0}s=1.0/(q*w+p*x+n*y+0.0+(j*t+r*u+s*v));o[l+(A*152|0)+108>>2]=s;if(a){n=+o[e+(c*244|0)+192>>2];j=+o[e+(c*244|0)+196>>2];q=+o[e+(c*244|0)+200>>2];p=(+o[e+(c*244|0)+176>>2]+ +o[e+(c*244|0)+208>>2])*0.0+(+o[e+(c*244|0)+180>>2]+ +o[e+(c*244|0)+212>>2])*0.0+(+o[e+(c*244|0)+184>>2]+ +o[e+(c*244|0)+216>>2])*0.0}else{n=0.0;j=0.0;q=0.0;p=0.0}j=p+(n*w+j*x+q*y);if(!m){q=0.0;w=0.0;y=0.0;x=-0.0;q=q*t;u=w*u;u=q+u;y=y*v;y=u+y;y=x+y;y=j+y;y=0.0-y;y=s*y;c=l+(A*152|0)+112|0;o[c>>2]=y;c=l+(A*152|0)+116|0;o[c>>2]=0.0;y=-z;c=l+(A*152|0)+120|0;o[c>>2]=y;c=l+(A*152|0)+124|0;o[c>>2]=z;return}q=+o[e+(d*244|0)+192>>2];w=+o[e+(d*244|0)+196>>2];y=+o[e+(d*244|0)+200>>2];x=(+o[e+(d*244|0)+176>>2]+ +o[e+(d*244|0)+208>>2])*-0.0+(+o[e+(d*244|0)+180>>2]+ +o[e+(d*244|0)+212>>2])*-0.0+(+o[e+(d*244|0)+184>>2]+ +o[e+(d*244|0)+216>>2])*-0.0;q=q*t;u=w*u;u=q+u;y=y*v;y=u+y;y=x+y;y=j+y;y=0.0-y;y=s*y;c=l+(A*152|0)+112|0;o[c>>2]=y;c=l+(A*152|0)+116|0;o[c>>2]=0.0;y=-z;c=l+(A*152|0)+120|0;o[c>>2]=y;c=l+(A*152|0)+124|0;o[c>>2]=z;return}function Mq(a,b,c){a=a|0;b=b|0;c=+c;var d=0,e=0,f=0;e=r;r=r+496|0;d=k[b+212>>2]|0;if((d|0)>-1){a=d;r=e;return a|0}f=(k[b+236>>2]&2|0)==0;d=f?0:b;do if(!f){if(!(+o[d+344>>2]!=0.0)?(k[d+204>>2]&2|0)==0:0)break;f=k[a+8>>2]|0;nF(e+244|0,0,244)|0;Iq(Yw(a+4|0,e+244|0)|0,b,c);k[b+212>>2]=f;a=f;r=e;return a|0}while(0);d=k[a+188>>2]|0;if((d|0)>=0){a=d;r=e;return a|0}k[a+188>>2]=k[a+8>>2];nF(e|0,0,244)|0;Iq(Yw(a+4|0,e)|0,0,c);a=k[a+188>>2]|0;r=e;return a|0}function Nq(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0.0,j=0.0,l=0,m=0.0,n=0,p=0,q=0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0,N=0,O=0,P=0.0,Q=0,R=0,S=0,T=0,U=0,V=0,W=0,Z=0,_=0,$=0,aa=0,ba=0,ca=0,da=0,ea=0;ea=r;r=r+80|0;if((c|0)<=0){r=ea;return}ba=0;while(1){U=k[b+(ba<<2)>>2]|0;V=k[U+740>>2]|0;W=k[U+744>>2]|0;Z=Mq(a,V,+o[d+12>>2])|0;_=Mq(a,W,+o[d+12>>2])|0;$=k[a+16>>2]|0;if(!(((((+o[$+(Z*244|0)+128>>2]==0.0?+o[$+(Z*244|0)+132>>2]==0.0:0)?+o[$+(Z*244|0)+136>>2]==0.0:0)?+o[$+(_*244|0)+128>>2]==0.0:0)?+o[$+(_*244|0)+132>>2]==0.0:0)?+o[$+(_*244|0)+136>>2]==0.0:0))da=9;if((da|0)==9?(da=0,aa=k[U+748>>2]|0,(aa|0)>0):0){f=aa;ca=0;e=1;do{R=U+4+(ca*184|0)|0;n=U+4+(ca*184|0)+80|0;if(+o[n>>2]<=+o[U+756>>2]){S=k[a+28>>2]|0;if((S|0)==(k[a+32>>2]|0)?(T=(S|0)==0?1:S<<1,(S|0)<(T|0)):0){if(!T){f=0;g=S}else{k[5108]=(k[5108]|0)+1;f=iF((T*152|3)+16|0)|0;if(!f)f=0;else{k[(f+4+15&-16)+-4>>2]=f;f=f+4+15&-16}g=k[a+28>>2]|0}if((g|0)>0){g=g+-1|0;l=0;while(1){qF(f+(l*152|0)|0,(k[a+36>>2]|0)+(l*152|0)|0,152)|0;if((l|0)==(g|0))break;else l=l+1|0}}g=k[a+36>>2]|0;if(g){if(i[a+40>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[g+-4>>2]|0)}k[a+36>>2]=0}i[a+40>>0]=1;k[a+36>>2]=f;k[a+32>>2]=T;f=k[a+28>>2]|0}else f=S;k[a+28>>2]=f+1;Q=k[a+36>>2]|0;f=(k[V+236>>2]&2|0)==0?0:V;l=(k[W+236>>2]&2|0)==0?0:W;k[Q+(S*152|0)+144>>2]=Z;k[Q+(S*152|0)+148>>2]=_;k[Q+(S*152|0)+132>>2]=R;w=+o[U+4+(ca*184|0)+48>>2]-+o[V+52>>2];C=+o[U+4+(ca*184|0)+52>>2]-+o[V+56>>2];x=+o[U+4+(ca*184|0)+56>>2]-+o[V+60>>2];o[ea+64>>2]=w;o[ea+64+4>>2]=C;o[ea+64+8>>2]=x;o[ea+64+12>>2]=0.0;E=+o[U+4+(ca*184|0)+32>>2]-+o[W+52>>2];F=+o[U+4+(ca*184|0)+36>>2]-+o[W+56>>2];D=+o[U+4+(ca*184|0)+40>>2]-+o[W+60>>2];o[ea+48>>2]=E;o[ea+48+4>>2]=F;o[ea+48+8>>2]=D;o[ea+48+12>>2]=0.0;if(!(k[$+(Z*244|0)+240>>2]|0)){u=0.0;h=0.0;m=0.0}else{h=+o[$+(Z*244|0)+192>>2]+ +o[$+(Z*244|0)+224>>2];P=+o[$+(Z*244|0)+196>>2]+ +o[$+(Z*244|0)+228>>2];m=+o[$+(Z*244|0)+200>>2]+ +o[$+(Z*244|0)+232>>2];u=+o[$+(Z*244|0)+184>>2]+ +o[$+(Z*244|0)+216>>2]+(h*C-P*w);h=+o[$+(Z*244|0)+180>>2]+ +o[$+(Z*244|0)+212>>2]+(m*w-h*x);m=+o[$+(Z*244|0)+176>>2]+ +o[$+(Z*244|0)+208>>2]+(P*x-m*C)}if(!(k[$+(_*244|0)+240>>2]|0)){t=0.0;s=0.0;j=0.0}else{s=+o[$+(_*244|0)+192>>2]+ +o[$+(_*244|0)+224>>2];P=+o[$+(_*244|0)+196>>2]+ +o[$+(_*244|0)+228>>2];j=+o[$+(_*244|0)+200>>2]+ +o[$+(_*244|0)+232>>2];t=+o[$+(_*244|0)+184>>2]+ +o[$+(_*244|0)+216>>2]+(s*F-P*E);s=+o[$+(_*244|0)+180>>2]+ +o[$+(_*244|0)+212>>2]+(j*E-s*D);j=+o[$+(_*244|0)+176>>2]+ +o[$+(_*244|0)+208>>2]+(P*D-j*F)}P=m-j;L=h-s;H=u-t;M=U+4+(ca*184|0)+64|0;I=+o[M>>2];N=U+4+(ca*184|0)+68|0;J=+o[N>>2];O=U+4+(ca*184|0)+72|0;K=+o[O>>2];g=k[a+16>>2]|0;q=k[g+(Z*244|0)+240>>2]|0;p=k[g+(_*244|0)+240>>2]|0;if(q){A=((C*K-x*J)*+o[q+264>>2]+(x*I-K*w)*+o[q+268>>2]+(J*w-C*I)*+o[q+272>>2])*+o[q+544>>2];y=((C*K-x*J)*+o[q+280>>2]+(x*I-K*w)*+o[q+284>>2]+(J*w-C*I)*+o[q+288>>2])*+o[q+548>>2];v=((C*K-x*J)*+o[q+296>>2]+(x*I-K*w)*+o[q+300>>2]+(J*w-C*I)*+o[q+304>>2])*+o[q+552>>2]}else{A=0.0;y=0.0;v=0.0}o[Q+(S*152|0)+64>>2]=A;o[Q+(S*152|0)+68>>2]=y;o[Q+(S*152|0)+72>>2]=v;o[Q+(S*152|0)+76>>2]=0.0;t=+o[O>>2];z=+o[N>>2];m=+o[M>>2];if(p){B=(+o[p+264>>2]*-(F*t-D*z)+ +o[p+268>>2]*-(D*m-t*E)+ +o[p+272>>2]*-(z*E-F*m))*+o[p+544>>2];u=(+o[p+280>>2]*-(F*t-D*z)+ +o[p+284>>2]*-(D*m-t*E)+ +o[p+288>>2]*-(z*E-F*m))*+o[p+548>>2];s=(+o[p+296>>2]*-(F*t-D*z)+ +o[p+300>>2]*-(D*m-t*E)+ +o[p+304>>2]*-(z*E-F*m))*+o[p+552>>2]}else{B=0.0;u=0.0;s=0.0}o[Q+(S*152|0)+80>>2]=B;o[Q+(S*152|0)+84>>2]=u;o[Q+(S*152|0)+88>>2]=s;o[Q+(S*152|0)+92>>2]=0.0;if(q)y=+o[q+344>>2]+((y*x-v*C)*+o[M>>2]+(v*w-x*A)*+o[N>>2]+(C*A-y*w)*+o[O>>2]);else y=0.0;if(p){G=-B;A=-u;B=-s;A=+o[p+344>>2]+((D*A-F*B)*+o[M>>2]+(E*B-D*G)*+o[N>>2]+(F*G-E*A)*+o[O>>2])}else A=0.0;o[Q+(S*152|0)+108>>2]=1.0/(y+A);if(q){k[Q+(S*152|0)+16>>2]=k[M>>2];k[Q+(S*152|0)+16+4>>2]=k[M+4>>2];k[Q+(S*152|0)+16+8>>2]=k[M+8>>2];k[Q+(S*152|0)+16+12>>2]=k[M+12>>2];o[Q+(S*152|0)>>2]=C*K-x*J;o[Q+(S*152|0)+4>>2]=x*I-K*w;o[Q+(S*152|0)+8>>2]=J*w-C*I;o[Q+(S*152|0)+12>>2]=0.0}else{k[Q+(S*152|0)>>2]=0;k[Q+(S*152|0)+4>>2]=0;k[Q+(S*152|0)+8>>2]=0;k[Q+(S*152|0)+12>>2]=0;k[Q+(S*152|0)+16>>2]=0;k[Q+(S*152|0)+20>>2]=0;k[Q+(S*152|0)+24>>2]=0;k[Q+(S*152|0)+28>>2]=0}if(p){B=-+o[N>>2];G=-+o[O>>2];o[Q+(S*152|0)+48>>2]=-+o[M>>2];o[Q+(S*152|0)+52>>2]=B;o[Q+(S*152|0)+56>>2]=G;o[Q+(S*152|0)+60>>2]=0.0;o[Q+(S*152|0)+32>>2]=-(F*t-D*z);o[Q+(S*152|0)+36>>2]=-(D*m-t*E);o[Q+(S*152|0)+40>>2]=-(z*E-F*m);o[Q+(S*152|0)+44>>2]=0.0}else{k[Q+(S*152|0)+32>>2]=0;k[Q+(S*152|0)+32+4>>2]=0;k[Q+(S*152|0)+32+8>>2]=0;k[Q+(S*152|0)+32+12>>2]=0;k[Q+(S*152|0)+32+16>>2]=0;k[Q+(S*152|0)+32+20>>2]=0;k[Q+(S*152|0)+32+24>>2]=0;k[Q+(S*152|0)+32+28>>2]=0}G=+o[n>>2]+ +o[d+56>>2];if(q){t=+o[q+332>>2];m=+o[q+336>>2];B=+o[q+328>>2];A=t*x-m*C+ +o[q+312>>2];m=+o[q+316>>2]+(m*w-x*B);t=C*B-t*w+ +o[q+320>>2]}else{A=0.0;m=0.0;t=0.0}if(p){v=+o[p+332>>2];u=+o[p+336>>2];C=+o[p+328>>2];s=v*D-u*F+ +o[p+312>>2];u=+o[p+316>>2]+(u*E-D*C);v=F*C-v*E+ +o[p+320>>2]}else{s=0.0;u=0.0;v=0.0}B=+o[M>>2]*(A-s)+(m-u)*+o[N>>2]+(t-v)*+o[O>>2];o[Q+(S*152|0)+104>>2]=+o[U+4+(ca*184|0)+84>>2];B=B*+o[U+4+(ca*184|0)+92>>2];B=!(B>=-0.0)?-B:0.0;do if(!(k[d+64>>2]&4))o[Q+(S*152|0)+100>>2]=0.0;else{u=+o[U+4+(ca*184|0)+120>>2]*+o[d+60>>2];o[Q+(S*152|0)+100>>2]=u;do if(q){if(!(k[g+(Z*244|0)+240>>2]|0))break;F=u*(+o[Q+(S*152|0)+20>>2]*+o[g+(Z*244|0)+132>>2]*+o[q+352>>2])*+o[g+(Z*244|0)+116>>2];E=u*(+o[Q+(S*152|0)+24>>2]*+o[g+(Z*244|0)+136>>2]*+o[q+356>>2])*+o[g+(Z*244|0)+120>>2];o[g+(Z*244|0)+64>>2]=+o[g+(Z*244|0)+112>>2]*(u*(+o[Q+(S*152|0)+16>>2]*+o[g+(Z*244|0)+128>>2]*+o[q+348>>2]))+ +o[g+(Z*244|0)+64>>2];o[g+(Z*244|0)+68>>2]=F+ +o[g+(Z*244|0)+68>>2];o[g+(Z*244|0)+72>>2]=E+ +o[g+(Z*244|0)+72>>2];E=u*+o[g+(Z*244|0)+100>>2]*+o[Q+(S*152|0)+68>>2];F=u*+o[g+(Z*244|0)+104>>2]*+o[Q+(S*152|0)+72>>2];o[g+(Z*244|0)+80>>2]=u*+o[g+(Z*244|0)+96>>2]*+o[Q+(S*152|0)+64>>2]+ +o[g+(Z*244|0)+80>>2];o[g+(Z*244|0)+84>>2]=E+ +o[g+(Z*244|0)+84>>2];o[g+(Z*244|0)+88>>2]=F+ +o[g+(Z*244|0)+88>>2]}while(0);if(!p)break;s=+o[Q+(S*152|0)+100>>2];if(!(k[g+(_*244|0)+240>>2]|0))break;F=+o[Q+(S*152|0)+88>>2];E=+o[Q+(S*152|0)+84>>2];D=+o[Q+(S*152|0)+80>>2];A=s*(+o[Q+(S*152|0)+52>>2]*+o[g+(_*244|0)+132>>2]*+o[p+352>>2])*+o[g+(_*244|0)+116>>2];C=s*(+o[Q+(S*152|0)+56>>2]*+o[g+(_*244|0)+136>>2]*+o[p+356>>2])*+o[g+(_*244|0)+120>>2];o[g+(_*244|0)+64>>2]=+o[g+(_*244|0)+112>>2]*(s*(+o[Q+(S*152|0)+48>>2]*+o[g+(_*244|0)+128>>2]*+o[p+348>>2]))+ +o[g+(_*244|0)+64>>2];o[g+(_*244|0)+68>>2]=A+ +o[g+(_*244|0)+68>>2];o[g+(_*244|0)+72>>2]=C+ +o[g+(_*244|0)+72>>2];E=E*(+o[g+(_*244|0)+100>>2]*-s);F=F*(+o[g+(_*244|0)+104>>2]*-s);o[g+(_*244|0)+80>>2]=+o[g+(_*244|0)+80>>2]-D*(+o[g+(_*244|0)+96>>2]*-s);o[g+(_*244|0)+84>>2]=+o[g+(_*244|0)+84>>2]-E;o[g+(_*244|0)+88>>2]=+o[g+(_*244|0)+88>>2]-F}while(0);o[Q+(S*152|0)+96>>2]=0.0;if(!(k[g+(Z*244|0)+240>>2]|0)){v=0.0;u=0.0;s=0.0;t=0.0;m=0.0;j=0.0}else{v=+o[g+(Z*244|0)+208>>2];u=+o[g+(Z*244|0)+212>>2];s=+o[g+(Z*244|0)+216>>2];t=+o[g+(Z*244|0)+224>>2];m=+o[g+(Z*244|0)+228>>2];j=+o[g+(Z*244|0)+232>>2]}if(!(k[g+(_*244|0)+240>>2]|0)){h=0.0;w=0.0;x=0.0;y=0.0;z=0.0;A=0.0}else{h=+o[g+(_*244|0)+208>>2];w=+o[g+(_*244|0)+212>>2];x=+o[g+(_*244|0)+216>>2];y=+o[g+(_*244|0)+224>>2];z=+o[g+(_*244|0)+228>>2];A=+o[g+(_*244|0)+232>>2]}s=B-((v+ +o[g+(Z*244|0)+176>>2])*+o[Q+(S*152|0)+16>>2]+(u+ +o[g+(Z*244|0)+180>>2])*+o[Q+(S*152|0)+20>>2]+(s+ +o[g+(Z*244|0)+184>>2])*+o[Q+(S*152|0)+24>>2]+((t+ +o[g+(Z*244|0)+192>>2])*+o[Q+(S*152|0)>>2]+(m+ +o[g+(Z*244|0)+196>>2])*+o[Q+(S*152|0)+4>>2]+(j+ +o[g+(Z*244|0)+200>>2])*+o[Q+(S*152|0)+8>>2])+((h+ +o[g+(_*244|0)+176>>2])*+o[Q+(S*152|0)+48>>2]+(w+ +o[g+(_*244|0)+180>>2])*+o[Q+(S*152|0)+52>>2]+(x+ +o[g+(_*244|0)+184>>2])*+o[Q+(S*152|0)+56>>2]+((y+ +o[g+(_*244|0)+192>>2])*+o[Q+(S*152|0)+32>>2]+(z+ +o[g+(_*244|0)+196>>2])*+o[Q+(S*152|0)+36>>2]+(A+ +o[g+(_*244|0)+200>>2])*+o[Q+(S*152|0)+40>>2])));q=(k[d+44>>2]|0)==0;m=+o[d+12>>2];if(G>0.0){u=0.0;s=s-G/m}else u=-(G*+o[(q|G>+o[d+48>>2]?d+32|0:d+36|0)>>2])/m;m=+o[Q+(S*152|0)+108>>2];j=u*m;m=s*m;if(q|G>+o[d+48>>2]){o[Q+(S*152|0)+112>>2]=j+m;o[Q+(S*152|0)+128>>2]=0.0}else{o[Q+(S*152|0)+112>>2]=m;o[Q+(S*152|0)+128>>2]=j}o[Q+(S*152|0)+116>>2]=0.0;o[Q+(S*152|0)+120>>2]=0.0;o[Q+(S*152|0)+124>>2]=1.0e10;k[Q+(S*152|0)+140>>2]=k[a+68>>2];if(!f){u=0.0;h=0.0;v=0.0}else{u=+o[f+328>>2];h=+o[f+332>>2];v=+o[f+336>>2]}if(!l){s=0.0;t=0.0;m=0.0}else{s=+o[l+328>>2];t=+o[l+332>>2];m=+o[l+336>>2]}j=s-u;u=t-h;s=m-v;o[ea+32>>2]=j;o[ea+32+4>>2]=u;o[ea+32+8>>2]=s;o[ea+32+12>>2]=0.0;do if((e|0)>0?+o[U+4+(ca*184|0)+88>>2]>0.0:0){e=e+-1|0;m=+Y(+(j*j+u*u+s*s));if(m>+o[d+80>>2]){o[ea+32>>2]=j*(1.0/m);o[ea+32+4>>2]=u*(1.0/m);o[ea+32+8>>2]=s*(1.0/m);if(!(k[V+180>>2]&2)){h=j*(1.0/m);j=u*(1.0/m);m=s*(1.0/m)}else{t=+o[V+4>>2];y=+o[V+20>>2];C=+o[V+36>>2];v=+o[V+8>>2];A=+o[V+24>>2];E=+o[V+40>>2];h=+o[V+12>>2];B=+o[V+28>>2];G=+o[V+44>>2];D=(t*(j*(1.0/m))+y*(u*(1.0/m))+s*(1.0/m)*C)*+o[V+164>>2];F=(j*(1.0/m)*v+u*(1.0/m)*A+s*(1.0/m)*E)*+o[V+168>>2];m=(j*(1.0/m)*h+u*(1.0/m)*B+s*(1.0/m)*G)*+o[V+172>>2];o[ea+32>>2]=t*D+v*F+h*m;o[ea+32+4>>2]=y*D+A*F+B*m;o[ea+32+8>>2]=C*D+E*F+G*m;o[ea+32+12>>2]=0.0;h=t*D+v*F+h*m;j=y*D+A*F+B*m;m=C*D+E*F+G*m}if(k[W+180>>2]&2){y=+o[W+4>>2];C=+o[W+20>>2];s=+o[W+36>>2];A=+o[W+8>>2];E=+o[W+24>>2];u=+o[W+40>>2];B=+o[W+12>>2];G=+o[W+28>>2];v=+o[W+44>>2];D=(y*h+C*j+s*m)*+o[W+164>>2];F=(h*A+j*E+m*u)*+o[W+168>>2];j=(h*B+j*G+m*v)*+o[W+172>>2];o[ea+32>>2]=y*D+A*F+B*j;o[ea+32+4>>2]=C*D+E*F+G*j;o[ea+32+8>>2]=s*D+u*F+v*j;o[ea+32+12>>2]=0.0;m=s*D+u*F+v*j;h=y*D+A*F+B*j;j=C*D+E*F+G*j}if(!(+Y(+(h*h+j*j+m*m))>.001))break;Lq(a,ea+32|0,Z,_,S,R);break}Lq(a,M,Z,_,S,R);m=+o[O>>2];if(+X(+m)>.7071067690849304){s=+o[N>>2];G=1.0/+Y(+(m*m+s*s));o[ea+16>>2]=0.0;o[ea+16+4>>2]=-(G*m);o[ea+16+8>>2]=G*s;o[ea>>2]=(m*m+s*s)*G;F=+o[M>>2];o[ea+4>>2]=-(F*(G*s));h=F*-(G*m);u=0.0;j=-(G*m);v=G*s;t=(m*m+s*s)*G;s=-(F*(G*s))}else{t=+o[M>>2];G=+o[N>>2];s=1.0/+Y(+(t*t+G*G));o[ea+16>>2]=-(G*s);o[ea+16+4>>2]=s*t;o[ea+16+8>>2]=0.0;o[ea>>2]=-(m*(s*t));o[ea+4>>2]=m*-(G*s);h=(t*t+G*G)*s;u=-(G*s);j=s*t;v=0.0;t=-(m*(s*t));s=m*-(G*s)}o[ea+8>>2]=h;q=(k[V+180>>2]&2|0)==0;if(!q){x=+o[V+4>>2];y=+o[V+20>>2];C=+o[V+36>>2];m=+o[V+8>>2];A=+o[V+24>>2];E=+o[V+40>>2];z=+o[V+12>>2];B=+o[V+28>>2];G=+o[V+44>>2];D=(x*u+y*j+C*v)*+o[V+164>>2];F=(u*m+j*A+v*E)*+o[V+168>>2];v=(u*z+j*B+v*G)*+o[V+172>>2];o[ea+16>>2]=x*D+m*F+z*v;o[ea+16+4>>2]=y*D+A*F+B*v;o[ea+16+8>>2]=C*D+E*F+G*v;o[ea+16+12>>2]=0.0;u=x*D+m*F+z*v;j=y*D+A*F+B*v;v=C*D+E*F+G*v}p=(k[W+180>>2]&2|0)==0;if(!p){x=+o[W+4>>2];y=+o[W+20>>2];C=+o[W+36>>2];m=+o[W+8>>2];A=+o[W+24>>2];E=+o[W+40>>2];z=+o[W+12>>2];B=+o[W+28>>2];G=+o[W+44>>2];D=(x*u+y*j+C*v)*+o[W+164>>2];F=(u*m+j*A+v*E)*+o[W+168>>2];v=(u*z+j*B+v*G)*+o[W+172>>2];o[ea+16>>2]=x*D+m*F+z*v;o[ea+16+4>>2]=y*D+A*F+B*v;o[ea+16+8>>2]=C*D+E*F+G*v;o[ea+16+12>>2]=0.0;u=x*D+m*F+z*v;j=y*D+A*F+B*v;v=C*D+E*F+G*v}if(q)m=h;else{w=+o[V+4>>2];y=+o[V+20>>2];C=+o[V+36>>2];x=+o[V+8>>2];A=+o[V+24>>2];E=+o[V+40>>2];z=+o[V+12>>2];B=+o[V+28>>2];G=+o[V+44>>2];D=(w*t+y*s+C*h)*+o[V+164>>2];F=(t*x+s*A+h*E)*+o[V+168>>2];m=(t*z+s*B+h*G)*+o[V+172>>2];o[ea>>2]=w*D+x*F+z*m;o[ea+4>>2]=y*D+A*F+B*m;o[ea+8>>2]=C*D+E*F+G*m;o[ea+12>>2]=0.0;t=w*D+x*F+z*m;s=y*D+A*F+B*m;m=C*D+E*F+G*m}if(!p){w=+o[W+4>>2];y=+o[W+20>>2];C=+o[W+36>>2];x=+o[W+8>>2];A=+o[W+24>>2];E=+o[W+40>>2];z=+o[W+12>>2];B=+o[W+28>>2];G=+o[W+44>>2];D=(w*t+y*s+C*m)*+o[W+164>>2];F=(t*x+s*A+m*E)*+o[W+168>>2];m=(t*z+s*B+m*G)*+o[W+172>>2];o[ea>>2]=w*D+x*F+z*m;o[ea+4>>2]=y*D+A*F+B*m;o[ea+8>>2]=C*D+E*F+G*m;o[ea+12>>2]=0.0;t=w*D+x*F+z*m;s=y*D+A*F+B*m;m=C*D+E*F+G*m}if(+Y(+(u*u+j*j+v*v))>.001)Lq(a,ea+16|0,Z,_,S,R);if(!(+Y(+(t*t+s*s+m*m))>.001))break;Lq(a,ea,Z,_,S,R)}while(0);do if(!(k[d+64>>2]&32))da=95;else{if(!(i[U+4+(ca*184|0)+116>>0]|0)){da=95;break}Kq(a,U+4+(ca*184|0)+152|0,Z,_,S,R,ea+64|0,ea+48|0,1.0,+o[U+4+(ca*184|0)+132>>2],+o[U+4+(ca*184|0)+140>>2]);if(!(k[d+64>>2]&16))break;Kq(a,U+4+(ca*184|0)+168|0,Z,_,S,R,ea+64|0,ea+48|0,1.0,+o[U+4+(ca*184|0)+136>>2],+o[U+4+(ca*184|0)+144>>2])}while(0);do if((da|0)==95){da=0;g=U+4+(ca*184|0)+152|0;v=+o[M>>2];t=+o[N>>2];j=+o[O>>2];u=P-(P*I+L*J+H*K)*v;s=L-(P*I+L*J+H*K)*t;m=H-(P*I+L*J+H*K)*j;o[U+4+(ca*184|0)+152>>2]=u;q=U+4+(ca*184|0)+156|0;o[q>>2]=s;n=U+4+(ca*184|0)+160|0;o[n>>2]=m;o[U+4+(ca*184|0)+164>>2]=0.0;if((k[d+64>>2]&64|0)==0?u*u+s*s+m*m>1.1920928955078125e-07:0){P=1.0/+Y(+(u*u+s*s+m*m));o[g>>2]=u*P;o[q>>2]=P*s;o[n>>2]=P*m;Jq(V,g);Jq(W,g);Kq(a,g,Z,_,S,R,ea+64|0,ea+48|0,1.0,0.0,0.0);if(!(k[d+64>>2]&16))break;p=U+4+(ca*184|0)+168|0;H=+o[q>>2];E=+o[O>>2];D=+o[n>>2];F=+o[N>>2];K=+o[M>>2];G=+o[g>>2];o[U+4+(ca*184|0)+168>>2]=H*E-D*F;o[U+4+(ca*184|0)+180>>2]=0.0;P=1.0/+Y(+((H*E-D*F)*(H*E-D*F)+(D*K-E*G)*(D*K-E*G)+(F*G-H*K)*(F*G-H*K)));o[p>>2]=(H*E-D*F)*P;o[U+4+(ca*184|0)+172>>2]=(D*K-E*G)*P;o[U+4+(ca*184|0)+176>>2]=(F*G-H*K)*P;Jq(V,p);Jq(W,p);Kq(a,p,Z,_,S,R,ea+64|0,ea+48|0,1.0,0.0,0.0);break}p=U+4+(ca*184|0)+168|0;if(+X(+j)>.7071067690849304){P=1.0/+Y(+(j*j+t*t));o[g>>2]=0.0;o[q>>2]=-(P*j);o[n>>2]=P*t;h=-(v*(P*t));m=v*-(P*j);j=(j*j+t*t)*P}else{P=1.0/+Y(+(v*v+t*t));o[g>>2]=-(t*P);o[q>>2]=P*v;o[n>>2]=0.0;h=j*-(t*P);m=(v*v+t*t)*P;j=-(j*(P*v))}o[p>>2]=j;o[U+4+(ca*184|0)+172>>2]=h;o[U+4+(ca*184|0)+176>>2]=m;Jq(V,g);Jq(W,g);Kq(a,g,Z,_,S,R,ea+64|0,ea+48|0,1.0,0.0,0.0);f=k[d+64>>2]|0;if(f&16){Jq(V,p);Jq(W,p);Kq(a,p,Z,_,S,R,ea+64|0,ea+48|0,1.0,0.0,0.0);f=k[d+64>>2]|0}if((f&80|0)!=80)break;i[U+4+(ca*184|0)+116>>0]=1}while(0);q=k[a+16>>2]|0;f=k[q+(Z*244|0)+240>>2]|0;l=k[q+(_*244|0)+240>>2]|0;n=k[Q+(S*152|0)+140>>2]|0;p=k[a+76>>2]|0;g=k[d+64>>2]|0;do if(!(g&4))o[p+(n*152|0)+100>>2]=0.0;else{j=+o[U+4+(ca*184|0)+124>>2]*+o[d+60>>2];o[p+(n*152|0)+100>>2]=j;if(f){H=+o[f+344>>2];P=j*(H*+o[p+(n*152|0)+20>>2]*+o[f+352>>2])*+o[q+(Z*244|0)+116>>2];K=j*(H*+o[p+(n*152|0)+24>>2]*+o[f+356>>2])*+o[q+(Z*244|0)+120>>2];o[q+(Z*244|0)+64>>2]=+o[q+(Z*244|0)+112>>2]*(j*(H*+o[p+(n*152|0)+16>>2]*+o[f+348>>2]))+ +o[q+(Z*244|0)+64>>2];o[q+(Z*244|0)+68>>2]=P+ +o[q+(Z*244|0)+68>>2];o[q+(Z*244|0)+72>>2]=K+ +o[q+(Z*244|0)+72>>2];K=j*+o[q+(Z*244|0)+100>>2]*+o[p+(n*152|0)+68>>2];P=j*+o[q+(Z*244|0)+104>>2]*+o[p+(n*152|0)+72>>2];o[q+(Z*244|0)+80>>2]=j*+o[q+(Z*244|0)+96>>2]*+o[p+(n*152|0)+64>>2]+ +o[q+(Z*244|0)+80>>2];o[q+(Z*244|0)+84>>2]=K+ +o[q+(Z*244|0)+84>>2];o[q+(Z*244|0)+88>>2]=P+ +o[q+(Z*244|0)+88>>2]}if(!l)break;j=+o[l+344>>2];h=+o[p+(n*152|0)+100>>2];if(!(k[q+(_*244|0)+240>>2]|0))break;P=+o[p+(n*152|0)+88>>2];K=+o[p+(n*152|0)+84>>2];H=+o[p+(n*152|0)+80>>2];F=h*(j*+o[p+(n*152|0)+52>>2]*+o[l+352>>2])*+o[q+(_*244|0)+116>>2];G=h*(j*+o[p+(n*152|0)+56>>2]*+o[l+356>>2])*+o[q+(_*244|0)+120>>2];o[q+(_*244|0)+64>>2]=+o[q+(_*244|0)+112>>2]*(h*(j*+o[p+(n*152|0)+48>>2]*+o[l+348>>2]))+ +o[q+(_*244|0)+64>>2];o[q+(_*244|0)+68>>2]=F+ +o[q+(_*244|0)+68>>2];o[q+(_*244|0)+72>>2]=G+ +o[q+(_*244|0)+72>>2];K=K*(+o[q+(_*244|0)+100>>2]*-h);P=P*(+o[q+(_*244|0)+104>>2]*-h);o[q+(_*244|0)+80>>2]=+o[q+(_*244|0)+80>>2]-H*(+o[q+(_*244|0)+96>>2]*-h);o[q+(_*244|0)+84>>2]=+o[q+(_*244|0)+84>>2]-K;o[q+(_*244|0)+88>>2]=+o[q+(_*244|0)+88>>2]-P}while(0);do if(g&16){if(!(g&4)){o[p+((n+1|0)*152|0)+100>>2]=0.0;break}h=+o[U+4+(ca*184|0)+128>>2]*+o[d+60>>2];o[p+((n+1|0)*152|0)+100>>2]=h;do if(f){j=+o[f+344>>2];if(!(k[q+(Z*244|0)+240>>2]|0))break;P=h*(j*+o[p+((n+1|0)*152|0)+20>>2])*+o[q+(Z*244|0)+116>>2];K=h*(j*+o[p+((n+1|0)*152|0)+24>>2])*+o[q+(Z*244|0)+120>>2];o[q+(Z*244|0)+64>>2]=+o[q+(Z*244|0)+112>>2]*(h*(j*+o[p+((n+1|0)*152|0)+16>>2]))+ +o[q+(Z*244|0)+64>>2];o[q+(Z*244|0)+68>>2]=P+ +o[q+(Z*244|0)+68>>2];o[q+(Z*244|0)+72>>2]=K+ +o[q+(Z*244|0)+72>>2];K=h*+o[q+(Z*244|0)+100>>2]*+o[p+((n+1|0)*152|0)+68>>2];P=h*+o[q+(Z*244|0)+104>>2]*+o[p+((n+1|0)*152|0)+72>>2];o[q+(Z*244|0)+80>>2]=h*+o[q+(Z*244|0)+96>>2]*+o[p+((n+1|0)*152|0)+64>>2]+ +o[q+(Z*244|0)+80>>2];o[q+(Z*244|0)+84>>2]=K+ +o[q+(Z*244|0)+84>>2];o[q+(Z*244|0)+88>>2]=P+ +o[q+(Z*244|0)+88>>2]}while(0);if(!l)break;h=+o[l+344>>2];j=+o[p+((n+1|0)*152|0)+100>>2];if(!(k[q+(_*244|0)+240>>2]|0))break;P=+o[p+((n+1|0)*152|0)+88>>2];K=+o[p+((n+1|0)*152|0)+84>>2];H=+o[p+((n+1|0)*152|0)+80>>2];F=j*(h*+o[p+((n+1|0)*152|0)+52>>2])*+o[q+(_*244|0)+116>>2];G=j*(h*+o[p+((n+1|0)*152|0)+56>>2])*+o[q+(_*244|0)+120>>2];o[q+(_*244|0)+64>>2]=+o[q+(_*244|0)+112>>2]*(j*(h*+o[p+((n+1|0)*152|0)+48>>2]))+ +o[q+(_*244|0)+64>>2];o[q+(_*244|0)+68>>2]=F+ +o[q+(_*244|0)+68>>2];o[q+(_*244|0)+72>>2]=G+ +o[q+(_*244|0)+72>>2];K=K*(+o[q+(_*244|0)+100>>2]*-j);P=P*(+o[q+(_*244|0)+104>>2]*-j);o[q+(_*244|0)+80>>2]=+o[q+(_*244|0)+80>>2]-H*(+o[q+(_*244|0)+96>>2]*-j);o[q+(_*244|0)+84>>2]=+o[q+(_*244|0)+84>>2]-K;o[q+(_*244|0)+88>>2]=+o[q+(_*244|0)+88>>2]-P}while(0);f=k[U+748>>2]|0}ca=ca+1|0}while((ca|0)<(f|0))}if((ba|0)==(c+-1|0))break;else ba=ba+1|0}r=ea;return}function Oq(a,b,c,d,e,f,g,h,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;j=j|0;var l=0,m=0,n=0.0,p=0,q=0,s=0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,P=0,Q=0,R=0,S=0,T=0,U=0,V=0;U=r;r=r+304|0;k[a+188>>2]=-1;Cw(4032);k[a+184>>2]=0;if((c|0)>0){j=0;while(1){k[(k[b+(j<<2)>>2]|0)+212>>2]=-1;if((j|0)==(c+-1|0))break;else j=j+1|0}}j=k[a+12>>2]|0;if((j|0)<(c+1|0)){if((c+1|0)!=0?(k[5108]=(k[5108]|0)+1,m=iF(((c+1|0)*244|3)+16|0)|0,(m|0)!=0):0){k[(m+4+15&-16)+-4>>2]=m;l=m+4+15&-16}else l=0;j=k[a+8>>2]|0;if((j|0)>0){m=0;while(1){S=l+(m*244|0)|0;T=k[a+16>>2]|0;Q=T+(m*244|0)|0;k[S>>2]=k[Q>>2];k[S+4>>2]=k[Q+4>>2];k[S+8>>2]=k[Q+8>>2];k[S+12>>2]=k[Q+12>>2];S=l+(m*244|0)+16|0;Q=T+(m*244|0)+16|0;k[S>>2]=k[Q>>2];k[S+4>>2]=k[Q+4>>2];k[S+8>>2]=k[Q+8>>2];k[S+12>>2]=k[Q+12>>2];S=l+(m*244|0)+32|0;Q=T+(m*244|0)+32|0;k[S>>2]=k[Q>>2];k[S+4>>2]=k[Q+4>>2];k[S+8>>2]=k[Q+8>>2];k[S+12>>2]=k[Q+12>>2];S=l+(m*244|0)+48|0;Q=T+(m*244|0)+48|0;k[S>>2]=k[Q>>2];k[S+4>>2]=k[Q+4>>2];k[S+8>>2]=k[Q+8>>2];k[S+12>>2]=k[Q+12>>2];qF(l+(m*244|0)+64|0,T+(m*244|0)+64|0,180)|0;if((m|0)==(j+-1|0))break;else m=m+1|0}}j=k[a+16>>2]|0;if(j){if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[j+-4>>2]|0)}k[a+16>>2]=0}i[a+20>>0]=1;k[a+16>>2]=l;k[a+12>>2]=c+1;l=a+8|0;m=c+1|0}else{l=a+8|0;m=j}nF(U|0,0,244)|0;j=k[l>>2]|0;if((j|0)<0){if((m|0)<0){m=k[a+16>>2]|0;if(m){if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[m+-4>>2]|0)}k[a+16>>2]=0}i[a+20>>0]=1;k[a+16>>2]=0;k[a+12>>2]=0}while(1){T=k[a+16>>2]|0;S=T+(j*244|0)|0;k[S>>2]=k[U>>2];k[S+4>>2]=k[U+4>>2];k[S+8>>2]=k[U+8>>2];k[S+12>>2]=k[U+12>>2];S=T+(j*244|0)+16|0;k[S>>2]=k[U+16>>2];k[S+4>>2]=k[U+16+4>>2];k[S+8>>2]=k[U+16+8>>2];k[S+12>>2]=k[U+16+12>>2];S=T+(j*244|0)+32|0;k[S>>2]=k[U+32>>2];k[S+4>>2]=k[U+32+4>>2];k[S+8>>2]=k[U+32+8>>2];k[S+12>>2]=k[U+32+12>>2];S=T+(j*244|0)+48|0;k[S>>2]=k[U+48>>2];k[S+4>>2]=k[U+48+4>>2];k[S+8>>2]=k[U+48+8>>2];k[S+12>>2]=k[U+48+12>>2];qF(T+(j*244|0)+64|0,U+64|0,180)|0;if((j|0)==-1)break;else j=j+1|0}}k[l>>2]=0;if((c|0)>0){j=0;while(1){q=b+(j<<2)|0;s=Mq(a,k[q>>2]|0,+o[h+12>>2])|0;q=k[q>>2]|0;if((!((q|0)==0?1:(k[q+236>>2]&2|0)==0)?+o[q+344>>2]!=0.0:0)?(p=k[a+16>>2]|0,(k[q+504>>2]&2|0)!=0):0){t=+o[h+76>>2];I=1.0/+o[q+396>>2];M=1.0/+o[q+400>>2];n=1.0/+o[q+404>>2];E=+o[q+4>>2];F=+o[q+8>>2];G=+o[q+12>>2];H=+o[q+20>>2];K=+o[q+24>>2];O=+o[q+28>>2];J=+o[q+36>>2];N=+o[q+40>>2];w=+o[q+44>>2];x=+o[q+328>>2];y=+o[q+332>>2];v=+o[q+336>>2];z=(E*(I*E)+F*(M*F)+G*(n*G))*x+(I*E*H+M*F*K+n*G*O)*y+(I*E*J+M*F*N+n*G*w)*v;A=(E*(I*H)+F*(M*K)+G*(n*O))*x+(H*(I*H)+K*(M*K)+O*(n*O))*y+(I*H*J+M*K*N+n*O*w)*v;w=v*(J*(I*J)+N*(M*N)+w*(n*w))+(x*(E*(I*J)+F*(M*N)+G*(n*w))+y*(H*(I*J)+K*(M*N)+O*(n*w)));n=(y*w-v*A)*(y*w-v*A)+(v*z-x*w)*(v*z-x*w)+(x*A-y*z)*(x*A-y*z);if(n>t*t){n=1.0/+Y(+n)*t;u=(y*w-v*A)*n;t=n*(v*z-x*w);n=n*(x*A-y*z)}else{u=y*w-v*A;t=v*z-x*w;n=x*A-y*z}M=+o[h+12>>2];N=(u*+o[q+268>>2]+t*+o[q+284>>2]+n*+o[q+300>>2])*M;O=M*(u*+o[q+272>>2]+t*+o[q+288>>2]+n*+o[q+304>>2]);o[p+(s*244|0)+224>>2]=+o[p+(s*244|0)+224>>2]-(u*+o[q+264>>2]+t*+o[q+280>>2]+n*+o[q+296>>2])*M;o[p+(s*244|0)+228>>2]=+o[p+(s*244|0)+228>>2]-N;o[p+(s*244|0)+232>>2]=+o[p+(s*244|0)+232>>2]-O}if((j|0)==(c+-1|0))break;else j=j+1|0}}if((g|0)>0){l=0;do{T=k[f+(l<<2)>>2]|0;Sb[k[(k[T>>2]|0)+8>>2]&255](T);o[T+36>>2]=0.0;l=l+1|0}while((l|0)<(g|0))}b=k[a+168>>2]|0;if((b|0)<(g|0)?(k[a+172>>2]|0)<(g|0):0){if(!g)l=0;else{k[5108]=(k[5108]|0)+1;l=iF((g<<3|3)+16|0)|0;if(!l)l=0;else{k[(l+4+15&-16)+-4>>2]=l;l=l+4+15&-16}b=k[a+168>>2]|0}if((b|0)>0){j=b+-1|0;b=0;while(1){m=l+(b<<3)|0;if(m){S=(k[a+176>>2]|0)+(b<<3)|0;T=k[S+4>>2]|0;k[m>>2]=k[S>>2];k[m+4>>2]=T}if((b|0)==(j|0))break;else b=b+1|0}}b=k[a+176>>2]|0;if(b){if(i[a+180>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+176>>2]=0}i[a+180>>0]=1;k[a+176>>2]=l;k[a+172>>2]=g}k[a+168>>2]=g;if((g|0)>0){s=0;l=0;do{p=k[a+176>>2]|0;q=p+(s<<3)|0;b=f+(s<<2)|0;j=k[b>>2]|0;m=k[j+44>>2]|0;if(m){j=m+64|0;do{k[m>>2]=0;m=m+4|0}while((m|0)<(j|0));j=k[b>>2]|0}if(!(i[j+20>>0]|0)){k[q>>2]=0;k[p+(s<<3)+4>>2]=0;j=0}else{Ub[k[(k[j>>2]|0)+16>>2]&127](j,q);j=k[q>>2]|0}l=j+l|0;s=s+1|0}while((s|0)<(g|0))}else l=0;m=k[a+48>>2]|0;if((m|0)<(l|0)?(k[a+52>>2]|0)<(l|0):0){if(!l)j=0;else{k[5108]=(k[5108]|0)+1;b=iF((l*152|3)+16|0)|0;if(!b)j=0;else{k[(b+4+15&-16)+-4>>2]=b;j=b+4+15&-16}m=k[a+48>>2]|0}if((m|0)>0){m=m+-1|0;b=0;while(1){qF(j+(b*152|0)|0,(k[a+56>>2]|0)+(b*152|0)|0,152)|0;if((b|0)==(m|0))break;else b=b+1|0}}m=k[a+56>>2]|0;if(m){if(i[a+60>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[m+-4>>2]|0)}k[a+56>>2]=0}i[a+60>>0]=1;k[a+56>>2]=j;k[a+52>>2]=l}k[a+48>>2]=l;if((g|0)>0){j=k[a+176>>2]|0;S=0;T=0;while(1){R=j+(T<<3)|0;if(!(k[R>>2]|0))m=0;else{j=k[a+56>>2]|0;m=f+(T<<2)|0;l=k[m>>2]|0;c=k[l+28>>2]|0;p=k[l+32>>2]|0;b=Mq(a,c,+o[h+12>>2])|0;P=Mq(a,p,+o[h+12>>2])|0;Q=k[a+16>>2]|0;s=k[l+24>>2]|0;s=(s|0)>0?s:k[h+20>>2]|0;if((s|0)>(k[a+184>>2]|0))k[a+184>>2]=s;if((k[R>>2]|0)>0){q=0;do{V=q+S|0;nF(j+(V*152|0)|0,0,152)|0;o[j+(V*152|0)+120>>2]=-3402823466385288598117041.0e14;o[j+(V*152|0)+124>>2]=3402823466385288598117041.0e14;o[j+(V*152|0)+100>>2]=0.0;o[j+(V*152|0)+96>>2]=0.0;k[j+(V*152|0)+144>>2]=b;k[j+(V*152|0)+148>>2]=P;k[j+(V*152|0)+136>>2]=s;q=q+1|0}while((q|0)<(k[R>>2]|0))}k[Q+(b*244|0)+64>>2]=0;k[Q+(b*244|0)+64+4>>2]=0;k[Q+(b*244|0)+64+8>>2]=0;k[Q+(b*244|0)+64+12>>2]=0;k[Q+(b*244|0)+64+16>>2]=0;k[Q+(b*244|0)+64+20>>2]=0;k[Q+(b*244|0)+64+24>>2]=0;k[Q+(b*244|0)+64+28>>2]=0;k[Q+(b*244|0)+144>>2]=0;k[Q+(b*244|0)+144+4>>2]=0;k[Q+(b*244|0)+144+8>>2]=0;k[Q+(b*244|0)+144+12>>2]=0;k[Q+(b*244|0)+144+16>>2]=0;k[Q+(b*244|0)+144+20>>2]=0;k[Q+(b*244|0)+144+24>>2]=0;k[Q+(b*244|0)+144+28>>2]=0;k[Q+(P*244|0)+64>>2]=0;k[Q+(P*244|0)+64+4>>2]=0;k[Q+(P*244|0)+64+8>>2]=0;k[Q+(P*244|0)+64+12>>2]=0;k[Q+(P*244|0)+64+16>>2]=0;k[Q+(P*244|0)+64+20>>2]=0;k[Q+(P*244|0)+64+24>>2]=0;k[Q+(P*244|0)+64+28>>2]=0;k[Q+(P*244|0)+144>>2]=0;k[Q+(P*244|0)+144+4>>2]=0;k[Q+(P*244|0)+144+8>>2]=0;k[Q+(P*244|0)+144+12>>2]=0;k[Q+(P*244|0)+144+16>>2]=0;k[Q+(P*244|0)+144+20>>2]=0;k[Q+(P*244|0)+144+24>>2]=0;k[Q+(P*244|0)+144+28>>2]=0;o[U+248>>2]=1.0/+o[h+12>>2];o[U+248+4>>2]=+o[h+32>>2];k[U+248+8>>2]=j+(S*152|0)+16;k[U+248+12>>2]=j+(S*152|0);k[U+248+16>>2]=j+(S*152|0)+48;k[U+248+20>>2]=j+(S*152|0)+32;k[U+248+24>>2]=38;k[U+248+28>>2]=j+(S*152|0)+112;V=j+(S*152|0)+116|0;o[V>>2]=+o[h+40>>2];o[U+248+52>>2]=+o[h+4>>2];k[U+248+32>>2]=V;k[U+248+36>>2]=j+(S*152|0)+120;k[U+248+40>>2]=j+(S*152|0)+124;k[U+248+48>>2]=k[h+20>>2];V=k[m>>2]|0;Ub[k[(k[V>>2]|0)+20>>2]&127](V,U+248|0);if((k[R>>2]|0)>0){q=0;do{s=q+S|0;t=+o[(k[m>>2]|0)+16>>2];if(+o[j+(s*152|0)+124>>2]>=t)o[j+(s*152|0)+124>>2]=t;if(+o[j+(s*152|0)+120>>2]<=-t)o[j+(s*152|0)+120>>2]=-t;k[j+(s*152|0)+132>>2]=l;V=k[l+28>>2]|0;C=+o[j+(s*152|0)>>2];F=+o[j+(s*152|0)+4>>2];z=+o[j+(s*152|0)+8>>2];E=(C*+o[V+280>>2]+F*+o[V+284>>2]+z*+o[V+288>>2])*+o[V+548>>2];G=(C*+o[V+296>>2]+F*+o[V+300>>2]+z*+o[V+304>>2])*+o[V+552>>2];o[j+(s*152|0)+64>>2]=(+o[V+264>>2]*C+ +o[V+268>>2]*F+ +o[V+272>>2]*z)*+o[V+544>>2];o[j+(s*152|0)+68>>2]=E;o[j+(s*152|0)+72>>2]=G;o[j+(s*152|0)+76>>2]=0.0;V=k[l+32>>2]|0;G=+o[j+(s*152|0)+32>>2];E=+o[j+(s*152|0)+36>>2];z=+o[j+(s*152|0)+40>>2];F=(G*+o[V+280>>2]+E*+o[V+284>>2]+z*+o[V+288>>2])*+o[V+548>>2];C=(G*+o[V+296>>2]+E*+o[V+300>>2]+z*+o[V+304>>2])*+o[V+552>>2];o[j+(s*152|0)+80>>2]=(+o[V+264>>2]*G+ +o[V+268>>2]*E+ +o[V+272>>2]*z)*+o[V+544>>2];o[j+(s*152|0)+84>>2]=F;o[j+(s*152|0)+88>>2]=C;o[j+(s*152|0)+92>>2]=0.0;C=+o[c+344>>2];F=+o[j+(s*152|0)+16>>2];G=+o[j+(s*152|0)+20>>2];H=+o[j+(s*152|0)+24>>2];I=+o[j+(s*152|0)>>2];J=+o[j+(s*152|0)+4>>2];K=+o[j+(s*152|0)+8>>2];D=+o[p+344>>2];L=+o[j+(s*152|0)+48>>2];M=+o[j+(s*152|0)+52>>2];N=+o[j+(s*152|0)+56>>2];O=+o[j+(s*152|0)+32>>2];z=F*(C*F)+G*(C*G)+H*(C*H)+(I*(+o[c+264>>2]*I+ +o[c+268>>2]*J+ +o[c+272>>2]*K)+J*(I*+o[c+280>>2]+J*+o[c+284>>2]+K*+o[c+288>>2])+K*(I*+o[c+296>>2]+J*+o[c+300>>2]+K*+o[c+304>>2]))+(L*(D*L)+M*(D*M)+N*(D*N))+(O*(+o[p+264>>2]*O+ +o[p+268>>2]*E+ +o[p+272>>2]*z)+E*(O*+o[p+280>>2]+E*+o[p+284>>2]+z*+o[p+288>>2])+z*(O*+o[p+296>>2]+E*+o[p+300>>2]+z*+o[p+304>>2]));if(+X(+z)>1.1920928955078125e-07)z=1.0/z;else z=0.0;o[j+(s*152|0)+108>>2]=z;if(!(k[Q+(b*244|0)+240>>2]|0)){y=0.0;x=0.0;w=0.0;v=0.0;t=0.0;u=0.0}else{y=+o[Q+(b*244|0)+208>>2];x=+o[Q+(b*244|0)+212>>2];w=+o[Q+(b*244|0)+216>>2];v=+o[Q+(b*244|0)+224>>2];t=+o[Q+(b*244|0)+228>>2];u=+o[Q+(b*244|0)+232>>2]}if(!(k[Q+(P*244|0)+240>>2]|0)){A=0.0;n=0.0;B=0.0;C=0.0;D=0.0;E=0.0}else{A=+o[Q+(P*244|0)+208>>2];n=+o[Q+(P*244|0)+212>>2];B=+o[Q+(P*244|0)+216>>2];C=+o[Q+(P*244|0)+224>>2];D=+o[Q+(P*244|0)+228>>2];E=+o[Q+(P*244|0)+232>>2]}o[j+(s*152|0)+112>>2]=+o[j+(s*152|0)+112>>2]*z+z*(0.0-+o[U+248+52>>2]*((y+ +o[c+312>>2])*F+(x+ +o[c+316>>2])*G+(w+ +o[c+320>>2])*H+((v+ +o[c+328>>2])*I+(t+ +o[c+332>>2])*J+(u+ +o[c+336>>2])*K)+((A+ +o[p+312>>2])*L+(n+ +o[p+316>>2])*M+(B+ +o[p+320>>2])*N+((C+ +o[p+328>>2])*O+(D+ +o[p+332>>2])*+o[j+(s*152|0)+36>>2]+(E+ +o[p+336>>2])*+o[j+(s*152|0)+40>>2]))));o[j+(s*152|0)+100>>2]=0.0;q=q+1|0}while((q|0)<(k[R>>2]|0))}m=k[a+176>>2]|0;j=m;m=k[m+(T<<3)>>2]|0}T=T+1|0;if((T|0)>=(g|0))break;else S=m+S|0}}Cc[k[(k[a>>2]|0)+28>>2]&127](a,d,e,h);s=k[a+48>>2]|0;q=k[a+28>>2]|0;Q=k[a+68>>2]|0;b=k[a+128>>2]|0;if((b|0)<(s|0)?(k[a+132>>2]|0)<(s|0):0){if(!s)l=0;else{k[5108]=(k[5108]|0)+1;l=iF((s<<2|3)+16|0)|0;if(!l)l=0;else{k[(l+4+15&-16)+-4>>2]=l;l=l+4+15&-16}b=k[a+128>>2]|0}if((b|0)>0){j=b+-1|0;b=0;while(1){m=l+(b<<2)|0;if(m)k[m>>2]=k[(k[a+136>>2]|0)+(b<<2)>>2];if((b|0)==(j|0))break;else b=b+1|0}}b=k[a+136>>2]|0;if(b){if(i[a+140>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+136>>2]=0}i[a+140>>0]=1;k[a+136>>2]=l;k[a+132>>2]=s}k[a+128>>2]=s;if(!(k[h+64>>2]&16)){b=k[a+108>>2]|0;if((b|0)<(q|0)?(k[a+112>>2]|0)<(q|0):0){if(!q)l=0;else{k[5108]=(k[5108]|0)+1;l=iF((q<<2|3)+16|0)|0;if(!l)l=0;else{k[(l+4+15&-16)+-4>>2]=l;l=l+4+15&-16}b=k[a+108>>2]|0}if((b|0)>0){m=b+-1|0;j=0;while(1){b=l+(j<<2)|0;if(b)k[b>>2]=k[(k[a+116>>2]|0)+(j<<2)>>2];if((j|0)==(m|0))break;else j=j+1|0}}b=k[a+116>>2]|0;if(b){if(i[a+120>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+116>>2]=0}i[a+120>>0]=1;k[a+116>>2]=l;k[a+112>>2]=q}k[a+108>>2]=q}else{b=k[a+108>>2]|0;if((b|0)<(q<<1|0)?(k[a+112>>2]|0)<(q<<1|0):0){if(!q)l=0;else{k[5108]=(k[5108]|0)+1;l=iF((q<<3|3)+16|0)|0;if(!l)l=0;else{k[(l+4+15&-16)+-4>>2]=l;l=l+4+15&-16}b=k[a+108>>2]|0}if((b|0)>0){b=b+-1|0;j=0;while(1){m=l+(j<<2)|0;if(m)k[m>>2]=k[(k[a+116>>2]|0)+(j<<2)>>2];if((j|0)==(b|0))break;else j=j+1|0}}b=k[a+116>>2]|0;if(b){if(i[a+120>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+116>>2]=0}i[a+120>>0]=1;k[a+116>>2]=l;k[a+112>>2]=q<<1}k[a+108>>2]=q<<1}b=k[a+148>>2]|0;if((b|0)<(Q|0)?(k[a+152>>2]|0)<(Q|0):0){if(!Q)l=0;else{k[5108]=(k[5108]|0)+1;l=iF((Q<<2|3)+16|0)|0;if(!l)l=0;else{k[(l+4+15&-16)+-4>>2]=l;l=l+4+15&-16}b=k[a+148>>2]|0}if((b|0)>0){m=b+-1|0;j=0;while(1){b=l+(j<<2)|0;if(b)k[b>>2]=k[(k[a+156>>2]|0)+(j<<2)>>2];if((j|0)==(m|0))break;else j=j+1|0}}b=k[a+156>>2]|0;if(b){if(i[a+160>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+156>>2]=0}i[a+160>>0]=1;k[a+156>>2]=l;k[a+152>>2]=Q}k[a+148>>2]=Q;if((s|0)>0){l=k[a+136>>2]|0;b=0;while(1){k[l+(b<<2)>>2]=b;if((b|0)==(s+-1|0))break;else b=b+1|0}}if((q|0)>0){l=k[a+116>>2]|0;b=0;while(1){k[l+(b<<2)>>2]=b;if((b|0)==(q+-1|0))break;else b=b+1|0}}if((Q|0)>0){b=k[a+156>>2]|0;l=0;while(1){k[b+(l<<2)>>2]=l;if((l|0)==(Q+-1|0))break;else l=l+1|0}}b=k[5104]|0;V=(k[b+16>>2]|0)+-1|0;k[b+16>>2]=V;if(V){r=U;return 0.0}do if(k[b+4>>2]|0){Kb(U+248|0,0)|0;V=k[5090]|0;o[b+8>>2]=+(((k[U+248+4>>2]|0)-(k[V+4>>2]|0)+(((k[U+248>>2]|0)-(k[V>>2]|0)|0)*1e6|0)-(k[b+12>>2]|0)|0)>>>0)/1.0e3+ +o[b+8>>2];if(!(k[b+16>>2]|0)){b=k[5104]|0;break}else{r=U;return 0.0}}while(0);k[5104]=k[b+20>>2];r=U;return 0.0}function Pq(a,b,c,d,e,f,g,h,j,l){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;j=j|0;l=l|0;var m=0,n=0.0,p=0,q=0,r=0,s=0,t=0,u=0,v=0.0;l=k[a+48>>2]|0;r=k[a+28>>2]|0;s=k[a+68>>2]|0;if(k[j+64>>2]&1){if((l|0)>0){p=k[a+136>>2]|0;f=k[a+192>>2]|0;m=0;do{c=p+(m<<2)|0;d=k[c>>2]|0;q=m;m=m+1|0;f=(ia(f,1664525)|0)+1013904223|0;if(m>>>0<65537){e=f>>>16^f;if(m>>>0<257)if(m>>>0<17){e=(e>>>8^e)>>>4^(e>>>8^e);if(m>>>0<5)if(m>>>0<3)e=(e>>>2^e)>>>1^(e>>>2^e);else e=e>>>2^e}else e=e>>>8^e}else e=f;e=p+(((e>>>0)%(m>>>0)|0)<<2)|0;k[c>>2]=k[e>>2];k[e>>2]=d}while((q|0)!=(l+-1|0));k[a+192>>2]=f}if((k[j+20>>2]|0)>(b|0)){if((r|0)>0){p=k[a+116>>2]|0;f=k[a+192>>2]|0;l=0;do{c=p+(l<<2)|0;d=k[c>>2]|0;m=l;l=l+1|0;f=(ia(f,1664525)|0)+1013904223|0;if(l>>>0<65537){e=f>>>16^f;if(l>>>0<257)if(l>>>0<17){e=(e>>>8^e)>>>4^(e>>>8^e);if(l>>>0<5)if(l>>>0<3)e=(e>>>2^e)>>>1^(e>>>2^e);else e=e>>>2^e}else e=e>>>8^e}else e=f;q=p+(((e>>>0)%(l>>>0)|0)<<2)|0;k[c>>2]=k[q>>2];k[q>>2]=d}while((m|0)!=(r+-1|0));k[a+192>>2]=f}if((s|0)>0){c=k[a+156>>2]|0;l=k[a+192>>2]|0;m=0;do{d=c+(m<<2)|0;f=k[d>>2]|0;p=m;m=m+1|0;l=(ia(l,1664525)|0)+1013904223|0;if(m>>>0<65537){e=l>>>16^l;if(m>>>0<257)if(m>>>0<17){e=(e>>>8^e)>>>4^(e>>>8^e);if(m>>>0<5)if(m>>>0<3)e=(e>>>2^e)>>>1^(e>>>2^e);else e=e>>>2^e}else e=e>>>8^e}else e=l;r=c+(((e>>>0)%(m>>>0)|0)<<2)|0;k[d>>2]=k[r>>2];k[r>>2]=f}while((p|0)!=(s+-1|0));k[a+192>>2]=l}}}c=k[a+48>>2]|0;if(!(k[j+64>>2]&256)){if((c|0)>0){m=0;do{d=k[(k[a+136>>2]|0)+(m<<2)>>2]|0;f=k[a+56>>2]|0;if((k[f+(d*152|0)+136>>2]|0)>(b|0)){c=k[a+16>>2]|0;Fq(c+((k[f+(d*152|0)+144>>2]|0)*244|0)|0,c+((k[f+(d*152|0)+148>>2]|0)*244|0)|0,f+(d*152|0)|0);c=k[a+48>>2]|0}m=m+1|0}while((m|0)<(c|0))}if((k[j+20>>2]|0)<=(b|0))return 0.0;if((h|0)>0){f=0;while(1){c=g+(f<<2)|0;d=k[c>>2]|0;if(i[d+20>>0]|0){s=Mq(a,k[d+28>>2]|0,+o[j+12>>2])|0;u=Mq(a,k[(k[c>>2]|0)+32>>2]|0,+o[j+12>>2])|0;t=k[a+16>>2]|0;r=k[c>>2]|0;xc[k[(k[r>>2]|0)+24>>2]&15](r,t+(s*244|0)|0,t+(u*244|0)|0,+o[j+12>>2])}if((f|0)==(h+-1|0))break;else f=f+1|0}}m=k[a+28>>2]|0;if((m|0)>0){f=0;while(1){j=k[(k[a+116>>2]|0)+(f<<2)>>2]|0;h=k[a+36>>2]|0;g=k[a+16>>2]|0;Gq(g+((k[h+(j*152|0)+144>>2]|0)*244|0)|0,g+((k[h+(j*152|0)+148>>2]|0)*244|0)|0,h+(j*152|0)|0);if((f|0)==(m+-1|0))break;else f=f+1|0}}d=k[a+68>>2]|0;if((d|0)>0){c=0;while(1){f=k[(k[a+156>>2]|0)+(c<<2)>>2]|0;m=k[a+76>>2]|0;n=+o[(k[a+36>>2]|0)+((k[m+(f*152|0)+140>>2]|0)*152|0)+100>>2];if(n>0.0){n=n*+o[m+(f*152|0)+104>>2];o[m+(f*152|0)+120>>2]=-n;o[m+(f*152|0)+124>>2]=n;j=k[a+16>>2]|0;Fq(j+((k[m+(f*152|0)+144>>2]|0)*244|0)|0,j+((k[m+(f*152|0)+148>>2]|0)*244|0)|0,m+(f*152|0)|0)}if((c|0)==(d+-1|0))break;else c=c+1|0}}f=k[a+88>>2]|0;if((f|0)<=0)return 0.0;d=0;while(1){m=k[a+96>>2]|0;n=+o[(k[a+36>>2]|0)+((k[m+(d*152|0)+140>>2]|0)*152|0)+100>>2];if(n>0.0){v=+o[m+(d*152|0)+104>>2];n=n*v>v?v:n*v;o[m+(d*152|0)+120>>2]=-n;o[m+(d*152|0)+124>>2]=n;j=k[a+16>>2]|0;Fq(j+((k[m+(d*152|0)+144>>2]|0)*244|0)|0,j+((k[m+(d*152|0)+148>>2]|0)*244|0)|0,m+(d*152|0)|0)}if((d|0)==(f+-1|0))break;else d=d+1|0}return 0.0}if((c|0)>0){e=0;do{d=k[(k[a+136>>2]|0)+(e<<2)>>2]|0;f=k[a+56>>2]|0;if((k[f+(d*152|0)+136>>2]|0)>(b|0)){c=k[a+16>>2]|0;Fq(c+((k[f+(d*152|0)+144>>2]|0)*244|0)|0,c+((k[f+(d*152|0)+148>>2]|0)*244|0)|0,f+(d*152|0)|0);c=k[a+48>>2]|0}e=e+1|0}while((e|0)<(c|0))}if((k[j+20>>2]|0)<=(b|0))return 0.0;if((h|0)>0){f=0;while(1){c=g+(f<<2)|0;d=k[c>>2]|0;if(i[d+20>>0]|0){q=Mq(a,k[d+28>>2]|0,+o[j+12>>2])|0;s=Mq(a,k[(k[c>>2]|0)+32>>2]|0,+o[j+12>>2])|0;r=k[a+16>>2]|0;p=k[c>>2]|0;xc[k[(k[p>>2]|0)+24>>2]&15](p,r+(q*244|0)|0,r+(s*244|0)|0,+o[j+12>>2])}if((f|0)==(h+-1|0))break;else f=f+1|0}}c=k[j+64>>2]|0;e=k[a+28>>2]|0;if(c&512){if((e|0)<=0)return 0.0;l=0;while(1){d=k[(k[a+116>>2]|0)+(l<<2)>>2]|0;f=k[a+36>>2]|0;m=k[a+16>>2]|0;Gq(m+((k[f+(d*152|0)+144>>2]|0)*244|0)|0,m+((k[f+(d*152|0)+148>>2]|0)*244|0)|0,f+(d*152|0)|0);n=+o[f+(d*152|0)+100>>2];d=ia(l,(c>>>4&1)+1|0)|0;f=k[(k[a+156>>2]|0)+(d<<2)>>2]|0;m=k[a+76>>2]|0;if(n>0.0){v=n*+o[m+(f*152|0)+104>>2];o[m+(f*152|0)+120>>2]=-v;o[m+(f*152|0)+124>>2]=v;h=k[a+16>>2]|0;Fq(h+((k[m+(f*152|0)+144>>2]|0)*244|0)|0,h+((k[m+(f*152|0)+148>>2]|0)*244|0)|0,m+(f*152|0)|0)}if((k[j+64>>2]&16|0)!=0?(t=k[(k[a+156>>2]|0)+(d+1<<2)>>2]|0,u=k[a+76>>2]|0,n>0.0):0){v=n*+o[u+(t*152|0)+104>>2];o[u+(t*152|0)+120>>2]=-v;o[u+(t*152|0)+124>>2]=v;h=k[a+16>>2]|0;Fq(h+((k[u+(t*152|0)+144>>2]|0)*244|0)|0,h+((k[u+(t*152|0)+148>>2]|0)*244|0)|0,u+(t*152|0)|0)}if((l|0)==(e+-1|0))break;else l=l+1|0}return 0.0}if((e|0)>0){m=0;while(1){j=k[(k[a+116>>2]|0)+(m<<2)>>2]|0;h=k[a+36>>2]|0;g=k[a+16>>2]|0;Gq(g+((k[h+(j*152|0)+144>>2]|0)*244|0)|0,g+((k[h+(j*152|0)+148>>2]|0)*244|0)|0,h+(j*152|0)|0);if((m|0)==(e+-1|0))break;else m=m+1|0}}d=k[a+68>>2]|0;if((d|0)>0){c=0;while(1){f=k[(k[a+156>>2]|0)+(c<<2)>>2]|0;m=k[a+76>>2]|0;n=+o[(k[a+36>>2]|0)+((k[m+(f*152|0)+140>>2]|0)*152|0)+100>>2];if(n>0.0){v=n*+o[m+(f*152|0)+104>>2];o[m+(f*152|0)+120>>2]=-v;o[m+(f*152|0)+124>>2]=v;j=k[a+16>>2]|0;Fq(j+((k[m+(f*152|0)+144>>2]|0)*244|0)|0,j+((k[m+(f*152|0)+148>>2]|0)*244|0)|0,m+(f*152|0)|0)}if((c|0)==(d+-1|0))break;else c=c+1|0}}f=k[a+88>>2]|0;if((f|0)<=0)return 0.0;d=0;while(1){m=k[a+96>>2]|0;n=+o[(k[a+36>>2]|0)+((k[m+(d*152|0)+140>>2]|0)*152|0)+100>>2];if(n>0.0){v=+o[m+(d*152|0)+104>>2];v=n*v>v?v:n*v;o[m+(d*152|0)+120>>2]=-v;o[m+(d*152|0)+124>>2]=v;j=k[a+16>>2]|0;Fq(j+((k[m+(d*152|0)+144>>2]|0)*244|0)|0,j+((k[m+(d*152|0)+148>>2]|0)*244|0)|0,m+(d*152|0)|0)}if((d|0)==(f+-1|0))break;else d=d+1|0}return 0.0}function Qq(a,b,c,d,e,f,g,h,i){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;if(!(k[h+44>>2]|0))return;i=k[h+20>>2]|0;if(!(k[h+64>>2]&256)){if((i|0)<=0)return;b=0;do{f=k[a+28>>2]|0;if((f|0)>0){i=0;while(1){e=k[(k[a+116>>2]|0)+(i<<2)>>2]|0;g=k[a+36>>2]|0;c=k[a+16>>2]|0;Hq(c+((k[g+(e*152|0)+144>>2]|0)*244|0)|0,c+((k[g+(e*152|0)+148>>2]|0)*244|0)|0,g+(e*152|0)|0);if((i|0)==(f+-1|0))break;else i=i+1|0}i=k[h+20>>2]|0}b=b+1|0}while((b|0)<(i|0));return}else{if((i|0)<=0)return;b=0;do{f=k[a+28>>2]|0;if((f|0)>0){i=0;while(1){e=k[(k[a+116>>2]|0)+(i<<2)>>2]|0;g=k[a+36>>2]|0;c=k[a+16>>2]|0;Hq(c+((k[g+(e*152|0)+144>>2]|0)*244|0)|0,c+((k[g+(e*152|0)+148>>2]|0)*244|0)|0,g+(e*152|0)|0);if((i|0)==(f+-1|0))break;else i=i+1|0}i=k[h+20>>2]|0}b=b+1|0}while((b|0)<(i|0));return}}function Rq(a,b,c,d,e,f,g,h,i){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;var j=0,l=0,m=0;m=r;r=r+16|0;Cw(4064);lc[k[(k[a>>2]|0)+32>>2]&1](a,b,c,d,e,f,g,h,i);l=k[a+184>>2]|0;j=k[h+20>>2]|0;j=(l|0)>(j|0)?l:j;if((j|0)>0){l=0;do{+pc[k[(k[a>>2]|0)+40>>2]&3](a,l,b,c,d,e,f,g,h,i);l=l+1|0}while((l|0)<(j|0))}j=k[5104]|0;a=(k[j+16>>2]|0)+-1|0;k[j+16>>2]=a;if(a){r=m;return 0.0}do if(k[j+4>>2]|0){Kb(m|0,0)|0;a=k[5090]|0;o[j+8>>2]=+(((k[m+4>>2]|0)-(k[a+4>>2]|0)+(((k[m>>2]|0)-(k[a>>2]|0)|0)*1e6|0)-(k[j+12>>2]|0)|0)>>>0)/1.0e3+ +o[j+8>>2];if(!(k[j+16>>2]|0)){j=k[5104]|0;break}else{r=m;return 0.0}}while(0);k[5104]=k[j+20>>2];r=m;return 0.0}function Sq(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0,j=0.0,l=0.0,m=0.0,n=0,p=0,q=0,s=0.0,t=0.0;q=r;r=r+80|0;e=k[a+28>>2]|0;c=k[d+64>>2]|0;if((c&4|0)!=0&(e|0)>0){g=k[a+36>>2]|0;b=k[a+76>>2]|0;if(!(c&16)){c=0;while(1){n=k[g+(c*152|0)+132>>2]|0;o[n+120>>2]=+o[g+(c*152|0)+100>>2];o[n+124>>2]=+o[b+((k[g+(c*152|0)+140>>2]|0)*152|0)+100>>2];if((c|0)==(e+-1|0))break;else c=c+1|0}}else{c=0;while(1){n=k[g+(c*152|0)+132>>2]|0;o[n+120>>2]=+o[g+(c*152|0)+100>>2];h=k[g+(c*152|0)+140>>2]|0;o[n+124>>2]=+o[b+(h*152|0)+100>>2];o[n+128>>2]=+o[b+((h+1|0)*152|0)+100>>2];if((c|0)==(e+-1|0))break;else c=c+1|0}}}e=k[a+48>>2]|0;if((e|0)>0){h=0;while(1){b=k[a+56>>2]|0;f=k[b+(h*152|0)+132>>2]|0;g=k[f+44>>2]|0;c=b+(h*152|0)+100|0;if(g){m=+o[c>>2];n=k[f+28>>2]|0;l=1.0/+o[d+12>>2];j=m*+o[b+(h*152|0)+20>>2]*+o[n+352>>2]*l;s=m*+o[b+(h*152|0)+24>>2]*+o[n+356>>2]*l;o[g>>2]=+o[b+(h*152|0)+16>>2]*m*+o[n+348>>2]*l+ +o[g>>2];o[g+4>>2]=j+ +o[g+4>>2];o[g+8>>2]=s+ +o[g+8>>2];s=+o[c>>2];n=k[f+32>>2]|0;j=1.0/+o[d+12>>2];l=s*+o[b+(h*152|0)+52>>2]*+o[n+352>>2]*j;m=s*+o[b+(h*152|0)+56>>2]*+o[n+356>>2]*j;o[g+32>>2]=+o[b+(h*152|0)+48>>2]*s*+o[n+348>>2]*j+ +o[g+32>>2];o[g+36>>2]=l+ +o[g+36>>2];o[g+40>>2]=m+ +o[g+40>>2];n=k[f+28>>2]|0;m=+o[c>>2];l=1.0/+o[d+12>>2];j=+o[b+(h*152|0)+4>>2]*+o[n+548>>2]*m*l;s=m*(+o[b+(h*152|0)+8>>2]*+o[n+552>>2])*l;o[g+16>>2]=+o[b+(h*152|0)>>2]*+o[n+544>>2]*m*l+ +o[g+16>>2];o[g+20>>2]=j+ +o[g+20>>2];o[g+24>>2]=s+ +o[g+24>>2];n=k[f+32>>2]|0;s=+o[c>>2];j=1.0/+o[d+12>>2];l=+o[b+(h*152|0)+36>>2]*+o[n+548>>2]*s*j;m=s*(+o[b+(h*152|0)+40>>2]*+o[n+552>>2])*j;o[g+48>>2]=+o[b+(h*152|0)+32>>2]*+o[n+544>>2]*s*j+ +o[g+48>>2];o[g+52>>2]=l+ +o[g+52>>2];o[g+56>>2]=m+ +o[g+56>>2]}s=+o[c>>2];o[f+36>>2]=s;s=+X(+s);if(s>=+o[f+16>>2])i[f+20>>0]=0;if((h|0)==(e+-1|0))break;else h=h+1|0}}c=k[a+8>>2]|0;if((c|0)>0){b=k[a+16>>2]|0;n=0;do{f=b+(n*244|0)|0;e=k[b+(n*244|0)+240>>2]|0;if(e){if(!(k[d+44>>2]|0)){h=b+(n*244|0)+176|0;l=+o[b+(n*244|0)+64>>2]+ +o[h>>2];o[h>>2]=l;h=b+(n*244|0)+180|0;j=+o[b+(n*244|0)+68>>2]+ +o[h>>2];o[h>>2]=j;h=b+(n*244|0)+184|0;m=+o[b+(n*244|0)+72>>2]+ +o[h>>2];o[h>>2]=m;h=b+(n*244|0)+192|0;o[h>>2]=+o[b+(n*244|0)+80>>2]+ +o[h>>2];h=b+(n*244|0)+196|0;o[h>>2]=+o[b+(n*244|0)+84>>2]+ +o[h>>2];h=b+(n*244|0)+200|0;o[h>>2]=+o[b+(n*244|0)+88>>2]+ +o[h>>2];h=b}else{j=+o[d+12>>2];l=+o[d+52>>2];g=b+(n*244|0)+176|0;o[g>>2]=+o[b+(n*244|0)+64>>2]+ +o[g>>2];g=b+(n*244|0)+180|0;o[g>>2]=+o[b+(n*244|0)+68>>2]+ +o[g>>2];g=b+(n*244|0)+184|0;o[g>>2]=+o[b+(n*244|0)+72>>2]+ +o[g>>2];g=b+(n*244|0)+192|0;o[g>>2]=+o[b+(n*244|0)+80>>2]+ +o[g>>2];g=b+(n*244|0)+196|0;o[g>>2]=+o[b+(n*244|0)+84>>2]+ +o[g>>2];g=b+(n*244|0)+200|0;o[g>>2]=+o[b+(n*244|0)+88>>2]+ +o[g>>2];g=b+(n*244|0)+144|0;h=b+(n*244|0)+148|0;if(!(((((!(+o[g>>2]!=0.0)?!(+o[h>>2]!=0.0):0)?!(+o[b+(n*244|0)+152>>2]!=0.0):0)?!(+o[b+(n*244|0)+160>>2]!=0.0):0)?!(+o[b+(n*244|0)+164>>2]!=0.0):0)?!(+o[b+(n*244|0)+168>>2]!=0.0):0))p=22;if((p|0)==22){p=0;m=+o[b+(n*244|0)+164>>2]*l;s=+o[b+(n*244|0)+168>>2]*l;o[q>>2]=+o[b+(n*244|0)+160>>2]*l;o[q+4>>2]=m;o[q+8>>2]=s;o[q+12>>2]=0.0;Qw(f,+o[g>>2],+o[h>>2],+o[b+(n*244|0)+152>>2],q,j,q+16|0);k[f>>2]=k[q+16>>2];k[f+4>>2]=k[q+16+4>>2];k[f+8>>2]=k[q+16+8>>2];k[f+12>>2]=k[q+16+12>>2];h=b+(n*244|0)+16|0;k[h>>2]=k[q+16+16>>2];k[h+4>>2]=k[q+16+16+4>>2];k[h+8>>2]=k[q+16+16+8>>2];k[h+12>>2]=k[q+16+16+12>>2];h=b+(n*244|0)+32|0;k[h>>2]=k[q+16+32>>2];k[h+4>>2]=k[q+16+32+4>>2];k[h+8>>2]=k[q+16+32+8>>2];k[h+12>>2]=k[q+16+32+12>>2];b=b+(n*244|0)+48|0;k[b>>2]=k[q+16+48>>2];k[b+4>>2]=k[q+16+48+4>>2];k[b+8>>2]=k[q+16+48+8>>2];k[b+12>>2]=k[q+16+48+12>>2];b=k[a+16>>2]|0}h=b;l=+o[b+(n*244|0)+176>>2];j=+o[b+(n*244|0)+180>>2];m=+o[b+(n*244|0)+184>>2];e=k[b+(n*244|0)+240>>2]|0}t=l+ +o[h+(n*244|0)+208>>2];s=j+ +o[h+(n*244|0)+212>>2];l=m+ +o[h+(n*244|0)+216>>2];g=e+260|0;k[g>>2]=(k[g>>2]|0)+1;o[e+312>>2]=t;o[e+316>>2]=s;o[e+320>>2]=l;o[e+324>>2]=0.0;g=k[a+16>>2]|0;h=k[g+(n*244|0)+240>>2]|0;l=+o[g+(n*244|0)+192>>2]+ +o[g+(n*244|0)+224>>2];m=+o[g+(n*244|0)+196>>2]+ +o[g+(n*244|0)+228>>2];s=+o[g+(n*244|0)+200>>2]+ +o[g+(n*244|0)+232>>2];k[h+260>>2]=(k[h+260>>2]|0)+1;o[h+328>>2]=l;o[h+332>>2]=m;o[h+336>>2]=s;o[h+340>>2]=0.0;if(k[d+44>>2]|0){g=k[a+16>>2]|0;h=k[g+(n*244|0)+240>>2]|0;f=g+(n*244|0)|0;k[h+260>>2]=(k[h+260>>2]|0)+1;k[h+4>>2]=k[f>>2];k[h+4+4>>2]=k[f+4>>2];k[h+4+8>>2]=k[f+8>>2];k[h+4+12>>2]=k[f+12>>2];f=g+(n*244|0)+16|0;k[h+20>>2]=k[f>>2];k[h+20+4>>2]=k[f+4>>2];k[h+20+8>>2]=k[f+8>>2];k[h+20+12>>2]=k[f+12>>2];f=g+(n*244|0)+32|0;k[h+36>>2]=k[f>>2];k[h+36+4>>2]=k[f+4>>2];k[h+36+8>>2]=k[f+8>>2];k[h+36+12>>2]=k[f+12>>2];g=g+(n*244|0)+48|0;k[h+52>>2]=k[g>>2];k[h+52+4>>2]=k[g+4>>2];k[h+52+8>>2]=k[g+8>>2];k[h+52+12>>2]=k[g+12>>2]}b=k[a+16>>2]|0;k[(k[b+(n*244|0)+240>>2]|0)+212>>2]=-1;c=k[a+8>>2]|0}n=n+1|0}while((n|0)<(c|0))}if((k[a+28>>2]|0)<0?(k[a+32>>2]|0)<0:0){b=k[a+36>>2]|0;if(b){if(i[a+40>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+36>>2]=0}i[a+40>>0]=1;k[a+36>>2]=0;k[a+32>>2]=0}k[a+28>>2]=0;if((k[a+48>>2]|0)<0?(k[a+52>>2]|0)<0:0){b=k[a+56>>2]|0;if(b){if(i[a+60>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+56>>2]=0}i[a+60>>0]=1;k[a+56>>2]=0;k[a+52>>2]=0}k[a+48>>2]=0;if((k[a+68>>2]|0)<0?(k[a+72>>2]|0)<0:0){b=k[a+76>>2]|0;if(b){if(i[a+80>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+76>>2]=0}i[a+80>>0]=1;k[a+76>>2]=0;k[a+72>>2]=0}k[a+68>>2]=0;if((k[a+88>>2]|0)<0?(k[a+92>>2]|0)<0:0){b=k[a+96>>2]|0;if(b){if(i[a+100>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+96>>2]=0}i[a+100>>0]=1;k[a+96>>2]=0;k[a+92>>2]=0}k[a+88>>2]=0;if((k[a+8>>2]|0)>=0){k[a+8>>2]=0;r=q;return 0.0}if((k[a+12>>2]|0)>=0){k[a+8>>2]=0;r=q;return 0.0}b=k[a+16>>2]|0;if(b){if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+16>>2]=0}i[a+20>>0]=1;k[a+16>>2]=0;k[a+12>>2]=0;k[a+8>>2]=0;r=q;return 0.0}function Tq(a,b,c,d,e,f,g,h,i,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;var l=0;l=r;r=r+16|0;Cw(4104);+rc[k[(k[a>>2]|0)+44>>2]&3](a,b,c,d,e,f,g,h,i);+rc[k[(k[a>>2]|0)+48>>2]&3](a,b,c,d,e,f,g,h,i);+vc[k[(k[a>>2]|0)+36>>2]&1](a,b,c,h);j=k[5104]|0;a=(k[j+16>>2]|0)+-1|0;k[j+16>>2]=a;if(a){r=l;return 0.0}do if(k[j+4>>2]|0){Kb(l|0,0)|0;a=k[5090]|0;o[j+8>>2]=+(((k[l+4>>2]|0)-(k[a+4>>2]|0)+(((k[l>>2]|0)-(k[a>>2]|0)|0)*1e6|0)-(k[j+12>>2]|0)|0)>>>0)/1.0e3+ +o[j+8>>2];if(!(k[j+16>>2]|0)){j=k[5104]|0;break}else{r=l;return 0.0}}while(0);k[5104]=k[j+20>>2];r=l;return 0.0}function Uq(a){a=a|0;k[a+192>>2]=0;return}function Vq(a){a=a|0;var b=0;k[a>>2]=4840;b=k[a+144>>2]|0;if(b){if(i[a+148>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+144>>2]=0}i[a+148>>0]=1;k[a+144>>2]=0;k[a+136>>2]=0;k[a+140>>2]=0;b=k[a+76>>2]|0;if(b){if(i[a+80>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+76>>2]=0}i[a+80>>0]=1;k[a+76>>2]=0;k[a+68>>2]=0;k[a+72>>2]=0;b=k[a+56>>2]|0;if(b){if(i[a+60>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+56>>2]=0}i[a+60>>0]=1;k[a+56>>2]=0;k[a+48>>2]=0;k[a+52>>2]=0;b=k[a+36>>2]|0;if(b){if(i[a+40>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+36>>2]=0}i[a+40>>0]=1;k[a+36>>2]=0;k[a+28>>2]=0;k[a+32>>2]=0;b=k[a+16>>2]|0;if(!b){i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;a=a+12|0;k[a>>2]=0;return}if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+16>>2]=0;i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;a=a+12|0;k[a>>2]=0;return}function Wq(a){a=a|0;Vq(a);jF(a);return}function Xq(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0.0,g=0.0,h=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0;e=r;r=r+64|0;i[b+84>>0]=0;k[e>>2]=k[a+4>>2];k[e+4>>2]=k[a+4+4>>2];k[e+8>>2]=k[a+4+8>>2];k[e+12>>2]=k[a+4+12>>2];k[e+16>>2]=k[a+20>>2];k[e+16+4>>2]=k[a+20+4>>2];k[e+16+8>>2]=k[a+20+8>>2];k[e+16+12>>2]=k[a+20+12>>2];k[e+32>>2]=k[a+36>>2];k[e+32+4>>2]=k[a+36+4>>2];k[e+32+8>>2]=k[a+36+8>>2];k[e+32+12>>2]=k[a+36+12>>2];k[e+48>>2]=k[a+52>>2];k[e+48+4>>2]=k[a+52+4>>2];k[e+48+8>>2]=k[a+52+8>>2];k[e+48+12>>2]=k[a+52+12>>2];if(c?(d=k[a+480>>2]|0,(d|0)!=0):0)Ub[k[(k[d>>2]|0)+8>>2]&127](d,e);w=+o[b+156>>2];u=+o[e>>2];v=+o[b+160>>2];t=+o[e+4>>2];m=+o[b+164>>2];s=+o[e+8>>2];q=+o[e+16>>2];p=+o[e+20>>2];n=+o[e+24>>2];l=+o[e+32>>2];h=+o[e+36>>2];f=+o[e+40>>2];j=w*q+v*p+m*n+ +o[e+52>>2];g=w*l+v*h+m*f+ +o[e+56>>2];o[b+36>>2]=w*u+v*t+m*s+ +o[e+48>>2];o[b+40>>2]=j;o[b+44>>2]=g;o[b+48>>2]=0.0;g=+o[b+172>>2];j=+o[b+176>>2];m=+o[b+180>>2];o[b+52>>2]=u*g+t*j+s*m;o[b+56>>2]=g*q+j*p+m*n;o[b+60>>2]=g*l+j*h+m*f;o[b+64>>2]=0.0;m=+o[b+188>>2];j=+o[b+192>>2];g=+o[b+196>>2];o[b+68>>2]=u*m+t*j+s*g;o[b+72>>2]=m*q+j*p+g*n;o[b+76>>2]=m*l+j*h+g*f;o[b+80>>2]=0.0;r=e;return}function Yq(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0;Xq(a,b+(c*284|0)|0,d);l=+o[b+(c*284|0)+52>>2];g=+o[b+(c*284|0)+56>>2];q=+o[b+(c*284|0)+60>>2];G=+o[b+(c*284|0)+76>>2];z=+o[b+(c*284|0)+72>>2];y=+o[b+(c*284|0)+68>>2];w=1.0/+Y(+((z*-l-y*-g)*(z*-l-y*-g)+((G*-g-z*-q)*(G*-g-z*-q)+(y*-q-G*-l)*(y*-q-G*-l))));v=(G*-g-z*-q)*w;u=w*(y*-q-G*-l);w=w*(z*-l-y*-g);e=+o[b+(c*284|0)+232>>2]*.5;j=+$(+e)/+Y(+(l*l+g*g+q*q));e=+_(+e);k=2.0/(e*e+(j*-q*(j*-q)+(j*-l*(j*-l)+j*-g*(j*-g))));E=1.0-(j*-g*(j*-g*k)+j*-q*(j*-q*k));D=j*-l*(j*-g*k)-e*(j*-q*k);F=j*-l*(j*-q*k)+e*(j*-g*k);B=j*-l*(j*-g*k)+e*(j*-q*k);A=1.0-(j*-l*(j*-l*k)+j*-q*(j*-q*k));C=j*-g*(j*-q*k)-e*(j*-l*k);i=j*-l*(j*-q*k)-e*(j*-g*k);e=j*-g*(j*-q*k)+e*(j*-l*k);k=1.0-(j*-l*(j*-l*k)+j*-g*(j*-g*k));j=+o[b+(c*284|0)+236>>2]*-.5;x=+$(+j)/+Y(+(G*G+(z*z+y*y)));j=+_(+j);r=2.0/(j*j+(G*x*(G*x)+(y*x*(y*x)+z*x*(z*x))));m=1.0-(z*x*(z*x*r)+G*x*(G*x*r));h=y*x*(z*x*r)-j*(G*x*r);t=y*x*(G*x*r)+j*(z*x*r);n=y*x*(z*x*r)+j*(G*x*r);f=1.0-(y*x*(y*x*r)+G*x*(G*x*r));s=z*x*(G*x*r)-j*(y*x*r);p=y*x*(G*x*r)-j*(z*x*r);j=z*x*(G*x*r)+j*(y*x*r);r=1.0-(y*x*(y*x*r)+z*x*(z*x*r));x=+o[b+(c*284|0)+72>>2];z=+o[b+(c*284|0)+76>>2];o[b+(c*284|0)+92>>2]=z*(E*t+D*s+F*r)+(y*(F*p+(D*n+E*m))+x*(F*j+(E*h+D*f)));o[b+(c*284|0)+96>>2]=w*(E*t+D*s+F*r)+(v*(F*p+(D*n+E*m))+u*(F*j+(E*h+D*f)));o[b+(c*284|0)+100>>2]=(E*t+D*s+F*r)*-q+((F*p+(D*n+E*m))*-l+(F*j+(E*h+D*f))*-g);o[b+(c*284|0)+104>>2]=0.0;o[b+(c*284|0)+108>>2]=z*(B*t+A*s+C*r)+(y*(C*p+(A*n+B*m))+x*(C*j+(B*h+A*f)));o[b+(c*284|0)+112>>2]=w*(B*t+A*s+C*r)+(v*(C*p+(A*n+B*m))+u*(C*j+(B*h+A*f)));o[b+(c*284|0)+116>>2]=(B*t+A*s+C*r)*-q+((C*p+(A*n+B*m))*-l+(C*j+(B*h+A*f))*-g);o[b+(c*284|0)+120>>2]=0.0;o[b+(c*284|0)+124>>2]=z*(i*t+e*s+k*r)+(y*(k*p+(e*n+i*m))+x*(k*j+(i*h+e*f)));o[b+(c*284|0)+128>>2]=w*(i*t+e*s+k*r)+(v*(k*p+(e*n+i*m))+u*(k*j+(i*h+e*f)));o[b+(c*284|0)+132>>2]=(i*t+e*s+k*r)*-q+((k*p+(e*n+i*m))*-l+(k*j+(i*h+e*f))*-g);o[b+(c*284|0)+136>>2]=0.0;g=+o[b+(c*284|0)+32>>2];f=g*+o[b+(c*284|0)+56>>2]+ +o[b+(c*284|0)+40>>2];e=g*+o[b+(c*284|0)+60>>2]+ +o[b+(c*284|0)+44>>2];o[b+(c*284|0)+140>>2]=+o[b+(c*284|0)+52>>2]*g+ +o[b+(c*284|0)+36>>2];o[b+(c*284|0)+144>>2]=f;o[b+(c*284|0)+148>>2]=e;o[b+(c*284|0)+152>>2]=0.0;return}function Zq(a,b){a=a|0;b=+b;var c=0,d=0,e=0.0,f=0,g=0,h=0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0.0,G=0.0;D=r;r=r+96|0;c=k[a+136>>2]|0;if((c|0)>0){d=0;do{Yq(k[a+116>>2]|0,k[a+144>>2]|0,d,0);d=d+1|0;c=k[a+136>>2]|0}while((d|0)<(c|0));C=a+116|0}else C=a+116|0;d=k[C>>2]|0;s=+o[d+312>>2];u=+o[d+316>>2];e=+o[d+320>>2];e=+Y(+(s*s+u*u+e*e))*3.5999999046325684;o[a+112>>2]=e;B=k[a+128>>2]|0;if(+o[d+4+(B<<2)>>2]*+o[d+312>>2]+ +o[d+20+(B<<2)>>2]*+o[d+316>>2]+ +o[d+36+(B<<2)>>2]*+o[d+320>>2]<0.0)o[a+112>>2]=-e;a:do if((c|0)>0){B=0;c=d;do{A=k[a+144>>2]|0;h=A+(B*284|0)|0;Xq(c,h,0);d=A+(B*284|0)+204|0;g=A+(B*284|0)+212|0;p=+o[d>>2]+ +o[g>>2];c=A+(B*284|0)+52|0;v=A+(B*284|0)+56|0;w=A+(B*284|0)+60|0;E=A+(B*284|0)+36|0;x=A+(B*284|0)+16|0;s=p*+o[v>>2]+ +o[A+(B*284|0)+40>>2];u=p*+o[w>>2]+ +o[A+(B*284|0)+44>>2];o[A+(B*284|0)+16>>2]=+o[c>>2]*p+ +o[E>>2];y=A+(B*284|0)+20|0;o[y>>2]=s;z=A+(B*284|0)+24|0;o[z>>2]=u;o[A+(B*284|0)+28>>2]=0.0;o[D+32+32>>2]=-1.0;f=k[a+100>>2]|0;E=_b[k[(k[f>>2]|0)+8>>2]&31](f,E,x,D+32|0)|0;f=A+(B*284|0)+88|0;k[f>>2]=0;do if(E){p=p*+o[D+32+32>>2];k[h>>2]=k[D+32+16>>2];k[h+4>>2]=k[D+32+16+4>>2];k[h+8>>2]=k[D+32+16+8>>2];k[h+12>>2]=k[D+32+16+12>>2];i[A+(B*284|0)+84>>0]=1;if((i[4824]|0)==0?(db(4824)|0)!=0:0){k[D+72>>2]=0;k[D+72+4>>2]=0;k[D+72+8>>2]=0;k[D+72+12>>2]=0;_o(4208,0.0,0,0,D+72|0);ib(4824)}k[1103]=k[1103]|1;o[1138]=0.0;n=+o[1148]*0.0;m=+o[1149]*0.0;o[1143]=+o[1147]*0.0;o[1144]=n;o[1145]=m;o[1146]=0.0;k[1151]=0;k[1152]=0;k[1153]=0;k[1154]=0;m=+o[1140]*0.0;n=+o[1141]*0.0;o[1192]=+o[1139]*0.0;o[1193]=m;o[1194]=n;o[1195]=0.0;k[f>>2]=4208;p=p-+o[g>>2];g=A+(B*284|0)+32|0;o[g>>2]=p;n=+o[d>>2];m=+o[A+(B*284|0)+208>>2]*.009999999776482582;if(p<n-m){o[g>>2]=n-m;p=n-m}if(p>n+m)o[g>>2]=n+m;k[x>>2]=k[D+32>>2];k[x+4>>2]=k[D+32+4>>2];k[x+8>>2]=k[D+32+8>>2];k[x+12>>2]=k[D+32+12>>2];s=+o[h>>2];t=+o[A+(B*284|0)+4>>2];u=+o[A+(B*284|0)+8>>2];q=s*+o[c>>2]+t*+o[v>>2]+u*+o[w>>2];g=k[C>>2]|0;e=+o[x>>2]-+o[g+52>>2];l=+o[y>>2]-+o[g+56>>2];p=+o[z>>2]-+o[g+60>>2];n=+o[g+332>>2];m=+o[g+336>>2];j=+o[g+328>>2];if(!(q>=-.10000000149011612)){o[A+(B*284|0)+272>>2]=-1.0/q*(s*(n*p-l*m+ +o[g+312>>2])+t*(e*m-p*j+ +o[g+316>>2])+u*(l*j-e*n+ +o[g+320>>2]));o[A+(B*284|0)+268>>2]=-1.0/q;break}else{o[A+(B*284|0)+272>>2]=0.0;o[A+(B*284|0)+268>>2]=10.0;break}}else{o[A+(B*284|0)+32>>2]=+o[d>>2];o[A+(B*284|0)+272>>2]=0.0;s=-+o[v>>2];u=-+o[w>>2];o[h>>2]=-+o[c>>2];o[A+(B*284|0)+4>>2]=s;o[A+(B*284|0)+8>>2]=u;o[A+(B*284|0)+12>>2]=0.0;o[A+(B*284|0)+268>>2]=1.0}while(0);B=B+1|0;h=k[a+136>>2]|0;c=k[C>>2]|0}while((B|0)<(h|0));e=1.0/+o[c+344>>2];if((h|0)>0){f=k[a+144>>2]|0;g=0;while(1){if(i[f+(g*284|0)+84>>0]|0){u=+o[f+(g*284|0)+272>>2];u=e*(+o[f+(g*284|0)+216>>2]*(+o[f+(g*284|0)+204>>2]-+o[f+(g*284|0)+32>>2])*+o[f+(g*284|0)+268>>2]-u*+o[(u<0.0?f+(g*284|0)+220|0:f+(g*284|0)+224|0)>>2]);d=f+(g*284|0)+276|0;o[d>>2]=u;if(u<0.0)o[d>>2]=0.0}else o[f+(g*284|0)+276>>2]=0.0;if((g|0)==(h+-1|0))break;else g=g+1|0}d=0;while(1){q=+o[f+(d*284|0)+276>>2];u=+o[f+(d*284|0)+248>>2];q=q>u?u:q;u=q*+o[f+(d*284|0)+4>>2]*b;s=q*+o[f+(d*284|0)+8>>2]*b;o[D+16>>2]=+o[f+(d*284|0)>>2]*q*b;o[D+16+4>>2]=u;o[D+16+8>>2]=s;o[D+16+12>>2]=0.0;s=+o[f+(d*284|0)+20>>2]-+o[c+56>>2];u=+o[f+(d*284|0)+24>>2]-+o[c+60>>2];o[D>>2]=+o[f+(d*284|0)+16>>2]-+o[c+52>>2];o[D+4>>2]=s;o[D+8>>2]=u;o[D+12>>2]=0.0;Nw(c,D+16|0,D);d=d+1|0;if((d|0)>=(k[a+136>>2]|0))break a;f=k[a+144>>2]|0;c=k[C>>2]|0}}}while(0);Rb[k[(k[a>>2]|0)+20>>2]&31](a,b);d=k[a+136>>2]|0;if((d|0)<=0){r=D;return}h=k[a+144>>2]|0;g=k[C>>2]|0;f=0;while(1){e=+o[h+(f*284|0)+36>>2]-+o[g+52>>2];j=+o[h+(f*284|0)+40>>2]-+o[g+56>>2];l=+o[h+(f*284|0)+44>>2]-+o[g+60>>2];m=+o[g+332>>2];n=+o[g+336>>2];p=+o[g+328>>2];if(!(i[h+(f*284|0)+84>>0]|0)){e=+o[h+(f*284|0)+240>>2];C=h+(f*284|0)+236|0;o[C>>2]=e+ +o[C>>2]}else{C=k[a+128>>2]|0;G=+o[g+4+(C<<2)>>2];t=+o[g+20+(C<<2)>>2];s=+o[g+36+(C<<2)>>2];F=+o[h+(f*284|0)>>2];q=+o[h+(f*284|0)+4>>2];u=+o[h+(f*284|0)+8>>2];e=((j*p-e*m+ +o[g+320>>2])*(s-u*(G*F+t*q+s*u))+((m*l-j*n+ +o[g+312>>2])*(G-F*(G*F+t*q+s*u))+(e*n-l*p+ +o[g+316>>2])*(t-q*(G*F+t*q+s*u))))*b/+o[h+(f*284|0)+212>>2];o[h+(f*284|0)+240>>2]=e;C=h+(f*284|0)+236|0;o[C>>2]=e+ +o[C>>2]}o[h+(f*284|0)+240>>2]=e*.9900000095367432;if((f|0)==(d+-1|0))break;else f=f+1|0}r=D;return}function _q(a,b){a=a|0;b=+b;var c=0,d=0,e=0,f=0,g=0.0,h=0,j=0.0,l=0,m=0,n=0.0,p=0,q=0,s=0.0,t=0,u=0.0,v=0.0,w=0.0,x=0.0,y=0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0,Q=0.0;t=r;r=r+384|0;m=k[a+136>>2]|0;if(!m){r=t;return}h=k[a+8>>2]|0;if((h|0)<(m|0)){if((k[a+12>>2]|0)<(m|0)){k[5108]=(k[5108]|0)+1;c=iF((m<<4|3)+16|0)|0;if(!c)d=0;else{k[(c+4+15&-16)+-4>>2]=c;d=c+4+15&-16}f=k[a+8>>2]|0;if((f|0)>0){e=0;while(1){l=d+(e<<4)|0;p=(k[a+16>>2]|0)+(e<<4)|0;k[l>>2]=k[p>>2];k[l+4>>2]=k[p+4>>2];k[l+8>>2]=k[p+8>>2];k[l+12>>2]=k[p+12>>2];if((e|0)==(f+-1|0))break;else e=e+1|0}}e=k[a+16>>2]|0;if(e){if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0)}k[a+16>>2]=0}i[a+20>>0]=1;k[a+16>>2]=d;k[a+12>>2]=m;d=a+16|0}else d=a+16|0;c=h;while(1){l=(k[d>>2]|0)+(c<<4)|0;k[l>>2]=k[t+328>>2];k[l+4>>2]=k[t+328+4>>2];k[l+8>>2]=k[t+328+8>>2];k[l+12>>2]=k[t+328+12>>2];if((c|0)==(m+-1|0))break;else c=c+1|0}}k[a+8>>2]=m;h=k[a+28>>2]|0;if((h|0)<(m|0)){if((k[a+32>>2]|0)<(m|0)){k[5108]=(k[5108]|0)+1;c=iF((m<<4|3)+16|0)|0;if(!c)d=0;else{k[(c+4+15&-16)+-4>>2]=c;d=c+4+15&-16}f=k[a+28>>2]|0;if((f|0)>0){e=0;while(1){l=d+(e<<4)|0;p=(k[a+36>>2]|0)+(e<<4)|0;k[l>>2]=k[p>>2];k[l+4>>2]=k[p+4>>2];k[l+8>>2]=k[p+8>>2];k[l+12>>2]=k[p+12>>2];if((e|0)==(f+-1|0))break;else e=e+1|0}}e=k[a+36>>2]|0;if(e){if(i[a+40>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0)}k[a+36>>2]=0}i[a+40>>0]=1;k[a+36>>2]=d;k[a+32>>2]=m;d=a+36|0}else d=a+36|0;c=h;while(1){l=(k[d>>2]|0)+(c<<4)|0;k[l>>2]=k[t+360>>2];k[l+4>>2]=k[t+360+4>>2];k[l+8>>2]=k[t+360+8>>2];k[l+12>>2]=k[t+360+12>>2];if((c|0)==(m+-1|0))break;else c=c+1|0}}k[a+28>>2]=m;f=k[a+48>>2]|0;if((f|0)<(m|0)){if((k[a+52>>2]|0)<(m|0)){k[5108]=(k[5108]|0)+1;c=iF((m<<2|3)+16|0)|0;if(!c)e=0;else{k[(c+4+15&-16)+-4>>2]=c;e=c+4+15&-16}d=k[a+48>>2]|0;if((d|0)>0){h=0;while(1){c=e+(h<<2)|0;if(c)o[c>>2]=+o[(k[a+56>>2]|0)+(h<<2)>>2];if((h|0)==(d+-1|0))break;else h=h+1|0}}d=k[a+56>>2]|0;if(d){if(i[a+60>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[a+56>>2]=0}i[a+60>>0]=1;k[a+56>>2]=e;k[a+52>>2]=m}else e=k[a+56>>2]|0;while(1){d=e+(f<<2)|0;if(d)o[d>>2]=0.0;if((f|0)==(m+-1|0))break;else f=f+1|0}}k[a+48>>2]=m;f=k[a+68>>2]|0;if((f|0)<(m|0)){if((k[a+72>>2]|0)<(m|0)){k[5108]=(k[5108]|0)+1;c=iF((m<<2|3)+16|0)|0;if(!c)e=0;else{k[(c+4+15&-16)+-4>>2]=c;e=c+4+15&-16}d=k[a+68>>2]|0;if((d|0)>0){h=0;while(1){c=e+(h<<2)|0;if(c)o[c>>2]=+o[(k[a+76>>2]|0)+(h<<2)>>2];if((h|0)==(d+-1|0))break;else h=h+1|0}}d=k[a+76>>2]|0;if(d){if(i[a+80>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[a+76>>2]=0}i[a+80>>0]=1;k[a+76>>2]=e;k[a+72>>2]=m}else e=k[a+76>>2]|0;while(1){d=e+(f<<2)|0;if(d)o[d>>2]=0.0;if((f|0)==(m+-1|0))break;else f=f+1|0}}k[a+68>>2]=m;c=k[a+136>>2]|0;if((c|0)<=0){r=t;return}d=k[a+76>>2]|0;e=k[a+56>>2]|0;f=0;while(1){o[d+(f<<2)>>2]=0.0;o[e+(f<<2)>>2]=0.0;if((f|0)==(c+-1|0))break;else f=f+1|0}p=0;do{l=k[a+144>>2]|0;m=k[l+(p*284|0)+88>>2]|0;if(m){f=l+(p*284|0)+92|0;k[t+168>>2]=k[f>>2];k[t+168+4>>2]=k[f+4>>2];k[t+168+8>>2]=k[f+8>>2];k[t+168+12>>2]=k[f+12>>2];f=l+(p*284|0)+108|0;k[t+168+16>>2]=k[f>>2];k[t+168+16+4>>2]=k[f+4>>2];k[t+168+16+8>>2]=k[f+8>>2];k[t+168+16+12>>2]=k[f+12>>2];f=l+(p*284|0)+124|0;k[t+168+32>>2]=k[f>>2];k[t+168+32+4>>2]=k[f+4>>2];k[t+168+32+8>>2]=k[f+8>>2];k[t+168+32+12>>2]=k[f+12>>2];f=k[a+36>>2]|0;y=k[a+120>>2]|0;g=+o[t+168+16+(y<<2)>>2];z=+o[t+168+32+(y<<2)>>2];o[f+(p<<4)>>2]=+o[t+168+(y<<2)>>2];o[f+(p<<4)+4>>2]=g;o[f+(p<<4)+8>>2]=z;o[f+(p<<4)+12>>2]=0.0;f=k[a+36>>2]|0;y=f+(p<<4)|0;z=+o[y>>2];e=l+(p*284|0)|0;g=+o[e>>2];h=f+(p<<4)+4|0;x=+o[h>>2];d=l+(p*284|0)+4|0;n=+o[d>>2];f=f+(p<<4)+8|0;u=+o[f>>2];c=l+(p*284|0)+8|0;w=+o[c>>2];j=z-g*(z*g+x*n+u*w);v=x-n*(z*g+x*n+u*w);w=u-w*(z*g+x*n+u*w);u=1.0/+Y(+(j*j+v*v+w*w));o[y>>2]=j*u;o[h>>2]=v*u;o[f>>2]=w*u;f=k[a+16>>2]|0;n=+o[d>>2];x=+o[c>>2];g=+o[e>>2];o[f+(p<<4)>>2]=n*(w*u)-x*(v*u);o[f+(p<<4)+4>>2]=x*(j*u)-w*u*g;o[f+(p<<4)+8>>2]=v*u*g-n*(j*u);o[f+(p<<4)+12>>2]=0.0;f=k[a+16>>2]|0;e=f+(p<<4)|0;u=+o[e>>2];c=f+(p<<4)+4|0;j=+o[c>>2];f=f+(p<<4)+8|0;n=+o[f>>2];g=1.0/+Y(+(u*u+j*j+n*n));o[e>>2]=u*g;o[c>>2]=j*g;o[f>>2]=n*g;f=k[a+116>>2]|0;c=k[a+36>>2]|0;e=c+(p<<4)|0;d=(k[a+76>>2]|0)+(p<<2)|0;g=+o[e>>2];h=c+(p<<4)+4|0;n=+o[h>>2];c=c+(p<<4)+8|0;j=+o[c>>2];if(g*g+n*n+j*j>1.100000023841858)o[d>>2]=0.0;else{x=+o[l+(p*284|0)+16>>2];n=x-+o[f+52>>2];j=+o[l+(p*284|0)+20>>2];B=j-+o[f+56>>2];w=+o[l+(p*284|0)+24>>2];D=w-+o[f+60>>2];o[t+344>>2]=n;o[t+344+4>>2]=B;o[t+344+8>>2]=D;o[t+344+12>>2]=0.0;x=x-+o[m+52>>2];j=j-+o[m+56>>2];w=w-+o[m+60>>2];o[t+312>>2]=x;o[t+312+4>>2]=j;o[t+312+8>>2]=w;o[t+312+12>>2]=0.0;g=+o[f+332>>2];E=+o[f+336>>2];A=+o[f+328>>2];z=+o[m+332>>2];C=+o[m+336>>2];v=+o[m+328>>2];u=g*D-E*B+ +o[f+312>>2]-(z*w-C*j+ +o[m+312>>2]);w=+o[f+316>>2]+(E*n-D*A)-(+o[m+316>>2]+(C*x-w*v));x=B*A-g*n+ +o[f+320>>2]-(j*v-z*x+ +o[m+320>>2]);o[t+32>>2]=+o[f+4>>2];o[t+32+4>>2]=+o[f+20>>2];o[t+32+8>>2]=+o[f+36>>2];o[t+32+12>>2]=0.0;o[t+32+16>>2]=+o[f+8>>2];o[t+32+20>>2]=+o[f+24>>2];o[t+32+24>>2]=+o[f+40>>2];o[t+32+28>>2]=0.0;o[t+32+32>>2]=+o[f+12>>2];o[t+32+36>>2]=+o[f+28>>2];o[t+32+40>>2]=+o[f+44>>2];o[t+32+44>>2]=0.0;o[t+264>>2]=+o[m+4>>2];o[t+264+4>>2]=+o[m+20>>2];o[t+264+8>>2]=+o[m+36>>2];o[t+264+12>>2]=0.0;o[t+264+16>>2]=+o[m+8>>2];o[t+264+20>>2]=+o[m+24>>2];o[t+264+24>>2]=+o[m+40>>2];o[t+264+28>>2]=0.0;o[t+264+32>>2]=+o[m+12>>2];o[t+264+36>>2]=+o[m+28>>2];o[t+264+40>>2]=+o[m+44>>2];o[t+264+44>>2]=0.0;Vw(t+80|0,t+32|0,t+264|0,t+344|0,t+312|0,e,f+396|0,+o[f+344>>2],m+396|0,+o[m+344>>2]);o[d>>2]=1.0/+o[t+80+80>>2]*((u*+o[e>>2]+w*+o[h>>2]+x*+o[c>>2])*-.20000000298023224)}c=k[a+136>>2]|0}p=p+1|0}while((p|0)<(c|0));if((c|0)<=0){r=t;return}m=k[a+144>>2]|0;d=0;p=0;while(1){f=k[m+(p*284|0)+88>>2]|0;if(f){g=+o[m+(p*284|0)+252>>2];if(g!=0.0){f=m;j=g*b}else{E=+o[m+(p*284|0)+256>>2];E=E==0.0?0.0:E;y=k[a+116>>2]|0;l=k[a+16>>2]|0;w=+o[m+(p*284|0)+16>>2];z=+o[m+(p*284|0)+20>>2];F=+o[m+(p*284|0)+24>>2];H=+o[l+(p<<4)>>2];v=+o[l+(p<<4)+4>>2];j=+o[l+(p<<4)+8>>2];O=w-+o[y+52>>2];P=z-+o[y+56>>2];M=F-+o[y+60>>2];L=+o[y+264>>2]*(P*j-M*v)+ +o[y+280>>2]*(M*H-O*j)+(O*v-P*H)*+o[y+296>>2];Q=(P*j-M*v)*+o[y+268>>2]+(M*H-O*j)*+o[y+284>>2]+(O*v-P*H)*+o[y+300>>2];N=(P*j-M*v)*+o[y+272>>2]+(M*H-O*j)*+o[y+288>>2]+(O*v-P*H)*+o[y+304>>2];C=w-+o[f+52>>2];A=z-+o[f+56>>2];n=F-+o[f+60>>2];I=(v*C-H*A)*+o[f+296>>2]+(+o[f+264>>2]*(j*A-v*n)+ +o[f+280>>2]*(H*n-j*C));K=(j*A-v*n)*+o[f+268>>2]+(H*n-j*C)*+o[f+284>>2]+(v*C-H*A)*+o[f+300>>2];J=(j*A-v*n)*+o[f+272>>2]+(H*n-j*C)*+o[f+288>>2]+(v*C-H*A)*+o[f+304>>2];w=w-+o[y+52>>2];z=z-+o[y+56>>2];F=F-+o[y+60>>2];x=+o[y+332>>2];G=+o[y+336>>2];u=+o[y+328>>2];D=+o[f+332>>2];g=+o[f+336>>2];B=+o[f+328>>2];j=-(1.0/(+o[y+344>>2]+(j*(P*L-O*Q)+(H*(M*Q-P*N)+v*(O*N-M*L)))+(+o[f+344>>2]+(j*(A*I-C*K)+(H*(n*K-A*J)+v*(C*J-n*I)))))*((F*x-z*G+ +o[y+312>>2]-(n*D-A*g+ +o[f+312>>2]))*H+(+o[y+316>>2]+(w*G-F*u)-(+o[f+316>>2]+(C*g-n*B)))*v+(z*u-w*x+ +o[y+320>>2]-(A*B-C*D+ +o[f+320>>2]))*j));j=E<j?E:j;f=k[a+144>>2]|0;j=j<-E?-E:j}e=k[a+56>>2]|0;y=e+(p<<2)|0;o[y>>2]=0.0;l=f+(p*284|0)+280|0;o[l>>2]=1.0;n=+o[m+(p*284|0)+276>>2]*b*+o[m+(p*284|0)+228>>2];o[y>>2]=j;g=j*.5;j=+o[(k[a+76>>2]|0)+(p<<2)>>2];if(g*g+j*j>n*n){Q=n/+Y(+(g*g+j*j));o[l>>2]=Q*+o[l>>2];m=f;l=e;f=1}else{m=f;l=e;f=d}}else{l=k[a+56>>2]|0;o[l+(p<<2)>>2]=0.0;o[m+(p*284|0)+280>>2]=1.0;f=d}p=p+1|0;h=k[a+136>>2]|0;if((p|0)>=(h|0))break;else d=f}if(f){if((h|0)<=0){r=t;return}f=k[a+76>>2]|0;d=0;while(1){e=f+(d<<2)|0;if(+o[e>>2]!=0.0?(q=m+(d*284|0)+280|0,s=+o[q>>2],s<1.0):0){y=l+(d<<2)|0;o[y>>2]=s*+o[y>>2];o[e>>2]=+o[q>>2]*+o[e>>2]}if((d|0)==(h+-1|0))break;else d=d+1|0}}if((h|0)<=0){r=t;return}h=m;e=l;c=0;while(1){f=k[a+116>>2]|0;m=h+(c*284|0)+16|0;j=+o[m>>2]-+o[f+52>>2];l=h+(c*284|0)+20|0;n=+o[l>>2]-+o[f+56>>2];d=h+(c*284|0)+24|0;b=+o[d>>2]-+o[f+60>>2];o[t>>2]=j;o[t+4>>2]=n;o[t+8>>2]=b;o[t+12>>2]=0.0;g=+o[e+(c<<2)>>2];if(g!=0.0){y=k[a+16>>2]|0;P=g*+o[y+(c<<4)+4>>2];Q=g*+o[y+(c<<4)+8>>2];o[t+232>>2]=g*+o[y+(c<<4)>>2];o[t+232+4>>2]=P;o[t+232+8>>2]=Q;o[t+232+12>>2]=0.0;Nw(f,t+232|0,t)}g=+o[(k[a+76>>2]|0)+(c<<2)>>2];if(g!=0.0){y=k[(k[a+144>>2]|0)+(c*284|0)+88>>2]|0;P=+o[l>>2]-+o[y+56>>2];O=+o[d>>2]-+o[y+60>>2];o[t+16>>2]=+o[m>>2]-+o[y+52>>2];o[t+16+4>>2]=P;o[t+16+8>>2]=O;o[t+16+12>>2]=0.0;m=k[a+36>>2]|0;O=+o[m+(c<<4)>>2]*g;P=g*+o[m+(c<<4)+4>>2];Q=g*+o[m+(c<<4)+8>>2];o[t+248>>2]=O;o[t+248+4>>2]=P;o[t+248+8>>2]=Q;o[t+248+12>>2]=0.0;m=k[a+116>>2]|0;l=k[a+124>>2]|0;I=+o[m+4+(l<<2)>>2];J=+o[m+20+(l<<2)>>2];M=+o[m+36+(l<<2)>>2];N=(I*j+J*n+M*b)*(1.0-+o[h+(c*284|0)+244>>2]);o[t>>2]=j-I*N;o[t+4>>2]=n-J*N;o[t+8>>2]=b-M*N;Nw(m,t+248|0,t);o[t+216>>2]=-O;o[t+216+4>>2]=-P;o[t+216+8>>2]=-Q;o[t+216+12>>2]=0.0;Nw(y,t+216|0,t+16|0)}c=c+1|0;if((c|0)>=(k[a+136>>2]|0))break;h=k[a+144>>2]|0;e=k[a+56>>2]|0}r=t;return}function $q(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0.0,g=0.0,h=0,j=0;d=r;r=r+48|0;if((k[a+136>>2]|0)<=0){r=d;return}c=0;do{j=k[a+144>>2]|0;o[d+32>>2]=(i[j+(c*284|0)+84>>0]|0)==0?1.0:0.0;o[d+32+4>>2]=0.0;o[d+32+8>>2]=1.0;o[d+32+12>>2]=0.0;h=j+(c*284|0)+140|0;k[d+16>>2]=k[h>>2];k[d+16+4>>2]=k[h+4>>2];k[d+16+8>>2]=k[h+8>>2];k[d+16+12>>2]=k[h+12>>2];h=k[a+120>>2]|0;e=k[(k[b>>2]|0)+8>>2]|0;g=+o[j+(c*284|0)+108+(h<<2)>>2]+ +o[d+16+4>>2];f=+o[j+(c*284|0)+124+(h<<2)>>2]+ +o[d+16+8>>2];o[d>>2]=+o[j+(c*284|0)+92+(h<<2)>>2]+ +o[d+16>>2];o[d+4>>2]=g;o[d+8>>2]=f;o[d+12>>2]=0.0;Cc[e&127](b,d+16|0,d,d+32|0);Cc[k[(k[b>>2]|0)+8>>2]&127](b,d+16|0,(k[a+144>>2]|0)+(c*284|0)+16|0,d+32|0);c=c+1|0}while((c|0)<(k[a+136>>2]|0));r=d;return}function ar(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0.0,g=0.0,h=0.0,i=0.0;e=r;r=r+96|0;o[e+4>>2]=1.0;k[e+8>>2]=0;j[e+12>>1]=1;j[e+14>>1]=-1;k[e+16>>2]=0;k[e>>2]=528;k[e+20>>2]=k[b>>2];k[e+20+4>>2]=k[b+4>>2];k[e+20+8>>2]=k[b+8>>2];k[e+20+12>>2]=k[b+12>>2];k[e+36>>2]=k[c>>2];k[e+36+4>>2]=k[c+4>>2];k[e+36+8>>2]=k[c+8>>2];k[e+36+12>>2]=k[c+12>>2];a=k[a+4>>2]|0;Cc[k[(k[a>>2]|0)+32>>2]&127](a,b,c,e);b=k[e+8>>2]|0;if(!b){d=0;r=e;return d|0}if(!(k[b+236>>2]&2)){d=0;r=e;return d|0}if(k[b+204>>2]&4){d=0;r=e;return d|0}k[d>>2]=k[e+68>>2];k[d+4>>2]=k[e+68+4>>2];k[d+8>>2]=k[e+68+8>>2];k[d+12>>2]=k[e+68+12>>2];k[d+16>>2]=k[e+52>>2];k[d+16+4>>2]=k[e+52+4>>2];k[d+16+8>>2]=k[e+52+8>>2];k[d+16+12>>2]=k[e+52+12>>2];i=+o[d+16>>2];h=+o[d+20>>2];g=+o[d+24>>2];f=1.0/+Y(+(i*i+h*h+g*g));o[d+16>>2]=i*f;o[d+20>>2]=h*f;o[d+24>>2]=g*f;o[d+32>>2]=+o[e+4>>2];d=b;r=e;return d|0}function br(a){a=a|0;var b=0;k[a>>2]=5024;b=k[a+140>>2]|0;if(b){if(i[a+144>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+140>>2]=0}i[a+144>>0]=1;k[a+140>>2]=0;k[a+132>>2]=0;k[a+136>>2]=0;return}function cr(a){a=a|0;var b=0;k[a>>2]=5024;b=k[a+140>>2]|0;if(b){if(i[a+144>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+140>>2]=0}i[a+144>>0]=1;k[a+140>>2]=0;k[a+132>>2]=0;k[a+136>>2]=0;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function dr(a,b){a=a|0;b=b|0;var c=0,d=0,e=0.0,f=0,g=0.0,h=0,j=0.0,l=0,m=0,n=0,p=0,q=0,s=0,t=0,u=0,v=0.0,w=0.0;u=r;r=r+96|0;n=k[a+12>>2]|0;Cc[k[(k[n>>2]|0)+8>>2]&127](n,(k[a+8>>2]|0)+4|0,u+80|0,u+64|0);n=k[b+68>>2]|0;Qb[k[(k[n>>2]|0)+16>>2]&31](n,k[(k[a+8>>2]|0)+188>>2]|0,u+80|0,u+64|0,k[b+24>>2]|0);n=k[b+24>>2]|0;Cc[k[(k[n>>2]|0)+32>>2]&127](n,k[(k[a+8>>2]|0)+284>>2]|0,b+28|0,n);n=k[a+8>>2]|0;k[a+92>>2]=k[n+52>>2];k[a+92+4>>2]=k[n+52+4>>2];k[a+92+8>>2]=k[n+52+8>>2];k[a+92+12>>2]=k[n+52+12>>2];n=k[n+284>>2]|0;if((Wb[k[(k[n>>2]|0)+36>>2]&127](n)|0)>0){s=0;e=0.0;b=0;do{c=k[a+132>>2]|0;if((c|0)<0){if((k[a+136>>2]|0)<0){d=k[a+140>>2]|0;if(d){if(i[a+144>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[a+140>>2]=0}i[a+144>>0]=1;k[a+140>>2]=0;k[a+136>>2]=0}while(1){d=(k[a+140>>2]|0)+(c<<2)|0;if(d)k[d>>2]=0;if((c|0)==-1)break;else c=c+1|0}}k[a+132>>2]=0;d=k[(k[a+8>>2]|0)+284>>2]|0;d=(Wb[k[(k[d>>2]|0)+28>>2]&127](d)|0)+12|0;d=k[d>>2]|0;n=k[k[d+(s<<4)>>2]>>2]|0;c=k[k[d+(s<<4)+4>>2]>>2]|0;if(!((n|0)!=0?(k[n+204>>2]&4|0)!=0:0))t=15;do if((t|0)==15){t=0;if((c|0)!=0?(k[c+204>>2]&4|0)!=0:0)break;c=k[d+(s<<4)+8>>2]|0;if(c)Ub[k[(k[c>>2]|0)+16>>2]&127](c,a+128|0);p=k[a+132>>2]|0;if((p|0)>0){m=k[a+140>>2]|0;n=k[a+8>>2]|0;q=0;while(1){l=k[m+(q<<2)>>2]|0;j=(k[l+740>>2]|0)==(n|0)?-1.0:1.0;d=k[l+748>>2]|0;if((d|0)>0){h=0;do{g=+o[l+4+(h*184|0)+80>>2];if(g<0.0){f=l+4+(h*184|0)+64|0;if(g<e){c=l+4+(h*184|0)+68|0;v=j*+o[c>>2];b=l+4+(h*184|0)+72|0;e=j*+o[b>>2];o[a+152>>2]=j*+o[f>>2];o[a+156>>2]=v;o[a+160>>2]=e;o[a+164>>2]=0.0;d=k[l+748>>2]|0;e=g}else{c=l+4+(h*184|0)+68|0;b=l+4+(h*184|0)+72|0}w=g*(j*+o[c>>2])*.20000000298023224;v=g*(j*+o[b>>2])*.20000000298023224;o[a+92>>2]=g*(j*+o[f>>2])*.20000000298023224+ +o[a+92>>2];o[a+96>>2]=w+ +o[a+96>>2];o[a+100>>2]=v+ +o[a+100>>2];b=1}h=h+1|0}while((h|0)<(d|0))}if((q|0)==(p+-1|0))break;else q=q+1|0}}}while(0);s=s+1|0;n=k[(k[a+8>>2]|0)+284>>2]|0}while((s|0)<(Wb[k[(k[n>>2]|0)+36>>2]&127](n)|0))}else b=0;t=k[a+8>>2]|0;k[u>>2]=k[t+4>>2];k[u+4>>2]=k[t+4+4>>2];k[u+8>>2]=k[t+4+8>>2];k[u+12>>2]=k[t+4+12>>2];k[u+16>>2]=k[t+20>>2];k[u+16+4>>2]=k[t+20+4>>2];k[u+16+8>>2]=k[t+20+8>>2];k[u+16+12>>2]=k[t+20+12>>2];k[u+32>>2]=k[t+36>>2];k[u+32+4>>2]=k[t+36+4>>2];k[u+32+8>>2]=k[t+36+8>>2];k[u+32+12>>2]=k[t+36+12>>2];k[u+48>>2]=k[a+92>>2];k[u+48+4>>2]=k[a+92+4>>2];k[u+48+8>>2]=k[a+92+8>>2];k[u+48+12>>2]=k[a+92+12>>2];k[t+260>>2]=(k[t+260>>2]|0)+1;k[t+4>>2]=k[u>>2];k[t+4+4>>2]=k[u+4>>2];k[t+4+8>>2]=k[u+8>>2];k[t+4+12>>2]=k[u+12>>2];k[t+20>>2]=k[u+16>>2];k[t+20+4>>2]=k[u+16+4>>2];k[t+20+8>>2]=k[u+16+8>>2];k[t+20+12>>2]=k[u+16+12>>2];k[t+36>>2]=k[u+32>>2];k[t+36+4>>2]=k[u+32+4>>2];k[t+36+8>>2]=k[u+32+8>>2];k[t+36+12>>2]=k[u+32+12>>2];k[t+52>>2]=k[u+48>>2];k[t+52+4>>2]=k[u+48+4>>2];k[t+52+8>>2]=k[u+48+8>>2];k[t+52+12>>2]=k[u+48+12>>2];r=u;return b|0}function er(a,b,c,d,e){a=a|0;b=b|0;c=+c;d=+d;e=+e;var f=0,g=0.0,h=0.0,l=0.0,m=0.0,n=0.0,p=0,q=0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0;p=r;r=r+240|0;m=+o[a+96>>2]+d;n=+o[a+100>>2]+e;o[a+112>>2]=+o[a+92>>2]+c;o[a+116>>2]=m;o[a+120>>2]=n;o[a+124>>2]=0.0;o[p+168>>2]=1.0;k[p+168+4>>2]=0;k[p+168+4+4>>2]=0;k[p+168+4+8>>2]=0;k[p+168+4+12>>2]=0;o[p+168+20>>2]=1.0;k[p+168+24>>2]=0;k[p+168+24+4>>2]=0;k[p+168+24+8>>2]=0;k[p+168+24+12>>2]=0;o[p+168+40>>2]=1.0;f=p+168+44|0;k[f>>2]=0;k[f+4>>2]=0;k[f+8>>2]=0;k[f+12>>2]=0;k[f+16>>2]=0;o[p+104>>2]=1.0;k[p+104+4>>2]=0;k[p+104+4+4>>2]=0;k[p+104+4+8>>2]=0;k[p+104+4+12>>2]=0;o[p+104+20>>2]=1.0;k[p+104+24>>2]=0;k[p+104+24+4>>2]=0;k[p+104+24+8>>2]=0;k[p+104+24+12>>2]=0;o[p+104+40>>2]=1.0;f=p+104+44|0;k[f>>2]=0;k[f+4>>2]=0;k[f+8>>2]=0;k[f+12>>2]=0;k[f+16>>2]=0;n=1.0;f=10;while(1){if((f|0)<=0){f=14;break};f=f+-1|0;k[p+168+48>>2]=k[a+92>>2];k[p+168+48+4>>2]=k[a+92+4>>2];k[p+168+48+8>>2]=k[a+92+8>>2];k[p+168+48+12>>2]=k[a+92+12>>2];k[p+104+48>>2]=k[a+112>>2];k[p+104+48+4>>2]=k[a+112+4>>2];k[p+104+48+8>>2]=k[a+112+8>>2];k[p+104+48+12>>2]=k[a+112+12>>2];l=+o[a+92>>2]-+o[a+112>>2];m=+o[a+96>>2]-+o[a+116>>2];c=+o[a+100>>2]-+o[a+120>>2];q=k[a+8>>2]|0;o[p+4>>2]=1.0;k[p+76>>2]=0;k[p+12>>2]=0;k[p+12+4>>2]=0;k[p+12+8>>2]=0;k[p+12+12>>2]=0;k[p+12+16>>2]=0;k[p+12+20>>2]=0;k[p+12+24>>2]=0;k[p+12+28>>2]=0;k[p>>2]=5256;k[p+80>>2]=q;o[p+84>>2]=l;o[p+88>>2]=m;o[p+92>>2]=c;o[p+96>>2]=0.0;o[p+100>>2]=0.0;q=k[q+188>>2]|0;j[p+8>>1]=j[q+4>>1]|0;j[p+10>>1]=j[q+6>>1]|0;q=k[a+12>>2]|0;c=+gc[k[(k[q>>2]|0)+48>>2]&15](q);q=k[a+12>>2]|0;Rb[k[(k[q>>2]|0)+44>>2]&31](q,c+ +o[a+56>>2]);if(!(i[a+170>>0]|0))ws(b,k[a+12>>2]|0,p+168|0,p+104|0,p,+o[b+56>>2]);else Cr(k[a+8>>2]|0,k[a+12>>2]|0,p+168|0,p+104|0,p,+o[b+56>>2]);q=k[a+12>>2]|0;Rb[k[(k[q>>2]|0)+44>>2]&31](q,c);m=+o[p+4>>2];n=n-m;if(m<1.0){d=+o[a+112>>2];h=+o[a+92>>2];c=+o[a+116>>2];l=+o[a+96>>2];g=+o[a+120>>2];m=+o[a+100>>2];e=+Y(+((d-h)*(d-h)+(c-l)*(c-l)+(g-m)*(g-m)));if(e>1.1920928955078125e-07){v=+o[p+44>>2];t=+o[p+48>>2];x=+o[p+52>>2];w=((d-h)*(1.0/e)*v+(c-l)*(1.0/e)*t+(g-m)*(1.0/e)*x)*2.0;u=(d-h)*(1.0/e)-v*w;s=(c-l)*(1.0/e)-t*w;w=(g-m)*(1.0/e)-x*w;g=1.0/+Y(+(w*w+(u*u+s*s)));k[a+112>>2]=k[a+92>>2];k[a+112+4>>2]=k[a+92+4>>2];k[a+112+8>>2]=k[a+92+8>>2];k[a+112+12>>2]=k[a+92+12>>2];d=e*(g*u-v*(x*(g*w)+(v*(g*u)+t*(g*s))))+ +o[a+112>>2];o[a+112>>2]=d;c=e*(g*s-t*(x*(g*w)+(v*(g*u)+t*(g*s))))+ +o[a+116>>2];o[a+116>>2]=c;g=e*(g*w-x*(x*(g*w)+(v*(g*u)+t*(g*s))))+ +o[a+120>>2];o[a+120>>2]=g;e=c}else e=c;c=d-h;d=e-l;e=g-m;if(!(c*c+d*d+e*e>1.1920928955078125e-07)){f=12;break}x=1.0/+Y(+(c*c+d*d+e*e));if(c*x*+o[a+76>>2]+d*x*+o[a+80>>2]+e*x*+o[a+84>>2]<=0.0){f=12;break}}else{k[a+92>>2]=k[a+112>>2];k[a+92+4>>2]=k[a+112+4>>2];k[a+92+8>>2]=k[a+112+8>>2];k[a+92+12>>2]=k[a+112+12>>2]}if(!(n>.009999999776482582)){f=14;break}}if((f|0)==12){r=p;return}else if((f|0)==14){r=p;return}}function fr(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0.0,f=0.0,g=0.0,h=0.0;i[a+171>>0]=1;k[a+60>>2]=k[b>>2];k[a+60+4>>2]=k[b+4>>2];k[a+60+8>>2]=k[b+8>>2];k[a+60+12>>2]=k[b+12>>2];c=+o[a+60>>2];d=+o[a+64>>2];g=+o[a+68>>2];e=1.0/+Y(+(c*c+d*d+g*g));if(+Y(+(g*e*(g*e)+(c*e*(c*e)+d*e*(d*e))))<1.1920928955078125e-07){h=0.0;f=0.0;c=0.0;d=0.0}else{h=c*e;f=d*e;c=g*e;d=+o[a+72>>2]}o[a+76>>2]=h;o[a+80>>2]=f;o[a+84>>2]=c;o[a+88>>2]=d;return}function gr(a,b,c){a=a|0;b=b|0;c=+c;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,j=0.0;i[a+171>>0]=0;k[a+60>>2]=k[b>>2];k[a+60+4>>2]=k[b+4>>2];k[a+60+8>>2]=k[b+8>>2];k[a+60+12>>2]=k[b+12>>2];d=+o[a+60>>2];e=+o[a+64>>2];h=+o[a+68>>2];f=1.0/+Y(+(d*d+e*e+h*h));if(+Y(+(h*f*(h*f)+(d*f*(d*f)+e*f*(e*f))))<1.1920928955078125e-07){j=0.0;g=0.0;d=0.0;e=0.0}else{j=d*f;g=e*f;d=h*f;e=+o[a+72>>2]}o[a+76>>2]=j;o[a+80>>2]=g;o[a+84>>2]=d;o[a+88>>2]=e;o[a+172>>2]=+o[a+172>>2]+c;return}function hr(a,b){a=a|0;b=b|0;var c=0,d=0,e=0;o[a+16>>2]=0.0;o[a+20>>2]=0.0;i[a+168>>0]=0;i[a+169>>0]=0;o[a+172>>2]=0.0;k[a+60>>2]=0;k[a+60+4>>2]=0;k[a+60+8>>2]=0;k[a+60+12>>2]=0;a=k[(k[a+8>>2]|0)+284>>2]|0;c=(Wb[k[(k[a>>2]|0)+28>>2]&127](a)|0)+4|0;if((k[c>>2]|0)<=0)return;do{d=k[a>>2]|0;e=k[d+12>>2]|0;d=(Wb[k[d+28>>2]&127](a)|0)+12|0;d=k[k[d>>2]>>2]|0;c=(Wb[k[(k[a>>2]|0)+28>>2]&127](a)|0)+12|0;_b[e&31](a,d,k[(k[c>>2]|0)+4>>2]|0,k[b+24>>2]|0)|0;c=(Wb[k[(k[a>>2]|0)+28>>2]&127](a)|0)+4|0}while((k[c>>2]|0)>0);return}function ir(a,b){a=a|0;b=b|0;var c=0;c=r;r=r+32|0;k[c+16>>2]=0;k[c+16+4>>2]=0;k[c+16+8>>2]=0;k[c+16+12>>2]=0;k[c>>2]=k[b>>2];k[c+4>>2]=k[b+4>>2];k[c+8>>2]=k[b+8>>2];k[c+12>>2]=k[b+12>>2];a=k[a+8>>2]|0;k[a+260>>2]=(k[a+260>>2]|0)+1;o[a+4>>2]=1.0;k[a+8>>2]=k[c+16>>2];k[a+8+4>>2]=k[c+16+4>>2];k[a+8+8>>2]=k[c+16+8>>2];k[a+20>>2]=0;o[a+24>>2]=1.0;k[a+28>>2]=0;k[a+28+4>>2]=0;k[a+28+8>>2]=0;k[a+28+12>>2]=0;o[a+44>>2]=1.0;o[a+48>>2]=0.0;k[a+52>>2]=k[c>>2];k[a+52+4>>2]=k[c+4>>2];k[a+52+8>>2]=k[c+8>>2];k[a+52+12>>2]=k[c+12>>2];r=c;return}function jr(a,b){a=a|0;b=b|0;i[a+148>>0]=0;if((((dr(a,b)|0?(i[a+148>>0]=1,dr(a,b)|0):0)?(i[a+148>>0]=1,dr(a,b)|0):0)?(i[a+148>>0]=1,dr(a,b)|0):0)?(i[a+148>>0]=1,dr(a,b)|0):0)i[a+148>>0]=1;b=(k[a+8>>2]|0)+52|0;k[a+92>>2]=k[b>>2];k[a+92+4>>2]=k[b+4>>2];k[a+92+8>>2]=k[b+8>>2];k[a+92+12>>2]=k[b+12>>2];rF(a+112|0,b|0,16)|0;return}
function Ks(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0,x=0.0,y=0.0,z=0,A=0.0,B=0,C=0.0,D=0.0,E=0.0,F=0.0,G=0,H=0,I=0.0,J=0,K=0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0,Q=0,R=0.0,S=0,T=0,U=0.0,V=0.0,W=0.0,Z=0.0,aa=0.0,ba=0.0,ca=0.0,da=0.0,ea=0.0,fa=0.0,ga=0.0,ha=0.0,ia=0.0,ja=0.0,ka=0.0,la=0.0,ma=0.0,na=0.0,oa=0,pa=0,qa=0;qa=r;r=r+800|0;j=k[a+20>>2]|0;if(!j){j=k[a+4>>2]|0;j=dc[k[(k[j>>2]|0)+12>>2]&63](j,k[b+8>>2]|0,k[c+8>>2]|0)|0;k[a+20>>2]=j;i[a+16>>0]=1}k[e+4>>2]=j;T=k[b+4>>2]|0;G=k[c+4>>2]|0;h=k[T+4>>2]|0;g=k[G+4>>2]|0;if((h|0)==10&(g|0)==10){I=+o[j+752>>2];pa=k[T+52>>2]|0;t=+o[T+28+(pa<<2)>>2];E=+o[T+28+(((pa+2|0)%3|0)<<2)>>2];d=k[G+52>>2]|0;n=+o[G+28+(d<<2)>>2];F=+o[G+28+(((d+2|0)%3|0)<<2)>>2];a=k[b+12>>2]|0;B=k[c+12>>2]|0;C=+o[a+(pa<<2)>>2];D=+o[a+16+(pa<<2)>>2];A=+o[a+32+(pa<<2)>>2];u=+o[B+(d<<2)>>2];v=+o[B+16+(d<<2)>>2];s=+o[B+32+(d<<2)>>2];m=+o[B+48>>2]-+o[a+48>>2];x=+o[B+52>>2]-+o[a+52>>2];y=+o[B+56>>2]-+o[a+56>>2];p=1.0-(C*u+D*v+A*s)*(C*u+D*v+A*s);if(!(p==0.0)){p=(C*m+D*x+A*y-(C*u+D*v+A*s)*(u*m+v*x+s*y))/p;if(!(p<-t)){if(p>t)p=t}else p=-t}else p=0.0;q=(C*u+D*v+A*s)*p-(u*m+v*x+s*y);if(q<-n){p=(C*u+D*v+A*s)*-n+(C*m+D*x+A*y);if(!(p<-t))if(p>t){p=t;n=-n}else n=-n;else{p=-t;n=-n}}else if(q>n){p=n*(C*u+D*v+A*s)+(C*m+D*x+A*y);if(!(p<-t)){if(p>t)p=t}else p=-t}else n=q;u=u*n;t=v*n;s=s*n;m=u+(m-C*p);l=t+(x-D*p);n=s+(y-A*p);q=+Y(+(n*n+(m*m+l*l)));if(!(q-E-F>I)){do if(n*n+(m*m+l*l)<=1.4210854715202004e-14)if(+X(+A)>.7071067690849304){n=1.0/+Y(+(D*D+A*A));o[qa+256>>2]=0.0;o[qa+256+4>>2]=-(A*n);o[qa+256+8>>2]=D*n;m=0.0;p=-(A*n);n=D*n;break}else{p=1.0/+Y(+(C*C+D*D));o[qa+256>>2]=-(D*p);o[qa+256+4>>2]=C*p;o[qa+256+8>>2]=0.0;m=-(D*p);p=C*p;n=0.0;break}else{o[qa+256>>2]=m*-(1.0/q);o[qa+256+4>>2]=l*-(1.0/q);o[qa+256+8>>2]=n*-(1.0/q);o[qa+256+12>>2]=0.0;m=m*-(1.0/q);p=l*-(1.0/q);n=n*-(1.0/q)}while(0);ha=F*p+(t+ +o[B+52>>2]);ia=F*n+(s+ +o[B+56>>2]);o[qa+272>>2]=F*m+(u+ +o[B+48>>2]);o[qa+272+4>>2]=ha;o[qa+272+8>>2]=ia;o[qa+272+12>>2]=0.0}if(q-E-F<I){xc[k[(k[e>>2]|0)+16>>2]&15](e,qa+256|0,qa+272|0,q-E-F);j=k[e+4>>2]|0}if(!(k[j+748>>2]|0)){r=qa;return}h=k[j+740>>2]|0;g=k[(k[e+8>>2]|0)+8>>2]|0;f=k[(k[e+12>>2]|0)+8>>2]|0;if((h|0)==(g|0)){rr(j,h+4|0,f+4|0);r=qa;return}else{rr(j,f+4|0,g+4|0);r=qa;return}}o[qa+128>>2]=999999984306749440.0;j=k[a+8>>2]|0;S=k[a+12>>2]|0;k[qa+528>>2]=19400;o[qa+528+4>>2]=0.0;o[qa+528+8>>2]=1.0;o[qa+528+12>>2]=0.0;o[qa+528+16>>2]=0.0;k[qa+528+20>>2]=S;k[qa+528+24>>2]=j;k[qa+528+28>>2]=T;k[qa+528+32>>2]=G;k[qa+528+36>>2]=h;k[qa+528+40>>2]=g;ha=+gc[k[(k[T>>2]|0)+48>>2]&15](T);o[qa+528+44>>2]=ha;ha=+gc[k[(k[G>>2]|0)+48>>2]&15](G);o[qa+528+48>>2]=ha;i[qa+528+52>>0]=0;k[qa+528+60>>2]=-1;k[qa+528+72>>2]=1;k[qa+528+76>>2]=1;k[qa+528+28>>2]=T;k[qa+528+32>>2]=G;ha=+gc[k[(k[T>>2]|0)+48>>2]&15](T);ia=+gc[k[(k[G>>2]|0)+48>>2]&15](G);ia=ha+ia+ +o[(k[a+20>>2]|0)+752>>2];o[qa+128>>2]=ia*ia;j=k[b+12>>2]|0;k[qa>>2]=k[j>>2];k[qa+4>>2]=k[j+4>>2];k[qa+8>>2]=k[j+8>>2];k[qa+12>>2]=k[j+12>>2];k[qa+16>>2]=k[j+16>>2];k[qa+16+4>>2]=k[j+16+4>>2];k[qa+16+8>>2]=k[j+16+8>>2];k[qa+16+12>>2]=k[j+16+12>>2];k[qa+32>>2]=k[j+32>>2];k[qa+32+4>>2]=k[j+32+4>>2];k[qa+32+8>>2]=k[j+32+8>>2];k[qa+32+12>>2]=k[j+32+12>>2];k[qa+48>>2]=k[j+48>>2];k[qa+48+4>>2]=k[j+48+4>>2];k[qa+48+8>>2]=k[j+48+8>>2];k[qa+48+12>>2]=k[j+48+12>>2];j=k[c+12>>2]|0;k[qa+64>>2]=k[j>>2];k[qa+64+4>>2]=k[j+4>>2];k[qa+64+8>>2]=k[j+8>>2];k[qa+64+12>>2]=k[j+12>>2];k[qa+80>>2]=k[j+16>>2];k[qa+80+4>>2]=k[j+16+4>>2];k[qa+80+8>>2]=k[j+16+8>>2];k[qa+80+12>>2]=k[j+16+12>>2];k[qa+96>>2]=k[j+32>>2];k[qa+96+4>>2]=k[j+32+4>>2];k[qa+96+8>>2]=k[j+32+8>>2];k[qa+96+12>>2]=k[j+32+12>>2];k[qa+112>>2]=k[j+48>>2];k[qa+112+4>>2]=k[j+48+4>>2];k[qa+112+8>>2]=k[j+48+8>>2];k[qa+112+12>>2]=k[j+48+12>>2];j=k[T+4>>2]|0;if((j|0)<7?(f=k[G+4>>2]|0,(f|0)<7):0){k[qa+184>>2]=10832;if(!j){j=f;n=0.0}else{n=+gc[k[(k[T>>2]|0)+48>>2]&15](T);j=k[G+4>>2]|0}if(!j)p=0.0;else p=+gc[k[(k[G>>2]|0)+48>>2]&15](G);k[qa+624>>2]=10560;k[qa+624+4>>2]=e;o[qa+624+24>>2]=n;o[qa+624+28>>2]=p;i[qa+624+36>>0]=0;H=k[T+52>>2]|0;a:do if(H){h=k[G+52>>2]|0;do if(h){na=+o[(k[a+20>>2]|0)+752>>2];if(!(i[d+24>>0]|0)){Zv(qa+528|0,qa,qa+624|0,k[d+20>>2]|0,0);l=+o[qa+624+32>>2];if(l<0.0&(i[qa+624+36>>0]|0)!=0){n=+o[qa+624+8>>2];s=+o[qa+624+16>>2];q=+o[qa+624+20>>2];p=+o[qa+624+12>>2];oa=104}}else{z=k[b+12>>2]|0;g=k[c+12>>2]|0;k[4824]=(k[4824]|0)+1;ea=+o[H+64>>2];fa=+o[H+68>>2];v=+o[z+4>>2];ga=+o[H+72>>2];u=+o[z+8>>2];t=+o[z+16>>2];x=+o[z+20>>2];s=+o[z+24>>2];A=+o[z+32>>2];q=+o[z+36>>2];C=+o[z+40>>2];ha=+o[h+64>>2];ia=+o[h+68>>2];ma=+o[h+72>>2];ka=ea*+o[z>>2]+fa*v+ga*u+ +o[z+48>>2]-(ha*+o[g>>2]+ia*+o[g+4>>2]+ma*+o[g+8>>2]+ +o[g+48>>2]);la=ea*t+fa*x+ga*s+ +o[z+52>>2]-(ha*+o[g+16>>2]+ia*+o[g+20>>2]+ma*+o[g+24>>2]+ +o[g+52>>2]);ma=ea*A+fa*q+ga*C+ +o[z+56>>2]-(ha*+o[g+32>>2]+ia*+o[g+36>>2]+ma*+o[g+40>>2]+ +o[g+56>>2]);K=k[H+28>>2]|0;b:do if((K|0)>0){D=0.0;E=s;I=q;F=3402823466385288598117041.0e14;J=0;m=0.0;y=0.0;q=0.0;l=0.0;while(1){d=k[H+36>>2]|0;ha=+o[d+(J*36|0)+20>>2];ia=+o[d+(J*36|0)+24>>2];s=+o[d+(J*36|0)+28>>2];n=ha*+o[z>>2]+ia*v+s*u;p=ha*t+ia*x+s*E;s=ha*A+ia*I+s*C;o[qa+664>>2]=n;o[qa+664+4>>2]=p;o[qa+664+8>>2]=s;o[qa+664+12>>2]=0.0;if(ka*n+la*p+ma*s<0.0){o[qa+664>>2]=-n;o[qa+664+4>>2]=-p;o[qa+664+8>>2]=-s;n=-n;p=-p;s=-s}k[4820]=(k[4820]|0)+1;do if(Vv(z,g,ka,la,ma,n,p,s,H,h,F)|0){k[4822]=(k[4822]|0)+1;rw(H,z,qa+664|0,qa+712|0,qa+288|0,qa+680|0,qa+152|0);rw(h,g,qa+664|0,qa+248|0,qa+208|0,qa+168|0,qa+608|0);A=+o[qa+288>>2];x=+o[qa+248>>2];do if(A<x){B=0;x=D}else{v=+o[qa+208>>2];u=+o[qa+712>>2];if(v<u){B=0;x=D;break}B=1;x=A-x<v-u?A-x:v-u}while(0);if(!B){w=0;n=m;s=y;p=l;break b}if(!(x<F)){D=x;n=m;s=y;p=l;break}D=x;F=x;q=0.0}else{n=m;s=y;p=l}while(0);B=J+1|0;if((B|0)>=(K|0)){v=F;oa=51;break b}v=+o[z+4>>2];u=+o[z+8>>2];t=+o[z+16>>2];x=+o[z+20>>2];E=+o[z+24>>2];A=+o[z+32>>2];I=+o[z+36>>2];C=+o[z+40>>2];J=B;m=n;y=s;l=p}}else{v=3402823466385288598117041.0e14;n=0.0;s=0.0;q=0.0;p=0.0;oa=51}while(0);c:do if((oa|0)==51){K=k[h+28>>2]|0;if((K|0)>0){x=0.0;J=0;I=n;F=s;E=p;while(1){d=k[h+36>>2]|0;ha=+o[d+(J*36|0)+20>>2];ia=+o[d+(J*36|0)+24>>2];s=+o[d+(J*36|0)+28>>2];n=ha*+o[g>>2]+ia*+o[g+4>>2]+s*+o[g+8>>2];p=ha*+o[g+16>>2]+ia*+o[g+20>>2]+s*+o[g+24>>2];s=ha*+o[g+32>>2]+ia*+o[g+36>>2]+s*+o[g+40>>2];o[qa+696>>2]=n;o[qa+696+4>>2]=p;o[qa+696+8>>2]=s;o[qa+696+12>>2]=0.0;if(ka*n+la*p+ma*s<0.0){o[qa+696>>2]=-n;o[qa+696+4>>2]=-p;o[qa+696+8>>2]=-s;n=-n;p=-p;s=-s}k[4820]=(k[4820]|0)+1;do if(Vv(z,g,ka,la,ma,n,p,s,H,h,v)|0){k[4822]=(k[4822]|0)+1;rw(H,z,qa+696|0,qa+712|0,qa+288|0,qa+680|0,qa+152|0);rw(h,g,qa+696|0,qa+248|0,qa+208|0,qa+168|0,qa+608|0);A=+o[qa+288>>2];u=+o[qa+248>>2];do if(A<u)B=0;else{t=+o[qa+208>>2];m=+o[qa+712>>2];if(t<m){B=0;break}B=1;x=A-u<t-m?A-u:t-m}while(0);if(!B){w=0;n=I;s=F;p=E;break c}if(!(x<v)){C=x;n=I;s=F;p=E;break}C=x;v=x;q=0.0}else{C=x;n=I;s=F;p=E}while(0);J=J+1|0;if((J|0)>=(K|0))break;else{x=C;I=n;F=s;E=p}}}j=k[H+48>>2]|0;if((j|0)>0){D=0.0;y=0.0;L=0.0;M=0.0;C=0.0;A=0.0;x=0.0;I=0.0;F=0.0;E=0.0;W=0.0;V=0.0;U=0.0;m=0.0;l=0.0;N=0.0;O=0.0;P=0.0;R=0.0;S=k[h+48>>2]|0;K=0;J=-1;B=-1;do{d=k[H+56>>2]|0;fa=+o[d+(K<<4)>>2];ga=+o[d+(K<<4)+4>>2];ja=+o[d+(K<<4)+8>>2];ha=fa*+o[z>>2]+ga*+o[z+4>>2]+ja*+o[z+8>>2];ia=fa*+o[z+16>>2]+ga*+o[z+20>>2]+ja*+o[z+24>>2];ja=fa*+o[z+32>>2]+ga*+o[z+36>>2]+ja*+o[z+40>>2];if((S|0)>0){ga=D;ba=C;aa=A;Z=x;ca=m;da=l;ea=N;d=0;fa=s;while(1){S=k[h+56>>2]|0;C=+o[S+(d<<4)>>2];D=+o[S+(d<<4)+4>>2];N=+o[S+(d<<4)+8>>2];m=C*+o[g>>2]+D*+o[g+4>>2]+N*+o[g+8>>2];l=C*+o[g+16>>2]+D*+o[g+20>>2]+N*+o[g+24>>2];N=C*+o[g+32>>2]+D*+o[g+36>>2]+N*+o[g+40>>2];o[qa+776>>2]=ia*N-ja*l;o[qa+776+4>>2]=ja*m-ha*N;o[qa+776+8>>2]=ha*l-ia*m;o[qa+776+12>>2]=0.0;do if(!(+X(+(ia*N-ja*l))>1.0e-06)){if(+X(+(ja*m-ha*N))>1.0e-06){oa=69;break}if(!(+X(+(ha*l-ia*m))>1.0e-06)){N=ea;l=da;m=ca;ca=U;da=V;ea=W;u=Z;A=aa;t=ba;ba=ga;s=fa}else oa=69}else oa=69;while(0);do if((oa|0)==69){oa=0;s=1.0/+Y(+((ia*N-ja*l)*(ia*N-ja*l)+(ja*m-ha*N)*(ja*m-ha*N)+(ha*l-ia*m)*(ha*l-ia*m)));D=(ia*N-ja*l)*s;o[qa+776>>2]=D;C=(ja*m-ha*N)*s;o[qa+776+4>>2]=C;s=(ha*l-ia*m)*s;o[qa+776+8>>2]=s;if(ka*D+la*C+ma*s<0.0){o[qa+776>>2]=-D;o[qa+776+4>>2]=-C;o[qa+776+8>>2]=-s;D=-D;C=-C;s=-s}k[4820]=(k[4820]|0)+1;if(!(Vv(z,g,ka,la,ma,D,C,s,H,h,v)|0)){N=ea;l=da;m=ca;ca=U;da=V;ea=W;u=Z;A=aa;t=ba;ba=ga;s=fa;break}k[4822]=(k[4822]|0)+1;rw(H,z,qa+776|0,qa+712|0,qa+288|0,qa+680|0,qa+152|0);rw(h,g,qa+776|0,qa+248|0,qa+208|0,qa+168|0,qa+608|0);A=+o[qa+288>>2];x=+o[qa+248>>2];do if(!(A<x)){u=+o[qa+208>>2];t=+o[qa+712>>2];if(u<t){Q=0;x=ga;break}if(A-x<u-t){Q=1;U=+o[qa+152+8>>2];V=+o[qa+152+4>>2];W=+o[qa+152>>2];Z=+o[qa+168+8>>2];aa=+o[qa+168+4>>2];ba=+o[qa+168>>2];x=A-x;break}else{Q=1;U=+o[qa+680+8>>2];V=+o[qa+680+4>>2];W=+o[qa+680>>2];Z=+o[qa+608+8>>2];aa=+o[qa+608+4>>2];ba=+o[qa+608>>2];x=u-t;break}}else{Q=0;x=ga}while(0);if(!Q){w=0;s=fa;break c}if(!(x<v)){N=ea;l=da;m=ca;ca=U;da=V;ea=W;u=Z;A=aa;t=ba;ba=x;s=fa;break}R=ja;P=ia;O=ha;ca=U;da=V;ea=W;E=U;F=V;I=W;u=Z;A=aa;t=ba;M=Z;L=aa;y=ba;ba=x;v=x;J=K;B=d;n=D;q=0.0;p=C}while(0);d=d+1|0;S=k[h+48>>2]|0;if((d|0)>=(S|0))break;else{ga=ba;ba=t;aa=A;Z=u;W=ea;V=da;U=ca;ca=m;da=l;ea=N;fa=s}}U=ca;V=da;W=ea;x=u;C=t;D=ba;j=k[H+48>>2]|0}K=K+1|0}while((K|0)<(j|0))}else{R=0.0;P=0.0;O=0.0;N=0.0;l=0.0;m=0.0;E=0.0;F=0.0;I=0.0;M=0.0;L=0.0;y=0.0;J=-1;B=-1}do if((B|J|0)>-1){I=y-I;u=L-F;t=M-E;x=O*m+P*l+R*N;v=O*I+P*u+R*t;A=m*I+l*u+N*t;do if(1.0-x*x==0.0)D=0.0;else{if((v-x*A)/(1.0-x*x)<-1000000015047466219876688.0e6){D=-1000000015047466219876688.0e6;break}if(!((v-x*A)/(1.0-x*x)>1000000015047466219876688.0e6)){D=(v-x*A)/(1.0-x*x);break}D=1000000015047466219876688.0e6}while(0);C=x*D-A;do if(C<-1000000015047466219876688.0e6){if(x*-1000000015047466219876688.0e6+v<-1000000015047466219876688.0e6){D=-1000000015047466219876688.0e6;C=-1000000015047466219876688.0e6;break}if(!(x*-1000000015047466219876688.0e6+v>1000000015047466219876688.0e6)){D=x*-1000000015047466219876688.0e6+v;C=-1000000015047466219876688.0e6;break}D=1000000015047466219876688.0e6;C=-1000000015047466219876688.0e6}else{if(!(C>1000000015047466219876688.0e6))break;if(x*1000000015047466219876688.0e6+v<-1000000015047466219876688.0e6){D=-1000000015047466219876688.0e6;C=1000000015047466219876688.0e6;break}if(!(x*1000000015047466219876688.0e6+v>1000000015047466219876688.0e6)){D=x*1000000015047466219876688.0e6+v;C=1000000015047466219876688.0e6;break}D=1000000015047466219876688.0e6;C=1000000015047466219876688.0e6}while(0);F=m*C;E=C*l;C=C*N;A=I-O*D+F;x=u-D*P+E;v=t-D*R+C;o[qa+216>>2]=A;o[qa+216+4>>2]=x;o[qa+216+8>>2]=v;o[qa+216+12>>2]=0.0;if(!(A*A+x*x+v*v>1.1920928955078125e-07))break;u=+Y(+(A*A+x*x+v*v));o[qa+216>>2]=A*(1.0/u);o[qa+216+4>>2]=1.0/u*x;o[qa+216+8>>2]=1.0/u*v;if(A*(1.0/u)*ka+1.0/u*x*la+1.0/u*v*ma<0.0){o[qa+216>>2]=-(A*(1.0/u));o[qa+216+4>>2]=-(1.0/u*x);o[qa+216+8>>2]=-(1.0/u*v)}o[qa+232>>2]=y+F;o[qa+232+4>>2]=L+E;o[qa+232+8>>2]=M+C;o[qa+232+12>>2]=0.0;xc[k[(k[e>>2]|0)+16>>2]&15](e,qa+216|0,qa+232|0,-u)}while(0);if(ka*n+la*p+ma*s<0.0){w=1;n=-n;s=-s;q=0.0;p=-p}else w=1}while(0);if(w){l=-1000000015047466219876688.0e6;oa=104}}if((oa|0)==104){d=k[T+52>>2]|0;S=k[G+52>>2]|0;T=k[b+12>>2]|0;Q=k[c+12>>2]|0;I=l-na;D=1.0/+Y(+(n*n+p*p+s*s));F=n*D;E=p*D;D=s*D;o[qa+712>>2]=F;o[qa+712+4>>2]=E;o[qa+712+8>>2]=D;o[qa+712+12>>2]=q;h=k[S+28>>2]|0;j=k[S+36>>2]|0;if((h|0)>0){A=+o[Q>>2];x=+o[Q+4>>2];v=+o[Q+8>>2];u=+o[Q+16>>2];t=+o[Q+20>>2];s=+o[Q+24>>2];q=+o[Q+32>>2];p=+o[Q+36>>2];n=+o[Q+40>>2];z=-1;C=-3402823466385288598117041.0e14;B=0;while(1){m=+o[j+(B*36|0)+20>>2];y=+o[j+(B*36|0)+24>>2];l=+o[j+(B*36|0)+28>>2];w=(m*A+y*x+l*v)*F+(m*u+y*t+l*s)*E+(m*q+y*p+l*n)*D>C;z=w?B:z;if((B|0)==(h+-1|0)){J=z;break}else{C=w?(m*A+y*x+l*v)*F+(m*u+y*t+l*s)*E+(m*q+y*p+l*n)*D:C;B=B+1|0}}}else J=-1;i[qa+288+16>>0]=1;K=qa+288+12|0;k[K>>2]=0;k[qa+288+4>>2]=0;k[qa+288+8>>2]=0;H=k[j+(J*36|0)+4>>2]|0;d:do if((H|0)>0){G=j+(J*36|0)+12|0;h=0;j=0;f=0;B=0;g=0;while(1){c=k[(k[G>>2]|0)+(g<<2)>>2]|0;z=k[S+16>>2]|0;ha=+o[z+(c<<4)>>2];ia=+o[z+(c<<4)+4>>2];D=+o[z+(c<<4)+8>>2];F=ha*+o[Q>>2]+ia*+o[Q+4>>2]+D*+o[Q+8>>2]+ +o[Q+48>>2];E=ha*+o[Q+16>>2]+ia*+o[Q+20>>2]+D*+o[Q+24>>2]+ +o[Q+52>>2];D=ha*+o[Q+32>>2]+ia*+o[Q+36>>2]+D*+o[Q+40>>2]+ +o[Q+56>>2];if((h|0)==(B|0)){z=(B|0)==0?1:B<<1;if((B|0)<(z|0)){do if(!z)w=0;else{k[5108]=(k[5108]|0)+1;j=iF((z<<4|3)+16|0)|0;if(!j){w=0;break}k[(j+4+15&-16)+-4>>2]=j;w=j+4+15&-16}while(0);if((B|0)>0){h=B+-1|0;j=k[K>>2]|0;f=0;while(1){c=w+(f<<4)|0;oa=j+(f<<4)|0;k[c>>2]=k[oa>>2];k[c+4>>2]=k[oa+4>>2];k[c+8>>2]=k[oa+8>>2];k[c+12>>2]=k[oa+12>>2];if((f|0)==(h|0))break;else f=f+1|0}if(!(i[qa+288+16>>0]|0)){h=B;oa=120}else oa=119}else{j=k[K>>2]|0;if(!j)h=B;else oa=119}if((oa|0)==119){k[5110]=(k[5110]|0)+1;jF(k[j+-4>>2]|0);h=k[qa+288+4>>2]|0;oa=120}if((oa|0)==120){oa=0;k[K>>2]=0}i[qa+288+16>>0]=1;k[K>>2]=w;k[qa+288+8>>2]=z;j=w;f=w}else h=B}o[f+(h<<4)>>2]=F;o[f+(h<<4)+4>>2]=E;o[f+(h<<4)+8>>2]=D;o[f+(h<<4)+12>>2]=0.0;h=(k[qa+288+4>>2]|0)+1|0;k[qa+288+4>>2]=h;g=g+1|0;if((g|0)>=(H|0))break d;B=k[qa+288+8>>2]|0}}else j=0;while(0);if((J|0)>-1){Wv(qa+712|0,d,T,qa+288|0,I,na,e);j=k[K>>2]|0}if(j){if(i[qa+288+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[j+-4>>2]|0)}k[K>>2]=0}}if((i[a+16>>0]|0)!=0?(pa=k[e+4>>2]|0,(k[pa+748>>2]|0)!=0):0){j=k[pa+740>>2]|0;h=k[(k[e+8>>2]|0)+8>>2]|0;f=k[(k[e+12>>2]|0)+8>>2]|0;if((j|0)==(h|0)){rr(pa,j+4|0,f+4|0);break}else{rr(pa,f+4|0,h+4|0);break}}}else{if((k[G+4>>2]|0)!=1)break a;J=qa+132+16|0;i[J>>0]=1;B=qa+132+12|0;k[B>>2]=0;K=qa+132+4|0;k[K>>2]=0;z=qa+132+8|0;k[z>>2]=0;j=k[c+12>>2]|0;ha=+o[G+56>>2];ia=+o[G+56+4>>2];m=+o[G+56+8>>2];p=ha*+o[j>>2]+ia*+o[j+4>>2]+m*+o[j+8>>2]+ +o[j+48>>2];n=ha*+o[j+16>>2]+ia*+o[j+20>>2]+m*+o[j+24>>2]+ +o[j+52>>2];m=ha*+o[j+32>>2]+ia*+o[j+36>>2]+m*+o[j+40>>2]+ +o[j+56>>2];k[5108]=(k[5108]|0)+1;j=iF(35)|0;if(!j)g=0;else{k[(j+4+15&-16)+-4>>2]=j;g=j+4+15&-16}j=k[K>>2]|0;if((j|0)>0){h=0;while(1){pa=g+(h<<4)|0;S=(k[B>>2]|0)+(h<<4)|0;k[pa>>2]=k[S>>2];k[pa+4>>2]=k[S+4>>2];k[pa+8>>2]=k[S+8>>2];k[pa+12>>2]=k[S+12>>2];if((h|0)==(j+-1|0))break;else h=h+1|0}}j=k[B>>2]|0;if(j){if(i[J>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[j+-4>>2]|0)}k[B>>2]=0}i[J>>0]=1;k[B>>2]=g;k[z>>2]=1;f=k[K>>2]|0;o[g+(f<<4)>>2]=p;o[g+(f<<4)+4>>2]=n;o[g+(f<<4)+8>>2]=m;o[g+(f<<4)+12>>2]=0.0;f=k[K>>2]|0;k[K>>2]=f+1;j=k[c+12>>2]|0;ha=+o[G+56+16>>2];ia=+o[G+56+20>>2];p=+o[G+56+24>>2];s=ha*+o[j>>2]+ia*+o[j+4>>2]+p*+o[j+8>>2]+ +o[j+48>>2];q=ha*+o[j+16>>2]+ia*+o[j+20>>2]+p*+o[j+24>>2]+ +o[j+52>>2];p=ha*+o[j+32>>2]+ia*+o[j+36>>2]+p*+o[j+40>>2]+ +o[j+56>>2];j=k[z>>2]|0;if((f+1|0)==(j|0)){j=(f+1|0)==0?1:f+1<<1;if((f+1|0)<(j|0)){do if(!j)g=0;else{k[5108]=(k[5108]|0)+1;h=iF((j<<4|3)+16|0)|0;if(!h){g=0;break}k[(h+4+15&-16)+-4>>2]=h;g=h+4+15&-16}while(0);if((f|0)>-1){h=0;while(1){pa=g+(h<<4)|0;S=(k[B>>2]|0)+(h<<4)|0;k[pa>>2]=k[S>>2];k[pa+4>>2]=k[S+4>>2];k[pa+8>>2]=k[S+8>>2];k[pa+12>>2]=k[S+12>>2];if((h|0)==(f|0))break;else h=h+1|0}}h=k[B>>2]|0;if(h){if(i[J>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[h+-4>>2]|0)}k[B>>2]=0}i[J>>0]=1;k[B>>2]=g;k[z>>2]=j;g=k[K>>2]|0}else{g=f+1|0;j=f+1|0}}else g=f+1|0;h=k[B>>2]|0;o[h+(g<<4)>>2]=s;o[h+(g<<4)+4>>2]=q;o[h+(g<<4)+8>>2]=p;o[h+(g<<4)+12>>2]=0.0;g=g+1|0;k[K>>2]=g;c=k[c+12>>2]|0;ha=+o[G+56+32>>2];ia=+o[G+56+36>>2];p=+o[G+56+40>>2];s=ha*+o[c>>2]+ia*+o[c+4>>2]+p*+o[c+8>>2]+ +o[c+48>>2];q=ha*+o[c+16>>2]+ia*+o[c+20>>2]+p*+o[c+24>>2]+ +o[c+52>>2];p=ha*+o[c+32>>2]+ia*+o[c+36>>2]+p*+o[c+40>>2]+ +o[c+56>>2];if((g|0)==(j|0)){f=(j|0)==0?1:j<<1;if((j|0)<(f|0)){do if(!f)h=0;else{k[5108]=(k[5108]|0)+1;h=iF((f<<4|3)+16|0)|0;if(!h){h=0;break}k[(h+4+15&-16)+-4>>2]=h;h=h+4+15&-16}while(0);if((j|0)>0){j=j+-1|0;g=0;while(1){c=h+(g<<4)|0;pa=(k[B>>2]|0)+(g<<4)|0;k[c>>2]=k[pa>>2];k[c+4>>2]=k[pa+4>>2];k[c+8>>2]=k[pa+8>>2];k[c+12>>2]=k[pa+12>>2];if((g|0)==(j|0))break;else g=g+1|0}}j=k[B>>2]|0;if(j){if(i[J>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[j+-4>>2]|0)}k[B>>2]=0}i[J>>0]=1;k[B>>2]=h;k[z>>2]=f;j=k[K>>2]|0}}else j=g;o[h+(j<<4)>>2]=s;o[h+(j<<4)+4>>2]=q;o[h+(j<<4)+8>>2]=p;o[h+(j<<4)+12>>2]=0.0;k[K>>2]=(k[K>>2]|0)+1;p=+o[(k[a+20>>2]|0)+752>>2];Zv(qa+528|0,qa,qa+184|0,k[d+20>>2]|0,0);l=+o[qa+528+4>>2];m=+o[qa+528+8>>2];n=+o[qa+528+12>>2];if(l*l+m*m+n*n>1.1920928955078125e-07){ha=1.0/(l*l+m*m+n*n);o[qa+192>>2]=l*ha;o[qa+192+4>>2]=m*ha;o[qa+192+8>>2]=n*ha;o[qa+192+12>>2]=0.0;ha=+o[qa+528+56>>2];ia=+gc[k[(k[T>>2]|0)+48>>2]&15](T);ia=ha-ia-+gc[k[(k[G>>2]|0)+48>>2]&15](G);Wv(qa+192|0,k[T+52>>2]|0,k[b+12>>2]|0,qa+132|0,ia-p,p,e)}do if(i[a+16>>0]|0){h=k[e+4>>2]|0;if(!(k[h+748>>2]|0))break;g=k[h+740>>2]|0;f=k[(k[e+8>>2]|0)+8>>2]|0;j=k[(k[e+12>>2]|0)+8>>2]|0;if((g|0)==(f|0)){rr(h,g+4|0,j+4|0);break}else{rr(h,j+4|0,f+4|0);break}}while(0);f=k[B>>2]|0;if(f){if(i[J>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[f+-4>>2]|0)}k[B>>2]=0}i[J>>0]=1;k[B>>2]=0;k[K>>2]=0;k[z>>2]=0}while(0);r=qa;return}while(0)}Zv(qa+528|0,qa,e,k[d+20>>2]|0,0);if(((k[a+28>>2]|0)!=0?(k[(k[e+4>>2]|0)+748>>2]|0)<(k[a+32>>2]|0):0)?(I=+o[qa+528+4>>2],E=+o[qa+528+8>>2],D=+o[qa+528+12>>2],I*I+E*E+D*D>1.1920928955078125e-07):0){A=1.0/(I*I+E*E+D*D);if(+X(+(D*A))>.7071067690849304){m=1.0/+Y(+(D*A*(D*A)+E*A*(E*A)));q=0.0;n=-(D*A*m);m=E*A*m}else{n=1.0/+Y(+(I*A*(I*A)+E*A*(E*A)));q=-(E*A*n);n=I*A*n;m=0.0}y=+gc[k[(k[T>>2]|0)+16>>2]&15](T);x=+gc[k[(k[G>>2]|0)+16>>2]&15](G);p=.019999999552965164/(y<x?y:x);if(y<x){k[qa+712>>2]=k[qa>>2];k[qa+712+4>>2]=k[qa+4>>2];k[qa+712+8>>2]=k[qa+8>>2];k[qa+712+12>>2]=k[qa+12>>2];k[qa+712+16>>2]=k[qa+16>>2];k[qa+712+16+4>>2]=k[qa+16+4>>2];k[qa+712+16+8>>2]=k[qa+16+8>>2];k[qa+712+16+12>>2]=k[qa+16+12>>2];k[qa+712+32>>2]=k[qa+32>>2];k[qa+712+32+4>>2]=k[qa+32+4>>2];k[qa+712+32+8>>2]=k[qa+32+8>>2];k[qa+712+32+12>>2]=k[qa+32+12>>2];k[qa+712+48>>2]=k[qa+48>>2];k[qa+712+48+4>>2]=k[qa+48+4>>2];k[qa+712+48+8>>2]=k[qa+48+8>>2];k[qa+712+48+12>>2]=k[qa+48+12>>2]}else{k[qa+712>>2]=k[qa+64>>2];k[qa+712+4>>2]=k[qa+64+4>>2];k[qa+712+8>>2]=k[qa+64+8>>2];k[qa+712+12>>2]=k[qa+64+12>>2];k[qa+712+16>>2]=k[qa+80>>2];k[qa+712+16+4>>2]=k[qa+80+4>>2];k[qa+712+16+8>>2]=k[qa+80+8>>2];k[qa+712+16+12>>2]=k[qa+80+12>>2];k[qa+712+32>>2]=k[qa+96>>2];k[qa+712+32+4>>2]=k[qa+96+4>>2];k[qa+712+32+8>>2]=k[qa+96+8>>2];k[qa+712+32+12>>2]=k[qa+96+12>>2];k[qa+712+48>>2]=k[qa+112>>2];k[qa+712+48+4>>2]=k[qa+112+4>>2];k[qa+712+48+8>>2]=k[qa+112+8>>2];k[qa+712+48+12>>2]=k[qa+112+12>>2]}j=k[a+28>>2]|0;if((j|0)>0?(C=m*m+(n*n+q*q),F=p>.39269909262657166?.19634954631328583:p*.5,C>1.1920928955078125e-07):0){t=+$(+F)/+Y(+C);v=q*t;u=n*t;t=m*t;s=+_(+F);l=+Y(+(D*A*(D*A)+(I*A*(I*A)+E*A*(E*A))));h=0;do{m=+(h|0)*(6.2831854820251465/+(j|0))*.5;n=+$(+m)/l;q=I*A*n;p=E*A*n;n=D*A*n;m=+_(+m);if(y<x){ea=n*(v*-n+(s*-p+u*m)-t*-q)+(q*(s*m-v*-q-u*-p-t*-n)+m*(t*-p+(v*m+s*-q)-u*-n))-p*(u*-q+(t*m+s*-n)-v*-p);ga=q*(u*-q+(t*m+s*-n)-v*-p)+(m*(v*-n+(s*-p+u*m)-t*-q)+p*(s*m-v*-q-u*-p-t*-n))-n*(t*-p+(v*m+s*-q)-u*-n);R=p*(t*-p+(v*m+s*-q)-u*-n)+(n*(s*m-v*-q-u*-p-t*-n)+m*(u*-q+(t*m+s*-n)-v*-p))-q*(v*-n+(s*-p+u*m)-t*-q);ca=m*(s*m-v*-q-u*-p-t*-n)-q*(t*-p+(v*m+s*-q)-u*-n)-p*(v*-n+(s*-p+u*m)-t*-q)-n*(u*-q+(t*m+s*-n)-v*-p);fa=ea*(2.0/(ca*ca+(R*R+(ea*ea+ga*ga))));ha=ga*(2.0/(ca*ca+(R*R+(ea*ea+ga*ga))));ba=R*(2.0/(ca*ca+(R*R+(ea*ea+ga*ga))));pa=k[b+12>>2]|0;C=+o[pa>>2];F=+o[pa+16>>2];U=+o[pa+32>>2];V=+o[pa+4>>2];W=+o[pa+20>>2];Z=+o[pa+36>>2];aa=+o[pa+8>>2];da=+o[pa+24>>2];ia=+o[pa+40>>2];o[qa>>2]=(ea*ba+ca*ha)*U+(F*(ea*ha-ca*ba)+C*(1.0-(ga*ha+R*ba)));o[qa+4>>2]=(1.0-(ga*ha+R*ba))*V+(ea*ha-ca*ba)*W+(ea*ba+ca*ha)*Z;o[qa+8>>2]=(1.0-(ga*ha+R*ba))*aa+(ea*ha-ca*ba)*da+(ea*ba+ca*ha)*ia;o[qa+12>>2]=0.0;o[qa+16>>2]=(ga*ba-ca*fa)*U+(C*(ea*ha+ca*ba)+F*(1.0-(ea*fa+R*ba)));o[qa+20>>2]=(ea*ha+ca*ba)*V+(1.0-(ea*fa+R*ba))*W+(ga*ba-ca*fa)*Z;o[qa+24>>2]=(ea*ha+ca*ba)*aa+(1.0-(ea*fa+R*ba))*da+(ga*ba-ca*fa)*ia;o[qa+28>>2]=0.0;o[qa+32>>2]=C*(ea*ba-ca*ha)+F*(ga*ba+ca*fa)+U*(1.0-(ea*fa+ga*ha));o[qa+36>>2]=(ea*ba-ca*ha)*V+(ga*ba+ca*fa)*W+(1.0-(ea*fa+ga*ha))*Z;o[qa+40>>2]=(ea*ba-ca*ha)*aa+(ga*ba+ca*fa)*da+(1.0-(ea*fa+ga*ha))*ia;o[qa+44>>2]=0.0;pa=k[c+12>>2]|0;k[qa+64>>2]=k[pa>>2];k[qa+64+4>>2]=k[pa+4>>2];k[qa+64+8>>2]=k[pa+8>>2];k[qa+64+12>>2]=k[pa+12>>2];k[qa+80>>2]=k[pa+16>>2];k[qa+80+4>>2]=k[pa+16+4>>2];k[qa+80+8>>2]=k[pa+16+8>>2];k[qa+80+12>>2]=k[pa+16+12>>2];k[qa+96>>2]=k[pa+32>>2];k[qa+96+4>>2]=k[pa+32+4>>2];k[qa+96+8>>2]=k[pa+32+8>>2];k[qa+96+12>>2]=k[pa+32+12>>2];k[qa+112>>2]=k[pa+48>>2];k[qa+112+4>>2]=k[pa+48+4>>2];k[qa+112+8>>2]=k[pa+48+8>>2];k[qa+112+12>>2]=k[pa+48+12>>2]}else{pa=k[b+12>>2]|0;k[qa>>2]=k[pa>>2];k[qa+4>>2]=k[pa+4>>2];k[qa+8>>2]=k[pa+8>>2];k[qa+12>>2]=k[pa+12>>2];k[qa+16>>2]=k[pa+16>>2];k[qa+16+4>>2]=k[pa+16+4>>2];k[qa+16+8>>2]=k[pa+16+8>>2];k[qa+16+12>>2]=k[pa+16+12>>2];k[qa+32>>2]=k[pa+32>>2];k[qa+32+4>>2]=k[pa+32+4>>2];k[qa+32+8>>2]=k[pa+32+8>>2];k[qa+32+12>>2]=k[pa+32+12>>2];k[qa+48>>2]=k[pa+48>>2];k[qa+48+4>>2]=k[pa+48+4>>2];k[qa+48+8>>2]=k[pa+48+8>>2];k[qa+48+12>>2]=k[pa+48+12>>2];ea=n*(v*-n+(s*-p+u*m)-t*-q)+(q*(s*m-v*-q-u*-p-t*-n)+m*(t*-p+(v*m+s*-q)-u*-n))-p*(u*-q+(t*m+s*-n)-v*-p);ga=q*(u*-q+(t*m+s*-n)-v*-p)+(m*(v*-n+(s*-p+u*m)-t*-q)+p*(s*m-v*-q-u*-p-t*-n))-n*(t*-p+(v*m+s*-q)-u*-n);R=p*(t*-p+(v*m+s*-q)-u*-n)+(n*(s*m-v*-q-u*-p-t*-n)+m*(u*-q+(t*m+s*-n)-v*-p))-q*(v*-n+(s*-p+u*m)-t*-q);ca=m*(s*m-v*-q-u*-p-t*-n)-q*(t*-p+(v*m+s*-q)-u*-n)-p*(v*-n+(s*-p+u*m)-t*-q)-n*(u*-q+(t*m+s*-n)-v*-p);fa=ea*(2.0/(ca*ca+(R*R+(ea*ea+ga*ga))));ha=ga*(2.0/(ca*ca+(R*R+(ea*ea+ga*ga))));ba=R*(2.0/(ca*ca+(R*R+(ea*ea+ga*ga))));pa=k[c+12>>2]|0;C=+o[pa>>2];F=+o[pa+16>>2];U=+o[pa+32>>2];V=+o[pa+4>>2];W=+o[pa+20>>2];Z=+o[pa+36>>2];aa=+o[pa+8>>2];da=+o[pa+24>>2];ia=+o[pa+40>>2];o[qa+64>>2]=(ea*ba+ca*ha)*U+(F*(ea*ha-ca*ba)+C*(1.0-(ga*ha+R*ba)));o[qa+68>>2]=(1.0-(ga*ha+R*ba))*V+(ea*ha-ca*ba)*W+(ea*ba+ca*ha)*Z;o[qa+72>>2]=(1.0-(ga*ha+R*ba))*aa+(ea*ha-ca*ba)*da+(ea*ba+ca*ha)*ia;o[qa+76>>2]=0.0;o[qa+80>>2]=(ga*ba-ca*fa)*U+(C*(ea*ha+ca*ba)+F*(1.0-(ea*fa+R*ba)));o[qa+84>>2]=(ea*ha+ca*ba)*V+(1.0-(ea*fa+R*ba))*W+(ga*ba-ca*fa)*Z;o[qa+88>>2]=(ea*ha+ca*ba)*aa+(1.0-(ea*fa+R*ba))*da+(ga*ba-ca*fa)*ia;o[qa+92>>2]=0.0;o[qa+96>>2]=C*(ea*ba-ca*ha)+F*(ga*ba+ca*fa)+U*(1.0-(ea*fa+ga*ha));o[qa+100>>2]=(ea*ba-ca*ha)*V+(ga*ba+ca*fa)*W+(1.0-(ea*fa+ga*ha))*Z;o[qa+104>>2]=(ea*ba-ca*ha)*aa+(ga*ba+ca*fa)*da+(1.0-(ea*fa+ga*ha))*ia;o[qa+108>>2]=0.0}j=k[d+20>>2]|0;k[qa+288>>2]=10752;k[qa+288+32>>2]=e;k[qa+288+36>>2]=k[qa>>2];k[qa+288+36+4>>2]=k[qa+4>>2];k[qa+288+36+8>>2]=k[qa+8>>2];k[qa+288+36+12>>2]=k[qa+12>>2];k[qa+288+52>>2]=k[qa+16>>2];k[qa+288+52+4>>2]=k[qa+16+4>>2];k[qa+288+52+8>>2]=k[qa+16+8>>2];k[qa+288+52+12>>2]=k[qa+16+12>>2];k[qa+288+68>>2]=k[qa+32>>2];k[qa+288+68+4>>2]=k[qa+32+4>>2];k[qa+288+68+8>>2]=k[qa+32+8>>2];k[qa+288+68+12>>2]=k[qa+32+12>>2];k[qa+288+84>>2]=k[qa+48>>2];k[qa+288+84+4>>2]=k[qa+48+4>>2];k[qa+288+84+8>>2]=k[qa+48+8>>2];k[qa+288+84+12>>2]=k[qa+48+12>>2];k[qa+288+100>>2]=k[qa+64>>2];k[qa+288+100+4>>2]=k[qa+64+4>>2];k[qa+288+100+8>>2]=k[qa+64+8>>2];k[qa+288+100+12>>2]=k[qa+64+12>>2];k[qa+288+116>>2]=k[qa+80>>2];k[qa+288+116+4>>2]=k[qa+80+4>>2];k[qa+288+116+8>>2]=k[qa+80+8>>2];k[qa+288+116+12>>2]=k[qa+80+12>>2];k[qa+288+132>>2]=k[qa+96>>2];k[qa+288+132+4>>2]=k[qa+96+4>>2];k[qa+288+132+8>>2]=k[qa+96+8>>2];k[qa+288+132+12>>2]=k[qa+96+12>>2];k[qa+288+148>>2]=k[qa+112>>2];k[qa+288+148+4>>2]=k[qa+112+4>>2];k[qa+288+148+8>>2]=k[qa+112+8>>2];k[qa+288+148+12>>2]=k[qa+112+12>>2];k[qa+288+164>>2]=k[qa+712>>2];k[qa+288+164+4>>2]=k[qa+712+4>>2];k[qa+288+164+8>>2]=k[qa+712+8>>2];k[qa+288+164+12>>2]=k[qa+712+12>>2];k[qa+288+180>>2]=k[qa+712+16>>2];k[qa+288+180+4>>2]=k[qa+712+16+4>>2];k[qa+288+180+8>>2]=k[qa+712+16+8>>2];k[qa+288+180+12>>2]=k[qa+712+16+12>>2];k[qa+288+196>>2]=k[qa+712+32>>2];k[qa+288+196+4>>2]=k[qa+712+32+4>>2];k[qa+288+196+8>>2]=k[qa+712+32+8>>2];k[qa+288+196+12>>2]=k[qa+712+32+12>>2];k[qa+288+212>>2]=k[qa+712+48>>2];k[qa+288+212+4>>2]=k[qa+712+48+4>>2];k[qa+288+212+8>>2]=k[qa+712+48+8>>2];k[qa+288+212+12>>2]=k[qa+712+48+12>>2];i[qa+288+228>>0]=y<x&1;k[qa+288+232>>2]=j;Zv(qa+528|0,qa,qa+288|0,j,0);j=k[a+28>>2]|0;h=h+1|0}while((h|0)<(j|0))}}if(!(i[a+16>>0]|0)){r=qa;return}g=k[e+4>>2]|0;if(!(k[g+748>>2]|0)){r=qa;return}h=k[g+740>>2]|0;j=k[(k[e+8>>2]|0)+8>>2]|0;f=k[(k[e+12>>2]|0)+8>>2]|0;if((h|0)==(j|0)){rr(g,h+4|0,f+4|0);r=qa;return}else{rr(g,f+4|0,j+4|0);r=qa;return}}function Ls(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0.0,g=0.0,h=0.0,j=0.0,l=0.0,m=0.0,n=0.0;a=r;r=r+624|0;n=+o[b+116>>2]-+o[b+52>>2];m=+o[b+120>>2]-+o[b+56>>2];l=+o[b+124>>2]-+o[b+60>>2];g=+o[c+116>>2]-+o[c+52>>2];f=+o[c+120>>2]-+o[c+56>>2];h=+o[c+124>>2]-+o[c+60>>2];j=+o[b+252>>2];if(n*n+m*m+l*l<j*j?(m=+o[c+252>>2],g*g+f*f+h*h<m*m):0){m=1.0;r=a;return +m}e=k[b+192>>2]|0;m=+o[c+248>>2];k[a+568+8>>2]=0;o[a+568+12>>2]=1.0;o[a+568+16>>2]=1.0;o[a+568+20>>2]=1.0;o[a+568+24>>2]=0.0;k[a+568>>2]=12008;k[a+568+4>>2]=8;o[a+568+28>>2]=m;o[a+568+44>>2]=m;k[a+392>>2]=7512;o[a+392+164>>2]=999999984306749440.0;k[a+392+168>>2]=0;o[a+392+172>>2]=0.0;o[a+32+308>>2]=9.999999747378752e-05;i[a+32+332>>0]=0;k[a+16>>2]=19128;k[a+16+4>>2]=a+32;k[a+16+8>>2]=e;k[a+16+12>>2]=a+568;if(Tv(a+16|0,b+4|0,b+68|0,c+4|0,c+68|0,a+392|0)|0){f=+o[a+392+164>>2];if(+o[b+244>>2]>f)o[b+244>>2]=f;if(+o[c+244>>2]>f)o[c+244>>2]=f;if(f<1.0)g=f;else g=1.0}else g=1.0;e=k[c+192>>2]|0;m=+o[b+248>>2];k[a+568+8>>2]=0;o[a+568+12>>2]=1.0;o[a+568+16>>2]=1.0;o[a+568+20>>2]=1.0;o[a+568+24>>2]=0.0;k[a+568>>2]=12008;k[a+568+4>>2]=8;o[a+568+28>>2]=m;o[a+568+44>>2]=m;k[a+392>>2]=7512;o[a+392+164>>2]=999999984306749440.0;k[a+392+168>>2]=0;o[a+392+172>>2]=0.0;o[a+32+308>>2]=9.999999747378752e-05;i[a+32+332>>0]=0;k[a>>2]=19128;k[a+4>>2]=a+32;k[a+8>>2]=a+568;k[a+12>>2]=e;if(Tv(a,b+4|0,b+68|0,c+4|0,c+68|0,a+392|0)|0){f=+o[a+392+164>>2];if(+o[b+244>>2]>f)o[b+244>>2]=f;if(+o[c+244>>2]>f)o[c+244>>2]=f;if(!(g>f))f=g}else f=g;m=f;r=a;return +m}function Ms(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;k[a+4>>2]=b;k[a>>2]=11016;i[a+24>>0]=1;k[a+20>>2]=0;k[a+12>>2]=0;k[a+16>>2]=0;i[a+28>>0]=f&1;k[a+32>>2]=c;i[a+36>>0]=0;k[a+40>>2]=k[(k[(f?e:d)+4>>2]|0)+68>>2];Ns(a,d,e);return}function Ns(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,j=0,l=0,m=0;m=r;r=r+32|0;g=(i[a+28>>0]|0)!=0;l=g?c:b;g=g?b:c;h=k[l+4>>2]|0;j=k[h+16>>2]|0;f=k[a+12>>2]|0;if((f|0)<(j|0)){if((k[a+16>>2]|0)<(j|0)){if(!j){c=0;b=f}else{k[5108]=(k[5108]|0)+1;c=iF((j<<2|3)+16|0)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}b=k[a+12>>2]|0}if((b|0)>0){d=b+-1|0;e=0;while(1){b=c+(e<<2)|0;if(b)k[b>>2]=k[(k[a+20>>2]|0)+(e<<2)>>2];if((e|0)==(d|0))break;else e=e+1|0}}b=k[a+20>>2]|0;if(b){if(i[a+24>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+20>>2]=0}i[a+24>>0]=1;k[a+20>>2]=c;k[a+16>>2]=j;d=a+20|0}else d=a+20|0;b=f;while(1){c=(k[d>>2]|0)+(b<<2)|0;if(c)k[c>>2]=0;if((b|0)==(j+-1|0))break;else b=b+1|0}}k[a+12>>2]=j;if((j|0)<=0){r=m;return}c=0;while(1){if(!(k[h+64>>2]|0)){d=k[(k[h+24>>2]|0)+(c*80|0)+64>>2]|0;e=k[l+8>>2]|0;f=k[l+12>>2]|0;k[m>>2]=l;k[m+4>>2]=d;k[m+8>>2]=e;k[m+12>>2]=f;k[m+16>>2]=-1;k[m+20>>2]=c;f=k[a+4>>2]|0;f=_b[k[(k[f>>2]|0)+8>>2]&31](f,m,g,k[a+32>>2]|0)|0;k[(k[a+20>>2]|0)+(c<<2)>>2]=f}else k[(k[a+20>>2]|0)+(c<<2)>>2]=0;if((c|0)==(j+-1|0))break;else c=c+1|0}r=m;return}function Os(a){a=a|0;var b=0,c=0,d=0;k[a>>2]=11016;b=k[a+12>>2]|0;if((b|0)>0){d=0;while(1){c=k[(k[a+20>>2]|0)+(d<<2)>>2]|0;if(c){Sb[k[k[c>>2]>>2]&255](c);c=k[a+4>>2]|0;Ub[k[(k[c>>2]|0)+60>>2]&127](c,k[(k[a+20>>2]|0)+(d<<2)>>2]|0)}if((d|0)==(b+-1|0))break;else d=d+1|0}}b=k[a+20>>2]|0;if(!b){i[a+24>>0]=1;k[a+20>>2]=0;k[a+12>>2]=0;a=a+16|0;k[a>>2]=0;return}if(i[a+24>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+20>>2]=0;i[a+24>>0]=1;k[a+20>>2]=0;k[a+12>>2]=0;a=a+16|0;k[a>>2]=0;return}function Ps(a){a=a|0;Os(a);jF(a);return}function Qs(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,l=0,m=0,n=0,p=0,q=0,s=0,t=0,u=0,v=0,w=0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0,Q=0.0,R=0.0,S=0.0,T=0.0,U=0.0;w=r;r=r+256|0;u=(i[a+28>>0]|0)!=0;t=u?c:b;u=u?b:c;v=k[t+4>>2]|0;if((k[v+68>>2]|0)!=(k[a+40>>2]|0)){g=k[a+12>>2]|0;if((g|0)>0){h=0;while(1){f=k[(k[a+20>>2]|0)+(h<<2)>>2]|0;if(f){Sb[k[k[f>>2]>>2]&255](f);p=k[a+4>>2]|0;Ub[k[(k[p>>2]|0)+60>>2]&127](p,k[(k[a+20>>2]|0)+(h<<2)>>2]|0)}if((h|0)==(g+-1|0))break;else h=h+1|0}}Ns(a,b,c)}p=k[v+64>>2]|0;m=k[a+4>>2]|0;h=k[a+20>>2]|0;l=k[a+32>>2]|0;k[w>>2]=11096;k[w+4>>2]=t;k[w+8>>2]=u;k[w+12>>2]=m;k[w+16>>2]=d;k[w+20>>2]=e;k[w+24>>2]=h;k[w+28>>2]=l;l=w+80+16|0;i[l>>0]=1;m=w+80+12|0;k[m>>2]=0;n=w+80+4|0;k[n>>2]=0;k[w+80+8>>2]=0;g=k[a+12>>2]|0;if((g|0)>0){c=h;j=0;while(1){h=k[c+(j<<2)>>2]|0;if(h){Ub[k[(k[h>>2]|0)+16>>2]&127](h,w+80|0);g=k[n>>2]|0;if((g|0)>0){b=0;do{f=k[(k[m>>2]|0)+(b<<2)>>2]|0;if(k[f+748>>2]|0){k[e+4>>2]=f;d=k[f+740>>2]|0;h=k[(k[e+8>>2]|0)+8>>2]|0;c=k[(k[e+12>>2]|0)+8>>2]|0;if((d|0)==(h|0))rr(f,d+4|0,c+4|0);else rr(f,c+4|0,h+4|0);k[e+4>>2]=0;g=k[n>>2]|0}b=b+1|0}while((b|0)<(g|0));if((g|0)<=0){q=g;s=19}}else{q=g;s=19}if((s|0)==19?(s=0,(q|0)<0):0){if((k[w+80+8>>2]|0)<0){g=k[m>>2]|0;if(g){if(i[l>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[g+-4>>2]|0)}k[m>>2]=0}i[l>>0]=1;k[m>>2]=0;k[w+80+8>>2]=0;c=q}else c=q;while(1){h=(k[m>>2]|0)+(c<<2)|0;if(h)k[h>>2]=0;if((c|0)==-1)break;else c=c+1|0}}k[n>>2]=0;g=k[a+12>>2]|0}h=j+1|0;if((h|0)>=(g|0))break;c=k[a+20>>2]|0;j=h}g=k[m>>2]|0;if(g){if(i[l>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[g+-4>>2]|0)}k[m>>2]=0}}i[l>>0]=1;k[m>>2]=0;k[n>>2]=0;k[w+80+8>>2]=0;if(!p){b=k[a+12>>2]|0;if((b|0)>0){f=0;do{ex(w,k[(k[v+24>>2]|0)+(f*80|0)+64>>2]|0,f);f=f+1|0}while((f|0)<(b|0))}else{r=w;return}}else{s=k[t+12>>2]|0;L=+o[s>>2];K=+o[s+16>>2];J=+o[s+32>>2];I=+o[s+4>>2];H=+o[s+20>>2];G=+o[s+36>>2];C=+o[s+8>>2];A=+o[s+24>>2];y=+o[s+40>>2];F=-+o[s+48>>2];E=-+o[s+52>>2];D=-+o[s+56>>2];s=k[u+12>>2]|0;U=+o[s>>2];T=+o[s+16>>2];S=+o[s+32>>2];R=+o[s+4>>2];Q=+o[s+20>>2];P=+o[s+36>>2];O=+o[s+8>>2];N=+o[s+24>>2];M=+o[s+40>>2];B=+o[s+48>>2];z=+o[s+52>>2];x=+o[s+56>>2];o[w+152>>2]=L*U+K*T+J*S;o[w+152+4>>2]=L*R+K*Q+J*P;o[w+152+8>>2]=L*O+K*N+J*M;o[w+152+12>>2]=0.0;o[w+152+16>>2]=I*U+H*T+G*S;o[w+152+20>>2]=I*R+H*Q+G*P;o[w+152+24>>2]=I*O+H*N+G*M;o[w+152+28>>2]=0.0;o[w+152+32>>2]=C*U+A*T+y*S;o[w+152+36>>2]=C*R+A*Q+y*P;o[w+152+40>>2]=C*O+A*N+y*M;o[w+152+44>>2]=0.0;o[w+152+48>>2]=L*F+K*E+J*D+(L*B+K*z+J*x);o[w+152+52>>2]=I*F+H*E+G*D+(I*B+H*z+G*x);o[w+152+56>>2]=C*F+A*E+y*D+(C*B+A*z+y*x);o[w+152+60>>2]=0.0;s=k[u+4>>2]|0;Cc[k[(k[s>>2]|0)+8>>2]&127](s,w+152|0,w+136|0,w+32|0);k[w+216>>2]=k[w+136>>2];k[w+216+4>>2]=k[w+136+4>>2];k[w+216+8>>2]=k[w+136+8>>2];k[w+216+12>>2]=k[w+136+12>>2];k[w+216+16>>2]=k[w+32>>2];k[w+216+16+4>>2]=k[w+32+4>>2];k[w+216+16+8>>2]=k[w+32+8>>2];k[w+216+16+12>>2]=k[w+32+12>>2];dx(k[p>>2]|0,w+216|0,w)}b=k[a+12>>2]|0;if((b|0)<=0){r=w;return}g=0;do{do if(k[(k[a+20>>2]|0)+(g<<2)>>2]|0){q=k[v+24>>2]|0;s=k[q+(g*80|0)+64>>2]|0;e=k[t+12>>2]|0;A=+o[e>>2];B=+o[e+4>>2];C=+o[e+8>>2];D=+o[e+16>>2];E=+o[e+20>>2];F=+o[e+24>>2];M=+o[e+32>>2];O=+o[e+36>>2];Q=+o[e+40>>2];G=+o[q+(g*80|0)>>2];H=+o[q+(g*80|0)+16>>2];I=+o[q+(g*80|0)+32>>2];J=+o[q+(g*80|0)+4>>2];K=+o[q+(g*80|0)+20>>2];L=+o[q+(g*80|0)+36>>2];N=+o[q+(g*80|0)+8>>2];P=+o[q+(g*80|0)+24>>2];R=+o[q+(g*80|0)+40>>2];y=+o[q+(g*80|0)+48>>2];z=+o[q+(g*80|0)+52>>2];U=+o[q+(g*80|0)+56>>2];S=+o[e+48>>2]+(A*y+B*z+C*U);T=+o[e+52>>2]+(D*y+E*z+F*U);U=+o[e+56>>2]+(M*y+O*z+Q*U);o[w+152>>2]=A*G+B*H+C*I;o[w+152+4>>2]=A*J+B*K+C*L;o[w+152+8>>2]=A*N+B*P+C*R;o[w+152+12>>2]=0.0;o[w+152+16>>2]=D*G+E*H+F*I;o[w+152+20>>2]=D*J+E*K+F*L;o[w+152+24>>2]=D*N+E*P+F*R;o[w+152+28>>2]=0.0;o[w+152+32>>2]=M*G+O*H+Q*I;o[w+152+36>>2]=M*J+O*K+Q*L;o[w+152+40>>2]=M*N+O*P+Q*R;o[w+152+44>>2]=0.0;o[w+152+48>>2]=S;o[w+152+52>>2]=T;o[w+152+56>>2]=U;o[w+152+60>>2]=0.0;Cc[k[(k[s>>2]|0)+8>>2]&127](s,w+152|0,w+64|0,w+120|0);s=k[u+4>>2]|0;Cc[k[(k[s>>2]|0)+8>>2]&127](s,k[u+12>>2]|0,w+104|0,w+48|0);if(!(+o[w+64>>2]>+o[w+48>>2])?!(+o[w+120>>2]<+o[w+104>>2]):0)f=1;else f=0;if(!(!(+o[w+64+8>>2]>+o[w+48+8>>2])?!(+o[w+120+8>>2]<+o[w+104+8>>2]):0))f=0;if(!(+o[w+64+4>>2]>+o[w+48+4>>2])?!(+o[w+120+4>>2]<+o[w+104+4>>2]|f^1):0)break;s=k[(k[a+20>>2]|0)+(g<<2)>>2]|0;Sb[k[k[s>>2]>>2]&255](s);s=k[a+4>>2]|0;Ub[k[(k[s>>2]|0)+60>>2]&127](s,k[(k[a+20>>2]|0)+(g<<2)>>2]|0);k[(k[a+20>>2]|0)+(g<<2)>>2]=0}while(0);g=g+1|0}while((g|0)<(b|0));r=w;return}function Rs(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0.0,g=0.0,h=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0,A=0,B=0,C=0,D=0.0,E=0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0;z=(i[a+28>>0]|0)!=0;C=z?c:b;z=z?b:c;A=k[a+12>>2]|0;if((A|0)<=0){y=1.0;return +y}b=(k[C+192>>2]|0)+24|0;g=+o[C+4>>2];v=+o[C+8>>2];w=+o[C+12>>2];x=+o[C+16>>2];y=+o[C+20>>2];h=+o[C+24>>2];j=+o[C+28>>2];l=+o[C+32>>2];m=+o[C+36>>2];n=+o[C+40>>2];p=+o[C+44>>2];q=+o[C+48>>2];r=+o[C+52>>2];s=+o[C+56>>2];t=+o[C+60>>2];u=+o[C+64>>2];c=k[C+260>>2]|0;f=1.0;B=0;while(1){E=k[b>>2]|0;P=+o[E+(B*80|0)>>2];O=+o[E+(B*80|0)+16>>2];N=+o[E+(B*80|0)+32>>2];M=+o[E+(B*80|0)+4>>2];L=+o[E+(B*80|0)+20>>2];K=+o[E+(B*80|0)+36>>2];J=+o[E+(B*80|0)+8>>2];I=+o[E+(B*80|0)+24>>2];H=+o[E+(B*80|0)+40>>2];G=+o[E+(B*80|0)+48>>2];F=+o[E+(B*80|0)+52>>2];D=+o[E+(B*80|0)+56>>2];k[C+260>>2]=c+1;o[C+4>>2]=g*P+v*O+w*N;o[C+8>>2]=g*M+v*L+w*K;o[C+12>>2]=g*J+v*I+w*H;o[C+16>>2]=0.0;o[C+20>>2]=y*P+h*O+j*N;o[C+24>>2]=y*M+h*L+j*K;o[C+28>>2]=y*J+h*I+j*H;o[C+32>>2]=0.0;o[C+36>>2]=m*P+n*O+p*N;o[C+40>>2]=m*M+n*L+p*K;o[C+44>>2]=m*J+n*I+p*H;o[C+48>>2]=0.0;o[C+52>>2]=r+(g*G+v*F+w*D);o[C+56>>2]=s+(y*G+h*F+j*D);o[C+60>>2]=t+(m*G+n*F+p*D);o[C+64>>2]=0.0;E=k[(k[a+20>>2]|0)+(B<<2)>>2]|0;D=+cc[k[(k[E>>2]|0)+12>>2]&15](E,C,z,d,e);f=D<f?D:f;c=(k[C+260>>2]|0)+1|0;k[C+260>>2]=c;o[C+4>>2]=g;o[C+8>>2]=v;o[C+12>>2]=w;o[C+16>>2]=x;o[C+20>>2]=y;o[C+24>>2]=h;o[C+28>>2]=j;o[C+32>>2]=l;o[C+36>>2]=m;o[C+40>>2]=n;o[C+44>>2]=p;o[C+48>>2]=q;o[C+52>>2]=r;o[C+56>>2]=s;o[C+60>>2]=t;o[C+64>>2]=u;if((B|0)==(A+-1|0))break;else B=B+1|0}return +f}function Ss(a){a=a|0;var b=0,c=0,d=0,e=0,f=0;k[a>>2]=11184;b=k[a+8>>2]|0;d=k[b+8>>2]|0;if((d|0)>0){e=0;while(1){c=k[(k[b+16>>2]|0)+(e*12|0)+8>>2]|0;if(c){Sb[k[k[c>>2]>>2]&255](c);f=k[a+4>>2]|0;Ub[k[(k[f>>2]|0)+60>>2]&127](f,c)}if((e|0)==(d+-1|0))break;else e=e+1|0}b=k[a+8>>2]|0}mw(b);b=k[a+8>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+8>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+24>>2]|0;if(!b){i[a+28>>0]=1;k[a+24>>2]=0;k[a+16>>2]=0;f=a+20|0;k[f>>2]=0;return}if(i[a+28>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+24>>2]=0;i[a+28>>0]=1;k[a+24>>2]=0;k[a+16>>2]=0;f=a+20|0;k[f>>2]=0;return}function Ts(a){a=a|0;Ss(a);jF(a);return}function Us(a,b){a=a|0;b=b|0;var c=0,d=0,e=0;e=k[a+8>>2]|0;a=k[e+8>>2]|0;if((a|0)<=0)return;d=0;do{c=k[(k[e+16>>2]|0)+(d*12|0)+8>>2]|0;if(c){Ub[k[(k[c>>2]|0)+16>>2]&127](c,b);a=k[e+8>>2]|0}d=d+1|0}while((d|0)<(a|0));return}function Vs(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,l=0,m=0,n=0,p=0,q=0,s=0,t=0,u=0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0,Q=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0.0,Y=0.0,Z=0.0,_=0.0,$=0.0,aa=0.0,ba=0,ca=0,da=0,ea=0,fa=0,ga=0.0,ha=0.0,ia=0.0,ja=0.0,ka=0.0,la=0.0,ma=0.0,na=0.0,oa=0.0,pa=0.0,qa=0.0;fa=r;r=r+192|0;da=k[b+4>>2]|0;ea=k[c+4>>2]|0;if((k[da+68>>2]|0)==(k[a+40>>2]|0)?(k[ea+68>>2]|0)==(k[a+44>>2]|0):0)ba=a+8|0;else{h=k[a+8>>2]|0;g=k[h+8>>2]|0;if((g|0)>0){j=0;while(1){f=k[(k[h+16>>2]|0)+(j*12|0)+8>>2]|0;if(f){Sb[k[k[f>>2]>>2]&255](f);s=k[a+4>>2]|0;Ub[k[(k[s>>2]|0)+60>>2]&127](s,f)}if((j|0)==(g+-1|0))break;else j=j+1|0}h=k[a+8>>2]|0}mw(h);ba=a+8|0}l=fa+32+16|0;i[l>>0]=1;q=fa+32+12|0;k[q>>2]=0;s=fa+32+4|0;k[s>>2]=0;k[fa+32+8>>2]=0;n=k[ba>>2]|0;j=k[n+8>>2]|0;if((j|0)>0){p=0;do{h=k[(k[n+16>>2]|0)+(p*12|0)+8>>2]|0;if(h){Ub[k[(k[h>>2]|0)+16>>2]&127](h,fa+32|0);j=k[s>>2]|0;if((j|0)>0){m=0;do{f=k[(k[q>>2]|0)+(m<<2)>>2]|0;if(k[f+748>>2]|0){k[e+4>>2]=f;j=k[f+740>>2]|0;h=k[(k[e+8>>2]|0)+8>>2]|0;g=k[(k[e+12>>2]|0)+8>>2]|0;if((j|0)==(h|0))rr(f,j+4|0,g+4|0);else rr(f,g+4|0,h+4|0);k[e+4>>2]=0;j=k[s>>2]|0}m=m+1|0}while((m|0)<(j|0));if((j|0)<=0){t=j;u=22}}else{t=j;u=22}if((u|0)==22?(u=0,(t|0)<0):0){if((k[fa+32+8>>2]|0)<0){j=k[q>>2]|0;if(j){if(i[l>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[j+-4>>2]|0)}k[q>>2]=0}i[l>>0]=1;k[q>>2]=0;k[fa+32+8>>2]=0;h=t}else h=t;while(1){j=(k[q>>2]|0)+(h<<2)|0;if(j)k[j>>2]=0;if((h|0)==-1)break;else h=h+1|0}}k[s>>2]=0;j=k[n+8>>2]|0}p=p+1|0}while((p|0)<(j|0));h=k[q>>2]|0;if(h){if(i[l>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[h+-4>>2]|0)}k[q>>2]=0}}i[l>>0]=1;k[q>>2]=0;k[s>>2]=0;k[fa+32+8>>2]=0;s=k[da+64>>2]|0;q=k[ea+64>>2]|0;p=k[a+4>>2]|0;t=k[ba>>2]|0;u=k[a+32>>2]|0;k[fa+120>>2]=11272;k[fa+120+4>>2]=0;k[fa+120+8>>2]=b;k[fa+120+12>>2]=c;k[fa+120+16>>2]=p;k[fa+120+20>>2]=d;k[fa+120+24>>2]=e;k[fa+120+28>>2]=t;k[fa+120+32>>2]=u;e=k[b+12>>2]|0;E=+o[e>>2];F=+o[e+16>>2];G=+o[e+32>>2];H=+o[e+4>>2];I=+o[e+20>>2];J=+o[e+36>>2];K=+o[e+8>>2];L=+o[e+24>>2];M=+o[e+40>>2];N=-+o[e+48>>2];O=-+o[e+52>>2];P=-+o[e+56>>2];e=k[c+12>>2]|0;Q=+o[e>>2];R=+o[e+16>>2];S=+o[e+32>>2];T=+o[e+4>>2];U=+o[e+20>>2];V=+o[e+36>>2];W=+o[e+8>>2];Y=+o[e+24>>2];Z=+o[e+40>>2];_=+o[e+48>>2];$=+o[e+52>>2];aa=+o[e+56>>2];s=k[s>>2]|0;q=k[q>>2]|0;if((s|0)!=0&(q|0)!=0){k[5108]=(k[5108]|0)+1;t=iF(1043)|0;k[(t+4+15&-16)+-4>>2]=t;k[(t+4+15&-16)>>2]=s;k[(t+4+15&-16)+4>>2]=q;v=+X(+(E*Q+F*R+G*S));w=+X(+(E*T+F*U+G*V));x=+X(+(E*W+F*Y+G*Z));y=+X(+(H*Q+I*R+J*S));z=+X(+(H*T+I*U+J*V));A=+X(+(H*W+I*Y+J*Z));B=+X(+(K*Q+L*R+M*S));C=+X(+(K*T+L*U+M*V));D=+X(+(K*W+L*Y+M*Z));q=t+4+15&-16;t=128;d=128;j=1;u=124;while(1){s=j+-1|0;m=k[q+(s<<3)>>2]|0;l=k[q+(s<<3)+4>>2]|0;qa=+o[l+16>>2];pa=+o[l>>2];oa=+o[l+20>>2];na=+o[l+4>>2];ma=+o[l+24>>2];ga=+o[l+8>>2];la=E*N+F*O+G*P+(E*_+F*$+G*aa)+((E*Q+F*R+G*S)*((qa+pa)*.5)+(E*T+F*U+G*V)*((oa+na)*.5)+(E*W+F*Y+G*Z)*((ma+ga)*.5));ja=H*N+I*O+J*P+(H*_+I*$+J*aa)+((H*Q+I*R+J*S)*((qa+pa)*.5)+(H*T+I*U+J*V)*((oa+na)*.5)+(H*W+I*Y+J*Z)*((ma+ga)*.5));ha=K*N+L*O+M*P+(K*_+L*$+M*aa)+((K*Q+L*R+M*S)*((qa+pa)*.5)+(K*T+L*U+M*V)*((oa+na)*.5)+(K*W+L*Y+M*Z)*((ma+ga)*.5));ka=((qa-pa)*.5+0.0)*v+((oa-na)*.5+0.0)*w+((ma-ga)*.5+0.0)*x;ia=((qa-pa)*.5+0.0)*y+((oa-na)*.5+0.0)*z+((ma-ga)*.5+0.0)*A;ga=((qa-pa)*.5+0.0)*B+((oa-na)*.5+0.0)*C+((ma-ga)*.5+0.0)*D;do if(((((+o[m>>2]<=ka+la?+o[m+16>>2]>=la-ka:0)?+o[m+4>>2]<=ja+ia:0)?+o[m+20>>2]>=ja-ia:0)?+o[m+8>>2]<=ha+ga:0)?+o[m+24>>2]>=ha-ga:0){if((s|0)>(u|0)){n=t<<1;if((t|0)<(n|0)&(d|0)<(n|0)){if(t){k[5108]=(k[5108]|0)+1;e=iF((t<<4|3)+16|0)|0;if(!e)e=0;else{k[(e+4+15&-16)+-4>>2]=e;e=e+4+15&-16}if((t|0)>0){d=t+-1|0;t=0;while(1){u=e+(t<<3)|0;if(u){h=q+(t<<3)|0;p=k[h+4>>2]|0;k[u>>2]=k[h>>2];k[u+4>>2]=p}if((t|0)==(d|0))break;else t=t+1|0}}}else e=0;if(!q)d=n;else{k[5110]=(k[5110]|0)+1;jF(k[q+-4>>2]|0);d=n}}else e=q;p=n;u=n+-4|0}else{e=q;p=t}q=(k[l+40>>2]|0)!=0;if(!(k[m+40>>2]|0))if(q){t=k[l+36>>2]|0;s=e+(s<<3)|0;k[s>>2]=m;k[s+4>>2]=t;s=k[l+40>>2]|0;t=e+(j<<3)|0;k[t>>2]=m;k[t+4>>2]=s;t=p;s=j+1|0;break}else{yc[k[(k[fa+120>>2]|0)+8>>2]&127](fa+120|0,m,l);t=p;break}else{t=e+(s<<3)|0;s=k[m+36>>2]|0;if(q){q=k[l+36>>2]|0;k[t>>2]=s;k[t+4>>2]=q;s=k[l+36>>2]|0;t=e+(j<<3)|0;k[t>>2]=k[m+40>>2];k[t+4>>2]=s;t=k[l+40>>2]|0;s=e+(j+1<<3)|0;k[s>>2]=k[m+36>>2];k[s+4>>2]=t;s=k[l+40>>2]|0;t=e+(j+2<<3)|0;k[t>>2]=k[m+40>>2];k[t+4>>2]=s;t=p;s=j+3|0;break}else{k[t>>2]=s;k[t+4>>2]=l;t=e+(j<<3)|0;k[t>>2]=k[m+40>>2];k[t+4>>2]=l;t=p;s=j+1|0;break}}}else e=q;while(0);if(!s)break;else{q=e;j=s}}if(e){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0)}}n=k[ba>>2]|0;if((k[n+8>>2]|0)>0){p=0;do{h=k[n+16>>2]|0;g=k[h+(p*12|0)+8>>2]|0;do if(g){e=k[h+(p*12|0)>>2]|0;d=k[da+24>>2]|0;u=k[d+(e*80|0)+64>>2]|0;t=k[b+12>>2]|0;la=+o[t>>2];M=+o[t+4>>2];L=+o[t+8>>2];ia=+o[t+16>>2];ga=+o[t+20>>2];$=+o[t+24>>2];ha=+o[t+32>>2];_=+o[t+36>>2];R=+o[t+40>>2];Z=+o[d+(e*80|0)>>2];Y=+o[d+(e*80|0)+16>>2];W=+o[d+(e*80|0)+32>>2];V=+o[d+(e*80|0)+4>>2];U=+o[d+(e*80|0)+20>>2];T=+o[d+(e*80|0)+36>>2];aa=+o[d+(e*80|0)+8>>2];S=+o[d+(e*80|0)+24>>2];Q=+o[d+(e*80|0)+40>>2];ka=+o[d+(e*80|0)+48>>2];ja=+o[d+(e*80|0)+52>>2];N=+o[d+(e*80|0)+56>>2];P=+o[t+48>>2]+(la*ka+M*ja+L*N);O=+o[t+52>>2]+(ia*ka+ga*ja+$*N);N=+o[t+56>>2]+(ha*ka+_*ja+R*N);o[fa+56>>2]=la*Z+M*Y+L*W;o[fa+56+4>>2]=la*V+M*U+L*T;o[fa+56+8>>2]=la*aa+M*S+L*Q;o[fa+56+12>>2]=0.0;o[fa+56+16>>2]=ia*Z+ga*Y+$*W;o[fa+56+20>>2]=ia*V+ga*U+$*T;o[fa+56+24>>2]=ia*aa+ga*S+$*Q;o[fa+56+28>>2]=0.0;o[fa+56+32>>2]=ha*Z+_*Y+R*W;o[fa+56+36>>2]=ha*V+_*U+R*T;o[fa+56+40>>2]=ha*aa+_*S+R*Q;o[fa+56+44>>2]=0.0;o[fa+56+48>>2]=P;o[fa+56+52>>2]=O;o[fa+56+56>>2]=N;o[fa+56+60>>2]=0.0;Cc[k[(k[u>>2]|0)+8>>2]&127](u,fa+56|0,fa+160|0,fa+176|0);u=k[(k[n+16>>2]|0)+(p*12|0)+4>>2]|0;t=k[ea+24>>2]|0;e=k[t+(u*80|0)+64>>2]|0;d=k[c+12>>2]|0;N=+o[d>>2];O=+o[d+4>>2];P=+o[d+8>>2];Q=+o[d+16>>2];R=+o[d+20>>2];S=+o[d+24>>2];_=+o[d+32>>2];aa=+o[d+36>>2];ha=+o[d+40>>2];T=+o[t+(u*80|0)>>2];U=+o[t+(u*80|0)+16>>2];V=+o[t+(u*80|0)+32>>2];W=+o[t+(u*80|0)+4>>2];Y=+o[t+(u*80|0)+20>>2];Z=+o[t+(u*80|0)+36>>2];$=+o[t+(u*80|0)+8>>2];ga=+o[t+(u*80|0)+24>>2];ia=+o[t+(u*80|0)+40>>2];L=+o[t+(u*80|0)+48>>2];M=+o[t+(u*80|0)+52>>2];la=+o[t+(u*80|0)+56>>2];ja=+o[d+48>>2]+(N*L+O*M+P*la);ka=+o[d+52>>2]+(Q*L+R*M+S*la);la=+o[d+56>>2]+(_*L+aa*M+ha*la);o[fa+56>>2]=N*T+O*U+P*V;o[fa+56+4>>2]=N*W+O*Y+P*Z;o[fa+56+8>>2]=N*$+O*ga+P*ia;o[fa+56+12>>2]=0.0;o[fa+56+16>>2]=Q*T+R*U+S*V;o[fa+56+20>>2]=Q*W+R*Y+S*Z;o[fa+56+24>>2]=Q*$+R*ga+S*ia;o[fa+56+28>>2]=0.0;o[fa+56+32>>2]=_*T+aa*U+ha*V;o[fa+56+36>>2]=_*W+aa*Y+ha*Z;o[fa+56+40>>2]=_*$+aa*ga+ha*ia;o[fa+56+44>>2]=0.0;o[fa+56+48>>2]=ja;o[fa+56+52>>2]=ka;o[fa+56+56>>2]=la;o[fa+56+60>>2]=0.0;Cc[k[(k[e>>2]|0)+8>>2]&127](e,fa+56|0,fa+16|0,fa);if(!(+o[fa+160>>2]>+o[fa>>2])?!(+o[fa+176>>2]<+o[fa+16>>2]):0)h=1;else h=0;if(!(!(+o[fa+160+8>>2]>+o[fa+8>>2])?!(+o[fa+176+8>>2]<+o[fa+16+8>>2]):0))h=0;if(!(+o[fa+160+4>>2]>+o[fa+4>>2])?!(+o[fa+176+4>>2]<+o[fa+16+4>>2]|h^1):0)break;Sb[k[k[g>>2]>>2]&255](g);m=k[a+4>>2]|0;Ub[k[(k[m>>2]|0)+60>>2]&127](m,g);m=k[n+16>>2]|0;l=k[m+(p*12|0)>>2]|0;m=k[m+(p*12|0)+4>>2]|0;h=k[a+16>>2]|0;if((h|0)==(k[a+20>>2]|0)?(ca=(h|0)==0?1:h<<1,(h|0)<(ca|0)):0){if(!ca)f=0;else{k[5108]=(k[5108]|0)+1;h=iF((ca*12|3)+16|0)|0;if(!h)h=0;else{k[(h+4+15&-16)+-4>>2]=h;h=h+4+15&-16}f=h;h=k[a+16>>2]|0}if((h|0)>0){j=h+-1|0;g=0;while(1){h=f+(g*12|0)|0;if(h){e=(k[a+24>>2]|0)+(g*12|0)|0;k[h>>2]=k[e>>2];k[h+4>>2]=k[e+4>>2];k[h+8>>2]=k[e+8>>2]}if((g|0)==(j|0))break;else g=g+1|0}}h=k[a+24>>2]|0;if(h){if(i[a+28>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[h+-4>>2]|0)}k[a+24>>2]=0}i[a+28>>0]=1;k[a+24>>2]=f;k[a+20>>2]=ca;h=k[a+16>>2]|0}g=k[a+24>>2]|0;f=g+(h*12|0)|0;if(f){k[f>>2]=l;k[g+(h*12|0)+4>>2]=m;k[g+(h*12|0)+8>>2]=0;h=k[a+16>>2]|0}k[a+16>>2]=h+1}while(0);p=p+1|0}while((p|0)<(k[n+8>>2]|0));g=a+24|0;h=a+16|0}else{g=a+24|0;h=a+16|0}if((k[h>>2]|0)>0){f=0;do{d=k[ba>>2]|0;e=k[g>>2]|0;dc[k[(k[d>>2]|0)+8>>2]&63](d,k[e+(f*12|0)>>2]|0,k[e+(f*12|0)+4>>2]|0)|0;f=f+1|0}while((f|0)<(k[h>>2]|0))}f=k[g>>2]|0;if(!f){i[a+28>>0]=1;k[g>>2]=0;k[h>>2]=0;e=a+20|0;k[e>>2]=0;r=fa;return}if(i[a+28>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[f+-4>>2]|0)}k[g>>2]=0;i[a+28>>0]=1;k[g>>2]=0;k[h>>2]=0;e=a+20|0;k[e>>2]=0;r=fa;return}function Ws(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;return 0.0}function Xs(a,b){a=a|0;b=b|0;var c=0;k[a+8>>2]=0;k[a>>2]=11368;i[a+28>>0]=1;k[a+24>>2]=0;k[a+16>>2]=0;k[a+20>>2]=0;o[a+32>>2]=999999984306749440.0;o[a+36>>2]=999999984306749440.0;o[a+40>>2]=999999984306749440.0;o[a+44>>2]=0.0;o[a+48>>2]=-999999984306749440.0;o[a+52>>2]=-999999984306749440.0;o[a+56>>2]=-999999984306749440.0;o[a+60>>2]=0.0;k[a+64>>2]=0;k[a+68>>2]=1;o[a+72>>2]=0.0;o[a+76>>2]=1.0;o[a+80>>2]=1.0;o[a+84>>2]=1.0;o[a+88>>2]=0.0;k[a+4>>2]=31;if(!b)return;k[5108]=(k[5108]|0)+1;b=iF(79)|0;if((b|0)!=0?(c=b+4+15&-16,k[c+-4>>2]=b,(b+4+15&-16|0)!=0):0){i[c+36>>0]=1;k[c+32>>2]=0;k[c+24>>2]=0;k[c+28>>2]=0;i[c+56>>0]=1;k[c+52>>2]=0;k[c+44>>2]=0;k[c+48>>2]=0;k[(b+4+15&-16)>>2]=0;k[c+4>>2]=0;k[c+8>>2]=-1;k[c+12>>2]=0;k[c+16>>2]=0;b=b+4+15&-16}else b=0;k[a+64>>2]=b;return}function Ys(a){a=a|0;var b=0,c=0;k[a>>2]=11368;b=k[a+64>>2]|0;if((b|0)!=0?(Lv(b),c=k[a+64>>2]|0,(c|0)!=0):0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}b=k[a+24>>2]|0;if(!b){i[a+28>>0]=1;k[a+24>>2]=0;k[a+16>>2]=0;a=a+20|0;k[a>>2]=0;return}if(i[a+28>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+24>>2]=0;i[a+28>>0]=1;k[a+24>>2]=0;k[a+16>>2]=0;a=a+20|0;k[a>>2]=0;return}function Zs(a){a=a|0;Ys(a);if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function _s(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,l=0,m=0,n=0;h=r;r=r+80|0;k[a+68>>2]=(k[a+68>>2]|0)+1;c=k[a+16>>2]|0;if((c|0)<=0){b=k[a>>2]|0;b=b+68|0;b=k[b>>2]|0;Sb[b&255](a);r=h;return}d=c;f=c;while(1){g=f;f=f+-1|0;c=k[a+24>>2]|0;if((k[c+(f*80|0)+64>>2]|0)==(b|0)){k[a+68>>2]=(k[a+68>>2]|0)+1;e=k[a+64>>2]|0;if(e){c=k[c+(f*80|0)+76>>2]|0;ox(e,c)|0;d=k[e+4>>2]|0;if(d){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[e+4>>2]=c;k[e+12>>2]=(k[e+12>>2]|0)+-1;d=k[a+16>>2]|0;c=k[a+24>>2]|0}e=d+-1|0;m=c+(f*80|0)|0;k[h>>2]=k[m>>2];k[h+4>>2]=k[m+4>>2];k[h+8>>2]=k[m+8>>2];k[h+12>>2]=k[m+12>>2];l=c+(f*80|0)+16|0;k[h+16>>2]=k[l>>2];k[h+16+4>>2]=k[l+4>>2];k[h+16+8>>2]=k[l+8>>2];k[h+16+12>>2]=k[l+12>>2];j=c+(f*80|0)+32|0;k[h+32>>2]=k[j>>2];k[h+32+4>>2]=k[j+4>>2];k[h+32+8>>2]=k[j+8>>2];k[h+32+12>>2]=k[j+12>>2];i=c+(f*80|0)+48|0;k[h+48>>2]=k[i>>2];k[h+48+4>>2]=k[i+4>>2];k[h+48+8>>2]=k[i+8>>2];k[h+48+12>>2]=k[i+12>>2];d=c+(f*80|0)+64|0;k[h+64>>2]=k[d>>2];k[h+64+4>>2]=k[d+4>>2];k[h+64+8>>2]=k[d+8>>2];k[h+64+12>>2]=k[d+12>>2];n=c+(e*80|0)|0;k[m>>2]=k[n>>2];k[m+4>>2]=k[n+4>>2];k[m+8>>2]=k[n+8>>2];k[m+12>>2]=k[n+12>>2];m=c+(e*80|0)+16|0;k[l>>2]=k[m>>2];k[l+4>>2]=k[m+4>>2];k[l+8>>2]=k[m+8>>2];k[l+12>>2]=k[m+12>>2];l=c+(e*80|0)+32|0;k[j>>2]=k[l>>2];k[j+4>>2]=k[l+4>>2];k[j+8>>2]=k[l+8>>2];k[j+12>>2]=k[l+12>>2];j=c+(e*80|0)+48|0;k[i>>2]=k[j>>2];k[i+4>>2]=k[j+4>>2];k[i+8>>2]=k[j+8>>2];k[i+12>>2]=k[j+12>>2];c=c+(e*80|0)+64|0;k[d>>2]=k[c>>2];k[d+4>>2]=k[c+4>>2];k[d+8>>2]=k[c+8>>2];k[d+12>>2]=k[c+12>>2];d=k[a+24>>2]|0;k[d+(e*80|0)>>2]=k[h>>2];k[d+(e*80|0)+4>>2]=k[h+4>>2];k[d+(e*80|0)+8>>2]=k[h+8>>2];k[d+(e*80|0)+12>>2]=k[h+12>>2];k[d+(e*80|0)+16>>2]=k[h+16>>2];k[d+(e*80|0)+16+4>>2]=k[h+16+4>>2];k[d+(e*80|0)+16+8>>2]=k[h+16+8>>2];k[d+(e*80|0)+16+12>>2]=k[h+16+12>>2];k[d+(e*80|0)+32>>2]=k[h+32>>2];k[d+(e*80|0)+32+4>>2]=k[h+32+4>>2];k[d+(e*80|0)+32+8>>2]=k[h+32+8>>2];k[d+(e*80|0)+32+12>>2]=k[h+32+12>>2];k[d+(e*80|0)+48>>2]=k[h+48>>2];k[d+(e*80|0)+48+4>>2]=k[h+48+4>>2];k[d+(e*80|0)+48+8>>2]=k[h+48+8>>2];k[d+(e*80|0)+48+12>>2]=k[h+48+12>>2];k[d+(e*80|0)+64>>2]=k[h+64>>2];k[d+(e*80|0)+64+4>>2]=k[h+64+4>>2];k[d+(e*80|0)+64+8>>2]=k[h+64+8>>2];k[d+(e*80|0)+64+12>>2]=k[h+64+12>>2];if(k[a+64>>2]|0)k[(k[(k[a+24>>2]|0)+(f*80|0)+76>>2]|0)+36>>2]=f;c=(k[a+16>>2]|0)+-1|0;k[a+16>>2]=c}else c=d;if((g|0)<=1)break;else d=c}n=k[a>>2]|0;n=n+68|0;n=k[n>>2]|0;Sb[n&255](a);r=h;return}function $s(a){a=a|0;var b=0.0,c=0,d=0,e=0,f=0;d=r;r=r+32|0;o[a+32>>2]=999999984306749440.0;o[a+36>>2]=999999984306749440.0;o[a+40>>2]=999999984306749440.0;o[a+44>>2]=0.0;o[a+48>>2]=-999999984306749440.0;o[a+52>>2]=-999999984306749440.0;o[a+56>>2]=-999999984306749440.0;o[a+60>>2]=0.0;if((k[a+16>>2]|0)<=0){r=d;return}c=0;do{e=k[a+24>>2]|0;f=k[e+(c*80|0)+64>>2]|0;Cc[k[(k[f>>2]|0)+8>>2]&127](f,e+(c*80|0)|0,d+16|0,d);b=+o[d+16>>2];if(+o[a+32>>2]>b)o[a+32>>2]=b;b=+o[d>>2];if(+o[a+48>>2]<b)o[a+48>>2]=b;b=+o[d+16+4>>2];if(+o[a+36>>2]>b)o[a+36>>2]=b;b=+o[d+4>>2];if(+o[a+52>>2]<b)o[a+52>>2]=b;b=+o[d+16+8>>2];if(+o[a+40>>2]>b)o[a+40>>2]=b;b=+o[d+8>>2];if(+o[a+56>>2]<b)o[a+56>>2]=b;c=c+1|0}while((c|0)<(k[a+16>>2]|0));r=d;return}function at(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0;r=+o[a+48>>2];t=+o[a+32>>2];C=+o[a+52>>2];u=+o[a+36>>2];D=+o[a+56>>2];g=+o[a+40>>2];E=(k[a+16>>2]|0)==0;v=E?0.0:(D+g)*.5;x=E?0.0:(C+u)*.5;z=E?0.0:(r+t)*.5;l=+gc[k[(k[a>>2]|0)+48>>2]&15](a);i=+gc[k[(k[a>>2]|0)+48>>2]&15](a);l=(E?0.0:(r-t)*.5)+l;i=(E?0.0:(C-u)*.5)+i;g=(E?0.0:(D-g)*.5)+ +gc[k[(k[a>>2]|0)+48>>2]&15](a);D=+o[b>>2];u=+X(+D);C=+o[b+4>>2];t=+X(+C);r=+o[b+8>>2];s=+X(+r);B=+o[b+16>>2];q=+X(+B);A=+o[b+20>>2];p=+X(+A);m=+o[b+24>>2];n=+X(+m);y=+o[b+32>>2];j=+X(+y);w=+o[b+36>>2];h=+X(+w);e=+o[b+40>>2];f=+X(+e);r=z*D+x*C+v*r+ +o[b+48>>2];m=z*B+x*A+v*m+ +o[b+52>>2];e=z*y+x*w+v*e+ +o[b+56>>2];o[c>>2]=r-(l*u+i*t+g*s);o[c+4>>2]=m-(l*q+i*p+g*n);o[c+8>>2]=e-(l*j+i*h+g*f);o[c+12>>2]=0.0;o[d>>2]=l*u+i*t+g*s+r;o[d+4>>2]=l*q+i*p+g*n+m;o[d+8>>2]=l*j+i*h+g*f+e;o[d+12>>2]=0.0;return}function bt(a,b,c){a=a|0;b=+b;c=c|0;var d=0,e=0.0,f=0.0,g=0.0,h=0;d=r;r=r+96|0;o[d+32>>2]=1.0;k[d+32+4>>2]=0;k[d+32+4+4>>2]=0;k[d+32+4+8>>2]=0;k[d+32+4+12>>2]=0;o[d+32+20>>2]=1.0;k[d+32+24>>2]=0;k[d+32+24+4>>2]=0;k[d+32+24+8>>2]=0;k[d+32+24+12>>2]=0;o[d+32+40>>2]=1.0;h=d+32+44|0;k[h>>2]=0;k[h+4>>2]=0;k[h+8>>2]=0;k[h+12>>2]=0;k[h+16>>2]=0;Cc[k[(k[a>>2]|0)+8>>2]&127](a,d+32|0,d+16|0,d);f=(+o[d>>2]-+o[d+16>>2])*.5*2.0;e=(+o[d+4>>2]-+o[d+16+4>>2])*.5*2.0;g=(+o[d+8>>2]-+o[d+16+8>>2])*.5*2.0;o[c>>2]=b/12.0*(e*e+g*g);o[c+4>>2]=b/12.0*(f*f+g*g);o[c+8>>2]=b/12.0*(f*f+e*e);r=d;return}function ct(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,l=0,m=0,n=0,p=0.0,q=0.0;n=r;r=r+144|0;if((k[a+16>>2]|0)<=0){m=a+76|0;k[m>>2]=k[b>>2];k[m+4>>2]=k[b+4>>2];k[m+8>>2]=k[b+8>>2];k[m+12>>2]=k[b+12>>2];b=k[a>>2]|0;b=b+68|0;b=k[b>>2]|0;Sb[b&255](a);r=n;return}g=n+16+16|0;h=n+16+32|0;i=n+16+48|0;m=0;do{l=k[a+24>>2]|0;j=l+(m*80|0)|0;k[n+16>>2]=k[j>>2];k[n+16+4>>2]=k[j+4>>2];k[n+16+8>>2]=k[j+8>>2];k[n+16+12>>2]=k[j+12>>2];j=l+(m*80|0)+16|0;k[g>>2]=k[j>>2];k[g+4>>2]=k[j+4>>2];k[g+8>>2]=k[j+8>>2];k[g+12>>2]=k[j+12>>2];j=l+(m*80|0)+32|0;k[h>>2]=k[j>>2];k[h+4>>2]=k[j+4>>2];k[h+8>>2]=k[j+8>>2];k[h+12>>2]=k[j+12>>2];j=l+(m*80|0)+48|0;k[i>>2]=k[j>>2];k[i+4>>2]=k[j+4>>2];k[i+8>>2]=k[j+8>>2];k[i+12>>2]=k[j+12>>2];l=k[l+(m*80|0)+64>>2]|0;l=Wb[k[(k[l>>2]|0)+28>>2]&127](l)|0;k[n>>2]=k[l>>2];k[n+4>>2]=k[l+4>>2];k[n+8>>2]=k[l+8>>2];p=+o[n+4>>2]*+o[b+4>>2]/+o[a+80>>2];q=+o[n+8>>2]*+o[b+8>>2]/+o[a+84>>2];o[n>>2]=+o[n>>2]*+o[b>>2]/+o[a+76>>2];o[n+4>>2]=p;o[n+8>>2]=q;o[n+12>>2]=0.0;l=k[(k[a+24>>2]|0)+(m*80|0)+64>>2]|0;Ub[k[(k[l>>2]|0)+24>>2]&127](l,n);q=+o[n+16+52>>2]*+o[b+4>>2]/+o[a+80>>2];p=+o[n+16+56>>2]*+o[b+8>>2]/+o[a+84>>2];o[n+16+48>>2]=+o[i>>2]*+o[b>>2]/+o[a+76>>2];o[n+16+52>>2]=q;o[n+16+56>>2]=p;o[n+16+60>>2]=0.0;l=k[a+24>>2]|0;j=l+(m*80|0)|0;k[j>>2]=k[n+16>>2];k[j+4>>2]=k[n+16+4>>2];k[j+8>>2]=k[n+16+8>>2];k[j+12>>2]=k[n+16+12>>2];j=l+(m*80|0)+16|0;k[j>>2]=k[g>>2];k[j+4>>2]=k[g+4>>2];k[j+8>>2]=k[g+8>>2];k[j+12>>2]=k[g+12>>2];j=l+(m*80|0)+32|0;k[j>>2]=k[h>>2];k[j+4>>2]=k[h+4>>2];k[j+8>>2]=k[h+8>>2];k[j+12>>2]=k[h+12>>2];l=l+(m*80|0)+48|0;k[l>>2]=k[i>>2];k[l+4>>2]=k[i+4>>2];k[l+8>>2]=k[i+8>>2];k[l+12>>2]=k[i+12>>2];if(k[a+64>>2]|0){j=k[(k[a+24>>2]|0)+(m*80|0)+64>>2]|0;Cc[k[(k[j>>2]|0)+8>>2]&127](j,n+16|0,n+128|0,n+112|0);k[n+80>>2]=k[n+128>>2];k[n+80+4>>2]=k[n+128+4>>2];k[n+80+8>>2]=k[n+128+8>>2];k[n+80+12>>2]=k[n+128+12>>2];k[n+80+16>>2]=k[n+112>>2];k[n+80+16+4>>2]=k[n+112+4>>2];k[n+80+16+8>>2]=k[n+112+8>>2];k[n+80+16+12>>2]=k[n+112+12>>2];j=k[a+64>>2]|0;l=k[(k[a+24>>2]|0)+(m*80|0)+76>>2]|0;c=ox(j,l)|0;a:do if(c){e=k[j+8>>2]|0;if((e|0)<=-1){c=k[j>>2]|0;break}if((e|0)>0){f=0;d=c;while(1){c=k[d+32>>2]|0;f=f+1|0;if(!c){c=d;break a}if((f|0)>=(e|0))break;else d=c}}}else c=0;while(0);k[l>>2]=k[n+80>>2];k[l+4>>2]=k[n+80+4>>2];k[l+8>>2]=k[n+80+8>>2];k[l+12>>2]=k[n+80+12>>2];k[l+16>>2]=k[n+80+16>>2];k[l+20>>2]=k[n+80+20>>2];k[l+24>>2]=k[n+80+24>>2];k[l+28>>2]=k[n+80+28>>2];px(j,c,l)}m=m+1|0}while((m|0)<(k[a+16>>2]|0));m=a+76|0;k[m>>2]=k[b>>2];k[m+4>>2]=k[b+4>>2];k[m+8>>2]=k[b+8>>2];k[m+12>>2]=k[b+12>>2];b=k[a>>2]|0;b=b+68|0;b=k[b>>2]|0;Sb[b&255](a);r=n;return}function dt(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0;d=nc[k[(k[c>>2]|0)+40>>2]&31](c,a)|0;g=nc[k[(k[c>>2]|0)+28>>2]&31](c,d)|0;k[b>>2]=g;if(g)Ub[k[(k[c>>2]|0)+48>>2]&127](c,d);k[b+4>>2]=k[a+4>>2];o[b+20>>2]=+o[a+72>>2];d=k[a+16>>2]|0;k[b+16>>2]=d;k[b+12>>2]=0;if(!d)return 11472;g=dc[k[(k[c>>2]|0)+16>>2]&63](c,76,d)|0;d=k[g+8>>2]|0;f=nc[k[(k[c>>2]|0)+28>>2]&31](c,d)|0;k[b+12>>2]=f;if((k[b+16>>2]|0)>0){e=k[a+24>>2]|0;f=0;while(1){o[d+72>>2]=+o[e+(f*80|0)+72>>2];e=nc[k[(k[c>>2]|0)+28>>2]&31](c,k[e+(f*80|0)+64>>2]|0)|0;k[d+64>>2]=e;if(!(nc[k[(k[c>>2]|0)+24>>2]&31](c,k[(k[a+24>>2]|0)+(f*80|0)+64>>2]|0)|0)){e=k[(k[c>>2]|0)+16>>2]|0;h=k[(k[a+24>>2]|0)+(f*80|0)+64>>2]|0;h=Wb[k[(k[h>>2]|0)+52>>2]&127](h)|0;h=dc[e&63](c,h,1)|0;e=k[(k[a+24>>2]|0)+(f*80|0)+64>>2]|0;e=dc[k[(k[e>>2]|0)+56>>2]&63](e,k[h+8>>2]|0,c)|0;Qb[k[(k[c>>2]|0)+20>>2]&31](c,h,e,1346455635,k[(k[a+24>>2]|0)+(f*80|0)+64>>2]|0)}e=k[a+24>>2]|0;k[d+68>>2]=k[e+(f*80|0)+68>>2];o[d>>2]=+o[e+(f*80|0)>>2];o[d+4>>2]=+o[e+(f*80|0)+4>>2];o[d+8>>2]=+o[e+(f*80|0)+8>>2];o[d+12>>2]=+o[e+(f*80|0)+12>>2];o[d+16>>2]=+o[e+(f*80|0)+16>>2];o[d+20>>2]=+o[e+(f*80|0)+20>>2];o[d+24>>2]=+o[e+(f*80|0)+24>>2];o[d+28>>2]=+o[e+(f*80|0)+28>>2];o[d+32>>2]=+o[e+(f*80|0)+32>>2];o[d+36>>2]=+o[e+(f*80|0)+36>>2];o[d+40>>2]=+o[e+(f*80|0)+40>>2];o[d+44>>2]=+o[e+(f*80|0)+44>>2];o[d+48>>2]=+o[e+(f*80|0)+48>>2];o[d+52>>2]=+o[e+(f*80|0)+52>>2];o[d+56>>2]=+o[e+(f*80|0)+56>>2];o[d+60>>2]=+o[e+(f*80|0)+60>>2];f=f+1|0;if((f|0)>=(k[b+16>>2]|0)){d=c;break}else d=d+76|0}}else d=c;Qb[k[(k[d>>2]|0)+20>>2]&31](c,g,11440,1497453121,k[g+8>>2]|0);return 11472}function et(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0,h=0.0,i=0,j=0;f=+o[b+60>>2]*.5;j=k[b+68>>2]|0;d=+o[c>>2];e=+o[c+4>>2];h=+o[c+8>>2];h=+Y(+(d*d+e*e+h*h));g=k[b+64>>2]|0;if(+o[c+(j<<2)>>2]>h*+o[b+52>>2]){o[a+(g<<2)>>2]=0.0;o[a+(j<<2)>>2]=f;o[a+(k[b+72>>2]<<2)>>2]=0.0;return}h=+o[c+(g<<2)>>2];i=k[b+72>>2]|0;d=+o[c+(i<<2)>>2];e=+Y(+(h*h+d*d));if(e>1.1920928955078125e-07){e=+o[b+56>>2]/e;o[a+(g<<2)>>2]=h*e;o[a+(j<<2)>>2]=-f;o[a+(i<<2)>>2]=d*e;return}else{o[a+(g<<2)>>2]=0.0;o[a+(j<<2)>>2]=-f;o[a+(i<<2)>>2]=0.0;return}}function ft(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0,g=0,h=0.0,i=0,j=0.0,l=0.0,m=0,n=0,p=0;p=r;r=r+16|0;if((d|0)<=0){r=p;return}n=0;while(1){m=c+(n<<4)|0;e=+o[a+60>>2]*.5;f=k[a+68>>2]|0;j=+o[b+(n<<4)>>2];h=+o[b+(n<<4)+4>>2];l=+o[b+(n<<4)+8>>2];l=+Y(+(j*j+h*h+l*l));g=k[a+64>>2]|0;do if(!(+o[b+(n<<4)+(f<<2)>>2]>l*+o[a+52>>2])){h=+o[b+(n<<4)+(g<<2)>>2];i=k[a+72>>2]|0;j=+o[b+(n<<4)+(i<<2)>>2];l=+Y(+(h*h+j*j));if(l>1.1920928955078125e-07){l=+o[a+56>>2]/l;o[p+(g<<2)>>2]=h*l;o[p+(f<<2)>>2]=-e;o[p+(i<<2)>>2]=j*l;break}else{o[p+(g<<2)>>2]=0.0;o[p+(f<<2)>>2]=-e;o[p+(i<<2)>>2]=0.0;break}}else{o[p+(g<<2)>>2]=0.0;o[p+(f<<2)>>2]=e;o[p+(k[a+72>>2]<<2)>>2]=0.0}while(0);k[m>>2]=k[p>>2];k[m+4>>2]=k[p+4>>2];k[m+8>>2]=k[p+8>>2];k[m+12>>2]=k[p+12>>2];if((n|0)==(d+-1|0))break;else n=n+1|0}r=p;return}function gt(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0,f=0.0,g=0,h=0.0,i=0.0,j=0,l=0.0;d=+o[b+60>>2]*.5;j=k[b+68>>2]|0;i=+o[c>>2];f=+o[c+4>>2];h=+o[c+8>>2];h=+Y(+(i*i+f*f+h*h));e=k[b+64>>2]|0;do if(!(+o[c+(j<<2)>>2]>h*+o[b+52>>2])){f=+o[c+(e<<2)>>2];g=k[b+72>>2]|0;h=+o[c+(g<<2)>>2];i=+Y(+(f*f+h*h));if(i>1.1920928955078125e-07){i=+o[b+56>>2]/i;o[a+(e<<2)>>2]=f*i;o[a+(j<<2)>>2]=-d;o[a+(g<<2)>>2]=h*i;break}else{o[a+(e<<2)>>2]=0.0;o[a+(j<<2)>>2]=-d;o[a+(g<<2)>>2]=0.0;break}}else{o[a+(e<<2)>>2]=0.0;o[a+(j<<2)>>2]=d;o[a+(k[b+72>>2]<<2)>>2]=0.0}while(0);if(!(+gc[k[(k[b>>2]|0)+48>>2]&15](b)!=0.0))return;l=+o[c>>2];i=+o[c+4>>2];f=+o[c+8>>2];h=l*l+i*i+f*f<1.4210854715202004e-14?-1.0:f;d=l*l+i*i+f*f<1.4210854715202004e-14?-1.0:i;l=l*l+i*i+f*f<1.4210854715202004e-14?-1.0:l;f=1.0/+Y(+(h*h+(l*l+d*d)));i=+gc[k[(k[b>>2]|0)+48>>2]&15](b);o[a>>2]=f*l*i+ +o[a>>2];o[a+4>>2]=i*(f*d)+ +o[a+4>>2];o[a+8>>2]=i*(f*h)+ +o[a+8>>2];return}function ht(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0.0,f=0,g=0,h=0;h=k[a+68>>2]|0;g=k[a+64>>2]|0;f=k[a+72>>2]|0;d=+o[b+(h<<2)>>2]/+o[a+12+(h<<2)>>2]*+o[a+60>>2];o[a+60>>2]=d;e=+o[a+56>>2]*((+o[b+(g<<2)>>2]/+o[a+12+(g<<2)>>2]+ +o[b+(f<<2)>>2]/+o[a+12+(f<<2)>>2])*.5);o[a+56>>2]=e;e=e/+Y(+(d*d+e*e));o[a+52>>2]=e;e=+X(+(+o[b>>2]));d=+X(+(+o[b+4>>2]));c=+X(+(+o[b+8>>2]));o[a+12>>2]=e;o[a+16>>2]=d;o[a+20>>2]=c;o[a+24>>2]=0.0;return}function it(a,b,c){a=a|0;b=b|0;c=c|0;k[a>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;return}function jt(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;if((d|0)<=0)return;a=0;while(1){b=c+(a<<4)|0;k[b>>2]=0;k[b+4>>2]=0;k[b+8>>2]=0;k[b+12>>2]=0;if((a|0)==(d+-1|0))break;else a=a+1|0}return}function kt(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0;d=r;r=r+16|0;yc[k[(k[b>>2]|0)+68>>2]&127](d,b,c);k[a>>2]=k[d>>2];k[a+4>>2]=k[d+4>>2];k[a+8>>2]=k[d+8>>2];k[a+12>>2]=k[d+12>>2];i=+o[c>>2];g=+o[c+4>>2];f=+o[c+8>>2];e=i*i+g*g+f*f<1.4210854715202004e-14?-1.0:f;h=i*i+g*g+f*f<1.4210854715202004e-14?-1.0:g;i=i*i+g*g+f*f<1.4210854715202004e-14?-1.0:i;f=1.0/+Y(+(e*e+(i*i+h*h)));g=+gc[k[(k[b>>2]|0)+48>>2]&15](b);o[a>>2]=f*i*g+ +o[a>>2];o[a+4>>2]=g*(f*h)+ +o[a+4>>2];o[a+8>>2]=g*(f*e)+ +o[a+8>>2];r=d;return}function lt(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0.0;g=+gc[k[(k[a>>2]|0)+48>>2]&15](a);f=+gc[k[(k[a>>2]|0)+48>>2]&15](a);e=+gc[k[(k[a>>2]|0)+48>>2]&15](a);i=+o[b+52>>2]-f;h=+o[b+56>>2]-e;o[c>>2]=+o[b+48>>2]-g;o[c+4>>2]=i;o[c+8>>2]=h;o[c+12>>2]=0.0;f=f+ +o[b+52>>2];e=e+ +o[b+56>>2];o[d>>2]=g+ +o[b+48>>2];o[d+4>>2]=f;o[d+8>>2]=e;o[d+12>>2]=0.0;return}function mt(a,b,c){a=a|0;b=+b;c=c|0;b=b*.4000000059604645*+gc[k[(k[a>>2]|0)+48>>2]&15](a);b=b*+gc[k[(k[a>>2]|0)+48>>2]&15](a);o[c>>2]=b;o[c+4>>2]=b;o[c+8>>2]=b;o[c+12>>2]=0.0;return}function nt(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;vt(a,b);k[a>>2]=12152;k[a+52>>2]=0;k[a+56>>2]=0;i[a+60>>0]=c&1;i[a+61>>0]=0;k[a+4>>2]=21;if(!d)return;k[5108]=(k[5108]|0)+1;d=iF(191)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}k[d+52>>2]=282;i[d+60>>0]=0;i[d+80>>0]=1;k[d+76>>2]=0;k[d+68>>2]=0;k[d+72>>2]=0;i[d+100>>0]=1;k[d+96>>2]=0;k[d+88>>2]=0;k[d+92>>2]=0;i[d+120>>0]=1;k[d+116>>2]=0;k[d+108>>2]=0;k[d+112>>2]=0;i[d+140>>0]=1;k[d+136>>2]=0;k[d+128>>2]=0;k[d+132>>2]=0;k[d+144>>2]=0;i[d+164>>0]=1;k[d+160>>2]=0;k[d+152>>2]=0;k[d+156>>2]=0;k[d+168>>2]=0;o[d+4>>2]=-3402823466385288598117041.0e14;o[d+8>>2]=-3402823466385288598117041.0e14;o[d+12>>2]=-3402823466385288598117041.0e14;o[d+16>>2]=0.0;o[d+20>>2]=3402823466385288598117041.0e14;o[d+24>>2]=3402823466385288598117041.0e14;o[d+28>>2]=3402823466385288598117041.0e14;o[d+32>>2]=0.0;k[d>>2]=15088;k[a+52>>2]=d;Nu(d,k[a+48>>2]|0,(i[a+60>>0]|0)!=0,a+16|0,a+32|0);i[a+61>>0]=1;return}function ot(a){a=a|0;var b=0;k[a>>2]=12152;if(!(i[a+61>>0]|0))return;b=k[a+52>>2]|0;Sb[k[k[b>>2]>>2]&255](b);a=k[a+52>>2]|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function pt(a){a=a|0;var b=0;k[a>>2]=12152;if((i[a+61>>0]|0)!=0?(b=k[a+52>>2]|0,Sb[k[k[b>>2]>>2]&255](b),b=k[a+52>>2]|0,(b|0)!=0):0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function qt(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0,l=0,n=0,p=0,q=0,s=0,t=0,u=0,v=0,w=0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0;w=r;r=r+80|0;v=k[a+48>>2]|0;k[w>>2]=12336;k[w+4>>2]=v;k[w+8>>2]=b;v=k[a+52>>2]|0;if(!(i[v+60>>0]|0)){b=k[v+56>>2]|0;if((b|0)>0){a=b;g=0;n=k[v+96>>2]|0;b=0;while(1){b=b+1|0;if(!(+o[c>>2]>+o[n+16>>2])?!(+o[d>>2]<+o[n>>2]):0)e=1;else e=0;if(!(!(+o[c+8>>2]>+o[n+24>>2])?!(+o[d+8>>2]<+o[n+8>>2]):0))e=0;if(!(+o[c+4>>2]>+o[n+20>>2])?!(+o[d+4>>2]<+o[n+4>>2]):0){f=k[n+32>>2]|0;if(e&(f|0)==-1){yc[k[(k[w>>2]|0)+8>>2]&127](w,k[n+36>>2]|0,k[n+40>>2]|0);a=k[v+56>>2]|0;l=42}else{h=(f|0)==-1;l=41}}else{f=k[n+32>>2]|0;h=(f|0)==-1;e=0;l=41}if((l|0)==41){l=0;if(h|e)l=42;else{g=f+g|0;e=n+(f<<6)|0}}if((l|0)==42){g=g+1|0;e=n+64|0}if((g|0)<(a|0))n=e;else break}}else b=0;if((k[4340]|0)>=(b|0)){r=w;return}k[4340]=b;r=w;return}z=+o[c>>2];D=+o[c+4>>2];H=+o[c+8>>2];G=+o[v+4>>2];z=z<G?G:z;C=+o[v+8>>2];D=D<C?C:D;y=+o[v+12>>2];H=H<y?y:H;I=+o[v+20>>2];E=+o[v+24>>2];A=+o[v+28>>2];F=+o[v+36>>2];B=+o[v+40>>2];x=+o[v+44>>2];t=~~(((I<z?I:z)-G)*F)&65534;j[w+66>>1]=t;u=~~(((E<D?E:D)-C)*B)&65534;j[w+66+2>>1]=u;s=~~(((A<H?A:H)-y)*x)&65534;j[w+66+4>>1]=s;H=+o[d>>2];D=+o[d+4>>2];z=+o[d+8>>2];H=H<G?G:H;D=D<C?C:D;z=z<y?y:z;p=(~~(((I<H?I:H)-G)*F+1.0)&65535|1)&65535;j[w+60>>1]=p;q=(~~(((E<D?E:D)-C)*B+1.0)&65535|1)&65535;j[w+60+2>>1]=q;d=(~~(((A<z?A:z)-y)*x+1.0)&65535|1)&65535;j[w+60+4>>1]=d;a=k[v+144>>2]|0;if(!a){l=k[v+56>>2]|0;if((l|0)>0){g=0;f=k[v+136>>2]|0;b=0;do{b=b+1|0;e=((p&65535)>=(m[f>>1]|0)?(t&65535)<=(m[f+6>>1]|0):0)&(s&65535)<=(m[f+10>>1]|0)&(d&65535)>=(m[f+4>>1]|0)&(u&65535)<=(m[f+8>>1]|0)&(q&65535)>=(m[f+2>>1]|0);a=f+12|0;h=k[a>>2]|0;if((h|0)>-1&e)yc[k[(k[w>>2]|0)+8>>2]&127](w,h>>21,h&2097151);if(e|(h|0)>-1){g=g+1|0;f=f+16|0}else{v=k[a>>2]|0;g=g-v|0;f=f+(0-v<<4)|0}}while((g|0)<(l|0))}else b=0;if((k[4340]|0)>=(b|0)){r=w;return}k[4340]=b;r=w;return}else if((a|0)==2){Ev(k[v+136>>2]|0,w,w+66|0,w+60|0);r=w;return}else if((a|0)==1){if((k[v+152>>2]|0)<=0){r=w;return}c=0;do{e=k[v+160>>2]|0;if(((p&65535)>=(m[e+(c<<5)>>1]|0)?(t&65535)<=(m[e+(c<<5)+6>>1]|0):0)&(s&65535)<=(m[e+(c<<5)+10>>1]|0)&(d&65535)>=(m[e+(c<<5)+4>>1]|0)&(u&65535)<=(m[e+(c<<5)+8>>1]|0)&(q&65535)>=(m[e+(c<<5)+2>>1]|0)){b=k[e+(c<<5)+12>>2]|0;n=k[e+(c<<5)+16>>2]|0;if((n|0)>0){h=b;g=(k[v+136>>2]|0)+(b<<4)|0;e=0;do{e=e+1|0;l=((p&65535)>=(m[g>>1]|0)?(t&65535)<=(m[g+6>>1]|0):0)&(s&65535)<=(m[g+10>>1]|0)&(d&65535)>=(m[g+4>>1]|0)&(u&65535)<=(m[g+8>>1]|0)&(q&65535)>=(m[g+2>>1]|0);f=g+12|0;a=k[f>>2]|0;if((a|0)>-1&l)yc[k[(k[w>>2]|0)+8>>2]&127](w,a>>21,a&2097151);if(l|(a|0)>-1){h=h+1|0;g=g+16|0}else{l=k[f>>2]|0;h=h-l|0;g=g+(0-l<<4)|0}}while((h|0)<(n+b|0))}else e=0;if((k[4340]|0)<(e|0))k[4340]=e}c=c+1|0}while((c|0)<(k[v+152>>2]|0));r=w;return}else{r=w;return}}function rt(a,b){a=a|0;b=b|0;var c=0,d=0.0,e=0.0,f=0.0,g=0;g=Wb[k[(k[a>>2]|0)+28>>2]&127](a)|0;f=+o[g>>2]-+o[b>>2];e=+o[g+4>>2]-+o[b+4>>2];d=+o[g+8>>2]-+o[b+8>>2];if(!(f*f+e*e+d*d>1.1920928955078125e-07))return;zt(a,b);if((i[a+61>>0]|0)!=0?(c=k[a+52>>2]|0,Sb[k[k[c>>2]>>2]&255](c),c=k[a+52>>2]|0,(c|0)!=0):0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);b=a+52|0}else b=a+52|0;k[5108]=(k[5108]|0)+1;c=iF(191)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}k[c+52>>2]=282;i[c+60>>0]=0;i[c+80>>0]=1;k[c+76>>2]=0;k[c+68>>2]=0;k[c+72>>2]=0;i[c+100>>0]=1;k[c+96>>2]=0;k[c+88>>2]=0;k[c+92>>2]=0;i[c+120>>0]=1;k[c+116>>2]=0;k[c+108>>2]=0;k[c+112>>2]=0;i[c+140>>0]=1;k[c+136>>2]=0;k[c+128>>2]=0;k[c+132>>2]=0;k[c+144>>2]=0;i[c+164>>0]=1;k[c+160>>2]=0;k[c+152>>2]=0;k[c+156>>2]=0;k[c+168>>2]=0;o[c+4>>2]=-3402823466385288598117041.0e14;o[c+8>>2]=-3402823466385288598117041.0e14;o[c+12>>2]=-3402823466385288598117041.0e14;o[c+16>>2]=0.0;o[c+20>>2]=3402823466385288598117041.0e14;o[c+24>>2]=3402823466385288598117041.0e14;o[c+28>>2]=3402823466385288598117041.0e14;o[c+32>>2]=0.0;k[c>>2]=15088;k[b>>2]=c;Nu(c,k[a+48>>2]|0,(i[a+60>>0]|0)!=0,a+16|0,a+32|0);i[a+61>>0]=1;return}function st(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0;d=nc[k[(k[c>>2]|0)+40>>2]&31](c,a)|0;f=nc[k[(k[c>>2]|0)+28>>2]&31](c,d)|0;k[b>>2]=f;if(f)Ub[k[(k[c>>2]|0)+48>>2]&127](c,d);k[b+4>>2]=k[a+4>>2];f=k[a+48>>2]|0;dc[k[(k[f>>2]|0)+56>>2]&63](f,b+12|0,c)|0;o[b+52>>2]=+o[a+12>>2];do if((k[a+52>>2]|0)!=0?((Wb[k[(k[c>>2]|0)+52>>2]&127](c)|0)&1|0)==0:0){d=nc[k[(k[c>>2]|0)+24>>2]&31](c,k[a+52>>2]|0)|0;if(!d){d=nc[k[(k[c>>2]|0)+28>>2]&31](c,k[a+52>>2]|0)|0;k[b+40>>2]=d;k[b+44>>2]=0;d=k[a+52>>2]|0;d=Wb[k[(k[d>>2]|0)+12>>2]&127](d)|0;d=dc[k[(k[c>>2]|0)+16>>2]&63](c,d,1)|0;f=k[a+52>>2]|0;f=dc[k[(k[f>>2]|0)+16>>2]&63](f,k[d+8>>2]|0,c)|0;Qb[k[(k[c>>2]|0)+20>>2]&31](c,d,f,1213612625,k[a+52>>2]|0);break}else{k[b+40>>2]=d;k[b+44>>2]=0;break}}else e=8;while(0);if((e|0)==8){k[b+40>>2]=0;k[b+44>>2]=0}if((k[a+56>>2]|0)!=0?((Wb[k[(k[c>>2]|0)+52>>2]&127](c)|0)&2|0)==0:0){d=nc[k[(k[c>>2]|0)+24>>2]&31](c,k[a+56>>2]|0)|0;if(!d){f=nc[k[(k[c>>2]|0)+28>>2]&31](c,k[a+56>>2]|0)|0;k[b+48>>2]=f;b=k[a+56>>2]|0;b=Wb[k[(k[b>>2]|0)+8>>2]&127](b)|0;b=dc[k[(k[c>>2]|0)+16>>2]&63](c,b,1)|0;f=k[a+56>>2]|0;f=dc[k[(k[f>>2]|0)+12>>2]&63](f,k[b+8>>2]|0,c)|0;Qb[k[(k[c>>2]|0)+20>>2]&31](c,b,f,1346456916,k[a+56>>2]|0);return 12240}else{k[b+48>>2]=d;return 12240}}k[b+48>>2]=0;return 12240}function tt(a,b){a=a|0;b=b|0;var c=0,d=0;c=k[a+52>>2]|0;if(!c)return;d=Wb[k[(k[c>>2]|0)+12>>2]&127](c)|0;d=dc[k[(k[b>>2]|0)+16>>2]&63](b,d,1)|0;c=k[a+52>>2]|0;c=dc[k[(k[c>>2]|0)+16>>2]&63](c,k[d+8>>2]|0,b)|0;Qb[k[(k[b>>2]|0)+20>>2]&31](b,d,c,1213612625,k[a+52>>2]|0);return}function ut(a,b){a=a|0;b=b|0;var c=0,d=0;c=k[a+56>>2]|0;if(!c)return;d=Wb[k[(k[c>>2]|0)+8>>2]&127](c)|0;d=dc[k[(k[b>>2]|0)+16>>2]&63](b,d,1)|0;c=k[a+56>>2]|0;c=dc[k[(k[c>>2]|0)+12>>2]&63](c,k[d+8>>2]|0,b)|0;Qb[k[(k[b>>2]|0)+20>>2]&31](b,d,c,1346456916,k[a+56>>2]|0);return}function vt(a,b){a=a|0;b=b|0;var c=0;c=r;r=r+48|0;k[a+8>>2]=0;o[a+12>>2]=0.0;k[a>>2]=12824;k[a+48>>2]=b;k[a+4>>2]=21;if(Wb[k[(k[b>>2]|0)+40>>2]&127](b)|0){yc[k[(k[b>>2]|0)+48>>2]&127](b,a+16|0,a+32|0);r=c;return}else{k[c+32>>2]=0;k[c+32+4>>2]=0;k[c+32+8>>2]=0;k[c+32+12>>2]=0;o[c+32>>2]=1.0;yc[k[(k[a>>2]|0)+68>>2]&127](c+16|0,a,c+32|0);o[a+32>>2]=+o[c+16>>2]+ +o[a+12>>2];o[c+32>>2]=-1.0;yc[k[(k[a>>2]|0)+68>>2]&127](c,a,c+32|0);k[c+16>>2]=k[c>>2];k[c+16+4>>2]=k[c+4>>2];k[c+16+8>>2]=k[c+8>>2];k[c+16+12>>2]=k[c+12>>2];o[a+16>>2]=+o[c+16>>2]-+o[a+12>>2];k[c+32>>2]=0;k[c+32+4>>2]=0;k[c+32+8>>2]=0;k[c+32+12>>2]=0;o[c+32+4>>2]=1.0;yc[k[(k[a>>2]|0)+68>>2]&127](c+16|0,a,c+32|0);o[a+36>>2]=+o[c+16+4>>2]+ +o[a+12>>2];o[c+32+4>>2]=-1.0;yc[k[(k[a>>2]|0)+68>>2]&127](c,a,c+32|0);k[c+16>>2]=k[c>>2];k[c+16+4>>2]=k[c+4>>2];k[c+16+8>>2]=k[c+8>>2];k[c+16+12>>2]=k[c+12>>2];o[a+20>>2]=+o[c+16+4>>2]-+o[a+12>>2];k[c+32>>2]=0;k[c+32+4>>2]=0;k[c+32+8>>2]=0;k[c+32+12>>2]=0;o[c+32+8>>2]=1.0;yc[k[(k[a>>2]|0)+68>>2]&127](c+16|0,a,c+32|0);o[a+40>>2]=+o[c+16+8>>2]+ +o[a+12>>2];o[c+32+8>>2]=-1.0;yc[k[(k[a>>2]|0)+68>>2]&127](c,a,c+32|0);k[c+16>>2]=k[c>>2];k[c+16+4>>2]=k[c+4>>2];k[c+16+8>>2]=k[c+8>>2];k[c+16+12>>2]=k[c+12>>2];o[a+24>>2]=+o[c+16+8>>2]-+o[a+12>>2];r=c;return}}function wt(a){a=a|0;return}function xt(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function yt(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0;n=(+o[a+32>>2]-+o[a+16>>2])*.5;j=(+o[a+36>>2]-+o[a+20>>2])*.5;g=(+o[a+40>>2]-+o[a+24>>2])*.5;m=+gc[k[(k[a>>2]|0)+48>>2]&15](a);i=+gc[k[(k[a>>2]|0)+48>>2]&15](a);g=g+ +gc[k[(k[a>>2]|0)+48>>2]&15](a);B=(+o[a+32>>2]+ +o[a+16>>2])*.5;z=(+o[a+36>>2]+ +o[a+20>>2])*.5;x=(+o[a+40>>2]+ +o[a+24>>2])*.5;F=+o[b>>2];w=+X(+F);E=+o[b+4>>2];v=+X(+E);t=+o[b+8>>2];u=+X(+t);D=+o[b+16>>2];s=+X(+D);C=+o[b+20>>2];r=+X(+C);p=+o[b+24>>2];q=+X(+p);A=+o[b+32>>2];l=+X(+A);y=+o[b+36>>2];h=+X(+y);e=+o[b+40>>2];f=+X(+e);t=B*F+z*E+x*t+ +o[b+48>>2];p=B*D+z*C+x*p+ +o[b+52>>2];e=B*A+z*y+x*e+ +o[b+56>>2];o[c>>2]=t-((n+m)*w+(j+i)*v+g*u);o[c+4>>2]=p-((n+m)*s+(j+i)*r+g*q);o[c+8>>2]=e-((n+m)*l+(j+i)*h+g*f);o[c+12>>2]=0.0;o[d>>2]=(n+m)*w+(j+i)*v+g*u+t;o[d+4>>2]=(n+m)*s+(j+i)*r+g*q+p;o[d+8>>2]=(n+m)*l+(j+i)*h+g*f+e;o[d+12>>2]=0.0;return}function zt(a,b){a=a|0;b=b|0;var c=0,d=0;c=r;r=r+48|0;d=(k[a+48>>2]|0)+4|0;k[d>>2]=k[b>>2];k[d+4>>2]=k[b+4>>2];k[d+8>>2]=k[b+8>>2];k[d+12>>2]=k[b+12>>2];k[c+32>>2]=0;k[c+32+4>>2]=0;k[c+32+8>>2]=0;k[c+32+12>>2]=0;o[c+32>>2]=1.0;yc[k[(k[a>>2]|0)+68>>2]&127](c+16|0,a,c+32|0);o[a+32>>2]=+o[c+16>>2]+ +o[a+12>>2];o[c+32>>2]=-1.0;yc[k[(k[a>>2]|0)+68>>2]&127](c,a,c+32|0);k[c+16>>2]=k[c>>2];k[c+16+4>>2]=k[c+4>>2];k[c+16+8>>2]=k[c+8>>2];k[c+16+12>>2]=k[c+12>>2];o[a+16>>2]=+o[c+16>>2]-+o[a+12>>2];k[c+32>>2]=0;k[c+32+4>>2]=0;k[c+32+8>>2]=0;k[c+32+12>>2]=0;o[c+32+4>>2]=1.0;yc[k[(k[a>>2]|0)+68>>2]&127](c+16|0,a,c+32|0);o[a+36>>2]=+o[c+16+4>>2]+ +o[a+12>>2];o[c+32+4>>2]=-1.0;yc[k[(k[a>>2]|0)+68>>2]&127](c,a,c+32|0);k[c+16>>2]=k[c>>2];k[c+16+4>>2]=k[c+4>>2];k[c+16+8>>2]=k[c+8>>2];k[c+16+12>>2]=k[c+12>>2];o[a+20>>2]=+o[c+16+4>>2]-+o[a+12>>2];k[c+32>>2]=0;k[c+32+4>>2]=0;k[c+32+8>>2]=0;k[c+32+12>>2]=0;o[c+32+8>>2]=1.0;yc[k[(k[a>>2]|0)+68>>2]&127](c+16|0,a,c+32|0);o[a+40>>2]=+o[c+16+8>>2]+ +o[a+12>>2];o[c+32+8>>2]=-1.0;yc[k[(k[a>>2]|0)+68>>2]&127](c,a,c+32|0);k[c+16>>2]=k[c>>2];k[c+16+4>>2]=k[c+4>>2];k[c+16+8>>2]=k[c+8>>2];k[c+16+12>>2]=k[c+12>>2];o[a+24>>2]=+o[c+16+8>>2]-+o[a+12>>2];r=c;return}function At(a){a=a|0;return (k[a+48>>2]|0)+4|0}function Bt(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;e=r;r=r+48|0;k[e>>2]=13032;k[e+4>>2]=b;k[e+8>>2]=k[c>>2];k[e+8+4>>2]=k[c+4>>2];k[e+8+8>>2]=k[c+8>>2];k[e+8+12>>2]=k[c+12>>2];k[e+24>>2]=k[d>>2];k[e+24+4>>2]=k[d+4>>2];k[e+24+8>>2]=k[d+8>>2];k[e+24+12>>2]=k[d+12>>2];a=k[a+48>>2]|0;Cc[k[(k[a>>2]|0)+8>>2]&127](a,e,c,d);r=e;return}function Ct(a,b,c){a=a|0;b=+b;c=c|0;k[c>>2]=0;k[c+4>>2]=0;k[c+8>>2]=0;k[c+12>>2]=0;return}function Dt(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0;d=r;r=r+176|0;k[d+160>>2]=0;k[d+160+4>>2]=0;k[d+160+8>>2]=0;k[d+160+12>>2]=0;k[d+136>>2]=0;k[d+136+4>>2]=0;k[d+136+8>>2]=0;k[d+136+12>>2]=0;k[d+136+16>>2]=0;k[d+32>>2]=12968;k[d+32+4>>2]=0;k[d+32+4+4>>2]=0;k[d+32+4+8>>2]=0;k[d+32+4+12>>2]=0;o[d+32+20>>2]=1.0;k[d+32+24>>2]=k[d+160>>2];k[d+32+24+4>>2]=k[d+160+4>>2];k[d+32+24+8>>2]=k[d+160+8>>2];k[d+32+36>>2]=0;o[d+32+40>>2]=1.0;k[d+32+44>>2]=0;k[d+32+44+4>>2]=0;k[d+32+44+8>>2]=0;k[d+32+44+12>>2]=0;o[d+32+60>>2]=1.0;o[d+32+64>>2]=0.0;k[d+32+68>>2]=k[d+136+4>>2];k[d+32+68+4>>2]=k[d+136+4+4>>2];k[d+32+68+8>>2]=k[d+136+4+8>>2];k[d+32+68+12>>2]=k[d+136+4+12>>2];o[d+32+84>>2]=-999999984306749440.0;i=+o[c>>2];h=+o[c+4>>2];g=+o[c+8>>2];f=i*+o[d+32+24>>2]+h+g*0.0;e=i*+o[d+32+28>>2]+h*0.0+g;o[d+32+88>>2]=i+h*0.0+g*0.0;o[d+32+92>>2]=f;o[d+32+96>>2]=e;o[d+32+100>>2]=0.0;o[d+16>>2]=999999984306749440.0;o[d+16+4>>2]=999999984306749440.0;o[d+16+8>>2]=999999984306749440.0;o[d+16+12>>2]=0.0;c=k[(k[b>>2]|0)+64>>2]|0;o[d>>2]=-999999984306749440.0;o[d+4>>2]=-999999984306749440.0;o[d+8>>2]=-999999984306749440.0;o[d+12>>2]=0.0;Cc[c&127](b,d+32|0,d,d+16|0);k[a>>2]=k[d+32+4>>2];k[a+4>>2]=k[d+32+4+4>>2];k[a+8>>2]=k[d+32+4+8>>2];k[a+12>>2]=k[d+32+4+12>>2];r=d;return}function Et(a){a=a|0;return}function Ft(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function Gt(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;o[c>>2]=-999999984306749440.0;o[c+4>>2]=-999999984306749440.0;o[c+8>>2]=-999999984306749440.0;o[c+12>>2]=0.0;o[d>>2]=999999984306749440.0;o[d+4>>2]=999999984306749440.0;o[d+8>>2]=999999984306749440.0;o[d+12>>2]=0.0;return}function Ht(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0,y=0.0;x=r;r=r+48|0;t=+o[d>>2];u=+o[c>>2];v=+o[d+4>>2];w=+o[c+4>>2];s=+o[d+8>>2];f=+o[c+8>>2];g=+Y(+((t-u)*.5*((t-u)*.5)+(v-w)*.5*((v-w)*.5)+(s-f)*.5*((s-f)*.5)));h=+o[a+56>>2];c=+X(+h)>.7071067690849304;i=+o[a+52>>2];if(c){q=1.0/+Y(+(h*h+i*i));y=+o[a+48>>2];e=y*-(h*q);j=y;l=0.0;m=-(h*q);n=i*q;p=(h*h+i*i)*q;q=-(y*(i*q))}else{p=+o[a+48>>2];q=1.0/+Y(+(p*p+i*i));e=(p*p+i*i)*q;j=p;l=-(i*q);m=p*q;n=0.0;p=-(h*(p*q));q=h*-(i*q)}y=(t+u)*.5*j+(v+w)*.5*i+(s+f)*.5*h-+o[a+64>>2];j=(t+u)*.5-j*y;l=g*l;m=g*m;u=g*n;p=g*p;q=g*q;t=g*e;o[x>>2]=p+(l+j);o[x+4>>2]=q+(m+((v+w)*.5-i*y));o[x+8>>2]=t+(u+((s+f)*.5-h*y));o[x+12>>2]=0.0;o[x+16>>2]=l+j-p;o[x+20>>2]=m+((v+w)*.5-i*y)-q;o[x+24>>2]=u+((s+f)*.5-h*y)-t;o[x+28>>2]=0.0;o[x+32>>2]=j-l-p;o[x+36>>2]=(v+w)*.5-i*y-m-q;o[x+40>>2]=(s+f)*.5-h*y-u-t;o[x+44>>2]=0.0;Cc[k[(k[b>>2]|0)+8>>2]&127](b,x,0,0);o[x>>2]=j-l-p;o[x+4>>2]=(v+w)*.5-i*y-m-q;o[x+8>>2]=(s+f)*.5-h*y-u-t;o[x+12>>2]=0.0;o[x+16>>2]=p+(j-l);o[x+20>>2]=q+((v+w)*.5-i*y-m);o[x+24>>2]=t+((s+f)*.5-h*y-u);o[x+28>>2]=0.0;o[x+32>>2]=p+(l+j);o[x+36>>2]=q+(m+((v+w)*.5-i*y));o[x+40>>2]=t+(u+((s+f)*.5-h*y));o[x+44>>2]=0.0;Cc[k[(k[b>>2]|0)+8>>2]&127](b,x,0,1);r=x;return}function It(a,b,c){a=a|0;b=+b;c=c|0;k[c>>2]=0;k[c+4>>2]=0;k[c+8>>2]=0;k[c+12>>2]=0;return}function Jt(a,b){a=a|0;b=b|0;k[a+68>>2]=k[b>>2];k[a+68+4>>2]=k[b+4>>2];k[a+68+8>>2]=k[b+8>>2];k[a+68+12>>2]=k[b+12>>2];return}function Kt(a){a=a|0;return a+68|0}function Lt(a){a=a|0;var b=0,c=0;k[a>>2]=13336;b=k[a+52>>2]|0;if((b|0)!=0?(Sb[k[k[b>>2]>>2]&255](b),c=k[a+52>>2]|0,(c|0)!=0):0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function Mt(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0,l=0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0,x=0,y=0,z=0,A=0,B=0,C=0.0,D=0.0,E=0,F=0,G=0.0,H=0.0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0,Q=0.0,R=0,S=0,T=0,U=0,V=0,W=0,Z=0,_=0,$=0,aa=0,ba=0,ca=0,da=0,ea=0,fa=0,ga=0.0,ha=0.0;fa=r;r=r+352|0;c=k[a+52>>2]|0;if((c|0)!=0?(Sb[k[k[c>>2]>>2]&255](c),d=k[a+52>>2]|0,(d|0)!=0):0){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}k[5108]=(k[5108]|0)+1;c=iF(151)|0;if(!c)c=0;else{k[(c+4+15&-16)+-4>>2]=c;c=c+4+15&-16}k[c>>2]=19992;i[c+20>>0]=1;k[c+16>>2]=0;k[c+8>>2]=0;k[c+12>>2]=0;i[c+40>>0]=1;k[c+36>>2]=0;k[c+28>>2]=0;k[c+32>>2]=0;i[c+60>>0]=1;k[c+56>>2]=0;k[c+48>>2]=0;k[c+52>>2]=0;k[a+52>>2]=c;d=0;M=0;ea=0;e=0;while(1){if((d|0)>=(Wb[k[(k[a>>2]|0)+96>>2]&127](a)|0))break;do if((M|0)==(e|0)){l=(e|0)==0?1:e<<1;if((e|0)<(l|0)){if((l|0)!=0?(k[5108]=(k[5108]|0)+1,w=iF((l<<4|3)+16|0)|0,(w|0)!=0):0){k[(w+4+15&-16)+-4>>2]=w;h=w+4+15&-16}else h=0;if((e|0)<=0){if(!ea){g=e;break}}else{g=e+-1|0;f=0;while(1){$=h+(f<<4)|0;_=ea+(f<<4)|0;k[$>>2]=k[_>>2];k[$+4>>2]=k[_+4>>2];k[$+8>>2]=k[_+8>>2];k[$+12>>2]=k[_+12>>2];if((f|0)==(g|0))break;else f=f+1|0}}k[5110]=(k[5110]|0)+1;jF(k[ea+-4>>2]|0);g=e}else{g=e;h=ea;l=e}}else{g=M;h=ea;l=e}while(0);ea=h+(M<<4)|0;k[ea>>2]=k[fa+48>>2];k[ea+4>>2]=k[fa+48+4>>2];k[ea+8>>2]=k[fa+48+8>>2];k[ea+12>>2]=k[fa+48+12>>2];yc[k[(k[a>>2]|0)+108>>2]&127](a,d,ea);d=d+1|0;M=g+1|0;ea=h;e=l}i[fa+100+16>>0]=1;da=fa+100+12|0;k[da>>2]=0;k[fa+100+4>>2]=0;k[fa+100+8>>2]=0;i[fa+100+36>>0]=1;ca=fa+100+32|0;k[ca>>2]=0;k[fa+100+24>>2]=0;k[fa+100+28>>2]=0;i[fa+100+56>>0]=1;ba=fa+100+52|0;k[ba>>2]=0;k[fa+100+44>>2]=0;k[fa+100+48>>2]=0;if(b){if((M|0)>0){c=M+-1|0;K=0;h=0;l=0;f=0;while(1){L=K;K=K+1|0;if((K|0)<(M|0)){J=ea+(L<<4)|0;F=ea+(L<<4)+4|0;d=ea+(L<<4)+8|0;E=K;do{e=E;E=E+1|0;a:do if((E|0)<(M|0)){x=ea+(e<<4)|0;g=ea+(e<<4)+4|0;w=ea+(e<<4)+8|0;I=E;while(1){p=+o[J>>2];C=+o[x>>2]-p;n=+o[F>>2];s=+o[g>>2]-n;H=+o[d>>2];q=+o[w>>2]-H;p=+o[ea+(I<<4)>>2]-p;n=+o[ea+(I<<4)+4>>2]-n;H=+o[ea+(I<<4)+8>>2]-H;G=1.0;b=0;while(1){D=(s*H-q*n)*G;t=(q*p-C*H)*G;v=(C*n-s*p)*G;b:do if(v*v+(D*D+t*t)>9.999999747378752e-05){u=1.0/+Y(+(v*v+(D*D+t*t)));if((h|0)>0){B=0;do{if(D*u*+o[f+(B<<4)>>2]+t*u*+o[f+(B<<4)+4>>2]+v*u*+o[f+(B<<4)+8>>2]>.9990000128746033)break b;B=B+1|0}while((B|0)<(h|0))}G=D*u*+o[J>>2]+t*u*+o[F>>2]+v*u*+o[d>>2];B=0;do{if(D*u*+o[ea+(B<<4)>>2]+t*u*+o[ea+(B<<4)+4>>2]+v*u*+o[ea+(B<<4)+8>>2]-G+-.009999999776482582>0.0)break b;B=B+1|0}while((B|0)<(M|0));do if((h|0)==(l|0)){z=(l|0)==0?1:l<<1;if((l|0)<(z|0)){do if(!z)y=0;else{k[5108]=(k[5108]|0)+1;B=iF((z<<4|3)+16|0)|0;if(!B){y=0;break}k[(B+4+15&-16)+-4>>2]=B;y=B+4+15&-16}while(0);if((l|0)<=0){if(!f){B=l;l=z;f=y;break}}else{B=l+-1|0;A=0;while(1){$=y+(A<<4)|0;_=f+(A<<4)|0;k[$>>2]=k[_>>2];k[$+4>>2]=k[_+4>>2];k[$+8>>2]=k[_+8>>2];k[$+12>>2]=k[_+12>>2];if((A|0)==(B|0))break;else A=A+1|0}}k[5110]=(k[5110]|0)+1;jF(k[f+-4>>2]|0);B=l;l=z;f=y}else B=l}else B=h;while(0);o[f+(B<<4)>>2]=D*u;o[f+(B<<4)+4>>2]=t*u;o[f+(B<<4)+8>>2]=v*u;o[f+(B<<4)+12>>2]=-G;h=h+1|0}while(0);b=b+1|0;if((b|0)==2)break;else G=-1.0}if((I|0)==(c|0))break a;I=I+1|0}}while(0)}while((e|0)!=(c|0))}if((L|0)==(c|0)){x=h;break}}if((x|0)>0){w=0;d=0;c=0;while(1){$=f+(w<<4)|0;k[fa+20>>2]=k[$>>2];k[fa+20+4>>2]=k[$+4>>2];k[fa+20+8>>2]=k[$+8>>2];v=+o[f+(w<<4)+12>>2];v=v-+gc[k[(k[a>>2]|0)+48>>2]&15](a);do if((w|0)==(d|0)){e=(d|0)==0?1:d<<1;if((d|0)<(e|0)){if((e|0)!=0?(k[5108]=(k[5108]|0)+1,N=iF((e<<4|3)+16|0)|0,(N|0)!=0):0){k[(N+4+15&-16)+-4>>2]=N;g=N+4+15&-16}else g=0;if((d|0)<=0){if(!c){h=d;l=e;break}}else{l=d+-1|0;h=0;while(1){$=g+(h<<4)|0;_=c+(h<<4)|0;k[$>>2]=k[_>>2];k[$+4>>2]=k[_+4>>2];k[$+8>>2]=k[_+8>>2];k[$+12>>2]=k[_+12>>2];if((h|0)==(l|0))break;else h=h+1|0}}k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);h=d;l=e}else{h=d;l=d;g=c}}else{h=w;l=d;g=c}while(0);$=g+(h<<4)|0;k[$>>2]=k[fa+20>>2];k[$+4>>2]=k[fa+20+4>>2];k[$+8>>2]=k[fa+20+8>>2];o[g+(h<<4)+12>>2]=v;w=w+1|0;if((w|0)<(x|0)){d=l;c=g}else break}if((w|0)>0){d=0;h=0;l=0;e=0;do{E=d;d=d+1|0;if((d|0)<(w|0)){F=d;do{y=F;F=F+1|0;c:do if((F|0)<(w|0)){z=F;A=l;while(1){s=+o[g+(y<<4)+4>>2];v=+o[g+(z<<4)+8>>2];u=+o[g+(y<<4)+8>>2];q=+o[g+(z<<4)+4>>2];p=+o[g+(z<<4)>>2];n=+o[g+(y<<4)>>2];t=+o[g+(E<<4)+8>>2];C=+o[g+(E<<4)+4>>2];D=+o[g+(E<<4)>>2];d:do if((((q*n-s*p)*(q*n-s*p)+((s*v-u*q)*(s*v-u*q)+(u*p-v*n)*(u*p-v*n))>9.999999747378752e-05?(p*C-q*D)*(p*C-q*D)+((q*t-v*C)*(q*t-v*C)+(v*D-p*t)*(v*D-p*t))>9.999999747378752e-05:0)?(s*D-n*C)*(s*D-n*C)+((u*C-s*t)*(u*C-s*t)+(n*t-u*D)*(n*t-u*D))>9.999999747378752e-05:0)?(Q=t*(q*n-s*p)+(C*(u*p-v*n)+(s*v-u*q)*D),+X(+Q)>9.999999974752427e-07):0){ga=+o[g+(E<<4)+12>>2];H=+o[g+(y<<4)+12>>2];ha=+o[g+(z<<4)+12>>2];G=-1.0/Q*((u*C-s*t)*ha+((s*v-u*q)*ga+(q*t-v*C)*H));u=-1.0/Q*((n*t-u*D)*ha+((u*p-v*n)*ga+(v*D-p*t)*H));v=-1.0/Q*((s*D-n*C)*ha+((q*n-s*p)*ga+(p*C-q*D)*H));l=0;do{if(+o[g+(l<<4)+12>>2]+(G*+o[g+(l<<4)>>2]+u*+o[g+(l<<4)+4>>2]+v*+o[g+(l<<4)+8>>2])+-.009999999776482582>0.0){l=A;break d}l=l+1|0}while((l|0)<(w|0));do if((h|0)==(e|0)){B=(e|0)==0?1:e<<1;if((e|0)>=(B|0)){b=e;l=A;break}do if(!B)l=0;else{k[5108]=(k[5108]|0)+1;l=iF((B<<4|3)+16|0)|0;if(!l){l=0;break}k[(l+4+15&-16)+-4>>2]=l;l=l+4+15&-16}while(0);if((e|0)<=0){if(!A){b=e;e=B;break}}else{b=e+-1|0;x=0;while(1){$=l+(x<<4)|0;_=A+(x<<4)|0;k[$>>2]=k[_>>2];k[$+4>>2]=k[_+4>>2];k[$+8>>2]=k[_+8>>2];k[$+12>>2]=k[_+12>>2];if((x|0)==(b|0))break;else x=x+1|0}}k[5110]=(k[5110]|0)+1;jF(k[A+-4>>2]|0);b=e;e=B}else{b=h;l=A}while(0);o[l+(b<<4)>>2]=G;o[l+(b<<4)+4>>2]=u;o[l+(b<<4)+8>>2]=v;o[l+(b<<4)+12>>2]=0.0;h=h+1|0}else l=A;while(0);if((z|0)==(w+-1|0))break c;z=z+1|0;A=l}}while(0)}while((y|0)!=(w+-1|0))}}while((E|0)!=(w+-1|0))}else{h=0;l=0}}else{g=0;h=0;l=0}}else{f=0;g=0;h=0;l=0}Iw(fa+100|0,l,h);if(l){k[5110]=(k[5110]|0)+1;jF(k[l+-4>>2]|0)}if(g){k[5110]=(k[5110]|0)+1;jF(k[g+-4>>2]|0)}if(f){k[5110]=(k[5110]|0)+1;jF(k[f+-4>>2]|0)}}else Iw(fa+100|0,ea,M);L=k[fa+100+44>>2]|0;if((L|0)>0){k[5108]=(k[5108]|0)+1;c=iF((L<<4|3)+16|0)|0;if(!c)g=0;else{k[(c+4+15&-16)+-4>>2]=c;g=c+4+15&-16}h=0;while(1){$=g+(h<<4)|0;k[$>>2]=k[fa+32>>2];k[$+4>>2]=k[fa+32+4>>2];k[$+8>>2]=k[fa+32+8>>2];k[$+12>>2]=k[fa+32+12>>2];if((h|0)==(L+-1|0)){$=g;break}else h=h+1|0}}else $=0;i[fa+320+16>>0]=1;Z=fa+320+12|0;k[Z>>2]=0;_=fa+320+4|0;k[_>>2]=0;k[fa+320+8>>2]=0;l=fa+176|0;h=l+36|0;do{k[l>>2]=0;l=l+4|0}while((l|0)<(h|0));i[fa+176+16>>0]=1;k[fa+176+12>>2]=0;k[fa+176+4>>2]=0;k[fa+176+8>>2]=0;if((L|0)<0)Nb();if((L|0)>0){fx(fa+320|0,L);l=k[Z>>2]|0;g=0;while(1){h=l+(g*36|0)|0;if(h)gx(h,fa+176|0);if((g|0)==(L+-1|0))break;else g=g+1|0}}k[_>>2]=L;i[fa+176+16>>0]=1;k[fa+176+12>>2]=0;k[fa+176+4>>2]=0;k[fa+176+8>>2]=0;x=k[fa+100+4>>2]|0;w=k[a+52>>2]|0;f=k[w+8>>2]|0;if((f|0)<(x|0)){if((k[w+12>>2]|0)<(x|0)){if(!x){l=0;h=f}else{k[5108]=(k[5108]|0)+1;l=iF((x<<4|3)+16|0)|0;if(!l)l=0;else{k[(l+4+15&-16)+-4>>2]=l;l=l+4+15&-16}h=k[w+8>>2]|0}if((h|0)>0){h=h+-1|0;g=0;while(1){S=l+(g<<4)|0;R=(k[w+16>>2]|0)+(g<<4)|0;k[S>>2]=k[R>>2];k[S+4>>2]=k[R+4>>2];k[S+8>>2]=k[R+8>>2];k[S+12>>2]=k[R+12>>2];if((g|0)==(h|0))break;else g=g+1|0}}h=k[w+16>>2]|0;if(h){if(i[w+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[h+-4>>2]|0)}k[w+16>>2]=0}i[w+20>>0]=1;k[w+16>>2]=l;k[w+12>>2]=x;h=w+16|0}else h=w+16|0;l=f;while(1){S=(k[h>>2]|0)+(l<<4)|0;k[S>>2]=k[fa+216>>2];k[S+4>>2]=k[fa+216+4>>2];k[S+8>>2]=k[fa+216+8>>2];k[S+12>>2]=k[fa+216+12>>2];if((l|0)==(x+-1|0))break;else l=l+1|0}}k[w+8>>2]=x;if((x|0)>0){l=k[da>>2]|0;h=0;while(1){S=(k[(k[a+52>>2]|0)+16>>2]|0)+(h<<4)|0;R=l+(h<<4)|0;k[S>>2]=k[R>>2];k[S+4>>2]=k[R+4>>2];k[S+8>>2]=k[R+8>>2];k[S+12>>2]=k[R+12>>2];if((h|0)==(x+-1|0))break;else h=h+1|0}}if((L|0)>0){F=0;while(1){f=(k[ca>>2]|0)+((k[(k[ba>>2]|0)+(F<<2)>>2]|0)*12|0)|0;d=f;h=0;do{e=d+4|0;w=k[d+((k[e>>2]|0)*12|0)+8>>2]|0;y=k[Z>>2]|0;b=y+(F*36|0)+4|0;l=k[b>>2]|0;A=y+(F*36|0)+8|0;if((l|0)==(k[A>>2]|0)?(U=(l|0)==0?1:l<<1,(l|0)<(U|0)):0){if(!U)B=0;else{k[5108]=(k[5108]|0)+1;l=iF((U<<2|3)+16|0)|0;if(!l)l=0;else{k[(l+4+15&-16)+-4>>2]=l;l=l+4+15&-16}B=l;l=k[b>>2]|0}z=y+(F*36|0)+12|0;if((l|0)>0){l=l+-1|0;g=0;while(1){x=B+(g<<2)|0;if(x)k[x>>2]=k[(k[z>>2]|0)+(g<<2)>>2];if((g|0)==(l|0))break;else g=g+1|0}}g=k[z>>2]|0;l=y+(F*36|0)+16|0;if(g){if(i[l>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[g+-4>>2]|0)}k[z>>2]=0}i[l>>0]=1;k[z>>2]=B;k[A>>2]=U;l=k[b>>2]|0}g=(k[y+(F*36|0)+12>>2]|0)+(l<<2)|0;if(g){k[g>>2]=w;l=k[b>>2]|0}k[b>>2]=l+1;R=k[d+8>>2]|0;S=k[da>>2]|0;q=+o[S+(R<<4)>>2]-+o[S+(w<<4)>>2];p=+o[S+(R<<4)+4>>2]-+o[S+(w<<4)+4>>2];t=+o[S+(R<<4)+8>>2]-+o[S+(w<<4)+8>>2];s=1.0/+Y(+(q*q+p*p+t*t));if((h|0)<2){o[fa+272+(h<<4)>>2]=q*s;o[fa+272+(h<<4)+4>>2]=p*s;o[fa+272+(h<<4)+8>>2]=t*s;o[fa+272+(h<<4)+12>>2]=0.0;h=h+1|0}S=k[e>>2]|0;d=d+(((k[d+(S*12|0)>>2]|0)+S|0)*12|0)|0}while((d|0)!=(f|0));l=$+(F<<4)|0;if((h|0)==2){Q=+o[fa+272+4>>2];v=+o[fa+272+24>>2];G=+o[fa+272+8>>2];H=+o[fa+272+20>>2];u=+o[fa+272+16>>2];D=+o[fa+272>>2];R=$+(F<<4)+4|0;S=$+(F<<4)+8|0;o[$+(F<<4)+12>>2]=0.0;ga=1.0/+Y(+((Q*v-G*H)*(Q*v-G*H)+(G*u-v*D)*(G*u-v*D)+(H*D-Q*u)*(H*D-Q*u)));o[l>>2]=(Q*v-G*H)*ga;o[R>>2]=(G*u-v*D)*ga;o[S>>2]=(H*D-Q*u)*ga;f=k[Z>>2]|0;o[f+(F*36|0)+20>>2]=(Q*v-G*H)*ga;o[f+(F*36|0)+24>>2]=+o[R>>2];o[f+(F*36|0)+28>>2]=+o[S>>2];o[f+(F*36|0)+32>>2]=1000000015047466219876688.0e6}else{k[l>>2]=0;k[l+4>>2]=0;k[l+8>>2]=0;k[l+12>>2]=0;f=k[Z>>2]|0}g=k[f+(F*36|0)+4>>2]|0;if((g|0)>0){w=k[(k[a+52>>2]|0)+16>>2]|0;v=+o[l>>2];u=+o[$+(F<<4)+4>>2];t=+o[$+(F<<4)+8>>2];l=k[f+(F*36|0)+12>>2]|0;n=1000000015047466219876688.0e6;h=0;while(1){S=k[l+(h<<2)>>2]|0;ga=+o[w+(S<<4)>>2]*v+ +o[w+(S<<4)+4>>2]*u+ +o[w+(S<<4)+8>>2]*t;n=n>ga?ga:n;if((h|0)==(g+-1|0))break;else h=h+1|0}}else n=1000000015047466219876688.0e6;o[f+(F*36|0)+32>>2]=-n;if((F|0)==(L+-1|0))break;else F=F+1|0}}if((k[_>>2]|0)>0){l=0;d=0;w=0;while(1){if((w|0)==(l|0)){l=(w|0)==0?1:w<<1;if((w|0)<(l|0)){if((l|0)!=0?(k[5108]=(k[5108]|0)+1,T=iF((l<<2|3)+16|0)|0,(T|0)!=0):0){k[(T+4+15&-16)+-4>>2]=T;e=T+4+15&-16}else e=0;if((w|0)>0){h=w+-1|0;f=0;while(1){g=e+(f<<2)|0;if(g)k[g>>2]=k[d+(f<<2)>>2];if((f|0)==(h|0))break;else f=f+1|0}}if(d){k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0)}}else{l=w;e=d}}else e=d;h=e+(w<<2)|0;if(h)k[h>>2]=w;w=w+1|0;if((w|0)>=(k[_>>2]|0))break;else d=e}if(w){S=fa+232+16|0;R=fa+232+12|0;P=fa+232+4|0;l=w;while(1){f=l+-1|0;g=k[e+(f<<2)>>2]|0;k[5108]=(k[5108]|0)+1;l=iF(23)|0;if(l){k[(l+4+15&-16)+-4>>2]=l;h=l+4+15&-16;if(l+4+15&-16)k[h>>2]=g}else h=0;l=k[Z>>2]|0;G=+o[l+(g*36|0)+20>>2];v=+o[l+(g*36|0)+24>>2];H=+o[l+(g*36|0)+28>>2];l=f;w=1;b=1;g=f;e:while(1){if((l|0)>0){f=w;A=b}else{W=205;break}f:while(1){x=k[Z>>2]|0;do{U=g;g=g+-1|0;if((U|0)<=0){T=h;U=A;h=x;break e}B=k[e+(g<<2)>>2]|0}while(!(G*+o[x+(B*36|0)+20>>2]+v*+o[x+(B*36|0)+24>>2]+H*+o[x+(B*36|0)+28>>2]>.9990000128746033));do if((A|0)==(f|0)?(O=(f|0)==0?1:f<<1,(f|0)<(O|0)):0){do if(!O)b=0;else{k[5108]=(k[5108]|0)+1;w=iF((O<<2|3)+16|0)|0;if(!w){b=0;break}k[(w+4+15&-16)+-4>>2]=w;b=w+4+15&-16}while(0);if((f|0)>0){w=f+-1|0;d=0;while(1){f=b+(d<<2)|0;if(f)k[f>>2]=k[h+(d<<2)>>2];if((d|0)==(w|0))break;else d=d+1|0}}if(!h){z=O;h=b;break}k[5110]=(k[5110]|0)+1;jF(k[h+-4>>2]|0);z=O;h=b}else z=f;while(0);w=h+(A<<2)|0;if(w)k[w>>2]=B;A=A+1|0;w=0;while(1){f=e+(w<<2)|0;if((k[f>>2]|0)==(B|0))break;w=w+1|0;if((w|0)>=(l|0)){f=z;continue f}}if((w|0)<(l|0))break;else f=z}w=l+-1|0;b=e+(w<<2)|0;k[f>>2]=k[b>>2];k[b>>2]=B;l=w;w=z;b=A}g:do if((W|0)==205)while(1){W=0;x=k[Z>>2]|0;A=g;do{U=A;A=A+-1|0;if((U|0)<=0){T=h;U=b;h=x;break g}B=k[e+(A<<2)>>2]|0}while(!(G*+o[x+(B*36|0)+20>>2]+v*+o[x+(B*36|0)+24>>2]+H*+o[x+(B*36|0)+28>>2]>.9990000128746033));do if((b|0)==(w|0)?(V=(w|0)==0?1:w<<1,(w|0)<(V|0)):0){do if(!V)x=0;else{k[5108]=(k[5108]|0)+1;g=iF((V<<2|3)+16|0)|0;if(!g){x=0;break}k[(g+4+15&-16)+-4>>2]=g;x=g+4+15&-16}while(0);if((w|0)>0){g=w+-1|0;f=0;while(1){w=x+(f<<2)|0;if(w)k[w>>2]=k[h+(f<<2)>>2];if((f|0)==(g|0))break;else f=f+1|0}}if(!h){w=V;h=x;break}k[5110]=(k[5110]|0)+1;jF(k[h+-4>>2]|0);w=V;h=x}while(0);g=h+(b<<2)|0;if(g)k[g>>2]=B;b=b+1|0;g=A;W=205}while(0);do if((U|0)<=1)if((U|0)>0){d=h;W=347}else W=357;else{i[S>>0]=1;k[R>>2]=0;k[P>>2]=0;k[fa+232+8>>2]=0;d=U+-1|0;x=0;G=0.0;v=0.0;u=0.0;F=0;while(1){g=k[T+(F<<2)>>2]|0;G=+o[h+(g*36|0)+20>>2]+G;v=+o[h+(g*36|0)+24>>2]+v;u=+o[h+(g*36|0)+28>>2]+u;f=h+(g*36|0)+4|0;if((k[f>>2]|0)>0){w=h+(g*36|0)+12|0;h=x;g=0;while(1){y=k[(k[w>>2]|0)+(g<<2)>>2]|0;N=(k[(k[a+52>>2]|0)+16>>2]|0)+(y<<4)|0;k[fa+256>>2]=k[N>>2];k[fa+256+4>>2]=k[N+4>>2];k[fa+256+8>>2]=k[N+8>>2];k[fa+256+12>>2]=k[N+12>>2];h:do if((h|0)>0){b=k[R>>2]|0;x=0;while(1){if((k[b+(x*24|0)+20>>2]|0)==(y|0))break h;x=x+1|0;if((x|0)>=(h|0)){W=232;break}}}else W=232;while(0);if((W|0)==232){W=0;k[fa>>2]=k[fa+256>>2];k[fa+4>>2]=k[fa+256+4>>2];k[fa+8>>2]=k[fa+256+8>>2];k[fa+12>>2]=k[fa+256+12>>2];do if((h|0)==(k[fa+232+8>>2]|0)){z=(h|0)==0?1:h<<1;if((h|0)>=(z|0))break;if(!z)b=0;else{k[5108]=(k[5108]|0)+1;b=iF((z*24|3)+16|0)|0;if(!b)b=0;else{k[(b+4+15&-16)+-4>>2]=b;b=b+4+15&-16}h=k[P>>2]|0}if((h|0)<=0){x=k[R>>2]|0;if(x)W=242}else{B=h+-1|0;x=k[R>>2]|0;A=0;while(1){W=b+(A*24|0)|0;N=x+(A*24|0)|0;k[W>>2]=k[N>>2];k[W+4>>2]=k[N+4>>2];k[W+8>>2]=k[N+8>>2];k[W+12>>2]=k[N+12>>2];k[W+16>>2]=k[N+16>>2];k[W+20>>2]=k[N+20>>2];if((A|0)==(B|0)){W=242;break}else A=A+1|0}}if((W|0)==242){W=0;if(i[S>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[x+-4>>2]|0);h=k[P>>2]|0}k[R>>2]=0}i[S>>0]=1;k[R>>2]=b;k[fa+232+8>>2]=z}while(0);N=k[R>>2]|0;M=N+(h*24|0)|0;k[M>>2]=k[fa>>2];k[M+4>>2]=k[fa+4>>2];k[M+8>>2]=k[fa+8>>2];k[M+12>>2]=k[fa+12>>2];k[M+16>>2]=k[fa+16>>2];k[N+(h*24|0)+20>>2]=y;h=(k[P>>2]|0)+1|0;k[P>>2]=h}g=g+1|0;if((g|0)>=(k[f>>2]|0)){x=h;break}}}h=k[Z>>2]|0;if((F|0)==(d|0))break;else F=F+1|0}i[fa+64+16>>0]=1;k[fa+64+12>>2]=0;k[fa+64+4>>2]=0;k[fa+64+8>>2]=0;N=h+20+((k[T>>2]|0)*9<<2)|0;k[fa+64+20>>2]=k[N>>2];k[fa+64+20+4>>2]=k[N+4>>2];k[fa+64+20+8>>2]=k[N+8>>2];k[fa+64+20+12>>2]=k[N+12>>2];H=1.0/+Y(+(G*G+v*v+u*u));D=G*H;G=v*H;H=u*H;if(+X(+H)>.7071067690849304){s=1.0/+Y(+(H*H+G*G));u=0.0;t=-(H*s);s=G*s}else{t=1.0/+Y(+(D*D+G*G));u=-(G*t);t=D*t;s=0.0}do if((x|0)<2){if((x|0)>0){g=0;f=0;B=0}else{w=0;d=0;W=331;break}while(1){A=k[R>>2]|0;do if((g|0)==(f|0)){w=(f|0)==0?1:f<<1;if((f|0)>=(w|0)){b=f;h=B;break}do if(!w)h=0;else{k[5108]=(k[5108]|0)+1;h=iF((w*24|3)+16|0)|0;if(!h){h=0;f=g;break}k[(h+4+15&-16)+-4>>2]=h;h=h+4+15&-16;f=g}while(0);if((f|0)<=0){if(B)W=265}else{f=f+-1|0;d=0;while(1){W=h+(d*24|0)|0;N=B+(d*24|0)|0;k[W>>2]=k[N>>2];k[W+4>>2]=k[N+4>>2];k[W+8>>2]=k[N+8>>2];k[W+12>>2]=k[N+12>>2];k[W+16>>2]=k[N+16>>2];k[W+20>>2]=k[N+20>>2];if((d|0)==(f|0)){W=265;break}else d=d+1|0}}if((W|0)==265){W=0;k[5110]=(k[5110]|0)+1;jF(k[B+-4>>2]|0)}b=g;x=k[P>>2]|0;f=w}else{b=g;h=B}while(0);N=h+(b*24|0)|0;k[N>>2]=k[A>>2];k[N+4>>2]=k[A+4>>2];k[N+8>>2]=k[A+8>>2];k[N+12>>2]=k[A+12>>2];k[N+16>>2]=k[A+16>>2];k[N+20>>2]=k[A+20>>2];g=g+1|0;if((g|0)<(x|0))B=h;else{f=x;W=296;break}}}else{z=k[R>>2]|0;h=x;g=0;do{if(u*+o[z+(g*24|0)>>2]+t*+o[z+(g*24|0)+4>>2]+s*+o[z+(g*24|0)+8>>2]<u*+o[z>>2]+t*+o[z+4>>2]+s*+o[z+8>>2]){k[fa+272>>2]=k[z>>2];k[fa+272+4>>2]=k[z+4>>2];k[fa+272+8>>2]=k[z+8>>2];k[fa+272+12>>2]=k[z+12>>2];k[fa+272+16>>2]=k[z+16>>2];k[fa+272+20>>2]=k[z+20>>2];h=z+(g*24|0)|0;k[z>>2]=k[h>>2];k[z+4>>2]=k[h+4>>2];k[z+8>>2]=k[h+8>>2];k[z+12>>2]=k[h+12>>2];k[z+16>>2]=k[h+16>>2];k[z+20>>2]=k[h+20>>2];h=z+(g*24|0)|0;k[h>>2]=k[fa+272>>2];k[h+4>>2]=k[fa+272+4>>2];k[h+8>>2]=k[fa+272+8>>2];k[h+12>>2]=k[fa+272+12>>2];k[h+16>>2]=k[fa+272+16>>2];k[h+20>>2]=k[fa+272+20>>2];h=x}g=g+1|0}while((g|0)<(h|0));o[z+16>>2]=-1000000015047466219876688.0e6;if((h|0)>1){v=+o[z+4>>2];x=h+-1|0;b=1;while(1){C=+o[z+(b*24|0)>>2]-+o[z>>2];Q=+o[z+(b*24|0)+4>>2]-v;ga=+o[z+(b*24|0)+8>>2]-+o[z+8>>2];ga=((u*Q-t*C)*H+(D*(t*ga-s*Q)+G*(s*C-u*ga)))/+Y(+(C*C+Q*Q+ga*ga));o[z+(b*24|0)+16>>2]=ga;if((b|0)==(x|0))break;else b=b+1|0}};k[fa+160>>2]=k[z>>2];k[fa+160+4>>2]=k[z+4>>2];k[fa+160+8>>2]=k[z+8>>2];k[fa+160+12>>2]=k[z+12>>2];yB(fa+232|0,fa+160|0,1,h+-1|0);g=k[R>>2]|0;k[5108]=(k[5108]|0)+1;h=iF(43)|0;if(!h)f=0;else{k[(h+4+15&-16)+-4>>2]=h;f=h+4+15&-16}w=k[R>>2]|0;k[f>>2]=k[g>>2];k[f+4>>2]=k[g+4>>2];k[f+8>>2]=k[g+8>>2];k[f+12>>2]=k[g+12>>2];k[f+16>>2]=k[g+16>>2];k[f+20>>2]=k[g+20>>2];k[5108]=(k[5108]|0)+1;h=iF(67)|0;if(!h)h=0;else{k[(h+4+15&-16)+-4>>2]=h;h=h+4+15&-16}g=0;while(1){W=h+(g*24|0)|0;N=f+(g*24|0)|0;k[W>>2]=k[N>>2];k[W+4>>2]=k[N+4>>2];k[W+8>>2]=k[N+8>>2];k[W+12>>2]=k[N+12>>2];k[W+16>>2]=k[N+16>>2];k[W+20>>2]=k[N+20>>2];if(!g)break;else g=g+1|0}k[5110]=(k[5110]|0)+1;jF(k[f+-4>>2]|0);g=h+24|0;k[g>>2]=k[w+24>>2];k[g+4>>2]=k[w+24+4>>2];k[g+8>>2]=k[w+24+8>>2];k[g+12>>2]=k[w+24+12>>2];k[g+16>>2]=k[w+24+16>>2];k[g+20>>2]=k[w+24+20>>2];g=k[P>>2]|0;if((g|0)==2){g=2;W=297;break}else{b=2;f=g;g=2;A=2;F=h;d=2}while(1){i:do if((b|0)>1){W=k[R>>2]|0;y=W+(d*24|0)|0;v=+o[y>>2];u=+o[W+(d*24|0)+4>>2];t=+o[W+(d*24|0)+8>>2];while(1){W=b+-2|0;B=b+-1|0;C=+o[F+(W*24|0)>>2];Q=C-+o[F+(B*24|0)>>2];q=+o[F+(W*24|0)+4>>2];p=q-+o[F+(B*24|0)+4>>2];ga=+o[F+(W*24|0)+8>>2];s=ga-+o[F+(B*24|0)+8>>2];if((Q*(q-u)-p*(C-v))*H+(D*(p*(ga-t)-s*(q-u))+G*(s*(C-v)-Q*(ga-t)))>0.0)break;if((B|0)>1){b=B;g=B}else{b=B;g=B;z=A;h=F;break i}}do if((b|0)==(A|0)){z=A<<1;if((A|0)>=(z|0)){b=A;z=A;h=F;break}k[5108]=(k[5108]|0)+1;h=iF((A*48|3)+16|0)|0;if(!h)h=0;else{k[(h+4+15&-16)+-4>>2]=h;h=h+4+15&-16}if((g|0)>0){x=g+-1|0;w=0;while(1){W=h+(w*24|0)|0;N=F+(w*24|0)|0;k[W>>2]=k[N>>2];k[W+4>>2]=k[N+4>>2];k[W+8>>2]=k[N+8>>2];k[W+12>>2]=k[N+12>>2];k[W+16>>2]=k[N+16>>2];k[W+20>>2]=k[N+20>>2];if((w|0)==(x|0))break;else w=w+1|0}}k[5110]=(k[5110]|0)+1;jF(k[F+-4>>2]|0);f=k[P>>2]|0;b=g}else{z=A;h=F}while(0);b=h+(b*24|0)|0;k[b>>2]=k[y>>2];k[b+4>>2]=k[y+4>>2];k[b+8>>2]=k[y+8>>2];k[b+12>>2]=k[y+12>>2];k[b+16>>2]=k[y+16>>2];k[b+20>>2]=k[y+20>>2];g=g+1|0;b=g}else{z=A;h=F}while(0);d=d+1|0;if((d|0)==(f|0)){W=296;break}else{A=z;F=h}}}while(0);if((W|0)==296)if((g|0)>0)W=297;else{g=0;W=298}if((W|0)==297){E=g+-1|0;z=0;y=0;B=0;g=0;F=0;while(1){c=h+(F*24|0)+20|0;do if((z|0)==(y|0)){A=(y|0)==0?1:y<<1;if((y|0)>=(A|0)){f=y;A=y;break}do if(!A)b=0;else{k[5108]=(k[5108]|0)+1;g=iF((A<<2|3)+16|0)|0;if(!g){b=0;break}k[(g+4+15&-16)+-4>>2]=g;b=g+4+15&-16}while(0);if((y|0)>0){x=y+-1|0;w=0;while(1){g=b+(w<<2)|0;if(g)k[g>>2]=k[B+(w<<2)>>2];if((w|0)==(x|0))break;else w=w+1|0}}if(B){k[5110]=(k[5110]|0)+1;jF(k[B+-4>>2]|0);k[fa+64+12>>2]=0}i[fa+64+16>>0]=1;k[fa+64+12>>2]=b;k[fa+64+8>>2]=A;B=b;f=y;g=b}else{f=z;A=y}while(0);w=B+(f<<2)|0;if(w){k[w>>2]=k[c>>2];f=k[fa+64+4>>2]|0}z=f+1|0;k[fa+64+4>>2]=z;f=k[P>>2]|0;j:do if((f|0)>0){d=k[R>>2]|0;b=k[c>>2]|0;w=0;while(1){x=d+(w*24|0)+20|0;w=w+1|0;if((k[x>>2]|0)==(b|0))break;if((w|0)>=(f|0))break j}k[x>>2]=-1}while(0);if((F|0)==(E|0)){W=298;break}else{y=A;F=F+1|0}}}k:do if((W|0)==298){W=0;if((f|0)>0){d=k[R>>2]|0;c=k[_>>2]|0;y=k[Z>>2]|0;A=0;while(1){z=k[d+(A*24|0)+20>>2]|0;if(!((z|0)==-1|(c|0)<1)){B=0;do{b=0;while(1){if((k[T+(b<<2)>>2]|0)==(B|0))break;b=b+1|0;if((b|0)>=(U|0)){W=324;break}}do if((W|0)==324){W=0;b=k[y+(B*36|0)+4>>2]|0;if((b|0)<=0)break;x=k[y+(B*36|0)+12>>2]|0;w=0;do{if((k[x+(w<<2)>>2]|0)==(z|0)){f=1;break k}w=w+1|0}while((w|0)<(b|0))}while(0);B=B+1|0}while((B|0)<(c|0))}A=A+1|0;if((A|0)>=(f|0)){w=g;d=h;W=331;break}}}else{w=g;d=h;W=331}}while(0);if((W|0)==331){f=k[a+52>>2]|0;h=k[f+28>>2]|0;if((h|0)==(k[f+32>>2]|0)){fx(f+24|0,(h|0)==0?1:h<<1);h=k[f+28>>2]|0}g=(k[f+36>>2]|0)+(h*36|0)|0;if(g){gx(g,fa+64|0);h=k[f+28>>2]|0}k[f+28>>2]=h+1;g=w;f=0;h=d}if(h){k[5110]=(k[5110]|0)+1;jF(k[h+-4>>2]|0)}if(g){k[5110]=(k[5110]|0)+1;jF(k[g+-4>>2]|0);k[fa+64+12>>2]=0}h=k[R>>2]|0;if(h){if(i[S>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[h+-4>>2]|0)}k[R>>2]=0}i[S>>0]=1;k[R>>2]=0;k[P>>2]=0;k[fa+232+8>>2]=0;if(!(f&(U|0)>0)){W=357;break}d=k[Z>>2]|0;W=347}while(0);if((W|0)==347){w=0;do{gx(fa+272|0,d+((k[T+(w<<2)>>2]|0)*36|0)|0);f=k[a+52>>2]|0;h=k[f+28>>2]|0;if((h|0)==(k[f+32>>2]|0)){fx(f+24|0,(h|0)==0?1:h<<1);h=k[f+28>>2]|0}g=(k[f+36>>2]|0)+(h*36|0)|0;if(g){gx(g,fa+272|0);h=k[f+28>>2]|0}k[f+28>>2]=h+1;h=k[fa+272+12>>2]|0;if(h){if(i[fa+272+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[h+-4>>2]|0)}k[fa+272+12>>2]=0}w=w+1|0}while((w|0)<(U|0));W=358}else if((W|0)==357?(W=0,(T|0)!=0):0)W=358;if((W|0)==358){W=0;k[5110]=(k[5110]|0)+1;jF(k[T+-4>>2]|0)}if(!l)break}}}else e=0;V=k[a+52>>2]|0;k[V+64>>2]=0;k[V+64+4>>2]=0;k[V+64+8>>2]=0;k[V+64+12>>2]=0;c=k[V+28>>2]|0;if((c|0)>0){x=0;w=0;f=0;A=0;h=0;B=0;g=0;F=0;d=0;b=0;y=0;z=0;U=0;while(1){l=k[V+36>>2]|0;T=k[l+(U*36|0)+4>>2]|0;if((T|0)>0){R=U&65535;S=U|-65536;E=x;c=B;P=g;N=b;M=y;x=z;b=0;while(1){O=b+1|0;I=k[l+(U*36|0)+12>>2]|0;y=k[I+(b<<2)>>2]&65535;I=k[I+(((O|0)==(T|0)?0:O)<<2)>>2]&65535;K=y<<16>>16<I<<16>>16?y:I;J=y<<16>>16<I<<16>>16?I:y;z=y<<16>>16<I<<16>>16?y:I;y=y<<16>>16<I<<16>>16?I:y;I=F+-1|0;l:do if((((z&65535)<<16)+(y<<16>>16)&I)>>>0<f>>>0?(aa=k[w+((((z&65535)<<16)+(y<<16>>16)&I)<<2)>>2]|0,(aa|0)!=-1):0){B=aa;while(1){if(y<<16>>16==(j[E+(B<<2)>>1]|0)?z<<16>>16==(j[E+(B<<2)+2>>1]|0):0)break;B=k[c+(B<<2)>>2]|0;if((B|0)==-1){b=0;break l}}b=d+(B<<2)|0}else b=0;while(0);B=k[V+16>>2]|0;t=+o[B+(z<<16>>16<<4)>>2]-+o[B+(y<<16>>16<<4)>>2];C=+o[B+(z<<16>>16<<4)+4>>2]-+o[B+(y<<16>>16<<4)+4>>2];G=+o[B+(z<<16>>16<<4)+8>>2]-+o[B+(y<<16>>16<<4)+8>>2];D=1.0/+Y(+(t*t+C*C+G*G));B=k[V+48>>2]|0;m:do if((B|0)>0){z=k[V+56>>2]|0;y=0;while(1){v=+o[z+(y<<4)>>2];u=+o[z+(y<<4)+8>>2];do if(!(+X(+(v-t*D))>1.0e-06)){if(+X(+(+o[z+(y<<4)+4>>2]-C*D))>1.0e-06)break;if(!(+X(+(u-G*D))>1.0e-06))break m}while(0);do if(!(+X(+(t*D+v))>1.0e-06)){if(+X(+(C*D+ +o[z+(y<<4)+4>>2]))>1.0e-06)break;if(!(+X(+(G*D+u))>1.0e-06))break m}while(0);y=y+1|0;if((y|0)>=(B|0)){W=381;break}}}else W=381;while(0);if((W|0)==381){W=0;do if((B|0)==(k[V+52>>2]|0)){l=(B|0)==0?1:B<<1;if((B|0)>=(l|0))break;if(!l)y=0;else{k[5108]=(k[5108]|0)+1;B=iF((l<<4|3)+16|0)|0;if(!B)B=0;else{k[(B+4+15&-16)+-4>>2]=B;B=B+4+15&-16}y=B;B=k[V+48>>2]|0}if((B|0)>0){B=B+-1|0;z=0;while(1){a=y+(z<<4)|0;L=(k[V+56>>2]|0)+(z<<4)|0;k[a>>2]=k[L>>2];k[a+4>>2]=k[L+4>>2];k[a+8>>2]=k[L+8>>2];k[a+12>>2]=k[L+12>>2];if((z|0)==(B|0))break;else z=z+1|0}}B=k[V+56>>2]|0;if(B){if(i[V+60>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[B+-4>>2]|0)}k[V+56>>2]=0}i[V+60>>0]=1;k[V+56>>2]=y;k[V+52>>2]=l;B=k[V+48>>2]|0}while(0);a=k[V+56>>2]|0;o[a+(B<<4)>>2]=t*D;o[a+(B<<4)+4>>2]=C*D;o[a+(B<<4)+8>>2]=G*D;o[a+(B<<4)+12>>2]=0.0;k[V+48>>2]=(k[V+48>>2]|0)+1}n:do if(!b){l=((K&65535)<<16)+(J<<16>>16)&I;o:do if(l>>>0<f>>>0){B=k[w+(l<<2)>>2]|0;if((B|0)==-1)break;while(1){if(J<<16>>16==(j[E+(B<<2)>>1]|0)?K<<16>>16==(j[E+(B<<2)+2>>1]|0):0)break;B=k[c+(B<<2)>>2]|0;if((B|0)==-1)break o}B=d+(B<<2)|0;j[B>>1]=S;j[B+2>>1]=S>>>16;B=c;g=P;b=N;y=M;z=x;break n}while(0);do if((P|0)==(F|0)){y=(F|0)==0?1:F<<1;if((F|0)>=(y|0)){B=F;L=F;break}do if(!y)b=0;else{k[5108]=(k[5108]|0)+1;B=iF((y<<2|3)+16|0)|0;if(!B){b=0;break}k[(B+4+15&-16)+-4>>2]=B;b=B+4+15&-16}while(0);if((F|0)>0){z=0;while(1){B=b+(z<<2)|0;if(B){a=d+(z<<2)|0;a=m[a>>1]|m[a+2>>1]<<16;j[B>>1]=a;j[B+2>>1]=a>>>16}if((z|0)==(I|0))break;else z=z+1|0}}if(!d){B=F;L=y;d=b;break}k[5110]=(k[5110]|0)+1;jF(k[d+-4>>2]|0);B=F;L=y;d=b}else{B=P;L=F}while(0);z=d+(B<<2)|0;if(z){j[z>>1]=S;j[z+2>>1]=S>>>16;B=P}g=B+1|0;do if((M|0)==(x|0)){x=(M|0)==0?1:M<<1;if((M|0)>=(x|0)){x=M;break}do if(!x)B=0;else{k[5108]=(k[5108]|0)+1;B=iF((x<<2|3)+16|0)|0;if(!B){B=0;break}k[(B+4+15&-16)+-4>>2]=B;B=B+4+15&-16}while(0);if((M|0)>0){z=M+-1|0;b=0;while(1){y=B+(b<<2)|0;if(y){a=E+(b<<2)|0;a=m[a>>1]|m[a+2>>1]<<16;j[y>>1]=a;j[y+2>>1]=a>>>16}if((b|0)==(z|0))break;else b=b+1|0}}if(!E){E=B;break}k[5110]=(k[5110]|0)+1;jF(k[E+-4>>2]|0);E=B}while(0);B=E+(M<<2)|0;if(B){j[B>>1]=(K&65535)<<16|J&65535;j[B+2>>1]=((K&65535)<<16|J&65535)>>>16}M=M+1|0;if((F|0)<(L|0)){do if((f|0)<(L|0)){if((f|0)>(L|0))b=N;else{do if((N|0)<(L|0)){do if(!L)B=0;else{k[5108]=(k[5108]|0)+1;l=iF((L<<2|3)+16|0)|0;if(!l){B=0;break}k[(l+4+15&-16)+-4>>2]=l;B=l+4+15&-16}while(0);if((f|0)>0){z=f+-1|0;l=0;while(1){y=B+(l<<2)|0;if(y)k[y>>2]=k[w+(l<<2)>>2];if((l|0)==(z|0))break;else l=l+1|0}}if(!w){b=L;break}k[5110]=(k[5110]|0)+1;jF(k[w+-4>>2]|0);b=L}else{B=w;b=N}while(0);z=L+-1|0;l=f;while(1){y=B+(l<<2)|0;if(y)k[y>>2]=0;if((l|0)==(z|0)){w=B;break}else l=l+1|0}}if((A|0)<(L|0)){do if((h|0)<(L|0)){do if(!L)l=0;else{k[5108]=(k[5108]|0)+1;l=iF((L<<2|3)+16|0)|0;if(!l){l=0;break}k[(l+4+15&-16)+-4>>2]=l;l=l+4+15&-16}while(0);if((A|0)>0){B=A+-1|0;y=0;while(1){z=l+(y<<2)|0;if(z)k[z>>2]=k[c+(y<<2)>>2];if((y|0)==(B|0))break;else y=y+1|0}}if(!c){y=L;break}k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);y=L}else{y=h;l=c}while(0);z=L+-1|0;while(1){B=l+(A<<2)|0;if(B)k[B>>2]=0;if((A|0)==(z|0)){h=y;B=l;break}else A=A+1|0}}else B=c;if((L|0)>0){a=L<<2;nF(w|0,-1,a|0)|0;nF(B|0,-1,a|0)|0}if((f|0)<=0){z=w;y=L;A=L;break}z=f+-1|0;y=L+-1|0;l=0;while(1){a=w+(((m[E+(l<<2)+2>>1]<<16)+(j[E+(l<<2)>>1]|0)&y)<<2)|0;k[B+(l<<2)>>2]=k[a>>2];k[a>>2]=l;if((l|0)==(z|0)){z=w;y=L;A=L;break}else l=l+1|0}}else{z=w;y=f;B=c;b=N}while(0);l=((K&65535)<<16)+(J<<16>>16)&L+-1}else{z=w;y=f;B=c;b=N}w=z+(l<<2)|0;k[B+(P<<2)>>2]=k[w>>2];k[w>>2]=P;w=z;f=y;F=L;y=M;z=x}else{j[b+2>>1]=R;B=c;g=P;b=N;y=M;z=x}while(0);if((O|0)>=(T|0))break;l=k[V+36>>2]|0;c=B;P=g;N=b;M=y;x=z;b=O}c=k[V+28>>2]|0;J=w;l=F;I=d}else{E=x;J=w;l=F;I=d}U=U+1|0;if((U|0)>=(c|0))break;else{x=E;w=J;F=l;d=I}}if((c|0)>0){x=k[V+36>>2]|0;f=k[V+16>>2]|0;d=c+-1|0;n=0.0;b=0;while(1){h=k[x+(b*36|0)+4>>2]|0;g=k[x+(b*36|0)+12>>2]|0;w=k[g>>2]|0;if((h+-2|0)>=1){v=+o[V+64>>2];u=+o[V+68>>2];t=+o[V+72>>2];l=1;do{aa=l;l=l+1|0;a=k[g+(aa<<2)>>2]|0;W=k[g+(((l|0)%(h|0)|0)<<2)>>2]|0;ha=+o[f+(w<<4)>>2];p=+o[f+(a<<4)>>2];s=+o[f+(w<<4)+4>>2];C=+o[f+(a<<4)+4>>2];Q=+o[f+(w<<4)+8>>2];G=+o[f+(a<<4)+8>>2];q=+o[f+(W<<4)>>2];D=+o[f+(W<<4)+4>>2];H=+o[f+(W<<4)+8>>2];ga=+Y(+(((ha-p)*(s-D)-(s-C)*(ha-q))*((ha-p)*(s-D)-(s-C)*(ha-q))+(((s-C)*(Q-H)-(Q-G)*(s-D))*((s-C)*(Q-H)-(Q-G)*(s-D))+((Q-G)*(ha-q)-(ha-p)*(Q-H))*((Q-G)*(ha-q)-(ha-p)*(Q-H)))))*.5;v=v+(ha+p+q)*.3333333432674408*ga;o[V+64>>2]=v;u=(s+C+D)*.3333333432674408*ga+u;o[V+68>>2]=u;t=ga*((Q+G+H)*.3333333432674408)+t;o[V+72>>2]=t;n=n+ga}while((aa|0)!=(h+-2|0))}if((b|0)==(d|0)){l=1;A=J;break}else b=b+1|0}}else{n=0.0;l=0;A=J}}else{n=0.0;l=0;E=0;A=0;B=0;I=0}t=1.0/n;s=t*+o[V+64>>2];o[V+64>>2]=s;n=t*+o[V+68>>2];o[V+68>>2]=n;t=t*+o[V+72>>2];o[V+72>>2]=t;o[V+96>>2]=3402823466385288598117041.0e14;if(l){l=k[V+36>>2]|0;p=3402823466385288598117041.0e14;h=0;while(1){q=+X(+(+o[l+(h*36|0)+32>>2]+(+o[l+(h*36|0)+20>>2]*s+ +o[l+(h*36|0)+24>>2]*n+ +o[l+(h*36|0)+28>>2]*t)));if(q<p)o[V+96>>2]=q;else q=p;h=h+1|0;if((h|0)>=(c|0))break;else p=q}}else q=3402823466385288598117041.0e14;l=k[V+8>>2]|0;if((l|0)>0){h=k[V+16>>2]|0;t=-3402823466385288598117041.0e14;u=-3402823466385288598117041.0e14;v=-3402823466385288598117041.0e14;s=3402823466385288598117041.0e14;p=3402823466385288598117041.0e14;n=3402823466385288598117041.0e14;b=0;while(1){ga=+o[h+(b<<4)>>2];s=ga<s?ga:s;t=ga>t?ga:t;ga=+o[h+(b<<4)+4>>2];p=ga<p?ga:p;u=ga>u?ga:u;ga=+o[h+(b<<4)+8>>2];n=ga<n?ga:n;v=ga>v?ga:v;if((b|0)==(l+-1|0))break;else b=b+1|0}}else{t=-3402823466385288598117041.0e14;u=-3402823466385288598117041.0e14;v=-3402823466385288598117041.0e14;s=3402823466385288598117041.0e14;p=3402823466385288598117041.0e14;n=3402823466385288598117041.0e14}o[V+100>>2]=t+s;o[V+104>>2]=u+p;o[V+108>>2]=n+v;o[V+112>>2]=0.0;s=t-s;p=u-p;n=v-n;o[V+116>>2]=s;o[V+120>>2]=p;o[V+124>>2]=n;o[V+128>>2]=0.0;t=q/1.7320507764816284;if(s<p)g=p<n?2:1;else g=s<n?2:0;l=V+116+(g<<2)|0;n=(+o[l>>2]*.5-t)*.0009765625;o[V+88>>2]=t;o[V+84>>2]=t;o[V+80>>2]=t;p=+o[l>>2]*.5;l=V+80+(g<<2)|0;o[l>>2]=p;h=0;while(1){if(qw(V)|0){W=495;break}p=p-n;o[l>>2]=p;h=h+1|0;if((h|0)>=1024){W=494;break}}p:do if((W|0)==494){o[V+88>>2]=t;o[V+84>>2]=t;o[V+80>>2]=t}else if((W|0)==495){s=(+o[V+96>>2]-t)*.0009765625;l=1<<g&3;q=+o[V+80+((1<<l&3)<<2)>>2];h=0;while(1){p=+o[V+80+(l<<2)>>2];o[V+80+(l<<2)>>2]=s+p;n=s+ +o[V+80+((1<<l&3)<<2)>>2];o[V+80+((1<<l&3)<<2)>>2]=n;h=h+1|0;if(!(qw(V)|0))break;if((h|0)>=1024)break p;else q=n}o[V+80+(l<<2)>>2]=p;o[V+80+((1<<l&3)<<2)>>2]=q}while(0);if(E){k[5110]=(k[5110]|0)+1;jF(k[E+-4>>2]|0)}if(I){k[5110]=(k[5110]|0)+1;jF(k[I+-4>>2]|0)}if(B){k[5110]=(k[5110]|0)+1;jF(k[B+-4>>2]|0)}if(A){k[5110]=(k[5110]|0)+1;jF(k[A+-4>>2]|0)}if(e){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0)}l=k[_>>2]|0;if((l|0)<=0){c=k[Z>>2]|0;if(c)W=517}else{c=k[Z>>2]|0;h=0;while(1){e=c+(h*36|0)+4|0;f=c+(h*36|0)+12|0;g=k[f>>2]|0;d=c+(h*36|0)+16|0;if(g){if(i[d>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[g+-4>>2]|0)}k[f>>2]=0}i[d>>0]=1;k[f>>2]=0;k[e>>2]=0;k[c+(h*36|0)+8>>2]=0;if((h|0)==(l+-1|0)){W=517;break}else h=h+1|0}}if((W|0)==517){if(i[fa+320+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[Z>>2]=0}i[fa+320+16>>0]=1;k[Z>>2]=0;k[_>>2]=0;k[fa+320+8>>2]=0;if($){k[5110]=(k[5110]|0)+1;jF(k[$+-4>>2]|0)}c=k[ba>>2]|0;if(c){if(i[fa+100+56>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[ba>>2]=0}i[fa+100+56>>0]=1;k[ba>>2]=0;k[fa+100+44>>2]=0;k[fa+100+48>>2]=0;c=k[ca>>2]|0;if(c){if(i[fa+100+36>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[ca>>2]=0}i[fa+100+36>>0]=1;k[ca>>2]=0;k[fa+100+24>>2]=0;k[fa+100+28>>2]=0;c=k[da>>2]|0;if(c){if(i[fa+100+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[da>>2]=0}if(!ea){r=fa;return 1}k[5110]=(k[5110]|0)+1;jF(k[ea+-4>>2]|0);r=fa;return 1}function Nt(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0,h=0,i=0,j=0.0,l=0.0,m=0,n=0,p=0.0,q=0;n=r;r=r+2048|0;k[a>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;d=+o[c>>2];e=+o[c+4>>2];f=+o[c+8>>2];if(d*d+e*e+f*f<9.999999747378752e-05){l=1.0;j=0.0;d=0.0}else{p=1.0/+Y(+(d*d+e*e+f*f));l=d*p;j=e*p;d=f*p}if((Wb[k[(k[b>>2]|0)+96>>2]&127](b)|0)<=0){r=n;return}i=0;e=-999999984306749440.0;while(1){if(((Wb[k[(k[b>>2]|0)+96>>2]&127](b)|0)-i|0)<128){c=(Wb[k[(k[b>>2]|0)+96>>2]&127](b)|0)-i|0;if((c|0)>0)m=7;else{f=-3402823466385288598117041.0e14;c=-1}}else{c=128;m=7}if((m|0)==7){m=0;h=c+-1|0;c=0;while(1){yc[k[(k[b>>2]|0)+108>>2]&127](b,c,n+(c<<4)|0);if((c|0)==(h|0)){g=0;f=-3402823466385288598117041.0e14;c=-1;break}else c=c+1|0}while(1){p=l*+o[n+(g<<4)>>2]+j*+o[n+(g<<4)+4>>2]+d*+o[n+(g<<4)+8>>2];q=p>f;c=q?g:c;f=q?p:f;if((g|0)==(h|0))break;else g=g+1|0}}if(f>e){q=n+(c<<4)|0;k[a>>2]=k[q>>2];k[a+4>>2]=k[q+4>>2];k[a+8>>2]=k[q+8>>2];k[a+12>>2]=k[q+12>>2]}else f=e;i=i+128|0;if((i|0)>=(Wb[k[(k[b>>2]|0)+96>>2]&127](b)|0))break;else e=f}r=n;return}
function lB(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0,h=0,i=0,j=0,l=0,n=0,q=0,s=0;s=r;r=r+96|0;i=k[a+4>>2]|0;mc[k[(k[i>>2]|0)+16>>2]&3](i,s+16|0,s+4|0,s+8|0,s+80|0,s,s+12|0,s+24|0,s+20|0,b);i=k[s>>2]|0;j=ia(k[s+12>>2]|0,c)|0;q=k[a+4>>2]|0;l=(k[s+8>>2]|0)==0;n=k[s+16>>2]|0;if((k[s+20>>2]|0)!=3){g=k[s+80>>2]|0;h=ia(g,k[i+(j+8)>>2]|0)|0;if(l){e=+o[n+(h+4)>>2]*+o[q+8>>2];f=+o[n+(h+8)>>2]*+o[q+12>>2];o[s+32+32>>2]=+o[n+h>>2]*+o[q+4>>2];o[s+32+36>>2]=e;o[s+32+40>>2]=f;o[s+32+44>>2]=0.0;l=ia(g,k[i+(j+4)>>2]|0)|0;f=+o[n+(l+4)>>2]*+o[q+8>>2];e=+o[n+(l+8)>>2]*+o[q+12>>2];o[s+32+16>>2]=+o[n+l>>2]*+o[q+4>>2];o[s+32+20>>2]=f;o[s+32+24>>2]=e;o[s+32+28>>2]=0.0;l=ia(g,k[i+j>>2]|0)|0;e=+o[n+(l+4)>>2]*+o[q+8>>2];f=+o[n+(l+8)>>2]*+o[q+12>>2];o[s+32>>2]=+o[n+l>>2]*+o[q+4>>2];o[s+32+4>>2]=e;o[s+32+8>>2]=f;o[s+32+12>>2]=0.0;q=a+8|0;q=k[q>>2]|0;n=k[q>>2]|0;n=n+8|0;n=k[n>>2]|0;Cc[n&127](q,s+32|0,b,c);a=k[a+4>>2]|0;c=k[a>>2]|0;c=c+24|0;c=k[c>>2]|0;Ub[c&127](a,b);r=s;return}else{e=+p[n+(h+8)>>3]*+o[q+8>>2];f=+p[n+(h+16)>>3]*+o[q+12>>2];o[s+32+32>>2]=+p[n+h>>3]*+o[q+4>>2];o[s+32+36>>2]=e;o[s+32+40>>2]=f;o[s+32+44>>2]=0.0;l=ia(g,k[i+(j+4)>>2]|0)|0;f=+p[n+(l+8)>>3]*+o[q+8>>2];e=+p[n+(l+16)>>3]*+o[q+12>>2];o[s+32+16>>2]=+p[n+l>>3]*+o[q+4>>2];o[s+32+20>>2]=f;o[s+32+24>>2]=e;o[s+32+28>>2]=0.0;l=ia(g,k[i+j>>2]|0)|0;e=+p[n+(l+8)>>3]*+o[q+8>>2];f=+p[n+(l+16)>>3]*+o[q+12>>2];o[s+32>>2]=+p[n+l>>3]*+o[q+4>>2];o[s+32+4>>2]=e;o[s+32+8>>2]=f;o[s+32+12>>2]=0.0;q=a+8|0;q=k[q>>2]|0;n=k[q>>2]|0;n=n+8|0;n=k[n>>2]|0;Cc[n&127](q,s+32|0,b,c);a=k[a+4>>2]|0;c=k[a>>2]|0;c=c+24|0;c=k[c>>2]|0;Ub[c&127](a,b);r=s;return}}g=k[s+80>>2]|0;h=ia(g,m[i+(j+4)>>1]|0)|0;if(l){e=+o[n+(h+8)>>2]*+o[q+12>>2];d=+o[n+(h+4)>>2]*+o[q+8>>2];f=+o[n+h>>2]*+o[q+4>>2]}else{e=+p[n+(h+16)>>3]*+o[q+12>>2];d=+p[n+(h+8)>>3]*+o[q+8>>2];f=+p[n+h>>3]*+o[q+4>>2]}o[s+32+32>>2]=f;o[s+32+36>>2]=d;o[s+32+40>>2]=e;o[s+32+44>>2]=0.0;h=ia(g,m[i+(j+2)>>1]|0)|0;if(l){e=+o[n+(h+8)>>2]*+o[q+12>>2];d=+o[n+(h+4)>>2]*+o[q+8>>2];f=+o[n+h>>2]*+o[q+4>>2]}else{e=+p[n+(h+16)>>3]*+o[q+12>>2];d=+p[n+(h+8)>>3]*+o[q+8>>2];f=+p[n+h>>3]*+o[q+4>>2]}o[s+32+16>>2]=f;o[s+32+20>>2]=d;o[s+32+24>>2]=e;o[s+32+28>>2]=0.0;g=ia(g,m[i+j>>1]|0)|0;if(l){e=+o[n+(g+8)>>2]*+o[q+12>>2];f=+o[n+(g+4)>>2]*+o[q+8>>2];d=+o[n+g>>2]*+o[q+4>>2]}else{e=+p[n+(g+16)>>3]*+o[q+12>>2];f=+p[n+(g+8)>>3]*+o[q+8>>2];d=+p[n+g>>3]*+o[q+4>>2]}o[s+32>>2]=d;o[s+32+4>>2]=f;o[s+32+8>>2]=e;o[s+32+12>>2]=0.0;q=a+8|0;q=k[q>>2]|0;n=k[q>>2]|0;n=n+8|0;n=k[n>>2]|0;Cc[n&127](q,s+32|0,b,c);a=k[a+4>>2]|0;c=k[a>>2]|0;c=c+24|0;c=k[c>>2]|0;Ub[c&127](a,b);r=s;return}function mB(a){a=a|0;jF(a);return}function nB(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0.0,g=0.0,h=0,i=0,j=0,l=0,n=0,q=0,s=0;s=r;r=r+96|0;l=k[a+4>>2]|0;mc[k[(k[l>>2]|0)+16>>2]&3](l,s+16|0,s+4|0,s+8|0,s+80|0,s,s+12|0,s+24|0,s+20|0,b);l=(k[s>>2]|0)+(ia(k[s+12>>2]|0,c)|0)|0;n=k[a+4>>2]|0;h=(k[s+20>>2]|0)==3;i=(k[s+8>>2]|0)==0;j=k[s+16>>2]|0;q=2;while(1){if(h)d=m[l+(q<<1)>>1]|0;else d=k[l+(q<<2)>>2]|0;d=ia(k[s+80>>2]|0,d)|0;if(i){f=+o[j+(d+8)>>2]*+o[n+12>>2];g=+o[j+d>>2]*+o[n+4>>2];e=+o[j+(d+4)>>2]*+o[n+8>>2]}else{f=+p[j+(d+16)>>3]*+o[n+12>>2];g=+p[j+d>>3]*+o[n+4>>2];e=+p[j+(d+8)>>3]*+o[n+8>>2]}o[s+32+(q<<4)>>2]=g;o[s+32+(q<<4)+4>>2]=e;o[s+32+(q<<4)+8>>2]=f;o[s+32+(q<<4)+12>>2]=0.0;if((q|0)>0)q=q+-1|0;else break}q=k[a+8>>2]|0;Cc[k[(k[q>>2]|0)+8>>2]&127](q,s+32|0,b,c);a=k[a+4>>2]|0;Ub[k[(k[a>>2]|0)+24>>2]&127](a,b);r=s;return}function oB(a){a=a|0;jF(a);return}function pB(a){a=a|0;return 12}function qB(a){a=a|0;return 12944}function rB(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0.0;h=+o[a+88>>2];i=+o[a+92>>2];g=+o[a+96>>2];e=h*+o[b>>2]+i*+o[b+4>>2]+g*+o[b+8>>2];f=+o[a+84>>2];if(e>f){o[a+84>>2]=e;k[a+4>>2]=k[b>>2];k[a+4+4>>2]=k[b+4>>2];k[a+4+8>>2]=k[b+8>>2];k[a+4+12>>2]=k[b+12>>2]}else e=f;f=h*+o[b+16>>2]+i*+o[b+20>>2]+g*+o[b+24>>2];if(f>e){o[a+84>>2]=f;k[a+4>>2]=k[b+16>>2];k[a+4+4>>2]=k[b+16+4>>2];k[a+4+8>>2]=k[b+16+8>>2];k[a+4+12>>2]=k[b+16+12>>2]}else f=e;e=h*+o[b+32>>2]+i*+o[b+36>>2]+g*+o[b+40>>2];if(!(e>f))return;o[a+84>>2]=e;k[a+4>>2]=k[b+32>>2];k[a+4+4>>2]=k[b+32+4>>2];k[a+4+8>>2]=k[b+32+8>>2];k[a+4+12>>2]=k[b+32+12>>2];return}function sB(a){a=a|0;jF(a);return}function tB(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0;e=+o[b>>2];f=+o[b+16>>2];h=e<f?e:f;g=+o[b+32>>2];if((h<g?h:g)>+o[a+24>>2])return;i=e>f?b:b+16|0;if(+o[(+o[i>>2]>g?i:b+32|0)>>2]<+o[a+8>>2])return;f=+o[b+8>>2];e=+o[b+24>>2];h=f<e?f:e;g=+o[b+40>>2];if((h<g?h:g)>+o[a+32>>2])return;i=f>e?b+8|0:b+24|0;if(+o[(+o[i>>2]>g?i:b+40|0)>>2]<+o[a+16>>2])return;g=+o[b+4>>2];f=+o[b+20>>2];h=g<f?g:f;e=+o[b+36>>2];if((h<e?h:e)>+o[a+28>>2])return;i=g>f?b+4|0:b+20|0;if(+o[(+o[i>>2]>e?i:b+36|0)>>2]<+o[a+12>>2])return;a=k[a+4>>2]|0;Cc[k[(k[a>>2]|0)+8>>2]&127](a,b,c,d);return}function uB(a){a=a|0;jF(a);return}function vB(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0;d=nc[k[(k[c>>2]|0)+40>>2]&31](c,a)|0;e=nc[k[(k[c>>2]|0)+28>>2]&31](c,d)|0;k[b>>2]=e;if(e)Ub[k[(k[c>>2]|0)+48>>2]&127](c,d);k[b+4>>2]=k[a+4>>2];o[b+12>>2]=+o[a+68>>2];o[b+16>>2]=+o[a+72>>2];o[b+20>>2]=+o[a+76>>2];o[b+24>>2]=+o[a+80>>2];o[b+28>>2]=+o[a+48>>2];o[b+32>>2]=+o[a+52>>2];o[b+36>>2]=+o[a+56>>2];o[b+40>>2]=+o[a+60>>2];o[b+44>>2]=+o[a+64>>2];return 13288}function wB(a){a=a|0;return 52}function xB(a){a=a|0;return 13312}function yB(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0,s=0,t=0.0,u=0.0,v=0.0,w=0,x=0;w=r;r=r+32|0;s=k[a+12>>2]|0;t=+o[s+(((d+c|0)/2|0)*24|0)>>2];u=+o[s+(((d+c|0)/2|0)*24|0)+4>>2];v=+o[s+(((d+c|0)/2|0)*24|0)+8>>2];p=+o[s+(((d+c|0)/2|0)*24|0)+16>>2];q=k[s+(((d+c|0)/2|0)*24|0)+20>>2]|0;e=c;f=d;while(1){j=+o[b>>2];l=+o[b+4>>2];m=+o[b+8>>2];n=(t-j)*(t-j)+(u-l)*(u-l)+(v-m)*(v-m);a:while(1){g=+o[s+(e*24|0)+16>>2];do if(g!=p){if(!(g<p))break a}else{g=+o[s+(e*24|0)>>2]-j;h=+o[s+(e*24|0)+4>>2]-l;i=+o[s+(e*24|0)+8>>2]-m;if(g*g+h*h+i*i!=n)if(g*g+h*h+i*i<n)break;else break a;else if((k[s+(e*24|0)+20>>2]|0)<(q|0))break;else break a}while(0);e=e+1|0}b:while(1){g=+o[s+(f*24|0)+16>>2];do if(p!=g){if(!(p<g))break b}else{i=+o[s+(f*24|0)>>2]-j;h=+o[s+(f*24|0)+4>>2]-l;g=+o[s+(f*24|0)+8>>2]-m;if(n!=i*i+h*h+g*g)if(n<i*i+h*h+g*g)break;else break b;else if((q|0)<(k[s+(f*24|0)+20>>2]|0))break;else break b}while(0);f=f+-1|0}if((e|0)<=(f|0)){x=s+(e*24|0)|0;k[w>>2]=k[x>>2];k[w+4>>2]=k[x+4>>2];k[w+8>>2]=k[x+8>>2];k[w+12>>2]=k[x+12>>2];k[w+16>>2]=k[x+16>>2];k[w+20>>2]=k[x+20>>2];s=s+(f*24|0)|0;k[x>>2]=k[s>>2];k[x+4>>2]=k[s+4>>2];k[x+8>>2]=k[s+8>>2];k[x+12>>2]=k[s+12>>2];k[x+16>>2]=k[s+16>>2];k[x+20>>2]=k[s+20>>2];s=(k[a+12>>2]|0)+(f*24|0)|0;k[s>>2]=k[w>>2];k[s+4>>2]=k[w+4>>2];k[s+8>>2]=k[w+8>>2];k[s+12>>2]=k[w+12>>2];k[s+16>>2]=k[w+16>>2];k[s+20>>2]=k[w+20>>2];e=e+1|0;f=f+-1|0}if((e|0)>(f|0))break;s=k[a+12>>2]|0}if((f|0)>(c|0))yB(a,b,c,f);if((e|0)>=(d|0)){r=w;return}yB(a,b,e,d);r=w;return}function zB(a){a=a|0;return 68}function AB(a){a=a|0;return 14e3}function BB(a){a=a|0;var b=0,c=0;k[a>>2]=13808;b=k[a+104>>2]|0;if(b){if(i[a+108>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+104>>2]=0}i[a+108>>0]=1;k[a+104>>2]=0;k[a+96>>2]=0;k[a+100>>2]=0;k[a>>2]=13336;b=k[a+52>>2]|0;if((b|0)!=0?(Sb[k[k[b>>2]>>2]&255](b),c=k[a+52>>2]|0,(c|0)!=0):0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function CB(a){a=a|0;var b=0;k[a>>2]=13808;b=k[a+104>>2]|0;if(b){if(i[a+108>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+104>>2]=0}i[a+108>>0]=1;k[a+104>>2]=0;k[a+96>>2]=0;k[a+100>>2]=0;k[a>>2]=13336;b=k[a+52>>2]|0;if(!b)return;Sb[k[k[b>>2]>>2]&255](b);b=k[a+52>>2]|0;if(!b)return;k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0);return}function DB(a){a=a|0;return 14520}function EB(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function FB(a){a=a|0;return 14536}function GB(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function HB(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0;d=nc[k[(k[c>>2]|0)+40>>2]&31](c,a)|0;e=nc[k[(k[c>>2]|0)+28>>2]&31](c,d)|0;k[b>>2]=e;if(e)Ub[k[(k[c>>2]|0)+48>>2]&127](c,d);k[b+4>>2]=k[a+4>>2];o[b+28>>2]=+o[a+28>>2];o[b+32>>2]=+o[a+32>>2];o[b+36>>2]=+o[a+36>>2];o[b+40>>2]=+o[a+40>>2];o[b+12>>2]=+o[a+12>>2];o[b+16>>2]=+o[a+16>>2];o[b+20>>2]=+o[a+20>>2];o[b+24>>2]=+o[a+24>>2];o[b+44>>2]=+o[a+44>>2];k[b+52>>2]=k[a+52>>2];return 14552}function IB(a){a=a|0;return 60}function JB(a,b){a=a|0;b=+b;var c=0.0,d=0.0,e=0.0,f=0.0,g=0.0;f=+gc[k[(k[a>>2]|0)+48>>2]&15](a);d=+gc[k[(k[a>>2]|0)+48>>2]&15](a);g=+gc[k[(k[a>>2]|0)+48>>2]&15](a);f=f+ +o[a+28>>2];d=d+ +o[a+32>>2];g=g+ +o[a+36>>2];o[a+44>>2]=b;e=+gc[k[(k[a>>2]|0)+48>>2]&15](a);c=+gc[k[(k[a>>2]|0)+48>>2]&15](a);b=g-+gc[k[(k[a>>2]|0)+48>>2]&15](a);o[a+28>>2]=f-e;o[a+32>>2]=d-c;o[a+36>>2]=b;o[a+40>>2]=0.0;return}function KB(a,b){a=a|0;b=b|0;k[a>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;o[a+(k[b+52>>2]<<2)>>2]=1.0;return}function LB(a){a=a|0;return 14576}function MB(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0;i=+gc[k[(k[a>>2]|0)+48>>2]&15](a);f=+gc[k[(k[a>>2]|0)+48>>2]&15](a);c=+gc[k[(k[a>>2]|0)+48>>2]&15](a);l=(i+ +o[a+28>>2])/+o[a+12>>2];h=(f+ +o[a+32>>2])/+o[a+16>>2];e=(c+ +o[a+36>>2])/+o[a+20>>2];j=+X(+(+o[b>>2]));g=+X(+(+o[b+4>>2]));d=+X(+(+o[b+8>>2]));o[a+12>>2]=j;o[a+16>>2]=g;o[a+20>>2]=d;o[a+24>>2]=0.0;o[a+28>>2]=l*j-i;o[a+32>>2]=h*g-f;o[a+36>>2]=e*d-c;o[a+40>>2]=0.0;return}function NB(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0;e=r;r=r+16|0;x=k[a+52>>2]|0;h=+o[a+28+(((x+2|0)%3|0)<<2)>>2];o[e>>2]=h;o[e+4>>2]=h;o[e+8>>2]=h;o[e+12>>2]=0.0;o[e+(x<<2)>>2]=h+ +o[a+28+(x<<2)>>2];h=+gc[k[(k[a>>2]|0)+48>>2]&15](a);f=+gc[k[(k[a>>2]|0)+48>>2]&15](a);l=+gc[k[(k[a>>2]|0)+48>>2]&15](a);h=h+ +o[e>>2];o[e>>2]=h;f=f+ +o[e+4>>2];o[e+4>>2]=f;l=l+ +o[e+8>>2];u=+X(+(+o[b>>2]));t=+X(+(+o[b+4>>2]));v=+X(+(+o[b+8>>2]));p=+X(+(+o[b+16>>2]));n=+X(+(+o[b+20>>2]));q=+X(+(+o[b+24>>2]));i=+X(+(+o[b+32>>2]));g=+X(+(+o[b+36>>2]));j=+X(+(+o[b+40>>2]));w=+o[b+48>>2];s=+o[b+52>>2];m=+o[b+56>>2];o[c>>2]=w-(l*v+(u*h+t*f));o[c+4>>2]=s-(l*q+(p*h+n*f));o[c+8>>2]=m-(l*j+(i*h+g*f));o[c+12>>2]=0.0;o[d>>2]=w+(l*v+(u*h+t*f));o[d+4>>2]=s+(l*q+(p*h+n*f));o[d+8>>2]=m+(l*j+(i*h+g*f));o[d+12>>2]=0.0;r=e;return}function OB(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function PB(a){a=a|0;return 14776}function QB(a){a=a|0;var b=0,c=0;k[a>>2]=13336;b=k[a+52>>2]|0;if((b|0)!=0?(Sb[k[k[b>>2]>>2]&255](b),c=k[a+52>>2]|0,(c|0)!=0):0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function RB(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0.0;h=+o[a+24>>2];i=+o[a+28>>2];g=+o[a+32>>2];e=h*+o[b>>2]+i*+o[b+4>>2]+g*+o[b+8>>2];f=+o[a+20>>2];if(e>f){o[a+20>>2]=e;k[a+4>>2]=k[b>>2];k[a+4+4>>2]=k[b+4>>2];k[a+4+8>>2]=k[b+8>>2];k[a+4+12>>2]=k[b+12>>2]}else e=f;f=h*+o[b+16>>2]+i*+o[b+20>>2]+g*+o[b+24>>2];if(f>e){o[a+20>>2]=f;k[a+4>>2]=k[b+16>>2];k[a+4+4>>2]=k[b+16+4>>2];k[a+4+8>>2]=k[b+16+8>>2];k[a+4+12>>2]=k[b+16+12>>2]}else f=e;e=h*+o[b+32>>2]+i*+o[b+36>>2]+g*+o[b+40>>2];if(!(e>f))return;o[a+20>>2]=e;k[a+4>>2]=k[b+32>>2];k[a+4+4>>2]=k[b+32+4>>2];k[a+4+8>>2]=k[b+32+8>>2];k[a+4+12>>2]=k[b+32+12>>2];return}function SB(a){a=a|0;jF(a);return}function TB(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0;e=+o[a+28>>2];f=+o[a+32>>2];d=+o[a+36>>2];switch(c|0){case 2:{o[b>>2]=0.0;o[b+4>>2]=1.0;o[b+8>>2]=0.0;o[b+12>>2]=-f;return}case 0:{o[b>>2]=1.0;o[b+4>>2]=0.0;o[b+8>>2]=0.0;o[b+12>>2]=-e;return}case 5:{o[b>>2]=0.0;o[b+4>>2]=0.0;o[b+8>>2]=-1.0;o[b+12>>2]=-d;return}case 1:{o[b>>2]=-1.0;o[b+4>>2]=0.0;o[b+8>>2]=0.0;o[b+12>>2]=-e;return}case 4:{o[b>>2]=0.0;o[b+4>>2]=0.0;o[b+8>>2]=1.0;o[b+12>>2]=-d;return}case 3:{o[b>>2]=0.0;o[b+4>>2]=-1.0;o[b+8>>2]=0.0;o[b+12>>2]=-f;return}default:return}}function UB(a,b,c){a=a|0;b=b|0;c=+c;var d=0.0,e=0.0,f=0.0,g=0.0;e=+o[a+28>>2];f=+o[a+32>>2];g=+o[a+36>>2];d=+o[b>>2];if(!(d<=e+c)){b=0;return b|0}if(!(d>=-e-c)){b=0;return b|0}d=+o[b+4>>2];if(!(d<=f+c)){b=0;return b|0}if(!(d>=-f-c)){b=0;return b|0}d=+o[b+8>>2];if(!(d<=g+c)){b=0;return b|0}b=d>=-g-c;return b|0}function VB(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0.0,g=0.0,h=0.0;e=r;r=r+48|0;yc[k[(k[a>>2]|0)+124>>2]&127](a,e+32|0,d);h=+o[e+32>>2];g=+o[e+32+4>>2];f=+o[e+32+8>>2];o[b>>2]=h;o[b+4>>2]=g;o[b+8>>2]=f;o[b+12>>2]=0.0;b=k[(k[a>>2]|0)+64>>2]|0;o[e>>2]=-h;o[e+4>>2]=-g;o[e+8>>2]=-f;o[e+12>>2]=0.0;yc[b&127](e+16|0,a,e);k[c>>2]=k[e+16>>2];k[c+4>>2]=k[e+16+4>>2];k[c+8>>2]=k[e+16+8>>2];k[c+12>>2]=k[e+16+12>>2];r=e;return}function WB(a){a=a|0;return 6}function XB(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0;h=+o[a+28>>2];f=+o[a+32>>2];d=+o[a+36>>2];g=+gc[k[(k[a>>2]|0)+48>>2]&15](a);e=+gc[k[(k[a>>2]|0)+48>>2]&15](a);d=d+ +gc[k[(k[a>>2]|0)+48>>2]&15](a);o[c>>2]=+(b&1^1|0)*(h+g)-+(b&1|0)*(h+g);o[c+4>>2]=+(b>>>1&1^1|0)*(f+e)-+(b>>>1&1|0)*(f+e);o[c+8>>2]=+(b>>>2&1^1|0)*d-+(b>>>2&1|0)*d;o[c+12>>2]=0.0;return}function YB(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;do switch(b|0){case 5:{e=1;break}case 9:{e=4;b=6;break}case 0:{e=0;b=1;break}case 7:{e=3;break}case 10:{e=5;b=7;break}case 6:{e=2;break}case 4:{e=0;break}case 3:{e=2;break}case 8:{e=4;b=5;break}case 11:{e=6;b=7;break}case 2:{e=1;b=3;break}case 1:{e=0;b=2;break}default:{e=0;b=0}}while(0);yc[k[(k[a>>2]|0)+108>>2]&127](a,e,c);yc[k[(k[a>>2]|0)+108>>2]&127](a,b,d);return}function ZB(a){a=a|0;return 12}function _B(a){a=a|0;return 8}function $B(a,b,c){a=a|0;b=b|0;c=c|0;switch(b|0){case 2:{o[c>>2]=0.0;o[c+4>>2]=1.0;o[c+8>>2]=0.0;o[c+12>>2]=0.0;return}case 4:{o[c>>2]=0.0;o[c+4>>2]=0.0;o[c+8>>2]=1.0;o[c+12>>2]=0.0;return}case 1:{o[c>>2]=-1.0;o[c+4>>2]=0.0;o[c+8>>2]=0.0;o[c+12>>2]=0.0;return}case 5:{o[c>>2]=0.0;o[c+4>>2]=0.0;o[c+8>>2]=-1.0;o[c+12>>2]=0.0;return}case 3:{o[c>>2]=0.0;o[c+4>>2]=-1.0;o[c+8>>2]=0.0;o[c+12>>2]=0.0;return}case 0:{o[c>>2]=1.0;o[c+4>>2]=0.0;o[c+8>>2]=0.0;o[c+12>>2]=0.0;return}default:return}}function aC(a){a=a|0;return 6}function bC(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0.0,g=0.0,h=0.0;if((d|0)<=0)return;e=0;while(1){h=+o[a+28>>2];g=+o[a+32>>2];g=+o[b+(e<<4)+4>>2]>=0.0?g:-g;f=+o[a+36>>2];f=+o[b+(e<<4)+8>>2]>=0.0?f:-f;o[c+(e<<4)>>2]=+o[b+(e<<4)>>2]>=0.0?h:-h;o[c+(e<<4)+4>>2]=g;o[c+(e<<4)+8>>2]=f;o[c+(e<<4)+12>>2]=0.0;if((e|0)==(d+-1|0))break;else e=e+1|0}return}function cC(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0;f=+o[b+28>>2];e=+o[b+32>>2];e=+o[c+4>>2]>=0.0?e:-e;d=+o[b+36>>2];d=+o[c+8>>2]>=0.0?d:-d;o[a>>2]=+o[c>>2]>=0.0?f:-f;o[a+4>>2]=e;o[a+8>>2]=d;o[a+12>>2]=0.0;return}function dC(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,g=0.0,h=0.0;g=+o[b+28>>2];h=+o[b+32>>2];d=+o[b+36>>2];f=+gc[k[(k[b>>2]|0)+48>>2]&15](b);e=+gc[k[(k[b>>2]|0)+48>>2]&15](b);d=d+ +gc[k[(k[b>>2]|0)+48>>2]&15](b);e=+o[c+4>>2]>=0.0?h+e:-(h+e);d=+o[c+8>>2]>=0.0?d:-d;o[a>>2]=+o[c>>2]>=0.0?g+f:-(g+f);o[a+4>>2]=e;o[a+8>>2]=d;o[a+12>>2]=0.0;return}function eC(a){a=a|0;return 15072}function fC(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0;i=+gc[k[(k[a>>2]|0)+48>>2]&15](a);f=+gc[k[(k[a>>2]|0)+48>>2]&15](a);c=+gc[k[(k[a>>2]|0)+48>>2]&15](a);l=(i+ +o[a+28>>2])/+o[a+12>>2];h=(f+ +o[a+32>>2])/+o[a+16>>2];e=(c+ +o[a+36>>2])/+o[a+20>>2];j=+X(+(+o[b>>2]));g=+X(+(+o[b+4>>2]));d=+X(+(+o[b+8>>2]));o[a+12>>2]=j;o[a+16>>2]=g;o[a+20>>2]=d;o[a+24>>2]=0.0;o[a+28>>2]=l*j-i;o[a+32>>2]=h*g-f;o[a+36>>2]=e*d-c;o[a+40>>2]=0.0;return}function gC(a){a=a|0;var b=0,c=0;k[a>>2]=13336;b=k[a+52>>2]|0;if((b|0)!=0?(Sb[k[k[b>>2]>>2]&255](b),c=k[a+52>>2]|0,(c|0)!=0):0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0)}k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function hC(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;Hv(a,b,c,d)|0;return 1}function iC(a){a=a|0;return 84}function jC(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,l=0.0,m=0,n=0.0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0,E=0;e=+o[b>>2];f=e<999999984306749440.0?e:999999984306749440.0;g=+o[b+4>>2];l=g<999999984306749440.0?g:999999984306749440.0;n=+o[b+8>>2];h=n<999999984306749440.0?n:999999984306749440.0;e=e>-999999984306749440.0?e:-999999984306749440.0;g=g>-999999984306749440.0?g:-999999984306749440.0;n=n>-999999984306749440.0?n:-999999984306749440.0;x=+o[b+16>>2];f=x<f?x:f;y=+o[b+20>>2];l=y<l?y:l;z=+o[b+24>>2];h=z<h?z:h;e=e<x?x:e;g=g<y?y:g;n=n<z?z:n;z=+o[b+32>>2];f=z<f?z:f;y=+o[b+36>>2];l=y<l?y:l;x=+o[b+40>>2];h=x<h?x:h;e=e<z?z:e;g=g<y?y:g;n=n<x?x:n;if(e-f<2.0000000949949026e-03){e=e+1.0000000474974513e-03;f=f+-1.0000000474974513e-03}if(g-l<2.0000000949949026e-03){g=g+1.0000000474974513e-03;l=l+-1.0000000474974513e-03}if(n-h<2.0000000949949026e-03){n=n+1.0000000474974513e-03;h=h+-1.0000000474974513e-03}v=k[a+8>>2]|0;C=+o[v+4>>2];A=+o[v+8>>2];y=+o[v+12>>2];B=+o[v+36>>2];x=+o[v+40>>2];z=+o[v+44>>2];v=~~((f-C)*B)&65534;u=~~((l-A)*x)&65534;t=~~((h-y)*z)&65534;s=(~~((e-C)*B+1.0)&65535|1)&65535;r=(~~((g-A)*x+1.0)&65535|1)&65535;q=(~~((n-y)*z+1.0)&65535|1)&65535;a=k[a+4>>2]|0;b=k[a+4>>2]|0;if((b|0)==(k[a+8>>2]|0)?(w=(b|0)==0?1:b<<1,(b|0)<(w|0)):0){if(!w)p=0;else{k[5108]=(k[5108]|0)+1;b=iF((w<<4|3)+16|0)|0;if(!b)b=0;else{k[(b+4+15&-16)+-4>>2]=b;b=b+4+15&-16}p=b;b=k[a+4>>2]|0}if((b|0)>0){b=b+-1|0;m=0;while(1){D=p+(m<<4)|0;E=(k[a+12>>2]|0)+(m<<4)|0;k[D>>2]=k[E>>2];k[D+4>>2]=k[E+4>>2];k[D+8>>2]=k[E+8>>2];k[D+12>>2]=k[E+12>>2];if((m|0)==(b|0))break;else m=m+1|0}}b=k[a+12>>2]|0;if(b){if(i[a+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+12>>2]=0}i[a+16>>0]=1;k[a+12>>2]=p;k[a+8>>2]=w;b=k[a+4>>2]|0}E=k[a+12>>2]|0;j[E+(b<<4)>>1]=v;j[E+(b<<4)+2>>1]=u;j[E+(b<<4)+4>>1]=t;j[E+(b<<4)+6>>1]=s;j[E+(b<<4)+8>>1]=r;j[E+(b<<4)+10>>1]=q;k[E+(b<<4)+12>>2]=c<<21|d;k[a+4>>2]=(k[a+4>>2]|0)+1;return}function kC(a){a=a|0;jF(a);return}function lC(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,l=0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0,x=0.0,y=0.0,z=0.0,A=0.0;w=r;r=r+32|0;n=+o[b>>2];t=n<999999984306749440.0?n:999999984306749440.0;p=+o[b+4>>2];u=p<999999984306749440.0?p:999999984306749440.0;q=+o[b+8>>2];v=q<999999984306749440.0?q:999999984306749440.0;s=+o[b+12>>2];m=s<0.0?s:0.0;n=n>-999999984306749440.0?n:-999999984306749440.0;p=p>-999999984306749440.0?p:-999999984306749440.0;q=q>-999999984306749440.0?q:-999999984306749440.0;s=s>0.0?s:0.0;x=+o[b+16>>2];t=x<t?x:t;y=+o[b+20>>2];u=y<u?y:u;z=+o[b+24>>2];v=z<v?z:v;A=+o[b+28>>2];m=A<m?A:m;n=n<x?x:n;p=p<y?y:p;q=q<z?z:q;s=s<A?A:s;A=+o[b+32>>2];t=A<t?A:t;z=+o[b+36>>2];u=z<u?z:u;y=+o[b+40>>2];v=y<v?y:v;x=+o[b+44>>2];m=x<m?x:m;n=n<A?A:n;p=p<z?z:p;q=q<y?y:q;s=s<x?x:s;j=k[a+4>>2]|0;b=k[j+4>>2]|0;if((b|0)==(k[j+8>>2]|0)?(l=(b|0)==0?1:b<<1,(b|0)<(l|0)):0){if(!l)h=0;else{k[5108]=(k[5108]|0)+1;b=iF(l<<6|19)|0;if(!b)b=0;else{k[(b+4+15&-16)+-4>>2]=b;b=b+4+15&-16}h=b;b=k[j+4>>2]|0}if((b|0)>0){a=b+-1|0;b=0;while(1){e=h+(b<<6)|0;f=(k[j+12>>2]|0)+(b<<6)|0;g=e+64|0;do{k[e>>2]=k[f>>2];e=e+4|0;f=f+4|0}while((e|0)<(g|0));if((b|0)==(a|0))break;else b=b+1|0}}a=k[j+12>>2]|0;if(a){if(i[j+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0)}k[j+12>>2]=0}i[j+16>>0]=1;k[j+12>>2]=h;k[j+8>>2]=l;b=k[j+4>>2]|0}l=k[j+12>>2]|0;o[l+(b<<6)>>2]=t;o[l+(b<<6)+4>>2]=u;o[l+(b<<6)+8>>2]=v;o[l+(b<<6)+12>>2]=m;o[l+(b<<6)+16>>2]=n;o[l+(b<<6)+20>>2]=p;o[l+(b<<6)+24>>2]=q;o[l+(b<<6)+28>>2]=s;k[l+(b<<6)+32>>2]=-1;k[l+(b<<6)+36>>2]=c;k[l+(b<<6)+40>>2]=d;l=l+(b<<6)+44|0;k[l>>2]=k[w>>2];k[l+4>>2]=k[w+4>>2];k[l+8>>2]=k[w+8>>2];k[l+12>>2]=k[w+12>>2];k[l+16>>2]=k[w+16>>2];k[j+4>>2]=(k[j+4>>2]|0)+1;r=w;return}function mC(a){a=a|0;jF(a);return}function nC(a){a=a|0;var b=0.0,c=0.0;c=+o[a+28>>2];b=+gc[k[(k[a>>2]|0)+48>>2]&15](a);+gc[k[(k[a>>2]|0)+48>>2]&15](a);+gc[k[(k[a>>2]|0)+48>>2]&15](a);return +(c+b)}function oC(a){a=a|0;return 15872}function pC(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function qC(a){a=a|0;var b=0.0,c=0.0;c=+o[a+32>>2];+gc[k[(k[a>>2]|0)+48>>2]&15](a);b=+gc[k[(k[a>>2]|0)+48>>2]&15](a);+gc[k[(k[a>>2]|0)+48>>2]&15](a);return +(c+b)}function rC(a){a=a|0;return 15888}function sC(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function tC(a){a=a|0;var b=0.0,c=0.0;c=+o[a+28>>2];b=+gc[k[(k[a>>2]|0)+48>>2]&15](a);+gc[k[(k[a>>2]|0)+48>>2]&15](a);+gc[k[(k[a>>2]|0)+48>>2]&15](a);return +(c+b)}function uC(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0;d=r;r=r+16|0;yc[k[(k[b>>2]|0)+68>>2]&127](d,b,c);k[a>>2]=k[d>>2];k[a+4>>2]=k[d+4>>2];k[a+8>>2]=k[d+8>>2];k[a+12>>2]=k[d+12>>2];if(!(+gc[k[(k[b>>2]|0)+48>>2]&15](b)!=0.0)){r=d;return}i=+o[c>>2];g=+o[c+4>>2];f=+o[c+8>>2];e=i*i+g*g+f*f<1.4210854715202004e-14?-1.0:f;h=i*i+g*g+f*f<1.4210854715202004e-14?-1.0:g;i=i*i+g*g+f*f<1.4210854715202004e-14?-1.0:i;f=1.0/+Y(+(e*e+(i*i+h*h)));g=+gc[k[(k[b>>2]|0)+48>>2]&15](b);o[a>>2]=f*i*g+ +o[a>>2];o[a+4>>2]=g*(f*h)+ +o[a+4>>2];o[a+8>>2]=g*(f*e)+ +o[a+8>>2];r=d;return}function vC(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0;d=nc[k[(k[c>>2]|0)+40>>2]&31](c,a)|0;e=nc[k[(k[c>>2]|0)+28>>2]&31](c,d)|0;k[b>>2]=e;if(e)Ub[k[(k[c>>2]|0)+48>>2]&127](c,d);k[b+4>>2]=k[a+4>>2];o[b+28>>2]=+o[a+28>>2];o[b+32>>2]=+o[a+32>>2];o[b+36>>2]=+o[a+36>>2];o[b+40>>2]=+o[a+40>>2];o[b+12>>2]=+o[a+12>>2];o[b+16>>2]=+o[a+16>>2];o[b+20>>2]=+o[a+20>>2];o[b+24>>2]=+o[a+24>>2];o[b+44>>2]=+o[a+44>>2];k[b+52>>2]=k[a+52>>2];return 15904}function wC(a){a=a|0;return 60}function xC(a,b){a=a|0;b=b|0;k[a>>2]=0;k[a+4>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;o[a+(k[b+52>>2]<<2)>>2]=1.0;return}function yC(a){a=a|0;return 15928}function zC(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0;i=+gc[k[(k[a>>2]|0)+48>>2]&15](a);f=+gc[k[(k[a>>2]|0)+48>>2]&15](a);c=+gc[k[(k[a>>2]|0)+48>>2]&15](a);l=(i+ +o[a+28>>2])/+o[a+12>>2];h=(f+ +o[a+32>>2])/+o[a+16>>2];e=(c+ +o[a+36>>2])/+o[a+20>>2];j=+X(+(+o[b>>2]));g=+X(+(+o[b+4>>2]));d=+X(+(+o[b+8>>2]));o[a+12>>2]=j;o[a+16>>2]=g;o[a+20>>2]=d;o[a+24>>2]=0.0;o[a+28>>2]=l*j-i;o[a+32>>2]=h*g-f;o[a+36>>2]=e*d-c;o[a+40>>2]=0.0;return}function AC(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function BC(a){a=a|0;return 28}function CC(a){a=a|0;return k[a+24>>2]|0}function DC(a,b){a=a|0;b=b|0;return}function EC(a,b){a=a|0;b=b|0;return}function FC(a){a=a|0;GC(a);if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function GC(a){a=a|0;var b=0;k[a>>2]=15952;b=k[a+156>>2]|0;if(b){if(i[a+160>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+156>>2]=0}i[a+160>>0]=1;k[a+156>>2]=0;k[a+148>>2]=0;k[a+152>>2]=0;b=k[a+136>>2]|0;if(b){if(i[a+140>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+136>>2]=0}i[a+140>>0]=1;k[a+136>>2]=0;k[a+128>>2]=0;k[a+132>>2]=0;b=k[a+116>>2]|0;if(b){if(i[a+120>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+116>>2]=0}i[a+120>>0]=1;k[a+116>>2]=0;k[a+108>>2]=0;k[a+112>>2]=0;b=k[a+96>>2]|0;if(b){if(i[a+100>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+96>>2]=0}i[a+100>>0]=1;k[a+96>>2]=0;k[a+88>>2]=0;k[a+92>>2]=0;k[a>>2]=20040;b=k[a+32>>2]|0;if(!b){i[a+36>>0]=1;k[a+32>>2]=0;k[a+24>>2]=0;a=a+28|0;k[a>>2]=0;return}if(i[a+36>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+32>>2]=0;i[a+36>>0]=1;k[a+32>>2]=0;k[a+24>>2]=0;a=a+28|0;k[a>>2]=0;return}function HC(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0;g=k[a+4>>2]|0;if(!((g|0)<=(b|0)&(g|0)<(b|0))){k[a+4>>2]=b;return}if((k[a+8>>2]|0)<(b|0)){if(!b){d=0;e=g}else{k[5108]=(k[5108]|0)+1;d=iF((b<<4|3)+16|0)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}e=k[a+4>>2]|0}if((e|0)>0){e=e+-1|0;f=0;while(1){h=k[a+12>>2]|0;k[d+(f<<4)>>2]=k[h+(f<<4)>>2];k[d+(f<<4)+4>>2]=k[h+(f<<4)+4>>2];k[d+(f<<4)+8>>2]=k[h+(f<<4)+8>>2];k[d+(f<<4)+12>>2]=k[h+(f<<4)+12>>2];if((f|0)==(e|0))break;else f=f+1|0}}e=k[a+12>>2]|0;if(e){if(i[a+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0)}k[a+12>>2]=0}i[a+16>>0]=1;k[a+12>>2]=d;k[a+8>>2]=b;e=a+12|0}else e=a+12|0;d=g;while(1){h=k[e>>2]|0;k[h+(d<<4)>>2]=k[c>>2];k[h+(d<<4)+4>>2]=k[c+4>>2];k[h+(d<<4)+8>>2]=k[c+8>>2];k[h+(d<<4)+12>>2]=k[c+12>>2];if((d|0)==(b+-1|0))break;else d=d+1|0}k[a+4>>2]=b;return}function IC(a){a=a|0;return}function JC(a,b){a=a|0;b=b|0;var c=0,d=0,e=0;if(j[a+56>>1]|0)return;j[a+64>>1]=1;b=j[a+58>>1]|0;e=k[a+60>>2]|0;if((b&65535)>1){c=1;b=1;while(1){j[e+(c<<6)+48>>1]=c+1;d=b+1<<16>>16;b=j[a+58>>1]|0;if((d&65535)<(b&65535)){c=d&65535;b=d}else break}}j[e+((b&65535)+-1<<6)+48>>1]=0;return}function KC(a,b,c){a=a|0;b=b|0;c=c|0;k[b>>2]=k[a+8>>2];k[b+4>>2]=k[a+8+4>>2];k[b+8>>2]=k[a+8+8>>2];k[b+12>>2]=k[a+8+12>>2];k[c>>2]=k[a+24>>2];k[c+4>>2]=k[a+24+4>>2];k[c+8>>2]=k[a+24+8>>2];k[c+12>>2]=k[a+24+12>>2];return}function LC(a){a=a|0;return k[a+92>>2]|0}function MC(a){a=a|0;return k[a+92>>2]|0}function NC(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,l=0,n=0,o=0,p=0;o=r;r=r+32|0;n=k[a+92>>2]|0;if(!(Wb[k[(k[n>>2]|0)+56>>2]&127](n)|0)){r=o;return}n=k[a+92>>2]|0;n=Wb[k[(k[n>>2]|0)+28>>2]&127](n)|0;c=k[n+4>>2]|0;if((c|0)>1){kx(n,0,c+-1|0);c=k[n+4>>2]|0}d=c-(k[a+104>>2]|0)|0;k[o+16>>2]=0;k[o+16+4>>2]=0;k[o+16+8>>2]=0;k[o+16+12>>2]=0;HC(n,d,o+16|0);k[a+104>>2]=0;d=k[n+4>>2]|0;if((d|0)>0){e=0;g=0;c=0;l=0;while(1){i=k[n+12>>2]|0;h=i+(l<<4)|0;f=k[h>>2]|0;i=i+(l<<4)+4|0;j=k[i>>2]|0;if((f|0)==(e|0))if((j|0)==(g|0)){f=g;g=14}else g=8;else{e=f;g=8}if((g|0)==8){g=0;f=e+54|0;p=e+48|0;if((((((m[f>>1]|0)>=(m[j+48>>1]|0)?(m[j+54>>1]|0)>=(m[p>>1]|0):0)?(m[f+2>>1]|0)>=(m[j+48+2>>1]|0):0)?(m[j+54+2>>1]|0)>=(m[p+2>>1]|0):0)?(m[f+4>>1]|0)>=(m[j+52>>1]|0):0)?(m[j+54+4>>1]|0)>=(m[e+52>>1]|0):0)f=j;else{f=j;g=14}}if((g|0)==14){c=k[a+92>>2]|0;yc[k[(k[c>>2]|0)+32>>2]&127](c,h,b);k[h>>2]=0;k[i>>2]=0;c=(k[a+104>>2]|0)+1|0;k[a+104>>2]=c;k[4116]=(k[4116]|0)+-1;d=k[n+4>>2]|0}l=l+1|0;if((l|0)>=(d|0))break;else g=f}if((d|0)>1){kx(n,0,d+-1|0);d=k[n+4>>2]|0;c=k[a+104>>2]|0}}else c=0;k[o>>2]=0;k[o+4>>2]=0;k[o+8>>2]=0;k[o+12>>2]=0;HC(n,d-c|0,o);k[a+104>>2]=0;r=o;return}function OC(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0,i=0;e=k[a+108>>2]|0;if(e){Cc[k[(k[e>>2]|0)+28>>2]&127](e,b,c,d);return}e=j[a+56>>1]|0;if((e&65535)<<1>>>0<=1)return;g=1;i=1;do{f=k[a+68>>2]|0;if(j[f+(g<<2)>>1]&1){h=k[a+60>>2]|0;g=m[f+(g<<2)+2>>1]|0;if(!(+o[b>>2]>+o[h+(g<<6)+32>>2])?!(+o[c>>2]<+o[h+(g<<6)+16>>2]):0)f=1;else f=0;if(!(!(+o[b+8>>2]>+o[h+(g<<6)+40>>2])?!(+o[c+8>>2]<+o[h+(g<<6)+24>>2]):0))f=0;if(!(+o[b+4>>2]>+o[h+(g<<6)+36>>2])?!(+o[c+4>>2]<+o[h+(g<<6)+20>>2]|f^1):0){nc[k[(k[d>>2]|0)+8>>2]&31](d,h+(g<<6)|0)|0;e=j[a+56>>1]|0}}i=i+1<<16>>16;g=i&65535}while(g>>>0<((e&65535)<<1|1)>>>0);return}function PC(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;var g=0;g=k[a+108>>2]|0;if(g){ec[k[(k[g>>2]|0)+24>>2]&7](g,b,c,d,e,f);return}f=j[a+56>>1]|0;if((f&65535)<<1>>>0<=1)return;c=1;e=1;do{g=k[a+68>>2]|0;if(j[g+(c<<2)>>1]&1){nc[k[(k[d>>2]|0)+8>>2]&31](d,(k[a+60>>2]|0)+((m[g+(c<<2)+2>>1]|0)<<6)|0)|0;f=j[a+56>>1]|0}e=e+1<<16>>16;c=e&65535}while(c>>>0<((f&65535)<<1|1)>>>0);return}function QC(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;k[c>>2]=k[b+16>>2];k[c+4>>2]=k[b+16+4>>2];k[c+8>>2]=k[b+16+8>>2];k[c+12>>2]=k[b+16+12>>2];k[d>>2]=k[b+32>>2];k[d+4>>2]=k[b+32+4>>2];k[d+8>>2]=k[b+32+8>>2];k[d+12>>2]=k[b+32+12>>2];return}function RC(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0,g=0,h=0,i=0,l=0,n=0,p=0,q=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0,G=0,H=0,I=0;I=r;r=r+16|0;k[b+16>>2]=k[c>>2];k[b+16+4>>2]=k[c+4>>2];k[b+16+8>>2]=k[c+8>>2];k[b+16+12>>2]=k[c+12>>2];k[b+32>>2]=k[d>>2];k[b+32+4>>2]=k[d+4>>2];k[b+32+8>>2]=k[d+8>>2];k[b+32+12>>2]=k[d+12>>2];D=k[a+60>>2]|0;E=k[b+12>>2]&65535;UC(a,I+6|0,+o[c>>2],+o[c+4>>2],+o[c+8>>2],0);UC(a,I,+o[d>>2],+o[d+4>>2],+o[d+8>>2],1);H=0;do{t=j[D+(E<<6)+48+(H<<1)>>1]|0;w=j[D+(E<<6)+54+(H<<1)>>1]|0;n=j[I+6+(H<<1)>>1]|0;p=a+68+(H<<2)|0;s=k[p>>2]|0;l=(n&65535)-(m[s+((t&65535)<<2)>>1]|0)|0;q=j[I+(H<<1)>>1]|0;y=(q&65535)-(m[s+((w&65535)<<2)>>1]|0)|0;j[s+((t&65535)<<2)>>1]=n;j[s+((w&65535)<<2)>>1]=q;if((l|0)<0)TC(a,H,t);a:do if((y|0)>0?(z=k[p>>2]|0,A=k[a+60>>2]|0,B=m[z+((w&65535)<<2)+2>>1]|0,C=j[z+((w&65535)+1<<2)+2>>1]|0,C<<16>>16!=0):0){i=1<<H&3;h=A+(B<<6)+54+(H<<1)|0;n=C;q=z+((w&65535)<<2)|0;s=z+((w&65535)+1<<2)|0;while(1){g=j[s>>1]|0;if((m[q>>1]|0)<(g&65535))break a;f=k[a+60>>2]|0;n=n&65535;if(!(g&1)){if(((((m[A+(B<<6)+54+(i<<1)>>1]|0)>=(m[f+(n<<6)+48+(i<<1)>>1]|0)?(m[f+(n<<6)+54+(i<<1)>>1]|0)>=(m[A+(B<<6)+48+(i<<1)>>1]|0):0)?(m[A+(B<<6)+54+((1<<i&3)<<1)>>1]|0)>=(m[f+(n<<6)+48+((1<<i&3)<<1)>>1]|0):0)?(m[f+(n<<6)+54+((1<<i&3)<<1)>>1]|0)>=(m[A+(B<<6)+48+((1<<i&3)<<1)>>1]|0):0)?(G=k[a+92>>2]|0,F=f+((m[q+2>>1]|0)<<6)|0,dc[k[(k[G>>2]|0)+8>>2]&63](G,F,f+(n<<6)|0)|0,G=k[a+96>>2]|0,(G|0)!=0):0)dc[k[(k[G>>2]|0)+8>>2]&63](G,F,f+(n<<6)|0)|0;n=f+(n<<6)+48+(H<<1)|0;j[n>>1]=(j[n>>1]|0)+-1<<16>>16}else{n=f+(n<<6)+54+(H<<1)|0;j[n>>1]=(j[n>>1]|0)+-1<<16>>16}j[h>>1]=(j[h>>1]|0)+1<<16>>16;n=m[q>>1]|m[q+2>>1]<<16;g=m[s>>1]|m[s+2>>1]<<16;j[q>>1]=g;j[q+2>>1]=g>>>16;j[s>>1]=n;j[s+2>>1]=n>>>16;n=j[s+6>>1]|0;if(!(n<<16>>16))break;else{q=q+4|0;s=s+4|0}}}while(0);b:do if((l|0)>0?(u=k[p>>2]|0,v=j[u+((t&65535)+1<<2)+2>>1]|0,v<<16>>16!=0):0){l=(k[a+60>>2]|0)+((m[u+((t&65535)<<2)+2>>1]|0)<<6)+48+(H<<1)|0;n=1<<H&3;g=v;p=u+((t&65535)<<2)|0;i=u+((t&65535)+1<<2)|0;while(1){f=j[i>>1]|0;if((m[p>>1]|0)<(f&65535))break b;h=k[a+60>>2]|0;g=g&65535;if(!(f&1)){t=h+(g<<6)+48+(H<<1)|0;j[t>>1]=(j[t>>1]|0)+-1<<16>>16}else{f=m[p+2>>1]|0;if(((((m[h+(f<<6)+54+(n<<1)>>1]|0)>=(m[h+(g<<6)+48+(n<<1)>>1]|0)?(m[h+(g<<6)+54+(n<<1)>>1]|0)>=(m[h+(f<<6)+48+(n<<1)>>1]|0):0)?(m[h+(f<<6)+54+((1<<n&3)<<1)>>1]|0)>=(m[h+(g<<6)+48+((1<<n&3)<<1)>>1]|0):0)?(m[h+(g<<6)+54+((1<<n&3)<<1)>>1]|0)>=(m[h+(f<<6)+48+((1<<n&3)<<1)>>1]|0):0)?(x=k[a+92>>2]|0,_b[k[(k[x>>2]|0)+12>>2]&31](x,h+(f<<6)|0,h+(g<<6)|0,e)|0,x=k[a+96>>2]|0,(x|0)!=0):0)_b[k[(k[x>>2]|0)+12>>2]&31](x,h+(f<<6)|0,h+(g<<6)|0,e)|0;t=h+(g<<6)+54+(H<<1)|0;j[t>>1]=(j[t>>1]|0)+-1<<16>>16}j[l>>1]=(j[l>>1]|0)+1<<16>>16;g=m[p>>1]|m[p+2>>1]<<16;t=m[i>>1]|m[i+2>>1]<<16;j[p>>1]=t;j[p+2>>1]=t>>>16;j[i>>1]=g;j[i+2>>1]=g>>>16;g=j[i+6>>1]|0;if(!(g<<16>>16))break;else{p=p+4|0;i=i+4|0}}}while(0);if((y|0)<0)SC(a,H,w,e);H=H+1|0}while((H|0)!=3);f=k[a+108>>2]|0;if(!f){r=I;return}Qb[k[(k[f>>2]|0)+16>>2]&31](f,k[b+60>>2]|0,c,d,e);r=I;return}function SC(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0,i=0,l=0,n=0,o=0;f=k[a+68+(b<<2)>>2]|0;e=j[f+((c&65535)+-1<<2)>>1]|0;if((m[f+((c&65535)<<2)>>1]|0)>=(e&65535))return;h=k[a+60>>2]|0;i=h+((m[f+((c&65535)<<2)+2>>1]|0)<<6)+54+(b<<1)|0;g=f+((c&65535)<<2)|0;c=f+((c&65535)+-1<<2)|0;while(1){f=m[c+2>>1]|0;if(!(e&1)){e=m[g+2>>1]|0;if(((((m[h+(e<<6)+54+((1<<b&3)<<1)>>1]|0)>=(m[h+(f<<6)+48+((1<<b&3)<<1)>>1]|0)?(m[h+(f<<6)+54+((1<<b&3)<<1)>>1]|0)>=(m[h+(e<<6)+48+((1<<b&3)<<1)>>1]|0):0)?(m[h+(e<<6)+54+((1<<(1<<b&3)&3)<<1)>>1]|0)>=(m[h+(f<<6)+48+((1<<(1<<b&3)&3)<<1)>>1]|0):0)?(m[h+(f<<6)+54+((1<<(1<<b&3)&3)<<1)>>1]|0)>=(m[h+(e<<6)+48+((1<<(1<<b&3)&3)<<1)>>1]|0):0)?(o=k[a+92>>2]|0,l=h+(e<<6)|0,n=h+(f<<6)|0,_b[k[(k[o>>2]|0)+12>>2]&31](o,l,n,d)|0,o=k[a+96>>2]|0,(o|0)!=0):0)_b[k[(k[o>>2]|0)+12>>2]&31](o,l,n,d)|0;h=h+(f<<6)+48+(b<<1)|0;j[h>>1]=(j[h>>1]|0)+1<<16>>16}else{h=h+(f<<6)+54+(b<<1)|0;j[h>>1]=(j[h>>1]|0)+1<<16>>16}j[i>>1]=(j[i>>1]|0)+-1<<16>>16;f=m[g>>1]|m[g+2>>1]<<16;e=m[c>>1]|m[c+2>>1]<<16;j[g>>1]=e;j[g+2>>1]=e>>>16;j[c>>1]=f;j[c+2>>1]=f>>>16;f=g+-4|0;c=c+-4|0;e=j[c>>1]|0;if((m[f>>1]|0)>=(e&65535))break;h=k[a+60>>2]|0;g=f}return}function TC(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,i=0,l=0,n=0;e=k[a+68+(b<<2)>>2]|0;l=k[a+60>>2]|0;n=m[e+((c&65535)<<2)+2>>1]|0;d=j[e+((c&65535)+-1<<2)>>1]|0;if((m[e+((c&65535)<<2)>>1]|0)>=(d&65535))return;g=l;f=e+((c&65535)<<2)|0;c=e+((c&65535)+-1<<2)|0;while(1){e=m[c+2>>1]|0;if(!(d&1)){g=g+(e<<6)+48+(b<<1)|0;j[g>>1]=(j[g>>1]|0)+1<<16>>16}else{if(((((m[l+(n<<6)+54+((1<<b&3)<<1)>>1]|0)>=(m[g+(e<<6)+48+((1<<b&3)<<1)>>1]|0)?(m[g+(e<<6)+54+((1<<b&3)<<1)>>1]|0)>=(m[l+(n<<6)+48+((1<<b&3)<<1)>>1]|0):0)?(m[l+(n<<6)+54+((1<<(1<<b&3)&3)<<1)>>1]|0)>=(m[g+(e<<6)+48+((1<<(1<<b&3)&3)<<1)>>1]|0):0)?(m[g+(e<<6)+54+((1<<(1<<b&3)&3)<<1)>>1]|0)>=(m[l+(n<<6)+48+((1<<(1<<b&3)&3)<<1)>>1]|0):0)?(i=k[a+92>>2]|0,h=g+(e<<6)|0,dc[k[(k[i>>2]|0)+8>>2]&63](i,l+(n<<6)|0,h)|0,i=k[a+96>>2]|0,(i|0)!=0):0)dc[k[(k[i>>2]|0)+8>>2]&63](i,l+(n<<6)|0,h)|0;g=g+(e<<6)+54+(b<<1)|0;j[g>>1]=(j[g>>1]|0)+1<<16>>16}j[l+(n<<6)+48+(b<<1)>>1]=(j[l+(n<<6)+48+(b<<1)>>1]|0)+-1<<16>>16;e=m[f>>1]|m[f+2>>1]<<16;d=m[c>>1]|m[c+2>>1]<<16;j[f>>1]=d;j[f+2>>1]=d>>>16;j[c>>1]=e;j[c+2>>1]=e>>>16;e=f+-4|0;c=c+-4|0;d=j[c>>1]|0;if((m[e>>1]|0)>=(d&65535))break;g=k[a+60>>2]|0;f=e}return}function UC(a,b,c,d,e,f){a=a|0;b=b|0;c=+c;d=+d;e=+e;f=f|0;var g=0,h=0;c=(c-+o[a+8>>2])*+o[a+40>>2];d=(d-+o[a+12>>2])*+o[a+44>>2];e=(e-+o[a+16>>2])*+o[a+48>>2];do if(!(c<=0.0)){h=j[a+6>>1]|0;g=j[a+4>>1]|0;if(!(c>=+(h&65535|0))){g=g&(~~c&65535)&65535|f;break}else{g=g&h&65535|f;break}}else g=f;while(0);j[b>>1]=g;do if(!(d<=0.0)){h=j[a+6>>1]|0;g=j[a+4>>1]|0;if(!(d>=+(h&65535|0))){g=g&(~~d&65535)&65535|f;break}else{g=g&h&65535|f;break}}else g=f;while(0);j[b+2>>1]=g;if(e<=0.0){f=f&65535;b=b+4|0;j[b>>1]=f;return}h=j[a+6>>1]|0;g=j[a+4>>1]|0;if(!(e>=+(h&65535|0))){f=g&(~~e&65535)&65535|f;f=f&65535;b=b+4|0;j[b>>1]=f;return}else{f=g&h&65535|f;f=f&65535;b=b+4|0;j[b>>1]=f;return}}function VC(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,i=0,l=0,n=0,o=0,p=0,q=0;d=k[a+108>>2]|0;if(d)yc[k[(k[d>>2]|0)+12>>2]&127](d,k[b+60>>2]|0,c);q=k[b+12>>2]|0;p=k[a+60>>2]|0;o=k[a+92>>2]|0;if(!(Wb[k[(k[o>>2]|0)+56>>2]&127](o)|0)){o=k[a+92>>2]|0;yc[k[(k[o>>2]|0)+16>>2]&127](o,p+((q&65535)<<6)|0,c)}l=m[a+56>>1]|0;c=k[a+60>>2]|0;j[c+54>>1]=(m[c+54>>1]|0)+65534;j[c+56>>1]=(m[c+56>>1]|0)+65534;j[c+58>>1]=(m[c+58>>1]|0)+65534;c=j[a+6>>1]|0;o=0;do{i=a+68+(o<<2)|0;n=k[i>>2]|0;e=m[p+((q&65535)<<6)+54+(o<<1)>>1]|0;j[n+(e<<2)>>1]=c;b=j[n+(e+1<<2)+2>>1]|0;if(!(b<<16>>16))d=n;else{h=(k[a+60>>2]|0)+((m[n+(e<<2)+2>>1]|0)<<6)+54+(o<<1)|0;g=n+(e<<2)|0;d=n+(e+1<<2)|0;while(1){f=j[d>>1]|0;if((m[g>>1]|0)<(f&65535))break;c=k[a+60>>2]|0;e=b&65535;if(!(f&1)){f=c+(e<<6)+48+(o<<1)|0;j[f>>1]=(j[f>>1]|0)+-1<<16>>16}else{f=c+(e<<6)+54+(o<<1)|0;j[f>>1]=(j[f>>1]|0)+-1<<16>>16}j[h>>1]=(j[h>>1]|0)+1<<16>>16;b=m[g>>1]|m[g+2>>1]<<16;f=m[d>>1]|m[d+2>>1]<<16;j[g>>1]=f;j[g+2>>1]=f>>>16;j[d>>1]=b;j[d+2>>1]=b>>>16;b=j[d+6>>1]|0;if(!(b<<16>>16))break;else{g=g+4|0;d=d+4|0}}c=j[a+6>>1]|0;d=k[i>>2]|0}e=m[p+((q&65535)<<6)+48+(o<<1)>>1]|0;j[n+(e<<2)>>1]=c;b=j[d+(e+1<<2)+2>>1]|0;if(b<<16>>16){h=(k[a+60>>2]|0)+((m[d+(e<<2)+2>>1]|0)<<6)+48+(o<<1)|0;g=d+(e<<2)|0;f=d+(e+1<<2)|0;while(1){d=j[f>>1]|0;if((m[g>>1]|0)<(d&65535))break;e=k[a+60>>2]|0;c=b&65535;if(!(d&1)){i=e+(c<<6)+48+(o<<1)|0;j[i>>1]=(j[i>>1]|0)+-1<<16>>16}else{i=e+(c<<6)+54+(o<<1)|0;j[i>>1]=(j[i>>1]|0)+-1<<16>>16}j[h>>1]=(j[h>>1]|0)+1<<16>>16;b=m[g>>1]|m[g+2>>1]<<16;i=m[f>>1]|m[f+2>>1]<<16;j[g>>1]=i;j[g+2>>1]=i>>>16;j[f>>1]=b;j[f+2>>1]=b>>>16;b=j[f+6>>1]|0;if(!(b<<16>>16))break;else{g=g+4|0;f=f+4|0}}c=j[a+6>>1]|0}j[n+((l<<1)+-1<<2)+2>>1]=0;j[n+((l<<1)+-1<<2)>>1]=c;o=o+1|0}while((o|0)!=3);j[(k[a+60>>2]|0)+((q&65535)<<6)+48>>1]=j[a+64>>1]|0;j[a+64>>1]=q;j[a+56>>1]=(j[a+56>>1]|0)+-1<<16>>16;return}function WC(a,b,c,d,e,f,g,h,i){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;var l=0,n=0,p=0,q=0,s=0,t=0,u=0,v=0,w=0;w=r;r=r+16|0;UC(a,w+6|0,+o[b>>2],+o[b+4>>2],+o[b+8>>2],0);UC(a,w,+o[c>>2],+o[c+4>>2],+o[c+8>>2],1);v=j[a+64>>1]|0;u=k[a+60>>2]|0;j[a+64>>1]=j[u+((v&65535)<<6)+48>>1]|0;n=(j[a+56>>1]|0)+1<<16>>16;j[a+56>>1]=n;k[u+((v&65535)<<6)+12>>2]=v&65535;k[u+((v&65535)<<6)>>2]=e;j[u+((v&65535)<<6)+4>>1]=f;j[u+((v&65535)<<6)+6>>1]=g;k[u+((v&65535)<<6)+8>>2]=i;q=(n&65535)<<1&65534;j[u+54>>1]=(m[u+54>>1]|0)+2;l=k[a+68>>2]|0;i=m[l+(q+-1<<2)>>1]|m[l+(q+-1<<2)+2>>1]<<16;j[l+((q|1)<<2)>>1]=i;j[l+((q|1)<<2)+2>>1]=i>>>16;l=k[a+68>>2]|0;j[l+(q+-1<<2)>>1]=j[w+6>>1]|0;j[l+(q+-1<<2)+2>>1]=v;j[l+(q<<2)>>1]=j[w>>1]|0;j[l+(q<<2)+2>>1]=v;j[u+((v&65535)<<6)+48>>1]=q+-1;j[u+((v&65535)<<6)+54>>1]=(n&65535)<<1;l=(k[a+60>>2]|0)+56|0;j[l>>1]=(m[l>>1]|0)+2;l=k[a+72>>2]|0;i=m[l+(q+-1<<2)>>1]|m[l+(q+-1<<2)+2>>1]<<16;j[l+((q|1)<<2)>>1]=i;j[l+((q|1)<<2)+2>>1]=i>>>16;l=k[a+72>>2]|0;j[l+(q+-1<<2)>>1]=j[w+6+2>>1]|0;j[l+(q+-1<<2)+2>>1]=v;j[l+(q<<2)>>1]=j[w+2>>1]|0;j[l+(q<<2)+2>>1]=v;j[u+((v&65535)<<6)+50>>1]=q+-1;j[u+((v&65535)<<6)+56>>1]=(n&65535)<<1;l=(k[a+60>>2]|0)+58|0;j[l>>1]=(m[l>>1]|0)+2;l=k[a+76>>2]|0;i=m[l+(q+-1<<2)>>1]|m[l+(q+-1<<2)+2>>1]<<16;j[l+((q|1)<<2)>>1]=i;j[l+((q|1)<<2)+2>>1]=i>>>16;l=k[a+76>>2]|0;j[l+(q+-1<<2)>>1]=j[w+6+4>>1]|0;j[l+(q+-1<<2)+2>>1]=v;j[l+(q<<2)>>1]=j[w+4>>1]|0;j[l+(q<<2)+2>>1]=v;j[u+((v&65535)<<6)+52>>1]=q+-1;j[u+((v&65535)<<6)+58>>1]=(n&65535)<<1;n=k[a+68>>2]|0;q=m[u+((v&65535)<<6)+48>>1]|0;l=k[a+60>>2]|0;i=j[n+(q+-1<<2)>>1]|0;if((m[n+(q<<2)>>1]|0)<(i&65535)){t=l+((m[n+(q<<2)+2>>1]|0)<<6)+48|0;s=n+(q<<2)|0;p=n+(q+-1<<2)|0;while(1){n=m[p+2>>1]|0;if(!(i&1)){q=l+(n<<6)+48|0;j[q>>1]=(j[q>>1]|0)+1<<16>>16}else{q=l+(n<<6)+54|0;j[q>>1]=(j[q>>1]|0)+1<<16>>16}j[t>>1]=(j[t>>1]|0)+-1<<16>>16;n=m[s>>1]|m[s+2>>1]<<16;i=m[p>>1]|m[p+2>>1]<<16;j[s>>1]=i;j[s+2>>1]=i>>>16;j[p>>1]=n;j[p+2>>1]=n>>>16;n=s+-4|0;p=p+-4|0;i=j[p>>1]|0;if((m[n>>1]|0)>=(i&65535))break;l=k[a+60>>2]|0;s=n}n=k[a+68>>2]|0}l=m[u+((v&65535)<<6)+54>>1]|0;p=n+(l<<2)|0;q=n+(l+-1<<2)|0;i=j[q>>1]|0;a:do if((m[p>>1]|0)<(i&65535)){s=k[a+60>>2]|0;t=s+((m[n+(l<<2)+2>>1]|0)<<6)+54|0;l=q;while(1){n=m[l+2>>1]|0;if(!(i&1)){s=s+(n<<6)+48|0;j[s>>1]=(j[s>>1]|0)+1<<16>>16}else{s=s+(n<<6)+54|0;j[s>>1]=(j[s>>1]|0)+1<<16>>16}j[t>>1]=(j[t>>1]|0)+-1<<16>>16;n=m[p>>1]|m[p+2>>1]<<16;i=m[l>>1]|m[l+2>>1]<<16;j[p>>1]=i;j[p+2>>1]=i>>>16;j[l>>1]=n;j[l+2>>1]=n>>>16;p=p+-4|0;n=l+-4|0;i=j[n>>1]|0;if((m[p>>1]|0)>=(i&65535))break a;s=k[a+60>>2]|0;l=n}}while(0);l=k[a+72>>2]|0;q=m[u+((v&65535)<<6)+50>>1]|0;n=k[a+60>>2]|0;i=j[l+(q+-1<<2)>>1]|0;if((m[l+(q<<2)>>1]|0)<(i&65535)){t=n+((m[l+(q<<2)+2>>1]|0)<<6)+50|0;p=l+(q<<2)|0;q=l+(q+-1<<2)|0;while(1){l=m[q+2>>1]|0;if(!(i&1)){s=n+(l<<6)+50|0;j[s>>1]=(j[s>>1]|0)+1<<16>>16}else{s=n+(l<<6)+56|0;j[s>>1]=(j[s>>1]|0)+1<<16>>16}j[t>>1]=(j[t>>1]|0)+-1<<16>>16;l=m[p>>1]|m[p+2>>1]<<16;i=m[q>>1]|m[q+2>>1]<<16;j[p>>1]=i;j[p+2>>1]=i>>>16;j[q>>1]=l;j[q+2>>1]=l>>>16;p=p+-4|0;l=q+-4|0;i=j[l>>1]|0;if((m[p>>1]|0)>=(i&65535))break;n=k[a+60>>2]|0;q=l}l=k[a+72>>2]|0}n=m[u+((v&65535)<<6)+56>>1]|0;p=l+(n<<2)|0;q=l+(n+-1<<2)|0;i=j[q>>1]|0;b:do if((m[p>>1]|0)<(i&65535)){s=k[a+60>>2]|0;t=s+((m[l+(n<<2)+2>>1]|0)<<6)+56|0;l=q;while(1){n=m[l+2>>1]|0;if(!(i&1)){s=s+(n<<6)+50|0;j[s>>1]=(j[s>>1]|0)+1<<16>>16}else{s=s+(n<<6)+56|0;j[s>>1]=(j[s>>1]|0)+1<<16>>16}j[t>>1]=(j[t>>1]|0)+-1<<16>>16;n=m[p>>1]|m[p+2>>1]<<16;i=m[l>>1]|m[l+2>>1]<<16;j[p>>1]=i;j[p+2>>1]=i>>>16;j[l>>1]=n;j[l+2>>1]=n>>>16;p=p+-4|0;n=l+-4|0;i=j[n>>1]|0;if((m[p>>1]|0)>=(i&65535))break b;s=k[a+60>>2]|0;l=n}}while(0);TC(a,2,j[u+((v&65535)<<6)+52>>1]|0);SC(a,2,j[u+((v&65535)<<6)+58>>1]|0,h);i=k[a+60>>2]|0;l=k[a+108>>2]|0;if(!l){e=i+((v&65535)<<6)|0;r=w;return e|0}e=wc[k[(k[l>>2]|0)+8>>2]&3](l,b,c,d,e,f,g,h,0)|0;k[i+((v&65535)<<6)+60>>2]=e;e=i+((v&65535)<<6)|0;r=w;return e|0}function XC(a){a=a|0;YC(a);if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function YC(a){a=a|0;var b=0;k[a>>2]=16240;if(k[a+108>>2]|0){b=k[a+112>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+112>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+108>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+108>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}}b=k[a+88>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+84>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+80>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}b=k[a+60>>2]|0;if(b){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}if(!(i[a+100>>0]|0))return;b=k[a+92>>2]|0;Sb[k[k[b>>2]>>2]&255](b);b=k[a+92>>2]|0;if(!b)return;k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0);return}function ZC(a){a=a|0;YC(a);if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function _C(a,b){a=a|0;b=b|0;return}function $C(a,b){a=a|0;b=b|0;return}function aD(a){a=a|0;return 1}function bD(a,b,c){a=a|0;b=b|0;c=c|0;return 0}function cD(a,b,c){a=a|0;b=b|0;c=c|0;return}function dD(a,b){a=a|0;b=b|0;return}function eD(a,b,c){a=a|0;b=b|0;c=c|0;return}function fD(a){a=a|0;return 0}function gD(a,b,c){a=a|0;b=b|0;c=c|0;return}function hD(a){a=a|0;return a+4|0}function iD(a){a=a|0;return k[a+16>>2]|0}function jD(a){a=a|0;return k[a+16>>2]|0}function kD(a,b,c){a=a|0;b=b|0;c=c|0;return}function lD(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;return 0}function mD(a,b,c){a=a|0;b=b|0;c=c|0;return 0}function nD(a){a=a|0;var b=0;k[a>>2]=16304;b=k[a+16>>2]|0;if(!b){jF(a);return}if(!(i[a+20>>0]|0)){jF(a);return}k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0);jF(a);return}function oD(a){a=a|0;var b=0;k[a>>2]=16304;b=k[a+16>>2]|0;if(b){if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[b+-4>>2]|0)}k[a+16>>2]=0}i[a+20>>0]=1;k[a+16>>2]=0;k[a+8>>2]=0;k[a+12>>2]=0;return}function pD(a,b){a=a|0;b=b|0;k[a+72>>2]=b;return}function qD(a){a=a|0;return 0}function rD(a,b){a=a|0;b=b|0;k[a+24>>2]=b;return}function sD(a){a=a|0;return k[a+8>>2]|0}function tD(a){a=a|0;return a+4|0}function uD(a){a=a|0;return k[a+16>>2]|0}function vD(a){a=a|0;return k[a+16>>2]|0}function wD(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,l=0,m=0,n=0,o=0;k[4120]=(k[4120]|0)+1;d=k[a+24>>2]|0;if(!d){if(!((j[c+6>>1]&j[b+4>>1])<<16>>16)){a=0;return a|0}if(!((j[b+6>>1]&j[c+4>>1])<<16>>16)){a=0;return a|0}}else if(!(dc[k[(k[d>>2]|0)+8>>2]&63](d,b,c)|0)){a=0;return a|0}m=(k[b+12>>2]|0)>(k[c+12>>2]|0);n=m?c:b;m=m?b:c;e=k[n+12>>2]|0;b=k[m+12>>2]|0;h=((b<<16|e)+~((b<<16|e)<<15)>>10^(b<<16|e)+~((b<<16|e)<<15))*9|0;h=(h>>6^h)+~((h>>6^h)<<11)>>16^(h>>6^h)+~((h>>6^h)<<11);l=k[a+12>>2]|0;c=k[(k[a+44>>2]|0)+((h&l+-1)<<2)>>2]|0;a:do if((c|0)!=-1){d=k[a+16>>2]|0;while(1){if((k[(k[d+(c<<4)>>2]|0)+12>>2]|0)==(e|0)?(k[(k[d+(c<<4)+4>>2]|0)+12>>2]|0)==(b|0):0)break;c=k[(k[a+64>>2]|0)+(c<<2)>>2]|0;if((c|0)==-1)break a}c=d+(c<<4)|0;if(c){a=c;return a|0}}while(0);g=k[a+8>>2]|0;if((g|0)==(l|0)){c=(l|0)==0?1:l<<1;if((l|0)<(c|0)){if(!c){b=0;d=l}else{k[5108]=(k[5108]|0)+1;b=iF((c<<4|3)+16|0)|0;if(!b)b=0;else{k[(b+4+15&-16)+-4>>2]=b;b=b+4+15&-16}d=k[a+8>>2]|0}if((d|0)>0){e=d+-1|0;f=0;while(1){o=k[a+16>>2]|0;k[b+(f<<4)>>2]=k[o+(f<<4)>>2];k[b+(f<<4)+4>>2]=k[o+(f<<4)+4>>2];k[b+(f<<4)+8>>2]=k[o+(f<<4)+8>>2];k[b+(f<<4)+12>>2]=k[o+(f<<4)+12>>2];if((f|0)==(e|0))break;else f=f+1|0}}e=k[a+16>>2]|0;if(e){if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0);d=k[a+8>>2]|0}k[a+16>>2]=0}i[a+20>>0]=1;k[a+16>>2]=b;k[a+12>>2]=c}else{d=l;c=l}}else{d=g;c=l}k[a+8>>2]=d+1;e=k[a+16>>2]|0;b=k[a+72>>2]|0;if(b){dc[k[(k[b>>2]|0)+8>>2]&63](b,n,m)|0;c=k[a+12>>2]|0}if((l|0)<(c|0)){cv(a);c=(k[a+12>>2]|0)+-1&h}else c=h&l+-1;o=(k[n+12>>2]|0)<(k[m+12>>2]|0);k[e+(g<<4)>>2]=o?n:m;k[e+(g<<4)+4>>2]=o?m:n;k[e+(g<<4)+8>>2]=0;k[e+(g<<4)+8+4>>2]=0;o=(k[a+44>>2]|0)+(c<<2)|0;k[(k[a+64>>2]|0)+(g<<2)>>2]=k[o>>2];k[o>>2]=g;o=e+(g<<4)|0;return o|0}function xD(a,b){a=a|0;b=b|0;a=k[a+4>>2]|0;if((k[b>>2]|0)==(a|0)){b=1;return b|0}b=(k[b+4>>2]|0)==(a|0);return b|0}function yD(a){a=a|0;jF(a);return}function zD(a,b){a=a|0;b=b|0;var c=0;c=k[a+4>>2]|0;if((k[b>>2]|0)!=(c|0)?(k[b+4>>2]|0)!=(c|0):0)return 0;c=k[a+8>>2]|0;yc[k[(k[c>>2]|0)+32>>2]&127](c,b,k[a+12>>2]|0);return 0}function AD(a){a=a|0;jF(a);return}function BD(a,b){a=a|0;b=b|0;a=k[a+4>>2]|0;nc[k[(k[a>>2]|0)+8>>2]&31](a,k[b+36>>2]|0)|0;return}function CD(a){a=a|0;jF(a);return}function DD(a,b){a=a|0;b=b|0;a=k[a+4>>2]|0;nc[k[(k[a>>2]|0)+8>>2]&31](a,k[b+36>>2]|0)|0;return}function ED(a){a=a|0;jF(a);return}function FD(a,b){a=a|0;b=b|0;yc[k[(k[a>>2]|0)+8>>2]&127](a,b,k[(k[a+8>>2]|0)+48>>2]|0);return}function GD(a,b,c){a=a|0;b=b|0;c=c|0;var d=0;if((b|0)==(c|0))return;d=k[(k[a+4>>2]|0)+136>>2]|0;dc[k[(k[d>>2]|0)+8>>2]&63](d,k[b+36>>2]|0,k[c+36>>2]|0)|0;a=(k[a+4>>2]|0)+160|0;k[a>>2]=(k[a>>2]|0)+1;return}function HD(a){a=a|0;jF(a);return}function ID(a){a=a|0;return}function JD(a){a=a|0;jF(a);return}function KD(a){a=a|0;jF(a);return}function LD(a){a=a|0;return}function MD(a,b,c,d){a=a|0;b=b|0;c=c|0;d=+d;k[a+4>>2]=k[b>>2];k[a+4+4>>2]=k[b+4>>2];k[a+4+8>>2]=k[b+8>>2];k[a+4+12>>2]=k[b+12>>2];k[a+20>>2]=k[c>>2];k[a+20+4>>2]=k[c+4>>2];k[a+20+8>>2]=k[c+8>>2];k[a+20+12>>2]=k[c+12>>2];o[a+36>>2]=d;i[a+40>>0]=1;return}function ND(a,b,c){a=a|0;b=b|0;c=c|0;return}function OD(a,b,c){a=a|0;b=b|0;c=c|0;return}function PD(a){a=a|0;jF(a);return}function QD(a){a=a|0;jF(a);return}function RD(a){a=a|0;jF(a);return}function SD(a){a=a|0;jF(a);return}function TD(a,b,c,d){a=a|0;b=b|0;c=c|0;d=+d;if(!(+o[a+36>>2]>d))return;i[a+40>>0]=1;k[a+4>>2]=k[b>>2];k[a+4+4>>2]=k[b+4>>2];k[a+4+8>>2]=k[b+8>>2];k[a+4+12>>2]=k[b+12>>2];k[a+20>>2]=k[c>>2];k[a+20+4>>2]=k[c+4>>2];k[a+20+8>>2]=k[c+8>>2];k[a+20+12>>2]=k[c+12>>2];o[a+36>>2]=d;return}function UD(a,b,c){a=a|0;b=b|0;c=c|0;return}function VD(a,b,c){a=a|0;b=b|0;c=c|0;return}function WD(a){a=a|0;jF(a);return}function XD(a){a=a|0;jF(a);return}function YD(a){a=a|0;jF(a);return}function ZD(a){a=a|0;return}function _D(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;var g=0,h=0;if((l[d+55>>0]|0|0)==(b|0)){d=0;return d|0}g=k[19520+(e<<2)>>2]|0;if(+o[d>>2]*+o[c+16>>2]+ +o[d+4>>2]*+o[c+20>>2]+ +o[d+8>>2]*+o[c+24>>2]-+o[d+16>>2]<-9.999999747378752e-06){h=aE(a,k[d+20+(g<<2)>>2]|0,k[d+20+(e<<2)>>2]|0,c,0)|0;if(!h){d=0;return d|0}i[h+52>>0]=e;k[h+32>>2]=d;i[d+52+e>>0]=0;k[d+32+(e<<2)>>2]=h;g=k[f>>2]|0;if(!g)k[f+4>>2]=h;else{i[g+53>>0]=2;k[g+36>>2]=h;i[h+54>>0]=1;k[h+40>>2]=g}k[f>>2]=h;k[f+8>>2]=(k[f+8>>2]|0)+1;d=1;return d|0}h=k[19504+(e<<2)>>2]|0;i[d+55>>0]=b;if(!(_D(a,b,c,k[d+32+(g<<2)>>2]|0,l[d+52+g>>0]|0,f)|0)){d=0;return d|0}if(!(_D(a,b,c,k[d+32+(h<<2)>>2]|0,l[d+52+h>>0]|0,f)|0)){d=0;return d|0}g=k[d+48>>2]|0;if(g)k[g+44>>2]=k[d+44>>2];g=k[d+44>>2]|0;if(g)k[g+48>>2]=k[d+48>>2];if((k[a+9280>>2]|0)==(d|0))k[a+9280>>2]=k[d+48>>2];k[a+9284>>2]=(k[a+9284>>2]|0)+-1;k[d+44>>2]=0;k[d+48>>2]=k[a+9288>>2];g=k[a+9288>>2]|0;if(g)k[g+44>>2]=d;k[a+9288>>2]=d;k[a+9292>>2]=(k[a+9292>>2]|0)+1;d=1;return d|0}function $D(a,b,c,d,e){a=a|0;b=+b;c=+c;d=+d;e=e|0;var f=0,g=0,h=0,i=0,j=0.0,l=0.0;h=r;r=r+48|0;j=1.0/+Y(+(b*b+c*c+d*d));o[e>>2]=j*b;o[e+4>>2]=j*c;o[e+8>>2]=j*d;o[e+12>>2]=0.0;f=k[a+120>>2]|0;i=k[a+120+4>>2]|0;g=(k[a>>2]|0)+(i>>1)|0;if(i&1)f=k[(k[g>>2]|0)+f>>2]|0;yc[f&127](h,g,e);d=-+o[e>>2];c=-+o[e+4>>2];b=-+o[e+8>>2];g=k[a+120>>2]|0;i=k[a+120+4>>2]|0;f=(k[a+4>>2]|0)+(i>>1)|0;if(i&1)g=k[(k[f>>2]|0)+g>>2]|0;j=+o[a+24>>2]*d+ +o[a+28>>2]*c+ +o[a+32>>2]*b;l=+o[a+40>>2]*d+ +o[a+44>>2]*c+ +o[a+48>>2]*b;o[h+16>>2]=+o[a+8>>2]*d+ +o[a+12>>2]*c+ +o[a+16>>2]*b;o[h+16+4>>2]=j;o[h+16+8>>2]=l;o[h+16+12>>2]=0.0;yc[g&127](h+32|0,f,h+16|0);l=+o[h+32>>2];b=+o[h+32+4>>2];c=+o[h+32+8>>2];d=+o[h+4>>2]-(l*+o[a+72>>2]+b*+o[a+76>>2]+c*+o[a+80>>2]+ +o[a+108>>2]);j=+o[h+8>>2]-(l*+o[a+88>>2]+b*+o[a+92>>2]+c*+o[a+96>>2]+ +o[a+112>>2]);o[e+16>>2]=+o[h>>2]-(l*+o[a+56>>2]+b*+o[a+60>>2]+c*+o[a+64>>2]+ +o[a+104>>2]);o[e+20>>2]=d;o[e+24>>2]=j;o[e+28>>2]=0.0;r=h;return}function aE(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0,g=0.0,h=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0;q=k[a+9288>>2]|0;if(!q){k[a>>2]=5;a=0;return a|0}f=k[q+48>>2]|0;if(f)k[f+44>>2]=k[q+44>>2];f=k[q+44>>2]|0;if(f)k[f+48>>2]=k[q+48>>2];if((k[a+9288>>2]|0)==(q|0))k[a+9288>>2]=k[q+48>>2];k[a+9292>>2]=(k[a+9292>>2]|0)+-1;k[q+44>>2]=0;k[q+48>>2]=k[a+9280>>2];f=k[a+9280>>2]|0;if(f)k[f+44>>2]=q;k[a+9280>>2]=q;k[a+9284>>2]=(k[a+9284>>2]|0)+1;i[q+55>>0]=0;k[q+20>>2]=b;k[q+24>>2]=c;k[q+28>>2]=d;l=+o[b+16>>2];g=+o[c+16>>2]-l;m=+o[b+20>>2];h=+o[c+20>>2]-m;n=+o[b+24>>2];j=+o[c+24>>2]-n;l=+o[d+16>>2]-l;m=+o[d+20>>2]-m;n=+o[d+24>>2]-n;o[q>>2]=h*n-j*m;o[q+4>>2]=j*l-g*n;o[q+8>>2]=g*m-h*l;o[q+12>>2]=0.0;p=+Y(+((h*n-j*m)*(h*n-j*m)+(j*l-g*n)*(j*l-g*n)+(g*m-h*l)*(g*m-h*l)));do if(p>9.999999747378752e-05){if((!(bE(h*n-j*m,j*l-g*n,g*m-h*l,+o[b+16>>2],+o[b+20>>2],+o[b+24>>2],+o[c+16>>2],+o[c+20>>2],+o[c+24>>2],q+16|0)|0)?!(bE(+o[q>>2],+o[q+4>>2],+o[q+8>>2],+o[c+16>>2],+o[c+20>>2],+o[c+24>>2],+o[d+16>>2],+o[d+20>>2],+o[d+24>>2],q+16|0)|0):0)?!(bE(+o[q>>2],+o[q+4>>2],+o[q+8>>2],+o[d+16>>2],+o[d+20>>2],+o[d+24>>2],+o[b+16>>2],+o[b+20>>2],+o[b+24>>2],q+16|0)|0):0)o[q+16>>2]=(+o[b+16>>2]*+o[q>>2]+ +o[b+20>>2]*+o[q+4>>2]+ +o[b+24>>2]*+o[q+8>>2])/p;o[q>>2]=1.0/p*+o[q>>2];o[q+4>>2]=1.0/p*+o[q+4>>2];o[q+8>>2]=1.0/p*+o[q+8>>2];if(e){a=q;return a|0}if(!(+o[q+16>>2]>=-9.999999747378752e-06)){k[a>>2]=3;break}else{a=q;return a|0}}else k[a>>2]=2;while(0);f=k[q+48>>2]|0;if(f)k[f+44>>2]=k[q+44>>2];f=k[q+44>>2]|0;if(f)k[f+48>>2]=k[q+48>>2];if((k[a+9280>>2]|0)==(q|0))k[a+9280>>2]=k[q+48>>2];k[a+9284>>2]=(k[a+9284>>2]|0)+-1;k[q+44>>2]=0;k[q+48>>2]=k[a+9288>>2];f=k[a+9288>>2]|0;if(f)k[f+44>>2]=q;k[a+9288>>2]=q;k[a+9292>>2]=(k[a+9292>>2]|0)+1;a=0;return a|0}function bE(a,b,c,d,e,f,g,h,i,j){a=+a;b=+b;c=+c;d=+d;e=+e;f=+f;g=+g;h=+h;i=+i;j=j|0;if(!(((g-d)*b-(h-e)*a)*f+(((h-e)*c-(i-f)*b)*d+((i-f)*a-(g-d)*c)*e)<0.0)){j=0;return j|0}if((g-d)*d+(h-e)*e+(i-f)*f>0.0){c=+Y(+(d*d+e*e+f*f));o[j>>2]=c;j=1;return j|0}if((g-d)*g+(h-e)*h+(i-f)*i<0.0){c=+Y(+(g*g+h*h+i*i));o[j>>2]=c;j=1;return j|0}else{c=((g*g+h*h+i*i)*(d*d+e*e+f*f)-(g*d+h*e+i*f)*(g*d+h*e+i*f))/((g-d)*(g-d)+(h-e)*(h-e)+(i-f)*(i-f));c=+Y(+(c>0.0?c:0.0));o[j>>2]=c;j=1;return j|0}return 0}function cE(a){a=a|0;var b=0,c=0,d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0,l=0,m=0.0,n=0.0,p=0.0,q=0;l=r;r=r+32|0;j=k[a+372>>2]|0;c=k[j+32>>2]|0;a:do if((c|0)==2){c=k[j+4>>2]|0;j=k[j>>2]|0;i=+o[c+16>>2]-+o[j+16>>2];h=+o[c+20>>2]-+o[j+20>>2];g=+o[c+24>>2]-+o[j+24>>2];j=0;while(1){k[l>>2]=0;k[l+4>>2]=0;k[l+8>>2]=0;k[l+12>>2]=0;o[l+(j<<2)>>2]=1.0;f=+o[l+8>>2];e=+o[l+4>>2];d=+o[l>>2];if((h*f-g*e)*(h*f-g*e)+(g*d-i*f)*(g*d-i*f)+(i*e-h*d)*(i*e-h*d)>0.0){b=k[a+372>>2]|0;o[b+16+(k[b+32>>2]<<2)>>2]=0.0;c=(k[a+364>>2]|0)+-1|0;k[a+364>>2]=c;k[b+(k[b+32>>2]<<2)>>2]=k[a+348+(c<<2)>>2];c=k[b+32>>2]|0;k[b+32>>2]=c+1;$D(a,h*f-g*e,g*d-i*f,i*e-h*d,k[b+(c<<2)>>2]|0);if(cE(a)|0){b=1;c=19;break}b=k[a+372>>2]|0;c=(k[b+32>>2]|0)+-1|0;k[b+32>>2]=c;c=k[b+(c<<2)>>2]|0;b=k[a+364>>2]|0;k[a+364>>2]=b+1;k[a+348+(b<<2)>>2]=c;b=k[a+372>>2]|0;o[b+16+(k[b+32>>2]<<2)>>2]=0.0;c=(k[a+364>>2]|0)+-1|0;k[a+364>>2]=c;k[b+(k[b+32>>2]<<2)>>2]=k[a+348+(c<<2)>>2];c=k[b+32>>2]|0;k[b+32>>2]=c+1;$D(a,-(h*f-g*e),-(g*d-i*f),-(i*e-h*d),k[b+(c<<2)>>2]|0);if(cE(a)|0){b=1;c=19;break}c=k[a+372>>2]|0;b=(k[c+32>>2]|0)+-1|0;k[c+32>>2]=b;b=k[c+(b<<2)>>2]|0;c=k[a+364>>2]|0;k[a+364>>2]=c+1;k[a+348+(c<<2)>>2]=b}j=j+1|0;if(j>>>0>=3)break a}if((c|0)==19){r=l;return b|0}}else if((c|0)==4){a=k[j>>2]|0;c=k[j+12>>2]|0;i=+o[c+16>>2];p=+o[a+16>>2]-i;m=+o[c+20>>2];d=+o[a+20>>2]-m;f=+o[c+24>>2];g=+o[a+24>>2]-f;a=k[j+4>>2]|0;e=+o[a+16>>2]-i;h=+o[a+20>>2]-m;n=+o[a+24>>2]-f;a=k[j+8>>2]|0;i=+o[a+16>>2]-i;m=+o[a+20>>2]-m;f=+o[a+24>>2]-f;if(!((0.0!=0.0?1:p*h*f+(d*n*i+g*e*m-p*n*m-d*e*f)-g*h*i!=p*h*f+(d*n*i+g*e*m-p*n*m-d*e*f)-g*h*i)|p*h*f+(d*n*i+g*e*m-p*n*m-d*e*f)-g*h*i==0.0)){a=1;r=l;return a|0}}else if((c|0)==3){c=k[j+4>>2]|0;b=k[j>>2]|0;g=+o[b+16>>2];f=+o[c+16>>2]-g;h=+o[b+20>>2];e=+o[c+20>>2]-h;i=+o[b+24>>2];d=+o[c+24>>2]-i;c=k[j+8>>2]|0;g=+o[c+16>>2]-g;h=+o[c+20>>2]-h;i=+o[c+24>>2]-i;if((e*i-d*h)*(e*i-d*h)+(d*g-f*i)*(d*g-f*i)+(f*h-e*g)*(f*h-e*g)>0.0){o[j+28>>2]=0.0;c=(k[a+364>>2]|0)+-1|0;k[a+364>>2]=c;k[j+12>>2]=k[a+348+(c<<2)>>2];c=k[j+32>>2]|0;k[j+32>>2]=c+1;$D(a,e*i-d*h,d*g-f*i,f*h-e*g,k[j+(c<<2)>>2]|0);if(cE(a)|0){a=1;r=l;return a|0}c=k[a+372>>2]|0;j=(k[c+32>>2]|0)+-1|0;k[c+32>>2]=j;j=k[c+(j<<2)>>2]|0;c=k[a+364>>2]|0;k[a+364>>2]=c+1;k[a+348+(c<<2)>>2]=j;c=k[a+372>>2]|0;o[c+16+(k[c+32>>2]<<2)>>2]=0.0;j=(k[a+364>>2]|0)+-1|0;k[a+364>>2]=j;k[c+(k[c+32>>2]<<2)>>2]=k[a+348+(j<<2)>>2];j=k[c+32>>2]|0;k[c+32>>2]=j+1;$D(a,-(e*i-d*h),-(d*g-f*i),-(f*h-e*g),k[c+(j<<2)>>2]|0);if(cE(a)|0){a=1;r=l;return a|0}else{j=k[a+372>>2]|0;c=(k[j+32>>2]|0)+-1|0;k[j+32>>2]=c;c=k[j+(c<<2)>>2]|0;j=k[a+364>>2]|0;k[a+364>>2]=j+1;k[a+348+(j<<2)>>2]=c;break}}}else if((c|0)==1){b=1;c=0;while(1){k[l+16>>2]=0;k[l+16+4>>2]=0;k[l+16+8>>2]=0;k[l+16+12>>2]=0;o[l+16+(c<<2)>>2]=1.0;q=j+32|0;o[j+16+(b<<2)>>2]=0.0;b=(k[a+364>>2]|0)+-1|0;k[a+364>>2]=b;k[j+(k[q>>2]<<2)>>2]=k[a+348+(b<<2)>>2];b=k[q>>2]|0;k[q>>2]=b+1;d=+o[l+16>>2];e=+o[l+16+4>>2];f=+o[l+16+8>>2];$D(a,d,e,f,k[j+(b<<2)>>2]|0);if(cE(a)|0){b=1;c=19;break}j=k[a+372>>2]|0;q=(k[j+32>>2]|0)+-1|0;k[j+32>>2]=q;q=k[j+(q<<2)>>2]|0;j=k[a+364>>2]|0;k[a+364>>2]=j+1;k[a+348+(j<<2)>>2]=q;j=k[a+372>>2]|0;o[j+16+(k[j+32>>2]<<2)>>2]=0.0;q=(k[a+364>>2]|0)+-1|0;k[a+364>>2]=q;k[j+(k[j+32>>2]<<2)>>2]=k[a+348+(q<<2)>>2];q=k[j+32>>2]|0;k[j+32>>2]=q+1;$D(a,-d,-e,-f,k[j+(q<<2)>>2]|0);if(cE(a)|0){b=1;c=19;break}q=k[a+372>>2]|0;j=(k[q+32>>2]|0)+-1|0;k[q+32>>2]=j;j=k[q+(j<<2)>>2]|0;q=k[a+364>>2]|0;k[a+364>>2]=q+1;k[a+348+(q<<2)>>2]=j;c=c+1|0;if(c>>>0>=3)break a;j=k[a+372>>2]|0;b=k[j+32>>2]|0}if((c|0)==19){r=l;return b|0}}while(0);q=0;r=l;return q|0}function dE(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0,C=0.0,D=0,E=0.0,F=0;F=r;r=r+80|0;k[F+64>>2]=a;k[F+64+4>>2]=b;k[F+64+8>>2]=c;l=+o[a>>2];p=+o[b>>2];v=+o[a+4>>2];C=+o[b+4>>2];h=+o[a+8>>2];i=+o[b+8>>2];o[F+16>>2]=l-p;o[F+16+4>>2]=v-C;o[F+16+8>>2]=h-i;o[F+16+12>>2]=0.0;j=+o[c>>2];m=+o[c+4>>2];n=+o[c+8>>2];o[F+16+16>>2]=p-j;o[F+16+20>>2]=C-m;o[F+16+24>>2]=i-n;o[F+16+28>>2]=0.0;o[F+16+32>>2]=j-l;o[F+16+36>>2]=m-v;o[F+16+40>>2]=n-h;o[F+16+44>>2]=0.0;q=(v-C)*(i-n)-(h-i)*(C-m);s=(h-i)*(p-j)-(i-n)*(l-p);t=(C-m)*(l-p)-(v-C)*(p-j);if(!(t*t+(q*q+s*s)>0.0)){E=-1.0;r=F;return +E}k[F>>2]=0;k[F+4>>2]=0;k[F+8>>2]=0;u=v-C;w=h-i;x=l-p;y=l;z=v;A=h;D=a;f=0;g=-1.0;while(1){if(y*(t*u-s*w)+z*(q*w-t*x)+(s*x-q*u)*A>0.0?(B=k[19520+(f<<2)>>2]|0,E=+eE(D,k[F+64+(B<<2)>>2]|0,F,F+8|0),g<0.0|E<g):0){D=k[F+8>>2]|0;k[e>>2]=((D&1|0)==0?0:1<<f)+((D&2|0)==0?0:1<<B);o[d+(f<<2)>>2]=+o[F>>2];o[d+(B<<2)>>2]=+o[F+4>>2];o[d+(k[19520+(B<<2)>>2]<<2)>>2]=0.0;g=E}f=f+1|0;if((f|0)==3)break;D=k[F+64+(f<<2)>>2]|0;u=+o[F+16+(f<<4)+4>>2];w=+o[F+16+(f<<4)+8>>2];x=+o[F+16+(f<<4)>>2];y=+o[D>>2];z=+o[D+4>>2];A=+o[D+8>>2]}if(!(g<0.0)){E=g;r=F;return +E}A=+Y(+(t*t+(q*q+s*s)));E=(q*+o[a>>2]+s*+o[a+4>>2]+t*+o[a+8>>2])/(t*t+(q*q+s*s));k[e>>2]=7;x=+o[b>>2]-q*E;z=+o[b+4>>2]-s*E;y=+o[b+8>>2]-t*E;C=+Y(+((z*(p-j)-x*(C-m))*(z*(p-j)-x*(C-m))+(((C-m)*y-z*(i-n))*((C-m)*y-z*(i-n))+(x*(i-n)-y*(p-j))*(x*(i-n)-y*(p-j)))))/A;o[d>>2]=C;y=+o[c>>2]-q*E;x=+o[c+4>>2]-s*E;z=+o[c+8>>2]-t*E;A=+Y(+((x*(j-l)-y*(m-v))*(x*(j-l)-y*(m-v))+(((m-v)*z-x*(n-h))*((m-v)*z-x*(n-h))+(y*(n-h)-z*(j-l))*(y*(n-h)-z*(j-l)))))/A;o[d+4>>2]=A;o[d+8>>2]=1.0-(A+C);E=t*E*(t*E)+(q*E*(q*E)+s*E*(s*E));r=F;return +E}function eE(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0;e=+o[a>>2];i=+o[b>>2]-e;g=+o[a+4>>2];j=+o[b+4>>2]-g;f=+o[a+8>>2];h=+o[b+8>>2]-f;if(!(i*i+j*j+h*h>0.0)){j=-1.0;return +j}e=-(e*i+g*j+f*h)/(i*i+j*j+h*h);if(e>=1.0){o[c>>2]=0.0;o[c+4>>2]=1.0;k[d>>2]=2;h=+o[b>>2];i=+o[b+4>>2];j=+o[b+8>>2];j=h*h+i*i+j*j;return +j}if(!(e<=0.0)){o[c+4>>2]=e;o[c>>2]=1.0-e;k[d>>2]=3;g=i*e+ +o[a>>2];i=j*e+ +o[a+4>>2];j=h*e+ +o[a+8>>2];j=g*g+i*i+j*j;return +j}else{o[c>>2]=1.0;o[c+4>>2]=0.0;k[d>>2]=1;h=+o[a>>2];i=+o[a+4>>2];j=+o[a+8>>2];j=h*h+i*i+j*j;return +j}return 0.0}function fE(a,b){a=a|0;b=b|0;return}function gE(a){a=a|0;jF(a);return}function hE(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0,g=0,h=0;if(!(k[a+12>>2]|0))return;if(!(i[a+8>>0]|0))return;d=k[b+4>>2]|0;if((d|0)==(k[b+8>>2]|0)?(h=(d|0)==0?1:d<<1,(d|0)<(h|0)):0){if(!h)g=0;else{k[5108]=(k[5108]|0)+1;c=iF((h<<2|3)+16|0)|0;if(!c)d=0;else{k[(c+4+15&-16)+-4>>2]=c;d=c+4+15&-16}g=d;d=k[b+4>>2]|0}if((d|0)>0){c=d+-1|0;f=0;while(1){e=g+(f<<2)|0;if(e)k[e>>2]=k[(k[b+12>>2]|0)+(f<<2)>>2];if((f|0)==(c|0))break;else f=f+1|0}}c=k[b+12>>2]|0;if(c){if(i[b+16>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[c+-4>>2]|0);d=k[b+4>>2]|0}k[b+12>>2]=0}i[b+16>>0]=1;k[b+12>>2]=g;k[b+8>>2]=h}c=(k[b+12>>2]|0)+(d<<2)|0;if(c)k[c>>2]=k[a+12>>2];k[b+4>>2]=d+1;return}function iE(a){a=a|0;jF(a);return}function jE(a){a=a|0;jF(a);return}function kE(a){a=a|0;return k[a+16>>2]|0}function lE(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0,g=0,h=0,j=0,l=0,m=0,n=0;k[4974]=(k[4974]|0)+1;l=((c<<16|b)+~((c<<16|b)<<15)>>10^(c<<16|b)+~((c<<16|b)<<15))*9|0;l=(l>>6^l)+~((l>>6^l)<<11)>>16^(l>>6^l)+~((l>>6^l)<<11);m=k[a+12>>2]|0;d=k[(k[a+40>>2]|0)+((m+-1&l)<<2)>>2]|0;a:do if((d|0)!=-1){e=k[a+16>>2]|0;while(1){if((k[e+(d*12|0)>>2]|0)==(b|0)?(k[e+(d*12|0)+4>>2]|0)==(c|0):0)break;d=k[(k[a+60>>2]|0)+(d<<2)>>2]|0;if((d|0)==-1)break a}d=e+(d*12|0)|0;if(d){a=d;return a|0}}while(0);j=k[a+8>>2]|0;if((j|0)==(m|0)){h=(m|0)==0?1:m<<1;if((m|0)<(h|0)){if(!h){d=0;e=m}else{k[5108]=(k[5108]|0)+1;d=iF((h*12|3)+16|0)|0;if(!d)d=0;else{k[(d+4+15&-16)+-4>>2]=d;d=d+4+15&-16}e=k[a+8>>2]|0}if((e|0)>0){e=e+-1|0;g=0;while(1){f=d+(g*12|0)|0;if(f){n=(k[a+16>>2]|0)+(g*12|0)|0;k[f>>2]=k[n>>2];k[f+4>>2]=k[n+4>>2];k[f+8>>2]=k[n+8>>2]}if((g|0)==(e|0))break;else g=g+1|0}}e=k[a+16>>2]|0;if(e){if(i[a+20>>0]|0){k[5110]=(k[5110]|0)+1;jF(k[e+-4>>2]|0)}k[a+16>>2]=0}i[a+20>>0]=1;k[a+16>>2]=d;k[a+12>>2]=h;e=k[a+8>>2]|0;d=h}else{e=m;d=m}}else{e=j;d=m}k[a+8>>2]=e+1;e=k[a+16>>2]|0;if((m|0)<(d|0)){jw(a);d=(k[a+12>>2]|0)+-1&l}else d=m+-1&l;k[e+(j*12|0)>>2]=b;k[e+(j*12|0)+4>>2]=c;k[e+(j*12|0)+8>>2]=0;n=(k[a+40>>2]|0)+(d<<2)|0;k[(k[a+60>>2]|0)+(j<<2)>>2]=k[n>>2];k[n>>2]=j;n=e+(j*12|0)|0;return n|0}function mE(a,b){a=a|0;b=b|0;return}function nE(a,b){a=a|0;b=b|0;return}function oE(){var a=0,b=0;while(1){a=iF(8)|0;if(a){b=6;break}a=k[5230]|0;k[5230]=a+0;if(!a){b=5;break}zc[a&3]()}if((b|0)==5){b=Gb(4)|0;k[b>>2]=20816;Eb(b|0,20864,207)}else if((b|0)==6){k[5090]=a;Kb(a|0,0)|0;k[5092]=20408;k[5093]=0;k[5094]=0;k[5095]=0;k[5096]=0;k[5097]=0;k[5098]=0;k[5099]=0;k[5100]=0;Bw(20368);return}}function pE(a){a=a|0;return}function qE(a){a=a|0;jF(a);return}function rE(a,b,c){a=a|0;b=b|0;c=c|0;var d=0;a=k[b>>2]|0;d=k[c>>2]|0;a=(k[a+236>>2]|0)==4?a:0;d=(k[d+236>>2]|0)==4?d:0;if(a)yc[k[(k[a>>2]|0)+28>>2]&127](a,c,b);if(!d)return 0;yc[k[(k[d>>2]|0)+28>>2]&127](d,b,c);return 0}function sE(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;a=k[b>>2]|0;e=k[c>>2]|0;a=(k[a+236>>2]|0)==4?a:0;e=(k[e+236>>2]|0)==4?e:0;if(a)Cc[k[(k[a>>2]|0)+32>>2]&127](a,c,d,b);if(!e)return 0;Cc[k[(k[e>>2]|0)+32>>2]&127](e,b,d,c);return 0}function tE(a,b,c){a=a|0;b=b|0;c=c|0;return}function uE(a){a=a|0;return}function vE(a){a=a|0;return}function wE(a){a=a|0;if(!a)return;k[5110]=(k[5110]|0)+1;jF(k[a+-4>>2]|0);return}function xE(a,b){a=a|0;b=b|0;var c=0,d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0,j=0.0,l=0.0,m=0.0,n=0.0,p=0.0,q=0.0;c=r;r=r+176|0;q=+o[a+68>>2];o[c+128>>2]=q;p=+o[a+84>>2];o[c+128+4>>2]=p;n=+o[a+100>>2];o[c+128+8>>2]=n;o[c+128+12>>2]=0.0;m=+o[a+72>>2];o[c+128+16>>2]=m;l=+o[a+88>>2];o[c+128+20>>2]=l;j=+o[a+104>>2];o[c+128+24>>2]=j;o[c+128+28>>2]=0.0;i=+o[a+76>>2];o[c+128+32>>2]=i;g=+o[a+92>>2];o[c+128+36>>2]=g;e=+o[a+108>>2];o[c+128+40>>2]=e;o[c+128+44>>2]=0.0;h=-+o[a+116>>2];f=-+o[a+120>>2];d=-+o[a+124>>2];k[c>>2]=k[c+128>>2];k[c+4>>2]=k[c+128+4>>2];k[c+8>>2]=k[c+128+8>>2];k[c+12>>2]=k[c+128+12>>2];k[c+16>>2]=k[c+128+16>>2];k[c+16+4>>2]=k[c+128+16+4>>2];k[c+16+8>>2]=k[c+128+16+8>>2];k[c+16+12>>2]=k[c+128+16+12>>2];k[c+32>>2]=k[c+128+32>>2];k[c+32+4>>2]=k[c+128+32+4>>2];k[c+32+8>>2]=k[c+128+32+8>>2];k[c+32+12>>2]=k[c+128+32+12>>2];o[c+48>>2]=q*h+p*f+n*d;o[c+52>>2]=m*h+l*f+j*d;o[c+56>>2]=i*h+g*f+e*d;o[c+60>>2]=0.0;Sw(c+64|0,c,a+4|0);k[b>>2]=k[c+64>>2];k[b+4>>2]=k[c+64+4>>2];k[b+8>>2]=k[c+64+8>>2];k[b+12>>2]=k[c+64+12>>2];k[b+16>>2]=k[c+64+16>>2];k[b+16+4>>2]=k[c+64+16+4>>2];k[b+16+8>>2]=k[c+64+16+8>>2];k[b+16+12>>2]=k[c+64+16+12>>2];k[b+32>>2]=k[c+64+32>>2];k[b+32+4>>2]=k[c+64+32+4>>2];k[b+32+8>>2]=k[c+64+32+8>>2];k[b+32+12>>2]=k[c+64+32+12>>2];k[b+48>>2]=k[c+64+48>>2];k[b+48+4>>2]=k[c+64+48+4>>2];k[b+48+8>>2]=k[c+64+48+8>>2];k[b+48+12>>2]=k[c+64+48+12>>2];r=c;return}function yE(a,b){a=a|0;b=b|0;var c=0;c=r;r=r+64|0;Sw(c,b,a+68|0);k[a+4>>2]=k[c>>2];k[a+4+4>>2]=k[c+4>>2];k[a+4+8>>2]=k[c+8>>2];k[a+4+12>>2]=k[c+12>>2];k[a+20>>2]=k[c+16>>2];k[a+20+4>>2]=k[c+16+4>>2];k[a+20+8>>2]=k[c+16+8>>2];k[a+20+12>>2]=k[c+16+12>>2];k[a+36>>2]=k[c+32>>2];k[a+36+4>>2]=k[c+32+4>>2];k[a+36+8>>2]=k[c+32+8>>2];k[a+36+12>>2]=k[c+32+12>>2];k[a+52>>2]=k[c+48>>2];k[a+52+4>>2]=k[c+48+4>>2];k[a+52+8>>2]=k[c+48+8>>2];k[a+52+12>>2]=k[c+48+12>>2];r=c;return}function zE(a){a=a|0;return}function AE(a){a=a|0;return}function BE(a){a=a|0;jF(a);return}function CE(a,b){a=a|0;b=b|0;if(!((j[b+4>>1]&j[a+6>>1])<<16>>16)){a=0;return a|0}a=(j[a+4>>1]&j[b+6>>1])<<16>>16!=0;return a|0}function DE(a,b,c,d,e,f,g,h){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;return +(+Mb(0,a|0,b|0,c|0,d|0,e|0,f|0,g|0,h|0))}function EE(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0.0,f=0.0,g=0.0,h=0.0,i=0.0;f=+o[b>>2];d=+o[b+4>>2];i=+o[b+8>>2];g=+o[b+12>>2];e=f*(2.0/(f*f+d*d+i*i+g*g));c=d*(2.0/(f*f+d*d+i*i+g*g));h=i*(2.0/(f*f+d*d+i*i+g*g));o[a>>2]=1.0-(d*c+i*h);o[a+4>>2]=f*c-g*h;o[a+8>>2]=f*h+g*c;o[a+12>>2]=0.0;o[a+16>>2]=f*c+g*h;o[a+20>>2]=1.0-(f*e+i*h);o[a+24>>2]=d*h-g*e;o[a+28>>2]=0.0;o[a+32>>2]=f*h-g*c;o[a+36>>2]=d*h+g*e;o[a+40>>2]=1.0-(f*e+d*c);o[a+44>>2]=0.0;return}function FE(a,b){a=a|0;b=b|0;var c=0;c=r;r=r+16|0;k[c>>2]=b;b=k[w>>2]|0;fb(b|0,a|0,c|0)|0;Db(10,b|0)|0;Fb()}function GE(a){a=a|0;return}function HE(a){a=a|0;jF(a);return}function IE(a){a=a|0;return 20832}function JE(a){a=a|0;var b=0;b=r;r=r+16|0;zc[a&3]();FE(20880,b)}function KE(a){a=a|0;return}function LE(a){a=a|0;return}function ME(a){a=a|0;return}function NE(a){a=a|0;jF(a);return}function OE(a){a=a|0;jF(a);return}function PE(a){a=a|0;jF(a);return}function QE(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0;f=r;r=r+64|0;if((a|0)!=(b|0))if((b|0)!=0?(e=VE(b,21072)|0,(e|0)!=0):0){b=f;d=b+56|0;do{k[b>>2]=0;b=b+4|0}while((b|0)<(d|0));k[f>>2]=e;k[f+8>>2]=a;k[f+12>>2]=-1;k[f+48>>2]=1;Cc[k[(k[e>>2]|0)+28>>2]&127](e,f,k[c>>2]|0,1);if((k[f+24>>2]|0)==1){k[c>>2]=k[f+16>>2];b=1}else b=0}else b=0;else b=1;r=f;return b|0}function RE(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;do if((a|0)==(k[b+8>>2]|0)){a=k[b+16>>2]|0;if(!a){k[b+16>>2]=c;k[b+24>>2]=d;k[b+36>>2]=1;break}if((a|0)!=(c|0)){k[b+36>>2]=(k[b+36>>2]|0)+1;k[b+24>>2]=2;i[b+54>>0]=1;break}if((k[b+24>>2]|0)==2)k[b+24>>2]=d}while(0);return}function SE(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;do if((a|0)==(k[b+8>>2]|0)){a=k[b+16>>2]|0;if(!a){k[b+16>>2]=c;k[b+24>>2]=d;k[b+36>>2]=1;break}if((a|0)!=(c|0)){k[b+36>>2]=(k[b+36>>2]|0)+1;k[b+24>>2]=2;i[b+54>>0]=1;break}if((k[b+24>>2]|0)==2)k[b+24>>2]=d}else{a=k[a+8>>2]|0;Cc[k[(k[a>>2]|0)+28>>2]&127](a,b,c,d)}while(0);return}function TE(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0;e=k[a+4>>2]|0;if(!(e&1))f=e>>8;else f=k[(k[c>>2]|0)+(e>>8)>>2]|0;a=k[a>>2]|0;Cc[k[(k[a>>2]|0)+28>>2]&127](a,b,c+f|0,(e&2|0)!=0?d:2);return}function UE(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0;a:do if((a|0)==(k[b+8>>2]|0)){e=k[b+16>>2]|0;if(!e){k[b+16>>2]=c;k[b+24>>2]=d;k[b+36>>2]=1;break}if((e|0)!=(c|0)){k[b+36>>2]=(k[b+36>>2]|0)+1;k[b+24>>2]=2;i[b+54>>0]=1;break}if((k[b+24>>2]|0)==2)k[b+24>>2]=d}else{e=k[a+12>>2]|0;TE(a+16|0,b,c,d);if((e|0)>1){f=a+24|0;do{TE(f,b,c,d);if(i[b+54>>0]|0)break a;f=f+8|0}while(f>>>0<(a+16+(e<<3)|0)>>>0)}}while(0);return}function VE(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0;f=r;r=r+64|0;e=k[a>>2]|0;d=a+(k[e+-8>>2]|0)|0;e=k[e+-4>>2]|0;k[f>>2]=b;k[f+4>>2]=a;k[f+8>>2]=21016;a=f+12|0;c=a+40|0;do{k[a>>2]=0;a=a+4|0}while((a|0)<(c|0));j[f+12+40>>1]=0;i[f+12+42>>0]=0;do if((e|0)==(b|0)){k[f+48>>2]=1;ec[k[(k[b>>2]|0)+20>>2]&7](b,f,d,d,1,0);a=(k[f+24>>2]|0)==1?d:0}else{Qb[k[(k[e>>2]|0)+24>>2]&31](e,f,d,1,0);a=k[f+36>>2]|0;if(!a){a=((k[f+40>>2]|0)==1?(k[f+28>>2]|0)==1:0)&(k[f+32>>2]|0)==1?k[f+20>>2]|0:0;break}else if((a|0)!=1){a=0;break}if((k[f+24>>2]|0)!=1?!(((k[f+40>>2]|0)==0?(k[f+28>>2]|0)==1:0)&(k[f+32>>2]|0)==1):0){a=0;break}a=k[f+16>>2]|0}while(0);r=f;return a|0}function WE(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;i[a+53>>0]=1;do if((k[a+4>>2]|0)==(c|0)){i[a+52>>0]=1;c=k[a+16>>2]|0;if(!c){k[a+16>>2]=b;k[a+24>>2]=d;k[a+36>>2]=1;if(!((d|0)==1?(k[a+48>>2]|0)==1:0))break;i[a+54>>0]=1;break}if((c|0)!=(b|0)){k[a+36>>2]=(k[a+36>>2]|0)+1;i[a+54>>0]=1;break}c=k[a+24>>2]|0;if((c|0)==2)k[a+24>>2]=d;else d=c;if((d|0)==1?(k[a+48>>2]|0)==1:0)i[a+54>>0]=1}while(0);return}function XE(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0;a:do if((a|0)==(k[b+8>>2]|0)){if((k[b+4>>2]|0)==(c|0)?(k[b+28>>2]|0)!=1:0)k[b+28>>2]=d}else{if((a|0)!=(k[b>>2]|0)){g=k[a+12>>2]|0;ZE(a+16|0,b,c,d,e);if((g|0)<=1)break;f=k[a+8>>2]|0;if((f&2|0)==0?(k[b+36>>2]|0)!=1:0){if(!(f&1)){f=a+24|0;while(1){if(i[b+54>>0]|0)break a;if((k[b+36>>2]|0)==1)break a;ZE(f,b,c,d,e);f=f+8|0;if(f>>>0>=(a+16+(g<<3)|0)>>>0)break a}}f=a+24|0;while(1){if(i[b+54>>0]|0)break a;if((k[b+36>>2]|0)==1?(k[b+24>>2]|0)==1:0)break a;ZE(f,b,c,d,e);f=f+8|0;if(f>>>0>=(a+16+(g<<3)|0)>>>0)break a}}f=a+24|0;while(1){if(i[b+54>>0]|0)break a;ZE(f,b,c,d,e);f=f+8|0;if(f>>>0>=(a+16+(g<<3)|0)>>>0)break a}}if((k[b+16>>2]|0)!=(c|0)?(k[b+20>>2]|0)!=(c|0):0){k[b+32>>2]=d;if((k[b+44>>2]|0)==4)break;h=a+16+(k[a+12>>2]<<3)|0;g=0;f=0;d=a+16|0;b:while(1){if(d>>>0>=h>>>0){j=20;break}i[b+52>>0]=0;i[b+53>>0]=0;YE(d,b,c,c,1,e);if(i[b+54>>0]|0){j=20;break}do if(i[b+53>>0]|0){if(!(i[b+52>>0]|0))if(!(k[a+8>>2]&1)){f=1;j=20;break b}else{f=1;break}if((k[b+24>>2]|0)==1)break b;if(!(k[a+8>>2]&2))break b;else{g=1;f=1}}while(0);d=d+8|0}do if((j|0)==20){if((!g?(k[b+20>>2]=c,k[b+40>>2]=(k[b+40>>2]|0)+1,(k[b+36>>2]|0)==1):0)?(k[b+24>>2]|0)==2:0){i[b+54>>0]=1;if(f)break}else j=24;if((j|0)==24?f:0)break;k[b+44>>2]=4;break a}while(0);k[b+44>>2]=3;break}if((d|0)==1)k[b+32>>2]=1}while(0);return}function YE(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;var g=0,h=0;g=k[a+4>>2]|0;if(!(g&1))h=g>>8;else h=k[(k[d>>2]|0)+(g>>8)>>2]|0;a=k[a>>2]|0;ec[k[(k[a>>2]|0)+20>>2]&7](a,b,c,d+h|0,(g&2|0)!=0?e:2,f);return}function ZE(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0,g=0;f=k[a+4>>2]|0;if(!(f&1))g=f>>8;else g=k[(k[c>>2]|0)+(f>>8)>>2]|0;a=k[a>>2]|0;Qb[k[(k[a>>2]|0)+24>>2]&31](a,b,c+g|0,(f&2|0)!=0?d:2,e);return}function _E(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0;a:do if((a|0)==(k[b+8>>2]|0)){if((k[b+4>>2]|0)==(c|0)?(k[b+28>>2]|0)!=1:0)k[b+28>>2]=d}else{if((a|0)!=(k[b>>2]|0)){f=k[a+8>>2]|0;Qb[k[(k[f>>2]|0)+24>>2]&31](f,b,c,d,e);break}if((k[b+16>>2]|0)!=(c|0)?(k[b+20>>2]|0)!=(c|0):0){k[b+32>>2]=d;if((k[b+44>>2]|0)==4)break;i[b+52>>0]=0;i[b+53>>0]=0;a=k[a+8>>2]|0;ec[k[(k[a>>2]|0)+20>>2]&7](a,b,c,c,1,e);if(i[b+53>>0]|0){if(!(i[b+52>>0]|0)){d=1;f=13}}else{d=0;f=13}do if((f|0)==13){k[b+20>>2]=c;k[b+40>>2]=(k[b+40>>2]|0)+1;if((k[b+36>>2]|0)==1?(k[b+24>>2]|0)==2:0){i[b+54>>0]=1;if(d)break}else f=16;if((f|0)==16?d:0)break;k[b+44>>2]=4;break a}while(0);k[b+44>>2]=3;break}if((d|0)==1)k[b+32>>2]=1}while(0);return}function $E(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;do if((a|0)==(k[b+8>>2]|0)){if((k[b+4>>2]|0)==(c|0)?(k[b+28>>2]|0)!=1:0)k[b+28>>2]=d}else if((a|0)==(k[b>>2]|0)){if((k[b+16>>2]|0)!=(c|0)?(k[b+20>>2]|0)!=(c|0):0){k[b+32>>2]=d;k[b+20>>2]=c;k[b+40>>2]=(k[b+40>>2]|0)+1;if((k[b+36>>2]|0)==1?(k[b+24>>2]|0)==2:0)i[b+54>>0]=1;k[b+44>>2]=4;break}if((d|0)==1)k[b+32>>2]=1}while(0);return}function aF(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;var g=0,h=0,j=0,l=0;if((a|0)==(k[b+8>>2]|0))WE(b,c,d,e);else{g=i[b+52>>0]|0;h=i[b+53>>0]|0;j=k[a+12>>2]|0;i[b+52>>0]=0;i[b+53>>0]=0;YE(a+16|0,b,c,d,e,f);a:do if((j|0)>1){l=a+24|0;do{if(i[b+54>>0]|0)break a;if(!(i[b+52>>0]|0)){if((i[b+53>>0]|0)!=0?(k[a+8>>2]&1|0)==0:0)break a}else{if((k[b+24>>2]|0)==1)break a;if(!(k[a+8>>2]&2))break a}i[b+52>>0]=0;i[b+53>>0]=0;YE(l,b,c,d,e,f);l=l+8|0}while(l>>>0<(a+16+(j<<3)|0)>>>0)}while(0);i[b+52>>0]=g;i[b+53>>0]=h}return}function bF(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;if((a|0)==(k[b+8>>2]|0))WE(b,c,d,e);else{a=k[a+8>>2]|0;ec[k[(k[a>>2]|0)+20>>2]&7](a,b,c,d,e,f)}return}function cF(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;if((a|0)==(k[b+8>>2]|0))WE(b,c,d,e);return}function dF(a,b,c){a=a|0;b=b|0;c=c|0;var d=0;d=r;r=r+16|0;k[d>>2]=k[c>>2];a=dc[k[(k[a>>2]|0)+16>>2]&63](a,b,d)|0;if(a)k[c>>2]=k[d>>2];r=d;return a&1|0}function eF(a){a=a|0;if(!a)a=0;else a=(VE(a,21184)|0)!=0;return a&1|0}function fF(){var a=0,b=0,c=0,d=0;d=r;r=r+48|0;if(yb(20632,3)|0)FE(20640,d);a=wb(k[5156]|0)|0;if((a|0)!=0?(c=k[a>>2]|0,(c|0)!=0):0){a=k[c+48>>2]|0;b=k[c+48+4>>2]|0;if(!((a&-256|0)==1126902528&(b|0)==1129074247)){k[d+32>>2]=20456;FE(20568,d+32|0)}if((a|0)==1126902529&(b|0)==1129074247)a=k[c+44>>2]|0;else a=c+80|0;k[d+44>>2]=a;c=k[c>>2]|0;a=k[c+4>>2]|0;if(QE(20944,c,d+44|0)|0){c=k[d+44>>2]|0;c=Wb[k[(k[c>>2]|0)+8>>2]&127](c)|0;k[d+8>>2]=20456;k[d+8+4>>2]=a;k[d+8+8>>2]=c;FE(20472,d+8|0)}else{k[d+24>>2]=20456;k[d+24+4>>2]=a;FE(20520,d+24|0)}}FE(20608,d+40|0)}function gF(){var a=0;a=r;r=r+16|0;if(!(zb(20624,215)|0)){r=a;return}else FE(20696,a)}function hF(a){a=a|0;var b=0;b=r;r=r+16|0;jF(a);if(!(Cb(k[5156]|0,0)|0)){r=b;return}else FE(20752,b)}function iF(a){a=a|0;var b=0,c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0;do if(a>>>0<245){if(a>>>0<11)b=16;else b=a+11&-8;a=b>>>3;h=k[5358]|0;if(h>>>a&3){b=k[21472+(((h>>>a&1^1)+a<<1)+2<<2)>>2]|0;c=k[b+8>>2]|0;do if((21472+((h>>>a&1^1)+a<<1<<2)|0)!=(c|0)){if(c>>>0<(k[5362]|0)>>>0)Fb();if((k[c+12>>2]|0)==(b|0)){k[c+12>>2]=21472+((h>>>a&1^1)+a<<1<<2);k[21472+(((h>>>a&1^1)+a<<1)+2<<2)>>2]=c;break}else Fb()}else k[5358]=h&~(1<<(h>>>a&1^1)+a);while(0);k[b+4>>2]=(h>>>a&1^1)+a<<3|3;k[b+((h>>>a&1^1)+a<<3|4)>>2]=k[b+((h>>>a&1^1)+a<<3|4)>>2]|1;F=b+8|0;return F|0}g=k[5360]|0;if(b>>>0>g>>>0){if(h>>>a){d=(h>>>a<<a&(2<<a|0-(2<<a))&0-(h>>>a<<a&(2<<a|0-(2<<a))))+-1|0;a=d>>>(d>>>12&16)>>>(d>>>(d>>>12&16)>>>5&8);e=a>>>(a>>>2&4)>>>(a>>>(a>>>2&4)>>>1&2);e=(d>>>(d>>>12&16)>>>5&8|d>>>12&16|a>>>2&4|a>>>(a>>>2&4)>>>1&2|e>>>1&1)+(e>>>(e>>>1&1))|0;a=k[21472+((e<<1)+2<<2)>>2]|0;d=k[a+8>>2]|0;do if((21472+(e<<1<<2)|0)!=(d|0)){if(d>>>0<(k[5362]|0)>>>0)Fb();if((k[d+12>>2]|0)==(a|0)){k[d+12>>2]=21472+(e<<1<<2);k[21472+((e<<1)+2<<2)>>2]=d;j=k[5360]|0;break}else Fb()}else{k[5358]=h&~(1<<e);j=g}while(0);f=(e<<3)-b|0;k[a+4>>2]=b|3;g=a+b|0;k[a+(b|4)>>2]=f|1;k[a+(e<<3)>>2]=f;if(j){e=k[5363]|0;b=j>>>3;d=k[5358]|0;if(d&1<<b){c=k[21472+((b<<1)+2<<2)>>2]|0;if(c>>>0<(k[5362]|0)>>>0)Fb();else{i=21472+((b<<1)+2<<2)|0;l=c}}else{k[5358]=d|1<<b;i=21472+((b<<1)+2<<2)|0;l=21472+(b<<1<<2)|0}k[i>>2]=e;k[l+12>>2]=e;k[e+8>>2]=l;k[e+12>>2]=21472+(b<<1<<2)}k[5360]=f;k[5363]=g;F=a+8|0;return F|0}a=k[5359]|0;if(a){i=((a&0-a)+-1|0)>>>(((a&0-a)+-1|0)>>>12&16);j=i>>>(i>>>5&8)>>>(i>>>(i>>>5&8)>>>2&4);j=k[21736+((i>>>5&8|((a&0-a)+-1|0)>>>12&16|i>>>(i>>>5&8)>>>2&4|j>>>1&2|j>>>(j>>>1&2)>>>1&1)+(j>>>(j>>>1&2)>>>(j>>>(j>>>1&2)>>>1&1))<<2)>>2]|0;i=(k[j+4>>2]&-8)-b|0;e=j;while(1){c=k[e+16>>2]|0;if(!c){c=k[e+20>>2]|0;if(!c)break}e=(k[c+4>>2]&-8)-b|0;F=e>>>0<i>>>0;i=F?e:i;e=c;j=F?c:j}a=k[5362]|0;if(j>>>0<a>>>0)Fb();h=j+b|0;if(j>>>0>=h>>>0)Fb();c=k[j+24>>2]|0;e=k[j+12>>2]|0;do if((e|0)==(j|0)){d=j+20|0;e=k[d>>2]|0;if(!e){d=j+16|0;e=k[d>>2]|0;if(!e){m=0;break}}while(1){g=e+20|0;f=k[g>>2]|0;if(f){e=f;d=g;continue}g=e+16|0;f=k[g>>2]|0;if(!f)break;else{e=f;d=g}}if(d>>>0<a>>>0)Fb();else{k[d>>2]=0;m=e;break}}else{d=k[j+8>>2]|0;if(d>>>0<a>>>0)Fb();if((k[d+12>>2]|0)!=(j|0))Fb();if((k[e+8>>2]|0)==(j|0)){k[d+12>>2]=e;k[e+8>>2]=d;m=e;break}else Fb()}while(0);do if(c){d=k[j+28>>2]|0;if((j|0)==(k[21736+(d<<2)>>2]|0)){k[21736+(d<<2)>>2]=m;if(!m){k[5359]=k[5359]&~(1<<d);break}}else{if(c>>>0<(k[5362]|0)>>>0)Fb();if((k[c+16>>2]|0)==(j|0))k[c+16>>2]=m;else k[c+20>>2]=m;if(!m)break}e=k[5362]|0;if(m>>>0<e>>>0)Fb();k[m+24>>2]=c;d=k[j+16>>2]|0;do if(d)if(d>>>0<e>>>0)Fb();else{k[m+16>>2]=d;k[d+24>>2]=m;break}while(0);d=k[j+20>>2]|0;if(d)if(d>>>0<(k[5362]|0)>>>0)Fb();else{k[m+20>>2]=d;k[d+24>>2]=m;break}}while(0);if(i>>>0<16){F=i+b|0;k[j+4>>2]=F|3;F=j+(F+4)|0;k[F>>2]=k[F>>2]|1}else{k[j+4>>2]=b|3;k[j+(b|4)>>2]=i|1;k[j+(i+b)>>2]=i;c=k[5360]|0;if(c){b=k[5363]|0;d=k[5358]|0;if(d&1<<(c>>>3)){d=k[21472+((c>>>3<<1)+2<<2)>>2]|0;if(d>>>0<(k[5362]|0)>>>0)Fb();else{o=21472+((c>>>3<<1)+2<<2)|0;n=d}}else{k[5358]=d|1<<(c>>>3);o=21472+((c>>>3<<1)+2<<2)|0;n=21472+(c>>>3<<1<<2)|0}k[o>>2]=b;k[n+12>>2]=b;k[b+8>>2]=n;k[b+12>>2]=21472+(c>>>3<<1<<2)}k[5360]=i;k[5363]=h}F=j+8|0;return F|0}else q=b}else q=b}else if(a>>>0<=4294967231){o=a+11&-8;i=k[5359]|0;if(i){if((a+11|0)>>>8)if(o>>>0>16777215)j=31;else{j=(a+11|0)>>>8<<((((a+11|0)>>>8)+1048320|0)>>>16&8);j=14-((j+520192|0)>>>16&4|(((a+11|0)>>>8)+1048320|0)>>>16&8|((j<<((j+520192|0)>>>16&4))+245760|0)>>>16&2)+(j<<((j+520192|0)>>>16&4)<<(((j<<((j+520192|0)>>>16&4))+245760|0)>>>16&2)>>>15)|0;j=o>>>(j+7|0)&1|j<<1}else j=0;e=k[21736+(j<<2)>>2]|0;a:do if(!e){f=0-o|0;a=0;g=0;w=90}else{if((j|0)==31)g=0;else g=25-(j>>>1)|0;f=0-o|0;a=0;h=o<<g;g=0;while(1){d=k[e+4>>2]&-8;if((d-o|0)>>>0<f>>>0)if((d|0)==(o|0)){f=d-o|0;a=e;g=e;w=94;break a}else{f=d-o|0;g=e}w=k[e+20>>2]|0;e=k[e+16+(h>>>31<<2)>>2]|0;a=(w|0)==0|(w|0)==(e|0)?a:w;if(!e){w=90;break}else h=h<<1}}while(0);if((w|0)==90){if((a|0)==0&(g|0)==0){a=2<<j;if(!(i&(a|0-a))){q=o;break}m=(i&(a|0-a)&0-(i&(a|0-a)))+-1|0;n=m>>>(m>>>12&16)>>>(m>>>(m>>>12&16)>>>5&8);a=n>>>(n>>>2&4)>>>(n>>>(n>>>2&4)>>>1&2);a=k[21736+((m>>>(m>>>12&16)>>>5&8|m>>>12&16|n>>>2&4|n>>>(n>>>2&4)>>>1&2|a>>>1&1)+(a>>>(a>>>1&1))<<2)>>2]|0}if(!a){j=f;n=g}else w=94}if((w|0)==94)while(1){w=0;n=(k[a+4>>2]&-8)-o|0;e=n>>>0<f>>>0;f=e?n:f;g=e?a:g;e=k[a+16>>2]|0;if(e){a=e;w=94;continue}a=k[a+20>>2]|0;if(!a){j=f;n=g;break}else w=94}if((n|0)!=0?j>>>0<((k[5360]|0)-o|0)>>>0:0){a=k[5362]|0;if(n>>>0<a>>>0)Fb();l=n+o|0;if(n>>>0>=l>>>0)Fb();c=k[n+24>>2]|0;e=k[n+12>>2]|0;do if((e|0)==(n|0)){g=n+20|0;e=k[g>>2]|0;if(!e){g=n+16|0;e=k[g>>2]|0;if(!e){p=0;break}}while(1){f=e+20|0;d=k[f>>2]|0;if(d){e=d;g=f;continue}f=e+16|0;d=k[f>>2]|0;if(!d)break;else{e=d;g=f}}if(g>>>0<a>>>0)Fb();else{k[g>>2]=0;p=e;break}}else{d=k[n+8>>2]|0;if(d>>>0<a>>>0)Fb();if((k[d+12>>2]|0)!=(n|0))Fb();if((k[e+8>>2]|0)==(n|0)){k[d+12>>2]=e;k[e+8>>2]=d;p=e;break}else Fb()}while(0);do if(c){e=k[n+28>>2]|0;if((n|0)==(k[21736+(e<<2)>>2]|0)){k[21736+(e<<2)>>2]=p;if(!p){k[5359]=k[5359]&~(1<<e);break}}else{if(c>>>0<(k[5362]|0)>>>0)Fb();if((k[c+16>>2]|0)==(n|0))k[c+16>>2]=p;else k[c+20>>2]=p;if(!p)break}d=k[5362]|0;if(p>>>0<d>>>0)Fb();k[p+24>>2]=c;e=k[n+16>>2]|0;do if(e)if(e>>>0<d>>>0)Fb();else{k[p+16>>2]=e;k[e+24>>2]=p;break}while(0);d=k[n+20>>2]|0;if(d)if(d>>>0<(k[5362]|0)>>>0)Fb();else{k[p+20>>2]=d;k[d+24>>2]=p;break}}while(0);b:do if(j>>>0>=16){k[n+4>>2]=o|3;k[n+(o|4)>>2]=j|1;k[n+(j+o)>>2]=j;e=j>>>3;if(j>>>0<256){c=k[5358]|0;if(c&1<<e){c=k[21472+((e<<1)+2<<2)>>2]|0;if(c>>>0<(k[5362]|0)>>>0)Fb();else{b=21472+((e<<1)+2<<2)|0;q=c}}else{k[5358]=c|1<<e;b=21472+((e<<1)+2<<2)|0;q=21472+(e<<1<<2)|0}k[b>>2]=l;k[q+12>>2]=l;k[n+(o+8)>>2]=q;k[n+(o+12)>>2]=21472+(e<<1<<2);break}c=j>>>8;if(c)if(j>>>0>16777215)e=31;else{e=c<<((c+1048320|0)>>>16&8)<<(((c<<((c+1048320|0)>>>16&8))+520192|0)>>>16&4);e=14-(((c<<((c+1048320|0)>>>16&8))+520192|0)>>>16&4|(c+1048320|0)>>>16&8|(e+245760|0)>>>16&2)+(e<<((e+245760|0)>>>16&2)>>>15)|0;e=j>>>(e+7|0)&1|e<<1}else e=0;d=21736+(e<<2)|0;k[n+(o+28)>>2]=e;k[n+(o+20)>>2]=0;k[n+(o+16)>>2]=0;c=k[5359]|0;b=1<<e;if(!(c&b)){k[5359]=c|b;k[d>>2]=l;k[n+(o+24)>>2]=d;k[n+(o+12)>>2]=l;k[n+(o+8)>>2]=l;break}d=k[d>>2]|0;if((e|0)==31)c=0;else c=25-(e>>>1)|0;c:do if((k[d+4>>2]&-8|0)!=(j|0)){e=j<<c;while(1){b=d+16+(e>>>31<<2)|0;c=k[b>>2]|0;if(!c)break;if((k[c+4>>2]&-8|0)==(j|0)){v=c;break c}else{e=e<<1;d=c}}if(b>>>0<(k[5362]|0)>>>0)Fb();else{k[b>>2]=l;k[n+(o+24)>>2]=d;k[n+(o+12)>>2]=l;k[n+(o+8)>>2]=l;break b}}else v=d;while(0);c=v+8|0;b=k[c>>2]|0;F=k[5362]|0;if(v>>>0>=F>>>0&b>>>0>=F>>>0){k[b+12>>2]=l;k[c>>2]=l;k[n+(o+8)>>2]=b;k[n+(o+12)>>2]=v;k[n+(o+24)>>2]=0;break}else Fb()}else{F=j+o|0;k[n+4>>2]=F|3;F=n+(F+4)|0;k[F>>2]=k[F>>2]|1}while(0);F=n+8|0;return F|0}else q=o}else q=o}else q=-1;while(0);a=k[5360]|0;if(a>>>0>=q>>>0){c=a-q|0;b=k[5363]|0;if(c>>>0>15){k[5363]=b+q;k[5360]=c;k[b+(q+4)>>2]=c|1;k[b+a>>2]=c;k[b+4>>2]=q|3}else{k[5360]=0;k[5363]=0;k[b+4>>2]=a|3;k[b+(a+4)>>2]=k[b+(a+4)>>2]|1}F=b+8|0;return F|0}a=k[5361]|0;if(a>>>0>q>>>0){E=a-q|0;k[5361]=E;F=k[5364]|0;k[5364]=F+q;k[F+(q+4)>>2]=E|1;k[F+4>>2]=q|3;F=F+8|0;return F|0}do if(!(k[5476]|0)){a=ub(30)|0;if(!(a+-1&a)){k[5478]=a;k[5477]=a;k[5479]=-1;k[5480]=-1;k[5481]=0;k[5469]=0;v=(Ib(0)|0)&-16^1431655768;k[5476]=v;break}else Fb()}while(0);j=q+48|0;f=k[5478]|0;i=q+47|0;h=f+i&0-f;if(h>>>0<=q>>>0){F=0;return F|0}a=k[5468]|0;if((a|0)!=0?(v=k[5466]|0,(v+h|0)>>>0<=v>>>0|(v+h|0)>>>0>a>>>0):0){F=0;return F|0}d:do if(!(k[5469]&4)){g=k[5364]|0;e:do if(g){e=21880;while(1){a=k[e>>2]|0;if(a>>>0<=g>>>0?(c=e+4|0,(a+(k[c>>2]|0)|0)>>>0>g>>>0):0)break;a=k[e+8>>2]|0;if(!a){w=180;break e}else e=a}a=f+i-(k[5361]|0)&0-f;if(a>>>0<2147483647){g=nb(a|0)|0;if((g|0)==((k[e>>2]|0)+(k[c>>2]|0)|0)){if((g|0)!=(-1|0)){v=g;p=a;w=200;break d}}else w=190}else a=0}else w=180;while(0);do if((w|0)==180){e=nb(0)|0;if((e|0)!=(-1|0)){a=k[5477]|0;if(!(a+-1&e))a=h;else a=h-e+(a+-1+e&0-a)|0;g=k[5466]|0;f=g+a|0;if(a>>>0>q>>>0&a>>>0<2147483647){v=k[5468]|0;if((v|0)!=0?f>>>0<=g>>>0|f>>>0>v>>>0:0){a=0;break}g=nb(a|0)|0;if((g|0)==(e|0)){v=e;p=a;w=200;break d}else w=190}else a=0}else a=0}while(0);f:do if((w|0)==190){f=0-a|0;do if(j>>>0>a>>>0&(a>>>0<2147483647&(g|0)!=(-1|0))?(r=k[5478]|0,r=i-a+r&0-r,r>>>0<2147483647):0)if((nb(r|0)|0)==(-1|0)){nb(f|0)|0;a=0;break f}else{a=r+a|0;break}while(0);if((g|0)==(-1|0))a=0;else{v=g;p=a;w=200;break d}}while(0);k[5469]=k[5469]|4;w=197}else{a=0;w=197}while(0);if((((w|0)==197?h>>>0<2147483647:0)?(s=nb(h|0)|0,t=nb(0)|0,s>>>0<t>>>0&((s|0)!=(-1|0)&(t|0)!=(-1|0))):0)?(u=(t-s|0)>>>0>(q+40|0)>>>0,u):0){v=s;p=u?t-s|0:a;w=200}if((w|0)==200){g=(k[5466]|0)+p|0;k[5466]=g;if(g>>>0>(k[5467]|0)>>>0)k[5467]=g;j=k[5364]|0;g:do if(j){d=21880;while(1){a=k[d>>2]|0;g=d+4|0;f=k[g>>2]|0;if((v|0)==(a+f|0)){w=212;break}e=k[d+8>>2]|0;if(!e)break;else d=e}if(((w|0)==212?(k[d+12>>2]&8|0)==0:0)?j>>>0<v>>>0&j>>>0>=a>>>0:0){k[g>>2]=f+p;c=(k[5361]|0)+p|0;if(!(j+8&7))b=0;else b=0-(j+8)&7;F=c-b|0;k[5364]=j+b;k[5361]=F;k[j+(b+4)>>2]=F|1;k[j+(c+4)>>2]=40;k[5365]=k[5480];break}a=k[5362]|0;if(v>>>0<a>>>0){k[5362]=v;a=v}f=v+p|0;g=21880;while(1){if((k[g>>2]|0)==(f|0)){w=222;break}g=k[g+8>>2]|0;if(!g){e=21880;break}}if((w|0)==222)if(!(k[g+12>>2]&8)){k[g>>2]=v;e=g+4|0;k[e>>2]=(k[e>>2]|0)+p;e=v+8|0;if(!(e&7))o=0;else o=0-e&7;e=v+(p+8)|0;if(!(e&7))b=0;else b=0-e&7;e=v+(b+p)|0;m=o+q|0;n=v+m|0;l=e-(v+o)-q|0;k[v+(o+4)>>2]=q|3;h:do if((e|0)!=(j|0)){if((e|0)==(k[5363]|0)){F=(k[5360]|0)+l|0;k[5360]=F;k[5363]=n;k[v+(m+4)>>2]=F|1;k[v+(F+m)>>2]=F;break}j=p+4|0;i=k[v+(j+b)>>2]|0;if((i&3|0)==1){i:do if(i>>>0>=256){h=k[v+((b|24)+p)>>2]|0;g=k[v+(p+12+b)>>2]|0;do if((g|0)==(e|0)){f=b|16;d=v+(j+f)|0;g=k[d>>2]|0;if(!g){f=v+(f+p)|0;g=k[f>>2]|0;if(!g){C=0;break}}else f=d;while(1){d=g+20|0;c=k[d>>2]|0;if(c){g=c;f=d;continue}d=g+16|0;c=k[d>>2]|0;if(!c)break;else{g=c;f=d}}if(f>>>0<a>>>0)Fb();else{k[f>>2]=0;C=g;break}}else{f=k[v+((b|8)+p)>>2]|0;if(f>>>0<a>>>0)Fb();if((k[f+12>>2]|0)!=(e|0))Fb();if((k[g+8>>2]|0)==(e|0)){k[f+12>>2]=g;k[g+8>>2]=f;C=g;break}else Fb()}while(0);if(!h)break;a=k[v+(p+28+b)>>2]|0;do if((e|0)!=(k[21736+(a<<2)>>2]|0)){if(h>>>0<(k[5362]|0)>>>0)Fb();if((k[h+16>>2]|0)==(e|0))k[h+16>>2]=C;else k[h+20>>2]=C;if(!C)break i}else{k[21736+(a<<2)>>2]=C;if(C)break;k[5359]=k[5359]&~(1<<a);break i}while(0);f=k[5362]|0;if(C>>>0<f>>>0)Fb();k[C+24>>2]=h;a=b|16;g=k[v+(a+p)>>2]|0;do if(g)if(g>>>0<f>>>0)Fb();else{k[C+16>>2]=g;k[g+24>>2]=C;break}while(0);g=k[v+(j+a)>>2]|0;if(!g)break;if(g>>>0<(k[5362]|0)>>>0)Fb();else{k[C+20>>2]=g;k[g+24>>2]=C;break}}else{g=k[v+((b|8)+p)>>2]|0;f=k[v+(p+12+b)>>2]|0;do if((g|0)!=(21472+(i>>>3<<1<<2)|0)){if(g>>>0<a>>>0)Fb();if((k[g+12>>2]|0)==(e|0))break;Fb()}while(0);if((f|0)==(g|0)){k[5358]=k[5358]&~(1<<(i>>>3));break}do if((f|0)==(21472+(i>>>3<<1<<2)|0))A=f+8|0;else{if(f>>>0<a>>>0)Fb();if((k[f+8>>2]|0)==(e|0)){A=f+8|0;break}Fb()}while(0);k[g+12>>2]=f;k[A>>2]=g}while(0);e=v+((i&-8|b)+p)|0;a=(i&-8)+l|0}else a=l;e=e+4|0;k[e>>2]=k[e>>2]&-2;k[v+(m+4)>>2]=a|1;k[v+(a+m)>>2]=a;e=a>>>3;if(a>>>0<256){d=k[5358]|0;do if(!(d&1<<e)){k[5358]=d|1<<e;D=21472+((e<<1)+2<<2)|0;E=21472+(e<<1<<2)|0}else{d=k[21472+((e<<1)+2<<2)>>2]|0;if(d>>>0>=(k[5362]|0)>>>0){D=21472+((e<<1)+2<<2)|0;E=d;break}Fb()}while(0);k[D>>2]=n;k[E+12>>2]=n;k[v+(m+8)>>2]=E;k[v+(m+12)>>2]=21472+(e<<1<<2);break}c=a>>>8;do if(!c)b=0;else{if(a>>>0>16777215){b=31;break}b=c<<((c+1048320|0)>>>16&8)<<(((c<<((c+1048320|0)>>>16&8))+520192|0)>>>16&4);b=14-(((c<<((c+1048320|0)>>>16&8))+520192|0)>>>16&4|(c+1048320|0)>>>16&8|(b+245760|0)>>>16&2)+(b<<((b+245760|0)>>>16&2)>>>15)|0;b=a>>>(b+7|0)&1|b<<1}while(0);e=21736+(b<<2)|0;k[v+(m+28)>>2]=b;k[v+(m+20)>>2]=0;k[v+(m+16)>>2]=0;d=k[5359]|0;c=1<<b;if(!(d&c)){k[5359]=d|c;k[e>>2]=n;k[v+(m+24)>>2]=e;k[v+(m+12)>>2]=n;k[v+(m+8)>>2]=n;break}e=k[e>>2]|0;if((b|0)==31)d=0;else d=25-(b>>>1)|0;j:do if((k[e+4>>2]&-8|0)!=(a|0)){b=a<<d;while(1){c=e+16+(b>>>31<<2)|0;d=k[c>>2]|0;if(!d)break;if((k[d+4>>2]&-8|0)==(a|0)){F=d;break j}else{b=b<<1;e=d}}if(c>>>0<(k[5362]|0)>>>0)Fb();else{k[c>>2]=n;k[v+(m+24)>>2]=e;k[v+(m+12)>>2]=n;k[v+(m+8)>>2]=n;break h}}else F=e;while(0);c=F+8|0;b=k[c>>2]|0;E=k[5362]|0;if(F>>>0>=E>>>0&b>>>0>=E>>>0){k[b+12>>2]=n;k[c>>2]=n;k[v+(m+8)>>2]=b;k[v+(m+12)>>2]=F;k[v+(m+24)>>2]=0;break}else Fb()}else{F=(k[5361]|0)+l|0;k[5361]=F;k[5364]=n;k[v+(m+4)>>2]=F|1}while(0);F=v+(o|8)|0;return F|0}else e=21880;while(1){a=k[e>>2]|0;if(a>>>0<=j>>>0?(x=k[e+4>>2]|0,(a+x|0)>>>0>j>>>0):0)break;e=k[e+8>>2]|0}if(!(a+(x+-39)&7))e=0;else e=0-(a+(x+-39))&7;g=a+(x+-47+e)|0;g=g>>>0<(j+16|0)>>>0?j:g;e=v+8|0;if(!(e&7))e=0;else e=0-e&7;F=p+-40-e|0;k[5364]=v+e;k[5361]=F;k[v+(e+4)>>2]=F|1;k[v+(p+-36)>>2]=40;k[5365]=k[5480];k[g+4>>2]=27;k[g+8>>2]=k[5470];k[g+8+4>>2]=k[5471];k[g+8+8>>2]=k[5472];k[g+8+12>>2]=k[5473];k[5470]=v;k[5471]=p;k[5473]=0;k[5472]=g+8;k[g+28>>2]=7;if((g+32|0)>>>0<(a+x|0)>>>0){d=g+28|0;do{F=d;d=d+4|0;k[d>>2]=7}while((F+8|0)>>>0<(a+x|0)>>>0)}if((g|0)!=(j|0)){k[g+4>>2]=k[g+4>>2]&-2;k[j+4>>2]=g-j|1;k[g>>2]=g-j;if((g-j|0)>>>0<256){c=k[5358]|0;do if(!(c&1<<((g-j|0)>>>3))){k[5358]=c|1<<((g-j|0)>>>3);y=21472+(((g-j|0)>>>3<<1)+2<<2)|0;z=21472+((g-j|0)>>>3<<1<<2)|0}else{c=k[21472+(((g-j|0)>>>3<<1)+2<<2)>>2]|0;if(c>>>0>=(k[5362]|0)>>>0){y=21472+(((g-j|0)>>>3<<1)+2<<2)|0;z=c;break}Fb()}while(0);k[y>>2]=j;k[z+12>>2]=j;k[j+8>>2]=z;k[j+12>>2]=21472+((g-j|0)>>>3<<1<<2);break}if((g-j|0)>>>8)if((g-j|0)>>>0>16777215)e=31;else{e=(g-j|0)>>>8<<((((g-j|0)>>>8)+1048320|0)>>>16&8);e=14-((e+520192|0)>>>16&4|(((g-j|0)>>>8)+1048320|0)>>>16&8|((e<<((e+520192|0)>>>16&4))+245760|0)>>>16&2)+(e<<((e+520192|0)>>>16&4)<<(((e<<((e+520192|0)>>>16&4))+245760|0)>>>16&2)>>>15)|0;e=(g-j|0)>>>(e+7|0)&1|e<<1}else e=0;c=21736+(e<<2)|0;k[j+28>>2]=e;k[j+20>>2]=0;k[j+16>>2]=0;b=k[5359]|0;d=1<<e;if(!(b&d)){k[5359]=b|d;k[c>>2]=j;k[j+24>>2]=c;k[j+12>>2]=j;k[j+8>>2]=j;break}d=k[c>>2]|0;if((e|0)==31)c=0;else c=25-(e>>>1)|0;k:do if((k[d+4>>2]&-8|0)!=(g-j|0)){e=g-j<<c;while(1){b=d+16+(e>>>31<<2)|0;c=k[b>>2]|0;if(!c)break;if((k[c+4>>2]&-8|0)==(g-j|0)){B=c;break k}else{e=e<<1;d=c}}if(b>>>0<(k[5362]|0)>>>0)Fb();else{k[b>>2]=j;k[j+24>>2]=d;k[j+12>>2]=j;k[j+8>>2]=j;break g}}else B=d;while(0);c=B+8|0;b=k[c>>2]|0;F=k[5362]|0;if(B>>>0>=F>>>0&b>>>0>=F>>>0){k[b+12>>2]=j;k[c>>2]=j;k[j+8>>2]=b;k[j+12>>2]=B;k[j+24>>2]=0;break}else Fb()}}else{F=k[5362]|0;if((F|0)==0|v>>>0<F>>>0)k[5362]=v;k[5470]=v;k[5471]=p;k[5473]=0;k[5367]=k[5476];k[5366]=-1;c=0;do{F=c<<1;k[21472+(F+3<<2)>>2]=21472+(F<<2);k[21472+(F+2<<2)>>2]=21472+(F<<2);c=c+1|0}while((c|0)!=32);c=v+8|0;if(!(c&7))c=0;else c=0-c&7;F=p+-40-c|0;k[5364]=v+c;k[5361]=F;k[v+(c+4)>>2]=F|1;k[v+(p+-36)>>2]=40;k[5365]=k[5480]}while(0);b=k[5361]|0;if(b>>>0>q>>>0){E=b-q|0;k[5361]=E;F=k[5364]|0;k[5364]=F+q;k[F+(q+4)>>2]=E|1;k[F+4>>2]=q|3;F=F+8|0;return F|0}}F=Bb()|0;k[F>>2]=12;F=0;return F|0}function jF(a){a=a|0;var b=0,c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0;if(!a)return;h=k[5362]|0;if((a+-8|0)>>>0<h>>>0)Fb();p=k[a+-4>>2]|0;if((p&3|0)==1)Fb();o=a+((p&-8)+-8)|0;do if(!(p&1)){j=k[a+-8>>2]|0;if(!(p&3))return;l=a+(-8-j)|0;m=j+(p&-8)|0;if(l>>>0<h>>>0)Fb();if((l|0)==(k[5363]|0)){e=k[a+((p&-8)+-4)>>2]|0;if((e&3|0)!=3){t=l;f=m;break}k[5360]=m;k[a+((p&-8)+-4)>>2]=e&-2;k[a+(-8-j+4)>>2]=m|1;k[o>>2]=m;return}if(j>>>0<256){e=k[a+(-8-j+8)>>2]|0;d=k[a+(-8-j+12)>>2]|0;if((e|0)!=(21472+(j>>>3<<1<<2)|0)){if(e>>>0<h>>>0)Fb();if((k[e+12>>2]|0)!=(l|0))Fb()}if((d|0)==(e|0)){k[5358]=k[5358]&~(1<<(j>>>3));t=l;f=m;break}if((d|0)!=(21472+(j>>>3<<1<<2)|0)){if(d>>>0<h>>>0)Fb();if((k[d+8>>2]|0)!=(l|0))Fb();else c=d+8|0}else c=d+8|0;k[e+12>>2]=d;k[c>>2]=e;t=l;f=m;break}b=k[a+(-8-j+24)>>2]|0;e=k[a+(-8-j+12)>>2]|0;do if((e|0)==(l|0)){e=k[a+(-8-j+20)>>2]|0;if(!e){e=k[a+(-8-j+16)>>2]|0;if(!e){i=0;break}else g=a+(-8-j+16)|0}else g=a+(-8-j+20)|0;while(1){d=e+20|0;c=k[d>>2]|0;if(c){e=c;g=d;continue}d=e+16|0;c=k[d>>2]|0;if(!c)break;else{e=c;g=d}}if(g>>>0<h>>>0)Fb();else{k[g>>2]=0;i=e;break}}else{d=k[a+(-8-j+8)>>2]|0;if(d>>>0<h>>>0)Fb();if((k[d+12>>2]|0)!=(l|0))Fb();if((k[e+8>>2]|0)==(l|0)){k[d+12>>2]=e;k[e+8>>2]=d;i=e;break}else Fb()}while(0);if(b){e=k[a+(-8-j+28)>>2]|0;if((l|0)==(k[21736+(e<<2)>>2]|0)){k[21736+(e<<2)>>2]=i;if(!i){k[5359]=k[5359]&~(1<<e);t=l;f=m;break}}else{if(b>>>0<(k[5362]|0)>>>0)Fb();if((k[b+16>>2]|0)==(l|0))k[b+16>>2]=i;else k[b+20>>2]=i;if(!i){t=l;f=m;break}}d=k[5362]|0;if(i>>>0<d>>>0)Fb();k[i+24>>2]=b;e=k[a+(-8-j+16)>>2]|0;do if(e)if(e>>>0<d>>>0)Fb();else{k[i+16>>2]=e;k[e+24>>2]=i;break}while(0);e=k[a+(-8-j+20)>>2]|0;if(e)if(e>>>0<(k[5362]|0)>>>0)Fb();else{k[i+20>>2]=e;k[e+24>>2]=i;t=l;f=m;break}else{t=l;f=m}}else{t=l;f=m}}else{t=a+-8|0;f=p&-8}while(0);if(t>>>0>=o>>>0)Fb();c=k[a+((p&-8)+-4)>>2]|0;if(!(c&1))Fb();if(!(c&2)){if((o|0)==(k[5364]|0)){u=(k[5361]|0)+f|0;k[5361]=u;k[5364]=t;k[t+4>>2]=u|1;if((t|0)!=(k[5363]|0))return;k[5363]=0;k[5360]=0;return}if((o|0)==(k[5363]|0)){u=(k[5360]|0)+f|0;k[5360]=u;k[5363]=t;k[t+4>>2]=u|1;k[t+u>>2]=u;return}f=(c&-8)+f|0;do if(c>>>0>=256){g=k[a+((p&-8)+16)>>2]|0;e=k[a+(p&-8|4)>>2]|0;do if((e|0)==(o|0)){e=k[a+((p&-8)+12)>>2]|0;if(!e){e=k[a+((p&-8)+8)>>2]|0;if(!e){q=0;break}else b=a+((p&-8)+8)|0}else b=a+((p&-8)+12)|0;while(1){d=e+20|0;c=k[d>>2]|0;if(c){e=c;b=d;continue}d=e+16|0;c=k[d>>2]|0;if(!c)break;else{e=c;b=d}}if(b>>>0<(k[5362]|0)>>>0)Fb();else{k[b>>2]=0;q=e;break}}else{d=k[a+(p&-8)>>2]|0;if(d>>>0<(k[5362]|0)>>>0)Fb();if((k[d+12>>2]|0)!=(o|0))Fb();if((k[e+8>>2]|0)==(o|0)){k[d+12>>2]=e;k[e+8>>2]=d;q=e;break}else Fb()}while(0);if(g){e=k[a+((p&-8)+20)>>2]|0;if((o|0)==(k[21736+(e<<2)>>2]|0)){k[21736+(e<<2)>>2]=q;if(!q){k[5359]=k[5359]&~(1<<e);break}}else{if(g>>>0<(k[5362]|0)>>>0)Fb();if((k[g+16>>2]|0)==(o|0))k[g+16>>2]=q;else k[g+20>>2]=q;if(!q)break}d=k[5362]|0;if(q>>>0<d>>>0)Fb();k[q+24>>2]=g;e=k[a+((p&-8)+8)>>2]|0;do if(e)if(e>>>0<d>>>0)Fb();else{k[q+16>>2]=e;k[e+24>>2]=q;break}while(0);c=k[a+((p&-8)+12)>>2]|0;if(c)if(c>>>0<(k[5362]|0)>>>0)Fb();else{k[q+20>>2]=c;k[c+24>>2]=q;break}}}else{d=k[a+(p&-8)>>2]|0;e=k[a+(p&-8|4)>>2]|0;if((d|0)!=(21472+(c>>>3<<1<<2)|0)){if(d>>>0<(k[5362]|0)>>>0)Fb();if((k[d+12>>2]|0)!=(o|0))Fb()}if((e|0)==(d|0)){k[5358]=k[5358]&~(1<<(c>>>3));break}if((e|0)!=(21472+(c>>>3<<1<<2)|0)){if(e>>>0<(k[5362]|0)>>>0)Fb();if((k[e+8>>2]|0)!=(o|0))Fb();else n=e+8|0}else n=e+8|0;k[d+12>>2]=e;k[n>>2]=d}while(0);k[t+4>>2]=f|1;k[t+f>>2]=f;if((t|0)==(k[5363]|0)){k[5360]=f;return}}else{k[a+((p&-8)+-4)>>2]=c&-2;k[t+4>>2]=f|1;k[t+f>>2]=f}d=f>>>3;if(f>>>0<256){c=k[5358]|0;if(c&1<<d){c=k[21472+((d<<1)+2<<2)>>2]|0;if(c>>>0<(k[5362]|0)>>>0)Fb();else{r=21472+((d<<1)+2<<2)|0;s=c}}else{k[5358]=c|1<<d;r=21472+((d<<1)+2<<2)|0;s=21472+(d<<1<<2)|0}k[r>>2]=t;k[s+12>>2]=t;k[t+8>>2]=s;k[t+12>>2]=21472+(d<<1<<2);return}b=f>>>8;if(b)if(f>>>0>16777215)e=31;else{e=b<<((b+1048320|0)>>>16&8)<<(((b<<((b+1048320|0)>>>16&8))+520192|0)>>>16&4);e=14-(((b<<((b+1048320|0)>>>16&8))+520192|0)>>>16&4|(b+1048320|0)>>>16&8|(e+245760|0)>>>16&2)+(e<<((e+245760|0)>>>16&2)>>>15)|0;e=f>>>(e+7|0)&1|e<<1}else e=0;c=21736+(e<<2)|0;k[t+28>>2]=e;k[t+20>>2]=0;k[t+16>>2]=0;b=k[5359]|0;d=1<<e;a:do if(b&d){d=k[c>>2]|0;if((e|0)==31)c=0;else c=25-(e>>>1)|0;b:do if((k[d+4>>2]&-8|0)!=(f|0)){e=f<<c;while(1){b=d+16+(e>>>31<<2)|0;c=k[b>>2]|0;if(!c)break;if((k[c+4>>2]&-8|0)==(f|0)){u=c;break b}else{e=e<<1;d=c}}if(b>>>0<(k[5362]|0)>>>0)Fb();else{k[b>>2]=t;k[t+24>>2]=d;k[t+12>>2]=t;k[t+8>>2]=t;break a}}else u=d;while(0);b=u+8|0;c=k[b>>2]|0;s=k[5362]|0;if(u>>>0>=s>>>0&c>>>0>=s>>>0){k[c+12>>2]=t;k[b>>2]=t;k[t+8>>2]=c;k[t+12>>2]=u;k[t+24>>2]=0;break}else Fb()}else{k[5359]=b|d;k[c>>2]=t;k[t+24>>2]=c;k[t+12>>2]=t;k[t+8>>2]=t}while(0);u=(k[5366]|0)+-1|0;k[5366]=u;if(!u)b=21888;else return;while(1){b=k[b>>2]|0;if(!b)break;else b=b+8|0}k[5366]=-1;return}function kF(a,b){a=+a;b=+b;var c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0;j=(o[t>>2]=a,k[t>>2]|0);g=(o[t>>2]=b,k[t>>2]|0);if((g<<1|0)!=0?!((g&2147483647)>>>0>2139095040|(j>>>23&255|0)==255):0){if(j<<1>>>0<=g<<1>>>0){if((j<<1|0)!=(g<<1|0))return +a;a=a*0.0;return +a}if(!(j>>>23&255)){if((j<<9|0)>-1){d=0;c=j<<9;do{d=d+-1|0;c=c<<1}while((c|0)>-1)}else d=0;c=d;e=j<<1-d}else{c=j>>>23&255;e=j&8388607|8388608}if(!(g>>>23&255)){if((g<<9|0)>-1){d=0;f=g<<9;do{d=d+-1|0;f=f<<1}while((f|0)>-1)}else d=0;h=d;i=g<<1-d}else{h=g>>>23&255;i=g&8388607|8388608}f=e-i|0;a:do if((c|0)>(h|0)){g=(f|0)>-1;d=f;while(1){if(g){if((e|0)==(i|0))break}else d=e;e=d<<1;c=c+-1|0;f=e-i|0;if((c|0)>(h|0)){g=(f|0)>-1;d=f}else{d=f;f=(f|0)>-1;break a}}a=a*0.0;return +a}else{d=f;f=(f|0)>-1}while(0);if(f){if((e|0)==(i|0)){a=a*0.0;return +a}}else d=e;if(d>>>0<8388608)do{d=d<<1;c=c+-1|0}while(d>>>0<8388608);if((c|0)>0)c=d+-8388608|c<<23;else c=d>>>(1-c|0);a=(k[t>>2]=c|j&-2147483648,+o[t>>2]);return +a}a=a*b/(a*b);return +a}function lF(){}function mF(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;d=b-d-(c>>>0>a>>>0|0)>>>0;return (M=d,a-c>>>0|0)|0}function nF(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0,f=0;d=a+c|0;if((c|0)>=20){b=b&255;e=a&3;f=b|b<<8|b<<16|b<<24;if(e){e=a+4-e|0;while((a|0)<(e|0)){i[a>>0]=b;a=a+1|0}}while((a|0)<(d&~3|0)){k[a>>2]=f;a=a+4|0}}while((a|0)<(d|0)){i[a>>0]=b;a=a+1|0}return a-c|0}function oF(a){a=a|0;var b=0;b=a;while(i[b>>0]|0)b=b+1|0;return b-a|0}function pF(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;return (M=b+d+(a+c>>>0>>>0<a>>>0|0)>>>0,a+c>>>0|0)|0}function qF(a,b,c){a=a|0;b=b|0;c=c|0;var d=0;if((c|0)>=4096)return xb(a|0,b|0,c|0)|0;d=a|0;if((a&3)==(b&3)){while(a&3){if(!c)return d|0;i[a>>0]=i[b>>0]|0;a=a+1|0;b=b+1|0;c=c-1|0}while((c|0)>=4){k[a>>2]=k[b>>2];a=a+4|0;b=b+4|0;c=c-4|0}}while((c|0)>0){i[a>>0]=i[b>>0]|0;a=a+1|0;b=b+1|0;c=c-1|0}return d|0}function rF(a,b,c){a=a|0;b=b|0;c=c|0;var d=0;if((b|0)<(a|0)&(a|0)<(b+c|0)){d=a;b=b+c|0;a=a+c|0;while((c|0)>0){a=a-1|0;b=b-1|0;c=c-1|0;i[a>>0]=i[b>>0]|0}a=d}else qF(a,b,c)|0;return a|0}function sF(a){a=a|0;return (a&255)<<24|(a>>8&255)<<16|(a>>16&255)<<8|a>>>24|0}function tF(a,b,c){a=a|0;b=b|0;c=c|0;if((c|0)<32){M=b<<c|(a&(1<<c)-1<<32-c)>>>32-c;return a<<c}M=a<<c-32;return 0}function uF(a,b,c){a=a|0;b=b|0;c=c|0;if((c|0)<32){M=b>>>c;return a>>>c|(b&(1<<c)-1)<<32-c}M=0;return b>>>c-32|0}function vF(a,b,c){a=a|0;b=b|0;c=c|0;if((c|0)<32){M=b>>c;return a>>>c|(b&(1<<c)-1)<<32-c}M=(b|0)<0?-1:0;return b>>c-32|0}function wF(a){a=a|0;var b=0;b=i[v+(a&255)>>0]|0;if((b|0)<8)return b|0;b=i[v+(a>>8&255)>>0]|0;if((b|0)<8)return b+8|0;b=i[v+(a>>16&255)>>0]|0;if((b|0)<8)return b+16|0;return (i[v+(a>>>24)>>0]|0)+24|0}function xF(a,b){a=a|0;b=b|0;var c=0,d=0,e=0;c=ia(b&65535,a&65535)|0;e=(c>>>16)+(ia(b&65535,a>>>16)|0)|0;d=ia(b>>>16,a&65535)|0;return (M=(e>>>16)+(ia(b>>>16,a>>>16)|0)+(((e&65535)+d|0)>>>16)|0,e+d<<16|c&65535|0)|0}function yF(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0;g=b>>31|((b|0)<0?-1:0)<<1;e=((b|0)<0?-1:0)>>31|((b|0)<0?-1:0)<<1;h=d>>31|((d|0)<0?-1:0)<<1;f=((d|0)<0?-1:0)>>31|((d|0)<0?-1:0)<<1;a=mF(g^a,e^b,g,e)|0;b=M;return mF((DF(a,b,mF(h^c,f^d,h,f)|0,M,0)|0)^(h^g),M^(f^e),h^g,f^e)|0}function zF(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0,i=0;e=r;r=r+8|0;g=b>>31|((b|0)<0?-1:0)<<1;f=((b|0)<0?-1:0)>>31|((b|0)<0?-1:0)<<1;i=d>>31|((d|0)<0?-1:0)<<1;h=((d|0)<0?-1:0)>>31|((d|0)<0?-1:0)<<1;a=mF(g^a,f^b,g,f)|0;b=M;DF(a,b,mF(i^c,h^d,i,h)|0,M,e|0)|0;d=mF(k[e>>2]^g,k[e+4>>2]^f,g,f)|0;c=M;r=e;return (M=c,d)|0}function AF(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0;e=xF(a,c)|0;f=M;return (M=(ia(b,c)|0)+(ia(d,a)|0)+f|f&0,e|0|0)|0}function BF(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;return DF(a,b,c,d,0)|0}function CF(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;e=r;r=r+8|0;DF(a,b,c,d,e|0)|0;r=e;return (M=k[e+4>>2]|0,k[e>>2]|0)|0}function DF(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;var f=0,g=0,h=0,i=0,j=0,l=0,m=0,n=0,o=0,p=0;if(!b)if(!d){if(e){k[e>>2]=(a>>>0)%(c>>>0);k[e+4>>2]=0}d=0;e=(a>>>0)/(c>>>0)>>>0;return (M=d,e)|0}else{if(!e){d=0;e=0;return (M=d,e)|0}k[e>>2]=a|0;k[e+4>>2]=b&0;d=0;e=0;return (M=d,e)|0}do if(c){if(d){g=(ka(d|0)|0)-(ka(b|0)|0)|0;if(g>>>0<=31){i=g+1|0;h=a>>>((g+1|0)>>>0)&g-31>>31|b<<31-g;m=b>>>((g+1|0)>>>0)&g-31>>31;f=0;g=a<<31-g;break}if(!e){d=0;e=0;return (M=d,e)|0}k[e>>2]=a|0;k[e+4>>2]=b|b&0;d=0;e=0;return (M=d,e)|0}if(c-1&c){g=(ka(c|0)|0)+33-(ka(b|0)|0)|0;i=g;h=32-g-1>>31&b>>>((g-32|0)>>>0)|(b<<32-g|a>>>(g>>>0))&g-32>>31;m=g-32>>31&b>>>(g>>>0);f=a<<64-g&32-g>>31;g=(b<<64-g|a>>>((g-32|0)>>>0))&32-g>>31|a<<32-g&g-33>>31;break}if(e){k[e>>2]=c-1&a;k[e+4>>2]=0}if((c|0)==1){d=b|b&0;e=a|0|0;return (M=d,e)|0}else{e=wF(c|0)|0;d=b>>>(e>>>0)|0;e=b<<32-e|a>>>(e>>>0)|0;return (M=d,e)|0}}else{if(!d){if(e){k[e>>2]=(b>>>0)%(c>>>0);k[e+4>>2]=0}d=0;e=(b>>>0)/(c>>>0)>>>0;return (M=d,e)|0}if(!a){if(e){k[e>>2]=0;k[e+4>>2]=(b>>>0)%(d>>>0)}c=0;e=(b>>>0)/(d>>>0)>>>0;return (M=c,e)|0}if(!(d-1&d)){if(e){k[e>>2]=a|0;k[e+4>>2]=d-1&b|b&0}c=0;e=b>>>((wF(d|0)|0)>>>0);return (M=c,e)|0}g=(ka(d|0)|0)-(ka(b|0)|0)|0;if(g>>>0<=30){i=g+1|0;h=b<<31-g|a>>>((g+1|0)>>>0);m=b>>>((g+1|0)>>>0);f=0;g=a<<31-g;break}if(!e){d=0;e=0;return (M=d,e)|0}k[e>>2]=a|0;k[e+4>>2]=b|b&0;d=0;e=0;return (M=d,e)|0}while(0);if(!i){i=g;b=m;g=0;a=0}else{j=pF(c|0|0,d|d&0|0,-1,-1)|0;l=M;b=m;a=0;do{p=g;g=f>>>31|g<<1;f=a|f<<1;p=h<<1|p>>>31|0;o=h>>>31|b<<1|0;mF(j,l,p,o)|0;m=M;n=m>>31|((m|0)<0?-1:0)<<1;a=n&1;h=mF(p,o,n&(c|0),(((m|0)<0?-1:0)>>31|((m|0)<0?-1:0)<<1)&(d|d&0))|0;b=M;i=i-1|0}while((i|0)!=0);i=g;g=0}if(e){k[e>>2]=h;k[e+4>>2]=b}o=(f|0)>>>31|i<<1|(0<<1|f>>>31)&0|g;p=(f<<1|0>>>31)&-2|a;return (M=o,p)|0}function EF(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;Qb[a&31](b|0,c|0,d|0,e|0,f|0)}function FF(a,b,c){a=a|0;b=b|0;c=+c;Rb[a&31](b|0,+c)}function GF(a,b){a=a|0;b=b|0;Sb[a&255](b|0)}function HF(a,b,c,d,e,f,g){a=a|0;b=b|0;c=c|0;d=d|0;e=+e;f=f|0;g=g|0;Tb[a&0](b|0,c|0,d|0,+e,f|0,g|0)}function IF(a,b,c){a=a|0;b=b|0;c=c|0;Ub[a&127](b|0,c|0)}function JF(a,b,c,d,e,f,g,h,i,j,k){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;k=k|0;return Vb[a&3](b|0,c|0,d|0,e|0,f|0,g|0,h|0,i|0,j|0,k|0)|0}function KF(a,b){a=a|0;b=b|0;return Wb[a&127](b|0)|0}function LF(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=+d;e=e|0;Xb[a&7](b|0,c|0,+d,e|0)}function MF(a,b,c,d,e,f,g){a=a|0;b=b|0;c=+c;d=+d;e=e|0;f=f|0;g=g|0;Yb[a&0](b|0,+c,+d,e|0,f|0,g|0)}function NF(a,b,c,d,e){a=a|0;b=b|0;c=+c;d=d|0;e=e|0;Zb[a&0](b|0,+c,d|0,e|0)}function OF(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;return _b[a&31](b|0,c|0,d|0,e|0)|0}function PF(a,b,c,d){a=a|0;b=b|0;c=+c;d=d|0;$b[a&15](b|0,+c,d|0)}function QF(a,b,c,d,e,f,g,h,i){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;return +ac[a&1](b|0,c|0,d|0,e|0,f|0,g|0,h|0,i|0)}function RF(a,b,c,d,e,f,g,h,i,j,k,l){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=+f;g=+g;h=+h;i=+i;j=j|0;k=k|0;l=+l;bc[a&0](b|0,c|0,d|0,e|0,+f,+g,+h,+i,j|0,k|0,+l)}function SF(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;return +cc[a&15](b|0,c|0,d|0,e|0,f|0)}function TF(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;return dc[a&63](b|0,c|0,d|0)|0}function UF(a,b,c,d,e,f,g){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;ec[a&7](b|0,c|0,d|0,e|0,f|0,g|0)}function VF(a,b,c,d){a=a|0;b=b|0;c=c|0;d=+d;return fc[a&7](b|0,c|0,+d)|0}function WF(a,b){a=a|0;b=b|0;return +gc[a&15](b|0)}function XF(a,b,c,d,e,f,g){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;return hc[a&3](b|0,c|0,d|0,e|0,f|0,g|0)|0}function YF(a,b,c,d,e,f,g){a=a|0;b=b|0;c=c|0;d=d|0;e=+e;f=f|0;g=g|0;return +ic[a&3](b|0,c|0,d|0,+e,f|0,g|0)}function ZF(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=+d;e=e|0;f=f|0;jc[a&0](b|0,c|0,+d,e|0,f|0)}function _F(a,b,c,d,e,f,g,h){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;kc[a&1](b|0,c|0,d|0,e|0,f|0,g|0,h|0)}function $F(a,b,c,d,e,f,g,h,i,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;lc[a&1](b|0,c|0,d|0,e|0,f|0,g|0,h|0,i|0,j|0)}function aG(a,b,c,d,e,f,g,h,i,j,k){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;k=k|0;mc[a&3](b|0,c|0,d|0,e|0,f|0,g|0,h|0,i|0,j|0,k|0)}function bG(a,b,c){a=a|0;b=b|0;c=c|0;return nc[a&31](b|0,c|0)|0}function cG(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;return +oc[a&15](b|0,c|0,d|0)}function dG(a,b,c,d,e,f,g,h,i,j,k){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;k=k|0;return +pc[a&3](b|0,c|0,d|0,e|0,f|0,g|0,h|0,i|0,j|0,k|0)}function eG(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=+f;qc[a&1](b|0,c|0,d|0,e|0,+f)}function fG(a,b,c,d,e,f,g,h,i,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;return +rc[a&3](b|0,c|0,d|0,e|0,f|0,g|0,h|0,i|0,j|0)}function gG(a,b,c){a=a|0;b=b|0;c=+c;return +sc[a&1](b|0,+c)}function hG(a,b,c,d,e,f,g,h,i,j,k,l,m){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=+f;g=+g;h=+h;i=+i;j=+j;k=k|0;l=+l;m=m|0;tc[a&0](b|0,c|0,d|0,e|0,+f,+g,+h,+i,+j,k|0,+l,m|0)}function iG(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=+d;e=e|0;f=f|0;return +uc[a&3](b|0,c|0,+d,e|0,f|0)}function jG(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;return +vc[a&1](b|0,c|0,d|0,e|0)}function kG(a,b,c,d,e,f,g,h,i,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;return wc[a&3](b|0,c|0,d|0,e|0,f|0,g|0,h|0,i|0,j|0)|0}function lG(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=+e;xc[a&15](b|0,c|0,d|0,+e)}function mG(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;yc[a&127](b|0,c|0,d|0)}function nG(a){a=a|0;zc[a&3]()}function oG(a,b,c,d){a=a|0;b=b|0;c=c|0;d=+d;Ac[a&7](b|0,c|0,+d)}function pG(a,b,c,d,e){a=a|0;b=b|0;c=+c;d=d|0;e=+e;return Bc[a&1](b|0,+c,d|0,+e)|0}function qG(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;Cc[a&127](b|0,c|0,d|0,e|0)}function rG(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;la(0)}function sG(a,b){a=a|0;b=+b;la(1)}function tG(a){a=a|0;la(2)}function uG(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=+d;e=e|0;f=f|0;la(3)}function vG(a,b){a=a|0;b=b|0;la(4)}function wG(a,b,c,d,e,f,g,h,i,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;la(5);return 0}function xG(a){a=a|0;la(6);return 0}function yG(a,b,c,d){a=a|0;b=b|0;c=+c;d=d|0;la(7)}function zG(a,b,c,d,e,f){a=a|0;b=+b;c=+c;d=d|0;e=e|0;f=f|0;la(8)}function AG(a,b,c,d){a=a|0;b=+b;c=c|0;d=d|0;la(9)}function BG(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;la(10);return 0}function CG(a,b,c){a=a|0;b=+b;c=c|0;la(11)}function DG(a,b,c,d,e,f,g,h){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;la(12);return 0.0}function EG(a,b,c,d,e,f,g,h,i,j,k){a=a|0;b=b|0;c=c|0;d=d|0;e=+e;f=+f;g=+g;h=+h;i=i|0;j=j|0;k=+k;la(13)}function FG(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;la(14);return 0.0}function GG(a,b,c){a=a|0;b=b|0;c=c|0;la(15);return 0}function HG(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;la(16)}function IG(a,b,c){a=a|0;b=b|0;c=+c;la(17);return 0}function JG(a){a=a|0;la(18);return 0.0}function KG(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;la(19);return 0}function LG(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=+d;e=e|0;f=f|0;la(20);return 0.0}function MG(a,b,c,d,e){a=a|0;b=b|0;c=+c;d=d|0;e=e|0;la(21)}function NG(a,b,c,d,e,f,g){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;la(22)}function OG(a,b,c,d,e,f,g,h,i){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;la(23)}function PG(a,b,c,d,e,f,g,h,i,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;la(24)}function QG(a,b){a=a|0;b=b|0;la(25);return 0}function RG(a,b,c){a=a|0;b=b|0;c=c|0;la(26);return 0.0}function SG(a,b,c,d,e,f,g,h,i,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;la(27);return 0.0}function TG(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=+e;la(28)}function UG(a,b,c,d,e,f,g,h,i){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;la(29);return 0.0}function VG(a,b){a=a|0;b=+b;la(30);return 0.0}function WG(a,b,c,d,e,f,g,h,i,j,k,l){a=a|0;b=b|0;c=c|0;d=d|0;e=+e;f=+f;g=+g;h=+h;i=+i;j=j|0;k=+k;l=l|0;la(31)}function XG(a,b,c,d,e){a=a|0;b=b|0;c=+c;d=d|0;e=e|0;la(32);return 0.0}function YG(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;la(33);return 0.0}function ZG(a,b,c,d,e,f,g,h,i){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;la(34);return 0}function _G(a,b,c,d){a=a|0;b=b|0;c=c|0;d=+d;la(35)}function $G(a,b,c){a=a|0;b=b|0;c=c|0;la(36)}function aH(){la(37)}function bH(){Ob()}function cH(a,b,c){a=a|0;b=b|0;c=+c;la(38)}function dH(a,b,c,d){a=a|0;b=+b;c=c|0;d=+d;la(39);return 0}function eH(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;la(40)}

// EMSCRIPTEN_END_FUNCS
var Qb=[rG,Zr,fs,_t,js,Es,Ks,Qs,Vs,RC,uv,Zv,bw,fw,hw,iw,$E,_E,XE,rG,rG,rG,rG,rG,rG,rG,rG,rG,rG,rG,rG,rG];var Rb=[sG,Hp,Gp,vp,np,hp,wx,Zq,_q,hz,_w,JA,aB,gB,JB,ix,jx,sG,sG,sG,sG,sG,sG,sG,sG,sG,sG,sG,sG,sG,sG,sG];var Sb=[tG,Qx,Zx,Yx,pE,qE,uE,ry,vE,wE,zE,Hx,AE,BE,Xw,vx,fp,gp,ps,qs,ip,rs,lp,jp,Fp,kp,Bx,Gx,Kx,Jx,Nx,Rp,Wp,Tx,Wx,$p,ay,dy,oq,gy,xq,Dq,Eq,Uq,Vq,Wq,ly,ky,br,cr,mr,uy,ur,vr,yr,zr,Er,Fr,Cy,Ey,Qr,Rr,Ky,Jy,My,Oy,Qy,Sy,Uy,Wy,Yy,_y,az,Tr,Ur,Xr,Yr,$r,as,cs,ds,su,iz,dz,ez,St,Cz,hs,is,Hz,Gz,ms,ns,zs,ax,Nz,Iz,Jz,Pz,Qz,Sz,Uz,Xz,Zz,$z,oy,cA,jA,iA,lA,nA,Cs,Ds,Gs,Hs,Is,Js,uA,wA,AA,Os,Ps,DA,Ss,Ts,GA,Ys,Zs,$s,Zt,_A,RA,OA,cB,ot,pt,kB,jB,mB,oB,wt,xt,sB,tu,uB,Et,Ft,Lt,CB,BB,OB,GB,EB,QB,SB,gC,Lu,Mu,kC,mC,AC,sC,pC,GC,FC,YC,XC,IC,ZC,oD,nD,dv,ev,yD,AD,nv,ov,Av,CD,ED,HD,Cv,Dv,JD,LD,KD,PD,Uv,QD,RD,SD,WD,XD,ZD,YD,ID,gE,dw,ew,iE,jE,kw,lw,ow,pw,sw,tw,GE,HE,KE,NE,LE,ME,OE,PE,hF,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG,tG];var Tb=[uG];var Ub=[vG,xE,yE,ux,ep,Ax,rp,Np,xp,yp,zp,op,pp,tp,sp,Ip,Ap,Bp,Cp,Dp,Ep,xx,Sp,Tp,Zp,aq,bq,hq,iq,lq,nq,yq,zq,$q,or,fr,hr,ir,jr,pr,tr,Ir,Hr,Or,Wr,bz,bs,gz,bu,xz,Yt,Dz,ss,Bs,gA,oA,pA,BA,CA,Us,EA,ct,_s,ht,WA,PA,MA,rt,tt,ut,zt,Jt,eu,MB,KB,Hu,fC,Iv,Jv,zC,xC,EC,DC,_u,$u,NC,JC,dD,$C,_C,rD,pD,lv,vv,zv,BD,DD,FD,fE,hE,nE,mE,vG,vG,vG,vG,vG,vG,vG,vG,vG,vG,vG,vG,vG,vG,vG,vG,vG,vG,vG,vG,vG,vG,vG,vG,vG,vG];var Vb=[wG,Pv,Sv,wG];var Wb=[xG,Xx,cp,zx,Jp,Kp,yx,Mx,Sx,Vx,$x,cy,fy,hy,lr,nr,vy,By,zy,yy,xy,Hy,Gy,Fy,Az,yz,wz,sz,qz,pz,mz,LA,KA,HA,XA,VA,TA,QA,NA,bB,At,hB,eB,qB,pB,Kt,xB,wB,AB,zB,ju,ku,nu,LB,IB,FB,DB,Iu,PB,Au,Bu,Eu,eC,aC,_B,ZB,WB,iC,yC,wC,rC,oC,CC,ww,BC,MC,LC,jD,iD,hD,fD,aD,vD,uD,tD,sD,qD,wv,xv,kE,IE,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG,xG];var Xb=[yG,Xp,cq,jq,sq,Bq,yG,yG];var Yb=[zG];var Zb=[AG];var _b=[BG,sE,ar,Jr,Iy,Ly,Ny,Py,Ry,Ty,Vy,Xy,Zy,$y,qA,Hv,hC,lD,jv,BG,BG,BG,BG,BG,BG,BG,BG,BG,BG,BG,BG,BG];var $b=[CG,zz,bt,YA,mt,Ct,It,Pt,wu,Ku,Qu,CG,CG,CG,CG,CG];var ac=[DG,DE];var bc=[EG];var cc=[FG,_r,gs,ks,Fs,Ls,Rs,Ws,cw,gw,FG,FG,FG,FG,FG,FG];var dc=[GG,fq,rE,dp,Lx,Rx,Ux,_x,by,ey,sr,Gr,Lr,Kr,Sr,vz,dt,UA,st,Xt,vB,qu,HB,Kv,vC,Aw,mD,bD,wD,iv,nw,lE,QE,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG,GG];var ec=[HG,Ix,PC,sv,cF,bF,aF,HG];var fc=[IG,kz,pu,Gu,UB,IG,IG,IG];var gc=[JG,Vt,hx,IA,$A,fB,tC,qC,nC,JG,JG,JG,JG,JG,JG,JG];var hc=[KG,Rv,Tv,Yv];var ic=[LG,Yz,_z,LG];var jc=[MG];var kc=[NG,ru];var lc=[OG,Qq];var mc=[PG,uw,vw,PG];var nc=[QG,qy,Fx,CE,ap,Lp,Mp,Ex,wy,Ay,Nr,Dy,Mt,Rz,Tz,Wz,bA,eA,dA,xD,zD,QG,QG,QG,QG,QG,QG,QG,QG,QG,QG,QG];var oc=[RG,py,Dx,Cx,Yp,dq,kq,tq,Cq,ty,Vz,aA,RG,RG,RG,RG];var pc=[SG,Tq,Pq,SG];var qc=[TG,Px];var rc=[UG,Oq,Rq,UG];var sc=[VG,Ut];var tc=[WG];var uc=[XG,kA,mA,XG];var vc=[YG,Sq];var wc=[ZG,WC,pv,ZG];var xc=[_G,Ox,pq,ls,Oz,rA,vA,xA,MD,TD,_G,_G,_G,_G,_G,_G];var yc=[$G,tE,wp,_p,uq,jy,iy,wr,Ar,Vr,fz,Tt,du,uz,rz,nz,Fz,Ez,hA,tA,sA,zA,yA,FA,gt,et,SA,kt,it,Dt,dB,iB,lB,nB,Nt,iu,gu,mu,uu,zu,xu,Du,dC,cC,$B,XB,TB,uC,Tu,Ru,Su,xw,yw,VC,KC,kD,gD,eD,cD,hv,fv,gv,kv,qv,yv,GD,OD,ND,VD,UD,Dr,au,$t,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G,$G];var zc=[aH,bH,fF,gF];var Ac=[cH,ny,sy,gr,kr,fA,cH,cH];var Bc=[dH,mp];var Cc=[eH,ys,vs,qp,up,Nq,my,xr,Br,Mr,es,cz,Bz,tz,cu,oz,lz,jz,os,Mz,Lz,Kz,Ov,Nv,at,ZA,ft,lt,jt,yt,qt,Bt,rB,tB,Gt,Ht,Ot,Rt,hu,lu,ou,NB,vu,yu,Cu,Fu,RB,Ju,bC,YB,VB,jC,lC,Pu,Uu,Wu,Vu,zw,QC,OC,rv,tv,RE,SE,UE,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH,eH];return{_emscripten_bind_btCylinderShape___destroy___0:Ro,_emscripten_bind_btGeneric6DofConstraint_enableFeedback_1:We,_emscripten_bind_btDispatcherInfo_get_m_enableSPU_0:ld,_emscripten_bind_btDispatcherInfo_set_m_useContinuous_1:id,_emscripten_bind_btCollisionObject_isActive_0:hf,_emscripten_bind_btVehicleTuning_set_m_frictionSlip_1:Wh,_emscripten_bind_btDiscreteDynamicsWorld_btDiscreteDynamicsWorld_4:vf,_emscripten_bind_btContactSolverInfo___destroy___0:fl,_emscripten_bind_btWheelInfo_get_m_rollInfluence_0:Tj,_emscripten_bind_btTypedConstraint_setBreakingImpulseThreshold_1:Xo,_emscripten_bind_btQuaternion_setX_1:wj,_emscripten_bind_btDispatcherInfo_get_m_timeOfImpact_0:fd,_emscripten_bind_btQuaternion_setZ_1:yj,_emscripten_bind_btHingeConstraint_btHingeConstraint_4:Dl,_emscripten_bind_btKinematicCharacterController_setMaxSlope_1:Tk,_emscripten_bind_btQuadWord_z_0:vo,_emscripten_bind_btVehicleTuning_get_m_suspensionStiffness_0:Nh,_emscripten_bind_btWheelInfo_get_m_suspensionRestLength1_0:Vj,_emscripten_bind_btWheelInfo_get_m_suspensionStiffness_0:Pj,_emscripten_bind_btRigidBodyConstructionInfo_get_m_angularDamping_0:fe,_emscripten_bind_btCollisionDispatcher___destroy___0:Lh,_emscripten_bind_btRigidBody_applyCentralImpulse_1:mn,_emscripten_bind_btDefaultMotionState_getWorldTransform_1:xi,_emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_1:Ef,_emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_3:Gf,_emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_2:Ff,_emscripten_bind_btVector3_op_mul_1:sl,_emscripten_bind_btDynamicsWorld_rayTest_3:cj,_emscripten_bind_btRaycastVehicle_updateWheelTransform_2:Go,_emscripten_bind_btQuadWord_x_0:to,_emscripten_bind_btCollisionObject_isKinematicObject_0:jf,_emscripten_bind_btWheelInfo_set_m_chassisConnectionPointCS_1:mk,_emscripten_bind_btSphereShape___destroy___0:yl,_emscripten_bind_btGeneric6DofSpringConstraint_setLinearUpperLimit_1:Gm,_emscripten_bind_ClosestConvexResultCallback_set_m_hitNormalWorld_1:ki,_emscripten_bind_btWheelInfo_set_m_wheelsSuspensionForce_1:ik,_emscripten_bind_btRigidBody_getCenterOfMassTransform_0:$m,_emscripten_bind_btGhostObject_isKinematicObject_0:im,_emscripten_bind_btGeneric6DofSpringConstraint_btGeneric6DofSpringConstraint_5:Bm,_emscripten_bind_btGeneric6DofSpringConstraint_btGeneric6DofSpringConstraint_3:Am,_emscripten_bind_btCollisionObject_activate_1:gf,_emscripten_bind_btCollisionObject_activate_0:ff,_emscripten_bind_btKinematicCharacterController_setUpAxis_1:Gk,_emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterGroup_1:Ti,_emscripten_bind_btDispatcherInfo_set_m_timeOfImpact_1:gd,_emscripten_bind_btCollisionDispatcher_btCollisionDispatcher_1:Ih,_emscripten_bind_btVector3_setX_1:ol,_emscripten_bind_btCollisionConfiguration___destroy___0:Ad,_emscripten_bind_btQuaternion_btQuaternion_4:qj,_emscripten_bind_btGeneric6DofConstraint_setAngularLowerLimit_1:Ue,_emscripten_bind_btManifoldPoint_set_m_localPointB_1:Ie,_emscripten_bind_btVector3_setZ_1:ql,_emscripten_bind_btWheelInfo_get_m_maxSuspensionTravelCm_0:fk,_emscripten_bind_btQuaternion_setValue_4:rj,_emscripten_bind_btDispatcherInfo_set_m_dispatchFunc_1:ed,_emscripten_bind_LocalShapeInfo___destroy___0:ym,_emscripten_bind_btWheelInfo_get_m_bIsFrontWheel_0:jk,_emscripten_bind_btQuadWord_setY_1:yo,_emscripten_bind_btRigidBodyConstructionInfo_set_m_restitution_1:me,_emscripten_bind_btDefaultMotionState_get_m_graphicsWorldTrans_0:zi,_emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_3:zf,_emscripten_bind_btPairCachingGhostObject_btPairCachingGhostObject_0:Gd,_emscripten_bind_btDiscreteDynamicsWorld_getSolverInfo_0:Uf,_emscripten_bind_btCollisionWorld___destroy___0:so,_emscripten_bind_LocalConvexResult_get_m_hitPointLocal_0:Um,_emscripten_bind_btBoxShape_btBoxShape_1:Eh,_emscripten_bind_btPersistentManifold_getBody1_0:Ah,_emscripten_bind_btRigidBody_isKinematicObject_0:En,_emscripten_bind_btKinematicCharacterController_setGravity_1:Rk,_emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_5:Re,_emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_3:Qe,_emscripten_bind_LocalShapeInfo_get_m_shapePart_0:um,_emscripten_bind_ClosestRayResultCallback_get_m_hitPointWorld_0:Qi,_emscripten_bind_btVector4_setValue_4:uk,_emscripten_bind_btBvhTriangleMeshShape_setLocalScaling_1:Tc,_emscripten_bind_btPoint2PointConstraint_setBreakingImpulseThreshold_1:pg,_emscripten_bind_btDynamicsWorld_getDispatchInfo_0:ej,_emscripten_bind_btVector3_length_0:kl,_emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_2:Xf,_emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_1:Wf,_emscripten_bind_ClosestConvexResultCallback_set_m_hitPointWorld_1:mi,_emscripten_bind_RayResultCallback_set_m_collisionFilterMask_1:Lj,_emscripten_bind_btPairCachingGhostObject___destroy___0:ae,_emscripten_bind_btPairCachingGhostObject_activate_0:Md,_emscripten_bind_btPairCachingGhostObject_activate_1:Nd,_emscripten_bind_btContactSolverInfo_get_m_splitImpulsePenetrationThreshold_0:dl,_emscripten_bind_btPairCachingGhostObject_forceActivationState_1:Ld,_emscripten_bind_btDefaultMotionState___destroy___0:Bi,_emscripten_bind_btDispatcherInfo_get_m_stepCount_0:bd,_emscripten_bind_btRigidBodyConstructionInfo_set_m_angularDamping_1:ge,_emscripten_bind_btQuadWord_setW_1:Ao,_emscripten_bind_btRigidBodyConstructionInfo_get_m_friction_0:he,_emscripten_bind_btCapsuleShapeX_btCapsuleShapeX_2:mj,_emscripten_bind_btWheelInfo_get_m_maxSuspensionForce_0:dk,_emscripten_bind_btRigidBody_setLinearFactor_1:en,_emscripten_bind_btDispatcherInfo_set_m_useConvexConservativeDistanceUtil_1:sd,_emscripten_bind_btRigidBody_getAngularVelocity_0:pn,_emscripten_bind_btRaycastVehicle_setSteeringValue_2:Eo,_emscripten_bind_btPoint2PointConstraint___destroy___0:sg,_emscripten_bind_btGeneric6DofConstraint_setAngularUpperLimit_1:Ve,_emscripten_bind_btDiscreteDynamicsWorld_addConstraint_2:Cf,_emscripten_bind_btDiscreteDynamicsWorld_addConstraint_1:Bf,_emscripten_bind_btRigidBodyConstructionInfo_set_m_angularSleepingThreshold_1:qe,_emscripten_bind_btCollisionWorld_computeOverlappingPairs_0:ho,_malloc:iF,_emscripten_bind_btDispatcherInfo_get_m_useEpa_0:nd,_emscripten_bind_btTransform_btTransform_2:Zn,_emscripten_bind_btTransform_btTransform_0:Yn,_emscripten_bind_btWheelInfo_set_m_wheelsRadius_1:Yj,_emscripten_bind_btDispatcherInfo_set_m_enableSPU_1:md,_emscripten_bind_btRaycastVehicle_setCoordinateSystem_3:Mo,_emscripten_bind_btCollisionObject_setActivationState_1:df,_emscripten_bind_btPersistentManifold___destroy___0:Dh,_emscripten_bind_btConstraintSetting_get_m_impulseClamp_0:Wl,_emscripten_bind_btCylinderShapeZ___destroy___0:Xn,_emscripten_bind_btMatrix3x3___destroy___0:Nc,_emscripten_bind_btGeneric6DofSpringConstraint_setBreakingImpulseThreshold_1:Lm,_emscripten_bind_btCollisionShape_calculateLocalInertia_2:Pl,_emscripten_bind_ConvexResultCallback_hasHit_0:$f,_emscripten_bind_btCollisionWorld_convexSweepTest_5:qo,_emscripten_bind_ClosestRayResultCallback_set_m_hitPointWorld_1:Ri,_emscripten_bind_btCapsuleShapeX_calculateLocalInertia_2:oj,_emscripten_bind_btConstraintSetting_set_m_damping_1:Vl,_emscripten_bind_btVehicleRaycaster___destroy___0:ul,_emscripten_bind_btRigidBody_setCcdMotionThreshold_1:Nn,_emscripten_bind_btRigidBody_applyForce_2:hn,_emscripten_bind_btConeShapeZ_calculateLocalInertia_2:gh,_emscripten_bind_btConstraintSetting_set_m_tau_1:Tl,_emscripten_bind_btConvexHullShape_calculateLocalInertia_2:wh,_emscripten_bind_btSphereShape_calculateLocalInertia_2:xl,_emscripten_bind_btWheelInfo_get_m_chassisConnectionPointCS_0:lk,_emscripten_bind_btPoint2PointConstraint_get_m_setting_0:qg,_emscripten_bind_ClosestRayResultCallback_get_m_rayToWorld_0:Mi,_emscripten_bind_btGhostObject_setFriction_1:km,_emscripten_bind_btCollisionWorld_rayTest_3:jo,_emscripten_bind_btRigidBody_setCcdSweptSphereRadius_1:On,_emscripten_bind_btRigidBody_setFriction_1:Gn,_emscripten_bind_LocalConvexResult_set_m_hitPointLocal_1:Vm,_emscripten_bind_btGhostObject_setWorldTransform_1:pm,_emscripten_bind_btDiscreteDynamicsWorld_removeRigidBody_1:Af,_emscripten_bind_btConvexHullShape___destroy___0:xh,_emscripten_bind_btDiscreteDynamicsWorld_getBroadphase_0:Qf,_emscripten_bind_btVector4_setX_1:zk,_emscripten_bind_btKinematicCharacterController_jump_0:Qk,_emscripten_bind_btConeTwistConstraint_setMaxMotorImpulseNormalized_1:Ng,_emscripten_bind_btConvexTriangleMeshShape_setLocalScaling_1:Yf,_emscripten_bind_btRigidBody_upcast_1:vn,_emscripten_bind_btTransform_setOrigin_1:$n,_emscripten_bind_btVector4_setZ_1:Bk,_emscripten_bind_btQuadWord_y_0:uo,___cxa_can_catch:dF,_emscripten_bind_btTransform_getBasis_0:eo,_emscripten_bind_btPairCachingGhostObject_setFriction_1:Rd,_emscripten_bind_btDispatcherInfo_set_m_useEpa_1:od,_emscripten_bind_btCollisionDispatcher_getNumManifolds_0:Jh,_emscripten_bind_btWheelInfo_set_m_bIsFrontWheel_1:kk,_emscripten_bind_ClosestRayResultCallback___destroy___0:Yi,_emscripten_bind_ClosestConvexResultCallback_get_m_convexFromWorld_0:fi,_emscripten_bind_btQuadWord_w_0:wo,_emscripten_bind_btCompoundShape___destroy___0:ci,_emscripten_bind_btAxisSweep3___destroy___0:Fd,_emscripten_bind_btBvhTriangleMeshShape_calculateLocalInertia_2:Uc,_emscripten_bind_btGhostObject_btGhostObject_0:Zl,_strlen:oF,_emscripten_bind_ClosestConvexResultCallback_ClosestConvexResultCallback_2:di,_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingFactor_1:Ae,_emscripten_bind_btManifoldPoint_set_m_localPointA_1:Ge,_emscripten_bind_btCollisionObject_setCollisionShape_1:rf,_emscripten_bind_btWheelInfo___destroy___0:nk,_emscripten_bind_btTransform_setRotation_1:ao,_emscripten_bind_btPairCachingGhostObject_getNumOverlappingObjects_0:_d,_emscripten_bind_btPoint2PointConstraint_enableFeedback_1:ng,_emscripten_bind_btQuadWord_setZ_1:zo,_emscripten_bind_btAxisSweep3_btAxisSweep3_2:Bd,_emscripten_bind_btAxisSweep3_btAxisSweep3_3:Cd,_emscripten_bind_btDynamicsWorld___destroy___0:lj,_emscripten_bind_btVector3_setY_1:pl,_emscripten_bind_btAxisSweep3_btAxisSweep3_4:Dd,_emscripten_bind_btAxisSweep3_btAxisSweep3_5:Ed,_emscripten_bind_btQuadWord_setX_1:xo,_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalLinearDampingThresholdSqr_0:ve,_emscripten_bind_btGhostObject_isActive_0:hm,_emscripten_bind_btOverlappingPairCache___destroy___0:hl,_emscripten_bind_btConstraintSetting___destroy___0:Yl,_emscripten_bind_RayResultCallback___destroy___0:Oj,_emscripten_bind_btPersistentManifold_getBody0_0:zh,_emscripten_bind_btConeShapeX_btConeShapeX_2:ih,_emscripten_bind_btConeTwistConstraint_enableFeedback_1:Qg,_emscripten_bind_btCapsuleShapeZ_setLocalScaling_1:Cj,_emscripten_bind_btRigidBody_applyTorque_1:gn,_emscripten_bind_btSliderConstraint_setUpperLinLimit_1:zg,_emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_2:Gg,_emscripten_bind_btConcaveShape___destroy___0:qk,_emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_4:Hg,_emscripten_bind_btQuaternion_x_0:sj,_emscripten_bind_LocalConvexResult_set_m_hitNormalLocal_1:Tm,_emscripten_bind_btConcaveShape_setLocalScaling_1:ok,_emscripten_bind_btDiscreteDynamicsWorld_getDispatchInfo_0:Mf,_emscripten_bind_btConeShapeX_setLocalScaling_1:jh,_emscripten_bind_btQuaternion_z_0:uj,_emscripten_bind_btConvexHullShape_btConvexHullShape_0:sh,_emscripten_bind_btWheelInfo_set_m_maxSuspensionForce_1:ek,_emscripten_bind_btConstraintSetting_get_m_damping_0:Ul,_emscripten_bind_btGhostObject___destroy___0:tm,_emscripten_bind_btGhostObject_setContactProcessingThreshold_1:cm,_emscripten_bind_btCollisionWorld_getBroadphase_0:po,_emscripten_bind_btQuaternion___destroy___0:Aj,_emscripten_bind_btContactSolverInfo_set_m_splitImpulse_1:cl,_emscripten_bind_btRigidBody_getGravity_0:qn,_emscripten_bind_btDefaultMotionState_btDefaultMotionState_2:wi,_emscripten_bind_btDefaultMotionState_btDefaultMotionState_0:ui,_emscripten_bind_btDefaultMotionState_btDefaultMotionState_1:vi,_emscripten_bind_btKinematicCharacterController_canJump_0:Pk,_emscripten_bind_btVector4_length_0:vk,_emscripten_bind_btRigidBody_isActive_0:Dn,_emscripten_bind_btRaycastVehicle_btRaycastVehicle_3:Co,_emscripten_bind_btMotionState_setWorldTransform_1:ug,_emscripten_bind_btCylinderShape_setLocalScaling_1:Po,_emscripten_bind_btPairCachingGhostObject_getWorldTransform_0:Td,_emscripten_bind_btCompoundShape_calculateLocalInertia_2:bi,_emscripten_bind_btCollisionWorld_getDispatchInfo_0:lo,_emscripten_bind_btRigidBody_setCollisionShape_1:Mn,_emscripten_bind_btConeShapeX___destroy___0:lh,_emscripten_bind_btCollisionObject_getCollisionFlags_0:of,_emscripten_bind_btDispatcherInfo_set_m_enableSatConvex_1:kd,_emscripten_bind_btConeTwistConstraint_enableMotor_1:Lg,_emscripten_bind_btWheelInfo_set_m_wheelsDampingCompression_1:_j,_emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_4:Fk,_emscripten_bind_btPairCachingGhostObject_setRestitution_1:Qd,_emscripten_bind_btBroadphaseInterface___destroy___0:$e,_emscripten_bind_btSliderConstraint_getBreakingImpulseThreshold_0:Dg,_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDampingFactor_1:ue,_emscripten_bind_btCollisionObject_setContactProcessingThreshold_1:cf,_emscripten_bind_btGhostObject_setCcdMotionThreshold_1:rm,_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingFactor_0:ze,_emscripten_bind_LocalConvexResult___destroy___0:Ym,_emscripten_bind_btSequentialImpulseConstraintSolver___destroy___0:_c,_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalLinearDampingThresholdSqr_1:we,_emscripten_bind_btRigidBody_getCollisionFlags_0:Jn,_emscripten_bind_btCollisionShape_setLocalScaling_1:Ol,_emscripten_bind_ClosestConvexResultCallback_get_m_closestHitFraction_0:ri,_emscripten_bind_LocalConvexResult_get_m_hitCollisionObject_0:Om,_emscripten_bind_btMatrix3x3_setEulerZYX_3:Lc,_emscripten_bind_btRigidBody_setRollingFriction_1:Hn,_emscripten_bind_btDispatcherInfo_get_m_convexConservativeDistanceThreshold_0:td,_emscripten_bind_ClosestRayResultCallback_get_m_hitNormalWorld_0:Oi,_emscripten_bind_RayResultCallback_get_m_collisionFilterMask_0:Kj,_emscripten_bind_btCollisionWorld_getDispatcher_0:go,_emscripten_bind_btCollisionObject_setRollingFriction_1:mf,_emscripten_bind_RayResultCallback_set_m_collisionFilterGroup_1:Jj,_emscripten_bind_btTriangleMesh_btTriangleMesh_1:nh,_i64Subtract:mF,_emscripten_bind_btRaycastVehicle_getWheelTransformWS_1:Fo,_emscripten_bind_btRigidBody_setDamping_2:cn,_emscripten_bind_btDynamicsWorld_getDispatcher_0:$i,_emscripten_bind_btGhostObject_setCollisionFlags_1:om,_emscripten_bind_btMatrix3x3_getRotation_1:Mc,_emscripten_bind_btConeTwistConstraint_setMaxMotorImpulse_1:Mg,_emscripten_bind_btPersistentManifold_getNumContacts_0:Bh,_emscripten_bind_btCylinderShapeX_setLocalScaling_1:Rn,_emscripten_bind_btDbvtBroadphase_btDbvtBroadphase_0:Wc,_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDamping_0:re,_emscripten_bind_btCompoundShape_setLocalScaling_1:ai,_emscripten_bind_btOverlappingPairCallback___destroy___0:Zm,_emscripten_bind_btManifoldPoint_get_m_positionWorldOnB_0:Je,_emscripten_bind_btVector4_setY_1:Ak,_emscripten_bind_btPairCachingGhostObject_setCcdSweptSphereRadius_1:Zd,_emscripten_bind_btHingeConstraint_enableAngularMotor_3:Jl,_emscripten_bind_btRigidBody_setContactProcessingThreshold_1:yn,_emscripten_bind_btRigidBody_getLinearVelocity_0:on,_emscripten_bind_btRigidBody_applyImpulse_2:ln,_emscripten_bind_btConcaveShape_calculateLocalInertia_2:pk,_emscripten_bind_btRigidBody_setWorldTransform_1:Ln,_emscripten_bind_btRigidBody_setAngularVelocity_1:sn,_emscripten_bind_btCapsuleShape___destroy___0:zd,_emscripten_bind_btConvexShape_setLocalScaling_1:Yg,_emscripten_bind_btRigidBody_setCenterOfMassTransform_1:an,_free:jF,_emscripten_bind_btPairCachingGhostObject_setContactProcessingThreshold_1:Jd,_emscripten_bind_btGeneric6DofConstraint_setLinearUpperLimit_1:Te,_emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterMask_0:Ui,_emscripten_bind_RayResultCallback_hasHit_0:Hj,_emscripten_bind_btVehicleTuning_set_m_maxSuspensionForce_1:Yh,_emscripten_bind_btVehicleTuning_get_m_suspensionDamping_0:Rh,_emscripten_bind_ClosestConvexResultCallback_get_m_convexToWorld_0:hi,_emscripten_bind_btWheelInfo_get_m_frictionSlip_0:Rj,_emscripten_bind_btConeShapeZ_setLocalScaling_1:fh,_emscripten_bind_btPairCachingGhostObject_setActivationState_1:Kd,_emscripten_bind_btGeneric6DofSpringConstraint___destroy___0:Mm,_emscripten_bind_btConvexTriangleMeshShape___destroy___0:_f,_emscripten_bind_btVehicleTuning_set_m_maxSuspensionTravelCm_1:Uh,_emscripten_bind_btGhostObject_setRollingFriction_1:lm,_emscripten_bind_btCylinderShapeZ_btCylinderShapeZ_1:Un,_emscripten_bind_btDispatcherInfo_get_m_allowedCcdPenetration_0:pd,_emscripten_bind_btCompoundShape_btCompoundShape_0:Zh,_emscripten_bind_btCompoundShape_btCompoundShape_1:_h,_emscripten_bind_btOverlappingPairCache_setInternalGhostPairCallback_1:gl,_emscripten_bind_btStaticPlaneShape_btStaticPlaneShape_2:Zk,_emscripten_bind_RayResultCallback_get_m_collisionFilterGroup_0:Ij,_emscripten_bind_btRigidBody_updateInertiaTensor_0:nn,_emscripten_bind_btPairCachingGhostObject_setAnisotropicFriction_2:Hd,_emscripten_bind_btManifoldPoint_set_m_positionWorldOnB_1:Ke,_emscripten_bind_btCollisionObject_getWorldTransform_0:nf,_emscripten_bind_ClosestRayResultCallback_hasHit_0:Ji,_emscripten_bind_btDispatcherInfo_get_m_useConvexConservativeDistanceUtil_0:rd,_emscripten_bind_btCompoundShape_addChildShape_2:$h,_emscripten_bind_btDispatcher___destroy___0:Hi,_emscripten_bind_btVehicleTuning_get_m_suspensionCompression_0:Ph,_emscripten_bind_btDiscreteDynamicsWorld___destroy___0:Vf,_emscripten_bind_btConvexShape___destroy___0:_g,_memmove:rF,_emscripten_bind_btCapsuleShapeX_setLocalScaling_1:nj,_emscripten_bind_btCollisionObject_setRestitution_1:kf,_emscripten_bind_btWheelInfo_get_m_wheelsDampingCompression_0:Zj,_emscripten_bind_LocalConvexResult_get_m_hitFraction_0:Wm,_emscripten_bind_btHingeConstraint_setBreakingImpulseThreshold_1:Ml,_emscripten_bind_btQuaternion_w_0:vj,_emscripten_bind_ConvexResultCallback_get_m_collisionFilterGroup_0:ag,_emscripten_bind_btTransform_getRotation_0:co,_emscripten_bind_btHingeConstraint_btHingeConstraint_6:Fl,_emscripten_bind_btHingeConstraint_btHingeConstraint_7:Gl,_emscripten_bind_LocalConvexResult_get_m_hitNormalLocal_0:Sm,_emscripten_bind_btHingeConstraint_btHingeConstraint_5:El,_emscripten_bind_btHingeConstraint_btHingeConstraint_2:Bl,_emscripten_bind_btHingeConstraint_btHingeConstraint_3:Cl,_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingThresholdSqr_1:ye,_emscripten_bind_ClosestConvexResultCallback_get_m_hitNormalWorld_0:ji,_emscripten_bind_btTypedConstraint___destroy___0:Yo,_emscripten_bind_btDiscreteDynamicsWorld_computeOverlappingPairs_0:If,_emscripten_bind_ConvexResultCallback___destroy___0:gg,_emscripten_bind_btCylinderShapeX_btCylinderShapeX_1:Qn,_emscripten_bind_btGeneric6DofSpringConstraint_setAngularUpperLimit_1:Im,_emscripten_bind_btConeTwistConstraint_setDamping_1:Kg,_emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_1:yf,_emscripten_bind_btRigidBody_applyCentralForce_1:jn,_emscripten_bind_btHingeConstraint_enableFeedback_1:Kl,_emscripten_bind_btSphereShape_btSphereShape_1:vl,_emscripten_bind_btWheelInfo_get_m_wheelsSuspensionForce_0:hk,_emscripten_bind_btQuaternion_y_0:tj,_emscripten_bind_btCollisionWorld_addCollisionObject_1:mo,_emscripten_bind_btCollisionWorld_addCollisionObject_2:no,_emscripten_bind_btCollisionWorld_addCollisionObject_3:oo,_emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterGroup_1:oi,_emscripten_bind_btConeTwistConstraint_setBreakingImpulseThreshold_1:Sg,_emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterGroup_0:ni,_emscripten_bind_btRigidBody_getMotionState_0:tn,_emscripten_bind_btDefaultVehicleRaycaster_btDefaultVehicleRaycaster_1:Fj,_emscripten_bind_ConcreteContactResultCallback_addSingleResult_7:Pc,_emscripten_bind_btSequentialImpulseConstraintSolver_btSequentialImpulseConstraintSolver_0:Zc,_emscripten_bind_btActionInterface___destroy___0:So,_emscripten_bind_btDefaultMotionState_setWorldTransform_1:yi,_emscripten_bind_btDefaultVehicleRaycaster___destroy___0:Gj,_emscripten_bind_RayResultCallback_get_m_collisionObject_0:Mj,_emscripten_bind_btPoint2PointConstraint_getPivotInA_0:lg,_emscripten_bind_btGeneric6DofSpringConstraint_setStiffness_2:Dm,_emscripten_bind_btCylinderShape_calculateLocalInertia_2:Qo,_emscripten_bind_btGhostObject_setRestitution_1:jm,_emscripten_bind_btDynamicsWorld_addCollisionObject_1:fj,_emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterMask_0:pi,_emscripten_bind_btDynamicsWorld_addCollisionObject_3:hj,_emscripten_bind_btDynamicsWorld_addCollisionObject_2:gj,_emscripten_bind_btDiscreteDynamicsWorld_getDispatcher_0:Hf,_emscripten_bind_btKinematicCharacterController_setUseGhostSweepTest_1:Wk,_emscripten_bind_btVector4_op_mul_1:Ck,_emscripten_bind_btCylinderShape_btCylinderShape_1:Oo,_emscripten_bind_btDynamicsWorld_computeOverlappingPairs_0:aj,_emscripten_bind_btVector3___destroy___0:tl,_emscripten_bind_btRigidBody_setAngularFactor_1:un,_emscripten_bind_btCylinderShapeZ_calculateLocalInertia_2:Wn,_emscripten_bind_btWheelInfo_set_m_steering_1:ck,_emscripten_bind_btMotionState_getWorldTransform_1:tg,_emscripten_bind_btDynamicsWorld_getSolverInfo_0:_i,_emscripten_bind_btDynamicsWorld_getBroadphase_0:ij,_emscripten_bind_btDispatcherInfo_set_m_convexConservativeDistanceThreshold_1:ud,_emscripten_bind_btVector3_x_0:ll,___cxa_is_pointer_type:eF,_emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_3:be,_emscripten_bind_btCollisionObject_getCollisionShape_0:bf,_emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_4:ce,_emscripten_bind_btManifoldPoint___destroy___0:Pe,_emscripten_bind_btRigidBodyConstructionInfo_set_m_rollingFriction_1:ke,_emscripten_bind_btVector3_z_0:nl,_emscripten_bind_btDefaultMotionState_set_m_graphicsWorldTrans_1:Ai,_emscripten_bind_ClosestConvexResultCallback___destroy___0:ti,_emscripten_bind_btDefaultCollisionConstructionInfo___destroy___0:Al,_emscripten_bind_btCollisionObject_setFriction_1:lf,_emscripten_bind_btDefaultCollisionConfiguration___destroy___0:bh,_emscripten_bind_btRigidBody_setMassProps_2:dn,_emscripten_bind_btVector3_setValue_3:rl,_emscripten_bind_btPairCachingGhostObject_setCcdMotionThreshold_1:Yd,_emscripten_bind_btGhostObject_getCollisionFlags_0:nm,_emscripten_bind_btCapsuleShapeX___destroy___0:pj,_emscripten_bind_btHingeConstraint_setLimit_4:Hl,_emscripten_bind_btHingeConstraint_setLimit_5:Il,_emscripten_bind_btWheelInfo_set_m_maxSuspensionTravelCm_1:gk,_emscripten_bind_btConeShape_setLocalScaling_1:Vg,_emscripten_bind_btKinematicCharacterController_setJumpSpeed_1:Nk,_emscripten_bind_btTypedConstraint_getBreakingImpulseThreshold_0:Wo,_emscripten_bind_btGhostObject_getCollisionShape_0:bm,_emscripten_bind_btCollisionObject_setAnisotropicFriction_2:af,_emscripten_bind_btRigidBodyConstructionInfo_set_m_friction_1:ie,_emscripten_bind_btPersistentManifold_getContactPoint_1:Ch,_emscripten_bind_btGeneric6DofSpringConstraint_getBreakingImpulseThreshold_0:Km,_emscripten_bind_btConeShapeX_calculateLocalInertia_2:kh,_emscripten_bind_btGhostObject_activate_0:fm,_emscripten_bind_btGhostObject_activate_1:gm,_emscripten_bind_btGeneric6DofSpringConstraint_enableSpring_2:Cm,_emscripten_bind_btManifoldPoint_getPositionWorldOnB_0:De,_emscripten_bind_btManifoldPoint_get_m_positionWorldOnA_0:Le,_emscripten_bind_btGeneric6DofSpringConstraint_enableFeedback_1:Jm,_emscripten_bind_btConeShapeZ_btConeShapeZ_2:eh,_emscripten_bind_btContactSolverInfo_set_m_splitImpulsePenetrationThreshold_1:el,_emscripten_bind_btSliderConstraint_setUpperAngLimit_1:Bg,_emscripten_bind_btDynamicsWorld_contactPairTest_3:kj,_emscripten_bind_btCollisionWorld_getPairCache_0:ko,_emscripten_bind_btConeTwistConstraint_setMotorTarget_1:Og,_emscripten_bind_ClosestConvexResultCallback_set_m_convexFromWorld_1:gi,_emscripten_bind_btWheelInfo_set_m_rollInfluence_1:Uj,_emscripten_bind_btGeneric6DofConstraint_setBreakingImpulseThreshold_1:Ye,_emscripten_bind_btDefaultCollisionConstructionInfo_btDefaultCollisionConstructionInfo_0:zl,_emscripten_bind_btGhostObject_forceActivationState_1:em,_emscripten_bind_ConcreteContactResultCallback_ConcreteContactResultCallback_0:Oc,_emscripten_bind_btTriangleMeshShape_calculateLocalInertia_2:Di,_emscripten_bind_VoidPtr___destroy___0:Yc,_emscripten_bind_btSliderConstraint_setLowerAngLimit_1:Ag,_emscripten_bind_btConeShape_btConeShape_2:Ug,_emscripten_bind_ClosestRayResultCallback_get_m_rayFromWorld_0:Ki,_emscripten_bind_btRaycastVehicle_getRigidBody_0:Jo,_emscripten_bind_btWheelInfo_get_m_steering_0:bk,_emscripten_bind_btConstraintSetting_get_m_tau_0:Sl,_emscripten_bind_btSliderConstraint___destroy___0:Fg,_emscripten_bind_btCollisionShape___destroy___0:Ql,_emscripten_bind_ConvexResultCallback_get_m_closestHitFraction_0:eg,_emscripten_bind_btDispatcherInfo_get_m_dispatchFunc_0:dd,_emscripten_bind_btRigidBodyConstructionInfo_get_m_rollingFriction_0:je,_emscripten_bind_btPairCachingGhostObject_setCollisionShape_1:Xd,_emscripten_bind_btKinematicCharacterController_warp_1:Jk,_emscripten_bind_btGhostObject_setCcdSweptSphereRadius_1:sm,_emscripten_bind_btCollisionWorld_performDiscreteCollisionDetection_0:io,_emscripten_bind_btTriangleMesh___destroy___0:rh,_emscripten_bind_btKinematicCharacterController_preStep_1:Kk,_emscripten_bind_btRaycastVehicle_applyEngineForce_2:Do,_emscripten_bind_btBoxShape_calculateLocalInertia_2:Gh,_emscripten_bind_btRaycastVehicle_setBrake_2:Lo,_emscripten_bind_ConcreteContactResultCallback___destroy___0:Qc,_emscripten_bind_btCollisionObject___destroy___0:uf,_emscripten_bind_btVehicleTuning_set_m_suspensionDamping_1:Sh,_emscripten_bind_btRigidBodyConstructionInfo_set_m_linearSleepingThreshold_1:oe,_emscripten_bind_btConeTwistConstraint_setMotorTargetInConstraintSpace_1:Pg,_emscripten_bind_btDispatcherInfo_set_m_timeStep_1:ad,_emscripten_bind_btVector3_btVector3_3:jl,_emscripten_bind_btVector3_btVector3_0:il,_emscripten_bind_btBoxShape___destroy___0:Hh,_emscripten_bind_btDiscreteDynamicsWorld_getGravity_0:xf,_emscripten_bind_ClosestConvexResultCallback_get_m_hitPointWorld_0:li,_emscripten_bind_ClosestRayResultCallback_set_m_collisionObject_1:Xi,_emscripten_bind_btConeTwistConstraint___destroy___0:Tg,_emscripten_bind_btQuadWord___destroy___0:Bo,_emscripten_bind_ClosestRayResultCallback_set_m_rayFromWorld_1:Li,_emscripten_bind_btGeneric6DofSpringConstraint_setDamping_2:Em,_emscripten_bind_btSliderConstraint_setBreakingImpulseThreshold_1:Eg,_emscripten_bind_btGhostObject_setAnisotropicFriction_2:am,_emscripten_bind_btConstraintSolver___destroy___0:zm,_emscripten_bind_btDbvtBroadphase___destroy___0:Xc,_emscripten_bind_btCapsuleShape_btCapsuleShape_2:wd,_emscripten_bind_btTypedConstraint_enableFeedback_1:Vo,_emscripten_bind_btCapsuleShape_setLocalScaling_1:xd,_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDampingFactor_0:te,_emscripten_bind_btRigidBody_setAnisotropicFriction_2:wn,_emscripten_bind_btTriangleMeshShape_setLocalScaling_1:Ci,_emscripten_bind_ConvexResultCallback_set_m_closestHitFraction_1:fg,_emscripten_bind_btPersistentManifold_btPersistentManifold_0:yh,_emscripten_bind_ConvexResultCallback_get_m_collisionFilterMask_0:cg,_emscripten_bind_ClosestRayResultCallback_ClosestRayResultCallback_2:Ii,_emscripten_bind_btVector4___destroy___0:Dk,_emscripten_bind_btPairCachingGhostObject_isKinematicObject_0:Pd,_emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterMask_1:Vi,_i64Add:pF,_emscripten_bind_btStaticPlaneShape_calculateLocalInertia_2:$k,_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingThresholdSqr_0:xe,_emscripten_bind_btCollisionObject_setCcdMotionThreshold_1:sf,_emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_0:$g,_emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_1:ah,_emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_3:Ek,_emscripten_bind_btRigidBodyConstructionInfo_get_m_angularSleepingThreshold_0:pe,_emscripten_bind_btPoint2PointConstraint_getPivotInB_0:mg,_emscripten_bind_btKinematicCharacterController_playerStep_2:Lk,_emscripten_bind_btDispatcherInfo___destroy___0:vd,_emscripten_bind_btStaticPlaneShape_setLocalScaling_1:_k,_emscripten_bind_btConvexTriangleMeshShape_calculateLocalInertia_2:Zf,_emscripten_bind_ContactResultCallback_addSingleResult_7:ch,_emscripten_bind_btGhostObject_getWorldTransform_0:mm,_emscripten_bind_btDiscreteDynamicsWorld_getPairCache_0:Lf,_emscripten_bind_LocalConvexResult_set_m_hitFraction_1:Xm,_emscripten_bind_btCapsuleShapeZ_calculateLocalInertia_2:Dj,_emscripten_bind_btDispatcherInfo_get_m_timeStep_0:$c,_emscripten_bind_btVehicleTuning_set_m_suspensionCompression_1:Qh,_emscripten_bind_btConstraintSetting_set_m_impulseClamp_1:Xl,_emscripten_bind_btMotionState___destroy___0:vg,_emscripten_bind_btCollisionObject_setCollisionFlags_1:pf,_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_1:Nf,_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_2:Of,_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_3:Pf,_emscripten_bind_btWheelInfo_set_m_suspensionStiffness_1:Qj,_emscripten_bind_btRaycastVehicle_getNumWheels_0:Io,_emscripten_bind_btDispatcher_getManifoldByIndexInternal_1:Gi,_emscripten_bind_btCollisionDispatcher_getManifoldByIndexInternal_1:Kh,_emscripten_bind_LocalShapeInfo_set_m_triangleIndex_1:xm,_emscripten_bind_btPairCachingGhostObject_setWorldTransform_1:Wd,_emscripten_bind_btHingeConstraint_getBreakingImpulseThreshold_0:Ll,_emscripten_bind_btConeTwistConstraint_setAngularOnly_1:Jg,_emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_4:ig,_emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_2:hg,_emscripten_bind_btGhostObject_getNumOverlappingObjects_0:_l,_emscripten_bind_ConvexResultCallback_set_m_collisionFilterGroup_1:bg,_emscripten_bind_btPairCachingGhostObject_getOverlappingObject_1:$d,_emscripten_bind_btRigidBodyConstructionInfo___destroy___0:Be,_emscripten_bind_btRigidBody_getWorldTransform_0:In,_emscripten_bind_btPoint2PointConstraint_setPivotA_1:jg,_emscripten_bind_ClosestConvexResultCallback_set_m_convexToWorld_1:ii,_memcpy:qF,_emscripten_bind_btCapsuleShape_calculateLocalInertia_2:yd,_emscripten_bind_btVector3_y_0:ml,_emscripten_bind_btVehicleTuning_get_m_maxSuspensionForce_0:Xh,_emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_2:Rc,_emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_3:Sc,_emscripten_bind_LocalShapeInfo_get_m_triangleIndex_0:wm,_emscripten_bind_btGhostObject_setCollisionShape_1:qm,_emscripten_bind_btDispatcherInfo_set_m_allowedCcdPenetration_1:qd,_emscripten_bind_btQuaternion_setW_1:zj,_emscripten_bind_btPairCachingGhostObject_setRollingFriction_1:Sd,_emscripten_bind_btDiscreteDynamicsWorld_setGravity_1:wf,_emscripten_bind_btVehicleTuning_set_m_suspensionStiffness_1:Oh,_emscripten_bind_btVector4_z_0:yk,_emscripten_bind_btCollisionObject_forceActivationState_1:ef,_emscripten_bind_btKinematicCharacterController_onGround_0:Xk,_emscripten_bind_btRaycastVehicle_getWheelInfo_1:Ko,_emscripten_bind_btGeneric6DofConstraint_getBreakingImpulseThreshold_0:Xe,_emscripten_bind_btConeTwistConstraint_setLimit_2:Ig,_emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterMask_1:qi,_emscripten_bind_btRigidBody___destroy___0:Pn,_emscripten_bind_btStridingMeshInterface___destroy___0:_e,_emscripten_bind_btRigidBody_setSleepingThresholds_2:bn,_emscripten_bind_btCollisionObject_setWorldTransform_1:qf,_emscripten_bind_LocalConvexResult_get_m_localShapeInfo_0:Qm,_emscripten_bind_btManifoldPoint_get_m_localPointA_0:Fe,_emscripten_bind_btRigidBodyConstructionInfo_get_m_linearDamping_0:de,_emscripten_bind_btDispatcher_getNumManifolds_0:Fi,_emscripten_bind_btRigidBodyConstructionInfo_get_m_linearSleepingThreshold_0:ne,_emscripten_bind_btRigidBody_activate_1:Cn,_emscripten_bind_btRigidBody_activate_0:Bn,_emscripten_bind_btRaycastVehicle___destroy___0:No,_emscripten_bind_btGhostObject_setActivationState_1:dm,_emscripten_bind_btCollisionWorld_contactPairTest_3:ro,_emscripten_bind_btDispatcherInfo_get_m_useContinuous_0:hd,_emscripten_bind_btCylinderShapeX___destroy___0:Tn,_emscripten_bind_btManifoldPoint_getPositionWorldOnA_0:Ce,_emscripten_bind_LocalConvexResult_set_m_localShapeInfo_1:Rm,_emscripten_bind_btDispatcherInfo_set_m_stepCount_1:cd,_emscripten_bind_btVector4_x_0:wk,_emscripten_bind_btPairCachingGhostObject_setCollisionFlags_1:Vd,_emscripten_bind_btKinematicCharacterController_getGhostObject_0:Vk,_emscripten_bind_btRigidBody_btRigidBody_1:_m,_emscripten_bind_btTriangleMeshShape___destroy___0:Ei,_emscripten_bind_btKinematicCharacterController_setWalkDirection_1:Hk,_emscripten_bind_btRigidBodyConstructionInfo_get_m_restitution_0:le,_emscripten_bind_btTransform_setIdentity_0:_n,_emscripten_bind_btManifoldPoint_set_m_normalWorldOnB_1:Oe,_emscripten_bind_btKinematicCharacterController_getGravity_0:Sk,_emscripten_bind_btConeTwistConstraint_getBreakingImpulseThreshold_0:Rg,_emscripten_bind_btDiscreteDynamicsWorld_addAction_1:Tf,_emscripten_bind_btQuaternion_setY_1:xj,_emscripten_bind_btConeShape_calculateLocalInertia_2:Wg,_emscripten_bind_btCylinderShapeX_calculateLocalInertia_2:Sn,_emscripten_bind_ConvexResultCallback_set_m_collisionFilterMask_1:dg,_llvm_bswap_i32:sF,_emscripten_bind_btSphereShape_setLocalScaling_1:wl,_emscripten_bind_btVector4_w_0:tk,_emscripten_bind_btManifoldPoint_get_m_normalWorldOnB_0:Ne,_emscripten_bind_btBvhTriangleMeshShape___destroy___0:Vc,_emscripten_bind_LocalConvexResult_LocalConvexResult_5:Nm,_emscripten_bind_ClosestConvexResultCallback_set_m_closestHitFraction_1:si,_emscripten_bind_btDiscreteDynamicsWorld_removeConstraint_1:Df,_emscripten_bind_btVector4_y_0:xk,_emscripten_bind_btGeneric6DofConstraint___destroy___0:Ze,_emscripten_bind_btVehicleTuning_get_m_maxSuspensionTravelCm_0:Th,_emscripten_bind_btConvexHullShape_addPoint_1:th,_emscripten_bind_btConvexHullShape_addPoint_2:uh,_emscripten_bind_btPoint2PointConstraint_getBreakingImpulseThreshold_0:og,_emscripten_bind_btTransform_getOrigin_0:bo,_emscripten_bind_btHingeConstraint___destroy___0:Nl,_emscripten_bind_btConvexShape_calculateLocalInertia_2:Zg,_memset:nF,_emscripten_bind_btGeneric6DofConstraint_setLinearLowerLimit_1:Se,_emscripten_bind_btConvexHullShape_setLocalScaling_1:vh,_emscripten_bind_btTriangleMesh_btTriangleMesh_0:mh,_emscripten_bind_btPairCachingGhostObject_getCollisionShape_0:Id,_emscripten_bind_btTriangleMesh_btTriangleMesh_2:oh,_emscripten_bind_btWheelInfo_set_m_frictionSlip_1:Sj,_emscripten_bind_btDynamicsWorld_performDiscreteCollisionDetection_0:bj,_emscripten_bind_btRigidBody_getCollisionShape_0:xn,_emscripten_bind_btManifoldPoint_set_m_positionWorldOnA_1:Me,_emscripten_bind_btWheelInfo_get_m_wheelsDampingRelaxation_0:$j,_emscripten_bind_btManifoldPoint_get_m_localPointB_0:He,_emscripten_bind_btDiscreteDynamicsWorld_contactPairTest_3:Sf,_emscripten_bind_btSliderConstraint_setLowerLinLimit_1:yg,_emscripten_bind_btPoint2PointConstraint_set_m_setting_1:rg,_emscripten_bind_btCollisionObject_setCcdSweptSphereRadius_1:tf,_emscripten_bind_btWheelInfo_get_m_wheelsRadius_0:Xj,_emscripten_bind_btRigidBody_setLinearVelocity_1:rn,_emscripten_bind_btVehicleTuning_btVehicleTuning_0:Mh,_emscripten_bind_RayResultCallback_set_m_collisionObject_1:Nj,_emscripten_bind_ClosestRayResultCallback_set_m_rayToWorld_1:Ni,_emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterGroup_0:Si,_emscripten_bind_btWheelInfo_set_m_wheelsDampingRelaxation_1:ak,_emscripten_bind_btDynamicsWorld_addAction_1:Zi,_emscripten_bind_btPairCachingGhostObject_getCollisionFlags_0:Ud,_emscripten_bind_btRigidBodyConstructionInfo_set_m_linearDamping_1:ee,_emscripten_bind_btRigidBody_setGravity_1:fn,_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDamping_1:se,_emscripten_bind_btKinematicCharacterController_setFallSpeed_1:Mk,_emscripten_bind_btRigidBody_setActivationState_1:zn,_emscripten_bind_ClosestConvexResultCallback_hasHit_0:ei,_emscripten_bind_btCapsuleShapeZ___destroy___0:Ej,_emscripten_bind_LocalShapeInfo_set_m_shapePart_1:vm,_emscripten_bind_ClosestRayResultCallback_get_m_collisionObject_0:Wi,_emscripten_bind_btTriangleMesh_addTriangle_3:ph,_emscripten_bind_btGhostObject_getOverlappingObject_1:$l,_emscripten_bind_btTriangleMesh_addTriangle_4:qh,_emscripten_bind_btRigidBody_applyTorqueImpulse_1:kn,_emscripten_bind_btRigidBody_setCollisionFlags_1:Kn,_emscripten_bind_btWheelInfo_set_m_suspensionRestLength1_1:Wj,_emscripten_bind_btConeShape___destroy___0:Xg,_emscripten_bind_btCapsuleShapeZ_btCapsuleShapeZ_2:Bj,_emscripten_bind_btSliderConstraint_btSliderConstraint_5:xg,_emscripten_bind_btSliderConstraint_btSliderConstraint_3:wg,_emscripten_bind_btTransform___destroy___0:fo,_emscripten_bind_btDynamicsWorld_convexSweepTest_5:jj,_emscripten_bind_btRigidBody_forceActivationState_1:An,_emscripten_bind_btPoint2PointConstraint_setPivotB_1:kg,_emscripten_bind_btManifoldPoint_getDistance_0:Ee,_emscripten_bind_btGhostPairCallback___destroy___0:Uo,_emscripten_bind_btKinematicCharacterController_getMaxSlope_0:Uk,_emscripten_bind_btSliderConstraint_enableFeedback_1:Cg,_emscripten_bind_btRaycastVehicle_addWheel_7:Ho,_emscripten_bind_ClosestRayResultCallback_set_m_hitNormalWorld_1:Pi,_emscripten_bind_ContactResultCallback___destroy___0:dh,_emscripten_bind_btStaticPlaneShape___destroy___0:al,_emscripten_bind_btCylinderShapeZ_setLocalScaling_1:Vn,_emscripten_bind_btBoxShape_setLocalScaling_1:Fh,_emscripten_bind_btConeShapeZ___destroy___0:hh,_emscripten_bind_btDynamicsWorld_getPairCache_0:dj,_emscripten_bind_btDiscreteDynamicsWorld_convexSweepTest_5:Rf,_emscripten_bind_btKinematicCharacterController_setVelocityForTimeInterval_2:Ik,_emscripten_bind_btRigidBody_setRestitution_1:Fn,_emscripten_bind_btVector4_btVector4_0:rk,_emscripten_bind_btDispatcherInfo_get_m_enableSatConvex_0:jd,_emscripten_bind_btDiscreteDynamicsWorld_performDiscreteCollisionDetection_0:Jf,_emscripten_bind_btVector4_btVector4_4:sk,_emscripten_bind_btKinematicCharacterController___destroy___0:Yk,_emscripten_bind_btGeneric6DofSpringConstraint_setLinearLowerLimit_1:Fm,_emscripten_bind_LocalConvexResult_set_m_hitCollisionObject_1:Pm,_emscripten_bind_btConstraintSetting_btConstraintSetting_0:Rl,_emscripten_bind_btGeneric6DofSpringConstraint_setAngularLowerLimit_1:Hm,_emscripten_bind_btDiscreteDynamicsWorld_rayTest_3:Kf,_emscripten_bind_btContactSolverInfo_get_m_splitImpulse_0:bl,_emscripten_bind_btGhostPairCallback_btGhostPairCallback_0:To,_emscripten_bind_btKinematicCharacterController_setMaxJumpHeight_1:Ok,_emscripten_bind_btPairCachingGhostObject_isActive_0:Od,_emscripten_bind_btVehicleTuning_get_m_frictionSlip_0:Vh,__GLOBAL__sub_I_btQuickprof_cpp:oE,runPostSets:lF,_emscripten_replace_memory:_emscripten_replace_memory,stackAlloc:Dc,stackSave:Ec,stackRestore:Fc,setThrew:Gc,setTempRet0:Jc,getTempRet0:Kc,dynCall_viiiii:EF,dynCall_vid:FF,dynCall_vi:GF,dynCall_viiidii:HF,dynCall_vii:IF,dynCall_iiiiiiiiiii:JF,dynCall_ii:KF,dynCall_viidi:LF,dynCall_viddiii:MF,dynCall_vidii:NF,dynCall_iiiii:OF,dynCall_vidi:PF,dynCall_diiiiiiii:QF,dynCall_viiiiddddiid:RF,dynCall_diiiii:SF,dynCall_iiii:TF,dynCall_viiiiii:UF,dynCall_iiid:VF,dynCall_di:WF,dynCall_iiiiiii:XF,dynCall_diiidii:YF,dynCall_viidii:ZF,dynCall_viiiiiii:_F,dynCall_viiiiiiiii:$F,dynCall_viiiiiiiiii:aG,dynCall_iii:bG,dynCall_diii:cG,dynCall_diiiiiiiiii:dG,dynCall_viiiid:eG,dynCall_diiiiiiiii:fG,dynCall_did:gG,dynCall_viiiidddddidi:hG,dynCall_diidii:iG,dynCall_diiii:jG,dynCall_iiiiiiiiii:kG,dynCall_viiid:lG,dynCall_viii:mG,dynCall_v:nG,dynCall_viid:oG,dynCall_iidid:pG,dynCall_viiii:qG}})


// EMSCRIPTEN_END_ASM
(Module.asmGlobalArg,Module.asmLibraryArg,buffer);var _emscripten_bind_btCylinderShape___destroy___0=Module["_emscripten_bind_btCylinderShape___destroy___0"]=asm["_emscripten_bind_btCylinderShape___destroy___0"];var _emscripten_bind_btGeneric6DofConstraint_enableFeedback_1=Module["_emscripten_bind_btGeneric6DofConstraint_enableFeedback_1"]=asm["_emscripten_bind_btGeneric6DofConstraint_enableFeedback_1"];var _strlen=Module["_strlen"]=asm["_strlen"];var _emscripten_bind_btDispatcherInfo_set_m_useContinuous_1=Module["_emscripten_bind_btDispatcherInfo_set_m_useContinuous_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_useContinuous_1"];var _emscripten_bind_btCollisionObject_isActive_0=Module["_emscripten_bind_btCollisionObject_isActive_0"]=asm["_emscripten_bind_btCollisionObject_isActive_0"];var _emscripten_bind_btVehicleTuning_set_m_frictionSlip_1=Module["_emscripten_bind_btVehicleTuning_set_m_frictionSlip_1"]=asm["_emscripten_bind_btVehicleTuning_set_m_frictionSlip_1"];var _emscripten_bind_btDiscreteDynamicsWorld_btDiscreteDynamicsWorld_4=Module["_emscripten_bind_btDiscreteDynamicsWorld_btDiscreteDynamicsWorld_4"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_btDiscreteDynamicsWorld_4"];var _emscripten_bind_btContactSolverInfo___destroy___0=Module["_emscripten_bind_btContactSolverInfo___destroy___0"]=asm["_emscripten_bind_btContactSolverInfo___destroy___0"];var _emscripten_bind_btWheelInfo_get_m_rollInfluence_0=Module["_emscripten_bind_btWheelInfo_get_m_rollInfluence_0"]=asm["_emscripten_bind_btWheelInfo_get_m_rollInfluence_0"];var _emscripten_bind_btTypedConstraint_setBreakingImpulseThreshold_1=Module["_emscripten_bind_btTypedConstraint_setBreakingImpulseThreshold_1"]=asm["_emscripten_bind_btTypedConstraint_setBreakingImpulseThreshold_1"];var _emscripten_bind_btQuaternion_setX_1=Module["_emscripten_bind_btQuaternion_setX_1"]=asm["_emscripten_bind_btQuaternion_setX_1"];var _emscripten_bind_btDispatcherInfo_get_m_timeOfImpact_0=Module["_emscripten_bind_btDispatcherInfo_get_m_timeOfImpact_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_timeOfImpact_0"];var _emscripten_bind_btQuaternion_setZ_1=Module["_emscripten_bind_btQuaternion_setZ_1"]=asm["_emscripten_bind_btQuaternion_setZ_1"];var _emscripten_bind_LocalConvexResult_get_m_hitNormalLocal_0=Module["_emscripten_bind_LocalConvexResult_get_m_hitNormalLocal_0"]=asm["_emscripten_bind_LocalConvexResult_get_m_hitNormalLocal_0"];var _emscripten_bind_btKinematicCharacterController_setMaxSlope_1=Module["_emscripten_bind_btKinematicCharacterController_setMaxSlope_1"]=asm["_emscripten_bind_btKinematicCharacterController_setMaxSlope_1"];var _emscripten_bind_btQuadWord_z_0=Module["_emscripten_bind_btQuadWord_z_0"]=asm["_emscripten_bind_btQuadWord_z_0"];var _emscripten_bind_btTransform_setIdentity_0=Module["_emscripten_bind_btTransform_setIdentity_0"]=asm["_emscripten_bind_btTransform_setIdentity_0"];var _emscripten_bind_btWheelInfo_get_m_suspensionRestLength1_0=Module["_emscripten_bind_btWheelInfo_get_m_suspensionRestLength1_0"]=asm["_emscripten_bind_btWheelInfo_get_m_suspensionRestLength1_0"];var _emscripten_bind_btWheelInfo_get_m_suspensionStiffness_0=Module["_emscripten_bind_btWheelInfo_get_m_suspensionStiffness_0"]=asm["_emscripten_bind_btWheelInfo_get_m_suspensionStiffness_0"];var _emscripten_bind_btQuaternion_setW_1=Module["_emscripten_bind_btQuaternion_setW_1"]=asm["_emscripten_bind_btQuaternion_setW_1"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_angularDamping_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_angularDamping_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_angularDamping_0"];var _emscripten_bind_btCollisionDispatcher___destroy___0=Module["_emscripten_bind_btCollisionDispatcher___destroy___0"]=asm["_emscripten_bind_btCollisionDispatcher___destroy___0"];var _emscripten_bind_btRigidBody_applyCentralImpulse_1=Module["_emscripten_bind_btRigidBody_applyCentralImpulse_1"]=asm["_emscripten_bind_btRigidBody_applyCentralImpulse_1"];var _emscripten_bind_btDefaultMotionState_getWorldTransform_1=Module["_emscripten_bind_btDefaultMotionState_getWorldTransform_1"]=asm["_emscripten_bind_btDefaultMotionState_getWorldTransform_1"];var _emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_1=Module["_emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_1"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_1"];var _emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_3=Module["_emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_3"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_3"];var _emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_2=Module["_emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_2"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_2"];var _emscripten_bind_btVector3_op_mul_1=Module["_emscripten_bind_btVector3_op_mul_1"]=asm["_emscripten_bind_btVector3_op_mul_1"];var _emscripten_bind_btDynamicsWorld_rayTest_3=Module["_emscripten_bind_btDynamicsWorld_rayTest_3"]=asm["_emscripten_bind_btDynamicsWorld_rayTest_3"];var _emscripten_bind_btRaycastVehicle_updateWheelTransform_2=Module["_emscripten_bind_btRaycastVehicle_updateWheelTransform_2"]=asm["_emscripten_bind_btRaycastVehicle_updateWheelTransform_2"];var _emscripten_bind_btQuadWord_x_0=Module["_emscripten_bind_btQuadWord_x_0"]=asm["_emscripten_bind_btQuadWord_x_0"];var _emscripten_bind_btCollisionObject_isKinematicObject_0=Module["_emscripten_bind_btCollisionObject_isKinematicObject_0"]=asm["_emscripten_bind_btCollisionObject_isKinematicObject_0"];var _emscripten_bind_btWheelInfo_set_m_chassisConnectionPointCS_1=Module["_emscripten_bind_btWheelInfo_set_m_chassisConnectionPointCS_1"]=asm["_emscripten_bind_btWheelInfo_set_m_chassisConnectionPointCS_1"];var _emscripten_bind_btSphereShape___destroy___0=Module["_emscripten_bind_btSphereShape___destroy___0"]=asm["_emscripten_bind_btSphereShape___destroy___0"];var _emscripten_bind_btGeneric6DofSpringConstraint_setLinearUpperLimit_1=Module["_emscripten_bind_btGeneric6DofSpringConstraint_setLinearUpperLimit_1"]=asm["_emscripten_bind_btGeneric6DofSpringConstraint_setLinearUpperLimit_1"];var _emscripten_bind_ClosestConvexResultCallback_set_m_hitNormalWorld_1=Module["_emscripten_bind_ClosestConvexResultCallback_set_m_hitNormalWorld_1"]=asm["_emscripten_bind_ClosestConvexResultCallback_set_m_hitNormalWorld_1"];var _emscripten_bind_btRigidBody_getCenterOfMassTransform_0=Module["_emscripten_bind_btRigidBody_getCenterOfMassTransform_0"]=asm["_emscripten_bind_btRigidBody_getCenterOfMassTransform_0"];var _emscripten_bind_btGhostObject_isKinematicObject_0=Module["_emscripten_bind_btGhostObject_isKinematicObject_0"]=asm["_emscripten_bind_btGhostObject_isKinematicObject_0"];var _emscripten_bind_btGeneric6DofSpringConstraint_btGeneric6DofSpringConstraint_5=Module["_emscripten_bind_btGeneric6DofSpringConstraint_btGeneric6DofSpringConstraint_5"]=asm["_emscripten_bind_btGeneric6DofSpringConstraint_btGeneric6DofSpringConstraint_5"];var _emscripten_bind_btGeneric6DofSpringConstraint_btGeneric6DofSpringConstraint_3=Module["_emscripten_bind_btGeneric6DofSpringConstraint_btGeneric6DofSpringConstraint_3"]=asm["_emscripten_bind_btGeneric6DofSpringConstraint_btGeneric6DofSpringConstraint_3"];var _emscripten_bind_btCollisionObject_activate_1=Module["_emscripten_bind_btCollisionObject_activate_1"]=asm["_emscripten_bind_btCollisionObject_activate_1"];var _emscripten_bind_btCollisionObject_activate_0=Module["_emscripten_bind_btCollisionObject_activate_0"]=asm["_emscripten_bind_btCollisionObject_activate_0"];var _emscripten_bind_btKinematicCharacterController_setUpAxis_1=Module["_emscripten_bind_btKinematicCharacterController_setUpAxis_1"]=asm["_emscripten_bind_btKinematicCharacterController_setUpAxis_1"];var _emscripten_bind_btDispatcherInfo_set_m_timeOfImpact_1=Module["_emscripten_bind_btDispatcherInfo_set_m_timeOfImpact_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_timeOfImpact_1"];var _emscripten_bind_btCollisionDispatcher_btCollisionDispatcher_1=Module["_emscripten_bind_btCollisionDispatcher_btCollisionDispatcher_1"]=asm["_emscripten_bind_btCollisionDispatcher_btCollisionDispatcher_1"];var _emscripten_bind_btVector3_setX_1=Module["_emscripten_bind_btVector3_setX_1"]=asm["_emscripten_bind_btVector3_setX_1"];var _emscripten_bind_btCollisionConfiguration___destroy___0=Module["_emscripten_bind_btCollisionConfiguration___destroy___0"]=asm["_emscripten_bind_btCollisionConfiguration___destroy___0"];var _emscripten_bind_btQuaternion_btQuaternion_4=Module["_emscripten_bind_btQuaternion_btQuaternion_4"]=asm["_emscripten_bind_btQuaternion_btQuaternion_4"];var _emscripten_bind_btManifoldPoint_set_m_positionWorldOnB_1=Module["_emscripten_bind_btManifoldPoint_set_m_positionWorldOnB_1"]=asm["_emscripten_bind_btManifoldPoint_set_m_positionWorldOnB_1"];var _emscripten_bind_btManifoldPoint_set_m_localPointB_1=Module["_emscripten_bind_btManifoldPoint_set_m_localPointB_1"]=asm["_emscripten_bind_btManifoldPoint_set_m_localPointB_1"];var _emscripten_bind_btVector3_setZ_1=Module["_emscripten_bind_btVector3_setZ_1"]=asm["_emscripten_bind_btVector3_setZ_1"];var _emscripten_bind_btWheelInfo_get_m_maxSuspensionTravelCm_0=Module["_emscripten_bind_btWheelInfo_get_m_maxSuspensionTravelCm_0"]=asm["_emscripten_bind_btWheelInfo_get_m_maxSuspensionTravelCm_0"];var _emscripten_bind_btQuaternion_setValue_4=Module["_emscripten_bind_btQuaternion_setValue_4"]=asm["_emscripten_bind_btQuaternion_setValue_4"];var _emscripten_bind_btDispatcherInfo_set_m_dispatchFunc_1=Module["_emscripten_bind_btDispatcherInfo_set_m_dispatchFunc_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_dispatchFunc_1"];var _emscripten_bind_LocalShapeInfo___destroy___0=Module["_emscripten_bind_LocalShapeInfo___destroy___0"]=asm["_emscripten_bind_LocalShapeInfo___destroy___0"];var _emscripten_bind_btWheelInfo_get_m_bIsFrontWheel_0=Module["_emscripten_bind_btWheelInfo_get_m_bIsFrontWheel_0"]=asm["_emscripten_bind_btWheelInfo_get_m_bIsFrontWheel_0"];var _emscripten_bind_btQuadWord_setY_1=Module["_emscripten_bind_btQuadWord_setY_1"]=asm["_emscripten_bind_btQuadWord_setY_1"];var _emscripten_bind_ContactResultCallback_addSingleResult_7=Module["_emscripten_bind_ContactResultCallback_addSingleResult_7"]=asm["_emscripten_bind_ContactResultCallback_addSingleResult_7"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_restitution_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_restitution_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_restitution_1"];var _emscripten_bind_btDefaultMotionState_get_m_graphicsWorldTrans_0=Module["_emscripten_bind_btDefaultMotionState_get_m_graphicsWorldTrans_0"]=asm["_emscripten_bind_btDefaultMotionState_get_m_graphicsWorldTrans_0"];var _emscripten_bind_btConeTwistConstraint_setDamping_1=Module["_emscripten_bind_btConeTwistConstraint_setDamping_1"]=asm["_emscripten_bind_btConeTwistConstraint_setDamping_1"];var _emscripten_bind_btPairCachingGhostObject_btPairCachingGhostObject_0=Module["_emscripten_bind_btPairCachingGhostObject_btPairCachingGhostObject_0"]=asm["_emscripten_bind_btPairCachingGhostObject_btPairCachingGhostObject_0"];var _emscripten_bind_btDiscreteDynamicsWorld_getSolverInfo_0=Module["_emscripten_bind_btDiscreteDynamicsWorld_getSolverInfo_0"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_getSolverInfo_0"];var _emscripten_bind_btCollisionWorld___destroy___0=Module["_emscripten_bind_btCollisionWorld___destroy___0"]=asm["_emscripten_bind_btCollisionWorld___destroy___0"];var _emscripten_bind_LocalConvexResult_get_m_hitPointLocal_0=Module["_emscripten_bind_LocalConvexResult_get_m_hitPointLocal_0"]=asm["_emscripten_bind_LocalConvexResult_get_m_hitPointLocal_0"];var _emscripten_bind_btBoxShape_btBoxShape_1=Module["_emscripten_bind_btBoxShape_btBoxShape_1"]=asm["_emscripten_bind_btBoxShape_btBoxShape_1"];var _emscripten_bind_btPersistentManifold_getBody1_0=Module["_emscripten_bind_btPersistentManifold_getBody1_0"]=asm["_emscripten_bind_btPersistentManifold_getBody1_0"];var _emscripten_bind_btRigidBody_isKinematicObject_0=Module["_emscripten_bind_btRigidBody_isKinematicObject_0"]=asm["_emscripten_bind_btRigidBody_isKinematicObject_0"];var _emscripten_bind_btKinematicCharacterController_setGravity_1=Module["_emscripten_bind_btKinematicCharacterController_setGravity_1"]=asm["_emscripten_bind_btKinematicCharacterController_setGravity_1"];var _emscripten_bind_btConstraintSetting_set_m_impulseClamp_1=Module["_emscripten_bind_btConstraintSetting_set_m_impulseClamp_1"]=asm["_emscripten_bind_btConstraintSetting_set_m_impulseClamp_1"];var _emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_5=Module["_emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_5"]=asm["_emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_5"];var _emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_3=Module["_emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_3"]=asm["_emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_3"];var _emscripten_bind_btQuaternion_setY_1=Module["_emscripten_bind_btQuaternion_setY_1"]=asm["_emscripten_bind_btQuaternion_setY_1"];var _emscripten_bind_ClosestRayResultCallback_get_m_hitPointWorld_0=Module["_emscripten_bind_ClosestRayResultCallback_get_m_hitPointWorld_0"]=asm["_emscripten_bind_ClosestRayResultCallback_get_m_hitPointWorld_0"];var _emscripten_bind_btVector4_setValue_4=Module["_emscripten_bind_btVector4_setValue_4"]=asm["_emscripten_bind_btVector4_setValue_4"];var _emscripten_bind_btBvhTriangleMeshShape_setLocalScaling_1=Module["_emscripten_bind_btBvhTriangleMeshShape_setLocalScaling_1"]=asm["_emscripten_bind_btBvhTriangleMeshShape_setLocalScaling_1"];var _emscripten_bind_btPoint2PointConstraint_setBreakingImpulseThreshold_1=Module["_emscripten_bind_btPoint2PointConstraint_setBreakingImpulseThreshold_1"]=asm["_emscripten_bind_btPoint2PointConstraint_setBreakingImpulseThreshold_1"];var _emscripten_bind_btDynamicsWorld_getDispatchInfo_0=Module["_emscripten_bind_btDynamicsWorld_getDispatchInfo_0"]=asm["_emscripten_bind_btDynamicsWorld_getDispatchInfo_0"];var _emscripten_bind_btVector3_length_0=Module["_emscripten_bind_btVector3_length_0"]=asm["_emscripten_bind_btVector3_length_0"];var _emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_2=Module["_emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_2"]=asm["_emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_2"];var _emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_1=Module["_emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_1"]=asm["_emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_1"];var _emscripten_bind_ClosestConvexResultCallback_set_m_hitPointWorld_1=Module["_emscripten_bind_ClosestConvexResultCallback_set_m_hitPointWorld_1"]=asm["_emscripten_bind_ClosestConvexResultCallback_set_m_hitPointWorld_1"];var _emscripten_bind_RayResultCallback_set_m_collisionFilterMask_1=Module["_emscripten_bind_RayResultCallback_set_m_collisionFilterMask_1"]=asm["_emscripten_bind_RayResultCallback_set_m_collisionFilterMask_1"];var _emscripten_bind_btPairCachingGhostObject___destroy___0=Module["_emscripten_bind_btPairCachingGhostObject___destroy___0"]=asm["_emscripten_bind_btPairCachingGhostObject___destroy___0"];var _emscripten_bind_btDynamicsWorld_addCollisionObject_3=Module["_emscripten_bind_btDynamicsWorld_addCollisionObject_3"]=asm["_emscripten_bind_btDynamicsWorld_addCollisionObject_3"];var _emscripten_bind_btPairCachingGhostObject_activate_0=Module["_emscripten_bind_btPairCachingGhostObject_activate_0"]=asm["_emscripten_bind_btPairCachingGhostObject_activate_0"];var _emscripten_bind_btPairCachingGhostObject_activate_1=Module["_emscripten_bind_btPairCachingGhostObject_activate_1"]=asm["_emscripten_bind_btPairCachingGhostObject_activate_1"];var _emscripten_bind_btContactSolverInfo_get_m_splitImpulsePenetrationThreshold_0=Module["_emscripten_bind_btContactSolverInfo_get_m_splitImpulsePenetrationThreshold_0"]=asm["_emscripten_bind_btContactSolverInfo_get_m_splitImpulsePenetrationThreshold_0"];var _emscripten_bind_btPairCachingGhostObject_forceActivationState_1=Module["_emscripten_bind_btPairCachingGhostObject_forceActivationState_1"]=asm["_emscripten_bind_btPairCachingGhostObject_forceActivationState_1"];var _emscripten_bind_btDefaultMotionState___destroy___0=Module["_emscripten_bind_btDefaultMotionState___destroy___0"]=asm["_emscripten_bind_btDefaultMotionState___destroy___0"];var _emscripten_bind_btDispatcherInfo_get_m_stepCount_0=Module["_emscripten_bind_btDispatcherInfo_get_m_stepCount_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_stepCount_0"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_angularDamping_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_angularDamping_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_angularDamping_1"];var _emscripten_bind_btQuadWord_setW_1=Module["_emscripten_bind_btQuadWord_setW_1"]=asm["_emscripten_bind_btQuadWord_setW_1"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_friction_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_friction_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_friction_0"];var _emscripten_bind_btCapsuleShapeX_btCapsuleShapeX_2=Module["_emscripten_bind_btCapsuleShapeX_btCapsuleShapeX_2"]=asm["_emscripten_bind_btCapsuleShapeX_btCapsuleShapeX_2"];var _emscripten_bind_btWheelInfo_get_m_maxSuspensionForce_0=Module["_emscripten_bind_btWheelInfo_get_m_maxSuspensionForce_0"]=asm["_emscripten_bind_btWheelInfo_get_m_maxSuspensionForce_0"];var _emscripten_bind_btRigidBody_setLinearFactor_1=Module["_emscripten_bind_btRigidBody_setLinearFactor_1"]=asm["_emscripten_bind_btRigidBody_setLinearFactor_1"];var _emscripten_bind_btDispatcherInfo_set_m_useConvexConservativeDistanceUtil_1=Module["_emscripten_bind_btDispatcherInfo_set_m_useConvexConservativeDistanceUtil_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_useConvexConservativeDistanceUtil_1"];var _emscripten_bind_btRaycastVehicle_setSteeringValue_2=Module["_emscripten_bind_btRaycastVehicle_setSteeringValue_2"]=asm["_emscripten_bind_btRaycastVehicle_setSteeringValue_2"];var _emscripten_bind_btPoint2PointConstraint___destroy___0=Module["_emscripten_bind_btPoint2PointConstraint___destroy___0"]=asm["_emscripten_bind_btPoint2PointConstraint___destroy___0"];var _emscripten_bind_btGeneric6DofConstraint_setAngularUpperLimit_1=Module["_emscripten_bind_btGeneric6DofConstraint_setAngularUpperLimit_1"]=asm["_emscripten_bind_btGeneric6DofConstraint_setAngularUpperLimit_1"];var _emscripten_bind_btDiscreteDynamicsWorld_addConstraint_2=Module["_emscripten_bind_btDiscreteDynamicsWorld_addConstraint_2"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_addConstraint_2"];var _emscripten_bind_btDiscreteDynamicsWorld_addConstraint_1=Module["_emscripten_bind_btDiscreteDynamicsWorld_addConstraint_1"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_addConstraint_1"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_angularSleepingThreshold_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_angularSleepingThreshold_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_angularSleepingThreshold_1"];var _emscripten_bind_btCollisionWorld_computeOverlappingPairs_0=Module["_emscripten_bind_btCollisionWorld_computeOverlappingPairs_0"]=asm["_emscripten_bind_btCollisionWorld_computeOverlappingPairs_0"];var _malloc=Module["_malloc"]=asm["_malloc"];var _emscripten_bind_btDispatcherInfo_get_m_useEpa_0=Module["_emscripten_bind_btDispatcherInfo_get_m_useEpa_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_useEpa_0"];var _emscripten_replace_memory=Module["_emscripten_replace_memory"]=asm["_emscripten_replace_memory"];var _emscripten_bind_btTransform_btTransform_2=Module["_emscripten_bind_btTransform_btTransform_2"]=asm["_emscripten_bind_btTransform_btTransform_2"];var _emscripten_bind_btTransform_btTransform_0=Module["_emscripten_bind_btTransform_btTransform_0"]=asm["_emscripten_bind_btTransform_btTransform_0"];var _emscripten_bind_btWheelInfo_set_m_wheelsRadius_1=Module["_emscripten_bind_btWheelInfo_set_m_wheelsRadius_1"]=asm["_emscripten_bind_btWheelInfo_set_m_wheelsRadius_1"];var _emscripten_bind_btDispatcherInfo_set_m_enableSPU_1=Module["_emscripten_bind_btDispatcherInfo_set_m_enableSPU_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_enableSPU_1"];var _emscripten_bind_btRaycastVehicle_setCoordinateSystem_3=Module["_emscripten_bind_btRaycastVehicle_setCoordinateSystem_3"]=asm["_emscripten_bind_btRaycastVehicle_setCoordinateSystem_3"];var _emscripten_bind_btCollisionObject_setActivationState_1=Module["_emscripten_bind_btCollisionObject_setActivationState_1"]=asm["_emscripten_bind_btCollisionObject_setActivationState_1"];var _emscripten_bind_btPersistentManifold___destroy___0=Module["_emscripten_bind_btPersistentManifold___destroy___0"]=asm["_emscripten_bind_btPersistentManifold___destroy___0"];var _emscripten_bind_btConstraintSetting_get_m_impulseClamp_0=Module["_emscripten_bind_btConstraintSetting_get_m_impulseClamp_0"]=asm["_emscripten_bind_btConstraintSetting_get_m_impulseClamp_0"];var _emscripten_bind_btCylinderShapeZ___destroy___0=Module["_emscripten_bind_btCylinderShapeZ___destroy___0"]=asm["_emscripten_bind_btCylinderShapeZ___destroy___0"];var _emscripten_bind_btMatrix3x3___destroy___0=Module["_emscripten_bind_btMatrix3x3___destroy___0"]=asm["_emscripten_bind_btMatrix3x3___destroy___0"];var _emscripten_bind_btGeneric6DofSpringConstraint_setBreakingImpulseThreshold_1=Module["_emscripten_bind_btGeneric6DofSpringConstraint_setBreakingImpulseThreshold_1"]=asm["_emscripten_bind_btGeneric6DofSpringConstraint_setBreakingImpulseThreshold_1"];var _emscripten_bind_btCollisionShape_calculateLocalInertia_2=Module["_emscripten_bind_btCollisionShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btCollisionShape_calculateLocalInertia_2"];var _emscripten_bind_ConvexResultCallback_hasHit_0=Module["_emscripten_bind_ConvexResultCallback_hasHit_0"]=asm["_emscripten_bind_ConvexResultCallback_hasHit_0"];var _emscripten_bind_btCollisionWorld_convexSweepTest_5=Module["_emscripten_bind_btCollisionWorld_convexSweepTest_5"]=asm["_emscripten_bind_btCollisionWorld_convexSweepTest_5"];var _emscripten_bind_ClosestRayResultCallback_set_m_hitPointWorld_1=Module["_emscripten_bind_ClosestRayResultCallback_set_m_hitPointWorld_1"]=asm["_emscripten_bind_ClosestRayResultCallback_set_m_hitPointWorld_1"];var _emscripten_bind_btCapsuleShapeX_calculateLocalInertia_2=Module["_emscripten_bind_btCapsuleShapeX_calculateLocalInertia_2"]=asm["_emscripten_bind_btCapsuleShapeX_calculateLocalInertia_2"];var _emscripten_bind_btConstraintSetting_set_m_damping_1=Module["_emscripten_bind_btConstraintSetting_set_m_damping_1"]=asm["_emscripten_bind_btConstraintSetting_set_m_damping_1"];var _emscripten_bind_btWheelInfo_set_m_bIsFrontWheel_1=Module["_emscripten_bind_btWheelInfo_set_m_bIsFrontWheel_1"]=asm["_emscripten_bind_btWheelInfo_set_m_bIsFrontWheel_1"];var _emscripten_bind_btRigidBody_setCcdMotionThreshold_1=Module["_emscripten_bind_btRigidBody_setCcdMotionThreshold_1"]=asm["_emscripten_bind_btRigidBody_setCcdMotionThreshold_1"];var _emscripten_bind_btRigidBody_applyForce_2=Module["_emscripten_bind_btRigidBody_applyForce_2"]=asm["_emscripten_bind_btRigidBody_applyForce_2"];var _emscripten_bind_btConeShapeZ_calculateLocalInertia_2=Module["_emscripten_bind_btConeShapeZ_calculateLocalInertia_2"]=asm["_emscripten_bind_btConeShapeZ_calculateLocalInertia_2"];var _emscripten_bind_btConstraintSetting_set_m_tau_1=Module["_emscripten_bind_btConstraintSetting_set_m_tau_1"]=asm["_emscripten_bind_btConstraintSetting_set_m_tau_1"];var _emscripten_bind_btConvexHullShape_calculateLocalInertia_2=Module["_emscripten_bind_btConvexHullShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btConvexHullShape_calculateLocalInertia_2"];var _emscripten_bind_btSphereShape_calculateLocalInertia_2=Module["_emscripten_bind_btSphereShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btSphereShape_calculateLocalInertia_2"];var _emscripten_bind_btSliderConstraint_setBreakingImpulseThreshold_1=Module["_emscripten_bind_btSliderConstraint_setBreakingImpulseThreshold_1"]=asm["_emscripten_bind_btSliderConstraint_setBreakingImpulseThreshold_1"];var _emscripten_bind_ConcreteContactResultCallback_addSingleResult_7=Module["_emscripten_bind_ConcreteContactResultCallback_addSingleResult_7"]=asm["_emscripten_bind_ConcreteContactResultCallback_addSingleResult_7"];var _emscripten_bind_LocalConvexResult_LocalConvexResult_5=Module["_emscripten_bind_LocalConvexResult_LocalConvexResult_5"]=asm["_emscripten_bind_LocalConvexResult_LocalConvexResult_5"];var _emscripten_bind_btGhostObject_setFriction_1=Module["_emscripten_bind_btGhostObject_setFriction_1"]=asm["_emscripten_bind_btGhostObject_setFriction_1"];var _emscripten_bind_btPairCachingGhostObject_getWorldTransform_0=Module["_emscripten_bind_btPairCachingGhostObject_getWorldTransform_0"]=asm["_emscripten_bind_btPairCachingGhostObject_getWorldTransform_0"];var _emscripten_bind_ClosestRayResultCallback_set_m_collisionObject_1=Module["_emscripten_bind_ClosestRayResultCallback_set_m_collisionObject_1"]=asm["_emscripten_bind_ClosestRayResultCallback_set_m_collisionObject_1"];var _emscripten_bind_btRigidBody_setCcdSweptSphereRadius_1=Module["_emscripten_bind_btRigidBody_setCcdSweptSphereRadius_1"]=asm["_emscripten_bind_btRigidBody_setCcdSweptSphereRadius_1"];var _emscripten_bind_btRigidBody_setFriction_1=Module["_emscripten_bind_btRigidBody_setFriction_1"]=asm["_emscripten_bind_btRigidBody_setFriction_1"];var _emscripten_bind_LocalConvexResult_set_m_hitPointLocal_1=Module["_emscripten_bind_LocalConvexResult_set_m_hitPointLocal_1"]=asm["_emscripten_bind_LocalConvexResult_set_m_hitPointLocal_1"];var _emscripten_bind_btGhostObject_setWorldTransform_1=Module["_emscripten_bind_btGhostObject_setWorldTransform_1"]=asm["_emscripten_bind_btGhostObject_setWorldTransform_1"];var _emscripten_bind_btDiscreteDynamicsWorld_removeRigidBody_1=Module["_emscripten_bind_btDiscreteDynamicsWorld_removeRigidBody_1"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_removeRigidBody_1"];var _emscripten_bind_btConvexHullShape___destroy___0=Module["_emscripten_bind_btConvexHullShape___destroy___0"]=asm["_emscripten_bind_btConvexHullShape___destroy___0"];var _emscripten_bind_btDiscreteDynamicsWorld_getBroadphase_0=Module["_emscripten_bind_btDiscreteDynamicsWorld_getBroadphase_0"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_getBroadphase_0"];var _emscripten_bind_btDiscreteDynamicsWorld_addAction_1=Module["_emscripten_bind_btDiscreteDynamicsWorld_addAction_1"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_addAction_1"];var _emscripten_bind_btVector4_setX_1=Module["_emscripten_bind_btVector4_setX_1"]=asm["_emscripten_bind_btVector4_setX_1"];var _emscripten_bind_btKinematicCharacterController_jump_0=Module["_emscripten_bind_btKinematicCharacterController_jump_0"]=asm["_emscripten_bind_btKinematicCharacterController_jump_0"];var _emscripten_bind_btConeTwistConstraint_setMaxMotorImpulseNormalized_1=Module["_emscripten_bind_btConeTwistConstraint_setMaxMotorImpulseNormalized_1"]=asm["_emscripten_bind_btConeTwistConstraint_setMaxMotorImpulseNormalized_1"];var _emscripten_bind_btConvexTriangleMeshShape_setLocalScaling_1=Module["_emscripten_bind_btConvexTriangleMeshShape_setLocalScaling_1"]=asm["_emscripten_bind_btConvexTriangleMeshShape_setLocalScaling_1"];var _emscripten_bind_btRigidBody_upcast_1=Module["_emscripten_bind_btRigidBody_upcast_1"]=asm["_emscripten_bind_btRigidBody_upcast_1"];var _emscripten_bind_btCollisionObject_getWorldTransform_0=Module["_emscripten_bind_btCollisionObject_getWorldTransform_0"]=asm["_emscripten_bind_btCollisionObject_getWorldTransform_0"];var _emscripten_bind_btVector4_setZ_1=Module["_emscripten_bind_btVector4_setZ_1"]=asm["_emscripten_bind_btVector4_setZ_1"];var _emscripten_bind_btQuadWord_y_0=Module["_emscripten_bind_btQuadWord_y_0"]=asm["_emscripten_bind_btQuadWord_y_0"];var _emscripten_bind_btTransform_getBasis_0=Module["_emscripten_bind_btTransform_getBasis_0"]=asm["_emscripten_bind_btTransform_getBasis_0"];var _emscripten_bind_btPairCachingGhostObject_setFriction_1=Module["_emscripten_bind_btPairCachingGhostObject_setFriction_1"]=asm["_emscripten_bind_btPairCachingGhostObject_setFriction_1"];var _emscripten_bind_btDispatcherInfo_set_m_useEpa_1=Module["_emscripten_bind_btDispatcherInfo_set_m_useEpa_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_useEpa_1"];var _emscripten_bind_btCollisionDispatcher_getNumManifolds_0=Module["_emscripten_bind_btCollisionDispatcher_getNumManifolds_0"]=asm["_emscripten_bind_btCollisionDispatcher_getNumManifolds_0"];var _emscripten_bind_btVehicleRaycaster___destroy___0=Module["_emscripten_bind_btVehicleRaycaster___destroy___0"]=asm["_emscripten_bind_btVehicleRaycaster___destroy___0"];var _emscripten_bind_ClosestRayResultCallback___destroy___0=Module["_emscripten_bind_ClosestRayResultCallback___destroy___0"]=asm["_emscripten_bind_ClosestRayResultCallback___destroy___0"];var _emscripten_bind_btGeneric6DofSpringConstraint_setStiffness_2=Module["_emscripten_bind_btGeneric6DofSpringConstraint_setStiffness_2"]=asm["_emscripten_bind_btGeneric6DofSpringConstraint_setStiffness_2"];var _emscripten_bind_btQuadWord_w_0=Module["_emscripten_bind_btQuadWord_w_0"]=asm["_emscripten_bind_btQuadWord_w_0"];var _emscripten_bind_btGhostObject_setCcdMotionThreshold_1=Module["_emscripten_bind_btGhostObject_setCcdMotionThreshold_1"]=asm["_emscripten_bind_btGhostObject_setCcdMotionThreshold_1"];var _emscripten_bind_btPairCachingGhostObject_getCollisionFlags_0=Module["_emscripten_bind_btPairCachingGhostObject_getCollisionFlags_0"]=asm["_emscripten_bind_btPairCachingGhostObject_getCollisionFlags_0"];var _emscripten_bind_btBvhTriangleMeshShape_calculateLocalInertia_2=Module["_emscripten_bind_btBvhTriangleMeshShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btBvhTriangleMeshShape_calculateLocalInertia_2"];var _emscripten_bind_btGhostObject_btGhostObject_0=Module["_emscripten_bind_btGhostObject_btGhostObject_0"]=asm["_emscripten_bind_btGhostObject_btGhostObject_0"];var _emscripten_bind_ClosestConvexResultCallback_ClosestConvexResultCallback_2=Module["_emscripten_bind_ClosestConvexResultCallback_ClosestConvexResultCallback_2"]=asm["_emscripten_bind_ClosestConvexResultCallback_ClosestConvexResultCallback_2"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingFactor_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingFactor_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingFactor_1"];var _emscripten_bind_btManifoldPoint_set_m_localPointA_1=Module["_emscripten_bind_btManifoldPoint_set_m_localPointA_1"]=asm["_emscripten_bind_btManifoldPoint_set_m_localPointA_1"];var _emscripten_bind_btCollisionObject_setCollisionShape_1=Module["_emscripten_bind_btCollisionObject_setCollisionShape_1"]=asm["_emscripten_bind_btCollisionObject_setCollisionShape_1"];var _emscripten_bind_btWheelInfo___destroy___0=Module["_emscripten_bind_btWheelInfo___destroy___0"]=asm["_emscripten_bind_btWheelInfo___destroy___0"];var _emscripten_bind_btTransform_setRotation_1=Module["_emscripten_bind_btTransform_setRotation_1"]=asm["_emscripten_bind_btTransform_setRotation_1"];var _emscripten_bind_btPairCachingGhostObject_getNumOverlappingObjects_0=Module["_emscripten_bind_btPairCachingGhostObject_getNumOverlappingObjects_0"]=asm["_emscripten_bind_btPairCachingGhostObject_getNumOverlappingObjects_0"];var _emscripten_bind_btPoint2PointConstraint_enableFeedback_1=Module["_emscripten_bind_btPoint2PointConstraint_enableFeedback_1"]=asm["_emscripten_bind_btPoint2PointConstraint_enableFeedback_1"];var _emscripten_bind_btQuadWord_setZ_1=Module["_emscripten_bind_btQuadWord_setZ_1"]=asm["_emscripten_bind_btQuadWord_setZ_1"];var _emscripten_bind_btAxisSweep3_btAxisSweep3_2=Module["_emscripten_bind_btAxisSweep3_btAxisSweep3_2"]=asm["_emscripten_bind_btAxisSweep3_btAxisSweep3_2"];var _emscripten_bind_btAxisSweep3_btAxisSweep3_3=Module["_emscripten_bind_btAxisSweep3_btAxisSweep3_3"]=asm["_emscripten_bind_btAxisSweep3_btAxisSweep3_3"];var _emscripten_bind_btDynamicsWorld___destroy___0=Module["_emscripten_bind_btDynamicsWorld___destroy___0"]=asm["_emscripten_bind_btDynamicsWorld___destroy___0"];var _emscripten_bind_btVector3_setY_1=Module["_emscripten_bind_btVector3_setY_1"]=asm["_emscripten_bind_btVector3_setY_1"];var _emscripten_bind_btAxisSweep3_btAxisSweep3_4=Module["_emscripten_bind_btAxisSweep3_btAxisSweep3_4"]=asm["_emscripten_bind_btAxisSweep3_btAxisSweep3_4"];var _emscripten_bind_btAxisSweep3_btAxisSweep3_5=Module["_emscripten_bind_btAxisSweep3_btAxisSweep3_5"]=asm["_emscripten_bind_btAxisSweep3_btAxisSweep3_5"];var _emscripten_bind_btQuadWord_setX_1=Module["_emscripten_bind_btQuadWord_setX_1"]=asm["_emscripten_bind_btQuadWord_setX_1"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalLinearDampingThresholdSqr_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalLinearDampingThresholdSqr_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalLinearDampingThresholdSqr_0"];var _emscripten_bind_btGhostObject_isActive_0=Module["_emscripten_bind_btGhostObject_isActive_0"]=asm["_emscripten_bind_btGhostObject_isActive_0"];var _emscripten_bind_btOverlappingPairCache___destroy___0=Module["_emscripten_bind_btOverlappingPairCache___destroy___0"]=asm["_emscripten_bind_btOverlappingPairCache___destroy___0"];var _emscripten_bind_btConstraintSetting___destroy___0=Module["_emscripten_bind_btConstraintSetting___destroy___0"]=asm["_emscripten_bind_btConstraintSetting___destroy___0"];var _emscripten_bind_RayResultCallback___destroy___0=Module["_emscripten_bind_RayResultCallback___destroy___0"]=asm["_emscripten_bind_RayResultCallback___destroy___0"];var _emscripten_bind_btPersistentManifold_getBody0_0=Module["_emscripten_bind_btPersistentManifold_getBody0_0"]=asm["_emscripten_bind_btPersistentManifold_getBody0_0"];var _emscripten_bind_btConeShapeX_btConeShapeX_2=Module["_emscripten_bind_btConeShapeX_btConeShapeX_2"]=asm["_emscripten_bind_btConeShapeX_btConeShapeX_2"];var _emscripten_bind_btConeTwistConstraint_enableFeedback_1=Module["_emscripten_bind_btConeTwistConstraint_enableFeedback_1"]=asm["_emscripten_bind_btConeTwistConstraint_enableFeedback_1"];var _emscripten_bind_btCapsuleShapeZ_setLocalScaling_1=Module["_emscripten_bind_btCapsuleShapeZ_setLocalScaling_1"]=asm["_emscripten_bind_btCapsuleShapeZ_setLocalScaling_1"];var _emscripten_bind_ClosestConvexResultCallback_get_m_closestHitFraction_0=Module["_emscripten_bind_ClosestConvexResultCallback_get_m_closestHitFraction_0"]=asm["_emscripten_bind_ClosestConvexResultCallback_get_m_closestHitFraction_0"];var _emscripten_bind_btSliderConstraint_setUpperLinLimit_1=Module["_emscripten_bind_btSliderConstraint_setUpperLinLimit_1"]=asm["_emscripten_bind_btSliderConstraint_setUpperLinLimit_1"];var _emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_2=Module["_emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_2"]=asm["_emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_2"];var _emscripten_bind_btConcaveShape___destroy___0=Module["_emscripten_bind_btConcaveShape___destroy___0"]=asm["_emscripten_bind_btConcaveShape___destroy___0"];var _emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_4=Module["_emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_4"]=asm["_emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_4"];var _emscripten_bind_btQuaternion_x_0=Module["_emscripten_bind_btQuaternion_x_0"]=asm["_emscripten_bind_btQuaternion_x_0"];var _emscripten_bind_LocalConvexResult_set_m_hitNormalLocal_1=Module["_emscripten_bind_LocalConvexResult_set_m_hitNormalLocal_1"]=asm["_emscripten_bind_LocalConvexResult_set_m_hitNormalLocal_1"];var _emscripten_bind_btConcaveShape_setLocalScaling_1=Module["_emscripten_bind_btConcaveShape_setLocalScaling_1"]=asm["_emscripten_bind_btConcaveShape_setLocalScaling_1"];var _emscripten_bind_btDiscreteDynamicsWorld_getDispatchInfo_0=Module["_emscripten_bind_btDiscreteDynamicsWorld_getDispatchInfo_0"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_getDispatchInfo_0"];var _emscripten_bind_btConeShapeX_setLocalScaling_1=Module["_emscripten_bind_btConeShapeX_setLocalScaling_1"]=asm["_emscripten_bind_btConeShapeX_setLocalScaling_1"];var _emscripten_bind_btQuaternion_z_0=Module["_emscripten_bind_btQuaternion_z_0"]=asm["_emscripten_bind_btQuaternion_z_0"];var _emscripten_bind_btConvexHullShape_btConvexHullShape_0=Module["_emscripten_bind_btConvexHullShape_btConvexHullShape_0"]=asm["_emscripten_bind_btConvexHullShape_btConvexHullShape_0"];var _emscripten_bind_btWheelInfo_set_m_maxSuspensionForce_1=Module["_emscripten_bind_btWheelInfo_set_m_maxSuspensionForce_1"]=asm["_emscripten_bind_btWheelInfo_set_m_maxSuspensionForce_1"];var _emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterMask_1=Module["_emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterMask_1"]=asm["_emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterMask_1"];var _emscripten_bind_btGhostObject___destroy___0=Module["_emscripten_bind_btGhostObject___destroy___0"]=asm["_emscripten_bind_btGhostObject___destroy___0"];var _emscripten_bind_btGhostObject_setContactProcessingThreshold_1=Module["_emscripten_bind_btGhostObject_setContactProcessingThreshold_1"]=asm["_emscripten_bind_btGhostObject_setContactProcessingThreshold_1"];var _emscripten_bind_btRigidBody_applyCentralForce_1=Module["_emscripten_bind_btRigidBody_applyCentralForce_1"]=asm["_emscripten_bind_btRigidBody_applyCentralForce_1"];var _emscripten_bind_btStaticPlaneShape_calculateLocalInertia_2=Module["_emscripten_bind_btStaticPlaneShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btStaticPlaneShape_calculateLocalInertia_2"];var _emscripten_bind_btRigidBody_getGravity_0=Module["_emscripten_bind_btRigidBody_getGravity_0"]=asm["_emscripten_bind_btRigidBody_getGravity_0"];var _emscripten_bind_btDefaultMotionState_btDefaultMotionState_2=Module["_emscripten_bind_btDefaultMotionState_btDefaultMotionState_2"]=asm["_emscripten_bind_btDefaultMotionState_btDefaultMotionState_2"];var _emscripten_bind_btDefaultMotionState_btDefaultMotionState_0=Module["_emscripten_bind_btDefaultMotionState_btDefaultMotionState_0"]=asm["_emscripten_bind_btDefaultMotionState_btDefaultMotionState_0"];var _emscripten_bind_btDefaultMotionState_btDefaultMotionState_1=Module["_emscripten_bind_btDefaultMotionState_btDefaultMotionState_1"]=asm["_emscripten_bind_btDefaultMotionState_btDefaultMotionState_1"];var _emscripten_bind_btKinematicCharacterController_canJump_0=Module["_emscripten_bind_btKinematicCharacterController_canJump_0"]=asm["_emscripten_bind_btKinematicCharacterController_canJump_0"];var _emscripten_bind_btRigidBody_isActive_0=Module["_emscripten_bind_btRigidBody_isActive_0"]=asm["_emscripten_bind_btRigidBody_isActive_0"];var _emscripten_bind_btRaycastVehicle_btRaycastVehicle_3=Module["_emscripten_bind_btRaycastVehicle_btRaycastVehicle_3"]=asm["_emscripten_bind_btRaycastVehicle_btRaycastVehicle_3"];var _emscripten_bind_btMotionState_setWorldTransform_1=Module["_emscripten_bind_btMotionState_setWorldTransform_1"]=asm["_emscripten_bind_btMotionState_setWorldTransform_1"];var _emscripten_bind_btCylinderShape_setLocalScaling_1=Module["_emscripten_bind_btCylinderShape_setLocalScaling_1"]=asm["_emscripten_bind_btCylinderShape_setLocalScaling_1"];var _emscripten_bind_btCollisionWorld_rayTest_3=Module["_emscripten_bind_btCollisionWorld_rayTest_3"]=asm["_emscripten_bind_btCollisionWorld_rayTest_3"];var _emscripten_bind_btCompoundShape_calculateLocalInertia_2=Module["_emscripten_bind_btCompoundShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btCompoundShape_calculateLocalInertia_2"];var _emscripten_bind_btCollisionWorld_getDispatchInfo_0=Module["_emscripten_bind_btCollisionWorld_getDispatchInfo_0"]=asm["_emscripten_bind_btCollisionWorld_getDispatchInfo_0"];var _emscripten_bind_btRigidBody_setCollisionShape_1=Module["_emscripten_bind_btRigidBody_setCollisionShape_1"]=asm["_emscripten_bind_btRigidBody_setCollisionShape_1"];var _emscripten_bind_btConeShapeX___destroy___0=Module["_emscripten_bind_btConeShapeX___destroy___0"]=asm["_emscripten_bind_btConeShapeX___destroy___0"];var _emscripten_bind_btCollisionObject_getCollisionFlags_0=Module["_emscripten_bind_btCollisionObject_getCollisionFlags_0"]=asm["_emscripten_bind_btCollisionObject_getCollisionFlags_0"];var _emscripten_bind_btDispatcherInfo_set_m_enableSatConvex_1=Module["_emscripten_bind_btDispatcherInfo_set_m_enableSatConvex_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_enableSatConvex_1"];var _emscripten_bind_btConeTwistConstraint_enableMotor_1=Module["_emscripten_bind_btConeTwistConstraint_enableMotor_1"]=asm["_emscripten_bind_btConeTwistConstraint_enableMotor_1"];var _emscripten_bind_btWheelInfo_set_m_wheelsDampingCompression_1=Module["_emscripten_bind_btWheelInfo_set_m_wheelsDampingCompression_1"]=asm["_emscripten_bind_btWheelInfo_set_m_wheelsDampingCompression_1"];var _emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_0=Module["_emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_0"]=asm["_emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_0"];var _emscripten_bind_btPairCachingGhostObject_setRestitution_1=Module["_emscripten_bind_btPairCachingGhostObject_setRestitution_1"]=asm["_emscripten_bind_btPairCachingGhostObject_setRestitution_1"];var _emscripten_bind_ConvexResultCallback___destroy___0=Module["_emscripten_bind_ConvexResultCallback___destroy___0"]=asm["_emscripten_bind_ConvexResultCallback___destroy___0"];var _emscripten_bind_btSliderConstraint_getBreakingImpulseThreshold_0=Module["_emscripten_bind_btSliderConstraint_getBreakingImpulseThreshold_0"]=asm["_emscripten_bind_btSliderConstraint_getBreakingImpulseThreshold_0"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDampingFactor_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDampingFactor_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDampingFactor_1"];var _emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_3=Module["_emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_3"]=asm["_emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_3"];var _emscripten_bind_btCollisionObject_setContactProcessingThreshold_1=Module["_emscripten_bind_btCollisionObject_setContactProcessingThreshold_1"]=asm["_emscripten_bind_btCollisionObject_setContactProcessingThreshold_1"];var _emscripten_bind_btCompoundShape___destroy___0=Module["_emscripten_bind_btCompoundShape___destroy___0"]=asm["_emscripten_bind_btCompoundShape___destroy___0"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingFactor_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingFactor_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingFactor_0"];var _emscripten_bind_LocalConvexResult___destroy___0=Module["_emscripten_bind_LocalConvexResult___destroy___0"]=asm["_emscripten_bind_LocalConvexResult___destroy___0"];var _emscripten_bind_btSequentialImpulseConstraintSolver___destroy___0=Module["_emscripten_bind_btSequentialImpulseConstraintSolver___destroy___0"]=asm["_emscripten_bind_btSequentialImpulseConstraintSolver___destroy___0"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalLinearDampingThresholdSqr_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalLinearDampingThresholdSqr_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalLinearDampingThresholdSqr_1"];var _emscripten_bind_btRigidBody_getCollisionFlags_0=Module["_emscripten_bind_btRigidBody_getCollisionFlags_0"]=asm["_emscripten_bind_btRigidBody_getCollisionFlags_0"];var _emscripten_bind_btCollisionShape_setLocalScaling_1=Module["_emscripten_bind_btCollisionShape_setLocalScaling_1"]=asm["_emscripten_bind_btCollisionShape_setLocalScaling_1"];var _emscripten_bind_btRigidBody_applyTorque_1=Module["_emscripten_bind_btRigidBody_applyTorque_1"]=asm["_emscripten_bind_btRigidBody_applyTorque_1"];var _emscripten_bind_LocalConvexResult_get_m_hitCollisionObject_0=Module["_emscripten_bind_LocalConvexResult_get_m_hitCollisionObject_0"]=asm["_emscripten_bind_LocalConvexResult_get_m_hitCollisionObject_0"];var _emscripten_bind_btMatrix3x3_setEulerZYX_3=Module["_emscripten_bind_btMatrix3x3_setEulerZYX_3"]=asm["_emscripten_bind_btMatrix3x3_setEulerZYX_3"];var _emscripten_bind_btDispatcherInfo_get_m_convexConservativeDistanceThreshold_0=Module["_emscripten_bind_btDispatcherInfo_get_m_convexConservativeDistanceThreshold_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_convexConservativeDistanceThreshold_0"];var _emscripten_bind_btConvexHullShape_setLocalScaling_1=Module["_emscripten_bind_btConvexHullShape_setLocalScaling_1"]=asm["_emscripten_bind_btConvexHullShape_setLocalScaling_1"];var _emscripten_bind_btDispatcherInfo___destroy___0=Module["_emscripten_bind_btDispatcherInfo___destroy___0"]=asm["_emscripten_bind_btDispatcherInfo___destroy___0"];var _emscripten_bind_RayResultCallback_get_m_collisionFilterMask_0=Module["_emscripten_bind_RayResultCallback_get_m_collisionFilterMask_0"]=asm["_emscripten_bind_RayResultCallback_get_m_collisionFilterMask_0"];var _emscripten_bind_btCollisionWorld_getDispatcher_0=Module["_emscripten_bind_btCollisionWorld_getDispatcher_0"]=asm["_emscripten_bind_btCollisionWorld_getDispatcher_0"];var _emscripten_bind_btCollisionObject_setRollingFriction_1=Module["_emscripten_bind_btCollisionObject_setRollingFriction_1"]=asm["_emscripten_bind_btCollisionObject_setRollingFriction_1"];var _emscripten_bind_RayResultCallback_set_m_collisionFilterGroup_1=Module["_emscripten_bind_RayResultCallback_set_m_collisionFilterGroup_1"]=asm["_emscripten_bind_RayResultCallback_set_m_collisionFilterGroup_1"];var _emscripten_bind_btPairCachingGhostObject_getCollisionShape_0=Module["_emscripten_bind_btPairCachingGhostObject_getCollisionShape_0"]=asm["_emscripten_bind_btPairCachingGhostObject_getCollisionShape_0"];var _i64Subtract=Module["_i64Subtract"]=asm["_i64Subtract"];var _emscripten_bind_btRaycastVehicle_getWheelTransformWS_1=Module["_emscripten_bind_btRaycastVehicle_getWheelTransformWS_1"]=asm["_emscripten_bind_btRaycastVehicle_getWheelTransformWS_1"];var _emscripten_bind_btRigidBody_setDamping_2=Module["_emscripten_bind_btRigidBody_setDamping_2"]=asm["_emscripten_bind_btRigidBody_setDamping_2"];var _emscripten_bind_btDynamicsWorld_getDispatcher_0=Module["_emscripten_bind_btDynamicsWorld_getDispatcher_0"]=asm["_emscripten_bind_btDynamicsWorld_getDispatcher_0"];var _emscripten_bind_btGhostObject_setCollisionFlags_1=Module["_emscripten_bind_btGhostObject_setCollisionFlags_1"]=asm["_emscripten_bind_btGhostObject_setCollisionFlags_1"];var _emscripten_bind_btMatrix3x3_getRotation_1=Module["_emscripten_bind_btMatrix3x3_getRotation_1"]=asm["_emscripten_bind_btMatrix3x3_getRotation_1"];var _emscripten_bind_btConeTwistConstraint_setMaxMotorImpulse_1=Module["_emscripten_bind_btConeTwistConstraint_setMaxMotorImpulse_1"]=asm["_emscripten_bind_btConeTwistConstraint_setMaxMotorImpulse_1"];var _emscripten_bind_btPersistentManifold_getNumContacts_0=Module["_emscripten_bind_btPersistentManifold_getNumContacts_0"]=asm["_emscripten_bind_btPersistentManifold_getNumContacts_0"];var _emscripten_bind_btCylinderShapeX_setLocalScaling_1=Module["_emscripten_bind_btCylinderShapeX_setLocalScaling_1"]=asm["_emscripten_bind_btCylinderShapeX_setLocalScaling_1"];var _emscripten_bind_btDbvtBroadphase_btDbvtBroadphase_0=Module["_emscripten_bind_btDbvtBroadphase_btDbvtBroadphase_0"]=asm["_emscripten_bind_btDbvtBroadphase_btDbvtBroadphase_0"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDamping_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDamping_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDamping_0"];var _emscripten_bind_btCompoundShape_setLocalScaling_1=Module["_emscripten_bind_btCompoundShape_setLocalScaling_1"]=asm["_emscripten_bind_btCompoundShape_setLocalScaling_1"];var _emscripten_bind_btOverlappingPairCallback___destroy___0=Module["_emscripten_bind_btOverlappingPairCallback___destroy___0"]=asm["_emscripten_bind_btOverlappingPairCallback___destroy___0"];var _emscripten_bind_btManifoldPoint_get_m_positionWorldOnB_0=Module["_emscripten_bind_btManifoldPoint_get_m_positionWorldOnB_0"]=asm["_emscripten_bind_btManifoldPoint_get_m_positionWorldOnB_0"];var _emscripten_bind_btVector4_setY_1=Module["_emscripten_bind_btVector4_setY_1"]=asm["_emscripten_bind_btVector4_setY_1"];var _emscripten_bind_btPairCachingGhostObject_setCcdSweptSphereRadius_1=Module["_emscripten_bind_btPairCachingGhostObject_setCcdSweptSphereRadius_1"]=asm["_emscripten_bind_btPairCachingGhostObject_setCcdSweptSphereRadius_1"];var _emscripten_bind_btRigidBody_getCollisionShape_0=Module["_emscripten_bind_btRigidBody_getCollisionShape_0"]=asm["_emscripten_bind_btRigidBody_getCollisionShape_0"];var _emscripten_bind_btRigidBody_setContactProcessingThreshold_1=Module["_emscripten_bind_btRigidBody_setContactProcessingThreshold_1"]=asm["_emscripten_bind_btRigidBody_setContactProcessingThreshold_1"];var _emscripten_bind_btRigidBody_getLinearVelocity_0=Module["_emscripten_bind_btRigidBody_getLinearVelocity_0"]=asm["_emscripten_bind_btRigidBody_getLinearVelocity_0"];var _emscripten_bind_btRigidBody_applyImpulse_2=Module["_emscripten_bind_btRigidBody_applyImpulse_2"]=asm["_emscripten_bind_btRigidBody_applyImpulse_2"];var _emscripten_bind_btConcaveShape_calculateLocalInertia_2=Module["_emscripten_bind_btConcaveShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btConcaveShape_calculateLocalInertia_2"];var _emscripten_bind_btRigidBody_setWorldTransform_1=Module["_emscripten_bind_btRigidBody_setWorldTransform_1"]=asm["_emscripten_bind_btRigidBody_setWorldTransform_1"];var _emscripten_bind_btRigidBody_setAngularVelocity_1=Module["_emscripten_bind_btRigidBody_setAngularVelocity_1"]=asm["_emscripten_bind_btRigidBody_setAngularVelocity_1"];var _emscripten_bind_btCapsuleShape___destroy___0=Module["_emscripten_bind_btCapsuleShape___destroy___0"]=asm["_emscripten_bind_btCapsuleShape___destroy___0"];var _emscripten_bind_btConvexShape_setLocalScaling_1=Module["_emscripten_bind_btConvexShape_setLocalScaling_1"]=asm["_emscripten_bind_btConvexShape_setLocalScaling_1"];var _emscripten_bind_btTriangleMeshShape_calculateLocalInertia_2=Module["_emscripten_bind_btTriangleMeshShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btTriangleMeshShape_calculateLocalInertia_2"];var _emscripten_bind_btPairCachingGhostObject_setContactProcessingThreshold_1=Module["_emscripten_bind_btPairCachingGhostObject_setContactProcessingThreshold_1"]=asm["_emscripten_bind_btPairCachingGhostObject_setContactProcessingThreshold_1"];var _emscripten_bind_btGeneric6DofConstraint_setLinearUpperLimit_1=Module["_emscripten_bind_btGeneric6DofConstraint_setLinearUpperLimit_1"]=asm["_emscripten_bind_btGeneric6DofConstraint_setLinearUpperLimit_1"];var _emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterMask_0=Module["_emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterMask_0"]=asm["_emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterMask_0"];var _emscripten_bind_RayResultCallback_hasHit_0=Module["_emscripten_bind_RayResultCallback_hasHit_0"]=asm["_emscripten_bind_RayResultCallback_hasHit_0"];var _emscripten_bind_btVehicleTuning_set_m_maxSuspensionForce_1=Module["_emscripten_bind_btVehicleTuning_set_m_maxSuspensionForce_1"]=asm["_emscripten_bind_btVehicleTuning_set_m_maxSuspensionForce_1"];var _emscripten_bind_ClosestConvexResultCallback_get_m_convexToWorld_0=Module["_emscripten_bind_ClosestConvexResultCallback_get_m_convexToWorld_0"]=asm["_emscripten_bind_ClosestConvexResultCallback_get_m_convexToWorld_0"];var _emscripten_bind_btWheelInfo_get_m_frictionSlip_0=Module["_emscripten_bind_btWheelInfo_get_m_frictionSlip_0"]=asm["_emscripten_bind_btWheelInfo_get_m_frictionSlip_0"];var _emscripten_bind_btConeShapeZ_setLocalScaling_1=Module["_emscripten_bind_btConeShapeZ_setLocalScaling_1"]=asm["_emscripten_bind_btConeShapeZ_setLocalScaling_1"];var _emscripten_bind_btPairCachingGhostObject_setActivationState_1=Module["_emscripten_bind_btPairCachingGhostObject_setActivationState_1"]=asm["_emscripten_bind_btPairCachingGhostObject_setActivationState_1"];var _emscripten_bind_btGeneric6DofSpringConstraint___destroy___0=Module["_emscripten_bind_btGeneric6DofSpringConstraint___destroy___0"]=asm["_emscripten_bind_btGeneric6DofSpringConstraint___destroy___0"];var _emscripten_bind_btConvexTriangleMeshShape___destroy___0=Module["_emscripten_bind_btConvexTriangleMeshShape___destroy___0"]=asm["_emscripten_bind_btConvexTriangleMeshShape___destroy___0"];var _emscripten_bind_btVehicleTuning_set_m_maxSuspensionTravelCm_1=Module["_emscripten_bind_btVehicleTuning_set_m_maxSuspensionTravelCm_1"]=asm["_emscripten_bind_btVehicleTuning_set_m_maxSuspensionTravelCm_1"];var _emscripten_bind_btGhostObject_setRollingFriction_1=Module["_emscripten_bind_btGhostObject_setRollingFriction_1"]=asm["_emscripten_bind_btGhostObject_setRollingFriction_1"];var _emscripten_bind_btCylinderShapeZ_btCylinderShapeZ_1=Module["_emscripten_bind_btCylinderShapeZ_btCylinderShapeZ_1"]=asm["_emscripten_bind_btCylinderShapeZ_btCylinderShapeZ_1"];var _emscripten_bind_btPoint2PointConstraint_set_m_setting_1=Module["_emscripten_bind_btPoint2PointConstraint_set_m_setting_1"]=asm["_emscripten_bind_btPoint2PointConstraint_set_m_setting_1"];var _emscripten_bind_btCompoundShape_btCompoundShape_0=Module["_emscripten_bind_btCompoundShape_btCompoundShape_0"]=asm["_emscripten_bind_btCompoundShape_btCompoundShape_0"];var _emscripten_bind_btCompoundShape_btCompoundShape_1=Module["_emscripten_bind_btCompoundShape_btCompoundShape_1"]=asm["_emscripten_bind_btCompoundShape_btCompoundShape_1"];var _emscripten_bind_btOverlappingPairCache_setInternalGhostPairCallback_1=Module["_emscripten_bind_btOverlappingPairCache_setInternalGhostPairCallback_1"]=asm["_emscripten_bind_btOverlappingPairCache_setInternalGhostPairCallback_1"];var _emscripten_bind_btStaticPlaneShape_btStaticPlaneShape_2=Module["_emscripten_bind_btStaticPlaneShape_btStaticPlaneShape_2"]=asm["_emscripten_bind_btStaticPlaneShape_btStaticPlaneShape_2"];var __GLOBAL__sub_I_btQuickprof_cpp=Module["__GLOBAL__sub_I_btQuickprof_cpp"]=asm["__GLOBAL__sub_I_btQuickprof_cpp"];var _emscripten_bind_RayResultCallback_get_m_collisionFilterGroup_0=Module["_emscripten_bind_RayResultCallback_get_m_collisionFilterGroup_0"]=asm["_emscripten_bind_RayResultCallback_get_m_collisionFilterGroup_0"];var _emscripten_bind_btRigidBody_updateInertiaTensor_0=Module["_emscripten_bind_btRigidBody_updateInertiaTensor_0"]=asm["_emscripten_bind_btRigidBody_updateInertiaTensor_0"];var _emscripten_bind_btPairCachingGhostObject_setAnisotropicFriction_2=Module["_emscripten_bind_btPairCachingGhostObject_setAnisotropicFriction_2"]=asm["_emscripten_bind_btPairCachingGhostObject_setAnisotropicFriction_2"];var _emscripten_bind_btTransform_setOrigin_1=Module["_emscripten_bind_btTransform_setOrigin_1"]=asm["_emscripten_bind_btTransform_setOrigin_1"];var _emscripten_bind_ClosestRayResultCallback_hasHit_0=Module["_emscripten_bind_ClosestRayResultCallback_hasHit_0"]=asm["_emscripten_bind_ClosestRayResultCallback_hasHit_0"];var _emscripten_bind_btCompoundShape_addChildShape_2=Module["_emscripten_bind_btCompoundShape_addChildShape_2"]=asm["_emscripten_bind_btCompoundShape_addChildShape_2"];var _emscripten_bind_btDispatcher___destroy___0=Module["_emscripten_bind_btDispatcher___destroy___0"]=asm["_emscripten_bind_btDispatcher___destroy___0"];var _emscripten_bind_btVehicleTuning_get_m_suspensionCompression_0=Module["_emscripten_bind_btVehicleTuning_get_m_suspensionCompression_0"]=asm["_emscripten_bind_btVehicleTuning_get_m_suspensionCompression_0"];var _emscripten_bind_btDiscreteDynamicsWorld___destroy___0=Module["_emscripten_bind_btDiscreteDynamicsWorld___destroy___0"]=asm["_emscripten_bind_btDiscreteDynamicsWorld___destroy___0"];var _emscripten_bind_btConvexShape___destroy___0=Module["_emscripten_bind_btConvexShape___destroy___0"]=asm["_emscripten_bind_btConvexShape___destroy___0"];var _memmove=Module["_memmove"]=asm["_memmove"];var _emscripten_bind_btCapsuleShapeX_setLocalScaling_1=Module["_emscripten_bind_btCapsuleShapeX_setLocalScaling_1"]=asm["_emscripten_bind_btCapsuleShapeX_setLocalScaling_1"];var _emscripten_bind_btCollisionObject_setRestitution_1=Module["_emscripten_bind_btCollisionObject_setRestitution_1"]=asm["_emscripten_bind_btCollisionObject_setRestitution_1"];var _emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_3=Module["_emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_3"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_3"];var _emscripten_bind_LocalConvexResult_get_m_hitFraction_0=Module["_emscripten_bind_LocalConvexResult_get_m_hitFraction_0"]=asm["_emscripten_bind_LocalConvexResult_get_m_hitFraction_0"];var _emscripten_bind_btDispatcherInfo_get_m_enableSPU_0=Module["_emscripten_bind_btDispatcherInfo_get_m_enableSPU_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_enableSPU_0"];var _emscripten_bind_btQuaternion_w_0=Module["_emscripten_bind_btQuaternion_w_0"]=asm["_emscripten_bind_btQuaternion_w_0"];var _emscripten_bind_ConvexResultCallback_get_m_collisionFilterGroup_0=Module["_emscripten_bind_ConvexResultCallback_get_m_collisionFilterGroup_0"]=asm["_emscripten_bind_ConvexResultCallback_get_m_collisionFilterGroup_0"];var _emscripten_bind_btTransform_getRotation_0=Module["_emscripten_bind_btTransform_getRotation_0"]=asm["_emscripten_bind_btTransform_getRotation_0"];var _emscripten_bind_btHingeConstraint_btHingeConstraint_6=Module["_emscripten_bind_btHingeConstraint_btHingeConstraint_6"]=asm["_emscripten_bind_btHingeConstraint_btHingeConstraint_6"];var _emscripten_bind_btHingeConstraint_btHingeConstraint_7=Module["_emscripten_bind_btHingeConstraint_btHingeConstraint_7"]=asm["_emscripten_bind_btHingeConstraint_btHingeConstraint_7"];var _emscripten_bind_btHingeConstraint_btHingeConstraint_4=Module["_emscripten_bind_btHingeConstraint_btHingeConstraint_4"]=asm["_emscripten_bind_btHingeConstraint_btHingeConstraint_4"];var _emscripten_bind_btHingeConstraint_btHingeConstraint_5=Module["_emscripten_bind_btHingeConstraint_btHingeConstraint_5"]=asm["_emscripten_bind_btHingeConstraint_btHingeConstraint_5"];var _emscripten_bind_btHingeConstraint_btHingeConstraint_2=Module["_emscripten_bind_btHingeConstraint_btHingeConstraint_2"]=asm["_emscripten_bind_btHingeConstraint_btHingeConstraint_2"];var _emscripten_bind_btHingeConstraint_btHingeConstraint_3=Module["_emscripten_bind_btHingeConstraint_btHingeConstraint_3"]=asm["_emscripten_bind_btHingeConstraint_btHingeConstraint_3"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingThresholdSqr_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingThresholdSqr_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingThresholdSqr_1"];var _emscripten_bind_ClosestConvexResultCallback_get_m_hitNormalWorld_0=Module["_emscripten_bind_ClosestConvexResultCallback_get_m_hitNormalWorld_0"]=asm["_emscripten_bind_ClosestConvexResultCallback_get_m_hitNormalWorld_0"];var _emscripten_bind_btTypedConstraint___destroy___0=Module["_emscripten_bind_btTypedConstraint___destroy___0"]=asm["_emscripten_bind_btTypedConstraint___destroy___0"];var _emscripten_bind_btDiscreteDynamicsWorld_computeOverlappingPairs_0=Module["_emscripten_bind_btDiscreteDynamicsWorld_computeOverlappingPairs_0"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_computeOverlappingPairs_0"];var _emscripten_bind_btCylinderShapeX_btCylinderShapeX_1=Module["_emscripten_bind_btCylinderShapeX_btCylinderShapeX_1"]=asm["_emscripten_bind_btCylinderShapeX_btCylinderShapeX_1"];var _emscripten_bind_btGeneric6DofSpringConstraint_setAngularUpperLimit_1=Module["_emscripten_bind_btGeneric6DofSpringConstraint_setAngularUpperLimit_1"]=asm["_emscripten_bind_btGeneric6DofSpringConstraint_setAngularUpperLimit_1"];var _emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_3=Module["_emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_3"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_3"];var _emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_1=Module["_emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_1"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_1"];var _emscripten_bind_btHingeConstraint_enableFeedback_1=Module["_emscripten_bind_btHingeConstraint_enableFeedback_1"]=asm["_emscripten_bind_btHingeConstraint_enableFeedback_1"];var _emscripten_bind_btSphereShape_btSphereShape_1=Module["_emscripten_bind_btSphereShape_btSphereShape_1"]=asm["_emscripten_bind_btSphereShape_btSphereShape_1"];var _emscripten_bind_btWheelInfo_get_m_wheelsSuspensionForce_0=Module["_emscripten_bind_btWheelInfo_get_m_wheelsSuspensionForce_0"]=asm["_emscripten_bind_btWheelInfo_get_m_wheelsSuspensionForce_0"];var _emscripten_bind_btQuaternion_y_0=Module["_emscripten_bind_btQuaternion_y_0"]=asm["_emscripten_bind_btQuaternion_y_0"];var _emscripten_bind_btCollisionWorld_addCollisionObject_1=Module["_emscripten_bind_btCollisionWorld_addCollisionObject_1"]=asm["_emscripten_bind_btCollisionWorld_addCollisionObject_1"];var _emscripten_bind_btCollisionWorld_addCollisionObject_2=Module["_emscripten_bind_btCollisionWorld_addCollisionObject_2"]=asm["_emscripten_bind_btCollisionWorld_addCollisionObject_2"];var _emscripten_bind_btCollisionWorld_addCollisionObject_3=Module["_emscripten_bind_btCollisionWorld_addCollisionObject_3"]=asm["_emscripten_bind_btCollisionWorld_addCollisionObject_3"];var _emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterGroup_1=Module["_emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterGroup_1"]=asm["_emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterGroup_1"];var _emscripten_bind_btConeTwistConstraint_setBreakingImpulseThreshold_1=Module["_emscripten_bind_btConeTwistConstraint_setBreakingImpulseThreshold_1"]=asm["_emscripten_bind_btConeTwistConstraint_setBreakingImpulseThreshold_1"];var _emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_3=Module["_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_3"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_3"];var _emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterGroup_0=Module["_emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterGroup_0"]=asm["_emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterGroup_0"];var _emscripten_bind_btDefaultVehicleRaycaster_btDefaultVehicleRaycaster_1=Module["_emscripten_bind_btDefaultVehicleRaycaster_btDefaultVehicleRaycaster_1"]=asm["_emscripten_bind_btDefaultVehicleRaycaster_btDefaultVehicleRaycaster_1"];var _emscripten_bind_btPoint2PointConstraint_get_m_setting_0=Module["_emscripten_bind_btPoint2PointConstraint_get_m_setting_0"]=asm["_emscripten_bind_btPoint2PointConstraint_get_m_setting_0"];var _emscripten_bind_btSequentialImpulseConstraintSolver_btSequentialImpulseConstraintSolver_0=Module["_emscripten_bind_btSequentialImpulseConstraintSolver_btSequentialImpulseConstraintSolver_0"]=asm["_emscripten_bind_btSequentialImpulseConstraintSolver_btSequentialImpulseConstraintSolver_0"];var _emscripten_bind_btActionInterface___destroy___0=Module["_emscripten_bind_btActionInterface___destroy___0"]=asm["_emscripten_bind_btActionInterface___destroy___0"];var _emscripten_bind_btDefaultMotionState_setWorldTransform_1=Module["_emscripten_bind_btDefaultMotionState_setWorldTransform_1"]=asm["_emscripten_bind_btDefaultMotionState_setWorldTransform_1"];var _emscripten_bind_btGeneric6DofSpringConstraint_setDamping_2=Module["_emscripten_bind_btGeneric6DofSpringConstraint_setDamping_2"]=asm["_emscripten_bind_btGeneric6DofSpringConstraint_setDamping_2"];var _emscripten_bind_RayResultCallback_get_m_collisionObject_0=Module["_emscripten_bind_RayResultCallback_get_m_collisionObject_0"]=asm["_emscripten_bind_RayResultCallback_get_m_collisionObject_0"];var _emscripten_bind_btPoint2PointConstraint_getPivotInA_0=Module["_emscripten_bind_btPoint2PointConstraint_getPivotInA_0"]=asm["_emscripten_bind_btPoint2PointConstraint_getPivotInA_0"];var _emscripten_bind_ClosestConvexResultCallback_get_m_convexFromWorld_0=Module["_emscripten_bind_ClosestConvexResultCallback_get_m_convexFromWorld_0"]=asm["_emscripten_bind_ClosestConvexResultCallback_get_m_convexFromWorld_0"];var _emscripten_bind_btCylinderShape_calculateLocalInertia_2=Module["_emscripten_bind_btCylinderShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btCylinderShape_calculateLocalInertia_2"];var _emscripten_bind_ClosestConvexResultCallback___destroy___0=Module["_emscripten_bind_ClosestConvexResultCallback___destroy___0"]=asm["_emscripten_bind_ClosestConvexResultCallback___destroy___0"];var _emscripten_bind_btDynamicsWorld_addCollisionObject_1=Module["_emscripten_bind_btDynamicsWorld_addCollisionObject_1"]=asm["_emscripten_bind_btDynamicsWorld_addCollisionObject_1"];var _emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterMask_0=Module["_emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterMask_0"]=asm["_emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterMask_0"];var ___cxa_can_catch=Module["___cxa_can_catch"]=asm["___cxa_can_catch"];var _emscripten_bind_btDynamicsWorld_addCollisionObject_2=Module["_emscripten_bind_btDynamicsWorld_addCollisionObject_2"]=asm["_emscripten_bind_btDynamicsWorld_addCollisionObject_2"];var _emscripten_bind_btDiscreteDynamicsWorld_getDispatcher_0=Module["_emscripten_bind_btDiscreteDynamicsWorld_getDispatcher_0"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_getDispatcher_0"];var _emscripten_bind_btKinematicCharacterController_setUseGhostSweepTest_1=Module["_emscripten_bind_btKinematicCharacterController_setUseGhostSweepTest_1"]=asm["_emscripten_bind_btKinematicCharacterController_setUseGhostSweepTest_1"];var _emscripten_bind_btVector4_op_mul_1=Module["_emscripten_bind_btVector4_op_mul_1"]=asm["_emscripten_bind_btVector4_op_mul_1"];var _emscripten_bind_btCylinderShape_btCylinderShape_1=Module["_emscripten_bind_btCylinderShape_btCylinderShape_1"]=asm["_emscripten_bind_btCylinderShape_btCylinderShape_1"];var _emscripten_bind_btDynamicsWorld_computeOverlappingPairs_0=Module["_emscripten_bind_btDynamicsWorld_computeOverlappingPairs_0"]=asm["_emscripten_bind_btDynamicsWorld_computeOverlappingPairs_0"];var _emscripten_bind_btVector3___destroy___0=Module["_emscripten_bind_btVector3___destroy___0"]=asm["_emscripten_bind_btVector3___destroy___0"];var _emscripten_bind_btRigidBody_setAngularFactor_1=Module["_emscripten_bind_btRigidBody_setAngularFactor_1"]=asm["_emscripten_bind_btRigidBody_setAngularFactor_1"];var _emscripten_bind_btCylinderShapeZ_calculateLocalInertia_2=Module["_emscripten_bind_btCylinderShapeZ_calculateLocalInertia_2"]=asm["_emscripten_bind_btCylinderShapeZ_calculateLocalInertia_2"];var _emscripten_bind_LocalShapeInfo_set_m_triangleIndex_1=Module["_emscripten_bind_LocalShapeInfo_set_m_triangleIndex_1"]=asm["_emscripten_bind_LocalShapeInfo_set_m_triangleIndex_1"];var _emscripten_bind_btMotionState_getWorldTransform_1=Module["_emscripten_bind_btMotionState_getWorldTransform_1"]=asm["_emscripten_bind_btMotionState_getWorldTransform_1"];var _emscripten_bind_btDynamicsWorld_getSolverInfo_0=Module["_emscripten_bind_btDynamicsWorld_getSolverInfo_0"]=asm["_emscripten_bind_btDynamicsWorld_getSolverInfo_0"];var _emscripten_bind_btDynamicsWorld_getBroadphase_0=Module["_emscripten_bind_btDynamicsWorld_getBroadphase_0"]=asm["_emscripten_bind_btDynamicsWorld_getBroadphase_0"];var _emscripten_bind_btDispatcherInfo_set_m_convexConservativeDistanceThreshold_1=Module["_emscripten_bind_btDispatcherInfo_set_m_convexConservativeDistanceThreshold_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_convexConservativeDistanceThreshold_1"];var _emscripten_bind_btVector3_x_0=Module["_emscripten_bind_btVector3_x_0"]=asm["_emscripten_bind_btVector3_x_0"];var ___cxa_is_pointer_type=Module["___cxa_is_pointer_type"]=asm["___cxa_is_pointer_type"];var _emscripten_bind_btWheelInfo_get_m_wheelsDampingCompression_0=Module["_emscripten_bind_btWheelInfo_get_m_wheelsDampingCompression_0"]=asm["_emscripten_bind_btWheelInfo_get_m_wheelsDampingCompression_0"];var _emscripten_bind_btCollisionObject_getCollisionShape_0=Module["_emscripten_bind_btCollisionObject_getCollisionShape_0"]=asm["_emscripten_bind_btCollisionObject_getCollisionShape_0"];var _emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_4=Module["_emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_4"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_4"];var _emscripten_bind_btManifoldPoint___destroy___0=Module["_emscripten_bind_btManifoldPoint___destroy___0"]=asm["_emscripten_bind_btManifoldPoint___destroy___0"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_rollingFriction_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_rollingFriction_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_rollingFriction_1"];var _emscripten_bind_btVector4_length_0=Module["_emscripten_bind_btVector4_length_0"]=asm["_emscripten_bind_btVector4_length_0"];var _emscripten_bind_btDefaultMotionState_set_m_graphicsWorldTrans_1=Module["_emscripten_bind_btDefaultMotionState_set_m_graphicsWorldTrans_1"]=asm["_emscripten_bind_btDefaultMotionState_set_m_graphicsWorldTrans_1"];var _emscripten_bind_btCylinderShapeZ_setLocalScaling_1=Module["_emscripten_bind_btCylinderShapeZ_setLocalScaling_1"]=asm["_emscripten_bind_btCylinderShapeZ_setLocalScaling_1"];var _emscripten_bind_btGhostObject_setRestitution_1=Module["_emscripten_bind_btGhostObject_setRestitution_1"]=asm["_emscripten_bind_btGhostObject_setRestitution_1"];var _emscripten_bind_btConeTwistConstraint_setAngularOnly_1=Module["_emscripten_bind_btConeTwistConstraint_setAngularOnly_1"]=asm["_emscripten_bind_btConeTwistConstraint_setAngularOnly_1"];var _emscripten_bind_btCollisionObject_setFriction_1=Module["_emscripten_bind_btCollisionObject_setFriction_1"]=asm["_emscripten_bind_btCollisionObject_setFriction_1"];var _emscripten_bind_btDefaultCollisionConfiguration___destroy___0=Module["_emscripten_bind_btDefaultCollisionConfiguration___destroy___0"]=asm["_emscripten_bind_btDefaultCollisionConfiguration___destroy___0"];var _emscripten_bind_btRigidBody_setMassProps_2=Module["_emscripten_bind_btRigidBody_setMassProps_2"]=asm["_emscripten_bind_btRigidBody_setMassProps_2"];var _emscripten_bind_btVector3_setValue_3=Module["_emscripten_bind_btVector3_setValue_3"]=asm["_emscripten_bind_btVector3_setValue_3"];var _emscripten_bind_btPairCachingGhostObject_setCcdMotionThreshold_1=Module["_emscripten_bind_btPairCachingGhostObject_setCcdMotionThreshold_1"]=asm["_emscripten_bind_btPairCachingGhostObject_setCcdMotionThreshold_1"];var _emscripten_bind_btGhostObject_getCollisionFlags_0=Module["_emscripten_bind_btGhostObject_getCollisionFlags_0"]=asm["_emscripten_bind_btGhostObject_getCollisionFlags_0"];var _emscripten_bind_btCapsuleShapeX___destroy___0=Module["_emscripten_bind_btCapsuleShapeX___destroy___0"]=asm["_emscripten_bind_btCapsuleShapeX___destroy___0"];var _emscripten_bind_btHingeConstraint_setLimit_4=Module["_emscripten_bind_btHingeConstraint_setLimit_4"]=asm["_emscripten_bind_btHingeConstraint_setLimit_4"];var _emscripten_bind_btHingeConstraint_setLimit_5=Module["_emscripten_bind_btHingeConstraint_setLimit_5"]=asm["_emscripten_bind_btHingeConstraint_setLimit_5"];var _emscripten_bind_btWheelInfo_get_m_wheelsDampingRelaxation_0=Module["_emscripten_bind_btWheelInfo_get_m_wheelsDampingRelaxation_0"]=asm["_emscripten_bind_btWheelInfo_get_m_wheelsDampingRelaxation_0"];var _emscripten_bind_btWheelInfo_set_m_maxSuspensionTravelCm_1=Module["_emscripten_bind_btWheelInfo_set_m_maxSuspensionTravelCm_1"]=asm["_emscripten_bind_btWheelInfo_set_m_maxSuspensionTravelCm_1"];var _emscripten_bind_btWheelInfo_set_m_wheelsSuspensionForce_1=Module["_emscripten_bind_btWheelInfo_set_m_wheelsSuspensionForce_1"]=asm["_emscripten_bind_btWheelInfo_set_m_wheelsSuspensionForce_1"];var _emscripten_bind_btHingeConstraint_setBreakingImpulseThreshold_1=Module["_emscripten_bind_btHingeConstraint_setBreakingImpulseThreshold_1"]=asm["_emscripten_bind_btHingeConstraint_setBreakingImpulseThreshold_1"];var _emscripten_bind_btGhostObject_getNumOverlappingObjects_0=Module["_emscripten_bind_btGhostObject_getNumOverlappingObjects_0"]=asm["_emscripten_bind_btGhostObject_getNumOverlappingObjects_0"];var _emscripten_bind_btTypedConstraint_getBreakingImpulseThreshold_0=Module["_emscripten_bind_btTypedConstraint_getBreakingImpulseThreshold_0"]=asm["_emscripten_bind_btTypedConstraint_getBreakingImpulseThreshold_0"];var _emscripten_bind_btGhostObject_getCollisionShape_0=Module["_emscripten_bind_btGhostObject_getCollisionShape_0"]=asm["_emscripten_bind_btGhostObject_getCollisionShape_0"];var _emscripten_bind_btCollisionObject_setAnisotropicFriction_2=Module["_emscripten_bind_btCollisionObject_setAnisotropicFriction_2"]=asm["_emscripten_bind_btCollisionObject_setAnisotropicFriction_2"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_friction_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_friction_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_friction_1"];var _emscripten_bind_btPersistentManifold_getContactPoint_1=Module["_emscripten_bind_btPersistentManifold_getContactPoint_1"]=asm["_emscripten_bind_btPersistentManifold_getContactPoint_1"];var _emscripten_bind_btGeneric6DofSpringConstraint_getBreakingImpulseThreshold_0=Module["_emscripten_bind_btGeneric6DofSpringConstraint_getBreakingImpulseThreshold_0"]=asm["_emscripten_bind_btGeneric6DofSpringConstraint_getBreakingImpulseThreshold_0"];var _emscripten_bind_ConvexResultCallback_set_m_collisionFilterGroup_1=Module["_emscripten_bind_ConvexResultCallback_set_m_collisionFilterGroup_1"]=asm["_emscripten_bind_ConvexResultCallback_set_m_collisionFilterGroup_1"];var _emscripten_bind_btGhostObject_activate_0=Module["_emscripten_bind_btGhostObject_activate_0"]=asm["_emscripten_bind_btGhostObject_activate_0"];var _emscripten_bind_btGhostObject_activate_1=Module["_emscripten_bind_btGhostObject_activate_1"]=asm["_emscripten_bind_btGhostObject_activate_1"];var _emscripten_bind_btGeneric6DofSpringConstraint_enableSpring_2=Module["_emscripten_bind_btGeneric6DofSpringConstraint_enableSpring_2"]=asm["_emscripten_bind_btGeneric6DofSpringConstraint_enableSpring_2"];var _emscripten_bind_btManifoldPoint_getPositionWorldOnB_0=Module["_emscripten_bind_btManifoldPoint_getPositionWorldOnB_0"]=asm["_emscripten_bind_btManifoldPoint_getPositionWorldOnB_0"];var _emscripten_bind_btManifoldPoint_get_m_positionWorldOnA_0=Module["_emscripten_bind_btManifoldPoint_get_m_positionWorldOnA_0"]=asm["_emscripten_bind_btManifoldPoint_get_m_positionWorldOnA_0"];var _emscripten_bind_btGeneric6DofSpringConstraint_enableFeedback_1=Module["_emscripten_bind_btGeneric6DofSpringConstraint_enableFeedback_1"]=asm["_emscripten_bind_btGeneric6DofSpringConstraint_enableFeedback_1"];var _emscripten_bind_btConeShapeZ_btConeShapeZ_2=Module["_emscripten_bind_btConeShapeZ_btConeShapeZ_2"]=asm["_emscripten_bind_btConeShapeZ_btConeShapeZ_2"];var _emscripten_bind_btContactSolverInfo_set_m_splitImpulsePenetrationThreshold_1=Module["_emscripten_bind_btContactSolverInfo_set_m_splitImpulsePenetrationThreshold_1"]=asm["_emscripten_bind_btContactSolverInfo_set_m_splitImpulsePenetrationThreshold_1"];var _emscripten_bind_btSliderConstraint_setUpperAngLimit_1=Module["_emscripten_bind_btSliderConstraint_setUpperAngLimit_1"]=asm["_emscripten_bind_btSliderConstraint_setUpperAngLimit_1"];var _emscripten_bind_btDynamicsWorld_contactPairTest_3=Module["_emscripten_bind_btDynamicsWorld_contactPairTest_3"]=asm["_emscripten_bind_btDynamicsWorld_contactPairTest_3"];var _emscripten_bind_btCollisionWorld_getPairCache_0=Module["_emscripten_bind_btCollisionWorld_getPairCache_0"]=asm["_emscripten_bind_btCollisionWorld_getPairCache_0"];var _emscripten_bind_btConeTwistConstraint_setMotorTarget_1=Module["_emscripten_bind_btConeTwistConstraint_setMotorTarget_1"]=asm["_emscripten_bind_btConeTwistConstraint_setMotorTarget_1"];var _emscripten_bind_ClosestConvexResultCallback_set_m_convexFromWorld_1=Module["_emscripten_bind_ClosestConvexResultCallback_set_m_convexFromWorld_1"]=asm["_emscripten_bind_ClosestConvexResultCallback_set_m_convexFromWorld_1"];var _emscripten_bind_btWheelInfo_set_m_rollInfluence_1=Module["_emscripten_bind_btWheelInfo_set_m_rollInfluence_1"]=asm["_emscripten_bind_btWheelInfo_set_m_rollInfluence_1"];var _emscripten_bind_btRigidBody_getWorldTransform_0=Module["_emscripten_bind_btRigidBody_getWorldTransform_0"]=asm["_emscripten_bind_btRigidBody_getWorldTransform_0"];var _emscripten_bind_btDefaultCollisionConstructionInfo_btDefaultCollisionConstructionInfo_0=Module["_emscripten_bind_btDefaultCollisionConstructionInfo_btDefaultCollisionConstructionInfo_0"]=asm["_emscripten_bind_btDefaultCollisionConstructionInfo_btDefaultCollisionConstructionInfo_0"];var _emscripten_bind_btGhostObject_forceActivationState_1=Module["_emscripten_bind_btGhostObject_forceActivationState_1"]=asm["_emscripten_bind_btGhostObject_forceActivationState_1"];var _emscripten_bind_ConcreteContactResultCallback_ConcreteContactResultCallback_0=Module["_emscripten_bind_ConcreteContactResultCallback_ConcreteContactResultCallback_0"]=asm["_emscripten_bind_ConcreteContactResultCallback_ConcreteContactResultCallback_0"];var _emscripten_bind_VoidPtr___destroy___0=Module["_emscripten_bind_VoidPtr___destroy___0"]=asm["_emscripten_bind_VoidPtr___destroy___0"];var _emscripten_bind_btSliderConstraint_setLowerAngLimit_1=Module["_emscripten_bind_btSliderConstraint_setLowerAngLimit_1"]=asm["_emscripten_bind_btSliderConstraint_setLowerAngLimit_1"];var _emscripten_bind_btConeShape_btConeShape_2=Module["_emscripten_bind_btConeShape_btConeShape_2"]=asm["_emscripten_bind_btConeShape_btConeShape_2"];var _emscripten_bind_ClosestRayResultCallback_get_m_rayFromWorld_0=Module["_emscripten_bind_ClosestRayResultCallback_get_m_rayFromWorld_0"]=asm["_emscripten_bind_ClosestRayResultCallback_get_m_rayFromWorld_0"];var _emscripten_bind_btRaycastVehicle_getRigidBody_0=Module["_emscripten_bind_btRaycastVehicle_getRigidBody_0"]=asm["_emscripten_bind_btRaycastVehicle_getRigidBody_0"];var _emscripten_bind_btWheelInfo_get_m_steering_0=Module["_emscripten_bind_btWheelInfo_get_m_steering_0"]=asm["_emscripten_bind_btWheelInfo_get_m_steering_0"];var _emscripten_bind_btConstraintSetting_get_m_tau_0=Module["_emscripten_bind_btConstraintSetting_get_m_tau_0"]=asm["_emscripten_bind_btConstraintSetting_get_m_tau_0"];var _emscripten_bind_btConeShape_setLocalScaling_1=Module["_emscripten_bind_btConeShape_setLocalScaling_1"]=asm["_emscripten_bind_btConeShape_setLocalScaling_1"];var _emscripten_bind_btCollisionShape___destroy___0=Module["_emscripten_bind_btCollisionShape___destroy___0"]=asm["_emscripten_bind_btCollisionShape___destroy___0"];var _emscripten_bind_ConvexResultCallback_get_m_closestHitFraction_0=Module["_emscripten_bind_ConvexResultCallback_get_m_closestHitFraction_0"]=asm["_emscripten_bind_ConvexResultCallback_get_m_closestHitFraction_0"];var _emscripten_bind_btDispatcherInfo_get_m_dispatchFunc_0=Module["_emscripten_bind_btDispatcherInfo_get_m_dispatchFunc_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_dispatchFunc_0"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_rollingFriction_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_rollingFriction_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_rollingFriction_0"];var _emscripten_bind_btPairCachingGhostObject_setCollisionShape_1=Module["_emscripten_bind_btPairCachingGhostObject_setCollisionShape_1"]=asm["_emscripten_bind_btPairCachingGhostObject_setCollisionShape_1"];var _emscripten_bind_btKinematicCharacterController_warp_1=Module["_emscripten_bind_btKinematicCharacterController_warp_1"]=asm["_emscripten_bind_btKinematicCharacterController_warp_1"];var _emscripten_bind_btAxisSweep3___destroy___0=Module["_emscripten_bind_btAxisSweep3___destroy___0"]=asm["_emscripten_bind_btAxisSweep3___destroy___0"];var _emscripten_bind_btCollisionWorld_performDiscreteCollisionDetection_0=Module["_emscripten_bind_btCollisionWorld_performDiscreteCollisionDetection_0"]=asm["_emscripten_bind_btCollisionWorld_performDiscreteCollisionDetection_0"];var _emscripten_bind_btTriangleMesh___destroy___0=Module["_emscripten_bind_btTriangleMesh___destroy___0"]=asm["_emscripten_bind_btTriangleMesh___destroy___0"];var _emscripten_bind_btKinematicCharacterController_preStep_1=Module["_emscripten_bind_btKinematicCharacterController_preStep_1"]=asm["_emscripten_bind_btKinematicCharacterController_preStep_1"];var _emscripten_bind_btRaycastVehicle_applyEngineForce_2=Module["_emscripten_bind_btRaycastVehicle_applyEngineForce_2"]=asm["_emscripten_bind_btRaycastVehicle_applyEngineForce_2"];var _emscripten_bind_btRaycastVehicle_setBrake_2=Module["_emscripten_bind_btRaycastVehicle_setBrake_2"]=asm["_emscripten_bind_btRaycastVehicle_setBrake_2"];var _emscripten_bind_ConcreteContactResultCallback___destroy___0=Module["_emscripten_bind_ConcreteContactResultCallback___destroy___0"]=asm["_emscripten_bind_ConcreteContactResultCallback___destroy___0"];var _emscripten_bind_btCollisionObject___destroy___0=Module["_emscripten_bind_btCollisionObject___destroy___0"]=asm["_emscripten_bind_btCollisionObject___destroy___0"];var _emscripten_bind_btVehicleTuning_set_m_suspensionDamping_1=Module["_emscripten_bind_btVehicleTuning_set_m_suspensionDamping_1"]=asm["_emscripten_bind_btVehicleTuning_set_m_suspensionDamping_1"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_linearSleepingThreshold_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_linearSleepingThreshold_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_linearSleepingThreshold_1"];var _emscripten_bind_btConeTwistConstraint_setMotorTargetInConstraintSpace_1=Module["_emscripten_bind_btConeTwistConstraint_setMotorTargetInConstraintSpace_1"]=asm["_emscripten_bind_btConeTwistConstraint_setMotorTargetInConstraintSpace_1"];var _emscripten_bind_btDispatcherInfo_set_m_timeStep_1=Module["_emscripten_bind_btDispatcherInfo_set_m_timeStep_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_timeStep_1"];var _emscripten_bind_btVector3_btVector3_3=Module["_emscripten_bind_btVector3_btVector3_3"]=asm["_emscripten_bind_btVector3_btVector3_3"];var _emscripten_bind_btVector3_btVector3_0=Module["_emscripten_bind_btVector3_btVector3_0"]=asm["_emscripten_bind_btVector3_btVector3_0"];var _emscripten_bind_btBoxShape___destroy___0=Module["_emscripten_bind_btBoxShape___destroy___0"]=asm["_emscripten_bind_btBoxShape___destroy___0"];var _emscripten_bind_btDiscreteDynamicsWorld_getGravity_0=Module["_emscripten_bind_btDiscreteDynamicsWorld_getGravity_0"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_getGravity_0"];var _emscripten_bind_btVector3_z_0=Module["_emscripten_bind_btVector3_z_0"]=asm["_emscripten_bind_btVector3_z_0"];var _emscripten_bind_ClosestConvexResultCallback_get_m_hitPointWorld_0=Module["_emscripten_bind_ClosestConvexResultCallback_get_m_hitPointWorld_0"]=asm["_emscripten_bind_ClosestConvexResultCallback_get_m_hitPointWorld_0"];var _emscripten_bind_btBroadphaseInterface___destroy___0=Module["_emscripten_bind_btBroadphaseInterface___destroy___0"]=asm["_emscripten_bind_btBroadphaseInterface___destroy___0"];var _emscripten_bind_btVehicleTuning_get_m_suspensionDamping_0=Module["_emscripten_bind_btVehicleTuning_get_m_suspensionDamping_0"]=asm["_emscripten_bind_btVehicleTuning_get_m_suspensionDamping_0"];var _emscripten_bind_btConeTwistConstraint___destroy___0=Module["_emscripten_bind_btConeTwistConstraint___destroy___0"]=asm["_emscripten_bind_btConeTwistConstraint___destroy___0"];var _emscripten_bind_btQuadWord___destroy___0=Module["_emscripten_bind_btQuadWord___destroy___0"]=asm["_emscripten_bind_btQuadWord___destroy___0"];var _emscripten_bind_ClosestRayResultCallback_set_m_rayFromWorld_1=Module["_emscripten_bind_ClosestRayResultCallback_set_m_rayFromWorld_1"]=asm["_emscripten_bind_ClosestRayResultCallback_set_m_rayFromWorld_1"];var _emscripten_bind_btWheelInfo_get_m_chassisConnectionPointCS_0=Module["_emscripten_bind_btWheelInfo_get_m_chassisConnectionPointCS_0"]=asm["_emscripten_bind_btWheelInfo_get_m_chassisConnectionPointCS_0"];var _emscripten_bind_btGhostObject_setAnisotropicFriction_2=Module["_emscripten_bind_btGhostObject_setAnisotropicFriction_2"]=asm["_emscripten_bind_btGhostObject_setAnisotropicFriction_2"];var _emscripten_bind_btConstraintSolver___destroy___0=Module["_emscripten_bind_btConstraintSolver___destroy___0"]=asm["_emscripten_bind_btConstraintSolver___destroy___0"];var _emscripten_bind_btDbvtBroadphase___destroy___0=Module["_emscripten_bind_btDbvtBroadphase___destroy___0"]=asm["_emscripten_bind_btDbvtBroadphase___destroy___0"];var _emscripten_bind_btCapsuleShape_btCapsuleShape_2=Module["_emscripten_bind_btCapsuleShape_btCapsuleShape_2"]=asm["_emscripten_bind_btCapsuleShape_btCapsuleShape_2"];var _emscripten_bind_btTypedConstraint_enableFeedback_1=Module["_emscripten_bind_btTypedConstraint_enableFeedback_1"]=asm["_emscripten_bind_btTypedConstraint_enableFeedback_1"];var _emscripten_bind_btCapsuleShape_setLocalScaling_1=Module["_emscripten_bind_btCapsuleShape_setLocalScaling_1"]=asm["_emscripten_bind_btCapsuleShape_setLocalScaling_1"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDampingFactor_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDampingFactor_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDampingFactor_0"];var _emscripten_bind_btRigidBody_setAnisotropicFriction_2=Module["_emscripten_bind_btRigidBody_setAnisotropicFriction_2"]=asm["_emscripten_bind_btRigidBody_setAnisotropicFriction_2"];var _emscripten_bind_btTriangleMeshShape_setLocalScaling_1=Module["_emscripten_bind_btTriangleMeshShape_setLocalScaling_1"]=asm["_emscripten_bind_btTriangleMeshShape_setLocalScaling_1"];var _emscripten_bind_ConvexResultCallback_set_m_closestHitFraction_1=Module["_emscripten_bind_ConvexResultCallback_set_m_closestHitFraction_1"]=asm["_emscripten_bind_ConvexResultCallback_set_m_closestHitFraction_1"];var _emscripten_bind_btPersistentManifold_btPersistentManifold_0=Module["_emscripten_bind_btPersistentManifold_btPersistentManifold_0"]=asm["_emscripten_bind_btPersistentManifold_btPersistentManifold_0"];var _emscripten_bind_ConvexResultCallback_get_m_collisionFilterMask_0=Module["_emscripten_bind_ConvexResultCallback_get_m_collisionFilterMask_0"]=asm["_emscripten_bind_ConvexResultCallback_get_m_collisionFilterMask_0"];var _emscripten_bind_ClosestRayResultCallback_ClosestRayResultCallback_2=Module["_emscripten_bind_ClosestRayResultCallback_ClosestRayResultCallback_2"]=asm["_emscripten_bind_ClosestRayResultCallback_ClosestRayResultCallback_2"];var _emscripten_bind_btVector4___destroy___0=Module["_emscripten_bind_btVector4___destroy___0"]=asm["_emscripten_bind_btVector4___destroy___0"];var _emscripten_bind_btPairCachingGhostObject_isKinematicObject_0=Module["_emscripten_bind_btPairCachingGhostObject_isKinematicObject_0"]=asm["_emscripten_bind_btPairCachingGhostObject_isKinematicObject_0"];var _emscripten_bind_btConstraintSetting_get_m_damping_0=Module["_emscripten_bind_btConstraintSetting_get_m_damping_0"]=asm["_emscripten_bind_btConstraintSetting_get_m_damping_0"];var _i64Add=Module["_i64Add"]=asm["_i64Add"];var _emscripten_bind_btContactSolverInfo_set_m_splitImpulse_1=Module["_emscripten_bind_btContactSolverInfo_set_m_splitImpulse_1"]=asm["_emscripten_bind_btContactSolverInfo_set_m_splitImpulse_1"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingThresholdSqr_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingThresholdSqr_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingThresholdSqr_0"];var _emscripten_bind_btCollisionObject_setCcdMotionThreshold_1=Module["_emscripten_bind_btCollisionObject_setCcdMotionThreshold_1"]=asm["_emscripten_bind_btCollisionObject_setCcdMotionThreshold_1"];var _emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_4=Module["_emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_4"]=asm["_emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_4"];var _emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_1=Module["_emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_1"]=asm["_emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_1"];var _emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterGroup_1=Module["_emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterGroup_1"]=asm["_emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterGroup_1"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_angularSleepingThreshold_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_angularSleepingThreshold_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_angularSleepingThreshold_0"];var _emscripten_bind_btPoint2PointConstraint_getPivotInB_0=Module["_emscripten_bind_btPoint2PointConstraint_getPivotInB_0"]=asm["_emscripten_bind_btPoint2PointConstraint_getPivotInB_0"];var _emscripten_bind_btKinematicCharacterController_playerStep_2=Module["_emscripten_bind_btKinematicCharacterController_playerStep_2"]=asm["_emscripten_bind_btKinematicCharacterController_playerStep_2"];var _emscripten_bind_btGhostObject_setCcdSweptSphereRadius_1=Module["_emscripten_bind_btGhostObject_setCcdSweptSphereRadius_1"]=asm["_emscripten_bind_btGhostObject_setCcdSweptSphereRadius_1"];var _emscripten_bind_btStaticPlaneShape_setLocalScaling_1=Module["_emscripten_bind_btStaticPlaneShape_setLocalScaling_1"]=asm["_emscripten_bind_btStaticPlaneShape_setLocalScaling_1"];var _emscripten_bind_btConvexTriangleMeshShape_calculateLocalInertia_2=Module["_emscripten_bind_btConvexTriangleMeshShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btConvexTriangleMeshShape_calculateLocalInertia_2"];var _emscripten_bind_btQuaternion___destroy___0=Module["_emscripten_bind_btQuaternion___destroy___0"]=asm["_emscripten_bind_btQuaternion___destroy___0"];var _emscripten_bind_btGhostObject_getWorldTransform_0=Module["_emscripten_bind_btGhostObject_getWorldTransform_0"]=asm["_emscripten_bind_btGhostObject_getWorldTransform_0"];var _emscripten_bind_btDiscreteDynamicsWorld_getPairCache_0=Module["_emscripten_bind_btDiscreteDynamicsWorld_getPairCache_0"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_getPairCache_0"];var _emscripten_bind_LocalConvexResult_set_m_hitFraction_1=Module["_emscripten_bind_LocalConvexResult_set_m_hitFraction_1"]=asm["_emscripten_bind_LocalConvexResult_set_m_hitFraction_1"];var _emscripten_bind_btCapsuleShapeZ_calculateLocalInertia_2=Module["_emscripten_bind_btCapsuleShapeZ_calculateLocalInertia_2"]=asm["_emscripten_bind_btCapsuleShapeZ_calculateLocalInertia_2"];var _emscripten_bind_btDispatcherInfo_get_m_timeStep_0=Module["_emscripten_bind_btDispatcherInfo_get_m_timeStep_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_timeStep_0"];var _emscripten_bind_btVehicleTuning_set_m_suspensionCompression_1=Module["_emscripten_bind_btVehicleTuning_set_m_suspensionCompression_1"]=asm["_emscripten_bind_btVehicleTuning_set_m_suspensionCompression_1"];var _emscripten_bind_btBoxShape_calculateLocalInertia_2=Module["_emscripten_bind_btBoxShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btBoxShape_calculateLocalInertia_2"];var _emscripten_bind_btMotionState___destroy___0=Module["_emscripten_bind_btMotionState___destroy___0"]=asm["_emscripten_bind_btMotionState___destroy___0"];var _emscripten_bind_btCollisionObject_setCollisionFlags_1=Module["_emscripten_bind_btCollisionObject_setCollisionFlags_1"]=asm["_emscripten_bind_btCollisionObject_setCollisionFlags_1"];var _emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_1=Module["_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_1"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_1"];var _emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_2=Module["_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_2"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_2"];var _emscripten_bind_btRigidBody_getMotionState_0=Module["_emscripten_bind_btRigidBody_getMotionState_0"]=asm["_emscripten_bind_btRigidBody_getMotionState_0"];var _emscripten_bind_btWheelInfo_set_m_suspensionStiffness_1=Module["_emscripten_bind_btWheelInfo_set_m_suspensionStiffness_1"]=asm["_emscripten_bind_btWheelInfo_set_m_suspensionStiffness_1"];var _emscripten_bind_btRaycastVehicle_getNumWheels_0=Module["_emscripten_bind_btRaycastVehicle_getNumWheels_0"]=asm["_emscripten_bind_btRaycastVehicle_getNumWheels_0"];var _emscripten_bind_btDispatcher_getManifoldByIndexInternal_1=Module["_emscripten_bind_btDispatcher_getManifoldByIndexInternal_1"]=asm["_emscripten_bind_btDispatcher_getManifoldByIndexInternal_1"];var _emscripten_bind_btCollisionDispatcher_getManifoldByIndexInternal_1=Module["_emscripten_bind_btCollisionDispatcher_getManifoldByIndexInternal_1"]=asm["_emscripten_bind_btCollisionDispatcher_getManifoldByIndexInternal_1"];var _emscripten_bind_btRaycastVehicle_getWheelInfo_1=Module["_emscripten_bind_btRaycastVehicle_getWheelInfo_1"]=asm["_emscripten_bind_btRaycastVehicle_getWheelInfo_1"];var _emscripten_bind_btWheelInfo_set_m_steering_1=Module["_emscripten_bind_btWheelInfo_set_m_steering_1"]=asm["_emscripten_bind_btWheelInfo_set_m_steering_1"];var _emscripten_bind_btPairCachingGhostObject_setWorldTransform_1=Module["_emscripten_bind_btPairCachingGhostObject_setWorldTransform_1"]=asm["_emscripten_bind_btPairCachingGhostObject_setWorldTransform_1"];var _emscripten_bind_btHingeConstraint_getBreakingImpulseThreshold_0=Module["_emscripten_bind_btHingeConstraint_getBreakingImpulseThreshold_0"]=asm["_emscripten_bind_btHingeConstraint_getBreakingImpulseThreshold_0"];var _emscripten_bind_btDefaultCollisionConstructionInfo___destroy___0=Module["_emscripten_bind_btDefaultCollisionConstructionInfo___destroy___0"]=asm["_emscripten_bind_btDefaultCollisionConstructionInfo___destroy___0"];var _emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_4=Module["_emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_4"]=asm["_emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_4"];var _emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_2=Module["_emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_2"]=asm["_emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_2"];var _emscripten_bind_btKinematicCharacterController_setJumpSpeed_1=Module["_emscripten_bind_btKinematicCharacterController_setJumpSpeed_1"]=asm["_emscripten_bind_btKinematicCharacterController_setJumpSpeed_1"];var _emscripten_bind_btConeShapeX_calculateLocalInertia_2=Module["_emscripten_bind_btConeShapeX_calculateLocalInertia_2"]=asm["_emscripten_bind_btConeShapeX_calculateLocalInertia_2"];var _emscripten_bind_btPairCachingGhostObject_getOverlappingObject_1=Module["_emscripten_bind_btPairCachingGhostObject_getOverlappingObject_1"]=asm["_emscripten_bind_btPairCachingGhostObject_getOverlappingObject_1"];var _emscripten_bind_btRigidBodyConstructionInfo___destroy___0=Module["_emscripten_bind_btRigidBodyConstructionInfo___destroy___0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo___destroy___0"];var _emscripten_bind_btGeneric6DofConstraint_setBreakingImpulseThreshold_1=Module["_emscripten_bind_btGeneric6DofConstraint_setBreakingImpulseThreshold_1"]=asm["_emscripten_bind_btGeneric6DofConstraint_setBreakingImpulseThreshold_1"];var _emscripten_bind_btPoint2PointConstraint_setPivotA_1=Module["_emscripten_bind_btPoint2PointConstraint_setPivotA_1"]=asm["_emscripten_bind_btPoint2PointConstraint_setPivotA_1"];var _emscripten_bind_ClosestConvexResultCallback_set_m_convexToWorld_1=Module["_emscripten_bind_ClosestConvexResultCallback_set_m_convexToWorld_1"]=asm["_emscripten_bind_ClosestConvexResultCallback_set_m_convexToWorld_1"];var _memcpy=Module["_memcpy"]=asm["_memcpy"];var _emscripten_bind_btCapsuleShape_calculateLocalInertia_2=Module["_emscripten_bind_btCapsuleShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btCapsuleShape_calculateLocalInertia_2"];var _emscripten_bind_btVector3_y_0=Module["_emscripten_bind_btVector3_y_0"]=asm["_emscripten_bind_btVector3_y_0"];var _emscripten_bind_btVehicleTuning_get_m_maxSuspensionForce_0=Module["_emscripten_bind_btVehicleTuning_get_m_maxSuspensionForce_0"]=asm["_emscripten_bind_btVehicleTuning_get_m_maxSuspensionForce_0"];var _emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_2=Module["_emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_2"]=asm["_emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_2"];var _emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_3=Module["_emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_3"]=asm["_emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_3"];var _emscripten_bind_LocalShapeInfo_get_m_triangleIndex_0=Module["_emscripten_bind_LocalShapeInfo_get_m_triangleIndex_0"]=asm["_emscripten_bind_LocalShapeInfo_get_m_triangleIndex_0"];var _emscripten_bind_btGhostObject_setCollisionShape_1=Module["_emscripten_bind_btGhostObject_setCollisionShape_1"]=asm["_emscripten_bind_btGhostObject_setCollisionShape_1"];var _emscripten_bind_btDispatcherInfo_set_m_allowedCcdPenetration_1=Module["_emscripten_bind_btDispatcherInfo_set_m_allowedCcdPenetration_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_allowedCcdPenetration_1"];var _emscripten_bind_btRigidBody_setRollingFriction_1=Module["_emscripten_bind_btRigidBody_setRollingFriction_1"]=asm["_emscripten_bind_btRigidBody_setRollingFriction_1"];var _emscripten_bind_btPairCachingGhostObject_setRollingFriction_1=Module["_emscripten_bind_btPairCachingGhostObject_setRollingFriction_1"]=asm["_emscripten_bind_btPairCachingGhostObject_setRollingFriction_1"];var _emscripten_bind_btDiscreteDynamicsWorld_setGravity_1=Module["_emscripten_bind_btDiscreteDynamicsWorld_setGravity_1"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_setGravity_1"];var _emscripten_bind_btVehicleTuning_set_m_suspensionStiffness_1=Module["_emscripten_bind_btVehicleTuning_set_m_suspensionStiffness_1"]=asm["_emscripten_bind_btVehicleTuning_set_m_suspensionStiffness_1"];var _emscripten_bind_btVector4_z_0=Module["_emscripten_bind_btVector4_z_0"]=asm["_emscripten_bind_btVector4_z_0"];var _emscripten_bind_btCollisionObject_forceActivationState_1=Module["_emscripten_bind_btCollisionObject_forceActivationState_1"]=asm["_emscripten_bind_btCollisionObject_forceActivationState_1"];var _emscripten_bind_btKinematicCharacterController_onGround_0=Module["_emscripten_bind_btKinematicCharacterController_onGround_0"]=asm["_emscripten_bind_btKinematicCharacterController_onGround_0"];var _free=Module["_free"]=asm["_free"];var _emscripten_bind_btGeneric6DofConstraint_getBreakingImpulseThreshold_0=Module["_emscripten_bind_btGeneric6DofConstraint_getBreakingImpulseThreshold_0"]=asm["_emscripten_bind_btGeneric6DofConstraint_getBreakingImpulseThreshold_0"];var _emscripten_bind_btConeTwistConstraint_setLimit_2=Module["_emscripten_bind_btConeTwistConstraint_setLimit_2"]=asm["_emscripten_bind_btConeTwistConstraint_setLimit_2"];var _emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterMask_1=Module["_emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterMask_1"]=asm["_emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterMask_1"];var _emscripten_bind_btRigidBody___destroy___0=Module["_emscripten_bind_btRigidBody___destroy___0"]=asm["_emscripten_bind_btRigidBody___destroy___0"];var _emscripten_bind_btStridingMeshInterface___destroy___0=Module["_emscripten_bind_btStridingMeshInterface___destroy___0"]=asm["_emscripten_bind_btStridingMeshInterface___destroy___0"];var runPostSets=Module["runPostSets"]=asm["runPostSets"];var _emscripten_bind_btRigidBody_setSleepingThresholds_2=Module["_emscripten_bind_btRigidBody_setSleepingThresholds_2"]=asm["_emscripten_bind_btRigidBody_setSleepingThresholds_2"];var _emscripten_bind_btCollisionObject_setWorldTransform_1=Module["_emscripten_bind_btCollisionObject_setWorldTransform_1"]=asm["_emscripten_bind_btCollisionObject_setWorldTransform_1"];var _emscripten_bind_LocalConvexResult_get_m_localShapeInfo_0=Module["_emscripten_bind_LocalConvexResult_get_m_localShapeInfo_0"]=asm["_emscripten_bind_LocalConvexResult_get_m_localShapeInfo_0"];var _emscripten_bind_btManifoldPoint_get_m_localPointA_0=Module["_emscripten_bind_btManifoldPoint_get_m_localPointA_0"]=asm["_emscripten_bind_btManifoldPoint_get_m_localPointA_0"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_linearDamping_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_linearDamping_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_linearDamping_0"];var _emscripten_bind_btCollisionWorld_getBroadphase_0=Module["_emscripten_bind_btCollisionWorld_getBroadphase_0"]=asm["_emscripten_bind_btCollisionWorld_getBroadphase_0"];var _emscripten_bind_btDispatcher_getNumManifolds_0=Module["_emscripten_bind_btDispatcher_getNumManifolds_0"]=asm["_emscripten_bind_btDispatcher_getNumManifolds_0"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_linearSleepingThreshold_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_linearSleepingThreshold_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_linearSleepingThreshold_0"];var _emscripten_bind_btRigidBody_activate_1=Module["_emscripten_bind_btRigidBody_activate_1"]=asm["_emscripten_bind_btRigidBody_activate_1"];var _emscripten_bind_btRigidBody_activate_0=Module["_emscripten_bind_btRigidBody_activate_0"]=asm["_emscripten_bind_btRigidBody_activate_0"];var _emscripten_bind_btRaycastVehicle___destroy___0=Module["_emscripten_bind_btRaycastVehicle___destroy___0"]=asm["_emscripten_bind_btRaycastVehicle___destroy___0"];var _emscripten_bind_btGhostObject_setActivationState_1=Module["_emscripten_bind_btGhostObject_setActivationState_1"]=asm["_emscripten_bind_btGhostObject_setActivationState_1"];var _emscripten_bind_btCollisionWorld_contactPairTest_3=Module["_emscripten_bind_btCollisionWorld_contactPairTest_3"]=asm["_emscripten_bind_btCollisionWorld_contactPairTest_3"];var _emscripten_bind_btDispatcherInfo_get_m_useContinuous_0=Module["_emscripten_bind_btDispatcherInfo_get_m_useContinuous_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_useContinuous_0"];var _emscripten_bind_btCylinderShapeX___destroy___0=Module["_emscripten_bind_btCylinderShapeX___destroy___0"]=asm["_emscripten_bind_btCylinderShapeX___destroy___0"];var _emscripten_bind_btManifoldPoint_getPositionWorldOnA_0=Module["_emscripten_bind_btManifoldPoint_getPositionWorldOnA_0"]=asm["_emscripten_bind_btManifoldPoint_getPositionWorldOnA_0"];var _emscripten_bind_LocalConvexResult_set_m_localShapeInfo_1=Module["_emscripten_bind_LocalConvexResult_set_m_localShapeInfo_1"]=asm["_emscripten_bind_LocalConvexResult_set_m_localShapeInfo_1"];var _emscripten_bind_btDispatcherInfo_get_m_useConvexConservativeDistanceUtil_0=Module["_emscripten_bind_btDispatcherInfo_get_m_useConvexConservativeDistanceUtil_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_useConvexConservativeDistanceUtil_0"];var _emscripten_bind_btVector4_x_0=Module["_emscripten_bind_btVector4_x_0"]=asm["_emscripten_bind_btVector4_x_0"];var _emscripten_bind_btPairCachingGhostObject_setCollisionFlags_1=Module["_emscripten_bind_btPairCachingGhostObject_setCollisionFlags_1"]=asm["_emscripten_bind_btPairCachingGhostObject_setCollisionFlags_1"];var _emscripten_bind_btKinematicCharacterController_getGhostObject_0=Module["_emscripten_bind_btKinematicCharacterController_getGhostObject_0"]=asm["_emscripten_bind_btKinematicCharacterController_getGhostObject_0"];var _emscripten_bind_btRigidBody_btRigidBody_1=Module["_emscripten_bind_btRigidBody_btRigidBody_1"]=asm["_emscripten_bind_btRigidBody_btRigidBody_1"];var _emscripten_bind_btTriangleMeshShape___destroy___0=Module["_emscripten_bind_btTriangleMeshShape___destroy___0"]=asm["_emscripten_bind_btTriangleMeshShape___destroy___0"];var _emscripten_bind_btKinematicCharacterController_setWalkDirection_1=Module["_emscripten_bind_btKinematicCharacterController_setWalkDirection_1"]=asm["_emscripten_bind_btKinematicCharacterController_setWalkDirection_1"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_restitution_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_restitution_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_restitution_0"];var _emscripten_bind_btVehicleTuning_get_m_suspensionStiffness_0=Module["_emscripten_bind_btVehicleTuning_get_m_suspensionStiffness_0"]=asm["_emscripten_bind_btVehicleTuning_get_m_suspensionStiffness_0"];var _emscripten_bind_btManifoldPoint_set_m_normalWorldOnB_1=Module["_emscripten_bind_btManifoldPoint_set_m_normalWorldOnB_1"]=asm["_emscripten_bind_btManifoldPoint_set_m_normalWorldOnB_1"];var _emscripten_bind_btKinematicCharacterController_getGravity_0=Module["_emscripten_bind_btKinematicCharacterController_getGravity_0"]=asm["_emscripten_bind_btKinematicCharacterController_getGravity_0"];var _emscripten_bind_btConeTwistConstraint_getBreakingImpulseThreshold_0=Module["_emscripten_bind_btConeTwistConstraint_getBreakingImpulseThreshold_0"]=asm["_emscripten_bind_btConeTwistConstraint_getBreakingImpulseThreshold_0"];var _emscripten_bind_btGeneric6DofConstraint_setAngularLowerLimit_1=Module["_emscripten_bind_btGeneric6DofConstraint_setAngularLowerLimit_1"]=asm["_emscripten_bind_btGeneric6DofConstraint_setAngularLowerLimit_1"];var _emscripten_bind_LocalShapeInfo_get_m_shapePart_0=Module["_emscripten_bind_LocalShapeInfo_get_m_shapePart_0"]=asm["_emscripten_bind_LocalShapeInfo_get_m_shapePart_0"];var _emscripten_bind_btConeShape_calculateLocalInertia_2=Module["_emscripten_bind_btConeShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btConeShape_calculateLocalInertia_2"];var _emscripten_bind_btCylinderShapeX_calculateLocalInertia_2=Module["_emscripten_bind_btCylinderShapeX_calculateLocalInertia_2"]=asm["_emscripten_bind_btCylinderShapeX_calculateLocalInertia_2"];var _emscripten_bind_ConvexResultCallback_set_m_collisionFilterMask_1=Module["_emscripten_bind_ConvexResultCallback_set_m_collisionFilterMask_1"]=asm["_emscripten_bind_ConvexResultCallback_set_m_collisionFilterMask_1"];var _llvm_bswap_i32=Module["_llvm_bswap_i32"]=asm["_llvm_bswap_i32"];var _emscripten_bind_btSphereShape_setLocalScaling_1=Module["_emscripten_bind_btSphereShape_setLocalScaling_1"]=asm["_emscripten_bind_btSphereShape_setLocalScaling_1"];var _emscripten_bind_btVector4_w_0=Module["_emscripten_bind_btVector4_w_0"]=asm["_emscripten_bind_btVector4_w_0"];var _emscripten_bind_btManifoldPoint_get_m_normalWorldOnB_0=Module["_emscripten_bind_btManifoldPoint_get_m_normalWorldOnB_0"]=asm["_emscripten_bind_btManifoldPoint_get_m_normalWorldOnB_0"];var _emscripten_bind_btBvhTriangleMeshShape___destroy___0=Module["_emscripten_bind_btBvhTriangleMeshShape___destroy___0"]=asm["_emscripten_bind_btBvhTriangleMeshShape___destroy___0"];var _emscripten_bind_ClosestRayResultCallback_get_m_rayToWorld_0=Module["_emscripten_bind_ClosestRayResultCallback_get_m_rayToWorld_0"]=asm["_emscripten_bind_ClosestRayResultCallback_get_m_rayToWorld_0"];var _emscripten_bind_ClosestConvexResultCallback_set_m_closestHitFraction_1=Module["_emscripten_bind_ClosestConvexResultCallback_set_m_closestHitFraction_1"]=asm["_emscripten_bind_ClosestConvexResultCallback_set_m_closestHitFraction_1"];var _emscripten_bind_btDiscreteDynamicsWorld_removeConstraint_1=Module["_emscripten_bind_btDiscreteDynamicsWorld_removeConstraint_1"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_removeConstraint_1"];var _emscripten_bind_btVector4_y_0=Module["_emscripten_bind_btVector4_y_0"]=asm["_emscripten_bind_btVector4_y_0"];var _emscripten_bind_btGeneric6DofConstraint___destroy___0=Module["_emscripten_bind_btGeneric6DofConstraint___destroy___0"]=asm["_emscripten_bind_btGeneric6DofConstraint___destroy___0"];var _emscripten_bind_btVehicleTuning_get_m_maxSuspensionTravelCm_0=Module["_emscripten_bind_btVehicleTuning_get_m_maxSuspensionTravelCm_0"]=asm["_emscripten_bind_btVehicleTuning_get_m_maxSuspensionTravelCm_0"];var _emscripten_bind_btConvexHullShape_addPoint_1=Module["_emscripten_bind_btConvexHullShape_addPoint_1"]=asm["_emscripten_bind_btConvexHullShape_addPoint_1"];var _emscripten_bind_btConvexHullShape_addPoint_2=Module["_emscripten_bind_btConvexHullShape_addPoint_2"]=asm["_emscripten_bind_btConvexHullShape_addPoint_2"];var _emscripten_bind_btPoint2PointConstraint_getBreakingImpulseThreshold_0=Module["_emscripten_bind_btPoint2PointConstraint_getBreakingImpulseThreshold_0"]=asm["_emscripten_bind_btPoint2PointConstraint_getBreakingImpulseThreshold_0"];var _emscripten_bind_btTransform_getOrigin_0=Module["_emscripten_bind_btTransform_getOrigin_0"]=asm["_emscripten_bind_btTransform_getOrigin_0"];var _emscripten_bind_btHingeConstraint___destroy___0=Module["_emscripten_bind_btHingeConstraint___destroy___0"]=asm["_emscripten_bind_btHingeConstraint___destroy___0"];var _emscripten_bind_btConvexShape_calculateLocalInertia_2=Module["_emscripten_bind_btConvexShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btConvexShape_calculateLocalInertia_2"];var _memset=Module["_memset"]=asm["_memset"];var _emscripten_bind_btKinematicCharacterController___destroy___0=Module["_emscripten_bind_btKinematicCharacterController___destroy___0"]=asm["_emscripten_bind_btKinematicCharacterController___destroy___0"];var _emscripten_bind_ClosestRayResultCallback_get_m_hitNormalWorld_0=Module["_emscripten_bind_ClosestRayResultCallback_get_m_hitNormalWorld_0"]=asm["_emscripten_bind_ClosestRayResultCallback_get_m_hitNormalWorld_0"];var _emscripten_bind_btTriangleMesh_btTriangleMesh_0=Module["_emscripten_bind_btTriangleMesh_btTriangleMesh_0"]=asm["_emscripten_bind_btTriangleMesh_btTriangleMesh_0"];var _emscripten_bind_btTriangleMesh_btTriangleMesh_1=Module["_emscripten_bind_btTriangleMesh_btTriangleMesh_1"]=asm["_emscripten_bind_btTriangleMesh_btTriangleMesh_1"];var _emscripten_bind_btTriangleMesh_btTriangleMesh_2=Module["_emscripten_bind_btTriangleMesh_btTriangleMesh_2"]=asm["_emscripten_bind_btTriangleMesh_btTriangleMesh_2"];var _emscripten_bind_btTransform___destroy___0=Module["_emscripten_bind_btTransform___destroy___0"]=asm["_emscripten_bind_btTransform___destroy___0"];var _emscripten_bind_btWheelInfo_set_m_frictionSlip_1=Module["_emscripten_bind_btWheelInfo_set_m_frictionSlip_1"]=asm["_emscripten_bind_btWheelInfo_set_m_frictionSlip_1"];var _emscripten_bind_btDynamicsWorld_performDiscreteCollisionDetection_0=Module["_emscripten_bind_btDynamicsWorld_performDiscreteCollisionDetection_0"]=asm["_emscripten_bind_btDynamicsWorld_performDiscreteCollisionDetection_0"];var _emscripten_bind_btHingeConstraint_enableAngularMotor_3=Module["_emscripten_bind_btHingeConstraint_enableAngularMotor_3"]=asm["_emscripten_bind_btHingeConstraint_enableAngularMotor_3"];var _emscripten_bind_btManifoldPoint_set_m_positionWorldOnA_1=Module["_emscripten_bind_btManifoldPoint_set_m_positionWorldOnA_1"]=asm["_emscripten_bind_btManifoldPoint_set_m_positionWorldOnA_1"];var _emscripten_bind_btRigidBody_setCenterOfMassTransform_1=Module["_emscripten_bind_btRigidBody_setCenterOfMassTransform_1"]=asm["_emscripten_bind_btRigidBody_setCenterOfMassTransform_1"];var _emscripten_bind_btManifoldPoint_get_m_localPointB_0=Module["_emscripten_bind_btManifoldPoint_get_m_localPointB_0"]=asm["_emscripten_bind_btManifoldPoint_get_m_localPointB_0"];var _emscripten_bind_btDiscreteDynamicsWorld_contactPairTest_3=Module["_emscripten_bind_btDiscreteDynamicsWorld_contactPairTest_3"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_contactPairTest_3"];var _emscripten_bind_btSliderConstraint_setLowerLinLimit_1=Module["_emscripten_bind_btSliderConstraint_setLowerLinLimit_1"]=asm["_emscripten_bind_btSliderConstraint_setLowerLinLimit_1"];var _emscripten_bind_btRigidBody_getAngularVelocity_0=Module["_emscripten_bind_btRigidBody_getAngularVelocity_0"]=asm["_emscripten_bind_btRigidBody_getAngularVelocity_0"];var _emscripten_bind_btCollisionObject_setCcdSweptSphereRadius_1=Module["_emscripten_bind_btCollisionObject_setCcdSweptSphereRadius_1"]=asm["_emscripten_bind_btCollisionObject_setCcdSweptSphereRadius_1"];var _emscripten_bind_btWheelInfo_get_m_wheelsRadius_0=Module["_emscripten_bind_btWheelInfo_get_m_wheelsRadius_0"]=asm["_emscripten_bind_btWheelInfo_get_m_wheelsRadius_0"];var _emscripten_bind_btRigidBody_setLinearVelocity_1=Module["_emscripten_bind_btRigidBody_setLinearVelocity_1"]=asm["_emscripten_bind_btRigidBody_setLinearVelocity_1"];var _emscripten_bind_btVehicleTuning_btVehicleTuning_0=Module["_emscripten_bind_btVehicleTuning_btVehicleTuning_0"]=asm["_emscripten_bind_btVehicleTuning_btVehicleTuning_0"];var _emscripten_bind_RayResultCallback_set_m_collisionObject_1=Module["_emscripten_bind_RayResultCallback_set_m_collisionObject_1"]=asm["_emscripten_bind_RayResultCallback_set_m_collisionObject_1"];var _emscripten_bind_ClosestRayResultCallback_set_m_rayToWorld_1=Module["_emscripten_bind_ClosestRayResultCallback_set_m_rayToWorld_1"]=asm["_emscripten_bind_ClosestRayResultCallback_set_m_rayToWorld_1"];var _emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterGroup_0=Module["_emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterGroup_0"]=asm["_emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterGroup_0"];var _emscripten_bind_btWheelInfo_set_m_wheelsDampingRelaxation_1=Module["_emscripten_bind_btWheelInfo_set_m_wheelsDampingRelaxation_1"]=asm["_emscripten_bind_btWheelInfo_set_m_wheelsDampingRelaxation_1"];var _emscripten_bind_btDynamicsWorld_addAction_1=Module["_emscripten_bind_btDynamicsWorld_addAction_1"]=asm["_emscripten_bind_btDynamicsWorld_addAction_1"];var _emscripten_bind_btDefaultVehicleRaycaster___destroy___0=Module["_emscripten_bind_btDefaultVehicleRaycaster___destroy___0"]=asm["_emscripten_bind_btDefaultVehicleRaycaster___destroy___0"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_linearDamping_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_linearDamping_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_linearDamping_1"];var _emscripten_bind_btRigidBody_setGravity_1=Module["_emscripten_bind_btRigidBody_setGravity_1"]=asm["_emscripten_bind_btRigidBody_setGravity_1"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDamping_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDamping_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDamping_1"];var _emscripten_bind_btKinematicCharacterController_setFallSpeed_1=Module["_emscripten_bind_btKinematicCharacterController_setFallSpeed_1"]=asm["_emscripten_bind_btKinematicCharacterController_setFallSpeed_1"];var _emscripten_bind_btRigidBody_setActivationState_1=Module["_emscripten_bind_btRigidBody_setActivationState_1"]=asm["_emscripten_bind_btRigidBody_setActivationState_1"];var _emscripten_bind_ClosestConvexResultCallback_hasHit_0=Module["_emscripten_bind_ClosestConvexResultCallback_hasHit_0"]=asm["_emscripten_bind_ClosestConvexResultCallback_hasHit_0"];var _emscripten_bind_btCapsuleShapeZ___destroy___0=Module["_emscripten_bind_btCapsuleShapeZ___destroy___0"]=asm["_emscripten_bind_btCapsuleShapeZ___destroy___0"];var _emscripten_bind_LocalShapeInfo_set_m_shapePart_1=Module["_emscripten_bind_LocalShapeInfo_set_m_shapePart_1"]=asm["_emscripten_bind_LocalShapeInfo_set_m_shapePart_1"];var _emscripten_bind_ClosestRayResultCallback_get_m_collisionObject_0=Module["_emscripten_bind_ClosestRayResultCallback_get_m_collisionObject_0"]=asm["_emscripten_bind_ClosestRayResultCallback_get_m_collisionObject_0"];var _emscripten_bind_btTriangleMesh_addTriangle_3=Module["_emscripten_bind_btTriangleMesh_addTriangle_3"]=asm["_emscripten_bind_btTriangleMesh_addTriangle_3"];var _emscripten_bind_btGhostObject_getOverlappingObject_1=Module["_emscripten_bind_btGhostObject_getOverlappingObject_1"]=asm["_emscripten_bind_btGhostObject_getOverlappingObject_1"];var _emscripten_bind_btTriangleMesh_addTriangle_4=Module["_emscripten_bind_btTriangleMesh_addTriangle_4"]=asm["_emscripten_bind_btTriangleMesh_addTriangle_4"];var _emscripten_bind_btRigidBody_applyTorqueImpulse_1=Module["_emscripten_bind_btRigidBody_applyTorqueImpulse_1"]=asm["_emscripten_bind_btRigidBody_applyTorqueImpulse_1"];var _emscripten_bind_btRigidBody_setCollisionFlags_1=Module["_emscripten_bind_btRigidBody_setCollisionFlags_1"]=asm["_emscripten_bind_btRigidBody_setCollisionFlags_1"];var _emscripten_bind_btWheelInfo_set_m_suspensionRestLength1_1=Module["_emscripten_bind_btWheelInfo_set_m_suspensionRestLength1_1"]=asm["_emscripten_bind_btWheelInfo_set_m_suspensionRestLength1_1"];var _emscripten_bind_btConeShape___destroy___0=Module["_emscripten_bind_btConeShape___destroy___0"]=asm["_emscripten_bind_btConeShape___destroy___0"];var _emscripten_bind_btCapsuleShapeZ_btCapsuleShapeZ_2=Module["_emscripten_bind_btCapsuleShapeZ_btCapsuleShapeZ_2"]=asm["_emscripten_bind_btCapsuleShapeZ_btCapsuleShapeZ_2"];var _emscripten_bind_btSliderConstraint_btSliderConstraint_5=Module["_emscripten_bind_btSliderConstraint_btSliderConstraint_5"]=asm["_emscripten_bind_btSliderConstraint_btSliderConstraint_5"];var _emscripten_bind_btSliderConstraint_btSliderConstraint_3=Module["_emscripten_bind_btSliderConstraint_btSliderConstraint_3"]=asm["_emscripten_bind_btSliderConstraint_btSliderConstraint_3"];var _emscripten_bind_btDispatcherInfo_get_m_allowedCcdPenetration_0=Module["_emscripten_bind_btDispatcherInfo_get_m_allowedCcdPenetration_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_allowedCcdPenetration_0"];var _emscripten_bind_btDynamicsWorld_convexSweepTest_5=Module["_emscripten_bind_btDynamicsWorld_convexSweepTest_5"]=asm["_emscripten_bind_btDynamicsWorld_convexSweepTest_5"];var _emscripten_bind_btSliderConstraint___destroy___0=Module["_emscripten_bind_btSliderConstraint___destroy___0"]=asm["_emscripten_bind_btSliderConstraint___destroy___0"];var _emscripten_bind_btRigidBody_forceActivationState_1=Module["_emscripten_bind_btRigidBody_forceActivationState_1"]=asm["_emscripten_bind_btRigidBody_forceActivationState_1"];var _emscripten_bind_btPoint2PointConstraint_setPivotB_1=Module["_emscripten_bind_btPoint2PointConstraint_setPivotB_1"]=asm["_emscripten_bind_btPoint2PointConstraint_setPivotB_1"];var _emscripten_bind_btManifoldPoint_getDistance_0=Module["_emscripten_bind_btManifoldPoint_getDistance_0"]=asm["_emscripten_bind_btManifoldPoint_getDistance_0"];var _emscripten_bind_btGhostPairCallback___destroy___0=Module["_emscripten_bind_btGhostPairCallback___destroy___0"]=asm["_emscripten_bind_btGhostPairCallback___destroy___0"];var _emscripten_bind_btKinematicCharacterController_getMaxSlope_0=Module["_emscripten_bind_btKinematicCharacterController_getMaxSlope_0"]=asm["_emscripten_bind_btKinematicCharacterController_getMaxSlope_0"];var _emscripten_bind_btSliderConstraint_enableFeedback_1=Module["_emscripten_bind_btSliderConstraint_enableFeedback_1"]=asm["_emscripten_bind_btSliderConstraint_enableFeedback_1"];var _emscripten_bind_btRaycastVehicle_addWheel_7=Module["_emscripten_bind_btRaycastVehicle_addWheel_7"]=asm["_emscripten_bind_btRaycastVehicle_addWheel_7"];var _emscripten_bind_btPairCachingGhostObject_isActive_0=Module["_emscripten_bind_btPairCachingGhostObject_isActive_0"]=asm["_emscripten_bind_btPairCachingGhostObject_isActive_0"];var _emscripten_bind_ContactResultCallback___destroy___0=Module["_emscripten_bind_ContactResultCallback___destroy___0"]=asm["_emscripten_bind_ContactResultCallback___destroy___0"];var _emscripten_bind_btStaticPlaneShape___destroy___0=Module["_emscripten_bind_btStaticPlaneShape___destroy___0"]=asm["_emscripten_bind_btStaticPlaneShape___destroy___0"];var _emscripten_bind_btDispatcherInfo_set_m_stepCount_1=Module["_emscripten_bind_btDispatcherInfo_set_m_stepCount_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_stepCount_1"];var _emscripten_bind_btBoxShape_setLocalScaling_1=Module["_emscripten_bind_btBoxShape_setLocalScaling_1"]=asm["_emscripten_bind_btBoxShape_setLocalScaling_1"];var _emscripten_bind_btConeShapeZ___destroy___0=Module["_emscripten_bind_btConeShapeZ___destroy___0"]=asm["_emscripten_bind_btConeShapeZ___destroy___0"];var _emscripten_bind_btDynamicsWorld_getPairCache_0=Module["_emscripten_bind_btDynamicsWorld_getPairCache_0"]=asm["_emscripten_bind_btDynamicsWorld_getPairCache_0"];var _emscripten_bind_btDiscreteDynamicsWorld_convexSweepTest_5=Module["_emscripten_bind_btDiscreteDynamicsWorld_convexSweepTest_5"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_convexSweepTest_5"];var _emscripten_bind_btKinematicCharacterController_setVelocityForTimeInterval_2=Module["_emscripten_bind_btKinematicCharacterController_setVelocityForTimeInterval_2"]=asm["_emscripten_bind_btKinematicCharacterController_setVelocityForTimeInterval_2"];var _emscripten_bind_btRigidBody_setRestitution_1=Module["_emscripten_bind_btRigidBody_setRestitution_1"]=asm["_emscripten_bind_btRigidBody_setRestitution_1"];var _emscripten_bind_btVector4_btVector4_0=Module["_emscripten_bind_btVector4_btVector4_0"]=asm["_emscripten_bind_btVector4_btVector4_0"];var _emscripten_bind_btDispatcherInfo_get_m_enableSatConvex_0=Module["_emscripten_bind_btDispatcherInfo_get_m_enableSatConvex_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_enableSatConvex_0"];var _emscripten_bind_btDiscreteDynamicsWorld_performDiscreteCollisionDetection_0=Module["_emscripten_bind_btDiscreteDynamicsWorld_performDiscreteCollisionDetection_0"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_performDiscreteCollisionDetection_0"];var _emscripten_bind_btVector4_btVector4_4=Module["_emscripten_bind_btVector4_btVector4_4"]=asm["_emscripten_bind_btVector4_btVector4_4"];var _emscripten_bind_btGeneric6DofConstraint_setLinearLowerLimit_1=Module["_emscripten_bind_btGeneric6DofConstraint_setLinearLowerLimit_1"]=asm["_emscripten_bind_btGeneric6DofConstraint_setLinearLowerLimit_1"];var _emscripten_bind_btGeneric6DofSpringConstraint_setLinearLowerLimit_1=Module["_emscripten_bind_btGeneric6DofSpringConstraint_setLinearLowerLimit_1"]=asm["_emscripten_bind_btGeneric6DofSpringConstraint_setLinearLowerLimit_1"];var _emscripten_bind_LocalConvexResult_set_m_hitCollisionObject_1=Module["_emscripten_bind_LocalConvexResult_set_m_hitCollisionObject_1"]=asm["_emscripten_bind_LocalConvexResult_set_m_hitCollisionObject_1"];var _emscripten_bind_btConstraintSetting_btConstraintSetting_0=Module["_emscripten_bind_btConstraintSetting_btConstraintSetting_0"]=asm["_emscripten_bind_btConstraintSetting_btConstraintSetting_0"];var _emscripten_bind_btGeneric6DofSpringConstraint_setAngularLowerLimit_1=Module["_emscripten_bind_btGeneric6DofSpringConstraint_setAngularLowerLimit_1"]=asm["_emscripten_bind_btGeneric6DofSpringConstraint_setAngularLowerLimit_1"];var _emscripten_bind_btDiscreteDynamicsWorld_rayTest_3=Module["_emscripten_bind_btDiscreteDynamicsWorld_rayTest_3"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_rayTest_3"];var _emscripten_bind_btContactSolverInfo_get_m_splitImpulse_0=Module["_emscripten_bind_btContactSolverInfo_get_m_splitImpulse_0"]=asm["_emscripten_bind_btContactSolverInfo_get_m_splitImpulse_0"];var _emscripten_bind_btGhostPairCallback_btGhostPairCallback_0=Module["_emscripten_bind_btGhostPairCallback_btGhostPairCallback_0"]=asm["_emscripten_bind_btGhostPairCallback_btGhostPairCallback_0"];var _emscripten_bind_btKinematicCharacterController_setMaxJumpHeight_1=Module["_emscripten_bind_btKinematicCharacterController_setMaxJumpHeight_1"]=asm["_emscripten_bind_btKinematicCharacterController_setMaxJumpHeight_1"];var _emscripten_bind_ClosestRayResultCallback_set_m_hitNormalWorld_1=Module["_emscripten_bind_ClosestRayResultCallback_set_m_hitNormalWorld_1"]=asm["_emscripten_bind_ClosestRayResultCallback_set_m_hitNormalWorld_1"];var _emscripten_bind_btVehicleTuning_get_m_frictionSlip_0=Module["_emscripten_bind_btVehicleTuning_get_m_frictionSlip_0"]=asm["_emscripten_bind_btVehicleTuning_get_m_frictionSlip_0"];var dynCall_viiiii=Module["dynCall_viiiii"]=asm["dynCall_viiiii"];var dynCall_vid=Module["dynCall_vid"]=asm["dynCall_vid"];var dynCall_vi=Module["dynCall_vi"]=asm["dynCall_vi"];var dynCall_viiidii=Module["dynCall_viiidii"]=asm["dynCall_viiidii"];var dynCall_vii=Module["dynCall_vii"]=asm["dynCall_vii"];var dynCall_iiiiiiiiiii=Module["dynCall_iiiiiiiiiii"]=asm["dynCall_iiiiiiiiiii"];var dynCall_ii=Module["dynCall_ii"]=asm["dynCall_ii"];var dynCall_viidi=Module["dynCall_viidi"]=asm["dynCall_viidi"];var dynCall_viddiii=Module["dynCall_viddiii"]=asm["dynCall_viddiii"];var dynCall_vidii=Module["dynCall_vidii"]=asm["dynCall_vidii"];var dynCall_iiiii=Module["dynCall_iiiii"]=asm["dynCall_iiiii"];var dynCall_vidi=Module["dynCall_vidi"]=asm["dynCall_vidi"];var dynCall_diiiiiiii=Module["dynCall_diiiiiiii"]=asm["dynCall_diiiiiiii"];var dynCall_viiiiddddiid=Module["dynCall_viiiiddddiid"]=asm["dynCall_viiiiddddiid"];var dynCall_diiiii=Module["dynCall_diiiii"]=asm["dynCall_diiiii"];var dynCall_iiii=Module["dynCall_iiii"]=asm["dynCall_iiii"];var dynCall_viiiiii=Module["dynCall_viiiiii"]=asm["dynCall_viiiiii"];var dynCall_iiid=Module["dynCall_iiid"]=asm["dynCall_iiid"];var dynCall_di=Module["dynCall_di"]=asm["dynCall_di"];var dynCall_iiiiiii=Module["dynCall_iiiiiii"]=asm["dynCall_iiiiiii"];var dynCall_diiidii=Module["dynCall_diiidii"]=asm["dynCall_diiidii"];var dynCall_viidii=Module["dynCall_viidii"]=asm["dynCall_viidii"];var dynCall_viiiiiii=Module["dynCall_viiiiiii"]=asm["dynCall_viiiiiii"];var dynCall_viiiiiiiii=Module["dynCall_viiiiiiiii"]=asm["dynCall_viiiiiiiii"];var dynCall_viiiiiiiiii=Module["dynCall_viiiiiiiiii"]=asm["dynCall_viiiiiiiiii"];var dynCall_iii=Module["dynCall_iii"]=asm["dynCall_iii"];var dynCall_diii=Module["dynCall_diii"]=asm["dynCall_diii"];var dynCall_diiiiiiiiii=Module["dynCall_diiiiiiiiii"]=asm["dynCall_diiiiiiiiii"];var dynCall_viiiid=Module["dynCall_viiiid"]=asm["dynCall_viiiid"];var dynCall_diiiiiiiii=Module["dynCall_diiiiiiiii"]=asm["dynCall_diiiiiiiii"];var dynCall_did=Module["dynCall_did"]=asm["dynCall_did"];var dynCall_viiiidddddidi=Module["dynCall_viiiidddddidi"]=asm["dynCall_viiiidddddidi"];var dynCall_diidii=Module["dynCall_diidii"]=asm["dynCall_diidii"];var dynCall_diiii=Module["dynCall_diiii"]=asm["dynCall_diiii"];var dynCall_iiiiiiiiii=Module["dynCall_iiiiiiiiii"]=asm["dynCall_iiiiiiiiii"];var dynCall_viiid=Module["dynCall_viiid"]=asm["dynCall_viiid"];var dynCall_viii=Module["dynCall_viii"]=asm["dynCall_viii"];var dynCall_v=Module["dynCall_v"]=asm["dynCall_v"];var dynCall_viid=Module["dynCall_viid"]=asm["dynCall_viid"];var dynCall_iidid=Module["dynCall_iidid"]=asm["dynCall_iidid"];var dynCall_viiii=Module["dynCall_viiii"]=asm["dynCall_viiii"];Runtime.stackAlloc=asm["stackAlloc"];Runtime.stackSave=asm["stackSave"];Runtime.stackRestore=asm["stackRestore"];Runtime.setTempRet0=asm["setTempRet0"];Runtime.getTempRet0=asm["getTempRet0"];var i64Math=(function(){var goog={math:{}};goog.math.Long=(function(low,high){this.low_=low|0;this.high_=high|0});goog.math.Long.IntCache_={};goog.math.Long.fromInt=(function(value){if(-128<=value&&value<128){var cachedObj=goog.math.Long.IntCache_[value];if(cachedObj){return cachedObj}}var obj=new goog.math.Long(value|0,value<0?-1:0);if(-128<=value&&value<128){goog.math.Long.IntCache_[value]=obj}return obj});goog.math.Long.fromNumber=(function(value){if(isNaN(value)||!isFinite(value)){return goog.math.Long.ZERO}else if(value<=-goog.math.Long.TWO_PWR_63_DBL_){return goog.math.Long.MIN_VALUE}else if(value+1>=goog.math.Long.TWO_PWR_63_DBL_){return goog.math.Long.MAX_VALUE}else if(value<0){return goog.math.Long.fromNumber(-value).negate()}else{return new goog.math.Long(value%goog.math.Long.TWO_PWR_32_DBL_|0,value/goog.math.Long.TWO_PWR_32_DBL_|0)}});goog.math.Long.fromBits=(function(lowBits,highBits){return new goog.math.Long(lowBits,highBits)});goog.math.Long.fromString=(function(str,opt_radix){if(str.length==0){throw Error("number format error: empty string")}var radix=opt_radix||10;if(radix<2||36<radix){throw Error("radix out of range: "+radix)}if(str.charAt(0)=="-"){return goog.math.Long.fromString(str.substring(1),radix).negate()}else if(str.indexOf("-")>=0){throw Error('number format error: interior "-" character: '+str)}var radixToPower=goog.math.Long.fromNumber(Math.pow(radix,8));var result=goog.math.Long.ZERO;for(var i=0;i<str.length;i+=8){var size=Math.min(8,str.length-i);var value=parseInt(str.substring(i,i+size),radix);if(size<8){var power=goog.math.Long.fromNumber(Math.pow(radix,size));result=result.multiply(power).add(goog.math.Long.fromNumber(value))}else{result=result.multiply(radixToPower);result=result.add(goog.math.Long.fromNumber(value))}}return result});goog.math.Long.TWO_PWR_16_DBL_=1<<16;goog.math.Long.TWO_PWR_24_DBL_=1<<24;goog.math.Long.TWO_PWR_32_DBL_=goog.math.Long.TWO_PWR_16_DBL_*goog.math.Long.TWO_PWR_16_DBL_;goog.math.Long.TWO_PWR_31_DBL_=goog.math.Long.TWO_PWR_32_DBL_/2;goog.math.Long.TWO_PWR_48_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_16_DBL_;goog.math.Long.TWO_PWR_64_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_32_DBL_;goog.math.Long.TWO_PWR_63_DBL_=goog.math.Long.TWO_PWR_64_DBL_/2;goog.math.Long.ZERO=goog.math.Long.fromInt(0);goog.math.Long.ONE=goog.math.Long.fromInt(1);goog.math.Long.NEG_ONE=goog.math.Long.fromInt(-1);goog.math.Long.MAX_VALUE=goog.math.Long.fromBits(4294967295|0,2147483647|0);goog.math.Long.MIN_VALUE=goog.math.Long.fromBits(0,2147483648|0);goog.math.Long.TWO_PWR_24_=goog.math.Long.fromInt(1<<24);goog.math.Long.prototype.toInt=(function(){return this.low_});goog.math.Long.prototype.toNumber=(function(){return this.high_*goog.math.Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()});goog.math.Long.prototype.toString=(function(opt_radix){var radix=opt_radix||10;if(radix<2||36<radix){throw Error("radix out of range: "+radix)}if(this.isZero()){return"0"}if(this.isNegative()){if(this.equals(goog.math.Long.MIN_VALUE)){var radixLong=goog.math.Long.fromNumber(radix);var div=this.div(radixLong);var rem=div.multiply(radixLong).subtract(this);return div.toString(radix)+rem.toInt().toString(radix)}else{return"-"+this.negate().toString(radix)}}var radixToPower=goog.math.Long.fromNumber(Math.pow(radix,6));var rem=this;var result="";while(true){var remDiv=rem.div(radixToPower);var intval=rem.subtract(remDiv.multiply(radixToPower)).toInt();var digits=intval.toString(radix);rem=remDiv;if(rem.isZero()){return digits+result}else{while(digits.length<6){digits="0"+digits}result=""+digits+result}}});goog.math.Long.prototype.getHighBits=(function(){return this.high_});goog.math.Long.prototype.getLowBits=(function(){return this.low_});goog.math.Long.prototype.getLowBitsUnsigned=(function(){return this.low_>=0?this.low_:goog.math.Long.TWO_PWR_32_DBL_+this.low_});goog.math.Long.prototype.getNumBitsAbs=(function(){if(this.isNegative()){if(this.equals(goog.math.Long.MIN_VALUE)){return 64}else{return this.negate().getNumBitsAbs()}}else{var val=this.high_!=0?this.high_:this.low_;for(var bit=31;bit>0;bit--){if((val&1<<bit)!=0){break}}return this.high_!=0?bit+33:bit+1}});goog.math.Long.prototype.isZero=(function(){return this.high_==0&&this.low_==0});goog.math.Long.prototype.isNegative=(function(){return this.high_<0});goog.math.Long.prototype.isOdd=(function(){return(this.low_&1)==1});goog.math.Long.prototype.equals=(function(other){return this.high_==other.high_&&this.low_==other.low_});goog.math.Long.prototype.notEquals=(function(other){return this.high_!=other.high_||this.low_!=other.low_});goog.math.Long.prototype.lessThan=(function(other){return this.compare(other)<0});goog.math.Long.prototype.lessThanOrEqual=(function(other){return this.compare(other)<=0});goog.math.Long.prototype.greaterThan=(function(other){return this.compare(other)>0});goog.math.Long.prototype.greaterThanOrEqual=(function(other){return this.compare(other)>=0});goog.math.Long.prototype.compare=(function(other){if(this.equals(other)){return 0}var thisNeg=this.isNegative();var otherNeg=other.isNegative();if(thisNeg&&!otherNeg){return-1}if(!thisNeg&&otherNeg){return 1}if(this.subtract(other).isNegative()){return-1}else{return 1}});goog.math.Long.prototype.negate=(function(){if(this.equals(goog.math.Long.MIN_VALUE)){return goog.math.Long.MIN_VALUE}else{return this.not().add(goog.math.Long.ONE)}});goog.math.Long.prototype.add=(function(other){var a48=this.high_>>>16;var a32=this.high_&65535;var a16=this.low_>>>16;var a00=this.low_&65535;var b48=other.high_>>>16;var b32=other.high_&65535;var b16=other.low_>>>16;var b00=other.low_&65535;var c48=0,c32=0,c16=0,c00=0;c00+=a00+b00;c16+=c00>>>16;c00&=65535;c16+=a16+b16;c32+=c16>>>16;c16&=65535;c32+=a32+b32;c48+=c32>>>16;c32&=65535;c48+=a48+b48;c48&=65535;return goog.math.Long.fromBits(c16<<16|c00,c48<<16|c32)});goog.math.Long.prototype.subtract=(function(other){return this.add(other.negate())});goog.math.Long.prototype.multiply=(function(other){if(this.isZero()){return goog.math.Long.ZERO}else if(other.isZero()){return goog.math.Long.ZERO}if(this.equals(goog.math.Long.MIN_VALUE)){return other.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO}else if(other.equals(goog.math.Long.MIN_VALUE)){return this.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO}if(this.isNegative()){if(other.isNegative()){return this.negate().multiply(other.negate())}else{return this.negate().multiply(other).negate()}}else if(other.isNegative()){return this.multiply(other.negate()).negate()}if(this.lessThan(goog.math.Long.TWO_PWR_24_)&&other.lessThan(goog.math.Long.TWO_PWR_24_)){return goog.math.Long.fromNumber(this.toNumber()*other.toNumber())}var a48=this.high_>>>16;var a32=this.high_&65535;var a16=this.low_>>>16;var a00=this.low_&65535;var b48=other.high_>>>16;var b32=other.high_&65535;var b16=other.low_>>>16;var b00=other.low_&65535;var c48=0,c32=0,c16=0,c00=0;c00+=a00*b00;c16+=c00>>>16;c00&=65535;c16+=a16*b00;c32+=c16>>>16;c16&=65535;c16+=a00*b16;c32+=c16>>>16;c16&=65535;c32+=a32*b00;c48+=c32>>>16;c32&=65535;c32+=a16*b16;c48+=c32>>>16;c32&=65535;c32+=a00*b32;c48+=c32>>>16;c32&=65535;c48+=a48*b00+a32*b16+a16*b32+a00*b48;c48&=65535;return goog.math.Long.fromBits(c16<<16|c00,c48<<16|c32)});goog.math.Long.prototype.div=(function(other){if(other.isZero()){throw Error("division by zero")}else if(this.isZero()){return goog.math.Long.ZERO}if(this.equals(goog.math.Long.MIN_VALUE)){if(other.equals(goog.math.Long.ONE)||other.equals(goog.math.Long.NEG_ONE)){return goog.math.Long.MIN_VALUE}else if(other.equals(goog.math.Long.MIN_VALUE)){return goog.math.Long.ONE}else{var halfThis=this.shiftRight(1);var approx=halfThis.div(other).shiftLeft(1);if(approx.equals(goog.math.Long.ZERO)){return other.isNegative()?goog.math.Long.ONE:goog.math.Long.NEG_ONE}else{var rem=this.subtract(other.multiply(approx));var result=approx.add(rem.div(other));return result}}}else if(other.equals(goog.math.Long.MIN_VALUE)){return goog.math.Long.ZERO}if(this.isNegative()){if(other.isNegative()){return this.negate().div(other.negate())}else{return this.negate().div(other).negate()}}else if(other.isNegative()){return this.div(other.negate()).negate()}var res=goog.math.Long.ZERO;var rem=this;while(rem.greaterThanOrEqual(other)){var approx=Math.max(1,Math.floor(rem.toNumber()/other.toNumber()));var log2=Math.ceil(Math.log(approx)/Math.LN2);var delta=log2<=48?1:Math.pow(2,log2-48);var approxRes=goog.math.Long.fromNumber(approx);var approxRem=approxRes.multiply(other);while(approxRem.isNegative()||approxRem.greaterThan(rem)){approx-=delta;approxRes=goog.math.Long.fromNumber(approx);approxRem=approxRes.multiply(other)}if(approxRes.isZero()){approxRes=goog.math.Long.ONE}res=res.add(approxRes);rem=rem.subtract(approxRem)}return res});goog.math.Long.prototype.modulo=(function(other){return this.subtract(this.div(other).multiply(other))});goog.math.Long.prototype.not=(function(){return goog.math.Long.fromBits(~this.low_,~this.high_)});goog.math.Long.prototype.and=(function(other){return goog.math.Long.fromBits(this.low_&other.low_,this.high_&other.high_)});goog.math.Long.prototype.or=(function(other){return goog.math.Long.fromBits(this.low_|other.low_,this.high_|other.high_)});goog.math.Long.prototype.xor=(function(other){return goog.math.Long.fromBits(this.low_^other.low_,this.high_^other.high_)});goog.math.Long.prototype.shiftLeft=(function(numBits){numBits&=63;if(numBits==0){return this}else{var low=this.low_;if(numBits<32){var high=this.high_;return goog.math.Long.fromBits(low<<numBits,high<<numBits|low>>>32-numBits)}else{return goog.math.Long.fromBits(0,low<<numBits-32)}}});goog.math.Long.prototype.shiftRight=(function(numBits){numBits&=63;if(numBits==0){return this}else{var high=this.high_;if(numBits<32){var low=this.low_;return goog.math.Long.fromBits(low>>>numBits|high<<32-numBits,high>>numBits)}else{return goog.math.Long.fromBits(high>>numBits-32,high>=0?0:-1)}}});goog.math.Long.prototype.shiftRightUnsigned=(function(numBits){numBits&=63;if(numBits==0){return this}else{var high=this.high_;if(numBits<32){var low=this.low_;return goog.math.Long.fromBits(low>>>numBits|high<<32-numBits,high>>>numBits)}else if(numBits==32){return goog.math.Long.fromBits(high,0)}else{return goog.math.Long.fromBits(high>>>numBits-32,0)}}});var navigator={appName:"Modern Browser"};var dbits;var canary=0xdeadbeefcafe;var j_lm=(canary&16777215)==15715070;function BigInteger(a,b,c){if(a!=null)if("number"==typeof a)this.fromNumber(a,b,c);else if(b==null&&"string"!=typeof a)this.fromString(a,256);else this.fromString(a,b)}function nbi(){return new BigInteger(null)}function am1(i,x,w,j,c,n){while(--n>=0){var v=x*this[i++]+w[j]+c;c=Math.floor(v/67108864);w[j++]=v&67108863}return c}function am2(i,x,w,j,c,n){var xl=x&32767,xh=x>>15;while(--n>=0){var l=this[i]&32767;var h=this[i++]>>15;var m=xh*l+h*xl;l=xl*l+((m&32767)<<15)+w[j]+(c&1073741823);c=(l>>>30)+(m>>>15)+xh*h+(c>>>30);w[j++]=l&1073741823}return c}function am3(i,x,w,j,c,n){var xl=x&16383,xh=x>>14;while(--n>=0){var l=this[i]&16383;var h=this[i++]>>14;var m=xh*l+h*xl;l=xl*l+((m&16383)<<14)+w[j]+c;c=(l>>28)+(m>>14)+xh*h;w[j++]=l&268435455}return c}if(j_lm&&navigator.appName=="Microsoft Internet Explorer"){BigInteger.prototype.am=am2;dbits=30}else if(j_lm&&navigator.appName!="Netscape"){BigInteger.prototype.am=am1;dbits=26}else{BigInteger.prototype.am=am3;dbits=28}BigInteger.prototype.DB=dbits;BigInteger.prototype.DM=(1<<dbits)-1;BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP);BigInteger.prototype.F1=BI_FP-dbits;BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz";var BI_RC=new Array;var rr,vv;rr="0".charCodeAt(0);for(vv=0;vv<=9;++vv)BI_RC[rr++]=vv;rr="a".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;rr="A".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;function int2char(n){return BI_RM.charAt(n)}function intAt(s,i){var c=BI_RC[s.charCodeAt(i)];return c==null?-1:c}function bnpCopyTo(r){for(var i=this.t-1;i>=0;--i)r[i]=this[i];r.t=this.t;r.s=this.s}function bnpFromInt(x){this.t=1;this.s=x<0?-1:0;if(x>0)this[0]=x;else if(x<-1)this[0]=x+DV;else this.t=0}function nbv(i){var r=nbi();r.fromInt(i);return r}function bnpFromString(s,b){var k;if(b==16)k=4;else if(b==8)k=3;else if(b==256)k=8;else if(b==2)k=1;else if(b==32)k=5;else if(b==4)k=2;else{this.fromRadix(s,b);return}this.t=0;this.s=0;var i=s.length,mi=false,sh=0;while(--i>=0){var x=k==8?s[i]&255:intAt(s,i);if(x<0){if(s.charAt(i)=="-")mi=true;continue}mi=false;if(sh==0)this[this.t++]=x;else if(sh+k>this.DB){this[this.t-1]|=(x&(1<<this.DB-sh)-1)<<sh;this[this.t++]=x>>this.DB-sh}else this[this.t-1]|=x<<sh;sh+=k;if(sh>=this.DB)sh-=this.DB}if(k==8&&(s[0]&128)!=0){this.s=-1;if(sh>0)this[this.t-1]|=(1<<this.DB-sh)-1<<sh}this.clamp();if(mi)BigInteger.ZERO.subTo(this,this)}function bnpClamp(){var c=this.s&this.DM;while(this.t>0&&this[this.t-1]==c)--this.t}function bnToString(b){if(this.s<0)return"-"+this.negate().toString(b);var k;if(b==16)k=4;else if(b==8)k=3;else if(b==2)k=1;else if(b==32)k=5;else if(b==4)k=2;else return this.toRadix(b);var km=(1<<k)-1,d,m=false,r="",i=this.t;var p=this.DB-i*this.DB%k;if(i-->0){if(p<this.DB&&(d=this[i]>>p)>0){m=true;r=int2char(d)}while(i>=0){if(p<k){d=(this[i]&(1<<p)-1)<<k-p;d|=this[--i]>>(p+=this.DB-k)}else{d=this[i]>>(p-=k)&km;if(p<=0){p+=this.DB;--i}}if(d>0)m=true;if(m)r+=int2char(d)}}return m?r:"0"}function bnNegate(){var r=nbi();BigInteger.ZERO.subTo(this,r);return r}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(a){var r=this.s-a.s;if(r!=0)return r;var i=this.t;r=i-a.t;if(r!=0)return this.s<0?-r:r;while(--i>=0)if((r=this[i]-a[i])!=0)return r;return 0}function nbits(x){var r=1,t;if((t=x>>>16)!=0){x=t;r+=16}if((t=x>>8)!=0){x=t;r+=8}if((t=x>>4)!=0){x=t;r+=4}if((t=x>>2)!=0){x=t;r+=2}if((t=x>>1)!=0){x=t;r+=1}return r}function bnBitLength(){if(this.t<=0)return 0;return this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(n,r){var i;for(i=this.t-1;i>=0;--i)r[i+n]=this[i];for(i=n-1;i>=0;--i)r[i]=0;r.t=this.t+n;r.s=this.s}function bnpDRShiftTo(n,r){for(var i=n;i<this.t;++i)r[i-n]=this[i];r.t=Math.max(this.t-n,0);r.s=this.s}function bnpLShiftTo(n,r){var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<cbs)-1;var ds=Math.floor(n/this.DB),c=this.s<<bs&this.DM,i;for(i=this.t-1;i>=0;--i){r[i+ds+1]=this[i]>>cbs|c;c=(this[i]&bm)<<bs}for(i=ds-1;i>=0;--i)r[i]=0;r[ds]=c;r.t=this.t+ds+1;r.s=this.s;r.clamp()}function bnpRShiftTo(n,r){r.s=this.s;var ds=Math.floor(n/this.DB);if(ds>=this.t){r.t=0;return}var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<bs)-1;r[0]=this[ds]>>bs;for(var i=ds+1;i<this.t;++i){r[i-ds-1]|=(this[i]&bm)<<cbs;r[i-ds]=this[i]>>bs}if(bs>0)r[this.t-ds-1]|=(this.s&bm)<<cbs;r.t=this.t-ds;r.clamp()}function bnpSubTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]-a[i];r[i++]=c&this.DM;c>>=this.DB}if(a.t<this.t){c-=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB}c+=this.s}else{c+=this.s;while(i<a.t){c-=a[i];r[i++]=c&this.DM;c>>=this.DB}c-=a.s}r.s=c<0?-1:0;if(c<-1)r[i++]=this.DV+c;else if(c>0)r[i++]=c;r.t=i;r.clamp()}function bnpMultiplyTo(a,r){var x=this.abs(),y=a.abs();var i=x.t;r.t=i+y.t;while(--i>=0)r[i]=0;for(i=0;i<y.t;++i)r[i+x.t]=x.am(0,y[i],r,i,0,x.t);r.s=0;r.clamp();if(this.s!=a.s)BigInteger.ZERO.subTo(r,r)}function bnpSquareTo(r){var x=this.abs();var i=r.t=2*x.t;while(--i>=0)r[i]=0;for(i=0;i<x.t-1;++i){var c=x.am(i,x[i],r,2*i,0,1);if((r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1))>=x.DV){r[i+x.t]-=x.DV;r[i+x.t+1]=1}}if(r.t>0)r[r.t-1]+=x.am(i,x[i],r,2*i,0,1);r.s=0;r.clamp()}function bnpDivRemTo(m,q,r){var pm=m.abs();if(pm.t<=0)return;var pt=this.abs();if(pt.t<pm.t){if(q!=null)q.fromInt(0);if(r!=null)this.copyTo(r);return}if(r==null)r=nbi();var y=nbi(),ts=this.s,ms=m.s;var nsh=this.DB-nbits(pm[pm.t-1]);if(nsh>0){pm.lShiftTo(nsh,y);pt.lShiftTo(nsh,r)}else{pm.copyTo(y);pt.copyTo(r)}var ys=y.t;var y0=y[ys-1];if(y0==0)return;var yt=y0*(1<<this.F1)+(ys>1?y[ys-2]>>this.F2:0);var d1=this.FV/yt,d2=(1<<this.F1)/yt,e=1<<this.F2;var i=r.t,j=i-ys,t=q==null?nbi():q;y.dlShiftTo(j,t);if(r.compareTo(t)>=0){r[r.t++]=1;r.subTo(t,r)}BigInteger.ONE.dlShiftTo(ys,t);t.subTo(y,y);while(y.t<ys)y[y.t++]=0;while(--j>=0){var qd=r[--i]==y0?this.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);if((r[i]+=y.am(0,qd,r,j,0,ys))<qd){y.dlShiftTo(j,t);r.subTo(t,r);while(r[i]<--qd)r.subTo(t,r)}}if(q!=null){r.drShiftTo(ys,q);if(ts!=ms)BigInteger.ZERO.subTo(q,q)}r.t=ys;r.clamp();if(nsh>0)r.rShiftTo(nsh,r);if(ts<0)BigInteger.ZERO.subTo(r,r)}function bnMod(a){var r=nbi();this.abs().divRemTo(a,null,r);if(this.s<0&&r.compareTo(BigInteger.ZERO)>0)a.subTo(r,r);return r}function Classic(m){this.m=m}function cConvert(x){if(x.s<0||x.compareTo(this.m)>=0)return x.mod(this.m);else return x}function cRevert(x){return x}function cReduce(x){x.divRemTo(this.m,null,x)}function cMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}function cSqrTo(x,r){x.squareTo(r);this.reduce(r)}Classic.prototype.convert=cConvert;Classic.prototype.revert=cRevert;Classic.prototype.reduce=cReduce;Classic.prototype.mulTo=cMulTo;Classic.prototype.sqrTo=cSqrTo;function bnpInvDigit(){if(this.t<1)return 0;var x=this[0];if((x&1)==0)return 0;var y=x&3;y=y*(2-(x&15)*y)&15;y=y*(2-(x&255)*y)&255;y=y*(2-((x&65535)*y&65535))&65535;y=y*(2-x*y%this.DV)%this.DV;return y>0?this.DV-y:-y}function Montgomery(m){this.m=m;this.mp=m.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<m.DB-15)-1;this.mt2=2*m.t}function montConvert(x){var r=nbi();x.abs().dlShiftTo(this.m.t,r);r.divRemTo(this.m,null,r);if(x.s<0&&r.compareTo(BigInteger.ZERO)>0)this.m.subTo(r,r);return r}function montRevert(x){var r=nbi();x.copyTo(r);this.reduce(r);return r}function montReduce(x){while(x.t<=this.mt2)x[x.t++]=0;for(var i=0;i<this.m.t;++i){var j=x[i]&32767;var u0=j*this.mpl+((j*this.mph+(x[i]>>15)*this.mpl&this.um)<<15)&x.DM;j=i+this.m.t;x[j]+=this.m.am(0,u0,x,i,0,this.m.t);while(x[j]>=x.DV){x[j]-=x.DV;x[++j]++}}x.clamp();x.drShiftTo(this.m.t,x);if(x.compareTo(this.m)>=0)x.subTo(this.m,x)}function montSqrTo(x,r){x.squareTo(r);this.reduce(r)}function montMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}Montgomery.prototype.convert=montConvert;Montgomery.prototype.revert=montRevert;Montgomery.prototype.reduce=montReduce;Montgomery.prototype.mulTo=montMulTo;Montgomery.prototype.sqrTo=montSqrTo;function bnpIsEven(){return(this.t>0?this[0]&1:this.s)==0}function bnpExp(e,z){if(e>4294967295||e<1)return BigInteger.ONE;var r=nbi(),r2=nbi(),g=z.convert(this),i=nbits(e)-1;g.copyTo(r);while(--i>=0){z.sqrTo(r,r2);if((e&1<<i)>0)z.mulTo(r2,g,r);else{var t=r;r=r2;r2=t}}return z.revert(r)}function bnModPowInt(e,m){var z;if(e<256||m.isEven())z=new Classic(m);else z=new Montgomery(m);return this.exp(e,z)}BigInteger.prototype.copyTo=bnpCopyTo;BigInteger.prototype.fromInt=bnpFromInt;BigInteger.prototype.fromString=bnpFromString;BigInteger.prototype.clamp=bnpClamp;BigInteger.prototype.dlShiftTo=bnpDLShiftTo;BigInteger.prototype.drShiftTo=bnpDRShiftTo;BigInteger.prototype.lShiftTo=bnpLShiftTo;BigInteger.prototype.rShiftTo=bnpRShiftTo;BigInteger.prototype.subTo=bnpSubTo;BigInteger.prototype.multiplyTo=bnpMultiplyTo;BigInteger.prototype.squareTo=bnpSquareTo;BigInteger.prototype.divRemTo=bnpDivRemTo;BigInteger.prototype.invDigit=bnpInvDigit;BigInteger.prototype.isEven=bnpIsEven;BigInteger.prototype.exp=bnpExp;BigInteger.prototype.toString=bnToString;BigInteger.prototype.negate=bnNegate;BigInteger.prototype.abs=bnAbs;BigInteger.prototype.compareTo=bnCompareTo;BigInteger.prototype.bitLength=bnBitLength;BigInteger.prototype.mod=bnMod;BigInteger.prototype.modPowInt=bnModPowInt;BigInteger.ZERO=nbv(0);BigInteger.ONE=nbv(1);function bnpFromRadix(s,b){this.fromInt(0);if(b==null)b=10;var cs=this.chunkSize(b);var d=Math.pow(b,cs),mi=false,j=0,w=0;for(var i=0;i<s.length;++i){var x=intAt(s,i);if(x<0){if(s.charAt(i)=="-"&&this.signum()==0)mi=true;continue}w=b*w+x;if(++j>=cs){this.dMultiply(d);this.dAddOffset(w,0);j=0;w=0}}if(j>0){this.dMultiply(Math.pow(b,j));this.dAddOffset(w,0)}if(mi)BigInteger.ZERO.subTo(this,this)}function bnpChunkSize(r){return Math.floor(Math.LN2*this.DB/Math.log(r))}function bnSigNum(){if(this.s<0)return-1;else if(this.t<=0||this.t==1&&this[0]<=0)return 0;else return 1}function bnpDMultiply(n){this[this.t]=this.am(0,n-1,this,0,0,this.t);++this.t;this.clamp()}function bnpDAddOffset(n,w){if(n==0)return;while(this.t<=w)this[this.t++]=0;this[w]+=n;while(this[w]>=this.DV){this[w]-=this.DV;if(++w>=this.t)this[this.t++]=0;++this[w]}}function bnpToRadix(b){if(b==null)b=10;if(this.signum()==0||b<2||b>36)return"0";var cs=this.chunkSize(b);var a=Math.pow(b,cs);var d=nbv(a),y=nbi(),z=nbi(),r="";this.divRemTo(d,y,z);while(y.signum()>0){r=(a+z.intValue()).toString(b).substr(1)+r;y.divRemTo(d,y,z)}return z.intValue().toString(b)+r}function bnIntValue(){if(this.s<0){if(this.t==1)return this[0]-this.DV;else if(this.t==0)return-1}else if(this.t==1)return this[0];else if(this.t==0)return 0;return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnpAddTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]+a[i];r[i++]=c&this.DM;c>>=this.DB}if(a.t<this.t){c+=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB}c+=this.s}else{c+=this.s;while(i<a.t){c+=a[i];r[i++]=c&this.DM;c>>=this.DB}c+=a.s}r.s=c<0?-1:0;if(c>0)r[i++]=c;else if(c<-1)r[i++]=this.DV+c;r.t=i;r.clamp()}BigInteger.prototype.fromRadix=bnpFromRadix;BigInteger.prototype.chunkSize=bnpChunkSize;BigInteger.prototype.signum=bnSigNum;BigInteger.prototype.dMultiply=bnpDMultiply;BigInteger.prototype.dAddOffset=bnpDAddOffset;BigInteger.prototype.toRadix=bnpToRadix;BigInteger.prototype.intValue=bnIntValue;BigInteger.prototype.addTo=bnpAddTo;var Wrapper={abs:(function(l,h){var x=new goog.math.Long(l,h);var ret;if(x.isNegative()){ret=x.negate()}else{ret=x}HEAP32[tempDoublePtr>>2]=ret.low_;HEAP32[tempDoublePtr+4>>2]=ret.high_}),ensureTemps:(function(){if(Wrapper.ensuredTemps)return;Wrapper.ensuredTemps=true;Wrapper.two32=new BigInteger;Wrapper.two32.fromString("4294967296",10);Wrapper.two64=new BigInteger;Wrapper.two64.fromString("18446744073709551616",10);Wrapper.temp1=new BigInteger;Wrapper.temp2=new BigInteger}),lh2bignum:(function(l,h){var a=new BigInteger;a.fromString(h.toString(),10);var b=new BigInteger;a.multiplyTo(Wrapper.two32,b);var c=new BigInteger;c.fromString(l.toString(),10);var d=new BigInteger;c.addTo(b,d);return d}),stringify:(function(l,h,unsigned){var ret=(new goog.math.Long(l,h)).toString();if(unsigned&&ret[0]=="-"){Wrapper.ensureTemps();var bignum=new BigInteger;bignum.fromString(ret,10);ret=new BigInteger;Wrapper.two64.addTo(bignum,ret);ret=ret.toString(10)}return ret}),fromString:(function(str,base,min,max,unsigned){Wrapper.ensureTemps();var bignum=new BigInteger;bignum.fromString(str,base);var bigmin=new BigInteger;bigmin.fromString(min,10);var bigmax=new BigInteger;bigmax.fromString(max,10);if(unsigned&&bignum.compareTo(BigInteger.ZERO)<0){var temp=new BigInteger;bignum.addTo(Wrapper.two64,temp);bignum=temp}var error=false;if(bignum.compareTo(bigmin)<0){bignum=bigmin;error=true}else if(bignum.compareTo(bigmax)>0){bignum=bigmax;error=true}var ret=goog.math.Long.fromString(bignum.toString());HEAP32[tempDoublePtr>>2]=ret.low_;HEAP32[tempDoublePtr+4>>2]=ret.high_;if(error)throw"range error"})};return Wrapper})();if(memoryInitializer){if(typeof Module["locateFile"]==="function"){memoryInitializer=Module["locateFile"](memoryInitializer)}else if(Module["memoryInitializerPrefixURL"]){memoryInitializer=Module["memoryInitializerPrefixURL"]+memoryInitializer}if(ENVIRONMENT_IS_NODE||ENVIRONMENT_IS_SHELL){var data=Module["readBinary"](memoryInitializer);HEAPU8.set(data,STATIC_BASE)}else{addRunDependency("memory initializer");var applyMemoryInitializer=(function(data){if(data.byteLength)data=new Uint8Array(data);HEAPU8.set(data,STATIC_BASE);removeRunDependency("memory initializer")});var request=Module["memoryInitializerRequest"];if(request){if(request.response){setTimeout((function(){applyMemoryInitializer(request.response)}),0)}else{request.addEventListener("load",(function(){if(request.status!==200&&request.status!==0){console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+request.status)}if(!request.response||typeof request.response!=="object"||!request.response.byteLength){console.warn("a problem seems to have happened with Module.memoryInitializerRequest response (expected ArrayBuffer): "+request.response)}applyMemoryInitializer(request.response)}))}}else{Browser.asyncLoad(memoryInitializer,applyMemoryInitializer,(function(){throw"could not load memory initializer "+memoryInitializer}))}}}function ExitStatus(status){this.name="ExitStatus";this.message="Program terminated with exit("+status+")";this.status=status}ExitStatus.prototype=new Error;ExitStatus.prototype.constructor=ExitStatus;var initialStackTop;var preloadStartTime=null;var calledMain=false;dependenciesFulfilled=function runCaller(){if(!Module["calledRun"])run();if(!Module["calledRun"])dependenciesFulfilled=runCaller};Module["callMain"]=Module.callMain=function callMain(args){assert(runDependencies==0,"cannot call main when async dependencies remain! (listen on __ATMAIN__)");assert(__ATPRERUN__.length==0,"cannot call main when preRun functions remain to be called");args=args||[];ensureInitRuntime();var argc=args.length+1;function pad(){for(var i=0;i<4-1;i++){argv.push(0)}}var argv=[allocate(intArrayFromString(Module["thisProgram"]),"i8",ALLOC_NORMAL)];pad();for(var i=0;i<argc-1;i=i+1){argv.push(allocate(intArrayFromString(args[i]),"i8",ALLOC_NORMAL));pad()}argv.push(0);argv=allocate(argv,"i32",ALLOC_NORMAL);initialStackTop=STACKTOP;try{var ret=Module["_main"](argc,argv,0);exit(ret,true)}catch(e){if(e instanceof ExitStatus){return}else if(e=="SimulateInfiniteLoop"){Module["noExitRuntime"]=true;return}else{if(e&&typeof e==="object"&&e.stack)Module.printErr("exception thrown: "+[e,e.stack]);throw e}}finally{calledMain=true}};function run(args){args=args||Module["arguments"];if(preloadStartTime===null)preloadStartTime=Date.now();if(runDependencies>0){return}preRun();if(runDependencies>0)return;if(Module["calledRun"])return;function doRun(){if(Module["calledRun"])return;Module["calledRun"]=true;if(ABORT)return;ensureInitRuntime();preMain();if(ENVIRONMENT_IS_WEB&&preloadStartTime!==null){Module.printErr("pre-main prep time: "+(Date.now()-preloadStartTime)+" ms")}if(Module["onRuntimeInitialized"])Module["onRuntimeInitialized"]();if(Module["_main"]&&shouldRunNow)Module["callMain"](args);postRun()}if(Module["setStatus"]){Module["setStatus"]("Running...");setTimeout((function(){setTimeout((function(){Module["setStatus"]("")}),1);doRun()}),1)}else{doRun()}}Module["run"]=Module.run=run;function exit(status,implicit){if(implicit&&Module["noExitRuntime"]){return}if(Module["noExitRuntime"]){}else{ABORT=true;EXITSTATUS=status;STACKTOP=initialStackTop;exitRuntime();if(Module["onExit"])Module["onExit"](status)}if(ENVIRONMENT_IS_NODE){process["stdout"]["once"]("drain",(function(){process["exit"](status)}));console.log(" ");setTimeout((function(){process["exit"](status)}),500)}else if(ENVIRONMENT_IS_SHELL&&typeof quit==="function"){quit(status)}throw new ExitStatus(status)}Module["exit"]=Module.exit=exit;var abortDecorators=[];function abort(what){if(what!==undefined){Module.print(what);Module.printErr(what);what=JSON.stringify(what)}else{what=""}ABORT=true;EXITSTATUS=1;var extra="\nIf this abort() is unexpected, build with -s ASSERTIONS=1 which can give more information.";var output="abort("+what+") at "+stackTrace()+extra;if(abortDecorators){abortDecorators.forEach((function(decorator){output=decorator(output,what)}))}throw output}Module["abort"]=Module.abort=abort;if(Module["preInit"]){if(typeof Module["preInit"]=="function")Module["preInit"]=[Module["preInit"]];while(Module["preInit"].length>0){Module["preInit"].pop()()}}var shouldRunNow=true;if(Module["noInitialRun"]){shouldRunNow=false}Module["noExitRuntime"]=true;run();function WrapperObject(){}WrapperObject.prototype=Object.create(WrapperObject.prototype);WrapperObject.prototype.constructor=WrapperObject;WrapperObject.prototype.__class__=WrapperObject;WrapperObject.__cache__={};Module["WrapperObject"]=WrapperObject;function getCache(__class__){return(__class__||WrapperObject).__cache__}Module["getCache"]=getCache;function wrapPointer(ptr,__class__){var cache=getCache(__class__);var ret=cache[ptr];if(ret)return ret;ret=Object.create((__class__||WrapperObject).prototype);ret.ptr=ptr;return cache[ptr]=ret}Module["wrapPointer"]=wrapPointer;function castObject(obj,__class__){return wrapPointer(obj.ptr,__class__)}Module["castObject"]=castObject;Module["NULL"]=wrapPointer(0);function destroy(obj){if(!obj["__destroy__"])throw"Error: Cannot destroy object. (Did you create it yourself?)";obj["__destroy__"]();delete getCache(obj.__class__)[obj.ptr]}Module["destroy"]=destroy;function compare(obj1,obj2){return obj1.ptr===obj2.ptr}Module["compare"]=compare;function getPointer(obj){return obj.ptr}Module["getPointer"]=getPointer;function getClass(obj){return obj.__class__}Module["getClass"]=getClass;var ensureString=(function(){var stringCache={};function ensureString(value){if(typeof value=="string"){var cachedVal=stringCache[value];if(cachedVal)return cachedVal;var ret=allocate(intArrayFromString(value),"i8",ALLOC_STACK);stringCache[value]=ret;return ret}return value}return ensureString})();function btMatrix3x3(){throw"cannot construct a btMatrix3x3, no constructor in IDL"}btMatrix3x3.prototype=Object.create(WrapperObject.prototype);btMatrix3x3.prototype.constructor=btMatrix3x3;btMatrix3x3.prototype.__class__=btMatrix3x3;btMatrix3x3.__cache__={};Module["btMatrix3x3"]=btMatrix3x3;btMatrix3x3.prototype["setEulerZYX"]=btMatrix3x3.prototype.setEulerZYX=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btMatrix3x3_setEulerZYX_3(self,arg0,arg1,arg2)});btMatrix3x3.prototype["getRotation"]=btMatrix3x3.prototype.getRotation=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btMatrix3x3_getRotation_1(self,arg0)});btMatrix3x3.prototype["__destroy__"]=btMatrix3x3.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btMatrix3x3___destroy___0(self)});function ConcreteContactResultCallback(){this.ptr=_emscripten_bind_ConcreteContactResultCallback_ConcreteContactResultCallback_0();getCache(ConcreteContactResultCallback)[this.ptr]=this}ConcreteContactResultCallback.prototype=Object.create(ContactResultCallback.prototype);ConcreteContactResultCallback.prototype.constructor=ConcreteContactResultCallback;ConcreteContactResultCallback.prototype.__class__=ConcreteContactResultCallback;ConcreteContactResultCallback.__cache__={};Module["ConcreteContactResultCallback"]=ConcreteContactResultCallback;ConcreteContactResultCallback.prototype["addSingleResult"]=ConcreteContactResultCallback.prototype.addSingleResult=(function(arg0,arg1,arg2,arg3,arg4,arg5,arg6){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);if(arg5&&typeof arg5==="object")arg5=arg5.ptr;else arg5=ensureString(arg5);if(arg6&&typeof arg6==="object")arg6=arg6.ptr;else arg6=ensureString(arg6);return _emscripten_bind_ConcreteContactResultCallback_addSingleResult_7(self,arg0,arg1,arg2,arg3,arg4,arg5,arg6)});ConcreteContactResultCallback.prototype["__destroy__"]=ConcreteContactResultCallback.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_ConcreteContactResultCallback___destroy___0(self)});function btBvhTriangleMeshShape(arg0,arg1,arg2){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg2===undefined){this.ptr=_emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_2(arg0,arg1);getCache(btBvhTriangleMeshShape)[this.ptr]=this;return}this.ptr=_emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_3(arg0,arg1,arg2);getCache(btBvhTriangleMeshShape)[this.ptr]=this}btBvhTriangleMeshShape.prototype=Object.create(btTriangleMeshShape.prototype);btBvhTriangleMeshShape.prototype.constructor=btBvhTriangleMeshShape;btBvhTriangleMeshShape.prototype.__class__=btBvhTriangleMeshShape;btBvhTriangleMeshShape.__cache__={};Module["btBvhTriangleMeshShape"]=btBvhTriangleMeshShape;btBvhTriangleMeshShape.prototype["setLocalScaling"]=btBvhTriangleMeshShape.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btBvhTriangleMeshShape_setLocalScaling_1(self,arg0)});btBvhTriangleMeshShape.prototype["calculateLocalInertia"]=btBvhTriangleMeshShape.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btBvhTriangleMeshShape_calculateLocalInertia_2(self,arg0,arg1)});btBvhTriangleMeshShape.prototype["__destroy__"]=btBvhTriangleMeshShape.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btBvhTriangleMeshShape___destroy___0(self)});function btDbvtBroadphase(){this.ptr=_emscripten_bind_btDbvtBroadphase_btDbvtBroadphase_0();getCache(btDbvtBroadphase)[this.ptr]=this}btDbvtBroadphase.prototype=Object.create(WrapperObject.prototype);btDbvtBroadphase.prototype.constructor=btDbvtBroadphase;btDbvtBroadphase.prototype.__class__=btDbvtBroadphase;btDbvtBroadphase.__cache__={};Module["btDbvtBroadphase"]=btDbvtBroadphase;btDbvtBroadphase.prototype["__destroy__"]=btDbvtBroadphase.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btDbvtBroadphase___destroy___0(self)});function VoidPtr(){throw"cannot construct a VoidPtr, no constructor in IDL"}VoidPtr.prototype=Object.create(WrapperObject.prototype);VoidPtr.prototype.constructor=VoidPtr;VoidPtr.prototype.__class__=VoidPtr;VoidPtr.__cache__={};Module["VoidPtr"]=VoidPtr;VoidPtr.prototype["__destroy__"]=VoidPtr.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_VoidPtr___destroy___0(self)});function btSequentialImpulseConstraintSolver(){this.ptr=_emscripten_bind_btSequentialImpulseConstraintSolver_btSequentialImpulseConstraintSolver_0();getCache(btSequentialImpulseConstraintSolver)[this.ptr]=this}btSequentialImpulseConstraintSolver.prototype=Object.create(WrapperObject.prototype);btSequentialImpulseConstraintSolver.prototype.constructor=btSequentialImpulseConstraintSolver;btSequentialImpulseConstraintSolver.prototype.__class__=btSequentialImpulseConstraintSolver;btSequentialImpulseConstraintSolver.__cache__={};Module["btSequentialImpulseConstraintSolver"]=btSequentialImpulseConstraintSolver;btSequentialImpulseConstraintSolver.prototype["__destroy__"]=btSequentialImpulseConstraintSolver.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btSequentialImpulseConstraintSolver___destroy___0(self)});function btDispatcherInfo(){throw"cannot construct a btDispatcherInfo, no constructor in IDL"}btDispatcherInfo.prototype=Object.create(WrapperObject.prototype);btDispatcherInfo.prototype.constructor=btDispatcherInfo;btDispatcherInfo.prototype.__class__=btDispatcherInfo;btDispatcherInfo.__cache__={};Module["btDispatcherInfo"]=btDispatcherInfo;btDispatcherInfo.prototype["get_m_timeStep"]=btDispatcherInfo.prototype.get_m_timeStep=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_timeStep_0(self)});btDispatcherInfo.prototype["set_m_timeStep"]=btDispatcherInfo.prototype.set_m_timeStep=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_timeStep_1(self,arg0)});btDispatcherInfo.prototype["get_m_stepCount"]=btDispatcherInfo.prototype.get_m_stepCount=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_stepCount_0(self)});btDispatcherInfo.prototype["set_m_stepCount"]=btDispatcherInfo.prototype.set_m_stepCount=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_stepCount_1(self,arg0)});btDispatcherInfo.prototype["get_m_dispatchFunc"]=btDispatcherInfo.prototype.get_m_dispatchFunc=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_dispatchFunc_0(self)});btDispatcherInfo.prototype["set_m_dispatchFunc"]=btDispatcherInfo.prototype.set_m_dispatchFunc=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_dispatchFunc_1(self,arg0)});btDispatcherInfo.prototype["get_m_timeOfImpact"]=btDispatcherInfo.prototype.get_m_timeOfImpact=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_timeOfImpact_0(self)});btDispatcherInfo.prototype["set_m_timeOfImpact"]=btDispatcherInfo.prototype.set_m_timeOfImpact=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_timeOfImpact_1(self,arg0)});btDispatcherInfo.prototype["get_m_useContinuous"]=btDispatcherInfo.prototype.get_m_useContinuous=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_useContinuous_0(self)});btDispatcherInfo.prototype["set_m_useContinuous"]=btDispatcherInfo.prototype.set_m_useContinuous=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_useContinuous_1(self,arg0)});btDispatcherInfo.prototype["get_m_enableSatConvex"]=btDispatcherInfo.prototype.get_m_enableSatConvex=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_enableSatConvex_0(self)});btDispatcherInfo.prototype["set_m_enableSatConvex"]=btDispatcherInfo.prototype.set_m_enableSatConvex=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_enableSatConvex_1(self,arg0)});btDispatcherInfo.prototype["get_m_enableSPU"]=btDispatcherInfo.prototype.get_m_enableSPU=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_enableSPU_0(self)});btDispatcherInfo.prototype["set_m_enableSPU"]=btDispatcherInfo.prototype.set_m_enableSPU=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_enableSPU_1(self,arg0)});btDispatcherInfo.prototype["get_m_useEpa"]=btDispatcherInfo.prototype.get_m_useEpa=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_useEpa_0(self)});btDispatcherInfo.prototype["set_m_useEpa"]=btDispatcherInfo.prototype.set_m_useEpa=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_useEpa_1(self,arg0)});btDispatcherInfo.prototype["get_m_allowedCcdPenetration"]=btDispatcherInfo.prototype.get_m_allowedCcdPenetration=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_allowedCcdPenetration_0(self)});btDispatcherInfo.prototype["set_m_allowedCcdPenetration"]=btDispatcherInfo.prototype.set_m_allowedCcdPenetration=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_allowedCcdPenetration_1(self,arg0)});btDispatcherInfo.prototype["get_m_useConvexConservativeDistanceUtil"]=btDispatcherInfo.prototype.get_m_useConvexConservativeDistanceUtil=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_useConvexConservativeDistanceUtil_0(self)});btDispatcherInfo.prototype["set_m_useConvexConservativeDistanceUtil"]=btDispatcherInfo.prototype.set_m_useConvexConservativeDistanceUtil=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_useConvexConservativeDistanceUtil_1(self,arg0)});btDispatcherInfo.prototype["get_m_convexConservativeDistanceThreshold"]=btDispatcherInfo.prototype.get_m_convexConservativeDistanceThreshold=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_convexConservativeDistanceThreshold_0(self)});btDispatcherInfo.prototype["set_m_convexConservativeDistanceThreshold"]=btDispatcherInfo.prototype.set_m_convexConservativeDistanceThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_convexConservativeDistanceThreshold_1(self,arg0)});btDispatcherInfo.prototype["__destroy__"]=btDispatcherInfo.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btDispatcherInfo___destroy___0(self)});function btCapsuleShape(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);this.ptr=_emscripten_bind_btCapsuleShape_btCapsuleShape_2(arg0,arg1);getCache(btCapsuleShape)[this.ptr]=this}btCapsuleShape.prototype=Object.create(btCollisionShape.prototype);btCapsuleShape.prototype.constructor=btCapsuleShape;btCapsuleShape.prototype.__class__=btCapsuleShape;btCapsuleShape.__cache__={};Module["btCapsuleShape"]=btCapsuleShape;btCapsuleShape.prototype["setLocalScaling"]=btCapsuleShape.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCapsuleShape_setLocalScaling_1(self,arg0)});btCapsuleShape.prototype["calculateLocalInertia"]=btCapsuleShape.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCapsuleShape_calculateLocalInertia_2(self,arg0,arg1)});btCapsuleShape.prototype["__destroy__"]=btCapsuleShape.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btCapsuleShape___destroy___0(self)});function btCollisionConfiguration(){throw"cannot construct a btCollisionConfiguration, no constructor in IDL"}btCollisionConfiguration.prototype=Object.create(WrapperObject.prototype);btCollisionConfiguration.prototype.constructor=btCollisionConfiguration;btCollisionConfiguration.prototype.__class__=btCollisionConfiguration;btCollisionConfiguration.__cache__={};Module["btCollisionConfiguration"]=btCollisionConfiguration;btCollisionConfiguration.prototype["__destroy__"]=btCollisionConfiguration.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btCollisionConfiguration___destroy___0(self)});function btAxisSweep3(arg0,arg1,arg2,arg3,arg4){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);if(arg2===undefined){this.ptr=_emscripten_bind_btAxisSweep3_btAxisSweep3_2(arg0,arg1);getCache(btAxisSweep3)[this.ptr]=this;return}if(arg3===undefined){this.ptr=_emscripten_bind_btAxisSweep3_btAxisSweep3_3(arg0,arg1,arg2);getCache(btAxisSweep3)[this.ptr]=this;return}if(arg4===undefined){this.ptr=_emscripten_bind_btAxisSweep3_btAxisSweep3_4(arg0,arg1,arg2,arg3);getCache(btAxisSweep3)[this.ptr]=this;return}this.ptr=_emscripten_bind_btAxisSweep3_btAxisSweep3_5(arg0,arg1,arg2,arg3,arg4);getCache(btAxisSweep3)[this.ptr]=this}btAxisSweep3.prototype=Object.create(WrapperObject.prototype);btAxisSweep3.prototype.constructor=btAxisSweep3;btAxisSweep3.prototype.__class__=btAxisSweep3;btAxisSweep3.__cache__={};Module["btAxisSweep3"]=btAxisSweep3;btAxisSweep3.prototype["__destroy__"]=btAxisSweep3.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btAxisSweep3___destroy___0(self)});function btPairCachingGhostObject(){this.ptr=_emscripten_bind_btPairCachingGhostObject_btPairCachingGhostObject_0();getCache(btPairCachingGhostObject)[this.ptr]=this}btPairCachingGhostObject.prototype=Object.create(btGhostObject.prototype);btPairCachingGhostObject.prototype.constructor=btPairCachingGhostObject;btPairCachingGhostObject.prototype.__class__=btPairCachingGhostObject;btPairCachingGhostObject.__cache__={};Module["btPairCachingGhostObject"]=btPairCachingGhostObject;btPairCachingGhostObject.prototype["setAnisotropicFriction"]=btPairCachingGhostObject.prototype.setAnisotropicFriction=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btPairCachingGhostObject_setAnisotropicFriction_2(self,arg0,arg1)});btPairCachingGhostObject.prototype["getCollisionShape"]=btPairCachingGhostObject.prototype.getCollisionShape=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btPairCachingGhostObject_getCollisionShape_0(self),btCollisionShape)});btPairCachingGhostObject.prototype["setContactProcessingThreshold"]=btPairCachingGhostObject.prototype.setContactProcessingThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_setContactProcessingThreshold_1(self,arg0)});btPairCachingGhostObject.prototype["setActivationState"]=btPairCachingGhostObject.prototype.setActivationState=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_setActivationState_1(self,arg0)});btPairCachingGhostObject.prototype["forceActivationState"]=btPairCachingGhostObject.prototype.forceActivationState=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_forceActivationState_1(self,arg0)});btPairCachingGhostObject.prototype["activate"]=btPairCachingGhostObject.prototype.activate=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg0===undefined){_emscripten_bind_btPairCachingGhostObject_activate_0(self);return}_emscripten_bind_btPairCachingGhostObject_activate_1(self,arg0)});btPairCachingGhostObject.prototype["isActive"]=btPairCachingGhostObject.prototype.isActive=(function(){var self=this.ptr;return _emscripten_bind_btPairCachingGhostObject_isActive_0(self)});btPairCachingGhostObject.prototype["isKinematicObject"]=btPairCachingGhostObject.prototype.isKinematicObject=(function(){var self=this.ptr;return _emscripten_bind_btPairCachingGhostObject_isKinematicObject_0(self)});btPairCachingGhostObject.prototype["setRestitution"]=btPairCachingGhostObject.prototype.setRestitution=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_setRestitution_1(self,arg0)});btPairCachingGhostObject.prototype["setFriction"]=btPairCachingGhostObject.prototype.setFriction=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_setFriction_1(self,arg0)});btPairCachingGhostObject.prototype["setRollingFriction"]=btPairCachingGhostObject.prototype.setRollingFriction=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_setRollingFriction_1(self,arg0)});btPairCachingGhostObject.prototype["getWorldTransform"]=btPairCachingGhostObject.prototype.getWorldTransform=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btPairCachingGhostObject_getWorldTransform_0(self),btTransform)});btPairCachingGhostObject.prototype["getCollisionFlags"]=btPairCachingGhostObject.prototype.getCollisionFlags=(function(){var self=this.ptr;return _emscripten_bind_btPairCachingGhostObject_getCollisionFlags_0(self)});btPairCachingGhostObject.prototype["setCollisionFlags"]=btPairCachingGhostObject.prototype.setCollisionFlags=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_setCollisionFlags_1(self,arg0)});btPairCachingGhostObject.prototype["setWorldTransform"]=btPairCachingGhostObject.prototype.setWorldTransform=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_setWorldTransform_1(self,arg0)});btPairCachingGhostObject.prototype["setCollisionShape"]=btPairCachingGhostObject.prototype.setCollisionShape=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_setCollisionShape_1(self,arg0)});btPairCachingGhostObject.prototype["setCcdMotionThreshold"]=btPairCachingGhostObject.prototype.setCcdMotionThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_setCcdMotionThreshold_1(self,arg0)});btPairCachingGhostObject.prototype["setCcdSweptSphereRadius"]=btPairCachingGhostObject.prototype.setCcdSweptSphereRadius=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_setCcdSweptSphereRadius_1(self,arg0)});btPairCachingGhostObject.prototype["getNumOverlappingObjects"]=btPairCachingGhostObject.prototype.getNumOverlappingObjects=(function(){var self=this.ptr;return _emscripten_bind_btPairCachingGhostObject_getNumOverlappingObjects_0(self)});btPairCachingGhostObject.prototype["getOverlappingObject"]=btPairCachingGhostObject.prototype.getOverlappingObject=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btPairCachingGhostObject_getOverlappingObject_1(self,arg0),btCollisionObject)});btPairCachingGhostObject.prototype["__destroy__"]=btPairCachingGhostObject.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btPairCachingGhostObject___destroy___0(self)});function btRigidBodyConstructionInfo(arg0,arg1,arg2,arg3){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg3===undefined){this.ptr=_emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_3(arg0,arg1,arg2);getCache(btRigidBodyConstructionInfo)[this.ptr]=this;return}this.ptr=_emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_4(arg0,arg1,arg2,arg3);getCache(btRigidBodyConstructionInfo)[this.ptr]=this}btRigidBodyConstructionInfo.prototype=Object.create(WrapperObject.prototype);btRigidBodyConstructionInfo.prototype.constructor=btRigidBodyConstructionInfo;btRigidBodyConstructionInfo.prototype.__class__=btRigidBodyConstructionInfo;btRigidBodyConstructionInfo.__cache__={};Module["btRigidBodyConstructionInfo"]=btRigidBodyConstructionInfo;btRigidBodyConstructionInfo.prototype["get_m_linearDamping"]=btRigidBodyConstructionInfo.prototype.get_m_linearDamping=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_linearDamping_0(self)});btRigidBodyConstructionInfo.prototype["set_m_linearDamping"]=btRigidBodyConstructionInfo.prototype.set_m_linearDamping=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_linearDamping_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_angularDamping"]=btRigidBodyConstructionInfo.prototype.get_m_angularDamping=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_angularDamping_0(self)});btRigidBodyConstructionInfo.prototype["set_m_angularDamping"]=btRigidBodyConstructionInfo.prototype.set_m_angularDamping=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_angularDamping_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_friction"]=btRigidBodyConstructionInfo.prototype.get_m_friction=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_friction_0(self)});btRigidBodyConstructionInfo.prototype["set_m_friction"]=btRigidBodyConstructionInfo.prototype.set_m_friction=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_friction_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_rollingFriction"]=btRigidBodyConstructionInfo.prototype.get_m_rollingFriction=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_rollingFriction_0(self)});btRigidBodyConstructionInfo.prototype["set_m_rollingFriction"]=btRigidBodyConstructionInfo.prototype.set_m_rollingFriction=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_rollingFriction_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_restitution"]=btRigidBodyConstructionInfo.prototype.get_m_restitution=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_restitution_0(self)});btRigidBodyConstructionInfo.prototype["set_m_restitution"]=btRigidBodyConstructionInfo.prototype.set_m_restitution=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_restitution_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_linearSleepingThreshold"]=btRigidBodyConstructionInfo.prototype.get_m_linearSleepingThreshold=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_linearSleepingThreshold_0(self)});btRigidBodyConstructionInfo.prototype["set_m_linearSleepingThreshold"]=btRigidBodyConstructionInfo.prototype.set_m_linearSleepingThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_linearSleepingThreshold_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_angularSleepingThreshold"]=btRigidBodyConstructionInfo.prototype.get_m_angularSleepingThreshold=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_angularSleepingThreshold_0(self)});btRigidBodyConstructionInfo.prototype["set_m_angularSleepingThreshold"]=btRigidBodyConstructionInfo.prototype.set_m_angularSleepingThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_angularSleepingThreshold_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_additionalDamping"]=btRigidBodyConstructionInfo.prototype.get_m_additionalDamping=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDamping_0(self)});btRigidBodyConstructionInfo.prototype["set_m_additionalDamping"]=btRigidBodyConstructionInfo.prototype.set_m_additionalDamping=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDamping_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_additionalDampingFactor"]=btRigidBodyConstructionInfo.prototype.get_m_additionalDampingFactor=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDampingFactor_0(self)});btRigidBodyConstructionInfo.prototype["set_m_additionalDampingFactor"]=btRigidBodyConstructionInfo.prototype.set_m_additionalDampingFactor=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDampingFactor_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_additionalLinearDampingThresholdSqr"]=btRigidBodyConstructionInfo.prototype.get_m_additionalLinearDampingThresholdSqr=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalLinearDampingThresholdSqr_0(self)});btRigidBodyConstructionInfo.prototype["set_m_additionalLinearDampingThresholdSqr"]=btRigidBodyConstructionInfo.prototype.set_m_additionalLinearDampingThresholdSqr=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalLinearDampingThresholdSqr_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_additionalAngularDampingThresholdSqr"]=btRigidBodyConstructionInfo.prototype.get_m_additionalAngularDampingThresholdSqr=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingThresholdSqr_0(self)});btRigidBodyConstructionInfo.prototype["set_m_additionalAngularDampingThresholdSqr"]=btRigidBodyConstructionInfo.prototype.set_m_additionalAngularDampingThresholdSqr=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingThresholdSqr_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_additionalAngularDampingFactor"]=btRigidBodyConstructionInfo.prototype.get_m_additionalAngularDampingFactor=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingFactor_0(self)});btRigidBodyConstructionInfo.prototype["set_m_additionalAngularDampingFactor"]=btRigidBodyConstructionInfo.prototype.set_m_additionalAngularDampingFactor=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingFactor_1(self,arg0)});btRigidBodyConstructionInfo.prototype["__destroy__"]=btRigidBodyConstructionInfo.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btRigidBodyConstructionInfo___destroy___0(self)});function btManifoldPoint(){throw"cannot construct a btManifoldPoint, no constructor in IDL"}btManifoldPoint.prototype=Object.create(WrapperObject.prototype);btManifoldPoint.prototype.constructor=btManifoldPoint;btManifoldPoint.prototype.__class__=btManifoldPoint;btManifoldPoint.__cache__={};Module["btManifoldPoint"]=btManifoldPoint;btManifoldPoint.prototype["getPositionWorldOnA"]=btManifoldPoint.prototype.getPositionWorldOnA=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btManifoldPoint_getPositionWorldOnA_0(self),btVector3)});btManifoldPoint.prototype["getPositionWorldOnB"]=btManifoldPoint.prototype.getPositionWorldOnB=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btManifoldPoint_getPositionWorldOnB_0(self),btVector3)});btManifoldPoint.prototype["getDistance"]=btManifoldPoint.prototype.getDistance=(function(){var self=this.ptr;return _emscripten_bind_btManifoldPoint_getDistance_0(self)});btManifoldPoint.prototype["get_m_localPointA"]=btManifoldPoint.prototype.get_m_localPointA=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btManifoldPoint_get_m_localPointA_0(self),btVector3)});btManifoldPoint.prototype["set_m_localPointA"]=btManifoldPoint.prototype.set_m_localPointA=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btManifoldPoint_set_m_localPointA_1(self,arg0)});btManifoldPoint.prototype["get_m_localPointB"]=btManifoldPoint.prototype.get_m_localPointB=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btManifoldPoint_get_m_localPointB_0(self),btVector3)});btManifoldPoint.prototype["set_m_localPointB"]=btManifoldPoint.prototype.set_m_localPointB=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btManifoldPoint_set_m_localPointB_1(self,arg0)});btManifoldPoint.prototype["get_m_positionWorldOnB"]=btManifoldPoint.prototype.get_m_positionWorldOnB=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btManifoldPoint_get_m_positionWorldOnB_0(self),btVector3)});btManifoldPoint.prototype["set_m_positionWorldOnB"]=btManifoldPoint.prototype.set_m_positionWorldOnB=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btManifoldPoint_set_m_positionWorldOnB_1(self,arg0)});btManifoldPoint.prototype["get_m_positionWorldOnA"]=btManifoldPoint.prototype.get_m_positionWorldOnA=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btManifoldPoint_get_m_positionWorldOnA_0(self),btVector3)});btManifoldPoint.prototype["set_m_positionWorldOnA"]=btManifoldPoint.prototype.set_m_positionWorldOnA=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btManifoldPoint_set_m_positionWorldOnA_1(self,arg0)});btManifoldPoint.prototype["get_m_normalWorldOnB"]=btManifoldPoint.prototype.get_m_normalWorldOnB=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btManifoldPoint_get_m_normalWorldOnB_0(self),btVector3)});btManifoldPoint.prototype["set_m_normalWorldOnB"]=btManifoldPoint.prototype.set_m_normalWorldOnB=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btManifoldPoint_set_m_normalWorldOnB_1(self,arg0)});btManifoldPoint.prototype["__destroy__"]=btManifoldPoint.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btManifoldPoint___destroy___0(self)});function btGeneric6DofConstraint(arg0,arg1,arg2,arg3,arg4){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);if(arg3===undefined){this.ptr=_emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_3(arg0,arg1,arg2);getCache(btGeneric6DofConstraint)[this.ptr]=this;return}if(arg4===undefined){this.ptr=_emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_4(arg0,arg1,arg2,arg3);getCache(btGeneric6DofConstraint)[this.ptr]=this;return}this.ptr=_emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_5(arg0,arg1,arg2,arg3,arg4);getCache(btGeneric6DofConstraint)[this.ptr]=this}btGeneric6DofConstraint.prototype=Object.create(btTypedConstraint.prototype);btGeneric6DofConstraint.prototype.constructor=btGeneric6DofConstraint;btGeneric6DofConstraint.prototype.__class__=btGeneric6DofConstraint;btGeneric6DofConstraint.__cache__={};Module["btGeneric6DofConstraint"]=btGeneric6DofConstraint;btGeneric6DofConstraint.prototype["setLinearLowerLimit"]=btGeneric6DofConstraint.prototype.setLinearLowerLimit=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGeneric6DofConstraint_setLinearLowerLimit_1(self,arg0)});btGeneric6DofConstraint.prototype["setLinearUpperLimit"]=btGeneric6DofConstraint.prototype.setLinearUpperLimit=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGeneric6DofConstraint_setLinearUpperLimit_1(self,arg0)});btGeneric6DofConstraint.prototype["setAngularLowerLimit"]=btGeneric6DofConstraint.prototype.setAngularLowerLimit=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGeneric6DofConstraint_setAngularLowerLimit_1(self,arg0)});btGeneric6DofConstraint.prototype["setAngularUpperLimit"]=btGeneric6DofConstraint.prototype.setAngularUpperLimit=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGeneric6DofConstraint_setAngularUpperLimit_1(self,arg0)});btGeneric6DofConstraint.prototype["enableFeedback"]=btGeneric6DofConstraint.prototype.enableFeedback=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGeneric6DofConstraint_enableFeedback_1(self,arg0)});btGeneric6DofConstraint.prototype["getBreakingImpulseThreshold"]=btGeneric6DofConstraint.prototype.getBreakingImpulseThreshold=(function(){var self=this.ptr;return _emscripten_bind_btGeneric6DofConstraint_getBreakingImpulseThreshold_0(self)});btGeneric6DofConstraint.prototype["setBreakingImpulseThreshold"]=btGeneric6DofConstraint.prototype.setBreakingImpulseThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGeneric6DofConstraint_setBreakingImpulseThreshold_1(self,arg0)});btGeneric6DofConstraint.prototype["__destroy__"]=btGeneric6DofConstraint.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btGeneric6DofConstraint___destroy___0(self)});function btStridingMeshInterface(){throw"cannot construct a btStridingMeshInterface, no constructor in IDL"}btStridingMeshInterface.prototype=Object.create(WrapperObject.prototype);btStridingMeshInterface.prototype.constructor=btStridingMeshInterface;btStridingMeshInterface.prototype.__class__=btStridingMeshInterface;btStridingMeshInterface.__cache__={};Module["btStridingMeshInterface"]=btStridingMeshInterface;btStridingMeshInterface.prototype["__destroy__"]=btStridingMeshInterface.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btStridingMeshInterface___destroy___0(self)});function btBroadphaseInterface(){throw"cannot construct a btBroadphaseInterface, no constructor in IDL"}btBroadphaseInterface.prototype=Object.create(WrapperObject.prototype);btBroadphaseInterface.prototype.constructor=btBroadphaseInterface;btBroadphaseInterface.prototype.__class__=btBroadphaseInterface;btBroadphaseInterface.__cache__={};Module["btBroadphaseInterface"]=btBroadphaseInterface;btBroadphaseInterface.prototype["__destroy__"]=btBroadphaseInterface.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btBroadphaseInterface___destroy___0(self)});function btCollisionObject(){throw"cannot construct a btCollisionObject, no constructor in IDL"}btCollisionObject.prototype=Object.create(WrapperObject.prototype);btCollisionObject.prototype.constructor=btCollisionObject;btCollisionObject.prototype.__class__=btCollisionObject;btCollisionObject.__cache__={};Module["btCollisionObject"]=btCollisionObject;btCollisionObject.prototype["setAnisotropicFriction"]=btCollisionObject.prototype.setAnisotropicFriction=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCollisionObject_setAnisotropicFriction_2(self,arg0,arg1)});btCollisionObject.prototype["getCollisionShape"]=btCollisionObject.prototype.getCollisionShape=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btCollisionObject_getCollisionShape_0(self),btCollisionShape)});btCollisionObject.prototype["setContactProcessingThreshold"]=btCollisionObject.prototype.setContactProcessingThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_setContactProcessingThreshold_1(self,arg0)});btCollisionObject.prototype["setActivationState"]=btCollisionObject.prototype.setActivationState=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_setActivationState_1(self,arg0)});btCollisionObject.prototype["forceActivationState"]=btCollisionObject.prototype.forceActivationState=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_forceActivationState_1(self,arg0)});btCollisionObject.prototype["activate"]=btCollisionObject.prototype.activate=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg0===undefined){_emscripten_bind_btCollisionObject_activate_0(self);return}_emscripten_bind_btCollisionObject_activate_1(self,arg0)});btCollisionObject.prototype["isActive"]=btCollisionObject.prototype.isActive=(function(){var self=this.ptr;return _emscripten_bind_btCollisionObject_isActive_0(self)});btCollisionObject.prototype["isKinematicObject"]=btCollisionObject.prototype.isKinematicObject=(function(){var self=this.ptr;return _emscripten_bind_btCollisionObject_isKinematicObject_0(self)});btCollisionObject.prototype["setRestitution"]=btCollisionObject.prototype.setRestitution=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_setRestitution_1(self,arg0)});btCollisionObject.prototype["setFriction"]=btCollisionObject.prototype.setFriction=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_setFriction_1(self,arg0)});btCollisionObject.prototype["setRollingFriction"]=btCollisionObject.prototype.setRollingFriction=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_setRollingFriction_1(self,arg0)});btCollisionObject.prototype["getWorldTransform"]=btCollisionObject.prototype.getWorldTransform=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btCollisionObject_getWorldTransform_0(self),btTransform)});btCollisionObject.prototype["getCollisionFlags"]=btCollisionObject.prototype.getCollisionFlags=(function(){var self=this.ptr;return _emscripten_bind_btCollisionObject_getCollisionFlags_0(self)});btCollisionObject.prototype["setCollisionFlags"]=btCollisionObject.prototype.setCollisionFlags=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_setCollisionFlags_1(self,arg0)});btCollisionObject.prototype["setWorldTransform"]=btCollisionObject.prototype.setWorldTransform=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_setWorldTransform_1(self,arg0)});btCollisionObject.prototype["setCollisionShape"]=btCollisionObject.prototype.setCollisionShape=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_setCollisionShape_1(self,arg0)});btCollisionObject.prototype["setCcdMotionThreshold"]=btCollisionObject.prototype.setCcdMotionThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_setCcdMotionThreshold_1(self,arg0)});btCollisionObject.prototype["setCcdSweptSphereRadius"]=btCollisionObject.prototype.setCcdSweptSphereRadius=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_setCcdSweptSphereRadius_1(self,arg0)});btCollisionObject.prototype["__destroy__"]=btCollisionObject.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btCollisionObject___destroy___0(self)});function btDiscreteDynamicsWorld(arg0,arg1,arg2,arg3){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);this.ptr=_emscripten_bind_btDiscreteDynamicsWorld_btDiscreteDynamicsWorld_4(arg0,arg1,arg2,arg3);getCache(btDiscreteDynamicsWorld)[this.ptr]=this}btDiscreteDynamicsWorld.prototype=Object.create(btDynamicsWorld.prototype);btDiscreteDynamicsWorld.prototype.constructor=btDiscreteDynamicsWorld;btDiscreteDynamicsWorld.prototype.__class__=btDiscreteDynamicsWorld;btDiscreteDynamicsWorld.__cache__={};Module["btDiscreteDynamicsWorld"]=btDiscreteDynamicsWorld;btDiscreteDynamicsWorld.prototype["setGravity"]=btDiscreteDynamicsWorld.prototype.setGravity=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDiscreteDynamicsWorld_setGravity_1(self,arg0)});btDiscreteDynamicsWorld.prototype["getGravity"]=btDiscreteDynamicsWorld.prototype.getGravity=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDiscreteDynamicsWorld_getGravity_0(self),btVector3)});btDiscreteDynamicsWorld.prototype["addRigidBody"]=btDiscreteDynamicsWorld.prototype.addRigidBody=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg1===undefined){_emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_1(self,arg0);return}if(arg2===undefined){_emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_2(self,arg0,arg1);return}_emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_3(self,arg0,arg1,arg2)});btDiscreteDynamicsWorld.prototype["removeRigidBody"]=btDiscreteDynamicsWorld.prototype.removeRigidBody=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDiscreteDynamicsWorld_removeRigidBody_1(self,arg0)});btDiscreteDynamicsWorld.prototype["addConstraint"]=btDiscreteDynamicsWorld.prototype.addConstraint=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg1===undefined){_emscripten_bind_btDiscreteDynamicsWorld_addConstraint_1(self,arg0);return}_emscripten_bind_btDiscreteDynamicsWorld_addConstraint_2(self,arg0,arg1)});btDiscreteDynamicsWorld.prototype["removeConstraint"]=btDiscreteDynamicsWorld.prototype.removeConstraint=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDiscreteDynamicsWorld_removeConstraint_1(self,arg0)});btDiscreteDynamicsWorld.prototype["stepSimulation"]=btDiscreteDynamicsWorld.prototype.stepSimulation=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg1===undefined){return _emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_1(self,arg0)}if(arg2===undefined){return _emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_2(self,arg0,arg1)}return _emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_3(self,arg0,arg1,arg2)});btDiscreteDynamicsWorld.prototype["getDispatcher"]=btDiscreteDynamicsWorld.prototype.getDispatcher=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDiscreteDynamicsWorld_getDispatcher_0(self),btDispatcher)});btDiscreteDynamicsWorld.prototype["computeOverlappingPairs"]=btDiscreteDynamicsWorld.prototype.computeOverlappingPairs=(function(){var self=this.ptr;_emscripten_bind_btDiscreteDynamicsWorld_computeOverlappingPairs_0(self)});btDiscreteDynamicsWorld.prototype["performDiscreteCollisionDetection"]=btDiscreteDynamicsWorld.prototype.performDiscreteCollisionDetection=(function(){var self=this.ptr;_emscripten_bind_btDiscreteDynamicsWorld_performDiscreteCollisionDetection_0(self)});btDiscreteDynamicsWorld.prototype["rayTest"]=btDiscreteDynamicsWorld.prototype.rayTest=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btDiscreteDynamicsWorld_rayTest_3(self,arg0,arg1,arg2)});btDiscreteDynamicsWorld.prototype["getPairCache"]=btDiscreteDynamicsWorld.prototype.getPairCache=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDiscreteDynamicsWorld_getPairCache_0(self),btOverlappingPairCache)});btDiscreteDynamicsWorld.prototype["getDispatchInfo"]=btDiscreteDynamicsWorld.prototype.getDispatchInfo=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDiscreteDynamicsWorld_getDispatchInfo_0(self),btDispatcherInfo)});btDiscreteDynamicsWorld.prototype["addCollisionObject"]=btDiscreteDynamicsWorld.prototype.addCollisionObject=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg1===undefined){_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_1(self,arg0);return}if(arg2===undefined){_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_2(self,arg0,arg1);return}_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_3(self,arg0,arg1,arg2)});btDiscreteDynamicsWorld.prototype["getBroadphase"]=btDiscreteDynamicsWorld.prototype.getBroadphase=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDiscreteDynamicsWorld_getBroadphase_0(self),btBroadphaseInterface)});btDiscreteDynamicsWorld.prototype["convexSweepTest"]=btDiscreteDynamicsWorld.prototype.convexSweepTest=(function(arg0,arg1,arg2,arg3,arg4){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);_emscripten_bind_btDiscreteDynamicsWorld_convexSweepTest_5(self,arg0,arg1,arg2,arg3,arg4)});btDiscreteDynamicsWorld.prototype["contactPairTest"]=btDiscreteDynamicsWorld.prototype.contactPairTest=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btDiscreteDynamicsWorld_contactPairTest_3(self,arg0,arg1,arg2)});btDiscreteDynamicsWorld.prototype["addAction"]=btDiscreteDynamicsWorld.prototype.addAction=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDiscreteDynamicsWorld_addAction_1(self,arg0)});btDiscreteDynamicsWorld.prototype["getSolverInfo"]=btDiscreteDynamicsWorld.prototype.getSolverInfo=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDiscreteDynamicsWorld_getSolverInfo_0(self),btContactSolverInfo)});btDiscreteDynamicsWorld.prototype["__destroy__"]=btDiscreteDynamicsWorld.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btDiscreteDynamicsWorld___destroy___0(self)});function btConvexTriangleMeshShape(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg1===undefined){this.ptr=_emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_1(arg0);getCache(btConvexTriangleMeshShape)[this.ptr]=this;return}this.ptr=_emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_2(arg0,arg1);getCache(btConvexTriangleMeshShape)[this.ptr]=this}btConvexTriangleMeshShape.prototype=Object.create(btConvexShape.prototype);btConvexTriangleMeshShape.prototype.constructor=btConvexTriangleMeshShape;btConvexTriangleMeshShape.prototype.__class__=btConvexTriangleMeshShape;btConvexTriangleMeshShape.__cache__={};Module["btConvexTriangleMeshShape"]=btConvexTriangleMeshShape;btConvexTriangleMeshShape.prototype["setLocalScaling"]=btConvexTriangleMeshShape.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConvexTriangleMeshShape_setLocalScaling_1(self,arg0)});btConvexTriangleMeshShape.prototype["calculateLocalInertia"]=btConvexTriangleMeshShape.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btConvexTriangleMeshShape_calculateLocalInertia_2(self,arg0,arg1)});btConvexTriangleMeshShape.prototype["__destroy__"]=btConvexTriangleMeshShape.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btConvexTriangleMeshShape___destroy___0(self)});function ConvexResultCallback(){throw"cannot construct a ConvexResultCallback, no constructor in IDL"}ConvexResultCallback.prototype=Object.create(WrapperObject.prototype);ConvexResultCallback.prototype.constructor=ConvexResultCallback;ConvexResultCallback.prototype.__class__=ConvexResultCallback;ConvexResultCallback.__cache__={};Module["ConvexResultCallback"]=ConvexResultCallback;ConvexResultCallback.prototype["hasHit"]=ConvexResultCallback.prototype.hasHit=(function(){var self=this.ptr;return _emscripten_bind_ConvexResultCallback_hasHit_0(self)});ConvexResultCallback.prototype["get_m_collisionFilterGroup"]=ConvexResultCallback.prototype.get_m_collisionFilterGroup=(function(){var self=this.ptr;return _emscripten_bind_ConvexResultCallback_get_m_collisionFilterGroup_0(self)});ConvexResultCallback.prototype["set_m_collisionFilterGroup"]=ConvexResultCallback.prototype.set_m_collisionFilterGroup=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ConvexResultCallback_set_m_collisionFilterGroup_1(self,arg0)});ConvexResultCallback.prototype["get_m_collisionFilterMask"]=ConvexResultCallback.prototype.get_m_collisionFilterMask=(function(){var self=this.ptr;return _emscripten_bind_ConvexResultCallback_get_m_collisionFilterMask_0(self)});ConvexResultCallback.prototype["set_m_collisionFilterMask"]=ConvexResultCallback.prototype.set_m_collisionFilterMask=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ConvexResultCallback_set_m_collisionFilterMask_1(self,arg0)});ConvexResultCallback.prototype["get_m_closestHitFraction"]=ConvexResultCallback.prototype.get_m_closestHitFraction=(function(){var self=this.ptr;return _emscripten_bind_ConvexResultCallback_get_m_closestHitFraction_0(self)});ConvexResultCallback.prototype["set_m_closestHitFraction"]=ConvexResultCallback.prototype.set_m_closestHitFraction=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ConvexResultCallback_set_m_closestHitFraction_1(self,arg0)});ConvexResultCallback.prototype["__destroy__"]=ConvexResultCallback.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_ConvexResultCallback___destroy___0(self)});function btPoint2PointConstraint(arg0,arg1,arg2,arg3){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg2===undefined){this.ptr=_emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_2(arg0,arg1);getCache(btPoint2PointConstraint)[this.ptr]=this;return}if(arg3===undefined){this.ptr=_emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_3(arg0,arg1,arg2);getCache(btPoint2PointConstraint)[this.ptr]=this;return}this.ptr=_emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_4(arg0,arg1,arg2,arg3);getCache(btPoint2PointConstraint)[this.ptr]=this}btPoint2PointConstraint.prototype=Object.create(btTypedConstraint.prototype);btPoint2PointConstraint.prototype.constructor=btPoint2PointConstraint;btPoint2PointConstraint.prototype.__class__=btPoint2PointConstraint;btPoint2PointConstraint.__cache__={};Module["btPoint2PointConstraint"]=btPoint2PointConstraint;btPoint2PointConstraint.prototype["setPivotA"]=btPoint2PointConstraint.prototype.setPivotA=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPoint2PointConstraint_setPivotA_1(self,arg0)});btPoint2PointConstraint.prototype["setPivotB"]=btPoint2PointConstraint.prototype.setPivotB=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPoint2PointConstraint_setPivotB_1(self,arg0)});btPoint2PointConstraint.prototype["getPivotInA"]=btPoint2PointConstraint.prototype.getPivotInA=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btPoint2PointConstraint_getPivotInA_0(self),btVector3)});btPoint2PointConstraint.prototype["getPivotInB"]=btPoint2PointConstraint.prototype.getPivotInB=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btPoint2PointConstraint_getPivotInB_0(self),btVector3)});btPoint2PointConstraint.prototype["enableFeedback"]=btPoint2PointConstraint.prototype.enableFeedback=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPoint2PointConstraint_enableFeedback_1(self,arg0)});btPoint2PointConstraint.prototype["getBreakingImpulseThreshold"]=btPoint2PointConstraint.prototype.getBreakingImpulseThreshold=(function(){var self=this.ptr;return _emscripten_bind_btPoint2PointConstraint_getBreakingImpulseThreshold_0(self)});btPoint2PointConstraint.prototype["setBreakingImpulseThreshold"]=btPoint2PointConstraint.prototype.setBreakingImpulseThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPoint2PointConstraint_setBreakingImpulseThreshold_1(self,arg0)});btPoint2PointConstraint.prototype["get_m_setting"]=btPoint2PointConstraint.prototype.get_m_setting=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btPoint2PointConstraint_get_m_setting_0(self),btConstraintSetting)});btPoint2PointConstraint.prototype["set_m_setting"]=btPoint2PointConstraint.prototype.set_m_setting=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPoint2PointConstraint_set_m_setting_1(self,arg0)});btPoint2PointConstraint.prototype["__destroy__"]=btPoint2PointConstraint.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btPoint2PointConstraint___destroy___0(self)});function btMotionState(){throw"cannot construct a btMotionState, no constructor in IDL"}btMotionState.prototype=Object.create(WrapperObject.prototype);btMotionState.prototype.constructor=btMotionState;btMotionState.prototype.__class__=btMotionState;btMotionState.__cache__={};Module["btMotionState"]=btMotionState;btMotionState.prototype["getWorldTransform"]=btMotionState.prototype.getWorldTransform=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btMotionState_getWorldTransform_1(self,arg0)});btMotionState.prototype["setWorldTransform"]=btMotionState.prototype.setWorldTransform=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btMotionState_setWorldTransform_1(self,arg0)});btMotionState.prototype["__destroy__"]=btMotionState.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btMotionState___destroy___0(self)});function btSliderConstraint(arg0,arg1,arg2,arg3,arg4){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);if(arg3===undefined){this.ptr=_emscripten_bind_btSliderConstraint_btSliderConstraint_3(arg0,arg1,arg2);getCache(btSliderConstraint)[this.ptr]=this;return}if(arg4===undefined){this.ptr=_emscripten_bind_btSliderConstraint_btSliderConstraint_4(arg0,arg1,arg2,arg3);getCache(btSliderConstraint)[this.ptr]=this;return}this.ptr=_emscripten_bind_btSliderConstraint_btSliderConstraint_5(arg0,arg1,arg2,arg3,arg4);getCache(btSliderConstraint)[this.ptr]=this}btSliderConstraint.prototype=Object.create(btTypedConstraint.prototype);btSliderConstraint.prototype.constructor=btSliderConstraint;btSliderConstraint.prototype.__class__=btSliderConstraint;btSliderConstraint.__cache__={};Module["btSliderConstraint"]=btSliderConstraint;btSliderConstraint.prototype["setLowerLinLimit"]=btSliderConstraint.prototype.setLowerLinLimit=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btSliderConstraint_setLowerLinLimit_1(self,arg0)});btSliderConstraint.prototype["setUpperLinLimit"]=btSliderConstraint.prototype.setUpperLinLimit=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btSliderConstraint_setUpperLinLimit_1(self,arg0)});btSliderConstraint.prototype["setLowerAngLimit"]=btSliderConstraint.prototype.setLowerAngLimit=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btSliderConstraint_setLowerAngLimit_1(self,arg0)});btSliderConstraint.prototype["setUpperAngLimit"]=btSliderConstraint.prototype.setUpperAngLimit=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btSliderConstraint_setUpperAngLimit_1(self,arg0)});btSliderConstraint.prototype["enableFeedback"]=btSliderConstraint.prototype.enableFeedback=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btSliderConstraint_enableFeedback_1(self,arg0)});btSliderConstraint.prototype["getBreakingImpulseThreshold"]=btSliderConstraint.prototype.getBreakingImpulseThreshold=(function(){var self=this.ptr;return _emscripten_bind_btSliderConstraint_getBreakingImpulseThreshold_0(self)});btSliderConstraint.prototype["setBreakingImpulseThreshold"]=btSliderConstraint.prototype.setBreakingImpulseThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btSliderConstraint_setBreakingImpulseThreshold_1(self,arg0)});btSliderConstraint.prototype["__destroy__"]=btSliderConstraint.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btSliderConstraint___destroy___0(self)});function btConeTwistConstraint(arg0,arg1,arg2,arg3){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg2===undefined){this.ptr=_emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_2(arg0,arg1);getCache(btConeTwistConstraint)[this.ptr]=this;return}if(arg3===undefined){this.ptr=_emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_3(arg0,arg1,arg2);getCache(btConeTwistConstraint)[this.ptr]=this;return}this.ptr=_emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_4(arg0,arg1,arg2,arg3);getCache(btConeTwistConstraint)[this.ptr]=this}btConeTwistConstraint.prototype=Object.create(btTypedConstraint.prototype);btConeTwistConstraint.prototype.constructor=btConeTwistConstraint;btConeTwistConstraint.prototype.__class__=btConeTwistConstraint;btConeTwistConstraint.__cache__={};Module["btConeTwistConstraint"]=btConeTwistConstraint;btConeTwistConstraint.prototype["setLimit"]=btConeTwistConstraint.prototype.setLimit=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btConeTwistConstraint_setLimit_2(self,arg0,arg1)});btConeTwistConstraint.prototype["setAngularOnly"]=btConeTwistConstraint.prototype.setAngularOnly=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeTwistConstraint_setAngularOnly_1(self,arg0)});btConeTwistConstraint.prototype["setDamping"]=btConeTwistConstraint.prototype.setDamping=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeTwistConstraint_setDamping_1(self,arg0)});btConeTwistConstraint.prototype["enableMotor"]=btConeTwistConstraint.prototype.enableMotor=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeTwistConstraint_enableMotor_1(self,arg0)});btConeTwistConstraint.prototype["setMaxMotorImpulse"]=btConeTwistConstraint.prototype.setMaxMotorImpulse=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeTwistConstraint_setMaxMotorImpulse_1(self,arg0)});btConeTwistConstraint.prototype["setMaxMotorImpulseNormalized"]=btConeTwistConstraint.prototype.setMaxMotorImpulseNormalized=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeTwistConstraint_setMaxMotorImpulseNormalized_1(self,arg0)});btConeTwistConstraint.prototype["setMotorTarget"]=btConeTwistConstraint.prototype.setMotorTarget=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeTwistConstraint_setMotorTarget_1(self,arg0)});btConeTwistConstraint.prototype["setMotorTargetInConstraintSpace"]=btConeTwistConstraint.prototype.setMotorTargetInConstraintSpace=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeTwistConstraint_setMotorTargetInConstraintSpace_1(self,arg0)});btConeTwistConstraint.prototype["enableFeedback"]=btConeTwistConstraint.prototype.enableFeedback=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeTwistConstraint_enableFeedback_1(self,arg0)});btConeTwistConstraint.prototype["getBreakingImpulseThreshold"]=btConeTwistConstraint.prototype.getBreakingImpulseThreshold=(function(){var self=this.ptr;return _emscripten_bind_btConeTwistConstraint_getBreakingImpulseThreshold_0(self)});btConeTwistConstraint.prototype["setBreakingImpulseThreshold"]=btConeTwistConstraint.prototype.setBreakingImpulseThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeTwistConstraint_setBreakingImpulseThreshold_1(self,arg0)});btConeTwistConstraint.prototype["__destroy__"]=btConeTwistConstraint.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btConeTwistConstraint___destroy___0(self)});function btConeShape(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);this.ptr=_emscripten_bind_btConeShape_btConeShape_2(arg0,arg1);getCache(btConeShape)[this.ptr]=this}btConeShape.prototype=Object.create(btCollisionShape.prototype);btConeShape.prototype.constructor=btConeShape;btConeShape.prototype.__class__=btConeShape;btConeShape.__cache__={};Module["btConeShape"]=btConeShape;btConeShape.prototype["setLocalScaling"]=btConeShape.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeShape_setLocalScaling_1(self,arg0)});btConeShape.prototype["calculateLocalInertia"]=btConeShape.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btConeShape_calculateLocalInertia_2(self,arg0,arg1)});btConeShape.prototype["__destroy__"]=btConeShape.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btConeShape___destroy___0(self)});function btConvexShape(){throw"cannot construct a btConvexShape, no constructor in IDL"}btConvexShape.prototype=Object.create(btCollisionShape.prototype);btConvexShape.prototype.constructor=btConvexShape;btConvexShape.prototype.__class__=btConvexShape;btConvexShape.__cache__={};Module["btConvexShape"]=btConvexShape;btConvexShape.prototype["setLocalScaling"]=btConvexShape.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConvexShape_setLocalScaling_1(self,arg0)});btConvexShape.prototype["calculateLocalInertia"]=btConvexShape.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btConvexShape_calculateLocalInertia_2(self,arg0,arg1)});btConvexShape.prototype["__destroy__"]=btConvexShape.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btConvexShape___destroy___0(self)});function btDefaultCollisionConfiguration(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg0===undefined){this.ptr=_emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_0();getCache(btDefaultCollisionConfiguration)[this.ptr]=this;return}this.ptr=_emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_1(arg0);getCache(btDefaultCollisionConfiguration)[this.ptr]=this}btDefaultCollisionConfiguration.prototype=Object.create(WrapperObject.prototype);btDefaultCollisionConfiguration.prototype.constructor=btDefaultCollisionConfiguration;btDefaultCollisionConfiguration.prototype.__class__=btDefaultCollisionConfiguration;btDefaultCollisionConfiguration.__cache__={};Module["btDefaultCollisionConfiguration"]=btDefaultCollisionConfiguration;btDefaultCollisionConfiguration.prototype["__destroy__"]=btDefaultCollisionConfiguration.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btDefaultCollisionConfiguration___destroy___0(self)});function ContactResultCallback(){throw"cannot construct a ContactResultCallback, no constructor in IDL"}ContactResultCallback.prototype=Object.create(WrapperObject.prototype);ContactResultCallback.prototype.constructor=ContactResultCallback;ContactResultCallback.prototype.__class__=ContactResultCallback;ContactResultCallback.__cache__={};Module["ContactResultCallback"]=ContactResultCallback;ContactResultCallback.prototype["addSingleResult"]=ContactResultCallback.prototype.addSingleResult=(function(arg0,arg1,arg2,arg3,arg4,arg5,arg6){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);if(arg5&&typeof arg5==="object")arg5=arg5.ptr;else arg5=ensureString(arg5);if(arg6&&typeof arg6==="object")arg6=arg6.ptr;else arg6=ensureString(arg6);return _emscripten_bind_ContactResultCallback_addSingleResult_7(self,arg0,arg1,arg2,arg3,arg4,arg5,arg6)});ContactResultCallback.prototype["__destroy__"]=ContactResultCallback.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_ContactResultCallback___destroy___0(self)});function btConeShapeZ(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);this.ptr=_emscripten_bind_btConeShapeZ_btConeShapeZ_2(arg0,arg1);getCache(btConeShapeZ)[this.ptr]=this}btConeShapeZ.prototype=Object.create(btConeShape.prototype);btConeShapeZ.prototype.constructor=btConeShapeZ;btConeShapeZ.prototype.__class__=btConeShapeZ;btConeShapeZ.__cache__={};Module["btConeShapeZ"]=btConeShapeZ;btConeShapeZ.prototype["setLocalScaling"]=btConeShapeZ.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeShapeZ_setLocalScaling_1(self,arg0)});btConeShapeZ.prototype["calculateLocalInertia"]=btConeShapeZ.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btConeShapeZ_calculateLocalInertia_2(self,arg0,arg1)});btConeShapeZ.prototype["__destroy__"]=btConeShapeZ.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btConeShapeZ___destroy___0(self)});function btConeShapeX(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);this.ptr=_emscripten_bind_btConeShapeX_btConeShapeX_2(arg0,arg1);getCache(btConeShapeX)[this.ptr]=this}btConeShapeX.prototype=Object.create(btConeShape.prototype);btConeShapeX.prototype.constructor=btConeShapeX;btConeShapeX.prototype.__class__=btConeShapeX;btConeShapeX.__cache__={};Module["btConeShapeX"]=btConeShapeX;btConeShapeX.prototype["setLocalScaling"]=btConeShapeX.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeShapeX_setLocalScaling_1(self,arg0)});btConeShapeX.prototype["calculateLocalInertia"]=btConeShapeX.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btConeShapeX_calculateLocalInertia_2(self,arg0,arg1)});btConeShapeX.prototype["__destroy__"]=btConeShapeX.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btConeShapeX___destroy___0(self)});function btTriangleMesh(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg0===undefined){this.ptr=_emscripten_bind_btTriangleMesh_btTriangleMesh_0();getCache(btTriangleMesh)[this.ptr]=this;return}if(arg1===undefined){this.ptr=_emscripten_bind_btTriangleMesh_btTriangleMesh_1(arg0);getCache(btTriangleMesh)[this.ptr]=this;return}this.ptr=_emscripten_bind_btTriangleMesh_btTriangleMesh_2(arg0,arg1);getCache(btTriangleMesh)[this.ptr]=this}btTriangleMesh.prototype=Object.create(btStridingMeshInterface.prototype);btTriangleMesh.prototype.constructor=btTriangleMesh;btTriangleMesh.prototype.__class__=btTriangleMesh;btTriangleMesh.__cache__={};Module["btTriangleMesh"]=btTriangleMesh;btTriangleMesh.prototype["addTriangle"]=btTriangleMesh.prototype.addTriangle=(function(arg0,arg1,arg2,arg3){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg3===undefined){_emscripten_bind_btTriangleMesh_addTriangle_3(self,arg0,arg1,arg2);return}_emscripten_bind_btTriangleMesh_addTriangle_4(self,arg0,arg1,arg2,arg3)});btTriangleMesh.prototype["__destroy__"]=btTriangleMesh.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btTriangleMesh___destroy___0(self)});function btConvexHullShape(){this.ptr=_emscripten_bind_btConvexHullShape_btConvexHullShape_0();getCache(btConvexHullShape)[this.ptr]=this}btConvexHullShape.prototype=Object.create(btCollisionShape.prototype);btConvexHullShape.prototype.constructor=btConvexHullShape;btConvexHullShape.prototype.__class__=btConvexHullShape;btConvexHullShape.__cache__={};Module["btConvexHullShape"]=btConvexHullShape;btConvexHullShape.prototype["addPoint"]=btConvexHullShape.prototype.addPoint=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg1===undefined){_emscripten_bind_btConvexHullShape_addPoint_1(self,arg0);return}_emscripten_bind_btConvexHullShape_addPoint_2(self,arg0,arg1)});btConvexHullShape.prototype["setLocalScaling"]=btConvexHullShape.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConvexHullShape_setLocalScaling_1(self,arg0)});btConvexHullShape.prototype["calculateLocalInertia"]=btConvexHullShape.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btConvexHullShape_calculateLocalInertia_2(self,arg0,arg1)});btConvexHullShape.prototype["__destroy__"]=btConvexHullShape.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btConvexHullShape___destroy___0(self)});function btPersistentManifold(){this.ptr=_emscripten_bind_btPersistentManifold_btPersistentManifold_0();getCache(btPersistentManifold)[this.ptr]=this}btPersistentManifold.prototype=Object.create(WrapperObject.prototype);btPersistentManifold.prototype.constructor=btPersistentManifold;btPersistentManifold.prototype.__class__=btPersistentManifold;btPersistentManifold.__cache__={};Module["btPersistentManifold"]=btPersistentManifold;btPersistentManifold.prototype["getBody0"]=btPersistentManifold.prototype.getBody0=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btPersistentManifold_getBody0_0(self),btCollisionObject)});btPersistentManifold.prototype["getBody1"]=btPersistentManifold.prototype.getBody1=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btPersistentManifold_getBody1_0(self),btCollisionObject)});btPersistentManifold.prototype["getNumContacts"]=btPersistentManifold.prototype.getNumContacts=(function(){var self=this.ptr;return _emscripten_bind_btPersistentManifold_getNumContacts_0(self)});btPersistentManifold.prototype["getContactPoint"]=btPersistentManifold.prototype.getContactPoint=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btPersistentManifold_getContactPoint_1(self,arg0),btManifoldPoint)});btPersistentManifold.prototype["__destroy__"]=btPersistentManifold.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btPersistentManifold___destroy___0(self)});function btBoxShape(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);this.ptr=_emscripten_bind_btBoxShape_btBoxShape_1(arg0);getCache(btBoxShape)[this.ptr]=this}btBoxShape.prototype=Object.create(btCollisionShape.prototype);btBoxShape.prototype.constructor=btBoxShape;btBoxShape.prototype.__class__=btBoxShape;btBoxShape.__cache__={};Module["btBoxShape"]=btBoxShape;btBoxShape.prototype["setLocalScaling"]=btBoxShape.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btBoxShape_setLocalScaling_1(self,arg0)});btBoxShape.prototype["calculateLocalInertia"]=btBoxShape.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btBoxShape_calculateLocalInertia_2(self,arg0,arg1)});btBoxShape.prototype["__destroy__"]=btBoxShape.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btBoxShape___destroy___0(self)});function btCollisionDispatcher(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);this.ptr=_emscripten_bind_btCollisionDispatcher_btCollisionDispatcher_1(arg0);getCache(btCollisionDispatcher)[this.ptr]=this}btCollisionDispatcher.prototype=Object.create(btDispatcher.prototype);btCollisionDispatcher.prototype.constructor=btCollisionDispatcher;btCollisionDispatcher.prototype.__class__=btCollisionDispatcher;btCollisionDispatcher.__cache__={};Module["btCollisionDispatcher"]=btCollisionDispatcher;btCollisionDispatcher.prototype["getNumManifolds"]=btCollisionDispatcher.prototype.getNumManifolds=(function(){var self=this.ptr;return _emscripten_bind_btCollisionDispatcher_getNumManifolds_0(self)});btCollisionDispatcher.prototype["getManifoldByIndexInternal"]=btCollisionDispatcher.prototype.getManifoldByIndexInternal=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btCollisionDispatcher_getManifoldByIndexInternal_1(self,arg0),btPersistentManifold)});btCollisionDispatcher.prototype["__destroy__"]=btCollisionDispatcher.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btCollisionDispatcher___destroy___0(self)});function btVehicleTuning(){this.ptr=_emscripten_bind_btVehicleTuning_btVehicleTuning_0();getCache(btVehicleTuning)[this.ptr]=this}btVehicleTuning.prototype=Object.create(WrapperObject.prototype);btVehicleTuning.prototype.constructor=btVehicleTuning;btVehicleTuning.prototype.__class__=btVehicleTuning;btVehicleTuning.__cache__={};Module["btVehicleTuning"]=btVehicleTuning;btVehicleTuning.prototype["get_m_suspensionStiffness"]=btVehicleTuning.prototype.get_m_suspensionStiffness=(function(){var self=this.ptr;return _emscripten_bind_btVehicleTuning_get_m_suspensionStiffness_0(self)});btVehicleTuning.prototype["set_m_suspensionStiffness"]=btVehicleTuning.prototype.set_m_suspensionStiffness=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVehicleTuning_set_m_suspensionStiffness_1(self,arg0)});btVehicleTuning.prototype["get_m_suspensionCompression"]=btVehicleTuning.prototype.get_m_suspensionCompression=(function(){var self=this.ptr;return _emscripten_bind_btVehicleTuning_get_m_suspensionCompression_0(self)});btVehicleTuning.prototype["set_m_suspensionCompression"]=btVehicleTuning.prototype.set_m_suspensionCompression=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVehicleTuning_set_m_suspensionCompression_1(self,arg0)});btVehicleTuning.prototype["get_m_suspensionDamping"]=btVehicleTuning.prototype.get_m_suspensionDamping=(function(){var self=this.ptr;return _emscripten_bind_btVehicleTuning_get_m_suspensionDamping_0(self)});btVehicleTuning.prototype["set_m_suspensionDamping"]=btVehicleTuning.prototype.set_m_suspensionDamping=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVehicleTuning_set_m_suspensionDamping_1(self,arg0)});btVehicleTuning.prototype["get_m_maxSuspensionTravelCm"]=btVehicleTuning.prototype.get_m_maxSuspensionTravelCm=(function(){var self=this.ptr;return _emscripten_bind_btVehicleTuning_get_m_maxSuspensionTravelCm_0(self)});btVehicleTuning.prototype["set_m_maxSuspensionTravelCm"]=btVehicleTuning.prototype.set_m_maxSuspensionTravelCm=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVehicleTuning_set_m_maxSuspensionTravelCm_1(self,arg0)});btVehicleTuning.prototype["get_m_frictionSlip"]=btVehicleTuning.prototype.get_m_frictionSlip=(function(){var self=this.ptr;return _emscripten_bind_btVehicleTuning_get_m_frictionSlip_0(self)});btVehicleTuning.prototype["set_m_frictionSlip"]=btVehicleTuning.prototype.set_m_frictionSlip=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVehicleTuning_set_m_frictionSlip_1(self,arg0)});btVehicleTuning.prototype["get_m_maxSuspensionForce"]=btVehicleTuning.prototype.get_m_maxSuspensionForce=(function(){var self=this.ptr;return _emscripten_bind_btVehicleTuning_get_m_maxSuspensionForce_0(self)});btVehicleTuning.prototype["set_m_maxSuspensionForce"]=btVehicleTuning.prototype.set_m_maxSuspensionForce=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVehicleTuning_set_m_maxSuspensionForce_1(self,arg0)});function btCompoundShape(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg0===undefined){this.ptr=_emscripten_bind_btCompoundShape_btCompoundShape_0();getCache(btCompoundShape)[this.ptr]=this;return}this.ptr=_emscripten_bind_btCompoundShape_btCompoundShape_1(arg0);getCache(btCompoundShape)[this.ptr]=this}btCompoundShape.prototype=Object.create(btCollisionShape.prototype);btCompoundShape.prototype.constructor=btCompoundShape;btCompoundShape.prototype.__class__=btCompoundShape;btCompoundShape.__cache__={};Module["btCompoundShape"]=btCompoundShape;btCompoundShape.prototype["addChildShape"]=btCompoundShape.prototype.addChildShape=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCompoundShape_addChildShape_2(self,arg0,arg1)});btCompoundShape.prototype["setLocalScaling"]=btCompoundShape.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCompoundShape_setLocalScaling_1(self,arg0)});btCompoundShape.prototype["calculateLocalInertia"]=btCompoundShape.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCompoundShape_calculateLocalInertia_2(self,arg0,arg1)});btCompoundShape.prototype["__destroy__"]=btCompoundShape.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btCompoundShape___destroy___0(self)});function btCollisionObjectWrapper(){throw"cannot construct a btCollisionObjectWrapper, no constructor in IDL"}btCollisionObjectWrapper.prototype=Object.create(WrapperObject.prototype);btCollisionObjectWrapper.prototype.constructor=btCollisionObjectWrapper;btCollisionObjectWrapper.prototype.__class__=btCollisionObjectWrapper;btCollisionObjectWrapper.__cache__={};Module["btCollisionObjectWrapper"]=btCollisionObjectWrapper;function ClosestConvexResultCallback(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);this.ptr=_emscripten_bind_ClosestConvexResultCallback_ClosestConvexResultCallback_2(arg0,arg1);getCache(ClosestConvexResultCallback)[this.ptr]=this}ClosestConvexResultCallback.prototype=Object.create(ConvexResultCallback.prototype);ClosestConvexResultCallback.prototype.constructor=ClosestConvexResultCallback;ClosestConvexResultCallback.prototype.__class__=ClosestConvexResultCallback;ClosestConvexResultCallback.__cache__={};Module["ClosestConvexResultCallback"]=ClosestConvexResultCallback;ClosestConvexResultCallback.prototype["hasHit"]=ClosestConvexResultCallback.prototype.hasHit=(function(){var self=this.ptr;return _emscripten_bind_ClosestConvexResultCallback_hasHit_0(self)});ClosestConvexResultCallback.prototype["get_m_convexFromWorld"]=ClosestConvexResultCallback.prototype.get_m_convexFromWorld=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_ClosestConvexResultCallback_get_m_convexFromWorld_0(self),btVector3)});ClosestConvexResultCallback.prototype["set_m_convexFromWorld"]=ClosestConvexResultCallback.prototype.set_m_convexFromWorld=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestConvexResultCallback_set_m_convexFromWorld_1(self,arg0)});ClosestConvexResultCallback.prototype["get_m_convexToWorld"]=ClosestConvexResultCallback.prototype.get_m_convexToWorld=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_ClosestConvexResultCallback_get_m_convexToWorld_0(self),btVector3)});ClosestConvexResultCallback.prototype["set_m_convexToWorld"]=ClosestConvexResultCallback.prototype.set_m_convexToWorld=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestConvexResultCallback_set_m_convexToWorld_1(self,arg0)});ClosestConvexResultCallback.prototype["get_m_hitNormalWorld"]=ClosestConvexResultCallback.prototype.get_m_hitNormalWorld=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_ClosestConvexResultCallback_get_m_hitNormalWorld_0(self),btVector3)});ClosestConvexResultCallback.prototype["set_m_hitNormalWorld"]=ClosestConvexResultCallback.prototype.set_m_hitNormalWorld=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestConvexResultCallback_set_m_hitNormalWorld_1(self,arg0)});ClosestConvexResultCallback.prototype["get_m_hitPointWorld"]=ClosestConvexResultCallback.prototype.get_m_hitPointWorld=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_ClosestConvexResultCallback_get_m_hitPointWorld_0(self),btVector3)});ClosestConvexResultCallback.prototype["set_m_hitPointWorld"]=ClosestConvexResultCallback.prototype.set_m_hitPointWorld=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestConvexResultCallback_set_m_hitPointWorld_1(self,arg0)});ClosestConvexResultCallback.prototype["get_m_collisionFilterGroup"]=ClosestConvexResultCallback.prototype.get_m_collisionFilterGroup=(function(){var self=this.ptr;return _emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterGroup_0(self)});ClosestConvexResultCallback.prototype["set_m_collisionFilterGroup"]=ClosestConvexResultCallback.prototype.set_m_collisionFilterGroup=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterGroup_1(self,arg0)});ClosestConvexResultCallback.prototype["get_m_collisionFilterMask"]=ClosestConvexResultCallback.prototype.get_m_collisionFilterMask=(function(){var self=this.ptr;return _emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterMask_0(self)});ClosestConvexResultCallback.prototype["set_m_collisionFilterMask"]=ClosestConvexResultCallback.prototype.set_m_collisionFilterMask=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterMask_1(self,arg0)});ClosestConvexResultCallback.prototype["get_m_closestHitFraction"]=ClosestConvexResultCallback.prototype.get_m_closestHitFraction=(function(){var self=this.ptr;return _emscripten_bind_ClosestConvexResultCallback_get_m_closestHitFraction_0(self)});ClosestConvexResultCallback.prototype["set_m_closestHitFraction"]=ClosestConvexResultCallback.prototype.set_m_closestHitFraction=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestConvexResultCallback_set_m_closestHitFraction_1(self,arg0)});ClosestConvexResultCallback.prototype["__destroy__"]=ClosestConvexResultCallback.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_ClosestConvexResultCallback___destroy___0(self)});function btDefaultMotionState(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg0===undefined){this.ptr=_emscripten_bind_btDefaultMotionState_btDefaultMotionState_0();getCache(btDefaultMotionState)[this.ptr]=this;return}if(arg1===undefined){this.ptr=_emscripten_bind_btDefaultMotionState_btDefaultMotionState_1(arg0);getCache(btDefaultMotionState)[this.ptr]=this;return}this.ptr=_emscripten_bind_btDefaultMotionState_btDefaultMotionState_2(arg0,arg1);getCache(btDefaultMotionState)[this.ptr]=this}btDefaultMotionState.prototype=Object.create(btMotionState.prototype);btDefaultMotionState.prototype.constructor=btDefaultMotionState;btDefaultMotionState.prototype.__class__=btDefaultMotionState;btDefaultMotionState.__cache__={};Module["btDefaultMotionState"]=btDefaultMotionState;btDefaultMotionState.prototype["getWorldTransform"]=btDefaultMotionState.prototype.getWorldTransform=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDefaultMotionState_getWorldTransform_1(self,arg0)});btDefaultMotionState.prototype["setWorldTransform"]=btDefaultMotionState.prototype.setWorldTransform=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDefaultMotionState_setWorldTransform_1(self,arg0)});btDefaultMotionState.prototype["get_m_graphicsWorldTrans"]=btDefaultMotionState.prototype.get_m_graphicsWorldTrans=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDefaultMotionState_get_m_graphicsWorldTrans_0(self),btTransform)});btDefaultMotionState.prototype["set_m_graphicsWorldTrans"]=btDefaultMotionState.prototype.set_m_graphicsWorldTrans=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDefaultMotionState_set_m_graphicsWorldTrans_1(self,arg0)});btDefaultMotionState.prototype["__destroy__"]=btDefaultMotionState.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btDefaultMotionState___destroy___0(self)});function btTriangleMeshShape(){throw"cannot construct a btTriangleMeshShape, no constructor in IDL"}btTriangleMeshShape.prototype=Object.create(btConcaveShape.prototype);btTriangleMeshShape.prototype.constructor=btTriangleMeshShape;btTriangleMeshShape.prototype.__class__=btTriangleMeshShape;btTriangleMeshShape.__cache__={};Module["btTriangleMeshShape"]=btTriangleMeshShape;btTriangleMeshShape.prototype["setLocalScaling"]=btTriangleMeshShape.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btTriangleMeshShape_setLocalScaling_1(self,arg0)});btTriangleMeshShape.prototype["calculateLocalInertia"]=btTriangleMeshShape.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btTriangleMeshShape_calculateLocalInertia_2(self,arg0,arg1)});btTriangleMeshShape.prototype["__destroy__"]=btTriangleMeshShape.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btTriangleMeshShape___destroy___0(self)});function btDispatcher(){throw"cannot construct a btDispatcher, no constructor in IDL"}btDispatcher.prototype=Object.create(WrapperObject.prototype);btDispatcher.prototype.constructor=btDispatcher;btDispatcher.prototype.__class__=btDispatcher;btDispatcher.__cache__={};Module["btDispatcher"]=btDispatcher;btDispatcher.prototype["getNumManifolds"]=btDispatcher.prototype.getNumManifolds=(function(){var self=this.ptr;return _emscripten_bind_btDispatcher_getNumManifolds_0(self)});btDispatcher.prototype["getManifoldByIndexInternal"]=btDispatcher.prototype.getManifoldByIndexInternal=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btDispatcher_getManifoldByIndexInternal_1(self,arg0),btPersistentManifold)});btDispatcher.prototype["__destroy__"]=btDispatcher.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btDispatcher___destroy___0(self)});function ClosestRayResultCallback(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);this.ptr=_emscripten_bind_ClosestRayResultCallback_ClosestRayResultCallback_2(arg0,arg1);getCache(ClosestRayResultCallback)[this.ptr]=this}ClosestRayResultCallback.prototype=Object.create(RayResultCallback.prototype);ClosestRayResultCallback.prototype.constructor=ClosestRayResultCallback;ClosestRayResultCallback.prototype.__class__=ClosestRayResultCallback;ClosestRayResultCallback.__cache__={};Module["ClosestRayResultCallback"]=ClosestRayResultCallback;ClosestRayResultCallback.prototype["hasHit"]=ClosestRayResultCallback.prototype.hasHit=(function(){var self=this.ptr;return _emscripten_bind_ClosestRayResultCallback_hasHit_0(self)});ClosestRayResultCallback.prototype["get_m_rayFromWorld"]=ClosestRayResultCallback.prototype.get_m_rayFromWorld=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_ClosestRayResultCallback_get_m_rayFromWorld_0(self),btVector3)});ClosestRayResultCallback.prototype["set_m_rayFromWorld"]=ClosestRayResultCallback.prototype.set_m_rayFromWorld=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestRayResultCallback_set_m_rayFromWorld_1(self,arg0)});ClosestRayResultCallback.prototype["get_m_rayToWorld"]=ClosestRayResultCallback.prototype.get_m_rayToWorld=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_ClosestRayResultCallback_get_m_rayToWorld_0(self),btVector3)});ClosestRayResultCallback.prototype["set_m_rayToWorld"]=ClosestRayResultCallback.prototype.set_m_rayToWorld=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestRayResultCallback_set_m_rayToWorld_1(self,arg0)});ClosestRayResultCallback.prototype["get_m_hitNormalWorld"]=ClosestRayResultCallback.prototype.get_m_hitNormalWorld=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_ClosestRayResultCallback_get_m_hitNormalWorld_0(self),btVector3)});ClosestRayResultCallback.prototype["set_m_hitNormalWorld"]=ClosestRayResultCallback.prototype.set_m_hitNormalWorld=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestRayResultCallback_set_m_hitNormalWorld_1(self,arg0)});ClosestRayResultCallback.prototype["get_m_hitPointWorld"]=ClosestRayResultCallback.prototype.get_m_hitPointWorld=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_ClosestRayResultCallback_get_m_hitPointWorld_0(self),btVector3)});ClosestRayResultCallback.prototype["set_m_hitPointWorld"]=ClosestRayResultCallback.prototype.set_m_hitPointWorld=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestRayResultCallback_set_m_hitPointWorld_1(self,arg0)});ClosestRayResultCallback.prototype["get_m_collisionFilterGroup"]=ClosestRayResultCallback.prototype.get_m_collisionFilterGroup=(function(){var self=this.ptr;return _emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterGroup_0(self)});ClosestRayResultCallback.prototype["set_m_collisionFilterGroup"]=ClosestRayResultCallback.prototype.set_m_collisionFilterGroup=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterGroup_1(self,arg0)});ClosestRayResultCallback.prototype["get_m_collisionFilterMask"]=ClosestRayResultCallback.prototype.get_m_collisionFilterMask=(function(){var self=this.ptr;return _emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterMask_0(self)});ClosestRayResultCallback.prototype["set_m_collisionFilterMask"]=ClosestRayResultCallback.prototype.set_m_collisionFilterMask=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterMask_1(self,arg0)});ClosestRayResultCallback.prototype["get_m_collisionObject"]=ClosestRayResultCallback.prototype.get_m_collisionObject=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_ClosestRayResultCallback_get_m_collisionObject_0(self),btCollisionObject)});ClosestRayResultCallback.prototype["set_m_collisionObject"]=ClosestRayResultCallback.prototype.set_m_collisionObject=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestRayResultCallback_set_m_collisionObject_1(self,arg0)});ClosestRayResultCallback.prototype["__destroy__"]=ClosestRayResultCallback.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_ClosestRayResultCallback___destroy___0(self)});function btDynamicsWorld(){throw"cannot construct a btDynamicsWorld, no constructor in IDL"}btDynamicsWorld.prototype=Object.create(btCollisionWorld.prototype);btDynamicsWorld.prototype.constructor=btDynamicsWorld;btDynamicsWorld.prototype.__class__=btDynamicsWorld;btDynamicsWorld.__cache__={};Module["btDynamicsWorld"]=btDynamicsWorld;btDynamicsWorld.prototype["addAction"]=btDynamicsWorld.prototype.addAction=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDynamicsWorld_addAction_1(self,arg0)});btDynamicsWorld.prototype["getSolverInfo"]=btDynamicsWorld.prototype.getSolverInfo=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDynamicsWorld_getSolverInfo_0(self),btContactSolverInfo)});btDynamicsWorld.prototype["getDispatcher"]=btDynamicsWorld.prototype.getDispatcher=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDynamicsWorld_getDispatcher_0(self),btDispatcher)});btDynamicsWorld.prototype["computeOverlappingPairs"]=btDynamicsWorld.prototype.computeOverlappingPairs=(function(){var self=this.ptr;_emscripten_bind_btDynamicsWorld_computeOverlappingPairs_0(self)});btDynamicsWorld.prototype["performDiscreteCollisionDetection"]=btDynamicsWorld.prototype.performDiscreteCollisionDetection=(function(){var self=this.ptr;_emscripten_bind_btDynamicsWorld_performDiscreteCollisionDetection_0(self)});btDynamicsWorld.prototype["rayTest"]=btDynamicsWorld.prototype.rayTest=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btDynamicsWorld_rayTest_3(self,arg0,arg1,arg2)});btDynamicsWorld.prototype["getPairCache"]=btDynamicsWorld.prototype.getPairCache=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDynamicsWorld_getPairCache_0(self),btOverlappingPairCache)});btDynamicsWorld.prototype["getDispatchInfo"]=btDynamicsWorld.prototype.getDispatchInfo=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDynamicsWorld_getDispatchInfo_0(self),btDispatcherInfo)});btDynamicsWorld.prototype["addCollisionObject"]=btDynamicsWorld.prototype.addCollisionObject=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg1===undefined){_emscripten_bind_btDynamicsWorld_addCollisionObject_1(self,arg0);return}if(arg2===undefined){_emscripten_bind_btDynamicsWorld_addCollisionObject_2(self,arg0,arg1);return}_emscripten_bind_btDynamicsWorld_addCollisionObject_3(self,arg0,arg1,arg2)});btDynamicsWorld.prototype["getBroadphase"]=btDynamicsWorld.prototype.getBroadphase=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDynamicsWorld_getBroadphase_0(self),btBroadphaseInterface)});btDynamicsWorld.prototype["convexSweepTest"]=btDynamicsWorld.prototype.convexSweepTest=(function(arg0,arg1,arg2,arg3,arg4){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);_emscripten_bind_btDynamicsWorld_convexSweepTest_5(self,arg0,arg1,arg2,arg3,arg4)});btDynamicsWorld.prototype["contactPairTest"]=btDynamicsWorld.prototype.contactPairTest=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btDynamicsWorld_contactPairTest_3(self,arg0,arg1,arg2)});btDynamicsWorld.prototype["__destroy__"]=btDynamicsWorld.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btDynamicsWorld___destroy___0(self)});function btCapsuleShapeX(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);this.ptr=_emscripten_bind_btCapsuleShapeX_btCapsuleShapeX_2(arg0,arg1);getCache(btCapsuleShapeX)[this.ptr]=this}btCapsuleShapeX.prototype=Object.create(btCapsuleShape.prototype);btCapsuleShapeX.prototype.constructor=btCapsuleShapeX;btCapsuleShapeX.prototype.__class__=btCapsuleShapeX;btCapsuleShapeX.__cache__={};Module["btCapsuleShapeX"]=btCapsuleShapeX;btCapsuleShapeX.prototype["setLocalScaling"]=btCapsuleShapeX.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCapsuleShapeX_setLocalScaling_1(self,arg0)});btCapsuleShapeX.prototype["calculateLocalInertia"]=btCapsuleShapeX.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCapsuleShapeX_calculateLocalInertia_2(self,arg0,arg1)});btCapsuleShapeX.prototype["__destroy__"]=btCapsuleShapeX.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btCapsuleShapeX___destroy___0(self)});function btQuaternion(arg0,arg1,arg2,arg3){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);this.ptr=_emscripten_bind_btQuaternion_btQuaternion_4(arg0,arg1,arg2,arg3);getCache(btQuaternion)[this.ptr]=this}btQuaternion.prototype=Object.create(btQuadWord.prototype);btQuaternion.prototype.constructor=btQuaternion;btQuaternion.prototype.__class__=btQuaternion;btQuaternion.__cache__={};Module["btQuaternion"]=btQuaternion;btQuaternion.prototype["setValue"]=btQuaternion.prototype.setValue=(function(arg0,arg1,arg2,arg3){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);_emscripten_bind_btQuaternion_setValue_4(self,arg0,arg1,arg2,arg3)});btQuaternion.prototype["x"]=btQuaternion.prototype.x=(function(){var self=this.ptr;return _emscripten_bind_btQuaternion_x_0(self)});btQuaternion.prototype["y"]=btQuaternion.prototype.y=(function(){var self=this.ptr;return _emscripten_bind_btQuaternion_y_0(self)});btQuaternion.prototype["z"]=btQuaternion.prototype.z=(function(){var self=this.ptr;return _emscripten_bind_btQuaternion_z_0(self)});btQuaternion.prototype["w"]=btQuaternion.prototype.w=(function(){var self=this.ptr;return _emscripten_bind_btQuaternion_w_0(self)});btQuaternion.prototype["setX"]=btQuaternion.prototype.setX=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btQuaternion_setX_1(self,arg0)});btQuaternion.prototype["setY"]=btQuaternion.prototype.setY=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btQuaternion_setY_1(self,arg0)});btQuaternion.prototype["setZ"]=btQuaternion.prototype.setZ=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btQuaternion_setZ_1(self,arg0)});btQuaternion.prototype["setW"]=btQuaternion.prototype.setW=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btQuaternion_setW_1(self,arg0)});btQuaternion.prototype["__destroy__"]=btQuaternion.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btQuaternion___destroy___0(self)});function btCapsuleShapeZ(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);this.ptr=_emscripten_bind_btCapsuleShapeZ_btCapsuleShapeZ_2(arg0,arg1);getCache(btCapsuleShapeZ)[this.ptr]=this}btCapsuleShapeZ.prototype=Object.create(btCapsuleShape.prototype);btCapsuleShapeZ.prototype.constructor=btCapsuleShapeZ;btCapsuleShapeZ.prototype.__class__=btCapsuleShapeZ;btCapsuleShapeZ.__cache__={};Module["btCapsuleShapeZ"]=btCapsuleShapeZ;btCapsuleShapeZ.prototype["setLocalScaling"]=btCapsuleShapeZ.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCapsuleShapeZ_setLocalScaling_1(self,arg0)});btCapsuleShapeZ.prototype["calculateLocalInertia"]=btCapsuleShapeZ.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCapsuleShapeZ_calculateLocalInertia_2(self,arg0,arg1)});btCapsuleShapeZ.prototype["__destroy__"]=btCapsuleShapeZ.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btCapsuleShapeZ___destroy___0(self)});function btDefaultVehicleRaycaster(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);this.ptr=_emscripten_bind_btDefaultVehicleRaycaster_btDefaultVehicleRaycaster_1(arg0);getCache(btDefaultVehicleRaycaster)[this.ptr]=this}btDefaultVehicleRaycaster.prototype=Object.create(btVehicleRaycaster.prototype);btDefaultVehicleRaycaster.prototype.constructor=btDefaultVehicleRaycaster;btDefaultVehicleRaycaster.prototype.__class__=btDefaultVehicleRaycaster;btDefaultVehicleRaycaster.__cache__={};Module["btDefaultVehicleRaycaster"]=btDefaultVehicleRaycaster;btDefaultVehicleRaycaster.prototype["__destroy__"]=btDefaultVehicleRaycaster.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btDefaultVehicleRaycaster___destroy___0(self)});function RayResultCallback(){throw"cannot construct a RayResultCallback, no constructor in IDL"}RayResultCallback.prototype=Object.create(WrapperObject.prototype);RayResultCallback.prototype.constructor=RayResultCallback;RayResultCallback.prototype.__class__=RayResultCallback;RayResultCallback.__cache__={};Module["RayResultCallback"]=RayResultCallback;RayResultCallback.prototype["hasHit"]=RayResultCallback.prototype.hasHit=(function(){var self=this.ptr;return _emscripten_bind_RayResultCallback_hasHit_0(self)});RayResultCallback.prototype["get_m_collisionFilterGroup"]=RayResultCallback.prototype.get_m_collisionFilterGroup=(function(){var self=this.ptr;return _emscripten_bind_RayResultCallback_get_m_collisionFilterGroup_0(self)});RayResultCallback.prototype["set_m_collisionFilterGroup"]=RayResultCallback.prototype.set_m_collisionFilterGroup=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_RayResultCallback_set_m_collisionFilterGroup_1(self,arg0)});RayResultCallback.prototype["get_m_collisionFilterMask"]=RayResultCallback.prototype.get_m_collisionFilterMask=(function(){var self=this.ptr;return _emscripten_bind_RayResultCallback_get_m_collisionFilterMask_0(self)});RayResultCallback.prototype["set_m_collisionFilterMask"]=RayResultCallback.prototype.set_m_collisionFilterMask=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_RayResultCallback_set_m_collisionFilterMask_1(self,arg0)});RayResultCallback.prototype["get_m_collisionObject"]=RayResultCallback.prototype.get_m_collisionObject=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_RayResultCallback_get_m_collisionObject_0(self),btCollisionObject)});RayResultCallback.prototype["set_m_collisionObject"]=RayResultCallback.prototype.set_m_collisionObject=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_RayResultCallback_set_m_collisionObject_1(self,arg0)});RayResultCallback.prototype["__destroy__"]=RayResultCallback.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_RayResultCallback___destroy___0(self)});function btWheelInfo(){throw"cannot construct a btWheelInfo, no constructor in IDL"}btWheelInfo.prototype=Object.create(WrapperObject.prototype);btWheelInfo.prototype.constructor=btWheelInfo;btWheelInfo.prototype.__class__=btWheelInfo;btWheelInfo.__cache__={};Module["btWheelInfo"]=btWheelInfo;btWheelInfo.prototype["get_m_suspensionStiffness"]=btWheelInfo.prototype.get_m_suspensionStiffness=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_suspensionStiffness_0(self)});btWheelInfo.prototype["set_m_suspensionStiffness"]=btWheelInfo.prototype.set_m_suspensionStiffness=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_suspensionStiffness_1(self,arg0)});btWheelInfo.prototype["get_m_frictionSlip"]=btWheelInfo.prototype.get_m_frictionSlip=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_frictionSlip_0(self)});btWheelInfo.prototype["set_m_frictionSlip"]=btWheelInfo.prototype.set_m_frictionSlip=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_frictionSlip_1(self,arg0)});btWheelInfo.prototype["get_m_rollInfluence"]=btWheelInfo.prototype.get_m_rollInfluence=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_rollInfluence_0(self)});btWheelInfo.prototype["set_m_rollInfluence"]=btWheelInfo.prototype.set_m_rollInfluence=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_rollInfluence_1(self,arg0)});btWheelInfo.prototype["get_m_suspensionRestLength1"]=btWheelInfo.prototype.get_m_suspensionRestLength1=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_suspensionRestLength1_0(self)});btWheelInfo.prototype["set_m_suspensionRestLength1"]=btWheelInfo.prototype.set_m_suspensionRestLength1=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_suspensionRestLength1_1(self,arg0)});btWheelInfo.prototype["get_m_wheelsRadius"]=btWheelInfo.prototype.get_m_wheelsRadius=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_wheelsRadius_0(self)});btWheelInfo.prototype["set_m_wheelsRadius"]=btWheelInfo.prototype.set_m_wheelsRadius=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_wheelsRadius_1(self,arg0)});btWheelInfo.prototype["get_m_wheelsDampingCompression"]=btWheelInfo.prototype.get_m_wheelsDampingCompression=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_wheelsDampingCompression_0(self)});btWheelInfo.prototype["set_m_wheelsDampingCompression"]=btWheelInfo.prototype.set_m_wheelsDampingCompression=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_wheelsDampingCompression_1(self,arg0)});btWheelInfo.prototype["get_m_wheelsDampingRelaxation"]=btWheelInfo.prototype.get_m_wheelsDampingRelaxation=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_wheelsDampingRelaxation_0(self)});btWheelInfo.prototype["set_m_wheelsDampingRelaxation"]=btWheelInfo.prototype.set_m_wheelsDampingRelaxation=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_wheelsDampingRelaxation_1(self,arg0)});btWheelInfo.prototype["get_m_steering"]=btWheelInfo.prototype.get_m_steering=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_steering_0(self)});btWheelInfo.prototype["set_m_steering"]=btWheelInfo.prototype.set_m_steering=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_steering_1(self,arg0)});btWheelInfo.prototype["get_m_maxSuspensionForce"]=btWheelInfo.prototype.get_m_maxSuspensionForce=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_maxSuspensionForce_0(self)});btWheelInfo.prototype["set_m_maxSuspensionForce"]=btWheelInfo.prototype.set_m_maxSuspensionForce=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_maxSuspensionForce_1(self,arg0)});btWheelInfo.prototype["get_m_maxSuspensionTravelCm"]=btWheelInfo.prototype.get_m_maxSuspensionTravelCm=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_maxSuspensionTravelCm_0(self)});btWheelInfo.prototype["set_m_maxSuspensionTravelCm"]=btWheelInfo.prototype.set_m_maxSuspensionTravelCm=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_maxSuspensionTravelCm_1(self,arg0)});btWheelInfo.prototype["get_m_wheelsSuspensionForce"]=btWheelInfo.prototype.get_m_wheelsSuspensionForce=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_wheelsSuspensionForce_0(self)});btWheelInfo.prototype["set_m_wheelsSuspensionForce"]=btWheelInfo.prototype.set_m_wheelsSuspensionForce=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_wheelsSuspensionForce_1(self,arg0)});btWheelInfo.prototype["get_m_bIsFrontWheel"]=btWheelInfo.prototype.get_m_bIsFrontWheel=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_bIsFrontWheel_0(self)});btWheelInfo.prototype["set_m_bIsFrontWheel"]=btWheelInfo.prototype.set_m_bIsFrontWheel=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_bIsFrontWheel_1(self,arg0)});btWheelInfo.prototype["get_m_chassisConnectionPointCS"]=btWheelInfo.prototype.get_m_chassisConnectionPointCS=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btWheelInfo_get_m_chassisConnectionPointCS_0(self),btVector3)});btWheelInfo.prototype["set_m_chassisConnectionPointCS"]=btWheelInfo.prototype.set_m_chassisConnectionPointCS=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_chassisConnectionPointCS_1(self,arg0)});btWheelInfo.prototype["__destroy__"]=btWheelInfo.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btWheelInfo___destroy___0(self)});function btConcaveShape(){throw"cannot construct a btConcaveShape, no constructor in IDL"}btConcaveShape.prototype=Object.create(btCollisionShape.prototype);btConcaveShape.prototype.constructor=btConcaveShape;btConcaveShape.prototype.__class__=btConcaveShape;btConcaveShape.__cache__={};Module["btConcaveShape"]=btConcaveShape;btConcaveShape.prototype["setLocalScaling"]=btConcaveShape.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConcaveShape_setLocalScaling_1(self,arg0)});btConcaveShape.prototype["calculateLocalInertia"]=btConcaveShape.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btConcaveShape_calculateLocalInertia_2(self,arg0,arg1)});btConcaveShape.prototype["__destroy__"]=btConcaveShape.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btConcaveShape___destroy___0(self)});function btVector4(arg0,arg1,arg2,arg3){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg0===undefined){this.ptr=_emscripten_bind_btVector4_btVector4_0();getCache(btVector4)[this.ptr]=this;return}if(arg1===undefined){this.ptr=_emscripten_bind_btVector4_btVector4_1(arg0);getCache(btVector4)[this.ptr]=this;return}if(arg2===undefined){this.ptr=_emscripten_bind_btVector4_btVector4_2(arg0,arg1);getCache(btVector4)[this.ptr]=this;return}if(arg3===undefined){this.ptr=_emscripten_bind_btVector4_btVector4_3(arg0,arg1,arg2);getCache(btVector4)[this.ptr]=this;return}this.ptr=_emscripten_bind_btVector4_btVector4_4(arg0,arg1,arg2,arg3);getCache(btVector4)[this.ptr]=this}btVector4.prototype=Object.create(btVector3.prototype);btVector4.prototype.constructor=btVector4;btVector4.prototype.__class__=btVector4;btVector4.__cache__={};Module["btVector4"]=btVector4;btVector4.prototype["w"]=btVector4.prototype.w=(function(){var self=this.ptr;return _emscripten_bind_btVector4_w_0(self)});btVector4.prototype["setValue"]=btVector4.prototype.setValue=(function(arg0,arg1,arg2,arg3){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);_emscripten_bind_btVector4_setValue_4(self,arg0,arg1,arg2,arg3)});btVector4.prototype["length"]=btVector4.prototype.length=(function(){var self=this.ptr;return _emscripten_bind_btVector4_length_0(self)});btVector4.prototype["x"]=btVector4.prototype.x=(function(){var self=this.ptr;return _emscripten_bind_btVector4_x_0(self)});btVector4.prototype["y"]=btVector4.prototype.y=(function(){var self=this.ptr;return _emscripten_bind_btVector4_y_0(self)});btVector4.prototype["z"]=btVector4.prototype.z=(function(){var self=this.ptr;return _emscripten_bind_btVector4_z_0(self)});btVector4.prototype["setX"]=btVector4.prototype.setX=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVector4_setX_1(self,arg0)});btVector4.prototype["setY"]=btVector4.prototype.setY=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVector4_setY_1(self,arg0)});btVector4.prototype["setZ"]=btVector4.prototype.setZ=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVector4_setZ_1(self,arg0)});btVector4.prototype["op_mul"]=btVector4.prototype.op_mul=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btVector4_op_mul_1(self,arg0),btVector3)});btVector4.prototype["__destroy__"]=btVector4.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btVector4___destroy___0(self)});function btKinematicCharacterController(arg0,arg1,arg2,arg3){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg3===undefined){this.ptr=_emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_3(arg0,arg1,arg2);getCache(btKinematicCharacterController)[this.ptr]=this;return}this.ptr=_emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_4(arg0,arg1,arg2,arg3);getCache(btKinematicCharacterController)[this.ptr]=this}btKinematicCharacterController.prototype=Object.create(btActionInterface.prototype);btKinematicCharacterController.prototype.constructor=btKinematicCharacterController;btKinematicCharacterController.prototype.__class__=btKinematicCharacterController;btKinematicCharacterController.__cache__={};Module["btKinematicCharacterController"]=btKinematicCharacterController;btKinematicCharacterController.prototype["setUpAxis"]=btKinematicCharacterController.prototype.setUpAxis=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_setUpAxis_1(self,arg0)});btKinematicCharacterController.prototype["setWalkDirection"]=btKinematicCharacterController.prototype.setWalkDirection=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_setWalkDirection_1(self,arg0)});btKinematicCharacterController.prototype["setVelocityForTimeInterval"]=btKinematicCharacterController.prototype.setVelocityForTimeInterval=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btKinematicCharacterController_setVelocityForTimeInterval_2(self,arg0,arg1)});btKinematicCharacterController.prototype["warp"]=btKinematicCharacterController.prototype.warp=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_warp_1(self,arg0)});btKinematicCharacterController.prototype["preStep"]=btKinematicCharacterController.prototype.preStep=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_preStep_1(self,arg0)});btKinematicCharacterController.prototype["playerStep"]=btKinematicCharacterController.prototype.playerStep=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btKinematicCharacterController_playerStep_2(self,arg0,arg1)});btKinematicCharacterController.prototype["setFallSpeed"]=btKinematicCharacterController.prototype.setFallSpeed=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_setFallSpeed_1(self,arg0)});btKinematicCharacterController.prototype["setJumpSpeed"]=btKinematicCharacterController.prototype.setJumpSpeed=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_setJumpSpeed_1(self,arg0)});btKinematicCharacterController.prototype["setMaxJumpHeight"]=btKinematicCharacterController.prototype.setMaxJumpHeight=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_setMaxJumpHeight_1(self,arg0)});btKinematicCharacterController.prototype["canJump"]=btKinematicCharacterController.prototype.canJump=(function(){var self=this.ptr;return _emscripten_bind_btKinematicCharacterController_canJump_0(self)});btKinematicCharacterController.prototype["jump"]=btKinematicCharacterController.prototype.jump=(function(){var self=this.ptr;_emscripten_bind_btKinematicCharacterController_jump_0(self)});btKinematicCharacterController.prototype["setGravity"]=btKinematicCharacterController.prototype.setGravity=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_setGravity_1(self,arg0)});btKinematicCharacterController.prototype["getGravity"]=btKinematicCharacterController.prototype.getGravity=(function(){var self=this.ptr;return _emscripten_bind_btKinematicCharacterController_getGravity_0(self)});btKinematicCharacterController.prototype["setMaxSlope"]=btKinematicCharacterController.prototype.setMaxSlope=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_setMaxSlope_1(self,arg0)});btKinematicCharacterController.prototype["getMaxSlope"]=btKinematicCharacterController.prototype.getMaxSlope=(function(){var self=this.ptr;return _emscripten_bind_btKinematicCharacterController_getMaxSlope_0(self)});btKinematicCharacterController.prototype["getGhostObject"]=btKinematicCharacterController.prototype.getGhostObject=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btKinematicCharacterController_getGhostObject_0(self),btPairCachingGhostObject)});btKinematicCharacterController.prototype["setUseGhostSweepTest"]=btKinematicCharacterController.prototype.setUseGhostSweepTest=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_setUseGhostSweepTest_1(self,arg0)});btKinematicCharacterController.prototype["onGround"]=btKinematicCharacterController.prototype.onGround=(function(){var self=this.ptr;return _emscripten_bind_btKinematicCharacterController_onGround_0(self)});btKinematicCharacterController.prototype["__destroy__"]=btKinematicCharacterController.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btKinematicCharacterController___destroy___0(self)});function btStaticPlaneShape(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);this.ptr=_emscripten_bind_btStaticPlaneShape_btStaticPlaneShape_2(arg0,arg1);getCache(btStaticPlaneShape)[this.ptr]=this}btStaticPlaneShape.prototype=Object.create(btConcaveShape.prototype);btStaticPlaneShape.prototype.constructor=btStaticPlaneShape;btStaticPlaneShape.prototype.__class__=btStaticPlaneShape;btStaticPlaneShape.__cache__={};Module["btStaticPlaneShape"]=btStaticPlaneShape;btStaticPlaneShape.prototype["setLocalScaling"]=btStaticPlaneShape.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btStaticPlaneShape_setLocalScaling_1(self,arg0)});btStaticPlaneShape.prototype["calculateLocalInertia"]=btStaticPlaneShape.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btStaticPlaneShape_calculateLocalInertia_2(self,arg0,arg1)});btStaticPlaneShape.prototype["__destroy__"]=btStaticPlaneShape.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btStaticPlaneShape___destroy___0(self)});function btContactSolverInfo(){throw"cannot construct a btContactSolverInfo, no constructor in IDL"}btContactSolverInfo.prototype=Object.create(WrapperObject.prototype);btContactSolverInfo.prototype.constructor=btContactSolverInfo;btContactSolverInfo.prototype.__class__=btContactSolverInfo;btContactSolverInfo.__cache__={};Module["btContactSolverInfo"]=btContactSolverInfo;btContactSolverInfo.prototype["get_m_splitImpulse"]=btContactSolverInfo.prototype.get_m_splitImpulse=(function(){var self=this.ptr;return _emscripten_bind_btContactSolverInfo_get_m_splitImpulse_0(self)});btContactSolverInfo.prototype["set_m_splitImpulse"]=btContactSolverInfo.prototype.set_m_splitImpulse=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btContactSolverInfo_set_m_splitImpulse_1(self,arg0)});btContactSolverInfo.prototype["get_m_splitImpulsePenetrationThreshold"]=btContactSolverInfo.prototype.get_m_splitImpulsePenetrationThreshold=(function(){var self=this.ptr;return _emscripten_bind_btContactSolverInfo_get_m_splitImpulsePenetrationThreshold_0(self)});btContactSolverInfo.prototype["set_m_splitImpulsePenetrationThreshold"]=btContactSolverInfo.prototype.set_m_splitImpulsePenetrationThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btContactSolverInfo_set_m_splitImpulsePenetrationThreshold_1(self,arg0)});btContactSolverInfo.prototype["__destroy__"]=btContactSolverInfo.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btContactSolverInfo___destroy___0(self)});function btOverlappingPairCache(){throw"cannot construct a btOverlappingPairCache, no constructor in IDL"}btOverlappingPairCache.prototype=Object.create(WrapperObject.prototype);btOverlappingPairCache.prototype.constructor=btOverlappingPairCache;btOverlappingPairCache.prototype.__class__=btOverlappingPairCache;btOverlappingPairCache.__cache__={};Module["btOverlappingPairCache"]=btOverlappingPairCache;btOverlappingPairCache.prototype["setInternalGhostPairCallback"]=btOverlappingPairCache.prototype.setInternalGhostPairCallback=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btOverlappingPairCache_setInternalGhostPairCallback_1(self,arg0)});btOverlappingPairCache.prototype["__destroy__"]=btOverlappingPairCache.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btOverlappingPairCache___destroy___0(self)});function btVector3(arg0,arg1,arg2){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg0===undefined){this.ptr=_emscripten_bind_btVector3_btVector3_0();getCache(btVector3)[this.ptr]=this;return}if(arg1===undefined){this.ptr=_emscripten_bind_btVector3_btVector3_1(arg0);getCache(btVector3)[this.ptr]=this;return}if(arg2===undefined){this.ptr=_emscripten_bind_btVector3_btVector3_2(arg0,arg1);getCache(btVector3)[this.ptr]=this;return}this.ptr=_emscripten_bind_btVector3_btVector3_3(arg0,arg1,arg2);getCache(btVector3)[this.ptr]=this}btVector3.prototype=Object.create(WrapperObject.prototype);btVector3.prototype.constructor=btVector3;btVector3.prototype.__class__=btVector3;btVector3.__cache__={};Module["btVector3"]=btVector3;btVector3.prototype["length"]=btVector3.prototype.length=(function(){var self=this.ptr;return _emscripten_bind_btVector3_length_0(self)});btVector3.prototype["x"]=btVector3.prototype.x=(function(){var self=this.ptr;return _emscripten_bind_btVector3_x_0(self)});btVector3.prototype["y"]=btVector3.prototype.y=(function(){var self=this.ptr;return _emscripten_bind_btVector3_y_0(self)});btVector3.prototype["z"]=btVector3.prototype.z=(function(){var self=this.ptr;return _emscripten_bind_btVector3_z_0(self)});btVector3.prototype["setX"]=btVector3.prototype.setX=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVector3_setX_1(self,arg0)});btVector3.prototype["setY"]=btVector3.prototype.setY=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVector3_setY_1(self,arg0)});btVector3.prototype["setZ"]=btVector3.prototype.setZ=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVector3_setZ_1(self,arg0)});btVector3.prototype["setValue"]=btVector3.prototype.setValue=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btVector3_setValue_3(self,arg0,arg1,arg2)});btVector3.prototype["op_mul"]=btVector3.prototype.op_mul=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btVector3_op_mul_1(self,arg0),btVector3)});btVector3.prototype["__destroy__"]=btVector3.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btVector3___destroy___0(self)});function btVehicleRaycaster(){throw"cannot construct a btVehicleRaycaster, no constructor in IDL"}btVehicleRaycaster.prototype=Object.create(WrapperObject.prototype);btVehicleRaycaster.prototype.constructor=btVehicleRaycaster;btVehicleRaycaster.prototype.__class__=btVehicleRaycaster;btVehicleRaycaster.__cache__={};Module["btVehicleRaycaster"]=btVehicleRaycaster;btVehicleRaycaster.prototype["__destroy__"]=btVehicleRaycaster.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btVehicleRaycaster___destroy___0(self)});function btSphereShape(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);this.ptr=_emscripten_bind_btSphereShape_btSphereShape_1(arg0);getCache(btSphereShape)[this.ptr]=this}btSphereShape.prototype=Object.create(btCollisionShape.prototype);btSphereShape.prototype.constructor=btSphereShape;btSphereShape.prototype.__class__=btSphereShape;btSphereShape.__cache__={};Module["btSphereShape"]=btSphereShape;btSphereShape.prototype["setLocalScaling"]=btSphereShape.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btSphereShape_setLocalScaling_1(self,arg0)});btSphereShape.prototype["calculateLocalInertia"]=btSphereShape.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btSphereShape_calculateLocalInertia_2(self,arg0,arg1)});btSphereShape.prototype["__destroy__"]=btSphereShape.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btSphereShape___destroy___0(self)});function btDefaultCollisionConstructionInfo(){this.ptr=_emscripten_bind_btDefaultCollisionConstructionInfo_btDefaultCollisionConstructionInfo_0();getCache(btDefaultCollisionConstructionInfo)[this.ptr]=this}btDefaultCollisionConstructionInfo.prototype=Object.create(WrapperObject.prototype);btDefaultCollisionConstructionInfo.prototype.constructor=btDefaultCollisionConstructionInfo;btDefaultCollisionConstructionInfo.prototype.__class__=btDefaultCollisionConstructionInfo;btDefaultCollisionConstructionInfo.__cache__={};Module["btDefaultCollisionConstructionInfo"]=btDefaultCollisionConstructionInfo;btDefaultCollisionConstructionInfo.prototype["__destroy__"]=btDefaultCollisionConstructionInfo.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btDefaultCollisionConstructionInfo___destroy___0(self)});function btHingeConstraint(arg0,arg1,arg2,arg3,arg4,arg5,arg6){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);if(arg5&&typeof arg5==="object")arg5=arg5.ptr;else arg5=ensureString(arg5);if(arg6&&typeof arg6==="object")arg6=arg6.ptr;else arg6=ensureString(arg6);if(arg2===undefined){this.ptr=_emscripten_bind_btHingeConstraint_btHingeConstraint_2(arg0,arg1);getCache(btHingeConstraint)[this.ptr]=this;return}if(arg3===undefined){this.ptr=_emscripten_bind_btHingeConstraint_btHingeConstraint_3(arg0,arg1,arg2);getCache(btHingeConstraint)[this.ptr]=this;return}if(arg4===undefined){this.ptr=_emscripten_bind_btHingeConstraint_btHingeConstraint_4(arg0,arg1,arg2,arg3);getCache(btHingeConstraint)[this.ptr]=this;return}if(arg5===undefined){this.ptr=_emscripten_bind_btHingeConstraint_btHingeConstraint_5(arg0,arg1,arg2,arg3,arg4);getCache(btHingeConstraint)[this.ptr]=this;return}if(arg6===undefined){this.ptr=_emscripten_bind_btHingeConstraint_btHingeConstraint_6(arg0,arg1,arg2,arg3,arg4,arg5);getCache(btHingeConstraint)[this.ptr]=this;return}this.ptr=_emscripten_bind_btHingeConstraint_btHingeConstraint_7(arg0,arg1,arg2,arg3,arg4,arg5,arg6);getCache(btHingeConstraint)[this.ptr]=this}btHingeConstraint.prototype=Object.create(btTypedConstraint.prototype);btHingeConstraint.prototype.constructor=btHingeConstraint;btHingeConstraint.prototype.__class__=btHingeConstraint;btHingeConstraint.__cache__={};Module["btHingeConstraint"]=btHingeConstraint;btHingeConstraint.prototype["setLimit"]=btHingeConstraint.prototype.setLimit=(function(arg0,arg1,arg2,arg3,arg4){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);if(arg4===undefined){_emscripten_bind_btHingeConstraint_setLimit_4(self,arg0,arg1,arg2,arg3);return}_emscripten_bind_btHingeConstraint_setLimit_5(self,arg0,arg1,arg2,arg3,arg4)});btHingeConstraint.prototype["enableAngularMotor"]=btHingeConstraint.prototype.enableAngularMotor=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btHingeConstraint_enableAngularMotor_3(self,arg0,arg1,arg2)});btHingeConstraint.prototype["enableFeedback"]=btHingeConstraint.prototype.enableFeedback=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btHingeConstraint_enableFeedback_1(self,arg0)});btHingeConstraint.prototype["getBreakingImpulseThreshold"]=btHingeConstraint.prototype.getBreakingImpulseThreshold=(function(){var self=this.ptr;return _emscripten_bind_btHingeConstraint_getBreakingImpulseThreshold_0(self)});btHingeConstraint.prototype["setBreakingImpulseThreshold"]=btHingeConstraint.prototype.setBreakingImpulseThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btHingeConstraint_setBreakingImpulseThreshold_1(self,arg0)});btHingeConstraint.prototype["__destroy__"]=btHingeConstraint.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btHingeConstraint___destroy___0(self)});function btCollisionShape(){throw"cannot construct a btCollisionShape, no constructor in IDL"}btCollisionShape.prototype=Object.create(WrapperObject.prototype);btCollisionShape.prototype.constructor=btCollisionShape;btCollisionShape.prototype.__class__=btCollisionShape;btCollisionShape.__cache__={};Module["btCollisionShape"]=btCollisionShape;btCollisionShape.prototype["setLocalScaling"]=btCollisionShape.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionShape_setLocalScaling_1(self,arg0)});btCollisionShape.prototype["calculateLocalInertia"]=btCollisionShape.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCollisionShape_calculateLocalInertia_2(self,arg0,arg1)});btCollisionShape.prototype["__destroy__"]=btCollisionShape.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btCollisionShape___destroy___0(self)});function btConstraintSetting(){this.ptr=_emscripten_bind_btConstraintSetting_btConstraintSetting_0();getCache(btConstraintSetting)[this.ptr]=this}btConstraintSetting.prototype=Object.create(WrapperObject.prototype);btConstraintSetting.prototype.constructor=btConstraintSetting;btConstraintSetting.prototype.__class__=btConstraintSetting;btConstraintSetting.__cache__={};Module["btConstraintSetting"]=btConstraintSetting;btConstraintSetting.prototype["get_m_tau"]=btConstraintSetting.prototype.get_m_tau=(function(){var self=this.ptr;return _emscripten_bind_btConstraintSetting_get_m_tau_0(self)});btConstraintSetting.prototype["set_m_tau"]=btConstraintSetting.prototype.set_m_tau=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConstraintSetting_set_m_tau_1(self,arg0)});btConstraintSetting.prototype["get_m_damping"]=btConstraintSetting.prototype.get_m_damping=(function(){var self=this.ptr;return _emscripten_bind_btConstraintSetting_get_m_damping_0(self)});btConstraintSetting.prototype["set_m_damping"]=btConstraintSetting.prototype.set_m_damping=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConstraintSetting_set_m_damping_1(self,arg0)});btConstraintSetting.prototype["get_m_impulseClamp"]=btConstraintSetting.prototype.get_m_impulseClamp=(function(){var self=this.ptr;return _emscripten_bind_btConstraintSetting_get_m_impulseClamp_0(self)});btConstraintSetting.prototype["set_m_impulseClamp"]=btConstraintSetting.prototype.set_m_impulseClamp=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConstraintSetting_set_m_impulseClamp_1(self,arg0)});btConstraintSetting.prototype["__destroy__"]=btConstraintSetting.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btConstraintSetting___destroy___0(self)});function btGhostObject(){this.ptr=_emscripten_bind_btGhostObject_btGhostObject_0();getCache(btGhostObject)[this.ptr]=this}btGhostObject.prototype=Object.create(btCollisionObject.prototype);btGhostObject.prototype.constructor=btGhostObject;btGhostObject.prototype.__class__=btGhostObject;btGhostObject.__cache__={};Module["btGhostObject"]=btGhostObject;btGhostObject.prototype["getNumOverlappingObjects"]=btGhostObject.prototype.getNumOverlappingObjects=(function(){var self=this.ptr;return _emscripten_bind_btGhostObject_getNumOverlappingObjects_0(self)});btGhostObject.prototype["getOverlappingObject"]=btGhostObject.prototype.getOverlappingObject=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btGhostObject_getOverlappingObject_1(self,arg0),btCollisionObject)});btGhostObject.prototype["setAnisotropicFriction"]=btGhostObject.prototype.setAnisotropicFriction=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btGhostObject_setAnisotropicFriction_2(self,arg0,arg1)});btGhostObject.prototype["getCollisionShape"]=btGhostObject.prototype.getCollisionShape=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btGhostObject_getCollisionShape_0(self),btCollisionShape)});btGhostObject.prototype["setContactProcessingThreshold"]=btGhostObject.prototype.setContactProcessingThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_setContactProcessingThreshold_1(self,arg0)});btGhostObject.prototype["setActivationState"]=btGhostObject.prototype.setActivationState=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_setActivationState_1(self,arg0)});btGhostObject.prototype["forceActivationState"]=btGhostObject.prototype.forceActivationState=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_forceActivationState_1(self,arg0)});btGhostObject.prototype["activate"]=btGhostObject.prototype.activate=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg0===undefined){_emscripten_bind_btGhostObject_activate_0(self);return}_emscripten_bind_btGhostObject_activate_1(self,arg0)});btGhostObject.prototype["isActive"]=btGhostObject.prototype.isActive=(function(){var self=this.ptr;return _emscripten_bind_btGhostObject_isActive_0(self)});btGhostObject.prototype["isKinematicObject"]=btGhostObject.prototype.isKinematicObject=(function(){var self=this.ptr;return _emscripten_bind_btGhostObject_isKinematicObject_0(self)});btGhostObject.prototype["setRestitution"]=btGhostObject.prototype.setRestitution=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_setRestitution_1(self,arg0)});btGhostObject.prototype["setFriction"]=btGhostObject.prototype.setFriction=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_setFriction_1(self,arg0)});btGhostObject.prototype["setRollingFriction"]=btGhostObject.prototype.setRollingFriction=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_setRollingFriction_1(self,arg0)});btGhostObject.prototype["getWorldTransform"]=btGhostObject.prototype.getWorldTransform=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btGhostObject_getWorldTransform_0(self),btTransform)});btGhostObject.prototype["getCollisionFlags"]=btGhostObject.prototype.getCollisionFlags=(function(){var self=this.ptr;return _emscripten_bind_btGhostObject_getCollisionFlags_0(self)});btGhostObject.prototype["setCollisionFlags"]=btGhostObject.prototype.setCollisionFlags=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_setCollisionFlags_1(self,arg0)});btGhostObject.prototype["setWorldTransform"]=btGhostObject.prototype.setWorldTransform=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_setWorldTransform_1(self,arg0)});btGhostObject.prototype["setCollisionShape"]=btGhostObject.prototype.setCollisionShape=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_setCollisionShape_1(self,arg0)});btGhostObject.prototype["setCcdMotionThreshold"]=btGhostObject.prototype.setCcdMotionThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_setCcdMotionThreshold_1(self,arg0)});btGhostObject.prototype["setCcdSweptSphereRadius"]=btGhostObject.prototype.setCcdSweptSphereRadius=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_setCcdSweptSphereRadius_1(self,arg0)});btGhostObject.prototype["__destroy__"]=btGhostObject.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btGhostObject___destroy___0(self)});function LocalShapeInfo(){throw"cannot construct a LocalShapeInfo, no constructor in IDL"}LocalShapeInfo.prototype=Object.create(WrapperObject.prototype);LocalShapeInfo.prototype.constructor=LocalShapeInfo;LocalShapeInfo.prototype.__class__=LocalShapeInfo;LocalShapeInfo.__cache__={};Module["LocalShapeInfo"]=LocalShapeInfo;LocalShapeInfo.prototype["get_m_shapePart"]=LocalShapeInfo.prototype.get_m_shapePart=(function(){var self=this.ptr;return _emscripten_bind_LocalShapeInfo_get_m_shapePart_0(self)});LocalShapeInfo.prototype["set_m_shapePart"]=LocalShapeInfo.prototype.set_m_shapePart=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_LocalShapeInfo_set_m_shapePart_1(self,arg0)});LocalShapeInfo.prototype["get_m_triangleIndex"]=LocalShapeInfo.prototype.get_m_triangleIndex=(function(){var self=this.ptr;return _emscripten_bind_LocalShapeInfo_get_m_triangleIndex_0(self)});LocalShapeInfo.prototype["set_m_triangleIndex"]=LocalShapeInfo.prototype.set_m_triangleIndex=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_LocalShapeInfo_set_m_triangleIndex_1(self,arg0)});LocalShapeInfo.prototype["__destroy__"]=LocalShapeInfo.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_LocalShapeInfo___destroy___0(self)});function btConstraintSolver(){throw"cannot construct a btConstraintSolver, no constructor in IDL"}btConstraintSolver.prototype=Object.create(WrapperObject.prototype);btConstraintSolver.prototype.constructor=btConstraintSolver;btConstraintSolver.prototype.__class__=btConstraintSolver;btConstraintSolver.__cache__={};Module["btConstraintSolver"]=btConstraintSolver;btConstraintSolver.prototype["__destroy__"]=btConstraintSolver.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btConstraintSolver___destroy___0(self)});function btGeneric6DofSpringConstraint(arg0,arg1,arg2,arg3,arg4){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);if(arg3===undefined){this.ptr=_emscripten_bind_btGeneric6DofSpringConstraint_btGeneric6DofSpringConstraint_3(arg0,arg1,arg2);getCache(btGeneric6DofSpringConstraint)[this.ptr]=this;return}if(arg4===undefined){this.ptr=_emscripten_bind_btGeneric6DofSpringConstraint_btGeneric6DofSpringConstraint_4(arg0,arg1,arg2,arg3);getCache(btGeneric6DofSpringConstraint)[this.ptr]=this;return}this.ptr=_emscripten_bind_btGeneric6DofSpringConstraint_btGeneric6DofSpringConstraint_5(arg0,arg1,arg2,arg3,arg4);getCache(btGeneric6DofSpringConstraint)[this.ptr]=this}btGeneric6DofSpringConstraint.prototype=Object.create(btGeneric6DofConstraint.prototype);btGeneric6DofSpringConstraint.prototype.constructor=btGeneric6DofSpringConstraint;btGeneric6DofSpringConstraint.prototype.__class__=btGeneric6DofSpringConstraint;btGeneric6DofSpringConstraint.__cache__={};Module["btGeneric6DofSpringConstraint"]=btGeneric6DofSpringConstraint;btGeneric6DofSpringConstraint.prototype["enableSpring"]=btGeneric6DofSpringConstraint.prototype.enableSpring=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btGeneric6DofSpringConstraint_enableSpring_2(self,arg0,arg1)});btGeneric6DofSpringConstraint.prototype["setStiffness"]=btGeneric6DofSpringConstraint.prototype.setStiffness=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btGeneric6DofSpringConstraint_setStiffness_2(self,arg0,arg1)});btGeneric6DofSpringConstraint.prototype["setDamping"]=btGeneric6DofSpringConstraint.prototype.setDamping=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btGeneric6DofSpringConstraint_setDamping_2(self,arg0,arg1)});btGeneric6DofSpringConstraint.prototype["setLinearLowerLimit"]=btGeneric6DofSpringConstraint.prototype.setLinearLowerLimit=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGeneric6DofSpringConstraint_setLinearLowerLimit_1(self,arg0)});btGeneric6DofSpringConstraint.prototype["setLinearUpperLimit"]=btGeneric6DofSpringConstraint.prototype.setLinearUpperLimit=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGeneric6DofSpringConstraint_setLinearUpperLimit_1(self,arg0)});btGeneric6DofSpringConstraint.prototype["setAngularLowerLimit"]=btGeneric6DofSpringConstraint.prototype.setAngularLowerLimit=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGeneric6DofSpringConstraint_setAngularLowerLimit_1(self,arg0)});btGeneric6DofSpringConstraint.prototype["setAngularUpperLimit"]=btGeneric6DofSpringConstraint.prototype.setAngularUpperLimit=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGeneric6DofSpringConstraint_setAngularUpperLimit_1(self,arg0)});btGeneric6DofSpringConstraint.prototype["enableFeedback"]=btGeneric6DofSpringConstraint.prototype.enableFeedback=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGeneric6DofSpringConstraint_enableFeedback_1(self,arg0)});btGeneric6DofSpringConstraint.prototype["getBreakingImpulseThreshold"]=btGeneric6DofSpringConstraint.prototype.getBreakingImpulseThreshold=(function(){var self=this.ptr;return _emscripten_bind_btGeneric6DofSpringConstraint_getBreakingImpulseThreshold_0(self)});btGeneric6DofSpringConstraint.prototype["setBreakingImpulseThreshold"]=btGeneric6DofSpringConstraint.prototype.setBreakingImpulseThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGeneric6DofSpringConstraint_setBreakingImpulseThreshold_1(self,arg0)});btGeneric6DofSpringConstraint.prototype["__destroy__"]=btGeneric6DofSpringConstraint.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btGeneric6DofSpringConstraint___destroy___0(self)});function LocalConvexResult(arg0,arg1,arg2,arg3,arg4){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);this.ptr=_emscripten_bind_LocalConvexResult_LocalConvexResult_5(arg0,arg1,arg2,arg3,arg4);getCache(LocalConvexResult)[this.ptr]=this}LocalConvexResult.prototype=Object.create(WrapperObject.prototype);LocalConvexResult.prototype.constructor=LocalConvexResult;LocalConvexResult.prototype.__class__=LocalConvexResult;LocalConvexResult.__cache__={};Module["LocalConvexResult"]=LocalConvexResult;LocalConvexResult.prototype["get_m_hitCollisionObject"]=LocalConvexResult.prototype.get_m_hitCollisionObject=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_LocalConvexResult_get_m_hitCollisionObject_0(self),btCollisionObject)});LocalConvexResult.prototype["set_m_hitCollisionObject"]=LocalConvexResult.prototype.set_m_hitCollisionObject=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_LocalConvexResult_set_m_hitCollisionObject_1(self,arg0)});LocalConvexResult.prototype["get_m_localShapeInfo"]=LocalConvexResult.prototype.get_m_localShapeInfo=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_LocalConvexResult_get_m_localShapeInfo_0(self),LocalShapeInfo)});LocalConvexResult.prototype["set_m_localShapeInfo"]=LocalConvexResult.prototype.set_m_localShapeInfo=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_LocalConvexResult_set_m_localShapeInfo_1(self,arg0)});LocalConvexResult.prototype["get_m_hitNormalLocal"]=LocalConvexResult.prototype.get_m_hitNormalLocal=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_LocalConvexResult_get_m_hitNormalLocal_0(self),btVector3)});LocalConvexResult.prototype["set_m_hitNormalLocal"]=LocalConvexResult.prototype.set_m_hitNormalLocal=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_LocalConvexResult_set_m_hitNormalLocal_1(self,arg0)});LocalConvexResult.prototype["get_m_hitPointLocal"]=LocalConvexResult.prototype.get_m_hitPointLocal=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_LocalConvexResult_get_m_hitPointLocal_0(self),btVector3)});LocalConvexResult.prototype["set_m_hitPointLocal"]=LocalConvexResult.prototype.set_m_hitPointLocal=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_LocalConvexResult_set_m_hitPointLocal_1(self,arg0)});LocalConvexResult.prototype["get_m_hitFraction"]=LocalConvexResult.prototype.get_m_hitFraction=(function(){var self=this.ptr;return _emscripten_bind_LocalConvexResult_get_m_hitFraction_0(self)});LocalConvexResult.prototype["set_m_hitFraction"]=LocalConvexResult.prototype.set_m_hitFraction=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_LocalConvexResult_set_m_hitFraction_1(self,arg0)});LocalConvexResult.prototype["__destroy__"]=LocalConvexResult.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_LocalConvexResult___destroy___0(self)});function btOverlappingPairCallback(){throw"cannot construct a btOverlappingPairCallback, no constructor in IDL"}btOverlappingPairCallback.prototype=Object.create(WrapperObject.prototype);btOverlappingPairCallback.prototype.constructor=btOverlappingPairCallback;btOverlappingPairCallback.prototype.__class__=btOverlappingPairCallback;btOverlappingPairCallback.__cache__={};Module["btOverlappingPairCallback"]=btOverlappingPairCallback;btOverlappingPairCallback.prototype["__destroy__"]=btOverlappingPairCallback.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btOverlappingPairCallback___destroy___0(self)});function btRigidBody(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);this.ptr=_emscripten_bind_btRigidBody_btRigidBody_1(arg0);getCache(btRigidBody)[this.ptr]=this}btRigidBody.prototype=Object.create(btCollisionObject.prototype);btRigidBody.prototype.constructor=btRigidBody;btRigidBody.prototype.__class__=btRigidBody;btRigidBody.__cache__={};Module["btRigidBody"]=btRigidBody;btRigidBody.prototype["getCenterOfMassTransform"]=btRigidBody.prototype.getCenterOfMassTransform=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btRigidBody_getCenterOfMassTransform_0(self),btTransform)});btRigidBody.prototype["setCenterOfMassTransform"]=btRigidBody.prototype.setCenterOfMassTransform=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setCenterOfMassTransform_1(self,arg0)});btRigidBody.prototype["setSleepingThresholds"]=btRigidBody.prototype.setSleepingThresholds=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRigidBody_setSleepingThresholds_2(self,arg0,arg1)});btRigidBody.prototype["setDamping"]=btRigidBody.prototype.setDamping=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRigidBody_setDamping_2(self,arg0,arg1)});btRigidBody.prototype["setMassProps"]=btRigidBody.prototype.setMassProps=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRigidBody_setMassProps_2(self,arg0,arg1)});btRigidBody.prototype["setLinearFactor"]=btRigidBody.prototype.setLinearFactor=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setLinearFactor_1(self,arg0)});btRigidBody.prototype["setGravity"]=btRigidBody.prototype.setGravity=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setGravity_1(self,arg0)});btRigidBody.prototype["applyTorque"]=btRigidBody.prototype.applyTorque=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_applyTorque_1(self,arg0)});btRigidBody.prototype["applyForce"]=btRigidBody.prototype.applyForce=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRigidBody_applyForce_2(self,arg0,arg1)});btRigidBody.prototype["applyCentralForce"]=btRigidBody.prototype.applyCentralForce=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_applyCentralForce_1(self,arg0)});btRigidBody.prototype["applyTorqueImpulse"]=btRigidBody.prototype.applyTorqueImpulse=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_applyTorqueImpulse_1(self,arg0)});btRigidBody.prototype["applyImpulse"]=btRigidBody.prototype.applyImpulse=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRigidBody_applyImpulse_2(self,arg0,arg1)});btRigidBody.prototype["applyCentralImpulse"]=btRigidBody.prototype.applyCentralImpulse=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_applyCentralImpulse_1(self,arg0)});btRigidBody.prototype["updateInertiaTensor"]=btRigidBody.prototype.updateInertiaTensor=(function(){var self=this.ptr;_emscripten_bind_btRigidBody_updateInertiaTensor_0(self)});btRigidBody.prototype["getLinearVelocity"]=btRigidBody.prototype.getLinearVelocity=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btRigidBody_getLinearVelocity_0(self),btVector3)});btRigidBody.prototype["getAngularVelocity"]=btRigidBody.prototype.getAngularVelocity=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btRigidBody_getAngularVelocity_0(self),btVector3)});btRigidBody.prototype["getGravity"]=btRigidBody.prototype.getGravity=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btRigidBody_getGravity_0(self),btVector3)});btRigidBody.prototype["setLinearVelocity"]=btRigidBody.prototype.setLinearVelocity=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setLinearVelocity_1(self,arg0)});btRigidBody.prototype["setAngularVelocity"]=btRigidBody.prototype.setAngularVelocity=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setAngularVelocity_1(self,arg0)});btRigidBody.prototype["getMotionState"]=btRigidBody.prototype.getMotionState=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btRigidBody_getMotionState_0(self),btMotionState)});btRigidBody.prototype["setAngularFactor"]=btRigidBody.prototype.setAngularFactor=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setAngularFactor_1(self,arg0)});btRigidBody.prototype["upcast"]=btRigidBody.prototype.upcast=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btRigidBody_upcast_1(self,arg0),btRigidBody)});btRigidBody.prototype["setAnisotropicFriction"]=btRigidBody.prototype.setAnisotropicFriction=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRigidBody_setAnisotropicFriction_2(self,arg0,arg1)});btRigidBody.prototype["getCollisionShape"]=btRigidBody.prototype.getCollisionShape=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btRigidBody_getCollisionShape_0(self),btCollisionShape)});btRigidBody.prototype["setContactProcessingThreshold"]=btRigidBody.prototype.setContactProcessingThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setContactProcessingThreshold_1(self,arg0)});btRigidBody.prototype["setActivationState"]=btRigidBody.prototype.setActivationState=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setActivationState_1(self,arg0)});btRigidBody.prototype["forceActivationState"]=btRigidBody.prototype.forceActivationState=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_forceActivationState_1(self,arg0)});btRigidBody.prototype["activate"]=btRigidBody.prototype.activate=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg0===undefined){_emscripten_bind_btRigidBody_activate_0(self);return}_emscripten_bind_btRigidBody_activate_1(self,arg0)});btRigidBody.prototype["isActive"]=btRigidBody.prototype.isActive=(function(){var self=this.ptr;return _emscripten_bind_btRigidBody_isActive_0(self)});btRigidBody.prototype["isKinematicObject"]=btRigidBody.prototype.isKinematicObject=(function(){var self=this.ptr;return _emscripten_bind_btRigidBody_isKinematicObject_0(self)});btRigidBody.prototype["setRestitution"]=btRigidBody.prototype.setRestitution=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setRestitution_1(self,arg0)});btRigidBody.prototype["setFriction"]=btRigidBody.prototype.setFriction=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setFriction_1(self,arg0)});btRigidBody.prototype["setRollingFriction"]=btRigidBody.prototype.setRollingFriction=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setRollingFriction_1(self,arg0)});btRigidBody.prototype["getWorldTransform"]=btRigidBody.prototype.getWorldTransform=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btRigidBody_getWorldTransform_0(self),btTransform)});btRigidBody.prototype["getCollisionFlags"]=btRigidBody.prototype.getCollisionFlags=(function(){var self=this.ptr;return _emscripten_bind_btRigidBody_getCollisionFlags_0(self)});btRigidBody.prototype["setCollisionFlags"]=btRigidBody.prototype.setCollisionFlags=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setCollisionFlags_1(self,arg0)});btRigidBody.prototype["setWorldTransform"]=btRigidBody.prototype.setWorldTransform=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setWorldTransform_1(self,arg0)});btRigidBody.prototype["setCollisionShape"]=btRigidBody.prototype.setCollisionShape=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setCollisionShape_1(self,arg0)});btRigidBody.prototype["setCcdMotionThreshold"]=btRigidBody.prototype.setCcdMotionThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setCcdMotionThreshold_1(self,arg0)});btRigidBody.prototype["setCcdSweptSphereRadius"]=btRigidBody.prototype.setCcdSweptSphereRadius=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setCcdSweptSphereRadius_1(self,arg0)});btRigidBody.prototype["__destroy__"]=btRigidBody.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btRigidBody___destroy___0(self)});function btCylinderShapeX(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);this.ptr=_emscripten_bind_btCylinderShapeX_btCylinderShapeX_1(arg0);getCache(btCylinderShapeX)[this.ptr]=this}btCylinderShapeX.prototype=Object.create(btCylinderShape.prototype);btCylinderShapeX.prototype.constructor=btCylinderShapeX;btCylinderShapeX.prototype.__class__=btCylinderShapeX;btCylinderShapeX.__cache__={};Module["btCylinderShapeX"]=btCylinderShapeX;btCylinderShapeX.prototype["setLocalScaling"]=btCylinderShapeX.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCylinderShapeX_setLocalScaling_1(self,arg0)});btCylinderShapeX.prototype["calculateLocalInertia"]=btCylinderShapeX.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCylinderShapeX_calculateLocalInertia_2(self,arg0,arg1)});btCylinderShapeX.prototype["__destroy__"]=btCylinderShapeX.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btCylinderShapeX___destroy___0(self)});function btCylinderShapeZ(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);this.ptr=_emscripten_bind_btCylinderShapeZ_btCylinderShapeZ_1(arg0);getCache(btCylinderShapeZ)[this.ptr]=this}btCylinderShapeZ.prototype=Object.create(btCylinderShape.prototype);btCylinderShapeZ.prototype.constructor=btCylinderShapeZ;btCylinderShapeZ.prototype.__class__=btCylinderShapeZ;btCylinderShapeZ.__cache__={};Module["btCylinderShapeZ"]=btCylinderShapeZ;btCylinderShapeZ.prototype["setLocalScaling"]=btCylinderShapeZ.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCylinderShapeZ_setLocalScaling_1(self,arg0)});btCylinderShapeZ.prototype["calculateLocalInertia"]=btCylinderShapeZ.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCylinderShapeZ_calculateLocalInertia_2(self,arg0,arg1)});btCylinderShapeZ.prototype["__destroy__"]=btCylinderShapeZ.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btCylinderShapeZ___destroy___0(self)});function btTransform(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg0===undefined){this.ptr=_emscripten_bind_btTransform_btTransform_0();getCache(btTransform)[this.ptr]=this;return}if(arg1===undefined){this.ptr=_emscripten_bind_btTransform_btTransform_1(arg0);getCache(btTransform)[this.ptr]=this;return}this.ptr=_emscripten_bind_btTransform_btTransform_2(arg0,arg1);getCache(btTransform)[this.ptr]=this}btTransform.prototype=Object.create(WrapperObject.prototype);btTransform.prototype.constructor=btTransform;btTransform.prototype.__class__=btTransform;btTransform.__cache__={};Module["btTransform"]=btTransform;btTransform.prototype["setIdentity"]=btTransform.prototype.setIdentity=(function(){var self=this.ptr;_emscripten_bind_btTransform_setIdentity_0(self)});btTransform.prototype["setOrigin"]=btTransform.prototype.setOrigin=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btTransform_setOrigin_1(self,arg0)});btTransform.prototype["setRotation"]=btTransform.prototype.setRotation=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btTransform_setRotation_1(self,arg0)});btTransform.prototype["getOrigin"]=btTransform.prototype.getOrigin=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btTransform_getOrigin_0(self),btVector3)});btTransform.prototype["getRotation"]=btTransform.prototype.getRotation=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btTransform_getRotation_0(self),btQuaternion)});btTransform.prototype["getBasis"]=btTransform.prototype.getBasis=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btTransform_getBasis_0(self),btMatrix3x3)});btTransform.prototype["__destroy__"]=btTransform.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btTransform___destroy___0(self)});function btCollisionWorld(){throw"cannot construct a btCollisionWorld, no constructor in IDL"}btCollisionWorld.prototype=Object.create(WrapperObject.prototype);btCollisionWorld.prototype.constructor=btCollisionWorld;btCollisionWorld.prototype.__class__=btCollisionWorld;btCollisionWorld.__cache__={};Module["btCollisionWorld"]=btCollisionWorld;btCollisionWorld.prototype["getDispatcher"]=btCollisionWorld.prototype.getDispatcher=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btCollisionWorld_getDispatcher_0(self),btDispatcher)});btCollisionWorld.prototype["computeOverlappingPairs"]=btCollisionWorld.prototype.computeOverlappingPairs=(function(){var self=this.ptr;_emscripten_bind_btCollisionWorld_computeOverlappingPairs_0(self)});btCollisionWorld.prototype["performDiscreteCollisionDetection"]=btCollisionWorld.prototype.performDiscreteCollisionDetection=(function(){var self=this.ptr;_emscripten_bind_btCollisionWorld_performDiscreteCollisionDetection_0(self)});btCollisionWorld.prototype["rayTest"]=btCollisionWorld.prototype.rayTest=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btCollisionWorld_rayTest_3(self,arg0,arg1,arg2)});btCollisionWorld.prototype["getPairCache"]=btCollisionWorld.prototype.getPairCache=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btCollisionWorld_getPairCache_0(self),btOverlappingPairCache)});btCollisionWorld.prototype["getDispatchInfo"]=btCollisionWorld.prototype.getDispatchInfo=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btCollisionWorld_getDispatchInfo_0(self),btDispatcherInfo)});btCollisionWorld.prototype["addCollisionObject"]=btCollisionWorld.prototype.addCollisionObject=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg1===undefined){_emscripten_bind_btCollisionWorld_addCollisionObject_1(self,arg0);return}if(arg2===undefined){_emscripten_bind_btCollisionWorld_addCollisionObject_2(self,arg0,arg1);return}_emscripten_bind_btCollisionWorld_addCollisionObject_3(self,arg0,arg1,arg2)});btCollisionWorld.prototype["getBroadphase"]=btCollisionWorld.prototype.getBroadphase=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btCollisionWorld_getBroadphase_0(self),btBroadphaseInterface)});btCollisionWorld.prototype["convexSweepTest"]=btCollisionWorld.prototype.convexSweepTest=(function(arg0,arg1,arg2,arg3,arg4){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);_emscripten_bind_btCollisionWorld_convexSweepTest_5(self,arg0,arg1,arg2,arg3,arg4)});btCollisionWorld.prototype["contactPairTest"]=btCollisionWorld.prototype.contactPairTest=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btCollisionWorld_contactPairTest_3(self,arg0,arg1,arg2)});btCollisionWorld.prototype["__destroy__"]=btCollisionWorld.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btCollisionWorld___destroy___0(self)});function btQuadWord(){throw"cannot construct a btQuadWord, no constructor in IDL"}btQuadWord.prototype=Object.create(WrapperObject.prototype);btQuadWord.prototype.constructor=btQuadWord;btQuadWord.prototype.__class__=btQuadWord;btQuadWord.__cache__={};Module["btQuadWord"]=btQuadWord;btQuadWord.prototype["x"]=btQuadWord.prototype.x=(function(){var self=this.ptr;return _emscripten_bind_btQuadWord_x_0(self)});btQuadWord.prototype["y"]=btQuadWord.prototype.y=(function(){var self=this.ptr;return _emscripten_bind_btQuadWord_y_0(self)});btQuadWord.prototype["z"]=btQuadWord.prototype.z=(function(){var self=this.ptr;return _emscripten_bind_btQuadWord_z_0(self)});btQuadWord.prototype["w"]=btQuadWord.prototype.w=(function(){var self=this.ptr;return _emscripten_bind_btQuadWord_w_0(self)});btQuadWord.prototype["setX"]=btQuadWord.prototype.setX=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btQuadWord_setX_1(self,arg0)});btQuadWord.prototype["setY"]=btQuadWord.prototype.setY=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btQuadWord_setY_1(self,arg0)});btQuadWord.prototype["setZ"]=btQuadWord.prototype.setZ=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btQuadWord_setZ_1(self,arg0)});btQuadWord.prototype["setW"]=btQuadWord.prototype.setW=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btQuadWord_setW_1(self,arg0)});btQuadWord.prototype["__destroy__"]=btQuadWord.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btQuadWord___destroy___0(self)});function btRaycastVehicle(arg0,arg1,arg2){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);this.ptr=_emscripten_bind_btRaycastVehicle_btRaycastVehicle_3(arg0,arg1,arg2);getCache(btRaycastVehicle)[this.ptr]=this}btRaycastVehicle.prototype=Object.create(btActionInterface.prototype);btRaycastVehicle.prototype.constructor=btRaycastVehicle;btRaycastVehicle.prototype.__class__=btRaycastVehicle;btRaycastVehicle.__cache__={};Module["btRaycastVehicle"]=btRaycastVehicle;btRaycastVehicle.prototype["applyEngineForce"]=btRaycastVehicle.prototype.applyEngineForce=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRaycastVehicle_applyEngineForce_2(self,arg0,arg1)});btRaycastVehicle.prototype["setSteeringValue"]=btRaycastVehicle.prototype.setSteeringValue=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRaycastVehicle_setSteeringValue_2(self,arg0,arg1)});btRaycastVehicle.prototype["getWheelTransformWS"]=btRaycastVehicle.prototype.getWheelTransformWS=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btRaycastVehicle_getWheelTransformWS_1(self,arg0),btTransform)});btRaycastVehicle.prototype["updateWheelTransform"]=btRaycastVehicle.prototype.updateWheelTransform=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRaycastVehicle_updateWheelTransform_2(self,arg0,arg1)});btRaycastVehicle.prototype["addWheel"]=btRaycastVehicle.prototype.addWheel=(function(arg0,arg1,arg2,arg3,arg4,arg5,arg6){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);if(arg5&&typeof arg5==="object")arg5=arg5.ptr;else arg5=ensureString(arg5);if(arg6&&typeof arg6==="object")arg6=arg6.ptr;else arg6=ensureString(arg6);return wrapPointer(_emscripten_bind_btRaycastVehicle_addWheel_7(self,arg0,arg1,arg2,arg3,arg4,arg5,arg6),btWheelInfo)});btRaycastVehicle.prototype["getNumWheels"]=btRaycastVehicle.prototype.getNumWheels=(function(){var self=this.ptr;return _emscripten_bind_btRaycastVehicle_getNumWheels_0(self)});btRaycastVehicle.prototype["getRigidBody"]=btRaycastVehicle.prototype.getRigidBody=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btRaycastVehicle_getRigidBody_0(self),btRigidBody)});btRaycastVehicle.prototype["getWheelInfo"]=btRaycastVehicle.prototype.getWheelInfo=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btRaycastVehicle_getWheelInfo_1(self,arg0),btWheelInfo)});btRaycastVehicle.prototype["setBrake"]=btRaycastVehicle.prototype.setBrake=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRaycastVehicle_setBrake_2(self,arg0,arg1)});btRaycastVehicle.prototype["setCoordinateSystem"]=btRaycastVehicle.prototype.setCoordinateSystem=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btRaycastVehicle_setCoordinateSystem_3(self,arg0,arg1,arg2)});btRaycastVehicle.prototype["__destroy__"]=btRaycastVehicle.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btRaycastVehicle___destroy___0(self)});function btCylinderShape(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);this.ptr=_emscripten_bind_btCylinderShape_btCylinderShape_1(arg0);getCache(btCylinderShape)[this.ptr]=this}btCylinderShape.prototype=Object.create(btCollisionShape.prototype);btCylinderShape.prototype.constructor=btCylinderShape;btCylinderShape.prototype.__class__=btCylinderShape;btCylinderShape.__cache__={};Module["btCylinderShape"]=btCylinderShape;btCylinderShape.prototype["setLocalScaling"]=btCylinderShape.prototype.setLocalScaling=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCylinderShape_setLocalScaling_1(self,arg0)});btCylinderShape.prototype["calculateLocalInertia"]=btCylinderShape.prototype.calculateLocalInertia=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCylinderShape_calculateLocalInertia_2(self,arg0,arg1)});btCylinderShape.prototype["__destroy__"]=btCylinderShape.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btCylinderShape___destroy___0(self)});function btActionInterface(){throw"cannot construct a btActionInterface, no constructor in IDL"}btActionInterface.prototype=Object.create(WrapperObject.prototype);btActionInterface.prototype.constructor=btActionInterface;btActionInterface.prototype.__class__=btActionInterface;btActionInterface.__cache__={};Module["btActionInterface"]=btActionInterface;btActionInterface.prototype["__destroy__"]=btActionInterface.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btActionInterface___destroy___0(self)});function btGhostPairCallback(){this.ptr=_emscripten_bind_btGhostPairCallback_btGhostPairCallback_0();getCache(btGhostPairCallback)[this.ptr]=this}btGhostPairCallback.prototype=Object.create(WrapperObject.prototype);btGhostPairCallback.prototype.constructor=btGhostPairCallback;btGhostPairCallback.prototype.__class__=btGhostPairCallback;btGhostPairCallback.__cache__={};Module["btGhostPairCallback"]=btGhostPairCallback;btGhostPairCallback.prototype["__destroy__"]=btGhostPairCallback.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btGhostPairCallback___destroy___0(self)});function btTypedConstraint(){throw"cannot construct a btTypedConstraint, no constructor in IDL"}btTypedConstraint.prototype=Object.create(WrapperObject.prototype);btTypedConstraint.prototype.constructor=btTypedConstraint;btTypedConstraint.prototype.__class__=btTypedConstraint;btTypedConstraint.__cache__={};Module["btTypedConstraint"]=btTypedConstraint;btTypedConstraint.prototype["enableFeedback"]=btTypedConstraint.prototype.enableFeedback=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btTypedConstraint_enableFeedback_1(self,arg0)});btTypedConstraint.prototype["getBreakingImpulseThreshold"]=btTypedConstraint.prototype.getBreakingImpulseThreshold=(function(){var self=this.ptr;return _emscripten_bind_btTypedConstraint_getBreakingImpulseThreshold_0(self)});btTypedConstraint.prototype["setBreakingImpulseThreshold"]=btTypedConstraint.prototype.setBreakingImpulseThreshold=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btTypedConstraint_setBreakingImpulseThreshold_1(self,arg0)});btTypedConstraint.prototype["__destroy__"]=btTypedConstraint.prototype.__destroy__=(function(){var self=this.ptr;_emscripten_bind_btTypedConstraint___destroy___0(self)});((function(){function setupEnums(){}if(Module["calledRun"])setupEnums();else addOnPreMain(setupEnums)}))();this["Ammo"]=Module





  return Module;
};

Ammo = AmmoLib();


function Base() 
{
    this.userData = "";
    this.className = "";
}

Base.prototype.destroy = function()
{
    delete this;
}

function Allocator()
{
}
//These are created in global scope that way 3Scape can access them
var message = "";
var imgeData = "";
var cimageData = "";
var serializedScene = "";

Allocator.prototype.allocate = function()
{
    return null;
}
function loadBinaryResource(url)
{
    var req = new XMLHttpRequest();
    
    req.open('GET', url, false);
    req.overrideMimeType('text/plain; charset=x-user-defined');
    req.send();
    
    if (req.status != 200)
    {
        return null;
    }
    
    return req.responseText;
}

function loadXMLResource(url)
{
    var req = new XMLHttpRequest();
 
    req.open('GET', url, false);
    req.overrideMimeType('text/plain; charset=x-user-defined');    
    req.send();
    
    if (req.status != 200)
    {
        return null;
    }
    
    return req.responseText;
}

function loadTextResource(url)
{
    var req = new XMLHttpRequest();
 
    req.open('GET', url, false);
    req.overrideMimeType('text/plain; charset=x-user-defined');    
    req.send();
    
    if (req.status != 200)
    {
        return null;
    }
    
    return req.responseText;
}

function isLower(c)
{
    var ascii = c.charCodeAt(0);
    return (ascii > 96 && ascii < 123);
}

function isUpper(c)
{
    var ascii = c.charCodeAt(0);
    return (ascii > 64 && ascii < 91);
}

function isSpace(c)
{
    if (c == ' '  || 
        c == '\f' ||
        c == '\n' ||
        c == '\r' ||
        c == '\t' ||
        c == '\v')
        return true;
        
    return false;
}

// From: http://blog.magnetiq.com/post/514962277/finding-out-class-names-of-javascript-objects
/* Returns the class name of the argument or undefined if
   it's not a valid JavaScript object.
*/
function getObjectClassName(obj) {
    if (obj && obj.constructor && obj.constructor.toString) {
        var arr = obj.constructor.toString().match(
            /function\s*(\w+)/);

        if (arr && arr.length == 2) {
            return arr[1];
        }
        
        // match [method name]
        arr = obj.constructor.toString().split(" ");
        
        if (arr && arr.length == 2) {
            return arr[1].substring(0, arr[1].length-1);
        }
    }

    return undefined;
}

/*  takes string to an absolute or relative URL 
    returns an array containing a valid Bw path
    and the expected content directory.
    DOES NOT ENSURE CONTENT EXISTS
    Treat is like our best guess
*/
function formatPath(url)
{
    var result = [];
    
    var validPath = "";
    var validDir  = "";
    
    try {
        $.ajax({
            url: url,
            type:'HEAD',
            async: false,
            error: function()
            {
                console.debug(url + " does not exist.");
                // could be a relative path
                var href = document.location.href;
                
                validPath = href.substring(0, href.lastIndexOf("/")) + "/" + bridgeworks.contentDir + "/" + url;
                
                console.debug("Trying: " + validPath);
                
                var ndx = validPath.lastIndexOf("objects/");
                if (ndx == -1) ndx = validPath.lastIndexOf("motions/");
                if (ndx == -1) ndx = validPath.lastIndexOf("envelopes/");
                if (ndx == -1) ndx = validPath.lastIndexOf("scenes/");
                
                validDir = validPath.substring(0, ndx);
                
                console.debug("With contentDir: " + validDir);  
            },
            success: function()
            {
                var href = document.location.href;
                
                validPath = url;
                
                var ndx = validPath.lastIndexOf("objects/");
                if (ndx == -1) ndx = validPath.lastIndexOf("motions/");
                if (ndx == -1) ndx = validPath.lastIndexOf("envelopes/");
                if (ndx == -1) ndx = validPath.lastIndexOf("scenes/");
                
                //validDir = validPath.substring(0, ndx);
                validDir = href.substring(0, href.lastIndexOf("/")) + "/" + bridgeworks.contentDir;
                
                console.debug("File found: " + validPath);
            }
        });
        
        result[0] = validPath;
        result[1] = validDir;
    } catch (e) {
        
    }
    
    return result;
}

/**
 * Determine if the filename represents a full path.
 * @params filePath     - the filename [path] string.
 * @return bool         - boolean indicating if the filename represents a full path.
 */
function isFullPath(filePath)
{
    // check for // or \\ in beginning of pathname (UNC filename)
    var unc = false;
    var filePathLen = filePath.length;
    if (filePathLen >= 2)
    {
        if ((filePath[0] == '\\' || filePath[0] == '/') &&
            (filePath[1] == '\\' || filePath[1] == '/'))
        {
            unc = true;
        }
    }       

    // check if file path is a full path
    if (unc || filePath.indexOf(':') >= 0)
    {
        return true;
    }

    return false;
}

/**
 * Form a full path string by appending a filename [path] to a directory path.
 * @params filePath     - the filename [path] string.
 * @params dirPath      - the directory path string.
 * @return string       - the output string.
 */
function formFullPath(filePath, dirPath)
{
    var fullPath = new String();

    if (!filePath || !dirPath)
    {
        return null;
    }      

    // check if file path is already a full path
    if (isFullPath(filePath))
    {
        fullPath = filePath;
    }
    else // file path is relative, formulate full path
    {
        fullPath = dirPath;
        if (fullPath.length > 0)
        {
            var last = fullPath.charAt(fullPath.length - 1);
            if (last != '/' && last != '\\')
            {
                fullPath += '/';
            }
        }
        
        // don't allow "//" in the filepath (Minefield doesn't like that)
        if (filePath[0] == '/' || filePath[0] == "\\")
        {
            fullPath += filePath.slice(1);
        }
        else
        {
            fullPath += filePath;
        }
    }

    return fullPath;
}

function getFileExtension(filename)
{
    var ext = null;
    var lastDot = filename.lastIndexOf(".");
    if (lastDot != -1)
    {
        var ext = "";
        ext = filename.substr(lastDot+1)
        return ext;
    }

    return ext;    
}

function getBrowserName()
{
    var browser = new String(navigator.userAgent);
    
    // chrome
    if (browser.indexOf("Chrome") >= 0) return "Chrome";

    // firefox
    if (browser.indexOf("Firefox") >= 0) return "Firefox";

    return undefined;
}

function OutputDebugMsg(msg)
{
    var innerHTML = document.getElementById("DebugOutput").innerHTML;
    innerHTML += "&gt; " + msg + "<br>";
    document.getElementById("DebugOutput").innerHTML = innerHTML;
}

function addSlashAfterDriveSpecifier(filename)
{
    var index = filename.indexOf(":");
    if (index == -1) return filename;
    
    filename = filename.slice(0, index+1) + "\\" + filename.slice(index+1);
    return filename;
}

function hexStrToULong(string)
{
    // find end of string
    var i = string.length - 1;

    var value = 0;
    var digit = 0;
    var position = 0;
    for ( ; i >= 0; i--, position++)
    {
        switch (string.charAt(i))
        {
        case '0': digit = 0;  break;
        case '1': digit = 1;  break;
        case '2': digit = 2;  break;
        case '3': digit = 3;  break;
        case '4': digit = 4;  break;
        case '5': digit = 5;  break;
        case '6': digit = 6;  break;
        case '7': digit = 7;  break;
        case '8': digit = 8;  break;
        case '9': digit = 9;  break;

        case 'a':
        case 'A': digit = 10; break;

        case 'b':
        case 'B': digit = 11; break;

        case 'c':
        case 'C': digit = 12; break;

        case 'd':
        case 'D': digit = 13; break;

        case 'e':
        case 'E': digit = 14; break;

        case 'f':
        case 'F': digit = 15; break;

        default:  digit = 0;  break;
        }

        value += (digit * Math.pow(16, position));
    }

    return value;
}

function Color(r, g, b, a)
{
    this.r = r || 0;
    this.g = g || 0;
    this.b = b || 0;
    this.a = a || 0;
}

Color.prototype.v = function()
{
    var values = [ this.r, this.g, this.b, this.a ];
    return values; 
}

Color.prototype.load = function(r, g, b, a)
{
    this.r = r;
    this.g = g;
    this.b = b;
    this.a = a;
}

Color.prototype.copy = function(color)
{
    if (color)
    {
        this.r = color.r;
        this.g = color.g;
        this.b = color.b;
        this.a = color.a;
    }
}

function Pair(first, second)
{
    this.first = first;
    this.second = second;
}

function Rect(left, top, right, bottom)
{
    this.left = left || 0;
    this.top = top || 0;
    this.right = right || 0;
    this.bottom = bottom || 0;
}

Rect.prototype.load = function(left, top, right, bottom)
{
    this.left = left;
    this.top = top;
    this.right = right;
    this.bottom = bottom;
}

Rect.prototype.loadRect = function(rect)
{
    this.left = rect.left;
    this.top = rect.top;
    this.right = rect.right;
    this.bottom = rect.bottom;
}

function Viewport(x, y, width, height)
{
    this.x = x || 0;
    this.y = y || 0;
    this.width = width || 0;
    this.height = height || 0;
    
    this.equals = function(rhs)
    {
        return (this.x == rhs.x &&
                this.y == rhs.y &&
                this.width == rhs.width &&
                this.height == rhs.height); 
    }
}

Viewport.prototype.load = function(x, y, width, height)
{
    this.x = x;
    this.y = y;
    this.width = width;
    this.height = height;
}

Viewport.prototype.loadViewport = function(vp)
{
    this.x = vp.x;
    this.y = vp.y;
    this.width = vp.width;
    this.height = vp.height;
}

Viewport.prototype.containsPoint = function(x, y)
{
    if (x >= this.x &&
        y >= this.y &&
        x <= (this.x + this.width) &&
        y <= (this.y + this.height))
        return true;

    return false;
}
function Stack(element)
{
    this.stack = new Array();
    this.maxLength = 0;
    
    if (element)
    {
        this.stack.push(element);
    }
}

Stack.prototype.push = function(element)
{
	if (this.maxLength > 0 && this.stack.length >= this.maxLength)
	{
		this.pop();
	}
	
    this.stack.push(element);
}

Stack.prototype.pop = function()
{
    if (this.stack.length > 0)
    {
        this.stack.pop();
    }
}

Stack.prototype.load = function(element)
{
    this.pop(); // does nothing if empty
    this.push(element);
}

Stack.prototype.top = function()
{
    if (this.stack.length > 0)
    {
        return this.stack[this.stack.length-1];
    }
    
    return null;
}

Stack.prototype.getAt = function(index)
{
    if (this.stack.length > index)
    {
        return this.stack[index];
    }
    
    return null;
}

Stack.prototype.length = function()
{
    return this.stack.length;
}

Stack.prototype.empty = function()
{
    return this.stack.length == 0;
}

Stack.prototype.clear = function()
{
    this.stack.length = 0;
}

Stack.prototype.copy = function()
{
    return this.stack.slice();
}
function Queue(element)
{
	this.queue = new Array();
    this.maxLength = 0;
    
    if (element)
    {
        this.queue.push(element);
    }
}

Queue.prototype.push = function(element)
{
	if (this.maxLength > 0 && this.queue.length >= this.maxLength)
	{
		this.pop();
	}
	
    this.queue.push(element);
}

Queue.prototype.pop = function()
{
    if (this.queue.length > 0)
    {
        this.queue.shift();
    }
}

Queue.prototype.load = function(element)
{
    this.pop(); // does nothing if empty
    this.push(element);
}

Queue.prototype.front = function()
{
    if (this.queue.length > 0)
    {
        return this.queue[0];
    }
    
    return null;
}

Queue.prototype.getAt = function(index)
{
    if (this.queue.length > index)
    {
        return this.queue[index];
    }
    
    return null;
}

Queue.prototype.length = function()
{
    return this.queue.length;
}

Queue.prototype.empty = function()
{
    return this.queue.length == 0;
}

Queue.prototype.clear = function()
{
    this.queue.length = 0;
}

Queue.prototype.copy = function()
{
    return this.queue.slice();
}

var gAttributeBin = null;
var gAttributePairs = null;

function setAttributeBin(bin)
{
    gAttributeBin = bin;
}

function setAttributePairs(pairs)
{
    gAttributePairs = pairs;
}

function deserializeAttributeContainer(container, atts)
{
    for (var i=0; i < atts.length; i++)
    {
        var attribute = container.getAttribute(atts[i][0]);
        if (attribute)
        {
            deserializeAttribute(attribute, atts[i][1]);
        }
    }
    
    container.flagDeserializedFromXML();
}

function deserializeComplexAttribute(attribute, atts)
{
    var values = [];
    for (var i=0; i < atts.length; i++)
    {
        values.push(atts[i][1]);
    }
    if (values.length > 0) 
    {
        if (!gAttributeBin)
        {
            setAttributeValue(attribute, values);
        }
        else // gAttributeBin != null
        {
            gAttributeBin.push(new Pair(attribute, values));
        }
    }
    
    attribute.flagDeserializedFromXML();
}

function deserializeAttribute(attribute, value)
{
    // TODO: search value for operators
    
    if (!gAttributeBin)
    {
        setAttributeValue(attribute, value);
    }
    else // gAttributeBin != null
    {
        gAttributeBin.push(new Pair(attribute, value));
    }
    
    attribute.flagDeserializedFromXML();
}

function resolveAttributeContainerReference(container, atts, registry)
{
    if (atts.length > 0)
    {
        if (atts[0][0] == "ref")
        {
            var resource = registry.find(atts[0][1]);
            if (resource)
            {
                container.synchronize(resource, true);
                return true;
            } 
        }
    }
    
    return false;
}

function resolveComplexAttributeReference(attribute, atts)
{
    if (atts.length > 0)
    {
        if (atts[0][0] == "ref")
        {
            return resolvePrimitiveAttributeReference(attribute, atts[0][1]);
        }
    }

    return false;
}

function resolvePrimitiveAttributeReference(attribute, value)
{
    // TODO
    return false;
}

function resolveAttributeReference(source, target)
{
    if (!gAttributePairs)
    {
        target.copyValue(source);
    }
    else // gAttributePairs != null
    {
        gAttributePairs.push(new Pair(source, target));
    }
}
// =========================================================================
//
// xmlsax.js - an XML SAX parser in JavaScript.
//
// version 3.1
//
// =========================================================================
//
// Copyright (C) 2001 - 2002 David Joham (djoham@yahoo.com) and Scott Severtson
//
// This library is free software; you can redistribute it and/or
// modify it under the terms of the GNU Lesser General Public
// License as published by the Free Software Foundation; either
// version 2.1 of the License, or (at your option) any later version.

// This library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
// Lesser General Public License for more details.

// You should have received a copy of the GNU Lesser General Public
// License along with this library; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
//
//
// Visit the XML for <SCRIPT> home page at http://xmljs.sourceforge.net
//

// CONSTANTS

// =========================================================================
// =========================================================================
// =========================================================================
var whitespace = "\n\r\t ";


/***************************************************************************************************************
XMLP is a pull-based parser. The calling application passes in a XML string
to the constructor, then repeatedly calls .next() to parse the next segment.
.next() returns a flag indicating what type of segment was found, and stores
data temporarily in couple member variables (name, content, array of
attributes), which can be accessed by several .get____() methods.

Basically, XMLP is the lowest common denominator parser - an very simple
API which other wrappers can be built against.
*****************************************************************************************************************/


XMLP = function(strXML) {
    /*******************************************************************************************************************
    function:   this is the constructor to the XMLP Object

    Author:   Scott Severtson

    Description:
        Instantiates and initializes the object
    *********************************************************************************************************************/
    // Normalize line breaks
    strXML = SAXStrings.replace(strXML, null, null, "\r\n", "\n");
    strXML = SAXStrings.replace(strXML, null, null, "\r", "\n");

    this.m_xml = strXML;
    this.m_iP = 0;
    this.m_iState = XMLP._STATE_PROLOG;
    this.m_stack = new saxStack();
    this._clearAttributes();

}  // end XMLP constructor


// CONSTANTS    (these must be below the constructor)

// =========================================================================
// =========================================================================
// =========================================================================

XMLP._NONE    = 0;
XMLP._ELM_B   = 1;
XMLP._ELM_E   = 2;
XMLP._ELM_EMP = 3;
XMLP._ATT     = 4;
XMLP._TEXT    = 5;
XMLP._ENTITY  = 6;
XMLP._PI      = 7;
XMLP._CDATA   = 8;
XMLP._COMMENT = 9;
XMLP._DTD     = 10;
XMLP._ERROR   = 11;

XMLP._CONT_XML = 0;
XMLP._CONT_ALT = 1;

XMLP._ATT_NAME = 0;
XMLP._ATT_VAL  = 1;

XMLP._STATE_PROLOG = 1;
XMLP._STATE_DOCUMENT = 2;
XMLP._STATE_MISC = 3;

XMLP._errs = new Array();
XMLP._errs[XMLP.ERR_CLOSE_PI       = 0 ] = "PI: missing closing sequence";
XMLP._errs[XMLP.ERR_CLOSE_DTD      = 1 ] = "DTD: missing closing sequence";
XMLP._errs[XMLP.ERR_CLOSE_COMMENT  = 2 ] = "Comment: missing closing sequence";
XMLP._errs[XMLP.ERR_CLOSE_CDATA    = 3 ] = "CDATA: missing closing sequence";
XMLP._errs[XMLP.ERR_CLOSE_ELM      = 4 ] = "Element: missing closing sequence";
XMLP._errs[XMLP.ERR_CLOSE_ENTITY   = 5 ] = "Entity: missing closing sequence";
XMLP._errs[XMLP.ERR_PI_TARGET      = 6 ] = "PI: target is required";
XMLP._errs[XMLP.ERR_ELM_EMPTY      = 7 ] = "Element: cannot be both empty and closing";
XMLP._errs[XMLP.ERR_ELM_NAME       = 8 ] = "Element: name must immediatly follow \"<\"";
XMLP._errs[XMLP.ERR_ELM_LT_NAME    = 9 ] = "Element: \"<\" not allowed in element names";
XMLP._errs[XMLP.ERR_ATT_VALUES     = 10] = "Attribute: values are required and must be in quotes";
XMLP._errs[XMLP.ERR_ATT_LT_NAME    = 11] = "Element: \"<\" not allowed in attribute names";
XMLP._errs[XMLP.ERR_ATT_LT_VALUE   = 12] = "Attribute: \"<\" not allowed in attribute values";
XMLP._errs[XMLP.ERR_ATT_DUP        = 13] = "Attribute: duplicate attributes not allowed";
XMLP._errs[XMLP.ERR_ENTITY_UNKNOWN = 14] = "Entity: unknown entity";
XMLP._errs[XMLP.ERR_INFINITELOOP   = 15] = "Infininte loop";
XMLP._errs[XMLP.ERR_DOC_STRUCTURE  = 16] = "Document: only comments, processing instructions, or whitespace allowed outside of document element";
XMLP._errs[XMLP.ERR_ELM_NESTING    = 17] = "Element: must be nested correctly";

// =========================================================================
// =========================================================================
// =========================================================================


XMLP.prototype._addAttribute = function(name, value) {
    /*******************************************************************************************************************
    function:   _addAttribute

    Author:   Scott Severtson
    *********************************************************************************************************************/
    this.m_atts[this.m_atts.length] = new Array(name, value);
}  // end function _addAttribute


XMLP.prototype._checkStructure = function(iEvent) {
    /*******************************************************************************************************************
    function:   _checkStructure

    Author:   Scott Severtson
    *********************************************************************************************************************/
  
	if(XMLP._STATE_PROLOG == this.m_iState) {
		if((XMLP._TEXT == iEvent) || (XMLP._ENTITY == iEvent)) {
            if(SAXStrings.indexOfNonWhitespace(this.getContent(), this.getContentBegin(), this.getContentEnd()) != -1) {
				return this._setErr(XMLP.ERR_DOC_STRUCTURE);
            }
        }

        if((XMLP._ELM_B == iEvent) || (XMLP._ELM_EMP == iEvent)) {
            this.m_iState = XMLP._STATE_DOCUMENT;
            // Don't return - fall through to next state
        }
    }
    if(XMLP._STATE_DOCUMENT == this.m_iState) {
        if((XMLP._ELM_B == iEvent) || (XMLP._ELM_EMP == iEvent)) {
            this.m_stack.push(this.getName());
        }

        if((XMLP._ELM_E == iEvent) || (XMLP._ELM_EMP == iEvent)) {
            var strTop = this.m_stack.pop();
            if((strTop == null) || (strTop != this.getName())) {
                return this._setErr(XMLP.ERR_ELM_NESTING);
            }
        }

        if(this.m_stack.count() == 0) {
            this.m_iState = XMLP._STATE_MISC;
            return iEvent;
        }
    }
    if(XMLP._STATE_MISC == this.m_iState) {
		if((XMLP._ELM_B == iEvent) || (XMLP._ELM_E == iEvent) || (XMLP._ELM_EMP == iEvent) || (XMLP.EVT_DTD == iEvent)) {
			return this._setErr(XMLP.ERR_DOC_STRUCTURE);
        }

        if((XMLP._TEXT == iEvent) || (XMLP._ENTITY == iEvent)) {
			if(SAXStrings.indexOfNonWhitespace(this.getContent(), this.getContentBegin(), this.getContentEnd()) != -1) {
				return this._setErr(XMLP.ERR_DOC_STRUCTURE);
            }
        }
    }

    return iEvent;

}  // end function _checkStructure


XMLP.prototype._clearAttributes = function() {
    /*******************************************************************************************************************
    function:   _clearAttributes

    Author:   Scott Severtson
    *********************************************************************************************************************/
    this.m_atts = new Array();
}  // end function _clearAttributes


XMLP.prototype._findAttributeIndex = function(name) {
    /*******************************************************************************************************************
    function:   findAttributeIndex

    Author:   Scott Severtson
    *********************************************************************************************************************/
    for(var i = 0; i < this.m_atts.length; i++) {
        if(this.m_atts[i][XMLP._ATT_NAME] == name) {
            return i;
        }
    }
    return -1;

}  // end function _findAttributeIndex


XMLP.prototype.getAttributeCount = function() {
    /*******************************************************************************************************************
    function:   getAttributeCount

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_atts ? this.m_atts.length : 0;

}  // end function getAttributeCount()


XMLP.prototype.getAttributeName = function(index) {
    /*******************************************************************************************************************
    function:   getAttributeName

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return ((index < 0) || (index >= this.m_atts.length)) ? null : this.m_atts[index][XMLP._ATT_NAME];

}  //end function getAttributeName


XMLP.prototype.getAttributeValue = function(index) {
    /*******************************************************************************************************************
    function:   getAttributeValue

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return ((index < 0) || (index >= this.m_atts.length)) ? null : __unescapeString(this.m_atts[index][XMLP._ATT_VAL]);

} // end function getAttributeValue


XMLP.prototype.getAttributeValueByName = function(name) {
    /*******************************************************************************************************************
    function:   getAttributeValueByName

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.getAttributeValue(this._findAttributeIndex(name));

}  // end function getAttributeValueByName


XMLP.prototype.getColumnNumber = function() {
    /*******************************************************************************************************************
    function:   getColumnNumber

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return SAXStrings.getColumnNumber(this.m_xml, this.m_iP);

}  // end function getColumnNumber


XMLP.prototype.getContent = function() {
    /*******************************************************************************************************************
    function:   getContent

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return (this.m_cSrc == XMLP._CONT_XML) ? this.m_xml : this.m_cAlt;

}  //end function getContent


XMLP.prototype.getContentBegin = function() {
    /*******************************************************************************************************************
    function:   getContentBegin

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_cB;

}  //end function getContentBegin


XMLP.prototype.getContentEnd = function() {
    /*******************************************************************************************************************
    function:   getContentEnd

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_cE;

}  // end function getContentEnd


XMLP.prototype.getLineNumber = function() {
    /*******************************************************************************************************************
    function:   getLineNumber

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return SAXStrings.getLineNumber(this.m_xml, this.m_iP);

}  // end function getLineNumber


XMLP.prototype.getName = function() {
    /*******************************************************************************************************************
    function:   getName

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_name;

}  // end function getName()


XMLP.prototype.next = function() {
    /*******************************************************************************************************************
    function:   next

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this._checkStructure(this._parse());

}  // end function next()


XMLP.prototype._parse = function() {
    /*******************************************************************************************************************
    function:   _parse

    Author:   Scott Severtson
    *********************************************************************************************************************/

	if(this.m_iP == this.m_xml.length) {
        return XMLP._NONE;
    }

    if(this.m_iP == this.m_xml.indexOf("<?",        this.m_iP)) {
        return this._parsePI     (this.m_iP + 2);
    }
    else if(this.m_iP == this.m_xml.indexOf("<!DOCTYPE", this.m_iP)) {
        return this._parseDTD    (this.m_iP + 9);
    }
    else if(this.m_iP == this.m_xml.indexOf("<!--",      this.m_iP)) {
        return this._parseComment(this.m_iP + 4);
    }
    else if(this.m_iP == this.m_xml.indexOf("<![CDATA[", this.m_iP)) {
        return this._parseCDATA  (this.m_iP + 9);
    }
    else if(this.m_iP == this.m_xml.indexOf("<",         this.m_iP)) {
        return this._parseElement(this.m_iP + 1);
    }
    else if(this.m_iP == this.m_xml.indexOf("&",         this.m_iP)) {
        return this._parseEntity (this.m_iP + 1);
    }
    else{
        return this._parseText   (this.m_iP);
    }
	

}  // end function _parse


XMLP.prototype._parseAttribute = function(iB, iE) {
    /*******************************************************************************************************************
    function:   _parseAttribute

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var iNB, iNE, iEq, iVB, iVE;
    var cQuote, strN, strV;

	this.m_cAlt = ""; //resets the value so we don't use an old one by accident (see testAttribute7 in the test suite)
    
	iNB = SAXStrings.indexOfNonWhitespace(this.m_xml, iB, iE);
    if((iNB == -1) ||(iNB >= iE)) {
        return iNB;
    }

    iEq = this.m_xml.indexOf("=", iNB);
    if((iEq == -1) || (iEq > iE)) {
        return this._setErr(XMLP.ERR_ATT_VALUES);
    }

    iNE = SAXStrings.lastIndexOfNonWhitespace(this.m_xml, iNB, iEq);

    iVB = SAXStrings.indexOfNonWhitespace(this.m_xml, iEq + 1, iE);
    if((iVB == -1) ||(iVB > iE)) {
        return this._setErr(XMLP.ERR_ATT_VALUES);
    }

    cQuote = this.m_xml.charAt(iVB);
    if(SAXStrings.QUOTES.indexOf(cQuote) == -1) {
        return this._setErr(XMLP.ERR_ATT_VALUES);
    }

    iVE = this.m_xml.indexOf(cQuote, iVB + 1);
    if((iVE == -1) ||(iVE > iE)) {
        return this._setErr(XMLP.ERR_ATT_VALUES);
    }

    strN = this.m_xml.substring(iNB, iNE + 1);
    strV = this.m_xml.substring(iVB + 1, iVE);

    if(strN.indexOf("<") != -1) {
        return this._setErr(XMLP.ERR_ATT_LT_NAME);
    }

    if(strV.indexOf("<") != -1) {
        return this._setErr(XMLP.ERR_ATT_LT_VALUE);
    }

    strV = SAXStrings.replace(strV, null, null, "\n", " ");
    strV = SAXStrings.replace(strV, null, null, "\t", " ");
	iRet = this._replaceEntities(strV);
    if(iRet == XMLP._ERROR) {
        return iRet;
    }

    strV = this.m_cAlt;

    if(this._findAttributeIndex(strN) == -1) {
        this._addAttribute(strN, strV);
    }
    else {
        return this._setErr(XMLP.ERR_ATT_DUP);
    }

    this.m_iP = iVE + 2;

    return XMLP._ATT;

}  // end function _parseAttribute


XMLP.prototype._parseCDATA = function(iB) {
    /*******************************************************************************************************************
    function:   _parseCDATA

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var iE = this.m_xml.indexOf("]]>", iB);
    if (iE == -1) {
        return this._setErr(XMLP.ERR_CLOSE_CDATA);
    }

    this._setContent(XMLP._CONT_XML, iB, iE);

    this.m_iP = iE + 3;

    return XMLP._CDATA;

}  // end function _parseCDATA


XMLP.prototype._parseComment = function(iB) {
    /*******************************************************************************************************************
    function:   _parseComment

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var iE = this.m_xml.indexOf("-" + "->", iB);
    if (iE == -1) {
        return this._setErr(XMLP.ERR_CLOSE_COMMENT);
    }

    this._setContent(XMLP._CONT_XML, iB, iE);

    this.m_iP = iE + 3;

    return XMLP._COMMENT;

}  // end function _parseComment


XMLP.prototype._parseDTD = function(iB) {
    /*******************************************************************************************************************
    function:  _parseDTD

    Author:   Scott Severtson
    *********************************************************************************************************************/

    // Eat DTD

    var iE, strClose, iInt, iLast;

    iE = this.m_xml.indexOf(">", iB);
    if(iE == -1) {
        return this._setErr(XMLP.ERR_CLOSE_DTD);
    }

    iInt = this.m_xml.indexOf("[", iB);
    strClose = ((iInt != -1) && (iInt < iE)) ? "]>" : ">";

    while(true) {
        // DEBUG: Remove
        if(iE == iLast) {
            return this._setErr(XMLP.ERR_INFINITELOOP);
        }

        iLast = iE;
        // DEBUG: Remove End

        iE = this.m_xml.indexOf(strClose, iB);
        if(iE == -1) {
            return this._setErr(XMLP.ERR_CLOSE_DTD);
        }

        // Make sure it is not the end of a CDATA section
        if (this.m_xml.substring(iE - 1, iE + 2) != "]]>") {
            break;
        }
    }

    this.m_iP = iE + strClose.length;

    return XMLP._DTD;

}  // end function _parseDTD


XMLP.prototype._parseElement = function(iB) {
    /*******************************************************************************************************************
    function:   _parseElement

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var iE, iDE, iNE, iRet;
    var iType, strN, iLast;

    iDE = iE = this.m_xml.indexOf(">", iB);
    if(iE == -1) {
        return this._setErr(XMLP.ERR_CLOSE_ELM);
    }

    if(this.m_xml.charAt(iB) == "/") {
        iType = XMLP._ELM_E;
        iB++;
    } else {
        iType = XMLP._ELM_B;
    }

    if(this.m_xml.charAt(iE - 1) == "/") {
        if(iType == XMLP._ELM_E) {
            return this._setErr(XMLP.ERR_ELM_EMPTY);
        }
        iType = XMLP._ELM_EMP;
        iDE--;
    }

    iDE = SAXStrings.lastIndexOfNonWhitespace(this.m_xml, iB, iDE);

    //djohack
    //hack to allow for elements with single character names to be recognized

    if (iE - iB != 1 ) {
        if(SAXStrings.indexOfNonWhitespace(this.m_xml, iB, iDE) != iB) {
            return this._setErr(XMLP.ERR_ELM_NAME);
        }
    }
    // end hack -- original code below

    /*
    if(SAXStrings.indexOfNonWhitespace(this.m_xml, iB, iDE) != iB)
        return this._setErr(XMLP.ERR_ELM_NAME);
    */
    this._clearAttributes();

    iNE = SAXStrings.indexOfWhitespace(this.m_xml, iB, iDE);
    if(iNE == -1) {
        iNE = iDE + 1;
    }
    else {
        this.m_iP = iNE;
        while(this.m_iP < iDE) {
            // DEBUG: Remove
            if(this.m_iP == iLast) return this._setErr(XMLP.ERR_INFINITELOOP);
            iLast = this.m_iP;
            // DEBUG: Remove End


            iRet = this._parseAttribute(this.m_iP, iDE);
            if(iRet == XMLP._ERROR) return iRet;
        }
    }

    strN = this.m_xml.substring(iB, iNE);

    if(strN.indexOf("<") != -1) {
        return this._setErr(XMLP.ERR_ELM_LT_NAME);
    }

    this.m_name = strN;
    this.m_iP = iE + 1;

    return iType;

}  // end function _parseElement


XMLP.prototype._parseEntity = function(iB) {
    /*******************************************************************************************************************
    function:   _parseEntity

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var iE = this.m_xml.indexOf(";", iB);
    if(iE == -1) {
        return this._setErr(XMLP.ERR_CLOSE_ENTITY);
    }

    this.m_iP = iE + 1;

    return this._replaceEntity(this.m_xml, iB, iE);

}  // end function _parseEntity


XMLP.prototype._parsePI = function(iB) {
    /*******************************************************************************************************************
    function:   _parsePI

    Author:   Scott Severtson
    *********************************************************************************************************************/

    var iE, iTB, iTE, iCB, iCE;

    iE = this.m_xml.indexOf("?>", iB);
    if(iE   == -1) {
        return this._setErr(XMLP.ERR_CLOSE_PI);
    }

    iTB = SAXStrings.indexOfNonWhitespace(this.m_xml, iB, iE);
    if(iTB == -1) {
        return this._setErr(XMLP.ERR_PI_TARGET);
    }

    iTE = SAXStrings.indexOfWhitespace(this.m_xml, iTB, iE);
    if(iTE  == -1) {
        iTE = iE;
    }

    iCB = SAXStrings.indexOfNonWhitespace(this.m_xml, iTE, iE);
    if(iCB == -1) {
        iCB = iE;
    }

    iCE = SAXStrings.lastIndexOfNonWhitespace(this.m_xml, iCB, iE);
    if(iCE  == -1) {
        iCE = iE - 1;
    }

    this.m_name = this.m_xml.substring(iTB, iTE);
    this._setContent(XMLP._CONT_XML, iCB, iCE + 1);
    this.m_iP = iE + 2;

    return XMLP._PI;

}  // end function _parsePI


XMLP.prototype._parseText = function(iB) {
    /*******************************************************************************************************************
    function:   _parseText

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var iE, iEE;

    iE = this.m_xml.indexOf("<", iB);
    if(iE == -1) {
        iE = this.m_xml.length;
    }

    iEE = this.m_xml.indexOf("&", iB);
    if((iEE != -1) && (iEE <= iE)) {
        iE = iEE;
    }

    this._setContent(XMLP._CONT_XML, iB, iE);

    this.m_iP = iE;

    return XMLP._TEXT;

} // end function _parseText


XMLP.prototype._replaceEntities = function(strD, iB, iE) {
    /*******************************************************************************************************************
    function:   _replaceEntities

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(SAXStrings.isEmpty(strD)) return "";
    iB = iB || 0;
    iE = iE || strD.length;


    var iEB, iEE, strRet = "";

    iEB = strD.indexOf("&", iB);
    iEE = iB;

    while((iEB > 0) && (iEB < iE)) {
        strRet += strD.substring(iEE, iEB);

        iEE = strD.indexOf(";", iEB) + 1;

        if((iEE == 0) || (iEE > iE)) {
            return this._setErr(XMLP.ERR_CLOSE_ENTITY);
        }

        iRet = this._replaceEntity(strD, iEB + 1, iEE - 1);
        if(iRet == XMLP._ERROR) {
            return iRet;
        }

        strRet += this.m_cAlt;

        iEB = strD.indexOf("&", iEE);
    }

    if(iEE != iE) {
        strRet += strD.substring(iEE, iE);
    }

    this._setContent(XMLP._CONT_ALT, strRet);

    return XMLP._ENTITY;

}  // end function _replaceEntities


XMLP.prototype._replaceEntity = function(strD, iB, iE) {
    /*******************************************************************************************************************
    function:   _replaceEntity

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(SAXStrings.isEmpty(strD)) return -1;
    iB = iB || 0;
    iE = iE || strD.length;

    switch(strD.substring(iB, iE)) {
        case "amp":  strEnt = "&";  break;
        case "lt":   strEnt = "<";  break;
        case "gt":   strEnt = ">";  break;
        case "apos": strEnt = "'";  break;
        case "quot": strEnt = "\""; break;
        default:
            if(strD.charAt(iB) == "#") {
                strEnt = String.fromCharCode(parseInt(strD.substring(iB + 1, iE)));
            } else {
                return this._setErr(XMLP.ERR_ENTITY_UNKNOWN);
            }
        break;
    }
    this._setContent(XMLP._CONT_ALT, strEnt);

    return XMLP._ENTITY;
}  // end function _replaceEntity


XMLP.prototype._setContent = function(iSrc) {
    /*******************************************************************************************************************
    function:   _setContent

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var args = arguments;

    if(XMLP._CONT_XML == iSrc) {
        this.m_cAlt = null;
        this.m_cB = args[1];
        this.m_cE = args[2];
    } else {
        this.m_cAlt = args[1];
        this.m_cB = 0;
        this.m_cE = args[1].length;
    }
    this.m_cSrc = iSrc;

}  // end function _setContent


XMLP.prototype._setErr = function(iErr) {
    /*******************************************************************************************************************
    function:   _setErr

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var strErr = XMLP._errs[iErr];

    this.m_cAlt = strErr;
    this.m_cB = 0;
    this.m_cE = strErr.length;
    this.m_cSrc = XMLP._CONT_ALT;

    return XMLP._ERROR;

}  // end function _setErr






/***************************************************************************************************************
SAXDriver is an object that basically wraps an XMLP instance, and provides an
event-based interface for parsing. This is the object users interact with when coding
with XML for <SCRIPT>
*****************************************************************************************************************/


SAXDriver = function() {
    /*******************************************************************************************************************
    function:   SAXDriver

    Author:   Scott Severtson

    Description:
        This is the constructor for the SAXDriver Object
    *********************************************************************************************************************/
    this.m_hndDoc = null;
    this.m_hndErr = null;
    this.m_hndLex = null;
}


// CONSTANTS    (these must be below the constructor)

// =========================================================================
// =========================================================================
// =========================================================================
SAXDriver.DOC_B = 1;
SAXDriver.DOC_E = 2;
SAXDriver.ELM_B = 3;
SAXDriver.ELM_E = 4;
SAXDriver.CHARS = 5;
SAXDriver.PI    = 6;
SAXDriver.CD_B  = 7;
SAXDriver.CD_E  = 8;
SAXDriver.CMNT  = 9;
SAXDriver.DTD_B = 10;
SAXDriver.DTD_E = 11;
// =========================================================================
// =========================================================================
// =========================================================================



SAXDriver.prototype.parse = function(strD) {
    /*******************************************************************************************************************
    function:   parse

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var parser = new XMLP(strD);

    if(this.m_hndDoc && this.m_hndDoc.setDocumentLocator) {
        this.m_hndDoc.setDocumentLocator(this);
    }

    this.m_parser = parser;
    this.m_bErr = false;

    if(!this.m_bErr) {
        this._fireEvent(SAXDriver.DOC_B);
    }
    this._parseLoop();
    if(!this.m_bErr) {
        this._fireEvent(SAXDriver.DOC_E);
    }

    this.m_xml = null;
    this.m_iP = 0;

}  // end function parse


SAXDriver.prototype.setDocumentHandler = function(hnd) {
    /*******************************************************************************************************************
    function:   setDocumentHandler

    Author:   Scott Severtson
    *********************************************************************************************************************/

    this.m_hndDoc = hnd;

}   // end function setDocumentHandler


SAXDriver.prototype.setErrorHandler = function(hnd) {
    /*******************************************************************************************************************
    function:   setErrorHandler

    Author:   Scott Severtson
    *********************************************************************************************************************/

    this.m_hndErr = hnd;

}  // end function setErrorHandler


SAXDriver.prototype.setLexicalHandler = function(hnd) {
    /*******************************************************************************************************************
    function:   setLexicalHandler

    Author:   Scott Severtson
    *********************************************************************************************************************/

    this.m_hndLex = hnd;

}  // end function setLexicalHandler


    /*******************************************************************************************************************
                                                LOCATOR/PARSE EXCEPTION INTERFACE
    *********************************************************************************************************************/

SAXDriver.prototype.getColumnNumber = function() {
    /*******************************************************************************************************************
    function:   getSystemId

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_parser.getColumnNumber();

}  // end function getColumnNumber


SAXDriver.prototype.getLineNumber = function() {
    /*******************************************************************************************************************
    function:   getLineNumber

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_parser.getLineNumber();

}  // end function getLineNumber


SAXDriver.prototype.getMessage = function() {
    /*******************************************************************************************************************
    function:   getMessage

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_strErrMsg;

}  // end function getMessage


SAXDriver.prototype.getPublicId = function() {
    /*******************************************************************************************************************
    function:   getPublicID

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return null;

}  // end function getPublicID


SAXDriver.prototype.getSystemId = function() {
    /*******************************************************************************************************************
    function:   getSystemId

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return null;

}  // end function getSystemId


    /*******************************************************************************************************************
                                                Attribute List Interface
    *********************************************************************************************************************/

SAXDriver.prototype.getLength = function() {
    /*******************************************************************************************************************
    function:   getLength

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_parser.getAttributeCount();

}  // end function getAttributeCount


SAXDriver.prototype.getName = function(index) {
    /*******************************************************************************************************************
    function:   getName

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_parser.getAttributeName(index);

} // end function getAttributeName


SAXDriver.prototype.getValue = function(index) {
    /*******************************************************************************************************************
    function:   getValue

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_parser.getAttributeValue(index);

}  // end function getAttributeValue


SAXDriver.prototype.getValueByName = function(name) {
    /*******************************************************************************************************************
    function:   getValueByName

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_parser.getAttributeValueByName(name);

} // end function getAttributeValueByName


    /*******************************************************************************************************************
                                                                Private functions
    *********************************************************************************************************************/

SAXDriver.prototype._fireError = function(strMsg) {
    /*******************************************************************************************************************
    function:   _fireError

    Author:   Scott Severtson
    *********************************************************************************************************************/
    this.m_strErrMsg = strMsg;
    this.m_bErr = true;

    if(this.m_hndErr && this.m_hndErr.fatalError) {
        this.m_hndErr.fatalError(this);
    }

}   // end function _fireError


SAXDriver.prototype._fireEvent = function(iEvt) {
    /*******************************************************************************************************************
    function:   _fireEvent

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var hnd, func, args = arguments, iLen = args.length - 1;

    if(this.m_bErr) return;

    if(SAXDriver.DOC_B == iEvt) {
        func = "startDocument";         hnd = this.m_hndDoc;
    }
    else if (SAXDriver.DOC_E == iEvt) {
        func = "endDocument";           hnd = this.m_hndDoc;
    }
    else if (SAXDriver.ELM_B == iEvt) {
        func = "startElement";          hnd = this.m_hndDoc;
    }
    else if (SAXDriver.ELM_E == iEvt) {
        func = "endElement";            hnd = this.m_hndDoc;
    }
    else if (SAXDriver.CHARS == iEvt) {
        func = "characters";            hnd = this.m_hndDoc;
    }
    else if (SAXDriver.PI    == iEvt) {
        func = "processingInstruction"; hnd = this.m_hndDoc;
    }
    else if (SAXDriver.CD_B  == iEvt) {
        func = "startCDATA";            hnd = this.m_hndLex;
    }
    else if (SAXDriver.CD_E  == iEvt) {
        func = "endCDATA";              hnd = this.m_hndLex;
    }
    else if (SAXDriver.CMNT  == iEvt) {
        func = "comment";               hnd = this.m_hndLex;
    }

    if(hnd && hnd[func]) {
        if(0 == iLen) {
            hnd[func]();
        }
        else if (1 == iLen) {
            hnd[func](args[1]);
        }
        else if (2 == iLen) {
            hnd[func](args[1], args[2]);
        }
        else if (3 == iLen) {
            hnd[func](args[1], args[2], args[3]);
        }
    }

}  // end function _fireEvent


SAXDriver.prototype._parseLoop = function(parser) {
    /*******************************************************************************************************************
    function:   _parseLoop

    Author:   Scott Severtson
    *********************************************************************************************************************/
    var iEvent, parser;

    parser = this.m_parser;
    while(!this.m_bErr) {
        iEvent = parser.next();

        if(iEvent == XMLP._ELM_B) {
            this._fireEvent(SAXDriver.ELM_B, parser.getName(), this);
        }
        else if(iEvent == XMLP._ELM_E) {
            this._fireEvent(SAXDriver.ELM_E, parser.getName());
        }
        else if(iEvent == XMLP._ELM_EMP) {
            this._fireEvent(SAXDriver.ELM_B, parser.getName(), this);
            this._fireEvent(SAXDriver.ELM_E, parser.getName());
        }
        else if(iEvent == XMLP._TEXT) {
            this._fireEvent(SAXDriver.CHARS, parser.getContent(), parser.getContentBegin(), parser.getContentEnd() - parser.getContentBegin());
        }
        else if(iEvent == XMLP._ENTITY) {
            this._fireEvent(SAXDriver.CHARS, parser.getContent(), parser.getContentBegin(), parser.getContentEnd() - parser.getContentBegin());
        }
        else if(iEvent == XMLP._PI) {
            this._fireEvent(SAXDriver.PI, parser.getName(), parser.getContent().substring(parser.getContentBegin(), parser.getContentEnd()));
        }
        else if(iEvent == XMLP._CDATA) {
            this._fireEvent(SAXDriver.CD_B);
            this._fireEvent(SAXDriver.CHARS, parser.getContent(), parser.getContentBegin(), parser.getContentEnd() - parser.getContentBegin());
            this._fireEvent(SAXDriver.CD_E);
        }
        else if(iEvent == XMLP._COMMENT) {
            this._fireEvent(SAXDriver.CMNT, parser.getContent(), parser.getContentBegin(), parser.getContentEnd() - parser.getContentBegin());
        }
        else if(iEvent == XMLP._DTD) {
        }
        else if(iEvent == XMLP._ERROR) {
            this._fireError(parser.getContent());
        }
        else if(iEvent == XMLP._NONE) {
            return;
        }
    }

}  // end function _parseLoop



/***************************************************************************************************************
SAXStrings: a useful object containing string manipulation functions
*****************************************************************************************************************/


SAXStrings = function() {
    /*******************************************************************************************************************
    function:   SAXStrings

    Author:   Scott Severtson

    Description:
        This is the constructor of the SAXStrings object
    *********************************************************************************************************************/
}  // end function SAXStrings


// CONSTANTS    (these must be below the constructor)

// =========================================================================
// =========================================================================
// =========================================================================
SAXStrings.WHITESPACE = " \t\n\r";
SAXStrings.QUOTES = "\"'";
// =========================================================================
// =========================================================================
// =========================================================================


SAXStrings.getColumnNumber = function(strD, iP) {
    /*******************************************************************************************************************
    function:   replace

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(SAXStrings.isEmpty(strD)) {
        return -1;
    }
    iP = iP || strD.length;

    var arrD = strD.substring(0, iP).split("\n");
    var strLine = arrD[arrD.length - 1];
    arrD.length--;
    var iLinePos = arrD.join("\n").length;

    return iP - iLinePos;

}  // end function getColumnNumber


SAXStrings.getLineNumber = function(strD, iP) {
    /*******************************************************************************************************************
    function:   getLineNumber

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(SAXStrings.isEmpty(strD)) {
        return -1;
    }
    iP = iP || strD.length;

    return strD.substring(0, iP).split("\n").length
}  // end function getLineNumber


SAXStrings.indexOfNonWhitespace = function(strD, iB, iE) {
    /*******************************************************************************************************************
    function:   indexOfNonWhitespace

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(SAXStrings.isEmpty(strD)) {
        return -1;
    }
    iB = iB || 0;
    iE = iE || strD.length;

    for(var i = iB; i < iE; i++){
        if(SAXStrings.WHITESPACE.indexOf(strD.charAt(i)) == -1) {
            return i;
        }
    }
    return -1;

}  // end function indexOfNonWhitespace


SAXStrings.indexOfWhitespace = function(strD, iB, iE) {
    /*******************************************************************************************************************
    function:   indexOfWhitespace

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(SAXStrings.isEmpty(strD)) {
        return -1;
    }
    iB = iB || 0;
    iE = iE || strD.length;

    for(var i = iB; i < iE; i++) {
        if(SAXStrings.WHITESPACE.indexOf(strD.charAt(i)) != -1) {
            return i;
        }
    }
    return -1;
}  // end function indexOfWhitespace


SAXStrings.isEmpty = function(strD) {
    /*******************************************************************************************************************
    function:   isEmpty

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return (strD == null) || (strD.length == 0);

}  // end function isEmpty


SAXStrings.lastIndexOfNonWhitespace = function(strD, iB, iE) {
    /*******************************************************************************************************************
    function:   lastIndexOfNonWhiteSpace

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(SAXStrings.isEmpty(strD)) {
        return -1;
    }
    iB = iB || 0;
    iE = iE || strD.length;

    for(var i = iE - 1; i >= iB; i--){
        if(SAXStrings.WHITESPACE.indexOf(strD.charAt(i)) == -1){
            return i;
        }
    }
    return -1;
}  // end function lastIndexOfNonWhitespace


SAXStrings.replace = function(strD, iB, iE, strF, strR) {
    /*******************************************************************************************************************
    function:   replace

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(SAXStrings.isEmpty(strD)) {
        return "";
    }
    iB = iB || 0;
    iE = iE || strD.length;

    return strD.substring(iB, iE).split(strF).join(strR);

}  // end function replace



/***************************************************************************************************************
saxStack: A simple stack class, used for verifying document structure.
*****************************************************************************************************************/

saxStack = function() {
    /*******************************************************************************************************************
    function:   saxStack

    Author:   Scott Severtson

    Description:
        Constructor of the saxStack Object
    *********************************************************************************************************************/
    this.m_arr = new Array();

}  // end function saxStack


saxStack.prototype.clear = function() {
    /*******************************************************************************************************************
    function:   clear

    Author:   Scott Severtson
    *********************************************************************************************************************/

    this.m_arr = new Array();

}  // end function clear


saxStack.prototype.count = function() {
    /*******************************************************************************************************************
    function:   count

    Author:   Scott Severtson
    *********************************************************************************************************************/

    return this.m_arr.length;

}  // end function count


saxStack.prototype.destroy = function() {
    /*******************************************************************************************************************
    function:   destroy

    Author:   Scott Severtson
    *********************************************************************************************************************/

    this.m_arr = null;

}   // end function destroy


saxStack.prototype.peek = function() {
    /*******************************************************************************************************************
    function:   peek

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(this.m_arr.length == 0) {
        return null;
    }

    return this.m_arr[this.m_arr.length - 1];

}  // end function peek


saxStack.prototype.pop = function() {
    /*******************************************************************************************************************
    function:   pop

    Author:   Scott Severtson
    *********************************************************************************************************************/
    if(this.m_arr.length == 0) {
        return null;
    }

    var o = this.m_arr[this.m_arr.length - 1];
    this.m_arr.length--;
    return o;

}  // end function pop


saxStack.prototype.push = function(o) {
    /*******************************************************************************************************************
    function:   push

    Author:   Scott Severtson
    *********************************************************************************************************************/

    this.m_arr[this.m_arr.length] = o;

}  // end function push



// =========================================================================
// =========================================================================
// =========================================================================

// CONVENIENCE FUNCTIONS

// =========================================================================
// =========================================================================
// =========================================================================

function isEmpty(str) {
    /*******************************************************************************************************************
    function: isEmpty

    Author: mike@idle.org

    Description:
        convenience function to identify an empty string

    *********************************************************************************************************************/
    return (str==null) || (str.length==0);

} // end function isEmpty



function trim(trimString, leftTrim, rightTrim) {
    /*******************************************************************************************************************
    function: trim

    Author: may106@psu.edu

    Description:
        helper function to trip a string (trimString) of leading (leftTrim)
        and trailing (rightTrim) whitespace

    *********************************************************************************************************************/
    if (isEmpty(trimString)) {
        return "";
    }

    // the general focus here is on minimal method calls - hence only one
    // substring is done to complete the trim.

    if (leftTrim == null) {
        leftTrim = true;
    }

    if (rightTrim == null) {
        rightTrim = true;
    }

    var left=0;
    var right=0;
    var i=0;
    var k=0;


    // modified to properly handle strings that are all whitespace
    if (leftTrim == true) {
        while ((i<trimString.length) && (whitespace.indexOf(trimString.charAt(i++))!=-1)) {
            left++;
        }
    }
    if (rightTrim == true) {
        k=trimString.length-1;
        while((k>=left) && (whitespace.indexOf(trimString.charAt(k--))!=-1)) {
            right++;
        }
    }
    return trimString.substring(left, trimString.length - right);
} // end function trim

/**
 * function __escapeString
 *
 * author: David Joham djoham@yahoo.com
 *
 * @param  str : string - The string to be escaped
 *
 * @return : string - The escaped string
 */
function __escapeString(str) {

    var escAmpRegEx = /&/g;
    var escLtRegEx = /</g;
    var escGtRegEx = />/g;
    var quotRegEx = /"/g;
    var aposRegEx = /'/g;

    str = str.replace(escAmpRegEx, "&amp;");
    str = str.replace(escLtRegEx, "&lt;");
    str = str.replace(escGtRegEx, "&gt;");
    str = str.replace(quotRegEx, "&quot;");
    str = str.replace(aposRegEx, "&apos;");

  return str;
}

/**
 * function __unescapeString 
 *
 * author: David Joham djoham@yahoo.com
 *
 * @param  str : string - The string to be unescaped
 *
 * @return : string - The unescaped string
 */
function __unescapeString(str) {

    var escAmpRegEx = /&amp;/g;
    var escLtRegEx = /&lt;/g;
    var escGtRegEx = /&gt;/g;
    var quotRegEx = /&quot;/g;
    var aposRegEx = /&apos;/g;

    str = str.replace(escAmpRegEx, "&");
    str = str.replace(escLtRegEx, "<");
    str = str.replace(escGtRegEx, ">");
    str = str.replace(quotRegEx, "\"");
    str = str.replace(aposRegEx, "'");

  return str;
}

// =========================================================================
//
// scripts.js- sample code for the SAX Parser in XML for <SCRIPT>
//
// =========================================================================
//
// Copyright (C) 2001, 2002 - David Joham (djoham@yahoo.com)
//
// This library is free software; you can redistribute it and/or
// modify it under the terms of the GNU Lesser General Public
// License as published by the Free Software Foundation; eithere
// version 2.1 of the License, or (at your option) any later version.

// This library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
// Lesser General Public License for more details.

// You should have received a copy of the GNU Lesser General Public
// License along with this library; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA


/**************************************************************************************
                                        GLOBALS
***************************************************************************************/

var xmlTextArray
var xmlCDataArray
var xmlAttrArray


/**************************************************************************************
                                        FUNCTIONS
***************************************************************************************/

function showTagInfo(xpath){
    /*************************************************************************************
    Function:       void showTagInfo(xpath)

    author:         xwisdom@yahoo.com

    description:
        displays information about a node. Uses the node's xpath info

    ************************************************************************************/

    var textValue;
    var cdataValue;

    textValue = trim(xmlTextArray[xpath]);

    if (textValue == "" || textValue == null) {
        textValue = "No text value for this node";
    }

    cdataValue = trim(xmlCDataArray[xpath]);


    if (cdataValue == "" || cdataValue == null) {
        cdataValue = "No CDATA value for this node";
    }

    var src='Text:\n '+textValue+'\n\n' +'CDATA:\n '+cdataValue +'\n\n'

    if(xmlAttrArray[xpath]){
        var arr=xmlAttrArray[xpath]
        var atts=''
        for (i in arr){
            // name = value
            atts+=i+'='+arr[i]+'\n';
        }
        src+='Attributes:\n '+atts
    }

    alert(xpath+'\n\n'+src)

} // end function showTagInfo


function startParser() {
    /*************************************************************************************
    Function:       void startParser(xmldata)

    author:         xwisdom@yahoo.com

    description:
        starts the sax2 parser

    ************************************************************************************/

    var ixml = document.getElementById("xmldata").value;

    var arr,src='' ,parser = new SAXDriver();
    var handler = new xmlHandler();


    // pass handlers to the sax2 parser
    parser.setDocumentHandler(handler);
    parser.setErrorHandler(handler);
    parser.setLexicalHandler(handler);

    parser.parse(ixml);// start parsing

    // get errors from sax2 parser
    var err='\n'+handler.getError();

    xmlTextArray=handler.getText_Array()
    xmlCDataArray=handler.getCDATA_Array()
    xmlAttrArray=handler.getAttr_Array()

    arr=handler.getPath_Array();
    for (i=0;i<arr.length;i++){
        src+='<a href="javascript:void(null)" onclick="showTagInfo(\''+arr[i]+'\')">'+arr[i]+'</a>\n'
    }

    if(document.all){
        document.all.divout.innerHTML='Parsing completed  | Click on the links below for more info:<br><pre>'+src+'</pre>'
    }else if(document.getElementById){
        document.getElementById('divout').innerHTML='Parsing completed | Click on the links below for more info:<br><pre>'+src+'</pre>'
    }else{
        alert('Requires a DOM compatible browser for this test')
    }

}// end function startParser



/***************************************************************************************
                                        SAX EVENT HANDLER
***************************************************************************************/


xmlHandler = function() {
    /*************************************************************************************
    Function:       xmlHandler

    author:         xwisdom@yahoo.com

    description:
    	constructor for the xmlHandler object

    ************************************************************************************/
    this.m_strError=''
    this.m_treePath=[]
    this.m_xPath=[''] // stores current path info
    this.m_text=['']
    this.m_cdata=['']
    this.m_attr=['']
    this.m_pi=['']
    this.cdata=false

} // end function xmlHandler


xmlHandler.prototype.characters = function(data, start, length) {
    /*************************************************************************************
    Function:       object.characters(String data, Int start, Int length)
					-> data: xml data
					-> start of text/cdata entity
					-> length of text/cdata entity

    author:         xwisdom@yahoo.com

    description:
    	this event is triggered whenever a text/cdata entity is encounter by the sax2 parser

    ************************************************************************************/

    // capture characters from CDATA and Text entities
    var text=data.substr(start, length);
    if (text=='\n' ) return null // get ride of blank text lines
    if (this.m_treePath.length>0){
        if(this.cdata==false){
            if (!this.m_text[this.m_xPath.join('/')]) {
                this.m_text[this.m_xPath.join('/')]='';
            }
            this.m_text[this.m_xPath.join('/')]+=text;
        }
        else {
            if (!this.m_cdata[this.m_xPath.join('/')]) {
                this.m_cdata[this.m_xPath.join('/')]='';
            }
            this.m_cdata[this.m_xPath.join('/')]+=text;
        }
    }

} // end function characters


xmlHandler.prototype.comment = function(data, start, length) {
    /*************************************************************************************
    Function:       object.comment(String data, Int start, Int length)

    author:         xwisdom@yahoo.com

    description:
		triggered whenever a comment <!-- text --> is found. Same as the character event

    ************************************************************************************/

    var comment=data.substr(start, length)

} // end function comment


xmlHandler.prototype.endCDATA = function() {
    /*************************************************************************************
    Function:       object.endCDATA()

    author:         xwisdom@yahoo.com

    description:
    	triggered at the end of cdata entity

    ************************************************************************************/

    // end of CDATA entity
    this.cdata=false

} // end function endCDATA


xmlHandler.prototype.endDocument = function() {
    /*************************************************************************************
    Function:       object.endDocument()

    author:         xwisdom@yahoo.com

    description:
    	end of document parsing - last event triggered by the sax2 parser

    ************************************************************************************/

} // end function end Document


xmlHandler.prototype.endElement = function(name) {
    /*************************************************************************************
    Function:       object.endElement(String tagname)
					-> tagname: name of tag

    author:         xwisdom@yahoo.com

    description:
    	last event trigger when a node is encounter by the sax2 parser

    ************************************************************************************/

    this.m_xPath=this.m_xPath.slice(0,-1);

} // end function endElement

xmlHandler.prototype.error = function(exception) {
    /*************************************************************************************
    Function:       object.error(String exception)

    author:         xwisdom@yahoo.com

    description:
		triggered whenever an error is encounter by the sax2 parser

    ************************************************************************************/

    this.m_strError+='Error:'+exception.getMessage()+'\n'

} // end function error


xmlHandler.prototype.fatalError = function(exception) {
    /*************************************************************************************
    Function:       object.fatalError(String exception)

    author:         xwisdom@yahoo.com

    description:
		triggered whenever an error is encounter by the sax2 parser

    ************************************************************************************/

    this.m_strError+='fatal error:'+exception.getMessage()+'\n'

} // end function fatalError


xmlHandler.prototype.getAttr_Array= function() {
    /*************************************************************************************
    Function:       getAttr_Array

    author:         xwisdom@yahoo.com
    ************************************************************************************/

    return this.m_attr;

}   // end function getAttr_Array


xmlHandler.prototype.getCDATA_Array= function() {
    /*************************************************************************************
    Function:       getCDATA_Array

    author:         xwisdom@yahoo.com
    ************************************************************************************/
    return this.m_cdata;

}  // end function getCDATA_Array


xmlHandler.prototype.getError = function() {
    /*************************************************************************************
    Function:       getError

    author:         xwisdom@yahoo.com
    ************************************************************************************/

    return this.m_strError;

}  // end function getError


xmlHandler.prototype.getPath_Array = function() {
    /*************************************************************************************
    Function:       getError

    author:         xwisdom@yahoo.com
    ************************************************************************************/
	return this.m_treePath;
}  // end function getPath_Array


xmlHandler.prototype.getText_Array = function() {
    /*************************************************************************************
    Function:       getText_Array

    author:         xwisdom@yahoo.com
    ************************************************************************************/
    return this.m_text;

} // getTextArray


xmlHandler.prototype.processingInstruction = function(target, data) {
    /*************************************************************************************
    Function:       object.processingInstruction(String target, String data)
						-> target: is tagname of the pi
						-> data: is the content of the pi

    author:         xwisdom@yahoo.com

    description:
    	capture PI data here

    ************************************************************************************/

} // end function processingInstruction


xmlHandler.prototype.setDocumentLocator = function(locator) {
    /*************************************************************************************
    Function:       object.setDocumentLocator(SAXDriver locator)

    author:         xwisdom@yahoo.com

    description:
		passes an instance of the SAXDriver to the handler

    ************************************************************************************/

    this.m_locator = locator;

}  // end function setDocumentLocator


xmlHandler.prototype.startCDATA = function() {
    /*************************************************************************************
    Function:       object.startCDATA()

    author:         xwisdom@yahoo.com

    description:
    	triggered whenever a cdata entity is encounter by the sax2 parser

    ************************************************************************************/


    // start of CDATA entity
    this.cdata=true

} // end function startCDATA


xmlHandler.prototype.startDocument = function() {
    /*************************************************************************************
    Function:       object.startDocument()

    author:         xwisdom@yahoo.com

    description:
    	start of document - first event triggered by the sax2 parser

    ************************************************************************************/

} // end function startDocument


xmlHandler.prototype.startElement = function(name, atts) {
    /*************************************************************************************
    Function:       object.startElement(String tagname,Array content)
					-> tagname: name of tag
					-> content: [["attribute1", "value1"], ["attribute2", "value2"],....,n]

    author:         xwisdom@yahoo.com

    description:
    	First event trigger when a node is encounter by the sax2 parser
    	the name and attribute contents are passed to this event

    ************************************************************************************/
alert(name);
    // Note: the following code is used to store info about the node
    // into arrays for use the xpath layout

    var cpath,att_count=atts.getLength()
    this.m_xPath[this.m_xPath.length]=name
    cpath=this.m_xPath.join('/')
    this.m_treePath[this.m_treePath.length]=cpath

    if (att_count) {
        var attr=[]
        for (i=0;i<att_count;i++){
            attr[atts.getName(i)]=atts.getValue(i)
        }
        this.m_attr[this.m_xPath.join('/')]=attr;
    }

} // end function startElement


xmlHandler.prototype.warning = function(exception) {
    /*************************************************************************************
    Function:       object.warninng(String exception)

    author:         xwisdom@yahoo.com

    description:
		triggered whenever an error is encounter by the sax2 parser

    ************************************************************************************/

    this.m_strError+='Warning:'+exception.getMessage()+'\n'

} // end function warning


function Timer()
{
    this.startTime = null;
    this.stopTime = null;
}

Timer.prototype.start = function()
{
    var date = new Date();
    
    this.startTime = date.getTime();
}

Timer.prototype.stop = function()
{
    var date = new Date();
    
    this.stopTime = date.getTime();
}

Timer.prototype.getTime = function()
{
    if (this.startTime && this.stopTime)
    {
        return (this.stopTime - this.startTime) / 1000;
    }
        
    return 0;
}
// From: http://www.codeproject.com/KB/scripting/dom-element-abs-pos.aspx

function __getIEVersion()
{
    var rv = -1; // Return value assumes failure.
    if (navigator.appName == 'Microsoft Internet Explorer')
    {
        var ua = navigator.userAgent;
        var re = new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");
        if (re.exec(ua) != null)
            rv = parseFloat(RegExp.$1);
    }
    return rv;
}

function __getOperaVersion()
{
    var rv = 0; // Default value
    if (window.opera)
    {
        var sver = window.opera.version();
        rv = parseFloat(sver);
    }
    return rv;
}

var __userAgent = navigator.userAgent;
var __isIE = navigator.appVersion.match(/MSIE/) != null;
var __IEVersion = __getIEVersion();
var __isIENew = __isIE && __IEVersion >= 8;
var __isIEOld = __isIE && !__isIENew;

var __isFireFox = __userAgent.match(/firefox/i) != null;
var __isFireFoxOld = __isFireFox && ((__userAgent.match(/firefox\/2./i) != null) ||
	(__userAgent.match(/firefox\/1./i) != null));
var __isFireFoxNew = __isFireFox && !__isFireFoxOld;

var __isWebKit = navigator.appVersion.match(/WebKit/) != null;
var __isChrome = navigator.appVersion.match(/Chrome/) != null;
var __isOpera = window.opera != null;
var __operaVersion = __getOperaVersion();
var __isOperaOld = __isOpera && (__operaVersion < 10);

function __parseBorderWidth(width)
{
    var res = 0;
    if (typeof (width) == "string" && width != null && width != "")
    {
        var p = width.indexOf("px");
        if (p >= 0)
        {
            res = parseInt(width.substring(0, p));
        }
        else
        {
            //do not know how to calculate other values 
            //(such as 0.5em or 0.1cm) correctly now
            //so just set the width to 1 pixel
            res = 1;
        }
    }
    return res;
}

//returns border width for some element
function __getBorderWidth(element)
{
    var res = new Object();
    res.left = 0; res.top = 0; res.right = 0; res.bottom = 0;
    if (window.getComputedStyle)
    {
        //for Firefox
        var elStyle = window.getComputedStyle(element, null);
        res.left = parseInt(elStyle.borderLeftWidth.slice(0, -2));
        res.top = parseInt(elStyle.borderTopWidth.slice(0, -2));
        res.right = parseInt(elStyle.borderRightWidth.slice(0, -2));
        res.bottom = parseInt(elStyle.borderBottomWidth.slice(0, -2));
    }
    else
    {
        //for other browsers
        res.left = __parseBorderWidth(element.style.borderLeftWidth);
        res.top = __parseBorderWidth(element.style.borderTopWidth);
        res.right = __parseBorderWidth(element.style.borderRightWidth);
        res.bottom = __parseBorderWidth(element.style.borderBottomWidth);
    }

    return res;
}

//returns the absolute position of some element within document
function getElementAbsolutePos(element)
{
    var res = new Object();
    res.x = 0; res.y = 0;
    if (element !== null)
    {
        if (element.getBoundingClientRect)
        {
            var viewportElement = document.documentElement;
            var box = element.getBoundingClientRect();
            var scrollLeft = viewportElement.scrollLeft;
            var scrollTop = viewportElement.scrollTop;

            res.x = box.left + scrollLeft;
            res.y = box.top + scrollTop;

        }
        else
        { //for old browsers
            res.x = element.offsetLeft;
            res.y = element.offsetTop;

            var parentNode = element.parentNode;
            var borderWidth = null;

            while (offsetParent != null)
            {
                res.x += offsetParent.offsetLeft;
                res.y += offsetParent.offsetTop;

                var parentTagName =
					offsetParent.tagName.toLowerCase();

                if ((__isIEOld && parentTagName != "table") ||
					((__isFireFoxNew || __isChrome) &&
						parentTagName == "td"))
                {
                    borderWidth = kGetBorderWidth
							(offsetParent);
                    res.x += borderWidth.left;
                    res.y += borderWidth.top;
                }

                if (offsetParent != document.body &&
				offsetParent != document.documentElement)
                {
                    res.x -= offsetParent.scrollLeft;
                    res.y -= offsetParent.scrollTop;
                }


                //next lines are necessary to fix the problem 
                //with offsetParent
                if (!__isIE && !__isOperaOld || __isIENew)
                {
                    while (offsetParent != parentNode &&
						parentNode !== null)
                    {
                        res.x -= parentNode.scrollLeft;
                        res.y -= parentNode.scrollTop;
                        if (__isFireFoxOld || __isWebKit)
                        {
                            borderWidth =
						     kGetBorderWidth(parentNode);
                            res.x += borderWidth.left;
                            res.y += borderWidth.top;
                        }
                        parentNode = parentNode.parentNode;
                    }
                }

                parentNode = offsetParent.parentNode;
                offsetParent = offsetParent.offsetParent;
            }
        }
    }
    
    return res;
}
/**
*	The end behavior enumeration
*/
var eEndBehavior =
{
    Reset: 0,
    Constant: 1,
    Repeat: 2,
    Oscillate: 3,
    OffsetRepeat: 4,
    Linear: 5
};

var eImageAntialiasOp =
{
    None: 0,
    TwoPass: 1,
    FourPass: 2,
    EightPass: 3,
    EnumCount: 4
};

/**
 * The key frame shape enumeration
 */
var eKeyframeShape =
{
    Linear: 0,
    Stepped: 1,
    TCB: 2,
    Bezier1D: 3,
    Bezier2D: 4,
    Hermite: 5
};

var eTextureType =
{
    // color textures
    Color: 0,
    // diffuse textures
    Diffuse: 1,
    // luminosity (emissive) textures
    Luminosity: 2,
    // reflection textures
    Reflection: 3,
    // specularity textures
    Specularity: 4,
    // transparency textures
    Transparency: 5,
    // clip textures
    Clip: 6,
    // bump textures
    Bump: 7,
    // number of texture types
    EnumCount: 8
};

var eTextureWrap =
{
    // no texture wrapping
    None: 0,
    // clamp texture wrapping
    Clamp: 1,
    // repeat texture wrapping
    Repeat: 2,
    // mirror texture wrapping
    Mirror: 3,
    // number of texture wraps
    EnumCount: 4
};

var eHighlightType =
{
    // disable highlights
    None: 0,
    // 4-pass
    FourPass: 1,
    // 8-pass
    EightPass: 2  
};

var eBoneFalloffType =
{
    InverseDistance: 0,
    // inverse distance / 2
    InverseDistance_2: 1,
    // inverse distance / 4
    InverseDistance_4: 2,
    // inverse distance / 8
    InverseDistance_8: 3,
    // inverse distance / 16
    InverseDistance_16: 4  
};

var FLT_EPSILON = 1.192092896e-07;
var FLT_MAX     = 3.402823466e+38;

var TWOPI     = Math.PI * 2;
var HALFPI    = Math.PI / 2;
var QUARTERPI = Math.PI / 4;

function min3(x, y, z)
{
    return Math.min(x, Math.min(y, z));
}

function max3(x, y, z)
{
    return Math.max(x, Math.max(y, z));
}

function toRadians(degrees)
{
    return degrees * Math.PI / 180;
}

function toDegrees(radians)
{
    return radians * 180 / Math.PI;
}

function magnitude(x, y, z)
{
    return Math.sqrt(((x) * (x)) + ((y) * (y)) + ((z) * (z)));
}

function magnitude4(w, x, y, z)
{
    return Math.sqrt(((w) * (w)) + ((x) * (x)) + ((y) * (y)) + ((z) * (z)));
}

function clamp(value, min, max)
{
    if (value < min) return min;
    if (value > max) return max;
    return value;
}

/*
 * Normalize a degree value so that it falls between [0, 360)
 * @params deg the degree value to normalize
 * @return T the normalized value
 */
function degreeNormalize(deg)
{
    while (deg < 0)
    {
        deg += 360;
    }

    while (deg >=360)
    {
        deg -= 360;
    }

    return deg;
}

function epsilonEqual(value1, value2, epsilon)
{
    if (Math.abs(value1 - value2) < epsilon)
    {
        return true;
    }
    
    return false;
}

function determinant2x2(_11, _12, 
                        _21, _23)
{
    return (_11 * _23) - (_12 * _21);
}

function determinant3x3(_11, _12, _13, 
                        _21, _22, _23,
                        _31, _32, _33)
{
    var a = determinant2x2(_22, _23, _32, _33);
    var b = determinant2x2(_21, _23, _31, _33);
    var c = determinant2x2(_21, _22, _31, _32);
    
    return (_11 * a) - (_12 * b) + (_13 * c);
}
        
function determinant4x4(_11, _12, _13, _14,
                        _21, _22, _23, _24,
                        _31, _32, _33, _34,
                        _41, _42, _43, _44)
{
    var a = determinant3x3(_22, _23, _24, _32, _33, _34, _42, _43, _44);
    var b = determinant3x3(_21, _23, _24, _31, _33, _34, _41, _43, _44);
    var c = determinant3x3(_21, _22, _24, _31, _32, _34, _41, _42, _44);
    var d = determinant3x3(_21, _22, _23, _31, _32, _33, _41, _42, _43);
    
    return (_11 * a) - (_12 * b) + (_13 * c) - (_14 * d);  
}        

function modf(x)
{
    var integerPart = (x < 0 ? Math.ceil(x) : Math.floor(x));
    var fractionalPart = x - integerPart;
    
    return { integerPart: integerPart, fractionalPart: fractionalPart };
}

function XYZtoH(x, y, z)
{
    var heading = 0;
    
    if (x == 0)
    {
        if (z >= 0)
        {
            heading = 0.0;
        }
        else
        {
            heading = Math.PI;
        }
    }
    else if (z == 0)
    {
        if (x >= 0)
        {
            heading = 3 * HALFPI;
        }
        else
        {
            heading = HALFPI;
        }
    }
    else
    {
        if (x > 0 && z > 0) // I
        {
            heading = TWOPI - Math.atan(x / z);
        }
        else if (x < 0 && z > 0) // II
        {
            heading = -Math.atan(x / z);
        }
        else if (x < 0 && z < 0)  // III
        {
            heading = HALFPI + Math.atan(z / x);
        }
        else // (x > 0 && z < 0)  // IV
        {
            heading = 3 * HALFPI + Math.atan(z / x);
        }
    }
    
    return heading;
}

function XYZtoHP(x, y, z)
{
    var heading = 0;
    var pitch = 0;
    
    if (x == 0 && z == 0) 
    {
        heading = 0;
        if (y != 0)
        {
            pitch = (y < 0 ? -HALFPI : HALFPI);
        }
        else
        {
            pitch = 0;
        }
    }
    else 
    {
        if (z == 0)
        {
            heading = (x > 0 ? HALFPI : -HALFPI);
        }
        else if (z < 0)
        {
            heading = -Math.atan(x / z) + Math.PI;
        }
        else
        {
            heading = -Math.atan(x / z);
        }

        x = Math.sqrt(x * x + z * z);

        if (x == 0)
        {
            pitch = (y < 0 ? -HALFPI : HALFPI);
        }
        else
        {
            pitch = Math.atan(y / x);
        }
    }
    
    return { heading: heading, pitch: pitch };
}

function rectContainsPoint(x, y, rect)
{
    if (x >= rect.left &&
        y >= rect.top &&
        x <= rect.right &&
        y <= rect.bottom)
        return true;
        
    return false;
}
function Vector2D(x, y)
{
    this.x = x || 0;
    this.y = y || 0;
}

Vector2D.prototype.v = function()
{
    var values = [ this.x, this.y ];
    return values;
}

Vector2D.prototype.load = function(x, y)
{
    this.x = x;
    this.y = y;
}

Vector2D.prototype.copy = function(vector)
{
    if (vector)
    {
        this.x = vector.x;
        this.y = vector.y;
    }
}
function Vector3D(x, y, z)
{
    this.x = x || 0;
    this.y = y || 0;
    this.z = z || 0;

    this.equals = function(rhs)
    {
        return (this.x == rhs.x &&
                this.y == rhs.y &&
                this.z == rhs.z);
    }
}

Vector3D.prototype.alert = function()
{
    var msg  = "x: " + this.x + "\n";
        msg += "y: " + this.y + "\n";
        msg += "z: " + this.z + "\n";
    alert(msg);
}

Vector3D.prototype.v = function()
{
    var values = [ this.x, this.y, this.z ];
    return values;
}

Vector3D.prototype.load = function(x, y, z)
{
    this.x = x;
    this.y = y;
    this.z = z;
}

Vector3D.prototype.copy = function(vector)
{
    if (vector)
    {
        this.x = vector.x;
        this.y = vector.y;
        this.z = vector.z;
    }
}

Vector3D.prototype.multiplyScalar = function(scalar)
{
    this.x *= scalar;
    this.y *= scalar;
    this.z *= scalar;
}

Vector3D.prototype.multiplyVector = function(vector)
{
    this.x *= vector.x;
    this.y *= vector.y;
    this.z *= vector.z;
}

Vector3D.prototype.addVector = function(vector)
{
    this.x += vector.x;
    this.y += vector.y;
    this.z += vector.z;
}

Vector3D.prototype.subtractVector = function(vector)
{
    this.x -= vector.x;
    this.y -= vector.y;
    this.z -= vector.z;
}

Vector3D.prototype.normalize = function()
{
    var mag = magnitude(this.x, this.y, this.z);
    if (mag != 0)
    {
        this.x /= mag;
        this.y /= mag;
        this.z /= mag;
    }
}

function dotProduct(v1, v2)
{
    return ((v1.x * v2.x) + (v1.y * v2.y) + (v1.z * v2.z));
}

function crossProduct(v1, v2)
{
    var result = new Vector3D();
    
    result.x = (v1.y * v2.z) - (v1.z * v2.y);
    result.y = (v1.z * v2.x) - (v1.x * v2.z);
    result.z = (v1.x * v2.y) - (v1.y * v2.x);
    
    return result;
}

function cosineAngleBetween(v1, v2)
{
    var mag = magnitude(v1.x, v1.y, v1.z) * magnitude(v2.x, v2.y, v2.z);
    if (mag != 0)
    {
        var cosAngle = dotProduct(v1, v2) / mag;

        // clamp values between -1 and 1
        if (cosAngle > 1) cosAngle = 1;
        else if (cosAngle < -1) cosAngle = -1;

        return cosAngle;
    }

    return 1;
}

function midpoint(v1, v2)
{
    var result = new Vector3D();
    
    result.x = (v1.x + v2.x) / 2;
    result.y = (v1.y + v2.y) / 2;
    result.z = (v1.z + v2.z) / 2;
    
    return result;
}

function distanceBetween(v1, v2)
{
    return Math.sqrt((v1.x - v2.x) * (v1.x - v2.x) + 
                     (v1.y - v2.y) * (v1.y - v2.y) +
                     (v1.z - v2.z) * (v1.z - v2.z));
}

function subtract3D(v1, v2)
{
    var result = new Vector3D(v1.x, v1.y, v1.z);
    result.subtractVector(v2);
    return result;
}
function Vector4D(x, y, z, w)
{
    this.x = x || 0;
    this.y = y || 0;
    this.z = z || 0;
    this.w = w || 0;
}

Vector4D.prototype.v = function()
{
    var values = [ this.x, this.y, this.z, this.w ];
    return values;
}

Vector4D.prototype.load = function(x, y, z, w)
{
    if (Vector4D)
    {
        this.x = x;
        this.y = y;
        this.z = z;
        this.w = w;
    }
}

Vector4D.prototype.copy = function(vector)
{
    this.x = vector.x;
    this.y = vector.y;
    this.z = vector.z;
    this.w = vector.w;
}
function Matrix4x4(_11, _12, _13, _14,
                   _21, _22, _23, _24,
                   _31, _32, _33, _34,
                   _41, _42, _43, _44)
{
    this._11 = _11 || 1;
    this._12 = _12 || 0;
    this._13 = _13 || 0;
    this._14 = _14 || 0;

    this._21 = _21 || 0;
    this._22 = _22 || 1;
    this._23 = _23 || 0;
    this._24 = _24 || 0;

    this._31 = _31 || 0;
    this._32 = _32 || 0;
    this._33 = _33 || 1;
    this._34 = _34 || 0;

    this._41 = _41 || 0;
    this._42 = _42 || 0;
    this._43 = _43 || 0;
    this._44 = _44 || 1;
}

Matrix4x4.prototype.alert = function()
{
    alert([[this._11, this._12, this._13, this._14].join(" "),
           [this._21, this._22, this._23, this._24].join(" "),
           [this._31, this._32, this._33, this._34].join(" "),
           [this._41, this._42, this._43, this._44].join(" ")].join("\n") 
    );
}

Matrix4x4.prototype.flatten = function()
{
    var v = [
        this._11, this._12, this._13, this._14,
        this._21, this._22, this._23, this._24,
        this._31, this._32, this._33, this._34,
        this._41, this._42, this._43, this._44
    ];
    
    return v;
}

Matrix4x4.prototype.getAt = function(row, col)
{
    switch (row)
    {
    case 0:
        {
            switch (col)
            {
            case 0: return this._11;
            case 1: return this._12;
            case 2: return this._13;
            case 3: return this._14;
            }
        }
        break;
     
    case 1:
        {
            switch (col)
            {
            case 0: return this._21;
            case 1: return this._22;
            case 2: return this._23;
            case 3: return this._24;
            }
        }
        break;
        
    case 2:
        {
            switch (col)
            {
            case 0: return this._31;
            case 1: return this._32;
            case 2: return this._33;
            case 3: return this._34;
            }
        }
        break;
        
    case 3:
        {
            switch (col)
            {
            case 0: return this._41;
            case 1: return this._42;
            case 2: return this._43;
            case 3: return this._44;
            }
        }
        break;
    }
}

Matrix4x4.prototype.setAt = function(row, col, value)
{
    switch (row)
    {
    case 0:
        {
            switch (col)
            {
            case 0: this._11 = value; break;
            case 1: this._12 = value; break;
            case 2: this._13 = value; break;
            case 3: this._14 = value; break;
            }
        }
        break;
     
    case 1:
        {
            switch (col)
            {
            case 0: this._21 = value; break;
            case 1: this._22 = value; break;
            case 2: this._23 = value; break;
            case 3: this._24 = value; break;
            }
        }
        break;
        
    case 2:
        {
            switch (col)
            {
            case 0: this._31 = value; break;
            case 1: this._32 = value; break;
            case 2: this._33 = value; break;
            case 3: this._34 = value; break;
            }
        }
        break;
        
    case 3:
        {
            switch (col)
            {
            case 0: this._41 = value; break;
            case 1: this._42 = value; break;
            case 2: this._43 = value; break;
            case 3: this._44 = value; break;
            }
        }
        break;
    }
}

Matrix4x4.prototype.load = function(_11, _12, _13, _14,
                                    _21, _22, _23, _24,
                                    _31, _32, _33, _34,
                                    _41, _42, _43, _44)
{
    this._11 = _11;
    this._12 = _12;
    this._13 = _13;
    this._14 = _14;
    
    this._21 = _21;
    this._22 = _22;
    this._23 = _23;
    this._24 = _24;
    
    this._31 = _31;
    this._32 = _32;
    this._33 = _33;
    this._34 = _34;
    
    this._41 = _41;
    this._42 = _42;
    this._43 = _43;
    this._44 = _44;
}

Matrix4x4.prototype.loadMatrix = function(matrix)
{
    this._11 = matrix._11;
    this._12 = matrix._12;
    this._13 = matrix._13;
    this._14 = matrix._14;
    
    this._21 = matrix._21;
    this._22 = matrix._22;
    this._23 = matrix._23;
    this._24 = matrix._24;
    
    this._31 = matrix._31;
    this._32 = matrix._32;
    this._33 = matrix._33;
    this._34 = matrix._34;
    
    this._41 = matrix._41;
    this._42 = matrix._42;
    this._43 = matrix._43;
    this._44 = matrix._44;
}

Matrix4x4.prototype.loadArray = function(array)
{
    this._11 = array[0];
    this._12 = array[1];
    this._13 = array[2];
    this._14 = array[3];

    this._21 = array[4];
    this._22 = array[5];
    this._23 = array[6];
    this._24 = array[7];

    this._31 = array[8];
    this._32 = array[9];
    this._33 = array[10];
    this._34 = array[11];

    this._41 = array[12];
    this._42 = array[13];
    this._43 = array[14];
    this._44 = array[15];
}

Matrix4x4.prototype.loadIdentity = function()
{
    this._11 = 1;
    this._12 = 0;
    this._13 = 0;
    this._14 = 0;
        
    this._21 = 0;
    this._22 = 1;
    this._23 = 0;
    this._24 = 0;
    
    this._31 = 0;
    this._32 = 0;
    this._33 = 1;
    this._34 = 0;
    
    this._41 = 0;
    this._42 = 0;
    this._43 = 0;
    this._44 = 1;
}

Matrix4x4.prototype.loadTranslation = function(x, y, z)
{
    this.loadIdentity();
    
    this._41 = x;
    this._42 = y;
    this._43 = z;
}

Matrix4x4.prototype.loadRotation = function(x, y, z, degrees)
{
    // build rotation (and inverse rotation) matrix to rotate space 
    // about the X axis so that the rotation axis lies in the XZ plane
    var mX = new Matrix4x4();
    var mXinv = new Matrix4x4();
    var v = Math.sqrt(y * y + z * z);
    if (v != 0)
    {
        var y_v = y / v;
        var z_v = z / v;

        mX._22 =  z_v;
        mX._23 =  y_v;
        mX._32 = -y_v;
        mX._33 =  z_v;

        mXinv._22 =  z_v;
        mXinv._23 = -y_v;
        mXinv._32 =  y_v;
        mXinv._33 =  z_v;
    }

    // build rotation (and inverse rotation) matrix to rotate space 
    // about the Y axis so that the rotation axis is aligned with the Z axis
    var mY = new Matrix4x4();
    var mYinv = new Matrix4x4();
    var v2 = magnitude(x, y, z);
    if (v2 != 0)
    {
        var v_v2 = v / v2;
        var x_v2 = x / v2;

        mY._11 =  v_v2;
        mY._13 =  x_v2;
        mY._31 = -x_v2;
        mY._33 =  v_v2;

        mYinv._11 =  v_v2;
        mYinv._13 = -x_v2;
        mYinv._31 =  x_v2;
        mYinv._33 =  v_v2;
    }

    // build rotation matrix to rotate about the Z axis
    var mZ = new Matrix4x4();
    var cosAngle = Math.cos(toRadians(degrees));
    var sinAngle = Math.sin(toRadians(degrees));
    mZ._11 =  cosAngle;
    mZ._12 =  sinAngle;
    mZ._21 = -sinAngle;
    mZ._22 =  cosAngle;

    // sum rotations
    var result = mX.multiply(mY.multiply(mZ.multiply(mYinv.multiply(mXinv))));
    this.loadMatrix(result);
}

Matrix4x4.prototype.loadXAxisRotation = function(degrees)
{
    this.loadIdentity();

    var cosAngle = Math.cos(toRadians(degrees));
    var sinAngle = Math.sin(toRadians(degrees));

    this._22 =  cosAngle;
    this._23 =  sinAngle;
    this._32 = -sinAngle;
    this._33 =  cosAngle;
}

Matrix4x4.prototype.loadYAxisRotation = function(degrees)
{
    this.loadIdentity();

    var cosAngle = Math.cos(toRadians(degrees));
    var sinAngle = Math.sin(toRadians(degrees));

    this._11 =  cosAngle;
    this._13 = -sinAngle;
    this._31 =  sinAngle;
    this._33 =  cosAngle;
}

Matrix4x4.prototype.loadZAxisRotation = function(degrees)
{
    this.loadIdentity();

    var cosAngle = Math.cos(toRadians(degrees));
    var sinAngle = Math.sin(toRadians(degrees));

    this._11 =  cosAngle;
    this._12 =  sinAngle;
    this._21 = -sinAngle;
    this._22 =  cosAngle;
}

Matrix4x4.prototype.loadXYZAxisRotation = function(degreesX, degreesY, degreesZ)
{
    var mX = new Matrix4x4();
    var mY = new Matrix4x4();
    var mZ = new Matrix4x4();

    mX.loadXAxisRotation(degreesX);
    mY.loadYAxisRotation(degreesY);
    mZ.loadZAxisRotation(degreesZ);

    // sum rotations
    var result = mY.multiply(mX.multiply(mZ));
    this.loadMatrix(result);
}

Matrix4x4.prototype.getRotationAngles = function()
{
    var x, y, z;
    
    x = Math.asin(clamp(this._23, -1, 1));
    var cosx = Math.cos(x);
    
    if (!epsilonEqual(cosx, 0, FLT_EPSILON))
    {
        y = Math.atan2(-(this._13) / cosx, this._33 / cosx);
        z = Math.atan2(-(this._21) / cosx, this._22 / cosx); 
    }
    else // cosx == 0
    {
        // remove x-axis rotation to obtain z-axis rotation by 
        // multiplying this matrix with inverse of x-axis rotation
        var zAxisRot = new Matrix4x4();
        zAxisRot.loadXAxisRotation(toDegrees(x));
        zAxisRot.transpose(); // invert rotation
        zAxisRot.loadMatrix(zAxisRot.multiply(this));
        
        y = 0;
        z = Math.atan2(-(zAxisRot._21), zAxisRot._22);
    }
    
    return { x: toDegrees(x), y: toDegrees(y), z: toDegrees(z) };
}

Matrix4x4.prototype.getQuaternion = function()
{
    var m = new Matrix4x4();
    m.loadMatrix(this);
    
    // remove scale
    var scalingFactors = m.getScalingFactors();
    var scale = new Matrix4x4();
    scale.loadScale(1 / scalingFactors.x, 1 / scalingFactors.y, 1 / scalingFactors.z);
    m = m.multiply(scale);
    
    m.transpose();
    
    var q = new Quaternion();
    
    q.w = Math.sqrt( Math.max( 0, 1 + m._11 + m._22 + m._33 ) ) / 2; 
    q.x = Math.sqrt( Math.max( 0, 1 + m._11 - m._22 - m._33 ) ) / 2; 
    q.y = Math.sqrt( Math.max( 0, 1 - m._11 + m._22 - m._33 ) ) / 2; 
    q.z = Math.sqrt( Math.max( 0, 1 - m._11 - m._22 + m._33 ) ) / 2; 
    
    q.x *= SIGN( m._32 - m._23 );
    q.y *= SIGN( m._13 - m._31 );
    q.z *= SIGN( m._21 - m._12 );
    
    return q;
}

Matrix4x4.prototype.loadScale = function(x, y, z)
{
    this.loadIdentity();

    this._11 = x;
    this._22 = y;
    this._33 = z;
}

Matrix4x4.prototype.getScalingFactors = function()
{
    var a, b;
    
    // x
    a = this.transform(1, 0, 0, 0);
    b = this.transform(2, 0, 0, 0);
    var scalingX = magnitude(b.x, b.y, b.z) - magnitude(a.x, a.y, a.z);
    
    // y
    a = this.transform(0, 1, 0, 0);
    b = this.transform(0, 2, 0, 0);
    var scalingY = magnitude(b.x, b.y, b.z) - magnitude(a.x, a.y, a.z);
    
    // z
    a = this.transform(0, 0, 1, 0);
    b = this.transform(0, 0, 2, 0);
    var scalingZ = magnitude(b.x, b.y, b.z) - magnitude(a.x, a.y, a.z);
    
    return { x: scalingX, y: scalingY, z: scalingZ };
}

Matrix4x4.prototype.multiply = function(rhs)
{
    var result = new Matrix4x4();
    
    if (!rhs)
    {
        return null;    
    }
    
    result.load
    (
        this._11 * rhs._11 + this._12 * rhs._21 + this._13 * rhs._31 + this._14 * rhs._41,
        this._11 * rhs._12 + this._12 * rhs._22 + this._13 * rhs._32 + this._14 * rhs._42,
        this._11 * rhs._13 + this._12 * rhs._23 + this._13 * rhs._33 + this._14 * rhs._43,
        this._11 * rhs._14 + this._12 * rhs._24 + this._13 * rhs._34 + this._14 * rhs._44,
        this._21 * rhs._11 + this._22 * rhs._21 + this._23 * rhs._31 + this._24 * rhs._41,
        this._21 * rhs._12 + this._22 * rhs._22 + this._23 * rhs._32 + this._24 * rhs._42,
        this._21 * rhs._13 + this._22 * rhs._23 + this._23 * rhs._33 + this._24 * rhs._43,
        this._21 * rhs._14 + this._22 * rhs._24 + this._23 * rhs._34 + this._24 * rhs._44,
        this._31 * rhs._11 + this._32 * rhs._21 + this._33 * rhs._31 + this._34 * rhs._41,
        this._31 * rhs._12 + this._32 * rhs._22 + this._33 * rhs._32 + this._34 * rhs._42,
        this._31 * rhs._13 + this._32 * rhs._23 + this._33 * rhs._33 + this._34 * rhs._43,
        this._31 * rhs._14 + this._32 * rhs._24 + this._33 * rhs._34 + this._34 * rhs._44,
        this._41 * rhs._11 + this._42 * rhs._21 + this._43 * rhs._31 + this._44 * rhs._41,
        this._41 * rhs._12 + this._42 * rhs._22 + this._43 * rhs._32 + this._44 * rhs._42,
        this._41 * rhs._13 + this._42 * rhs._23 + this._43 * rhs._33 + this._44 * rhs._43,  
        this._41 * rhs._14 + this._42 * rhs._24 + this._43 * rhs._34 + this._44 * rhs._44
     );
     
     return result; 
}

Matrix4x4.prototype.leftMultiply = function(lhs)
{
    var result = lhs.multiply(this);
    
    return result;
}

Matrix4x4.prototype.transpose = function()
{
    var temp = new Matrix4x4();
    temp.loadMatrix(this);
    
    this._11 = temp._11;
    this._12 = temp._21;
    this._13 = temp._31;
    this._14 = temp._41;

    this._21 = temp._12;
    this._22 = temp._22;
    this._23 = temp._32;
    this._24 = temp._42;

    this._31 = temp._13;
    this._32 = temp._23;
    this._33 = temp._33;
    this._34 = temp._43;

    this._41 = temp._14;
    this._42 = temp._24;
    this._43 = temp._34;
    this._44 = temp._44;
}

Matrix4x4.prototype.invert = function()
{
    var det = determinant4x4(this._11, this._12, this._13, this._14,
                             this._21, this._22, this._23, this._24,
                             this._31, this._32, this._33, this._34,
                             this._41, this._42, this._43, this._44);
    if (det == 0)
    {
        // no inverse
        return;
    }
    
    var inverse  = new Matrix4x4();
    
    var i, j, i2, j2, k;
    
    for (i=0; i < 4; i++)
    {
        for (j=0; j < 4; j++)
        {
            var sub = [];

            for (i2=0, k=0; i2 < 4; i2++)
            {
                if (i2 == i) continue;

                for (j2=0; j2 < 4; j2++)
                {
                    if (j2 == j) continue;

                    sub[k++] = this.getAt(i2, j2);
                }
            }

            inverse.setAt(i, j, determinant3x3(sub[0], sub[1], sub[2], sub[3], sub[4], sub[5], sub[6], sub[7], sub[8]) / det * (i+j & 1 ? -1 : 1));
        }
    }

    // transpose
    inverse.transpose();

    this.loadMatrix(inverse);
}

Matrix4x4.prototype.transform = function(x, y, z, w)
{
    var tx, ty, tz;
    
    if (w == 0)
    {
        tx = this._11 * x + this._21 * y + this._31 * z;
        ty = this._12 * x + this._22 * y + this._32 * z;
        tz = this._13 * x + this._23 * y + this._33 * z;
    }
    else if (w == 1)
    {
        tx = this._11 * x + this._21 * y + this._31 * z + this._41;
        ty = this._12 * x + this._22 * y + this._32 * z + this._42;
        tz = this._13 * x + this._23 * y + this._33 * z + this._43;
    }
    else
    {
        tx = this._11 * x + this._21 * y + this._31 * z + this._41 * w;
        ty = this._12 * x + this._22 * y + this._32 * z + this._42 * w;
        tz = this._13 * x + this._23 * y + this._33 * z + this._43 * w;
    } 
    
    return { x: tx, y: ty, z: tz };
}

Matrix4x4.prototype.transformw = function(x, y, z, w)
{
    var tx, ty, tz, tw;
    
    if (w == 0)
    {
        tx = this._11 * x + this._21 * y + this._31 * z;
        ty = this._12 * x + this._22 * y + this._32 * z;
        tz = this._13 * x + this._23 * y + this._33 * z;
        tw = this._14 * x + this._24 * y + this._34 * z;
    }
    else if (w == 1)
    {
        tx = this._11 * x + this._21 * y + this._31 * z + this._41;
        ty = this._12 * x + this._22 * y + this._32 * z + this._42;
        tz = this._13 * x + this._23 * y + this._33 * z + this._43;
        tw = this._14 * x + this._24 * y + this._34 * z + this._44;
    }
    else
    {
        tx = this._11 * x + this._21 * y + this._31 * z + this._41 * w;
        ty = this._12 * x + this._22 * y + this._32 * z + this._42 * w;
        tz = this._13 * x + this._23 * y + this._33 * z + this._43 * w;
        tw = this._14 * x + this._24 * y + this._34 * z + this._44 * w;
    } 
    
    return { x: tx, y: ty, z: tz, w: tw };
}

Matrix4x4.prototype.transformVector3D = function(vector, w)
{
    return this.transform(vector.x, vector.y, vector.z, w);
}
MatrixStack.prototype = new Stack();
MatrixStack.prototype.constructor = MatrixStack;

function MatrixStack(element)
{
    Stack.call(this, element);
}

MatrixStack.prototype.push = function(element)
{
    if (element)
    {
        this.stack.push(element);
    }
    else
    {
        this.stack.push(this.top());
    }
}

MatrixStack.prototype.loadMatrix = function(matrix)
{
    this.load(matrix);
}

MatrixStack.prototype.leftMultiply = function(lhs)
{
    var result = lhs.multiply(this.top());
    this.pop();
    Stack.prototype.push.call(this, result);
}

MatrixStack.prototype.rightMultiply = function(rhs)
{
    var result = this.top().multiply(rhs);
    this.pop();
    Stack.prototype.push.call(this, result);
}

function Quaternion(w, x, y, z)
{
    this.w = w || 1;
    this.x = x || 0;
    this.y = y || 0;
    this.z = z || 0;
}

Quaternion.prototype.load = function(w, x, y, z)
{
    this.w = w;
    this.x = x;
    this.y = y;
    this.z = z;
}

Quaternion.prototype.loadQuaternion = function(quaternion)
{
    this.w = quaternion.w;
    this.x = quaternion.x;
    this.y = quaternion.y;
    this.z = quaternion.z;
}

Quaternion.prototype.loadArray = function(array)
{
    this.w = array[0];
    this.x = array[1];
    this.y = array[2];
    this.z = array[3];
}

Quaternion.prototype.loadIdentity = function()
{
    this.w = 1;
    this.x = 0;
    this.y = 0;
    this.z = 0;
}

Quaternion.prototype.magnitude = function()
{
    return Math.sqrt(this.w * this.w + this.x * this.x + this.y * this.y + this.z * this.z);
}

Quaternion.prototype.normalize = function()
{
    var magnitude = this.magnitude();
    
    this.w /= magnitude;
    this.x /= magnitude;
    this.y /= magnitude;
    this.z /= magnitude; 
}

Quaternion.prototype.loadRotation = function(x, y, z, degrees)
{
    var radians = toRadians(degrees) / 2;
    
    var sinAngle = Math.sin(radians);
    var cosAngle = Math.cos(radians);
    
    this.w = cosAngle;
    this.x = x * sinAngle;
    this.y = y * sinAngle;
    this.z = z * sinAngle;
    
    this.normalize();
}

Quaternion.prototype.loadXAxisRotation = function(degrees)
{
    var radians = toRadians(degrees) / 2;
    
    this.w = Math.cos(radians);
    this.x = Math.sin(radians);
    this.y = 0;
    this.z = 0;
}

Quaternion.prototype.loadYAxisRotation = function(degrees)
{
    var radians = toRadians(degrees) / 2;
    
    this.w = Math.cos(radians);
    this.x = 0
    this.y = Math.sin(radians);;
    this.z = 0;
}

Quaternion.prototype.loadZAxisRotation = function(degrees)
{
    var radians = toRadians(degrees) / 2;
    
    this.w = Math.cos(radians);
    this.x = 0;
    this.y = 0;
    this.z = Math.sin(radians);
}

Quaternion.prototype.loadXYZAxisRotation = function(degreesX, degreesY, degreesZ)
{
    var radiansX = toRadians(degreesX) / 2;
    var radiansY = toRadians(degreesY) / 2;
    var radiansZ = toRadians(degreesZ) / 2;
    
    var qX = new Quaternion();
    qX.load(Math.cos(radiansX), Math.sin(radiansX), 0, 0);
    
    var qY = new Quaternion();
    qY.load(Math.cos(radiansY), 0, Math.sin(radiansY), 0);
    
    var qZ = new Quaternion();
    qZ.load(Math.cos(radiansZ), 0, 0, Math.sin(radiansZ));
    
    // sum rotations
    var result = qY.multiply(qX.multiply(qZ));
    this.loadQuaternion(result);
}

Quaternion.prototype.multiply = function(rhs)
{
    var result = new Quaternion();
    
    result.load
    (
        this.w * rhs.w - this.x * rhs.x - this.y * rhs.y - this.z * rhs.z,
        this.w * rhs.x + this.x * rhs.w + this.y * rhs.z - this.z * rhs.y,
        this.w * rhs.y + this.y * rhs.w + this.z * rhs.x - this.x * rhs.z,
        this.w * rhs.z + this.z * rhs.w + this.x * rhs.y - this.y * rhs.x    
    );
    
    return result;
}

Quaternion.prototype.getMatrix = function()
{
    var matrix = new Matrix4x4();
    
    var x2 = this.x + this.x;
    var y2 = this.y + this.y;
    var z2 = this.z + this.z;
    var xx = this.x * x2;
    var xy = this.x * y2;
    var xz = this.x * z2;
    var yy = this.y * y2;
    var yz = this.y * z2;
    var zz = this.z * z2;
    var wx = this.w * x2;
    var wy = this.w * y2;
    var wz = this.w * z2;

    matrix._11 = 1 - (yy + zz);
    matrix._21 = xy - wz;
    matrix._31 = xz + wy;
    matrix._41 = 0;

    matrix._12 = xy + wz;
    matrix._22 = 1 - (xx + zz);
    matrix._32 = yz - wx;
    matrix._42 = 0;

    matrix._13 = xz - wy;
    matrix._23 = yz + wx;
    matrix._33 = 1 - (xx + yy);
    matrix._43 = 0;

    matrix._14 = 0;
    matrix._24 = 0;
    matrix._34 = 0;
    matrix._44 = 1;
    
    return matrix;
}

Quaternion.prototype.getRotationAngles = function()
{
    var x2 = this.x * this.x;
    var y2 = this.y * this.y;
    var z2 = this.z * this.z;
    var xy = this.x * this.y;
    var xz = this.x * this.z
    var yz = this.y * this.z;
    var wx = this.w * this.x;
    var wy = this.w * this.y;
    var wz = this.w * this.z;   
    var yz = this.y * this.z;
    
    var x = Math.atan2(2 * (wx + yz), 1 - 2 * (x2 + y2));
    var y = Math.asin(2 * (wy - xz));
    var z = Math.atan2(2 * (wz + xy), 1 - 2 * (y2 + z2));
    
    return { x: toDegrees(x), y: toDegrees(y), z: toDegrees(z) }
}


function Line(point, dir)
{
    this.point = new Vector3D(point.x, point.y, point.z);
    this.dir = new Vector3D(dir.x, dir.y, dir.z);
}
function Plane(point, normal)
{
    this.point = new Vector3D();
    this.normal = new Vector3D();
    this.dot = 0;
    
    if (point && normal)
    {
        this.point.copy(point);
        this.normal.copy(normal);
        this.dot = dotProduct(this.point, this.normal);
    }
}

Plane2.prototype = new Plane();
Plane2.prototype.constructor = Plane2;

function Plane2(v0, v1, v2)
{
    var normal;

    if (v0 && v1 && v2)
    {
        var leg1 = new Vector3D(v2.x - v1.x, v2.y - v1.y, v2.z - v1.z);
        var leg2 = new Vector3D(v0.x - v1.x, v0.y - v1.y, v0.z - v1.z);
        normal = crossProduct(leg1, leg2);
        normal.normalize();
    }
    
    Plane.call(this, v0, normal);
}

/**
 * Determine if a point lies on the plane.
 * @param point     - the point.
 * @param plane     - the plane.
 * @param tolerance - tolerance amount.
 * @return bool     - true if the point lies on the plane, false if it does not.
 */
function pointOnPlane(point, plane, tolerance)
{
    return (Math.abs(dotProduct(point, plane.normal) - plane.dot) < tolerance ? true : false);
}

/**
 * Determine if a point lies on the positive side of the plane; i.e., determine if the 
 * point lies in the half-space on the side of the plane in the direction of the normal.
 * @param point     - the point.
 * @param plane     - the plane.
 * @return bool     - true if the point lies on the positive side of the plane, false if 
 *                    it does not.
 */
function pointOnPositiveSideOfPlane(point, plane)
{
    return (dotProduct(point, plane.normal) - plane.dot > 0 ? true : false);
}

/**
 * Determine if a point lies on the negative side of the plane; i.e., determine if the 
 * point lies in the half-space on the side of the plane in the opposite direction of the 
 * normal.
 * @param point     - the point.
 * @param plane     - the plane.
 * @return bool     - true if the point lies on the negative side of the plane, false if 
 *                    it does not.
 */
function pointOnNegativeSideOfPlane(point, plane)
{
    return (dotProduct(point, plane.normal) - plane.dot < 0 ? true : false);
}

/**
 * Determine if a line intersects the plane.  If it does, find the point of intersection.
 * @param line  - the line.
 * @param plane - the plane.
 * @param point - the point of intersection (if line intersects plane).
 * @return int  - returns:
 *                  0 if line does not intersect plane
 *                  1 if line intersects plane at one point
 *                  2 if line intersects plane at infinite points (line lies on plane)
 */
function lineIntersectsPlane(line, plane)
{
    var point = new Vector3D();
    var result;
    
    // solve for t in terms of plane equation Ax + By + Cz = D
    var lhs = plane.normal.x * line.dir.x + plane.normal.y * line.dir.y + plane.normal.z * line.dir.z;
    if (lhs == 0)  // plane and line are parallel
    {
        // if line point lies on the plane, consider this an intersection
        if (pointOnPlane(line.point, plane, FLT_EPSILON))
        {
            point.copy(line.point);
            result = 2;
        }

        result = 0;
    }
    else
    {
        var rhs = plane.dot - (plane.normal.x * line.point.x + plane.normal.y * line.point.y + plane.normal.z * line.point.z);
        var t = rhs / lhs;

        // calculate point of intersection
        point.x = t * line.dir.x + line.point.x;
        point.y = t * line.dir.y + line.point.y;
        point.z = t * line.dir.z + line.point.z;

        result = 1;
    }

    return { result: result, point: point };
}

/**
 * Determine if a line segment intersects the plane.  If it does, find the point of intersection.
 * @param a      - one endpoint of the line segment.
 * @param b      - other endpoint of the line segment.
 * @param plane  - the plane.
 * @return point - the point of intersection (if line segment intersects plane).
 * @return count - returns:
 *                  0 if line segment does not intersect plane
 *                  1 if line segment intersects plane at one point
 *                  2 if line segment intersects plane at infinite points (line segment lies on plane)
 */
function lineSegmentPlaneIntersection(a, b, plane)
{
    // represent line segment in parametric line equation form;
    // line through P0(x0, y0, z0) parallel to v = Ai + Bj + Ck =>
    // x = x0 + tA, y = y0 + tB, z = z0 + tC
    var ab = new Vector3D(b.x - a.x, b.y - a.y, b.z - a.z);
    var x0 = a.x;
    var y0 = a.y;
    var z0 = a.z;
    var tA = ab.x;
    var tB = ab.y;
    var tC = ab.z;

    // solve for t in terms of plane equation Ax + By + Cz = D
    var lhs = plane.normal.x * tA + plane.normal.y * tB + plane.normal.z * tC;
    if (lhs == 0)  // plane and line segment are parallel
    {
        // if a lies on the plane, consider this an intersection
        if (pointOnPlane(a, plane, FLT_EPSILON))
        {
            var point = new Vector3D(a);
            return { count: 2, point: point };
        }

        return { count: 0 };
    }

    var rhs = plane.dot - (plane.normal.x * x0 + plane.normal.y * y0 + plane.normal.z * z0);
    var t = rhs / lhs;

    // if t is not in range [0, 1], then point of intersection is not
    // within line segment
    if (t < 0 || t > 1) 
    {
        return { count: 0 };
    }

    // point of intersection is within line segment; calculate point
    var point = new Vector3D();
    point.x = t * tA + x0;
    point.y = t * tB + y0;
    point.z = t * tC + z0;

    return { count: 1, point: point };
}

/**
 * Determine if planes are coplanar.
 * @param plane1 - the first plane.
 * @param plane2 - the second plane.
 * @return bool  - true if the planes are coplanar, false if they are not.
 */
function coplanar(plane1, plane2)
{
    return (((plane1.normal == plane2.normal || plane1.normal == -plane2.normal) &&
              pointOnPlane(plane1.point, plane2)) ? true: false);
}

/**
 * Determine if planes intersect.
 * @param plane1 - the first plane.
 * @param plane2 - the second plane.
 * @return bool  - true if the planes intersect, false if they do not.
 */
function planesIntersect(plane1, plane2)
{
    // if planes are parallel (normal cross product == 0),
    // planes don't intersect (or they are coplanar)
    var zero = new Vector3D(0, 0, 0);
    if (crossProduct(plane1.normal, plane2.normal).equals(zero))
    {
        return false;
    }
 
    return true;
}

/**
 * Determine the distance between 2 parallel planes.  If planes are not parallel, 0 is returned.
 * @param plane1 - the first plane.
 * @param plane2 - the second plane.
 * @return float - the distance between the planes.
 */
function distanceBetweenPlanes(plane1, plane2)
{
    if (coplanar(plane1, plane2))
    {
        return 0;
    }

    if (!planesIntersect(plane1, plane2))
    {
        var intersection = lineIntersectsPlane(new Line(plane1.point, plane1.normal), plane2);
        if (intersection.result)
        {
            return distanceBetween(plane1.point, plane2.point);
        }
        else
        {
            return 0;
        }
    }

    // planes intersect
    return 0;
}
function ViewVolume()
{
    this.left = null;
    this.right = null;
    this.top = null;
    this.bottom = null;
    this.near = null;
    this.far = null;
}

ViewVolume.prototype.setPerspective = function(fovyRadians, aspectRatio, near, far)
{
    // calculate the front and back frustum plane quadrilateral endpoints
    // for a symmetric frustum volume

    // front quad
   
    // derive 1/2 quad height from y-FOV and distance from origin
    var height = near * Math.tan(0.5 * fovyRadians);

    // derive 1/2 quad width from aspect ratio
    var width = height * aspectRatio;

    // set front quad endpoints
    var frontTopLeft  = new Vector3D(-width, height, near);
    var frontTopRight = new Vector3D( width, height, near);
    var frontBotLeft  = new Vector3D(-width,-height, near);
    var frontBotRight = new Vector3D( width,-height, near);

    // back quad
    height = far * Math.tan(0.5 * fovyRadians);
    width = height * aspectRatio;

    var backTopLeft  = new Vector3D(-width, height, far);
    var backTopRight = new Vector3D( width, height, far);
    var backBotLeft  = new Vector3D(-width,-height, far);
    var backBotRight = new Vector3D( width,-height, far);

    // derive planes from frustum endpoints (specify points in 
    // clockwise order so that plane normals point out of frustum)
    this.left   = new Plane2(frontTopLeft, frontBotLeft, backBotLeft);
    this.right  = new Plane2(frontBotRight, frontTopRight, backTopRight);
    this.top    = new Plane2(frontTopLeft,  backTopLeft,   backTopRight);
    this.bottom = new Plane2(frontBotLeft, frontBotRight, backBotRight);
    this.near   = new Plane2(frontBotLeft,  frontTopLeft,  frontTopRight);
    this.far    = new Plane2(backBotRight,  backTopRight,  backTopLeft);
}

ViewVolume.prototype.setOrthographic = function(left, right, top, bottom, near, far)
{
    // calculate the front and back frustum plane quadrilateral endpoints
    // for a symmetric frustum volume

    // set front quad endpoints
    var frontTopLeft  = new Vector3D(left,  top,    near);
    var frontTopRight = new Vector3D(right, top,    near);
    var frontBotLeft  = new Vector3D(left,  bottom, near);
    var frontBotRight = new Vector3D(right, bottom, near);

    // back quad
    var backTopLeft   = new Vector3D(left,  top,    far);
    var backTopRight  = new Vector3D(right, top,    far);
    var backBotLeft   = new Vector3D(left,  bottom, far);
    var backBotRight  = new Vector3D(right, bottom, far);

    // derive planes from frustum endpoints (specify points in 
    // clockwise order so that plane normals point out of frustum)
    this.left   = new Plane2(backBotLeft,   backTopLeft,   frontTopLeft);
    this.right  = new Plane2(frontBotRight, frontTopRight, backTopRight);
    this.top    = new Plane2(frontTopLeft,  backTopLeft,   backTopRight);
    this.bottom = new Plane2(backBotRight,  backBotLeft,   frontBotLeft);
    this.near   = new Plane2(frontBotLeft,  frontTopLeft,  frontTopRight);
    this.far    = new Plane2(backBotRight,  backTopRight,  backTopLeft);
}
var EPSILON = 0.00000001;

function SIGN(x)
{
    return ((x >= 0) ? 1 : -1);
}

function SIGN3(v) 
{
    (((v).x < 0 ) ? 4 : 0 | ((v).y < 0) ? 2 : 0 | ((v).z < 0) ? 1 : 0);
}

/**
 * Solve quadratic equation with term coefficients a (2nd degree term), 
 * b (1st degree term), and c (constant term); return number of real roots; 
 * if 1 root exists, it is set to root1, if 2 roots exist, they are set to 
 * root1 and root2.
 * @param a      - 2nd degree term coefficient.
 * @param b      - 1st degree term coefficient.
 * @param c      - constant term.
 * @return root1 - first real root.
 * @return root2 - second real root.
 * @return count - 0: no real roots exist
 *                 1: 1 real root exists
 *                 2: 2 real roots exist
 */
function solveQuadraticEquation(a, b, c)
{
   if (a == 0) 
   {
       return { count: 0 };
   }

   var sqrt_term = b * b - 4 * a * c;
   if (sqrt_term < 0) 
   {
       return { count: 0 };
   }

   if (sqrt_term == 0)
   {
      var root1 = -b / (2 * a);
      return { count: 1, root1: root1 };
   }

   sqrt_term = Math.sqrt(sqrt_term);

   var root1 = (-b + sqrt_term) / (2 * a);
   var root2 = (-b - sqrt_term) / (2 * a);

   return { count: 2, root1: root1, root2: root2 };
}

/** 
 * Determine if a ray intersects a triangle. 
 *
 * Given a ray defined by an origin and a direction, and a triangle,
 * determine if the ray intersects the triangle; if an intersection exists, 
 * determine the distance t from the ray origin to the point of intersection, and the 
 * barycentric coordinates (u, v) inside the triangle;
 *
 * Algorithm adapted from:
 *    Tomas Moller and Ben Trumbore, "Fast, Minimum Storage Ray/Triangle 
 *    Intersection", journal of graphics tool, vol. 2, no. 1, pp. 21-28, 1997.
 *    http://www.ce.chalmers.se/staff/tomasm
 *
 * @param rayOrig    - ray origination point.
 * @param rayDir     - ray direction.
 * @param v0         - first triangle vertex.
 * @param v1         - second triangle vertex.
 * @param v2         - third triangle vertex.
 * @param skipPosDet - if true, skip intersection test (return false) if the triangle's determinate 
 *                     is positive.
 * @param skipNegDet - if true, skip intersection test (return false) if the triangle's determinate 
 *                     is negative.
 * @return t         - distance from ray origin to intersection point (if ray intersects triangle).
 * @return u         - barycentric coordinate u of intersection point (if ray intersects triangle).
 * @return v         - barycentric coordinate v of intersection point (if ray intersects triangle).
 * @return result    - true if the ray intersects the triangle, false if not.
 */
function rayTriangleIntersection(rayOrig, rayDir, v0, v1, v2, skipPosDet, skipNegDet)
{
    // normalize ray direction vector
    var dir = new Vector3D(rayDir.x, rayDir.y, rayDir.z);
    dir.normalize();

    // find vectors for two edges sharing v0
    var edge1 = new Vector3D(v1.x - v0.x, v1.y - v0.y, v1.z - v0.z);
    var edge2 = new Vector3D(v2.x - v0.x, v2.y - v0.y, v2.z - v0.z);
   
    // calculate determinant
    var pvec = crossProduct(dir, edge2);
    var det = dotProduct(edge1, pvec);

    // if determinant is near zero, ray lies in plane of triangle
    if (-EPSILON < det && det < EPSILON) 
    {
        return { result: false };
    }

    // if requested, skip triangles with negative/positive determinates
    if (skipPosDet && det > 0) 
    {
        return { result: false };
    }
    if (skipNegDet && det < 0) 
    {
        return { result: false };
    }

    var inv_det = 1 / det;

    // calculate distance from v0 to ray origin
    var tvec = new Vector3D(rayOrig.x - v0.x, rayOrig.y - v0.y, rayOrig.z - v0.z);

    // calculate u parameter and test bounds
    var u = dotProduct(tvec, pvec) * inv_det;
    if (u < 0 || u > 1)
    {
        return { result: false };
    }

    var qvec = crossProduct(tvec, edge1);

    // calculate v parameter and test bounds
    var v = dotProduct(dir, qvec) * inv_det;
    if (v < 0 || u + v > 1) 
    {
        return { result: false };
    }

    // ray intersects triangle, calculate t
    var t = dotProduct(edge2, qvec) * inv_det;

    return { result: true, t: t, u: u, v: v };
}

/**
 * Determine if a ray intersects a sphere.
 *
 * Given a ray defined by an origination point (x0, y0, z0), and
 * destination point (x1, y1, z1), and represented by the parametric equations: 
 * x = x0 + t(x1 - x0), y = y0 + t(y1 - y0), z = z0 + t(z1 - z0),
 * determine if the ray intersects the sphere defined by center (a, b, c) and
 * radius r, and represented by the equation (x - a)² + (y - b)² + (z - c)² = r²;
 *
 * For convenience, define dx = x1 - x0, dy = y1 - y0, dz = z1 - z0;
 *
 * The intersection is found by substituting x, y, and z from the ray equations
 * into the sphere equation, and solving for t (after term collection):
 * 
 * (dx² + dy² + dz²)t² + 2[dx(x0 - a) + dy(y0 - b) + dz(z0 - c)]t
 *    + (x0 - a)² + (y0 - b)² + (z0 - c)² - r² = 0
 *
 * Algorithm adapted from:
 *    Computer Graphics: Principles and Practice, 2nd Edition, Foley, et al., pp. 702-703
 *
 * @param rayOrig - ray origination point.
 * @param rayDir  - ray direction.
 * @param center  - sphere center point.
 * @param radius  - sphere radius.
 * @return root1  - root 1 from solving quadratic equation (if ray intersects sphere).
 * @return root2  - root 2 from solving quadratic equation (if ray intersects sphere).
 * @return count  - 0: ray does not intersect sphere
 *                  1: ray grazes sphere - root1 will contain the one real root
 *                  2: ray intersects sphere - root1 and root2 will contain both real roots
 */
function raySphereIntersection(rayOrig, rayDir, center, radius)
{
    // normalize ray direction vector
    var dir = new Vector3D(rayDir.x, rayDir.y, rayDir.z);
    dir.normalize();
    
    var rayDest = new Vector3D(rayOrig.x + dir.x, rayOrig.y + dir.y, rayOrig.z + dir.z);

    var dx = rayDest.x - rayOrig.x;
    var dy = rayDest.y - rayOrig.y;
    var dz = rayDest.z - rayOrig.z;

    // a = dx * dx + dy * dy + dz * dz == 1
    // because distance from rayOrig to rayDest is 1

    var b = 2 * (dx * (rayOrig.x - center.x) + 
                 dy * (rayOrig.y - center.y) + 
                 dz * (rayOrig.z - center.z));

    var c = (rayOrig.x - center.x) * (rayOrig.x - center.x) +
            (rayOrig.y - center.y) * (rayOrig.x - center.y) +
            (rayOrig.z - center.z) * (rayOrig.z - center.z) -
            radius * radius;

    return solveQuadraticEquation(1, b, c);
}

/**
 * Determine if the triangle contains a point which is known to lie in the plane of the triangle.  
 * Adapted from "Triangle-Cube Intersection", Graphics Gems III, pp.236-239.
 * @param v0      - first triangle vertex.
 * @param v1      - second triangle vertex.
 * @param v2      - third triangle vertex.
 * @param point   - the point.
 * @return result - true if the triangle contains the point, false if not. 
 */
function triangleContainsPoint(v0, v1, v2, point)
{
    // for each triangle side, make a vector out of it by subtracting vertices; 
    // make another vector from one vertex to the point; the cross-product of these 
    // two vectors is orthogonal to both and the signs of its components indicate 
    // whether the point was on the inside or on the outside of this triangle side
    var sign12 = SIGN3(crossProduct(subtract3D(v0, v1), subtract3D(v0, point))); 
    var sign23 = SIGN3(crossProduct(subtract3D(v1, v2), subtract3D(v1, point))); 
    var sign31 = SIGN3(crossProduct(subtract3D(v2, v0), subtract3D(v2, point))); 

    // if all three cross-product vectors agree in their component signs,
    // then the point must be inside all three; the point cannot be outside all 
    // three sides simultaneously.
    if ((sign12 == sign23) && (sign23 == sign31))
    {
        return true;
    }

    return false;
}

/**
 * Determine if a triangle lies on the positive side of the plane (the side in the direction of
 * the plane normal).
 * @param v0    - first vertex of triangle.
 * @param v1    - second vertex of triangle.
 * @param v2    - third vertex of triangle.
 * @return bool - true if the triangle lies on the positive side of the plane, false if not.
 */
function triangleOnPositiveSideOfPlane(v0, v1, v2, plane)
{
    return pointOnPositiveSideOfPlane(v0, plane) &&
           pointOnPositiveSideOfPlane(v1, plane) &&
           pointOnPositiveSideOfPlane(v2, plane);
}

/**
 * Determine if a triangle lies on the positive side of the plane (the side in the direction of
 * the plane normal).
 * @param v0    - first vertex of triangle.
 * @param v1    - second vertex of triangle.
 * @param v2    - third vertex of triangle.
 * @return bool - true if the triangle lies on the positive side of the plane, false if not.
 */
function triangleOnNegativeSideOfPlane(v0, v1, v2, plane)
{
    return pointOnNegativeSideOfPlane(v0, plane) &&
           pointOnNegativeSideOfPlane(v1, plane) &&
           pointOnNegativeSideOfPlane(v2, plane);
}

/**
 * Determine if a triangle spans the plane.
 * @param v0    - first vertex of triangle.
 * @param v1    - second vertex of triangle.
 * @param v2    - third vertex of triangle.
 * @return bool - true if the triangle spans the plane, false if not.
 */
function triangleSpansPlane(v0, v1, v2, plane)
{
    return !triangleOnPositiveSideOfPlane(v0, v1, v2, plane) &&
           !triangleOnNegativeSideOfPlane(v0, v1, v2, plane);
}

/**
 * Determine if the line segment intersects the triangle.  If so, find the point
 * of intersection.
 * @param a       - one endpoint of the line segment.
 * @param b       - other endpoint of the line segment.
 * @param v0      - first triangle vertex. 
 * @param v1      - second triangle vertex.
 * @param v2      - third triangle vertex.
 * @return point  - the point of intersection (if line segment intersects triangle). 
 * @return result - true if the line segment intersects the triangle, false if not.
 */
function lineSegmentTriangleIntersection(a, b, v0, v1, v2)
{
    // first check that line segment intersects plane of triangle
    var result = lineSegmentPlaneIntersection(a, b, new Plane2(v0, v1, v2));
    if (result.count == 0)
    {
        return { result: false, point: null };
    }

    // check that point is within triangle bounding box
    if (result.point.x < min3(v0.x, v1.x, v2.x) ||
        result.point.y < min3(v0.y, v1.y, v2.y) ||
        result.point.z < min3(v0.z, v1.z, v2.z) ||
        result.point.x > max3(v0.x, v1.x, v2.x) ||
        result.point.y > max3(v0.y, v1.y, v2.y) ||
        result.point.z > max3(v0.z, v1.z, v2.z))
    {
        return { result: false, point: null };
    }

    // check that point is within triangle
    if (triangleContainsPoint(v0, v1, v2, result.point))
    {
        return { result: true, point: result.point };
    }
    
    return { result: false, point: null };
}

/**
 * Determine if two triangles intersect.
 * @param t1v0  - first triangle's first vertex. 
 * @param t1v1  - first triangle's second vertex.
 * @param t1v2  - first triangle's third vertex.
 * @param t2v0  - second triangle's first vertex. 
 * @param t2v1  - second triangle's second vertex.
 * @param t2v2  - second triangle's third vertex.
 * @return bool - true if the triangles intersect, false if not.
 */
function triangleTriangleIntersection(t1v0, t1v1, t1v2,
                                      t2v0, t2v1, t2v2)
{
    if (!triangleSpansPlane(t1v0, t1v1, t1v2, new Plane(t2v0, t2v1, t2v2)) ||
        !triangleSpansPlane(t2v0, t2v1, t2v2, new Plane(t1v0, t1v1, t1v2)))
    {
        return false;
    }
 
    if (lineSegmentTriangleIntersection(t1v0, t1v1, t2v0, t2v1, t2v2).result ||
        lineSegmentTriangleIntersection(t1v1, t1v2, t2v0, t2v1, t2v2).result ||
        lineSegmentTriangleIntersection(t1v2, t1v0, t2v0, t2v1, t2v2).result ||

        lineSegmentTriangleIntersection(t2v0, t2v1, t1v0, t1v1, t1v2).result ||
        lineSegmentTriangleIntersection(t2v1, t2v2, t1v0, t1v1, t1v2).result ||
        lineSegmentTriangleIntersection(t2v2, t2v0, t1v0, t1v1, t1v2).result)
    {
        return true;
    }

    return false;
}

function planeProject(v, plane)
{
    return crossProduct(plane.normal, crossProduct(v, plane.normal));
}

function distanceBetweenLineSegmentAndPoint(a, b, point)
{
    // if segment points are coincident, return
    if (a.equals(b))
    {
        return distanceBetween(a, point);
    }

    var mag = magnitude(b.x - a.x, 
                        b.y - a.y, 
                        b.z - a.z);

    var u = (((point.x - a.x) * (b.x - a.x)) +
             ((point.y - a.y) * (b.y - a.y)) +
             ((point.z - a.z) * (b.z - a.z))) / (mag * mag);

    // if u is not in range [0, 1], shortest distance lies on line outside of segment -- chose closest endpoint
    if (u < 0)
    {
        return distanceBetween(a, point);
    }
    else if (u > 1)
    {
        return distanceBetween(b, point);
    }
    else // u E [0, 1]
    {
        return distanceBetween(new Vector3D(a.x + (b.x - a.x) * u,
                                            a.y + (b.y - a.y) * u,
                                            a.z + (b.z - a.z) * u), point);
    }
}

var eAttrType = {
    Unknown                     :-1,
    
    Attribute                   :0,
    
    AttributeContainer          :1,
    
    AttributeVector             :2,
    
    AttributeFactory            :3,
    
    AttributeRegistry           :4,
    
    BalloonTipLabelStyleAttr    :5,
    BBoxAttr                    :6,
    BooleanAttr                 :7,
    ColorAttr                   :8,
    FontStyleAttr               :9,
    IconStyleAttr               :10,
    ImageAttr                   :11,
    KeyframeAttr                :12,
    KeyframesAttr               :13,
    LabelStyleAttr              :14,
    HTMLLabelStyleAttr          :15,
    NumberArrayAttr             :16,
    NumberAttr                  :17,
    Matrix4x4Attr               :18,
    PlaneAttr                   :19,
    PulseAttr                   :20,
    RectAttr                    :21,
    ReferenceAttr               :22,
    StringAttr                  :23,
    StyleAttr                   :24,
    StylesAttr                  :25,
    StyleMapAttr                :26,
    StylesMapAttr               :27,
    Vector2DAttr                :28,
    Vector3DAttr                :29,
    ViewportAttr                :30,
    ViewVolumeAttr              :31,
    RenderableElementStyleAttr  :32,
    Bone                        :33,
    SnapConnector               :34,
    GenericConnector            :36,
    GenericConnectors           :37,
    SocketConnector             :38,
    SocketConnectors            :39,
    PlugConnector               :40,
    PlugConnectors              :41,
    SphereAttr                  :42,
    PhysicalPropertiesAttr      :43,
    SnapModelDescriptor         :44,
    SnapModelDescriptors        :45,
    
    Node                        :1000,
       
    ParentableMotionElement     :1001,
    Camera                      :1002,
    PerspectiveCamera           :1003,
    OrthographicCamera          :1004,
    Light                       :1005,
    DirectionalLight            :1006,
    PointLight                  :1007,
    SpotLight                   :1008, 
    GlobalIllumination          :1009,           
    Material                    :1010,
    Texture                     :1011, 
    RenderableElement           :1012,
    Geometry                    :1013,
    VertexGeoemtry              :1014,
    TriList                     :1015, 
    Group                       :1016,
    Isolator                    :1017,
    Dissolve                    :1018,  
    Transform                   :1019,   
    QuaternionRotate            :1020,
    Scale                       :1021,
    Rotate                      :1022,
    Translate                   :1023,   
    Model                       :1024,
    Surface                     :1025,
    MediaTexture                :1026,
    NullObject                  :1027,   
    Label                       :1028,
    HTMLLabel                   :1029,
    BalloonTipLabel             :1030, 
    PathTrace                   :1031,
    Cube                        :1032,
    Bone                        :1033,
    Selector                    :1034,
    ScreenRect                  :1035,
    SnapModel                   :1036,
    
    Evaluator                   :1100,
    SceneInspector              :1101,
    KeyframeInterpolator        :1102,
    BBoxLocator                 :1103,
    ArcballInspector            :1104,
    MapProjectionCalculator     :1105,
    ObjectInspector             :1106,
    MultiTargetObserver		:1107,
    ObjectMover	 		:1108,
    AnimalMover			:1109, 
    WalkSimulator               :1110,
    MorphEffector               :1111,
    BoneEffector                :1112,
    PhysicsSimulator            :1113,
    GoblinPhysicsSimulator      :1114,
    CannonPhysicsSimulator      :1115,
    Animator                    :1116,
    Spinner                     :1117,
    Evaluator_End               :1199, // all evaluator types must be given a type between Evaluator and Evaluator_End

    Node_End                    :1999,

    Directive                   :2000,
    UpdateDirective             :2001,
    RenderDirective             :2002,
    RayPickDirective            :2003,
    BBoxDirective               :2004,
    SerializeDirective          :2005,
    CollideDirective            :2006,
    HighlightDirective          :2007,
    ShadowDirective             :2008,
    Directive_End               :2999,
    
    Command                     :3000,
    CommandSequence             :3001,
    AppendNode                  :3002,
    AttributeTrigger            :3003,
    AutoInterpolate             :3004,
    Locate                      :3005,
    Play                        :3006,
    Pause                       :3007,
    Remove                      :3008,
    ScreenCapture               :3009,
    Serialize                   :3010,
    Set                         :3011,
    Stop                        :3012,
    ConnectAttributes           :3013,
    DisconnectAttributes        :3014,
    Export                      :3015,
    Morph                       :3016,
    SnapTo                      :3017,
    Command_End                 :3999,

    DeviceHandler               :4000,
    MouseHandler                :4001,
    KeyboardHandler             :4002,
    DeviceHandler_End           :4999,
    
    UserDefined                 :5000
};

var eAttrElemType = {
    // unknown
    Unknown                     :-1,

    // attribute
    Attribute                   :0,
    
    // standard C-types
    Int                         :1,
    UnsignedInt                 :2,
    Char                        :3,
    UnsignedChar                :4,
    Float                       :5,
    Double                      :6,

    // user-defined
    UserDefined                 :100
};

function enumerateAttributeTypes()
{
    var count = 0; 
    for (var i in eAttrType)
    {
        if (eAttrType[i] == 0)
            eAttrType[i] = count++;
    }
}

function enumerateAttributeElementTypes()
{
    var count = 0;
    for (var i in eAttrElemType)
    {
        if (eAttrElemType[i] == 0)
            eAttrElemType[i] = count++;
    }
}
var eAttrSetOp = {
    Replace     :0,  
    Add		:1,
    Subtract	:2,
    Multiply	:3,
    Divide	:4,
    Append	:5,
    AND		:6,
    OR		:7,
    XOR         :8,
    NAND	:9,
    NOR		:10
};

function AttributeTargetDesc(target, 
                             sourceElementIndex, 
                             targetElementIndex,
                             op,
                             converter)
{
    if (sourceElementIndex == undefined) sourceElementIndex = -1;
    if (targetElementIndex == undefined) targetElementIndex = -1;
    
    this.target = target || null;
    this.sourceElementIndex = sourceElementIndex;
    this.targetElementIndex = targetElementIndex;
    this.op = op || eAttrSetOp.Replace;
    this.converter = converter || null;
}

function AttributeSourceDesc(source,
                             sourceElementIndex,
                             targetElementIndex,
                             op,
                             converter)
{
    if (sourceElementIndex == undefined) sourceElementIndex = -1;
    if (targetElementIndex == undefined) targetElementIndex = -1;
    
    this.source = source || null;
    this.sourceElementIndex = sourceElementIndex;
    this.targetElementIndex = targetElementIndex;
    this.op = op || eAttrSetOp.Replace;
    this.converter = converter || null;
}

function AttributeGetParams(elementIndex,
                            valueElementIndex)
{
    if (elementIndex == undefined) elementIndex = -1;
    if (valueElementIndex == undefined) valueElementIndex = -1;
    
    this.elementIndex = elementIndex;
    this.valueElementIndex = valueElementIndex;
}

function AttributeSetParams(elementIndex,
                            valueElementIndex,
                            op,
                            updateTargets,
                            alertModifiedCBs,
                            caller)
{
    if (elementIndex == undefined) elementIndex = -1;
    if (valueElementIndex == undefined) valueElementIndex = -1;
    
    this.elementIndex = elementIndex;
    this.valueElementIndex = valueElementIndex;
    this.op = op || eAttrSetOp.Replace;
    this.updateTargets = updateTargets != undefined ? updateTargets : true;
    this.alertModifiedCBs = alertModifiedCBs != undefined ? alertModifiedCBs : true;
    this.caller = caller != undefined ? caller : null;
}
                            
Attribute.prototype = new Base();
Attribute.prototype.constructor = Attribute;

function Attribute() 
{
    Base.call(this);
    this.className = "Attribute";
    this.attrType = eAttrType.Attribute;
    this.attrElemType = eAttrElemType.Attribute;
    
    this.native = true;
    this.transient = false;
    this.persistent = false;
    this.deserialized = false;
    this.modificationCount = -1;
    
    this.values = [];
    this.lastValues = [];
    this.modifiedCBs = [];
    this.modifiedCBsData = [];
    this.targets = [];
    this.sources = [];
    this.container = null;
    this.registry = null;
}

Attribute.prototype.destroy = function()
{
    // remove all targeting associated with this
    this.removeAllSources();
    this.removeAllTargets();
    
    // call base-class implementation
    Base.prototype.destroy.call(this);
}

Attribute.prototype.clone = function()
{
    return null;
}

Attribute.prototype.getValue = function(values, params)
{
    var elementIndex = (params ? params.elementIndex : -1);
    
    if (elementIndex < 0)
    {
        if (this.values == null)
        {
            values[0] = null;
        }
        else if (this.values.length == undefined)
        {
            values[0] = this.values;
        }
        else // this.values.length > 0
        {
            for (var i=0; i < this.values.length; i++)
            {
                values[i] = this.values[i];
            }
        }
    }
    else // elementIndex >= 0
    {
        var valueElementIndex = Math.max(0, params ? params.valueElementIndex : 0);
            
        values[valueElementIndex] = this.values[elementIndex];
    }
}

Attribute.prototype.getLastValue = function(values, params)
{
    var elementIndex = (params ? params.elementIndex : -1);
    
    if (elementIndex < 0)
    {
        if (this.lastValues == null)
        {
            values[0] = null;
        }
        else if (this.lastValues.length == undefined)
        {
            values[0] = this.lastValues;
        }
        else // this.values.length > 0
        {
            for (var i=0; i < this.lastValues.length; i++)
            {
                values[i] = this.lastValues[i];
            }
        }
    }
    else // elementIndex >= 0
    {
        var valueElementIndex = Math.max(0, params ? params.valueElementIndex : 0);
            
        values[valueElementIndex] = this.lastValues[elementIndex];
    }
}

Attribute.prototype.setValue = function(values, params)
{
    this.lastValues = this.values.slice();
    
    var elementIndex = (params ? params.elementIndex : -1);
    var op = (params ? params.op : eAttrSetOp.Replace);

    if (elementIndex < 0)
    {
        if (values == null)
        {
            this.values[0] = null;
        }
        else if (values.length == undefined)
        {
            switch (op)
            {
                case eAttrSetOp.Add: this.values[0] += values; break;
                case eAttrSetOp.Replace: this.values[0] = values; break;
                case eAttrSetOp.AND: this.values[0] &= values; break;
                default: alert("unsupported operation passed to Attribute::setValue"); break; // TODO: add support
            }
        }
        else // values.length > 0
        {
            this.values.length = values.length;
            for (var i = 0; i < values.length; i++)
            {
                switch (op)
                {
                    case eAttrSetOp.Add: this.values[i] += values[i]; break;
                    case eAttrSetOp.Replace: this.values[i] = values[i]; break;
                    case eAttrSetOp.AND: this.values[i] &= values[i]; break;
                    default: alert("unsupported operation passed to Attribute::setValue"); break; // TODO: add support
                }
            }
        }
    }
    else // elementIndex >= 0
    {
        if (values == null)
        {
            this.values[elementIndex] = null;
        }
        else if (values.length == undefined)
        {
            this.values[elementIndex] = values;
        }
        else // values.length > 0
        {
            var valueElementIndex = Math.max(0, params ? params.valueElementIndex : 0);
            this.values[elementIndex] = values[valueElementIndex];
        }
    }

    // alert modified CBs
    var alertModifiedCBs = (params ? params.alertModifiedCBs : true);
    if (alertModifiedCBs)
    {
        for (var i = 0; i < this.modifiedCBs.length; i++)
        {
            this.modifiedCBs[i](this, this.modifiedCBsData[i]);
        }
    }

    // update targets
    var updateTargets = (params ? params.updateTargets : true);
    if (updateTargets)
    {
        var caller = (params ? params.caller : null);
        for (var i = 0; i < this.targets.length; i++)
        {
            var targetDesc = this.targets[i];
            if (caller == targetDesc.target) continue;
            var params = new AttributeSetParams(targetDesc.targetElementIndex, targetDesc.sourceElementIndex,
                                                targetDesc.op, true, true, this);
            targetDesc.target.setValue(this.values, params);
        }
    }
    
    this.modificationCount++;
}

Attribute.prototype.revertValues = function()
{
    this.setValue(this.lastValues, null);
}

Attribute.prototype.getElement = function(index)
{
    if (this.values.length > index)
    {
        return this.values[index];
    }

    return undefined;
}

Attribute.prototype.setElement = function(index, value, op, updateTargets)
{
    console.debug("TODO: " + arguments.callee.name);
}

Attribute.prototype.getLength = function()
{
    if (this.values.length == undefined)
    {
        return (this.values == undefined ? 0 : 1);
    }   
    
    return this.values.length; 
}

Attribute.prototype.setLength = function(length)
{
    this.values.length = length;
}

Attribute.prototype.addModifiedCB = function(callback, data)
{
    // don't add dups
    var indexCB = this.modifiedCBs.indexOf(callback);
    var indexData = this.modifiedCBsData.indexOf(data);
    if (indexCB >= 0 && indexCB == indexData) 
    {
        return;
    }
        
    this.modifiedCBs.push(callback);
    this.modifiedCBsData.push(data);
}

Attribute.prototype.removeModifiedCB = function(callback, data)
{   
    var index = this.modifiedCBsData.indexOf(data);
    if (index >= 0)
    {
        this.modifiedCBs.splice(index, 1);
        this.modifiedCBsData.splice(index, 1);
    }
}

Attribute.prototype.addTarget = function(target, op, converter, setValueOnTargeting)
{
    if (op == undefined) op = eAttrSetOp.Replace;
    if (converter == undefined) converter = null;
    if (setValueOnTargeting == undefined) setValueOnTargeting = true;
    
    this.addElementTarget(target, -1, -1, op, converter, setValueOnTargeting);
}

Attribute.prototype.addSource = function(source, op, converter, setValueOnTargeting)
{
    source.addTarget(this, op, converter, setValueOnTargeting);
}

Attribute.prototype.removeTarget = function(target)
{
    this.removeElementTarget(target, -1, -1);
}

Attribute.prototype.removeSource = function(source)
{
    source.removeTarget(this);
}

Attribute.prototype.removeAllTargets = function()
{
    while (this.targets.length > 0)
    {
        this.removeElementTarget(this.targets[0].target,
                                 this.targets[0].sourceElementIndex,
                                 this.targets[0].targetElementIndex);
    }
}

Attribute.prototype.removeAllSources = function()
{
    while (this.sources.length > 0)
    {
        this.sources[0].source.removeElementTarget(this,
                                                   this.sources[0].sourceElementIndex,
                                                   this.sources[0].targetElementIndex);
    }
}

Attribute.prototype.addElementTarget = function(target, sourceElementIndex, targetElementIndex, op, converter, setValueOnTargeting)
{
    if (target)
    {
        if (sourceElementIndex == undefined) sourceElementIndex = -1;
        if (targetElementIndex == undefined) targetElementIndex = -1;
        if (op == undefined) op = eAttrSetOp.Replace;
        if (converter == undefined) converter = null;
        if (setValueOnTargeting == undefined) setValueOnTargeting = true;

        this.createTarget(new AttributeTargetDesc(target, sourceElementIndex, targetElementIndex, op, converter));

        // set this as a source of target
        target.createSource(new AttributeSourceDesc(this, sourceElementIndex, targetElementIndex, op, converter));

        if (setValueOnTargeting)
        {
            var params = new AttributeSetParams(targetElementIndex, sourceElementIndex, op, true, true);
            target.setValue(this.values, params);
        }
    }
}

Attribute.prototype.addElementSource = function(source, sourceElementIndex, targetElementIndex, op, converter, setValueOnTargeting)
{
    source.addElementTarget(this, sourceElementIndex, targetElementIndex, op, converter, setValueOnTargeting);
}

Attribute.prototype.removeElementTarget = function(target, sourceElementIndex, targetElementIndex)
{
    if (target)
    {
        this.deleteTarget(new AttributeTargetDesc(target, sourceElementIndex, targetElementIndex));

        // remove this as a source of target 
        target.deleteSource(new AttributeSourceDesc(this, sourceElementIndex, targetElementIndex));
    }
}

Attribute.prototype.removeElementSource = function(source, sourceElementIndex, targetElementIndex)
{
    source.removeElementTarget(this, sourceElementIndex, targetElementIndex);
}

Attribute.prototype.createTarget = function(targetDesc)
{
    this.targets.push(targetDesc);
}

Attribute.prototype.createSource = function(sourceDesc)
{
    this.sources.push(sourceDesc);
}

Attribute.prototype.deleteTarget = function(targetDesc)
{
    for (var i = 0; i < this.targets.length; i++)
    {
        var desc = this.targets[i];
        if (desc.target == targetDesc.target &&
            desc.sourceElementIndex == targetDesc.sourceElementIndex &&
            desc.targetElementIndex == targetDesc.targetElementIndex)
        {
            this.targets.splice(i, 1);
            break;
        }
    }
}

Attribute.prototype.deleteSource = function(sourceDesc)
{
    for (var i = 0; i < this.sources.length; i++)
    {
        var desc = this.sources[i];
        if (desc.source == sourceDesc.source &&
            desc.sourceElementIndex == sourceDesc.sourceElementIndex &&
            desc.targetElementIndex == sourceDesc.targetElementIndex)
        {
            this.sources.splice(i, 1);
            break;
        }
    }
}

Attribute.prototype.copyValue = function(source, op)
{
    source.addTarget(this, op);
    source.removeTarget(this);
}

Attribute.prototype.isContainer = function()
{
    return false;
}

Attribute.prototype.isCollection = function()
{
    return false;
}

Attribute.prototype.isNode = function()
{
    return false;
}

Attribute.prototype.getContainer = function()
{
    return this.container;
}

Attribute.prototype.setContainer = function(container)
{
    this.container = container;
}

Attribute.prototype.setNative = function(native)
{
    this.native = native;
}

Attribute.prototype.isNative = function()
{
    return this.native;    
}

Attribute.prototype.setTransient = function(transient)
{
    this.transient = transient;
}

Attribute.prototype.isTransient = function()
{
    return this.transient;    
}

Attribute.prototype.setPersistent = function(persistent)
{
    this.persistent = persistent;
}

Attribute.prototype.isPersistent = function()
{
    return this.persistent;    
}

Attribute.prototype.getRegistry = function()
{
    return this.registry;
}

Attribute.prototype.setRegistry = function(registry)
{
    this.registry = registry;
}

Attribute.prototype.onRegister = function(registry)
{
    
}

Attribute.prototype.onUnregister = function(registry)
{
    
}

Attribute.prototype.flagDeserializedFromXML = function()
{
    this.deserialized = true;

    if (this.attrContainer) // also flag container if present, otherwise serialization won't occur
    {
        this.attrContainer.flagDeserializedFromXML();
    }
}
Attribute.prototype.isDeserializedFromXML = function()
{
    return this.deserialized;
}
AttributeContainer.prototype = new Attribute();
AttributeContainer.prototype.constructor = AttributeContainer;

function AttributeContainer()
{
    Attribute.call(this);
    this.className = "AttributeContainer";
    this.attrType = eAttrType.AttributeContainer;

    this.attrNameMap = [];
}

AttributeContainer.prototype.clone = function()
{
    var factory = this.registry.find("AttributeFactory");
    var clone = factory.create(this.className);
    if (clone)
    {
        clone.synchronize(this, true);
    }
    
    return clone;
}

AttributeContainer.prototype.destroy = function()
{
    // destroy all registered attributes with this as the container
    for (var i in this.attrNameMap)
    {
        for (var j=0; j < this.attrNameMap[i].length; j++)
        {
            var attr = this.attrNameMap[i][j];
            if (attr.getContainer() == this)
            {
                attr.destroy();
            }
        }
    }

    // call base-class implementation
    Attribute.prototype.destroy.call(this);
}

AttributeContainer.prototype.isContainer = function()
{
    return true;
}

AttributeContainer.prototype.registerAttribute = function(attribute, name)
{
	if (!attribute) return;
	
    if (this.attrNameMap[name] == undefined)
    {
        this.attrNameMap[name] = new Array();
    }
    this.attrNameMap[name].push(attribute);

    // set the container if null
    if (!attribute.getContainer())
    {
        attribute.setContainer(this);
    }

    attribute.addModifiedCB(AttributeContainer_AttributeModifiedCB, this);
}

AttributeContainer.prototype.unregisterAttribute = function(attribute)
{
    if (!attribute) return;
	
    for (var i in this.attrNameMap)
    {
        for (var j=0; j < this.attrNameMap[i].length; j++)
        {
            if (this.attrNameMap[i][j] == attribute)
            {
                attribute.removeModifiedCB(AttributeContainer_AttributeModifiedCB, this);
                delete this.attrNameMap[i][j];
                this.attrNameMap[i].splice(j, 1);
                break;
            }
        }
    }
}

AttributeContainer.prototype.getAttribute = function(name)
{
    if (this.attrNameMap[name] == undefined)
    {
        return null;
    }
    
    return this.attrNameMap[name][0];
}

AttributeContainer.prototype.getAttributeAt = function(index)
{
    var count = 0;
    for (var i in this.attrNameMap)
    {
        for (var j=0; j < this.attrNameMap[i].length; j++)
        {
            if (count == index)
            {
                return this.attrNameMap[i][j];
            }
            count++;
        }
    }
    
    return null;
}

AttributeContainer.prototype.getAttributeName = function(attribute)
{
    var count = 0;
    for (var i in this.attrNameMap)
    {
        for (var j=0; j < this.attrNameMap[i].length; j++)
        {
            if (this.attrNameMap[i][j] == attribute)
            {
                return i;
            }
            count++;
        }
    }

    return null;
}

AttributeContainer.prototype.getAttributeNameAt = function(index)
{
    var count = 0;
    for (var i in this.attrNameMap)
    {
        for (var j=0; j < this.attrNameMap[i].length; j++)
        {
            if (count == index)
            {
                return i;
            }
            count++;
        }
    }
    
    return null;
}

AttributeContainer.prototype.getAttributeCount = function()
{
    var count = 0;
    for (var i in this.attrNameMap) count += this.attrNameMap[i].length;
    return count;
}

AttributeContainer.prototype.addTarget = function(target, op, converter, setValueOnTargeting)
{
    if (target)
    {
        if (op == undefined) op = null;
        if (converter == undefined) converter = null;
        if (setValueOnTargeting == undefined) setValueOnTargeting = true;
        
        var numAttributesToConnect = Math.max(this.getAttributeCount(), target.getAttributeCount());
        if (numAttributesToConnect == 0)
        {
            return;
        }

        var sourceAttr = null;
        var targetAttr = null;
        for (var i = 0; i < numAttributesToConnect; i++)
        {
            sourceAttr = this.getAttributeAt(i);
            targetAttr = target.getAttribute(this.getAttributeNameAt(i));
            if (!sourceAttr || !targetAttr)
            {
                continue;
            }

            sourceAttr.addTarget(targetAttr, op, converter, setValueOnTargeting);
        }
    }
}

AttributeContainer.prototype.removeTarget = function(target)
{
    if (target)
    {
        var numAttributesToConnect = Math.max(this.getAttributeCount(), target.getAttributeCount());
        if (numAttributesToConnect == 0)
        {
            return;
        }

        var sourceAttr = null;
        var targetAttr = null;
        for (var i = 0; i < numAttributesToConnect; i++)
        {
            sourceAttr = this.getAttributeAt(i);
            targetAttr = target.getAttribute(this.getAttributeNameAt(i));
            if (!sourceAttr || !targetAttr)
            {
                continue;
            }

            sourceAttr.removeTarget(targetAttr);
        }
    }
}

AttributeContainer.prototype.synchronize = function(src, syncValues)
{
    if (syncValues == undefined) syncValues = true;

    for (var i in src.attrNameMap)
    {
        for (var j=0; j < src.attrNameMap[i].length; j++)
        {
            if (!this.attrNameMap[i] || this.attrNameMap[i].length <= j) continue;
            var attr = this.attrNameMap[i][j];
            if (!attr)
            {
                attr = src.attrNameMap[i].clone();
                if (!attr) continue;
                attr.setContainer(this);
                this.registerAttribute(attr, i);
            }
    
            if (attr && syncValues)
            {
                attr.copyValue(src.attrNameMap[i][j]);
            }
        }
    }
}

function AttributeContainer_AttributeModifiedCB(attribute, container)
{
    for (var i=0; i < container.modifiedCBs.length; i++)
    {
        container.modifiedCBs[i](container, container.modifiedCBsData[i]);
    }
}

AttributeRegistry.prototype = new AttributeContainer();
AttributeRegistry.prototype.constructor = AttributeRegistry;

function AttributeRegistry()
{
    AttributeContainer.call(this);
    this.className = "AttributeRegistry";
    this.attrType = eAttrType.AttributeRegistry;

    this.objectCount = 0;

    this.typeRegistry = [];
    this.nameRegistry = [];

    this.uniqueAttributes = [];
}

AttributeRegistry.prototype.addUnique = function(attribute)
{
    for (var i = 0; i < this.uniqueAttributes.length; i++)
    {
        if (this.uniqueAttributes[i] == attribute)
            return;
    }

    this.uniqueAttributes.push(attribute);
}

AttributeRegistry.prototype.removeUnique = function(attribute)
{
    for (var i = 0; i < this.uniqueAttributes.length; i++)
    {
        if (this.uniqueAttributes[i] == attribute)
        {
            this.uniqueAttributes.splice(i, 1);
            return;
        }
    }
}

AttributeRegistry.prototype.registerByType = function(attribute, type)
{
    if (this.typeRegistry[type] == undefined)
    {
        this.typeRegistry[type] = new Array();
    }

    this.typeRegistry[type].push(attribute);
}

AttributeRegistry.prototype.registerByName = function(attribute, name)
{
    if (name.length == 0)
    {
        name = "unnamed";
    }

    if (this.nameRegistry[name] == undefined)
    {
        this.nameRegistry[name] = new Array();
    }

    this.nameRegistry[name].push(attribute);
}

AttributeRegistry.prototype.register = function(attribute)
{
    // register using type
    this.registerByType(attribute, attribute.attrType);

    // register using name attribute if container
    if (attribute.isContainer())
    {
        var name = attribute.getAttribute("name") || attribute.getAttribute("id");
        if (name)
        {
            this.registerByName(attribute, name.getValueDirect().join(""));
            name.addModifiedCB(AttributeRegistry_AttributeContainerNameModifiedCB, this);
        }
    }

    this.addUnique(attribute);
    this.objectCount++;

    attribute.onRegister(this);
}

AttributeRegistry.prototype.unregisterByType = function(attribute, type)
{
    if (this.typeRegistry[type])
    {
        this.typeRegistry[type].splice(this.typeRegistry[type].indexOf(attribute), 1);
    }
}

AttributeRegistry.prototype.unregisterByName = function(attribute, name)
{
    if (name.length == 0)
    {
        name = "unnamed";
    }

    if (this.nameRegistry[name])
    {
        this.nameRegistry[name].splice(this.nameRegistry[name].indexOf(attribute), 1);
    }
}

AttributeRegistry.prototype.unregister = function(attribute)
{
    // register using type
    this.unregisterByType(attribute, attribute.attrType);

    // register using name attribute if container
    if (attribute.isContainer())
    {
        var name = attribute.getAttribute("name") ||
                attribute.getAttribute("id");
        if (name)
        {
            this.unregisterByName(attribute, name.getValueDirect().join(""));
            name.removeModifiedCB(AttributeRegistry_AttributeContainerNameModifiedCB, this);
        }
    }

    this.removeUnique(attribute);
    this.objectCount--;

    attribute.onUnregister(this);
}

AttributeRegistry.prototype.getByType = function(type)
{
    switch (type)
    {
        case eAttrType.Camera:
            {
                var result = [];
                var perspectives = this.getByType(eAttrType.PerspectiveCamera);
                if (perspectives)
                {
                    for (var j = 0; j < perspectives.length; j++)
                    {
                        result.push(perspectives[j]);
                    }
                }
                var orthographics = this.getByType(eAttrType.OrthographicCamera);
                if (orthographics)
                {
                    for (var j = 0; j < orthographics.length; j++)
                    {
                        result.push(orthographics[j]);
                    }
                }
                return result;
            }
            break;

        case eAttrType.Evaluator:
            {
                var result = [];
                for (var i = eAttrType.Evaluator + 1; i != eAttrType.Evaluator_End; i++)
                {
                    var evaluators = this.getByType(i);
                    if (evaluators)
                    {
                        for (var j = 0; j < evaluators.length; j++)
                        {
                            result.push(evaluators[j]);
                        }
                    }
                }
                return result;
            }
            break;

        default:
            {
                return this.typeRegistry[type];
            }
            break;
    }
}

AttributeRegistry.prototype.getByName = function(name)
{
    return this.nameRegistry[name];
}

AttributeRegistry.prototype.updateName = function(container, name)
{
    for (var i in this.nameRegistry)
    {
        for (var j = 0; j < this.nameRegistry[i].length; j++)
        {
            if (this.nameRegistry[i][j] == container)
            {
                this.nameRegistry[i].splice(j, 1);
                this.registerByName(container, name);
                return;
            }
        }
    }
}

AttributeRegistry.prototype.clear = function()
{
    for (var i in this.typeRegistry)
    {
        this.typeRegistry[i] = [];
    }
    this.typeRegistry = [];

    for (var i in this.nameRegistry)
    {
        this.nameRegistry[i] = [];
    }
    this.nameRegistry = [];

    this.uniqueAttributes = [];

    this.objectCount = 0;
}

AttributeRegistry.prototype.getObjectCount = function()
{
    return this.uniqueAttributes.length;
}

AttributeRegistry.prototype.getObject = function(num)
{
    if (num < this.uniqueAttributes.length)
    {
        return this.uniqueAttributes[num];
    }

    return null;
}

function AttributeRegistry_AttributeContainerNameModifiedCB(attribute, container)
{
    container.updateName(attribute.getContainer(), attribute.getValueDirect().join(""));
}
BooleanAttr.prototype = new Attribute();
BooleanAttr.prototype.constructor = BooleanAttr;

function BooleanAttr(value)
{
    Attribute.call(this);
    this.className = "BooleanAttr";
    this.attrType = eAttrType.BooleanAttr;
    this.setValue(value || false);
}

BooleanAttr.prototype.clone = function()
{
    var attr = new BooleanAttr();
    attr.setValue(this.values);
    return attr;
}

BooleanAttr.prototype.getValueDirect = function()
{
    var values = [];
    this.getValue(values);
    return values[0];
}

BooleanAttr.prototype.getLastValueDirect = function()
{
    var lastValues = [];
    this.getLastValue(lastValues);
    return lastValues;
}

BooleanAttr.prototype.setValueDirect = function(value, params)
{
    var values = [value];
    this.setValue(value, params);
}

ColorAttr.prototype = new Attribute();
ColorAttr.prototype.constructor = ColorAttr;

function ColorAttr(r, g, b, a)
{
    Attribute.call(this);
    this.className = "ColorAttr";
    this.attrType = eAttrType.ColorAttr;
    var values = [ r || 0, g || 0, b || 0, a || 0 ];
    this.setValue(values);
}

ColorAttr.prototype.clone = function()
{
    var attr = new ColorAttr();
    attr.setValue(this.values);
    return attr;
}

ColorAttr.prototype.getValueDirect = function()
{
    var values = [];
    this.getValue(values);
    return { r: values[0], g: values[1], b: values[2], a: values[3] };
}

ColorAttr.prototype.setValueDirect = function(r, g, b, a, params)
{
    var values = [ r, g, b, a ];
    this.setValue(values, params);
}

Matrix4x4Attr.prototype = new Attribute();
Matrix4x4Attr.prototype.constructor = Matrix4x4Attr;

function Matrix4x4Attr(_11, _12, _13, _14,
                       _21, _22, _23, _24,
                       _31, _32, _33, _34,
                       _41, _42, _43, _44)
{
    Attribute.call(this);
    this.className = "Matrix4x4Attr";
    this.attrType = eAttrType.Matrix4x4Attr;
    var values = [ _11 || 1, _12 || 0, _13 || 0, _14 || 0,
                   _21 || 0, _22 || 1, _23 || 0, _24 || 0,
                   _31 || 0, _32 || 0, _33 || 1, _34 || 0,
                   _41 || 0, _42 || 0, _43 || 0, _44 || 1 ];
    this.setValue(values);
}

Matrix4x4Attr.prototype.clone = function()
{
    var attr = new Matrix4x4Attr();
    attr.setValue(this.values);
    return attr;
}

Matrix4x4Attr.prototype.getValueDirect = function()
{
    var values = [];
    this.getValue(values);
    var result = new Matrix4x4();
    result.loadArray(values);
    return result;
}

Matrix4x4Attr.prototype.setValueDirect = function(matrix, params)
{
    var values = [ matrix._11, matrix._12, matrix._13, matrix._14,
                   matrix._21, matrix._22, matrix._23, matrix._24,
                   matrix._31, matrix._32, matrix._33, matrix._34,
                   matrix._41, matrix._42, matrix._43, matrix._44 ];
    this.setValue(values, params);
}

NumberArrayAttr.prototype = new Attribute();
NumberArrayAttr.prototype.constructor = NumberArrayAttr;

function NumberArrayAttr()
{
    Attribute.call(this);
    this.className = "NumberArrayAttr";
    this.attrType = eAttrType.NumberArrayAttr;
}

NumberArrayAttr.prototype.clone = function()
{
    var attr = new NumberArrayAttr();
    attr.setValue(this.values);
    return attr;
}

NumberArrayAttr.prototype.getValueDirect = function()
{
    var values = [];
    this.getValue(values);
    return values;
}

NumberArrayAttr.prototype.setValueDirect = function(values, params)
{
    this.setValue(values, params);
}

NumberAttr.prototype = new Attribute();
NumberAttr.prototype.constructor = NumberAttr;

function NumberAttr(value)
{
    Attribute.call(this);
    this.className = "NumberAttr";
    this.attrType = eAttrType.NumberAttr;
    this.setValue(value || 0);
}

NumberAttr.prototype.clone = function()
{
    var attr = new NumberAttr();
    attr.setValue(this.values);
    return attr;
}

NumberAttr.prototype.getValueDirect = function()
{
    var values = [];
    this.getValue(values);
    return values[0];
}

NumberAttr.prototype.setValueDirect = function(value, params)
{
    var values = [value];
    this.setValue(values, params);
}

PulseAttr.prototype = new BooleanAttr();
PulseAttr.prototype.constructor = PulseAttr;

function PulseAttr()
{
    BooleanAttr.call(this);
    this.className = "PulseAttr";
    this.attrType = eAttrType.PulseAttr;
    
    this.setTransient(true); // don't serialize because by definition this attribute doesn't hold "true" (it pulses)
}

PulseAttr.prototype.clone = function()
{
    var attr = new PulseAttr();
    attr.setValue(this.values);
    return attr;
}

PulseAttr.prototype.pulse = function()
{
    this.setValueDirect(true);
    this.setValueDirect(false);
}

QuaternionAttr.prototype = new Attribute();
QuaternionAttr.prototype.constructor = QuaternionAttr;

function QuaternionAttr(w, x, y, z)
{
    Attribute.call(this);
    this.className = "QuaternionAttr";
    this.attrType = eAttrType.QuaternionAttr;
    var values = [ w || 1, x || 0, y || 0, z || 0 ];
    this.setValue(values);
}

QuaternionAttr.prototype.clone = function()
{
    var attr = new QuaternionAttr();
    attr.setValue(this.values);
    return attr;
}

QuaternionAttr.prototype.getValueDirect = function()
{
    var values = [];
    this.getValue(values);
    var result = new Quaternion();
    result.loadArray(values);
    return result;
}

QuaternionAttr.prototype.setValueDirect = function(quaternion, params)
{
    var values = [ quaternion.w, quaternion.x, quaternion.y, quaternion.z ];
    this.setValue(values, params);
}

ReferenceAttr.prototype = new Attribute();
ReferenceAttr.prototype.constructor = ReferenceAttr;

function ReferenceAttr(value)
{
    Attribute.call(this);
    this.className = "ReferenceAttr";
    this.attrType = eAttrType.ReferenceAttr;
    this.setValue(value || null);
}

ReferenceAttr.prototype.clone = function()
{
    var attr = new ReferenceAttr();
    attr.setValue(this.values);
    return attr;
}

ReferenceAttr.prototype.getValueDirect = function()
{
    var values = [];
    this.getValue(values);
    return values[0];
}

ReferenceAttr.prototype.setValueDirect = function(value, params)
{
    var values = [value];
    this.setValue(value, params);
}

StringAttr.prototype = new Attribute();
StringAttr.prototype.constructor = StringAttr;

function StringAttr(value)
{
    Attribute.call(this);
    this.className = "StringAttr";
    this.attrType = eAttrType.StringAttr;
    this.setValue(value || "");
}

StringAttr.prototype.clone = function()
{
    var attr = new StringAttr();
    attr.setValue(this.values);
    return attr;
}

StringAttr.prototype.getValueDirect = function()
{
    var values = [];
    this.getValue(values);
    return values;
}

StringAttr.prototype.getLastValueDirect = function()
{
    var lastValues = [];
    this.getLastValue(lastValues);
    return lastValues;
}

StringAttr.prototype.setValueDirect = function(value, params)
{
    this.setValue(value, params);
}

StringAttr.prototype.setValue = function(values, params)
{
    this.values = [];
    
    // call base-class implementation
    Attribute.prototype.setValue.call(this, values, params);
}

StringAttrAllocator.prototype = new Allocator();
StringAttrAllocator.prototype.constructor = StringAttrAllocator;

function StringAttrAllocator()
{
}

StringAttrAllocator.prototype.allocate = function()
{
    return new StringAttr();
}

TernaryAttr.prototype = new NumberAttr();
TernaryAttr.prototype.constructor = TernaryAttr;

function TernaryAttr(value)
{
    NumberAttr.call(this, value);
    this.className = "TernaryAttr";
    this.attrType = eAttrType.TernaryAttr;
    
    // TODO: this.setRange(-1, 1);
}

TernaryAttr.prototype.clone = function()
{
    var attr = new TernaryAttr();
    attr.setValue(this.values);
    return attr;
}

Vector2DAttr.prototype = new Attribute();
Vector2DAttr.prototype.constructor = Vector2DAttr;

function Vector2DAttr(x, y)
{
    Attribute.call(this);
    this.className = "Vector2DAttr";
    this.attrType = eAttrType.Vector2DAttr;
    var values = [ x || 0, y || 0 ];
    this.setValue(values);
}

Vector2DAttr.prototype.clone = function()
{
    var attr = new Vector2DAttr();
    attr.setValue(this.values);
    return attr;
}

Vector2DAttr.prototype.getValueDirect = function()
{
    var values = [];
    this.getValue(values);
    return { x: values[0], y: values[1] };
}

Vector2DAttr.prototype.setValueDirect = function(x, y, params)
{
    var values = [ x, y ];
    this.setValue(values, params);
}

Vector3DAttr.prototype = new Attribute();
Vector3DAttr.prototype.constructor = Vector3DAttr;

function Vector3DAttr(x, y, z)
{
    Attribute.call(this);
    this.className = "Vector3DAttr";
    this.attrType = eAttrType.Vector3DAttr;
    var values = [ x || 0, y || 0, z || 0 ];
    this.setValue(values);
}

Vector3DAttr.prototype.clone = function()
{
    var attr = new Vector3DAttr();
    attr.setValue(this.values);
    return attr;
}

Vector3DAttr.prototype.getValueDirect = function()
{
    var values = [];
    this.getValue(values);
    return { x: values[0], y: values[1], z: values[2] };
}

Vector3DAttr.prototype.setValueDirect = function(x, y, z, params)
{
    var values = [ x, y, z ];
    this.setValue(values, params);
}

Vector3DAttr.prototype.isZero = function()
{
	var values = [];
    this.getValue(values);
    return (values[0] == 0 && values[1] == 0 && values[2] == 0) ? true : false;
}

ViewportAttr.prototype = new Attribute();
ViewportAttr.prototype.constructor = ViewportAttr;

function ViewportAttr(x, y, width, height)
{
    Attribute.call(this);
    this.className = "ViewportAttr";
    this.attrType = eAttrType.ViewportAttr;
    var values = [ x || 0, y || 0, width || 0, height || 0 ];
    this.setValue(values);
}

ViewportAttr.prototype.clone = function()
{
    var attr = new ViewportAttr();
    attr.setValue(this.values);
    return attr;
}

ViewportAttr.prototype.getValueDirect = function()
{
    var values = [];
    this.getValue(values);
    return { x: values[0], y: values[1], width: values[2], height: values[3] };
}

ViewportAttr.prototype.setValueDirect = function(x, y, width, height, params)
{
    var values = [ x, y, width, height ];
    this.setValue(values, params);
}

AttributeVector.prototype = new AttributeContainer();
AttributeVector.prototype.constructor = AttributeVector;

function AttributeVector(allocator) // TODO: not sure if allocator is needed
{
    AttributeContainer.call(this);
    this.className = "AttributeVector";
    this.attrType = eAttrType.AttributeVector;
    
    this.vector = [];
    
    this.allocator = allocator;
    
    this.size = new NumberAttr(0);
    this.baseName = new StringAttr("item");
    this.appendParsedElements = new BooleanAttr(false);
    this.elementModified = new PulseAttr();
    
    this.size.addModifiedCB(AttributeVector_SizeModifiedCB, this);
    this.baseName.addModifiedCB(AttributeVector_BaseNameModifiedCB, this);
    
    this.registerAttribute(this.size, "size");
    this.registerAttribute(this.baseName, "baseName");
    this.registerAttribute(this.appendParsedElements, "appendParsedElements");
    this.registerAttribute(this.elementModified, "elementModified");
}

AttributeVector.prototype.allocatesElements = function() // TODO: necessary (?)
{
    return (this.allocator ? true : false);
}

AttributeVector.prototype.push_back = function(item)
{
    this.addElement(this.vector.length, item);
}

AttributeVector.prototype.erase = function(item)
{
    for (var i=0; i < this.vector.length; i++)
    {
        if (this.vector[i] == item)
        { 
            this.removeElement(i);
            return;
        }
    }
}

AttributeVector.prototype.resize = function(size)
{
    this.size.setValueDirect(size);
}

AttributeVector.prototype.clear = function()
{
    this.resize(0);
}

AttributeVector.prototype.getAt = function(index)
{
    if (this.vector.length > index)
    {
        return this.vector[index];
    }
    
    return null;
}

AttributeVector.prototype.setAt = function(index, item)
{
    if (this.vector.length > index)
    {
        this.vector[index] = item;
    }
}

AttributeVector.prototype.prev = function(element)
{
    for (var i=0; i < this.vector.length; i++)
    {
        if (this.vector[i] == element)
        {
            if (i > 0) return this.vector[i-1];
            break;
        }        
    }
    
    return null;
}

AttributeVector.prototype.next = function(element)
{
    for (var i=0; i < this.vector.length; i++)
    {
        if (this.vector[i] == element)
        {
            if (i < (this.vector.length - 1)) return this.vector[i+1];
            break;
        }        
    }
    
    return null;
}

AttributeVector.prototype.addElement = function(index, element)
{
    this.vector.splice(index, 0, element);
    this.size.setValueDirect(this.vector.length);
}

AttributeVector.prototype.removeElement = function(index)
{
    this.vector.splice(index, 1);
    this.size.setValueDirect(this.vector.length);
}

AttributeVector.prototype.Size = function()
{
    return this.size.getValueDirect();
}

AttributeVector.prototype.AppendParsedElements = function()
{
    return this.appendParsedElements.getValueDirect();
}

AttributeVector.prototype.setElementName = function(element, name)
{
    this.unregisterAttribute(element); // don't allow registration under multiple names
    this.registerAttribute(element, name);
    
    // TODO: add to element name map
    console.debug("TODO: add to element name map");
}

AttributeVector.prototype.synchronize = function(src, syncValues)
{
    var length = this.Size();
    var srcLength = src.Size();
    
    while (srcLength > length)
    {
        this.push_back(src.getAt(length));
        length++;
    }
    
    while (srcLength < length)
    {
        this.removeElement(length-1);
        length--;
    }
    
    if (syncValues)
    {
        for (var i = 0; i < length; i++)
        {
            if (src.getAt(i).getValueDirect() != this.getAt(i).getValueDirect())
            {
                this.getAt(i).copyValue(src.getAt(i));
            }
        }
    }
}

AttributeVector.prototype.isCollection = function()
{
    return true;
}

AttributeVector.prototype.sizeModified = function()
{
    var lastSize = this.vector.length;
    var nextSize = this.size.getValueDirect();
    var start, end;

    if (nextSize > lastSize)
    {
        start = lastSize;
        end = start + (nextSize - lastSize);

        for (var i = start; i < end; i++)
        {
            this.addElement(i, this.allocator ? this.allocator.allocate() : null);
        }
    }
    else if (nextSize < lastSize)
    {
        start = lastSize;
        end = start - (lastSize - nextSize);

        for (var i = start - 1; i >= end; i--)
        {
            this.removeElement(i);
        }
    }
}

function AttributeVector_SizeModifiedCB(attribute, container)
{
    container.sizeModified();
}

function AttributeVector_BaseNameModifiedCB(attribute, container)
{
}

StyleAttr.prototype = new AttributeContainer();
StyleAttr.prototype.constructor = StyleAttr;

function StyleAttr()
{
    AttributeContainer.call(this);
    this.className = "StyleAttr";
    this.attrType = eAttrType.StyleAttr;

    this.setOp = new NumberAttr(eAttrSetOp.Replace);
    this.styleUrl = new StringAttr();

    this.styleUrl.addModifiedCB(StyleAttr_StyleUrlModifiedCB, this);
    
    this.registerAttribute(this.setOp, "setOp");
    this.registerAttribute(this.styleUrl, "styleUrl");
}

StyleAttr.prototype.updateStyle = function(style)
{
    // implemented by derived classes
}

StyleAttr.prototype.styleUrlModified = function()
{
    var styleUrl = this.styleUrl.getValueDirect().join("");
    if (this.registry)
    {
        this.updateStyle(this.registry.find(styleUrl));
    }
}

function StyleAttr_StyleUrlModifiedCB(attribute, container)
{
    container.styleUrlModified();
}

StylesAttr.prototype = new AttributeVector();
StylesAttr.prototype.constructor = StylesAttr;

function StylesAttr()
{
    AttributeVector.call(this);
    this.className = "StylesAttr";
    this.attrType = eAttrType.StylesAttr;

    this.registeredCBs = [];
    this.registeredCBsData = [];
    
    this.enabled = new BooleanAttr(true);

    this.registerAttribute(this.enabled, "enabled");
}

StylesAttr.prototype.updateStyle = function(style)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        return;
    }

    for (var i = 0; i < style.Size(); i++)
    {
        for (var j = 0; j < this.Size(); j++)
        {
            if (this.vector[j].attrType == style.vector[i].attrType)
            {
                this.vector[j].updateStyle(style.vector[i]);
                break;
            }
        }
    }
}

StylesAttr.prototype.registerStyle = function(style, name)
{
    this.push_back(style);
    this.setElementName(style, name);
    this.alertRegisteredCBs(style, true);
}

StylesAttr.prototype.unregisterStyle = function(style)
{
    for (var i in this.vector)
    {
        if (this.vector[i] == style)
        {
            this.alertRegisteredCBs(style, false);
            delete this.vector[i];
            break;
        }
    }
}

StylesAttr.prototype.addRegisteredCB = function(callback, data)
{
    this.registeredCBs.push(callback);
    this.registeredCBsData.push(data);
}

StylesAttr.prototype.alertRegisteredCBs = function(style, registered)
{
    for (var i = 0; i < this.registeredCBs.length; i++)
    {
        this.registeredCBs[i](style, this.registeredCBs[i]);
    }
}

StylesAttr.prototype.push_back = function(item)
{
    // call base-class implementation
    AttributeVector.prototype.push_back.call(this, item);

    this.alertRegisteredCBs(item, true);
}

StylesAttr.prototype.getStyle = function(type)
{
    for (var i = 0; i < this.Size(); i++)
    {
        if (this.vector[i].attrType == type)
        {
            return this.vector[i];
        }
    }

    return undefined;
}

StyleMapAttr.prototype = new AttributeContainer();
StyleMapAttr.prototype.constructor = StyleMapAttr;

function StyleMapAttr()
{
    AttributeContainer.call(this);
    this.className = "StyleMapAttr";
    this.attrType = eAttrType.StyleMapAttr;

    this.eventType = eEventType.Unknown;
    this.targetContainer = null;
    
    this.event = new StringAttr();
    this.styles = new StylesAttr();
    this.styleUrl = new StringAttr();
    this.target = new StringAttr();

    this.event.addModifiedCB(StyleMapAttr_EventModifiedCB, this);
    this.styleUrl.addModifiedCB(StyleMapAttr_styleUrlModifiedCB, this);
    this.target.addModifiedCB(StyleMapAttr_TargetModifiedCB, this);

    this.registerAttribute(this.event, "event");
    this.registerAttribute(this.styleUrl, "styleUrl");
    this.registerAttribute(this.target, "target");
}

StyleMapAttr.prototype.getStyles = function(eventType)
{
    var styles = null;
    var target = null;

    if (this.eventType == eventType)
    {
        styles = this.styles;
        target = this.targetContainer;
    }

    return { styles: styles, target: target };
}

StyleMapAttr.prototype.setStyles = function(styles)
{
    this.styles = styles;
}

StyleMapAttr.prototype.setTargetContainer = function(targetContainer)
{
    this.targetContainer = targetContainer;
}

StyleMapAttr.prototype.eventModified = function()
{
    var eventName = this.event.getValueDirect().join("");

    this.eventType = eEventNameMap[eventName];
}

StyleMapAttr.prototype.styleUrlModified = function()
{
    var styleUrl = this.styleUrl.getValueDirect();
    if (styleUrl[0] == '#')
    {
        styleUrl.splice(0, 1);
    }
    styleUrl = styleUrl.join("");

    var styles = this.registry.find(styleUrl);
    if (styles)
    {
        this.styles = styles;
    }
}

StyleMapAttr.prototype.targetModified = function()
{
    var target = this.target.getValueDirect().join("");

    this.targetContainer = this.registry.find(target);
}

function StyleMapAttr_EventModifiedCB(attribute, container)
{
    container.eventModified();
}

function StyleMapAttr_styleUrlModifiedCB(attribute, container)
{
    container.styleUrlModified();
}

function StyleMapAttr_TargetModifiedCB(attribute, container)
{
    container.targetModified();
}

StyleMapAttrAllocator.prototype = new Allocator();
StyleMapAttrAllocator.prototype.constructor = StyleMapAttrAllocator;

function StyleMapAttrAllocator()
{
}

StyleMapAttrAllocator.prototype.allocate = function()
{
    return new StyleMapAttr();
}

StylesMapAttr.prototype = new AttributeVector();
StylesMapAttr.prototype.constructor = StylesMapAttr;

function StylesMapAttr()
{
    AttributeVector.call(this, new StyleMapAttrAllocator());
    this.className = "StylesMapAttr";
    this.attrType = eAttrType.StylesMapAttr;

    this.stylesEnabledMap = [];

    this.size.addModifiedCB(StylesMapAttr_SizeModifiedCB, this);

    this.appendParsedElements.setValueDirect(true);
}

StylesMapAttr.prototype.getStyles = function(eventType)
{
    var styles = null;
    var enabled = false;
    var target = null;

    for (var i = 0; i < this.Size(); i++)
    {
        var result = this.vector[i].getStyles(eventType);
        if (result.styles)
        {
            styles = result.styles;
            target = result.target;
            if (this.stylesEnabledMap[result.styles])
            {
                enabled = this.stylesEnabledMap[result.styles];
            }
        }
    }

    return { styles: styles, target: target, enabled: enabled };
}

StylesMapAttr.prototype.StylesMapAttr_SizeModified = function()
{
    for (var i = 0; i < this.Size(); i++)
    {
        if (!(this.vector[i].registry))
        {
            this.vector[i].setRegistry(this.registry);
        }

        if (!(this.stylesEnabledMap[this.vector[i].styles]))
        {
            this.stylesEnabledMap[this.vector[i].styles] = new BooleanAttr(true);
        }
    }
}

function StylesMapAttr_SizeModifiedCB(attribute, container)
{
    container.StylesMapAttr_SizeModified();
}
KeyframeAttr.prototype = new AttributeContainer();
KeyframeAttr.prototype.constructor = KeyframeAttr;

function KeyframeAttr()
{
    AttributeContainer.call(this);
    this.className = "KeyframeAttr";
    this.attrType = eAttrType.KeyframeAttr;

    this.time = new NumberAttr();
    this.value = new NumberAttr();
    this.shape = new NumberAttr();
    this.params = new AttributeVector();

    for (var i = 0; i < 6; i++)
    {
        this.params.push_back(new NumberAttr(0));
    }

    this.registerAttribute(this.time, "time");
    this.registerAttribute(this.value, "value");
    this.registerAttribute(this.shape, "shape");
    this.registerAttribute(this.params, "params");

    this.getTime = function () {
        return this.time.getValueDirect();
    }
    this.getValue = function () {
        return this.value.getValueDirect();
    }
    this.getShape = function () {
        return this.shape.getValueDirect();
    }
    this.getParams = function (i) {
        return this.params.getAt(i).getValueDirect();
    }
}

KeyframesAttr.prototype = new AttributeVector();
KeyframesAttr.prototype.constructor = KeyframesAttr;

function KeyframesAttr()
{
    AttributeVector.call(this);
    this.className = "KeyframesAttr";
    this.attrType = eAttrType.KeyframesAttr;
}

BBoxAttr.prototype = new AttributeContainer();
BBoxAttr.prototype.constructor = BBoxAttr;

function BBoxAttr()
{
    AttributeContainer.call(this);
    this.className = "BBoxAttr";
    this.attrType = eAttrType.BBoxAttr;

    this.min = new Vector3DAttr();
    this.max = new Vector3DAttr();

    this.registerAttribute(this.min, "min");
    this.registerAttribute(this.max, "max");
}

BBoxAttr.prototype.setValueDirect = function (min, max)
{
    this.min.setValueDirect(min.x, min.y, min.z);
    this.max.setValueDirect(max.x, max.y, max.z);
}

ImageAttr.prototype = new AttributeContainer();
ImageAttr.prototype.constructor = ImageAttr;

function ImageAttr()
{
    AttributeContainer.call(this);
    this.className = "ImageAttr";
    this.attrType = eAttrType.ImageAttr;

    this.width = new NumberAttr(0);
    this.height = new NumberAttr(0);
    this.byteAlignment = new NumberAttr(0);
    this.pixelFormat = new NumberAttr(ePixelFormat.Unknown);
    this.pixels = new NumberArrayAttr();

    this.registerAttribute(this.width, "width");
    this.registerAttribute(this.height, "height");
    this.registerAttribute(this.byteAlignment, "byteAlignment");
    this.registerAttribute(this.pixelFormat, "pixelFormat");
    this.registerAttribute(this.pixels, "pixels");
}

RectAttr.prototype = new AttributeContainer();
RectAttr.prototype.constructor = RectAttr;

function RectAttr()
{
    AttributeContainer.call(this);
    this.className = "RectAttr";
    this.attrType = eAttrType.RectAttr;

    this.left = new NumberAttr(0);
    this.top = new NumberAttr(0);
    this.right = new NumberAttr(0);
    this.bottom = new NumberAttr(0);

    this.registerAttribute(this.left, "left");
    this.registerAttribute(this.top, "top");
    this.registerAttribute(this.right, "right");
    this.registerAttribute(this.bottom, "bottom");
}

RectAttr.prototype.getValueDirect = function ()
{
    var rect = new Rect();
    rect.left = this.left.getValueDirect();
    rect.top = this.top.getValueDirect();
    rect.right = this.right.getValueDirect();
    rect.bottom = this.bottom.getValueDirect();
    return rect;
}

RectAttr.prototype.setValueDirect = function (rect)
{
    this.left.setValueDirect(rect.left);
    this.top.setValueDirect(rect.top);
    this.right.setValueDirect(rect.right);
    this.bottom.setValueDirect(rect.bottom);
}

RectAttr.prototype.containsPoint = function (x, y)
{
    if (x >= this.left.getValueDirect() &&
            y >= this.top.getValueDirect() &&
            x <= this.right.getValueDirect() &&
            y <= this.bottom.getValueDirect())
        return true;

    return false;
}

FontStyleAttr.prototype = new StyleAttr();
FontStyleAttr.prototype.constructor = FontStyleAttr;

function FontStyleAttr()
{
    StyleAttr.call(this);
    this.className = "FontStyleAttr";
    this.attrType = eAttrType.FontStyleAttr;

    this.antialiasType = new NumberAttr(eImageAntialiasOp.EightPass);
    this.borderColor = new ColorAttr(0, 0, 0, 1);
    this.borderWidth = new NumberAttr(2);
    this.color = new ColorAttr(1, 1, 1, 1);
    this.effects = new StringAttr();
    this.font = new StringAttr("Arial");
    this.opacity = new NumberAttr(1);
    this.size = new NumberAttr(18);
    this.style = new StringAttr("Bold");

    this.registerAttribute(this.antialiasType, "antialiasType");
    this.registerAttribute(this.borderColor, "borderColor");
    this.registerAttribute(this.borderWidth, "borderWidth");
    this.registerAttribute(this.color, "color");
    this.registerAttribute(this.effects, "effects");
    this.registerAttribute(this.font, "font");
    this.registerAttribute(this.opacity, "opacity");
    this.registerAttribute(this.size, "size");
    this.registerAttribute(this.style, "style");
}

FontStyleAttr.prototype.updateStyle = function (style)
{
    var setOp = style.setOp.getValueDirect();

    // antialiasType
    if (style.antialiasType.modificationCount > 0)
    {
        this.antialiasType.copyValue(style.antialiasType, setOp);
    }

    // borderColor
    if (style.borderColor.modificationCount > 0)
    {
        this.borderColor.copyValue(style.borderColor, setOp);
    }

    // borderWidth
    if (style.borderWidth.modificationCount > 0)
    {
        this.borderWidth.copyValue(style.borderWidth, setOp);
    }

    // color
    if (style.color.modificationCount > 0)
    {
        this.color.copyValue(style.color, setOp);
    }

    // effects
    if (style.effects.modificationCount > 0)
    {
        this.effects.copyValue(style.effects, setOp);
    }

    // font
    if (style.font.modificationCount > 0)
    {
        this.font.copyValue(style.font, setOp);
    }

    // opacity
    if (style.opacity.modificationCount > 0)
    {
        this.opacity.copyValue(style.opacity, setOp);
    }

    // size
    if (style.size.modificationCount > 0)
    {
        this.size.copyValue(style.size, setOp);
    }

    // style
    if (style.style.modificationCount > 0)
    {
        this.style.copyValue(style.style, setOp);
    }
}

LabelStyleAttr.prototype = new StyleAttr();
LabelStyleAttr.prototype.constructor = LabelStyleAttr;

function LabelStyleAttr()
{
    StyleAttr.call(this);
    this.className = "LabelStyleAttr";
    this.attrType = eAttrType.LabelStyleAttr;

    this.angle = new NumberAttr(0);
    this.backgroundColor = new ColorAttr(0, 0, 0, 1);
    this.backgroundOpacity = new NumberAttr(0);
    this.fontStyle = new FontStyleAttr();
    this.format = new StringAttr("left");
    this.height = new NumberAttr(0);
    this.offset = new Vector2DAttr(0, 0);
    this.padding = new NumberAttr(0);
    this.scale = new Vector3DAttr(1, 1, 1);
    this.textAlign = new StringAttr("middleRight");
    this.width = new NumberAttr(0);

    this.registerAttribute(this.angle, "angle");
    this.registerAttribute(this.backgroundColor, "backgroundColor");
    this.registerAttribute(this.backgroundOpacity, "backgroundOpacity");
    this.registerAttribute(this.fontStyle, "fontStyle");
    this.registerAttribute(this.format, "format");
    this.registerAttribute(this.height, "height");
    this.registerAttribute(this.offset, "offset");
    this.registerAttribute(this.padding, "padding");
    this.registerAttribute(this.scale, "scale");
    this.registerAttribute(this.textAlign, "textAlign");
    this.registerAttribute(this.width, "width");
}

LabelStyleAttr.prototype.updateStyle = function (style)
{
    var setOp = style.setOp.getValueDirect();

    // angle
    if (style.angle.modificationCount > 0)
    {
        this.angle.copyValue(style.angle, setOp);
    }

    // backgroundColor
    if (style.backgroundColor.modificationCount > 0)
    {
        this.backgroundColor.copyValue(style.backgroundColor, setOp);
    }

    // backgroundOpacity
    if (style.backgroundOpacity.modificationCount > 0)
    {
        this.backgroundOpacity.copyValue(style.backgroundOpacity, setOp);
    }

    // fontStyle
    this.fontStyle.updateStyle(style.fontStyle);

    // format
    if (style.format.modificationCount > 0)
    {
        this.format.copyValue(style.format, setOp);
    }

    // height
    if (style.height.modificationCount > 0)
    {
        this.height.copyValue(style.height, setOp);
    }

    // offset
    if (style.offset.modificationCount > 0)
    {
        this.offset.copyValue(style.offset, setOp);
    }

    // padding
    if (style.padding.modificationCount > 0)
    {
        this.padding.copyValue(style.padding, setOp);
    }

    // scale
    if (style.scale.modificationCount > 0)
    {
        this.scale.copyValue(style.scale, setOp);
    }

    // textAlign
    if (style.textAlign.modificationCount > 0)
    {
        this.textAlign.copyValue(style.textAlign, setOp);
    }

    // width
    if (style.width.modificationCount > 0)
    {
        this.width.copyValue(style.width, setOp);
    }
}

IconStyleAttr.prototype = new StyleAttr();
IconStyleAttr.prototype.constructor = IconStyleAttr;

function IconStyleAttr()
{
    StyleAttr.call(this);
    this.className = "IconStyleAttr";
    this.attrType = eAttrType.IconStyleAttr;

    this.alphaUrl = new StringAttr("");
    this.color = new ColorAttr(1, 1, 1, 1);
    this.opacity = new NumberAttr(1);
    this.scale = new Vector3DAttr(1, 1, 1);
    this.url = new StringAttr("");

    this.registerAttribute(this.alphaUrl, "alphaUrl");
    this.registerAttribute(this.color, "color");
    this.registerAttribute(this.opacity, "opacity");
    this.registerAttribute(this.scale, "scale");
    this.registerAttribute(this.url, "url");
}

IconStyleAttr.prototype.updateStyle = function (style)
{
    var setOp = style.setOp.getValueDirect();

    // alphaUrl
    if (style.alphaUrl.modificationCount > 0)
    {
        this.alphaUrl.copyValue(style.alphaUrl, setOp);
    }

    // color
    if (style.color.modificationCount > 0)
    {
        this.color.copyValue(style.color, setOp);
    }

    // opacity
    if (style.opacity.modificationCount > 0)
    {
        this.opacity.copyValue(style.opacity, setOp);
    }

    // scale
    if (style.scale.modificationCount > 0)
    {
        this.scale.copyValue(style.scale, setOp);
    }

    // url
    if (style.url.modificationCount > 0)
    {
        this.url.copyValue(style.url, setOp);
    }
}

HTMLLabelStyleAttr.prototype = new StyleAttr();
HTMLLabelStyleAttr.prototype.constructor = HTMLLabelStyleAttr;

function HTMLLabelStyleAttr()
{
    StyleAttr.call(this);
    this.className = "HTMLLabelStyleAttr";
    this.attrType = eAttrType.HTMLLabelStyleAttr;

    this.bgColor = new ColorAttr(1, 1, 1, 1); // white
    this.height = new NumberAttr(0); // 0 (auto-calculate)
    this.html = new StringAttr(); // empty string
    this.left = new NumberAttr(0);
    //if (!(this.scrollBarLabelStyle = New<ScrollBarLabelStyleAttr>())) return;
    this.top = new NumberAttr(0);
    this.url = new StringAttr(); // empty string
    this.width = new NumberAttr(0); // 0 (auto-calculate)

    this.registerAttribute(this.bgColor, "bgColor");
    this.registerAttribute(this.height, "height");
    this.registerAttribute(this.html, "html");
    this.registerAttribute(this.html, "userData");          // for CDATA
    this.registerAttribute(this.left, "left");
    //this.registerAttribute(this.scrollBarLabelStyle, "scrollBarLabelStyle");
    this.registerAttribute(this.top, "top");
    this.registerAttribute(this.url, "url");
    this.registerAttribute(this.width, "width");
}

BalloonTipLabelStyleAttr.prototype = new StyleAttr();
BalloonTipLabelStyleAttr.prototype.constructor = BalloonTipLabelStyleAttr;

function BalloonTipLabelStyleAttr()
{
    StyleAttr.call(this);
    this.className = "BalloonTipLabelStyleAttr";
    this.attrType = eAttrType.BalloonTipLabelStyleAttr;

    this.balloonOffset = new NumberAttr(100);
    this.bgColor = new ColorAttr(1, 1, 1, 1);
    this.displayMode = new StringAttr("default");
    this.htmlLabelStyle = new HTMLLabelStyleAttr();
    this.text = new StringAttr();
    this.textColor = new ColorAttr(0, 0, 0, 1);

    this.registerAttribute(this.balloonOffset, "balloonOffset");
    this.registerAttribute(this.bgColor, "bgColor");
    this.registerAttribute(this.displayMode, "displayMode");
    this.registerAttribute(this.htmlLabelStyle, "htmlLabelStyle");
    this.registerAttribute(this.text, "text");
    this.registerAttribute(this.textColor, "textColor");
}

BalloonTipLabelStyleAttr.prototype.updateStyle = function (style)
{
    var setOp = style.setOp.getValueDirect();

    // balloonOffset
    if (style.balloonOffset.modificationCount > 0)
    {
        this.balloonOffset.copyValue(style.balloonOffset, setOp);
    }

    // bgColor
    if (style.bgColor.modificationCount > 0)
    {
        this.bgColor.copyValue(style.bgColor, setOp);
    }

    // displayMode
    if (style.displayMode.modificationCount > 0)
    {
        this.displayMode.copyValue(style.displayMode, setOp);
    }

    // htmlLabelStyle
    this.htmlLabelStyle.updateStyle(style.htmlLabelStyle);

    // text
    if (style.text.modificationCount > 0)
    {
        this.text.copyValue(style.text, setOp);
    }

    // textColor
    if (style.textColor.modificationCount > 0)
    {
        this.textColor.copyValue(style.textColor, setOp);
    }
}

RenderableElementStyleAttr.prototype = new StyleAttr();
RenderableElementStyleAttr.prototype.constructor = RenderableElementStyleAttr;

function RenderableElementStyleAttr()
{
    StyleAttr.call(this);
    this.className = "RenderableElementStyleAttr";
    this.attrType = eAttrType.RenderableElementStyleAttr;

    this.hasFocus = new TernaryAttr(0);
    this.selected = new TernaryAttr(0);

    this.registerAttribute(this.hasFocus, "hasFocus");
    this.registerAttribute(this.selected, "selected");
}

RenderableElementStyleAttr.prototype.updateStyle = function (style)
{
    var setOp = style.setOp.getValueDirect();

    // hasFocus
    if (style.hasFocus.modificationCount > 0)
    {
        this.hasFocus.copyValue(style.hasFocus, setOp);
    }

    // selected
    if (style.selected.modificationCount > 0)
    {
        this.selected.copyValue(style.selected, setOp);
    }
}

PlaneAttr.prototype = new AttributeContainer();
PlaneAttr.prototype.constructor = PlaneAttr;

function PlaneAttr()
{
    AttributeContainer.call(this);
    this.className = "PlaneAttr";
    this.attrType = eAttrType.PlaneAttr;

    this.point = new Vector3DAttr(0, 0, 0);
    this.normal = new Vector3DAttr(0, 0, 1);
    this.dot = new NumberAttr(0);

    this.registerAttribute(this.point, "point");
    this.registerAttribute(this.normal, "normal");
    this.registerAttribute(this.dot, "dot");
}

PlaneAttr.prototype.getValueDirect = function ()
{
    var point = this.point.getValueDirect();
    var normal = this.normal.getValueDirect();
    var plane = new Plane(new Vector3D(point.x, point.y, point.z), new Vector3D(normal.x, normal.y, normal.z));
    return plane;
}

PlaneAttr.prototype.setValueDirect = function (plane)
{
    this.point.setValueDirect(plane.point.x, plane.point.y, plane.point.z);
    this.normal.setValueDirect(plane.normal.x, plane.normal.y, plane.normal.z);
    this.dot.setValueDirect(plane.dot);
}

ViewVolumeAttr.prototype = new AttributeContainer();
ViewVolumeAttr.prototype.constructor = ViewVolumeAttr;

function ViewVolumeAttr()
{
    AttributeContainer.call(this);
    this.className = "ViewVolumeAttr";
    this.attrType = eAttrType.ViewVolumeAttr;

    this.left = new PlaneAttr();
    this.right = new PlaneAttr();
    this.top = new PlaneAttr();
    this.bottom = new PlaneAttr();
    this.near = new PlaneAttr();
    this.far = new PlaneAttr();

    this.registerAttribute(this.left, "left");
    this.registerAttribute(this.right, "right");
    this.registerAttribute(this.top, "top");
    this.registerAttribute(this.bottom, "bottom");
    this.registerAttribute(this.near, "near");
    this.registerAttribute(this.far, "far");
}

ViewVolumeAttr.prototype.setValueDirect = function (left, right, top, bottom, near, far)
{
    this.left.setValueDirect(left);
    this.right.setValueDirect(right);
    this.top.setValueDirect(top);
    this.bottom.setValueDirect(bottom);
    this.near.setValueDirect(near);
    this.far.setValueDirect(far);
}

SphereAttr.prototype = new AttributeContainer();
SphereAttr.prototype.constructor = SphereAttr;

function SphereAttr()
{
    AttributeContainer.call(this);
    this.className = "SphereAttr";
    this.attrType = eAttrType.SphereAttr;

    this.sphere = new Sphere();

    this.center = new Vector3DAttr(0, 0, 0);
    this.radius = new NumberAttr(0);

    this.center.addModifiedCB(SphereAttr_CenterModifiedCB, this);
    this.radius.addModifiedCB(SphereAttr_RadiusModifiedCB, this);
    
    this.registerAttribute(this.center, "center");
    this.registerAttribute(this.radius, "radius");
}

function SphereAttr_CenterModifiedCB(attribute, container)
{
    container.sphere.center = attribute.getValueDirect();
}

function SphereAttr_RadiusModifiedCB(attribute, container)
{
    container.sphere.radius = attribute.getValueDirect();
}

PhysicalPropertiesAttr.prototype = new AttributeContainer();
PhysicalPropertiesAttr.prototype.constructor = PhysicalPropertiesAttr;

function PhysicalPropertiesAttr()
{
    AttributeContainer.call(this);
    this.className = "PhysicalPropertiesAttr";
    this.attrType = eAttrType.PhysicalPropertiesAttr;

    this.mass = new NumberAttr(0);
    this.radius = new NumberAttr(0);
    this.friction = new NumberAttr(0);
    this.restitution = new NumberAttr(0);

    this.registerAttribute(this.mass, "mass");
    this.registerAttribute(this.radius, "radius");
    this.registerAttribute(this.friction, "friction");
    this.registerAttribute(this.restitution, "restitution");
}

function setAttributeValue(attribute, value)
{
    switch (attribute.attrType)
    {
    case eAttrType.BooleanAttr:
        {
            if (value == "false" || value == "0")
                attribute.setValueDirect(false);
            else 
                attribute.setValueDirect(true);
        }
        break;

    case eAttrType.ColorAttr:
    case eAttrType.Matrix4x4Attr:
    case eAttrType.NumberArrayAttr:
    case eAttrType.QuaternionAttr:
    case eAttrType.Vector2DAttr:
    case eAttrType.Vector3DAttr:
    case eAttrType.ViewportAttr:
        {
            // convert from string to numeric
            for (var i = 0; i < value.length; i++)
            {
                value[i] = parseFloat(value[i]);
            }
            attribute.setValue(value);
        }
        break;   
    
    case eAttrType.NumberAttr:
        {
            // convert from string to numeric
            attribute.setValueDirect(parseFloat(value));
        }
        break;

    default:
        {
            attribute.setValue(value);
        }
        break;
    }
}
Agent.prototype = new AttributeContainer();
Agent.prototype.constructor = Agent;

function Agent()
{
    AttributeContainer.call(this);
    this.className = "Agent";
    
    this.running = false;
    
    this.name = new StringAttr("");
    this.enabled = new BooleanAttr(true);
    
    this.registerAttribute(this.name, "name");
    this.registerAttribute(this.enabled, "enabled");
}

Agent.prototype.start = function()
{
    this.running = true;
}

Agent.prototype.stop = function()
{
    this.running = false;
}

Agent.prototype.pause = function()
{
    this.running = false;
}



function RayIntersectRecord()
{
    this.distance = Infinity;
    this.pointModel = new Vector3D();
    this.pointWorld = new Vector3D();
    this.pointView = new Vector3D();
    this.normalModel = new Vector3D();
    this.normalWorld = new Vector3D();
    this.normalView = new Vector3D();
    this.triIndex = 0;
}

function RayIntersectParams(rayOrigin,
                            rayDir,
                            nearDistance,
                            farDistance,
                            worldMatrix,
                            viewMatrix,
                            scale,
                            doubleSided,
                            clipPlanes)
{
    this.rayOrigin = rayOrigin || new Vector3D();
    this.rayDir = rayDir || new Vector3D();
    this.nearDistance = nearDistance || 0;
    this.farDistance = farDistance || 0;
    this.worldMatrix = worldMatrix || new Matrix4x4();
    this.viewMatrix = viewMatrix || new Matrix4x4();
    this.worldViewMatrix = this.worldMatrix.multiply(this.viewMatrix);
    this.scale = scale || 0;
    this.doubleSided = doubleSided || false;
    this.clipPlanes = clipPlanes || new Array();
    this.intersects = false;
    this.intersectRecord = new RayIntersectRecord();
}

function Triangle(x0, y0, z0, x1, y1, z1, x2, y2, z2)
{
    this.v0 = new Vector3D(x0, y0, z0);
    this.v1 = new Vector3D(x1, y1, z1);
    this.v2 = new Vector3D(x2, y2, z2);
}

function Sphere()
{
    this.center = new Vector3D();
    this.radius = 0;
    this.xcenter = new Vector3D(); // transformed center
    this.xradius = 0;              // transformed (scaled) radius
}

Sphere.prototype.setTransform = function(matrix)
{
    var result = matrix.transform(this.center.x, this.center.y, this.center.z, 1);
    this.xcenter.x = result.x;
    this.xcenter.y = result.y;
    this.xcenter.z = result.z;

    var scale = matrix.getScalingFactors();
    this.xradius = this.radius * max3(scale.x, scale.y, scale.z);
}

Sphere.prototype.intersects = function(sphere)
{
    // compare squared distances to keep from calling sqrt
    /*return (((this.xcenter.x - sphere.xcenter.x) * (this.xcenter.x - sphere.xcenter.x) + 
     (this.xcenter.y - sphere.xcenter.y) * (this.xcenter.y - sphere.xcenter.y) +
     (this.xcenter.z - sphere.xcenter.z) * (this.xcenter.z - sphere.xcenter.z)) < ((this.xradius + sphere.xradius) * (this.xradius + sphere.xradius)) ? true : false);
     */
    var distanceBetweenCenters = distanceBetween(this.xcenter, sphere.xcenter);
    var combinedRadii = this.xradius + sphere.xradius;

    if (distanceBetweenCenters < combinedRadii)
        return true;

    return false;
}

function Region(minX, minY, minZ, maxX, maxY, maxZ)
{
    this.min = new Vector3D(minX, minY, minZ);
    this.max = new Vector3D(maxX, maxY, maxZ);

    this.xpos = new Plane();
    this.xneg = new Plane();
    this.ypos = new Plane();
    this.yneg = new Plane();
    this.zpos = new Plane();
    this.zneg = new Plane();

    this.xpos_ypos_zpos = new Plane();
    this.xpos_ypos_zneg = new Plane();
    this.xpos_yneg_zpos = new Plane();
    this.xpos_yneg_zneg = new Plane();
    this.xneg_ypos_zpos = new Plane();
    this.xneg_ypos_zneg = new Plane();
    this.xneg_yneg_zpos = new Plane();
    this.xneg_yneg_zneg = new Plane();

    this.setPlanes();
}

Region.prototype.setPlanes = function()
{
    // generate axis planes
    this.xpos = new Plane(this.max, new Vector3D(1, 0, 0));
    this.xneg = new Plane(this.min, new Vector3D(-1, 0, 0));
    this.ypos = new Plane(this.max, new Vector3D(0, 1, 0));
    this.yneg = new Plane(this.min, new Vector3D(0, -1, 0));
    this.zpos = new Plane(this.max, new Vector3D(0, 0, 1));
    this.zneg = new Plane(this.min, new Vector3D(0, 0, -1));

    // define corner points of region
    var xp_yp_zp = new Vector3D(this.max.x, this.max.y, this.max.z);
    var xp_yp_zn = new Vector3D(this.max.x, this.max.y, this.min.z);
    var xp_yn_zp = new Vector3D(this.max.x, this.min.y, this.max.z);
    var xp_yn_zn = new Vector3D(this.max.x, this.min.y, this.min.z);
    var xn_yp_zp = new Vector3D(this.min.x, this.max.y, this.max.z);
    var xn_yp_zn = new Vector3D(this.min.x, this.max.y, this.min.z);
    var xn_yn_zp = new Vector3D(this.min.x, this.min.y, this.max.z);
    var xn_yn_zn = new Vector3D(this.min.x, this.min.y, this.min.z);

    // generate corner planes
    this.xpos_ypos_zpos = new Plane(xp_yp_zp, xp_yp_zp - xn_yn_zn);
    this.xpos_ypos_zneg = new Plane(xp_yp_zn, xp_yp_zn - xn_yn_zp);
    this.xpos_yneg_zpos = new Plane(xp_yn_zp, xp_yn_zp - xn_yp_zn);
    this.xpos_yneg_zneg = new Plane(xp_yn_zn, xp_yn_zn - xn_yp_zp);
    this.xneg_ypos_zpos = new Plane(xn_yp_zp, xn_yp_zp - xp_yn_zn);
    this.xneg_ypos_zneg = new Plane(xn_yp_zn, xn_yp_zn - xp_yn_zp);
    this.xneg_yneg_zpos = new Plane(xn_yn_zp, xn_yn_zp - xp_yp_zn);
    this.xneg_yneg_zneg = new Plane(xn_yn_zn, xn_yn_zn - xp_yp_zp);
}

Region.prototype.containsGeometry = function(tris, triIndices)
{
    var result = [];

    for (var i = 0; i < triIndices.length; i++)
    {
        if (this.containsTriangle(tris[triIndices[i]]))
        {
            result.push(triIndices[i]);
        }
    }

    return result;
}

Region.prototype.containsTriangle = function(tri)
{
    var verts = new Array(3);
    verts[0] = tri.v0;
    verts[1] = tri.v1;
    verts[2] = tri.v2;

    // check if any vertices are within the region bounds (quick accept)
    for (var i = 0; i < 3; i++)
    {
        if (verts[i].x >= this.min.x &&
            verts[i].y >= this.min.y &&
            verts[i].z >= this.min.z &&
            verts[i].x <= this.max.x &&
            verts[i].y <= this.max.y &&
            verts[i].z <= this.max.z)
        {
            return true;
        }
    }

    // check if all vertices are outside a region plane (quick reject)
    if (triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xpos) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xneg) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.ypos) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.yneg) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.zpos) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.zneg) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xpos_ypos_zpos) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xpos_ypos_zneg) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xpos_yneg_zpos) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xpos_yneg_zneg) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xneg_ypos_zpos) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xneg_ypos_zneg) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xneg_yneg_zpos) ||
        triangleOnPositiveSideOfPlane(verts[0], verts[1], verts[2], this.xneg_yneg_zneg))
    {
        return false;
    }

    // triangle has survived trivial acceptance/rejection tests...

    // test triangle line segments for cube face penetration
    // (only test segments if they span the face plane)
    var result;
    for (var i = 0; i < 3; i++)
    {
        var a = verts[i];
        var b = verts[(i + 1) % 3];

        // +X face
        result = lineSegmentPlaneIntersection(a, b, this.xpos);
        if (result.count > 0)
        {
            // if point lies within region face, triangle intersects region
            if (result.point.y >= this.min.y && result.point.y <= this.max.y &&
                result.point.z >= this.min.z && result.point.z <= this.max.z)
            {
                return true;
            }
        }

        // -X face
        result = lineSegmentPlaneIntersection(a, b, this.xneg);
        if (result.count > 0)
        {
            if (result.point.y >= this.min.y && result.point.y <= this.max.y &&
                result.point.z >= this.min.z && result.point.z <= this.max.z)
            {
                return true;
            }
        }

        // +Y face
        result = lineSegmentPlaneIntersection(a, b, this.ypos);
        if (result.count > 0)
        {
            if (result.point.x >= this.min.x && result.point.x <= this.max.x &&
                result.point.z >= this.min.z && result.point.z <= this.max.z)
            {
                return true;
            }
        }

        // -Y face
        result = lineSegmentPlaneIntersection(a, b, this.yneg);
        if (result.count > 0)
        {
            if (result.point.x >= this.min.x && result.point.x <= this.max.x &&
                result.point.z >= this.min.z && result.point.z <= this.max.z)
            {
                return true;
            }
        }

        // +Z face
        result = lineSegmentPlaneIntersection(a, b, this.zpos);
        if (result.count > 0)
        {
            if (result.point.x >= this.min.x && result.point.x <= this.max.x &&
                result.point.y >= this.min.y && result.point.y <= this.max.y)
            {
                return true;
            }
        }

        // -Z face
        result = lineSegmentPlaneIntersection(a, b, this.zneg);
        if (result.count > 0)
        {
            if (result.point.x >= this.min.x && result.point.x <= this.max.x &&
                result.point.y >= this.min.y && result.point.y <= this.max.y)
            {
                return true;
            }
        }
    }

    // triangle and region may still intersect if a region corner is poking
    // through the interior of the triangle; check for this case by
    // determining if any of the four region diagonals intersect the triangle
    // 0
    result = lineSegmentTriangleIntersection(this.min,
            this.max,
            verts[0], verts[1], verts[2]);
    if (result.count > 0)
        return true;
    // 1
    result = lineSegmentTriangleIntersection(new Vector3D(this.min.x, this.max.y, this.min.z),
            new Vector3D(this.max.x, this.min.y, this.max.z),
            verts[0], verts[1], verts[2]);
    if (result.count > 0)
        return true;
    // 2
    result = lineSegmentTriangleIntersection(new Vector3D(this.max.x, this.min.y, this.min.z),
            new Vector3D(this.min.x, this.max.y, this.max.z),
            verts[0], verts[1], verts[2]);
    if (result.count > 0)
        return true;
    // 3                                        
    result = lineSegmentTriangleIntersection(new Vector3D(this.min.x, this.min.y, this.max.z),
            new Vector3D(this.max.x, this.max.y, this.min.z),
            verts[0], verts[1], verts[2]);
    if (result.count > 0)
        return true;

    // triangle and region do not intersect
    return false;
}

function SphereTreeNode(tree)
{
    this.tree = tree;
    this.sphere = new Sphere();
    this.level = 0;
    this.parent = null;
    this.children = [];
    this.triIndices = [];
}

SphereTreeNode.prototype.isLeaf = function()
{
    return this.children.length == 0 ? true : false;
}

SphereTreeNode.prototype.addChild = function(child)
{
    this.children.push(child);
    child.parent = this;
}

SphereTreeNode.prototype.intersects = function(sphereTreeNode)
{
    return (this.sphere.intersects(sphereTreeNode.sphere));
}

SphereTreeNode.prototype.trisIntersect = function(sphereTreeNode)
{
    return true;
    /*
     var triVerts1 = [];
     for (var i = 0; i < this.triIndices.length; i++)
     {
     var index = this.triIndices[i];
     var tri = this.tree.tris[index];
     
     triVerts1.push(this.tree.xform.transform(tri.v0.x, tri.v0.y, tri.v0.z, 1));
     triVerts1.push(this.tree.xform.transform(tri.v1.x, tri.v1.y, tri.v1.z, 1));
     triVerts1.push(this.tree.xform.transform(tri.v2.x, tri.v2.y, tri.v2.z, 1));
     }   
     
     var triVerts2 = [];
     for (var i = 0; i < sphereTreeNode.triIndices.length; i++)
     {
     var index = sphereTreeNode.triIndices[i];
     var tri = sphereTreeNode.tree.tris[index];
     
     triVerts2.push(sphereTreeNode.tree.xform.transform(tri.v0.x, tri.v0.y, tri.v0.z, 1));
     triVerts2.push(sphereTreeNode.tree.xform.transform(tri.v1.x, tri.v1.y, tri.v1.z, 1));
     triVerts2.push(sphereTreeNode.tree.xform.transform(tri.v2.x, tri.v2.y, tri.v2.z, 1));
     } 
     
     for (var i = 0; i < triVerts1.length; i += 3)
     {
     for (var j = 0; j < triVerts2.length; j += 3)
     {
     if (triangleTriangleIntersection(triVerts1[i], triVerts1[i+1], triVerts1[i+2],
     triVerts2[j], triVerts2[j+1], triVerts2[j+2]))
     return true;
     }    
     }
     
     return false;*/
}

function SphereHitRec()
{
    this.target = null;
    this.testList = [];
}
;

function BoundingTree()
{
    this.root = null;
    this.min = new Vector3D();
    this.max = new Vector3D();
    this.tris = [];
    this.visited = [];
    this.xform = new Matrix4x4();
}

BoundingTree.prototype.setTriangles = function(tris, min, max)
{
    this.tris = tris.slice();
    this.min.copy(min);
    this.max.copy(max);
}

BoundingTree.prototype.setTransform = function(matrix)
{
    this.xform.loadMatrix(matrix);
}

SphereTree.prototype = new BoundingTree();
SphereTree.prototype.constructor = SphereTree;

function SphereTree()
{
    BoundingTree.call(this);
}

SphereTree.prototype.setTransform = function(matrix)
{
    if (this.root)
        this.transformNode(matrix, this.root);

    // call base-class implementation
    BoundingTree.prototype.setTransform.call(this, matrix);
}

SphereTree.prototype.transformNode = function(matrix, node)
{
    node.sphere.setTransform(matrix);

    // recurse on node children
    for (var i = 0; i < node.children.length; i++)
    {
        this.transformNode(matrix, node.children[i]);
    }
}

SphereTree.prototype.collides = function(tree)
{
    if (!this.root || !tree.root) // must be non-NULL
    {
        return false;
    }

    // check root nodes for collision
    if (this.nodesCollide(this.root, tree.root))
    {
        // if both root nodes are leaves, and node's triangle(s) intersect, return true
        if (this.root.isLeaf() && tree.root.isLeaf())
        {
            return this.root.trisIntersect(tree.root);
        }

        // recursively check child nodes
        var sphereHit = new SphereHitRec();
        var sphereHits = [];
        if (tree.root.isLeaf())
        {
            sphereHit.target = tree.root;
            sphereHit.testList = this.root.children;
        }
        else
        {
            sphereHit.target = this.root;
            sphereHit.testList = tree.root.children;
        }
        sphereHits.push(sphereHit);

        return this.testSphereHits(sphereHits);
    }

    // root nodes do not collide
    return false;
}

SphereTree.prototype.obstructs = function(tree, forward)
{
    if (!this.root || !tree.root) // must be non-NULL
    {
        return 0; // indicates no obstruction
    }

    // construct cylinder representing tree's root sphere extruded along the forward vector
    var cylA = tree.root.sphere.xcenter;
    var cylB = new Vector3D(cylA.x + forward.x,
            cylA.y + forward.y,
            cylA.z + forward.z);
    var cylRadius = tree.root.sphere.xradius;

    // find distance between cylinder center segment and this' center
    var distance = distanceBetweenLineSegmentAndPoint(cylA, cylB, this.root.sphere.xcenter);

    if (distance < (this.root.sphere.xradius + cylRadius))
    {
        return distance;
    }

    return 0; // indicates no obstruction
}

SphereTree.prototype.nodesCollide = function(node1, node2)
{
    return (node1.intersects(node2));
}

SphereTree.prototype.testSphereHits = function(sphereHits)
{
    while (sphereHits.length > 0)
    {
        if (this.testSphereHit(sphereHits[0], sphereHits))
        {
            return true;
        }

        sphereHits.splice(0, 1);
    }

    return false;
}

SphereTree.prototype.testSphereHit = function(sphereHit, sphereHits)
{
    for (var i = 0; i < sphereHit.testList.length; i++)
    {
        if (this.nodesCollide(sphereHit.target, sphereHit.testList[i]))
        {
            var nextSphereHit = new SphereHitRec();
            nextSphereHit.target = sphereHit.testList[i];
            if (sphereHit.target.isLeaf())
            {
                nextSphereHit.testList.push(sphereHit.target);
            }
            else
            {
                nextSphereHit.testList = sphereHit.target.children;
            }
            sphereHits.push(nextSphereHit);

            // check for leaf collision
            if (sphereHit.target.isLeaf() && sphereHit.testList[i].isLeaf())
            {
                return sphereHit.target.trisIntersect(sphereHit.testList[i]);
            }
        }
    }

    // no leaf collisions
    return false;
}

SphereTree.prototype.rayIntersectsTree = function(params)
{
    if (this.root)
    {
        this.visited.length = this.tris.length;
        for (var i = 0; i < this.visited.length; i++)
        {
            this.visited[i] = false;
        }

        return this.rayIntersectsTreeNode(this.root, params);
    }

    return false;
}

SphereTree.prototype.rayIntersectsTreeNode = function(root, params)
{
    // if this sphere tree node has children, and it is intersected by the ray, 
    // recurse on all sphere tree nodes in the next level, saving the smallest positive 
    // t value; if ray does not intersect this sphere tree node, or if no intersections 
    // are found for the next level, return false
    if (root.children.length > 0)
    {
        // check if this sphere tree node is intersected by the ray
        if (this.rayIntersectsSphere(root, params) == false)
        {
            return false;
        }

        // sphere tree node is intersected by the ray, recurse on children nodes
        var childIntersects = false;
        for (var i = 0; i < root.children.length; i++)
        {
            if (this.rayIntersectsTreeNode(root.children[i], params) == true)
            {
                childIntersects = true;
            }
        }

        if (childIntersects)
        {
            return true;
        }
        else // !childIntersects
        {
            return false;
        }
    }
    else // root.children.empty()
    {
        // lowest sphere tree node level (no children); check against tris
        return this.rayIntersectsTriangleList(root.triIndices, params);
    }
}

SphereTree.prototype.rayIntersectsSphere = function(node, params)
{
    // transform sphere center by world-view transform
    var center = params.worldViewMatrix.transform(node.sphere.center.x, node.sphere.center.y, node.sphere.center.z, 1);

    // adjust sphere radius by scale factor
    var radius = node.sphere.radius * max3(params.scale.x, params.scale.y, params.scale.z);

    // test for ray-sphere intersection
    var roots = raySphereIntersection(params.rayOrigin, params.rayDir, center, radius);
    switch (roots.count)
    {
        case 2:
            // two intersection points; accept if one root is positive
            if (roots.root1 <= 0 && roots.root2 <= 0)
            {
                return false;
            }
            break;

        case 1:
            // one intersection point (ray grazes sphere); accept if root is positive
            if (roots.root1 <= 0)
            {
                return false;
            }
            break;

        case 0:
        default:
            // no intersection
            return false;
    }

    return true;
}

SphereTree.prototype.rayIntersectsTriangleList = function(triIndices, params)
{
    var distance, u, v;

    // determine closest triangle intersected by ray (closest to ray origin)
    for (var i = 0; i < triIndices.length; i++)
    {
        var index = triIndices[i];

        // skip triangle if already tested
        if (this.visited[index] == true)
        {
            continue;
        }

        var tri = this.tris[index];

        // transform triangle vertices by world-view transform
        var v0 = params.worldViewMatrix.transform(tri.v0.x, tri.v0.y, tri.v0.z, 1);
        var v1 = params.worldViewMatrix.transform(tri.v1.x, tri.v1.y, tri.v1.z, 1);
        var v2 = params.worldViewMatrix.transform(tri.v2.x, tri.v2.y, tri.v2.z, 1);

        var result = rayTriangleIntersection(params.rayOrigin, params.rayDir, v0, v1, v2, false,
                (params.doubleSided ? false : true));
        if (result.result)
        {
            if (result.t >= params.nearDistance &&
                    result.t <= params.farDistance &&
                    result.t < params.intersectRecord.distance)
            {
                var pointModel = new Vector3D(tri.v0.x * (1 - result.u - result.v) + tri.v1.x * result.u + tri.v2.x * result.v,
                        tri.v0.y * (1 - result.u - result.v) + tri.v1.y * result.u + tri.v2.y * result.v,
                        tri.v0.z * (1 - result.u - result.v) + tri.v1.z * result.u + tri.v2.z * result.v);
                var pointWorld = params.worldMatrix.transform(pointModel.x, pointModel.y, pointModel.z, 1);
                var pointView = params.worldViewMatrix.transform(pointModel.x, pointModel.y, pointModel.z, 1);

                // test for intersection point on negative side of clip plane(s), if any (would hence be clipped)
                for (var c = 0; c < params.clipPlanes.length; c++)
                {
                    if (pointOnNegativeSideOfPlane(pointWorld, params.clipPlanes[c]))
                    {
                        // mark triangle as tested
                        this.visited[index] = true;
                        break;
                    }
                }
                if (this.visited[index]) // clipped by clip plane(s)
                {
                    continue;
                }

                // calculate polygon normal
                var leg1 = new Vector3D();
                var leg2 = new Vector3D();     
                leg1.load(tri.v1.x - tri.v0.x,
                          tri.v1.y - tri.v0.y,
                          tri.v1.z - tri.v0.z);
                leg2.load(tri.v2.x - tri.v0.x,
                          tri.v2.y - tri.v0.y,
                          tri.v2.z - tri.v0.z);
                var normalModel = crossProduct(leg1, leg2);
                normalModel.normalize();
                var normalWorld = params.worldMatrix.transform(normalModel.x, normalModel.y, normalModel.z, 0);
                normalWorld = new Vector3D(normalWorld.x, normalWorld.y, normalWorld.z);
                normalWorld.normalize();
                var normalView = params.worldViewMatrix.transform(normalModel.x, normalModel.y, normalModel.z, 0);
                normalView = new Vector3D(normalView.x, normalView.y, normalView.z);
                normalView.normalize();
            
                params.intersectRecord.distance = result.t;
                params.intersectRecord.pointModel.copy(pointModel);
                params.intersectRecord.pointWorld.copy(pointWorld);
                params.intersectRecord.pointView.copy(pointView);
                params.intersectRecord.normalModel.copy(normalModel);
                params.intersectRecord.normalWorld.copy(normalWorld);
                params.intersectRecord.normalView.copy(normalView);
                params.intersectRecord.triIndex = index;
                params.intersects = true;
            }
        }

        // mark triangle as tested
        this.visited[index] = true;
    }

    return params.intersects;
}

Octree.prototype = new SphereTree();
Octree.prototype.constructor = Octree;

function Octree()
{
    SphereTree.call(this);
}

Octree.prototype.buildTree = function(levels)
{
    if (levels < 0)
        return;

    // define root sphere
    var root = new SphereTreeNode(this);

    // sphere center is the midpoint of min/max extents
    root.sphere.center.copy(midpoint(this.min, this.max));
    root.sphere.xcenter.copy(root.sphere.center);

    // sphere radius is the distance between the midpoint of min/max extents and min/max extent
    root.sphere.radius = distanceBetween(root.sphere.center, this.max);
    root.sphere.xradius = root.sphere.radius;

    // set triIndices
    root.triIndices.length = this.tris.length;
    for (var i = 0; i < this.tris.length; i++)
    {
        root.triIndices[i] = i;
    }

    // build subsequent levels (if requested) 
    if (levels > 0)
    {
        this.buildTreeLevels(levels, this.min, this.max, root, root.triIndices);
    }

    this.root = root;
}

Octree.prototype.buildTreeLevels = function(levels, min, max, root, triIndices)
{
    if (root.level == levels || triIndices.length == 1)
    {
        // requested levels have been generated
        return;
    }

    // define 8 equal sub-regions occupying the span from min to max
    var mid = new Vector3D(min.x + ((max.x - min.x) / 2),
            min.y + ((max.y - min.y) / 2),
            min.z + ((max.z - min.z) / 2));

    var regions = new Array(8);
    regions[0] = new Region(min.x, min.y, min.z, mid.x, mid.y, mid.z);
    regions[1] = new Region(mid.x, min.y, min.z, max.x, mid.y, mid.z);
    regions[2] = new Region(min.x, min.y, mid.z, mid.x, mid.y, max.z);
    regions[3] = new Region(mid.x, min.y, mid.z, max.x, mid.y, max.z);
    regions[4] = new Region(min.x, mid.y, min.z, mid.x, max.y, mid.z);
    regions[5] = new Region(mid.x, mid.y, min.z, max.x, max.y, mid.z);
    regions[6] = new Region(min.x, mid.y, mid.z, mid.x, max.y, max.z);
    regions[7] = new Region(mid.x, mid.y, mid.z, max.x, max.y, max.z);

    // for each sub-region containing geometry, create a bounding sphere for the sub-region, 
    // add to the list of the root sphere node's children, and recursively call for the child 
    // sub-region
    for (var i = 0; i < 8; i++)
    {
        var triIndicesContainedByRegion = regions[i].containsGeometry(this.tris, triIndices);
        if (triIndicesContainedByRegion.length > 0)
        {
            // create sphere node
            var node = new SphereTreeNode(this);

            // set level
            node.level = root.level + 1;

            // set center
            node.sphere.center.copy(midpoint(regions[i].min, regions[i].max));
            node.sphere.xcenter.copy(node.sphere.center);

            // set radius
            node.sphere.radius = distanceBetween(node.sphere.center, regions[i].max);
            node.sphere.xradius = node.sphere.radius;

            // set triIndices
            node.triIndices = triIndicesContainedByRegion.slice();

            // add to root sphere node
            root.addChild(node);

            // recurse on sub-region
            this.buildTreeLevels(levels, regions[i].min, regions[i].max, node, node.triIndices);
        }
    }
}

function rayPick(tree,
        rayOrigin,
        rayDir,
        nearDistance,
        farDistance,
        worldMatrix,
        viewMatrix,
        scale,
        doubleSided,
        clipPlanes)
{
    var params = new RayIntersectParams(rayOrigin, rayDir, nearDistance, farDistance, worldMatrix, viewMatrix, scale, doubleSided, clipPlanes);
    tree.rayIntersectsTree(params);
    if (params.intersects == true)
    {
        return params.intersectRecord;
    }

    return null;
}
function Context()
{
    this.clear();
}

Context.prototype.clear = function()
{
    this.container = null;
    this.attribute = null;
    this.item = 0;
    this.containerName = "";
    this.attributeName = "";
}
var eRenderContextMethod =
{
    Unknown:                        0,
    ApplyProjectionTransform:       1,
    ApplyViewTransform:             2,
    ApplyWorldTransform:            3,
    Clear:                          4,
    ClearColor:                     5,
    ClearDepth:                     6,
    ClearStencil:                   7,
    CreateProgram:                  8,
    CreateTextureObject:            9,
    CreateVertexBuffer:             10,
    CullFace:                       11,
    Disable:                        12,
    Enable:                         13,
    EnableClipPlane:                14,
    Enabled:                        15,
    EnableLight:                    16,
    EnableTextureStage:             17,
    Finish:                         18,
    GetClipPlane:                   19,
    GetEnabledClipPlanes:           20,
    GetEnabledLights:               21,
    GetGlobalIllumination:          22,
    GetLight:                       23,
    GetMaxLightCount:               24,
    GetMaxTextureStages:            25,
    GetProgram:                     26,
    PerspectiveMatrixLH:            27,
    OrthographicMatrixLH:           28,
    SetBlendColor:                  29,
    SetBlendFactor:                 30,
    SetClipPlane:                   31,
    SetDepthFunc:                   32,
    SetEnabledClipPlanes:           33,
    SetEnabledLights:               34,
    SetFrontMaterial:               35,
    SetGlobalIllumination:          36,
    SetLight:                       37,
    SetShadeModel:                  38,
    SetStencilFunc:                 39,
    SetStencilMask:                 40,
    SetStencilOp:                   41,
    SetTextureBlendFactor:          42,
    SetTextureBlendOp:              43,
    SetTextureColorMask:            44,
    SetViewport:                    45,
    VB_SetPrimitiveType:            46,
    VB_SetVertices:                 47,
    VB_SetNormals:                  48,
    VB_SetColors:                   49,
    VB_SetUVCoords:                 50,
    VB_SetTextureStage:             51,
    VB_Draw:                        52,
    TO_SetImage:                    53,
    TO_SetImageData:                54,
    TO_SetVideo:                    55,
    SetMatrixMode:                  56,
    PushMatrix:                     57,
    PopMatrix:                      58,
    LoadMatrix:                     59,
    LeftMultMatrix:                 60,
    RightMultMatrix:                61,
    UseProgram:                     62,
    SetModelID:                     63
}

function RenderContextMethodDesc(method, params)
{
    this.method = method;
    this.params = params;
}

function DisplayListObj(renderContext)
{
    this.renderContext = renderContext;
    this.displayList = [];
}

DisplayListObj.prototype.record_begin = function()
{
    this.clear();
    this.renderContext.setDisplayList(this);
}

DisplayListObj.prototype.record_end = function()
{
    this.renderContext.setDisplayList(null);
}

DisplayListObj.prototype.play = function()
{
    for (var i = 0; i < this.displayList.length; i++)
    {
        this.invokeMethod(this.displayList[i]);
    }
}

DisplayListObj.prototype.addMethodDesc = function(desc)
{
    this.displayList.push(desc);
}

DisplayListObj.prototype.clear = function()
{
    this.displayList = [];
}

DisplayListObj.prototype.invokeMethod = function(desc)
{
    switch (desc.method)
    {
        case eRenderContextMethod.ApplyProjectionTransform:
            {
                this.renderContext.applyProjectionTransform();
            }
            break;

        case eRenderContextMethod.ApplyViewTransform:
            {
                this.renderContext.applyViewTransform();
            }
            break;
            
        case eRenderContextMethod.ApplyWorldTransform:
            {
                this.renderContext.applyWorldTransform();
            }
            break;
            
        case eRenderContextMethod.Clear:
            {
                return this.renderContext.clear(desc.params[0]);
            }
            break;

        case eRenderContextMethod.ClearColor:
            {
                this.renderContext.clearColor(desc.params[0], desc.params[1], desc.params[2], desc.params[3]);
            }
            break;

        case eRenderContextMethod.ClearDepth:
            {
                this.renderContext.clearDepth(desc.params[0]);
            }
            break;

        case eRenderContextMethod.ClearStencil:
            {
                this.renderContext.clearStencil(desc.params[0]);
            }
            break;

        case eRenderContextMethod.CreateProgram:
            {
                return this.renderContext.createProgram();
            }
            break;
            
        case eRenderContextMethod.CreateTextureObject:
            {
                return this.renderContext.createTextureObject();
            }
            break;
            
        case eRenderContextMethod.CreateVertexBuffer:
            {
                return this.renderContext.createVertexBuffer(desc.params[0]);
            }
            break;

        case eRenderContextMethod.CullFace:
            {
                return this.renderContext.cullFace(desc.params[0]);
            }
            break;
            
        case eRenderContextMethod.Disable:
            {
                this.renderContext.disable(desc.params[0]);
            }
            break;

        case eRenderContextMethod.Enable:
            {
                this.renderContext.enable(desc.params[0]);
            }
            break;

        case eRenderContextMethod.EnableClipPlane:
            {
                this.renderContext.enableClipPlane(desc.params[0], desc.params[1]);
            }
            break;

        case eRenderContextMethod.Enabled:
            {
                return this.renderContext.enabled(desc.params[0]);
            }
            break;

        case eRenderContextMethod.EnableLight:
            {
                this.renderContext.enableLight(desc.params[0], desc.params[1]);
            }
            break;

        case eRenderContextMethod.EnableTextureStage:
            {
                this.renderContext.enableTextureStage(desc.params[0], desc.params[1]);
            }
            break;

        case eRenderContextMethod.Finish:
            {
                this.renderContext.finish();
            }
            break;

        case eRenderContextMethod.GetClipPlane:
            {
                return this.renderContext.getClipPlane(desc.params[0]);
            }
            break;

        case eRenderContextMethod.GetEnabledClipPlanes:
            {
                return this.renderContext.getEnabledClipPlanes();
            }
            break;

        case eRenderContextMethod.GetEnabledLights:
            {
                return this.renderContext.getEnabledLights();
            }
            break;

        case eRenderContextMethod.GetGlobalIllumination:
            {
                return this.renderContext.getGlobalIllumination();
            }
            break;

        case eRenderContextMethod.GetLight:
            {
                return this.renderContext.getLight(desc.params[0]);
            }
            break;

        case eRenderContextMethod.GetMaxLightCount:
            {
                return this.renderContext.getMaxLightCount();
            }
            break;

        case eRenderContextMethod.GetMaxTextureStages:
            {
                return this.renderContext.getMaxTextureStages();
            }
            break;

        case eRenderContextMethod.GetProgram:
            {
                return this.renderContext.getProgram();
            }
            break;
            
        case eRenderContextMethod.PerspectiveMatrixLH:
            {
                this.renderContext.perspectiveMatrixLH(desc.params[0], desc.params[1], desc.params[2],
                        desc.params[3], desc.params[4], desc.params[5]);
            }
            break;

        case eRenderContextMethod.OrthographicMatrixLH:
            {
                this.renderContext.orthographicMatrixLH(desc.params[0], desc.params[1], desc.params[2],
                        desc.params[3], desc.params[4], desc.params[5]);
            }
            break;

        case eRenderContextMethod.SetBlendColor:
            {
                this.renderContext.setBlendColor(desc.params[0], desc.params[1], desc.params[2], desc.params[3]);
            }
            break;

        case eRenderContextMethod.SetBlendFactor:
            {
                this.renderContext.setBlendFactor(desc.params[0], desc.params[1]);
            }
            break;

        case eRenderContextMethod.SetClipPlane:
            {
                this.renderContext.setClipPlane(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetDepthFunc:
            {
                this.renderContext.setDepthFunc(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetEnabledClipPlanes:
            {
                this.renderContext.setEnabledClipPlanes(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetEnabledLights:
            {
                this.renderContext.setEnabledLights(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetFrontMaterial:
            {
                this.renderContext.setFrontMaterial(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetGlobalIllumination:
            {
                this.renderContext.setGlobalIllumination(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetLight:
            {
                this.renderContext.setLight(desc.params[0], desc.params[1]);
            }
            break;

        case eRenderContextMethod.SetModelID:
            {
                this.renderContext.setModelID(desc.params[0]);
            }
            break;
            
        case eRenderContextMethod.SetShadeModel:
            {
                this.renderContext.setShadeModel(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetStencilFunc:
            {
                this.renderContext.setStencilFunc(desc.params[0], desc.params[1], desc.params[2]);
            }
            break;

        case eRenderContextMethod.SetStencilMask:
            {
                this.renderContext.setStencilMask(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetStencilOp:
            {
                this.renderContext.setStencilOp(desc.params[0], desc.params[1], desc.params[2]);
            }
            break;

        case eRenderContextMethod.SetTextureBlendFactor:
            {
                this.renderContext.setTextureBlendFactor(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetTextureBlendOp:
            {
                this.renderContext.setTextureBlendOp(desc.params[0]);
            }
            break;

        case eRenderContextMethod.SetTextureColorMask:
            {
                this.renderContext.setTextureColorMask(desc.params[0], desc.params[1], desc.params[2], desc.params[3]);
            }
            break;

        case eRenderContextMethod.SetViewport:
            {
                this.renderContext.setViewport(desc.params[0], desc.params[1], desc.params[2],
                        desc.params[3]);
            }
            break;

        case eRenderContextMethod.VB_SetPrimitiveType:
            {
                desc.params[0].setPrimitiveType(desc.params[1]);
            }
            break;

        case eRenderContextMethod.VB_SetVertices:
            {
                desc.params[0].setVertices(desc.params[1]);
            }
            break;

        case eRenderContextMethod.VB_SetNormals:
            {
                desc.params[0].setNormals(desc.params[1]);
            }
            break;

        case eRenderContextMethod.VB_SetColors:
            {
                desc.params[0].setColors(desc.params[1]);
            }
            break;

        case eRenderContextMethod.VB_SetUVCoords:
            {
                desc.params[0].setUVCoords(desc.params[1], desc.params[2]);
            }
            break;

        case eRenderContextMethod.VB_SetTextureStage:
            {
                desc.params[0].setTextureStage(desc.params[1], desc.params[2], desc.params[3],
                        desc.params[4], desc.params[5], desc.params[6]);
            }
            break;

        case eRenderContextMethod.VB_Draw:
            {
                desc.params[0].draw();
            }
            break;

        case eRenderContextMethod.TO_SetImage:
            {
                desc.params[0].setImage(desc.params[1], desc.params[2], desc.params[3]);
            }
            break;

        case eRenderContextMethod.TO_SetImageData:
            {
                desc.params[0].setImageData(desc.params[1], desc.params[2], desc.params[3],
                        desc.params[4], desc.params[5]);
            }
            break;

        case eRenderContextMethod.TO_SetVideo:
            {
                desc.params[0].setVideo(desc.params[1]);
            }
            break;

        case eRenderContextMethod.SetMatrixMode:
            {
                this.renderContext.setMatrixMode(desc.params[0]);
            }
            break;

        case eRenderContextMethod.PushMatrix:
            {
                this.renderContext.pushMatrix();
            }
            break;

        case eRenderContextMethod.PopMatrix:
            {
                this.renderContext.popMatrix();
            }
            break;

        case eRenderContextMethod.LoadMatrix:
            {
                this.renderContext.loadMatrix(desc.params[0]);
            }
            break;

        case eRenderContextMethod.LeftMultMatrix:
            {
                this.renderContext.leftMultMatrix(desc.params[0]);
            }
            break;

        case eRenderContextMethod.RightMultMatrix:
            {
                this.renderContext.rightMultMatrix(desc.params[0]);
            }
            break;
            
        case eRenderContextMethod.UseProgram:
            {
                this.renderContext.useProgram(desc.params[0]);
            }
            break;
    }
}

function DL_ADD_METHOD_DESC(dlObj, method, params)
{
    if (dlObj)
    {
        dlObj.addMethodDesc(new RenderContextMethodDesc(method, params));
    }
}

/* 
 * enable caps 
 */
var eRenderMode =
{
    AlphaBlend              : 1,
    CullBackFace            : 2,
    DepthTest               : 3,
    DepthBufferWrite        : 4,
    Lighting                : 5,
    NormalizeNormals        : 6,
    Fog                     : 7,
    StencilTest             : 8,
    PolygonOffset_Fill      : 9,
    PolygonOffset_Line      : 10,
    PolygonOffset_Point     : 11
}
 
/*
 * depth func
 */
var eDepthFunc =
{
    Never                   : 1,
    Less                    : 2,
    LessEqual               : 3,
    Equal                   : 4,
    NotEqual                : 5,
    GreaterEqual            : 6,
    Greater                 : 7,
    Always                  : 8 
}

/*
 * stencil func
 */
var eStencilFunc =
{
    Never                   : 1,
    Less                    : 2,
    LessEqual               : 3,
    Equal                   : 4,
    NotEqual                : 5,
    GreaterEqual            : 6,
    Greater                 : 7,
    Always                  : 8 
}

/*
 * stencil op
 */
var eStencilOp = 
{
    Keep                    : 0,
    Replace                 : 1,
    Increment               : 2,
    Decrement               : 3,
    Invert                  : 4,
    Zero                    : 5    
}

/*
 * shade model
 */
var eShadeModel =
{
    Flat                    : 1,
    Gouraud                 : 2
}

var RC_BLEND            = 0x0001;
var RC_CULL_FACE        = 0x0B44;

var RC_FRONT            = 0x0010;
var RC_BACK             = 0x0020;

/*
 * light desc
 */
var LIGHTDESC_POSITION_BIT          = 0x001;
var LIGHTDESC_DIRECTION_BIT         = 0x002;
var LIGHTDESC_AMBIENT_BIT           = 0x004;
var LIGHTDESC_DIFFUSE_BIT           = 0x008;
var LIGHTDESC_SPECULAR_BIT          = 0x010;
var LIGHTDESC_CONSTANT_ATT_BIT      = 0x020;
var LIGHTDESC_LINEAR_ATT_BIT        = 0x040;
var LIGHTDESC_QUADRATIC_ATT_BIT     = 0x080;
var LIGHTDESC_RANGE_BIT             = 0x100;
var LIGHTDESC_OUTER_CONE_DEG_BIT    = 0x200;
var LIGHTDESC_INNER_CONE_DEG_BIT    = 0x400;
var LIGHTDESC_CONE_FALLOFF_BIT      = 0x800;

function LightDesc()
{
    this.type = "";                     // required: "directional", "point", "spot"
    this.validMembersMask = 0;
    this.position = new Vector3D();     // point, spot
    this.direction = new Vector3D();    // directional, spot
    this.ambient = new Color();         // all types
    this.diffuse = new Color();         // all types
    this.specular = new Color();        // all types
    this.constantAttenuation = 0;       // all types
    this.linearAttenuation = 0;         // all types
    this.quadraticAttenuation = 0;      // all types
    this.range = 0;                     // point, spot
    this.outerConeDegrees = 0;          // spot
    this.innerConeDegrees = 0;          // spot
    this.coneFalloff = 0;               // spot
}

/* 
 * material desc 
 */
var MATERIALDESC_AMBIENT_BIT        = 0x001;
var MATERIALDESC_DIFFUSE_BIT        = 0x002;
var MATERIALDESC_SPECULAR_BIT       = 0x004;
var MATERIALDESC_EMISSIVE_BIT       = 0x008;
var MATERIALDESC_GLOSSINESS_BIT     = 0x010;
var MATERIALDESC_ALL_BITS           = 0x01F;

function MaterialDesc()
{
    this.validMembersMask = 0;
    this.ambient = new Color();
    this.diffuse = new Color();
    this.specular = new Color();
    this.emissive = new Color();
    this.glossiness = 0;

    this.copy = function(materialDesc)
    {
        if (materialDesc)
        {
            this.validMembersMask = materialDesc.validMembersMask;
            this.ambient.copy(materialDesc.ambient);
            this.diffuse.copy(materialDesc.diffuse);
            this.specular.copy(materialDesc.specular);
            this.emissive.copy(materialDesc.emissive);
            this.glossiness = materialDesc.glossiness;
        }
    }
}

/*
 * clear mask
 */
var RC_COLOR_BUFFER_BIT             = 0x001;
var RC_DEPTH_BUFFER_BIT             = 0x002;
var RC_STENCIL_BUFFER_BIT           = 0x004;

/*
 * blend factor
 */
var RC_ZERO                         = 0x001;    
var RC_ONE                          = 0x002;
var RC_SRC_COLOR                    = 0x004;
var RC_SRC_ALPHA                    = 0x008;
var RC_ONE_MINUS_SRC_COLOR          = 0x010;
var RC_ONE_MINUS_SRC_ALPHA          = 0x020;
var RC_DEST_COLOR                   = 0x040;
var RC_DEST_ALPHA                   = 0x080;
var RC_ONE_MINUS_DEST_COLOR         = 0x100;
var RC_ONE_MINUS_DEST_ALPHA         = 0x200;

/*
 * blend op
 */
var RC_MODULATE                     = 0x001;
var RC_REPLACE                      = 0x002;
var RC_BLEND                        = 0x004;
var RC_DECAL                        = 0x008;

/*
 * texture unit
 */
var eTextureUnit =
{
    Color0                          : 0,
    Color1                          : 1,
    ShadowMap                       : 2
}

/*
 * texture coordinate source
 */
var eTextureCoordSrc = 
{
    VertexUVs                       : 1,
    ViewSpaceVertexPosition         : 2,
    ViewSpaceReflectionVector       : 3
}
 
/*
 * texture wrap
 */
var RC_REPEAT                      = 0x2901;
var RC_CLAMP_TO_EDGE               = 0x812F;
var RC_MIRRORED_REPEAT             = 0x8370;

/*
 * matrix mode
 */
var RC_WORLD			   = 0x001;
var RC_VIEW                        = 0x002;
var RC_PROJECTION		   = 0x004;
var RC_TEXTURE                     = 0x008;

/*
 * cube map face
 */
var eCubeMapFace =
{
    Positive_X                      : 0,
    Negative_X                      : 1,
    Positive_Y                      : 2,
    Negative_Y                      : 3,
    Positive_Z                      : 4,
    Negative_Z                      : 5
}

/*
 * render context
 */
function RenderContext(canvas, background)
{
    this.valid = false;
    
    this.canvas = canvas;
    this.background = background;
    
    this.projectionMatrixStack = new MatrixStack(new Matrix4x4());
    this.viewMatrixStack = new MatrixStack(new Matrix4x4());
    this.worldMatrixStack = new MatrixStack(new Matrix4x4());
    this.matrixMode = RC_WORLD;
    this.globalIllumination = new Color();
    this.frontMaterial = new MaterialDesc();
    
    this.displayListObj = null;
    
    this.getDisplayList = function()
    {
        return this.displayListObj;    
    }
    
    this.setDisplayList = function(displayListObj)
    {
        this.displayListObj = displayListObj;
    }
    
    this.getFrontMaterial = function()
    {
        var material = new MaterialDesc();
        material.copy(this.frontMaterial); 
        return material;             
    }

    this.setBackgroundImage = function(url, width, height)
    {
        if (this.background)
        {
            this.background.src = url;
            this.background.width = width;
            this.background.height = height;
        }
    }
    
    this.setMatrixMode = function(mode) 
    { 
    	if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetMatrixMode, [mode]);
    	
    	this.matrixMode = mode; 
    }
    
    this.pushMatrix = function()
    {
    	if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.PushMatrix, null);
    	
    	switch (this.matrixMode)
    	{
            case RC_WORLD:
            {
                this.worldMatrixStack.push();
            }
            break;

            case RC_VIEW:
            {
                this.viewMatrixStack.push();
            }
            break;

            case RC_PROJECTION:
            {
                this.projectionMatrixStack.push();
            }
            break;
    	}	
    }
    
    this.popMatrix = function()
    {
    	if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.PopMatrix, null);
    	
    	switch (this.matrixMode)
    	{
            case RC_WORLD:
            {
                this.worldMatrixStack.pop();
            }
            break;

            case RC_VIEW:
            {
                this.viewMatrixStack.pop();
            }
            break;

            case RC_PROJECTION:
            {
                this.projectionMatrixStack.pop();
            }
            break;
    	}
    }
    
    this.loadMatrix = function(matrix)
    {
    	if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.LoadMatrix, [matrix]);
    	
    	switch (this.matrixMode)
    	{
            case RC_WORLD:
            {
                this.worldMatrixStack.loadMatrix(matrix);
            }
            break;

            case RC_VIEW:
            {
                this.viewMatrixStack.loadMatrix(matrix);
            }
            break;

            case RC_PROJECTION:
            {
                this.projectionMatrixStack.loadMatrix(matrix);
            }
            break;
    	}	
    }
    
    this.leftMultMatrix = function(matrix)
    {
    	if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.LeftMultMatrix, [matrix]);
    	
    	switch (this.matrixMode)
    	{
            case RC_WORLD:
            {
                this.worldMatrixStack.leftMultiply(matrix);
            }
            break;

            case RC_VIEW:
            {
                this.viewMatrixStack.leftMultiply(matrix);
            }
            break;

            case RC_PROJECTION:
            {
                this.projectionMatrixStack.leftMultiply(matrix);
            }
            break;
    	}
    }
    
    this.rightMultMatrix = function(matrix)
    {
    	if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.RightMultMatrix, [matrix]);
    	
    	switch (this.matrixMode)
    	{
            case RC_WORLD:
            {
                this.worldMatrixStack.rightMultiply(matrix);
            }
            break;

            case RC_VIEW:
            {
                this.viewMatrixStack.rightMultiply(matrix);
            }
            break;

            case RC_PROJECTION:
            {
                this.projectionMatrixStack.rightMultiply(matrix);
            }
            break;
    	}	
    }
    
    this.setEnabled = function(cap, enabled)
    {
        if (enabled)
        {
            this.enable(cap);    
        }
        else
        {
            this.disable(cap);
        }
    }
}

function newRenderContext(api, canvas, background)
{
    var rc = null;
    
    switch (api)
    {
    case "webgl":
        {
            rc = new webglRC(canvas, background);
            // load default program
            if (rc.valid)
            {
                var program = rc.createProgram(default_vertex_lighting_vs, default_vertex_lighting_fs);
                rc.useProgram(program);
            }
        }
        break;
    }

    // return rc if valid    
    return rc.valid ? rc : null;
}

var RENDERSTATE_TRANSFORM_BIT      = 0x001;
var RENDERSTATE_LIGHTING_BIT       = 0x002;
var RENDERSTATE_MATERIAL_BIT       = 0x004;
var RENDERSTATE_FOG_BIT            = 0x008;
var RENDERSTATE_CLIP_PLANE_BIT     = 0x010;
var RENDERSTATE_ZBUFFER_BIT        = 0x020;
var RENDERSTATE_ALL_BITS           = 0x03F;

function RenderStateRec()
{
    this.projMatrix = new Matrix4x4();
    this.viewMatrix = new Matrix4x4();
    this.worldViewMatrix = new Matrix4x4();
    // TODO: textureMatrices
    this.lightIndices = [];
    this.lightStates = [];
    this.lightMatrices = [];
    this.lightingEnabled = false;
    this.materialDesc = new MaterialDesc();
    // TODO: fogParams
    this.fogEnabled = false;
    this.clipPlaneIndices = [];
    this.clipPlanes = [];
    this.clipPlaneMatrices = [];
    this.zBufferEnabled = false;
    this.zBufferWriteEnabled = false;
}

function RenderState(rc)
{
    this.renderContext = rc;

    this.stateStack = new Stack();
    
    this.push = function(mask)
    {
        var rec = this.getState(mask);
        this.stateStack.push(rec);
    }

    this.pop = function(mask)
    {
        if (this.stateStack.empty()) return;

        var rec = this.stateStack.top();
        this.setState(mask, rec);
        this.stateStack.pop();
    }

    this.getState = function(mask)
    {
        var rec = new RenderStateRec();

        if (mask & RENDERSTATE_TRANSFORM_BIT)
        {
            rec.projMatrix = this.renderContext.projectionMatrixStack.top();
            rec.viewMatrix = this.renderContext.viewMatrixStack.top();
            rec.worldViewMatrix = this.renderContext.worldMatrixStack.top();
        }

        if (mask & RENDERSTATE_LIGHTING_BIT)
        {
            rec.lightIndices = this.renderContext.getEnabledLights();
            for (var i = 0; i < rec.lightIndices.length; i++)
            {
                var light = this.renderContext.getLight(rec.lightIndices[i]);
                rec.lightStates[i] = light.desc;
                rec.lightMatrices[i] = light.matrix;
            }
            rec.lightingEnabled = this.renderContext.enabled(eRenderMode.Lighting);
        }

        if (mask & RENDERSTATE_MATERIAL_BIT)
        {
            rec.materialDesc = this.renderContext.getFrontMaterial();
        }

        if (mask & RENDERSTATE_FOG_BIT)
        {
        }

        if (mask & RENDERSTATE_CLIP_PLANE_BIT)
        {
        }

        if (mask & RENDERSTATE_ZBUFFER_BIT)
        {
            rec.zBufferEnabled = this.renderContext.enabled(eRenderMode.DepthTest);
            rec.zBufferWriteEnabled = this.renderContext.enabled(eRenderMode.DepthBufferWrite);
        }

        return rec;
    }

    this.setState = function(mask, rec)
    {
        if (mask & RENDERSTATE_TRANSFORM_BIT)
        {
            this.renderContext.projectionMatrixStack.loadMatrix(rec.projMatrix);
            this.renderContext.applyProjectionTransform();
            this.renderContext.viewMatrixStack.loadMatrix(rec.viewMatrix);
            this.renderContext.applyViewTransform();
            this.renderContext.worldMatrixStack.loadMatrix(rec.worldViewMatrix);
            this.renderContext.applyWorldTransform();
        }

        if (mask & RENDERSTATE_LIGHTING_BIT)
        {
            // set light state for each set light within this state block
            for (var i = 0; i < rec.lightIndices.length; i++)
            {
                this.renderContext.worldMatrixStack.push(rec.lightMatrices[i]);
                this.renderContext.setLight(rec.lightIndices[i], rec.lightStates[i]);
                this.renderContext.worldMatrixStack.pop();
            }

            // set light state to disabled for lights set outside this state block
            this.renderContext.setEnabledLights(rec.lightIndices);

            // set current lighting enabled
            if (rec.lightingEnabled)
            {
                this.renderContext.enable(eRenderMode.Lighting);
            }
            else
            {
                this.renderContext.disable(eRenderMode.Lighting);
            }
        }

        if (mask & RENDERSTATE_MATERIAL_BIT)
        {
            this.renderContext.setFrontMaterial(rec.materialDesc);
        }

        if (mask & RENDERSTATE_FOG_BIT)
        {
        }

        if (mask & RENDERSTATE_CLIP_PLANE_BIT)
        {
        }

        if (mask & RENDERSTATE_ZBUFFER_BIT)
        {
            if (rec.zBufferEnabled)
            {
                this.renderContext.enable(eRenderMode.DepthTest);
            }
            else
            {
                this.renderContext.disable(eRenderMode.depthTest);
            }

            if (rec.zBufferWriteEnabled)
            {
                this.renderContext.enable(eRenderMode.DepthBufferWrite);
            }
            else
            {
                this.renderContext.disable(eRenderMode.DepthBufferWrite);
            }
        }
    }
}
var RC_POINTS                       = 0x0000;
var RC_LINES                        = 0x0001;
var RC_LINE_LOOP                    = 0x0002;
var RC_LINE_STRIP                   = 0x0003;
var RC_TRIANGLES                    = 0x0004;
var RC_TRIANGLE_STRIP               = 0x0005;
var RC_TRIANGLE_FAN                 = 0x0006;
    
function VertexBuffer()
{
    this.vertices = new Array();
    this.normals = new Array();
    this.colors = new Array();
    this.vertexCount = 0;
    this.numVerticesPerPrimitive = 0;
}
function TextureObject()
{
}
//Copyright (c) 2009 The Chromium Authors. All rights reserved.
//Use of this source code is governed by a BSD-style license that can be
//found in the LICENSE file.

// Various functions for helping debug WebGL apps.

WebGLDebugUtils = function() {

/**
 * Wrapped logging function.
 * @param {string} msg Message to log.
 */
var log = function(msg) {
  if (window.console && window.console.log) {
    window.console.log(msg);
  }
};

/**
 * Which arguements are enums.
 * @type {!Object.<number, string>}
 */
var glValidEnumContexts = {

  // Generic setters and getters

  'enable': { 0:true },
  'disable': { 0:true },
  'getParameter': { 0:true },

  // Rendering

  'drawArrays': { 0:true },
  'drawElements': { 0:true, 2:true },

  // Shaders

  'createShader': { 0:true },
  'getShaderParameter': { 1:true },
  'getProgramParameter': { 1:true },

  // Vertex attributes

  'getVertexAttrib': { 1:true },
  'vertexAttribPointer': { 2:true },

  // Textures

  'bindTexture': { 0:true },
  'activeTexture': { 0:true },
  'getTexParameter': { 0:true, 1:true },
  'texParameterf': { 0:true, 1:true },
  'texParameteri': { 0:true, 1:true, 2:true },
  'texImage2D': { 0:true, 2:true, 6:true, 7:true },
  'texSubImage2D': { 0:true, 6:true, 7:true },
  'copyTexImage2D': { 0:true, 2:true },
  'copyTexSubImage2D': { 0:true },
  'generateMipmap': { 0:true },

  // Buffer objects

  'bindBuffer': { 0:true },
  'bufferData': { 0:true, 2:true },
  'bufferSubData': { 0:true },
  'getBufferParameter': { 0:true, 1:true },

  // Renderbuffers and framebuffers

  'pixelStorei': { 0:true, 1:true },
  'readPixels': { 4:true, 5:true },
  'bindRenderbuffer': { 0:true },
  'bindFramebuffer': { 0:true },
  'checkFramebufferStatus': { 0:true },
  'framebufferRenderbuffer': { 0:true, 1:true, 2:true },
  'framebufferTexture2D': { 0:true, 1:true, 2:true },
  'getFramebufferAttachmentParameter': { 0:true, 1:true, 2:true },
  'getRenderbufferParameter': { 0:true, 1:true },
  'renderbufferStorage': { 0:true, 1:true },

  // Frame buffer operations (clear, blend, depth test, stencil)

  'clear': { 0:true },
  'depthFunc': { 0:true },
  'blendFunc': { 0:true, 1:true },
  'blendFuncSeparate': { 0:true, 1:true, 2:true, 3:true },
  'blendEquation': { 0:true },
  'blendEquationSeparate': { 0:true, 1:true },
  'stencilFunc': { 0:true },
  'stencilFuncSeparate': { 0:true, 1:true },
  'stencilMaskSeparate': { 0:true },
  'stencilOp': { 0:true, 1:true, 2:true },
  'stencilOpSeparate': { 0:true, 1:true, 2:true, 3:true },

  // Culling

  'cullFace': { 0:true },
  'frontFace': { 0:true },
};

/**
 * Map of numbers to names.
 * @type {Object}
 */
var glEnums = null;

/**
 * Initializes this module. Safe to call more than once.
 * @param {!WebGLRenderingContext} ctx A WebGL context. If
 *    you have more than one context it doesn't matter which one
 *    you pass in, it is only used to pull out constants.
 */
function init(ctx) {
  if (glEnums == null) {
    glEnums = { };
    for (var propertyName in ctx) {
      if (typeof ctx[propertyName] == 'number') {
        glEnums[ctx[propertyName]] = propertyName;
      }
    }
  }
}

/**
 * Checks the utils have been initialized.
 */
function checkInit() {
  if (glEnums == null) {
    throw 'WebGLDebugUtils.init(ctx) not called';
  }
}

/**
 * Returns true or false if value matches any WebGL enum
 * @param {*} value Value to check if it might be an enum.
 * @return {boolean} True if value matches one of the WebGL defined enums
 */
function mightBeEnum(value) {
  checkInit();
  return (glEnums[value] !== undefined);
}

/**
 * Gets an string version of an WebGL enum.
 *
 * Example:
 *   var str = WebGLDebugUtil.glEnumToString(ctx.getError());
 *
 * @param {number} value Value to return an enum for
 * @return {string} The string version of the enum.
 */
function glEnumToString(value) {
  checkInit();
  var name = glEnums[value];
  return (name !== undefined) ? name :
      ("*UNKNOWN WebGL ENUM");// (0x" + value.toString(16) + ")");
}

/**
 * Returns the string version of a WebGL argument.
 * Attempts to convert enum arguments to strings.
 * @param {string} functionName the name of the WebGL function.
 * @param {number} argumentIndx the index of the argument.
 * @param {*} value The value of the argument.
 * @return {string} The value as a string.
 */ 
function glFunctionArgToString(functionName, argumentIndex, value) {
  var funcInfo = glValidEnumContexts[functionName];
  if (funcInfo !== undefined) {
    if (funcInfo[argumentIndex]) {
      return glEnumToString(value);
    }
  }
  return value.toString();
}

/**
 * Given a WebGL context returns a wrapped context that calls
 * gl.getError after every command and calls a function if the
 * result is not gl.NO_ERROR.
 *
 * @param {!WebGLRenderingContext} ctx The webgl context to
 *        wrap.
 * @param {!function(err, funcName, args): void} opt_onErrorFunc
 *        The function to call when gl.getError returns an
 *        error. If not specified the default function calls
 *        console.log with a message.
 */
function makeDebugContext(ctx, opt_onErrorFunc) {
  init(ctx);
  opt_onErrorFunc = opt_onErrorFunc || function(err, functionName, args) {
        // apparently we can't do args.join(",");
        var argStr = "";
        for (var ii = 0; ii < args.length; ++ii) {
          argStr += ((ii == 0) ? '' : ', ') + 
              glFunctionArgToString(functionName, ii, args[ii]);
        }
        log("WebGL error "+ glEnumToString(err) + " in "+ functionName +
            "(" + argStr + ")");
      };

  // Holds booleans for each GL error so after we get the error ourselves
  // we can still return it to the client app.
  var glErrorShadow = { };

  // Makes a function that calls a WebGL function and then calls getError.
  function makeErrorWrapper(ctx, functionName) {
    return function() {
      var result = ctx[functionName].apply(ctx, arguments);
      var err = ctx.getError();
      if (err != 0) {
        glErrorShadow[err] = true;
        opt_onErrorFunc(err, functionName, arguments);
      }
      return result;
    };
  }

  // Make a an object that has a copy of every property of the WebGL context
  // but wraps all functions.
  var wrapper = {};
  for (var propertyName in ctx) {
    if (typeof ctx[propertyName] == 'function') {
      wrapper[propertyName] = makeErrorWrapper(ctx, propertyName);
     } else {
       wrapper[propertyName] = ctx[propertyName];
     }
  }

  // Override the getError function with one that returns our saved results.
  wrapper.getError = function() {
    for (var err in glErrorShadow) {
      if (glErrorShadow[err]) {
        glErrorShadow[err] = false;
        return err;
      }
    }
    return ctx.NO_ERROR;
  };

  return wrapper;
}

return {
  /**
   * Initializes this module. Safe to call more than once.
   * @param {!WebGLRenderingContext} ctx A WebGL context. If
   *    you have more than one context it doesn't matter which one
   *    you pass in, it is only used to pull out constants.
   */
  'init': init,

  /**
   * Returns true or false if value matches any WebGL enum
   * @param {*} value Value to check if it might be an enum.
   * @return {boolean} True if value matches one of the WebGL defined enums
   */
  'mightBeEnum': mightBeEnum,

  /**
   * Gets an string version of an WebGL enum.
   *
   * Example:
   *   WebGLDebugUtil.init(ctx);
   *   var str = WebGLDebugUtil.glEnumToString(ctx.getError());
   *
   * @param {number} value Value to return an enum for
   * @return {string} The string version of the enum.
   */
  'glEnumToString': glEnumToString,

  /**
   * Converts the argument of a WebGL function to a string.
   * Attempts to convert enum arguments to strings.
   *
   * Example:
   *   WebGLDebugUtil.init(ctx);
   *   var str = WebGLDebugUtil.glFunctionArgToString('bindTexture', 0, gl.TEXTURE_2D);
   *   
   * would return 'TEXTURE_2D'
   *
   * @param {string} functionName the name of the WebGL function.
   * @param {number} argumentIndx the index of the argument.
   * @param {*} value The value of the argument.
   * @return {string} The value as a string.
   */
  'glFunctionArgToString': glFunctionArgToString,

  /**
   * Given a WebGL context returns a wrapped context that calls
   * gl.getError after every command and calls a function if the
   * result is not NO_ERROR.
   *
   * You can supply your own function if you want. For example, if you'd like
   * an exception thrown on any GL error you could do this
   *
   *    function throwOnGLError(err, funcName, args) {
   *      throw WebGLDebugUtils.glEnumToString(err) + " was caused by call to" +
   *            funcName;
   *    };
   *
   *    ctx = WebGLDebugUtils.makeDebugContext(
   *        canvas.getContext("webgl"), throwOnGLError);
   *
   * @param {!WebGLRenderingContext} ctx The webgl context to wrap.
   * @param {!function(err, funcName, args): void} opt_onErrorFunc The function
   *     to call when gl.getError returns an error. If not specified the default
   *     function calls console.log with a message.
   */
  'makeDebugContext': makeDebugContext
};

}();


(function() {
  var checkColorBuffer, checkFloatLinear, checkSupport, checkTexture, createSourceCanvas, getExtension, getSupportedExtensions, name, shimExtensions, shimLookup, unshimExtensions, unshimLookup, _i, _len,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  createSourceCanvas = function() {
    var canvas, ctx, imageData;
    canvas = document.createElement('canvas');
    canvas.width = 2;
    canvas.height = 2;
    ctx = canvas.getContext('2d');
    imageData = ctx.getImageData(0, 0, 2, 2);
    imageData.data.set(new Uint8ClampedArray([0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 255, 255, 255, 255]));
    ctx.putImageData(imageData, 0, 0);
    return canvas;
  };

  createSourceCanvas();

  checkFloatLinear = function(gl, sourceType) {
    var buffer, cleanup, fragmentShader, framebuffer, positionLoc, program, readBuffer, result, source, sourceCanvas, sourceLoc, target, vertexShader, vertices;
    program = gl.createProgram();
    vertexShader = gl.createShader(gl.VERTEX_SHADER);
    gl.attachShader(program, vertexShader);
    gl.shaderSource(vertexShader, 'attribute vec2 position;\nvoid main(){\n    gl_Position = vec4(position, 0.0, 1.0);\n}');
    gl.compileShader(vertexShader);
    if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {
      throw gl.getShaderInfoLog(vertexShader);
    }
    fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
    gl.attachShader(program, fragmentShader);
    gl.shaderSource(fragmentShader, 'uniform sampler2D source;\nvoid main(){\n    gl_FragColor = texture2D(source, vec2(1.0, 1.0));\n}');
    gl.compileShader(fragmentShader);
    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {
      throw gl.getShaderInfoLog(fragmentShader);
    }
    gl.linkProgram(program);
    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
      throw gl.getProgramInfoLog(program);
    }
    gl.useProgram(program);
    cleanup = function() {
      gl.deleteShader(fragmentShader);
      gl.deleteShader(vertexShader);
      gl.deleteProgram(program);
      gl.deleteBuffer(buffer);
      gl.deleteTexture(source);
      gl.deleteTexture(target);
      gl.deleteFramebuffer(framebuffer);
      gl.bindBuffer(gl.ARRAY_BUFFER, null);
      gl.useProgram(null);
      gl.bindTexture(gl.TEXTURE_2D, null);
      return gl.bindFramebuffer(gl.FRAMEBUFFER, null);
    };
    target = gl.createTexture();
    gl.bindTexture(gl.TEXTURE_2D, target);
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 2, 2, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
    framebuffer = gl.createFramebuffer();
    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);
    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, target, 0);
    sourceCanvas = createSourceCanvas();
    source = gl.createTexture();
    gl.bindTexture(gl.TEXTURE_2D, source);
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, sourceType, sourceCanvas);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
    vertices = new Float32Array([1, 1, -1, 1, -1, -1, 1, 1, -1, -1, 1, -1]);
    buffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
    positionLoc = gl.getAttribLocation(program, 'position');
    sourceLoc = gl.getUniformLocation(program, 'source');
    gl.enableVertexAttribArray(positionLoc);
    gl.vertexAttribPointer(positionLoc, 2, gl.FLOAT, false, 0, 0);
    gl.uniform1i(sourceLoc, 0);
    gl.drawArrays(gl.TRIANGLES, 0, 6);
    readBuffer = new Uint8Array(4 * 4);
    gl.readPixels(0, 0, 2, 2, gl.RGBA, gl.UNSIGNED_BYTE, readBuffer);
    result = Math.abs(readBuffer[0] - 127) < 10;
    cleanup();
    return result;
  };

  checkTexture = function(gl, targetType) {
    var target;
    target = gl.createTexture();
    gl.bindTexture(gl.TEXTURE_2D, target);
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 2, 2, 0, gl.RGBA, targetType, null);
    if (gl.getError() === 0) {
      gl.deleteTexture(target);
      return true;
    } else {
      gl.deleteTexture(target);
      return false;
    }
  };

  checkColorBuffer = function(gl, targetType) {
    var check, framebuffer, target;
    target = gl.createTexture();
    gl.bindTexture(gl.TEXTURE_2D, target);
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 2, 2, 0, gl.RGBA, targetType, null);
    framebuffer = gl.createFramebuffer();
    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);
    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, target, 0);
    check = gl.checkFramebufferStatus(gl.FRAMEBUFFER);
    gl.deleteTexture(target);
    gl.deleteFramebuffer(framebuffer);
    gl.bindTexture(gl.TEXTURE_2D, null);
    gl.bindFramebuffer(gl.FRAMEBUFFER, null);
    if (check === gl.FRAMEBUFFER_COMPLETE) {
      return true;
    } else {
      return false;
    }
  };

  shimExtensions = [];

  shimLookup = {};

  unshimExtensions = [];

  checkSupport = function() {
    var canvas, extobj, gl, halfFloatExt, halfFloatTexturing, singleFloatExt, singleFloatTexturing;
    canvas = document.createElement('canvas');
    gl = null;
    try {
      gl = canvas.getContext('experimental-webgl');
      if (gl === null) {
        gl = canvas.getContext('webgl');
      }
    } catch (_error) {}
    if (gl != null) {
      singleFloatExt = gl.getExtension('OES_texture_float');
      if (singleFloatExt === null) {
        if (checkTexture(gl, gl.FLOAT)) {
          singleFloatTexturing = true;
          shimExtensions.push('OES_texture_float');
          shimLookup.OES_texture_float = {
            shim: true
          };
        } else {
          singleFloatTexturing = false;
          unshimExtensions.push('OES_texture_float');
        }
      } else {
        if (checkTexture(gl, gl.FLOAT)) {
          singleFloatTexturing = true;
          shimExtensions.push('OES_texture_float');
        } else {
          singleFloatTexturing = false;
          unshimExtensions.push('OES_texture_float');
        }
      }
      if (singleFloatTexturing) {
        extobj = gl.getExtension('WEBGL_color_buffer_float');
        if (extobj === null) {
          if (checkColorBuffer(gl, gl.FLOAT)) {
            shimExtensions.push('WEBGL_color_buffer_float');
            shimLookup.WEBGL_color_buffer_float = {
              shim: true,
              RGBA32F_EXT: 0x8814,
              RGB32F_EXT: 0x8815,
              FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT: 0x8211,
              UNSIGNED_NORMALIZED_EXT: 0x8C17
            };
          } else {
            unshimExtensions.push('WEBGL_color_buffer_float');
          }
        } else {
          if (checkColorBuffer(gl, gl.FLOAT)) {
            shimExtensions.push('WEBGL_color_buffer_float');
          } else {
            unshimExtensions.push('WEBGL_color_buffer_float');
          }
        }
        extobj = gl.getExtension('OES_texture_float_linear');
        if (extobj === null) {
          if (checkFloatLinear(gl, gl.FLOAT)) {
            shimExtensions.push('OES_texture_float_linear');
            shimLookup.OES_texture_float_linear = {
              shim: true
            };
          } else {
            unshimExtensions.push('OES_texture_float_linear');
          }
        } else {
          if (checkFloatLinear(gl, gl.FLOAT)) {
            shimExtensions.push('OES_texture_float_linear');
          } else {
            unshimExtensions.push('OES_texture_float_linear');
          }
        }
      }
      halfFloatExt = gl.getExtension('OES_texture_half_float');
      if (halfFloatExt === null) {
        if (checkTexture(gl, 0x8D61)) {
          halfFloatTexturing = true;
          shimExtensions.push('OES_texture_half_float');
          halfFloatExt = shimLookup.OES_texture_half_float = {
            HALF_FLOAT_OES: 0x8D61,
            shim: true
          };
        } else {
          halfFloatTexturing = false;
          unshimExtensions.push('OES_texture_half_float');
        }
      } else {
        if (checkTexture(gl, halfFloatExt.HALF_FLOAT_OES)) {
          halfFloatTexturing = true;
          shimExtensions.push('OES_texture_half_float');
        } else {
          halfFloatTexturing = false;
          unshimExtensions.push('OES_texture_half_float');
        }
      }
      if (halfFloatTexturing) {
        extobj = gl.getExtension('EXT_color_buffer_half_float');
        if (extobj === null) {
          if (checkColorBuffer(gl, halfFloatExt.HALF_FLOAT_OES)) {
            shimExtensions.push('EXT_color_buffer_half_float');
            shimLookup.EXT_color_buffer_half_float = {
              shim: true,
              RGBA16F_EXT: 0x881A,
              RGB16F_EXT: 0x881B,
              FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT: 0x8211,
              UNSIGNED_NORMALIZED_EXT: 0x8C17
            };
          } else {
            unshimExtensions.push('EXT_color_buffer_half_float');
          }
        } else {
          if (checkColorBuffer(gl, halfFloatExt.HALF_FLOAT_OES)) {
            shimExtensions.push('EXT_color_buffer_half_float');
          } else {
            unshimExtensions.push('EXT_color_buffer_half_float');
          }
        }
        extobj = gl.getExtension('OES_texture_half_float_linear');
        if (extobj === null) {
          if (checkFloatLinear(gl, halfFloatExt.HALF_FLOAT_OES)) {
            shimExtensions.push('OES_texture_half_float_linear');
            return shimLookup.OES_texture_half_float_linear = {
              shim: true
            };
          } else {
            return unshimExtensions.push('OES_texture_half_float_linear');
          }
        } else {
          if (checkFloatLinear(gl, halfFloatExt.HALF_FLOAT_OES)) {
            return shimExtensions.push('OES_texture_half_float_linear');
          } else {
            return unshimExtensions.push('OES_texture_half_float_linear');
          }
        }
      }
    }
  };

  if (window.WebGLRenderingContext != null) {
    checkSupport();
    unshimLookup = {};
    for (_i = 0, _len = unshimExtensions.length; _i < _len; _i++) {
      name = unshimExtensions[_i];
      unshimLookup[name] = true;
    }
    getExtension = WebGLRenderingContext.prototype.getExtension;
    WebGLRenderingContext.prototype.getExtension = function(name) {
      var extobj;
      extobj = shimLookup[name];
      if (extobj === void 0) {
        if (unshimLookup[name]) {
          return null;
        } else {
          return getExtension.call(this, name);
        }
      } else {
        return extobj;
      }
    };
    getSupportedExtensions = WebGLRenderingContext.prototype.getSupportedExtensions;
    WebGLRenderingContext.prototype.getSupportedExtensions = function() {
      var extension, result, supported, _j, _k, _len1, _len2;
      supported = getSupportedExtensions.call(this);
      result = [];
      for (_j = 0, _len1 = supported.length; _j < _len1; _j++) {
        extension = supported[_j];
        if (unshimLookup[extension] === void 0) {
          result.push(extension);
        }
      }
      for (_k = 0, _len2 = shimExtensions.length; _k < _len2; _k++) {
        extension = shimExtensions[_k];
        if (__indexOf.call(result, extension) < 0) {
          result.push(extension);
        }
      }
      return result;
    };
    WebGLRenderingContext.prototype.getFloatExtension = function(spec) {
      var candidate, candidates, half, halfFramebuffer, halfLinear, halfTexture, i, importance, preference, result, single, singleFramebuffer, singleLinear, singleTexture, use, _j, _k, _l, _len1, _len2, _len3, _len4, _m, _ref, _ref1, _ref2, _ref3, _ref4, _ref5;
      if ((_ref = spec.prefer) == null) {
        spec.prefer = ['half'];
      }
      if ((_ref1 = spec.require) == null) {
        spec.require = [];
      }
      if ((_ref2 = spec.throws) == null) {
        spec.throws = true;
      }
      singleTexture = this.getExtension('OES_texture_float');
      halfTexture = this.getExtension('OES_texture_half_float');
      singleFramebuffer = this.getExtension('WEBGL_color_buffer_float');
      halfFramebuffer = this.getExtension('EXT_color_buffer_half_float');
      singleLinear = this.getExtension('OES_texture_float_linear');
      halfLinear = this.getExtension('OES_texture_half_float_linear');
      single = {
        texture: singleTexture !== null,
        filterable: singleLinear !== null,
        renderable: singleFramebuffer !== null,
        score: 0,
        precision: 'single',
        half: false,
        single: true,
        type: this.FLOAT
      };
      half = {
        texture: halfTexture !== null,
        filterable: halfLinear !== null,
        renderable: halfFramebuffer !== null,
        score: 0,
        precision: 'half',
        half: true,
        single: false,
        type: (_ref3 = halfTexture != null ? halfTexture.HALF_FLOAT_OES : void 0) != null ? _ref3 : null
      };
      candidates = [];
      if (single.texture) {
        candidates.push(single);
      }
      if (half.texture) {
        candidates.push(half);
      }
      result = [];
      for (_j = 0, _len1 = candidates.length; _j < _len1; _j++) {
        candidate = candidates[_j];
        use = true;
        _ref4 = spec.require;
        for (_k = 0, _len2 = _ref4.length; _k < _len2; _k++) {
          name = _ref4[_k];
          if (candidate[name] === false) {
            use = false;
          }
        }
        if (use) {
          result.push(candidate);
        }
      }
      for (_l = 0, _len3 = result.length; _l < _len3; _l++) {
        candidate = result[_l];
        _ref5 = spec.prefer;
        for (i = _m = 0, _len4 = _ref5.length; _m < _len4; i = ++_m) {
          preference = _ref5[i];
          importance = Math.pow(2, spec.prefer.length - i - 1);
          if (candidate[preference]) {
            candidate.score += importance;
          }
        }
      }
      result.sort(function(a, b) {
        if (a.score === b.score) {
          return 0;
        } else if (a.score < b.score) {
          return 1;
        } else if (a.score > b.score) {
          return -1;
        }
      });
      if (result.length === 0) {
        if (spec.throws) {
          throw 'No floating point texture support that is ' + spec.require.join(', ');
        } else {
          return null;
        }
      } else {
        result = result[0];
        return {
          filterable: result.filterable,
          renderable: result.renderable,
          type: result.type,
          precision: result.precision
        };
      }
    };
  }

}).call(this);

function webglProgram(rc, gl, source_vs, source_fs)
{
    var rc = rc;
    var gl = gl;

    // create vertex shader
    var vs = gl.createShader(gl.VERTEX_SHADER);
    if (vs)
    {
        gl.shaderSource(vs, source_vs);
        gl.compileShader(vs);

        if (!gl.getShaderParameter(vs, gl.COMPILE_STATUS))
        {
            alert(gl.getShaderInfoLog(vs));
            return;
        }
    }

    // create fragment shader
    var fs = gl.createShader(gl.FRAGMENT_SHADER);
    if (fs)
    {
        gl.shaderSource(fs, source_fs);
        gl.compileShader(fs);
        if (!gl.getShaderParameter(fs, gl.COMPILE_STATUS))
        {
            alert(gl.getShaderInfoLog(fs));
            return;
        }
    }

    // create program
    var program = gl.createProgram();
    if (!program)
        return;

    gl.attachShader(program, vs);
    gl.attachShader(program, fs);
    gl.linkProgram(program);

    if (!gl.getProgramParameter(program, gl.LINK_STATUS))
    {
        alert(gl.getProgramInfoLog(program));
        return;
    }
    
    gl.useProgram(program);

    // get attributes
    var _attributeCount = 0;
    this.vertexPositionAttribute = gl.getAttribLocation(program, "aVertexPosition");
    if (this.vertexPositionAttribute >= 0) _attributeCount++;
    this.vertexNormalAttribute = gl.getAttribLocation(program, "aVertexNormal");
    if (this.vertexNormalAttribute >= 0) _attributeCount++;
    this.vertexColorAttribute = gl.getAttribLocation(program, "aVertexColor");
    if (this.vertexColorAttribute >= 0) _attributeCount++;
    this.textureCoordAttribute = new Array(gl_MaxTextureStages);
    for (var i = 0; i < gl_MaxTextureStages; i++)
    {
        this.textureCoordAttribute[i] = gl.getAttribLocation(program, "aTextureCoord" + i);
        if (this.textureCoordAttribute[i] >= 0) _attributeCount++;
    }

    // get uniforms

    // matrices
    this.projectionMatrix = gl.getUniformLocation(program, "uProjectionMatrix");
    this.viewMatrix = gl.getUniformLocation(program, "uViewMatrix");
    this.worldMatrix = gl.getUniformLocation(program, "uWorldMatrix");
    this.normalMatrix = gl.getUniformLocation(program, "uNormalMatrix");

    // lights
    this.globalAmbientLight = gl.getUniformLocation(program, "uGlobalAmbientLight");
    this.lightSource = new Array(gl_MaxLights);
    for (var i = 0; i < gl_MaxLights; i++)
    {
        this.lightSource[i] = new gl_LightSourceParameters();

        this.lightSource[i].enabled = gl.getUniformLocation(program, "uLightSource[" + i + "].enabled");
        this.lightSource[i].ambient = gl.getUniformLocation(program, "uLightSource[" + i + "].ambient");
        this.lightSource[i].diffuse = gl.getUniformLocation(program, "uLightSource[" + i + "].diffuse");
        this.lightSource[i].specular = gl.getUniformLocation(program, "uLightSource[" + i + "].specular");
        this.lightSource[i].position = gl.getUniformLocation(program, "uLightSource[" + i + "].position");
        this.lightSource[i].spotDirection = gl.getUniformLocation(program, "uLightSource[" + i + "].spotDirection");
        this.lightSource[i].spotExponent = gl.getUniformLocation(program, "uLightSource[" + i + "].spotExponent");
        this.lightSource[i].spotCutoff = gl.getUniformLocation(program, "uLightSource[" + i + "].spotCutoff");
        this.lightSource[i].constantAttenuation = gl.getUniformLocation(program, "uLightSource[" + i + "].constantAttenuation");
        this.lightSource[i].linearAttenuation = gl.getUniformLocation(program, "uLightSource[" + i + "].linearAttenuation");
        this.lightSource[i].quadraticAttenuation = gl.getUniformLocation(program, "uLightSource[" + i + "].quadraticAttenuation");
        this.lightSource[i].range = gl.getUniformLocation(program, "uLightSource[" + i + "].range");

        // set initially disabled
        gl.uniform1i(this.lightSource[i].enabled, 0);
    }

    // materials
    this.frontMaterial = new gl_MaterialParameters();
    this.frontMaterial.ambient = gl.getUniformLocation(program, "uFrontMaterial.ambient");
    this.frontMaterial.diffuse = gl.getUniformLocation(program, "uFrontMaterial.diffuse");
    this.frontMaterial.specular = gl.getUniformLocation(program, "uFrontMaterial.specular");
    this.frontMaterial.emission = gl.getUniformLocation(program, "uFrontMaterial.emission");
    this.frontMaterial.shininess = gl.getUniformLocation(program, "uFrontMaterial.shininess");

    // textures
    this.textureSamplerColor = new Array(gl_MaxTextureStages);
    this.textureSamplerAlpha = new Array(gl_MaxTextureStages);
    this.textureStageEnabled = new Array(gl_MaxTextureStages)
    for (var i = 0; i < gl_MaxTextureStages; i++)
    {
        this.textureSamplerColor[i] = gl.getUniformLocation(program, "uTextureSamplerColor[" + i + "]");
        this.textureSamplerAlpha[i] = gl.getUniformLocation(program, "uTextureSamplerAlpha[" + i + "]");
        this.textureStageEnabled[i] = gl.getUniformLocation(program, "uTextureStageEnabled[" + i + "]");
    }
    this.textureSamplerShadowMap = gl.getUniformLocation(program, "uTextureSamplerShadowMap");
    this.textureBlendOp = gl.getUniformLocation(program, "uTextureBlendOp");
    this.textureColorMask = gl.getUniformLocation(program, "uTextureColorMask");

    // clip planes
    this.clipPlane = new Array(gl_MaxClipPlanes);
    this.clipPlaneEnabled = new Array(gl_MaxClipPlanes);
    for (var i = 0; i < gl_MaxClipPlanes; i++)
    {
        this.clipPlane[i] = gl.getUniformLocation(program, "uClipPlane[" + i + "]");
        this.clipPlaneEnabled[i] = gl.getUniformLocation(program, "uClipPlaneEnabled[" + i + "]");
    }

    // enabled
    this.lightingEnabled = gl.getUniformLocation(program, "uLightingEnabled");
    this.texturesEnabled = gl.getUniformLocation(program, "uTexturesEnabled");

    // misc
    this.shadowCasterWorldPosition = gl.getUniformLocation(program, "uShadowCasterWorldPosition");
    this.modelID = gl.getUniformLocation(program, "uModelID");
    
    // set initially enabled/disabled
    gl.uniform1i(this.lightingEnabled, 1);
    gl.uniform1i(this.texturesEnabled, 1);
    gl.uniform1i(this.textureStageEnabled[0], 0);
    gl.uniform1i(this.textureStageEnabled[1], 0);
    
    this.getGLProgram = function()
    {
        return program;
    }
    
    this.enableVertexAttribArrays = function()
    {
        for (var i = 0; i < _attributeCount; i++)
        {
            gl.enableVertexAttribArray(i);
        }
    }
    
    this.disableVertexAttribArrays = function()
    {
        for (var i = 0; i < _attributeCount; i++)
        {
            gl.disableVertexAttribArray(i);
        }
    }
    
    this.vertexAttribPointer = function(index, size, type, normalized, stride, offset)
    {
        if (index >= 0)
        {
            gl.vertexAttribPointer(index, size, type, normalized, stride, offset);
        }
    }
}





function gl_LightSourceParameters()
{
    var enabled;
    var ambient;
    var diffuse;
    var specular;
    var position;
    var spotDirection;
    var spotExponent;
    var spotCutoff;
    var constantAttenuation;
    var linearAttenuation;
    var quadraticAttenuation;
}

function gl_MaterialParameters()
{
    var ambient;
    var diffuse;
    var specular;
    var emission;
    var shininess; 
}

var gl_MaxLights = 4;
var gl_MaxTextureStages = 2;
var gl_MaxClipPlanes = 4;

webglRC.prototype = new RenderContext();
webglRC.prototype.constructor = webglRC;

function webglRC(canvas, background)
{
    //
    // initialization
    //
    
    RenderContext.call(this, canvas, background);
    
    var _gl = getWebGLContext(canvas, false /*set to true for debug context*/);
    if (!_gl) return;

    _gl.clearColor(0, 0, 0, background ? 0 : 1);
    _gl.clearDepth(1);
    _gl.clearStencil(0);
    _gl.enable(_gl.DEPTH_TEST);
    _gl.depthFunc(_gl.LEQUAL);
    _gl.disable(_gl.STENCIL_TEST);
    _gl.frontFace(_gl.CW);
    _gl.viewport(0, 0, canvas.width, canvas.height);
    _gl.enable(_gl.CULL_FACE);
    _gl.cullFace(_gl.BACK);
   
    // extensions
    var OES_standard_derivatives_extension = _gl.getExtension('OES_standard_derivatives');
    var FRAGMENT_SHADER_DERIVATIVE_HINT_OES = 0x8B8B;
    _gl.hint(FRAGMENT_SHADER_DERIVATIVE_HINT_OES, _gl.NICEST);
    
    // set valid flag
    this.valid = true;

    // private members
    var _program = null;
    var _vLights = [];
    var _vLightMatrices = [];
    var _vLightEnabledStates = [];
    var _vClipPlanes = [];
    var _vClipPlaneMatrices = [];
    var _vClipPlaneEnabledStates = [];
    var _viewport = new Viewport(0, 0, canvas.width, canvas.height);
    var _clearColor = new Color(0, 0, 0, background ? 0 : 1);
    
    //
    // methods
    //
    
    this.applyProjectionTransform = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.ApplyProjectionTransform, null);
        
        _gl.uniformMatrix4fv(_program.projectionMatrix, false, new Float32Array(this.projectionMatrixStack.top().flatten()));
    }
    
    this.applyViewTransform = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.ApplyViewTransform, null);
        
        _gl.uniformMatrix4fv(_program.viewMatrix, false, new Float32Array(this.viewMatrixStack.top().flatten()));
    }
    
    this.applyWorldTransform = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.ApplyWorldTransform, null);
        
        _gl.uniformMatrix4fv(_program.worldMatrix, false, new Float32Array(this.worldMatrixStack.top().flatten()));

        var normalMatrix = new Matrix4x4();
        normalMatrix.loadMatrix(this.worldMatrixStack.top());
        normalMatrix.invert();
        normalMatrix.transpose();
        _gl.uniformMatrix4fv(_program.normalMatrix, false, new Float32Array(normalMatrix.flatten()));
    }
    
    this.clear = function(mask)
    {
        mask = mask || (RC_COLOR_BUFFER_BIT | RC_DEPTH_BUFFER_BIT);
        
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.Clear, [mask]);
        
        _gl.clear((mask & RC_COLOR_BUFFER_BIT   ? _gl.COLOR_BUFFER_BIT   : 0) |
                  (mask & RC_DEPTH_BUFFER_BIT   ? _gl.DEPTH_BUFFER_BIT   : 0) |
                  (mask & RC_STENCIL_BUFFER_BIT ? _gl.STENCIL_BUFFER_BIT : 0));
    }

    this.clearColor = function(r, g, b, a)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.ClearColor, [r, g, b, a]);
        
        _gl.clearColor(r, g, b, a);
        _clearColor.load(r, g, b, a);
    }
    
    this.clearDepth = function(d)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.ClearDepth, [d]);
        
        _gl.clearDepth(d);
    }
    
    this.clearStencil = function(s)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.ClearStencil, [s]);
        
        _gl.clearStencil(s);  
    }
    
    this.createProgram = function(vs, fs)
    {
        //if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.createProgram, [vs, fs]);
        
        return new webglProgram(this, _gl, vs, fs);
    }
    
    this.createShadowFramebufferObject = function()
    {
        return new webglShadowFBO(this, _gl);
    }
    
    this.createTextureObject = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.CreateTextureObject, null);
        
        return new webglTO(this, _gl);
    }
    
    this.createVertexBuffer = function(numVerticesPerPrimitive)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.CreateVertexBuffer, [numVerticesPerPrimitive]);
        
        return new webglVB(this, _gl, numVerticesPerPrimitive);
    }
    
    this.cullFace = function(face)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.CullFace, [face]);
        
        switch (face)
        {
            case RC_FRONT:
                _gl.cullFace(_gl.FRONT);
                break;
                
            case RC_BACK:
                _gl.cullFace(_gl.BACK);
                break;
        }
    }
    
    this.disable = function(cap)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.Disable, [cap]);
        
        switch (cap)
        {
            case eRenderMode.AlphaBlend:
                _gl.disable(_gl.BLEND);
                break;

            case eRenderMode.CullBackFace:
                _gl.disable(_gl.CULL_FACE);
                break;

            case eRenderMode.DepthBufferWrite:
                _gl.depthMask(false);
                break;

            case eRenderMode.DepthTest:
                _gl.disable(_gl.DEPTH_TEST);
                break;

            case eRenderMode.Lighting:
                _gl.uniform1i(_program.lightingEnabled, false); 
                break;
                
            case eRenderMode.StencilTest:
                _gl.disable(_gl.STENCIL_TEST);
                break;
        }
    }

    this.enable = function(cap)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.Enable, [cap]);
        
        switch (cap)
        {
            case eRenderMode.AlphaBlend:
                _gl.enable(_gl.BLEND);
                break;

            case eRenderMode.CullBackFace:
                _gl.enable(_gl.CULL_FACE);
                break;

            case eRenderMode.DepthBufferWrite:
                _gl.depthMask(true);
                break;

            case eRenderMode.DepthTest:
                _gl.enable(_gl.DEPTH_TEST);
                break;

            case eRenderMode.Lighting:
                _gl.uniform1i(_program.lightingEnabled, true);
                break;
                
            case eRenderMode.StencilTest:
                _gl.enable(_gl.STENCIL_TEST);
                break;
        }
    }
    
    this.enableClipPlane = function(index, enable)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.EnableClipPlane, [index, enable]);
        
        _gl.uniform1i(_program.clipPlaneEnabled[index], enable);

        _vClipPlaneEnabledStates[index] = enable;
    }

    this.enabled = function(cap)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.Enabled, [cap]);
        
        var e = false;

        switch (cap)
        {
            case eRenderMode.AlphaBlend:
                e = _gl.getParameter(_gl.BLEND);
                break;

            case eRenderMode.CullBackFace:
                e = _gl.getParameter(_gl.CULL_FACE);
                break;
                
            case eRenderMode.DepthBufferWrite:
                e = _gl.getParameter(_gl.DEPTH_WRITEMASK);
                break;

            case eRenderMode.DepthTest:
                e = _gl.getParameter(_gl.DEPTH_TEST);
                break;

            case eRenderMode.Lighting:
                e = _gl.getUniform(_program.getGLProgram(), _program.lightingEnabled);
                break;
                
            case eRenderMode.StencilTest:
                e = _gl.getParameter(_gl.STENCIL_TEST);
                break;
        }

        return e;
    }
    
    this.enableLight = function(index, enable)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.EnableLight, [index, enable]);
        
        _gl.uniform1i(_program.lightSource[index].enabled, enable);

        _vLightEnabledStates[index] = enable;
    }
    
    this.enableTextureStage = function(stage, enable)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.EnableTextureStage, [stage, enable]);
        
        _gl.uniform1i(_program.textureStageEnabled[stage], enable);
    }
    
    this.finish = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.Finish, null);
        
        _gl.finish();
    }
    
    this.getClearColor = function()
    {
        return _clearColor;
    }
    
    this.getClipPlane = function(index)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.GetClipPlane, [index]);
        
        return { equation: _vClipPlanes[index], matrix: _vClipPlaneMatrices[index] };
    }
    
    this.getEnabledClipPlanes = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.GetEnabledClipPlanes, null);
        
        var indices = [];

        for (var i = 0; i < _vClipPlaneEnabledStates.length; i++)
        {
            if (_vClipPlaneEnabledStates[i])
            {
                indices.push(i);
            }
        }

        return indices;
    }
    
    this.getEnabledLights = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.GetEnabledLights, null);
        
        var indices = [];

        for (var i = 0; i < _vLightEnabledStates.length; i++)
        {
            if (_vLightEnabledStates[i])
            {
                indices.push(i);
            }
        }

        return indices;
    }

    this.getGlobalIllumination = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.GetGlobalIllumination, null);
        
        var values = this.globalIllumination.v();//_gl.getUniform(_program.getGLProgram(), _program.globalAmbientLight);

        return { r: values[0], g: values[1], b: values[2], a: values[3] };
    }
    
    this.getLight = function(index)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.GetLight, [index]);
        
        return { desc: _vLights[index], matrix: _vLightMatrices[index] };
    }
    
    this.getMaxLightCount = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.GetMaxLightCount, null);
        
        return gl_MaxLights;
    }
    
    this.getMaxTextureStages = function()
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.GetMaxTextureStages, null);
        
        return gl_MaxTextureStages;
    }
    
    this.getProgram = function()
    {
        //if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.GetProgram, null);
        
        return _program;
    }
    
    this.getViewport = function()
    {
        return _viewport;
    }
    
    this.perspectiveMatrixLH = function(left, right, top, bottom, near, far)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.PerspectiveMatrixLH, [left, right, top, bottom, near, far]);
        
        var p = new Matrix4x4();
        
        var a = (right + left) / (right - left);
        var b = (top + bottom) / (top - bottom);
        var c = (far + near) / (far - near);
        var d = (2 * far * near) / (far - near);
        
        p._11 = (2 * near) / (right - left);
        p._13 = a;
        p._22 = (2 * near) / (top - bottom);
        p._23 = b;
        p._33 = c;
        p._34 = 1;
        p._43 = -d;
        p._44 = 0;
        
        return p;
    }
    
    this.orthographicMatrixLH = function(left, right, top, bottom, near, far)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.OrthographicMatrixLH, [left, right, top, bottom, near, far]);
        
        var p = new Matrix4x4();
        
        p._11 =  2 / (right - left);
        p._22 =  2 / (top - bottom);
        p._33 = -2 / (far - near);
        p._41 = -((right + left) / (right - left));
        p._42 = -((top + bottom) / (top - bottom));
        p._43 = -((far + near) / (far - near)) / 2;
              
        return p;
    }
    
    this.readFrameBuffer = function(x, y, width, height)
    {
        var pixels = new Uint8Array(width * height * 4);
        
        _gl.readPixels(x, y, width, height, _gl.RGBA, _gl.UNSIGNED_BYTE, pixels);
        
        return pixels;
    }
    
    this.setBlendColor = function(r, g, b, a)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetBlendColor, [r, g, b, a]);
        
        _gl.blendColor(r, g, b, a);
    }
    
    this.setBlendFactor = function(sfactor, dfactor)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetBlendFactor, [sfactor, dfactor]);
        
        var gl_SrcFactor;
        switch (sfactor)
        {
        case RC_ZERO:                   gl_SrcFactor = _gl.ZERO; break;
        case RC_ONE:                    gl_SrcFactor = _gl.ONE; break;
        case RC_SRC_COLOR:              gl_SrcFactor = _gl.SRC_COLOR; break;
        case RC_SRC_ALPHA:              gl_SrcFactor = _gl.SRC_ALPHA; break;        
        case RC_ONE_MINUS_SRC_COLOR:    gl_SrcFactor = _gl.ONE_MINUS_SRC_COLOR; break;
        case RC_ONE_MINUS_SRC_ALPHA:    gl_SrcFactor = _gl.ONE_MINUS_SRC_ALPHA; break;
        case RC_DEST_COLOR:             gl_SrcFactor = _gl.DEST_COLOR; break;
        case RC_DEST_ALPHA:             gl_SrcFactor = _gl.DEST_ALPHA; break;        
        case RC_ONE_MINUS_DEST_COLOR:   gl_SrcFactor = _gl.ONE_MINUS_DEST_COLOR; break;
        case RC_ONE_MINUS_DEST_ALPHA:   gl_SrcFactor = _gl.ONE_MINUS_DEST_ALPHA; break;
        }     
        
        var gl_DestFactor;
        switch (dfactor)
        {
        case RC_ZERO:                   gl_DestFactor = _gl.ZERO; break;
        case RC_ONE:                    gl_DestFactor = _gl.ONE; break;
        case RC_SRC_COLOR:              gl_DestFactor = _gl.SRC_COLOR; break;
        case RC_SRC_ALPHA:              gl_DestFactor = _gl.SRC_ALPHA; break;        
        case RC_ONE_MINUS_SRC_COLOR:    gl_DestFactor = _gl.ONE_MINUS_SRC_COLOR; break;
        case RC_ONE_MINUS_SRC_ALPHA:    gl_DestFactor = _gl.ONE_MINUS_SRC_ALPHA; break;
        case RC_DEST_COLOR:             gl_DestFactor = _gl.DEST_COLOR; break;
        case RC_DEST_ALPHA:             gl_DestFactor = _gl.DEST_ALPHA; break;        
        case RC_ONE_MINUS_DEST_COLOR:   gl_DestFactor = _gl.ONE_MINUS_DEST_COLOR; break;
        case RC_ONE_MINUS_DEST_ALPHA:   gl_DestFactor = _gl.ONE_MINUS_DEST_ALPHA; break;
        }
        
        _gl.blendFunc(gl_SrcFactor, gl_DestFactor);  
    }

    this.setClipPlane = function(index, equation)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetClipPlane, [index, equation]);
        
        // get current world transform
        var worldMatrix = this.worldMatrixStack.top();

        var values = [ equation[0], equation[1], equation[2], equation[3] ];
        
        _gl.uniform4fv(_program.textureColorMask, new Float32Array(values));
        
        _vClipPlanes[index] = equation;
        _vClipPlaneMatrices[index] = worldMatrix;          
    }
    
    this.setDepthFunc = function(func)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetDepthFunc, [func]);
        
        var gl_DepthFunc;
        switch (func)
        {
        case eDepthFunc.Never:          gl_DepthFunc = _gl.NEVER; break;
        case eDepthFunc.Less:           gl_DepthFunc = _gl.LESS; break;
        case eDepthFunc.LessEqual:      gl_DepthFunc = _gl.LEQUAL; break;
        case eDepthFunc.Equal:          gl_DepthFunc = _gl.EQUAL; break;
        case eDepthFunc.NotEqual:       gl_DepthFunc = _gl.NOTEQUAL; break;
        case eDepthFunc.GreaterEqual:   gl_DepthFunc = _gl.GEQUAL; break;
        case eDepthFunc.Greater:        gl_DepthFunc = _gl.GREATER; break;
        case eDepthFunc.Always:         gl_DepthFunc = _gl.ALWAYS; break;
        }
        
        _gl.depthFunc(gl_DepthFunc);
           
    }
    
    this.setEnabledClipPlanes = function(indices)
    {
        if (this.displayListObj) if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetEnabledClipPlanes, [indices]);
        
        // disable all previously enabled clip planes
        for (var i = 0; i < _vClipPlaneEnabledStates.length; i++)
        {
            if (_vClipPlaneEnabledStates[i])
            {
                this.enableClipPlane(i, false);
            }
        }

        // enable specified clip planes
        for (var i = 0; i < indices.length; i++)
        {
            this.enableClipPlane(indices[i], true);
        }
    }
    
    this.setEnabledLights = function(indices)
    {
        if (this.displayListObj) if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetEnabledLights, [indices]);
        
        // disable all previously enabled lights
        for (var i = 0; i < _vLightEnabledStates.length; i++)
        {
            if (_vLightEnabledStates[i])
            {
                this.enableLight(i, false);
            }
        }

        // enable specified lights
        for (var i = 0; i < indices.length; i++)
        {
            this.enableLight(indices[i], true);
        }
    }
    
    this.setFrontMaterial = function(desc)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetFrontMaterial, [desc]);
        
        // ambient
        if (desc.validMembersMask & MATERIALDESC_AMBIENT_BIT)
        {
            _gl.uniform4fv(_program.frontMaterial.ambient, new Float32Array(desc.ambient.v()));
            
            this.frontMaterial.ambient = desc.ambient;
        }
        
        // diffuse
        if (desc.validMembersMask & MATERIALDESC_DIFFUSE_BIT)
        {
            _gl.uniform4fv(_program.frontMaterial.diffuse, new Float32Array(desc.diffuse.v()));
            
            this.frontMaterial.diffuse = desc.diffuse;
        }
        
        // specular
        if (desc.validMembersMask & MATERIALDESC_SPECULAR_BIT)
        {
            _gl.uniform4fv(_program.frontMaterial.specular, new Float32Array(desc.specular.v()));
            
            this.frontMaterial.specular = desc.specular;
        }
        
        // emissive
        if (desc.validMembersMask & MATERIALDESC_EMISSIVE_BIT)
        {
            // TODO
            //_gl.uniform4fv(_program.frontMaterial.emission, new Float32Array(desc.emissive.v()));
            
            this.frontMaterial.emissive = desc.emissive;
        }
        
        // glossiness
        if (desc.validMembersMask & MATERIALDESC_GLOSSINESS_BIT)
        {
            // glossiness - OpenGL accepts values in the range [0, 128].
            // use the range [5, 128], because values below 5 result in wash-out
            _gl.uniform1f(_program.frontMaterial.shininess, clamp(desc.glossiness * 128, 5, 128));
            
            this.frontMaterial.glossiness = desc.glossiness;
        }
        
        this.frontMaterial.validMembersMask |= desc.validMembersMask;
    }

    this.setGlobalIllumination = function(ambient)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetGlobalIllumination, [ambient]);
        
        var values = [ ambient.r, ambient.g, ambient.b, ambient.a ];

        _gl.uniform4fv(_program.globalAmbientLight, new Float32Array(values));
        
        this.globalIllumination.load(ambient.r, ambient.g, ambient.b, ambient.a);
    }

    this.setLight = function(index, desc)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetLight, [index, desc]);

        // position
        if (desc.validMembersMask & LIGHTDESC_POSITION_BIT)
        {
            var values = [desc.position.x, desc.position.y, desc.position.z, 1];
            _gl.uniform4fv(_program.lightSource[index].position, new Float32Array(values));
        }

        // direction
        if (desc.validMembersMask & LIGHTDESC_DIRECTION_BIT)
        {
            var values = [desc.direction.x, desc.direction.y, desc.direction.z, 0];

            switch (desc.type)
            {
                case "directional":
                    {
                        values[0] *= -1;
                        values[1] *= -1;
                        values[2] *= -1;

                        // OpenGL gets a directional light's direction from position member                
                        _gl.uniform4fv(_program.lightSource[index].position, new Float32Array(values));
                    }
                    break;

                case "spot":
                    {
                        _gl.uniform4fv(_program.lightSource[index].spotDirection, new Float32Array(values));
                    }
                    break;
            }
        }

        // ambient
        if (desc.validMembersMask & LIGHTDESC_AMBIENT_BIT)
        {
            _gl.uniform4fv(_program.lightSource[index].ambient, new Float32Array(desc.ambient.v()));
        }

        // diffuse
        if (desc.validMembersMask & LIGHTDESC_DIFFUSE_BIT)
        {
            _gl.uniform4fv(_program.lightSource[index].diffuse, new Float32Array(desc.diffuse.v()));
        }

        // specular
        if (desc.validMembersMask & LIGHTDESC_SPECULAR_BIT)
        {
            _gl.uniform4fv(_program.lightSource[index].specular, new Float32Array(desc.specular.v()));
        }

        // constant attenuation
        if (desc.validMembersMask & LIGHTDESC_CONSTANT_ATT_BIT)
        {
            _gl.uniform1f(_program.lightSource[index].constantAttenuation, desc.constantAttenuation);
        }

        // linear attenuation
        if (desc.validMembersMask & LIGHTDESC_LINEAR_ATT_BIT)
        {
            _gl.uniform1f(_program.lightSource[index].linearAttenuation, desc.linearAttenuation);
        }

        // quadratic attenuation
        if (desc.validMembersMask & LIGHTDESC_QUADRATIC_ATT_BIT)
        {
            _gl.uniform1f(_program.lightSource[index].quadraticAttenuation, desc.quadraticAttenuation);
        }

        // range
        if (desc.validMembersMask & LIGHTDESC_RANGE_BIT)
        {
            // TODO
            _gl.uniform1f(_program.lightSource[index].range, desc.range);
        }

        // outer cone angle
        if (desc.validMembersMask & LIGHTDESC_OUTER_CONE_DEG_BIT)
        {
            var outerConeDegrees = desc.outerConeDegrees;

            // OpenGL accepts cone degrees in the range [0, 90] or 180
            if (outerConeDegrees > 90)
            {
                outerConeDegrees = 180;
            }

            _gl.uniform1f(_program.lightSource[index].spotCutoff, outerConeDegrees);

            _gl.uniform1f(_program.lightSource[index].spotExponent, 0);
        }

        // inner cone angle
        if (desc.validMembersMask & LIGHTDESC_INNER_CONE_DEG_BIT)
        {
            // TODO
        }

        // cone falloff
        if (desc.validMembersMask & LIGHTDESC_CONE_FALLOFF_BIT)
        {
            // TODO
        }

        _vLights[index] = desc;
        _vLightMatrices[index] = worldMatrix;
    }

    this.setModelID = function(id)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetModelID, [id]);
        
        _gl.uniform1i(_program.modelID, id);
    }
    
    this.setShadeModel = function(model)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetShadeModel, [model]);
        
        // TODO
    }
    
    this.setShadowCasterWorldPosition = function(x, y, z)
    {
        _gl.uniform3fv(_program.shadowCasterWorldPosition, new Float32Array([x, y, z]));
    }
    
    this.setStencilFunc = function(func, ref, mask)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetStencilFunc, [func, ref, mask]);
        
        var gl_StencilFunc;
        switch (func)
        {
        case eDepthFunc.Never:          gl_StencilFunc = _gl.NEVER; break;
        case eDepthFunc.Less:           gl_StencilFunc = _gl.LESS; break;
        case eDepthFunc.LessEqual:      gl_StencilFunc = _gl.LEQUAL; break;
        case eDepthFunc.Equal:          gl_StencilFunc = _gl.EQUAL; break;
        case eDepthFunc.NotEqual:       gl_StencilFunc = _gl.NOTEQUAL; break;
        case eDepthFunc.GreaterEqual:   gl_StencilFunc = _gl.GEQUAL; break;
        case eDepthFunc.Greater:        gl_StencilFunc = _gl.GREATER; break;
        case eDepthFunc.Always:         gl_StencilFunc = _gl.ALWAYS; break;
        }
        
        _gl.stencilFunc(gl_StencilFunc, ref, mask);
    }
            
    this.setStencilMask = function(mask)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetStencilMask, [mask]);
        
        _gl.stencilMask(mask);
    } 
    
    this.setStencilOp = function(fail, zFail, zPass)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetStencilOp, [fail, zFail, zPass]);
       
        var gl_Fail;
        switch (fail)
        {
        case eStencilOp.Keep:           gl_Fail = _gl.KEEP; break;
        case eStencilOp.Replace:        gl_Fail = _gl.REPLACE; break;
        case eStencilOp.Increment:      gl_Fail = _gl.INCR; break;
        case eStencilOp.Decrement:      gl_Fail = _gl.DECR; break;
        case eStencilOp.Invert:         gl_Fail = _gl.INVERT; break;
        case eStencilOp.Zero:           gl_Fail = _gl.ZERO; break;
        }
        
        switch (zFail)
        {
        case eStencilOp.Keep:           gl_ZFail = _gl.KEEP; break;
        case eStencilOp.Replace:        gl_ZFail = _gl.REPLACE; break;
        case eStencilOp.Increment:      gl_ZFail = _gl.INCR; break;
        case eStencilOp.Decrement:      gl_ZFail = _gl.DECR; break;
        case eStencilOp.Invert:         gl_ZFail = _gl.INVERT; break;
        case eStencilOp.Zero:           gl_ZFail = _gl.ZERO; break;
        }
        
        switch (zPass)
        {
        case eStencilOp.Keep:           gl_ZPass = _gl.KEEP; break;
        case eStencilOp.Replace:        gl_ZPass = _gl.REPLACE; break;
        case eStencilOp.Increment:      gl_ZPass = _gl.INCR; break;
        case eStencilOp.Decrement:      gl_ZPass = _gl.DECR; break;
        case eStencilOp.Invert:         gl_ZPass = _gl.INVERT; break;
        case eStencilOp.Zero:           gl_ZPass = _gl.ZERO; break;
        }
        
        _gl.stencilOp(gl_Fail, gl_ZFail, gl_ZPass);
    }
    
    this.setTextureBlendFactor = function(factor)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetTextureBlendFactor, [factor]);
        
        // update material diffuse component alpha to blend factor
        var diffuse = [ this.frontMaterial.diffuse.r, this.frontMaterial.diffuse.g, this.frontMaterial.diffuse.b, factor ];
        _gl.uniform4fv(_program.frontMaterial.diffuse, new Float32Array(diffuse));
    }
    
    this.setTextureBlendOp = function(op)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetTextureBlendOp, [op]);
        
        _gl.uniform1i(_program.textureBlendOp, op);
    }
    
    this.setTextureColorMask = function(r, g, b, a)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetTextureColorMask, [r, g, b, a]);
        
        var values = [ r, g, b, a ];
        
        _gl.uniform4fv(_program.textureColorMask, new Float32Array(values));   
    }
    
    this.setViewport = function(x, y, width, height)
    {
        if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.SetViewport, [x, y, width, height]);
        
        _gl.viewport(x, y, width, height);
        _viewport.load(x, y, width, height);
    }
    
    this.useProgram = function(program)
    {
        //if (this.displayListObj) DL_ADD_METHOD_DESC(this.displayListObj, eRenderContextMethod.UseProgram, [_program]);
        
        if (_program != program)
        {
            if (_program)
            {
                _program.disableVertexAttribArrays();
            }
            
            _gl.useProgram(program.getGLProgram());
            _program = program;
            
            if (_program)
            {
                _program.enableVertexAttribArrays();
                
                // restore states that don't translate between program switches
                this.setGlobalIllumination(this.globalIllumination);
            }
        }
    }
}

function getWebGLContext(canvas, debug) 
{
    var _gl = null;
    try 
    {
        if (debug)
        {
            _gl = WebGLDebugUtils.makeDebugContext(canvas.getContext("experimental-webgl", { stencil: true, antialias: false, preserveDrawingBuffer: true }));
        }
        else // !debug
        {
            _gl = (canvas.getContext("webgl", { stencil: true, antialias: true, preserveDrawingBuffer: true }) || 
                  canvas.getContext("experimental-webgl", { stencil: true, antialias: true, preserveDrawingBuffer: true }));
        }
    }    
    catch (e) 
    {
    }
    if (!_gl) 
    {
        var div = document.createElement("div");
        div.innerHTML = "This demo requires a WebGL-enabled browser.";
        var canvasParent = canvas.parentNode;
        canvasParent.replaceChild(div, canvas);
    }

    var stencilBits = _gl.getParameter(_gl.STENCIL_BITS);

    return _gl;
}

function webglVB_uvb(buffer, coords)
{
    this.buffer = buffer;
    this.coords = coords;
}

webglVB.prototype = new VertexBuffer();
webglVB.prototype.constructor = webglVB;

function webglVB(rc, gl, numVerticesPerPrimitive)
{
    //
    // initialization
    //

    VertexBuffer.call(this);

    this.numVerticesPerPrimitive = numVerticesPerPrimitive;

    var rc = rc;
    var gl = gl;
    var vb = gl.createBuffer();
    var nb = null;
    var cb = null;
    var cEmpty = gl.createBuffer(); // for VBs with no color coordinates (see below)
    var uvb = new Array(gl_MaxTextureStages);
    var uvEmpty = gl.createBuffer(); // for VBs with no texture coordinates (see below)
    var uvCoords = []; // indexed by texture
    var primitiveType = 0;

    //
    // methods
    //

    this.setPrimitiveType = function(type)
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.VB_SetPrimitiveType, [this, type]);

        switch (type)
        {
            case RC_POINTS:
                primitiveType = gl.POINTS;
                break;
            case RC_LINES:
                primitiveType = gl.LINES;
                break;
            case RC_LINE_LOOP:
                primitiveType = gl.LINE_LOOP;
                break;
            case RC_LINE_STRIP:
                primitiveType = gl.LINE_STRIP;
                break;
            case RC_TRIANGLES:
                primitiveType = gl.TRIANGLES;
                break;
            case RC_TRIANGLE_STRIP:
                primitiveType = gl.TRIANGLE_STRIP;
                break;
            case RC_TRIANGLE_FAN:
                primitiveType = gl.TRIANGLE_FAN;
                break;
        }
    }

    this.setVertices = function(vertices)
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.VB_SetVertices, [this, vertices]);

        if (vertices.length)
        {
            gl.bindBuffer(gl.ARRAY_BUFFER, vb);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);

            this.vertexCount = vertices.length / this.numVerticesPerPrimitive;

            // create empty color array for vb's with no colors specified (see below)
            gl.bindBuffer(gl.ARRAY_BUFFER, cEmpty);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(this.vertexCount * 4), gl.STATIC_DRAW);

            // create empty texture coordinate arrays for vb's with no textures (see below)
            gl.bindBuffer(gl.ARRAY_BUFFER, uvEmpty);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(new Array(this.vertexCount * 2)), gl.STATIC_DRAW);
        }

        this.vertices = vertices;
    }

    this.setNormals = function(normals)
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.VB_SetNormals, [this, normals]);

        if (normals.length)
        {
            if (nb == null)
            {
                nb = gl.createBuffer();
            }
            gl.bindBuffer(gl.ARRAY_BUFFER, nb);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(normals), gl.STATIC_DRAW);
        }

        this.normals = normals;
    }

    this.setColors = function(colors)
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.VB_SetColors, [this, colors]);

        if (colors.length)
        {
            if (cb == null)
            {
                cb = gl.createBuffer();
            }
            gl.bindBuffer(gl.ARRAY_BUFFER, cb);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(colors), gl.STATIC_DRAW);
        }

        this.colors = colors;
    }

    this.setUVCoords = function(texture, coords)
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.VB_SetUVCoords, [this, texture, coords]);

        uvCoords[texture] = new webglVB_uvb(gl.createBuffer(), coords.slice());

        // flip y
        for (var i = 1; i < uvCoords[texture].coords.length; i += 2)
        {
            uvCoords[texture].coords[i] = 1 - uvCoords[texture].coords[i];
        }
    }

    this.setTextureStage = function(stage, textureObj, widthWrap, heightWrap, textureCoordSrc, planeCoefficients)
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.VB_SetTextureStage, [this, stage, textureObj, widthWrap, heightWrap, textureCoordSrc, planeCoefficients]);

        switch (stage)
        {
            case 0:
                {
                    gl.activeTexture(gl.TEXTURE0 + eTextureUnit.Color0);
                    gl.uniform1i(rc.getProgram().textureSamplerColor[stage], eTextureUnit.Color0);
                }
                break;

            case 1:
                {
                    gl.activeTexture(gl.TEXTURE0 + eTextureUnit.Color1);
                    gl.uniform1i(rc.getProgram().textureSamplerColor[stage], eTextureUnit.Color1);
                }
                break;
        }

        gl.bindTexture(gl.TEXTURE_2D, textureObj.texture);     
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, widthWrap);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, heightWrap);

        if (uvCoords[textureObj])
        {
            gl.bindBuffer(gl.ARRAY_BUFFER, uvCoords[textureObj].buffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(uvCoords[textureObj].coords), gl.STATIC_DRAW);
            uvb[stage] = uvCoords[textureObj].buffer;
        }
    }

    this.draw = function()
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.VB_Draw, [this]);

        var program = rc.getProgram();
        
        if (this.vertices.length)
        {
            // vertices
            gl.bindBuffer(gl.ARRAY_BUFFER, vb);
            program.vertexAttribPointer(program.vertexPositionAttribute, this.numVerticesPerPrimitive, gl.FLOAT, false, 0, 0);

            // normals
            if (nb)
            {
                gl.bindBuffer(gl.ARRAY_BUFFER, nb);
                program.vertexAttribPointer(program.vertexNormalAttribute, 3, gl.FLOAT, false, 0, 0);
            }

            // colors
            if (program.vertexColorAttribute >= 0)
            {
                if (cb)
                    gl.bindBuffer(gl.ARRAY_BUFFER, cb);
                else
                    gl.bindBuffer(gl.ARRAY_BUFFER, cEmpty);
                program.vertexAttribPointer(program.vertexColorAttribute, 4, gl.FLOAT, false, 0, 0);
            }
            
            // texture coords
            // NOTE: vertex shader silently fails if nothing is specified for a given rc.getProgram() attribute, so if 
            // no texture coords are specified, use the vertex uv buffer.
            for (var i = 0; i < gl_MaxTextureStages; i++)
            {
                if (program.textureCoordAttribute[i] >= 0)
                {
                    if (uvb[i])
                        gl.bindBuffer(gl.ARRAY_BUFFER, uvb[i]);
                    else
                        gl.bindBuffer(gl.ARRAY_BUFFER, uvEmpty);
                    program.vertexAttribPointer(program.textureCoordAttribute[i], 2, gl.FLOAT, false, 0, 0);
                }
            }

            gl.drawArrays(primitiveType, 0, this.vertexCount);
        }
    }
}
webglTO.prototype = new TextureObject();
webglTO.prototype.constructor = webglTO;

function webglTO(rc, gl)
{
    //
    // initialization
    //
    
    TextureObject.call(this);
    
    var rc = rc;
    var gl = gl;
    
    this.texture = gl.createTexture();
    
    //
    // methods
    //

    this.setImage = function(image, pixelFormat, imageFormat)
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.TO_SetImage, [this, image, pixelFormat, imageFormat]);

        var intFormat;
        switch (pixelFormat)
        {
            case ePixelFormat.R8G8B8:
            case ePixelFormat.B8G8R8:
            case ePixelFormat.X8G8R8:
                intFormat = gl.RGB;
                break;

            case ePixelFormat.R8G8B8A8:
            case ePixelFormat.B8G8R8A8:
            case ePixelFormat.A8R8G8B8:
            case ePixelFormat.A8B8G8R8:
            case ePixelFormat.X8X8X8X8:
                intFormat = gl.RGBA;
                break;

            case ePixelFormat.A8:
                intFormat = gl.ALPHA;
                break;

            default: // unsupported format
                return;
                break;
        }

        var format;
        switch (imageFormat)
        {
            case eImageFormat.RGB:
                format = gl.RGB;
                break;

            case eImageFormat.RGBA:
                format = gl.RGBA;
                break;

            case eImageFormat.Alpha:
                format = gl.ALPHA;
                break;

            case eImageFormat.Luminance:
                format = gl.LUMINANCE;
                break;

            case eImageFormat.Luminance_Alpha:
                format = gl.LUMINANCE_ALPHA;
                break;

            default: // unsupported format
                return;
                break;
        }

        // following taken from:
        // http://www.khronos.org/webgl/wiki/WebGL_and_OpenGL_Differences
        if (!isPowerOfTwo(image.width) || !isPowerOfTwo(image.height))
        {
            // Scale up the texture to the next highest power of two dimensions.
            var canvas = document.createElement("canvas");
            canvas.width = nextHighestPowerOfTwo(image.width);
            canvas.height = nextHighestPowerOfTwo(image.height);
            var ctx = canvas.getContext("2d");
            ctx.drawImage(image,
                0, 0, image.width, image.height,
                0, 0, canvas.width, canvas.height);
            image = canvas;
        }

        gl.bindTexture(gl.TEXTURE_2D, this.texture);

        gl.texImage2D(gl.TEXTURE_2D, 0, intFormat, format, gl.UNSIGNED_BYTE, image);

        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
    
        gl.generateMipmap(gl.TEXTURE_2D);

        gl.bindTexture(gl.TEXTURE_2D, null);
    }

    this.setImageData = function(width, height, pixelFormat, imageFormat, pixels)
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.TO_SetImageData, [this, width, height, pixelFormat, imageFormat, pixels]);

        var intFormat;
        switch (pixelFormat)
        {
            case ePixelFormat.R8G8B8:
            case ePixelFormat.B8G8R8:
            case ePixelFormat.X8G8R8:
                intFormat = gl.RGB;
                break;

            case ePixelFormat.R8G8B8A8:
            case ePixelFormat.B8G8R8A8:
            case ePixelFormat.A8R8G8B8:
            case ePixelFormat.A8B8G8R8:
            case ePixelFormat.X8X8X8X8:
                intFormat = gl.RGBA;
                break;

            case ePixelFormat.A8:
                intFormat = gl.ALPHA;
                break;

            default: // unsupported format
                return;
                break;
        }

        var format;
        switch (imageFormat)
        {
            case eImageFormat.RGB:
                format = gl.RGB;
                break;

            case eImageFormat.RGBA:
                format = gl.RGBA;
                break;

            case eImageFormat.Alpha:
                format = gl.ALPHA;
                break;

            case eImageFormat.Luminance:
                format = gl.LUMINANCE;
                break;

            case eImageFormat.Luminance_Alpha:
                format = gl.LUMINANCE_ALPHA;
                break;

            default: // unsupported format
                return;
                break;
        }
        
        gl.bindTexture(gl.TEXTURE_2D, this.texture);

        gl.texImage2D(gl.TEXTURE_2D, 0, intFormat, width, height, 0, format, gl.UNSIGNED_BYTE,
            new Uint8Array(pixels));

        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
    	
        gl.generateMipmap(gl.TEXTURE_2D);

        gl.bindTexture(gl.TEXTURE_2D, null);
    }

    //texImage2D(GLenum target, GLint level, GLenum internalformat,
    //           GLenum format, GLenum type, HTMLCanvasElement canvas)
    // gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, gl.canvas);
    
    this.setImageWithCanvas = function(canvas)
    {
        // following taken from:
        // http://www.khronos.org/webgl/wiki/WebGL_and_OpenGL_Differences
        var canvasPOT = canvas;
        if (!isPowerOfTwo(canvas.width) || !isPowerOfTwo(canvas.height))
        {
            // Scale up the texture to the next highest power of two dimensions.
            canvasPOT = document.createElement("canvas");
            canvasPOT.width = nextHighestPowerOfTwo(canvas.width);
            canvasPOT.height = nextHighestPowerOfTwo(canvas.height);
            var ctx = canvasPOT.getContext("2d");
            ctx.drawImage(canvas,
                0, 0, canvas.width, canvas.height,
                0, 0, canvasPOT.width, canvasPOT.height);
        }
        
        gl.bindTexture(gl.TEXTURE_2D, this.texture);

        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, canvasPOT);

        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);//LINEAR_MIPMAP_LINEAR);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);//LINEAR);
        
        gl.generateMipmap(gl.TEXTURE_2D);
        
        gl.bindTexture(gl.TEXTURE_2D, null);   
    }   
                 
    this.setVideo = function(video)
    {
        if (rc.displayListObj) DL_ADD_METHOD_DESC(rc.displayListObj, eRenderContextMethod.TO_SetVideo, [this, video]);

        gl.bindTexture(gl.TEXTURE_2D, this.texture);

        // different browsers require calls to different versions of texImage2D; possibly because 
        // complete webGL implementations are not yet available
        switch (getBrowserName())
        {
            case "Chrome":
            //gl.texImage2D(gl.TEXTURE_2D, 0, video, false);
            //break;

            case "Firefox":
                gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, video);
                break;

            default:
                gl.texImage2D(gl.TEXTURE_2D, 0, video, false);
                break;
        }

        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
        gl.bindTexture(gl.TEXTURE_2D, null);
    }
}

function isPowerOfTwo(x)
{
    return (x & (x - 1)) == 0;
}

function nextHighestPowerOfTwo(x)
{
    --x;
    for (var i = 1; i < 32; i <<= 1)
    {
        x = x | x >> i;
    }
    return x + 1;
}
function webglShadowFBO(rc, gl)
{
    var rc = rc;
    var gl = gl;
    var width = 1024;
    var height = 1024;
    
    // create frame buffer
    var fbo = gl.createFramebuffer();
    gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);
    
    // create depth texture
    var depth = gl.createRenderbuffer();
    gl.bindRenderbuffer(gl.RENDERBUFFER, depth);
    gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, width, height);
    gl.bindRenderbuffer(gl.RENDERBUFFER, null);
    gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, depth);
   
    var floatExt = gl.getFloatExtension({
        require: ['renderable'],
        prefer:  ['filterable', 'half']
    });
    
    // create shadow map
    var shadowMap = gl.createTexture();
    gl.bindTexture(gl.TEXTURE_CUBE_MAP, shadowMap);
    for (var i = 0; i < 6; i++)
    {
        var target = gl.TEXTURE_CUBE_MAP_POSITIVE_X + i;
        gl.texImage2D(target, 0, gl.RGBA, width, height, 0, gl.RGBA, floatExt.type, null);  
    }
    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
    //gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
    //gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
    gl.bindTexture(gl.TEXTURE_CUBE_MAP, null);
    
    gl.bindFramebuffer(gl.FRAMEBUFFER, null);
    
    this.bindForWriting = function(face)
    {
        var glFace = 0;
        switch (face)
        {
            case eCubeMapFace.Positive_X: glFace = gl.TEXTURE_CUBE_MAP_POSITIVE_X; break;
            case eCubeMapFace.Negative_X: glFace = gl.TEXTURE_CUBE_MAP_NEGATIVE_X; break;
            case eCubeMapFace.Positive_Y: glFace = gl.TEXTURE_CUBE_MAP_POSITIVE_Y; break;
            case eCubeMapFace.Negative_Y: glFace = gl.TEXTURE_CUBE_MAP_NEGATIVE_Y; break;
            case eCubeMapFace.Positive_Z: glFace = gl.TEXTURE_CUBE_MAP_POSITIVE_Z; break;
            case eCubeMapFace.Negative_Z: glFace = gl.TEXTURE_CUBE_MAP_NEGATIVE_Z; break;
            default: return false;
        }
        
        gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);
        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, glFace, shadowMap, 0);
        /*
        var status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);
        if (status != gl.FRAMEBUFFER_COMPLETE)
        {
            gl.bindFramebuffer(gl.FRAMEBUFFER, null);
            return false;
        }
        */
        gl.viewport(0, 0, width, height);
        gl.clearColor(FLT_MAX, 0, 0, 0);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
        
        return true;
    }
    
    this.bindForReading = function()
    {
        gl.bindFramebuffer(gl.FRAMEBUFFER, null);
        gl.activeTexture(gl.TEXTURE0 + eTextureUnit.ShadowMap);
        gl.uniform1i(rc.getProgram().textureSamplerShadowMap, eTextureUnit.ShadowMap);
        gl.bindTexture(gl.TEXTURE_CUBE_MAP, shadowMap);
        //gl.generateMipmap(gl.TEXTURE_CUBE_MAP);
        //gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);
        //gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, gl.LINEAR_MIPMAP_LINEAR);
        //gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
        //gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE); 
    }
}


var default_fragment_lighting_vs = [
"attribute vec3 aVertexPosition;",
"attribute vec3 aVertexNormal;",
"attribute vec4 aVertexColor;",
"attribute vec2 aTextureCoord0;",   // attributes cannot be arrays and must be specified
"attribute vec2 aTextureCoord1;",   // attributes cannot be arrays and must be specified      
"", 
"uniform mat4 uProjectionMatrix;",
"uniform mat4 uViewMatrix;",
"uniform mat4 uWorldMatrix;",
"uniform mat4 uNormalMatrix;",
"",
"varying vec4 vVertexPosition;",
"varying vec4 vTransformedNormal;",
"varying vec4 vVertexColor;",
"varying vec4 vViewPosition;",
"varying vec4 vViewDirection;",
"varying vec2 vTextureCoord[" + gl_MaxTextureStages + "];",
"",
"void main()",
"{",

"   vVertexPosition = uWorldMatrix * vec4(aVertexPosition, 1);",
"   vTransformedNormal = normalize(uNormalMatrix * vec4(aVertexNormal, 0));",
"   vVertexColor = aVertexColor;",
"   vViewPosition = uViewMatrix * vec4(0, 0, 0, 1);",
"   vViewDirection = normalize(-vViewPosition);",
"   vTextureCoord[0] = aTextureCoord0;",
"   vTextureCoord[1] = aTextureCoord1;",        
"   gl_Position = uProjectionMatrix * uViewMatrix * vVertexPosition;",
"}"
].join("\n");

var default_fragment_lighting_fs = [
"#ifdef GL_ES",
"precision highp float;",
"#endif",
"",
"vec4 gAmbient;",
"vec4 gDiffuse;",
"vec4 gSpecular;",
"",
"uniform vec4 uGlobalAmbientLight;",                    
"",
"struct lightSource",
"{",
"   int enabled;",
"   vec4 ambient;",
"   vec4 diffuse;",
"   vec4 specular;",
"   vec4 position;",
"   vec4 spotDirection;",
"   float spotExponent;",
"   float spotCutoff;",
"   float constantAttenuation;",
"   float linearAttenuation;",
"   float quadraticAttenuation;",
"   float range;",
"};",
"uniform lightSource uLightSource[" + gl_MaxLights + "];",
"",
"struct material",
"{",
"   vec4 ambient;",
"   vec4 diffuse;",
"   vec4 specular;",
"   vec4 emission;",
"   float shininess;",
"};",
"uniform material uFrontMaterial;",
"",
"uniform int uLightingEnabled;",
"uniform int uTexturesEnabled;",
"uniform int uTextureStageEnabled[" + gl_MaxTextureStages + "];",       
"uniform sampler2D uTextureSamplerColor[" + gl_MaxTextureStages + "];",
"uniform sampler2D uTextureSamplerAlpha[" + gl_MaxTextureStages + "];",
"uniform int uTextureBlendOp;",
"uniform vec4 uTextureColorMask;",
"uniform vec4 uClipPlane[" + gl_MaxClipPlanes + "];",
"uniform int uClipPlaneEnabled[" + gl_MaxClipPlanes + "];",
"",
"varying vec4 vVertexPosition;",
"varying vec4 vTransformedNormal;",
"varying vec4 vVertexColor;",
"varying vec4 vViewPosition;",
"varying vec4 vViewDirection;",
"varying vec2 vTextureCoord[" + gl_MaxTextureStages + "];",
"",
"void directionalLight(vec4 position, vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 halfVector)",
"{",
"   vec3 lightDir;",
"   float nDotL;",      // normal . light direction
"   float nDotHV;",     // normal . half-vector
"   float pf;",         // power factor
"",
"   lightDir = normalize(vec3(position));",
"",	
"   nDotL = max(dot(normal, lightDir), 0.0);",
"   if (nDotL == 0.0)",
"   {",
"       pf = 0.0;",
"   }",
"   else",
"   {",
"       nDotHV = max(0.0, dot(normal, halfVector));",
"       pf = pow(nDotHV, uFrontMaterial.shininess);",
"   }",
"",
"   gAmbient  += ambient * uFrontMaterial.ambient;",
"   gDiffuse  += diffuse * uFrontMaterial.diffuse * nDotL;",
"   gSpecular += specular * uFrontMaterial.specular * pf;",
"}",
"",
"void pointLight(vec4 position, float constantAttenuation, float linearAttenuation, float quadraticAttenuation, float range,",
"                vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 eye, vec3 vPosition)",
"{",
"   float nDotL;",      // normal . light direction
"   float nDotHV;",     // normal . light half vector
"   float pf;",         // power factor
"   float attenuation;",// computed attenuation factor
"   float d;",          // distance from surface to light source
"   vec3  L;",          // direction from surface to light position
"   vec3  halfVector;", //
"",
"", // Compute vector from surface to light position
"   L = vec3(position) - vPosition;",
"",
"", // Compute distance between surface and light position; if greater than range, return
"   d = length(L); if (d > range) return;",
"",
"", // Normalize the vector from surface to light position,
"   L = normalize(L);",
"",
"", // Compute attenuation,
"   attenuation = 1.0 / (constantAttenuation +",
"      linearAttenuation * d +",
"      quadraticAttenuation * d * d);",
"",
"   nDotL = max(0.0, dot(normal, L));",
"   nDotHV = max(0.0, dot(normal, normalize(L + eye)));",
"",
"   if (nDotL == 0.0)",
"   {",
"       pf = 0.0;",
"   }",
"   else",
"   {",
"       pf = pow(nDotHV, uFrontMaterial.shininess);",
"   }",
"",    
"   gAmbient  += ambient * uFrontMaterial.ambient * attenuation;",
"   gDiffuse  += diffuse * uFrontMaterial.diffuse * nDotL * attenuation;",
"   gSpecular += specular * uFrontMaterial.specular * pf * attenuation;",
"}",
"",
"void main()",
"{",
"   vec4 lightingFactor;",
"   if (uLightingEnabled != 0)",
"   {",
"       gAmbient = vec4(0, 0, 0, 0);",
"       gDiffuse = vec4(0, 0, 0, 0);",
"       gSpecular = vec4(0, 0, 0, 0);",
"",
"       for (int i=0; i < " + gl_MaxLights + "; i++)",
"       {",
"           if (uLightSource[i].enabled != 0)",
"           {",
"               if (uLightSource[i].position[3] == 0.0)", // directional light
"               {",
"                   directionalLight(uLightSource[i].position, uLightSource[i].ambient,",
"                       uLightSource[i].diffuse, uLightSource[i].specular,",
"                       normalize(vec3(vTransformedNormal)),",
"                       normalize(vec3(vViewDirection) + vec3(uLightSource[i].position)));",
"               }",
"               else if (uLightSource[i].spotCutoff > 90.0)", // point light
"               {",
"                   pointLight(uLightSource[i].position, uLightSource[i].constantAttenuation,",
"                       uLightSource[i].linearAttenuation, uLightSource[i].quadraticAttenuation, uLightSource[i].range,",
"                       uLightSource[i].ambient, uLightSource[i].diffuse, uLightSource[i].specular,",
"                       normalize(vec3(vTransformedNormal)),",
"                       vec3(vViewDirection), vec3(vVertexPosition));",
"               }",
"               else", // spotlight
"               {",
"               }",   
"           }",
"       }",
"",
"       lightingFactor  = uGlobalAmbientLight * uFrontMaterial.ambient;", // global ambient contribution
"       lightingFactor += gAmbient + gDiffuse + gSpecular;", // light contribution(s)
"       lightingFactor.a  = uFrontMaterial.ambient.a / 3.0 + ",
"                           uFrontMaterial.diffuse.a / 3.0 + ",
"                           uFrontMaterial.specular.a / 3.0;",
"   }",
"   else", // uLightingEnabled == 0
"   {",
"       lightingFactor = vVertexColor;",
"   }",
"",
"   vec4 fragmentColor;",
"   vec4 fragmentColor1;",
"   vec4 fragmentColor2;",
"",
"   for (int i=0; i < " + gl_MaxClipPlanes + "; i++)",
"   {",
"       if (uClipPlaneEnabled[i] != 0)",
"       {",
"           if (dot(vVertexPosition.xyz, uClipPlane[i].xyz) - uClipPlane[i].w >= 0.0) discard;",    
"       }",
"   }",
"",
"   if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 0)",
"   {",
"       fragmentColor = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));",
"       if (fragmentColor.r == uTextureColorMask.r && fragmentColor.g == uTextureColorMask.g && fragmentColor.b == uTextureColorMask.b && fragmentColor.a == uTextureColorMask.a) discard;",
"       if (uTextureBlendOp == " + RC_MODULATE + ")",
"       {",
"           if (fragmentColor.a == 0.0) discard;",
"           else gl_FragColor = fragmentColor * lightingFactor;",
"       }",
"       else if (uTextureBlendOp == " + RC_REPLACE + ")",
"       {",
"           gl_FragColor = fragmentColor;",
"       }",
"       else",
"       {",
"           gl_FragColor = lightingFactor;",
"       }",
"   }",
"   else if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 1)",
"   {",
"       fragmentColor1 = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));",
"       fragmentColor2 = texture2D(uTextureSamplerColor[1], vec2(vTextureCoord[1].s, vTextureCoord[1].t));",
"       if (uTextureBlendOp == " + RC_MODULATE + ")",
"       {",
"           fragmentColor1.a = fragmentColor2.a;",
"           if (fragmentColor1.a == 0.0) discard;",
"           else gl_FragColor = fragmentColor1 * lightingFactor;",
"       }",
"       else if (uTextureBlendOp == " + RC_REPLACE + ")",
"       {",
"           gl_FragColor = fragmentColor1 * fragmentColor2;",
"       }",
"       else",
"       {",
"           gl_FragColor = lightingFactor;",
"       }",
"   }",
"   else", // uTexturesEnabled == 0 || (uTextureStageEnabled[0] == 0 && uTextureStageEnabled[1] == 1)
"   {",
"       gl_FragColor = lightingFactor;",
"   }",
"}"
].join("\n");


var default_vertex_lighting_vs = [
"#ifdef GL_ES",
"precision highp float;",
"#endif",
"",
"vec4 gAmbient;",
"vec4 gDiffuse;",
"vec4 gSpecular;",
"",
"attribute vec3 aVertexPosition;",
"attribute vec3 aVertexNormal;",
"attribute vec4 aVertexColor;",
"attribute vec2 aTextureCoord0;",   // attributes cannot be arrays and must be specified
"attribute vec2 aTextureCoord1;",   // attributes cannot be arrays and must be specified      
"", 
"uniform mat4 uProjectionMatrix;",
"uniform mat4 uViewMatrix;",
"uniform mat4 uWorldMatrix;",
"uniform mat4 uNormalMatrix;",
"",
"uniform vec4 uGlobalAmbientLight;",
"",
"struct lightSource",
"{",
"   int enabled;",
"   vec4 ambient;",
"   vec4 diffuse;",
"   vec4 specular;",
"   vec4 position;",
"   vec4 spotDirection;",
"   float spotExponent;",
"   float spotCutoff;",
"   float constantAttenuation;",
"   float linearAttenuation;",
"   float quadraticAttenuation;",
"   float range;",
"};",
"uniform lightSource uLightSource[" + gl_MaxLights + "];",
"",
"struct material",
"{",
"   vec4 ambient;",
"   vec4 diffuse;",
"   vec4 specular;",
"   vec4 emission;",
"   float shininess;",
"};",
"uniform material uFrontMaterial;",
"",
"uniform int uLightingEnabled;",
"",
"varying vec4 vVertexPosition;",
"varying vec4 vLightingFactor;",
"varying vec2 vTextureCoord[" + gl_MaxTextureStages + "];",
"",
"void directionalLight(vec4 position, vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 halfVector)",
"{",
"   vec3 lightDir;",
"   float nDotL;",      // normal . light direction
"   float nDotHV;",     // normal . half-vector
"   float pf;",         // power factor
"",
"   lightDir = normalize(vec3(position));",
"",	
"   nDotL = max(dot(normal, lightDir), 0.0);",
"   if (nDotL == 0.0)",
"   {",
"       pf = 0.0;",
"   }",
"   else",
"   {",
"       nDotHV = max(0.0, dot(normal, halfVector));",
"       pf = pow(nDotHV, uFrontMaterial.shininess);",
"   }",
"",
"   gAmbient  += ambient * uFrontMaterial.ambient;",
"   gDiffuse  += diffuse * uFrontMaterial.diffuse * nDotL;",
"   gSpecular += specular * uFrontMaterial.specular * pf;",
"}",
"",
"void pointLight(vec4 position, float constantAttenuation, float linearAttenuation, float quadraticAttenuation, float range,",
"                vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 eye, vec3 vPosition)",
"{",
"   float nDotL;",      // normal . light direction
"   float nDotHV;",     // normal . light half vector
"   float pf;",         // power factor
"   float attenuation;",// computed attenuation factor
"   float d;",          // distance from surface to light source
"   vec3  L;",          // direction from surface to light position
"   vec3  halfVector;", //
"",
"", // Compute vector from surface to light position
"   L = vec3(position) - vPosition;",
"",
"", // Compute distance between surface and light position; if greater than range, return
"   d = length(L); if (d > range) return;",
"",
"", // Normalize the vector from surface to light position,
"   L = normalize(L);",
"",
"", // Compute attenuation,
"   attenuation = 1.0 / (constantAttenuation +",
"      linearAttenuation * d +",
"      quadraticAttenuation * d * d);",
"",
"   nDotL = max(0.0, dot(normal, L));",
"   nDotHV = max(0.0, dot(normal, normalize(L + eye)));",
"",
"   if (nDotL == 0.0)",
"   {",
"       pf = 0.0;",
"   }",
"   else",
"   {",
"       pf = pow(nDotHV, uFrontMaterial.shininess);",
"   }",
"",    
"   gAmbient  += ambient * uFrontMaterial.ambient * attenuation;",
"   gDiffuse  += diffuse * uFrontMaterial.diffuse * nDotL * attenuation;",
"   gSpecular += specular * uFrontMaterial.specular * pf * attenuation;",
"}",
"",
"void main()",
"{",
"   vec4 transformedNormal;",
"   vec4 viewPosition;",
"   vec4 viewDirection;",
"",
"   vVertexPosition = uWorldMatrix * vec4(aVertexPosition, 1);",
"",
"   if (uLightingEnabled != 0)",
"   {",                    
"       transformedNormal = normalize(uNormalMatrix * vec4(aVertexNormal, 0));",
"       viewPosition = uViewMatrix * vec4(0, 0, 0, 1);",
"       viewDirection = normalize(-viewPosition);",

"       gAmbient = vec4(0, 0, 0, 0);",
"       gDiffuse = vec4(0, 0, 0, 0);",
"       gSpecular = vec4(0, 0, 0, 0);",
"",
"       for (int i=0; i < " + gl_MaxLights + "; i++)",
"       {",
"           if (uLightSource[i].enabled != 0)",
"           {",
"               if (uLightSource[i].position[3] == 0.0)", // directional light
"               {",
"                   directionalLight(uLightSource[i].position, uLightSource[i].ambient,",
"                       uLightSource[i].diffuse, uLightSource[i].specular,",
"                       normalize(vec3(transformedNormal)),",
"                       normalize(vec3(viewDirection) + vec3(uLightSource[i].position)));",
"               }",
"               else if (uLightSource[i].spotCutoff > 90.0)", // point light
"               {",
"                   pointLight(uLightSource[i].position, uLightSource[i].constantAttenuation,",
"                       uLightSource[i].linearAttenuation, uLightSource[i].quadraticAttenuation, uLightSource[i].range,",
"                       uLightSource[i].ambient, uLightSource[i].diffuse, uLightSource[i].specular,",
"                       normalize(vec3(transformedNormal)),",
"                       vec3(viewDirection), vec3(vVertexPosition));",
"               }",
"               else", // spotlight
"               {",
"               }",   
"           }",
"       }",
"",
"       vLightingFactor  = uGlobalAmbientLight * uFrontMaterial.ambient;", // global ambient contribution
"       vLightingFactor += gAmbient + gDiffuse + gSpecular;", // light contribution(s)
"       vLightingFactor.a = uFrontMaterial.ambient.a / 3.0 + ",
"                           uFrontMaterial.diffuse.a / 3.0 + ",
"                           uFrontMaterial.specular.a / 3.0;",
"   }",
"   else", // uLightingEnabled == 0
"   {",  
"       vLightingFactor = aVertexColor;",
"   }",
"",
"   vTextureCoord[0] = aTextureCoord0;",
"   vTextureCoord[1] = aTextureCoord1;",        
"   gl_Position = uProjectionMatrix * uViewMatrix * vVertexPosition;",
"}"
].join("\n");
    
var default_vertex_lighting_fs = [
"#ifdef GL_ES",
"precision highp float;",
"#endif",
"",
"uniform int uTexturesEnabled;",
"uniform int uTextureStageEnabled[" + gl_MaxTextureStages + "];",       
"uniform sampler2D uTextureSamplerColor[" + gl_MaxTextureStages + "];",
"uniform sampler2D uTextureSamplerAlpha[" + gl_MaxTextureStages + "];",
"uniform int uTextureBlendOp;",
"uniform vec4 uTextureColorMask;",
"uniform vec4 uClipPlane[" + gl_MaxClipPlanes + "];",
"uniform int uClipPlaneEnabled[" + gl_MaxClipPlanes + "];",
"",
"varying vec4 vVertexPosition;",
"varying vec4 vLightingFactor;",
"varying vec2 vTextureCoord[" + gl_MaxTextureStages + "];",
"",
"void main()",
"{",
"   vec4 fragmentColor;",
"   vec4 fragmentColor1;",
"   vec4 fragmentColor2;",
"",
"   for (int i=0; i < " + gl_MaxClipPlanes + "; i++)",
"   {",
"       if (uClipPlaneEnabled[i] != 0)",
"       {",
"           if (dot(vVertexPosition.xyz, uClipPlane[i].xyz) - uClipPlane[i].w >= 0.0) discard;",    
"       }",
"   }",
"",
"   if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 0)",
"   {",
"       fragmentColor = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));",
"       if (fragmentColor.r == uTextureColorMask.r && fragmentColor.g == uTextureColorMask.g && fragmentColor.b == uTextureColorMask.b && fragmentColor.a == uTextureColorMask.a) discard;",
"       if (uTextureBlendOp == " + RC_MODULATE + ")",
"       {",
"           if (fragmentColor.a == 0.0) discard;",
"           else gl_FragColor = fragmentColor * vLightingFactor;",
"       }",
"       else if (uTextureBlendOp == " + RC_REPLACE + ")",
"       {",
"           gl_FragColor = fragmentColor;",
"       }",
"       else",
"       {",
"           gl_FragColor = vLightingFactor;",
"       }",
"   }",
"   else if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 1)",
"   {",
"       fragmentColor1 = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));",
"       fragmentColor2 = texture2D(uTextureSamplerColor[1], vec2(vTextureCoord[1].s, vTextureCoord[1].t));",
"       if (uTextureBlendOp == " + RC_MODULATE + ")",
"       {",
"           fragmentColor1.a = fragmentColor2.a;",
"           if (fragmentColor1.a == 0.0) discard;",
"           else gl_FragColor = fragmentColor1 * vLightingFactor;",
"       }",
"       else if (uTextureBlendOp == " + RC_REPLACE + ")",
"       {",
"           gl_FragColor = fragmentColor1 * fragmentColor2;",
"       }",
"       else",
"       {",
"           gl_FragColor = vLightingFactor;",
"       }",
"   }",
"   else", // uTexturesEnabled == 0 || (uTextureStageEnabled[0] == 0 && uTextureStageEnabled[1] == 0)
"   {",
"       gl_FragColor = vLightingFactor;",
"   }",
"}"
].join("\n");
var pcf_shadow_mapping_depth_pass_vs = [
"#ifdef GL_ES",
"precision highp float;",
"#endif",
"",
"attribute vec3 aVertexPosition;",
"attribute vec3 aVertexNormal;", 
"", 
"uniform mat4 uProjectionMatrix;",
"uniform mat4 uViewMatrix;",
"uniform mat4 uWorldMatrix;",
"uniform mat4 uNormalMatrix;",
"",
"varying vec4 vVertexPosition;",
"varying vec4 vTransformedNormal;",
"",
"void main()",
"{",
"   vVertexPosition = uWorldMatrix * vec4(aVertexPosition, 1);",
"   vTransformedNormal = normalize(uNormalMatrix * vec4(aVertexNormal, 0));",
"   gl_Position = uProjectionMatrix * uViewMatrix * vVertexPosition;",
"}"
].join("\n");

var pcf_shadow_mapping_depth_pass_fs = [
"#ifdef GL_ES",
"precision highp float;",
"#endif",
//"#extension GL_OES_standard_derivatives : enable",
"",
"uniform vec3 uShadowCasterWorldPosition;",
"uniform int uModelID;",
"",
"varying vec4 vVertexPosition;",
"varying vec4 vTransformedNormal;",
"",
"void main()",
"{",
"   float depth = length(vVertexPosition.xyz - uShadowCasterWorldPosition);",
//"   float moment1 = depth;",
//"   float moment2 = depth * depth;",
//"   float dx = dFdx(depth);",
//"   float dy = dFdy(depth);",
//"   moment2 += 0.25*(dx*dx+dy*dy);", 
//"   gl_FragColor = vec4(moment1, moment2, 0, 0);",
"   gl_FragColor = vec4(depth, uModelID, 0, 0);",
"}"
].join("\n");
var pcf_shadow_mapping_render_pass_vs = [
"attribute vec3 aVertexPosition;",
"attribute vec3 aVertexNormal;",
"attribute vec4 aVertexColor;",
"attribute vec2 aTextureCoord0;",   // attributes cannot be arrays and must be specified
"attribute vec2 aTextureCoord1;",   // attributes cannot be arrays and must be specified      
"", 
"uniform mat4 uProjectionMatrix;",
"uniform mat4 uViewMatrix;",
"uniform mat4 uWorldMatrix;",
"uniform mat4 uNormalMatrix;",
"",
"varying vec4 vVertexPosition;",
"varying vec4 vTransformedNormal;",
"varying vec4 vVertexColor;",
"varying vec4 vViewPosition;",
"varying vec4 vViewDirection;",
"varying vec2 vTextureCoord[" + gl_MaxTextureStages + "];",
"",
"void main()",
"{",
"   vVertexPosition = uWorldMatrix * vec4(aVertexPosition, 1);",
"   vTransformedNormal = normalize(uNormalMatrix * vec4(aVertexNormal, 0));",
"   vVertexColor = aVertexColor;",
"   vViewPosition = uViewMatrix * vec4(0, 0, 0, 1);",
"   vViewDirection = normalize(-vViewPosition);",
"   vTextureCoord[0] = aTextureCoord0;",
"   vTextureCoord[1] = aTextureCoord1;",        
"   gl_Position = uProjectionMatrix * uViewMatrix * vVertexPosition;",
"}"
].join("\n");

var pcf_shadow_mapping_render_pass_fs = [
"#ifdef GL_ES",
"precision highp float;",
"#endif",
"",
"#define EPSILON 0.1",
"",
"vec4 gAmbient;",
"vec4 gDiffuse;",
"vec4 gSpecular;",
"",
"uniform vec4 uGlobalAmbientLight;",                    
"",
"struct lightSource",
"{",
"   int enabled;",
"   vec4 ambient;",
"   vec4 diffuse;",
"   vec4 specular;",
"   vec4 position;",
"   vec4 spotDirection;",
"   float spotExponent;",
"   float spotCutoff;",
"   float constantAttenuation;",
"   float linearAttenuation;",
"   float quadraticAttenuation;",
"   float range;",
"};",
"uniform lightSource uLightSource[" + gl_MaxLights + "];",
"",
"struct material",
"{",
"   vec4 ambient;",
"   vec4 diffuse;",
"   vec4 specular;",
"   vec4 emission;",
"   float shininess;",
"};",
"uniform material uFrontMaterial;",
"",
"uniform int uLightingEnabled;",
"uniform int uTexturesEnabled;",
"uniform int uTextureStageEnabled[" + gl_MaxTextureStages + "];",       
"uniform sampler2D uTextureSamplerColor[" + gl_MaxTextureStages + "];",
"uniform sampler2D uTextureSamplerAlpha[" + gl_MaxTextureStages + "];",
"uniform samplerCube uTextureSamplerShadowMap;",
"uniform int uTextureBlendOp;",
"uniform vec4 uTextureColorMask;",
"uniform vec4 uClipPlane[" + gl_MaxClipPlanes + "];",
"uniform int uClipPlaneEnabled[" + gl_MaxClipPlanes + "];",
"uniform vec3 uShadowCasterWorldPosition;",
"uniform int uModelID;",
"",
"varying vec4 vVertexPosition;",
"varying vec4 vTransformedNormal;",
"varying vec4 vVertexColor;",
"varying vec4 vViewPosition;",
"varying vec4 vViewDirection;",
"varying vec2 vTextureCoord[" + gl_MaxTextureStages + "];",
"",
"float shadowFactor(vec3 lightDirection, float cosTheta)",
"{",
"   float distance = length(lightDirection);",
"   lightDirection.y = -lightDirection.y;",
"   vec2 moments = textureCube(uTextureSamplerShadowMap, lightDirection).rg;", 
//"   float moment = textureCube(uTextureSamplerShadowMap, lightDirection).r;",
"",
"   float bias = EPSILON * tan(acos(cosTheta));",
"   if (distance <= moments.x + bias)",
//"   if (distance <= moment + bias)",
"       return 1.0;",
"   else if (abs(float(uModelID) - moments.y) >= 1.0)",
"   {",
//"       float variance = moments.y - (moments.x * moments.x);",
//"       variance = max(variance, 0.07);",
//"",
//"       float d = distance - moments.x;",
//"       float p_max = variance / (variance + d * d);",
//"", 
"       return 0.25;//p_max;",
"   }",
"   else return 1.0;",
"}",
"",
"void directionalLight(vec4 position, vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 halfVector)",
"{",
"   vec3 lightDir;",
"   float nDotL;",      // normal . light direction
"   float nDotHV;",     // normal . half-vector
"   float pf;",         // power factor
"",
"   lightDir = normalize(vec3(position));",
"",	
"   nDotL = max(dot(normal, lightDir), 0.0);",
"   if (nDotL == 0.0)",
"   {",
"       pf = 0.0;",
"   }",
"   else",
"   {",
"       nDotHV = max(0.0, dot(normal, halfVector));",
"       pf = pow(nDotHV, uFrontMaterial.shininess);",
"   }",
"",
"   gAmbient  += ambient * uFrontMaterial.ambient;",
"   gDiffuse  += diffuse * uFrontMaterial.diffuse * nDotL;",
"   gSpecular += specular * uFrontMaterial.specular * pf;",
"}",
"",
"void pointLight(vec4 position, float constantAttenuation, float linearAttenuation, float quadraticAttenuation, float range,",
"                vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 eye, vec3 vPosition)",
"{",
"   float nDotL;",      // normal . light direction
"   float nDotHV;",     // normal . light half vector
"   float pf;",         // power factor
"   float attenuation;",// computed attenuation factor
"   float d;",          // distance from surface to light source
"   vec3  L;",          // direction from surface to light position
"   vec3  halfVector;", //
"",
"", // Compute vector from surface to light position
"   L = vec3(position) - vPosition;",
"",
"", // Compute distance between surface and light position; if greater than range, return
"   d = length(L); if (d > range) return;",
"",
"", // Normalize the vector from surface to light position,
"   L = normalize(L);",
"",
"", // Compute attenuation,
"   attenuation = 1.0 / (constantAttenuation +",
"      linearAttenuation * d +",
"      quadraticAttenuation * d * d) *",
"      shadowFactor(vPosition - uShadowCasterWorldPosition, max(0.0, dot(normal, L)));",
"",
"   nDotL = max(0.0, dot(normal, L));",
"   nDotHV = max(0.0, dot(normal, normalize(L + eye)));",
"",
"   if (nDotL == 0.0)",
"   {",
"       pf = 0.0;",
"   }",
"   else",
"   {",
"       pf = pow(nDotHV, uFrontMaterial.shininess);",
"   }",
"",    
"   gAmbient  += ambient * uFrontMaterial.ambient * attenuation;",
"   gDiffuse  += diffuse * uFrontMaterial.diffuse * nDotL * attenuation;",
"   gSpecular += specular * uFrontMaterial.specular * pf * attenuation;",
"}",
"",
"void main()",
"{",
"   vec4 lightingFactor;",
"   if (uLightingEnabled != 0)",
"   {",
"       gAmbient = vec4(0, 0, 0, 0);",
"       gDiffuse = vec4(0, 0, 0, 0);",
"       gSpecular = vec4(0, 0, 0, 0);",
"",
"       for (int i=0; i < " + gl_MaxLights + "; i++)",
"       {",
"           if (uLightSource[i].enabled != 0)",
"           {",
"               if (uLightSource[i].position[3] == 0.0)", // directional light
"               {",
"                   directionalLight(uLightSource[i].position, uLightSource[i].ambient,",
"                       uLightSource[i].diffuse, uLightSource[i].specular,",
"                       normalize(vec3(vTransformedNormal)),",
"                       normalize(vec3(vViewDirection) + vec3(uLightSource[i].position)));",
"               }",
"               else if (uLightSource[i].spotCutoff > 90.0)", // point light
"               {",
"                   pointLight(uLightSource[i].position, uLightSource[i].constantAttenuation,",
"                       uLightSource[i].linearAttenuation, uLightSource[i].quadraticAttenuation, uLightSource[i].range,",
"                       uLightSource[i].ambient, uLightSource[i].diffuse, uLightSource[i].specular,",
"                       normalize(vec3(vTransformedNormal)),",
"                       vec3(vViewDirection), vec3(vVertexPosition));",
"               }",
"               else", // spotlight
"               {",
"               }",   
"           }",
"       }",
"",
"       lightingFactor  = uGlobalAmbientLight * uFrontMaterial.ambient;", // global ambient contribution
"       lightingFactor += gAmbient + gDiffuse + gSpecular;", // light contribution(s)
"       lightingFactor.a  = uFrontMaterial.ambient.a / 3.0 + ",
"                           uFrontMaterial.diffuse.a / 3.0 + ",
"                           uFrontMaterial.specular.a / 3.0;",
"   }",
"   else", // uLightingEnabled == 0
"   {",
"       lightingFactor = vVertexColor;",
"   }",
"",
"   vec4 fragmentColor;",
"   vec4 fragmentColor1;",
"   vec4 fragmentColor2;",
"",
"   for (int i=0; i < " + gl_MaxClipPlanes + "; i++)",
"   {",
"       if (uClipPlaneEnabled[i] != 0)",
"       {",
"           if (dot(vVertexPosition.xyz, uClipPlane[i].xyz) - uClipPlane[i].w >= 0.0) discard;",    
"       }",
"   }",
"",
"   if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 0)",
"   {",
"       fragmentColor = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));",
"       if (fragmentColor.r == uTextureColorMask.r && fragmentColor.g == uTextureColorMask.g && fragmentColor.b == uTextureColorMask.b && fragmentColor.a == uTextureColorMask.a) discard;",
"       if (uTextureBlendOp == " + RC_MODULATE + ")",
"       {",
"           if (fragmentColor.a == 0.0) discard;",
"           else gl_FragColor = fragmentColor * lightingFactor;",
"       }",
"       else if (uTextureBlendOp == " + RC_REPLACE + ")",
"       {",
"           gl_FragColor = fragmentColor;",
"       }",
"       else",
"       {",
"           gl_FragColor = lightingFactor;",
"       }",
"   }",
"   else if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 1)",
"   {",
"       fragmentColor1 = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));",
"       fragmentColor2 = texture2D(uTextureSamplerColor[1], vec2(vTextureCoord[1].s, vTextureCoord[1].t));",
"       if (uTextureBlendOp == " + RC_MODULATE + ")",
"       {",
"           fragmentColor1.a = fragmentColor2.a;",
"           if (fragmentColor1.a == 0.0) discard;",
"           else gl_FragColor = fragmentColor1 * lightingFactor;",
"       }",
"       else if (uTextureBlendOp == " + RC_REPLACE + ")",
"       {",
"           gl_FragColor = fragmentColor1 * fragmentColor2;",
"       }",
"       else",
"       {",
"           gl_FragColor = lightingFactor;",
"       }",
"   }",
"   else", // uTexturesEnabled == 0 || (uTextureStageEnabled[0] == 0 && uTextureStageEnabled[1] == 1)
"   {",
"       gl_FragColor = lightingFactor;",
"   }",
"}"
].join("\n");


ContentHandler.prototype = new AttributeContainer();
ContentHandler.prototype.constructor = ContentHandler;

function ContentHandler()
{
    AttributeContainer.call(this);
    this.className = "ContentHandler";
    
    this.contentDirectory = new StringAttr("");
    this.url = new StringAttr("");
    
    this.registerAttribute(this.contentDirectory, "contentDirectory");
    this.registerAttribute(this.url, "url");
}

ContentHandler.prototype.parseFileStream = function(file)
{
}

ContentHandler.prototype.matchesType = function(type)
{
}

ContentBuilder.prototype = new AttributeContainer();
ContentBuilder.prototype.constructor = ContentBuilder;

function ContentBuilder()
{
    AttributeContainer.call(this);
    this.className = "ContentBuilder";
    
    this.factory = null;
    
    this.cameras = [];
    this.lights = [];
    this.models = [];
    this.evaluators = [];
    
    this.layer = 0;
    this.invertAlpha = new BooleanAttr(false);
    
    this.registerAttribute(this.invertAlpha, "invertAlpha");
}

ContentBuilder.prototype.setRegistry = function(registry)
{
    AttributeContainer.prototype.setRegistry.call(this, registry); 
    
    this.factory = this.registry.find("AttributeFactory");   
}

ContentBuilder.prototype.visitHandler = function(handler)
{
}
/*
ContentBuilder.prototype.configure = function(models, evaluators)
{
    this.models = models;
    this.evaluators = evaluators;
}
*/
ContentBuilder.prototype.finalize = function()
{
}

ContentBuilder.prototype.matchesType = function(type)
{
}

function BinaryParser(stream, bigEndian)
{
    this.stream = stream;
    this.bigEndian = bigEndian;
    
    this.readUInt8  = function() { return this.decodeInt(8, false); }
    this.readUInt16 = function() { return this.decodeInt(16, false); }
    this.readUInt32 = function() { return this.decodeInt(32, false); }
    this.readInt8   = function() { return this.decodeInt(8, true); }
    this.readInt16  = function() { return this.decodeInt(16, true); }
    this.readInt32  = function() { return this.decodeInt(32, true); }
    this.readFloat32 = function(){ return this.decodeFloat32(); }
   
    var pos = 0;
     
    this.decodeInt = function(bits, signed)
    {
        var sum = 0;
        var bytes = bits / 8;
        var byteValue = 0;
        
        // sum bytes
        for (var B=0; B < bytes; B++)
        {
            byteValue = this.bigEndian ? this.stream.charCodeAt(pos+B) 
                                       : this.stream.charCodeAt(pos+(bytes-B-1));
            // sum bits
            for (var b=7; b >= 0; b--)
            {
                sum = sum * 2 + ((1 << b) & byteValue ? 1 : 0);
            }
        }
        
        // account for sign
        if (signed)
        {
            max = Math.pow(2, bits);
            sum = sum >= max / 2 ? sum - max : sum;
        }
        
        // advance stream position
        pos += bytes;
        
        return sum;
	}
	
	// based upon example from: http://en.wikipedia.org/wiki/Binary32
	this.decodeFloat32 = function()
	{
	    var sum = 0;
	    var bytes = 4;
	    var byteValue = new Array(bytes);
	    
	    // read the bytes representing the float
	    for (var B=0; B < bytes; B++)
	    {
	        this.bigEndian ? byteValue[B] = this.stream.charCodeAt(pos+B)
	                       : byteValue[B] = this.stream.charCodeAt(pos+(bytes-B-1));
	    }
	    
	    // read sign bit (bit 31)
	    var negative = byteValue[0] & 0x80;

	    // read exponent bits (bits 30-23)
	    var exponent = 0; 
	    for (var e=6; e >= 0; e--)
        {
            exponent = exponent * 2 + ((1 << e) & byteValue[0] ? 1 : 0);
        }
        exponent = exponent * 2 + (0x80 & byteValue[1] ? 1 : 0);
	    
	    // read significand bits (bits 22-0)
	    var significand = 0;
	    // byte 1
	    for (var s=6; s >= 0; s--)
	    {
	        significand = significand * 2 + ((1 << s) & byteValue[1] ? 1 : 0);
	    }
	    // byte 2, 3
	    for (var B=2; B <= 3; B++)
	    {
	        for (var s=7; s >= 0; s--)
	        {
	            significand = significand * 2 + ((1 << s) & byteValue[B] ? 1 : 0);
	        }
	    }

        // decode exponent by subtracting 127
        var decodedExponent = exponent - 127;
        
        // decode the significand using:
        // each of the 24 bits of the significand, bit 23 to bit 0, represents a value, 
        // starting at 1 and halves for each bit:
        // bit 23 = 1
        // bit 22 = 0.5
        // bit 21 = 0.25
        // bit 20 = 0.125
        // bit 19 = 0.0625
        // .
        // .
        // bit  0 = 0.00000011920928955078125
        var decodedSignificand = 1; // implicit 24th bit set to 1
        var bitvalue = 1;
        for (var s=23; s >= 0; s--)
        {
            decodedSignificand = decodedSignificand + ((1 << s) & significand ? bitvalue : 0);
            bitvalue /= 2;
        }
        
        // multiply significand with the base, 2, to the power of the exponent to get the final result
        sum = decodedSignificand * Math.pow(2, decodedExponent) * (negative ? -1 : 1);
        
	    // advance stream position
	    pos += bytes;
	    
	    return sum;
	}
}
function TextParser(stream)
{
    this.stream = stream;

    var pos = 0;

    this.readCharacter = function ()
    {
        if (pos >= this.stream.length)
            return null;

        return this.stream[pos++];
    }

    this.readToken = function ()
    {
        var c;
        var token = "";

        if (pos >= this.stream.length)
            return null;

        // read leading whitespace
        do
        {
            c = this.stream[pos++];
        }
        while (pos <= this.stream.length && isSpace(c));

        // read token
        do
        {
            token += c;
            c = this.stream[pos++];
        }
        while (pos <= this.stream.length && !isSpace(c));

        return (token.length > 0 ? token : null);
    }

    this.readLine = function ()
    {
        var line = "";

        if (pos >= this.stream.length)
            return null;

        while (pos < this.stream.length && this.stream[pos] != '\n')
        {
            line += this.stream[pos++];
        }
        pos++;

        return line;
    }

    this.readLineTokens = function ()
    {
        var c;
        var p = 0;
        var token = "";
        var tokens = [];

        var line = this.readLine();
        if (line == null)
            return null;

        while (p < line.length)
        {
            // read leading whitespace
            do
            {
                c = line[p++];
            }
            while (p <= line.length && isSpace(c));

            // read token
            do
            {
                token += c;
                c = line[p++];
            }
            while (p <= line.length && !isSpace(c));

            tokens.push(token);
            token = "";
        }

        return tokens;
    }
}
function XMLParser(factory, registry, contentDir)
{
    this.factory = factory;
    this.registry = registry;
    this.contentDir = contentDir;
    this.attributeStack = new Stack();
    this.collectionCountStack = new Stack();
}

XMLParser.prototype.parse = function(xml)
{
    parser = new SAXDriver();
   
    parser.setDocumentHandler(this);
    parser.setErrorHandler(this);
    parser.setLexicalHandler(this);

    parser.parse(xml);
}

XMLParser.prototype.processingInstruction = function(target, data)
{
    switch (target)
    {
        case "bw":
            {
                // TODO
                console.debug("TODO: " + target.toString());
            }
            break;

        case "bwinclude":
            {
                var dataString = new String(data);

                // url
                var url = this.parseTokenValue(dataString, "url=\"", "\"");
                if (url)
                {
                    console.debug("Processing Instruction for: " + url);
                    var ext = getFileExtension(url);
                    switch (ext) {
                    case "xml":
                        {
                            var xml = loadXMLResource(this.contentDir + "/" + url);
                            this.parse(xml);
                        }
                        break;
                        // TODO: abstract this dependency away from here
                    case "lws":
                        {
                            var pathInfo = formatPath(url);
                            console.debug("Include instruction for path: " + pathInfo[0]);
                            console.debug("Include content dir: " + pathInfo[1]);
            
                            var contentHandler = new LWSceneHandler();
                            contentHandler.getAttribute("contentDirectory").setValueDirect(pathInfo[1]);
            
                            var contentBuilder = new LWSceneBuilder(); 
                            contentBuilder.setRegistry(this.factory.registry);
                            contentBuilder.visitHandler(contentHandler);
            
                            contentHandler.parseFileStream(pathInfo[0]); 
                        }
                        break;
                    }
                }
            }
            break;
    }
}

XMLParser.prototype.startElement = function(name, atts) 
{
    // by convention, AttributeContainers start with capital letters, and 
    // complex attributes do not.
    if (isUpper(name[0]))
    {
        this.parseAttributeContainer(name, atts);
    }
    else 
    {
        this.parseComplexAttribute(name, atts);
    }
}

XMLParser.prototype.endElement = function(name) 
{
    // by convention, AttributeContainers start with capital letters, and 
    // complex attributes do not.
    if (isUpper(name[0]))
    {
        this.parseAttributeContainer(name);
    }
    else 
    {
        this.parseComplexAttribute(name);
    }
}

XMLParser.prototype.startCDATA = function()
{
}

XMLParser.prototype.endCDATA = function()
{
}

XMLParser.prototype.characters = function(data, start, length)
{
    var value = "";
    for (var i = 0; i < length; i++)
    {
        value += data[start + i];
    }
    if (value.length && !isSpace(value[0]))
    {
        var attribute = this.attributeStack.top();
        if (attribute)
        {
            // TODO: resolve reference
            deserializeAttribute(attribute, value);
        }
    }
}

XMLParser.prototype.error = function(exception) 
{
    alert('Error: ' + exception.getMessage());
}

XMLParser.prototype.fatalError = function(exception) 
{
    alert('Fatal Error: ' + exception.getMessage());
}

XMLParser.prototype.parseAttributeContainer = function(name, atts)
{
    if (atts) // element start
    {
        var attribute = this.factory.create(name);
        if (!attribute)
        {
            this.attributeStack.push(null); // for corresponding pop at closing tag
            return;
        }
        attribute.flagDeserializedFromXML();

        if (!resolveAttributeContainerReference(attribute, atts.m_parser.m_atts, this.registry))
        {
            deserializeAttributeContainer(attribute, atts.m_parser.m_atts);
        }

        this.registry.registerResource(attribute);
        
        // if a collection is at the top of the attribute stack which does not allocate its elements,
        // add the attribute it to the collection
        var container = this.attributeStack.top();
        if (container && container.isCollection())
        {
            if (!container.allocatesElements())
            {
                container.push_back(attribute);
                container.setElementName(attribute, name);

                var count = this.collectionCountStack.top();
                count++;
                this.collectionCountStack.pop();
                this.collectionCountStack.push(count);
            }
            else
            {
                container.setElementName(container.getAt(container.Size() - 1), name);
            }
        }

        this.attributeStack.push(attribute);

        if (attribute.isCollection())
        {
            this.collectionCountStack.push(0);
        }
    }
    else // element end
    {
        var attribute = this.attributeStack.top();

        this.attributeStack.pop();

        if (attribute && attribute.isCollection())
        {
            this.collectionCountStack.pop();
        }

        if (attribute)
        {
            this.factory.finalize(name, attribute);
            this.registry.finalizeResource(attribute);
        }
    }
}

XMLParser.prototype.parseComplexAttribute = function(name, atts)
{
    if (atts) // element start
    {
        var container = this.attributeStack.top();
        if (!container) return;

        var attribute = container.getAttribute(name);
        if (!attribute)
        {
            // check for collections here... if a collection is at the top of 
            // the attribute stack, resize the collection (if necessary) to accomodate
            // the current attribute being deserialized
            if (container.isCollection())
            {
                var count = this.collectionCountStack.top();
                count++;

                var size = container.Size();

                if (container.AppendParsedElements())
                {
                    container.resize(size + 1);
                    count = size;
                }
                else if (size <= count)
                {
                    container.resize(count + 1);
                }

                attribute = container.getAt(count);
            }
            else
            {
                this.attributeStack.push(container); // for corresponding pop at closing tag (push container so that child complex attributes can access)
                return;
            }
        }

        this.attributeStack.push(attribute);

        if (attribute && attribute.isContainer())
        {
            if (!resolveAttributeContainerReference(attribute, atts.m_parser.m_atts, this.registry))
            {
                deserializeAttributeContainer(attribute, atts.m_parser.m_atts);
            }

            if (attribute.isCollection())
            {
                this.collectionCountStack.push(0);
            }
        }
        else if (attribute)
        {
            if (!resolveComplexAttributeReference(attribute, atts.m_parser.m_atts))
            {
                deserializeComplexAttribute(attribute, atts.m_parser.m_atts);
            }
        }
    }
    else // element end
    {
        this.attributeStack.pop();

        if (container && container.isCollection())
        {
            this.collectionCountStack.pop();
        }
    }
}

XMLParser.prototype.parsePrimitiveAttribute = function()
{

}

XMLParser.prototype.parseTokenValue = function(string, delim_begin, delim_end)
{
    var begin = string.indexOf(delim_begin);
    if (begin == -1)
    {
        return undefined;
    }
    begin += delim_begin.length;

    var end = string.indexOf(delim_end, begin);
    if (end == -1)
    {
        return undefined;
    }

    return string.substring(begin, end);
}


Serializer.prototype = new AttributeContainer();
Serializer.prototype.constructor = Serializer;

function Serializer()
{
    AttributeContainer.call(this);
    this.className = "Serializer";

    this.pbMixed = null;
    this.bMixed = false;
    this.DOM  = null;
    this.RootElement = null;
    this.elementStack = new Stack();
    
    this.format = new StringAttr("xml");
    this.serializeMinimum = new BooleanAttr(false);
    this.serializeChildren = new BooleanAttr(false);
    
    this.registerAttribute(this.format, "format");
    this.registerAttribute(this.serializeMinimum, "serializeMinimum");
    this.registerAttribute(this.serializeChildren, "serializeChildren");
}

Serializer.prototype.serialize = function(attribute, item, attributeName, container)
{
	this.RootElement = null;
    this.DOM  = document.implementation.createDocument("", "__InitialRoot", null); 
    if (this.DOM)
    {
        if (this.RootElement)
        {
            this.DOM.removeChild(this.RootElement);
            this.RootElement = null;

            this.mixedModifiedCB(attr,data);
        }
        if (attribute)
        {
            this.serializeAttribute(attribute, item, attributeName);
        }
        else
        {
            this.serializeAttribute(container, 0, "");
        }
    }
}

Serializer.prototype.serializeAttribute = function(attribute, item, attrName)
{
    if (attribute)
    {
        if (attribute.isTransient()) // don't serialize transient attributes
        {
            return;
        }
        
        if (this.serializeMinimum.getValueDirect() == true &&
            !attribute.isDeserializedFromXML()) // if requested, don't serialize defaults
        {
            return;
        }
        
        if (attribute.attrType == eAttrType.Model)
        {
            var model = attribute;
            this.serializeModel(model);
        }
        else if (attribute.attrType == eAttrType.PerspectiveCamera)
        {
            var ctr = attribute;
            this.serializeAttributeContainer(ctr);
        }
        else if (attribute.attrType > eAttrType.Command &&
                 attribute.attrType < eAttrType.Command_End)
        {
            var cmd = attribute;
            this.serializeCommand(cmd);
        }
        else if (attribute.isCollection())
        {
            var ctr = attribute;
            this.serializeAttributeCollection(ctr, attrName);
        }
        else if (attribute.isContainer())
        {
            var ctr = attribute;
            this.serializeAttributeContainer(ctr, attrName);
        }
        else if (attrName && this.DOM)
        {
            var aType = attribute.attrType;
            var element = null;
            var itemElement = null;
            var itemAttr = null;
            var attrMap = null;
            var strItemAttr;
            var vecVal;
            var varVal;

            var len = attribute.getLength();
            if (attrName)
            {
                // serializer cannot put "(" or ")" in the XML tag name,
                // so convert parentheses to a string that is value,
                // which is then converted back to parentheses in the result
                // of serialization
                
                var index = 0;
                while (true)
                {
                    /* Locate the substring to replace. */
                    index = attrName.indexOf("(");
                    if (index == -1) break;

                    /* Make the replacement. */
                    attrName.replace(index, 1, "_x0028");
                }
                while (true)
                {
                    /* Locate the substring to replace. */
                    index = attrName.indexOf(")");
                    if (index == -1) break;

                    /* Make the replacement. */
                    attrName.replace(index, 1, "_x0029");
                }
                var bstr = attrName;
                if (bstr)
                {
                    element = this.DOM.createElement(bstr);
                    if (element)
                    {
                        var strValue;
                        strValue = this.getAttributeStringValue(attribute, item);
                        if (strValue == "") return;

                        if (item >= 0 || len == 1 || aType == eAttrType.StringAttr)
                        {
                            // Check for a CDATA section:
                            // CDATA sections are used for CStringAttrs
                            // containing special characters, including XML.
                            // CDATA behaves as it does in SAX, i.e., it
                            // is not parsed.  It is instead passed directly
                            // to the Attribute as a string literal.

                            // TODO:  Move this "constant" to a shared location.
                            // It is also used by XMLTokenizer
                            var strCdataStart = "<![CDATA[";
                            var strCdataEnd = "]]>";

                            var nStartPos = 0;
                            var nEndPos = strValue.indexOf(strCdataEnd);
                            if (nStartPos != -1 && nEndPos != -1)
                            {

                                nStartPos += strCdataStart.length;

                                strValue = strValue.substr(nStartPos, strValue.length-nStartPos-strCdataEnd.length);
                                var cdata = null;
                                bstr = strValue;
                                if (bstr)
                                {
                                    cdata = this.DOM.createCDATASection(bstr);
                                }
                                element.appendChild(cdata);
                            }
                            else
                            {
                                element.textContent = strValue;
                            }
                        }
                        else
                        {
                            var sv;
                            var startNdx = 0;
                            var endNdx = 0;
                            for (var i = 0; i < len; ++i)	// len - 1 = # of commas
                            {
                                strItemAttr = "item" + i.toString();

                                endNdx = (i == len-1) ? strValue.length : strValue.indexOf(",", startNdx);
                                sv = strValue.substr(startNdx, endNdx-startNdx);

                                startNdx = endNdx+1;

                                if (this.bMixed)
                                {
                                    itemElement = this.DOM.createElement(strItemAttr);
                                    itemElement.textValue = sv;
                                    element.appendChild(itemElement);
                                }
                                else
                                {
                                    itemAttr = this.DOM.createAttribute(strItemAttr);
                                    itemAttr.value = sv;
                                    element.setAttributeNode(itemAttr);
                                }
                            }
                        }

                        this.pushElement(element);
                        this.popElement();
                    }
                }
            }
        }
    }
}
Serializer.prototype.serializeAttributeReference = function(attribute, reference)
{
    if (attribute && reference && this.DOM)
    {
        var container = null;
        var element = null;
        var itemAttr = null;
        var attrMap = null;
        var pOldChild = null;

        container = attribute.getContainer();
        if (container)
        {
            var bstr = container.getAttributeName(attribute);
            if (bstr)
            {
                element = this.DOM.createElement(bstr);
            }
        }
        if (element)
        {
            if (element.attributes.length > 0)
            {
                itemAttr = this.DOM.createAttribute("ref");

                if (itemAttr)
                {
                    var refName = "";
                    var tmpName = "";
                    var nameAttr = null;
                    container = reference.getContainer();
                    if (container)
                    {
                        refName = container.getAttributeName(reference);
                        if (nameAttr = container.getAttribute("name"))
                        {
                            var s;
                            tmpName = nameAttr.getValueDirect().join("");
                            tmpName += "/";
                            tmpName += refName;
                            refName = tmpName;
                        }
                    }
                    itemAttr.textContent = refName;
                    attrMap.setNamedItem(itemAttr, pOldChild);
                }
            }

            this.pushElement(element);
            this.popElement();
        }
    }
}

Serializer.prototype.serializeModel = function(Model)
{
    // surround <Model> and <Set> tags so that both will serialize (previously the
    // <Set> was overwriting the <Model> as the root)
    var bstr = null;
    var element = null;
    if (this.DOM)
    {
        bstr = "ModelRoot";
        if (bstr)
        {
            element = this.DOM.createElement(bstr);
            if (element)
            {
                this.pushElement(element);
            }
        }
    }

    if (Model)
    {
        // serialize Model
        this.serializeAttributeContainer(Model);

        // add set command for rotation group's quaternion rotation, to retain rotation caused by object inspection
        var RotGroup = null;
        if (RotGroup = getInspectionGroup(Model))
        {
            var container = Model;
            var attr = RotGroup.getChild(2).getAttribute("rotationQuat");

            var containerName;
            var containerNameAttr = container.getAttribute("name");
            containerName = containerNameAttr.getValueDirect().join("");

            var command = null;
            var factory = this.registry.find("AttributeFactory");
            command = factory.create("Set");
            if (command)
            {
                command.getAttribute("target").setValueDirect(containerName);
                command.getAttribute("target").flagDeserializedFromXML();

                var values = [];
                attr.getValue(values);

                command.attributeValuePairs.push(new Pair(attr, values));
                
                this.serializeCommand(command);
                
                // setting the target on the SetCommand sets the attribute bin, which is normally
                // cleared by adding the command to the CommandMgr, but this doesn't occur here, because
                // it is only being serialized, not executed
                setAttributeBin(null);
                setAttributePairs(null);
            }
        }
    }

    if (element)
    {
        this.popElement();
    }
}

Serializer.prototype.serializeCommand = function(command)
{
    var i;
    // 1. create the start tag.

    if (command && this.DOM)
    {
        var element = null;
        var pcszType = command.className;
               
        // don't serialize SerializeCommand
        if (pcszType == "Serialize") return;
        
        var bstr = pcszType;
        if (bstr)
        {
            //this.DOM.createElement(bstr, element); Can only pass in a string value for this and only has 1 parameter
            element = this.DOM.createElement(bstr);
            if (element) {
                this.pushElement(element);

                // 2. serialize the native attributes (except "sourceContainer", "sourceEvaluator",
                //    "sourceAttribute", "sourceOutput", "source", "targetContainer", "targetAttribute", "target")
                var i;
                var attribute = null;
                var pcszName = null;
                var uiAttrCount = command.getAttributeCount();
                for (i = 0; i < uiAttrCount; ++i) {
                    attribute = command.getAttributeAt(i);
                    pcszName = command.getAttributeName(attribute);
                    if (!command.isBorrowed(attribute) &&
                        (pcszName != "sourceContainer") &&
                        (pcszName != "sourceEvaluator") &&
                        (pcszName != "sourceAttribute") &&
                        (pcszName != "sourceOutput") &&
                        (pcszName != "source") &&
                        (pcszName != "targetContainer") &&
                        (pcszName != "targetAttribute") &&
                        (pcszName != "target")) {
                        this.serializeAttribute(attribute, -1, pcszName);
                    }
                }

                // 3. serialize "sourceContainer", "targetContainer"
                attribute = command.getAttribute("sourceContainer");
                if (attribute) {
                    this.serializeAttribute(attribute, -1, "sourceContainer");
                }
                attribute = command.getAttribute("targetContainer");
                if (attribute) {
                    this.serializeAttribute(attribute, -1, "targetContainer");
                }

                // 4. serialize "sourceAttribute", "targetAttribute", "target" (may be multiple source/target pairs)
                var sources = [];
                var targets = [];
                for (i = 0; i < uiAttrCount; ++i) 
                {
                    //attribute = command.getAttribute(i, pcszName);
                    var attr = command.getAttributeAt(i);
                    var attrName = command.getAttributeName(attr);
                    if (attrName == "sourceAttribute") 
                    {
                        sources.push(attr);
                    }
                    else if (attrName == "targetAttribute") 
                    {
                        targets.push(attr);
                    }
                }
                
                // source/target pairs must be serialized together
                for (i = 0; i < sources.length && i < targets.length; i++) 
                {
                    this.serializeAttribute(sources[i], -1, "sourceAttribute");
                    this.serializeAttribute(targets[i], -1, "targetAttribute");
                }
                // if "targetAttribute" specified, don't serialize "target"
                if (targets.length == 0) 
                {
                    attribute = command.getAttribute("target");
                    if (attribute) 
                    {
                        this.serializeAttribute(attribute, -1, "target");
                    }
                }

                // 5. serialize the borrowed attributes that were modified by the command
                var vNewVal;
                var pRef;
                for (i = 0; i < uiAttrCount; ++i) 
                {
                    attribute = command.getAttributeAt(i);
                    var attrName = command.getAttributeName(attribute);
                    var borrowed = command.isBorrowedAndValueModified(attribute);
                    if (borrowed.borrowed)
                    {
                        var pNewAttribute = newAttribute(attribute.className);
                        if (pNewAttribute) 
                        {
                            setAttributeValue(pNewAttribute, borrowed.value);
                            pNewAttribute.flagDeserializedFromXML();
                            this.serializeAttribute(pNewAttribute, -1, attrName);
                        }
                    }
                    else 
                    {
                    	var borrowed = command.isBorrowedAndReferenceModified(attribute);
                    	if (borrowed.borrowed) 
                    	{
                        	this.serializeAttributeReference(attribute, borrowed.reference);
                        }
                    }
                }

                this.popElement();
            }
        }
    }
}

Serializer.prototype.serializeAttributeContainer = function(container, name)
{
    // 1. create the start tag.

    if (container && this.DOM)
    {
        var element = null;
        var pcszType = name || container.className;
        // TODO: is this the right way to do this?
        if (pcszType == "BwSceneInspector")
        {
            pcszType = "SceneInspector";
        }
        else if (pcszType == "GenericConnector")
        {
            pcszType = "genericConnector";
        }
        else if (pcszType == "PhysicalPropertiesAttr") 
        {
            pcszType = "physicalProperties";
        }
        else if (pcszType == "PlugConnector")
        {
            pcszType = "plugConnector";
        }
        else if (pcszType == "SocketConnector")
        {
            pcszType = "socketConnector";
        }

        var bstr = pcszType;
        if (bstr)
        {
            element = this.DOM.createElement(bstr);
            if (element)
            {
                this.pushElement(element);

                var attribute = null;
                var pcszName = null;
                var uiAttrCount = container.getAttributeCount();

                // 0. serialize any native attributes first
                for (var i = 0; i < uiAttrCount; ++i)
                {
                    attribute = container.getAttributeAt(i);
                    var attrName = container.getAttributeName(attribute);
                    if (attribute.isNative() == true)
                    {
                        this.serializeAttribute(attribute, -1, attrName);
                    }
                }

                // 1. if serialization of children is requested, serialize children
                if (this.serializeChildren.getValueDirect())
                {
                    this.doSerializeChildren(container);
                }

                // 2. serialize the non-native attributes
                for (var i = 0; i < uiAttrCount; ++i)
                {
                    attribute = container.getAttributeAt(i);
                    if (attribute.modificationCount == 0) continue;
                    var attrName = container.getAttributeName(attribute);
                    if (attribute.isNative() == false)
                    {
                        this.serializeAttribute(attribute, -1, attrName);
                    }
                }
                this.popElement();
            }
        }
    }

    // 3. create the end tag.
}

Serializer.prototype.serializeAttributeCollection = function(collection, name)
{
    if (collection && this.DOM)
    {
        var element = null;
        var pcszType = name;//collection.className;

        var bstr = pcszType;
        if (bstr)
        {
            element = this.DOM.createElement(bstr);
            if (element)
            {
                this.pushElement(element);

                // vector
                var attrVec = collection;
                {
                    var elementName;
                    var baseName = attrVec.baseName.getValueDirect().join("");

                    var size = attrVec.Size();
                    for (var i=0; i < size; i++)
                    {
                        elementName = baseName;
                        //elementName += "[";
                        elementName += i.toString();
                        //elementName += "]";

                        this.serializeAttribute(attrVec.getAt(i), 0, elementName);
                    }
                }

                this.popElement();
            }
        }
    }
}

Serializer.prototype.doSerializeChildren = function(root)
{
    if (root.attrType < eAttrType.Node ||
        root.attrType > eAttrType.Node_End)
    {
        return;
    }
    
    for (var i=0; i < root.getChildCount(); i++)
    {
        this.serializeAttribute(root.getChild(i), 0, null);
    }
}

Serializer.prototype.pushElement = function(element)
{
	this.elementStack.push(element);
	    
    if (this.RootElement)
    {
        this.RootElement.appendChild(element);
    }
    else // !this.RootElement
    {
        this.DOM.replaceChild(element, this.DOM.documentElement);
    }

    this.RootElement = element;
}

Serializer.prototype.popElement = function()
{
    this.elementStack.pop();

    if (this.elementStack.length() > 0)
    {
        this.RootElement = this.elementStack.top();
    }
}

Serializer.prototype.getAttributeStringValue = function(attr, item)
{
    strValue = "";

    var e = attr.attrType;

    var index = -1;

    switch (e)
    {
        case eAttrType.NumberAttr:
        {
            var i = attr.getValueDirect();
            strValue = i.toString();
        }
            break;
        case eAttrType.BooleanAttr:
        {
            var b = attr.getValueDirect();
            if (b == true)
            {
            	strValue = "true";
            }
            else
            {
            	strValue = "false";
            }
        }
            break;
        case eAttrType.StringAttr:
        {
            var len = attr.getLength();
            strValue = attr.getValueDirect().join("");
        }
            break;
        case eAttrType.ColorAttr:
        case eAttrType.Vector2DAttr:
        case eAttrType.Vector3DAttr:
        case eAttrType.Matrix4x4Attr:
        case eAttrType.QuaternionAttr:
        {
            var vecVal_F = [];
            attr.getValue(vecVal_F);
            if (item == -1)
            {
                for (var i = 0; i < vecVal_F.length; ++i)
                {
                    strValue += vecVal_F[i].toString();
                    if (i < vecVal_F.length - 1)
                    {
                        strValue += ",";
                    }
                }
            }
            else
            {
                strValue += vecVal_F[item].toString();
            }
        }
            break;
        case eAttrType.NumberArrayAttr:
        case eAttrType.ViewportAttr:
        {
            var vecVal_I = [];
            attr.getValue(vecVal_I);
            if (item == -1)
            {
                for (var i = 0; i < vecVal_I.length; ++i)
                {
                    strValue += vecVal_I[i].toString();
                    if (i < vecVal_I.length - 1)
                    {
                        strValue += ",";
                    }
                }
            }
            else
            {
                strValue += vecVal_I[item].toString();
            }
        }
            break;
        default:
        {
        }
            break;
    }
    
    return strValue;
}

Serializer.prototype.mixedModifiedCB = function(attr,data)
{
    var v = [];
    attr.getValue(v);
    var pSerializer = data;
    if (pSerializer != 0xffffffff)
    {
        pSerializer.bMixed = v[0]; //ASK MICHAEL
    }
}


/**
 *
 */
var ePixelFormat =
{
    Unknown             :-1,
    R8G8B8              : 0,  // 24-bit RGB
    B8G8R8              : 1,  // 24-bit BGR
    X8X8X8              : 2,  // 24-bit RGB (unspecified component order)
    R8G8B8A8            : 3,  // 32-bit RGB Alpha
    B8G8R8A8            : 4,  // 32-bit BGR Alpha
    A8R8G8B8            : 5,  // 32-bit Alpha RGB
    A8B8G8R8            : 6,  // 32-bit Alpha BGR
    X8X8X8X8            : 7,  // 32-bit RGB Alpha (unspecified component order)
    A8                  : 8   //  8-bit Alpha
};

var ePixelMap =
{
    Default             : 0,  // default mapping -- R to R, G to G, B to B, Alpha to Alpha
    RGBToAlpha          : 1   // average RGB components and map to Alpha component
};

function BytesPerPixel(pixelFormat)
{
    switch (pixelFormat)
    {
    case ePixelFormat.R8G8B8:
    case ePixelFormat.B8G8R8:
    case ePixelFormat.X8X8X8:
        return 3;

    case ePixelFormat.R8G8B8A8:
    case ePixelFormat.B8G8R8A8:
    case ePixelFormat.A8R8G8B8:
    case ePixelFormat.A8B8G8R8:
    case ePixelFormat.X8X8X8X8:
        return 4;

    case ePixelFormat.A8:
        return 1;

    default:
        return 0;
    }
}

function TPixel(r, g, b, a)
{
    var red = r || 0;
    var green = g || 0;
    var blue = b || 0;
    var alpha = a || 0;
}

/**
 *
 */
var eImageFormat =
{
    Unknown             :-1,
    RGB                 : 0,
    RGBA                : 1,
    Alpha               : 2,
    Luminance           : 3,
    Luminance_Alpha     : 4
}
function ScaleImage(pixelFormat, widthIn, heightIn, byteAlignmentIn, dataIn, widthOut, heightOut, byteAlignmentOut, dataOut)
{
    // currently supporting image pixel formats: RGBA
    if (pixelFormat != ePixelFormat.R8G8B8A8)
    {
        return false;
    }

    var canvasIn = document.createElement("canvas");
    canvasIn.width = widthIn;
    canvasIn.height = heightIn;
    
    var ctxIn = canvasIn.getContext("2d");
    var imageDataIn = ctxIn.createImageData(widthIn, heightIn);

    var i = 0;
    for (var row = 0; row < heightIn; row++)
    {
        for (var col = 0; col < widthIn; col++)
        {
            for (var component = 0; component < 4; component++, i++)
            {
                imageDataIn.data[i] = dataIn[i];
            }
        }
    }

    ctxIn.putImageData(imageDataIn, 0, 0);

    var canvasOut = document.createElement("canvas");
    canvasOut.width = widthOut;
    canvasOut.height = heightOut;

    var ctxOut = canvasOut.getContext("2d");
    
    ctxOut.drawImage(canvasIn,
                     0, 0, canvasIn.width, canvasIn.height,
                     0, 0, canvasOut.width, canvasOut.height);
               
    var imageDataOut = ctxOut.getImageData(0, 0, widthOut, heightOut);

    i = 0;
    for (var row = 0; row < heightOut; row++)
    {
        for (var col = 0; col < widthOut; col++)
        {
            for (var component = 0; component < 4; component++, i++)
            {
                dataOut[i] = imageDataOut.data[i];
            }
        }
    }

    return true;
}
// filter flags for GetFrameData() filterMask parameter
var FRAME_FILTER_SCALE_FRAME_BIT    = 0x001;    // scale frame to size of incoming buffer before copying
var FRAME_FILTER_INVERT_FRAME_BIT   = 0x002;    // invert frame
var FRAME_FILTER_NEGATE_COLOR_BIT   = 0x004;    // invert rgb pixel data (subtract from 255)
var FRAME_FILTER_NEGATE_ALPHA_BIT   = 0x008;    // invert alpha pixel data (subtract from 255)
var FRAME_FILTER_ALPHA_ONOFF_BIT    = 0x010;    // set alpha pixel to 0 or 255; alpha values in the range
                                                // [0, 127] are set to 0, [128, 255] are set to 255
                                                
function MediaPlayback(container, onload)
{
    this.container = container;
    this.onload = onload;

    this.url = null;
    this.video = false;
    this.ready = false;
    this.alphaPlayback = null;
    this.frameRetrieved = false;
    this.htmlImageElement = null;
    this.imageWidth = 0;
    this.imageHeight = 0;
    this.imagePitch = 0;
    this.imagePixels = null;
}

MediaPlayback.prototype.loadImage = function(url)
{
    this.ready = false;
    this.frameRetrieved = false;
    this.htmlImageElement = null;
    this.imageWidth = 0;
    this.imageHeight = 0;
    this.imagePitch = 0;
    this.imagePixels = null;

    var extension = getFileExtension(url);

    switch (extension)
    {
        case "avi":
        case "mpg":
        case "ogg":
            {

                this.htmlImageElement = document.createElement("video");
                this.htmlImageElement.container = this;
                this.htmlImageElement.controls = "controls";
                //this.htmlImageElement.preload = "auto";
                //this.htmlImageElement.autoplay = "autoplay";
                //this.htmlImageElement.setAttribute("controls", "controls");
                //this.htmlImageElement.setAttribute("preload", "preload");
                //this.htmlImageElement.setAttribute("autoplay", "autoplay");

                //this.htmlImageElement.canvas = document.createElement("canvas");
                //this.htmlImageElement.canvasContext = this.htmlImageElement.canvas.getContext("2d");

                //this.htmlImageElement.addEventListener("play", MediaTexture_OnVideoPlay, false);
                //this.htmlImageElement.onload = MediaTexture_OnVideoLoad;

                //this.onVideoPlay();
                this.htmlImageElement.src = "http://localhost/bwjs/BwContent/images/Bear.ogg"; //url;

                this.video = true;
                this.onVideoLoad();

                /*
                this.htmlImageElement = document.createElement("video"); //new Image();
                this.htmlImageElement.container = this;
                this.htmlImageElement.preload = "auto";
                this.htmlImageElement.autoplay = "autoplay";
                this.htmlImageElement.onload = MediaPlayback_OnVideoLoad;
                this.htmlImageElement.src = imageFilename;
                //this.imageSet = true;
                //this.video = true;
                */
                //var resource = loadBinaryResource(imageFilename);
                //alert(resource);
            }
            break;

        default:
            {
                this.htmlImageElement = new Image(); //document.createElement("img");
                this.htmlImageElement.container = this;
                this.htmlImageElement.onload = MediaPlayback_OnImageLoad;
                this.htmlImageElement.src = url;
            }
            break;
    }

    this.url = url;
}

MediaPlayback.prototype.onImageLoad = function()
{
    var image = this.htmlImageElement;
    this.imageWidth = image.width;
    this.imageHeight = image.height;
    this.imagePitch = image.width * 4; // rgba
    var canvas = document.createElement("canvas");
    var canvasContext = canvas.getContext("2d");
    canvas.width = image.width;
    canvas.height = image.height;
    canvasContext.drawImage(image, 0, 0);
    var imageData = canvasContext.getImageData(0, 0, image.width, image.height);
    this.imagePixels = imageData.data;

    this.ready = true;

    if (this.onload)
    {
        this.onload.call(this);
    }
}

MediaPlayback.prototype.onVideoLoad = function()
{
    this.ready = true;
}

MediaPlayback.prototype.getFrameDimensions = function()
{
    return { width: this.imageWidth, height: this.imageHeight, pitch: this.imagePitch };
}

MediaPlayback.prototype.getPixelFormat = function()
{
    return ePixelFormat.R8G8B8A8;
}

MediaPlayback.prototype.getPixelByteAlignment = function()
{
    return 4;
}

MediaPlayback.prototype.getBytesPerPixel = function()
{
    return BytesPerPixel(this.getPixelFormat());
}

/**
 * Retrieve the pixels for the current frame.
 * @param buffer        - incoming buffer to receive pixel data.
 * @param frame         - optional parameter specifying the frame number to retrieve.
 * @return number       - the frame number retrieved, -1 for single-frame images, or undefined on failure.
 */
MediaPlayback.prototype.getFramePixels = function(buffer, frame)
{
    // verify validity of image data
    if (!this.ready ||
        this.imageWidth == 0 ||
        this.imageHeight == 0 ||
        !this.imagePixels)
    {
        return undefined;
    }

    buffer.length = this.imagePixels.length;
    for (var i = 0; i < this.imagePixels.length; i++)
    {
        buffer[i] = this.imagePixels[i];
    }

    return -1; // single-frame image
}

MediaPlayback.prototype.newFrameDataAvailable = function()
{
    return this.ready && !this.frameRetrieved;
}

/**
 * Retrieve the pixels for the current frame in the specified pixel format and dimensions.
 * @param width         - width of the incoming buffer in pixels.
 * @param height        - height of the incoming buffer in pixels.
 * @param pitch         - width of a scan line of pixels in bytes; may differ from width * bytes
 *                        per pixel if pixels are padded to 2- or 4-byte boundaries.
 * @param pixelFormat   - pixel format of the incoming buffer.
 * @param buffer        - incoming buffer to receive pixel data.
 * @param filterMask    - zero or more OR'd filtering flags controlling how the image is filtered:
 *
 *                        FRAME_FILTER_SCALE_FRAME_BIT  - the frame is first scaled to the size 
 *                                                        of the incoming buffer before copying
 *                        FRAME_FILTER_INVERT_FRAME_BIT - the frame is inverted before copying
 *                        FRAME_FILTER_NEGATE_COLOR_BIT - the rgb pixel data is inverted (subtracted from 255) 
 *                        FRAME_FILTER_NEGATE_ALPHA_BIT - the alpha pixel data is inverted (subtracted from 255)
 *                        FRAME_FILTER_ALPHA_ONOFF_BIT  - set alpha pixel to 0 or 255; alpha values in the range
 *                                                        [0, 127] are set to 0, [128, 255] are set to 255
 *
 * @param pixelMap      - pixel mapping to perform; default: PixelMap_Default.
 * @param frame         - optional parameter specifying the frame number to retrieve.
 * @return number       - the frame number retrieved, -1 for single-frame images, or undefined on failure.
 */
MediaPlayback.prototype.getFrameData = function(width, height, pitch, pixelFormat, buffer, filterMask, pixelMap, frame)
{
    // verify validity of image data
    if (!this.ready ||
        this.imageWidth == 0 ||
        this.imageHeight == 0 ||
        !this.imagePixels)
    {
        return undefined;
    }

    // check params
    if (width == 0 ||
        height == 0 ||
        pitch < width ||
        pixelFormat == ePixelFormat.Unknown ||
        !buffer)
    {
        return undefined;
    }

    var frameRetrieved = -1;

    // get filter flags
    var scaleFrame = filterMask & FRAME_FILTER_SCALE_FRAME_BIT ? true : false;
    var invertFrame = filterMask & FRAME_FILTER_INVERT_FRAME_BIT ? true : false;
    var negateColor = filterMask & FRAME_FILTER_NEGATE_COLOR_BIT ? true : false;
    var negateAlpha = filterMask & FRAME_FILTER_NEGATE_ALPHA_BIT ? true : false;
    var alphaOnOff = filterMask & FRAME_FILTER_ALPHA_ONOFF_BIT ? true : false;

    // get image dimensions
    var dims = this.getFrameDimensions();
    var imageWidth = dims.width;
    var imageHeight = dims.height;
    var imagePitch = dims.pitch;

    // get image pixel format
    var imagePixelFormat = this.getPixelFormat();

    // currently supporting image pixel formats: RGBA
    if (imagePixelFormat != ePixelFormat.R8G8B8A8)
    {
        return undefined;
    }

    // get image pixels
    var pixels = [];
    var imageFrameRetrieved = this.getFramePixels(pixels, frame);
    if (imageFrameRetrieved == undefined)
    {
        return undefined;
    }

    // scale pixels if necessary
    if (scaleFrame && (width != imageWidth || height != imageHeight))
	{
		var imageBytesPerPixel = this.getBytesPerPixel();

		// calculate pitch (using byte aligment of "4")
		imagePitch = width * imageBytesPerPixel;
		imagePitch += (4 - imagePitch % 4) % 4;

		var scaledPixels = [];
		if (!ScaleImage(imagePixelFormat, imageWidth, imageHeight, this.getPixelByteAlignment(), pixels, 
			width, height, 4, scaledPixels))
		{
			return undefined;
		}

		pixels = scaledPixels;
		imageWidth = width;
		imageHeight = height;
	}

    // if no alpha channel, rgb pixel data is not to be negated, frame is not to be inverted,
    // and incoming buffer has same parameters as pixel buffer, copy bits
    if (!this.alphaPlayback &&
		!negateColor &&
		!invertFrame &&
		imagePitch == pitch &&
		imageHeight == height &&
		imagePixelFormat == pixelFormat)
    {
        for (var i = 0; i < buffer.length; i++)
        {
            buffer[i] = pixels[i];
        }
        
        this.frameRetrieved = true;
        return frameRetrieved;
    }

    // get alpha data
    var alphaWidth = 0;
	var alphaHeight = 0;
	var alphaPitch = 0;
	var alphaPixelFormat;
	var alphaPixels = null;
	if (this.alphaChannel)
	{
		// get alpha dimensions
		dims = this.alphaChannel.getFrameDimensions();
		alphaWidth = dims.width;
		alphaHeight = dims.height;
		alphaPitch = dims.pitch;

		// get alpha pixel format
		alphaPixelFormat = this.alphaChannel.getPixelFormat();
    
		// currently only supporting alpha pixel formats: RGBA
		if (alphaPixelFormat != ePixelFormat.R8G8B8A8)
		{
			return undefined;
		}

		// get alpha pixels
		var alphaFramePixels = [];
		var alphaFrameRetrieved = this.alphaChannel.getFramePixels(alphaFramePixels, imageFrameRetrieved);
		if (alphaFrameRetrieved != undefined)
		{
		    // scale alpha pixels to match frame data
		    if (alphaWidth != imageWidth ||
			    alphaHeight != imageHeight)
		    {
			    var alphaBytesPerPixel = this.alphaChannel.getBytesPerPixel();

			    // calculate pitch (using byte aligment of "4")
			    alphaPitch = imageWidth * alphaBytesPerPixel;
			    alphaPitch += (4 - alphaPitch % 4) % 4;

			    var scaledAlphaPixels = [];
			    if (ScaleImage(alphaPixelFormat, alphaWidth, alphaHeight, 
				    this.alphaChannel.getPixelByteAlignment(), alphaPixels, imageWidth, 
				    imageHeight, 4, scaledAlphaPixels))
			    {
			        alphaPixels = scaledAlphaPixels;
			        alphaWidth = imageWidth;
			        alphaHeight = imageHeight;
			    }
		    }
		    else
		    {
		        alphaPixels = alphaFramePixels;
		    }
		}
	}
	
    // determine dimensions to copy
    var copyWidth = Math.min(width, imageWidth);
    var copyHeight = Math.min(height, imageHeight);

    // set component positions for buffer pixel format
    var rPos = 0, gPos = 0, bPos = 0, aPos = 0;
    switch (pixelFormat)
    {
        case ePixelFormat.R8G8B8: rPos = 0; gPos = 1; bPos = 2; break;
        case ePixelFormat.B8G8R8: rPos = 2; gPos = 1; bPos = 0; break;
        case ePixelFormat.R8G8B8A8: rPos = 0; gPos = 1; bPos = 2; aPos = 3; break;
        case ePixelFormat.B8G8R8A8: rPos = 2; gPos = 1; bPos = 0; aPos = 3; break;
        case ePixelFormat.A8R8G8B8: rPos = 1; gPos = 2; bPos = 3; aPos = 0; break;
        case ePixelFormat.A8B8G8R8: rPos = 3; gPos = 2; bPos = 1; aPos = 0; break;
    }

    // if frame is to be inverted, start copying from last row of data
    var fromImage = 0, fromAlpha = 0, to = 0;
    if (invertFrame)
    {
        fromImage += imagePitch * (copyHeight - 1);

        if (alphaPixels)
        {
            fromAlpha += alphaPitch * (copyHeight - 1);
        }
    }

    // copy pixel data to buffer
    var pixel = new TPixel(0, 0, 0, 255);
    var alphaPixel = new TPixel(0, 0, 0, 255);
    for (var row = 0; row < copyHeight; row++)
    {
        for (var col = 0; col < copyWidth; col++)
        {
            // get image pixel
            /*
            switch (imagePixelFormat)
            {
            case ePixelFormat.R8G8B8:
            pixel.red = pixels[fromImage];
            pixel.green = pixels[fromImage + 1];
            pixel.blue = pixels[fromImage + 2];
            fromImage += 3;
            break;

                case ePixelFormat.B8G8R8:
            pixel.red = pixels[fromImage + 2];
            pixel.green = pixels[fromImage + 1];
            pixel.blue = pixels[fromImage];
            fromImage += 3;
            break;

                case ePixelFormat.R8G8B8A8:
            pixel.red = pixels[fromImage];
            pixel.green = pixels[fromImage + 1];
            pixel.blue = pixels[fromImage + 2];
            pixel.alpha = pixels[fromImage + 3];
            fromImage += 4;
            break;

                case ePixelFormat.B8G8R8A8:
            pixel.red = pixels[fromImage + 2];
            pixel.green = pixels[fromImage + 1];
            pixel.blue = pixels[fromImage];
            pixel.alpha = pixels[fromImage + 3];
            fromImage += 4;
            break;

                case ePixelFormat.A8B8G8R8:
            pixel.red = pixels[fromImage + 3];
            pixel.green = pixels[fromImage + 2];
            pixel.blue = pixels[fromImage + 1];
            pixel.alpha = pixels[fromImage];
            fromImage += 4;
            break;
            }
            */
            pixel.red = pixels[fromImage];
            pixel.green = pixels[fromImage + 1];
            pixel.blue = pixels[fromImage + 2];
            pixel.alpha = pixels[fromImage + 3];
            fromImage += 4;

            // negate rgb data if requested
            if (negateColor)
            {
                pixel.red = 255 - pixel.red;
                pixel.green = 255 - pixel.green;
                pixel.blue = 255 - pixel.blue;
                pixel.alpha = 255 - pixel.alpha;
            }

            // get alpha pixel
            if (alphaPixels)
            {
                /*
                switch (alphaPixelFormat)
                {
                case ePixelFormat.R8G8B8:
                alphaPixel.red = alphaPixels[fromAlpha];
                alphaPixel.green = alphaPixels[fromAlpha + 1];
                alphaPixel.blue = alphaPixels[fromAlpha + 2];
                fromAlpha += 3;
                break;

                    case ePixelFormat.B8G8R8:
                alphaPixel.red = alphaPixels[fromAlpha + 2];
                alphaPixel.green = alphaPixels[fromAlpha + 1];
                alphaPixel.blue = alphaPixels[fromAlpha];
                fromAlpha += 3;
                break;

                    case ePixelFormat.R8G8B8A8:
                alphaPixel.red = alphaPixels[fromAlpha];
                alphaPixel.green = alphaPixels[fromAlpha + 1];
                alphaPixel.blue = alphaPixels[fromAlpha + 2];
                alphaPixel.alpha = alphaPixels[fromAlpha + 3];
                fromAlpha += 4;
                break;

                    case ePixelFormat.B8G8R8A8:
                alphaPixel.red = alphaPixels[fromAlpha + 2];
                alphaPixel.green = alphaPixels[fromAlpha + 1];
                alphaPixel.blue = alphaPixels[fromAlpha];
                alphaPixel.alpha = alphaPixels[fromAlpha + 3];
                fromAlpha += 4;
                break;
                }
                */
                alphaPixel.red = alphaPixels[fromAlpha];
                alphaPixel.green = alphaPixels[fromAlpha + 1];
                alphaPixel.blue = alphaPixels[fromAlpha + 2];
                alphaPixel.alpha = alphaPixels[fromAlpha + 3];
                fromAlpha += 4;
            }

            // negate alpha data if requested
            if (negateAlpha)
            {
                alphaPixel.red = 255 - alphaPixel.red;
                alphaPixel.green = 255 - alphaPixel.green;
                alphaPixel.blue = 255 - alphaPixel.blue;
                alphaPixel.alpha = 255 - alphaPixel.alpha;
            }

            // copy to buffer
            switch (pixelFormat)
            {
                case ePixelFormat.R8G8B8:
                case ePixelFormat.B8G8R8:
                    buffer[to + rPos] = pixel.red;
                    buffer[to + gPos] = pixel.green;
                    buffer[to + bPos] = pixel.blue;
                    to += 3;
                    break;

                case ePixelFormat.R8G8B8A8:
                case ePixelFormat.B8G8R8A8:
                case ePixelFormat.A8R8G8B8:
                case ePixelFormat.A8B8G8R8:
                    switch (pixelMap)
                    {
                        case ePixelMap.RGBToAlpha:
                            buffer[to + rPos] = 0;
                            buffer[to + gPos] = 255;
                            buffer[to + bPos] = 0;
                            if (alphaPixels)
                            {
                                buffer[to + aPos] =
								((pixel.red + pixel.green + pixel.blue) / 3) &
								((alphaPixel.red + alphaPixel.green + alphaPixel.blue) / 3);
                            }
                            else
                            {
                                buffer[to + aPos] = (pixel.red + pixel.green + pixel.blue) / 3;
                            }
                            if (alphaOnOff)
                            {
                                buffer[to + aPos] = (buffer[to + aPos] <= 127 ? 0 : 255);
                            }
                            to += 4;
                            break;

                        case ePixelMap.Default:
                        default:
                            buffer[to + rPos] = pixel.red;
                            buffer[to + gPos] = pixel.green;
                            buffer[to + bPos] = pixel.blue;
                            if (alphaPixels)
                            {
                                buffer[to + aPos] = (alphaPixel.red + alphaPixel.green + alphaPixel.blue) / 3;
                            }
                            else
                            {
                                buffer[to + aPos] = pixel.alpha;
                            }
                            if (alphaOnOff)
                            {
                                buffer[to + aPos] = (buffer[to + aPos] <= 127 ? 0 : 255);
                            }
                            to += 4;
                            break;
                    }
                    break;

                case ePixelFormat.A8:
                    if (alphaPixels)
                    {
                        buffer[to] = (alphaPixel.red + alphaPixel.green + alphaPixel.blue) / 3;
                    }
                    else // !alphaPixels
                    {
                        buffer[to] = (pixel.red + pixel.green + pixel.blue) / 3;
                    }
                    if (alphaOnOff)
                    {
                        buffer[to] = (buffer[to] <= 127 ? 0 : 255);
                    }
                    to += 1;
                    break;
            }
        }

        if (invertFrame) fromImage -= (2 * imagePitch);
        if (alphaPixels)
        {
            if (invertFrame) fromAlpha -= (2 * alphaPitch);
        }
    }

    this.frameRetrieved = true;

    return frameRetrieved;
}

MediaPlayback.prototype.setAlphaChannel = function(playback)
{
    this.alphaPlayback = playback;
}

function MediaPlayback_OnImageLoad()
{
    this.container.onImageLoad();
}
// TODO: consider moving to a more appropriate file
function TextureArray(textureArray)
{
    this.textures = new Array(eTextureType.EnumCount);

    for (var i=0; i < this.textures.length; i++)
    {
        if (textureArray)
        {
            this.textures[i] = textureArray.textures[i].slice();
        }
        else
        {
            this.textures[i] = [];
        }
    }
}


StyleMgr.prototype = new AttributeContainer();
StyleMgr.prototype.constructor = StyleMgr;

function StyleMgr()
{
    AttributeContainer.call(this);
    this.className = "StyleMgr";
}

StyleMgr.prototype.eventPerformed = function(event, node)
{
    var result = node.stylesMap.getStyles(event.type);
    if (result.styles && result.enabled)
    {
        this.applyStyle(result.styles, result.target ? result.target : node);
    }
}

StyleMgr.prototype.applyStyle = function(style, node)
{
    node.styles.updateStyle(style);
}
GraphMgr.prototype = new AttributeContainer();
GraphMgr.prototype.constructor = GraphMgr;

function GraphMgr()
{
    AttributeContainer.call(this);
    this.className = "GraphMgr";
    
    this.renderContext = null;
    this.renderState = null;
    this.lightIndex = 0;
    this.material = null;
    this.dissolve = null;
    this.balloonTipLabel = null;
    this.drawTextures = true;
    this.textureArrayStack = new Stack(new TextureArray());
    this.projectionTextureArrayStack = new Stack(new TextureArray());
    this.labelIndex = 1;
    this.balloonTipLabelIndex = 1;
    this.styleMgr = new StyleMgr();
    this.updateRegistry = new NodeRegistry();
    
    this.name = new StringAttr("GraphMgr");
    
    this.registerAttribute(this.name, "name");
}

GraphMgr.prototype.setRenderContext = function(rc)
{
    this.renderContext = rc;
    this.renderState = new RenderState(rc);
}

GraphMgr.prototype.getAvailableLightIndex = function()
{
    return this.lightIndex++;
}

GraphMgr.prototype.getCurrentMaterial = function()
{
    return this.material;
}

GraphMgr.prototype.setCurrentMaterial = function(material)
{
    this.material = material;
}

GraphMgr.prototype.getCurrentDissolve = function()
{
    return this.dissolve;
}

GraphMgr.prototype.setCurrentDissolve = function(dissolve)
{
    this.dissolve = dissolve;
}

GraphMgr.prototype.getCurrentBalloonTipLabel = function()
{
    return this.balloonTipLabel;
}

GraphMgr.prototype.setCurrentBalloonTipLabel = function(balloonTipLabel)
{
    this.balloonTipLabel = balloonTipLabel;
}

GraphMgr.prototype.getDrawTextures = function()
{
    return this.drawTextures;
}

GraphMgr.prototype.setDrawTextures = function(drawTextures)
{
    this.drawTextures = drawTextures;
}

GraphMgr.prototype.getNextLabelIndex = function()
{
    return this.labelIndex++;
}

GraphMgr.prototype.getNextBalloonTipLabelIndex = function()
{
    return this.balloonTipLabelIndex++;    
}

GraphMgr.prototype.reset = function ()
{
    this.lightIndex = 0;
    this.labelIndex = 1;
    this.balloonTipLabelIndex = 1;
    this.setCurrentDissolve(null);
    this.setCurrentMaterial(null);
    this.setCurrentBalloonTipLabel(null);
    this.setDrawTextures(true);
    this.collisions = new Array;

    for (var i=0; i < gl_MaxLights; i++)
    {
        this.renderContext.enableLight(i, false);
    }
}
NodeRegistry.prototype = new AttributeContainer();
NodeRegistry.prototype.constructor = NodeRegistry;

function NodeRegistry()
{
    AttributeContainer.call(this);
    this.className = "NodeRegistry";
    
    this.nodes = [];
}

NodeRegistry.prototype.register = function(node)
{
    this.nodes[node.__nodeId__] = node;
}

NodeRegistry.prototype.unregister = function(node)
{
    // TODO
}

NodeRegistry.prototype.clear = function()
{
    this.nodes = [];
}

var g__nodeId__ = 0;

Node.prototype = new AttributeContainer();
Node.prototype.constructor = Node;

function Node()
{
    AttributeContainer.call(this);
    this.className = "Node";
    this.attrType = eAttrType.Node;

    this.__nodeId__ = g__nodeId__++;
    this.children = [];
    this.parents = [];

    this.name = new StringAttr("");
    this.enabled = new BooleanAttr(true);
    this.orphan = new BooleanAttr(false);
    this.modified = new PulseAttr();

    this.registerAttribute(this.name, "name");
    this.registerAttribute(this.enabled, "enabled");
    this.registerAttribute(this.orphan, "orphan");
    this.registerAttribute(this.modified, "modified");
}

Node.prototype.copyNode = function(clone, cloneChildren, pathSrc, pathClone)
{
    var clonedByThis = false;
    if (!clone)
    {
        if (!( clone = new Node()))
        {
            return -1;
        }

        clonedByThis = true;
    }

    // synchronize attributes
    clone.synchronize(this, false);

    // add source to path
    //pathSrc.addNode(this);
    pathSrc.push(this);

    // add clone to path
    // pathClone.AddNode(clone);
    pathClone.push(this);

    // if requested, clone children
    if (cloneChildren)
    {
        var pos;
        for (var i in this.children)
        {
            //pos = it - m_children.begin();
            pos = i - this.children.start();

            var childClone = null;
            if (!(i.getCreatedByParent()))
            {
                if (i.copyNode(childClone, cloneChildren, pathSrc, pathClone))
                {
                    if (clonedByThis)
                    {
                    }
                    return -1;
                }

                if (clone.getChildCount() > pos)
                {
                    clone.insertChild(childClone, pos);
                }
                else
                {
                    clone.addChild(childClone);
                }

                i.postCloneChild(childClone, pathSrc, pathClone);
            }
            else// created by parent -- clone child's children without allocating child
            {
                //childClone = clone.getChild(i - m_children.begin());
                childClone = clone.getChild(i - this.children.start());

                if (i.copyNode(childClone, cloneChildren, pathSrc, pathClone))
                {
                    if (clonedByThis)
                    {
                    }
                    return -1;
                }
            }
        }
    }

    this.postClone(clone, pathSrc, pathClone);

}
Node.prototype.searchTree = function(name, type, searchName, searchType, searchPredecessors, skipChild, skipParent, stopAt, matches)
{
    var names = [];
    var types = [];

    if (!(names.push(name)))
        return;
    if (!(types.push(type)))
        return;

    this.searchesTree(names, types, searchName, searchType, searchPredecessors, skipChild, skipParent, stopAt, matches);
}

Node.prototype.searchesTree = function(names, types, searchNames, searchTypes, searchPredecessors, skipChild, skipParent, stopAt, matches)
{
    // if this node matches any of the names and/or types, add it to the list
    var match = false;
    var nameMatch = false;
    var typeMatch = false;
    if (searchNames)
    {
        for (var i = 0; i < names.size(); i++)
        {
            if (!(this.name == names[i]))
            {
                nameMatch = true;
                break;
            }
        }
    }
    if (searchTypes)
    {
        for (var i = 0; i < types.size(); i++)
        {
            if (this.attrType == types[i])
            {
                typeMatch = true;
                break;
            }
        }
    }
    if (searchNames && searchTypes)
    {
        match = nameMatch && typeMatch;
    }
    else
    if (searchNames)
    {
        match = nameMatch;
    }
    else// searchTypes
    {
        match = typeMatch;
    }
    if (match)
    {
        if (!(matches.push(this)))
            return;
    }

    if (this == stopAt)
    {
        return;
    }

    // recurse on parent(s) if requested (with this set to skipChild)
    if (searchPredecessors)
    {
        for (var i = 0; i < this.parents.size(); i++)
        {
            if (this.parents[i] != skipParent)
            {
                this.parents[i].searchesTree(names, types, searchNames, searchTypes, searchPredecessors, this, null, stopAt, matches);
            }
        }
    }

    // recurse on children (with searchPredecessors set to false)
    for (var i = 0; i < this.children.size(); i++)
    {
        if (this.children[i] != skipChild)
        {
            this.children[i].searchesTree(names, types, searchNames, searchTypes, false, null, null, stopAt, matches);
        }
    }
}
Node.prototype.setCreatedByParent = function(createdByParent)
{
    this.createdByParent = createdByParent;
}
Node.prototype.getCreatedByParent = function()
{
    return this.createdByParent;
}

Node.prototype.isNode = function()
{
    return true;
}

Node.prototype.addChild = function(child)
{
    this.children.push(child);

    this.setModified();

    child.addParent(this);
}

Node.prototype.insertChild = function(child, at)
{
    this.children.splice(at, 0, child);

    this.setModified();

    child.addParent(this);
}

Node.prototype.removeChild = function(child)
{
    this.children.splice(this.children.indexOf(child), 1);

    this.setModified();

    child.removeParent(this);
}

Node.prototype.replaceChild = function(replacement, replacee)
{
    this.children.splice(this.children.indexOf(replacement), 1, replacee);
    replacement.removeParent(this);
    replacee.addParent(this);
}

Node.prototype.getChild = function(n)
{
    if (this.children.length > n)
    {
        return this.children[n];
    }

    return null;
}

Node.prototype.getNamedChild = function(name)
{
    for (var i = 0; i < this.children.length; i++)
    {
        if (this.children[i].name.getValueDirect().join("") == name)
        {
            return this.children[i];
        }
    }

    return null;
}

Node.prototype.getChildCount = function()
{
    return this.children.length;
}

Node.prototype.getParent = function(n)
{
    if (this.parents.length > n)
    {
        return this.parents[n];
    }

    return null;
}

Node.prototype.getParentCount = function()
{
    return this.parents.length;
}

Node.prototype.addParent = function(parent)
{
    this.parents.push(parent);
}

Node.prototype.removeParent = function(parent)
{
    this.parents.splice(this.parents.indexOf(parent), 1);
}

Node.prototype.update = function(params, visitChildren)
{
    params.visited.push(this);

    if (visitChildren)
    {
        // call for all children
        for (var i = 0; i < this.children.length; i++)
        {
            this.children[i].update(params, visitChildren);
        }
    }
}

Node.prototype.apply = function(directive, params, visitChildren)
{
    // commented this out because if an evaluator (e.g., WalkSimulator)
    // happens to be the root node of a subtree and is currently disabled, its subtree will not be visited.
    /*
     var enabled = this.enabled.getValueDirect();
     if (!enabled)
     {
     if (directive != "serialize")
     {
     return;
     }
     }
     */
    switch (directive)
    {
        case "serialize":
            {
                var context = new Context();
                context.attribute = this;

                var factory = this.registry.find("AttributeFactory");
                var serializer = factory.create("Serializer");
                var xmlSerializer = new XMLSerializer();

                // added required format setting - need to revisit to reduce number of required steps
                serializer.getAttribute("format").setValueDirect("xml");
                // set minimum flag so that only the minimum required for recreation is serialized
                serializer.getAttribute("serializeMinimum").setValueDirect(true);
                // set children flag so that child nodes are serialized
                serializer.getAttribute("serializeChildren").setValueDirect(true);
                // serialize
                serializer.serialize(context.attribute, context.item, context.attributeName, context.container);
                var serialized = xmlSerializer.serializeToString(serializer.DOM);
                if (serialized != "<__InitialRoot/>")
                {
                    params.serialized += serialized;
                }

                // do not visit children, as they were serialized by this
                visitChildren = false;
            }
            break;
    }

    if (visitChildren)
    {
        if (params.path)
        {
            // call for next node in path if next node in path is a child of this node
            if (params.path.length > params.pathIndex)
            {
                for (var i = 0; i < this.children.length; i++)
                {
                    var next = params.path[params.pathIndex];

                    if (this.children[i] == next)
                    {
                        params.pathIndex++;
                        this.children[i].apply(directive, params, visitChildren);
                    }
                }
            }
        }
        else
        {
            // call for all children
            for (var i = 0; i < this.children.length; i++)
            {
                this.children[i].apply(directive, params, visitChildren);
            }
        }
    }
}

Node.prototype.applyNode = function(node, directive, params, visitChildren)
{
    node.apply(directive, params, visitChildren);
}

Node.prototype.setModified = function()
{
    this.modified.pulse();
    
    // TODO: remove if
    if (this.graphMgr) this.graphMgr.updateRegistry.register(this);
}


SGNode.prototype = new Node();
SGNode.prototype.constructor = SGNode;

function SGNode()
{
    Node.call(this);
    this.className = "SGNode";

    this.graphMgr = null;
    this.recordDisplayList = false;
    this.disableDisplayLists = false;
    this.displayListObj = null;

    this.enableDisplayList = new BooleanAttr(false);
    this.autoDisplayList = new BooleanAttr(false);
    this.updateDisplayList = new PulseAttr();

    this.modified.addModifiedCB(SGNode_ModifiedModifiedCB, this);
    
    this.registerAttribute(this.enableDisplayList, "enableDisplayList");
    this.registerAttribute(this.autoDisplayList, "autoDisplayList");
    this.registerAttribute(this.updateDisplayList, "updateDisplayList");
}

SGNode.prototype.setGraphMgr = function(graphMgr)
{
    this.graphMgr = graphMgr;
}

SGNode.prototype.update = function(params, visitChildren)
{
    if (this.recordDisplayList)
    {
        this.createDisplayList();
    }

    Node.prototype.update.call(this, params, visitChildren);
}

SGNode.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        return;
    }

    var useDisplayList = false;

    switch (directive)
    {
        case "render":
            {
                if (params.resetDisplayLists)
                {
                    this.recordDisplayList = true;
                }

                // determine if display list should be used; if a display list (from a parent node) is already operating, don't nest record or play...
                // this node's display list operations  will be recorded by the currently operating display list; also check manual override flag for disabling
                // display lists
                useDisplayList = this.enableDisplayList.getValueDirect() &&
                        this.displayListObj != null &&
                        params.displayListObj == null &&
                        !params.disableDisplayLists;

                if (useDisplayList)
                {
                    // set as current display list
                    params.displayListObj = this.displayListObj;

                    if (this.recordDisplayList)
                    {
                        // start recording render engine calls
                        this.displayListObj.record_begin();
                    }
                    else // !this.recordDisplayList
                    {
                        // playback render engine calls and do not visit children
                        this.displayListObj.play();
                        visitChildren = false;
                    }
                }
            }
            break;

        case "rayPick":
            {
                params.currentNodePath.push(this);
            }
            break;

        default:
            {
                // call base-class implementation
                Node.prototype.apply.call(this, directive, params, visitChildren);
                return;
            }
            break;
    }

    if (visitChildren)
    {
        if (params.path)
        {
            // call for next node in path if next node in path is a child of this node
            if (params.path.length > params.pathIndex)
            {
                for (var i = 0; i < this.children.length; i++)
                {
                    var next = params.path[params.pathIndex];

                    if (this.children[i] == next)
                    {
                        params.pathIndex++;
                        this.children[i].apply(directive, params, visitChildren);
                    }
                }
            }
        }
        else
        {
            // call for all children
            for (var i = 0; i < this.children.length; i++)
            {
                this.children[i].apply(directive, params, visitChildren);
            }
        }
    }

    switch (directive)
    {
        case "render":
            {
                if (useDisplayList)
                {
                    if (this.recordDisplayList)
                    {
                        // stop recording render engine calls
                        this.displayListObj.record_end();
                        this.recordDisplayList = false;
                    }

                    // clear current display list
                    params.displayListObj = null;
                }
            }
            break;

        case "rayPick":
            {
                params.currentNodePath.pop();
            }
            break;
    }
}

SGNode.prototype.isRecordingDisplayList = function()
{
    if (this.graphMgr.renderContext.getDisplayList())
    {
        return true;
    }

    return false;
}

SGNode.prototype.createDisplayList = function()
{
    this.displayListObj = new DisplayListObj(this.graphMgr.renderContext);
}

SGNode.prototype.deleteDisplayList = function()
{
    this.displayListObj = null;
}

SGNode.prototype.enableDisplayListModified = function()
{
}

SGNode.prototype.setModified = function()
{
    // call base-class implementation
    Node.prototype.setModified.call(this);

    this.recordDisplayList = true;
}

function SGNode_ModifiedModifiedCB(attribute, container)
{
    container.recordDisplayList = true;
}

RenderableElement.prototype = new SGNode();
RenderableElement.prototype.constructor = RenderableElement;

function RenderableElement()
{
    SGNode.call(this);
    this.className = "RenderableElement";
    this.attrType = eAttrType.RenderableElement;
    
    this.bbox = new BBoxAttr();
    this.renderSequenceSlot = new NumberAttr(0);
    this.hasFocus = new TernaryAttr(0);
    this.selected = new TernaryAttr(0);
    this.styles = new StylesAttr();
    this.stylesMap = new StylesMapAttr();
    this.renderableElementStyle = new RenderableElementStyleAttr();
    this.renderedSlot = new NumberAttr(0);
    
    this.registerAttribute(this.bbox, "bbox");
    this.registerAttribute(this.renderSequenceSlot, "renderSequenceSlot");
    this.registerAttribute(this.hasFocus, "hasFocus");
    this.registerAttribute(this.selected, "selected");
    this.registerAttribute(this.styles, "styles");
    this.registerAttribute(this.stylesMap, "stylesMap");
    this.registerAttribute(this.renderableElementStyle, "renderableElementStyle");
    this.registerAttribute(this.renderedSlot, "renderedSlot");
}

RenderableElement.prototype.setRegistry = function(registry)
{
    this.stylesMap.setRegistry(registry);

    // call base-class implementation
    SGNode.prototype.setRegistry.call(this, registry);
}

RenderableElement.prototype.update = function(params, visitChildren)
{
    // call base-class implementation
    SGNode.prototype.update.call(this, params, visitChildren);
}

RenderableElement.prototype.apply = function(directive, params, visitChildren)
{
    // call base-class implementation
    SGNode.prototype.apply.call(this, directive, params, visitChildren);
}

ParentableMotionElement.prototype = new RenderableElement();
ParentableMotionElement.prototype.constructor = ParentableMotionElement;

function ParentableMotionElement()
{
    RenderableElement.call(this);
    this.className = "ParentableMotionElement";
    this.attrType = eAttrType.ParentableMotionElement;

    this.translationMatrix = new Matrix4x4();           // matrix representing this element's position translation
    this.rotationMatrix = new Matrix4x4();              // matrix representing this element's rotation
    this.scaleMatrix = new Matrix4x4();                 // matrix representing this element's scale transformation
    this.pivotMatrix = new Matrix4x4();                 // matrix representing this element's pivot translation
    this.sectorTranslationMatrix = new Matrix4x4();	// matrix representing this element's sector position translation
    this.stackMatrix = new Matrix4x4();                 // current matrix from the scene graph matrix stack (GcTransform nodes)
    this.transformSimple = new Matrix4x4();             // after Update(), contains this element's transformations (translation/
    							// rotation/scale/pivot)
    this.transformCompound = new Matrix4x4();           // after Update(), contains this element's transformations combined with 
    							// parent's transformations (if any)
    this.sectorTransformSimple = new Matrix4x4();	// after Update(), contains this element's transformations (translation/
    							// rotation/scale/pivot) for the current sector
    this.sectorTransformCompound = new Matrix4x4();     // after Update(), contains this element's transformations combined with 
    							// parent's transformations (if any) for the current sector                                        
    this.updatePosition = false;
    this.updateRotation = false;
    this.updateQuaternion = false;
    this.updateScale = false;
    this.updatePivot = false;
    this.updateSectorPosition = false;
    this.updateInheritance = false;
    this.inheritsPosition = true;
    this.inheritsRotation = true;
    this.inheritsScale = true;
    this.inheritsPivot = true;
    this.nonZeroVelocity = false;
    this.motionParent = null;
    this.motionChildren = [];

    this.position = new Vector3DAttr(0, 0, 0);
    this.rotation = new Vector3DAttr(0, 0, 0);
    this.quaternion = new QuaternionAttr(1, 0, 0, 0);
    this.scale = new Vector3DAttr(1, 1, 1);
    this.pivot = new Vector3DAttr(0, 0, 0);
    this.center = new Vector3DAttr(0, 0, 0);
    this.worldCenter = new Vector3DAttr(0, 0, 0);
    this.worldPosition = new Vector3DAttr(0, 0, 0);
    this.worldRotation = new Vector3DAttr(0, 0, 0);
    this.worldScale = new Vector3DAttr(1, 1, 1);
    this.screenPosition = new Vector3DAttr(0, 0, 0);
    this.sectorOrigin = new Vector3DAttr(0, 0, 0);
    this.sectorPosition = new Vector3DAttr(0, 0, 0);
    this.sectorWorldCenter = new Vector3DAttr(0, 0, 0);
    this.sectorWorldPosition = new Vector3DAttr(0, 0, 0);
    this.panVelocity = new Vector3DAttr(0, 0, 0);          // linear velocity along direction vectors in world-units/second
    this.linearVelocity = new Vector3DAttr(0, 0, 0);       // linear velocity in world-units/second
    this.linearVelocity_affectPosition_Y = new BooleanAttr(true);
    this.angularVelocity = new Vector3DAttr(0, 0, 0);      // angular velocity in degrees/second
    this.scalarVelocity = new Vector3DAttr(0, 0, 0);       // scalar velocity in world-units/second
    this.worldTransform = new Matrix4x4Attr(1, 0, 0, 0,
            0, 1, 0, 0,
            0, 0, 1, 0,
            0, 0, 0, 1);
    this.sectorWorldTransform = new Matrix4x4Attr(1, 0, 0, 0,
            0, 1, 0, 0,
            0, 0, 1, 0,
            0, 0, 0, 1);
    this.parent = new StringAttr("");
    this.inheritPosition_X = new BooleanAttr(true);
    this.inheritPosition_Y = new BooleanAttr(true);
    this.inheritPosition_Z = new BooleanAttr(true);
    this.inheritRotation_X = new BooleanAttr(true);
    this.inheritRotation_Y = new BooleanAttr(true);
    this.inheritRotation_Z = new BooleanAttr(true);
    this.inheritScale_X = new BooleanAttr(true);
    this.inheritScale_Y = new BooleanAttr(true);
    this.inheritScale_Z = new BooleanAttr(true);
    this.inheritPivot_X = new BooleanAttr(true);
    this.inheritPivot_Y = new BooleanAttr(true);
    this.inheritPivot_Z = new BooleanAttr(true);
    this.transformModified = new PulseAttr();               // pulsed when transform has been modified
   
    this.position.addModifiedCB(ParentableMotionElement_PositionModifiedCB, this);
    this.rotation.addModifiedCB(ParentableMotionElement_RotationModifiedCB, this);
    this.quaternion.addModifiedCB(ParentableMotionElement_QuaternionModifiedCB, this);
    this.scale.addModifiedCB(ParentableMotionElement_ScaleModifiedCB, this);
    this.pivot.addModifiedCB(ParentableMotionElement_PivotModifiedCB, this);
    this.sectorOrigin.addModifiedCB(ParentableMotionElement_SectorOriginModifiedCB, this);
    this.sectorPosition.addModifiedCB(ParentableMotionElement_SectorPositionModifiedCB, this);
    this.parent.addModifiedCB(ParentableMotionElement_ParentModifiedCB, this);
    this.inheritPosition_X.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritPosition_Y.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritPosition_Z.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritRotation_X.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritRotation_Y.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritRotation_Z.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritScale_X.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritScale_Y.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritScale_Z.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritPivot_X.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritPivot_Y.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.inheritPivot_Z.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB, this);
    this.panVelocity.addModifiedCB(ParentableMotionElement_VelocityModifiedCB, this);
    this.linearVelocity.addModifiedCB(ParentableMotionElement_VelocityModifiedCB, this);
    this.angularVelocity.addModifiedCB(ParentableMotionElement_VelocityModifiedCB, this);
    this.scalarVelocity.addModifiedCB(ParentableMotionElement_VelocityModifiedCB, this);

    this.registerAttribute(this.position, "position");
    this.registerAttribute(this.rotation, "rotation");
    this.registerAttribute(this.quaternion, "quaternion");
    this.registerAttribute(this.scale, "scale");
    this.registerAttribute(this.pivot, "pivot");
    this.registerAttribute(this.center, "center");
    this.registerAttribute(this.worldCenter, "worldCenter");
    this.registerAttribute(this.worldPosition, "worldPosition");
    this.registerAttribute(this.worldRotation, "worldRotation");
    this.registerAttribute(this.worldScale, "worldScale");
    this.registerAttribute(this.screenPosition, "screenPosition");
    this.registerAttribute(this.sectorOrigin, "sectorOrigin");
    this.registerAttribute(this.sectorPosition, "sectorPosition");
    this.registerAttribute(this.sectorWorldCenter, "sectorWorldCenter");
    this.registerAttribute(this.sectorWorldPosition, "sectorWorldPosition");
    this.registerAttribute(this.worldTransform, "worldTransform");
    this.registerAttribute(this.sectorWorldTransform, "sectorWorldTransform");
    this.registerAttribute(this.panVelocity, "panVelocity");
    this.registerAttribute(this.linearVelocity, "linearVelocity");
    this.registerAttribute(this.linearVelocity_affectPosition_Y, "linearVelocity_affectPosition_Y");
    this.registerAttribute(this.angularVelocity, "angularVelocity");
    this.registerAttribute(this.scalarVelocity, "scalarVelocity");
    this.registerAttribute(this.parent, "parent");
    this.registerAttribute(this.inheritPosition_X, "inheritPosition_X");
    this.registerAttribute(this.inheritPosition_Y, "inheritPosition_Y");
    this.registerAttribute(this.inheritPosition_Z, "inheritPosition_Z");
    this.registerAttribute(this.inheritRotation_X, "inheritRotation_X");
    this.registerAttribute(this.inheritRotation_Y, "inheritRotation_Y");
    this.registerAttribute(this.inheritRotation_Z, "inheritRotation_Z");
    this.registerAttribute(this.inheritScale_X, "inheritScale_X");
    this.registerAttribute(this.inheritScale_Y, "inheritScale_Y");
    this.registerAttribute(this.inheritScale_Z, "inheritScale_Z");
    this.registerAttribute(this.inheritPivot_X, "inheritPivot_X");
    this.registerAttribute(this.inheritPivot_X, "inheritPivot_Y");
    this.registerAttribute(this.inheritPivot_X, "inheritPivot_Z");
    this.registerAttribute(this.transformModified, "transformModified");
}

ParentableMotionElement.prototype.getTransform = function()
{
    var matrix = new Matrix4x4();
    matrix.loadMatrix(this.transformCompound);
    return matrix;
}

ParentableMotionElement.prototype.getSectorTransform = function()
{
    var matrix = new Matrix4x4();
    matrix.loadMatrix(this.sectorTransformCompound);
    return matrix;
}

ParentableMotionElement.prototype.update = function(params, visitChildren)
{
    // update this element's position/rotation as affected by velocity
    if (this.nonZeroVelocity)
    {
        this.updateVelocityMotion(params.timeIncrement);
    }

    if (this.updateInheritance)
    {
        this.updateInheritance = false;

        this.inheritsPosition = this.inheritPosition_X.getValueDirect() &&
                this.inheritPosition_Y.getValueDirect() &&
                this.inheritPosition_Z.getValueDirect();

        this.inheritsRotation = this.inheritRotation_X.getValueDirect() &&
                this.inheritRotation_Y.getValueDirect() &&
                this.inheritRotation_Z.getValueDirect();

        this.inheritsScale = this.inheritScale_X.getValueDirect() &&
                this.inheritScale_Y.getValueDirect() &&
                this.inheritScale_Z.getValueDirect();

        this.inheritsPivot = this.inheritPivot_X.getValueDirect() &&
                this.inheritPivot_Y.getValueDirect() &&
                this.inheritPivot_Z.getValueDirect();
    }

    // update this element's transformations (translation/rotation/scale/pivot)
    this.updateSimpleTransform();
    if (this.motionParent)
    {
        this.motionParent.update(params, false);
    }
    this.updateCompoundTransform();
    this.updateWorldMotionInfo();

    // call base-class implementation
    RenderableElement.prototype.update.call(this, params, visitChildren);
}

ParentableMotionElement.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        RenderableElement.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    switch (directive)
    {
        case "render":
            {
                var screen = toScreenSpace(this.sectorWorldPosition.getValueDirect(),
                        params.viewMatrix, params.projMatrix, params.viewport);
                this.screenPosition.setValueDirect(screen.x, screen.y, screen.z);
            }
            break;
    }

    // call base-class implementation
    RenderableElement.prototype.apply.call(this, directive, params, visitChildren);
}

ParentableMotionElement.prototype.updateChildDisplayLists = function()
{
    /*for (var i=0; i < this.motionChildren.length; i++)
     {
     this.motionChildren[i].updateDisplayList.pulse();
     }*/
}

ParentableMotionElement.prototype.applyTransform = function()
{
    // TODO: if scaling factors are not 1, apply inverse scale before this transformation is
    // applied to avoid translation caused by scaling  

    // set transformation matrix
    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
    this.graphMgr.renderContext.leftMultMatrix(this.sectorTransformCompound);
    this.graphMgr.renderContext.applyWorldTransform();

    // TODO: if invsere scale was applied, re-apply scale
}

ParentableMotionElement.prototype.updateVelocityMotion = function(timeIncrement)
{
    // pan, linear velocity
    var panVelocity = this.panVelocity.getValueDirect();
    var linearVelocity = this.linearVelocity.getValueDirect();
    if (panVelocity.x != 0 || panVelocity.y != 0 || panVelocity.z != 0 ||
        linearVelocity.x != 0 || linearVelocity.y != 0 || linearVelocity.z != 0)
    {
        // position
        var position = this.position.getValueDirect();

        // get direction vectors for pan
        var directionVectors = this.getDirectionVectors();

        // get affect position flags
        var linearVelocity_affectPosition_Y = this.linearVelocity_affectPosition_Y.getValueDirect();

        // update position
        position.x = position.x + (directionVectors.right.x * panVelocity.x * timeIncrement) +
                                  (directionVectors.up.x * panVelocity.y * timeIncrement) +
                                  (directionVectors.forward.x * panVelocity.z * timeIncrement) +
                                  (linearVelocity.x * timeIncrement);
        if (linearVelocity_affectPosition_Y)
        {
            position.y = position.y + (directionVectors.right.y * panVelocity.x * timeIncrement) +
                                      (directionVectors.up.y * panVelocity.y * timeIncrement) +
                                      (directionVectors.forward.y * panVelocity.z * timeIncrement) +
                                      (linearVelocity.y * timeIncrement);
        }
        position.z = position.z + (directionVectors.right.z * panVelocity.x * timeIncrement) +
                                  (directionVectors.up.z * panVelocity.y * timeIncrement) +
                                  (directionVectors.forward.z * panVelocity.z * timeIncrement) +
                                  (linearVelocity.z * timeIncrement);

        this.position.setValueDirect(position.x, position.y, position.z);
    }

    // angular velocity
    var angularVelocity = this.angularVelocity.getValueDirect();
    if (angularVelocity.x != 0 || angularVelocity.y != 0 || angularVelocity.z != 0)
    {
        // rotation
        var rotation = this.rotation.getValueDirect();

        // update rotation
        rotation.x = rotation.x + (angularVelocity.x * timeIncrement);
        rotation.y = rotation.y + (angularVelocity.y * timeIncrement);
        rotation.z = rotation.z + (angularVelocity.z * timeIncrement);

        this.rotation.setValueDirect(rotation.x, rotation.y, rotation.z);
    }

    // scalar velocity
    var scalarVelocity = this.scalarVelocity.getValueDirect();
    if (scalarVelocity.x != 0 || scalarVelocity.y != 0 || scalarVelocity.z != 0)
    {
        // rotation
        var scale = this.scale.getValueDirect();

        // update rotation
        scale.x = scale.x + (scalarVelocity.x * timeIncrement);
        scale.y = scale.y + (scalarVelocity.y * timeIncrement);
        scale.z = scale.z + (scalarVelocity.z * timeIncrement);

        this.scale.setValueDirect(scale.x, scale.y, scale.z);
    }
}

ParentableMotionElement.prototype.updateSimpleTransform = function()
{
    var modified = false;

    if (this.updatePosition || this.updateRotation || this.updateQuaternion || this.updateScale || this.updatePivot)
    {
        var values;

        if (this.updatePosition)
        {
            this.updatePosition = false;

            values = this.position.getValueDirect();
            this.translationMatrix.loadTranslation(values.x, values.y, values.z);

            modified = true;
        }
        /*
        if (this.updateRotation)
        {
            this.updateRotation = false;

            values = this.rotation.getValueDirect();
            var quat = new Quaternion();
            quat.loadXYZAxisRotation(values.x, values.y, values.z);
            //this.quaternion.setValueDirect(quat);
            this.rotationMatrix = quat.getMatrix();

            modified = true;
        }
        */
        if (this.updateQuaternion)
        {
            this.updateQuaternion = false;
            
            var quat = this.quaternion.getValueDirect();
            this.rotationMatrix = quat.getMatrix();

            modified = true;
        }
        
        if (this.updateScale)
        {
            this.updateScale = false;

            values = this.scale.getValueDirect();
            this.scaleMatrix.loadScale(values.x, values.y, values.z);

            modified = true;
        }

        if (this.updatePivot)
        {
            this.updatePivot = false;

            values = this.pivot.getValueDirect();
            this.pivotMatrix.loadTranslation(-values.x, -values.y, -values.z);

            modified = true;
        }

        if (this.updateSectorPosition)
        {
            this.updateSectorPosition = false;

            values = this.sectorPosition.getValueDirect();
            this.sectorTranslationMatrix.loadTranslation(values.x, values.y, values.z);

            modified = true;
        }

        if (modified)
        {
            this.transformModified.pulse();

            // pre-multiply pivot/scale/rotation since this is applied to both regular and sector transforms
            var psr = new Matrix4x4();
            psr.loadMatrix(this.pivotMatrix.multiply(this.scaleMatrix.multiply(this.rotationMatrix)));

            this.transformSimple.loadMatrix(psr.multiply(this.translationMatrix));
            this.sectorTransformSimple.loadMatrix(psr.multiply(this.sectorTranslationMatrix));

            // force any motion children to update their display lists
            this.updateChildDisplayLists();
        }
    }

    return modified;
}

ParentableMotionElement.prototype.updateCompoundTransform = function()
{
    this.transformCompound.loadMatrix(this.transformSimple);
    this.sectorTransformCompound.loadMatrix(this.sectorTransformSimple);

    if (this.motionParent)
    {
        // account for parent's object-inspected rotation
        var inspectionRotationMatrix = new Matrix4x4();
        var inspectionGroup = getInspectionGroup(this.motionParent);
        if (inspectionGroup)
        {
            var translate = inspectionGroup.getChild(0);
            var translationMatrix = translate.getAttribute("matrix").getValueDirect();
            
            var scaleInverse = inspectionGroup.getChild(1);
            var scaleInverseMatrix = scaleInverse.getAttribute("matrix").getValueDirect();
            
            var quaternionRotate = inspectionGroup.getChild(2);
            var rotationMatrix = quaternionRotate.getAttribute("matrix").getValueDirect();
            
            var scale = inspectionGroup.getChild(3);
            var scaleMatrix = scale.getAttribute("matrix").getValueDirect();
            
            var translateBack = inspectionGroup.getChild(4);
            var translationBackMatrix = translateBack.getAttribute("matrix").getValueDirect();
            
            inspectionRotationMatrix = translationBackMatrix.multiply(scaleMatrix.multiply(
                    rotationMatrix.multiply(scaleInverseMatrix.multiply(translationMatrix))));
        }
        
        if (this.inheritsPosition && this.inheritsRotation && this.inheritsScale && this.inheritsPivot)
        {
            this.transformCompound.loadMatrix(this.transformCompound.multiply(inspectionRotationMatrix.multiply(this.motionParent.transformCompound)));
            this.sectorTransformCompound.loadMatrix(this.sectorTransformCompound.multiply(inspectionRotationMatrix.multiply(this.motionParent.sectorTransformCompound)));
        }
        else // !m_inheritsPosition || !m_inheritsRotation || !m_inheritsScale || !m_inheritsPivot
        {
            // TODO
        }
    }
}

ParentableMotionElement.prototype.updateWorldMotionInfo = function()
{
    this.worldTransform.setValueDirect(this.transformCompound);
    this.sectorWorldTransform.setValueDirect(this.sectorTransformCompound);

    this.updateWorldCenter();
    this.updateWorldPosition();
    this.updateWorldRotation();
    this.updateWorldScale();
}

ParentableMotionElement.prototype.updateWorldCenter = function()
{
    var center = this.center.getValueDirect();
    center = this.transformCompound.transform(center.x, center.y, center.z, 1);
    this.worldCenter.setValueDirect(center.x, center.y, center.z);

    center = this.center.getValueDirect();
    center = this.sectorTransformCompound.transform(center.x, center.y, center.z, 1);
    this.sectorWorldCenter.setValueDirect(center.x, center.y, center.z);
}

ParentableMotionElement.prototype.updateWorldPosition = function()
{
    var position = this.transformCompound.transform(0, 0, 0, 1);
    this.worldPosition.setValueDirect(position.x, position.y, position.z);

    position = this.sectorTransformCompound.transform(0, 0, 0, 1);
    this.sectorWorldPosition.setValueDirect(position.x, position.y, position.z);
}

ParentableMotionElement.prototype.updateWorldRotation = function()
{
    var rotation = this.transformCompound.getRotationAngles();
    this.worldRotation.setValueDirect(rotation.x, rotation.y, rotation.z);
}

ParentableMotionElement.prototype.updateWorldScale = function()
{
    var scale = this.transformCompound.getScalingFactors();
    this.worldScale.setValueDirect(scale.x, scale.y, scale.z);
}

ParentableMotionElement.prototype.synchronizePosition = function()
{
    // synchronize position with sector position if necessary (don't sync if not necessary to avoid 
    // the circular dependency between position & sector position

    // get sector origin (use [0, 0, 0] for parented objects)
    var sectorOrigin = new Vector3D();
    if (this.motionParent)
    {
        sectorOrigin.x = 0;
        sectorOrigin.y = 0;
        sectorOrigin.z = 0;
    }
    else // !motionParent
    {
        sectorOrigin = this.sectorOrigin.getValueDirect();
    }

    // get sector position
    var sectorPosition = this.sectorPosition.getValueDirect();

    // get world position
    var position = new Vector3D();
    position.x = sectorOrigin.x + sectorPosition.x;
    position.y = sectorOrigin.y + sectorPosition.y;
    position.z = sectorOrigin.z + sectorPosition.z;

    // update position
    this.position.removeModifiedCB(ParentableMotionElement_PositionModifiedCB, this);
    this.position.setValueDirect(position.x, position.y, position.z);
    this.position.addModifiedCB(ParentableMotionElement_PositionModifiedCB, this);

    // flag a position update
    this.updatePosition = true;
}

ParentableMotionElement.prototype.synchronizeSectorPosition = function()
{
    // synchronize sector position with position if necessary (don't sync if not necessary to avoid 
    // the circular dependency between position & sector position

    // get sector origin (use [0, 0, 0] for parented objects)
    var sectorOrigin = new Vector3D;
    if (this.motionParent)
    {
        sectorOrigin.x = 0;
        sectorOrigin.y = 0;
        sectorOrigin.z = 0;
    }
    else // !motionParent
    {
        sectorOrigin = this.sectorOrigin.getValueDirect();
    }

    // get world position
    var position = this.position.getValueDirect();

    // get sector position
    var sectorPosition = new Vector3D;
    sectorPosition.x = position.x - sectorOrigin.x;
    sectorPosition.y = position.y - sectorOrigin.y;
    sectorPosition.z = position.z - sectorOrigin.z;

    // update sector position
    this.sectorPosition.removeModifiedCB(ParentableMotionElement_SectorPositionModifiedCB, this);
    this.sectorPosition.setValueDirect(sectorPosition.x, sectorPosition.y, sectorPosition.z);
    this.sectorPosition.addModifiedCB(ParentableMotionElement_SectorPositionModifiedCB, this);

    // flag a sector position update
    this.updateSectorPosition = true;
}

ParentableMotionElement.prototype.getDirectionVectors = function()
{
    var up = this.sectorTransformCompound.transform(0, 1, 0, 0);
    var right = this.sectorTransformCompound.transform(1, 0, 0, 0);
    var forward = this.sectorTransformCompound.transform(0, 0, 1, 0);

    return {
        up: up,
        right: right,
        forward: forward
    };
}

ParentableMotionElement.prototype.setMotionParent = function(parent)
{
    if (parent == this)
        return;

    if (this.motionParent)
    {
        for (var i = 0; i < this.motionParent.motionChildren.length; i++)
        {
            if (this.motionParent.motionChildren[i] == this)
            {
                
                this.motionParent.motionChildren.splice(i, 1);
                break;
            }
        }
    }
    
    this.motionParent = parent;
    
    if (parent)
    {
        parent.motionChildren.push(this);
        // make sure this' parent attribute is updated (would not be if this method is called directly); don't invoke modified CB
        this.parent.removeModifiedCB(ParentableMotionElement_ParentModifiedCB, this);
        this.parent.copyValue(parent.name);
        this.parent.addModifiedCB(ParentableMotionElement_ParentModifiedCB, this);
    }
    else
    {
        this.parent.removeModifiedCB(ParentableMotionElement_ParentModifiedCB, this);
        this.parent.setValueDirect("");
        this.parent.addModifiedCB(ParentableMotionElement_ParentModifiedCB, this);
    }

    // set sector position to account for parenting
    this.synchronizeSectorPosition();
    
    this.setModified();
}

ParentableMotionElement.prototype.isMotionAncestor = function(pme)
{
    if (!pme || !this.motionParent) 
        return false;
    
    if (this.motionParent == pme)
        return true;
    
    return this.motionParent.isMotionAncestor(pme);
}
    
ParentableMotionElement.prototype.velocityModified = function()
{
    if (this.panVelocity.isZero() &&
            this.linearVelocity.isZero() &&
            this.angularVelocity.isZero() &&
            this.scalarVelocity.isZero())
    {
        this.nonZeroVelocity = false;
    }
    else
    {
        this.nonZeroVelocity = true;
    }
}

ParentableMotionElement.prototype.setModified = function()
{
    // call base-class implementation
    RenderableElement.prototype.setModified.call(this);
    
    // call for motion children
    for (var i = 0; i < this.motionChildren.length; i++)
    {
        this.motionChildren[i].setModified();
    }
}

function ParentableMotionElement_PositionModifiedCB(attribute, container)
{
    container.updatePosition = true;
    container.synchronizeSectorPosition();
    container.setModified();
}

function ParentableMotionElement_RotationModifiedCB(attribute, container)
{
    //container.updateRotation = true;
    //container.setModified();
    var values = attribute.getValueDirect();
    var quat = new Quaternion();
    quat.loadXYZAxisRotation(values.x, values.y, values.z);
    container.quaternion.setValueDirect(quat);
}

function ParentableMotionElement_QuaternionModifiedCB(attribute, container)
{
    container.updateQuaternion = true;
    container.setModified();
}

function ParentableMotionElement_ScaleModifiedCB(attribute, container)
{
    container.updateScale = true;
    container.setModified();
}

function ParentableMotionElement_PivotModifiedCB(attribute, container)
{
    container.updatePivot = true;
    container.setModified();
}

function ParentableMotionElement_SectorOriginModifiedCB(attribute, container)
{
    container.synchronizeSectorPosition();
    container.setModified();
}

function ParentableMotionElement_SectorPositionModifiedCB(attribute, container)
{
    container.updateSectorPosition = true;
    container.synchronizePosition();
    container.setModified();
}

function ParentableMotionElement_ParentModifiedCB(attribute, container)
{
    container.setMotionParent(container.registry.find(attribute.getValueDirect().join("")));
}

function ParentableMotionElement_VelocityModifiedCB(attribute, container)
{
    container.velocityModified();
    container.setModified();
}

function ParentableMotionElement_InheritanceModifiedCB(attribute, container)
{
    container.updateInheritance = true;
    container.setModified();
}
function DirectiveParams()
{
    this.directive = null;
    this.path = null;
    this.pathIndex = 0;
    this.currentNodePath = new Stack();
    this.userData = null;
}

Directive.prototype = new AttributeContainer();
Directive.prototype.constructor = Directive;

function Directive()
{
    AttributeContainer.call(this);
    this.className = "Directive";
    this.attrType = eAttrType.Directive;
    
    this.name = new StringAttr("");
    this.enabled = new BooleanAttr(true);
    this.rootNode = new ReferenceAttr(null);
    
    this.registerAttribute(this.name, "name");
    this.registerAttribute(this.enabled, "enabled");
    this.registerAttribute(this.rootNode, "rootNode");
}
SGDirective.prototype = new Directive();
SGDirective.prototype.constructor = SGDirective;

function SGDirective()
{
    Directive.call(this);
    this.className = "SGDirective";
    
    this.graphMgr = null;
}

SGDirective.prototype.setGraphMgr = function(graphMgr)
{
    this.graphMgr = graphMgr;
}
UpdateParams.prototype = new DirectiveParams();
UpdateParams.prototype.constructor = UpdateParams();

function UpdateParams() // combined CUpdateParams & GtUpdateParams in this version
{
    DirectiveParams.call(this);
    
    this.pass = 0;
    this.timeIncrement = 0;
    this.visited = [];
    this.nextPass = [];
    this.displayListObj = null;
    this.disableDisplayLists = false;
}

UpdateDirective.prototype = new SGDirective();
UpdateDirective.prototype.constructor = UpdateDirective;

function UpdateDirective()
{
    SGDirective.call(this);
    this.className = "UpdateDirective";
    this.attrType = eAttrType.UpdateDirective;
    
    this.name.setValueDirect("UpdateDirective");
    
    this.timeIncrement = new NumberAttr(0);
    
    this.registerAttribute(this.timeIncrement, "timeIncrement");
    
    this.collideDirective = new CollideDirective();
}

UpdateDirective.prototype.setRegistry = function(registry)
{
    this.collideDirective.setRegistry(registry);    
    
    // call base-class implementation
    SGDirective.prototype.setRegistry.call(this, registry);    
    
    this.registry.register(this.collideDirective);
}

UpdateDirective.prototype.setGraphMgr = function(graphMgr)
{
    // call base-class implementation
    SGDirective.prototype.setGraphMgr.call(this, graphMgr);
    
    this.collideDirective.setGraphMgr(graphMgr);  
}

UpdateDirective.prototype.execute = function(root, detectCollision)
{
    root = root || this.rootNode.getValueDirect();
    if (detectCollision == undefined) detectCollision = true;
    
    this.update();
   
    if (detectCollision)
    {
        // detect collisions
        collideParams = new CollideParams();
        collideParams.directive = this.collideDirective;
        this.collideDirective.execute(root, collideParams);
        
        // update (second pass)
        this.update();
    }
}

UpdateDirective.prototype.update = function()
{
    var params = new UpdateParams();
    params.directive = this.updateDirective;
    params.disableDisplayLists = this.resetDisplayLists; 
    params.timeIncrement = this.timeIncrement.getValueDirect();
    
    for (var i in this.graphMgr.updateRegistry.nodes)
    {
        this.graphMgr.updateRegistry.nodes[i].update(params, false);
    }
    
    this.graphMgr.updateRegistry.clear();
}
Camera.prototype = new ParentableMotionElement();
Camera.prototype.constructor = Camera;

function Camera()
{
    ParentableMotionElement.call(this);
    this.className = "Camera";
    this.attrType = eAttrType.Camera;
    
    this.projectionMatrix = new Matrix4x4();
    this.viewport = new Viewport();
    this.updateNearDistance = false;
    this.updateFarDistance = false;
    this.updateClipPlanes = true;
    this.near = 0;
    this.far = 0;
    
    this.nearDistance = new NumberAttr(0);
    this.farDistance = new NumberAttr(0);
    this.viewVolume = new ViewVolumeAttr();
    //this.viewports
    this.sectorOriginUpdatesEnabled = new BooleanAttr(false);
    //this.updateSectorOrigin
    
    this.nearDistance.addModifiedCB(Camera_NearDistanceModifiedCB, this);
    this.farDistance.addModifiedCB(Camera_FarDistanceModifiedCB, this);
    
    this.registerAttribute(this.nearDistance, "nearDistance");
    this.registerAttribute(this.farDistance, "farDistance");
    this.registerAttribute(this.viewVolume, "viewVolume");
}

Camera.prototype.update = function(params, visitChildren)
{
    if (this.updateNearDistance)
    {
        this.updateNearDistance = false;
        
        this.near = this.nearDistance.getValueDirect();
        
        this.updateClipPlanes = true;
    }
    
    if (this.updateFarDistance)
    {
        this.updateFarDistance = false;
        
        this.far = this.farDistance.getValueDirect();
        
        this.updateClipPlanes = true;
    }
    
    // call base-class implementation
    ParentableMotionElement.prototype.update.call(this, params, visitChildren);
}

Camera.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    switch (directive)
    {
        case "render":
            {
                this.applyTransform();

                params.projMatrix.loadMatrix(this.projectionMatrix);
                params.viewMatrix.loadMatrix(this.sectorTransformCompound);
                params.viewMatrix.invert(); // put in view-space
            }
            break;

        case "rayPick":
            {
                // if a specific camera is specified in the ray pick params,
                // make sure this is the specified camera
                if (!params.camera || params.camera == this)
                {
                    var ray = this.getViewSpaceRay(params.viewport, params.clickPoint);
                    params.rayOrigin = ray.origin;
                    params.rayDir = ray.direction;
                    params.currentCamera = this;
                    params.nearDistance = this.nearDistance.getValueDirect();
                    params.farDistance = this.farDistance.getValueDirect();
                    params.viewMatrix.loadMatrix(this.sectorTransformCompound);
                    params.viewMatrix.invert(); // put in view-space
                }
            }
            break;

        case "bbox":
            {
                // caller wants bbox in view space; set view matrix so that geometry nodes 
                // can multiply world matrix by view matrix to get worldView matrix
                params.viewMatrix.loadMatrix(this.sectorTransformCompound);
                params.viewMatrix.invert(); // put in view-space
            }
            break;
                       
        case "highlight":
            {
                params.projMatrix.loadMatrix(this.projectionMatrix); // TODO: using jittered allows for antialiasing
                params.viewMatrix.loadMatrix(this.transformCompound);
                params.viewMatrix.invert(); // put in view-space
                params.camera = this;
                params.viewport = this.viewport;
            }
            break;
    }

    // call base-class implementation
    ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
}

Camera.prototype.applyTransform = function()
{
    var matrix = new Matrix4x4();
    matrix.loadMatrix(this.sectorTransformCompound);
    matrix.invert();

    this.graphMgr.renderContext.setMatrixMode(RC_VIEW);
    this.graphMgr.renderContext.loadMatrix(matrix);
    this.graphMgr.renderContext.applyViewTransform();
}

function Camera_NearDistanceModifiedCB(attribute, container)
{
    container.updateNearDistance = true;
    container.setModified();
}

function Camera_FarDistanceModifiedCB(attribute, container)
{
    container.updateFarDistance = true;
    container.setModified();
}
OrthographicCamera.prototype = new Camera();
OrthographicCamera.prototype.constructor = OrthographicCamera;

function OrthographicCamera()
{
    Camera.call(this);
    this.className = "OrthographicCamera";
    this.attrType = eAttrType.OrthographicCamera;
    
    this.updateWidth = false;
    
    this.width = new NumberAttr(2);
    
    this.width.addModifiedCB(OrthographicCamera_WidthModifiedCB, this);
    
    this.registerAttribute(this.width, "width");
}

OrthographicCamera.prototype.update = function(params, visitChildren)
{
    if (this.updateWidth)
    {
        this.updateWidth = false;

        this.updateClipPlanes = true;
    }
    
    // call base-class implementation
    Camera.prototype.update.call(this, params, visitChildren);
}

OrthographicCamera.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        Camera.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    
    switch (directive)
    {
    case "render":
        {
            if (!this.viewport.equals(params.viewport))
            {
                this.viewport = params.viewport;
                this.updateClipPlanes = true;  
            }
            
            if (this.updateClipPlanes)
            {
                this.updateClipPlanes = false;
                
                this.setClipPlanes();
            }
            
            this.applyOrthographicTransform();
        }
        break;
    }
    
    // call base-class implementation
    Camera.prototype.apply.call(this, directive, params, visitChildren);
}

OrthographicCamera.prototype.setClipPlanes = function()
{
    var width = this.width.getValueDirect();
    var height = width * this.viewport.height / this.viewport.width;
    
    this.top = height / 2;
    this.bottom = -this.top;
    this.right = width / 2;
    this.left = -this.right;
    
    this.projectionMatrix.loadMatrix(this.graphMgr.renderContext.orthographicMatrixLH(this.left, this.right,
        this.top, this.bottom, this.near, this.far));
        
    // update view-volume attribute
    var viewVolume = new ViewVolume();
    viewVolume.setOrthographic(this.left, this.right, this.top, this.bottom, this.near, this.far);
    this.viewVolume.setValueDirect(viewVolume.left, viewVolume.right, viewVolume.top, viewVolume.bottom,
        viewVolume.near, viewVolume.far);    
}

OrthographicCamera.prototype.applyOrthographicTransform = function()
{
    this.graphMgr.renderContext.projectionMatrixStack.top().loadMatrix(this.projectionMatrix);
    this.graphMgr.renderContext.applyProjectionTransform();
}

OrthographicCamera.prototype.getViewSpaceRay = function(viewport, clickPoint)
{
    // normalize click coordinates so they span [-1, 1] on each axis
    var normX =  ((clickPoint.x - viewport.x) / viewport.width  * 2 - 1);
    var normY = -((clickPoint.y - viewport.y) / viewport.height * 2 - 1);

    // determine the width/2 of the visible portion of the x axis on the 
    // far clipping plane
    var farX  = (this.right - this.left) / 2;

    // determine the height/2 of the visible portion of the y axis on the
    // far clipping plane
    var farY  = (this.top - this.bottom) / 2;

    // set ray origin as point within visible portion of x, y on the 
    // near clipping plane corresponding to the normalized screen coordinates
    var origin = new Vector3D(normX * farX, normY * farY, this.near);

    // set ray direction as point within visible portion of x, y on the 
    // far clipping plane corresponding to the normalized screen coordinates
    //rayDir = CVector3Df(normX * farX, normY * farY, m_far);
    var direction = new Vector3D(0, 0, 1);
    
    return { origin: origin, direction: direction };  
}

function OrthographicCamera_WidthModifiedCB(attribute, container)
{
    container.updateWidth = true;
    container.setModified();
}
PerspectiveCamera.prototype = new Camera();
PerspectiveCamera.prototype.constructor = PerspectiveCamera;

function PerspectiveCamera()
{
    Camera.call(this);
    this.className = "PerspectiveCamera";
    this.attrType = eAttrType.PerspectiveCamera;
    
    this.updateZoom = false;
    this.fovyRadians = 0;
    this.left = 0;
    this.right = 0;
    this.top = 0;
    this.bottom = 0;
    
    this.zoom = new NumberAttr(0);
    
    this.zoom.addModifiedCB(PerspectiveCamera_ZoomModifiedCB, this);
    
    this.registerAttribute(this.zoom, "zoom");
}

PerspectiveCamera.prototype.update = function(params, visitChildren)
{
    if (this.updateZoom)
    {
        this.updateZoom = false;
        
        this.fovyRadians = 2 * Math.atan2(1, this.zoom.getValueDirect());

        this.updateClipPlanes = true;
    }
    
    // call base-class implementation
    Camera.prototype.update.call(this, params, visitChildren);
}

PerspectiveCamera.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        Camera.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    
    switch (directive)
    {
    case "render":
        {
            if (!this.viewport.equals(params.viewport))
            {
                this.viewport = params.viewport;
                this.updateClipPlanes = true;  
            }
            
            if (this.updateClipPlanes)
            {
                this.updateClipPlanes = false;
                
                this.setClipPlanes();
            }
            
            this.applyPerspectiveTransform();
        }
        break;
    }
    
    // call base-class implementation
    Camera.prototype.apply.call(this, directive, params, visitChildren);
}

PerspectiveCamera.prototype.setClipPlanes = function()
{
    this.top = Math.tan(this.fovyRadians / 2) * this.near;
    this.bottom = -this.top;
    this.right = this.top * (this.viewport.width / this.viewport.height);
    this.left = -this.right;
    
    this.projectionMatrix.loadMatrix(this.graphMgr.renderContext.perspectiveMatrixLH(this.left, this.right,
        this.top, this.bottom, this.near, this.far));
        
    // update view-volume attribute
    var viewVolume = new ViewVolume();
    viewVolume.setPerspective(this.fovyRadians, this.viewport.width / this.viewport.height, this.near, this.far);
    this.viewVolume.setValueDirect(viewVolume.left, viewVolume.right, viewVolume.top, viewVolume.bottom,
        viewVolume.near, viewVolume.far);    
}

PerspectiveCamera.prototype.applyPerspectiveTransform = function()
{
    this.graphMgr.renderContext.setMatrixMode(RC_PROJECTION);
    this.graphMgr.renderContext.loadMatrix(this.projectionMatrix);
    this.graphMgr.renderContext.applyProjectionTransform();
}

PerspectiveCamera.prototype.getViewSpaceRay = function(viewport, clickPoint)
{
    // normalize click coordinates so they span [-1, 1] on each axis
    var normX =  ((clickPoint.x - viewport.x) / viewport.width  * 2 - 1);
    var normY = -((clickPoint.y - viewport.y) / viewport.height * 2 - 1);

    // get vertical field of view in radians
    var fovY = this.fovyRadians;

    // get horizontal field of view in radians
    var fovX = 2 * Math.atan(viewport.width / viewport.height * Math.tan(fovY / 2));

    // determine the width/2 of the visible portion of the x axis on the 
    // far clipping plane
    var farX  = Math.tan(fovX / 2) * this.far;

    // determine the height/2 of the visible portion of the y axis on the
    // far clipping plane
    var farY  = Math.tan(fovY / 2) * this.far;

    // set ray origin
    var origin = new Vector3D(0, 0, 0);

    // set ray direction as point within visible portion of x, y on the 
    // far clipping plane corresponding to the normalized screen coordinates
    var direction = new Vector3D(normX * farX, normY * farY, this.far);
    
    return { origin: origin, direction: direction };  
}

function PerspectiveCamera_ZoomModifiedCB(attribute, container)
{
    container.updateZoom = true;
    container.setModified();
}
Light.prototype = new ParentableMotionElement();
Light.prototype.constructor = Light;

function Light()
{
    ParentableMotionElement.call(this);
    this.className = "Light";
    this.attrType = eAttrType.Light;

    this.updateAmbient = true;
    this.updateDiffuse = true;
    this.updateSpecular = true;
    this.updateConstantAttenuation = true;
    this.updateLinearAttenuation = true;
    this.updateQuadraticAttenuation = true;
    this.lightDesc = new LightDesc();
    this.lightDesc.validMembersMask = 0;
    this.lightIndex = 0;
    this.setLightDesc = false;

    this.ambient = new ColorAttr(0, 0, 0, 1);
    this.diffuse = new ColorAttr(1, 1, 1, 1);
    this.specular = new ColorAttr(1, 1, 1, 1);
    this.constantAttenuation = new NumberAttr(1);
    this.linearAttenuation = new NumberAttr(0);
    this.quadraticAttenuation = new NumberAttr(0);
    this.shadowCaster = new BooleanAttr(false);

    this.ambient.addModifiedCB(Light_AmbientModifiedCB, this);
    this.diffuse.addModifiedCB(Light_DiffuseModifiedCB, this);
    this.specular.addModifiedCB(Light_SpecularModifiedCB, this);
    this.constantAttenuation.addModifiedCB(Light_ConstantAttenuationModifiedCB, this);
    this.linearAttenuation.addModifiedCB(Light_LinearAttenuationModifiedCB, this);
    this.quadraticAttenuation.addModifiedCB(Light_QuadraticAttenuationModifiedCB, this);

    this.registerAttribute(this.ambient, "ambient");
    this.registerAttribute(this.diffuse, "diffuse");
    this.registerAttribute(this.specular, "specular");
    this.registerAttribute(this.constantAttenuation, "constantAttenuation");
    this.registerAttribute(this.linearAttenuation, "linearAttenuation");
    this.registerAttribute(this.quadraticAttenuation, "quadraticAttenuation");
    this.registerAttribute(this.shadowCaster, "shadowCaster");
}

Light.prototype.setGraphMgr = function(graphMgr)
{
    this.lightIndex = graphMgr.getAvailableLightIndex();

    // call base-class implementation
    ParentableMotionElement.prototype.setGraphMgr.call(this, graphMgr);
}

Light.prototype.update = function(params, visitChildren)
{
    if (this.updateAmbient)
    {
        this.updateAmbient = false;

        this.lightDesc.ambient.copy(this.ambient.getValueDirect());
        this.lightDesc.validMembersMask |= LIGHTDESC_AMBIENT_BIT;
    }

    if (this.updateDiffuse)
    {
        this.updateDiffuse = false;

        this.lightDesc.diffuse.copy(this.diffuse.getValueDirect());
        this.lightDesc.validMembersMask |= LIGHTDESC_DIFFUSE_BIT;
    }

    if (this.updateSpecular)
    {
        this.updateSpecular = false;

        this.lightDesc.specular.copy(this.specular.getValueDirect());
        this.lightDesc.validMembersMask |= LIGHTDESC_SPECULAR_BIT;
    }

    if (this.updateConstantAttenuation)
    {
        this.updateConstantAttenuation = false;

        this.lightDesc.constantAttenuation = this.constantAttenuation.getValueDirect();
        this.lightDesc.validMembersMask |= LIGHTDESC_CONSTANT_ATT_BIT;
    }

    if (this.updateLinearAttenuation)
    {
        this.updateLinearAttenuation = false;

        this.lightDesc.linearAttenuation = this.linearAttenuation.getValueDirect();
        this.lightDesc.validMembersMask |= LIGHTDESC_LINEAR_ATT_BIT;
    }

    if (this.updateQuadraticAttenuation)
    {
        this.updateQuadraticAttenuation = false;

        this.lightDesc.quadraticAttenuation = this.quadraticAttenuation.getValueDirect();
        this.lightDesc.validMembersMask |= LIGHTDESC_QUADRATIC_ATT_BIT;
    }

    if (this.lightDesc.validMembersMask)
    {
        this.setLightDesc = true;
    }

    // ensure continued update (lights are transformed by view matrix)
    this.setModified();

    // call base-class implementation
    ParentableMotionElement.prototype.update.call(this, params, visitChildren);
}

Light.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        switch (directive)
        {
            case "render":
                {
                    this.setLightEnabled();
                }
                break;
        }

        // call base-class implementation
        ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    switch (directive)
    {
        case "render":
            {
                if (this.setLightDesc)
                {
                    this.setLightDesc = false;

                    this.applyLightDesc();
                }

                this.setLightEnabled();
                params.lights.push(this);
            }
            break;
    }

    // call base-class implementation
    ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
}

Light.prototype.applyLightDesc = function()
{
    this.graphMgr.renderContext.setLight(this.lightIndex, this.lightDesc);
}

Light.prototype.setLightEnabled = function()
{
    this.graphMgr.renderContext.enableLight(this.lightIndex, this.enabled.getValueDirect() ? 1 : 0);
}

Light.prototype.onUnregister = function()
{
    // disable light
    this.graphMgr.renderContext.enableLight(this.lightIndex, 0);
}

function Light_AmbientModifiedCB(attribute, container)
{
    container.updateAmbient = true;
    container.setModified();
}

function Light_DiffuseModifiedCB(attribute, container)
{
    container.updateDiffuse = true;
    container.setModified();
}

function Light_SpecularModifiedCB(attribute, container)
{
    container.updateSpecular = true;
    container.setModified();
}

function Light_ConstantAttenuationModifiedCB(attribute, container)
{
    container.updateConstantAttenuation = true;
    container.setModified();
}

function Light_LinearAttenuationModifiedCB(attribute, container)
{
    container.updateLinearAttenuation = true;
    container.setModified();
}

function Light_QuadraticAttenuationModifiedCB(attribute, container)
{
    container.updateQuadraticAttenuation = true;
    container.setModified();
}

DirectionalLight.prototype = new Light();
DirectionalLight.prototype.constructor = DirectionalLight;

function DirectionalLight()
{
    Light.call(this);
    this.className = "DirectionalLight";
    this.attrType = eAttrType.DirectionalLight;
    
    this.lightDesc.type = "directional";
}

DirectionalLight.prototype.update = function(params, visitChildren)
{
    this.validMembersMask = 0;
    
    // call base-class implementation
    Light.prototype.update.call(this, params, visitChildren);
}

DirectionalLight.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        Light.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    
    switch (directive)
    {
    case "render":
        {      
            var direction = this.sectorTransformCompound.transform(0, 0, 1, 0);
            this.lightDesc.direction.copy(direction);
            this.lightDesc.validMembersMask |= LIGHTDESC_DIRECTION_BIT; 
            
            // must re-update direction every frame because OpenGL transforms
            // light direction by the current modelView matrix
            this.setLightDesc = true;
        }
        break;
    }
    
    // call base-class implementation
    Light.prototype.apply.call(this, directive, params, visitChildren);
}
PointLight.prototype = new Light();
PointLight.prototype.constructor = PointLight;

function PointLight()
{
    Light.call(this);
    this.className = "PointLight";
    this.attrType = eAttrType.PointLight;
    
    this.lightDesc.type = "point";
    
    this.updateRange = false;
    
    this.range = new NumberAttr();
    
    this.range.addModifiedCB(PointLight_RangeModifiedCB, this);

    this.registerAttribute(this.range, "range");
}

PointLight.prototype.setGraphMgr = function(graphMgr)
{
    // call base-class implementation
    Light.prototype.setGraphMgr.call(this, graphMgr);
    
    this.range.setValueDirect(FLT_MAX); // invoke modified CB
}

PointLight.prototype.update = function(params, visitChildren)
{
    this.validMembersMask = 0;
    
    if (this.updateRange)
    {
        this.updateRange = false;

        this.lightDesc.range = this.range.getValueDirect();
        this.lightDesc.validMembersMask |= LIGHTDESC_RANGE_BIT;
    }
    
    // call base-class implementation
    Light.prototype.update.call(this, params, visitChildren);
}

PointLight.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        Light.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    
    switch (directive)
    {
    case "render":
        {      
            var position = this.sectorTransformCompound.transform(0, 0, 0, 1);
            this.lightDesc.position.copy(position);
            this.lightDesc.validMembersMask |= LIGHTDESC_POSITION_BIT;

            // signifies this is a point light (not a spot light)
            this.lightDesc.outerConeDegrees = 180;
            this.lightDesc.validMembersMask |= LIGHTDESC_OUTER_CONE_DEG_BIT;
            
            // must re-update position every frame because OpenGL transforms
            // light position by the current modelView matrix
            this.setLightDesc = true;
        }
        break;
    }
    
    // call base-class implementation
    Light.prototype.apply.call(this, directive, params, visitChildren);
}

function PointLight_RangeModifiedCB(attribute, container)
{
    container.updateRange = true;
    container.setModified();
}
GlobalIllumination.prototype = new SGNode();
GlobalIllumination.prototype.constructor = GlobalIllumination;

function GlobalIllumination()
{
    SGNode.call(this);
    this.className = "GlobalIllumination";
    this.attrType = eAttrType.GlobalIllumination;
    
    this.updateAmbient = true;
    this.setGlobalIllumination = false;
    
    this.ambient = new ColorAttr(0, 0, 0, 1);
    
    this.ambient.addModifiedCB(GlobalIllumination_AmbientModifiedCB, this);
    
    this.registerAttribute(this.ambient, "ambient");
}

GlobalIllumination.prototype.update = function(params, visitChildren)
{
    if (this.updateAmbient)
    {
        this.updateAmbient = false;
        
        this.setGlobalIllumination = true;
    }
    
    // call base-class implementation
    SGNode.prototype.update.call(this, params, visitChildren);
}

GlobalIllumination.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    
    switch (directive)
    {
    case "render":
        {
            if (this.setGlobalIllumination)
            {
                this.setGlobalIllumination = false;
                
                this.applyGlobalIllumination();
            }
        }
        break;
    }
    
    // call base-class implementation
    SGNode.prototype.apply.call(this, directive, params, visitChildren);
}

GlobalIllumination.prototype.applyGlobalIllumination = function()
{
    this.graphMgr.renderContext.setGlobalIllumination(this.ambient.getValueDirect());
}

GlobalIllumination.prototype.onUnregister = function()
{
    // disable global illumination (set to black)
    var black = new Color(0, 0, 0, 0);
    this.graphMgr.renderContext.setGlobalIllumination(black);  
}

function GlobalIllumination_AmbientModifiedCB(attribute, container)
{
    container.updateAmbient = true;
    container.setModified();
}
Group.prototype = new SGNode();
Group.prototype.constructor = Group;

function Group()
{
    SGNode.call(this);
    this.className = "Group";
    this.attrType = eAttrType.Group;

    this.proxyChildAttrs = new BooleanAttr(false);

    this.proxyChildAttrs.addModifiedCB(Group_ProxyChildAttrsModifiedCB, this);

    this.registerAttribute(this.proxyChildAttrs, "proxyChildAttrs");
}

Group.prototype.addChild = function(child)
{
    if (this.proxyChildAttrs.getValueDirect() == true)
    {
        this.proxyAttributes(child);
    }

    // call base-class implementation
    SGNode.prototype.addChild.call(this, child);
}

Group.prototype.insertChild = function(child, at)
{
    if (this.proxyChildAttrs.getValueDirect() == true)
    {
        this.proxyAttributes(child);
    }

    // call base-class implementation
    SGNode.prototype.insertChild.call(this, child, at);
}

Group.prototype.removeChild = function(child)
{
    if (this.proxyChildAttrs.getValueDirect() == true)
    {
        //UnProxyAttributes(child);
        this.synchronizeProxiedAttributes();
    }

    // call base-class implementation
    return SGNode.prototype.removeChild.call(this, child);
}

Group.prototype.replaceChild = function(replacement, replacee)
{
    if (this.proxyChildAttrs.getValueDirect() == true)
    {
        //UnProxyAttributes(replacee);
        this.proxyAttributes(replacement);
        this.synchronizeProxiedAttributes(); // replacement might not be the same type as replacee
    }

    // call base-class implementation
    return SGNode.prototype.replaceChild.call(this, replacement, replacee);
}

Group.prototype.update = function(params, visitChildren)
{
    // call base-class implementation
    SGNode.prototype.update.call(this, params, visitChildren);
}

Group.prototype.apply = function(directive, params, visitChildren)
{
    // call base-class implementation
    SGNode.prototype.apply.call(this, directive, params, visitChildren);
}

Group.prototype.proxyChildAttrsModified = function()
{
    // TODO
}

function Group_ProxyChildAttrsModifiedCB(attribute, container)
{
    container.proxyChildAttrsModified();
}

function Group_ProxiedAttrModifiedCB(attribute, data)
{
    data.group.proxiedAttrModified(data.proxiedNodeTypeString, attribute, data.proxiedAttrName);
}

Isolator.prototype = new Group();
Isolator.prototype.constructor = Isolator;

function Isolator()
{
    Group.call(this);
    this.className = "Isolator";
    this.attrType = eAttrType.Isolator;

    this.updateIsolateTransforms = true;
    this.updateIsolateLights = true;
    this.updateIsolateMaterials = true;
    this.updateIsolateTextures = true;
    this.updateIsolateFog = true;
    this.updateIsolateClipPlanes = true;

    this.isolateTransforms = new BooleanAttr(false);
    this.isolateLights = new BooleanAttr(false);
    this.isolateMaterials = new BooleanAttr(false);
    this.isolateTextures = new BooleanAttr(false);
    this.isolateDissolves = new BooleanAttr(false);
    this.isolateGlobalIlluminations = new BooleanAttr(false);
    this.isolateLightModels = new BooleanAttr(false);
    this.isolateFog = new BooleanAttr(false);
    this.isolateClipPlanes = new BooleanAttr(false);
    this.isolateRenderModes = new BooleanAttr(false);

    this.isolateTransforms.addModifiedCB(Isolator_IsolateTransformsModifiedCB, this);
    this.isolateLights.addModifiedCB(Isolator_IsolateLightsModifiedCB, this);
    this.isolateMaterials.addModifiedCB(Isolator_IsolateMaterialsModifiedCB, this);
    this.isolateTextures.addModifiedCB(Isolator_IsolateTexturesModifiedCB, this);
    this.isolateFog.addModifiedCB(Isolator_IsolateFogModifiedCB, this);
    this.isolateClipPlanes.addModifiedCB(Isolator_IsolateClipPlanesModifiedCB, this);

    this.registerAttribute(this.isolateTransforms, "isolateTransforms");
    this.registerAttribute(this.isolateLights, "isolateLights");
    this.registerAttribute(this.isolateMaterials, "isolateMaterials");
    this.registerAttribute(this.isolateTextures, "isolateTextures");
    this.registerAttribute(this.isolateDissolves, "isolateDissolves");
    this.registerAttribute(this.isolateGlobalIlluminations, "isolateGlobalIlluminations");
    this.registerAttribute(this.isolateLightModels, "isolateLightModels");
    this.registerAttribute(this.isolateFog, "isolateFog");
    this.registerAttribute(this.isolateClipPlanes, "isolateClipPlanes");
    this.registerAttribute(this.isolateRenderModes, "isolateRenderModes");
}

Isolator.prototype.update = function(params, visitChildren)
{
    // call base-class implementation
    Group.prototype.update.call(this, params, visitChildren);
}

Isolator.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        Group.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    var isolateLights = this.isolateLights.values[0];
    var isolateTransforms = this.isolateTransforms.values[0];
    var isolateTextures = this.isolateTextures.values[0];
    var isolateDissolves = this.isolateDissolves.values[0];
    var isolateClipPlanes = this.isolateClipPlanes.values[0];

    var lastDissolve = 0;
    var dissolveNode = null;

    var lastProjMatrix = null;
    var lastViewMatrix = null;
    var lastWorldMatrix = null;

    var lights = null;
    
    switch (directive)
    {
        case "render":
        case "shadow":
            {
                this.pushIsolatedStates();

                // TODO

                // push lights
                if (isolateLights)
                {
                    // TODO
                    lights = params.lights.slice();
                }

                // push transforms
                if (isolateTransforms)
                {
                    lastProjMatrix = params.projMatrix;
                    lastViewMatrix = params.viewMatrix;
                    lastWorldMatrix = params.worldMatrix;

                    // TEMP -- move to pushIsolatedStates
                    this.graphMgr.renderContext.setMatrixMode(RC_PROJECTION);
                    this.graphMgr.renderContext.pushMatrix();
                    this.graphMgr.renderContext.setMatrixMode(RC_VIEW);
                    this.graphMgr.renderContext.pushMatrix();
                    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
                    this.graphMgr.renderContext.pushMatrix();
                }

                // push textures
                if (isolateTextures)
                {
                    this.graphMgr.textureArrayStack.push(new TextureArray(this.graphMgr.textureArrayStack.top()));

                    // TODO: projection stack 
                }
            }
            break;

        case "rayPick":
            {
                // push dissolve and dissolve node
                if (isolateDissolves)
                {
                    lastDissolve = params.dissolve;
                    dissolveNode = this.graphMgr.getCurrentDissolve();
                }

                // push transforms
                if (isolateTransforms)
                {
                    // TODO
                }

                // push clip planes
                if (isolateClipPlanes)
                {
                    // TODO
                }
            }
            break;

        case "bbox":
            {
                // push transforms
                if (isolateTransforms)
                {
                    lastWorldMatrix = params.worldMatrix;
                }
            }
            break;

        case "collide":
            {
                // push transforms
                if (isolateTransforms)
                {
                    lastWorldMatrix = params.worldMatrix;
                }
            }
            break;

        case "highlight":
            {
                // push transforms
                if (isolateTransforms)
                {
                    lastWorldMatrix = params.worldMatrix;
                }
            }
            break;
    }

    // call base-class implementation
    Group.prototype.apply.call(this, directive, params, visitChildren);

    switch (directive)
    {
        case "render":
        case "shadow":
            {
                this.popIsolatedStates();

                // TODO

                // pop lights
                if (isolateLights)
                {
                    // TODO
                    params.lights = lights.slice();
                }
                
                // pop transforms
                if (isolateTransforms)
                {
                    params.projMatrix = lastProjMatrix;
                    params.viewMatrix = lastViewMatrix;
                    params.worldMatrix = lastWorldMatrix;

                    // TEMP -- move to popIsolatedStates
                    this.graphMgr.renderContext.setMatrixMode(RC_PROJECTION);
                    this.graphMgr.renderContext.popMatrix();
                    this.graphMgr.renderContext.setMatrixMode(RC_VIEW);
                    this.graphMgr.renderContext.popMatrix();
                    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
                    this.graphMgr.renderContext.popMatrix();
                }

                // pop textures
                if (isolateTextures)
                {
                    this.graphMgr.textureArrayStack.pop();

                    // TODO: projection stack 
                }
            }
            break;

        case "rayPick":
            {
                // pop dissolve
                if (isolateDissolves)
                {
                    params.dissolve = lastDissolve;
                    this.graphMgr.setCurrentDissolve(dissolveNode);
                }

                // pop transforms
                if (isolateTransforms)
                {
                    // TODO
                }

                // pop clip planes
                if (isolateClipPlanes)
                {
                    // TODO
                }
            }
            break;

        case "bbox":
            {
                // pop transforms
                if (isolateTransforms)
                {
                    params.worldMatrix = lastWorldMatrix;
                }
            }
            break;

        case "collide":
            {
                // pop transforms
                if (isolateTransforms)
                {
                    params.worldMatrix = lastWorldMatrix;
                }
            }
            break;

        case "highlight":
            {
                // pop transforms
                if (isolateTransforms)
                {
                    params.worldMatrix = lastWorldMatrix;
                }
            }
            break;
    }
}

Isolator.prototype.pushIsolatedStates = function()
{
    // TODO


}

Isolator.prototype.popIsolatedStates = function()
{
    // TODO
}

function Isolator_IsolateTransformsModifiedCB(attribute, container)
{
    container.updateIsolateTransforms = true;
    container.setModified();
}

function Isolator_IsolateLightsModifiedCB(attribute, container)
{
    container.updateIsolateLights = true;
    container.setModified();
}

function Isolator_IsolateMaterialsModifiedCB(attribute, container)
{
    container.updateIsolateMaterials = true;
    container.setModified();
}

function Isolator_IsolateTexturesModifiedCB(attribute, container)
{
    container.updateIsolateTextures = true;
    container.setModified();
}

function Isolator_IsolateFogModifiedCB(attribute, container)
{
    container.updateIsolateFog = true;
    container.setModified();
}

function Isolator_IsolateClipPlanesModifiedCB(attribute, container)
{
    container.updateIsolateClipPlanes = true;
    container.setModified();
}

Selector.prototype = new Group();
Selector.prototype.constructor = Selector;

function Selector()
{
    Group.call(this);
    this.className = "Selector";
    this.attrType = eAttrType.Selector;
    
    this.selectee = new NumberAttr(0);
    
    this.registerAttribute(this.selectee, "selectee");
}

Selector.prototype.update = function(params, visitChildren)
{
    // call update for selected child    
    var selectee = this.selectee.getValueDirect();
    if (visitChildren && this.children.length > selectee)
    {
        this.children[selectee].update(params, visitChildren);
        return;
    }
    
    // call base-class implementation
    Group.prototype.update.call(this, params, visitChildren);
}

Selector.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        Group.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    // call apply for selected child
    var selectee = this.selectee.getValueDirect();
    if (visitChildren && this.children.length > selectee)
    {
        this.children[selectee].apply(directive, params, visitChildren);
        return;
    }
    
    // call base-class implementation
    Group.prototype.apply.call(this, directive, params, visitChildren);
}

Dissolve.prototype = new SGNode();
Dissolve.prototype.constructor = Dissolve;

function Dissolve()
{
    SGNode.call(this);
    this.className = "Dissolve";
    this.attrType = eAttrType.Dissolve;
    
    this.lastDissolve = 0;

    this.dissolve = new NumberAttr(0);

    this.dissolve.addModifiedCB(Dissolve_DissolveModifiedCB, this);

    this.registerAttribute(this.dissolve, "dissolve");
}

Dissolve.prototype.update = function(params, visitChildren)
{
    // call base-class implementation
    SGNode.prototype.update.call(this, params, visitChildren);
}

Dissolve.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        Group.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    switch (directive)
    {
        case "render":
        case "shadow":
            {
                var dissolve = this.dissolve.getValueDirect();
                this.lastDissolve = dissolve;
                
                params.dissolve = dissolve;
            }
            break;

        case "rayPick":
            {
                params.dissolve = this.lastDissolve;
            }
            break;
    }

    // call base-class implementation
    SGNode.prototype.apply.call(this, directive, params, visitChildren);
}

function Dissolve_DissolveModifiedCB(attribute, container)
{
    container.setModified();   
}
RenderParams.prototype = new DirectiveParams();
RenderParams.prototype.constructor = RenderParams();

function RenderParams()
{
    DirectiveParams.call(this);
    
    this.viewport = new Viewport();
    this.projMatrix = new Matrix4x4();
    this.viewMatrix = new Matrix4x4();
    this.worldMatrix = new Matrix4x4();
    this.dissolve = 0;
    this.opacity = 1;
    this.distanceSortAgent = null;
    this.drawTextures = true;
    this.displayListObj = null;
    this.disableDisplayLists = false;
    this.resetDisplayLists = false;
    this.lights = [];
    this.modelID = 0;
}

RenderDirective.prototype = new SGDirective();
RenderDirective.prototype.constructor = RenderDirective;

function RenderDirective()
{
    SGDirective.call(this);
    this.className = "RenderDirective";
    this.attrType = eAttrType.RenderDirective;
    
    this.name.setValueDirect("RenderDirective");

    this.backgroundImageSet = false;
    
    this.program = null;
    this.viewport = new ViewportAttr();
    this.backgroundColor = new ColorAttr(1, 1, 1, 1);
    this.backgroundImageFilename = new StringAttr("");
    this.foregroundImageFilename = new StringAttr("");
    this.foregroundAlphaFilename = new StringAttr("");
    this.foregroundFadeEnabled = new BooleanAttr(false);
    this.texturesEnabled = new BooleanAttr(true);
    this.shadowsEnabled = new BooleanAttr(false);//true);
    this.timeIncrement = new NumberAttr(0);
    this.highlightType = new NumberAttr(eHighlightType.None);
    
    this.viewport.addModifiedCB(RenderDirective_ViewportModifiedCB, this);
    this.backgroundColor.addModifiedCB(RenderDirective_BackgroundColorModifiedCB, this);
    this.backgroundImageFilename.addModifiedCB(RenderDirective_BackgroundImageFilenameModifiedCB, this);
    this.shadowsEnabled.addModifiedCB(RenderDirective_ShadowsEnabledModifiedCB, this);
    
    this.registerAttribute(this.viewport, "viewport");
    this.registerAttribute(this.backgroundColor, "backgroundColor");
    this.registerAttribute(this.backgroundImageFilename, "backgroundImageFilename");
    this.registerAttribute(this.foregroundImageFilename, "foregroundImageFilename");
    this.registerAttribute(this.foregroundAlphaFilename, "foregroundAlphaFilename");   
    this.registerAttribute(this.foregroundFadeEnabled, "foregroundFadeEnabled");   
    this.registerAttribute(this.texturesEnabled, "texturesEnabled");
    this.registerAttribute(this.shadowsEnabled, "shadowsEnabled");
    this.registerAttribute(this.timeIncrement, "timeIncrement");
    this.registerAttribute(this.highlightType, "highlightType");
    
    this.updateDirective = new UpdateDirective();
    this.timeIncrement.addTarget(this.updateDirective.getAttribute("timeIncrement"));
    this.resetDisplayLists = false;
    
    this.distanceSortAgent = new DistanceSortAgent();
       
    this.highlightDirective = new HighlightDirective();
    this.highlightType.addTarget(this.highlightDirective.getAttribute("highlightType"));
    
    this.shadowDirective = new ShadowDirective();
    
    this.backgroundScreen = new Isolator();
    this.backgroundScreen.isolateTextures.setValueDirect(true);
    
    this.backgroundTexture = new MediaTexture();
    this.backgroundScreen.addChild(this.backgroundTexture);
    
    this.backgroundScreenRect = new ScreenRect();
    this.backgroundScreenRect.setTexture(this.backgroundTexture);
    this.backgroundScreen.addChild(this.backgroundScreenRect);
}

RenderDirective.prototype.setRegistry = function(registry)
{
    this.distanceSortAgent.setRegistry(registry);
    this.updateDirective.setRegistry(registry);
    this.highlightDirective.setRegistry(registry);
    this.shadowDirective.setRegistry(registry); registry.register(this.shadowDirective);
    this.backgroundScreen.setRegistry(registry);
    this.backgroundTexture.setRegistry(registry);
    this.backgroundScreenRect.setRegistry(registry);
    
    // call base-class implementation
    SGDirective.prototype.setRegistry.call(this, registry);    
}

RenderDirective.prototype.setGraphMgr = function(graphMgr)
{
    this.distanceSortAgent.setGraphMgr(graphMgr);
    this.updateDirective.setGraphMgr(graphMgr);
    this.highlightDirective.setGraphMgr(graphMgr);
    this.shadowDirective.setGraphMgr(graphMgr);
    this.backgroundScreen.setGraphMgr(graphMgr);
    this.backgroundTexture.setGraphMgr(graphMgr);
    this.backgroundScreenRect.setGraphMgr(graphMgr);
    
    // create shader program
    if (this.shadowsEnabled.getValueDirect() == true)
    {
        this.program = graphMgr.renderContext.createProgram(pcf_shadow_mapping_render_pass_vs, pcf_shadow_mapping_render_pass_fs);
    }
    else
    {
        this.program = graphMgr.renderContext.createProgram(default_vertex_lighting_vs, default_vertex_lighting_fs);
    }

    // call base-class implementation
    SGDirective.prototype.setGraphMgr.call(this, graphMgr);
}

RenderDirective.prototype.execute = function(root)
{  
    // set shader program
    this.graphMgr.renderContext.useProgram(this.program);
    
    // draw background
    //this.drawBackground();
    
    root = root || this.rootNode.getValueDirect();

    this.updateDirective.execute(root);
    
    if (this.shadowsEnabled.getValueDirect() == true)
    {
        // setup shadow map
        this.shadowDirective.execute(root);
    }

    // render
    params = new RenderParams();
    params.directive = this;
    params.path = null;
    params.pathIndex = 1;
    params.viewport.loadViewport(this.viewport.getValueDirect());
    params.distanceSortAgent = this.distanceSortAgent;
    params.drawTextures = this.texturesEnabled.getValueDirect();

    // if resetting display lists, set the disableDisplayLists renderParams flag this render
    if (this.resetDisplayLists)
    {
    	params.resetDisplayLists = true;
        this.resetDisplayLists = false;
    }
        
    root.apply("render", params, true);
    
    // sort and draw semi-transparent geometries (if any)
    if (!this.distanceSortAgent.isEmpty())
    {
        this.distanceSortAgent.sort();
        this.distanceSortAgent.draw();
        this.distanceSortAgent.clear();
    }
    
    // draw highlights
    this.drawHighlights(root);
}

RenderDirective.prototype.drawBackground = function()
{
    if (!this.backgroundImageSet) return;
    
    // update
    var visited = this.updateDirective.execute(this.backgroundScreen, false);
    
    // render
    params = new RenderParams();
    params.directive = this;
    params.path = null;
    params.pathIndex = 1;
    params.viewport.loadViewport(this.viewport.getValueDirect());

    visited[0].apply("render", params, true);
}

RenderDirective.prototype.drawHighlights = function(root)
{
    // apply highlight directive if specified
    switch (this.highlightType.getValueDirect())
    {
    case eHighlightType.FourPass:
    case eHighlightType.EightPass:
        this.highlightDirective.execute(root);
        break;

    case eHighlightType.None:
    default:
        break;
    }   
}

RenderDirective.prototype.backgroundColorModified = function()
{
    var color = this.backgroundColor.getValueDirect();
    this.graphMgr.renderContext.clearColor(color.r, color.g, color.b, color.a);    
}

function RenderDirective_ViewportModifiedCB(attribute, container)
{
    var vp = container.viewport.getValueDirect();
    var url = container.backgroundImageFilename.getValueDirect().join("");
    container.graphMgr.renderContext.setBackgroundImage(url, vp.width, vp.height);
}

function RenderDirective_BackgroundColorModifiedCB(attribute, container)
{
    container.backgroundColorModified();
}

function RenderDirective_BackgroundImageFilenameModifiedCB(attribute, container)
{
    var vp = container.viewport.getValueDirect();
    var pathInfo = formatPath(container.backgroundImageFilename.getValueDirect().join(""));
    
    container.backgroundImageFilename.removeModifiedCB(RenderDirective_BackgroundImageFilenameModifiedCB, container);
    container.backgroundImageFilename.setValueDirect(pathInfo[0]);
    container.backgroundImageFilename.addModifiedCB(RenderDirective_BackgroundImageFilenameModifiedCB, container);
    
    //container.graphMgr.renderContext.setBackgroundImage(pathInfo[0], vp.width, vp.height);
    container.backgroundTexture.imageFilename.setValueDirect(pathInfo[0]);
    container.backgroundImageSet = true;
}

function RenderDirective_ShadowsEnabledModifiedCB(attribute, container)
{
    var enabled = attribute.getValueDirect();
    if (enabled)
    {
        container.program = container.graphMgr.renderContext.createProgram(pcf_shadow_mapping_render_pass_vs, pcf_shadow_mapping_render_pass_fs);
    }
    else
    {
        container.program = container.graphMgr.renderContext.createProgram(default_vertex_lighting_vs, default_vertex_lighting_fs);
    }
}
RayPickParams.prototype = new DirectiveParams();
RayPickParams.prototype.constructor = RayPickParams();

function RayPickParams()
{
    DirectiveParams.call(this);
    
    /// camera to perform selection testing with
    this.camera = null;
    /// current camera
    this.currentCamera = null;
    /// current viewport
    this.viewport = new Viewport();
    /// click point
    this.clickPoint = new Vector2D();
    /// origin of the ray
    this.rayOrigin = new Vector3D();
    /// direction of the ray
    this.rayDir = new Vector3D();
    /// camera near distance
    this.nearDistance = 0;
    /// camera far distance
    this.farDistance = 0;
    /// current view matrix
    this.viewMatrix = new Matrix4x4();
    /// current world matrix
    this.worldMatrix = new Matrix4x4();
    /// current sector origin
    this.sectorOrigin = new Vector3D();
    /// current material double-sided setting 
    this.doubleSided = false;
    /// current material opacity setting
    this.opacity = 0;
    /// current dissolve
    this.dissolve = 0;
    /// current clip plane(s)
    this.clipPlanes = [];
}

function RayPickRecord(path, intersectRecord, camera)
{
    /// the path of the picked geometry
    this.path = path.copy();
    /// intersection record
    this.intersectRecord = intersectRecord;
    /// the camera viewing the picked geometry
    this.camera = camera;
}

RayPickDirective.prototype = new SGDirective();
RayPickDirective.prototype.constructor = RayPickDirective;

function RayPickDirective()
{
    SGDirective.call(this);
    this.className = "RayPickDirective";
    this.attrType = eAttrType.RayPickDirective;
    
    this.name.setValueDirect("RayPickDirective");
    
    this.picked = [];
    
    this.viewport = new ViewportAttr();
    this.camera = new ReferenceAttr(null);
    this.clickPoint = new Vector2DAttr();
    
    this.registerAttribute(this.viewport, "viewport");
    this.registerAttribute(this.camera, "camera");
    this.registerAttribute(this.clickPoint, "clickPoint");
}

RayPickDirective.prototype.execute = function(root)
{
    root = root || this.rootNode.getValueDirect();
    
    // clear previous picks
    this.picked.length = 0;
    
    // pick
    var params = new RayPickParams();
    params.directive = this;
    params.camera = this.camera.getValueDirect();
    params.viewport.loadViewport(this.viewport.getValueDirect());
    params.clickPoint.copy(this.clickPoint.getValueDirect());

    root.apply("rayPick", params, true);
}

RayPickDirective.prototype.addPickRecord = function(record)
{
    // add to picked list according to distance
    for (var i=0; i < this.picked.length; i++)
    {
        if (this.picked[i].intersectRecord.distance > record.intersectRecord.distance)
        {
            break;
        }
    }
    this.picked.splice(i, 0, record);
}






BBoxParams.prototype = new DirectiveParams();
BBoxParams.prototype.constructor = BBoxParams();

function BBoxParams()
{
    DirectiveParams.call(this);

    this.viewSpace = false;
    this.viewMatrix = new Matrix4x4();
    this.worldMatrix = new Matrix4x4();
    this.minPoint = new Vector3D();
    this.maxPoint = new Vector3D();
    this.minMaxSet = false;
}

BBoxDirective.prototype = new SGDirective();
BBoxDirective.prototype.constructor = BBoxDirective;

function BBoxDirective()
{
    SGDirective.call(this);
    this.className = "BBoxDirective";
    this.attrType = eAttrType.BBoxDirective;

    this.min = new Vector3D();
    this.max = new Vector3D();
    
    this.name.setValueDirect("BBoxDirective");

    this.viewSpace = new BooleanAttr(false);
    this.viewTransform = new Matrix4x4Attr(1, 0, 0, 0,
                                           0, 1, 0, 0,
                                           0, 0, 1, 0,
                                           0, 0, 0, 1);

    this.registerAttribute(this.viewSpace, "viewSpace");
    this.registerAttribute(this.viewTransform, "viewTransform");
}

BBoxDirective.prototype.execute = function(root)
{
    root = root || this.rootNode.getValueDirect();

    // setup bbox params structure
    var params = new BBoxParams();
    params.viewSpace = this.viewSpace.getValueDirect();
    var viewMatrix = this.viewTransform.getValueDirect();
    params.viewMatrix.load(viewMatrix._11, viewMatrix._12, viewMatrix._13, viewMatrix._14,
                           viewMatrix._21, viewMatrix._22, viewMatrix._23, viewMatrix._24,
                           viewMatrix._31, viewMatrix._32, viewMatrix._33, viewMatrix._34,
                           viewMatrix._41, viewMatrix._42, viewMatrix._43, viewMatrix._44);

    // calculate bounding box
    root.apply("bbox", params, true);

    this.min = params.minPoint;
    this.max = params.maxPoint;
}

BBoxDirective.prototype.getBounds = function()
{
    return { min: this.min, max: this.max };
}

Geometry.prototype = new RenderableElement();
Geometry.prototype.constructor = Geometry;

function Geometry()
{
    RenderableElement.call(this);
    this.className = "Geometry";
    this.attrType = eAttrType.Geometry;

    this.boundingTree = new Octree();
    this.updateBoundingTree = false;

    this.selectable = new BooleanAttr(true);
    this.cullable = new BooleanAttr(true);
    this.show = new BooleanAttr(true);
    this.approximationLevels = new NumberAttr(1);
    this.sortPolygons = new BooleanAttr(false);
    this.flipPolygons = new BooleanAttr(false);
    this.shadowCaster = new BooleanAttr(false);
    this.shadowTarget = new BooleanAttr(true);
    this.highlight = new BooleanAttr(false);

    this.selectable.addModifiedCB(Geometry_SelectableModifiedCB, this);
    this.show.addModifiedCB(Geometry_ShowModifiedCB, this);
    this.approximationLevels.addModifiedCB(Geometry_ApproximationLevelsModifiedCB, this);

    this.registerAttribute(this.selectable, "selectable");
    this.registerAttribute(this.cullable, "cullable");
    this.registerAttribute(this.show, "show");
    this.registerAttribute(this.approximationLevels, "approximationLevels");
    this.registerAttribute(this.sortPolygons, "sortPolygons");
    this.registerAttribute(this.flipPolygons, "flipPolygons");
    this.registerAttribute(this.shadowCaster, "shadowCaster");
    this.registerAttribute(this.shadowTarget, "shadowTarget");
    this.registerAttribute(this.highlight, "highlight");
}

Geometry.prototype.update = function(params, visitChildren)
{
    if (this.updateBoundingTree)
    {
        this.updateBoundingTree = false;

        this.buildBoundingTree();
    }
    
    // call base-class implementation
    RenderableElement.prototype.update.call(this, params, visitChildren);
}

Geometry.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        RenderableElement.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    switch (directive)
    {
        case "render":
            {
                var drawNow = true;
                var dissolve = params.dissolve;
                var opacity = params.opacity;
                if (dissolve == 1)// || opacity == 0) // completely transparent objects can still reflect specularity
                {
                    // completely transparent, skip drawing
                    drawNow = false;
                }
                else if (dissolve > 0 ||
                         opacity < 1 ||
                         this.graphMgr.textureArrayStack.top().textures[eTextureType.Transparency].length > 0 ||
                         this.graphMgr.projectionTextureArrayStack.top().textures[eTextureType.Transparency].length > 0)
                {
                    // get bbox of geometry
                    var bounds = this.getBBox();

                    // add geometry to distance sort agent for sorted drawing
                    params.distanceSortAgent.addGeometry(this, bounds.min, bounds.max, dissolve);
                    drawNow = false;
                }

                if (drawNow)
                {
                    this.draw(dissolve);
                }
            }
            break;       

        case "rayPick":
            {
                if (this.selectable.getValueDirect() == true &&
                    params.opacity > 0 &&
                    params.dissolve < 1)
                {
                    var worldViewMatrix = params.worldMatrix.multiply(params.viewMatrix);
                    var scale = worldViewMatrix.getScalingFactors();

                    var intersectRecord = rayPick(this.boundingTree, params.rayOrigin, params.rayDir,
                                                  params.nearDistance, params.farDistance,
                                                  params.worldMatrix, params.viewMatrix,
                                                  max3(scale.x, scale.y, scale.z),
                                                  params.doubleSided, params.clipPlanes);
                    if (intersectRecord)
                    {
                        params.currentNodePath.push(this);
                        params.directive.addPickRecord(new RayPickRecord(params.currentNodePath, intersectRecord, params.camera));
                        params.currentNodePath.pop();
                    }
                }
            }
            break;

        case "bbox":
            {
                var bounds = this.getBBox();

                var matrix = new Matrix4x4();
                matrix.loadMatrix(params.worldMatrix);

                if (params.viewSpace)
                {
                    // user wants bbox in view space; multiply world matrix by view matrix
                    // to get worldView matrix
                    matrix.loadMatrix(matrix.multiply(params.viewMatrix));
                }

                var min = matrix.transform(bounds.min.x, bounds.min.y, bounds.min.z, 1);
                var max = matrix.transform(bounds.max.x, bounds.max.y, bounds.max.z, 1);

                if (params.minMaxSet)
                {
                    params.minPoint.x = Math.min(params.minPoint.x, Math.min(min.x, max.x));
                    params.minPoint.y = Math.min(params.minPoint.y, Math.min(min.y, max.y));
                    params.minPoint.z = Math.min(params.minPoint.z, Math.min(min.z, max.z));

                    params.maxPoint.x = Math.max(params.maxPoint.x, Math.max(min.x, max.x));
                    params.maxPoint.y = Math.max(params.maxPoint.y, Math.max(min.y, max.y));
                    params.maxPoint.z = Math.max(params.maxPoint.z, Math.max(min.z, max.z));
                }
                else // !params.minMaxSet
                {
                    params.minPoint.x = Math.min(min.x, max.x);
                    params.minPoint.y = Math.min(min.y, max.y);
                    params.minPoint.z = Math.min(min.z, max.z);

                    params.maxPoint.x = Math.max(min.x, max.x);
                    params.maxPoint.y = Math.max(min.y, max.y);
                    params.maxPoint.z = Math.max(min.z, max.z);

                    params.minMaxSet = true;
                }
            }
            break;
            
        case "highlight":
            {
                if (this.highlight.getValueDirect())
                {
                    if (params.targets.length > 0)
                    {
                        params.targets[params.targets.length-1].geometries.push(this);
                    }
                }
            }
            break;
    }

    // call base-class implementation
    RenderableElement.prototype.apply.call(this, directive, params, visitChildren);
}

Geometry.prototype.draw = function(dissolve)
{
}

Geometry.prototype.drawPrimitives = function()
{
}

Geometry.prototype.getBBox = function()
{
    return { min: this.bbox.min.getValueDirect(), max: this.bbox.max.getValueDirect() };
}

Geometry.prototype.getTriangles = function()
{
    return new Array();
}

function Geometry_SelectableModifiedCB(attribute, container)
{
}

function Geometry_ShowModifiedCB(attribute, container)
{
    container.setModified();
}

function Geometry_ApproximationLevelsModifiedCB(attribute, container)
{
    container.updateBoundingTree = true;
    container.setModified();
}
VertexGeometry.prototype = new Geometry();
VertexGeometry.prototype.constructor = VertexGeometry;

function VertexGeometry()
{
    Geometry.call(this);
    this.className = "VertexGeometry";
    this.attrType = eAttrType.VertexGeometry;

    this.updateVertices = false;
    this.updateColors = false;
    this.updateUVCoords = [];
    this.uvCoords = [];
    this.vertexBuffer = null;
    
    this.vertices = new NumberArrayAttr();
    this.colors = new NumberArrayAttr();
    
    this.vertices.addModifiedCB(VertexGeometry_VerticesModifiedCB, this);
    this.colors.addModifiedCB(VertexGeometry_ColorsModifiedCB, this);
    
    this.registerAttribute(this.vertices, "vertices");
    this.registerAttribute(this.colors, "colors");
}

VertexGeometry.prototype.clone = function()
{
    // call base-class implementation
    var clone = Geometry.prototype.clone.call(this);
    
    // set up uv coords
    for (var i = 0; i < this.uvCoords.length; i++)
    {
        clone.getUVCoords(this.uvCoords[i].first).copyValue(this.uvCoords[i].second);
    }
    
    return clone;
}

VertexGeometry.prototype.postCloneChild = function(childClone, pathSrc, pathClone)
{
    var i;
    var node;

    // setup uv-coords for cloned vertex geometry

    // find texture nodes affecting this node
    var textureNodes;
    for (i=0; i < pathSrc.length(); i++)
    {
        node = pathSrc.stack[i];
        if (node.getAttribute() == eAttrType.Texture)
        {
            if (!(textureNodes.push(node))) return;
        }
    }

    // find texture nodes affecting the clone
    var textureNodesClone;
    for (i=0; i < pathClone.length(); i++)
    {
        node = pathClone.stack[i];
        if (node.getAttribute() == eAttrType.Texture)
        {
            if (!(textureNodesClone.push(node))) return;
        }
    }

    // for each texture node, setup the uv-coords (textureNodes.size() and
    // textureNodesClone.size() should be the same, but check anyway)
   // CFloatArrayAttr* uvCoords = null;
    var uvCoords = new NumberArrayAttr();

    for (i=0; i < textureNodes.size() && i < textureNodesClone.size(); i++)
    {
        //uvCoords = FindUVCoords(dynamic_cast<GcTexture*>(textureNodes[i]));
        uvCoords = this.findUVCoords(textureNodes[i]);

        if (uvCoords)
        {
            var uvCoords2 = new NumberArrayAttr();
            uvCoords2 = childClone.getUVCoords(textureNodesClone[i]);
            uvCoords2.copyValue(uvCoords);
        }
    }

    // call base-class implementation
    //GcSGNode::Post_Clone_Child(childClone, pathSrc, pathClone); Not being used right now. Maybe used in the futrue.
}

VertexGeometry.prototype.getUVCoords = function(texture)
{
    for (var i=0; i < this.uvCoords.length; i++)
    {
        if (this.uvCoords[i].first == texture)
            return this.uvCoords[i].second;
    }       
    
    var uvCoords = new NumberArrayAttr();
    uvCoords.addModifiedCB(VertexGeometry_UVCoordsModifiedCB, this);
    this.uvCoords.push(new Pair(texture, uvCoords));
    
    return uvCoords;
}

VertexGeometry.prototype.findUVCoords = function(texture)
{
    if (!texture)
    {
        return null;
    }

    for (var i=0; i < this.uvCoords.length; i++)
    {
        if (this.uvCoords[i].first == texture)
            return this.uvCoords[i].second;
    }

    return null;
}

VertexGeometry.prototype.update = function(params, visitChildren)
{
    if (this.updateVertices)
    {
        this.updateVertices = false;
        
        var vertices = this.vertices.getValueDirect();
        this.vertexBuffer.setVertices(vertices);
        
        this.updateBoundingTree = true;
    }
    
    if (this.updateColors)
    {
        this.updateColors = false;
        
        this.vertexBuffer.setColors(this.colors.getValueDirect());    
    }
    
    if (this.updateUVCoords.length)
    {
        for (var i=0; i < this.updateUVCoords.length; i++)
        {
            for (var j=0; j < this.uvCoords.length; j++)
            {
                if (this.uvCoords[j].second == this.updateUVCoords[i])
                {
                    this.vertexBuffer.setUVCoords(this.uvCoords[j].first.textureObj, this.uvCoords[j].second.getValueDirect());
                    break;
                }
            }   
        }
        this.updateUVCoords.length = 0;
    }
    
    // call base-class implementation
    Geometry.prototype.update.call(this, params, visitChildren);
}

VertexGeometry.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        Geometry.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    
    switch (directive)
    {
        case "render":
            {
            }
            break;
            
        case "shadow":
            {
                var drawNow = true;
                var dissolve = params.dissolve;
                var opacity = params.opacity;
                if (dissolve == 1)// || opacity == 0) // completely transparent objects can still reflect specularity
                {
                    // completely transparent, skip drawing
                    drawNow = false;
                }

                if (drawNow)
                {
                    this.vertexBuffer.draw();
                }
            }
            break;
    }
    
    // call base-class implementation
    Geometry.prototype.apply.call(this, directive, params, visitChildren);
}

VertexGeometry.prototype.drawTextured = function(dissolve)
{
    var texture0 = null;
    var texture1 = null;

    // enable blending
    this.graphMgr.renderContext.enable(eRenderMode.AlphaBlend);

    // set blend factors
    this.graphMgr.renderContext.setBlendFactor(RC_SRC_ALPHA, RC_ONE_MINUS_SRC_ALPHA);

    // get number of texture stages
    var maxStages = this.graphMgr.renderContext.getMaxTextureStages();

    // get texture array
    var textureArray = this.graphMgr.textureArrayStack.top();

    // get current material node component levels
    var ambientLevel = 1;
    var diffuseLevel = 1;
    var specularLevel = 1;
    var emissiveLevel = 1;
    var material = this.graphMgr.getCurrentMaterial();
    if (material)
    {
        ambientLevel = material.getAttribute("ambientLevel").getValueDirect();
        diffuseLevel = material.getAttribute("diffuseLevel").getValueDirect();
        specularLevel = material.getAttribute("specularLevel").getValueDirect();
        emissiveLevel = material.getAttribute("emissiveLevel").getValueDirect();
    }

    // get current material
    var currMatDesc = this.graphMgr.renderContext.getFrontMaterial();

    // push current material
    this.graphMgr.renderState.push(RENDERSTATE_MATERIAL_BIT);

    // if non-zero dissolve, set to material
    if (dissolve > 0)
    {
        currMatDesc.ambient.a *= (1 - dissolve);
        currMatDesc.diffuse.a *= (1 - dissolve);
        currMatDesc.specular.a *= (1 - dissolve);
        currMatDesc.emissive.a *= (1 - dissolve);
        this.graphMgr.renderContext.setFrontMaterial(currMatDesc);
    }

    // if transparency texture, set to stage 0
    if (textureArray.textures[eTextureType.Transparency].length)
    {
        var texture = textureArray.textures[eTextureType.Transparency][0];
        var uvCoords = this.getUVCoords(texture);

        if (uvCoords && uvCoords.getLength() > 0)
        {
            // lock texture (keep it from being modified)
            //texture->Lock();

            this.setTextureStage(0, eTextureType.Transparency, texture, texture.transformCompound);
            texture0 = texture;
        }

        // disable stage 1
        if (maxStages > 1)
        {
            this.graphMgr.renderContext.enableTextureStage(1, 0);
            texture1 = null;
        }
    }

    // if color texture, set material for blending
    if (textureArray.textures[eTextureType.Color].length)
    {
        this.setBlendingMaterial(textureArray.textures[eTextureType.Color][0].getAttribute("opacity").getValueDirect(),
        ambientLevel, diffuseLevel, specularLevel, emissiveLevel);
    }

    // set texture blend factor
    this.graphMgr.renderContext.setTextureBlendFactor(currMatDesc.diffuse.a * (1 - dissolve));

    // draw untextured if no color texture is present, or if color texture's opacity < 1
    if (textureArray.textures[eTextureType.Color].length == 0 ||
        textureArray.textures[eTextureType.Color][0].getAttribute("opacity").getValueDirect() < 1)
    {
        this.vertexBuffer.draw();
    }

    if (texture0)
    {
        this.graphMgr.renderContext.enableTextureStage(0, 0);
        //texture0->Unlock();
        texture0 = null;
    }
    if (texture1)
    {
        this.graphMgr.renderContext.enableTextureStage(1, 0);
        //texture1->Unlock();
        texture1 = null;
    }
    
    // draw color texture(s)
    for (var i = 0; i < textureArray.textures[eTextureType.Color].length; i++)
    {
        var texture = textureArray.textures[eTextureType.Color][i];
        var uvCoords = this.getUVCoords(texture);

        if (uvCoords && uvCoords.getLength() > 0)
        {
            // lock texture (keep it from being modified)
            //texture->Lock();

            this.setTextureStage(0, eTextureType.Color, texture, texture.transformCompound);
            texture0 = texture;

            // set material for blending
            this.setBlendingMaterial(texture.getAttribute("opacity").getValueDirect(),
            ambientLevel, diffuseLevel, specularLevel, emissiveLevel);

            // set texture blend factor
            this.graphMgr.renderContext.setTextureBlendFactor(currMatDesc.diffuse.a * (1 - dissolve) * texture.getAttribute("opacity").getValueDirect());
        }

        // if transparency texture, and maxStages > 1, set to stage 1
        if (maxStages > 1)
        {
            if (textureArray.textures[eTextureType.Transparency].length)
            {
                texture = textureArray.textures[eTextureType.Transparency][0];
                uvCoords = this.getUVCoords(texture);

                if (uvCoords && uvCoords.getLength() > 0)
                {
                    // lock texture (keep it from being modified)
                    //texture->Lock();

                    this.setTextureStage(1, eTextureType.Transparency, texture, texture.transformCompound);
                    texture1 = texture;
                }
            }
        }

        // draw primitives
        this.vertexBuffer.draw();

        if (texture0)
        {
            this.graphMgr.renderContext.enableTextureStage(0, 0);
            //texture0->Unlock();
            texture0 = null;
        }
        if (texture1)
        {
            this.graphMgr.renderContext.enableTextureStage(1, 0);
            //texture1->Unlock();
            texture1 = null;
        }
    }

    // TODO
    /*
    // if object doesn't contain any specularity textures,
    // make an additional pass to add specular highlights;
    // skip this step if fog is enabled (causes ultra-white surface artifacts)
    var numSpecularityTextures = textureArray.textures[eTextureType.Specularity].length;
    // TODO: + m_graphMgr->GetProjectionTextureStack().top().textures[GeTextureType_Color].size();

    if (numSpecularityTextures == 0 &&
        specularLevel > 0) // TODO: && !renderEngine->IsRenderModeEnabled(Re_Fog)
    {
        this.setSpecularMaterial(currMatDesc.specular, currMatDesc.glossiness);
        this.graphMgr.renderContext.setBlendFactor(RC_ONE, RC_ONE);
        
        // if transparency texture, set to stage 0
        if (textureArray.textures[eTextureType.Transparency].length)
        {
            var texture = textureArray.textures[eTextureType.Transparency][0];
            var uvCoords = this.getUVCoords(texture);

            if (uvCoords && uvCoords.getLength() > 0)
            {
                // lock texture (keep it from being modified)
                //texture->Lock();

                this.setTextureStage(0, eTextureType.Transparency, texture, texture.transformCompound);
                texture0 = texture;
            }

            // disable stage 1
            if (maxStages > 1)
            {
                this.graphMgr.renderContext.enableTextureStage(1, 0);
                texture1 = null;
            }
        }
        
        // draw primitives
        this.vertexBuffer.draw();
        
        if (texture0)
        {
            this.graphMgr.renderContext.enableTextureStage(0, 0);
            //texture0->Unlock();
            texture0 = null;
        }
    }
    */
    // disable texture stage 0, 1
    this.graphMgr.renderContext.enableTextureStage(0, 0);
    this.graphMgr.renderContext.enableTextureStage(1, 0);
    
    // disable blending
    this.graphMgr.renderContext.disable(eRenderMode.AlphaBlend);

    // pop current material
    this.graphMgr.renderState.pop(RENDERSTATE_MATERIAL_BIT);
}

VertexGeometry.prototype.drawPrimitives = function()
{
    this.vertexBuffer.draw();
}

VertexGeometry.prototype.setTextureStage = function(stage, type, texture, textureTransform, 
                                                    textureCoordSrc, planeCoefficients)
{
    // get optional parameters
    textureTransform = textureTransform || new Matrix4x4();
    textureCoordSrc = textureCoordSrc || eTextureCoordSrc.VertexUVs;
    planeCoefficients = planeCoefficients ||  new Matrix4x4();   
    
    // enable texture stage
    this.graphMgr.renderContext.enableTextureStage(stage, 1);

    // get texture wrap
    var widthWrap = texture.getAttribute("widthWrap").getValueDirect();
    var heightWrap = texture.getAttribute("heightWrap").getValueDirect();
    var widthWrapType, heightWrapType;
    switch (widthWrap)
    {
        case eTextureWrap.Clamp:
            widthWrapType = RC_CLAMP_TO_EDGE;
            break;

        case eTextureWrap.Repeat:
        default:
            widthWrapType = RC_REPEAT;
            break;
    }
    switch (heightWrap)
    {
        case eTextureWrap.Clamp:
            heightWrapType = RC_CLAMP_TO_EDGE;
            break;

        case eTextureWrap.Repeat:
        default:
            heightWrapType = RC_REPEAT;
            break;
    }
    
    // set texture
    this.vertexBuffer.setTextureStage(stage, texture.textureObj, 
    widthWrapType, heightWrapType, textureCoordSrc, planeCoefficients);

    // set texture blend operation
    this.graphMgr.renderContext.setTextureBlendOp(texture.blendOp.getValueDirect());

    /* TODO
    // set texture matrix
    // TODO: only load texture transforms if they are enabled
    ReMatrixMode mode;
    switch (stage)
    {
    case 0: mode = ReMatrixMode_Texture0; break;
    case 1: mode = ReMatrixMode_Texture1; break;
    case 2: mode = ReMatrixMode_Texture2; break;
    case 3: mode = ReMatrixMode_Texture3; break;
    case 4: mode = ReMatrixMode_Texture4; break;
    case 5: mode = ReMatrixMode_Texture5; break;
    case 6: mode = ReMatrixMode_Texture6; break;
    case 7: mode = ReMatrixMode_Texture7; break;
    }
    this.graphMgr.renderContext.SetMatrixMode(mode);
    this.graphMgr.renderContext.LoadMatrix(textureTransform);
    
    this.graphMgr.renderContext.SetMatrixMode(ReMatrixMode_WorldView);
     */
}

VertexGeometry.prototype.setBlendingMaterial = function(opacity, ambientLevel, diffuseLevel, 
specularLevel, emissiveLevel)
{
    var matDesc = this.graphMgr.renderContext.getFrontMaterial();
    
    // setup material for texture blending operations
    var ambientBlend  = opacity * ambientLevel;
    var diffuseBlend  = opacity * diffuseLevel;
    var specularBlend = opacity * specularLevel;
    var emissiveBlend = opacity * emissiveLevel;

    // ambient
    matDesc.ambient.r = ambientBlend + matDesc.ambient.r * (1-opacity);
    matDesc.ambient.g = ambientBlend + matDesc.ambient.g * (1-opacity);
    matDesc.ambient.b = ambientBlend + matDesc.ambient.b * (1-opacity);
    //matDesc.ambient.a *= opacity;
    
    // diffuse
    matDesc.diffuse.r = diffuseBlend + matDesc.diffuse.r * (1-opacity);
    matDesc.diffuse.g = diffuseBlend + matDesc.diffuse.g * (1-opacity);
    matDesc.diffuse.b = diffuseBlend + matDesc.diffuse.b * (1-opacity);
    //matDesc.diffuse.a *= opacity;

    // specular (turn off)
    matDesc.specular.r = 0;//specularBlend + matDesc.specular.r * (1-opacity);
    matDesc.specular.g = 0;//specularBlend + matDesc.specular.g * (1-opacity);
    matDesc.specular.b = 0;//specularBlend + matDesc.specular.b * (1-opacity);
    //matDesc.specular.a *= opacity;
    matDesc.glossiness = 1;//matDesc.glossiness;

    // emissive
    matDesc.emissive.r = emissiveBlend + matDesc.emissive.r * (1-opacity);
    matDesc.emissive.g = emissiveBlend + matDesc.emissive.g * (1-opacity);
    matDesc.emissive.b = emissiveBlend + matDesc.emissive.b * (1-opacity);
    //matDesc.emissive.a *= opacity;
    
    matDesc.validMembersMask = MATERIALDESC_ALL_BITS;

    this.graphMgr.renderContext.setFrontMaterial(matDesc);
}

VertexGeometry.prototype.setSpecularMaterial = function(specular, glossiness)
{
    var matDesc = new MaterialDesc();
    matDesc.validMembersMask = MATERIALDESC_ALL_BITS;
    matDesc.specular = specular;
    matDesc.glossiness = glossiness;

    this.graphMgr.renderContext.setFrontMaterial(matDesc);
    this.graphMgr.renderContext.setBlendFactor(RC_ONE_MINUS_SRC_ALPHA, RC_ONE);
}

VertexGeometry.prototype.calculateBBox = function()
{
    var vertices = this.vertices.getValueDirect();
    if (vertices.length < 3) return;
    
    var min = new Vector3D(vertices[0], vertices[1], vertices[2]);
    var max = new Vector3D(vertices[0], vertices[1], vertices[2]);
    
    for (var i=3; i < vertices.length; i+=3)
    {
        min.x = Math.min(min.x, vertices[i  ]);
        min.y = Math.min(min.y, vertices[i+1]);
        min.z = Math.min(min.z, vertices[i+2]);

        max.x = Math.max(max.x, vertices[i  ]);
        max.y = Math.max(max.y, vertices[i+1]);
        max.z = Math.max(max.z, vertices[i+2]);
    }

    this.bbox.getAttribute("min").setValueDirect(min.x, min.y, min.z);
    this.bbox.getAttribute("max").setValueDirect(max.x, max.y, max.z);
}

function VertexGeometry_VerticesModifiedCB(attribute, container)
{
    container.updateVertices = true;
    container.calculateBBox();
    container.setModified();
}

function VertexGeometry_ColorsModifiedCB(attribute, container)
{
    container.updateColors = true;
    container.setModified();
}

function VertexGeometry_UVCoordsModifiedCB(attribute, container)
{
    container.updateUVCoords.push(attribute);
    container.setModified();
}
TriList.prototype = new VertexGeometry();
TriList.prototype.constructor = TriList;

function TriList()
{
    VertexGeometry.call(this);
    this.className = "TriList";
    this.attrType = eAttrType.TriList;
    
    this.primitiveType = RC_TRIANGLES;
    this.updateNormals = false;
    
    this.normals = new NumberArrayAttr();
    
    this.vertices.addModifiedCB(TriList_NormalsModifiedCB, this);
    this.normals.addModifiedCB(TriList_NormalsModifiedCB, this);
    
    this.registerAttribute(this.normals, "normals");
}

TriList.prototype.update = function(params, visitChildren)
{
    if (!this.vertexBuffer)
    {
        this.vertexBuffer = this.graphMgr.renderContext.createVertexBuffer(3);
        this.vertexBuffer.setPrimitiveType(this.primitiveType);
    }
       
    if (this.updateNormals)
    {
        this.updateNormals = false;
        
        this.vertexBuffer.setNormals(this.normals.getValueDirect());
    }
    
    // call base-class implementation
    VertexGeometry.prototype.update.call(this, params, visitChildren);
}

TriList.prototype.apply = function(directive, params, visitChildren)
{
    // call base-class impementation
    VertexGeometry.prototype.apply.call(this, directive, params, visitChildren);
}

TriList.prototype.draw = function(dissolve)
{
    // TODO
    
    // draw with textures
    this.drawTextured(dissolve);
}

TriList.prototype.buildBoundingTree = function()
{
    var min = this.bbox.getAttribute("min").getValueDirect();
    var max = this.bbox.getAttribute("max").getValueDirect();
    
    this.boundingTree.setTriangles(this.getTriangles(), min, max);
    this.boundingTree.buildTree(this.approximationLevels.getValueDirect());
}

TriList.prototype.getTriangles = function()
{
    var vertices = this.vertices.getValueDirect();
    
    var tris = [];
    for (var i=0, vertex=0; vertex+8 < vertices.length; i++, vertex+=9)
    {
        tris.push(new Triangle(vertices[vertex  ],  // v0
                               vertices[vertex+1],
                               vertices[vertex+2],
                               
                               vertices[vertex+3],  // v1
                               vertices[vertex+4],
                               vertices[vertex+5],
                               
                               vertices[vertex+6],  // v2
                               vertices[vertex+7],
                               vertices[vertex+8]));
    }
    
    return tris;
}

function TriList_NormalsModifiedCB(attribute, container)
{
    container.updateNormals = true;
    container.setModified();
}
Material.prototype = new SGNode();
Material.prototype.constructor = Material;

function Material()
{
    SGNode.call(this);
    this.className = "Material";
    this.attrType = eAttrType.Material;
    
    this.updateColor = false;
    this.updateAmbientLevel = false;
    this.updateDiffuseLevel = false;
    this.updateSpecularLevel = false;
    this.updateEmissiveLevel = false;
    this.updateAmbient = true;
    this.updateDiffuse = true;
    this.updateSpecular = true;
    this.updateEmissive = true;
    this.updateGlossiness = true;
    this.updateOpacity = true;
    this.lastOpacity = 0;
    this.lastDoubleSided = false;
    this.materialDesc = new MaterialDesc();
    this.materialDesc.validMembersMask = MATERIALDESC_ALL_BITS;
    
    this.color = new ColorAttr(1, 1, 1, 1);
    this.ambientLevel = new NumberAttr(1);
    this.diffuseLevel = new NumberAttr(1);
    this.specularLevel = new NumberAttr(1);
    this.emissiveLevel = new NumberAttr(0);
    this.ambient = new ColorAttr(0.2, 0.2, 0.2, 1);
    this.diffuse = new ColorAttr(0.8, 0.8, 0.8, 1);
    this.specular = new ColorAttr(0, 0, 0, 1);
    this.emissive = new ColorAttr(0, 0, 0, 1);
    this.glossiness = new NumberAttr(0);
    this.opacity = new NumberAttr(1);
    this.doubleSided = new BooleanAttr(false);
	
    this.color.addModifiedCB(Material_ColorModifiedCB, this);
    this.ambientLevel.addModifiedCB(Material_AmbientLevelModifiedCB, this);
    this.diffuseLevel.addModifiedCB(Material_DiffuseLevelModifiedCB, this);
    this.specularLevel.addModifiedCB(Material_SpecularLevelModifiedCB, this);
    this.emissiveLevel.addModifiedCB(Material_EmissiveLevelModifiedCB, this);
    this.ambient.addModifiedCB(Material_AmbientModifiedCB, this);
    this.diffuse.addModifiedCB(Material_DiffuseModifiedCB, this);
    this.specular.addModifiedCB(Material_SpecularModifiedCB, this);
    this.emissive.addModifiedCB(Material_EmissiveModifiedCB, this);
    this.glossiness.addModifiedCB(Material_GlossinessModifiedCB, this);
    this.opacity.addModifiedCB(Material_OpacityModifiedCB, this);
    this.doubleSided.addModifiedCB(Material_DoubleSidedModifiedCB, this);

    this.registerAttribute(this.color, "color");
    this.registerAttribute(this.ambientLevel, "ambientLevel");
    this.registerAttribute(this.diffuseLevel, "diffuseLevel");
    this.registerAttribute(this.specularLevel, "specularLevel");
    this.registerAttribute(this.emissiveLevel, "emissiveLevel");
    this.registerAttribute(this.ambient, "ambient");
    this.registerAttribute(this.diffuse, "diffuse");
    this.registerAttribute(this.specular, "specular");
    this.registerAttribute(this.emissive, "emissive");
    this.registerAttribute(this.glossiness, "glossiness");
    this.registerAttribute(this.opacity, "opacity");
    this.registerAttribute(this.doubleSided, "doubleSided");
}

Material.prototype.update = function(params, visitChildren)
{
    if (this.updateColor)
    {
        this.updateColor = false;

        this.updateAmbientLevel = true;
        this.updateDiffuseLevel = true;
        this.updateSpecularLevel = true;
        this.updateEmissiveLevel = true;
    }

    if (this.updateAmbientLevel || this.updateDiffuseLevel || this.updateSpecularLevel || this.updateEmissiveLevel)
    {
        var color = this.color.getValueDirect();

        if (this.updateAmbientLevel)
        {
            this.updateAmbientLevel = false;
            
            var level = this.ambientLevel.getValueDirect();
            this.ambient.setValueDirect(color.r * level, color.g * level, color.b * level, color.a);
        }

        if (this.updateDiffuseLevel)
        {
            this.updateDiffuseLevel = false;
            
            var level = this.diffuseLevel.getValueDirect();
            this.diffuse.setValueDirect(color.r * level, color.g * level, color.b * level, color.a);
        }

        if (this.updateSpecularLevel)
        {
            this.updateSpecularLevel = false;
            
            var level = this.specularLevel.getValueDirect();
            this.specular.setValueDirect(color.r * level, color.g * level, color.b * level, color.a);
        }

        if (this.updateEmissiveLevel)
        {
            this.updateEmissiveLevel = false;
            
            var level = this.emissiveLevel.getValueDirect();
            this.emissive.setValueDirect(color.r * level, color.g * level, color.b * level, color.a);
        }
    }

    var opacity = this.opacity.getValueDirect();

    var forceUpdate = false;

    if (this.updateOpacity)
    {
        this.updateOpacity = false;
        
        this.lastOpacity = opacity;

        // have to re-update all members
        forceUpdate = true;
    }

    if (this.updateAmbient || forceUpdate)
    {
        this.updateAmbient = false;
        
        this.materialDesc.ambient.copy(this.ambient.getValueDirect());
        this.materialDesc.ambient.a *= opacity;
    }

    if (this.updateDiffuse || forceUpdate)
    {
        this.updateDiffuse = false;
        
        this.materialDesc.diffuse.copy(this.diffuse.getValueDirect());
        this.materialDesc.diffuse.a *= opacity;
    }

    if (this.updateSpecular || forceUpdate)
    {
        this.updateSpecular = false;
        
        this.materialDesc.specular.copy(this.specular.getValueDirect());
        this.materialDesc.specular.a *= opacity;
    }

    if (this.updateEmissive || forceUpdate)
    {
        this.updateEmissive = false;
        
        this.materialDesc.emissive.copy(this.emissive.getValueDirect());
        this.materialDesc.emissive.a *= opacity;
    }

    if (this.updateGlossiness || forceUpdate)
    {
        this.updateGlossiness = false;
        
        this.materialDesc.glossiness = this.glossiness.getValueDirect();
    }
    
    // call base-class implementation
    SGNode.prototype.update.call(this, params, visitChildren);
}

Material.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        SGNode.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    
    this.graphMgr.setCurrentMaterial(this);
    
    switch (directive)
    {
        case "render":
        {
            params.opacity = this.lastOpacity; // set in update()
            
            this.applyMaterialDesc();
        }
        break;
        
        case "rayPick":
        {
            params.doubleSided = this.lastDoubleSided;
            params.opacity = this.lastOpacity;
        }
        break;
    }
    
    // call base-class implementation
    SGNode.prototype.apply.call(this, directive, params, visitChildren);
}

Material.prototype.applyMaterialDesc = function()
{
    // set material
    this.graphMgr.renderContext.setFrontMaterial(this.materialDesc);
    
    // enable/disable backface culling
    var doubleSided = this.doubleSided.getValueDirect();
    this.lastDoubleSided = doubleSided;
    if (doubleSided)
    {
        this.graphMgr.renderContext.disable(eRenderMode.CullBackFace);
    }
    else // !doubleSided
    {
        this.graphMgr.renderContext.enable(eRenderMode.CullBackFace);
    }
}

function Material_ColorModifiedCB(attribute, container)
{
    container.updateColor = true;
    container.setModified();
}

function Material_AmbientLevelModifiedCB(attribute, container)
{
    container.updateAmbientLevel = true;
    container.setModified();
}

function Material_DiffuseLevelModifiedCB(attribute, container)
{
    container.updateDiffuseLevel = true;
    container.setModified();
}

function Material_SpecularLevelModifiedCB(attribute, container)
{
    container.updateSpecularLevel = true;
    container.setModified();
}

function Material_EmissiveLevelModifiedCB(attribute, container)
{
    container.updateEmissiveLevel = true;
    container.setModified();
}

function Material_AmbientModifiedCB(attribute, container)
{
    container.updateAmbient = true;
    container.setModified();
}
    
function Material_DiffuseModifiedCB(attribute, container)
{
    container.updateDiffuse = true;
    container.setModified();
}
    
function Material_SpecularModifiedCB(attribute, container)
{
    container.updateSpecular = true;
    container.setModified();
}
    
function Material_EmissiveModifiedCB(attribute, container)
{
    container.updateEmissive = true;
    container.setModified();
}
    
function Material_GlossinessModifiedCB(attribute, container)
{
    container.updateGlosiness = true;
    container.setModified();
}
    
function Material_OpacityModifiedCB(attribute, container)
{
    container.updateOpacity = true;
    container.setModified();
}

function Material_DoubleSidedModifiedCB(attribute, container)
{
    container.setModified();
}
Surface.prototype = new Isolator();
Surface.prototype.constructor = Surface;

function Surface()
{
    Isolator.call(this);
    this.className = "Surface";
    this.attrType = eAttrType.Surface;
    
    this.geometries = [];
    
    this.color = new ColorAttr(1, 1, 1, 1);
    this.ambientLevel = new NumberAttr(1);
    this.diffuseLevel = new NumberAttr(1);
    this.specularLevel = new NumberAttr(1);
    this.emissiveLevel = new NumberAttr(0);
    this.ambient = new ColorAttr(0.8, 0.8, 0.8, 1);
    this.diffuse = new ColorAttr(0.2, 0.2, 0.2, 1);
    this.specular = new ColorAttr(0, 0, 0, 1);
    this.emissive = new ColorAttr(0, 0, 0, 1);
    this.glossiness = new NumberAttr(0);
    this.opacity = new NumberAttr(1);
    this.doubleSided = new BooleanAttr(false);
    this.texturesEnabled = new BooleanAttr(true);
    this.colorTexturesPresent = new BooleanAttr(true);
    this.diffuseTexturesPresent = new BooleanAttr(false);
    this.luminosityTexturesPresent = new BooleanAttr(false);
    this.specularityTexturesPresent = new BooleanAttr(false);
    this.transparencyTexturesPresent = new BooleanAttr(false);
    this.numColorTextures = new NumberAttr(0);
    this.numDiffuseTextures = new NumberAttr(0);
    this.numLuminosityTextures = new NumberAttr(0);
    this.numSpecularityTextures = new NumberAttr(0);
    this.numTransparencyTextures = new NumberAttr(0);
    this.vertices = new NumberArrayAttr();
    
    this.colorTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB, this);
    this.diffuseTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB, this);
    this.luminosityTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB, this);
    this.specularityTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB, this);
    this.transparencyTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB, this);

    this.registerAttribute(this.color, "color");
    this.registerAttribute(this.ambientLevel, "ambientLevel");
    this.registerAttribute(this.diffuseLevel, "diffuseLevel");
    this.registerAttribute(this.specularLevel, "specularLevel");
    this.registerAttribute(this.emissiveLevel, "emissiveLevel");
    this.registerAttribute(this.ambient, "ambient");
    this.registerAttribute(this.diffuse, "diffuse");
    this.registerAttribute(this.specular, "specular");
    this.registerAttribute(this.emissive, "emissive");
    this.registerAttribute(this.glossiness, "glossiness");
    this.registerAttribute(this.opacity, "opacity");
    this.registerAttribute(this.doubleSided, "doubleSided");
    this.registerAttribute(this.texturesEnabled, "texturesEnabled");
    this.registerAttribute(this.colorTexturesPresent, "colorTexturesPresent");
    this.registerAttribute(this.diffuseTexturesPresent, "diffuseTexturesPresent");
    this.registerAttribute(this.luminosityTexturesPresent, "luminosityTexturesPresent");
    this.registerAttribute(this.specularityTexturesPresent, "specularityTexturesPresent");
    this.registerAttribute(this.transparencyTexturesPresent, "transparencyTexturesPresent");
    this.registerAttribute(this.numColorTextures, "numColorTextures");
    this.registerAttribute(this.numDiffuseTextures, "numDiffuseTextures");
    this.registerAttribute(this.numLuminosityTextures, "numLuminosityTextures");
    this.registerAttribute(this.numSpecularityTextures, "numSpecularityTextures");
    this.registerAttribute(this.numTransparencyTextures, "numTransparencyTextures");
    this.registerAttribute(this.vertices, "vertices");

    this.isolateTextures.setValueDirect(true);

    this.materialNode = new Material();
    this.materialNode.getAttribute("name").setValueDirect("Material");
    this.materialNode.getAttribute("modified").addTarget(this.modified);
    this.addChild(this.materialNode);

    this.colorTexturesNode = new Group();
    this.colorTexturesNode.getAttribute("name").setValueDirect("Color Textures");
    this.colorTexturesNode.getAttribute("modified").addTarget(this.modified);
    this.addChild(this.colorTexturesNode);

    this.diffuseTexturesNode = new Group();
    this.diffuseTexturesNode.getAttribute("name").setValueDirect("Diffuse Textures");
    this.diffuseTexturesNode.getAttribute("modified").addTarget(this.modified);
    this.addChild(this.diffuseTexturesNode);

    this.luminosityTexturesNode = new Group();
    this.luminosityTexturesNode.getAttribute("name").setValueDirect("Luminosity Textures");
    this.luminosityTexturesNode.getAttribute("modified").addTarget(this.modified);
    this.addChild(this.luminosityTexturesNode);

    this.specularityTexturesNode = new Group();
    this.specularityTexturesNode.getAttribute("name").setValueDirect("Specularity Textures");
    this.specularityTexturesNode.getAttribute("modified").addTarget(this.modified);
    this.addChild(this.specularityTexturesNode);

    this.transparencyTexturesNode = new Group();
    this.transparencyTexturesNode.getAttribute("name").setValueDirect("Transparency Textures");
    this.transparencyTexturesNode.getAttribute("modified").addTarget(this.modified);
    this.addChild(this.transparencyTexturesNode);

    this.connectMaterialAttributes(this.materialNode);
}

Surface.prototype.clone = function()
{
    // call base-class implementation
    var clone = Isolator.prototype.clone.call(this);
    
    // set up texture references
    for (var i = 0; i < this.colorTexturesNode.children.length; i++)
    {
        clone.addTexture(this.colorTexturesNode.children[i]);
    }
    
    return clone;
}

Surface.prototype.setGraphMgr = function(graphMgr)
{
    this.materialNode.setGraphMgr(graphMgr);
    this.colorTexturesNode.setGraphMgr(graphMgr);
    this.diffuseTexturesNode.setGraphMgr(graphMgr);
    this.luminosityTexturesNode.setGraphMgr(graphMgr);
    this.specularityTexturesNode.setGraphMgr(graphMgr);
    this.transparencyTexturesNode.setGraphMgr(graphMgr);
    
    // call base-class implementation
    Isolator.prototype.setGraphMgr.call(this, graphMgr);
}

Surface.prototype.update = function(params, visitChildren)
{
    // call base-class implementation
    Isolator.prototype.update.call(this, params, visitChildren);
}

Surface.prototype.apply = function(directive, params, visitChildren)
{
    // call base-class implementation
    Isolator.prototype.apply.call(this, directive, params, visitChildren);
}

Surface.prototype.connectMaterialAttributes = function(material)
{
    this.connectMaterialAttribute(material, this.color, "color");
    this.connectMaterialAttribute(material, this.ambientLevel, "ambientLevel");
    this.connectMaterialAttribute(material, this.diffuseLevel, "diffuseLevel");
    this.connectMaterialAttribute(material, this.specularLevel, "specularLevel");
    this.connectMaterialAttribute(material, this.emissiveLevel, "emissiveLevel");
    this.connectMaterialAttribute(material, this.ambient, "ambient");
    this.connectMaterialAttribute(material, this.diffuse, "diffuse");
    this.connectMaterialAttribute(material, this.specular, "specular");
    this.connectMaterialAttribute(material, this.emissive, "emissive");
    this.connectMaterialAttribute(material, this.glossiness, "glossiness");
    this.connectMaterialAttribute(material, this.opacity, "opacity");
    this.connectMaterialAttribute(material, this.doubleSided, "doubleSided");
}

Surface.prototype.connectMaterialAttribute = function(material, attribute, name)
{
    var modified = attribute.modificationCount > 0 ? true : false;
    attribute.addTarget(material.getAttribute(name), eAttrSetOp.Replace, null, modified);
}

Surface.prototype.addGeometry = function(geometry)
{
    this.addChild(geometry);
    this.geometries.push(geometry);
}

Surface.prototype.removeGeometry = function(geometry)
{
    this.removeChild(geometry);
    for (var i = 0; i < this.geometries.length; i++)
    {
        if (this.geometries[i] == geometry)
        {
            this.geometries.splice(i, 1);
            break;
        }
    }
}
    
Surface.prototype.addTexture = function(texture)
{
    texture.getAttribute("modified").addTarget(this.modified);
    
    // TODO  
    this.colorTexturesNode.addChild(texture);
}

function Surface_TexturesPresentModifiedCB(attribute, container)
{
}
Model.prototype = new ParentableMotionElement();
Model.prototype.constructor = Model;

function Model()
{
    ParentableMotionElement.call(this);
    this.className = "Model";
    this.attrType = eAttrType.Model;
    
    this.surfaces = [];
    this.geometries = [];
    this.geometryIndices = [];
    this.geometryBBoxesMap = [];
    this.geometryAttrConnections = [];
    this.surfaceAttrConnections = [];
    this.boundingTree = new Octree();
    this.updateBoundingTree = false;
    this.bones = [];
    
    this.url = new StringAttr("");
    this.layer = new NumberAttr(0);//0xffffffff);
    this.selectable = new BooleanAttr(true);
    this.moveable = new BooleanAttr(true);
    this.cullable = new BooleanAttr(true);
    this.show = new BooleanAttr(true);
    this.approximationLevels = new NumberAttr(1);
    this.showApproximationLevel = new NumberAttr(-1);
    this.sortPolygons = new BooleanAttr(false);
    this.flipPolygons = new BooleanAttr(false);
    this.shadowCaster = new BooleanAttr(false);
    this.shadowTarget = new BooleanAttr(true);
    this.indexedGeometry = new BooleanAttr(true);
    this.enableSharing = new BooleanAttr(true);
    this.vertices = new NumberArrayAttr();
    this.dissolve = new NumberAttr(0);
    this.color = new ColorAttr(1, 1, 1, 1);
    this.ambientLevel = new NumberAttr(1);
    this.diffuseLevel = new NumberAttr(1);
    this.specularLevel = new NumberAttr(1);
    this.emissiveLevel = new NumberAttr(0);
    this.ambient = new ColorAttr(0.8, 0.8, 0.8, 1);
    this.diffuse = new ColorAttr(0.2, 0.2, 0.2, 1);
    this.specular = new ColorAttr(0, 0, 0, 1);
    this.emissive = new ColorAttr(0, 0, 0, 1);
    this.glossiness = new NumberAttr(0);
    this.opacity = new NumberAttr(1);
    this.textureOpacity = new NumberAttr(1);
    this.doubleSided = new BooleanAttr(false);
    this.texturesEnabled = new BooleanAttr(true);
    this.pivotAboutGeometricCenter = new BooleanAttr(true);
    this.screenScaleEnabled = new BooleanAttr(false);
    this.screenScalePixels = new Vector3DAttr(0, 0, 0);
    // TODO:
    //this.collider = new BooleanAttr(false);
    //this.collidee = new BooleanAttr(false);
    this.detectCollision = new BooleanAttr(false);
    this.collisionDetected = new BooleanAttr(false);
    this.collisionList = new AttributeVector();
    this.stopOnCollision = new BooleanAttr(false);
    this.detectObstruction = new BooleanAttr(false);
    this.obstructionDetected = new BooleanAttr(false);
    this.obstructionList = new AttributeVector(); // currently will only contain most threatening (closest) obstructor
    this.highlight = new BooleanAttr(false);
    this.highlightColor = new ColorAttr(1, 1, 0, 1);
    this.highlightWidth = new NumberAttr(5);
    this.disableOnDissolve = new BooleanAttr(true);
    this.snapEnabled = new BooleanAttr(true);
    this.genericConnectors = new GenericConnectors();
    this.socketConnectors = new SocketConnectors();
    this.plugConnectors = new PlugConnectors();
    this.physicalProperties = new PhysicalPropertiesAttr();
    this.physicsEnabled = new BooleanAttr(true);
    
    this.show.addTarget(this.enabled);
    
    this.selectable.addModifiedCB(Model_GeometryAttrModifiedCB, this);
    this.cullable.addModifiedCB(Model_GeometryAttrModifiedCB, this);
    this.show.addModifiedCB(Model_GeometryAttrModifiedCB, this);
    this.approximationLevels.addModifiedCB(Model_GeometryAttrModifiedCB, this);
    //this.showApproximationLevel.addModifiedCB(Model_ShowApproximationLevelModifiedCB, this);
    this.sortPolygons.addModifiedCB(Model_GeometryAttrModifiedCB, this);
    this.sortPolygons.addModifiedCB(Model_SortPolygonsModifiedCB, this);
    this.flipPolygons.addModifiedCB(Model_GeometryAttrModifiedCB, this);
    this.shadowCaster.addModifiedCB(Model_GeometryAttrModifiedCB, this);
    this.shadowTarget.addModifiedCB(Model_GeometryAttrModifiedCB, this);
    this.renderSequenceSlot.addModifiedCB(Model_GeometryAttrModifiedCB, this);
    this.renderSequenceSlot.addModifiedCB(Model_RenderSequenceSlotModifiedCB, this);
    this.dissolve.addModifiedCB(Model_DissolveModifiedCB, this);
    this.color.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.ambientLevel.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.diffuseLevel.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.specularLevel.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.emissiveLevel.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.ambient.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.diffuse.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.specular.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.emissive.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.glossiness.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.opacity.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.opacity.addModifiedCB(Model_OpacityModifiedCB, this);
    this.textureOpacity.addModifiedCB(Model_TextureOpacityModifiedCB, this);
    this.doubleSided.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.texturesEnabled.addModifiedCB(Model_SurfaceAttrModifiedCB, this);
    this.detectCollision.addModifiedCB(Model_DetectCollisionModifiedCB, this);
    this.collisionDetected.addModifiedCB(Model_CollisionDetectedModifiedCB, this);
    this.vertices.addModifiedCB(Model_VerticesModifiedCB, this);

    this.registerAttribute(this.url, "url");
    this.registerAttribute(this.layer, "layer");
    this.registerAttribute(this.selectable, "selectable");
    this.registerAttribute(this.moveable, "moveable");
    this.registerAttribute(this.cullable, "cullable");
    this.registerAttribute(this.show, "show");
    this.registerAttribute(this.approximationLevels, "approximationLevels");
    this.registerAttribute(this.showApproximationLevel, "showApproximationLevel");
    this.registerAttribute(this.sortPolygons, "sortPolygons");
    this.registerAttribute(this.flipPolygons, "flipPolygons");
    this.registerAttribute(this.shadowCaster, "shadowCaster");
    this.registerAttribute(this.shadowTarget, "shadowTarget");
    this.registerAttribute(this.indexedGeometry, "indexedGeometry");
    this.registerAttribute(this.enableSharing, "enableSharing");
    this.registerAttribute(this.vertices, "vertices");
    this.registerAttribute(this.dissolve, "dissolve");
    this.registerAttribute(this.color, "color");
    this.registerAttribute(this.ambientLevel, "ambientLevel");
    this.registerAttribute(this.diffuseLevel, "diffuseLevel");
    this.registerAttribute(this.specularLevel, "specularLevel");
    this.registerAttribute(this.emissiveLevel, "emissiveLevel");
    this.registerAttribute(this.ambient, "ambient");
    this.registerAttribute(this.diffuse, "diffuse");
    this.registerAttribute(this.specular, "specular");
    this.registerAttribute(this.emissive, "emissive");
    this.registerAttribute(this.glossiness, "glossiness");
    this.registerAttribute(this.opacity, "opacity");
    this.registerAttribute(this.textureOpacity, "textureOpacity");
    this.registerAttribute(this.doubleSided, "doubleSided");
    this.registerAttribute(this.texturesEnabled, "texturesEnabled");
    this.registerAttribute(this.pivotAboutGeometricCenter, "pivotAboutGeometricCenter");
    this.registerAttribute(this.screenScaleEnabled, "screenScaleEnabled");
    this.registerAttribute(this.screenScalePixels, "screenScalePixels");
    this.registerAttribute(this.detectCollision, "detectCollision");
    this.registerAttribute(this.collisionDetected, "collisionDetected");
    this.registerAttribute(this.collisionList, "collisionList");
    this.registerAttribute(this.stopOnCollision, "stopOnCollision");
    this.registerAttribute(this.detectObstruction, "detectObstruction");
    this.registerAttribute(this.obstructionDetected, "obstructionDetected");
    this.registerAttribute(this.obstructionList, "obstructionList");
    this.registerAttribute(this.highlight, "highlight");
    this.registerAttribute(this.highlightColor, "highlightColor");
    this.registerAttribute(this.highlightWidth, "highlightWidth");
    this.registerAttribute(this.disableOnDissolve, "disableOnDissolve");
    this.registerAttribute(this.snapEnabled, "snapEnabled");
    this.registerAttribute(this.genericConnectors, "genericConnectors");
    this.registerAttribute(this.socketConnectors, "socketConnectors");
    this.registerAttribute(this.plugConnectors, "plugConnectors");
    this.registerAttribute(this.physicalProperties, "physicalProperties");
    this.registerAttribute(this.physicsEnabled, "physicsEnabled");
        
    this.isolatorNode = new Isolator();
    this.isolatorNode.getAttribute("name").setValueDirect("Isolator");
    this.isolatorNode.getAttribute("isolateDissolves").setValueDirect(true);
    //this.isolatorNode.setCreatedByParent(true);
    this.addChild(this.isolatorNode);

    this.dissolveNode = new Dissolve();
    this.dissolveNode.getAttribute("name").setValueDirect("Dissolve");
    this.addChild(this.dissolveNode);
    this.dissolve.addTarget(this.dissolveNode.getAttribute("dissolve"));
    //this.dissolve.setCreatedByParent(true);

    this.surfacesNode = new Group();
    this.surfacesNode.getAttribute("name").setValueDirect("Surfaces");
    this.addChild(this.surfacesNode);
    //this.surfacesNode.setCreatedByParent(true);
}

Model.prototype.synchronize = function(src, syncValues)
{
    // call base-class implementation
    ParentableMotionElement.prototype.synchronize.call(this, src, syncValues);
    
    // sectorPosition is overwriting position
    this.position.copyValue(src.getAttribute("position"));
}

Model.prototype.copyModel = function(clone,cloneChildren,pathSrc,pathClone)
{
    var clonedByThis = false;
    if(!clone)
    {
        if (!(clone = new Model()))
        {
            return -1;
        }

        clonedByThis = true;
    }

    // call base-class implementation
    if (this.copyNode(clone, cloneChildren, pathSrc, pathClone))
    {
        return -1;
    }
}

Model.prototype.initializeSurfaceAttrConnectionsMap = function()
{
    this.surfaceAttrConnections.push(new Pair(this.color, false));
    this.surfaceAttrConnections.push(new Pair(this.ambientLevel, false));
    this.surfaceAttrConnections.push(new Pair(this.diffuseLevel, false));
    this.surfaceAttrConnections.push(new Pair(this.specularLevel, false));
    this.surfaceAttrConnections.push(new Pair(this.emissiveLevel, false));
    this.surfaceAttrConnections.push(new Pair(this.ambient, false));
    this.surfaceAttrConnections.push(new Pair(this.diffuse, false));
    this.surfaceAttrConnections.push(new Pair(this.specular, false));
    this.surfaceAttrConnections.push(new Pair(this.emissive, false));
    this.surfaceAttrConnections.push(new Pair(this.glossiness, false));
    this.surfaceAttrConnections.push(new Pair(this.opacity, false));
    this.surfaceAttrConnections.push(new Pair(this.doubleSided, false));
    this.surfaceAttrConnections.push(new Pair(this.texturesEnabled, false));
    this.surfaceAttrConnections.push(new Pair(this.renderSequenceSlot, false));
}

Model.prototype.initializeGeometryAttrConnectionsMap = function()
{
    this.geometryAttrConnections.push(new Pair(this.selectable, false));
    this.geometryAttrConnections.push(new Pair(this.cullable, false));
    this.geometryAttrConnections.push(new Pair(this.show, false));
    this.geometryAttrConnections.push(new Pair(this.approximationLevels, false));
    this.geometryAttrConnections.push(new Pair(this.showApproximationLevel, false));
    this.geometryAttrConnections.push(new Pair(this.sortPolygons, false));
    this.geometryAttrConnections.push(new Pair(this.flipPolygons, false));
    this.geometryAttrConnections.push(new Pair(this.intersector, false));
    this.geometryAttrConnections.push(new Pair(this.intersectee, false));
    this.geometryAttrConnections.push(new Pair(this.stationary, false));
    this.geometryAttrConnections.push(new Pair(this.shadowCaster, false));
    this.geometryAttrConnections.push(new Pair(this.shadowTarget, false));
}

Model.prototype.clearSurfaceAttrConnectionMap = function()
{
    this.surfaceAttrConnections = [];

    this.initializeSurfaceAttrConnectionsMap();
}

Model.prototype.clearGeometryAttrConnectionsMap = function()
{
    this.geometryAttrConnections = [];

    this.initializeGeometryAttrConnectionsMap();
}

Model.prototype.setGraphMgr = function(graphMgr)
{
    this.isolatorNode.setGraphMgr(graphMgr);
    this.dissolveNode.setGraphMgr(graphMgr);
    this.surfacesNode.setGraphMgr(graphMgr);
    
    // call base-class implementation
    ParentableMotionElement.prototype.setGraphMgr.call(this, graphMgr);
}

Model.prototype.update = function(params, visitChildren)
{
    if (this.updateBoundingTree)
    {
        this.updateBoundingTree = false;

        this.buildBoundingTree();
    }
    
    // call base-class implementation
    ParentableMotionElement.prototype.update.call(this, params, visitChildren);
}

Model.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    switch (directive)
    {
        case "render":
        case "shadow":
            {
                var show = this.show.getValueDirect();
                if (!show)
                {
                    // call base-class implementation
                    ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
                    return;
                }

                var lastWorldMatrix = new Matrix4x4();
                lastWorldMatrix.loadMatrix(params.worldMatrix);              

                params.worldMatrix = params.worldMatrix.multiply(this.sectorTransformCompound);
                
                this.pushMatrix();

                this.applyTransform();

                this.graphMgr.renderContext.setModelID(params.modelID++);
                
                // call base-class implementation
                ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
                
                this.popMatrix();
                
                params.worldMatrix.loadMatrix(lastWorldMatrix);
            }
            break;

        case "rayPick":
            {
                var lastWorldMatrix = new Matrix4x4();
                lastWorldMatrix.loadMatrix(params.worldMatrix);
                params.worldMatrix = params.worldMatrix.multiply(this.sectorTransformCompound);

                // call base-class implementation
                ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);

                params.worldMatrix.loadMatrix(lastWorldMatrix);
            }
            break;

        case "bbox":
            {
                var lastWorldMatrix = new Matrix4x4();
                lastWorldMatrix.loadMatrix(params.worldMatrix);
                params.worldMatrix.loadMatrix(this.sectorTransformCompound.multiply(params.worldMatrix));

                // call base-class implementation
                ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);

                params.worldMatrix.loadMatrix(lastWorldMatrix);
            }
            break;

        case "collide":
            {
                var lastWorldMatrix = new Matrix4x4();
                lastWorldMatrix.loadMatrix(params.worldMatrix);              

                params.worldMatrix = params.worldMatrix.multiply(this.sectorTransformCompound);
  
                // call base-class implementation
                ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
                
                if (this.detectCollision.getValueDirect()) 
                {
                    this.boundingTree.setTransform(params.worldMatrix);
                    params.detectCollisions[this.name.getValueDirect().join("")] = new CollideRec(this, this.boundingTree, params.worldMatrix);
                }

                params.worldMatrix.loadMatrix(lastWorldMatrix);
            }
            break;
           
        case "highlight":
            {
                if (this.highlight.getValueDirect())
                {
                    var target = new HighlightTarget();
                    target.projMatrix = params.projMatrix;
                    target.viewMatrix = params.viewMatrix;
                    target.worldMatrix = this.sectorTransformCompound.multiply(params.worldMatrix);
                    target.camera = params.camera;
                    target.viewport = params.viewport;
                    target.center = this.center.getValueDirect();
                    var highlightColor = this.highlightColor.getValueDirect();
                    target.highlightColor_r = highlightColor.r;
                    target.highlightColor_g = highlightColor.g;
                    target.highlightColor_b = highlightColor.b;
                    target.highlightColor_a = highlightColor.a;
                    target.highlightWidth = this.highlightWidth.getValueDirect();
                    params.targets.push(target);

                    // call base-class implementation
                    ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
                }
            }
            break;  
         
        default:
            {
                // call base-class implementation
                ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
            }
            break;
    }
}

Model.prototype.onUnregister = function()
{
    var name = this.name.getValueDirect().join("");
    
    // remove from any physics simulators
    var physicsSimulators = this.registry.getByType(eAttrType.PhysicsSimulator);
    if (physicsSimulators)
    {
        for (var i = 0; i < physicsSimulators.length; i++)
        {
            physicsSimulators[i].bodies.erase(this.name);
        }
    }
}

Model.prototype.pushMatrix = function()
{
    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
    this.graphMgr.renderContext.pushMatrix();
}

Model.prototype.popMatrix = function()
{
    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
    this.graphMgr.renderContext.popMatrix();
    this.graphMgr.renderContext.applyWorldTransform();    
}

Model.prototype.addSurface = function(surface)
{
    this.surfacesNode.addChild(surface);
    
    this.surfaces.push(surface);
    
    // register surface to this for accessiblity with Set
    this.registerAttribute(surface, surface.getAttribute("name").getValueDirect().join(""));
	
    this.connectSurfaceAttributes(surface);
}

Model.prototype.removeSurface = function(surface)
{
    this.surfacesNode.removeChild(surface);
    
    for (var i = 0; i < this.surfaces.length; i++)
    {
        if (this.surfaces[i] == surface)
        {
            this.surfaces.splice(i, 1);
            break;
        }
    }
    
    // unregister surface from this
    this.unregisterAttribute(surface);
	
    this.disconnectSurfaceAttributes(surface);
}
    
Model.prototype.addGeometry = function(geometry, indices, surface)
{
    if (surface) surface.addGeometry(geometry);
    
    this.connectGeometryAttributes(geometry);
    this.geometries.push(geometry);
    if (indices) this.geometryIndices.push(indices);
    geometry.bbox.addModifiedCB(Model_GeometryBBoxModifiedCB, this);
        
    this.updateBBox();
}

Model.prototype.removeGeometry = function(geometry, indices, surface)
{
    if (surface) surface.removeGeometry(geometry);
    
    this.disconnectGeometryAttributes(geometry);
    for (var i = 0; i < this.geometries.length; i++)
    {
        if (this.geometries[i] == geometry)
        {
            this.geometries.splice(i, 1);
            break;
        }
    }  
    if (indices) 
    {
        for (var i = 0; i < this.geometryIndices.length; i++)
        {
            if (this.geometryIndices[i] == indices)
            {
                this.geometryIndices.splice(i, 1);
                break;
            }
        }
    }
    geometry.bbox.removeModifiedCB(Model_GeometryBBoxModifiedCB, this);
        
    this.updateBBox();
}

Model.prototype.connectSurfaceAttributes = function(surface)
{
    this.connectSurfaceAttribute(surface, this.color, "color");
    this.connectSurfaceAttribute(surface, this.ambientLevel, "ambientLevel");
    this.connectSurfaceAttribute(surface, this.diffuseLevel, "diffuseLevel");
    this.connectSurfaceAttribute(surface, this.specularLevel, "specularLevel");
    this.connectSurfaceAttribute(surface, this.emissiveLevel, "emissiveLevel");
    this.connectSurfaceAttribute(surface, this.ambient, "ambient");
    this.connectSurfaceAttribute(surface, this.diffuse, "diffuse");
    this.connectSurfaceAttribute(surface, this.specular, "specular");
    this.connectSurfaceAttribute(surface, this.emissive, "emissive");
    this.connectSurfaceAttribute(surface, this.glossiness, "glossiness");
    this.connectSurfaceAttribute(surface, this.opacity, "opacity");
    this.connectSurfaceAttribute(surface, this.doubleSided, "doubleSided");
    this.connectSurfaceAttribute(surface, this.texturesEnabled, "texturesEnabled");
    this.connectSurfaceAttribute(surface, this.enabled, "enabled");
}

Model.prototype.connectSurfaceAttribute = function(surface, attribute, name)
{
    var modified = attribute.modificationCount > 0 ? true : false;
    attribute.addTarget(surface.getAttribute(name), eAttrSetOp.Replace, null, modified);
}

Model.prototype.disconnectSurfaceAttributes = function(surface)
{
    this.disconnectSurfaceAttribute(surface, this.color, "color");
    this.disconnectSurfaceAttribute(surface, this.ambientLevel, "ambientLevel");
    this.disconnectSurfaceAttribute(surface, this.diffuseLevel, "diffuseLevel");
    this.disconnectSurfaceAttribute(surface, this.specularLevel, "specularLevel");
    this.disconnectSurfaceAttribute(surface, this.emissiveLevel, "emissiveLevel");
    this.disconnectSurfaceAttribute(surface, this.ambient, "ambient");
    this.disconnectSurfaceAttribute(surface, this.diffuse, "diffuse");
    this.disconnectSurfaceAttribute(surface, this.specular, "specular");
    this.disconnectSurfaceAttribute(surface, this.emissive, "emissive");
    this.disconnectSurfaceAttribute(surface, this.glossiness, "glossiness");
    this.disconnectSurfaceAttribute(surface, this.opacity, "opacity");
    this.disconnectSurfaceAttribute(surface, this.doubleSided, "doubleSided");
    this.disconnectSurfaceAttribute(surface, this.texturesEnabled, "texturesEnabled");
    this.disconnectSurfaceAttribute(surface, this.enabled, "enabled");
}

Model.prototype.disconnectSurfaceAttribute = function(surface, attribute, name)
{
    attribute.removeTarget(surface.getAttribute(name));
}

Model.prototype.connectGeometryAttributes = function(geometry)
{
    this.connectGeometryAttribute(geometry, this.name, "name");
    this.connectGeometryAttribute(geometry, this.selectable, "selectable");
    this.connectGeometryAttribute(geometry, this.cullable, "cullable");
    this.connectGeometryAttribute(geometry, this.show, "show");
    this.connectGeometryAttribute(geometry, this.approximationLevels, "approximationLevels");
    this.connectGeometryAttribute(geometry, this.sortPolygons, "sortPolygons");
    this.connectGeometryAttribute(geometry, this.flipPolygons, "flipPolygons");
    this.connectGeometryAttribute(geometry, this.shadowCaster, "shadowCaster");
    this.connectGeometryAttribute(geometry, this.shadowTarget, "shadowTarget");
    this.connectGeometryAttribute(geometry, this.renderSequenceSlot, "renderSequenceSlot");
    this.connectGeometryAttribute(geometry, this.highlight, "highlight");
}

Model.prototype.connectGeometryAttribute = function(geometry, attribute, name)
{
    var modified = attribute.modificationCount > 0 ? true : false;
    attribute.addTarget(geometry.getAttribute(name), eAttrSetOp.Replace, null, modified);
}

Model.prototype.disconnectGeometryAttributes = function(geometry)
{
    this.disconnectGeometryAttribute(geometry, this.name, "name");
    this.disconnectGeometryAttribute(geometry, this.selectable, "selectable");
    this.disconnectGeometryAttribute(geometry, this.cullable, "cullable");
    this.disconnectGeometryAttribute(geometry, this.show, "show");
    this.disconnectGeometryAttribute(geometry, this.approximationLevels, "approximationLevels");
    this.disconnectGeometryAttribute(geometry, this.sortPolygons, "sortPolygons");
    this.disconnectGeometryAttribute(geometry, this.flipPolygons, "flipPolygons");
    this.disconnectGeometryAttribute(geometry, this.shadowCaster, "shadowCaster");
    this.disconnectGeometryAttribute(geometry, this.shadowTarget, "shadowTarget");
    this.disconnectGeometryAttribute(geometry, this.renderSequenceSlot, "renderSequenceSlot");
    this.disconnectGeometryAttribute(geometry, this.highlight, "highlight");
}

Model.prototype.disconnectGeometryAttribute = function(geometry, attribute, name)
{
    attribute.removeTarget(geometry.getAttribute(name));
}

Model.prototype.updateBBox = function()
{
    var min = new Vector3D(FLT_MAX, FLT_MAX, FLT_MAX);
    var max = new Vector3D(-FLT_MAX, -FLT_MAX, -FLT_MAX);
    
    for (var i = 0; i < this.geometries.length; i++)
    {
        var geometryMin = this.geometries[i].bbox.min.getValueDirect();
        var geometryMax = this.geometries[i].bbox.max.getValueDirect();
        
        min.x = Math.min(min.x, geometryMin.x);
        min.y = Math.min(min.y, geometryMin.y);
        min.z = Math.min(min.z, geometryMin.z);
        
        max.x = Math.max(max.x, geometryMax.x);
        max.y = Math.max(max.y, geometryMax.y);
        max.z = Math.max(max.z, geometryMax.z);
    }
    
    this.bbox.min.setValueDirect(min.x, min.y, min.z);
    this.bbox.max.setValueDirect(max.x, max.y, max.z);
    
    var center = new Vector3D((min.x + max.x) / 2.0,
                              (min.y + max.y) / 2.0,
                              (min.z + max.z) / 2.0);
                              
    this.center.setValueDirect(center.x, center.y, center.z);
    
    this.updateBoundingTree = true;
}

Model.prototype.buildBoundingTree = function()
{
    var tris = [];
    for (var i = 0; i < this.geometries.length; i++)
    {
        tris = tris.concat(this.geometries[i].getTriangles());
    }
    
    this.boundingTree = new Octree();
    this.boundingTree.setTriangles(tris, this.bbox.min.getValueDirect(), this.bbox.max.getValueDirect());
    this.boundingTree.buildTree(this.approximationLevels.getValueDirect());
}

Model.prototype.collisionDetectedModified = function()
{
}

function Model_SortPolygonsModifiedCB(attribute, container)
{
    // TODO
    //container.sortPolygonsModified();
}
    
function Model_RenderSequenceSlotModifiedCB(attribute, container)
{
    var slot = attribute.getValueDirect();
}

function Model_DissolveModifiedCB(attribute, container)
{
    var dissolve = attribute.getValueDirect();
}

function Model_OpacityModifiedCB(attribute, container)
{
    var opacity = attribute.getValueDirect();
}

function Model_TextureOpacityModifiedCB(attribute, container)
{
    //container.textureOpacityModified();
}

function Model_Surface_NumTransparencyTexturesModifiedCB(attribute, container)
{
    var numTransparencyTextures = attribute.getValueDirect();
}

function Model_GeometryBBoxModifiedCB(attribute, container)
{
    container.updateBBox();
}

function Model_SurfaceAttrModifiedCB(attribute, container)
{
    //container.setModified();
}

function Model_GeometryAttrModifiedCB(attribute, container)
{
    //container.incremementModificationCount();
}

function Model_DetectCollisionModifiedCB(attribute, container)
{
    var detectCollision = attribute.getValueDirect();
}

function Model_CollisionDetectedModifiedCB(attribute, container)
{
    container.collisionDetectedModified();
}

function Model_VerticesModifiedCB(attribute, container)
{
}

Texture.prototype = new ParentableMotionElement();
Texture.prototype.constructor = Texture;

function Texture()
{
    ParentableMotionElement.call(this);
    this.className = "Texture";
    this.attrType = eAttrType.Texture;
   
    this.updateImage = false;
    this.updateMipmappingEnabled = false;
    this.setImage = false;
    this.imageSet = false;
    this.textureObj = null;
    this.pitch = 0;
    
    this.image = new ImageAttr(); 
    this.opacity = new NumberAttr(1);
    this.textureType = new NumberAttr(eTextureType.Color);
    this.widthWrap = new NumberAttr(eTextureWrap.None);
    this.heightWrap = new NumberAttr(eTextureWrap.None);
    this.mipmappingEnabled = new BooleanAttr(false);
    this.blendOp = new NumberAttr(RC_MODULATE);
    
    this.image.setTransient(true); // don't serialize image data
    
    this.image.getAttribute("width").addModifiedCB(Texture_ImageModifiedCB, this);
    this.image.getAttribute("height").addModifiedCB(Texture_ImageModifiedCB, this);
    this.image.getAttribute("byteAlignment").addModifiedCB(Texture_ImageModifiedCB, this);
    this.image.getAttribute("pixelFormat").addModifiedCB(Texture_ImageModifiedCB, this);
    this.image.getAttribute("pixels").addModifiedCB(Texture_ImagePixelsModifiedCB, this);
    this.textureType.addModifiedCB(Texture_TextureTypeModifiedCB, this);
    this.opacity.addModifiedCB(Texture_OpacityModifiedCB, this);
    this.widthWrap.addModifiedCB(Texture_WrapModifiedCB, this);
    this.heightWrap.addModifiedCB(Texture_WrapModifiedCB, this);
    this.mipmappingEnabled.addModifiedCB(Texture_MipmappingEnabledModifiedCB, this);

    this.registerAttribute(this.image, "image");
    this.registerAttribute(this.opacity, "opacity");
    this.registerAttribute(this.textureType, "textureType");
    this.registerAttribute(this.widthWrap, "widthWrap");
    this.registerAttribute(this.heightWrap, "heightWrap");
    this.registerAttribute(this.mipmappingEnabled, "mipmappingEnabled");
    this.registerAttribute(this.blendOp, "blendOp");
}

Texture.prototype.setGraphMgr = function(graphMgr)
{
    // create texture object
    this.textureObj = graphMgr.renderContext.createTextureObject();
    
    // call base-class implementation
    ParentableMotionElement.prototype.setGraphMgr.call(this, graphMgr);
}

Texture.prototype.update = function(params, visitChildren)
{
    if (this.updateImage)
    {
        this.updateImage = false;

        this.setImage = true;
    }

    if (this.updateMipmappingEnabled)
    {
        // only reset image to use/not use mipmaps if image has been specified
        if (this.imageSet)
        {
            this.setImage = true;
            this.updateMipmappingEnabled = false;
        }
    }

    if (this.setImage)
    {
        this.setImage = !(this.SetImage());
    }

    // only call direct-base class implementation if position, rotation, or scale has been modified
    // (avoids unnecessary calculations for textures)
    if (this.updatePosition || this.updateRotation || this.updateScale)
    {
        ParentableMotionElement.prototype.update.call(this, params, visitChildren);
    }
    else
    {
        SGNode.prototype.update.call(this, params, visitChildren);
    }
}

Texture.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    switch (directive)
    {
        case "render":
            {
                // if texture is ready, add to texture array
                if (this.imageSet)
                {
                    var drawTextures = params.drawTextures && this.graphMgr.getDrawTextures();
                    if (drawTextures)
                    {
                        // TODO: if current projector object, add texture to projection texture array
                        var textures = this.graphMgr.textureArrayStack.top().textures;
                        var i = this.textureType.getValueDirect();
                        // Added this error handling when several scenes
                        // where textures[i] is undefined but have no
                        // idea why textures[i] is undefined - KMC
                        if (textures[i])
                        {
                            textures[i].push(this);
                        }
                    }
                }
                
            }
            break;
    }

    // call base-class implementation
    ParentableMotionElement.prototype.apply.call(this, directive, params, visitChildren);
}

Texture.prototype.SetImage = function()
{
    var width = this.image.width.getValueDirect();
    var height = this.image.height.getValueDirect();
    var pixelFormat = this.image.pixelFormat.getValueDirect();
    var pixels = this.image.pixels.getValueDirect();

    if (width == 0 ||
        height == 0 ||
        pixelFormat == ePixelFormat.Unknown ||
        pixels == null)
    {
        return false;
    }
    
    var imageFormat;
    switch (this.textureType.getValueDirect())
    {
        case eTextureType.Diffuse:
        case eTextureType.Luminosity:
        case eTextureType.Specularity:
        case eTextureType.Transparency:
            imageFormat = eImageFormat.Alpha;
            break;

        case eTextureType.Color:
        default:
            imageFormat = eImageFormat.RGBA;
            break;
    }

    this.textureObj.setImageData(width, height, pixelFormat, imageFormat, pixels);

    this.imageSet = true;
    
    return true;
}

function Texture_ImageModifiedCB(attribute, container)
{
    container.updateImage = true;
    container.setModified();
}

function Texture_ImagePixelsModifiedCB(attribute, container)
{
    container.updateImage = true;
    container.setModified();
}

function Texture_OpacityModifiedCB(attribute, container)
{
    container.setModified();
}

function Texture_TextureTypeModifiedCB(attribute, container)
{
    // update blendOp based upon type
    switch (attribute.getValueDirect())
    {
        case eTextureType.Color:
            op = RC_MODULATE;
            break;

        case eTextureType.Diffuse:
        case eTextureType.Luminosity:
        case eTextureType.Specularity:
            op = RC_REPLACE;
            break;

        case eTextureType.Transparency:
            op = RC_MODULATE;//BLEND;
            break;

        default:
            return;
    }
    
    container.blendOp.setValueDirect(op);
    container.setModified();
}

function Texture_WrapModifiedCB(attribute, container)
{
    container.setModified();
}

function Texture_MipmappingEnabledModifiedCB(attribute, container)
{
    container.updateMipmappingEnabled = true;
    container.setModified();
}
MediaTexture.prototype = new Texture();
MediaTexture.prototype.constructor = MediaTexture;

function MediaTexture()
{
    Texture.call(this);
    this.className = "MediaTexture";
    this.attrType = eAttrType.MediaTexture;
    
    this.updateImageFilename = false;
    this.updateAlphaFilename = false;
    this.updateNegateImage = false;
    this.updateNegateAlpha = false;
    this.imagePlayback = null;
    this.alphaPlayback = null;
    this.pixelMap = ePixelMap.Default;
    this.forceImageUpdate = false;
    
    this.imageFilename = new StringAttr("");
    this.alphaFilename = new StringAttr("");
    this.negateImage = new BooleanAttr(false);
    this.negateAlpha = new BooleanAttr(false);
    this.frame = new NumberAttr(-1);
    this.frameRetrieved = new NumberAttr(-1);
    
    this.imageFilename.addModifiedCB(MediaTexture_ImageFilenameModifiedCB, this);
    this.alphaFilename.addModifiedCB(MediaTexture_AlphaFilenameModifiedCB, this);
    this.negateImage.addModifiedCB(MediaTexture_NegateImageModifiedCB, this);
    this.negateAlpha.addModifiedCB(MediaTexture_NegateAlphaModifiedCB, this);
   
    this.registerAttribute(this.imageFilename, "imageFilename");
    this.registerAttribute(this.alphaFilename, "alphaFilename");
    this.registerAttribute(this.negateImage, "negateImage");
    this.registerAttribute(this.negateAlpha, "negateAlpha");
    this.registerAttribute(this.frame, "frame");
    this.registerAttribute(this.frameRetrieved, "frameRetrieved");
}

MediaTexture.prototype.setGraphMgr = function(graphMgr)
{
    // call base-class implementation
    Texture.prototype.setGraphMgr.call(this, graphMgr);
}

MediaTexture.prototype.update = function(params, visitChildren)
{
    if (this.updateImageFilename ||
        this.updateAlphaFilename)
    {
        this.updateImageFilename = false;
        this.updateAlphaFilename = false;

        this.frame.setValueDirect(-1);

        this.loadMedia();
    }

    if (this.updateTextureType)
    {
        this.updateTextureType = false;

        this.setImageSize();

        this.forceImageUpdate = true;
    }

    if (this.updateNegateImage)
    {
        this.updateNegateImage = false;

        this.forceImageUpdate = true;
    }

    if (this.updateNegateAlpha)
    {
        this.updateNegateAlpha = false;

        this.forceImageUpdate = true;
    }

    // update texture image if enabled
    if (this.enabled.getValueDirect())
    {
        this.updateMediaTextureImage();
    }

    // call base-class implementation
    Texture.prototype.update.call(this, params, visitChildren);
}

MediaTexture.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        Texture.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    // call base-class implementation
    Texture.prototype.apply.call(this, directive, params, visitChildren);
}

MediaTexture.prototype.loadMedia = function()
{
    var imageFilename = this.imageFilename.getValueDirect().join("");
    if (imageFilename &&
        imageFilename != "" &&
       !this.imagePlayback || (this.imagePlayback && this.imagePlayback.url != imageFilename))
    {
        this.imagePlayback = new MediaPlayback(this, MediaTexture_OnImageLoad);
        this.imagePlayback.container = this;
        this.imagePlayback.loadImage(imageFilename);
    }
    else if (imageFilename == "")
    {
        // TODO: remove texture
    }

    var alphaFilename = this.alphaFilename.getValueDirect().join("");
    if (alphaFilename &&
        alphaFilename != "" &&
       !this.alphaPlayback || (this.alphaPlayback && this.alphaPlayback.url != alphaFilename))
    {
        this.alphaPlayback = new MediaPlayback(this, MediaTexture_OnAlphaLoad);
        this.alphaPlayback.container = this;
        this.alphaPlayback.loadImage(alphaFilename);

        if (this.imagePlayback)
        {
            this.imagePlayback.setAlphaChannel(this.alphaPlayback);
        }
    }
    else if (alphaFilename == "")
    {
        // TODO: remove texture
    }
    
    // increment modification count
    this.setModified();
}

MediaTexture.prototype.setImageSize = function()
{
    // only perform this action if texture type is not color and/or an alpha channel is present
    if (this.textureType.getValueDirect() == eTextureType.Color &&
       !this.alphaPlayback)
    {
        return;
    }

    if (!this.imagePlayback)
    {
        return;
    }

    // get image playback dimensions
    var dims = this.imagePlayback.getFrameDimensions();
    var width = nextHighestPowerOfTwo(dims.width);
    var height = nextHighestPowerOfTwo(dims.height);

    // based on texture type, determine pixel format
    var pixelFormat;
    switch (this.textureType.getValueDirect())
    {
        case eTextureType.Diffuse:
        case eTextureType.Luminosity:
        case eTextureType.Specularity:
        case eTextureType.Transparency:
        case eTextureType.Clip:
            pixelFormat = ePixelFormat.A8;
            this.pixelMap = ePixelMap.RGBToAlpha;
            break;

        case eTextureType.Color:
        default:
            pixelFormat = this.imagePlayback.getPixelFormat();
            this.pixelMap = ePixelMap.Default;
            break;
    }

    // if alpha playback, ensure pixel format has an alpha channel
    if (this.alphaPlayback)
    {
        switch (pixelFormat)
        {
            case ePixelFormat.R8G8B8:
                pixelFormat = ePixelFormat.R8G8B8A8;
                break;

            case ePixelFormat.B8G8R8:
                pixelFormat = ePixelFormat.B8G8R8A8;
                break;
        }
    }

    // get image playback byte alignment
    var byteAlignment = this.imagePlayback.getPixelByteAlignment();

    // calculate pitch
    this.pitch = width * BytesPerPixel(pixelFormat);
    this.pitch += (byteAlignment - this.pitch % byteAlignment) % byteAlignment;

    // set image attributes
    this.image.width.setValueDirect(width);
    this.image.height.setValueDirect(height);
    this.image.pixelFormat.setValueDirect(pixelFormat);
    this.image.byteAlignment.setValueDirect(byteAlignment);

    // allocate pixel buffer
    this.image.pixels.setLength(height * this.pitch);
}

MediaTexture.prototype.updateMediaTextureImage = function()
{
    // only perform this action if texture type is not color and an alpha channel is present
    if (this.textureType.getValueDirect() == eTextureType.Color &&
       !this.alphaPlayback)
    {
        return;
    }
    
    if (this.imagePlayback &&
        this.imagePlayback.ready &&
       (this.imagePlayback.newFrameDataAvailable() ||
       (this.alphaPlayback && this.alphaPlayback.newFrameDataAvailable()) ||
        this.forceImageUpdate))
    {
        var width = this.image.width.getValueDirect();
        var height = this.image.height.getValueDirect();
        var pixelFormat = this.image.pixelFormat.getValueDirect();

        // set filter mask
        var filterMask = FRAME_FILTER_SCALE_FRAME_BIT;
        if (this.negateImage.getValueDirect())
        {
            filterMask |= FRAME_FILTER_NEGATE_COLOR_BIT;
        }
        if (this.negateAlpha.getValueDirect())
        {
            filterMask |= FRAME_FILTER_NEGATE_ALPHA_BIT;
        }

        // get image data
        var frameRetrieved = this.imagePlayback.getFrameData(width, height, this.pitch, pixelFormat, this.image.pixels.values, filterMask, this.pixelMap, this.frame.getValueDirect());
        this.frameRetrieved.setValueDirect(frameRetrieved);

        this.forceImageUpdate = false;
    }
    
    // increment modification count
    this.setModified();
}

MediaTexture.prototype.onImageLoad = function()
{
    // only perform this action if texture type is not color and/or an alpha channel is present
    if (this.textureType.getValueDirect() == eTextureType.Color &&
       !this.alphaPlayback)
    {
        this.textureObj.setImage(this.imagePlayback.htmlImageElement, ePixelFormat.R8G8B8A8, eImageFormat.RGBA);
        this.imageSet = true;
        this.setModified();
        return;
    }
    
    this.setImageSize();
}

MediaTexture.prototype.onAlphaLoad = function()
{
}

MediaTexture.prototype.onVideoLoad = function()
{   /*
    var image = this.htmlImageElement;
    var canvas = document.createElement("canvas");
    var canvasContext = canvas.getContext("2d");
    canvas.width = 200; //image.width;
    canvas.height = 200; //image.height;
    canvasContext.drawImage(image, 0, 0);
    var imageData = canvasContext.getImageData(0, 0, canvas.width, canvas.height);
    this.textureObj.setImageData(imageData);
    this.imageSet = true;
    this.video = true;
    //alert(imageData.data[0]);
    //alert(imageData.data[1]);
    //alert(imageData.data[2]);
    //alert(imageData.data[3]);
    */
    this.textureObj.setVideo(this.htmlImageElement);
    this.textureObj.negate = this.negateImage.getValueDirect();
    this.imageSet = true;
}

function MediaTexture_OnImageLoad()
{
    this.container.onImageLoad();
}

function MediaTexture_OnAlphaLoad()
{
    this.container.onAlphaLoad();
}

function MediaTexture_OnVideoLoad()
{
    alert("MediaTexture_OnVideoLoad");
    this.container.onVideoLoad();
}

function MediaTexture_ImageFilenameModifiedCB(attribute, container)
{
    container.updateImageFilename = true;
    container.setModified();
}

function MediaTexture_AlphaFilenameModifiedCB(attribute, container)
{
    container.updateAlphaFilename = true;
    container.setModified();
}

function MediaTexture_NegateImageModifiedCB(attribute, container)
{
    container.updateNegateImage = true;
    container.setModified();
}

function MediaTexture_NegateAlphaModifiedCB(attribute, container)
{
    container.updateNegateAlpha = true;
    container.setModified();
}
Evaluator.prototype = new Node();
Evaluator.prototype.constructor = Evaluator;

function Evaluator()
{
    Node.call(this);
    this.className = "Evaluator";
    this.attrType = eAttrType.Evaluator;
    
    this.evaluate_ = new BooleanAttr(true);
    this.expired = new BooleanAttr(false);
    
    this.registerAttribute(this.expired, "expired");
    this.registerAttribute(this.evaluate_, "evaluate");
    
    // evaluate/enabled are interchangeable
    this.evaluate_.addTarget(this.enabled);
    this.enabled.addTarget(this.evaluate_);
}

Evaluator.prototype.evaluate = function()
{
}

Evaluator.prototype.update = function(params, visitChildren)
{
    // evaluate if evaluator is "enabled" and has not "expired"
    var enabled = this.enabled.getValueDirect();
    var expired = this.expired.getValueDirect();
    if (enabled && !expired)
    {
        this.evaluate();
    }
    
    // call base-class implementation
    Node.prototype.update.call(this, params, visitChildren);
}
SceneInspector.prototype = new Evaluator();
SceneInspector.prototype.constructor = SceneInspector;

function SceneInspector()
{
    Evaluator.call(this);
    this.className = "SceneInspector";
    this.attrType = eAttrType.SceneInspector;
    
    this.camera = null;
        
    this.viewPosition = new Vector3DAttr(0, 0, 0);
    this.viewRotation = new Vector3DAttr(0, 0, 0);
    this.translationDelta = new Vector3DAttr(0, 0, 0);
    this.panDelta = new Vector3DAttr(0, 0, 0);
    this.trackDelta = new Vector3DAttr(0, 0, 0);
    this.rotationDelta = new Vector3DAttr(0, 0, 0);
    this.viewRelativeXAxisRotation = new BooleanAttr(false);
    this.viewRelativeYAxisRotation = new BooleanAttr(false);
    this.viewRelativeZAxisRotation = new BooleanAttr(false);
    this.pivotDistance = new NumberAttr(0);
    this.pivotPointWorld = new Vector3DAttr(0, 0, 0);
    this.resultPosition = new Vector3DAttr(0, 0, 0);
    this.resultRotation = new Vector3DAttr(0, 0, 0);
    /// indicates the up/right/forward vectors to use for pan/track; if zero,
    /// camera up/right/forward vectors are used (default: zero)
    this.upVector = new Vector3DAttr(0, 0, 0);
    this.rightVector = new Vector3DAttr(0, 0, 0);
    this.forwardVector = new Vector3DAttr(0, 0, 0);
    /// indicate which components of resultPosition/resultRotation should be set; if true,
    /// the component is set, if false, it is not (default: true)
    this.affectPosition_X = new BooleanAttr(true);
    this.affectPosition_Y = new BooleanAttr(true);
    this.affectPosition_Z = new BooleanAttr(true);
    this.affectRotation_X = new BooleanAttr(true);
    this.affectRotation_Y = new BooleanAttr(true);
    this.affectRotation_Z = new BooleanAttr(true);
    
    this.registerAttribute(this.viewPosition, "viewPosition");
    this.registerAttribute(this.viewRotation, "viewRotation");
    this.registerAttribute(this.translationDelta, "translationDelta");
    this.registerAttribute(this.panDelta, "panDelta");
    this.registerAttribute(this.trackDelta, "trackDelta");
    this.registerAttribute(this.rotationDelta, "rotationDelta");
    this.registerAttribute(this.viewRelativeXAxisRotation, "viewRelativeXAxisRotation");
    this.registerAttribute(this.viewRelativeYAxisRotation, "viewRelativeYAxisRotation");
    this.registerAttribute(this.viewRelativeZAxisRotation, "viewRelativeZAxisRotation");
    this.registerAttribute(this.pivotDistance, "pivotDistance");
    this.registerAttribute(this.pivotPointWorld, "pivotPointWorld");
    this.registerAttribute(this.resultPosition, "resultPosition");
    this.registerAttribute(this.resultRotation, "resultRotation");
    this.registerAttribute(this.upVector, "upVector");
    this.registerAttribute(this.rightVector, "rightVector");
    this.registerAttribute(this.forwardVector, "forwardVector");
    this.registerAttribute(this.affectPosition_X, "affectPosition_X");
    this.registerAttribute(this.affectPosition_Y, "affectPosition_Y");
    this.registerAttribute(this.affectPosition_Z, "affectPosition_Z");
    this.registerAttribute(this.affectRotation_X, "affectRotation_X");
    this.registerAttribute(this.affectRotation_Y, "affectRotation_Y");
    this.registerAttribute(this.affectRotation_Z, "affectRotation_Z");
}

SceneInspector.prototype.setCamera = function(camera)
{
    this.camera = camera;
}

SceneInspector.prototype.getCamera = function()
{
    return this.camera;
}

SceneInspector.prototype.evaluate = function()
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        return;
    }
    
    // get input values
    
    // view position
    var viewPosition = this.viewPosition.getValueDirect();
    
    // view rotation
    var viewRotation = this.viewRotation.getValueDirect();
    
    // translation delta
    var translationDelta = this.translationDelta.getValueDirect();
    
    // pan delta
    var panDelta = this.panDelta.getValueDirect();
    
    // track delta
    var trackDelta = this.trackDelta.getValueDirect();
    
    // rotation delta
    var rotationDelta = this.rotationDelta.getValueDirect();
    
    // view-relative rotation flags
    var viewRelativeXAxisRotation = this.viewRelativeXAxisRotation.getValueDirect();
    var viewRelativeYAxisRotation = this.viewRelativeYAxisRotation.getValueDirect();
    var viewRelativeZAxisRotation = this.viewRelativeZAxisRotation.getValueDirect();
    
    // pivot distance
    var pivotDistance = this.pivotDistance.getValueDirect();
    
    // formulate view transform
    var viewTrans = new Matrix4x4();
    viewTrans.loadTranslation(-viewPosition.x, -viewPosition.y, -viewPosition.z);
    var viewRot = new Matrix4x4();
    viewRot.loadXYZAxisRotation(-viewRotation.x, -viewRotation.y, -viewRotation.z);
    var viewTransform = viewTrans.multiply(viewRot);

    // calculate camera direction vectors
    var cameraUp = this.transformDirectionVector(0, 1, 0, viewTransform);
    var cameraRight = this.transformDirectionVector(1, 0, 0, viewTransform);
    var cameraForward = this.transformDirectionVector(0, 0, 1, viewTransform);
    
    // set rotation matrix
    var sceneRotX = new Matrix4x4();
    var sceneRotY = new Matrix4x4();
    var sceneRotZ = new Matrix4x4();
    // x
    if (viewRelativeXAxisRotation)
    {
        sceneRotX.loadRotation(cameraRight.x, cameraRight.y, cameraRight.z, -rotationDelta.x);
    }
    else
    {
        sceneRotX.loadXAxisRotation(-rotationDelta.x);
    }
    // y
    if (viewRelativeYAxisRotation)
    {
        sceneRotY.loadRotation(cameraUp.x, cameraUp.y, cameraUp.z, -rotationDelta.y);
    }
    else
    {
        sceneRotY.loadYAxisRotation(-rotationDelta.y);
    }
    // z
    if (viewRelativeZAxisRotation)
    {
        sceneRotZ.loadRotation(cameraForward.x, cameraForward.y, cameraForward.z, -rotationDelta.z);
    }
    else
    {
        sceneRotZ.loadXAxisRotation(-rotationDelta.z);
    }
    var sceneRot = sceneRotY.multiply(sceneRotX.multiply(sceneRotZ)); // this multiplication order eliminates roll when x- and y-axis rotations are combined
    
    // set translation matrix
    var sceneTrans = new Matrix4x4();
    sceneTrans.loadTranslation(translationDelta.x, -translationDelta.y, -translationDelta.z);
    
    // set pan/track
    if (panDelta.x != 0 || panDelta.y != 0 || panDelta.z != 0 ||
        trackDelta.x != 0 || trackDelta.y != 0 || trackDelta.z != 0)
    {
        // pan up/right/forward vectors
        var up = this.upVector.getValueDirect();
        var right = this.rightVector.getValueDirect();
        var forward = this.forwardVector.getValueDirect();
        if (up.x == 0 && up.y == 0 && up.z == 0) up = cameraUp;
        if (right.x == 0 && right.y == 0 && right.z == 0) right = cameraRight;
        if (forward.x == 0 && forward.y == 0 && forward.z == 0) forward = cameraForward;
        
        // calculate direction vectors after scene rotation matrix is applied
        var cameraUpRot = up;
        var cameraRightRot = right;    
        var cameraForwardRot = forward;    
            
        var scenePan = new Matrix4x4();
        scenePan.loadTranslation(
            cameraRightRot.x * panDelta.x + cameraUpRot.x * -panDelta.y + cameraForwardRot.x * -panDelta.z, 
            cameraRightRot.y * panDelta.x + cameraUpRot.y * -panDelta.y + cameraForwardRot.y * -panDelta.z, 
            cameraRightRot.z * panDelta.x + cameraUpRot.z * -panDelta.y + cameraForwardRot.z * -panDelta.z);
            
        sceneTrans = sceneTrans.multiply(scenePan);
        
        // formulate "track" or "dolly" vectors:
        // track forward = cameraForwardRot (calculated above) rotated about cameraRightRot 
        // (calculated above) viewRotation.x (camera pitch) degrees;
        // track up = track forward rotated about the camera right vector 90 degrees;
        // track right = cameraRightRot (calculated above)
        var sceneTrack = new Matrix4x4();
        var cameraVectorRot = new Matrix4x4();
        
        var flipIt = false;
        var abs_heading = Math.abs(viewRotation.y);
        var abs_pitch = Math.abs(viewRotation.x);
        var abs_bank = Math.abs(viewRotation.z);
        if (viewRotation.z >= 90 && viewRotation.z <= 270)
        {
            flipIt = true;
        }
        else if (viewRotation.z <= -90 && viewRotation.z >= -270)
        {
            flipIt = true
        }
        else
        {
            if (viewRotation.x <= -45 || (viewRotation.x >= 45 && viewRotation.x <= 90))
            {
                flipIt = true;
            }
        }
        
        var lastCameraForwardRot = cameraForwardRot;

        cameraVectorRot.loadRotation(cameraRightRot.x, cameraRightRot.y, cameraRightRot.z, viewRotation.x);
        cameraForwardRot = this.transformDirectionVector(cameraForwardRot.x, cameraForwardRot.y, cameraForwardRot.z, cameraVectorRot);

        var angle = toDegrees(Math.acos(cosineAngleBetween(lastCameraForwardRot, cameraForwardRot)));

        cameraVectorRot.loadRotation(cameraRightRot.x, cameraRightRot.y, cameraRightRot.z, 90);
        cameraUpRot = this.transformDirectionVector(cameraUpRot.x, cameraUpRot.y, cameraUpRot.z, cameraVectorRot);
        sceneTrack.loadTranslation(
            cameraRightRot.x * trackDelta.x + cameraUpRot.x * -trackDelta.y + cameraForwardRot.x * -trackDelta.z, 
            cameraRightRot.y * trackDelta.x + cameraUpRot.y * -trackDelta.y + 0, /*cameraForwardRot.y * -trackDelta.z,*/ // don't set y-component when z-tracking
            cameraRightRot.z * trackDelta.x + cameraUpRot.z * -trackDelta.y + cameraForwardRot.z * -trackDelta.z);

        sceneTrans = sceneTrans.multiply(sceneTrack);
    }
    
    // set pivot distance transforms

    // get camera position in world coordinates
    var viewTransformWorld = new Matrix4x4();
    viewTransformWorld.loadMatrix(viewTransform);
    viewTransformWorld.invert();
    var cameraPos = new Vector3D();
    cameraPos.load(viewTransformWorld._41, viewTransformWorld._42, viewTransformWorld._43);

    var pivotTrans = new Vector3D();
    pivotTrans.load(
        cameraPos.x + cameraForward.x * pivotDistance,
        cameraPos.y + cameraForward.y * pivotDistance,
        cameraPos.z + cameraForward.z * pivotDistance);                
	this.pivotPointWorld.setValueDirect(pivotTrans.x, pivotTrans.y, pivotTrans.z);

    var scenePivot = new Matrix4x4();
    var scenePivotInv = new Matrix4x4();
    scenePivot.loadTranslation(-pivotTrans.x, -pivotTrans.y, -pivotTrans.z);
    scenePivotInv.loadTranslation(pivotTrans.x, pivotTrans.y, pivotTrans.z);
    
    // set overall transform
    var resultTransform = sceneTrans.multiply(scenePivot.multiply(sceneRot.multiply(scenePivotInv.multiply(viewTransform))));

    var resultRotation = resultTransform.getRotationAngles();

    var resultPosition = new Vector3D();
    resultPosition.load(resultTransform._41, resultTransform._42, resultTransform._43);
    resultTransform.transpose(); // invert rotation
    resultPosition = resultTransform.transform(resultPosition.x, resultPosition.y, resultPosition.z, 0);

    // output results
    this.resultPosition.setValueDirect(this.affectPosition_X.getValueDirect() ? -resultPosition.x : viewPosition.x, 
                                       this.affectPosition_Y.getValueDirect() ? -resultPosition.y : viewPosition.y,
                                       this.affectPosition_Z.getValueDirect() ? -resultPosition.z : viewPosition.z);
    this.resultRotation.setValueDirect(this.affectRotation_X.getValueDirect() ? -resultRotation.x : viewRotation.x, 
                                       this.affectRotation_Y.getValueDirect() ? -resultRotation.y : viewRotation.y, 
                                       this.affectRotation_Z.getValueDirect() ? -resultRotation.z : viewRotation.z);
}

SceneInspector.prototype.transformDirectionVector = function(x, y, z, matrix)
{
    var m = new Matrix4x4();
    m.loadMatrix(matrix);
    m.transpose(); // invert rotation
    
    return m.transform(x, y, z, 0);
}

/*
SceneInspector.prototype.zoomIn = function()
{
   var x = bridgeworks.registry.find("SceneInspector");
   x.panDelta.z+=30;
    x.panDelta.setValueDirect(this.panDelta.x, this.panDelta.y, this.panDelta.z, this.viewTransform);
    x.updateScene();
}

SceneInspector.prototype.zoomOut = function()
{
    this.panDelta.z-=30;
    this.panDelta.setValueDirect(this.panDelta.x, this.panDelta.y, this.panDelta.z,this.viewTransform);
    this.updateScene();
}
*/


ArcballInspector.prototype = new Evaluator();
ArcballInspector.prototype.constructor = ArcballInspector;

function ArcballInspector()
{
    Evaluator.call(this);
    this.className = "ArcballInspector";
    this.attrType = eAttrType.ArcballInspector;

    this.sphereCenter = new Vector3DAttr(0, 0, 0);
    this.sphereRadius = new NumberAttr(0);
    this.mouseDown = new Vector2DAttr(0, 0);
    this.mouseNow = new Vector2DAttr(0, 0);
    this.quatAtMouseDown = new QuaternionAttr(1, 0, 0, 0);
    this.viewport = new ViewportAttr(0, 0, 0, 0);
    this.worldTransform = new Matrix4x4Attr();
    this.viewTransform = new Matrix4x4Attr();
    this.constrainToAxis = new BooleanAttr(false);
    this.constraintAxis = new Vector3DAttr(0, 0, 0);
    this.resultQuat = new QuaternionAttr(1, 0, 0, 0);

    this.registerAttribute(this.sphereCenter, "sphereCenter");
    this.registerAttribute(this.sphereRadius, "sphereRadius");
    this.registerAttribute(this.mouseDown, "mouseDown");
    this.registerAttribute(this.mouseNow, "mouseNow");
    this.registerAttribute(this.quatAtMouseDown, "quatAtMouseDown");
    this.registerAttribute(this.viewport, "viewport");
    this.registerAttribute(this.worldTransform, "worldTransform");
    this.registerAttribute(this.viewTransform, "viewTransform");
    this.registerAttribute(this.constrainToAxis, "constrainToAxis");
    this.registerAttribute(this.constraintAxis, "constraintAxis");
    this.registerAttribute(this.resultQuat, "resultQuat");
}

ArcballInspector.prototype.evaluate = function()
{
    if (!(this.enabled.getValueDirect()))
    {
        return;
    }

    // get input values

    // sphere center
    var center = this.sphereCenter.getValueDirect();

    // sphere radius
    var radius = this.sphereRadius.getValueDirect();

    // mouse coords
    var mouseDown = this.mouseDown.getValueDirect();
    var mouseNow = this.mouseNow.getValueDirect();

    // mouse down quat
    var quatDown = this.quatAtMouseDown.getValueDirect();

    // viewport
    var vp = this.viewport;
 
    // world transform
    var world = this.worldTransform.getValueDirect();

    // view transform
    var view = this.viewTransform.getValueDirect();

    // invert world transform (to account for existing transformations) and combine with view transform
    world.invert();
    view = view.multiply(world);

    // constrain to axis
    var constrain = this.constrainToAxis.getValueDirect();

    // normalize screen coordinates to [-1, 1] (invert y -- screen y coords are reversed)
    center.x    = 2 * (center.x - vp.x) / vp.width -1;
    center.y    = 2 * (vp.height - center.y - vp.y) / vp.height - 1;
    mouseDown.x = 2 * (mouseDown.x - vp.x) / vp.width  - 1;
    mouseDown.y = 2 * (vp.height - mouseDown.y - vp.y) / vp.height - 1;
    mouseNow.x  = 2 * (mouseNow.x  - vp.x) / vp.width  - 1;
    mouseNow.y  = 2 * (vp.height - mouseNow.y  - vp.y) / vp.height - 1;
    
    // get points on sphere corresponding to mouse down and mouse now
    var ptDown, ptNow;
    if (!constrain)
    {
        ptDown = this.getSpherePoint(mouseDown, center, radius);
        ptNow = this.getSpherePoint(mouseNow, center, radius);
    }
    else // constrain
    {
        // constraint axis
        var axis = this.constraintAxis.getValueDirect();

        ptDown = this.getSpherePointAboutAxis(mouseDown, center, radius, axis);
        ptNow = this.getSpherePointAboutAxis(mouseNow, center, radius, axis);
    }

    // transform by view matrix
    var ptDownX = view.transform(ptDown.x, ptDown.y, ptDown.z, 0);
    var ptNowX = view.transform(ptNow.x, ptNow.y, ptNow.z, 0);
    ptDown.x = ptDownX.x;
    ptDown.y = ptDownX.y;
    ptDown.z = ptDownX.z;
    ptNow.x = ptNowX.x;
    ptNow.y = ptNowX.y;
    ptNow.z = ptNowX.z;
    ptDown.normalize();
    ptNow.normalize();

    // construct unit quaternion from the two points on sphere
    var quatDrag = this.getQuatFromSpherePoints(ptDown, ptNow);

    // multiply drag quaternion with down quaternion
    quatDrag = quatDrag.multiply(quatDown);
    
    this.resultQuat.setValueDirect(quatDrag);
}

ArcballInspector.prototype.getSpherePoint = function(mouse, center, radius)
{
    var point = new Vector3D();
    
    point.x = (mouse.x - center.x) / radius;
    point.y = (mouse.y - center.y) / radius;

    var mag = point.x * point.x + point.y * point.y;
    if (mag > 1.0)
    {
        var scale = 1 / Math.sqrt(mag);
        point.x *= scale;
        point.y *= scale;
        point.z = 0;
    }
    else // mag <= 1.0f
    {
        point.z = -(Math.sqrt(1 - mag));
    }
    return point;
}

ArcballInspector.prototype.getSpherePointAboutAxis = function(mouse, center, radius, axis)
{
    point = this.getSpherePoint(mouse, center, radius);

    var dot = dotProduct(point, axis);
    
    axis.multiplyScalar(dot);
    
    var proj = new Vector3D(point.x, point.y, point.z);
    
    proj.subtractVector(axis);
    
    var norm = magnitude(proj.x, proj.y, proj.z);
    
    point = null;
    
    if (norm > 0)
    {
        var s = 1 / Math.sqrt(norm);
        if (proj.z < 0)
        {
            proj.x = -proj.x;
            proj.y = -proj.y;
            proj.z = -proj.z;
        }

        point = proj.multiplyScalar(s);
    }
    else if (axis.z == 1.0)
    {
        point = new Vector3D(1, 0, 0);
    }
    else
    {
        point.normalize();
    }
}

ArcballInspector.prototype.getQuatFromSpherePoints = function(pt1, pt2)
{
    var quat = new Quaternion();
    quat.x = pt1.y * pt2.z - pt1.z * pt2.y;
    quat.y = pt1.z * pt2.x - pt1.x * pt2.z;
    quat.z = pt1.x * pt2.y - pt1.y * pt2.x;
    quat.w = pt1.x * pt2.x + pt1.y * pt2.y + pt1.z * pt2.z;
    return quat;
}

// doesn't do anything
function ArcballInspector_ViewTransformModifiedCB(attribute, container)
{
    /*
    if (attr)
    {
        CMatrix4x4FloatAttr* viewTransform = dynamic_cast<CMatrix4x4FloatAttr*>(attr);
        if (viewTransform)
        {
            CMatrix4x4f m;
            viewTransform.getValueDirect(m);
        }
    }
    */
}


KeyframeInterpolator.prototype = new Evaluator();
KeyframeInterpolator.prototype.constructor = KeyframeInterpolator;

function EndState()
 {
    this.initialized = false;
    this.startKeyIts = []; // one for each channel
    this.endKeyIts = [];  // one for each channel
    this.startTime = -FLT_MAX;    // across all channels
    this.endTime = FLT_MAX;     // across all channels
 }
    
function KeyframeInterpolator()
{
    Evaluator.call(this);
    this.className = "KeyframeInterpolator";
    this.attrType = eAttrType.KeyframeInterpolator;

    this.lastTime = 0;
    this.evaluated = false;
    this.endState =  new EndState();
    
    this.time = new NumberAttr(0);
    this.channels = new AttributeVector();
    this.startKeys = new AttributeVector();
    this.endKeys = new AttributeVector();
    this.preBehaviors = new AttributeVector();
    this.postBehaviors = new AttributeVector();
    this.resultValues = new AttributeVector();

    this.time.addModifiedCB(KeyframeInterpolator_TimeModifiedCB, this);
    
    this.registerAttribute(this.time, "time");
    this.registerAttribute(this.channels, "channels");
    this.registerAttribute(this.startKeys, "startKeys");
    this.registerAttribute(this.endKeys, "endKeys");
    this.registerAttribute(this.preBehaviors, "preBehaviors");
    this.registerAttribute(this.postBehaviors, "postBehaviors");
    this.registerAttribute(this.resultValues, "resultValues");
}

KeyframeInterpolator.prototype.setNumChannels = function(numChannels)
{
    // clear
    this.channels.resize(0);
    this.startKeys.resize(0);
    this.endKeys.resize(0);
    this.preBehaviors.resize(0);
    this.postBehaviors.resize(0);
    this.resultValues.resize(0);
    
    for (var i=0; i < numChannels; i++)
    {
        this.channels.push_back(new KeyframesAttr());
        this.startKeys.push_back(new NumberAttr(-1));
        this.endKeys.push_back(new NumberAttr(-1));
        this.preBehaviors.push_back(new NumberAttr(eEndBehavior.Reset));
        this.postBehaviors.push_back(new NumberAttr(eEndBehavior.Reset));
        this.resultValues.push_back(new NumberAttr(0));
    }
}

KeyframeInterpolator.prototype.evaluate = function()
{
    // initialize end state if not already initialized
    if (!this.endState.initialized)
    {
        // initialize
        this.updateEndState();
        this.endState.initialized = true;
    }
    
    // get input values

    // time
    var time = this.time.getValueDirect();

    var first, last;
    var pre, post;

    // for each channel...
    for (var i = 0; i < this.channels.vector.length; i++)
    {
        var keyframes = this.channels.getAt(i);
        if (keyframes.vector.length == 0) continue;

        first = this.endState.startKeyIts[i];
        last = this.endState.endKeyIts[i];

        pre = this.preBehaviors.getAt(i).getValueDirect();
        post = this.postBehaviors.getAt(i).getValueDirect();

        // interpolate
        var value = interpolate(time, keyframes, first, last, pre, post);

        // output result
        this.resultValues.getAt(i).setValueDirect(value);
    }

    this.lastTime = time;
    this.evaluated = true;
}

KeyframeInterpolator.prototype.timeModified = function()
{
    this.updateExpired();
}

KeyframeInterpolator.prototype.updateExpired = function()
{
    // determine if kfi has "expired"
    this.expired.setValueDirect(false);

    // NOTE: this code moved from RenderAgent

    // an multi-channel Evaluator (i.e., KeyframeInterpolator) is considered
    // animating if any 1 of its channels meet the requirements for determining
    // whether or not Evaluate is called.  For KeyframeInterpolators, "at least
    // one channel is animating" if any one of the channels' keys has a time 
    // value greater than the current time.
    var bAtLeastOneChannelAnimating = false;

    // for each channel in the interpolator, compare current time
    // with both end behavior and stop time to determine whether or 
    // not this kfi should continue to be evaluated
    var fEvalTime = this.time.getValueDirect();
    var iPost = 0;
    var postBehavior = null;
    var numChannels = this.channels.vector.length;
    for (var i=0; i < numChannels; i++)
    {
        postBehavior = this.postBehaviors.getAt(i);
        if (postBehavior)
        {
            iPost = postBehavior.getValueDirect();
        }

        // if *expression* is TRUE then the end behavior is 
        // repeat, oscillate, or some other continuous behavior
        if (iPost != eEndBehavior.Constant)
        {
            bAtLeastOneChannelAnimating = true;
            break;
        }
    }

    // if the eval's current time either:
    // 1. has advanced passed its longest keyframe OR
    // 2. is not yet at its start time
    // then stop evaluating it.
    // NOTE: only check Constant end behaviors b/c Repeats and
    // Oscillators should keep running.  By definition, scenes w/
    // non-constant end behaviors will never AA
    if (!bAtLeastOneChannelAnimating &&
        (fEvalTime < this.endState.startTime || fEvalTime > this.endState.endTime))
    {
        // set expired flag
        this.expired.setValueDirect(true);
    }
}

KeyframeInterpolator.prototype.updateEndState = function()
{
    var fStartTime = -1;
    var fEndTime = -1;
    var fShortest = FLT_MAX;
    var fLongest = -FLT_MAX;
    var startKey = -1, endKey = -1;
    var keyframes = null;
    var numChannels = this.channels.vector.length;
    
    this.startKeys.resize(numChannels);
    this.endKeys.resize(numChannels);
    
    for (var i=0; i < numChannels; i++)
    {
        keyframes = this.channels.getAt(i);
        
        startKey = this.startKeys.vector.length > i ? this.startKeys.getAt(i).getValueDirect() : -1;
        endKey = this.endKeys.vector.length > i ? this.endKeys.getAt(i).getValueDirect() : -1;
        
        if (endKey < startKey)
        {
            endKey = startKey;
        }
        
        // set first/last keys to evaluate
        this.endState.startKeyIts[i] = keyframes.getAt(0); 
        this.endState.endKeyIts[i] = keyframes.getAt(keyframes.vector.length - 1);
        if (!this.endState.startKeyIts[i] || !this.endState.endKeyIts[i]) continue;
        
        if (startKey >= 0 && startKey < keyframes.vector.length)
        {
            this.endState.startKeyIts[i] = keyframes.getAt(startKey);
        }

        if (endKey >= 0 && endKey < keyframes.vector.length)
        {
            this.endState.endKeyIts[i] = keyframes.getAt(endKey);
        }

	    fStartTime = this.endState.startKeyIts[i].getTime();
        fEndTime = this.endState.endKeyIts[i].getTime();

	    // save the smallest start time for all channels
	    fShortest = fStartTime < fShortest ? fStartTime : fShortest;

	    // save the longest end time for all channels
	    fLongest = fEndTime >= fLongest ? fEndTime : fLongest;
    }
    
    this.endState.startTime = fShortest;
    this.endState.endTime = fLongest;
}

function KeyframeInterpolator_TimeModifiedCB(attribute, container)
{
    container.timeModified();
}

function KeyframeInterpolator_EndStateModifiedCB(attribute, container)
{
    container.updateEndState();
}
BBoxLocator.prototype = new Evaluator();
BBoxLocator.prototype.constructor = BBoxLocator;

function BBoxLocator()
{
    Evaluator.call(this);
    this.className = "BBoxLocator";
    this.attrType = eAttrType.BBoxLocator;

    this.viewPosition = new Vector3DAttr(0, 0, 0);
    this.viewTransform = new Matrix4x4Attr(1, 0, 0, 0,
                                           0, 1, 0, 0,
                                           0, 0, 1, 0,
                                           0, 0, 0, 1);
    this.viewVolume = new ViewVolumeAttr();
    this.viewport = new ViewportAttr(0, 0, 0, 0);
    this.nearDistance = new NumberAttr(0);
    this.bbox = new BBoxAttr();
    this.bboxView = new BBoxAttr();
    this.closeness = new NumberAttr(0.5);
    this.resultPosition = new Vector3DAttr(0, 0, 0);
    this.resultWidth = new NumberAttr(0);
    this.resultFarDistance = new NumberAttr(0);
    this.resultPivotDistance = new NumberAttr(0);
    
    this.registerAttribute(this.viewPosition, "viewPosition");
    this.registerAttribute(this.viewTransform, "viewTransform");
    this.registerAttribute(this.viewVolume, "viewVolume");
    this.registerAttribute(this.viewport, "viewport");
    this.registerAttribute(this.nearDistance, "nearDistance");
    this.registerAttribute(this.bbox, "bbox");
    this.registerAttribute(this.bboxView, "bboxView");
    this.registerAttribute(this.closeness, "closeness");
    this.registerAttribute(this.resultPosition, "resultPosition");
    this.registerAttribute(this.resultWidth, "resultWidth");
    this.registerAttribute(this.resultFarDistance, "resultFarDistance");
    this.registerAttribute(this.resultPivotDistance, "resultPivotDistance");
}

BBoxLocator.prototype.evaluate = function()
{
    // get input values

    // position
    var viewPosition = this.viewPosition.getValueDirect();

    // view transform
    var viewTransform = this.viewTransform.getValueDirect();

    // view volume planes
    var left = this.viewVolume.left.getValueDirect();
    var right = this.viewVolume.right.getValueDirect();
    var top = this.viewVolume.top.getValueDirect();
    var bottom = this.viewVolume.bottom.getValueDirect();
    var near = this.viewVolume.near.getValueDirect();
    var far = this.viewVolume.far.getValueDirect();

    // viewport
    var viewport = this.viewport.getValueDirect();

    // bbox min/max points
    var min = this.bbox.min.getValueDirect();
    var max = this.bbox.max.getValueDirect();

    // closeness
    var closeness = this.closeness.getValueDirect();
    if (closeness != 0)
    {
        var bbw = max.x - min.x;
        var bbh = max.y - min.y;

        bbw += bbw * closeness;
        bbh += bbh * closeness;

        if (viewport.width / viewport.height < bbw / bbh)
        {
            bbw = (bbw - (max.x - min.x)) / 2;
            min.x -= bbw;
            max.x += bbw;
        }
        else // (viewport.width / viewport.height >= bbw / bbh)
        {
            bbh = (bbh - (max.y - min.y)) / 2;
            min.y -= bbh;
            max.y += bbh;
        }
    }

    // formulate bbox endpoints
    var p = new Array(8);
    p[0] = new Vector3D(min.x, min.y, min.z);
    p[1] = new Vector3D(min.x, min.y, max.z);
    p[2] = new Vector3D(min.x, max.y, min.z);
    p[3] = new Vector3D(min.x, max.y, max.z);
    p[4] = new Vector3D(max.x, min.y, min.z);
    p[5] = new Vector3D(max.x, min.y, max.z);
    p[6] = new Vector3D(max.x, max.y, min.z);
    p[7] = new Vector3D(max.x, max.y, max.z);

    // get center of world-space bbox
    var center = new Vector3D((min.x + max.x) / 2,
                              (min.y + max.y) / 2,
                              (min.z + max.z) / 2);

    // get camera forward vector
    var fwd = new Vector3D();
    fwd.copy(viewTransform.transform(0, 0, 1, 0));
    fwd.normalize();

    var distance = 0;
    var resultPosition;
    var perspectiveViewVolume = planesIntersect(left, right);

    // if perspective camera...
    if (perspectiveViewVolume)
    {
        // formulate camera-oriented view-volume planes centered at bbox center
        var vvPlanes = new Array(5); // don't consider far plane

        vvPlanes[0] = this.getPlane(left.point, center, left.normal, viewTransform);
        vvPlanes[1] = this.getPlane(right.point, center, right.normal, viewTransform);
        vvPlanes[2] = this.getPlane(top.point, center, top.normal, viewTransform);
        vvPlanes[3] = this.getPlane(bottom.point, center, bottom.normal, viewTransform);
        vvPlanes[4] = this.getPlane(near.point, center, near.normal, viewTransform);

        // for each bbox point, determine the maximum distance necessary to move all points to within the
        // view-volume along the camera forward vector		
        for (var i = 0; i < 8; i++)
        {
            for (var j = 0; j < 5; j++)
            {
                if (pointOnPositiveSideOfPlane(p[i], vvPlanes[j]))
                {
                    var d = this.distanceFromPlane(p[i], fwd, vvPlanes[j]);
                    if (d.intersection)
                    {
                        distance = Math.max(distance, d.distance);
                    }
                }
            }
        }

        resultPosition = new Vector3D(center.x, center.y, center.z);
        fwd.multiplyScalar(distance);
        resultPosition.subtractVector(fwd);
    }
    else // orthographic camera
    {
        resultPosition = new Vector3D(center.x, center.y, center.z);
        distance = magnitude(viewPosition.x, viewPosition.y, viewPosition.z);
        fwd.multiplyScalar(distance);
        resultPosition.subtractVector(fwd);

        // set width

        // get bboxView min/max points
        var vmin = this.bboxView.min.getValueDirect();
        var vmax = this.bboxView.max.getValueDirect();

        var width = distanceBetweenPlanes(right, left);
        var height = distanceBetweenPlanes(top, bottom);
        var aspect = width / height;

        var xDim = Math.abs(vmax.x - vmin.x);
        var yDim = Math.abs(vmax.y - vmin.y);

        // this could probably be simplified, but it works
        if (xDim > yDim)
        {
            width = xDim;

            height = width / aspect;
            if (height < yDim)
            {
                height = yDim;
                width = height * aspect;
            }
        }
        else
        {
            height = yDim;
            width = height * aspect;

            if (width < xDim)
            {
                width = xDim;
            }
        }

        // output result
        this.resultWidth.setValueDirect(width);
    }

    // output result(s)
    this.resultPosition.setValueDirect(resultPosition.x, resultPosition.y, resultPosition.z);

    // determine distance of all points from near clipping plane
    distance = 0;
    for (var i = 0; i < 8; i++)
    {
        var px = viewTransform.transform(p[i].x, p[i].y, p[i].z, 1);
        distance = Math.max(distance, distanceBetween(p[i], resultPosition));
    }

    this.resultFarDistance.setValueDirect(this.nearDistance.getValueDirect() + distance);

    // determine pivot distance (distance between camera and center of bbox in world-space)
    distance = distanceBetween(resultPosition, new Vector3D(center.x, center.y, center.z));
    this.resultPivotDistance.setValueDirect(distance);
}

BBoxLocator.prototype.getPlane = function(point, offset, normal, transform)
{
    var xpoint = transform.transformVector3D(point, 0);
    xpoint.x += offset.x;
    xpoint.y += offset.y;
    xpoint.z += offset.z;

    var xnormal = transform.transformVector3D(normal, 0);

    var plane = new Plane(new Vector3D(xpoint.x, xpoint.y, xpoint.z), new Vector3D(xnormal.x, xnormal.y, xnormal.z));

    return plane;
}

BBoxLocator.prototype.distanceFromPlane = function(point, dir, plane)
{
    var line = new Line(point, dir);
    var distance;

    var intersection = lineIntersectsPlane(line, plane);
    switch (intersection.result)
    {
    case 0: // no intersection
        distance = FLT_MAX;
        break;

    case 1: // intersection at 1 point
        distance = distanceBetween(point, intersection.point);
        break;

    case 2: // intersection at infinite points (line on plane) 
    default:
        distance = 0;
        break;
    }

    return { intersection: intersection.result, distance: distance };
}
function worldUnitsPerPixelPersp(viewport, zoom, viewSpace_Z)
{
    // get vertical field of view in radians
    var fovY = 2 * Math.atan2(1, zoom);

    // get horizontal field of view in radians
    var fovX = 2 * Math.atan(viewport.width / viewport.height * Math.tan(fovY / 2));

    // determine the width of the visible portion of the x axis on the 
    // clipping plane at viewSpace_Z
    var clipPlaneWidth  = Math.tan(fovX / 2) * viewSpace_Z * 2;

    // determine the height of the visible portion of the y axis on the
    // clipping plane at viewSpace_Z
    var clipPlaneHeight  = Math.tan(fovY / 2) * viewSpace_Z * 2;

    // determine the per-pixel clipPlaneWidth and clipPlaneHeight
    var x = clipPlaneWidth  / viewport.width;
    var y = clipPlaneHeight / viewport.height;
    
    return { x: x, y: y };
}

function worldUnitsPerPixelOrtho(viewport, width)
{
    // calculate height
    var height = width * (viewport.height / viewport.width);

    // determine the per-pixel width and height
    var x = width  / viewport.width;
    var y = height / viewport.height;
    
    return { x: x, y: y };
}

function toScreenSpace(world, view, proj, viewport)
{
    // transform to view space
    var screen = view.transformw(world.x, world.y, world.z, 1);

    // transform to projection space
	screen = proj.transformw(screen.x, screen.y, screen.z, screen.w);

    if (screen.w == 0)
    {
        return { x: -Infinity, y: -Infinity, z: -Infinity };
    }

    // normalize to [-1, 1]
    // (if x or y is outside the range (-w, w), the screen coordinate(s) will be 
    // outside the viewport
    screen.x /= screen.w;
    screen.y /= screen.w;
    //screen.z /= screen.w;

    // clip to viewport
    screen.x = viewport.x + viewport.width  - ((-screen.x + 1) * viewport.width  / 2);
    screen.y = viewport.y + viewport.height - (( screen.y + 1) * viewport.height / 2);
	screen.z = 0;
	
	return { x: screen.x, y: screen.y, z: screen.z };    
} 
RasterComponent.prototype = new ParentableMotionElement();
RasterComponent.prototype.constructor = RasterComponent;

function RasterComponent()
{
    ParentableMotionElement.call(this);
    this.className = "RasterComponent";
    this.attrType = eAttrType.RasterComponent;

    this.rcEventListener = null;

    this.opacity = new NumberAttr(1);				// opaque
    this.anchor = new Vector2DAttr(0, 0);			// 0, 0
    this.origin = new StringAttr("bottomLeft");		// bottom-left
    this.show = new BooleanAttr(true);				// true
    this.selectable = new BooleanAttr(true);		// true
    this.cullable = new BooleanAttr(true);			// true
    this.clampToViewport = new BooleanAttr(false);	// false
    this.rasterPosition = new Vector3DAttr();
    this.inspectionOffset = new Vector3DAttr();
    this.componentRect = new RectAttr();
    this.screenRect = new RectAttr();

    this.stylesMap.size.addModifiedCB(RasterComponent_StylesMapSizeModifiedCB, this);
    this.show.addModifiedCB(RasterComponent_ShowModifiedCB, this);

    this.registerAttribute(this.opacity, "opacity");
    this.registerAttribute(this.anchor, "anchor");
    this.registerAttribute(this.origin, "origin");
    this.registerAttribute(this.show, "show");
    this.registerAttribute(this.selectable, "selectable");
    this.registerAttribute(this.cullable, "cullable");
    this.registerAttribute(this.rasterPosition, "rasterPosition");
    this.registerAttribute(this.inspectionOffset, "inspectionOffset");
    this.registerAttribute(this.clampToViewport, "clampToViewport");
    this.registerAttribute(this.componentRect, "componentRect");
    this.registerAttribute(this.screenRect, "screenRect");

    this.renderSequenceSlot.setValueDirect(0xffff);
}

RasterComponent.prototype.setRegistry = function(registry)
{
    var bworks = registry.find("Bridgeworks");
    if (bworks)
    {
        this.rcEventListener = bworks.rasterComponentEventListener;
        if (this.rcEventListener)
        {
            this.rcEventListener.registerComponent(this); // TODO: unable to unregister without dtor
            this.rcEventListener.Listen(this);
        }
    }

    ParentableMotionElement.prototype.setRegistry.call(this, registry);
}

RasterComponent.prototype.isSelected = function(x, y)
{
    var show = this.show.getValueDirect();
    if (show)
    {
        if (this.screenRect.containsPoint(x, y))
        {
            return true;
        }
    }

    return false;
}

RasterComponent.prototype.stylesMapSizeModified = function()
{
    var size = this.stylesMap.Size();
    for (var i = 0; i < size; i++)
    {
        var styleMap = this.stylesMap.getAt(i);
        if (styleMap)
        {
            // add modified CBs for styles map elements' events (remove first to eliminate duplicates)
            styleMap.event.removeModifiedCB(RasterComponent_StylesMapElementEventModifiedCB, this);
            styleMap.event.addModifiedCB(RasterComponent_StylesMapElementEventModifiedCB, this);
            // invoke CB now for stylesMap that are set by reference
            RasterComponent_StylesMapElementEventModifiedCB(styleMap.event, this);
        }
    }
}

RasterComponent.prototype.stylesMapElementEventModified = function(eventName)
{
    this.rcEventListener.listenEvent(this, eEventNameMap[eventName]);
}

RasterComponent.prototype.showModified = function()
{
}

function RasterComponent_StylesMapSizeModifiedCB(attribute, container)
{
    container.stylesMapSizeModified();
}

function RasterComponent_StylesMapElementEventModifiedCB(attribute, container)
{
    container.stylesMapElementEventModified(attribute.getValueDirect().join(""));
}

function RasterComponent_ShowModifiedCB(attribute, container)
{
    container.showModified();
}
Label.prototype = new RasterComponent();
Label.prototype.constructor = Label;

function Label()
{
    RasterComponent.call(this);
    this.className = "Label";
    this.attrType = eAttrType.Label;

    this.iconRect = new Rect(0, 0, 0, 0);
    this.labelRect = new Rect(0, 0, 0, 0);

    this.text = new StringAttr("");
    this.description = new StringAttr("");
    this.depthShadingEnabled = new BooleanAttr(true);
    this.labelStyle = new LabelStyleAttr();
    this.iconStyle = new IconStyleAttr();
    this.balloonTipLabelStyle = new BalloonTipLabelStyleAttr();

    this.text.addModifiedCB(Label_TextModifiedCB, this);
    this.description.addModifiedCB(Label_DescriptionModifiedCB, this);
    this.labelStyle.backgroundColor.addModifiedCB(Label_LabelStyleBackgroundColorModifiedCB, this);
    this.labelStyle.backgroundOpacity.addModifiedCB(Label_LabelStyleBackgroundOpacityModifiedCB, this);
    this.labelStyle.fontStyle.borderColor.addModifiedCB(Label_LabelStyleFontBorderModifiedCB, this);
    this.labelStyle.fontStyle.borderWidth.addModifiedCB(Label_LabelStyleFontBorderModifiedCB, this);
    this.labelStyle.fontStyle.color.addModifiedCB(Label_LabelStyleFontStyleColorModifiedCB, this);
    this.labelStyle.fontStyle.font.addModifiedCB(Label_LabelStyleFontStyleFontModifiedCB, this);
    this.labelStyle.fontStyle.opacity.addModifiedCB(Label_LabelStyleFontStyleOpacityModifiedCB, this);
    this.labelStyle.fontStyle.size.addModifiedCB(Label_LabelStyleFontStyleSizeModifiedCB, this);
    this.labelStyle.fontStyle.style.addModifiedCB(Label_LabelStyleFontStyleStyleModifiedCB, this);
    this.labelStyle.format.addModifiedCB(Label_LabelStyleFormatModifiedCB, this);
    this.labelStyle.padding.addModifiedCB(Label_LabelStylePaddingModifiedCB, this);
    this.iconStyle.url.addModifiedCB(Label_IconStyleUrlModifiedCB, this);
    this.balloonTipLabelStyle.addModifiedCB(Label_BalloonTipLabelStyleModifiedCB, this);

    this.registerAttribute(this.text, "text");
    this.registerAttribute(this.description, "description");
    this.registerAttribute(this.depthShadingEnabled, "depthShadingEnabled");
    this.registerAttribute(this.labelStyle, "labelStyle");
    this.registerAttribute(this.iconStyle, "iconStyle");
    this.registerAttribute(this.balloonTipLabelStyle, "balloonTipLabelStyle");

    this.styles.registerStyle(this.iconStyle, "iconStyle");
    this.styles.registerStyle(this.labelStyle, "labelStyle");
    this.styles.registerStyle(this.balloonTipLabelStyle, "balloonTipLabelStyle");
}

Label.prototype.setGraphMgr = function(graphMgr)
{
    // call base-class implementation
    RasterComponent.prototype.setGraphMgr.call(this, graphMgr);

    // create id
    this.id = "Label" + this.graphMgr.getNextLabelIndex();
    this.labelId = this.id + "_label";
    this.iconId = this.id + "_icon";

    // create html div for canvas overlay
    var htmlLabel = CreateHTMLLabel(this.id, this.labelId, this.iconId);
    this.htmlLabel = htmlLabel.label;
    this.htmlIconImg = htmlLabel.iconImg;
    this.htmlIconDiv = htmlLabel.iconDiv;

    // initialize base dimensions of icon (used for scaling)
    this.htmlIconImg.baseWidth = 0;
    this.htmlIconImg.baseHeight = 0;

    // set initial style
    Label_LabelStyleBackgroundColorModifiedCB(this.labelStyle.backgroundColor, this);
    Label_LabelStyleBackgroundOpacityModifiedCB(this.labelStyle.backgroundOpacity, this);
    Label_LabelStyleFontBorderModifiedCB(null, this); // handles borderColor and borderWidth
    Label_LabelStyleFontStyleColorModifiedCB(this.labelStyle.fontStyle.color, this);
    Label_LabelStyleFontStyleFontModifiedCB(this.labelStyle.fontStyle.font, this);
    Label_LabelStyleFontStyleOpacityModifiedCB(this.labelStyle.fontStyle.opacity, this);
    Label_LabelStyleFontStyleSizeModifiedCB(this.labelStyle.fontStyle.size, this);
    Label_LabelStyleFontStyleStyleModifiedCB(this.labelStyle.fontStyle.style, this);
    Label_LabelStyleFormatModifiedCB(this.labelStyle.format, this);
    Label_LabelStylePaddingModifiedCB(this.labelStyle.padding, this);
    Label_IconStyleUrlModifiedCB(this.iconStyle.url, this);
}

Label.prototype.update = function(params, visitChildren)
{
    // update icon scale
    // (necessary because dimensions are not available until image is actually loaded)
    this.updateIconScale();
    
    // call base-class implementation
    RasterComponent.prototype.update.call(this, params, visitChildren);
}

Label.prototype.updateIconScale = function()
{
    var scale = this.iconStyle.scale.getValueDirect();

    // obtain original dimensions
    if (this.htmlIconImg.baseWidth == 0)
    {
        this.htmlIconImg.baseWidth = this.htmlIconImg.offsetWidth;
        this.htmlIconImg.baseHeight = this.htmlIconImg.offsetHeight;
    }

    // scale
    if (this.htmlIconImg.baseWidth)
    {
        this.htmlIconImg.width = this.htmlIconImg.baseWidth * scale.x;
        this.htmlIconImg.height = this.htmlIconImg.baseHeight * scale.y;
    }
}

Label.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        RasterComponent.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    switch (directive)
    {
        case "render":
            {
                this.draw(params.viewport);
            }
            break;

        case "rayPick":
            {
                if (this.selectable.getValueDirect() == true &&
                        this.show.getValueDirect() == true)
                {
                    if (this.isSelected(params.clickPoint.x, params.clickPoint.y))
                    {
                        var intersectRecord = new RayIntersectRecord();
                        intersectRecord.distance = 0;

                        params.currentNodePath.push(this);
                        params.directive.addPickRecord(new RayPickRecord(params.currentNodePath, intersectRecord, params.camera));
                        params.currentNodePath.pop();
                    }
                }
            }
            break;
    }

    // call base-class implementation
    RasterComponent.prototype.apply.call(this, directive, params, visitChildren);
}

Label.prototype.draw = function(viewport)
{
    var bworks = this.registry.find("Bridgeworks");

    // show
    if (this.show.getValueDirect() == false)
    {
        this.htmlLabel.style.visibility = "hidden";
        this.htmlIconImg.style.visibility = "hidden";
        return;
    }

    this.htmlLabel.style.visibility = "visible";
    this.htmlIconImg.style.visibility = "visible";

    // update visibility with respect to color/opacity
    if (this.labelStyle.fontStyle.opacity.getValueDirect() == 0)
    {
        this.htmlLabel.style.visibility = "hidden";
    }
    var iconColor = this.iconStyle.color.getValueDirect();
    if (iconColor.a == 0 || this.iconStyle.opacity.getValueDirect() == 0)
    {
        this.htmlIconImg.style.visibility = "hidden";
    }

    // determine the rendering positions
    var positions = this.getRenderingPositions();

    var labelWidth = this.htmlLabel.offsetWidth; // * this.htmlLabel.style.zoom;
    var labelHeight = this.htmlLabel.offsetHeight; // * this.htmlLabel.style.zoom;
    var iconWidth = this.htmlIconImg.offsetWidth;
    var iconHeight = this.htmlIconImg.offsetHeight;

    // determine if label is fully contained within viewport
    if (positions.labelX < 0 ||
        positions.labelY < 0 ||
        positions.labelX + labelWidth > bworks.canvas.width ||
        positions.labelY + labelHeight > bworks.canvas.height)
    {
        this.htmlLabel.style.visibility = "hidden";
    }

    // determine if icon is fully contained within viewport
    if (positions.iconX < 0 ||
        positions.iconY < 0 ||
        positions.iconX + iconWidth > bworks.canvas.width ||
        positions.iconY + iconHeight > bworks.canvas.height)
    {
        this.htmlIconImg.style.visibility = "hidden";
    }

    // update positions if visible
    if (this.htmlLabel.style.visibility == "visible")
    {
        this.htmlLabel.style.left = bworks.canvas.offsetLeft + positions.labelX;
        this.htmlLabel.style.top = bworks.canvas.offsetTop + positions.labelY;

        this.labelRect.load(bworks.canvas.offsetLeft + positions.labelX,
                bworks.canvas.offsetTop + positions.labelY,
                this.labelRect.left + labelWidth,
                this.labelRect.top + labelHeight);
    }
    else
    {
        this.labelRect.load(0, 0, 0, 0);
    }
    if (this.htmlIconImg.style.visibility == "visible")
    {
        this.htmlIconDiv.style.left = bworks.canvas.offsetLeft + positions.iconX;
        this.htmlIconDiv.style.top = bworks.canvas.offsetTop + positions.iconY;

        this.iconRect.load(bworks.canvas.offsetLeft + positions.iconX,
                bworks.canvas.offsetTop + positions.iconY,
                this.iconRect.left + iconWidth,
                this.iconRect.top + iconHeight);
    }
    else
    {
        this.iconRect.load(0, 0, 0, 0);
    }

    // update screen rect
    var screenRect = new Rect(0, 0, 0, 0);
    if (this.htmlLabel.style.visibility == "visible" &&
            this.htmlIconImg.style.visibility == "visible")
    {
        screenRect.left = Math.min(this.labelRect.left, this.iconRect.left);
        screenRect.top = Math.min(this.labelRect.top, this.iconRect.top);
        screenRect.right = Math.max(this.labelRect.right, this.iconRect.right);
        screenRect.bottom = Math.max(this.labelRect.bottom, this.iconRect.bottom);
    }
    else if (this.htmlLabel.style.visibility == "visible")
    {
        screenRect.loadRect(this.labelRect);
    }
    else if (this.htmlIconImg.style.visibility == "visible")
    {
        screenRect.loadRect(this.iconRect);
    }
    this.screenRect.setValueDirect(screenRect);
}

Label.prototype.getRenderingPositions = function()
{
    // initialize
    var labelX = 0;
    var labelY = 0;
    var iconX = 0;
    var iconY = 0;

    // get screen position
    var screen = this.screenPosition.getValueDirect();

    // get anchor position
    var anchor = this.anchor.getValueDirect();

    // get label offset
    var offset = this.labelStyle.offset.getValueDirect();

    if (this.htmlIconImg.offsetWidth > 0 &&
            this.htmlLabel.offsetWidth > 0) // icon and label present
    {
        var labelWidth = this.htmlLabel.offsetWidth;// * this.htmlLabel.style.zoom;
        var labelHeight = this.htmlLabel.offsetHeight;// * this.htmlLabel.style.zoom;
        var iconWidth = this.htmlIconImg.offsetWidth;
        var iconHeight = this.htmlIconImg.offsetHeight;

        // measure from origin
        if (this.origin.getValueDirect().join("") == "bottomLeft")
        {
            anchor.y = iconHeight - anchor.y;
        }

        // 
        iconX = screen.x - anchor.x;
        iconY = screen.y - anchor.y;
        labelX = iconX + offset.x;
        labelY = iconY + offset.y;

        // adjust according to alignment
        switch (this.labelStyle.textAlign.getValueDirect().join(""))
        {
            case "topLeft":
                labelX -= labelWidth;
                labelY -= labelHeight / 2;
                break;

            case "middleLeft":
                labelX -= labelWidth;
                labelY += iconHeight / 2 - labelHeight / 2;
                break;

            case "bottomLeft":
                labelX -= labelWidth;
                labelY += iconHeight - labelHeight / 2;
                break;

            case "topCenter":
                labelX += iconWidth / 2 - labelWidth / 2;
                labelY -= labelHeight;
                break;

            case "middleCenter":
                labelX += iconWidth / 2 - labelWidth / 2;
                labelY += iconHeight / 2 - labelHeight / 2;
                break;

            case "bottomCenter":
                labelX += iconWidth / 2 - labelWidth / 2;
                labelY += iconHeight;
                break;

            case "topRight":
                labelX += iconWidth;
                labelY -= labelHeight / 2;
                break;

            case "bottomRight":
                labelX += iconWidth;
                labelY += iconHeight - labelHeight / 2;
                break;

            case "middleRight": // default
            default:
                labelX += iconWidth;
                labelY += iconHeight / 2 - labelHeight / 2;
                break;
        }
    }
    else if (this.htmlLabel.offsetWidth > 0)
    {
        var labelWidth = this.htmlLabel.offsetWidth;// * this.htmlLabel.style.zoom;
        var labelHeight = this.htmlLabel.offsetHeight;// * this.htmlLabel.style.zoom;

        // 
        labelX = screen.x + anchor.x + offset.x;
        labelY = screen.y - anchor.y + offset.y;

        // adjust according to alignment
        switch (this.labelStyle.textAlign.getValueDirect().join(""))
        {
            case "topLeft":
                labelX -= labelWidth;
                labelY -= labelHeight;
                break;

            case "middleLeft":
                labelX -= labelWidth;
                labelY -= labelHeight / 2;
                break;

            case "bottomLeft":
                labelX -= labelWidth;
                break;

            case "topCenter":
                labelX -= labelWidth / 2;
                labelY -= labelHeight;
                break;

            case "middleCenter":
                labelX -= labelWidth / 2;
                labelY -= labelHeight / 2;
                break;

            case "bottomCenter":
                labelX -= labelWidth / 2;
                break;

            case "topRight":
                labelY -= labelHeight;
                break;

            case "bottomRight":
                break;

            case "middleRight": // default
            default:
                labelY -= labelHeight / 2;
                break;
        }
    }
    else // only icon present
    {
        var iconWidth = this.htmlIconImg.offsetWidth;
        var iconHeight = this.htmlIconImg.offsetHeight;

        // measure from bottom left
        anchor.y = iconHeight - anchor.y;

        iconX = screen.x - anchor.x;
        iconY = screen.y - anchor.y;
    }

    return {labelX: labelX, labelY: labelY, iconX: iconX, iconY: iconY};
}

Label.prototype.eventPerformed = function(event)
{
    if (!(this.show.getValueDirect()))
    {
        return false;
    }

    var selected = this.isSelected(event.x, event.y);

    return selected;
}

Label.prototype.labelStyleFontBorderModified = function()
{
    var color = this.labelStyle.fontStyle.borderColor.getValueDirect();
    color.a *= this.labelStyle.fontStyle.opacity.getValueDirect();
    var width = this.labelStyle.fontStyle.borderWidth.getValueDirect();

    var shadow = "";
    for (var i = 0; i < color.a; i += 0.2)
    {
        if (i > 0)
            shadow += ", ";

        shadow += "rgba(" + color.r * 255 + ","
                + color.g * 255 + ","
                + color.b * 255 + ","
                + color.a + ")" + " 0px 0px " + width * 2 + "px";
    }

    this.htmlLabel.style.textShadow = shadow;
}

function CreateHTMLLabel(id, labelId, iconId)
{
    var newDiv = null;
    var newLabel = null;
    var newIconImg = null;
    var newIconDiv = null;

    // Needs further refactoring. Currently set in an app Helper
    // because we don't have container scope here to append these elements
    if (bridgeworks.rasterComponents)
    {
        // containing div
        newDiv = document.createElement("div");
        if (newDiv)
        {
            newDiv.setAttribute("id", id);

            // label
            newLabel = document.createElement("span");
            if (newLabel)
            {
                newLabel.setAttribute("id", labelId);
                newLabel.setAttribute("class", "labelText");
                newLabel.style.visibility = "hidden";
                newLabel.style.position = "absolute";
                newLabel.style.zIndex = 3;
                //newLabel.style.zoom = 1;//.95;
                newLabel.onmousedown = function() { /*onMouseDown();*/
                };
                newLabel.onmouseup = function() { /*onMouseUp();*/
                };
                newLabel.onmousemove = function() { /*onMouseMove();*/
                };
                // disable selection
                newLabel.onselectstart = new Function("return false");

                newDiv.appendChild(newLabel);
            }

            // icon
            newIconDiv = document.createElement("div");
            if (newIconDiv)
            {
                newIconDiv.setAttribute("id", iconId);
                newIconDiv.style.position = "absolute";
                newIconDiv.style.zIndex = 3;

                newIconImg = document.createElement("img");
                if (newIconImg)
                {
                    newIconImg.setAttribute("class", "labelIcon");
                    newIconImg.style.visibility = "hidden";
                    newIconImg.src = "BwContent/images/1x1.png";
                    //newIconImg.onmousedown = function(){onMouseDown();};
                    newIconImg.onmouseup = function() { /*onMouseUp();*/
                    };
                    newIconImg.onmousemove = function() { /*onMouseMove();*/
                    };
                    // disable selection
                    newIconImg.onmousedown = function() {
                        return false;
                    };

                    newIconDiv.appendChild(newIconImg);
                }
                newDiv.appendChild(newIconDiv);
            }

            bridgeworks.rasterComponents.appendChild(newDiv);
        }
    }

    return {div: newDiv, label: newLabel, iconDiv: newIconDiv, iconImg: newIconImg};
}

function Label_TextModifiedCB(attribute, container)
{
    container.htmlLabel.innerHTML = attribute.getValueDirect().join("");
}

function Label_DescriptionModifiedCB(attribute, container)
{
    var description = attribute.getValueDirect().join("");
    if (description.length > 0)
    {
        // desired dimensions; if 0, use 50% canvas size
        var width = container.balloonTipLabelStyle.htmlLabelStyle.width.getValueDirect();
        var height = container.balloonTipLabelStyle.htmlLabelStyle.height.getValueDirect();
        if (width == 0 || height == 0)
        {
            var viewportMgr = container.registry.find("ViewportMgr");
            if (width == 0)
                width = viewportMgr.getAttribute("width").getValueDirect() * 0.5;
            if (height == 0)
                height = viewportMgr.getAttribute("height").getValueDirect() * 0.5;
        }

        var id = '#' + container.iconId;
        description = "<div class='gmap' style='" +
                "width:" + (width + 12) + "px;" + // (+ 12 accounts for close button)
                "height:12px;'>" +
                "<a href='javascript:void($(\"" +
                id +
                "\").btOff());'><img src='libs/jquery/bt/close.gif' alt='close' width='12' height='12' class='gmap-close' /></a> " +
                "</div>" +
                "<div style='" +
                "width:" + (width + 12) + "px;" + // (+ 12 accounts for close button)
                "height:" + height + "px;" +
                "overflow:auto;'>" +
                description +
                "</div>";

        var bgColor = container.balloonTipLabelStyle.bgColor.getValueDirect();
        var fill = "rgba(" + bgColor.r * 255 + ","
                + bgColor.g * 255 + ","
                + bgColor.b * 255 + ","
                + bgColor.a * 255 + ")";

        $(id).bt(description, {trigger: 'click',
            width: width + 12 + "px", // (+ 12 accounts for close button)
            height: height + 12 + "px", // (+ 12 accounts for close button)
            shrinkToFit: ((width == 0 && height == 0) ? true : false),
            centerPointX: .9,
            spikeLength: container.balloonTipLabelStyle.balloonOffset.getValueDirect(),
            spikeGirth: 30,
            padding: 15,
            cornerRadius: 25,
            fill: fill,
            strokeStyle: '#ABABAB',
            strokeWidth: 1,
            shadow: true,
            shadowOffsetX: 3,
            shadowOffsetY: 3,
            shadowBlur: 8,
            shadowColor: 'rgba(0,0,0,.9)',
            shadowOverlap: false,
            noShadowOpts: {strokeStyle: '#999', strokeWidth: 2}});
    }
    else
    {
        var id = '#' + container.iconId;
        $(id).bt("", {trigger: 'click'});
    }
}

function Label_LabelStyleBackgroundColorModifiedCB(attribute, container)
{
    var color = attribute.getValueDirect();
    color.a *= attribute.getContainer().getAttribute("backgroundOpacity").getValueDirect();
    container.htmlLabel.style.backgroundColor = "rgba(" + color.r * 255 + ","
            + color.g * 255 + ","
            + color.b * 255 + ","
            + color.a + ")";
}

function Label_LabelStyleBackgroundOpacityModifiedCB(attribute, container)
{
    Label_LabelStyleBackgroundColorModifiedCB(container.labelStyle.backgroundColor, container);
}

function Label_LabelStyleFontBorderModifiedCB(attribute, container)
{
    container.labelStyleFontBorderModified();
}

function Label_LabelStyleFontStyleColorModifiedCB(attribute, container)
{
    var color = attribute.getValueDirect();
    color.a *= attribute.getContainer().getAttribute("opacity").getValueDirect();
    container.htmlLabel.style.color = "rgba(" + color.r * 255 + ","
            + color.g * 255 + ","
            + color.b * 255 + ","
            + color.a + ")";
}

function Label_LabelStyleFontStyleFontModifiedCB(attribute, container)
{
    container.htmlLabel.style.fontFamily = attribute.getValueDirect().join("");
}

function Label_LabelStyleFontStyleOpacityModifiedCB(attribute, container)
{
    Label_LabelStyleFontStyleColorModifiedCB(container.labelStyle.fontStyle.color, container);
    Label_LabelStyleFontBorderModifiedCB(null, container);
}

function Label_LabelStyleFontStyleSizeModifiedCB(attribute, container)
{
    container.htmlLabel.style.fontSize = attribute.getValueDirect() + "pt";
}

function Label_LabelStyleFontStyleStyleModifiedCB(attribute, container)
{
    switch (attribute.getValueDirect().join(""))
    {
        case "Bold":
            container.htmlLabel.style.fontWeight = "bold";
            break;

        case "Heavy":
            container.htmlLabel.style.fontWeight = "bolder";
            break;

        case "Normal":
            container.htmlLabel.style.fontWeight = "normal";
            break;

        case "Thin":
            container.htmlLabel.style.fontWeight = "lighter";
            break;
    }
}

function Label_LabelStyleFormatModifiedCB(attribute, container)
{
    var format = attribute.getValueDirect().join("");
    //container.htmlLabel.style.setProperty("textAlign", format, "normal");
    // TODO
}

function Label_LabelStylePaddingModifiedCB(attribute, container)
{
    var padding = attribute.getValueDirect() + "px";
    container.htmlLabel.style.paddingLeft = padding;
    container.htmlLabel.style.paddingRight = padding;
    container.htmlLabel.style.paddingTop = padding;
    container.htmlLabel.style.paddingBottom = padding;
}

function Label_IconStyleUrlModifiedCB(attribute, container)
{
    var url = attribute.getValueDirect().join("");
    switch (url)
    {
        case "":
            //container.htmlIconImg.src = null;
            break;

        default:
            container.htmlIconImg.src = document.location.href + "/../BwContent/" + url;
            break;
    }
}

function Label_BalloonTipLabelStyleModifiedCB(attribute, container)
{
    Label_DescriptionModifiedCB(container.description, container);
}
BalloonTipLabel.prototype = new RasterComponent();
BalloonTipLabel.prototype.constructor = BalloonTipLabel;

function BalloonTipLabel()
{
    RasterComponent.call(this);
    this.className = "BallonTipLabel";
    this.attrType = eAttrType.BalloonTipLabel;
    
    this.qtip = null;
    this.qtip_api = null;
    
    this.labelRect = new Rect(0, 0, 0, 0);
    
    this.balloonTipLabelStyle = new BalloonTipLabelStyleAttr();
    this.labelWidth = new NumberAttr(0);
    this.labelHeight = new NumberAttr(0);
    
    this.balloonTipLabelStyle.bgColor.addModifiedCB(BalloonTipLabel_balloonTipLabelStyleBgColorModifiedCB, this);
    this.balloonTipLabelStyle.htmlLabelStyle.addModifiedCB(BalloonTipLabel_BalloonTipLabelStyleHTMLLabelStyleModifiedCB, this);
    this.balloonTipLabelStyle.displayMode.addModifiedCB(BalloonTipLabel_balloonTipLabelStyleDisplayModeModifiedCB, this);
    this.show.addModifiedCB(BalloonTipLabel_showModifiedCB, this);
    this.renderSequenceSlot.addModifiedCB(BalloonTipLabel_renderSequenceSlotModifiedCB, this);

    this.registerAttribute(this.balloonTipLabelStyle, "balloonTipLabelStyle");
    this.registerAttribute(this.labelWidth, "labelWidth");
    this.registerAttribute(this.labelHeight, "labelHeight");
    
    this.styles.registerStyle(this.balloonTipLabelStyle, "balloonTipLabelStyle");
}

BalloonTipLabel.prototype.setGraphMgr = function(graphMgr)
{
    // call base-class implementation
    RasterComponent.prototype.setGraphMgr.call(this, graphMgr);
    
    // create id
    this.id = "BalloonTipLabel" + this.graphMgr.getNextBalloonTipLabelIndex();
    
    // create html components for canvas overlay
    var htmlBalloonTipLabel = CreateHTMLBalloonTipLabel(this.id);
    this.htmlBalloonTipLabel = htmlBalloonTipLabel.label;
    this.qtip = htmlBalloonTipLabel.qtip;
    
    // get qtip api 
    this.qtip_api = $('a[id=' + this.id + ']').qtip("api");
}

BalloonTipLabel.prototype.update = function(params, visitChildren)
{
    if (params.userData)
    {
        var updateParams = params.userData;
        if (this.show.getValueDirect())// && (this.updateLabel || isRenderStateModified(updateParams.viewport)))
        {
            this.updateLabel = false;

            //updateLabel(updateParams.viewport);
        }
    }

    // call base-class implementation
    RasterComponent.prototype.update.call(this, params, visitChildren);
}

BalloonTipLabel.prototype.apply = function(directive, params, visitChildren)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        // call base-class implementation
        RasterComponent.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    
    switch (directive)
    {
    case "render":
        {
            this.draw(params.viewport);
        }
        break;
    }
    
    // call base-class implementation
    RasterComponent.prototype.apply.call(this, directive, params, visitChildren);
}

BalloonTipLabel.prototype.updateLabel = function(viewport)
{
}

BalloonTipLabel.prototype.updateLabelDimensions = function(viewport)
{
}

BalloonTipLabel.prototype.updateShowStates = function()
{
}

BalloonTipLabel.prototype.draw = function()
{
    if (!(this.show.getValueDirect()))
    {
        if (this.graphMgr.getCurrentBalloonTipLabel() == this)
        {
            this.graphMgr.setCurrentBalloonTipLabel(null);
        }
        return;
    }
    /*
     // only allow one balloon tip to display at a time (per Ted)
     BalloonTipLabel* currentBTL = this.graphMgr.getCurrentBalloonTipLabel();
     if (currentBTL && currentBTL != this)
     {
     this.show.setValueDirect(false, false);
     return;
     }
     */
    this.graphMgr.setCurrentBalloonTipLabel(this);
    
    var bworks = this.registry.find("Bridgeworks");
    
    // determine the rendering positions
    var positions = this.getRenderingPositions();
    
    var labelWidth = this.htmlBalloonTipLabel.offsetWidth; // * this.htmlLabel.style.zoom;
    var labelHeight = this.htmlBalloonTipLabel.offsetHeight; // * this.htmlLabel.style.zoom;
    
    // update positions if visible
    //if (this.show.getValueDirect())
    {
        this.htmlBalloonTipLabel.style.left = bworks.canvas.offsetLeft + positions.labelX;
        this.htmlBalloonTipLabel.style.top = bworks.canvas.offsetTop + positions.labelY;

        this.labelRect.load(bworks.canvas.offsetLeft + positions.labelX,
                            bworks.canvas.offsetTop + positions.labelY,
                            this.labelRect.left + labelWidth,
                            this.labelRect.top + labelHeight);
        
        if (this.qtip_api)
        {
            this.qtip_api.reposition(null, false); // Reposition without animation
            //this.qtip_api.show();
        }
    }
    //else
    //{
    //    this.labelRect.load(0, 0, 0, 0);
    //}
    
    // update screen rect
    var screenRect = new Rect(0, 0, 0, 0);
    //if (this.show.getValueDirect())
    {
        screenRect.loadRect(this.labelRect);
    }
    this.screenRect.setValueDirect(screenRect);
}

BalloonTipLabel.prototype.getRenderingPositions = function()
{
    // initialize
    var labelX = 0;
    var labelY = 0;
    
    // get screen position
    var screen = this.screenPosition.getValueDirect();
    
    // get anchor position
    var anchor = this.anchor.getValueDirect();
    
    labelX = screen.x + anchor.x;
    labelY = screen.y - anchor.y;
    
    return { labelX: labelX, labelY: labelY };
}

BalloonTipLabel.prototype.eventPerformed = function(event)
{
    if (!(this.show.getValueDirect()))
    {
        return false;
    }

    var selected = this.isSelected(event.x, event.y);

    return selected;
}

BalloonTipLabel.prototype.balloonTipLabelStyleModified = function(update)
{
}

BalloonTipLabel.prototype.balloonTipLabelStyleBgColorModified = function()
{
}

BalloonTipLabel.prototype.balloonTipLabelStyleDisplayModeModified = function(mode)
{
    switch (mode)
    {
        case "default":
        {
            this.show.setValueDirect(true, false);
        }
        break;
        
        case "hide":
        {
            // don't hide if parent has focus
            if (this.motionParent && this.motionParent.getAttribute("hasFocus").getValueDirect() > 0)
            {
                // a bit kludgy for this programmer, but this is nessary to get the "Google Earth"-like behavior [MCB]
                this.hasFocus.setValueDirect(1);
                //DisableInspectionState();
            }
            else
            {
                this.show.setValueDirect(false, false);
            }
        }
        break;
    }
        
    this.setModified();
}

BalloonTipLabel.prototype.balloonTipLabelStyleHtmlLabelStyleModified = function()
{
    // html
    var html = this.balloonTipLabelStyle.htmlLabelStyle.html.getValueDirect().join("");
    
    if (this.qtip_api)
    {
        this.qtip_api.set("content.text", html);
    }
    
    this.setModified();
}

BalloonTipLabel.prototype.renderSequenceSlotModified = function()
{
}

BalloonTipLabel.prototype.showModified = function(show)
{
    if (this.qtip_api)
    {
        if (show)
        {
            this.qtip_api.show();
        }
        else
        {
            this.qtip_api.hide();
        }
    }
}

function CreateHTMLBalloonTipLabel(id)
{
    var newA = null;

    // Needs further refactoring. Currently set in an app Helper
    // because we don't have container scope here to append these elements
    if (bridgeworks.rasterComponents)
    {
        newA = document.createElement("a");
        if (newA)
        {
            newA.setAttribute("id", id);
            //newA.innerHTML = "";
            newA.style.visibility = "hidden";
            newA.style.position = "absolute";

            bridgeworks.rasterComponents.appendChild(newA);
        }
    }

    var id = 'a[id=' + id + ']';
    var qtip = $(id).qtip(
    {
        style:
        {
            classes: 'qtip-bootstrap qtip-rounded qtip-shadow qtip-close'
        },
        content :
        {
            text: '',
            button: true
        },
        //show : true,
        hide:
        {
            event: false
        }
    });
   
    return { label: newA, qtip: qtip };
}

function BalloonTipLabel_balloonTipLabelStyleModifiedCB(attribute, container)
{
    container.balloonTipLabelStyleModified();
}

function BalloonTipLabel_balloonTipLabelStyleBgColorModifiedCB(attribute, container)
{
}

function BalloonTipLabel_balloonTipLabelStyleDisplayModeModifiedCB(attribute, container)
{
    container.balloonTipLabelStyleDisplayModeModified(attribute.getValueDirect().join(""));
}

function BalloonTipLabel_BalloonTipLabelStyleHTMLLabelStyleModifiedCB(attribute, container)
{
    container.balloonTipLabelStyleHtmlLabelStyleModified();
}

function BalloonTipLabel_HTMLLabel_PageDimensionsModifiedCB(attribute, container)
{
}

function BalloonTipLabel_showModifiedCB(attribute, container)
{
    container.showModified(attribute.getValueDirect());
}

function BalloonTipLabel_renderSequenceSlotModifiedCB(attribute, container)
{
}

LineList.prototype = new VertexGeometry();
LineList.prototype.constructor = LineList;

function LineList()
{
    VertexGeometry.call(this);
    this.className = "LineList";
    this.attrType = eAttrType.LineList;
    this.width = 1;
}

LineList.prototype.update = function(params, visitChildren)
{
    if (!this.vertexBuffer)
    {
        this.vertexBuffer = this.graphMgr.renderContext.createVertexBuffer(3);
        this.vertexBuffer.setPrimitiveType(RC_LINES);
    }
    
    // call base-class implementation
    VertexGeometry.prototype.update.call(this, params, visitChildren);
}

LineList.prototype.apply = function(directive, params, visitChildren)
{
    // call base-class impementation
    VertexGeometry.prototype.apply.call(this, directive, params, visitChildren);
}

LineList.prototype.draw = function(dissolve)
{
    // TODO
    
    this.vertexBuffer.draw();
}

LineList.prototype.buildBoundingTree = function()
{
    
}
PointList.prototype = new VertexGeometry();
PointList.prototype.constructor = PointList;

function PointList()
{
    VertexGeometry.call(this);
    this.className = "PointList";
    this.attrType = eAttrType.PointList;
    this.width = 1;
}

PointList.prototype.update = function(params, visitChildren)
{
    if (!this.vertexBuffer)
    {
        this.vertexBuffer = this.graphMgr.renderContext.createVertexBuffer(3);
        this.vertexBuffer.setPrimitiveType(RC_POINTS);
    }
    
    // call base-class implementation
    VertexGeometry.prototype.update.call(this, params, visitChildren);
}

PointList.prototype.apply = function(directive, params, visitChildren)
{
    // call base-class impementation
    VertexGeometry.prototype.apply.call(this, directive, params, visitChildren);
}

PointList.prototype.draw = function(dissolve)
{
    // TODO
    
    this.vertexBuffer.draw();
}

PointList.prototype.buildBoundingTree = function()
{
    
}
/*
======================================================================
range()

Given the value v of a periodic function, returns the equivalent value
v2 in the principal interval [lo, hi].  If i isn't NULL, it receives
the number of wavelengths between v and v2.

   v2 = v - i * (hi - lo)

For example, range( 3 pi, 0, 2 pi, i ) returns pi, with i = 1.
====================================================================== */

function range( v, lo, hi )
{
   var v2, r = hi - lo;

   if ( r == 0.0 ) {
      return { value: lo, i: 0 };
   }

   v2 = v - r * Math.floor(( v - lo ) / r );

   return { value: v2, i: -(Math.floor(( v2 - v ) / r + ( ( v2 > v ) ? 0.5 : -0.5 ))) };
}


/*
======================================================================
hermite()

Calculate the Hermite coefficients.
====================================================================== */

function hermite( t )
{
   var t2, t3;

   t2 = t * t;
   t3 = t * t2;

   var h2 = 3 * t2 - t3 - t3;
   var h1 = 1 - h2;
   var h4 = t3 - t2;
   var h3 = h4 - t2 + t;
   
   return { h1: h1, h2: h2, h3: h3, h4: h4 };
}


/*
======================================================================
bezier()

Interpolate the value of a 1D Bezier curve.
====================================================================== */

function bezier( x0, x1, x2, x3, t )
{
   var a, b, c, t2, t3;

   t2 = t * t;
   t3 = t2 * t;

   c = 3 * ( x1 - x0 );
   b = 3 * ( x2 - x1 ) - c;
   a = x3 - x0 - c - b;

   return a * t3 + b * t2 + c * t + x0;
}


/*
======================================================================
bez2_time()

Find the t for which bezier() returns the input time.  The handle
endpoints of a BEZ2 curve represent the control points, and these have
(time, value) coordinates, so time is used as both a coordinate and a
parameter for this curve type.
====================================================================== */

function bez2_time( x0, x1, x2, x3, time, t0, t1 )
{
   var v, t;

   t = t0 + ( t1 - t0 ) * 0.5;
   v = bezier( x0, x1, x2, x3, t );
   if ( Math.abs( time - v ) > .0001 ) {
      if ( v > time )
         t1 = t;
      else
         t0 = t;
      return bez2_time( x0, x1, x2, x3, time, t0, t1 );
   }
   else
      return t;
}


/*
======================================================================
bez2()

Interpolate the value of a BEZ2 curve.
====================================================================== */

function bez2( key0, key1, time )
{
   var x, y, t, t0 = 0, t1 = 1;

   if ( key0.getShape() == eKeyframeShape_Bezier2D )
      x = key0.getTime() + key0.getParams(2);
   else
      x = key0.getTime() + ( key1.getTime() - key0.getTime() ) / 3;

   t = bez2_time( key0.getTime(), x, key1.getTime() + key1.getParams(0), key1.getTime(),
      time, t0, t1 );

   if ( key0.getShape() == eKeyframeShape_Bezier2D )
      y = key0.getValue() + key0.getParams(3);
   else
      y = key0.getValue() + key0.getParams(1) / 3;

   return bezier( key0.getValue(), y, key1.getParams(1) + key1.getValue(), key1.getValue(), t );
}


/*
======================================================================
outgoing()

Return the outgoing tangent to the curve at key0.  The value returned
for the BEZ2 case is used when extrapolating a linear pre behavior and
when interpolating a non-BEZ2 span.
====================================================================== */

function outgoing( keys, key0, key1, first )
{
   var a, b, d, t, out;

   switch ( key0.getShape() )
   {
      case eKeyframeShape.TCB:
         a = ( 1 - key0.getParams(0) )
           * ( 1 + key0.getParams(1) )
           * ( 1 + key0.getParams(2) );
         b = ( 1 - key0.getParams(0) )
           * ( 1 - key0.getParams(1) )
           * ( 1 - key0.getParams(2) );
         d = key1.getValue() - key0.getValue();

         if ( key0 != first ) {
            t = ( key1.getTime() - key0.getTime() ) / ( key1.getTime() - (keys.prev(key0)).getTime() );
            out = t * ( a * ( key0.getValue() - (keys.prev(key0)).getValue() ) + b * d );
         }
         else
            out = b * d;
         break;

      case eKeyframeShape.Linear:
         d = key1.getValue() - key0.getValue();
         if ( key0 != first ) {
            t = ( key1.getTime() - key0.getTime() ) / ( key1.getTime() - (keys.prev(key0)).getTime() );
            out = t * ( key0.getValue() - (keys.prev(key0)).getValue() + d );
         }
         else
            out = d;
         break;

      case eKeyframeShape.Bezier1D:
         out = key0.getParams(1);
         if ( key0 != first )
            out *= ( key1.getTime() - key0.getTime() ) / ( key1.getTime() - (keys.prev(key0)).getTime() );
         break;

      case eKeyframeShape.Bezier2D:
         out = key0.getParams(3) * ( key1.getTime() - key0.getTime() );
         if ( Math.abs( key0.getParams(2) ) > 1e-5 )
            out /= key0.getParams(2);
         else
            out *= 1e5;
         break;

      case eKeyframeShape.Stepped:
      default:
         out = 0;
         break;
   }

   return out;
}


/*
======================================================================
incoming()

Return the incoming tangent to the curve at key1.  The value returned
for the BEZ2 case is used when extrapolating a linear post behavior.
====================================================================== */

function incoming( keys, key0, key1, last )
{
   var a, b, d, t, _in;

   switch ( key1.getShape() )
   {
      case eKeyframeShape.Linear:
         d = key1.getValue() - key0.getValue();
         if ( key1 != last ) {
            t = ( key1.getTime() - key0.getTime() ) / ( (keys.next(key1)).getTime() - key0.getTime() );
            _in = t * ( (keys.next(key1)).getValue() - key1.getValue() + d );
         }
         else
            _in = d;
         break;

      case eKeyframeShape.TCB:
         a = ( 1 - key1.getParams(0) )
           * ( 1 - key1.getParams(1) )
           * ( 1 + key1.getParams(2) );
         b = ( 1 - key1.getParams(0) )
           * ( 1 + key1.getParams(1) )
           * ( 1 - key1.getParams(2) );
         d = key1.getValue() - key0.getValue();

         if ( key1 != last ) {
            t = ( key1.getTime() - key0.getTime() ) / ( (keys.next(key1)).getTime() - key0.getTime() );
            _in = t * ( b * ( (keys.next(key1)).getValue() - key1.getValue() ) + a * d );
         }
         else
            _in = a * d;
         break;

      case eKeyframeShape.Bezier1D:
         _in = key1.getParams(0);
         if ( key1 != last )
            _in *= ( key1.getTime() - key0.getTime() ) / ( (keys.next(key1)).getTime() - key0.getTime() );
         break;
         return _in;

      case eKeyframeShape.Bezier2D:
         _in = key1.getParams(1) * ( key1.getTime() - key0.getTime() );
         if ( Math.abs( key1.getParams(0) ) > 1e-5 )
            _in /= key1.getParams(0);
         else
            _in *= 1e5;
         break;

      case eKeyframeShape.Stepped:
      default:
         _in = 0;
         break;
   }

   return _in;
}


/*
======================================================================
interpolate()

Given a list of keys and a time number, returns the interpolated 
value at that time.
====================================================================== */

function interpolate(time, keyframes, first, last, preBehavior, postBehavior)
{
    // if no keys, the value is 0
    if (keyframes.length == 0)
    {
        return 0;
    }

    // if only one key, the value is constant
    if (keyframes.length == 1)
    {
        return first.getValue();
    }

    var noff = 0;
    var _in = 0;
    var out = 0;
    var offset = 0;
    var result;

    // use pre-behavior if time is before first key time
    if (time < first.getTime())
    {
        switch (preBehavior)
        {
        case eEndBehavior.Reset:
            return 0;

        case eEndBehavior.Constant:
            return first.getValue();

        case eEndBehavior.Repeat:
            result = range(time, first.getTime(), last.getTime());
            time = result.value;
            break;

        case eEndBehavior.Oscillate:
            result = range(time, first.getTime(), last.getTime());
            time = result.value;
            noff = result.i;
            if (noff % 2)
            {
                time = last.getTime() - first.getTime() - time;
            }
            break;

        case eEndBehavior.OffsetRepeat:
            result = range(time, first.getTime(), last.getTime());
            time = result.value;
            noff = result.i;
            offset = noff * (last.getValue() - first.getValue());
            break;

        case eEndBehavior.Linear:
            out = outgoing(keyframes, first, keyframes.next(first), first) / ((keyframes.next(first)).getTime() - first.getTime());
            return out * (time - first.getTime()) + first.getValue();
        }
    }
    // use post-behavior if time is after last key time
    else if (time > last.getTime())
    {
        switch (postBehavior)
        {
        case eEndBehavior.Reset:
            return 0;

        case eEndBehavior.Constant:
            return last.getValue();

        case eEndBehavior.Repeat:
            result = range(time, first.getTime(), last.getTime());
            time = result.value;
            break;

        case eEndBehavior.Oscillate:
            result = range(time, first.getTime(), last.getTime());
            time = result.value;
            noff = result.i;
            if (noff % 2)
            {
                time = last.getTime() - first.getTime() - time;
            }
            break;

        case eEndBehavior.OffsetRepeat:
            result = range(time, first.getTime(), last.getTime());
            time = result.value;
            noff = result.i;
            offset = noff * (last.getValue() - first.getValue());
            break;

        case eEndBehavior.Linear:
            _in = incoming(keyframes, keyframes.prev(last), last, last) / (last.getTime() - (keyframes.prev(last)).getTime());
            return _in * (time - last.getTime()) + last.getValue();
        }
    }

    // get the endpoints of the interval being evaluated 
    var key0 = first;
    while (keyframes.next(key0) && 
           time > (keyframes.next(key0)).getTime())
    {
        key0 = keyframes.next(key0);
    }
    var key1 = keyframes.next(key0);

    // check for singularities first 
    if (time == (key0).getTime())
    {
       return (key0).getValue() + offset;
    }
    else if (time == (key1).getTime())
    {
       return (key1).getValue() + offset;
    }

    // get interval length, time in [0, 1] 
    var t = (time - (key0).getTime()) / ((key1).getTime() - (key0).getTime());

    // interpolate 
    switch ((key1).getShape())
    {
    case eKeyframeShape.TCB:
    case eKeyframeShape.Bezier1D:
        {
            out = outgoing(keyframes, key0, key1, first);
            _in = incoming(keyframes, key0, key1, last);
            var result = hermite(t);
            return result.h1 * (key0).getValue() + result.h2 * (key1).getValue() + result.h3 * out + result.h4 * _in + offset;
        }

    case eKeyframeShape.Bezier2D:
        return bez2(key0, key1, time) + offset;

    case eKeyframeShape.Linear:
        return (key0).getValue() + t * ((key1).getValue() - (key0).getValue()) + offset;

    case eKeyframeShape.Stepped:
        return (key0).getValue() + offset;

    default:
        return 0;
    }

}
function StateRec()
{
    this.material = null;
    this.renderStateRec = null;
    this.cullBackFace = false;
    this.textures = null;
    this.projectionTextures = null;
    this.globalIllumination = new Color();
}

function GetCurrentState(graphMgr)
{
    var rec = new StateRec();
	
    rec.material = graphMgr.getCurrentMaterial();
    rec.renderStateRec = graphMgr.renderState.getState(RENDERSTATE_ALL_BITS);
    rec.cullBackFace = graphMgr.renderContext.enabled(eRenderMode.CullBackFace);
    rec.textures = graphMgr.textureArrayStack.top();
    rec.projectionTextures = graphMgr.projectionTextureArrayStack.top();
    rec.globalIllumination.copy(graphMgr.renderContext.getGlobalIllumination());
    
    return rec;
}

function SetCurrentState(graphMgr, stateRec)
{
    graphMgr.setCurrentMaterial(stateRec.material);
    graphMgr.renderState.setState(RENDERSTATE_ALL_BITS, stateRec.renderStateRec);
    if (stateRec.cullBackFace)
    {
        graphMgr.renderContext.enable(eRenderMode.CullBackFace);
    }
    else
    {
        graphMgr.renderContext.disable(eRenderMode.CullBackFace);
    }
    graphMgr.textureArrayStack.load(stateRec.textures);
    graphMgr.projectionTextureArrayStack.load(stateRec.projectionTextures);
    graphMgr.renderContext.setGlobalIllumination(stateRec.globalIllumination);
}
function DistanceSortRec(distance,
                         geometry,
                         dissolve)
{
    this.distance = distance || 0;
    this.geometry = geometry || null;
    this.dissolve = dissolve || 0;
    this.stateRec = null;
}

DistanceSortAgent.prototype = new Agent();
DistanceSortAgent.prototype.constructor = DistanceSortAgent;

function DistanceSortAgent()
{
    Agent.call(this);
    this.className = "DistanceSortAgent";

    this.graphMgr = null;
    this.sortRecs = [];
}

DistanceSortAgent.prototype.setGraphMgr = function(graphMgr)
{
    this.graphMgr = graphMgr;
}

DistanceSortAgent.prototype.isEmpty = function()
{
    return this.sortRecs.length == 0;
}

DistanceSortAgent.prototype.addGeometry = function(geometry, min, max, dissolve)
{
    var rec = new DistanceSortRec();

    rec.geometry = geometry;
    rec.dissolve = dissolve;
    rec.stateRec = GetCurrentState(this.graphMgr);

    // calculate distance from camera
    var worldViewMatrix = new Matrix4x4();
    worldViewMatrix.loadMatrix(this.graphMgr.renderContext.worldMatrixStack.top());

    // initialize
    rec.distance = FLT_MAX;

    // take smallest z of worldView-transformed endpoints of the geometry's bbox as distance from camera
    var p;
    for (var i = 0; i < 8; i++)
    {
        switch (i)
        {
            case 0: p = new Vector3D(max.x, max.y, max.z); break;
            case 1: p = new Vector3D(max.x, max.y, min.z); break;
            case 2: p = new Vector3D(max.x, min.y, max.z); break;
            case 3: p = new Vector3D(max.x, min.y, min.z); break;
            case 4: p = new Vector3D(min.x, max.y, max.z); break;
            case 5: p = new Vector3D(min.x, max.y, min.z); break;
            case 6: p = new Vector3D(min.x, min.y, max.z); break;
            case 7: p = new Vector3D(min.x, min.y, min.z); break;
        }

        p = worldViewMatrix.transform(p.x, p.y, p.z, 1);

        rec.distance = Math.min(p.z, rec.distance);
    }

    // add to list
    this.sortRecs.push(rec);
    
}

DistanceSortAgent.prototype.clear = function()
{
    this.sortRecs.length = 0;
}

DistanceSortAgent.prototype.sort = function()
{
    this.sortRecs.sort(DistanceSortAgent_CompareSortRecs);
}

DistanceSortAgent.prototype.draw = function()
{
    if (this.sortRecs.length == 0)
    {
        return;
    }

    // push state
    var saveState = GetCurrentState(this.graphMgr);

    // disable writing to the depth buffer
    // technique described in the OpenGL Programming Guide, 2nd edition, pp. 222-223
    //this.graphMgr.renderContext.disable(eRenderMode.DepthBufferWrite);

    for (var i = 0; i < this.sortRecs.length; i++)
    {
        // set state according to sort rec
        SetCurrentState(this.graphMgr, this.sortRecs[i].stateRec);

        // draw
        this.sortRecs[i].geometry.draw(this.sortRecs[i].dissolve);

        // pop clip plane state
        // NOTE: D3D is having issues with clip plane states when more than 1 sort rec was present
        this.graphMgr.renderState.setState(RENDERSTATE_CLIP_PLANE_BIT, saveState.renderStateRec);
    }

    // restore depth buffer write state
    this.graphMgr.renderContext.enable(eRenderMode.DepthBufferWrite);

    // pop state
    SetCurrentState(this.graphMgr, saveState);
}

function DistanceSortAgent_CompareSortRecs(rec1, rec2)
{
    return rec2.distance - rec1.distance;
}
/// <b>Approximate</b> radius of Earth at the equator (in Km).
/// For a more precise value, use either the Ellipsoid corresponding to a
/// particular datum or calculate the radius for a given latitude using
/// Synder's Formula
/// @see
var EARTH_RADIUS_KM_EQ = 6378;

/// <b>Approximate</b> radius of Earth at the poles (in Km).
var EARTH_RADIUS_KM_P = 6377;

/// Maximum width of a UTM zone (taken to be at equator)
var UTM_ZONE_WIDTH_KM = 667.956; 

// EqualArc projection - Metric
var EQ_ARC_WIDTH_KM       = 40075.16;	// Earth circumference at Equator
var EQ_ARC_HEIGHT_KM      = 40008.0;    // Earth circumference from pole to pole
var EQ_ARC_ONE_DEG_LAT_KM = EQ_ARC_HEIGHT_KM / 360;
var EQ_ARC_ONE_DEG_LON_KM = EQ_ARC_WIDTH_KM / 360;

// EqualArc projection - English
var EQ_ARC_WIDTH_MI       = 24902.0;
var EQ_ARC_HEIGHT_MI      = 24900.0;
var EQ_ARC_ONE_DEG_LAT_MI = EQ_ARC_HEIGHT_MI / 360;
var EQ_ARC_ONE_DEG_LON_MI = EQ_ARC_WIDTH_MI / 360;

MapProjectionCalculator.prototype = new Evaluator();
MapProjectionCalculator.prototype.constructor = MapProjectionCalculator;

function MapProjectionCalculator()
{
    Evaluator.call(this);
    this.className = "MapProjectionCalculator";
    this.attrType = eAttrType.MapProjectionCalculator;

    this.unitsMultiplier = 1;
    this.positionCalculators = [];
    this.geoPositionCalculators = [];
    
    this.mapProjection = new StringAttr("equalArc");
    this.elevationModel = new StringAttr();
    this.center2D = new Vector2DAttr(0, 0);
    this.units = new StringAttr("kilometers");
    this.geoPosition = new Vector3DAttr(0, 0, 0);
    this.pointWorld = new Vector3DAttr();
    this.resultPosition = new Vector3DAttr();
    this.resultGeoPosition = new Vector3DAttr();

    this.units.addModifiedCB(MapProjectionCalculator_UnitsModifiedCB, this);
    this.pointWorld.addModifiedCB(MapProjectionCalculator_PointWorldModifiedCB, this);
    
    this.registerAttribute(this.mapProjection, "mapProjection");
    this.registerAttribute(this.elevationModel, "elevationModel");
    this.registerAttribute(this.center2D, "center2d");
    this.registerAttribute(this.units, "units");
    this.registerAttribute(this.geoPosition, "geoPosition");
    this.registerAttribute(this.geoPosition, "position"); // backward-compatibility
    this.registerAttribute(this.pointWorld, "pointWorld");
    this.registerAttribute(this.resultPosition, "resultPosition");
    this.registerAttribute(this.resultGeoPosition, "resultGeoPosition");
    this.registerAttribute(this.resultGeoPosition, "resultGeoLocation"); // backward-compatibility

    this.positionCalculators["equalArc"] = ComputeEqualArc3DPosition;
    this.geoPositionCalculators["equalArc"] = ComputeEqualArcGeoPosition;

    this.units.setValueDirect("meters"); // invoke modified cb
}

MapProjectionCalculator.prototype.evaluate = function()
{
    var geoPosition = this.geoPosition.getValueDirect();

    var resultPosition = this.computePosition(geoPosition.x, geoPosition.y, geoPosition.z);
    this.resultPosition.setValueDirect(resultPosition.x, resultPosition.y, resultPosition.z);

    var resultGeoPosition = this.computeGeoPosition(resultPosition.x, resultPosition.y, resultPosition.z);
    this.resultGeoPosition.setValueDirect(resultGeoPosition.x, resultGeoPosition.y, resultGeoPosition.z);
}

MapProjectionCalculator.prototype.computePosition = function(lon, alt, lat)
{
    var position = undefined;
    
    var mapProjection = this.mapProjection.getValueDirect().join("");
    var computeFunc = this.positionCalculators[mapProjection];
    if (computeFunc)
    {
        var center2D = this.center2D.getValueDirect();
        position = computeFunc(lon, alt, lat, center2D.x, center2D.y, this.unitsMultiplier);
    }

    return position;
}

MapProjectionCalculator.prototype.computeGeoPosition = function(x, y, z)
{
    var geoPosition = undefined;

    var mapProjection = this.mapProjection.getValueDirect().join("");
    var computeFunc = this.geoPositionCalculators[mapProjection];
    if (computeFunc)
    {
        var center2D = this.center2D.getValueDirect();
        geoPosition = computeFunc(x, y, z, center2D.x, center2D.y, this.unitsMultiplier);
    }

    return geoPosition;
}

function MapProjectionCalculator_UnitsModifiedCB(attribute, container)
{
    switch (attribute.getValueDirect().join(""))
    {
        case "kilometers":
            {
                container.unitsMultiplier = 1;
            }
            break;

        case "meters":
            {
                container.unitsMultiplier = 1000;
            }
            break;
    }
}

function MapProjectionCalculator_PointWorldModifiedCB(attribute, container)
{
    // TODO
}

function ComputeEqualArc3DPosition(lon, alt, lat, centerLon, centerLat, units)
{
    if (lat > 90  || lat < -90 ||
		lon > 180 || lon < -180)
	{
		return undefined;
	}
	
	var x = (lon - centerLon) * EQ_ARC_ONE_DEG_LON_KM * units;
	var y = alt;
	var z = (lat - centerLat) * EQ_ARC_ONE_DEG_LAT_KM * units;

	return { x: x, y: y, z: z }
}

function ComputeEqualArcGeoPosition(x, y, z, centerLon, centerLat, units)
{
	var lon = (x / units / EQ_ARC_ONE_DEG_LON_KM) + centerLon;
	var alt = y;
	var lat = (z / units / EQ_ARC_ONE_DEG_LAT_KM) + centerLat;   
    
    return { lon: lon, alt: alt, lat: lat }
}
NullObject.prototype = new ParentableMotionElement();
NullObject.prototype.constructor = NullObject;

function NullObject()
{
    ParentableMotionElement.call(this);
    this.className = "NullObject";
    this.attrType = eAttrType.NullObject;
}
Transform.prototype = new SGNode();
Transform.prototype.constructor = Transform;

/**
 * Defines a generic matrix transformation.
 *
 * @see GcSGNode
 */
function Transform()
{
    SGNode.call(this);
    this.className = "Transform";
    this.attrType = eAttrType.Transform;
    
    this.matrix = new Matrix4x4Attr
       (1, 0, 0, 0,
        0, 1, 0, 0,
        0, 0, 1, 0,
        0, 0, 0, 1);
        
    this.matrixTransform = this.matrix.getValueDirect();
    this.updateMatrix = true;

    this.matrix.addModifiedCB(Transform_MatrixModifiedCB, this);

    this.registerAttribute(this.matrix, "matrix");
}

Transform.prototype.clone = function(src)
{
    this.matrix = src.matrix.clone();
    this.updateMatrix = src.updateMatrix;
}

Transform.prototype.update = function(params, visitChildren)
{
    if (this.updateMatrix)
    {
        this.updateMatrix = false;

        this.matrixTransform = this.matrix.getValueDirect();
    }
    
    // call base-class implementation
    SGNode.prototype.update.call(this, params, visitChildren);
}

Transform.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled.getValueDirect())
    {
        // call base class implementation
        SGNode.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    
    //params.worldMatrix = params.worldMatrix.leftMultiply(this.matrixTransform);
            
    switch (directive)
    {
        case "render":
        case "shadow":
        {
            params.worldMatrix = this.matrixTransform.multiply(params.worldMatrix);
            this.applyTransform();
        }
        break;
         
        case "rayPick":
        case "bbox":
        case "collide":
        {
            params.worldMatrix = this.matrixTransform.multiply(params.worldMatrix);
        }
        break;
        
        case "highlight":
        {
            params.worldMatrix = this.matrixTransform.multiply(params.worldMatrix);
            
            // apply to last target as well (covers object-inspection)
            if (params.targets.length > 0)
            {
                params.targets[params.targets.length-1].worldMatrix = 
                    this.matrixTransform.multiply(params.targets[params.targets.length-1].worldMatrix);
            }
        }
        break;
        
        default:
            break;
    }

    // call base class implementation
    SGNode.prototype.apply.call(this, directive, params, visitChildren);
}

Transform.prototype.applyTransform = function()
{
    // set transformation matrix
    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
    this.graphMgr.renderContext.leftMultMatrix(this.matrixTransform);
    this.graphMgr.renderContext.applyWorldTransform();
}

function Transform_MatrixModifiedCB(attribute, container)
{
    container.updateMatrix = true;
    container.setModified();
}


QuaternionRotate.prototype = new Transform();
QuaternionRotate.prototype.constructor = QuaternionRotate;

function QuaternionRotate()
{
    Transform.call(this);
    this.className = "QuaternionRotate";
    this.attrType = eAttrType.QuaternionRotate;

    this.rotationQuat = new QuaternionAttr(1, 0, 0, 0);
    this.rotation = new Vector3DAttr(0, 0, 0);
    this.updateRotationQuat = true;

    this.rotationQuat.addModifiedCB(QuaternionRotate_RotationQuatModifiedCB, this);

    this.registerAttribute(this.rotationQuat, "rotationQuat");
    this.registerAttribute(this.rotation, "rotation");
}

QuaternionRotate.prototype.update = function(params, visitChildren)
{
    if (this.updateRotationQuat)
    {
        this.updateRotationQuat = false;

        var q = this.rotationQuat.getValueDirect();

        var matrix = q.getMatrix();
        this.matrix.setValueDirect(matrix);

        var rotation = matrix.getRotationAngles();
        this.rotation.setValueDirect(rotation.x, rotation.y, rotation.z);
        
        //console.debug("QuaternionRotate: rotation " + rotation.x + ", " + 
        //rotation.y + ", " + rotation.z);
    }

    // call base-class implementation
    Transform.prototype.update.call(this, params, visitChildren);
}

QuaternionRotate.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled.getValueDirect())
    {
        // call base-class implementation
        Transform.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }
    /*
    switch (directive)
    {
        case "render":
        {
        }
        break;
         
        case "rayPick":
        {
            
        }
        break;
        
        case "bbox":
        {
            
        }
        break;
        
        case "collide":
        {
        }
        break;
    }
    */
    // call base-class implementation
    Transform.prototype.apply.call(this, directive, params, visitChildren);
}

function QuaternionRotate_RotationQuatModifiedCB(attribute, container)
{
    container.updateRotationQuat = true;
    container.setModified();
}
Rotate.prototype = new Transform();
Rotate.prototype.constructor = Rotate;

function Rotate()
{
    Transform.call(this);
    this.className = "Rotate";
    this.attrType = eAttrType.Rotate;
    
    this.rotation = new Vector3DAttr(0, 0, 0);
    this.updateRotation = true;
    
    this.rotation.addModifiedCB(Rotate_RotationModifiedCB, this);
	
    this.registerAttribute(this.rotation, "rotation");
}

Rotate.prototype.update = function(params, visitChildren)
{
    if (this.updateRotation)
    {
        this.updateRotation = false;

        var r = this.rotation.getValueDirect();

        var matrix = new Matrix4x4()
        matrix.loadXYZAxisRotation(r.x, r.y, r.z);
        this.matrix.setValueDirect(matrix);
    }

    // call base-class implementation
    Transform.prototype.update.call(this, params, visitChildren);
}

Rotate.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled.getValueDirect())
    {
        // call base-class implementation
        Transform.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    // call base-class implementation
    Transform.prototype.apply.call(this, directive, params, visitChildren);
}

function Rotate_RotationModifiedCB(attribute, container)
{
    container.updateRotation = true;
    container.setModified();
}
Scale.prototype = new Transform();
Scale.prototype.constructor = Scale;

function Scale()
{
    Transform.call(this);
    this.className = "Scale";
    this.attrType = eAttrType.Scale;
    
    this.scale = new Vector3DAttr(1, 1, 1);
    this.updateScale = true;
    
    this.scale.addModifiedCB(Scale_ScaleModifiedCB, this);
	
    this.registerAttribute(this.scale, "scale");
}

Scale.prototype.update = function(params, visitChildren)
{
    if (this.updateScale)
    {
        this.updateScale = false;

        var s = this.scale.getValueDirect();

        var matrix = new Matrix4x4();
        matrix.loadScale(s.x, s.y, s.z);
        this.matrix.setValueDirect(matrix);
    }

    // call base-class implementation
    Transform.prototype.update.call(this, params, visitChildren);
}

Scale.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled.getValueDirect())
    {
        // call base-class implementation
        Transform.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    // call base-class implementation
    Transform.prototype.apply.call(this, directive, params, visitChildren);
}

function Scale_ScaleModifiedCB(attribute, container)
{
    container.updateScale = true;
    container.setModified();
}
Translate.prototype = new Transform();
Translate.prototype.constructor = Translate;

function Translate()
{
    Transform.call(this);
    this.className = "Translate";
    this.attrType = eAttrType.Translate;
    
    this.translation = new Vector3DAttr(0, 0, 0);
    this.updateTranslation = true;
    
    this.translation.addModifiedCB(Translate_TranslationModifiedCB, this);
	
    this.registerAttribute(this.translation, "translation");
}

Translate.prototype.update = function(params, visitChildren)
{
    if (this.updateTranslation)
    {
        this.updateTranslation = false;

        var t = this.translation.getValueDirect();

        var matrix = new Matrix4x4();
        matrix.loadTranslation(t.x, t.y, t.z);
        this.matrix.setValueDirect(matrix);
    }

    // call base-class implementation
    Transform.prototype.update.call(this, params, visitChildren);
}

Translate.prototype.apply = function(directive, params, visitChildren)
{
    if (!this.enabled.getValueDirect())
    {
        // call base-class implementation
        Transform.prototype.apply.call(this, directive, params, visitChildren);
        return;
    }

    // call base-class implementation
    Transform.prototype.apply.call(this, directive, params, visitChildren);
}

function Translate_TranslationModifiedCB(attribute, container)
{
    container.updateTranslation = true;
    container.setModified();
}
MultiTargetObserver.prototype = new Evaluator();
MultiTargetObserver.prototype.constructor = MultiTargetObserver;

function MultiTargetObserver()
{
    Evaluator.call(this);
    this.className = "MultiTargetObserver";
    this.attrType = eAttrType.MultiTargetObserver;
    
    this.targetPosition = [];
    
    this.targets = new NumberAttr(0);
    this.position = new Vector3DAttr(0, 0, 0);
    this.distanceFromFirstTarget = new NumberAttr(0);
	this.affectPitch = new BooleanAttr(true);
	this.affectHeading = new BooleanAttr(true);
	this.resultPosition = new Vector3DAttr(0, 0, 0);
    this.resultPitch = new NumberAttr(0);
    this.resultHeading = new NumberAttr(0);

    this.registerAttribute(this.targets, "targets");
    this.registerAttribute(this.position, "position");
    this.registerAttribute(this.distanceFromFirstTarget, "distanceFromFirstTarget");
	this.registerAttribute(this.affectPitch, "affectPitch");
	this.registerAttribute(this.affectHeading, "affectHeading");
    this.registerAttribute(this.resultPosition, "resultPosition");
    this.registerAttribute(this.resultPitch, "resultPitch");
    this.registerAttribute(this.resultHeading, "resultHeading");
}

MultiTargetObserver.prototype.setNumberOfTargets = function(targets)
{
	// if targets are already registered, then unregister them
    var oldTargets = this.targets.getValueDirect();
	if (oldTargets > 0)
	{
		for (var i=0; i < oldTargets; i++)
        {
            this.unregisterAttribute(this.targetPosition[i]);
        }
	}

    this.targets.setValueDirect(targets);

    // allocate dynamic inputs
    if (targets > 0)
    {
        this.targetPosition.length = targets;
        
        for (var i=0; i < targets; i++)
        {
        	this.targetPosition[i] = new Vector3DAttr(0, 0, 0);
			this.registerAttribute(this.targetPosition[i], "targetPosition" + i);
        }
    }
}

MultiTargetObserver.prototype.evaluate = function()
{
    if (!(this.enabled.getValueDirect()))
	{
		return;
	}

    // if no targets, nothing to do
    if (this.targets.getValueDirect() == 0)
    {
        return;
    }

    // get input values

    // get observer and target positions
    var observerAndTarget = this.getObserverAndTargetPositions();
    var observer = observerAndTarget.observer;
    var target = observerAndTarget.target;

    // calculate target direction vector (vector from observer position to target position)
    var targetDirection = new Vector3D(target.x - observer.x,
                               		   target.y - observer.y,
                               		   target.z - observer.z);

    // get heading and pitch angles from target direction vector
    var targetDirHeading, targetDirPitch;
    var hp = XYZtoHP(targetDirection.x, targetDirection.y, targetDirection.z);
    var targetDirHeading = hp.heading;
    var targetDirPitch = hp.pitch;

    var pitch = 0;
	if (this.affectPitch.getValueDirect() == true)
	{
		pitch = -toDegrees(targetDirPitch);
	}

    var heading = 0;
	if (this.affectHeading.getValueDirect() == true)
	{
		heading = -toDegrees(targetDirHeading);
	}

    // output result
    var values = [observer.x, observer.y, observer.z];
    this.resultPosition.setValue(values);

    if (this.affectPitch.getValueDirect() == true)
    {
    	this.resultPitch.setValueDirect(pitch);
    }

    if (this.affectHeading.getValueDirect() == true)
    {
        this.resultHeading.setValueDirect(heading);
    }
}

MultiTargetObserver.prototype.getObserverAndTargetPositions = function()
{
	var observer, target;
	
    switch (this.targets.getValueDirect())
    {
    case 0:
        {
            observer = new Vector3D(0, 0, 0);
            target = new Vector3D(0, 0, 0);
        }
        break;

    case 1:
        {
            observer = this.position.getValueDirect();
            target = this.targetPosition[0].getValueDirect();
        }
        break;

    case 2:
        {
            var target1 = this.targetPosition[0].getValueDirect();
            var target2 = this.targetPosition[1].getValueDirect();

            var distance = this.distanceFromFirstTarget.getValueDirect();

            // get line direction from target2 to target1
            var lineDir = Normalize(target1 - target2);

            // calculate observer's position as target1's position + lineDir scaled by distance
            observer = lineDir * distance + target1;

            // if distance is 0, observer's position will equal target1's position,
            // so use target1 - lineDir as target's position
            if (distance == 0)
            {
                target = target1 - lineDir;
            }
            else
            {
                target = target1;
            }
        }
        break;

    default: // > 2 targets (currently unsupported)
        {
            observer = new Vector3D(0, 0, 0);
            target = Vector3D(0, 0, 0);
        }
        break;
    }
    
    return { observer: observer, target: target };
}
SerializeParams.prototype = new DirectiveParams();
SerializeParams.prototype.constructor = SerializeParams();

function SerializeParams()
{
    DirectiveParams.call(this);
    
    this.serialized = null;
}

SerializeDirective.prototype = new SGDirective();
SerializeDirective.prototype.constructor = SerializeDirective;

function SerializeDirective()
{
    SGDirective.call(this);
    
    this.className = "SerializeDirective";
    this.attrType = eAttrType.SerializeDirective;

    this.serialized = null;
}

SerializeDirective.prototype.execute = function(root)
{
    if (!root)
    {
		return;
	}

    // clear serialize string
    this.serialized = null;

    // setup serialize params structure
    var params = new SerializeParams();
    params.serialized = new String();

    // apply serialize directive
    root.apply("serialize", params, true);

	this.serialized = params.serialized;

    return;
}


var MAX_SEE_AHEAD = 2;

CollideParams.prototype = new DirectiveParams();
CollideParams.prototype.constructor = CollideParams();

function CollideParams()
{
    DirectiveParams.call(this);

    this.viewSpace = false;
    this.viewMatrix = new Matrix4x4();
    this.worldMatrix = new Matrix4x4();
    this.detectCollisions = new Array();
}

function CollideRec(model, tree, worldMatrix)
{
    this.model = model;
    this.tree = tree;
    this.worldMatrix = new Matrix4x4();
    this.worldMatrix.loadMatrix(worldMatrix);
}

CollideDirective.prototype = new SGDirective();
CollideDirective.prototype.constructor = CollideDirective;

function CollideDirective()
{
    SGDirective.call(this);
    this.className = "CollideDirective";
    this.attrType = eAttrType.CollideDirective;

    this.name.setValueDirect("CollideDirective");
}

CollideDirective.prototype.setRegistry = function(registry)
{
    // use Bridgeworks' physics simulator for collision detection
    var bworks = registry.find("Bridgeworks");
    this.physicsSimulator = bworks.physicsSimulator;

    // call base-class implementation
    SGDirective.prototype.setRegistry.call(this, registry);
}

CollideDirective.prototype.execute = function(root)
{
    root = root || this.rootNode.getValueDirect();

    // setup collision Detect params structure
    var params = new CollideParams();

    // get list of models for collision detection
    root.apply("collide", params, true);

    // detect collisions
    this.detectCollisions(params.detectCollisions);

    // detect obstructions
    this.detectObstructions(params.detectCollisions);

    // detect snap-to connections
    this.detectSnapConnections(params.detectCollisions);
}

CollideDirective.prototype.detectCollisions = function(collideRecs)
{
    if (!this.physicsSimulator) return;
        
    // reset model's collision attributes; get selected model
    var selected = null;
    for (var i in collideRecs)
    {
        var model = collideRecs[i].model;

        model.getAttribute("collisionDetected").setValueDirect(false);
        model.getAttribute("collisionList").clear();

        if (this.isSelected(model))
        {
            selected = model;
        }
    }
    // currently only detecting collisions on selected model
    if (!selected) return;

    // update position of selectd model with physics simulator
    this.physicsSimulator.updatePhysicsBodyPosition(this.physicsSimulator.getPhysicsBodyIndex(selected), false);
    
    // evaluate physics simulator
    this.physicsSimulator.evaluate();

    // check collision status
    var colliding = this.physicsSimulator.isColliding(selected);
    if (colliding)
    {
        // if model is set to stop on collision, update its position from the physics simulator
        if (selected.getAttribute("stopOnCollision").getValueDirect())
        {
            var trans = new Ammo.btTransform();
            this.physicsSimulator.getPhysicsBody(selected).getMotionState().getWorldTransform(trans);
            var origin = trans.getOrigin();
            var rot = trans.getRotation();
            var quaternion = new Quaternion();
            quaternion.load(rot.w(), rot.x(), rot.y(), rot.z());
            Ammo.destroy(trans);

            selected.getAttribute("sectorPosition").setValueDirect(origin.x(), origin.y(), origin.z()); 
            selected.getAttribute("quaternion").setValueDirect(quaternion);
        }
    }
}

CollideDirective.prototype.detectObstructions = function(collideRecs)
{
    var i, j;
    var models = [];
    var trees = [];
    var obstructions = [];

    for (i in collideRecs)
    {
        if (collideRecs[i].model.getAttribute("detectObstruction").getValueDirect() == false) continue;
        
        models.push(collideRecs[i].model);
        trees.push(collideRecs[i].tree);
        obstructions.push(false);

        collideRecs[i].model.getAttribute("obstructionList").clear();
    }

    var distance = 0;
    var minDistance = FLT_MAX;
    for (i = 0; i < trees.length; i++)
    {
        var scale = models[i].scale.getValueDirect();
        
        var directionVectors = models[i].getDirectionVectors();
        directionVectors.forward.x *= MAX_SEE_AHEAD * scale.x;
        directionVectors.forward.y *= MAX_SEE_AHEAD * scale.y;
        directionVectors.forward.z *= MAX_SEE_AHEAD * scale.z;

        for (j = 0; j < trees.length; j++)
        {
            if (i == j)
                continue;

            if (( distance = trees[j].obstructs(trees[i], directionVectors.forward)) > 0 && distance < minDistance)
            {
                models[i].getAttribute("obstructionList").clear();
                models[i].getAttribute("obstructionList").push_back(models[j]);
                obstructions[i] = true;
                minDistance = distance;
            }
        }
    }

    for (i = 0; i < obstructions.length; i++)
    {
        models[i].getAttribute("obstructionDetected").setValueDirect(obstructions[i]);
    }
}

CollideDirective.prototype.detectSnapConnections = function(collideRecs)
{
    var i;
    var snapper = null;
    var snappees = [];
    
    for (i in collideRecs)
    {
        // only test plugs from the currently selected model
        if (this.isSelected(collideRecs[i].model) &&
            collideRecs[i].model.getAttribute("snapEnabled").getValueDirect())
        {
            snapper = collideRecs[i].model;
        }
        else if (collideRecs[i].model.getAttribute("snapEnabled").getValueDirect()) // !selected
        {
            snappees.push(collideRecs[i].model);
        }       
    }
    if (!snapper || snappees.length == 0) return;

    // test plugs for collision with sockets
    var snapMgr = this.registry.find("SnapMgr");
    for (i = 0; i < snappees.length; i++)
    {
        if (snapMgr.trySnap(snapper, snappees[i]))
        {     
            return;
            //break;
        }
    }
}
    
CollideDirective.prototype.isSelected = function(model)
{
    var selected = model.getAttribute("selected").getValueDirect();
    if (!selected)
    {
        for (var i = 0; i < model.motionChildren.length && !selected; i++)
        {
            selected = this.isSelected(model.motionChildren[i]);
        }
    }

    return selected;
}

function HighlightTarget()
{
    this.projMatrix = new Matrix4x4();
    this.viewMatrix = new Matrix4x4();
    this.worldMatrix = new Matrix4x4();
    this.camera = null;
    this.viewport = new Viewport();
    this.geometries = new Array();
    this.center = new Vector3D();
    this.highlightColor_r = 0;
    this.highlightColor_g = 0;
    this.highlightColor_b = 0;
    this.highlightColor_a = 0;
    this.highlightWidth = 0;
};

HighlightParams.prototype = new DirectiveParams();
HighlightParams.prototype.constructor = HighlightParams();

function HighlightParams()
{
    DirectiveParams.call(this);

    this.projMatrix = new Matrix4x4();
    this.viewMatrix = new Matrix4x4();
    this.worldMatrix = new Matrix4x4();
    this.camera = null;
    this.viewport = new Viewport();
    this.targets = new Array();
}

HighlightDirective.prototype = new SGDirective();
HighlightDirective.prototype.constructor = HighlightDirective;

function HighlightDirective()
{
    SGDirective.call(this);
    this.className = "HighlightDirective";
    this.attrType = eAttrType.HighlightDirective;

    this.vertexBuffer = null;
    
    this.name.setValueDirect("HighlightDirective");
        
    this.highlightType = new NumberAttr(eHighlightType.None);
    this.highlightColor = new ColorAttr(1, 1, 0, 1);
    this.highlightWidth = new NumberAttr(5);
    
    this.highlightColor.addModifiedCB(HighlightDirective_HighlightColorModifiedCB, this);
    
    this.registerAttribute(this.highlightType, "highlightType");
    this.registerAttribute(this.highlightColor, "highlightColor");
    this.registerAttribute(this.highlightWidth, "highlightWidth");
}

HighlightDirective.prototype.setGraphMgr = function(graphMgr)
{
    // call base-class implementation
    SGDirective.prototype.setGraphMgr.call(this, graphMgr);
    
    this.initHighlightSquareVB();
}

HighlightDirective.prototype.execute = function(root)
{
    root = root || this.rootNode.getValueDirect();

    // setup collision Detect params structure
    var params = new HighlightParams();

    // get list of models for collision detection
    root.apply("highlight", params, true);
    
    // draw highlights
    this.drawHighlights(params);
}

HighlightDirective.prototype.drawHighlights = function(params)
{
    // if no targets, return
    if (params.targets.length == 0)
    {
        return;
    }

    // get render engine
    var renderContext = this.graphMgr.renderContext;
    if (!renderContext)
    {
        return;
    } 

    var highlightType = this.highlightType.getValueDirect();

    // for each target
    var up, right, forward;
    for (var i=0; i < params.targets.length; i++)
    {
        var target = params.targets[i];

        // get camera direction vectors
        var directions = target.camera.getDirectionVectors();
        up = directions.up;
        right = directions.right;
        forward = directions.forward;

        // get scaling factors from target's worldMatrix
        var scalingFactors = target.worldMatrix.getScalingFactors();
        var maxScalingFactor = max3(scalingFactors.x, scalingFactors.y, scalingFactors.z);
        
        var wupp = this.getWorldUnitsPerPixel(target.center, target.worldMatrix, target.viewMatrix, target.camera, target.viewport) / maxScalingFactor;
        var highlightWidth = target.highlightWidth * wupp;

        // clear stencil buffer
        renderContext.clearStencil(0);
        renderContext.clear(RC_STENCIL_BUFFER_BIT);

        // increment stencil for geometry in delta positions
        var worldViewMatrix;
        for (var j=0; j < target.geometries.length; j++)
        {
            switch (highlightType)
            {
            case eHighlightType.FourPass:
                {
                    for (var pass=0; pass < 4; pass++)
                    {
                        worldViewMatrix = this.getWorldViewMatrix(highlightType, highlightWidth, pass, up, right,
                            forward, target.worldMatrix, target.viewMatrix);
                        this.configureStencil_Target(renderContext, target.geometries[j], target.projMatrix, 
                            worldViewMatrix, eStencilOp.Increment);
                    }
                }
                break;

            case eHighlightType.EightPass:
                {
                    for (var pass=0; pass < 8; pass++)
                    {
                        worldViewMatrix = this.getWorldViewMatrix(highlightType, highlightWidth, pass, up, right,
                            forward, target.worldMatrix, target.viewMatrix);
                        this.configureStencil_Target(renderContext, target.geometries[j], target.projMatrix,
                            worldViewMatrix, eStencilOp.Increment);
                    }
                }
                break;
            }
        }

        // zero stencil for geometry in original position
        worldViewMatrix = target.worldMatrix.multiply(target.viewMatrix);
        for (var j=0; j < target.geometries.length; j++)
        {
            this.configureStencil_Target(renderContext, target.geometries[j], target.projMatrix, worldViewMatrix, eStencilOp.Zero);
        }

        // update highlight color
        this.highlightColor.setValueDirect(target.highlightColor_r, target.highlightColor_g, target.highlightColor_b, target.highlightColor_a);

        // render highlight square
        this.renderHighlightSquare(params, renderContext);
    } 
}

HighlightDirective.prototype.getWorldUnitsPerPixel = function(point, worldMatrix, viewMatrix, camera, viewport)
{
    // get geometry's center in view space
    var worldViewMatrix = worldMatrix.multiply(viewMatrix);
    var centerPtCamSpace = worldViewMatrix.transform(point.x, point.y, point.z, 1);

    // determine the per-pixel width and height at geometry's center in view space
    var perPixel = new Vector2D();
    
    // get camera node type
    switch (camera.attrType)
    {
    case eAttrType.PerspectiveCamera:
        {
            // get zoom
            var zoom = camera.getAttribute("zoom").getValueDirect();
            perPixel = worldUnitsPerPixelPersp(viewport, zoom, centerPtCamSpace.z);
        }
        break;

    case eAttrType.OrthographicCamera:
        {
            // get width
            var width = camera.getAttribute("width").getValueDirect();
            perPixel = worldUnitsPerPixelOrtho(viewport, width);
        }
        break;
        
    default:
        break;
    }
    
    return Math.max(perPixel.x, perPixel.y); 
}

HighlightDirective.prototype.getWorldViewMatrix = function(highlightType, highlightWidth, pass,
                                                           cameraUp, cameraRight, cameraForward,
                                                           world, view)
{
    var degrees = 0;
    switch (highlightType)
    {
    case eHighlightType.FourPass:  degrees = 90; break;
    case eHighlightType.EightPass: degrees = 45; break;
    }

    var rotate = new Matrix4x4();
    rotate.loadZAxisRotation(degrees * pass);
    var delta = rotate.transform(1, 0, 0, 0);
    delta.x *= highlightWidth;
    delta.y *= highlightWidth;
    delta.z *= highlightWidth;

    var translate = new Matrix4x4();
    translate.loadTranslation(cameraRight.x * delta.x + cameraUp.x * delta.y,// + cameraForward.x * delta.z, 
                              cameraRight.y * delta.x + cameraUp.y * delta.y,// + cameraForward.y * delta.z,
                              cameraRight.z * delta.x + cameraUp.z * delta.y);// + cameraForward.z * delta.z);

    return translate.multiply(world.multiply(view));
}

HighlightDirective.prototype.configureStencil_Target = function(renderContext,
                                                                geometry,
                                                                projMatrix,
                                                                worldViewMatrix,
                                                                stencilOp)
{
    // get current render states
    var lastDepthBufferWrite = renderContext.enabled(eRenderMode.DepthBufferWrite);
    var lastStencilTest = renderContext.enabled(eRenderMode.StencilTest);
    var lastAlphaBlend = renderContext.enabled(eRenderMode.AlphaBlend);

    // disable z-buffer writes (note: z-testing still occurs), and enable the
    // stencil-buffer
    renderContext.setEnabled(eRenderMode.DepthBufferWrite, false);
    renderContext.setEnabled(eRenderMode.StencilTest, true);

    // set depth function
    renderContext.setDepthFunc(eDepthFunc.LessEqual);

    // disable smooth shading
    renderContext.setShadeModel(eShadeModel.Flat);

    // set up stencil compare fuction, reference value, and masks.
    // stencil test passes if ((ref & mask) cmpfn (stencil & mask)) is true.
    renderContext.setStencilFunc(eStencilFunc.Always, 0, 0xFF);
    renderContext.setStencilMask(0xFF);

    // if depth-test passes, increment stencil buffer value
    renderContext.setStencilOp(eStencilOp.Keep, stencilOp, stencilOp);

    // make sure that no pixels get drawn to the frame buffer
    renderContext.setEnabled(eRenderMode.AlphaBlend, true);
    renderContext.setBlendFactor(RC_ZERO, RC_ONE);

    // draw geometry in stencil only
    renderContext.setMatrixMode(RC_PROJECTION);
    renderContext.pushMatrix();
    renderContext.loadMatrix(projMatrix);
    renderContext.applyProjectionTransform();
    renderContext.setMatrixMode(RC_VIEW);
    renderContext.pushMatrix();
    renderContext.loadMatrix(new Matrix4x4());
    renderContext.applyViewTransform();
    renderContext.setMatrixMode(RC_WORLD);
    renderContext.pushMatrix();
    renderContext.loadMatrix(worldViewMatrix);
    renderContext.applyWorldTransform();
    geometry.drawPrimitives();
    renderContext.setMatrixMode(RC_PROJECTION);
    renderContext.popMatrix();
    renderContext.setMatrixMode(RC_VIEW);
    renderContext.popMatrix();
    renderContext.setMatrixMode(RC_WORLD);
    renderContext.popMatrix();

    // restore render states
    renderContext.setEnabled(eRenderMode.DepthBufferWrite, lastDepthBufferWrite);
    renderContext.setEnabled(eRenderMode.StencilTest, lastStencilTest);
    renderContext.setDepthFunc(eDepthFunc.LessEqual);
    renderContext.setShadeModel(eShadeModel.Gouraud);
    renderContext.setEnabled(eRenderMode.AlphaBlend, lastAlphaBlend);
}
     
HighlightDirective.prototype.renderHighlightSquare = function(params, renderContext)
{
    // get current render states
    var lastDepthTest = renderContext.enabled(eRenderMode.DepthTest);
    var lastStencilTest = renderContext.enabled(eRenderMode.StencilTest);
    var lastAlphaBlend = renderContext.enabled(eRenderMode.AlphaBlend);
    var lastLighting = renderContext.enabled(eRenderMode.Lighting);

    // set render states
    renderContext.setDepthFunc(eDepthFunc.LessEqual);
    renderContext.setEnabled(eRenderMode.DepthTest, false);
    renderContext.setEnabled(eRenderMode.StencilTest, true);
    renderContext.setEnabled(eRenderMode.AlphaBlend, true);
    renderContext.setEnabled(eRenderMode.Lighting, false);
    renderContext.setBlendFactor(RC_SRC_ALPHA, RC_ONE_MINUS_SRC_ALPHA);

    // only write where stencil val <= 1 (count indicates # of target fragments that
    // overlap that pixel)
    renderContext.setStencilFunc(eStencilFunc.LessEqual, 1, 0xFF);
    renderContext.setStencilOp(eStencilOp.Keep, eStencilOp.Keep, eStencilOp.Keep); 

    // draw the highlight square
    var m = new Matrix4x4();
    m.loadIdentity();
    renderContext.setMatrixMode(RC_PROJECTION);
    renderContext.pushMatrix();
    renderContext.loadMatrix(m);
    renderContext.applyProjectionTransform();
    renderContext.setMatrixMode(RC_VIEW);
    renderContext.pushMatrix();
    renderContext.loadMatrix(m);
    renderContext.applyViewTransform();
    renderContext.setMatrixMode(RC_WORLD);
    renderContext.pushMatrix();
    renderContext.loadMatrix(m);
    renderContext.applyWorldTransform();
    this.vertexBuffer.draw();
    renderContext.popMatrix();
    renderContext.setMatrixMode(RC_VIEW);
    renderContext.popMatrix();
    renderContext.setMatrixMode(RC_PROJECTION);
    renderContext.popMatrix();

    // restore render states
    renderContext.setDepthFunc(eDepthFunc.LessEqual);
    renderContext.setEnabled(eRenderMode.DepthTest, lastDepthTest);
    renderContext.setEnabled(eRenderMode.StencilTest, lastStencilTest);
    renderContext.setEnabled(eRenderMode.AlphaBlend, lastAlphaBlend);
    renderContext.setEnabled(eRenderMode.Lighting, lastLighting);
    renderContext.setMatrixMode(RC_WORLD);
}
                                      
HighlightDirective.prototype.initHighlightSquareVB = function()
{
    this.vertexBuffer = this.graphMgr.renderContext.createVertexBuffer(3);
    this.vertexBuffer.setPrimitiveType(RC_TRIANGLE_STRIP);
    
    var vertices = [ -1, -1,  1,
                     -1,  1,  1,
                      1, -1,  1,
                      1,  1,  1 ];

    var normals = [ 0,  0, -1,
                    0,  0, -1,
                    0,  0, -1,
                    0,  0, -1 ];
             
    var color = this.highlightColor.getValueDirect();       
    var colors = [ color.r, color.g, color.b, color.a,
                   color.r, color.g, color.b, color.a,
                   color.r, color.g, color.b, color.a,
                   color.r, color.g, color.b, color.a ];
                    
    this.vertexBuffer.setVertices(vertices);
    this.vertexBuffer.setNormals(normals);
    this.vertexBuffer.setColors(colors);
}

HighlightDirective.prototype.highlightColorModified = function()
{
    if (this.vertexBuffer)
    {
        var color = this.highlightColor.getValueDirect();       
        var colors = [ color.r, color.g, color.b, color.a,
                       color.r, color.g, color.b, color.a,
                       color.r, color.g, color.b, color.a,
                       color.r, color.g, color.b, color.a ];

        this.vertexBuffer.setColors(colors);
    }
}

function HighlightDirective_HighlightColorModifiedCB(attribute, container)
{
    container.highlightColorModified();
}

ShadowParams.prototype = new DirectiveParams();
ShadowParams.prototype.constructor = ShadowParams();

function ShadowParams()
{
    DirectiveParams.call(this);
    
    this.worldMatrix = new Matrix4x4();
    this.dissolve = 0;
    this.opacity = 1;
    this.lights = [];
    this.modelID = 0;
}

ShadowDirective.prototype = new SGDirective();
ShadowDirective.prototype.constructor = ShadowDirective;

function ShadowDirective()
{
    SGDirective.call(this);
    this.className = "ShadowDirective";
    this.attrType = eAttrType.ShadowDirective;

    this.program = null;
    this.shadowFBO = null;
    this.displayListObj = null;
    
    this.name.setValueDirect("ShadowDirective");
    
    this.casterWorldPosition = new Vector3DAttr(0, 0, 0);
    
    this.registerAttribute(this.casterWorldPosition, "casterWorldPosition");
}

ShadowDirective.prototype.setGraphMgr = function(graphMgr)
{
    this.program = graphMgr.renderContext.createProgram(pcf_shadow_mapping_depth_pass_vs, pcf_shadow_mapping_depth_pass_fs);
    this.shadowFBO = graphMgr.renderContext.createShadowFramebufferObject();
    this.displayListObj = new DisplayListObj(graphMgr.renderContext);
    
    // call base-class implementation
    SGDirective.prototype.setGraphMgr.call(this, graphMgr);
}

ShadowDirective.prototype.execute = function(root)
{
    root = root || this.rootNode.getValueDirect();

    // get current shader program
    var program = this.graphMgr.renderContext.getProgram();

    // get current display list (if any)
    var lastDisplayListObj = this.graphMgr.renderContext.getDisplayList();
    
    // get current viewport and clear color
    var viewport = this.graphMgr.renderContext.getViewport();
    var clearColor = this.graphMgr.renderContext.getClearColor();

    // set shader program
    this.graphMgr.renderContext.useProgram(this.program);
    
    // set projection
    var fovyRadians = toRadians(90);
    var height = 1024;
    var width = 1024;
    var near = 1;
    var far = 100;
    
    var top = Math.tan(fovyRadians / 2) * near;
    var bottom = -top;
    var right = top * (width / height);
    var left = -right;
   
    var projectionMatrix = this.graphMgr.renderContext.perspectiveMatrixLH(left, right,
        top, bottom, near, far);
    
    this.graphMgr.renderContext.setMatrixMode(RC_PROJECTION);
    this.graphMgr.renderContext.pushMatrix();
    this.graphMgr.renderContext.loadMatrix(projectionMatrix);
    this.graphMgr.renderContext.applyProjectionTransform();
    
    // TODO: make configurable
    worldPos = this.casterWorldPosition.getValueDirect();
    this.graphMgr.renderContext.setShadowCasterWorldPosition(worldPos.x, worldPos.y, worldPos.z);
    
    // set view
    var translationMatrix = new Matrix4x4();
    translationMatrix.loadTranslation(worldPos.x, worldPos.y, worldPos.z); // TODO
    
    var rotationMatrix = new Matrix4x4();
    rotationMatrix.loadYAxisRotation(90);
    
    var viewMatrix = rotationMatrix.multiply(translationMatrix);
    viewMatrix.invert();
    
    this.graphMgr.renderContext.setMatrixMode(RC_VIEW);
    this.graphMgr.renderContext.pushMatrix();
    this.graphMgr.renderContext.loadMatrix(viewMatrix);
    this.graphMgr.renderContext.applyViewTransform();
    
    // bind the first face of the shadow fbo to the framebuffer
    this.shadowFBO.bindForWriting(eCubeMapFace.Positive_X);
    
    // set this display list to render context    
    this.graphMgr.renderContext.setDisplayList(this.displayListObj);
    
    // begin recording
    this.displayListObj.record_begin();
    
    // draw
    var params = new ShadowParams();
    root.apply("shadow", params, true);
    
    // stop recording
    this.displayListObj.record_end();
    
    // bind subsequent faces of the shadow fbo to the framebuffer and draw
    for (var i = 1; i < 6; i++)
    {
        // bind the face of the shadow fbo to the framebuffer
        this.shadowFBO.bindForWriting(eCubeMapFace.Positive_X + i);
        
        // set view
        switch (eCubeMapFace.Positive_X + i)
        {
            case eCubeMapFace.Negative_X: rotationMatrix.loadYAxisRotation(-90); break;
            case eCubeMapFace.Positive_Y: rotationMatrix.loadXAxisRotation(90); break;
            case eCubeMapFace.Negative_Y: rotationMatrix.loadXAxisRotation(-90); break;
            case eCubeMapFace.Positive_Z: rotationMatrix.loadYAxisRotation(0); break;
            case eCubeMapFace.Negative_Z: rotationMatrix.loadYAxisRotation(180); break;
        }
        viewMatrix = rotationMatrix.multiply(translationMatrix);
        viewMatrix.invert();
        this.graphMgr.renderContext.setMatrixMode(RC_VIEW);
        this.graphMgr.renderContext.loadMatrix(viewMatrix);
        this.graphMgr.renderContext.applyViewTransform();
        
        // draw
        this.displayListObj.play();
    }
    
    // restore previous projection
    this.graphMgr.renderContext.setMatrixMode(RC_PROJECTION);
    this.graphMgr.renderContext.popMatrix();
    this.graphMgr.renderContext.applyProjectionTransform();
    
    // restore previous view
    this.graphMgr.renderContext.setMatrixMode(RC_VIEW);
    this.graphMgr.renderContext.popMatrix();
    this.graphMgr.renderContext.applyViewTransform();
    
    // restore last display list (if any)
    this.graphMgr.renderContext.setDisplayList(lastDisplayListObj);
    
    // restore last viewport and clear color
    this.graphMgr.renderContext.setViewport(viewport.x, viewport.y, viewport.width, viewport.height);
    this.graphMgr.renderContext.clearColor(clearColor.r, clearColor.g, clearColor.b, clearColor.a);
    
    // restore last shader program
    this.graphMgr.renderContext.useProgram(program);
    
    this.graphMgr.renderContext.setShadowCasterWorldPosition(worldPos.x, worldPos.y, worldPos.z);
    
    // unbind the shadow fbo from the framebuffer and bind for reading by the render pass
    this.shadowFBO.bindForReading();
}
var OBJECTMOTION_PAN_BIT     = 0x001;
var OBJECTMOTION_LINEAR_BIT  = 0x002;
var OBJECTMOTION_ANGULAR_BIT = 0x004;
var OBJECTMOTION_SCALAR_BIT  = 0x008;
var OBJECTMOTION_ALL_BITS    = 0x00F;

function ObjectMotionDesc()
{
    this.validMembersMask = OBJECTMOTION_ALL_BITS;
    this.panVelocity = new Vector3D(0, 0, 0);
    this.linearVelocity = new Vector3D(0, 0, 0);
    this.angularVelocity = new Vector3D(0, 0, 0);
    this.scalarVelocity = new Vector3D(0, 0, 0);
    this.duration = 0; // seconds
    this.stopOnCollision = true;
}

ObjectMotionDesc.prototype.assign = function(rhs)
{
    this.validMembersMask = rhs.validMembersMask;
    this.panVelocity = rhs.panVelocity;
    this.linearVelocity = rhs.linearVelocity;
    this.angularVelocity = rhs.angularVelocity;
    this.scalarVelocity = rhs.scalarVelocity;
    this.duration = rhs.duration;
}

ObjectMover.prototype = new Evaluator();
ObjectMover.prototype.constructor = ObjectMover;

function ObjectMover()
{
    Evaluator.call(this);
    this.className = "ObjectMover";
    this.attrType = eAttrType.ObjectMover;

    this.targetObject = null;
    this.motionQueue = new Queue();
    this.activeMotion = null;
    this.activeDuration = 0;
    this.lastCollisionDetected = false;

    this.target = new StringAttr("");
    this.timeIncrement = new NumberAttr(0);
    this.linearSpeed = new NumberAttr(0); // meters/sec
    this.angularSpeed = new NumberAttr(0); // degrees/sec
    this.panVelocity = new Vector3DAttr();
    this.linearVelocity = new Vector3DAttr();
    this.angularVelocity = new Vector3DAttr();
    this.scalarVelocity = new Vector3DAttr();

    this.enabled.addModifiedCB(ObjectMover_EnabledModifiedCB, this);
    this.target.addModifiedCB(ObjectMover_TargetModifiedCB, this);

    this.registerAttribute(this.target, "target");
    this.registerAttribute(this.timeIncrement, "timeIncrement");
    this.registerAttribute(this.linearSpeed, "linearSpeed");
    this.registerAttribute(this.angularSpeed, "angularSpeed");
}

ObjectMover.prototype.onUnregister = function()
{
    this.motionQueue.clear();
    this.panVelocity.setValueDirect(0, 0, 0);
    this.linearVelocity.setValueDirect(0, 0, 0);
    this.angularVelocity.setValueDirect(0, 0, 0);
    this.scalarVelocity.setValueDirect(0, 0, 0);
}

ObjectMover.prototype.evaluate = function()
{
    // time
    var timeIncrement = this.timeIncrement.getValueDirect();

    this.updateActiveMotion(timeIncrement);

    this.setMotion(this.activeMotion);
}

ObjectMover.prototype.setMotion = function(motion)
{
    if (motion.validMembersMask & OBJECTMOTION_PAN_BIT)
    {
        this.panVelocity.setValueDirect(motion.panVelocity.x,
                motion.panVelocity.y,
                motion.panVelocity.z);
    }

    if (motion.validMembersMask & OBJECTMOTION_LINEAR_BIT)
    {
        this.linearVelocity.setValueDirect(motion.linearVelocity.x,
                motion.linearVelocity.y,
                motion.linearVelocity.z);
    }

    if (motion.validMembersMask & OBJECTMOTION_ANGULAR_BIT)
    {
        this.angularVelocity.setValueDirect(motion.angularVelocity.x,
                motion.angularVelocity.y,
                motion.angularVelocity.z);
    }

    if (motion.validMembersMask & OBJECTMOTION_SCALAR_BIT)
    {
        this.scalarVelocity.setValueDirect(motion.scalarVelocity.x,
                motion.scalarVelocity.y,
                motion.scalarVelocity.z);
    }
}

ObjectMover.prototype.updateActiveMotion = function(timeIncrement)
{
    if (!this.activeMotion ||
            this.activeDuration >= this.activeMotion.duration)
    {
        this.activeDuration = 0;
        this.activeMotion = this.motionQueue.front() || new ObjectMotionDesc();
        this.motionQueue.pop();
    }

    this.activeDuration += timeIncrement;
}

ObjectMover.prototype.connectTarget = function(target)
{
    this.panVelocity.removeAllTargets();
    this.linearVelocity.removeAllTargets();
    this.angularVelocity.removeAllTargets();
    this.scalarVelocity.removeAllTargets();

    if (target)
    {
        this.panVelocity.addTarget(target.getAttribute("panVelocity"));
        this.linearVelocity.addTarget(target.getAttribute("linearVelocity"));
        this.angularVelocity.addTarget(target.getAttribute("angularVelocity"));
        this.scalarVelocity.addTarget(target.getAttribute("scalarVelocity"));
        target.getAttribute("detectCollision").setValueDirect(true);
        target.getAttribute("collisionDetected").addModifiedCB(ObjectMover_TargetCollisionDetectedModifiedCB, this);
        target.getAttribute("detectObstruction").setValueDirect(true);
        target.getAttribute("obstructionDetected").addModifiedCB(ObjectMover_TargetObstructionDetectedModifiedCB, this);       
    }

    this.targetObject = target;
}

ObjectMover.prototype.collisionDetected = function(collisionList)
{
}

ObjectMover.prototype.obstructionDetected = function(obstructionList)
{
}

function ObjectMover_EnabledModifiedCB(attribute, container)
{
    var enabled = attribute.getValueDirect();
    if (!enabled)
    {
        container.motionQueue.clear();
        container.panVelocity.setValueDirect(0, 0, 0);
        container.linearVelocity.setValueDirect(0, 0, 0);
        container.angularVelocity.setValueDirect(0, 0, 0);
        container.scalarVelocity.setValueDirect(0, 0, 0);
    }
}

function ObjectMover_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    var resource = container.registry.find(target);
    if (resource)
    {
        container.connectTarget(resource);
    }
}

function ObjectMover_TargetCollisionDetectedModifiedCB(attribute, container)
{
    var collisionDetected = attribute.getValueDirect();
    var collisionList = attribute.getContainer().getAttribute("collisionList");
    container.collisionDetected(collisionList);
    container.lastCollisionDetected = collisionList.Size() > 0 ? true : false;
}

function ObjectMover_TargetObstructionDetectedModifiedCB(attribute, container)
{
    var obstructionDetected = attribute.getValueDirect();
    var obstructionList = attribute.getContainer().getAttribute("obstructionList");
    container.obstructionDetected(obstructionList);
}

var ANIMALMOVER_MAX_QUEUE_LENGTH = 2;

AnimalMover.prototype = new ObjectMover();
AnimalMover.prototype.constructor = AnimalMover;

function AnimalMover()
{
    ObjectMover.call(this);
    this.className = "AnimalMover";
    this.attrType = eAttrType.AnimalMover;

    this.linearDirection = null;
}

AnimalMover.prototype.evaluate = function()
{
    if (this.motionQueue.length() == 0)
    {
        var rand = Math.random();
        var negateAngle = rand < 0.5 ? -1 : 1;
        var walk = new ObjectMotionDesc();
        walk.duration = 5 * rand; // 
        walk.angularVelocity = new Vector3D(0, this.angularSpeed.getValueDirect() * rand * negateAngle, 0);
        walk.panVelocity = new Vector3D(0, 0, this.linearSpeed.getValueDirect());

        this.motionQueue.push(walk);
    }

    // call base-class implementation
    ObjectMover.prototype.evaluate.call(this);
}

AnimalMover.prototype.collisionDetected = function(collisionList)
{
}

AnimalMover.prototype.obstructionDetected = function(obstructionList)
{
    if (obstructionList.Size() > 0) // obstructions(s) occurred
    {
        this.motionQueue.clear();
        this.activeMotion = null;

        // determine vector to avoid obstruction
        var directionVectors = this.targetObject.getDirectionVectors();
        var thisPos = this.targetObject.getAttribute("sectorPosition").getValueDirect();
        var linearDirection = new Vector3D(directionVectors.forward.x, directionVectors.forward.y, directionVectors.forward.z);
        var obstructorPos = obstructionList.getAt(0).getAttribute("sectorPosition").getValueDirect();
        var angleBetween = toDegrees(Math.acos(cosineAngleBetween(directionVectors.forward,
                new Vector3D(obstructorPos.x - thisPos.x,
                        obstructorPos.y - thisPos.y,
                        obstructorPos.z - thisPos.z))));
        // if angleBetween is 0, offset obstructorPos so that deltaPos is not (0, 0, 0)
        if (angleBetween == 0)
        {
            obstructorPos.x += 0.1;
            obstructorPos.z += 0.1;
        }
        var mag = distanceBetween(thisPos, obstructorPos);
        var deltaPos = new Vector3D(((directionVectors.forward.x * mag) - (obstructorPos.x)),
                ((directionVectors.forward.y * mag) - (obstructorPos.y)),
                ((directionVectors.forward.z * mag) - (obstructorPos.z)));
        deltaPos.normalize();
        //deltaPos.multiplyScalar(MAX_AVOID_FORCE);
        linearDirection.addVector(deltaPos);
        linearDirection.normalize();

        // scale by linear speed   
        linearDirection.multiplyScalar(this.linearSpeed.getValueDirect());
        this.linearDirection = linearDirection;

        // turn so this will travel in direction of this vector
        var cosAngle = cosineAngleBetween(directionVectors.forward, this.linearDirection);
        angleBetween = toDegrees(Math.acos(cosAngle));
        if (angleBetween > 0)
        {
            if (cosAngle < 0)
                angleBetween = -angleBetween;
            var rotation = this.targetObject.getAttribute("rotation").getValueDirect();
            this.targetObject.getAttribute("rotation").setValueDirect(rotation.x, angleBetween + rotation.y, rotation.z);
            
            // this code can result in endless turning
            /*var turn = new ObjectMotionDesc();
            turn.angularVelocity = new Vector3D(0, angleBetween, 0);
            turn.duration = angleBetween / this.angularSpeed.getValueDirect();
            this.motionQueue.push(turn);*/
        }
    }
    else // no obstruction(s)
    {
    }
}
WalkSimulator.prototype = new SceneInspector();
WalkSimulator.prototype.constructor = WalkSimulator;

function WalkSimulator()
{
    SceneInspector.call(this);
    this.className = "WalkSimulator";
    this.attrType = eAttrType.WalkSimulator;
    
    this.sceneInspector_pivotDistanceValue = 0;
    this.selector_computePivotDistanceValue = 0;
    
    this.groundPlane = new PlaneAttr();
    this.linearDelta = new Vector3DAttr(0, 0, 0);
    this.angularDelta = new Vector3DAttr(0, 0, 0);
    this.linearSensitivity = new Vector3DAttr(1, 1, 1);
    this.angularSensitivity = new Vector3DAttr(1, 1, 1);
    this.resultLinear = new Vector3DAttr();
    this.resultAngular = new Vector3DAttr();
    
    this.enabled.addModifiedCB(WalkSimulator_EnabledModifiedCB, this);
    this.linearDelta.addModifiedCB(WalkSimulator_LinearDeltaModifiedCB, this);
    this.angularDelta.addModifiedCB(WalkSimulator_AngularDeltaModifiedCB, this);
    
    this.registerAttribute(this.groundPlane, "groundPlane");
    this.registerAttribute(this.linearDelta, "linearDelta");
    this.registerAttribute(this.angularDelta, "angularDelta");
    this.registerAttribute(this.linearSensitivity, "linearSensitivity");
    this.registerAttribute(this.angularSensitivity, "angularSensitivity");
    this.registerAttribute(this.resultLinear, "resultLinear");
    this.registerAttribute(this.resultAngular, "resultAngular");
    
    this.viewRelativeXAxisRotation.setValueDirect(true);
    this.viewRelativeYAxisRotation.setValueDirect(true);
    this.viewRelativeZAxisRotation.setValueDirect(true);
    this.groundPlane.normal.setValueDirect(0, 1, 0);
}

WalkSimulator.prototype.evaluate = function()
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        return;
    }
    
    // get inputs
    var linearDelta = this.linearDelta.getValueDirect();
    // reverse pan x
    linearDelta.x *= -1;
    var linearSensitivity = this.linearSensitivity.getValueDirect();
    var angularDelta = this.angularDelta.getValueDirect();
    var angularSensitivity = this.angularSensitivity.getValueDirect();

    var panDelta = new Vector3D(linearDelta.x, linearDelta.y, linearDelta.z);
    panDelta.multiplyVector(linearSensitivity);
    var rotationDelta = new Vector3D(angularDelta.x, angularDelta.y, angularDelta.z);
    rotationDelta.multiplyVector(angularSensitivity);

    // only evaluate if necessary
    if (panDelta.x != 0 || panDelta.y != 0 || panDelta.z != 0 || 
        rotationDelta.x != 0 || rotationDelta.y != 0 || rotationDelta.z != 0)
    {
        this.panDelta.setValueDirect(panDelta.x, panDelta.y, panDelta.z);
        this.rotationDelta.setValueDirect(rotationDelta.x, rotationDelta.y, rotationDelta.z);

        // set camera direction vectors based upon walkPlane
        //if (m_updateDirectionVectors) // uncomment to retain forward direction when inspecting with mouse
        {
            // view position
            var viewPosition = this.viewPosition.getValueDirect();

            // view rotation
            var viewRotation = this.viewRotation.getValueDirect();

            // ground plane
            var groundPlane = this.groundPlane.getValueDirect();

            // formulate view transform
            var viewTrans = new Matrix4x4();
            viewTrans.loadTranslation(-viewPosition.x, -viewPosition.y, -viewPosition.z);
            var viewRot = new Matrix4x4();
            viewRot.loadXYZAxisRotation(-viewRotation.x, -viewRotation.y, -viewRotation.z);
            var viewTransform = viewTrans.multiply(viewRot);

            // formulate direction vectors
            this.upVector.setValueDirect(groundPlane.normal.x, groundPlane.normal.y, groundPlane.normal.z);
            
            var xformedXYZ = this.transformDirectionVector(0, 0, 1, viewTransform);
            var projectedXYZ = planeProject(xformedXYZ, groundPlane);
            var vProjectedXYZ = new Vector3D(projectedXYZ.x, projectedXYZ.y, projectedXYZ.z);
            vProjectedXYZ.normalize();
            this.forwardVector.setValueDirect(vProjectedXYZ.x, vProjectedXYZ.y, vProjectedXYZ.z);

            var m = new Matrix4x4();
            m.loadYAxisRotation(90);
            xformedXYZ = m.transform(vProjectedXYZ.x, vProjectedXYZ.y, vProjectedXYZ.z, 0);
            this.rightVector.setValueDirect(xformedXYZ.x, xformedXYZ.y, xformedXYZ.z);
            
            //m_updateDirectionVectors = false;*/
        }

        // call base-class implementation
        SceneInspector.prototype.evaluate.call(this);
    }
}

WalkSimulator.prototype.enabledModified = function()
{
    var enabled = this.enabled.getValueDirect();
    if (enabled)
    {
        this.enableSceneInspectionState(); // ensure scene inspection is enabled
        //m_updateDirectionVectors = true;
        this.affectRotation_Z.setValueDirect(false); // suspend bank
    }
    else if (this.lastEnabled) // only do the following if previously enabled
    {
        this.restoreSceneInspectionState(); // restore previous scene inspector state
        //m_updateDirectionVectors = false;
        this.affectRotation_Z.setValueDirect(true); // restore bank
        this.upVector.setValueDirect(0, 0, 0, false);
        this.rightVector.setValueDirect(0, 0, 0, false);
        this.forwardVector.setValueDirect(0, 0, 0, false);
    }

    this.lastEnabled = enabled;
}

WalkSimulator.prototype.enableSceneInspectionState = function()
{
    var sceneInspector = this.registry.find("SceneInspector");
    if (sceneInspector)
    {
        sceneInspector.enabled.setValueDirect(true);
        this.sceneInspector_pivotDistanceValue = sceneInspector.pivotDistance.getValueDirect();
        sceneInspector.pivotDistance.setValueDirect(0);
    }
    
    var selector = this.registry.find("Selector");
    if (selector)
    {
        this.selector_computePivotDistanceValue = selector.computePivotDistance.getValueDirect();
        selector.computePivotDistance.setValueDirect(false);
    }
}

WalkSimulator.prototype.restoreSceneInspectionState = function()
{
    var sceneInspector = this.registry.find("SceneInspector");
    if (sceneInspector)
    {
        sceneInspector.pivotDistance.setValueDirect(this.sceneInspector_pivotDistanceValue);
    }
    
    var selector = this.registry.find("Selector");
    if (selector)
    {
        selector.computePivotDistance.setValueDirect(this.selector_computePivotDistanceValue);
    }
}

function WalkSimulator_EnabledModifiedCB(attribute, container)
{
    container.enabledModified();
}

function WalkSimulator_LinearDeltaModifiedCB(attribute, container)
{
    // if orphaned, evaluate (otherwise graph will invoke evaluation)
    //if (container.orphan.getValueDirect() == true)
    {
        container.evaluate();
    }
}

function WalkSimulator_AngularDeltaModifiedCB(attribute, container)
{
    // if orphaned, evaluate (otherwise graph will invoke evaluation)
    //if (container.orphan.getValueDirect() == true)
    {
        container.evaluate();
    }
}

Cube.prototype = new TriList();
Cube.prototype.constructor = Cube;

function Cube()
{
    TriList.call(this);
    this.className = "Cube";
    this.attrType = eAttrType.Cube;
    
    this.updateTriList = true; // update once
    
    this.transform = new Matrix4x4();
    this.updateTransform = false;
    
    this.materialNode = new Material();
    this.updateMaterial = false;
    
    this.color = new ColorAttr(1, 1, 1, 1);
    this.opacity = new NumberAttr(1);
    this.position = new Vector3DAttr(0, 0, 0);
    this.rotation = new Vector3DAttr(0, 0, 0);
    this.scale = new Vector3DAttr(1, 1, 1);
    
    this.color.addModifiedCB(Cube_MaterialModifiedCB, this);
    this.opacity.addModifiedCB(Cube_MaterialModifiedCB, this);
    this.position.addModifiedCB(Cube_PositionModifiedCB, this);
    this.rotation.addModifiedCB(Cube_RotationModifiedCB, this);
    this.scale.addModifiedCB(Cube_ScaleModifiedCB, this);
    
    this.registerAttribute(this.color, "color");
    this.registerAttribute(this.opacity, "opacity");
    this.registerAttribute(this.position, "position");
    this.registerAttribute(this.rotation, "rotation");
    this.registerAttribute(this.scale, "scale");
    
    var vertices = 
    [
        -0.25, -0.25, 0.25, -0.25, 0.25, 0.25, -0.25, 0.25, -0.25, -0.25, -0.25, -0.25, -0.25, -0.25, 0.25, -0.25, 0.25, -0.25,
        0.25, -0.25, -0.25, 0.25, -0.25, 0.25, -0.25, -0.25, 0.25, -0.25, -0.25, -0.25, 0.25, -0.25, -0.25, -0.25, -0.25, 0.25,
        0.25, -0.25, -0.25, -0.25, 0.25, -0.25, 0.25, 0.25, -0.25, 0.25, -0.25, -0.25, -0.25, -0.25, -0.25, -0.25, 0.25, -0.25,
        0.25, -0.25, 0.25, 0.25, 0.25, -0.25, 0.25, 0.25, 0.25, 0.25, -0.25, -0.25, 0.25, 0.25, -0.25, 0.25, -0.25, 0.25,
        0.25, 0.25, -0.25, -0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, -0.25, -0.25, 0.25, -0.25, -0.25, 0.25, 0.25,
        0.25, -0.25, 0.25, 0.25, 0.25, 0.25, -0.25, 0.25, 0.25, -0.25, -0.25, 0.25, 0.25, -0.25, 0.25, -0.25, 0.25, 0.25
    ];
    
    var normals =
    [
        -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0,
        0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0,
        0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1,
        1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0,
        0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0,
        0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1
    ];
    
    this.vertices.setValue(vertices);
    this.normals.setValue(normals);
    
    this.color.addTarget(this.materialNode.getAttribute("color"));
    this.opacity.addTarget(this.materialNode.getAttribute("opacity"));
}

Cube.prototype.setGraphMgr = function(graphMgr)
{
    // call base-class implementation
    TriList.prototype.setGraphMgr.call(this, graphMgr);

    this.materialNode.setGraphMgr(graphMgr);
}
            
Cube.prototype.update = function(params, visitChildren)
{
    if (this.updateTransform)
    {
        this.updateTransform = false;
 
        var position = this.position.getValueDirect();
        var translationMatrix = new Matrix4x4();
        translationMatrix.loadTranslation(position.x, position.y, position.z);
        
        var rotation = this.rotation.getValueDirect();
        var rotationMatrix = new Matrix4x4();
        rotationMatrix.loadXYZAxisRotation(rotation.x, rotation.y, rotation.z);
        
        var scale = this.scale.getValueDirect();
        var scaleMatrix = new Matrix4x4();
        scaleMatrix.loadScale(scale.x, scale.y, scale.z);
        
        this.transform.loadMatrix(scaleMatrix.multiply(rotationMatrix.multiply(translationMatrix)));
    }
    
    if (this.updateMaterial)
    {
        this.updateMaterial = false;       
        this.materialNode.update(params, visitChildren);
    }

    if (this.updateTriList)
    {
        this.updateTriList = false;
        TriList.prototype.update.call(this, params, visitChildren);
    }
}

Cube.prototype.apply = function(directive, params, visitChildren)
{
    var show = this.show.getValueDirect();
    var enabled = this.enabled.getValueDirect();
    if (!show || !enabled)
    {
        return;
    }
    
    switch (directive)
    {
        case "render":
        case "shadow":
            {
                this.materialNode.apply(directive, params, visitChildren);
                this.draw(params.dissolve);
            }
            break;
    }
}

Cube.prototype.draw = function(dissolve)
{
    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
    this.graphMgr.renderContext.pushMatrix();

    this.graphMgr.renderContext.leftMultMatrix(this.transform);
    this.graphMgr.renderContext.applyWorldTransform();
    
    // draw primitives
    this.vertexBuffer.draw();
    
    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
    this.graphMgr.renderContext.popMatrix();
    this.graphMgr.renderContext.applyWorldTransform();
}

function Cube_PositionModifiedCB(attribute, container)
{
    container.updateTransform = true;
}

function Cube_RotationModifiedCB(attribute, container)
{
    container.updateTransform = true;
}

function Cube_ScaleModifiedCB(attribute, container)
{
    container.updateTransform = true;
}

function Cube_MaterialModifiedCB(attribute, container)
{
    container.updateMaterial = true;
}
ScreenRect.prototype = new TriList();
ScreenRect.prototype.constructor = ScreenRect;

function ScreenRect()
{
    TriList.call(this);
    this.className = "ScreenRect";
    this.attrType = eAttrType.ScreenRect;
    
    this.primitiveType = RC_TRIANGLE_STRIP;
    
    this.textureColorMask = new ColorAttr(0, 0, 0, 1);
    
    this.registerAttribute(this.textureColorMask, "textureColorMask");
    
    var vertices = 
    [
        -1, -1,  1,
        -1,  1,  1,
         1, -1,  1,
         1,  1,  1
    ];
    
    var normals =
    [
        0,  0,  -1,
        0,  0,  -1,
        0,  0,  -1,
        0,  0,  -1
    ];
    
    var colors =
    [
        1,  1,  1,  1,
        1,  1,  1,  1,
        1,  1,  1,  1,
        1,  1,  1,  1
    ];
    
    this.vertices.setValueDirect(vertices);
    this.normals.setValueDirect(normals);
    this.colors.setValueDirect(colors);
}

ScreenRect.prototype.update = function(params, visitChildren)
{
    // call base-class implementation
    TriList.prototype.update.call(this, params, visitChildren);
}

ScreenRect.prototype.draw = function(dissolve)
{
    // set projection matrix
    var m = new Matrix4x4();
    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
    this.graphMgr.renderContext.pushMatrix();
    this.graphMgr.renderContext.loadMatrix(m);
    this.graphMgr.renderContext.applyWorldTransform();
    this.graphMgr.renderContext.setMatrixMode(RC_PROJECTION);
    this.graphMgr.renderContext.pushMatrix();
    this.graphMgr.renderContext.loadMatrix(m);
    this.graphMgr.renderContext.applyProjectionTransform();
    
    this.graphMgr.renderContext.disable(eRenderMode.DepthTest);
    this.graphMgr.renderContext.disable(eRenderMode.DepthBufferWrite);
    this.graphMgr.renderContext.disable(eRenderMode.Lighting);
    
    var textureColorMask = this.textureColorMask.getValueDirect();
    this.graphMgr.renderContext.setTextureColorMask(textureColorMask.r, textureColorMask.g, textureColorMask.b, textureColorMask.a);
    
    // call base-class implementation
    TriList.prototype.draw.call(this, dissolve);
    
    // restore projection matrix
    this.graphMgr.renderContext.popMatrix();
    this.graphMgr.renderContext.applyProjectionTransform();
    this.graphMgr.renderContext.setMatrixMode(RC_WORLD);
    this.graphMgr.renderContext.popMatrix();
    this.graphMgr.renderContext.applyWorldTransform();
    
    this.graphMgr.renderContext.enable(eRenderMode.DepthTest);
    this.graphMgr.renderContext.enable(eRenderMode.DepthBufferWrite);
    this.graphMgr.renderContext.enable(eRenderMode.Lighting);
    
    // reset color mask that won't affect rendering
    this.graphMgr.renderContext.setTextureColorMask(2, 2, 2, 2);
}

ScreenRect.prototype.setTexture = function(texture)
{
    var uvs =
    [
        0, 0,
        0, 1,
        1, 0,
        1, 1
    ];
    
    var uvCoords = this.getUVCoords(texture); 
    uvCoords.setValueDirect(uvs);
}

MorphEffector.prototype = new Evaluator();
MorphEffector.prototype.constructor = MorphEffector;

function MorphEffector()
{
    Evaluator.call(this);
    this.className = "MorphEffector";
    this.attrType = eAttrType.MorphEffector;
    
    this.morphAmt = new NumberAttr(0);
    this.morphIncr = new NumberAttr(0);
    this.sourceVertices = new NumberArrayAttr();
    this.targetVertices = new NumberArrayAttr();
    this.resultVertices = new NumberArrayAttr();
    
    this.registerAttribute(this.morphAmt, "morphAmt");
    this.registerAttribute(this.morphIncr, "morphIncr");
    this.registerAttribute(this.sourceVertices, "sourceVertices");
    this.registerAttribute(this.targetVertices, "targetVertices");
    this.registerAttribute(this.resultVertices, "resultVertices");
}

MorphEffector.prototype.evaluate = function()
{
    // get input values

    // morph amount
    var morphAmt = this.morphAmt.getValueDirect();

    // morph increment
    var morphIncr = this.morphIncr.getValueDirect();

    // increment morph amount by morph increment
    morphAmt += morphIncr;

    // clamp morph amount to range [0, 1]
    morphAmt = clamp(morphAmt, 0, 1);

    // update morph amount attribute value
    this.morphAmt.setValueDirect(morphAmt);

    var sourceVertices = this.sourceVertices.getValueDirect();
    var targetVertices = this.targetVertices.getValueDirect();
    var resultVertices = [];
    
    var count = Math.min(sourceVertices.length, targetVertices.length);
    resultVertices.length = count;
    
    for (var i = 0; i < count; i++)
    {
        resultVertices[i] = (targetVertices[i] - sourceVertices[i]) * morphAmt + sourceVertices[i];
    }
    
    this.resultVertices.setValue(resultVertices);
}

Bone.prototype = new AttributeContainer();
Bone.prototype.constructor = Bone;

function Bone()
{
    AttributeContainer.call(this);
    this.className = "Bone";
    this.attrType = eAttrType.Bone;
    
    this.parent = null;
    this.children = [];
    this.translationMatrix = new Matrix4x4();
    this.rotationMatrix = new Matrix4x4();
    this.rotationQuat = new Quaternion();
    this.scaleMatrix = new Matrix4x4();
    this.pivotMatrix = new Matrix4x4();
    this.matrix = new Matrix4x4();
    this.restMatrix = new Matrix4x4();
    this.restMatrixInv = new Matrix4x4();
    this.parentMatrix = new Matrix4x4();
    this.boneMatrix = new Matrix4x4();
    this.updatePosition = false;
    this.updateRotation = false;
    this.updateScale = false;
    this.updatePivot = false;
    this.updateRestPosition = false;
    this.updateRestRotation = false;
    this.updateRestLength = false;
    this.updateFalloffType = false;
    this.updateParentTransform = false;
    this.updateParentRestTransform = false;
    
    this.name = new StringAttr("");
    this.position = new Vector3DAttr(0, 0, 0);
    this.rotation = new Vector3DAttr(0, 0, 0);
    this.scale = new Vector3DAttr(1, 1, 1);
    this.pivot = new Vector3DAttr(0, 0, 0);
    this.restPosition = new Vector3DAttr(0, 0, 0);
    this.restRotation = new Vector3DAttr(0, 0, 0);
    this.restLength = new NumberAttr(0);
    this.strength = new NumberAttr(0);
    this.falloffType = new NumberAttr(eBoneFalloffType.InverseDistance);
    this.scaleBoneStrength = new BooleanAttr(false);
    this.transform = new Matrix4x4Attr(1, 0, 0, 0,
                                       0, 1, 0, 0,
                                       0, 0, 1, 0,
                                       0, 0, 0, 1);
    this.parentTransform = new Matrix4x4Attr(1, 0, 0, 0,
                                             0, 1, 0, 0,
                                             0, 0, 1, 0,
                                             0, 0, 0, 1);
    this.restTransform = new Matrix4x4Attr(1, 0, 0, 0,
                                           0, 1, 0, 0,
                                           0, 0, 1, 0,
                                           0, 0, 0, 1);
    this.parentRestTransform = new Matrix4x4Attr(1, 0, 0, 0,
                                                 0, 1, 0, 0,
                                                 0, 0, 1, 0,
                                                 0, 0, 0, 1);
    
    this.position.addModifiedCB(Bone_PositionModifiedCB, this);
    this.rotation.addModifiedCB(Bone_RotationModifiedCB, this);
    this.scale.addModifiedCB(Bone_ScaleModifiedCB, this);
    this.pivot.addModifiedCB(Bone_PivotModifiedCB, this);
    this.restPosition.addModifiedCB(Bone_RestPositionModifiedCB, this);
    this.restRotation.addModifiedCB(Bone_RestRotationModifiedCB, this);
    this.restLength.addModifiedCB(Bone_RestLengthModifiedCB, this);
    this.falloffType.addModifiedCB(Bone_FalloffTypeModifiedCB, this);
    this.parentTransform.addModifiedCB(Bone_ParentTransformModifiedCB, this);
    this.parentRestTransform.addModifiedCB(Bone_ParentRestTransformModifiedCB, this);
    
    this.registerAttribute(this.name, "name");
    this.registerAttribute(this.position, "position");
    this.registerAttribute(this.rotation, "rotation");
    this.registerAttribute(this.scale, "scale");
    this.registerAttribute(this.pivot, "pivot");
    this.registerAttribute(this.restPosition, "restPosition");
    this.registerAttribute(this.restRotation, "restRotation");
    this.registerAttribute(this.restLength, "restLength");
    this.registerAttribute(this.strength, "strength");
    this.registerAttribute(this.falloffType, "falloffType");
    this.registerAttribute(this.scaleBoneStrength, "scaleBoneStrength");
}

Bone.prototype.addChild = function(child)
{
    // child can only have one parent
    if (!child || child.parent)
    {
        return false;
    }

    // set child's parent to this
    child.parent = this;

    // set child's parent transform source to this transform
    this.transform.addTarget(child.parentTransform);

    // set child's parent rest tranform source to this rest transform
    this.restTransform.addTarget(child.parentRestTransform);

    this.children.push(child);

    return true;
}

Bone.prototype.removeChild = function(child)
{
    if (!child)
    {
        return false;
    }

    for (var i = 0; i < this.children.length; i++)
    {
        if (this.children[i] == child)
        {
            // clear child's parent
            child.parent = null;
            
            // clear child's parent transform source
            this.transform.removeTarget(child.parentTransform);
            
            // clear child's parent rest transform source
            this.restTransform.removeTarget(child.parentRestTransform);

            // set child's parent transform to identity
            var identity = new Matrix4x4();
            identity.loadIdentity();
            child.parentTransform.setValueDirect(identity);

            // set child's parent rest transform to identity
            child.parentRestTransform.setValueDirect(identity);

            this.children.splice(i, 1);
            
            return true;
        }
    }

    return false;
}

Bone.prototype.getChild = function(n)
{
    if (n >= this.children.length)
    {
        return null;
    }

    return this.children[n];
}
    
Bone.prototype.getChildCount = function()
{
    return this.children.length;
}

Bone.prototype.getParent = function()
{
    return this.parent;
}

Bone.prototype.getScaledStrength = function()
{
    var strength = this.strength.getValueDirect(); 
    if (this.scaleBoneStrength.getValueDirect())
    {
        strength *= this.restLength.getValueDirect();
    }

    return strength;
}

Bone.prototype.calculateFalloffValues = function(vertices)
{
    var bonePos = this.restMatrix.transform(0, 0, 0, 1);

    var boneDir = this.restMatrix.transform(0, 0, 1, 0);

    var restLength = this.restLength.getValueDirect();

    var boneSegment_a = new Vector3D(bonePos.x, bonePos.y, bonePos.z);
    var boneSegment_b = new Vector3D(bonePos.x + boneDir.x * restLength,
                                     bonePos.y + boneDir.y * restLength,
                                     bonePos.z + boneDir.z * restLength);
                                     
    var numVertices = vertices.length / 3;

    var falloffType = this.falloffType.getValueDirect();

    var falloffValues = []; falloffValues.length = numVertices;
    for (var i=0, j=0; i < numVertices; i++, j+=3)
    {
        var distance = distanceBetweenLineSegmentAndPoint(boneSegment_a, boneSegment_b, new Vector3D(vertices[j], vertices[j+1], vertices[j+2]));

        switch (falloffType)
        {
        case eBoneFalloffType.InverseDistance:
            falloffValues[i] = 1 / distance;
            break;

        case eBoneFalloffType.InverseDistance_2:
            falloffValues[i] = 1 / (distance * distance);
            break;

        case eBoneFalloffType.InverseDistance_4:
            falloffValues[i] = 1 / (distance * distance * distance * distance);
            break;

        case eBoneFalloffType.InverseDistance_8:
            falloffValues[i] = 1 / (distance * distance * distance * distance *
                                    distance * distance * distance * distance);
            break;

        case eBoneFalloffType.InverseDistance_16:
            falloffValues[i] = 1 / (distance * distance * distance * distance *
                                    distance * distance * distance * distance *
                                    distance * distance * distance * distance *
                                    distance * distance * distance * distance);  
            break;
        }

        falloffValues[i] *= this.getScaledStrength();
    }
    
    return falloffValues;
}

Bone.prototype.update = function()
{
    var updateBoneMatrix = false;
    
    if (this.updatePosition || this.updateRotation || this.updateScale || this.updatePivot || this.updateParentTransform)
    {
        if (this.updatePosition)
        {
            this.updatePosition = false;

            var position = this.position.getValueDirect();
            this.translationMatrix.loadTranslation(position.x, position.y, position.z);
        }

        if (this.updateRotation)
        {
            this.updateRotation = false;

            var rotation = this.rotation.getValueDirect();
            this.rotationQuat.loadXYZAxisRotation(rotation.x, rotation.y, rotation.z);
            this.rotationMatrix = this.rotationQuat.getMatrix();
        }

        if (this.updateScale)
        {
            this.updateScale = false;

            var scale = this.scale.getValueDirect();
            this.scaleMatrix.loadScale(scale.x, scale.y, scale.z);
        }

        if (this.updatePivot)
        {
            this.updatePivot = false;

            var pivot = this.pivot.getValueDirect();
            this.pivotMatrix.loadTranslation(-pivot.x, -pivot.y, -pivot.z);
        }

        if (this.updateParentTransform)
        {
            this.updateParentTransform = false;

            this.parentMatrix = this.parentTransform.getValueDirect();
        }

        this.matrix = this.pivotMatrix.multiply(this.scaleMatrix.multiply(this.rotationMatrix.multiply(this.translationMatrix.multiply(this.parentMatrix))));

        // set matrix to transform attribute so children will be notified of modification
        this.transform.setValueDirect(this.matrix);

        updateBoneMatrix = true;
    }

    if (this.updateRestPosition || this.updateRestRotation || this.updateParentRestTransform)
    {
        this.updateRestPosition = false;
        this.updateRestRotation = false;
        this.updateParentRestTransform = false;

        var restPosition = this.restPosition.getValueDirect();

        var restPositionMatrix = new Matrix4x4();
        restPositionMatrix.loadTranslation(restPosition.x, restPosition.y, restPosition.z);

        var restRotation = this.restRotation.getValueDirect();

        var restRotationQuat = new Quaternion();
        restRotationQuat.loadXYZAxisRotation(restRotation.x, restRotation.y, restRotation.z);
        var restRotationMatrix = restRotationQuat.getMatrix();

        var parentRestMatrix = this.parentRestTransform.getValueDirect();

        this.restMatrix = restRotationMatrix.multiply(restPositionMatrix.multiply(parentRestMatrix));

        this.restMatrixInv = new Matrix4x4();
        this.restMatrixInv.loadMatrix(this.restMatrix);
        this.restMatrixInv.invert();

        // set rest matrix to rest transform attribute so children will be notified of modification
        this.restTransform.setValueDirect(this.restMatrix);

        updateBoneMatrix = true;
    }

    if (this.updateRestLength)
    {
        this.updateRestLength = false;
    }

    if (updateBoneMatrix)
    {
        this.boneMatrix = this.restMatrixInv.multiply(this.matrix);
    }
}

function Bone_PositionModifiedCB(attribute, container)
{
    container.updatePosition = true;
}

function Bone_RotationModifiedCB(attribute, container)
{
    container.updateRotation = true;
}

function Bone_ScaleModifiedCB(attribute, container)
{
    container.updateScale = true;
}

function Bone_PivotModifiedCB(attribute, container)
{
    container.updatePivot = true;
}

function Bone_RestPositionModifiedCB(attribute, container)
{
    container.updateRestPosition = true;
}

function Bone_RestRotationModifiedCB(attribute, container)
{
    container.updateRestRotation = true;
}

function Bone_RestLengthModifiedCB(attribute, container)
{
    container.updateRestLength = true;
}

function Bone_FalloffTypeModifiedCB(attribute, container)
{
    container.updateFalloffType = true;
}

function Bone_ParentTransformModifiedCB(attribute, container)
{
    container.updateParentTransform = true;
}

function Bone_ParentRestTransformModifiedCB(attribute, container)
{
    container.updateParentRestTransform = true;
}

BoneEffector.prototype = new Evaluator();
BoneEffector.prototype.constructor = BoneEffector;

function BoneEffector()
{
    Evaluator.call(this);
    this.className = "BoneEffector";
    this.attrType = eAttrType.BoneEffector;
    
    this.bones = [];
    this.verticesArray = [];
    this.normalsArray = [];
    this.resultVerticesArray = [];
    this.resultNormalsArray = [];
    this.boneFalloffValuesMap = [];
    this.falloffSums = [];
    this.updateVertices = false;
    this.updateNormals = false;
    
    this.vertices = new NumberArrayAttr();
    this.normals = new NumberArrayAttr();
    this.resultVertices = new NumberArrayAttr();
    this.resultNormals = new NumberArrayAttr();
    
    this.vertices.addModifiedCB(BoneEffector_VerticesModifiedCB, this);
    this.normals.addModifiedCB(BoneEffector_NormalsModifiedCB, this);
    
    this.registerAttribute(this.vertices, "vertices");
    this.registerAttribute(this.normals, "normals");
    this.registerAttribute(this.resultVertices, "resultVertices");
    this.registerAttribute(this.resultNormals, "resultNormals");
}

BoneEffector.prototype.evaluate = function()
{
    this.update();

    // update bones
    for (var i=0; i < this.bones.length; i++)
    {
        this.updateBones(this.bones[i]);
    }

    // evaluate bones
    for (var i=0; i < this.bones.length; i++)
    {
        // pass true for "initial" param, so that result arrays will be loaded instead of appended
        this.evaluateBones(this.bones[i], i == 0 ? true : false);
    }

    // output result
    this.resultVertices.setValueDirect(this.resultVerticesArray);
    this.resultNormals.setValueDirect(this.resultNormalsArray);
}

BoneEffector.prototype.addBoneHierarchy = function(root)
{
    if (!root)
    {
        return false;
    }

    this.bones.push(root);

    if (this.verticesArray.length > 0)
    {
        this.calculateFalloffValues();
    }

    return true;
}

BoneEffector.prototype.update = function()
{
    if (this.updateVertices)
    {
        this.updateVertices = false;

        this.verticesArray = this.vertices.getValueDirect();
        this.resultVerticesArray.length = this.verticesArray.length;
        
        this.calculateFalloffValues();
    }

    if (this.updateNormals)
    {
        this.updateNormals = false;

        this.normalsArray = this.normals.getValueDirect();
        this.resultNormalsArray.length = this.normalsArray.length;
    }
}

BoneEffector.prototype.calculateFalloffValues = function()
{
    this.boneFalloffValuesMap = [];
    for (var i=0; i < this.bones.length; i++)
    {
        this.updateBones(this.bones[i]);
        this.calculateBoneFalloffValues(this.bones[i]);
    }

    this.sumFalloffValues();
}

BoneEffector.prototype.calculateBoneFalloffValues = function(root)
{
    if (!root || this.verticesArray.length == 0)
    {
        return;
    }

    var falloffValues = root.calculateFalloffValues(this.verticesArray);
    this.boneFalloffValuesMap.push(new Pair(root, falloffValues));

    // recurse on children
    for (var i=0; i < root.getChildCount(); i++)
    {
        var child = root.getChild(i);
        if (!child)
        {
            continue;
        }

        this.calculateBoneFalloffValues(child);
    }
}

BoneEffector.prototype.sumFalloffValues = function()
{
    if (this.verticesArray.length == 0)
    {
        return;
    }

    var numVertices = this.verticesArray.length / 3;

    // sum falloff values
    this.falloffSums.length = numVertices;
    for (var i=0; i < numVertices; i++) this.falloffSums[i] = 0;
    for (var i=0; i < this.boneFalloffValuesMap.length; i++)
    {
        var boneFalloffValues = this.boneFalloffValuesMap[i].second;
        for (var j=0; j < numVertices; j++)
        {
            this.falloffSums[j] += boneFalloffValues[j];
        }
    }

    // divide falloff values by sum
    for (var i=0; i < this.boneFalloffValuesMap.length; i++)
    {
        var boneFalloffValues = this.boneFalloffValuesMap[i].second;

        for (var j=0; j < numVertices; j++)
        {
            if (this.falloffSums[j] != 0)
            {
                boneFalloffValues[j] /= this.falloffSums[j];
            }
            else // this.falloffSums[j] == 0
            {
                boneFalloffValues[j] = 0;
            }
        }
    }
}

BoneEffector.prototype.updateBones = function(root)
{
    if (!root)
    {
        return;
    }

    root.update();

    // recurse on children
    for (var i=0; i < root.getChildCount(); i++)
    {
        var child = root.getChild(i);
        if (!child)
        {
            continue;
        }

        this.updateBones(child);
    }
}

BoneEffector.prototype.evaluateBones = function(root, initial)
{
    if (!root)
    {
        return;
    }

    // get bone falloff values
    var boneFalloffValues = null;
    for (var i=0; i < this.boneFalloffValuesMap.length; i++)
    {
        if (this.boneFalloffValuesMap[i].first == root)
        {
            boneFalloffValues = this.boneFalloffValuesMap[i].second;
            break;
        }
    }
    
    // get bone transform
    var boneTransform = root.boneMatrix;

    // transform vertices
    var numVertices = this.verticesArray.length / 3;
    for (var i=0, j=0; i < numVertices; i++, j+=3)
    {
        if (boneFalloffValues[i] > 0)
        {
            var xformed = boneTransform.transform(this.verticesArray[j], this.verticesArray[j+1], this.verticesArray[j+2], 1);

            if (initial)
            {
                this.resultVerticesArray[j  ] = xformed.x * boneFalloffValues[i];
                this.resultVerticesArray[j+1] = xformed.y * boneFalloffValues[i];
                this.resultVerticesArray[j+2] = xformed.z * boneFalloffValues[i];
            }
            else // !initial
            {
                this.resultVerticesArray[j  ] += xformed.x * boneFalloffValues[i];
                this.resultVerticesArray[j+1] += xformed.y * boneFalloffValues[i];
                this.resultVerticesArray[j+2] += xformed.z * boneFalloffValues[i];
            }
        }
        else // boneFalloffValues[i] == 0
        {
            // use untransformed vertex
            this.resultVerticesArray[j  ] = this.verticesArray[j  ];
            this.resultVerticesArray[j+1] = this.verticesArray[j+1];
            this.resultVerticesArray[j+2] = this.verticesArray[j+2];
        }
    }

    // transform normals
    var numNormals = this.normalsArray.length / 3;
    for (var i=0, j=0; i < numNormals; i++, j+=3)
    {
        if (boneFalloffValues[i] > 0)
        {
            var xformed = boneTransform.transform(this.normalsArray[j], this.normalsArray[j+1], this.normalsArray[j+2], 0);

            if (initial)
            {
                this.resultNormalsArray[j  ] = xformed.x * boneFalloffValues[i];
                this.resultNormalsArray[j+1] = xformed.y * boneFalloffValues[i];
                this.resultNormalsArray[j+2] = xformed.z * boneFalloffValues[i];
            }
            else // !initial
            {
                this.resultNormalsArray[j  ] += xformed.x * boneFalloffValues[i];
                this.resultNormalsArray[j+1] += xformed.y * boneFalloffValues[i];
                this.resultNormalsArray[j+2] += xformed.z * boneFalloffValues[i];
            }
        }
        else // boneFalloffValues[i] == 0
        {
            // use untransformed normal
            this.resultNormalsArray[j  ] = this.normalsArray[j  ];
            this.resultNormalsArray[j+1] = this.normalsArray[j+1];
            this.resultNormalsArray[j+2] = this.normalsArray[j+2];
        }
    }

    // recurse on children
    for (var i=0; i < root.getChildCount(); i++)
    {
        var child = root.getChild(i);
        if (!child)
        {
            continue;
        }

        this.evaluateBones(child);
    }
}

function BoneEffector_VerticesModifiedCB(attribute, container)
{
    container.updateVertices = true;
}

function BoneEffector_NormalsModifiedCB(attribute, container)
{
    container.updateNormals = true;
}

SnapConnector.prototype = new AttributeContainer();
SnapConnector.prototype.constructor = SnapConnector;

function SnapConnector()
{
    AttributeContainer.call(this);
    this.className = "SnapConnector";
    this.attrType = eAttrType.SnapConnector;

    this.name = new StringAttr();
    this.type = new StringAttr("default");
    this.normal = new Vector3DAttr(0, 0, 0);
    this.connected = new BooleanAttr(false);

    this.registerAttribute(this.name, "name");
    this.registerAttribute(this.type, "type");
    this.registerAttribute(this.normal, "normal");
    this.registerAttribute(this.connected, "connected");
}

GenericConnector.prototype = new SnapConnector();
GenericConnector.prototype.constructor = GenericConnector;

function GenericConnector()
{
    SnapConnector.call(this);
    this.className = "GenericConnector";
    this.attrType = eAttrType.GenericConnector;

    this.point = new SphereAttr();

    this.registerAttribute(this.point, "point");
}

GenericConnector.prototype.collides = function(genericConnector, colliderWorldMatrix, collideeWorldMatrix)
{
    // check point/point
    this.point.sphere.setTransform(colliderWorldMatrix);
    genericConnector.point.sphere.setTransform(collideeWorldMatrix);

    if (this.point.sphere.intersects(genericConnector.point.sphere))
    {
        return 1;
    }

    // no collision detected
    return 0;
}

GenericConnectors.prototype = new AttributeVector();
GenericConnectors.prototype.constructor = GenericConnectors;

function GenericConnectors()
{
    AttributeVector.call(this, new GenericConnectorAllocator());
    this.className = "GenericConnectors";
    this.attrType = eAttrType.GenericConnectors;

    this.appendParsedElements.setValueDirect(true);
}

GenericConnectors.prototype.get = function(name)
{
    var length = this.Size();
    for (var i = 0; i < length; i++)
    {
        var connector = this.getAt(i);
        if (connector.getAttribute("name").getValueDirect().join("") == name)
        {
            return connector;
        }
    }
    
    return null;
}
    
GenericConnectorAllocator.prototype = new Allocator();
GenericConnectorAllocator.prototype.constructor = GenericConnectorAllocator;

function GenericConnectorAllocator()
{
}

GenericConnectorAllocator.prototype.allocate = function ()
{
    return new GenericConnector();
}

SocketConnector.prototype = new SnapConnector();
SocketConnector.prototype.constructor = SocketConnector;

function SocketConnector()
{
    SnapConnector.call(this);
    this.className = "SocketConnector";
    this.attrType = eAttrType.SocketConnector;

    this.slot = 0;
    
    this.slot1 = new SphereAttr();
    this.slot2 = new SphereAttr();

    this.registerAttribute(this.slot1, "slot1");
    this.registerAttribute(this.slot2, "slot2");
}

SocketConnectors.prototype = new AttributeVector();
SocketConnectors.prototype.constructor = SocketConnectors;

function SocketConnectors()
{
    AttributeVector.call(this, new SocketConnectorAllocator());
    this.className = "SocketConnectors";
    this.attrType = eAttrType.SocketConnectors;

    this.appendParsedElements.setValueDirect(true);
}

SocketConnectors.prototype.get = function(name)
{
    var length = this.Size();
    for (var i = 0; i < length; i++)
    {
        var connector = this.getAt(i);
        if (connector.getAttribute("name").getValueDirect().join("") == name)
        {
            return connector;
        }
    }
    
    return null;
}

SocketConnectorAllocator.prototype = new Allocator();
SocketConnectorAllocator.prototype.constructor = SocketConnectorAllocator;

function SocketConnectorAllocator()
{
}

SocketConnectorAllocator.prototype.allocate = function ()
{
    return new SocketConnector();
}

PlugConnector.prototype = new SnapConnector();
PlugConnector.prototype.constructor = PlugConnector;

function PlugConnector()
{
    SnapConnector.call(this);
    this.className = "PlugConnector";
    this.attrType = eAttrType.PlugConnector;

    this.pin1 = new SphereAttr();
    this.pin2 = new SphereAttr();

    this.registerAttribute(this.pin1, "pin1");
    this.registerAttribute(this.pin2, "pin2");
}

PlugConnector.prototype.collides = function(socketConnector, plugWorldMatrix, socketWorldMatrix)
{
    // check pin1/socket1
    this.pin1.sphere.setTransform(plugWorldMatrix);
    socketConnector.slot1.sphere.setTransform(socketWorldMatrix);

    if (this.pin1.sphere.intersects(socketConnector.slot1.sphere))
    {
        return 1;
    }

    // check pin2/socket2
    this.pin2.sphere.setTransform(plugWorldMatrix);
    socketConnector.slot2.sphere.setTransform(socketWorldMatrix);

    if (this.pin2.sphere.intersects(socketConnector.slot2.sphere))
    {
        return 2;
    }

    // no collision detected
    return 0;
}

PlugConnectors.prototype = new AttributeVector();
PlugConnectors.prototype.constructor = PlugConnectors;

function PlugConnectors()
{
    AttributeVector.call(this, new PlugConnectorAllocator());
    this.className = "PlugConnectors";
    this.attrType = eAttrType.PlugConnectors;

    this.appendParsedElements.setValueDirect(true);
}

PlugConnectors.prototype.get = function(name)
{
    var length = this.Size();
    for (var i = 0; i < length; i++)
    {
        var connector = this.getAt(i);
        if (connector.getAttribute("name").getValueDirect().join("") == name)
        {
            return connector;
        }
    }
    
    return null;
}

PlugConnectorAllocator.prototype = new Allocator();
PlugConnectorAllocator.prototype.constructor = PlugConnectorAllocator;

function PlugConnectorAllocator()
{
}

PlugConnectorAllocator.prototype.allocate = function ()
{
    return new PlugConnector();
}



PhysicsSimulator.prototype = new Evaluator();
PhysicsSimulator.prototype.constructor = PhysicsSimulator;

function PhysicsSimulator()
{
    Evaluator.call(this);
    this.className = "PhysicsSimulator";
    this.attrType = eAttrType.PhysicsSimulator;

    this.collisionConfiguration = null;
    this.dispatcher = null;
    this.overlappingPairCache = null;
    this.solver = null;
    this.world = null;
    this.physicsBodies = [];
    this.physicsShapes = [];
    this.bodyAdded = [];
    this.bodyModels = [];
    this.updateWorld = false;
    this.updateBodies = false;
    this.updateBodyPositions = [];

    this.timeIncrement = new NumberAttr(0);
    this.timeScale = new NumberAttr(1);
    this.gravity = new Vector3DAttr(0, -9.8, 0);
    this.worldHalfExtents = new Vector3DAttr(10000, 10000, 10000); // TODO: does this need to be configurable? 
    this.bodies = new AttributeVector(new StringAttrAllocator());

    this.bodies.getAttribute("appendParsedElements").setValueDirect(true);

    this.gravity.addModifiedCB(PhysicsSimulator_GravityModifiedCB, this);
    this.bodies.addModifiedCB(PhysicsSimulator_BodiesModifiedCB, this);

    this.registerAttribute(this.timeIncrement, "timeIncrement");
    this.registerAttribute(this.timeScale, "timeScale");
    this.registerAttribute(this.gravity, "gravity");
    this.registerAttribute(this.worldHalfExtents, "worldHalfExtents");
    this.registerAttribute(this.bodies, "bodies");

    this.initPhysics();
}

PhysicsSimulator.prototype.evaluate = function()
{
    var timeIncrement = this.timeIncrement.getValueDirect() * this.timeScale.getValueDirect();
    this.stepSimulation(timeIncrement);

    // add/remove bodies based on selection state (allows for object inspection)
    for (var i = 0; i < this.bodyModels.length; i++)
    {
        switch (this.isSelected(this.bodyModels[i]))
        {
            case 0:
                // unselected
                {
                    // if not added, update its position and add
                    if (!this.bodyAdded[i])
                    {
                        this.updatePhysicsBodyPosition(i, true);
                        this.bodyAdded[i] = true;
                    }
                }
                break;

            case 1:
                // selected
                {
                    // stop positional updates
                    this.bodyAdded[i] = false;
                }
                break;
        }
    }

    var trans = new Ammo.btTransform();
    var worldHalfExtents = this.worldHalfExtents.getValueDirect();
    var modelsOutOfBounds = [];
    for (var i = 0; i < this.physicsBodies.length; i++)
    {
        var physicsEnabled = this.bodyModels[i].physicsEnabled.getValueDirect();
        if (!this.bodyAdded[i] || !physicsEnabled)
            continue;

        this.physicsBodies[i].getMotionState().getWorldTransform(trans);
        var origin = trans.getOrigin();
        var position = new Vector3D(origin.x(), origin.y(), origin.z());

        var rot = trans.getRotation();
        var quat = new Quaternion();
        quat.load(rot.w(), rot.x(), rot.y(), rot.z());

        this.bodyModels[i].getAttribute("position").removeModifiedCB(PhysicsSimulator_ModelPositionModifiedCB, this);
        //this.bodyModels[i].getAttribute("rotation").removeModifiedCB(PhysicsSimulator_ModelRotationModifiedCB, this);
        this.bodyModels[i].getAttribute("quaternion").removeModifiedCB(PhysicsSimulator_ModelQuaternionModifiedCB, this);
    
        this.bodyModels[i].getAttribute("sectorPosition").setValueDirect(position.x, position.y, position.z);
        this.bodyModels[i].getAttribute("quaternion").setValueDirect(quat);

        this.bodyModels[i].getAttribute("position").addModifiedCB(PhysicsSimulator_ModelPositionModifiedCB, this);
        //this.bodyModels[i].getAttribute("rotation").addModifiedCB(PhysicsSimulator_ModelRotationModifiedCB, this);
        this.bodyModels[i].getAttribute("quaternion").addModifiedCB(PhysicsSimulator_ModelQuaternionModifiedCB, this);
        
        // if object has moved outside of the world boundary, remove it from the simulation (memory errors occur when positions become too large)
        if (position.x < -worldHalfExtents.x || position.x > worldHalfExtents.x ||
            position.y < -worldHalfExtents.y || position.y > worldHalfExtents.y ||
            position.z < -worldHalfExtents.z || position.z > worldHalfExtents.z)
        {
            modelsOutOfBounds.push(this.bodyModels[i]);
        }
    }
    Ammo.destroy(trans);

    // remove any models that have moved outside of the world boundary
    for (var i = 0; i < modelsOutOfBounds.length; i++)
    {
        this.deletePhysicsBody(modelsOutOfBounds[i]);
    }
}

PhysicsSimulator.prototype.update = function()
{
    if (this.updateWorld)
    {
        this.updateWorld = false;
        this.updateBodies = true;
        this.initPhysics();
    }

    if (this.updateBodies)
    {
        this.updateBodies = false;
        this.updatePhysicsBodies();
    }
    
    for (var i in this.updateBodyPositions)
    {
        this.updatePhysicsBodyPosition(this.updateBodyPositions[i], true);
    }
    this.updateBodyPositions = [];
}

PhysicsSimulator.prototype.stepSimulation = function(timeIncrement, maxSubSteps)
{
    maxSubSteps = maxSubSteps || 10;
    
    this.update();
    this.world.stepSimulation(timeIncrement, maxSubSteps);
}

PhysicsSimulator.prototype.isColliding = function(model)
{
    // if model is parented, get parent
    while (model.motionParent)
    {
        model = model.motionParent;
    }
    
    // find physics body corresponding to model
    var physicsBody = this.getPhysicsBody(model);
    if (physicsBody)
    {
        var numManifolds = this.world.getDispatcher().getNumManifolds();
        for (var i = 0; i < numManifolds; i++)
        {
            var contactManifold = this.world.getDispatcher().getManifoldByIndexInternal(i);
            var body0 = contactManifold.getBody0();
            var body1 = contactManifold.getBody1();
            
            //var distance = FLT_MAX;
            var numContacts = contactManifold.getNumContacts();
            /*for (var j = 0; j < numContacts; j++)
            {
                var pt = contactManifold.getContactPoint(j);
                var ptA = pt.getPositionWorldOnA();
                var ptB = pt.getPositionWorldOnB();

                var distance = Math.min(distanceBetween(new Vector3D(ptA.x(), ptA.y(), ptA.z()), new Vector3D(ptB.x(), ptB.y(), ptB.z()), distance));
                //console.log(distance);               
            }
            */
            //if (distance < 0.05)
            if (numContacts > 0)
            {
                if (body0.ptr == physicsBody.ptr)
                {
                    return true;
                }
                else if (body1.ptr == physicsBody.ptr)
                {
                    return true;
                }
            }
        }
    }

    return false;
}

PhysicsSimulator.prototype.getColliders = function(model)
{
    var colliders = [];

    // if model is parented, get parent
    while (model.motionParent)
    {
        model = model.motionParent;
    }

    // find physics body corresponding to model
    var physicsBody = this.getPhysicsBody(model);
    if (physicsBody)
    {
        var numManifolds = this.world.getDispatcher().getNumManifolds();
        for (var i = 0; i < numManifolds; i++)
        {
            var contactManifold = this.world.getDispatcher().getManifoldByIndexInternal(i);
            var body0 = contactManifold.getBody0();
            var body1 = contactManifold.getBody1();
            
            //var distance = FLT_MAX;
            var numContacts = contactManifold.getNumContacts();
            /*for (var j = 0; j < numContacts; j++)
            {
                var pt = contactManifold.getContactPoint(j);
                var ptA = pt.getPositionWorldOnA();
                var ptB = pt.getPositionWorldOnB();

                var distance = Math.min(distanceBetween(new Vector3D(ptA.x(), ptA.y(), ptA.z()), new Vector3D(ptB.x(), ptB.y(), ptB.z()), distance));
                //console.log(distance);               
            }
            */
            //if (distance < 0.05)
            if (numContacts > 0)
            {
                if (body0.ptr == physicsBody.ptr)
                {
                    colliders.push(this.getBodyModel(body1));
                }
                else if (body1.ptr == physicsBody.ptr)
                {
                    colliders.push(this.getBodyModel(body0));
                }
            }
        }
    }

    return colliders;
}

PhysicsSimulator.prototype.getPhysicsBody = function(bodyModel)
{
    for (var i = 0; i < this.bodyModels.length; i++)
    {
        if (this.bodyModels[i] == bodyModel)
        {
            return this.physicsBodies[i];
        }
    }

    return null;
}

PhysicsSimulator.prototype.getPhysicsBodyIndex = function(bodyModel)
{
    for (var i = 0; i < this.bodyModels.length; i++)
    {
        if (this.bodyModels[i] == bodyModel)
        {
            return i;
        }
    }

    return -1;
}

PhysicsSimulator.prototype.getBodyModel = function(physicsBody)
{
    for (var i = 0; i < this.physicsBodies.length; i++)
    {
        if (this.physicsBodies[i].ptr == physicsBody.ptr)
        {
            return this.bodyModels[i];
        }
    }

    return null;
}

PhysicsSimulator.prototype.isSelected = function(model)
{
    var selected = model.getAttribute("selected").getValueDirect();
    if (!selected)
    {
        for (var i = 0; i < model.motionChildren.length && !selected; i++)
        {
            selected = this.isSelected(model.motionChildren[i]);
        }
    }

    return selected;
}

PhysicsSimulator.prototype.updatePhysicsBodies = function()
{
    // remove existing bodies
    while (this.bodyModels.length > 0)
    {
        this.deletePhysicsBody(this.bodyModels[0]);
    }

    // add bodies to world (if not already present)
    for (var i = 0; i < this.bodies.Size(); i++)
    {
        var name = this.bodies.getAt(i).getValueDirect().join("");
        var model = this.registry.find(name);
        if (model)
        {
            this.createPhysicsBody(model);
        }
    }
}

PhysicsSimulator.prototype.createPhysicsBody = function(model)
{
    if (!model)
        return;

    // watch for changes in vertices
    model.getAttribute("vertices").addModifiedCB(PhysicsSimulator_ModelVerticesModifiedCB, this);
    model.getAttribute("position").addModifiedCB(PhysicsSimulator_ModelPositionModifiedCB, this);
    model.getAttribute("rotation").addModifiedCB(PhysicsSimulator_ModelRotationModifiedCB, this);
    model.getAttribute("quaternion").addModifiedCB(PhysicsSimulator_ModelQuaternionModifiedCB, this);
    // watch for changes in scale
    model.getAttribute("scale").addModifiedCB(PhysicsSimulator_ModelScaleModifiedCB, this);
    // watch for changes in parent
    model.getAttribute("parent").addModifiedCB(PhysicsSimulator_ModelParentModifiedCB, this);
    // watch for changes in enabled
    model.getAttribute("enabled").removeModifiedCB(PhysicsSimulator_ModelEnabledModifiedCB, this); // ensure no dups (not removed by delete)
    model.getAttribute("enabled").addModifiedCB(PhysicsSimulator_ModelEnabledModifiedCB, this);

    // if model is disabled, don't create
    if (model.getAttribute("enabled").getValueDirect() == false)
        return;
    
    // if model is parented, don't add here; it will be added as a shape to the parent model's body
    if (model.motionParent)
        return;

    var shape = this.getCompoundShape(model);

    var properties = this.getNetProperties(model);

    var transform = new Ammo.btTransform();
    transform.setIdentity();

    var position = model.getAttribute("sectorPosition").getValueDirect();
    // temporary fix to remove y-axis padding between static and dynamic objects
    if (properties.mass == 0)
    {
        position.y -= 0.075;
    }
    var vector = new Ammo.btVector3(position.x, position.y, position.z);
    transform.setOrigin(vector);
    Ammo.destroy(vector);

    var quat = model.getAttribute("quaternion").getValueDirect();
    var quaternion = new Ammo.btQuaternion(quat.x, quat.y, quat.z, quat.w);
    transform.setRotation(quaternion);
    Ammo.destroy(quaternion);

    var isDynamic = (properties.mass != 0);
    var localInertia = new Ammo.btVector3(0, 0, 0);
    if (isDynamic)
    {
        shape.calculateLocalInertia(properties.mass, localInertia);
    }

    var motionState = new Ammo.btDefaultMotionState(transform);
    Ammo.destroy(transform);
    var rbInfo = new Ammo.btRigidBodyConstructionInfo(properties.mass, motionState, shape, localInertia);
    rbInfo.set_m_friction(properties.friction);
    rbInfo.set_m_restitution(properties.restitution);
    Ammo.destroy(localInertia);
    var body = new Ammo.btRigidBody(rbInfo);
    Ammo.destroy(rbInfo);

    this.world.addRigidBody(body);
    //if (isDynamic)
    {
        this.bodyModels.push(model);
        this.physicsShapes.push(shape);
        this.physicsBodies.push(body);
        this.bodyAdded.push(true);
    }
}

PhysicsSimulator.prototype.deletePhysicsBody = function(model)
{
    for (var i = 0; i < this.bodyModels.length; i++)
    {
        if (this.bodyModels[i] == model)
        {
            this.bodyModels[i].getAttribute("vertices").removeModifiedCB(PhysicsSimulator_ModelVerticesModifiedCB, this);
            this.bodyModels[i].getAttribute("position").removeModifiedCB(PhysicsSimulator_ModelPositionModifiedCB, this);
            this.bodyModels[i].getAttribute("rotation").removeModifiedCB(PhysicsSimulator_ModelRotationModifiedCB, this);
            this.bodyModels[i].getAttribute("quaternion").removeModifiedCB(PhysicsSimulator_ModelQuaternionModifiedCB, this);
            this.bodyModels[i].getAttribute("scale").removeModifiedCB(PhysicsSimulator_ModelScaleModifiedCB, this);
            this.bodyModels[i].getAttribute("parent").removeModifiedCB(PhysicsSimulator_ModelParentModifiedCB, this);
            //this.bodyModels[i].getAttribute("enabled").removeModifiedCB(PhysicsSimulator_ModelEnabledModifiedCB, this);
            this.world.removeRigidBody(this.physicsBodies[i]);
            Ammo.destroy(this.physicsShapes[i]);
            Ammo.destroy(this.physicsBodies[i].getMotionState());
            Ammo.destroy(this.physicsBodies[i]);
            this.physicsBodies.splice(i, 1);
            this.physicsShapes.splice(i, 1);
            this.bodyModels.splice(i, 1);
            this.bodyAdded.splice(i, 1);
            return;
        }
    }
}

PhysicsSimulator.prototype.getCompoundShape = function(model)
{
    var compoundShape = new Ammo.btCompoundShape();

    var position = new Vector3D();
    var rotation = new Vector3D();
    var scale = model.getAttribute("scale").getValueDirect();
    this.addCollisionShape(model, position, rotation, scale, compoundShape);

    return compoundShape;
}

PhysicsSimulator.prototype.addCollisionShape = function(model, position, rotation, scale, compoundShape)
{
    var center = model.getAttribute("center").getValueDirect();
    
    for (var i = 0; i < model.surfaces.length; i++)
    {
        var shape = this.getCollisionShape(model.surfaces[i], center, scale);

        var transform = new Ammo.btTransform();
        transform.setIdentity();
        var origin = new Ammo.btVector3(position.x, position.y, position.z);
        transform.setOrigin(origin);
        Ammo.destroy(origin);
        var quat = new Quaternion();
        quat.loadXYZAxisRotation(rotation.x, rotation.y, rotation.z);
        var quaternion = new Ammo.btQuaternion(quat.x, quat.y, quat.z, quat.w);
        transform.setRotation(quaternion);
        Ammo.destroy(quaternion);

        compoundShape.addChildShape(transform, shape);
        Ammo.destroy(transform);
    }

    // recurse on motion children
    for (var i = 0; i < model.motionChildren.length; i++)
    {
        var child = model.motionChildren[i];

        var childPosition = child.getAttribute("position").getValueDirect();
        childPosition.x += position.x;
        childPosition.y += position.y;
        childPosition.z += position.z;

        var childRotation = child.getAttribute("rotation").getValueDirect();
        childRotation.x += rotation.x;
        childRotation.y += rotation.y;
        childRotation.z += rotation.z;

        var childScale = child.getAttribute("scale").getValueDirect();
        childScale.x *= scale.x;
        childScale.y *= scale.y;
        childScale.z *= scale.z;

        this.addCollisionShape(child, childPosition, childRotation, childScale, compoundShape);
    }
}

PhysicsSimulator.prototype.getCollisionShape = function(surface, center, scale)
{
    // scale vertices
    var scaleMatrix = new Matrix4x4();
    scaleMatrix.loadScale(scale.x, scale.y, scale.z);

    var matrix = scaleMatrix;
    
    var shape = new Ammo.btConvexHullShape();
    var verts = surface.getAttribute("vertices").getValueDirect();
    for (var i = 0; i < verts.length; i += 3)
    {
        //var vert = matrix.transform(verts[i] - center.x, verts[i + 1] /*- center.y*/, verts[i + 2] - center.z, 1);
        var vert = matrix.transform(verts[i], verts[i + 1], verts[i + 2], 1);
        var point = new Ammo.btVector3(vert.x, vert.y, vert.z);
        shape.addPoint(point);
        Ammo.destroy(point);
    }

    return shape;
}

PhysicsSimulator.prototype.getNetProperties = function(model)
{
    var mass = 0;  
    var friction = 0;
    var restitution = 0;

    // calculate scaled mass for model
    var scale = model.getAttribute("scale").getValueDirect();
    var avgScale = (scale.x + scale.y + scale.z) / 3;
    var physicalProperties = model.getAttribute("physicalProperties");
    var mass = physicalProperties.getAttribute("mass").getValueDirect() * avgScale;
    var friction = physicalProperties.getAttribute("friction").getValueDirect();
    var restitution = physicalProperties.getAttribute("restitution").getValueDirect();
    
    // add children's properties (if any)
    for (var i = 0; i < model.motionChildren.length; i++)
    {
        var childProperties = this.getNetProperties(model.motionChildren[i]);
        mass += childProperties.mass;
        friction += childProperties.friction;
        restitution += childProperties.restitution;
    }

    return { mass: mass, friction: friction, restitution: restitution };
}

PhysicsSimulator.prototype.updatePhysicsShape = function(model)
{
    // locate array position of model
    var n = -1;
    for (var i = 0; i < this.bodyModels.length; i++)
    {
        if (this.bodyModels[i] == model)
        {
            n = i;
            break;
        }
    }
    if (n == -1)
        return;

    var shape = this.getCompoundShape(model);

    var properties = this.getNetProperties(model);

    var isDynamic = (properties.mass != 0);
    var localInertia = new Ammo.btVector3(0, 0, 0);
    if (isDynamic)
    {
        shape.calculateLocalInertia(properties.mass, localInertia);
    }

    var motionState = this.physicsBodies[n].getMotionState();
    var rbInfo = new Ammo.btRigidBodyConstructionInfo(properties.mass, motionState, shape, localInertia);
    rbInfo.set_m_friction(properties.friction);
    rbInfo.set_m_restitution(properties.restitution);
    Ammo.destroy(localInertia);
    var body = new Ammo.btRigidBody(rbInfo);
    Ammo.destroy(rbInfo);

    // remove previous before adding
    this.world.removeRigidBody(this.physicsBodies[n]);
    Ammo.destroy(this.physicsBodies[n]);
    // don't destroy motionState because it's now being used by the new body

    this.world.addRigidBody(body);
    this.physicsBodies[n] = body;
    this.physicsShapes[n] = shape;
}

PhysicsSimulator.prototype.updatePhysicsBodyPosition = function(n, clearRotationQuat)
{
    var model = this.bodyModels[n];
    if (!model)
        return;
    var body = this.physicsBodies[n];
    if (!body)
        return;
    
    var transform = new Ammo.btTransform();
    transform.setIdentity();

    var position = model.getAttribute("sectorPosition").getValueDirect();
    var vector = new Ammo.btVector3(position.x, position.y, position.z);
    transform.setOrigin(vector);
    Ammo.destroy(vector);

    // update rotation to include rotation caused by object inspection
    var rotationGroup = getInspectionGroup(model);
    if (rotationGroup)
    {
        var rotationQuat = rotationGroup.getChild(2).getAttribute("rotationQuat").getValueDirect();
        var quat1 = new Quaternion();
        quat1.load(rotationQuat.w, rotationQuat.x, rotationQuat.y, rotationQuat.z);

        var modelQuat = model.getAttribute("quaternion").getValueDirect();
        var quat2 = new Quaternion();
        quat2.load(modelQuat.w, modelQuat.x, modelQuat.y, modelQuat.z);

        var quat = quat2.multiply(quat1);

        var quaternion = new Ammo.btQuaternion(quat.x, quat.y, quat.z, quat.w);
        transform.setRotation(quaternion);
        Ammo.destroy(quaternion);

        // clear inspection group's rotation
        if (clearRotationQuat)
        {
            rotationGroup.getChild(2).getAttribute("rotationQuat").setValueDirect(new Quaternion());
        }
    }
    
    body.setWorldTransform(transform);
    body.getMotionState().setWorldTransform(transform);
    body.activate(true);
    Ammo.destroy(transform);
}

PhysicsSimulator.prototype.initPhysics = function()
{
    if (this.collisionConfiguration)
        Ammo.destroy(this.collisionConfiguration);
    if (this.dispatcher)
        Ammo.destroy(this.dispatcher);
    if (this.overlappingPairCache)
        Ammo.destroy(this.overlappingPairCache);
    if (this.solver)
        Ammo.destroy(this.solver);
    //if (this.world) Ammo.destroy(this.world);

    this.collisionConfiguration = new Ammo.btDefaultCollisionConfiguration();
    this.dispatcher = new Ammo.btCollisionDispatcher(this.collisionConfiguration);
    this.overlappingPairCache = new Ammo.btDbvtBroadphase();
    this.solver = new Ammo.btSequentialImpulseConstraintSolver();
    this.world = new Ammo.btDiscreteDynamicsWorld(this.dispatcher, this.overlappingPairCache, this.solver, this.collisionConfiguration);

    var gravity = this.gravity.getValueDirect();
    this.world.setGravity(new Ammo.btVector3(gravity.x, gravity.y, gravity.z));
}

PhysicsSimulator.prototype.bodiesModified = function()
{
    this.updateBodies = true;
}

PhysicsSimulator.prototype.modelEnabledModified = function(model, enabled)
{
    if (enabled)
    {
        this.deletePhysicsBody(model); // ensure model is not added multiple times
        this.createPhysicsBody(model);
    }
    else // !enabled
    {
        this.deletePhysicsBody(model);
    }
}

function PhysicsSimulator_GravityModifiedCB(attribute, container)
{
    container.updateWorld = true;
}

function PhysicsSimulator_BodiesModifiedCB(attribute, container)
{
    container.bodiesModified();
}

function PhysicsSimulator_ModelVerticesModifiedCB(attribute, container)
{
    container.updatePhysicsShape(attribute.getContainer());
}

function PhysicsSimulator_ModelPositionModifiedCB(attribute, container)
{
    //container.updatePhysicsBodyPosition(container.getPhysicsBodyIndex(attribute.getContainer()));
    //container.updateBodyPositions.push(container.getPhysicsBodyIndex(attribute.getContainer()));
    var index = container.getPhysicsBodyIndex(attribute.getContainer());
    for (var i = 0 ; i < container.updateBodyPositions.length; i++)
    {
        if (container.updateBodyPositions[i] == index)
            return;
    }
    container.updateBodyPositions.push(index);
}

function PhysicsSimulator_ModelRotationModifiedCB(attribute, container)
{
    //container.updatePhysicsBodyPosition(container.getPhysicsBodyIndex(attribute.getContainer()));
    //container.updateBodyPositions.push(container.getPhysicsBodyIndex(attribute.getContainer()));
    var index = container.getPhysicsBodyIndex(attribute.getContainer());
    for (var i = 0 ; i < container.updateBodyPositions.length; i++)
    {
        if (container.updateBodyPositions[i] == index)
            return;
    }
    container.updateBodyPositions.push(index);
}

function PhysicsSimulator_ModelQuaternionModifiedCB(attribute, container)
{
    //container.updatePhysicsBodyPosition(container.getPhysicsBodyIndex(attribute.getContainer()));
    //container.updateBodyPositions.push(container.getPhysicsBodyIndex(attribute.getContainer()));
    var index = container.getPhysicsBodyIndex(attribute.getContainer());
    for (var i = 0 ; i < container.updateBodyPositions.length; i++)
    {
        if (container.updateBodyPositions[i] == index)
            return;
    }
    container.updateBodyPositions.push(index);
}

function PhysicsSimulator_ModelScaleModifiedCB(attribute, container)
{
    container.updatePhysicsShape(attribute.getContainer());
}

function PhysicsSimulator_ModelParentModifiedCB(attribute, container)
{
    container.updateBodies = true;
}

function PhysicsSimulator_ModelEnabledModifiedCB(attribute, container)
{
    container.modelEnabledModified(attribute.getContainer(), attribute.getValueDirect());
}

SnapModelDescriptor.prototype = new AttributeContainer();
SnapModelDescriptor.prototype.constructor = SnapModelDescriptor;

function SnapModelDescriptor()
{
    AttributeContainer.call(this);
    this.className = "SnapModelDescriptor";
    this.attrType = eAttrType.SnapModelDescriptor;
    
    this.name = new StringAttr();
    this.position = new Vector3DAttr();
    this.quaternion = new QuaternionAttr();

    this.registerAttribute(this.name, "name");
    this.registerAttribute(this.position, "position");
    this.registerAttribute(this.quaternion, "quaternion");
}

SnapModelDescriptors.prototype = new AttributeVector();
SnapModelDescriptors.prototype.constructor = SnapModelDescriptors;

function SnapModelDescriptors()
{
    AttributeVector.call(this, new SnapModelDescriptorAllocator());
    this.className = "SnapModelDescriptors";
    this.attrType = eAttrType.SnapModelDescriptors;

    this.appendParsedElements.setValueDirect(true);
}

SnapModelDescriptorAllocator.prototype = new Allocator();
SnapModelDescriptorAllocator.prototype.constructor = SnapModelDescriptorAllocator;

function SnapModelDescriptorAllocator()
{
}

SnapModelDescriptorAllocator.prototype.allocate = function ()
{
    return new SnapModelDescriptor();
}

function SnapRec()
{
    this.model = null;
    this.matrix = null;
    this.surfaces = [];
    this.geometries = [];
    this.vertices_start = 0;
    this.vertices_count = 0;
    this.genericConnectors = [];
    this.plugConnectors = [];
    this.socketConnectors = [];
}

SnapModel.prototype = new Model();
SnapModel.prototype.constructor = SnapModel;

function SnapModel()
{
    Model.call(this);
    this.className = "SnapModel";
    this.attrType = eAttrType.SnapModel;
    
    this.snaps = [];
}

SnapModel.prototype.snap = function(model, matrix)
{
    var i, j, k;
    var vertices, xvertices, xvertex;
    var normals, xnormals, normal, xnormal;
    var center, xcenter;
    
    var snapRec = new SnapRec();
    snapRec.model = model;
    snapRec.matrix = matrix;
    
    // disable (hide) model
    model.enabled.setValueDirect(false);
    
    // copy model surfaces to this
    var surfaces = model.surfaces;
    for (i = 0; i < surfaces.length; i++)
    {
        var surface = surfaces[i].clone();
        this.addSurface(surface);
        surface.snappedModel = model;
        snapRec.surfaces.push(surface);

        // enable surface (disabled by model.enabled set above)
        surface.enabled.setValueDirect(true);
        
        // target original surfaces to retain changes made to snapped surface
        surface.color.addTarget(surfaces[i].color, eAttrSetOp.Replace, null, false);
        surface.ambientLevel.addTarget(surfaces[i].ambientLevel, eAttrSetOp.Replace, null, false);
        surface.diffuseLevel.addTarget(surfaces[i].diffuseLevel, eAttrSetOp.Replace, null, false);
        surface.specularLevel.addTarget(surfaces[i].specularLevel, eAttrSetOp.Replace, null, false);
        surface.emissiveLevel.addTarget(surfaces[i].emissiveLevel, eAttrSetOp.Replace, null, false);
        surface.ambient.addTarget(surfaces[i].ambient, eAttrSetOp.Replace, null, false);
        surface.diffuse.addTarget(surfaces[i].diffuse, eAttrSetOp.Replace, null, false);
        surface.specular.addTarget(surfaces[i].specular, eAttrSetOp.Replace, null, false);
        surface.emissive.addTarget(surfaces[i].emissive, eAttrSetOp.Replace, null, false);
        surface.glossiness.addTarget(surfaces[i].glossiness, eAttrSetOp.Replace, null, false);
        surface.opacity.addTarget(surfaces[i].opacity, eAttrSetOp.Replace, null, false);
        surface.doubleSided.addTarget(surfaces[i].doubleSided, eAttrSetOp.Replace, null, false);
        surface.texturesEnabled.addTarget(surfaces[i].texturesEnabled, eAttrSetOp.Replace, null, false);
       
        // transform vertices
        xvertices = [];
        vertices = surface.getAttribute("vertices").getValueDirect();
        for (j = 0; j < vertices.length; j += 3)
        {
            xvertex = matrix.transform(vertices[j], vertices[j + 1], vertices[j + 2], 1);
            xvertices.push(xvertex.x);
            xvertices.push(xvertex.y);
            xvertices.push(xvertex.z);
        }
        surface.getAttribute("vertices").setValueDirect(xvertices);
    
        // copy geometry
        var geometries = surfaces[i].geometries;
        for (j = 0; j < geometries.length; j++)
        {
            var geometry = geometries[j].clone();
            geometry.surface = surface;

            // transform vertices/normals
            xvertices = [];
            vertices = geometry.getAttribute("vertices").getValueDirect();
            for (k = 0; k < vertices.length; k += 3)
            {
                xvertex = matrix.transform(vertices[k], vertices[k + 1], vertices[k + 2], 1);
                xvertices.push(xvertex.x);
                xvertices.push(xvertex.y);
                xvertices.push(xvertex.z);
            }
            geometry.getAttribute("vertices").setValueDirect(xvertices);

            xnormals = [];
            normals = geometry.getAttribute("normals").getValueDirect();
            for (k = 0; k < normals.length; k += 3)
            {
                xnormal = matrix.transform(normals[k], normals[k + 1], normals[k + 2], 0);
                xnormals.push(xnormal.x);
                xnormals.push(xnormal.y);
                xnormals.push(xnormal.z);
            }
            geometry.getAttribute("normals").setValueDirect(xnormals);

            this.addGeometry(geometry, null, surface);
            snapRec.geometries.push(geometry);
        }
    }
    
    // append (transformed) model vertices to snappee
    xvertices = [];
    vertices = model.vertices.getValueDirect();
    for (i = 0; i < vertices.length; i += 3)
    {
        xvertex = matrix.transform(vertices[i], vertices[i + 1], vertices[i + 2], 1);
        xvertices.push(xvertex.x);
        xvertices.push(xvertex.y);
        xvertices.push(xvertex.z);
    }
    vertices = this.vertices.getValueDirect();   
    snapRec.vertices_start = vertices.length;
    snapRec.vertices_count = xvertices.length;
    vertices = vertices.concat(xvertices);
    this.vertices.setValueDirect(vertices);
   
    // copy (transformed) snap connectors to snappee
    
    // generics
    var genericConnectors = model.genericConnectors;
    for (i = 0; i < genericConnectors.Size(); i++)
    {
        var genericConnector = genericConnectors.getAt(i);
        var xgenericConnector = new GenericConnector();
        xgenericConnector.synchronize(genericConnector);
        
        normal = xgenericConnector.normal.getValueDirect();
        xnormal = matrix.transform(normal.x, normal.y, normal.z, 0);
        xgenericConnector.normal.setValueDirect(xnormal.x, xnormal.y, xnormal.z);
        
        center = xgenericConnector.point.center.getValueDirect();
        xcenter = matrix.transform(center.x, center.y, center.z, 1);
        xgenericConnector.point.center.setValueDirect(xcenter.x, xcenter.y, xcenter.z);
        
        this.genericConnectors.push_back(xgenericConnector);
        snapRec.genericConnectors.push(xgenericConnector);
    }
    
    // plugs  
    var plugConnectors = model.plugConnectors;
    for (i = 0; i < plugConnectors.Size(); i++)
    {
        var plugConnector = plugConnectors.getAt(i);
        var xplugConnector = new PlugConnector();
        xplugConnector.synchronize(plugConnector);
        
        normal = xgenericConnector.normal.getValueDirect();
        xnormal = matrix.transform(normal.x, normal.y, normal.z, 0);
        xgenericConnector.normal.setValueDirect(xnormal.x, xnormal.y, xnormal.z);
        
        center = xplugConnector.pin1.center.getValueDirect();
        xcenter = matrix.transform(center.x, center.y, center.z, 1);
        xplugConnector.pin1.center.setValueDirect(xcenter.x, xcenter.y, xcenter.z);
        
        center = xplugConnector.pin2.center.getValueDirect();
        xcenter = matrix.transform(center.x, center.y, center.z, 1);
        xplugConnector.pin2.center.setValueDirect(xcenter.x, xcenter.y, xcenter.z);
        
        this.plugConnectors.push_back(xplugConnector);
        snapRec.plugConnectors.push(xplugConnector);
    }
    
    // sockets
    var socketConnectors = model.socketConnectors;
    for (i = 0; i < socketConnectors.Size(); i++)
    {
        var socketConnector = socketConnectors.getAt(i);
        var xsocketConnector = new SocketConnector();
        xsocketConnector.synchronize(socketConnector);
        
        normal = xgenericConnector.normal.getValueDirect();
        xnormal = matrix.transform(normal.x, normal.y, normal.z, 0);
        xgenericConnector.normal.setValueDirect(xnormal.x, xnormal.y, xnormal.z);
        
        center = xsocketConnector.slot1.center.getValueDirect();
        xcenter = matrix.transform(center.x, center.y, center.z, 1);
        xsocketConnector.slot1.center.setValueDirect(xcenter.x, xcenter.y, xcenter.z);
        
        center = xsocketConnector.slot2.center.getValueDirect();
        xcenter = matrix.transform(center.x, center.y, center.z, 1);
        xsocketConnector.slot2.center.setValueDirect(xcenter.x, xcenter.y, xcenter.z);
        
        this.socketConnectors.push_back(xsocketConnector);
        snapRec.socketConnectors.push(xsocketConnector);
    }
    
    // append name
    //var name = this.name.getValueDirect().join("");
    //name += "_" + model.name.getValueDirect().join("");
    //this.name.setValueDirect(name);
    
    // add snap entry
    this.snaps[model.__nodeId__] = snapRec;
}

SnapModel.prototype.unsnap = function(model)
{
    var i;
    
    var snapRec = this.snaps[model.__nodeId__];
    if (!snapRec) return;
    
    // remove model's surfaces and synchronize original model's corresponding 
    // surface attributes to retain changes applied to this
    for (i = 0; i < snapRec.surfaces.length; i++)
    {   
        var surface = snapRec.surfaces[i];
        
        // untarget original surfaces
        surface.color.removeTarget(model.surfaces[i].color);
        surface.ambientLevel.removeTarget(model.surfaces[i].ambientLevel);
        surface.diffuseLevel.removeTarget(model.surfaces[i].diffuseLevel);
        surface.specularLevel.removeTarget(model.surfaces[i].specularLevel);
        surface.emissiveLevel.removeTarget(model.surfaces[i].emissiveLevel);
        surface.ambient.removeTarget(model.surfaces[i].ambient);
        surface.diffuse.removeTarget(model.surfaces[i].diffuse);
        surface.specular.removeTarget(model.surfaces[i].specular);
        surface.emissive.removeTarget(model.surfaces[i].emissive);
        surface.glossiness.removeTarget(model.surfaces[i].glossiness);
        surface.opacity.removeTarget(model.surfaces[i].opacity);
        surface.doubleSided.removeTarget(model.surfaces[i].doubleSided);
        surface.texturesEnabled.removeTarget(model.surfaces[i].texturesEnabled);
        
        this.removeSurface(surface);
    }
    
    // remove model's geometries
    for (i = 0; i < snapRec.geometries.length; i++)
    {
        this.removeGeometry(snapRec.geometries[i], null, snapRec.geometries[i].surface);
    }
    
    // remove model's vertices
    var vertices = this.vertices.getValueDirect();
    vertices.splice(snapRec.vertices_start, snapRec.vertices_count);
    this.vertices.setValueDirect(vertices);
    
    // remove model's snapConnectors
    for (i = 0; i < snapRec.genericConnectors.length; i++)
    {
        this.genericConnectors.erase(snapRec.genericConnectors[i]);
    }
    for (i = 0; i < snapRec.plugConnectors.length; i++)
    {
        this.plugConnectors.erase(snapRec.plugConnectors[i]);
    }
    for (i = 0; i < snapRec.socketConnectors.length; i++)
    {
        this.socketConnectors.erase(snapRec.socketConnectors[i]);
    }
    
    // clear snapConnector's connected flags
    var genericConnectors = model.genericConnectors;
    for (i = 0; i < genericConnectors.Size(); i++)
    {
        genericConnectors.getAt(i).getAttribute("connected").setValueDirect(false);
    }
    var plugConnectors = model.plugConnectors;
    for (i = 0; i < plugConnectors.Size(); i++)
    {
        plugConnectors.getAt(i).getAttribute("connected").setValueDirect(false);
    }
    var socketConnectors = model.socketConnectors;
    for (i = 0; i < socketConnectors.Size(); i++)
    {
        socketConnectors.getAt(i).getAttribute("connected").setValueDirect(false);
    }
        
    // set model's position
    var matrix = snapRec.matrix;
    
    var position = matrix.transform(0, 0, 0, 1);
    model.position.setValueDirect(position.x, position.y, position.z);

    var rotationAngles = matrix.getRotationAngles();
    model.rotation.setValueDirect(rotationAngles.x, rotationAngles.y, rotationAngles.z);

    model.setMotionParent(this);
    zeroInspectionGroup(model);
    model.updateSimpleTransform();
    model.updateCompoundTransform();
    model.setMotionParent(null);

    matrix = model.sectorTransformCompound;

    position = matrix.transform(0, 0, 0, 1);
    model.position.setValueDirect(position.x, position.y, position.z);

    var quaternion = matrix.getQuaternion();
    model.quaternion.setValueDirect(quaternion);
        
    // enable (show) model
    model.enabled.setValueDirect(true);
    
    // clear snap entry
    this.snaps[model.__nodeId__] = undefined;
}

SnapModel.prototype.unsnapAll = function()
{
    var unsnapped = [];
    
    var snaps = this.snaps.slice();
    for (var i in snaps)
    {
        this.unsnap(snaps[i].model);
        unsnapped.push(snaps[i].model);
    }
    
    // remove this
    this.getParent(0).removeChild(this);
    // remove from registry
    this.registry.unregister(this);
    // delete
    //this.destroy();
    
    return unsnapped;
}

SnapModel.prototype.getSnapped = function()
{
    var i;
    var descriptors = new SnapModelDescriptors();
    
    for (i in this.snaps)
    {
        var snapRec = this.snaps[i];
        var model = snapRec.model;
        
        // get model's position
        var matrix = snapRec.matrix;

        var position = matrix.transform(0, 0, 0, 1);
        model.position.setValueDirect(position.x, position.y, position.z);

        var rotationAngles = matrix.getRotationAngles();
        model.rotation.setValueDirect(rotationAngles.x, rotationAngles.y, rotationAngles.z);

        model.setMotionParent(this);
        zeroInspectionGroup(model);
        model.updateSimpleTransform();
        model.updateCompoundTransform();
        model.setMotionParent(null);

        matrix = model.sectorTransformCompound;

        position = matrix.transform(0, 0, 0, 1);
        var quaternion = matrix.getQuaternion();
        
        var descriptor = new SnapModelDescriptor();
        descriptor.name.copyValue(model.name);
        descriptor.position.setValueDirect(position.x, position.y, position.z);
        descriptor.quaternion.setValueDirect(quaternion);
        
        descriptors.push_back(descriptor);
    }
    
    return descriptors;
}
    
SnapModel.prototype.apply = function(directive, params, visitChildren)
{
    // call base-class implementation
    Model.prototype.apply.call(this, directive, params, visitChildren);
}

SnapModel.prototype.connectSurfaceAttribute = function(surface, attribute, name)
{
    // don't replace snapped surface's attribute value
    attribute.addTarget(surface.getAttribute(name), eAttrSetOp.Replace, null, false);
}
Animator.prototype = new Evaluator();
Animator.prototype.constructor = Animator;
    
function Animator()
{
    Evaluator.call(this);
    this.className = "Animator";
    this.attrType = eAttrType.Animator;
    
    this.targetObject = null;
    
    this.timeIncrement = new NumberAttr();
    this.target = new StringAttr("");
    
    this.target.addModifiedCB(Animator_TargetModifiedCB, this);
    
    this.registerAttribute(this.timeIncrement, "timeIncrement");
    this.registerAttribute(this.target, "target");
}

Animator.prototype.evaluate = function()
{    
}

Animator.prototype.targetModified = function(targetObject)
{
    this.targetObject = targetObject;
}

function Animator_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    var resource = container.registry.find(target);
    if (resource)
    {
        container.targetModified(resource);
    }
}


Spinner.prototype = new Animator();
Spinner.prototype.constructor = Spinner;
    
function Spinner()
{
    Animator.call(this);
    this.className = "Spinner";
    this.attrType = eAttrType.Spinner;
    
    this.targetCenter = new Vector3D();
    
    this.axisEndpoint = new Vector3DAttr(0, 0, 0);
    this.angularVelocity = new NumberAttr(0);
    
    this.registerAttribute(this.axisEndpoint, "axisEndpoint");
    this.registerAttribute(this.angularVelocity, "angularVelocity");
}

Spinner.prototype.evaluate = function()
{
    if (!this.targetObject) return;
    
    var timeIncrement = this.timeIncrement.getValueDirect()
    var angularVelocity = this.targetObject.angularVelocity.getValueDirect();
    
    var axisEndpoint = this.axisEndpoint.getValueDirect();   
    var axis = new Vector3D(axisEndpoint.x - this.targetCenter.x,
        axisEndpoint.y - this.targetCenter.y, 
        axisEndpoint.z - this.targetCenter.z);
    
    var spinQuat = new Quaternion();
    spinQuat.loadXYZAxisRotation(axis.x, axis.y, axis.z, this.angularVelocity.getValueDirect() * timeIncrement);
    
    var quaternion = this.targetObject.quaternion.getValueDirect();
    quaternion = spinQuat.multiply(quaternion);
    
    this.targetObject.quaternion.setValueDirect(quaternion);
}

Spinner.prototype.targetModified = function(targetObject)
{
    this.targetObject = targetObject;
    if (targetObject)
    {    
        // get center
        this.targetCenter = targetObject.center.getValueDirect();
    }
}


var eEventType = {
    Unknown                     :-1,
    
    Render_First                :0,
    RenderBegin                 :1,
    RenderEnd                   :2,
    Render_End                  :9,
    
    Mouse_First                 :100,
    MouseMove                   :101,
    MouseDown                   :102,
    MouseLeftDown               :103,
    MouseMiddleDown             :104,
    MouseRightDown              :105,
    MouseAllDown                :106,
    MouseBothDown               :107,
    MouseWheelDown              :108,
    MouseUp                     :109,
    MouseLeftUp                 :110,
    MouseRightUp                :111,
    MouseMiddleUp               :112,
    MouseWheelUp                :113,
    MouseLeftClick              :114,
    MouseMiddleClick            :115,
    MouseRightClick             :116,
    MouseLeftDblClick           :117,
    MouseMiddleDblClick         :118,
    MouseRightDblClick          :119,
    MouseDrag                   :120,
    MouseWheelForward           :121,
    MouseWheelBackward          :122,
    MouseHover                  :123,
    MouseLeave                  :124,	// fires when the mouse leaves the client area of the window
    MouseOver                   :125,	// fires when the mouse is moved onto an element
    MouseOut                    :126,	// fires when the mouse is moved off an element
    Mouse_Last                  :199,

    Key_First                   :200,
    KeyDown_First               :201,
    KeyDown_Last                :500,
    KeyUp_First                 :501,
    KeyUp_Last                  :798,
    Key_Last                    :799,
    
    Element_First               :800,
    ElementSelected             :801,
    ElementUnselected           :802,
    ElementFocus                :803,
    ElementBlur                 :804,
    Element_Last                :899,
    
    UserDefined                 :2000
};

var eEventNameMap = {
    "MButton1"                  : eEventType.MouseLeftDown,
    "MButton1.Down"             : eEventType.MouseLeftDown,
    "MButton2"                  : eEventType.MouseMiddleDown,
    "MButton2.Down"             : eEventType.MouseMiddleDown,
    "MButton3"                  : eEventType.MouseRightDown,
    "MButton3.Down"             : eEventType.MouseRightDown,
    "MButton1+MButton2.Down"    : eEventType.MouseBothDown,
    "MButton2+MButton3.Down"    : eEventType.MouseBothDown,
    "MButton1+MButton3.Down"    : eEventType.MouseBothDown,
    "MButton1.Click"            : eEventType.MouseLeftClick,
    "MButton1.DoubleClick"      : eEventType.MouseLeftDblClick,
    "MButton1.Up"               : eEventType.MouseLeftUp,
    "MButton2.Click"            : eEventType.MouseMiddleClick,
    "MButton2.DoubleClick"      : eEventType.MouseMiddleDblClick,
    "MButton2.Up"               : eEventType.MouseMiddleUp,
    "MButton3.Click"            : eEventType.MouseRightClick,
    "MButton3.DoubleClick"      : eEventType.MouseRightDblClick,
    "MButton3.Up"               : eEventType.MouseRightUp,
    "MWheel"                    : eEventType.MouseWheelDown,
    "MWheel.Down"               : eEventType.MouseWheelDown,
    "MWheel.Click"              : eEventType.MouseWheelUp,
    "MWheel.Up"                 : eEventType.MouseWheelUp,
    "Mouse.Move"                : eEventType.MouseMove,
    "Mouse.Hover"               : eEventType.MouseHover,
    "Mouse.Leave"               : eEventType.MouseLeave,
    "Mouse.Over"                : eEventType.MouseOver,
    "Mouse.Out"                 : eEventType.MouseOut,
    "Element.Selected"          : eEventType.ElementSelected,
    "Element.Unselected"        : eEventType.ElementUnselected,
    "Element.Focus"             : eEventType.ElementFocus,
    "Element.Blur"              : eEventType.ElementBlur
};

// map of VK_* strings to javascript key codes
var eKeyCodeMap = {
    "VK_BACK"                   : 8,
    "VK_TAB"                    : 9,
    "VK_ENTER"                  : 13,
    "VK_SHIFT"                  : 16,
    "VK_CONTROL"                : 17,
    "VK_ALT"                    : 18,
    "VK_PAUSE"                  : 19,
    "VK_CAPITAL"                : 20,
    "VK_ESCAPE"                 : 27,
    "VK_PAGEUP"                 : 33,
    "VK_PAGEDOWN"               : 34,
    "VK_END"                    : 35,
    "VK_HOME"                   : 36,
    "VK_LEFT"                   : 37,
    "VK_UP"                     : 38,
    "VK_RIGHT"                  : 39,
    "VK_DOWN"                   : 40,
    "VK_INSERT"                 : 45,
    "VK_DELETE"                 : 46,
    "VK_0"                      : 48,
    "VK_1"                      : 49,
    "VK_2"                      : 50,
    "VK_3"                      : 51,
    "VK_4"                      : 52,
    "VK_5"                      : 53,
    "VK_6"                      : 54,
    "VK_7"                      : 55,
    "VK_8"                      : 56,
    "VK_9"                      : 57,
    "VK_A"                      : 65,
    "VK_B"                      : 66,
    "VK_C"                      : 67,
    "VK_D"                      : 68,
    "VK_E"                      : 69,
    "VK_F"                      : 70,
    "VK_G"                      : 71,
    "VK_H"                      : 72,
    "VK_I"                      : 73,
    "VK_J"                      : 74,
    "VK_K"                      : 75,
    "VK_L"                      : 76,
    "VK_M"                      : 77,
    "VK_N"                      : 78,
    "VK_O"                      : 79,  
    "VK_P"                      : 80,
    "VK_Q"                      : 81,
    "VK_R"                      : 82,    
    "VK_S"                      : 83,
    "VK_T"                      : 84,
    "VK_U"                      : 85,
    "VK_V"                      : 86,
    "VK_W"                      : 87,
    "VK_X"                      : 88,
    "VK_Y"                      : 89,
    "VK_Z"                      : 90,
    "VK_COMMA"                  : 189,
    "VK_PERIOD"                 : 190,
    "VK_SLASH"                  : 191
};

function getEventTypeByName(name)
{
    var type = eEventNameMap[name];
    
    if (type == undefined)
    {
        // key
        if (name.indexOf("VK") != -1)
        {
            var key = name;
            var state = "";
            var dot = name.indexOf(".");
            if (dot != -1)
            {
                // key
                key = name.substring(0, dot);
                // state
                state = name.substring(dot+1);
            }
                
            var keyCode = eKeyCodeMap[key];
            if (keyCode)
            {
                switch (state)
                {
                    case "Down":
                        type = eEventType.KeyDown_First + keyCode;
                        break;
                        
                    case "Up":
                    default:
                        type = eEventType.KeyUp_First + keyCode;
                        break;
                }
            }
        }     
    }   
    
    return type;
}
Event.prototype = new AttributeContainer();
Event.prototype.constructor = Event;

function Event(type, time, userData)
{
    AttributeContainer.call(this);
    this.className = "Event";
    
    this.type = type || eEventType.Unknown;
    this.time = time || 0;
    this.userData = userData || null;
}

Event.prototype.synchronize = function(src)
{
    this.type = src.type;
    this.time = src.time;
    this.userData = src.userData;
}
InputEvent.prototype = new Event();
InputEvent.prototype.constructor = InputEvent;

function InputEvent(type, time, inputId, modifiers, state, userData)
{
    Event.call(this, type, time, userData);
    this.className = "InputEvent";
    
    this.inputId = inputId || 0;
    this.modifiers = modifiers || 0;
    this.state = state || 0;
}

InputEvent.prototype.synchronize = function(src)
{
	this.inputId = src.inputId;
	this.modifiers = src.modifiers;
	this.state = src.state;

	Event.prototype.synchronize.call(this, src);
}
var MOUSEEVENT_LEFT_BUTTON     = 0x0001;
var MOUSEEVENT_MIDDLE_BUTTON   = 0x0002;
var MOUSEEVENT_RIGHT_BUTTON    = 0x0004;

MouseEvent.prototype = new InputEvent();
MouseEvent.prototype.constructor = MouseEvent;

function MouseEvent(type, time, buttonId, modifiers, state, x, y, userData)
{
    InputEvent.call(this, type, time, buttonId, modifiers, state, userData);
    this.className = "MouseEvent";
    
    this.x = x || 0;
    this.y = y || 0;
}
KeyboardEvent.prototype = new InputEvent();
KeyboardEvent.prototype.constructor = KeyboardEvent;

function KeyboardEvent(type, time, buttonId, modifiers, state, userData)
{
    InputEvent.call(this, type, time, buttonId, modifiers, state, userData);
    this.className = "KeyboardEvent";
}
function MouseEventState()
{
    this.leftButtonDown = false;
    this.middleButtonDown = false;
    this.rightButtonDown = false;
}

EventAdapter.prototype = new AttributeContainer();
EventAdapter.prototype.constructor = EventAdapter;

function EventAdapter()
{
    AttributeContainer.call(this);
    this.className = "EventAdapter";
    
    this.mouseState = new MouseEventState();
    
    this.name = new StringAttr("EventAdapter");
    
    this.registerAttribute(this.name, "name");
}

EventAdapter.prototype.createKeyboardEvent = function(event, eventType /* optional; used for "keyup" */)
{
    var date = new Date();
    
    var type = eEventType.Unknown;
    var time = date.getTime();
    var buttonId = event.keyCode;
    var modifiers = 0;  // TODO
    var state = 0;      // TODO
    
    var eventType = eventType || event.type;
    switch (eventType)
    {
        case "keydown":
            {
                type = eEventType.KeyDown_First + buttonId;
            }
            break;
            
        case "keypress":
            {
                type = eEventType.KeyDown_First + buttonId - 32; //  not sure why keycodes have +32 compared to keydown events
            }
            break;
            
        case "keyup":
            {
                type = eEventType.KeyUp_First + buttonId;
            }
            break;
    }
    
    var keyboardEvent = new KeyboardEvent(type, time, buttonId, modifiers, state);
    
    return keyboardEvent;
}

EventAdapter.prototype.createMouseEvent = function(event)
{
    var date = new Date();
    
    var type = eEventType.Unknown;
    var time = date.getTime();
    var buttonId = 0;
    var modifiers = 0;  // TODO
    var state = 0;      // TODO
    
    var x = event.canvasX;
    var y = event.canvasY;

    switch (event.type)
    {
    case "click":
        {
            switch (event.button)
            {
            case 0: type = eEventType.MouseLeftClick; break;
            case 1: type = eEventType.MouseMiddleDown; break;
            case 2: type = eEventType.MouseRightClick; break;
            } 
        }
        break;

    case "dblclick":
        {
            switch (event.button)
            {
            case 0: type = eEventType.MouseLeftDblClick; break;
            case 1: type = eEventType.MouseMiddleDblClick; break;
            case 2: type = eEventType.MouseRightDblClick; break;
            }    
        }
        break;
        
    case "mousedown":
        {
            switch (event.button)
            {
            case 0:
                { 
                    if (this.mouseState.rightButtonDown)
                    {
                        type = eEventType.MouseBothDown;
                    }
                    else 
                    {
                        type = eEventType.MouseLeftDown;
                    }
                    this.mouseState.leftButtonDown = true;
                }
                break;
                
            case 1: 
                {
                    type = eEventType.MouseMiddleDown;
                    this.mouseState.middleButtonDown = true;
                }
                break;
                
            case 2: 
                {
                    if (this.mouseState.leftButtonDown)
                    {
                        type = eEventType.MouseBothDown;
                    }
                    else 
                    {
                        type = eEventType.MouseRightDown;
                    }
                    this.mouseState.rightButtonDown = true;
                }
                break;
            }
        }
        break;
      
    case "mouseup":
        {
            switch (event.button)
            {
            case 0:
                { 
                    type = eEventType.MouseLeftUp; 
                    this.mouseState.leftButtonDown = false;
                }
                break;
                
            case 1: 
                {
                    type = eEventType.MouseMiddleUp;
                    this.mouseState.middleButtonDown = false;
                }
                break;
                
            case 2: 
                {
                    type = eEventType.MouseRightUp;
                    this.mouseState.rightButtonDown = false;
                }
                break;
            }
        }
        break;
        
    case "mousemove":
        {
            type = eEventType.MouseMove;
        }
        break;
        
        case "mousewheel":
        {
            type = eEventType.MouseWheelBackward;
        }
        break;

    default:
        {
            type = eEventType.UserDefined; // TEMPTEST (?)
        }
        break;
    }       
    
    // set which buttons are pressed to buttonId
    if (this.mouseState.leftButtonDown)     buttonId |= MOUSEEVENT_LEFT_BUTTON;
    if (this.mouseState.middleButtonDown)   buttonId |= MOUSEEVENT_MIDDLE_BUTTON;
    if (this.mouseState.rightButtonDown)    buttonId |= MOUSEEVENT_RIGHT_BUTTON;
    
    var mouseEvent = new MouseEvent(type, time, buttonId, modifiers, state, x, y);
    
    return mouseEvent;
}
EventListener.prototype = new Agent();
EventListener.prototype.constructor = EventListener;

function EventListener()
{
    Agent.call(this);
    this.className = "EventListener";
    
    this.events = [];
    
    this.listen = new BooleanAttr(true);
    this.trigger = new StringAttr("");
    this.numResponses = new NumberAttr(1);
    this.event = new StringAttr("");
    
    this.event.addModifiedCB(EventListener_EventModifiedCB, this);
    
    this.registerAttribute(this.listen, "listen");
    this.registerAttribute(this.trigger, "trigger");
    this.registerAttribute(this.numResponses, "numResponses");
    this.registerAttribute(this.event, "event");
}

EventListener.prototype.addEventType = function(type)
{
    this.events.push(type);
    
    // for serialization
    var name = this.event.getValueDirect().join("");
    var event = new StringAttr(name);
    event.flagDeserializedFromXML(); 
    this.events.push(event);
    this.registerAttribute(event, "event");
}

EventListener.prototype.getEventTypes = function()
{
    return this.events;
}

EventListener.prototype.eventPerformed = function(event)
{
    // decr numResponses
    var numResponses = this.numResponses.getValueDirect();
    if (numResponses > 0)
    {
        this.numResponses.setValueDirect(numResponses-1);
    }
}
EventListener.prototype.getTrigger = function()
{
    this.trigger;
}
EventListener.prototype.setTrigger = function(trigger)
{
    if(trigger)
    {
        this.trigger = trigger;
    }
}

function EventListener_EventModifiedCB(attribute, container)
{
    var type = getEventTypeByName(attribute.getValueDirect().join(""));
    // TODO -- restore the following line when all events are defined
    //if (type != eEventType.Unknown)
    {
        container.addEventType(type);
    }
}
EventMgr.prototype = new AttributeContainer();
EventMgr.prototype.constructor = EventMgr;

function EventMgr()
{
    AttributeContainer.call(this);
    this.className = "EventMgr";
    
    this.listeners = [];
    
    this.name = new StringAttr("EventMgr");
    
    this.registerAttribute(this.name, "name");
}

EventMgr.prototype.addListener = function(type, listener)
{
    if (this.listeners[type] == undefined)
    {
        this.listeners[type] = [];
    }
    
    // only add once
    if (this.listeners[type].indexOf(listener) == -1)
    {
        this.listeners[type].push(listener);
    }
}

EventMgr.prototype.removeListener = function(type, listener)
{
    if (this.listeners[type])
    {
        this.listeners[type].splice(this.listeners[type].indexOf(listener), 1);
    }    
}

EventMgr.prototype.processEvent = function(event)
{
    var type = event.type;
    var expired = [];
    
    // process event for registered listeners
    if (this.listeners[type])
    {
        for (var i=0; i < this.listeners[type].length; i++)
        {
            this.listeners[type][i].eventPerformed(event);
            
            // if listener has finished responding, add to expired list
            var numResponses = this.listeners[type][i].getAttribute("numResponses");
            if (numResponses && numResponses.getValueDirect() == 0)
            {
                expired.push(this.listeners[type][i]);
            }
        }
    }
    
    // remove expired listeners
    for (var i=0; i < expired.length; i++)
    {
        this.removeListener(type, expired[i]);
        this.registry.unregister(expired[i]);
    }
}
EventMgr.prototype.clearEvents = function()
{
/*
    this.bProcessingQs = false;
    this.bPendingRegistrations = false;

    while (!this.pendingAddsQ.empty())
    {
        var elp = m_pendingAddsQ.front();
        var elist = elp.second;
        this.elist.clear();
//        SAFE_DELETE(elist);
        this.pendingAddsQ.pop();
    }

    while (!this.userInputEventsQ.empty())
    {
        var pEvent = this.userInputEventsQ.front();
        this.userInputEventsQ.pop();
//        SAFE_RELEASE(pEvent);
    }

    while (!this.sceneOutputEventsQ.empty())
    {
        var pEvent = this.sceneOutputEventsQ.front();
        this.sceneOutputEventsQ.pop();
//        SAFE_RELEASE(pEvent);
    }

    this.removeAllListeners();
    */
    this.listeners.length = 0;
}
DeviceHandler.prototype = new EventListener();
DeviceHandler.prototype.constructor = DeviceHandler;

function DeviceHandler()
{
    EventListener.call(this);
    this.className = "DeviceHandler";
    this.attrType = eAttrType.DeviceHandler;
    
    this.inputMessage = new NumberAttr(0);
    this.inputId = new NumberAttr(0);
    this.inputModifier = new NumberAttr(0);
    this.inputState = new NumberAttr(0);
    this.prevInputState = new NumberAttr(0);
    this.output = new StringAttr("");
    
    this.registerAttribute(this.inputMessage, "inputMessage");
    this.registerAttribute(this.inputId, "inputId");
    this.registerAttribute(this.inputModifier, "inputModifier");
    this.registerAttribute(this.inputState, "inputState");
    this.registerAttribute(this.prevInputState, "prevInputState");
    this.registerAttribute(this.output, "output");
    
    // always respond to events
    this.numResponses.setValueDirect(-1);
}

DeviceHandler.prototype.eventPerformed = function(event)
{
    this.inputMessage.setValueDirect(event.type);
    this.inputId.setValueDirect(event.inputId);
    this.inputState.setValueDirect(event.state);
    this.inputModifier.setValueDirect(event.modifiers);
}
MouseHandler.prototype = new DeviceHandler();
MouseHandler.prototype.constructor = MouseHandler;

function MouseHandler()
{
    DeviceHandler.call(this);
    this.className = "MouseHandler";
    this.attrType = eAttrType.MouseHandler;
    
    this.name.setValueDirect("MouseHandler");
        
    this.lastX = 0;
    this.lastY = 0;
    
    this.x = new NumberAttr(0);
    this.y = new NumberAttr(0);
    this.deltaX = new NumberAttr(0);
    this.deltaY = new NumberAttr(0);
    this.delta = new Vector2DAttr(0, 0);
    
    this.registerAttribute(this.x, "deviceX");
    this.registerAttribute(this.y, "deviceY");
    this.registerAttribute(this.deltaX, "deltaX");
    this.registerAttribute(this.deltaY, "deltaY");
    this.registerAttribute(this.delta, "delta");
   
    this.addEventType(eEventType.MouseMove);
    this.addEventType(eEventType.MouseLeftDown);
}

MouseHandler.prototype.eventPerformed = function(event)
{
    var x = event.x;
    var y = event.y;

    switch (event.type)
    {
    	case eEventType.MouseMove:
    	{
			// do nothing
    	}
    	break;
    	
    	default:
    	{
    		this.lastX = x;
    		this.lastY = y;
    	}
    	break;
    }
   
    this.x.setValueDirect(x);
    this.y.setValueDirect(y);
    
    this.deltaX.setValueDirect(this.lastX-x);
    this.deltaY.setValueDirect(this.lastY-y);
    
    this.delta.setValueDirect(this.lastX-x, this.lastY-y);
    
    this.lastX = x;
    this.lastY = y;
    
    // call the base class to copy the rest of the InputEvent data
	DeviceHandler.prototype.eventPerformed.call(this, event);

	this.deltaX.setValueDirect(0);
	this.deltaY.setValueDirect(0);
	this.delta.setValueDirect(0, 0);
}
KeyboardHandler.prototype = new DeviceHandler();
KeyboardHandler.prototype.constructor = KeyboardHandler;

function KeyboardHandler()
{
    DeviceHandler.call(this);
    this.className = "KeyboardHandler";
    this.attrType = eAttrType.KeyboardHandler;
    
    this.name.setValueDirect("KeyboardHandler");
    
    this.keyString = new StringAttr();
    
    this.registerAttribute(this.keyString, "keyString");
}

KeyboardHandler.prototype.eventPerformed = function(event)
{
    
}


Command.prototype = new EventListener();
Command.prototype.constructor = Command;

function Command()
{
    EventListener.call(this);
    this.className = "Command";
    this.attrType = eAttrType.Command;
    
    this.borrowedAttributes = [];
    this.attributeValuePairs = [];
    this.attributeRefPairs = [];
    
    this.target = new StringAttr("");
    
    this.registerAttribute(this.target, "target");
}

Command.prototype.finalize = function()
{  
}

Command.prototype.eventPerformed = function(event)
{
    if (this.listen.getValueDirect() == true)
    {
        this.execute();
    }
    
    // call base-class implementation
    EventListener.prototype.eventPerformed.call(this, event);
}

Command.prototype.isBorrowed = function(attribute)
{
    for (var i=0; i < this.borrowedAttributes.length; i++)
    {
        if (attribute == this.borrowedAttributes[i])
        {
            return true;
        }
    }

    return false;
}

Command.prototype.isBorrowedAndValueModified = function(attribute)
{
    if (this.isBorrowed(attribute))
    {
        for (var i=0; i < this.attributeValuePairs.length; i++)
        {
            if (attribute == this.attributeValuePairs[i].first)
            {
                return { borrowed: true, value: this.attributeValuePairs[i].second };
            }
        }
    }

    return { borrowed: false, value: null };
}

Command.prototype.isBorrowedAndReferenceModified = function(attribute)
{
    if (this.isBorrowed(attribute))
    {
        for (var i=0; i < this.attributeRefPairs.length; i++)
        {
            if (attribute == this.attributeRefPairs[i].second)
            {
                return { borrowed: true, reference: this.attributeRefPairs[i].first };
            }
        }
    }

    return { borrowed: false, reference: null };
}


SetCommand.prototype = new Command();
SetCommand.prototype.constructor = SetCommand;

function SetCommand()
{
    Command.call(this);
    this.className = "Set";
    this.attrType = eAttrType.Set;
    
    this.target.addModifiedCB(SetCommand_TargetModifiedCB, this);
}

SetCommand.prototype.execute = function()
{
    // TODO: enabled (? - there is a commandEnabled attaribute in .cpp)
    
    this.applyAttributeValues();
}

SetCommand.prototype.applyAttributeValues = function()
{
    for (var i=0; i < this.attributeValuePairs.length; i++)
    {
        setAttributeValue(this.attributeValuePairs[i].first, this.attributeValuePairs[i].second);
    }
}

SetCommand.prototype.registerTargetAttributes = function(target, targetName)
{
    var sname;
    var myAttribute;
    var count = target.getAttributeCount();
    for (var i=0; i < count; i++)
    {
        var attribute = target.getAttributeAt(i);
        var attributeName = target.getAttributeNameAt(i);

        // if the target has an attribute of the same name as the
		// Set, register that same attribute using a relative path
		// expression, e.g., "Container_target"
		if ((myAttribute = this.getAttribute(attributeName)) != null)
		{
			// insert relative path expression
			sName = targetName + "_";	
			sName += attributeName;	
		}
		else	// attribute is not already registered
		{
			sName = attributeName;
		}
		
		this.registerAttribute(attribute, sName);
		this.borrowedAttributes.push(attribute);
    }    
}

function SetCommand_TargetModifiedCB(attribute, container)
{ 
    var target = attribute.getValueDirect().join("");
    var targets = target.split(",");
    
    container.targets.length = 0;
    for (var i=0; i < targets.length; i++)
    {
        var resource = container.registry.find(targets[i]);
        if (resource)
        {
            container.registerTargetAttributes(resource, targets[i]);
        }
    }
    
    setAttributeBin(container.attributeValuePairs);
}
function ConnectionDesc()
{
    this.sourceContainer = null;
    this.targetContainer = null;
    this.sourceAttribute = null;
    this.targetAttribute = null;
    this.sourceAttributeName = "";
    this.targetAttributeName = "";
    this.sourceIndex = -1;
    this.targetIndex = -1;
}

var gConnectionHelpers = [];

function registerConnectionHelper(type, connect, disconnect)
{
    gConnectionHelpers[type] = new Pair(connect, disconnect);
}

ConnectAttributesCommand.prototype = new Command();
ConnectAttributesCommand.prototype.constructor = ConnectAttributesCommand;

function ConnectAttributesCommand()
{
    Command.call(this);
    this.className = "ConnectAttributes";
    this.attrType = eAttrType.ConnectAttributes;
    
    this.connections = new Stack();
    this.connectionHelper = new Pair(null, null);
    
    this.sourceContainer = new StringAttr("");
    this.targetContainer = new StringAttr("");
    this.sourceAttribute = new StringAttr("");
    this.targetAttribute = new StringAttr("");
    this.source = new StringAttr("");
    this.negate = new BooleanAttr(false);   // if true, disconnect
    this.persist = new BooleanAttr(true);
    this.connectionType = new StringAttr("");
    
    this.source.addTarget(this.sourceAttribute);
    this.target.addTarget(this.targetAttribute);
    
    this.sourceContainer.addModifiedCB(ConnectAttributesCommand_SourceContainerModifiedCB, this);
    this.targetContainer.addModifiedCB(ConnectAttributesCommand_TargetContainerModifiedCB, this);
    this.sourceAttribute.addModifiedCB(ConnectAttributesCommand_SourceAttributeModifiedCB, this);
    this.targetAttribute.addModifiedCB(ConnectAttributesCommand_TargetAttributeModifiedCB, this);
    this.connectionType.addModifiedCB(ConnectAttributesCommand_ConnectionTypeModifiedCB, this);
    this.negate.addModifiedCB(ConnectAttributesCommand_NegateModifiedCB, this);
    
    this.registerAttribute(this.sourceContainer, "sourceContainer");
	this.registerAttribute(this.sourceContainer, "sourceEvaluator");
	this.registerAttribute(this.targetContainer, "targetContainer");
	this.registerAttribute(this.sourceAttribute, "sourceAttribute");
	this.registerAttribute(this.sourceAttribute, "sourceOutput");
	this.registerAttribute(this.targetAttribute, "targetAttribute");
	this.registerAttribute(this.source, "source");
	this.registerAttribute(this.negate, "negate");
	this.registerAttribute(this.persist, "persist");
	this.registerAttribute(this.connectionType, "connectionType");
}

ConnectAttributesCommand.prototype.finalize = function()
{
    // for serialization; register each sourceAttribute/targetAttribute pair
    for (var i=0; i < this.connections.length()-2; i++)
    {
        var connection = this.connections.getAt(i);
        if (connection.sourceAttribute && connection.targetAttribute)
        {
            var sourceAttribute = new StringAttr(connection.sourceAttributeName);
            sourceAttribute.flagDeserializedFromXML();
            this.registerAttribute(sourceAttribute, "sourceAttribute");
            
            var targetAttribute = new StringAttr(connection.targetAttributeName);
            targetAttribute.flagDeserializedFromXML();
            this.registerAttribute(targetAttribute, "targetAttribute"); 
        }    
    }
    
    // call base-class implementation
    Command.prototype.finalize.call(this);
}

ConnectAttributesCommand.prototype.eventPerformed = function(event)
{
    // TEMPTEST
    // call base-class implementation
    Command.prototype.eventPerformed.call(this, event);
}

ConnectAttributesCommand.prototype.execute = function()
{
    var desc = this.connections.top();
    var persist = this.persist.getValueDirect();
    
    var sourceEvaluator = null;
    if (desc.sourceContainer &&
        desc.sourceContainer.attrType >= eAttrType.Evaluator &&
        desc.sourceContainer.attrType <= eAttrType.Evaluator_End)
    {
        sourceEvaluator = desc.sourceContainer;
    }
    
    if (this.negate.getValueDirect() == false)
    {
        if (this.connectionHelper.first)
        {
            this.connectionHelper.first(desc.sourceContainer, desc.targetContainer)
            if (!persist && this.connectionHelper.second)
            {
                // if source is evaluator, evaluate
                if (sourceEvaluator) sourceEvaluator.evalute();
                
                this.connectionHelper.second(desc.sourceContainer, desc.targetContainer);
            }
        }
        else
        {
            this.addOrRemoveTargets(true);
            
            if (!persist)
            {
                // if source is evaluator, evaluate
                if (sourceEvaluator) sourceEvaluator.evalute();
                
                this.addOrRemoveTargets(false);
            }
        }
    }
    else // negate - disconnect
    {
        if (this.connectionHelper.second)
        {
            var desc = this.connections.top();
            this.connectionHelper.second(desc.sourceContainer, desc.targetContainer);
            
            // if source is evaluator, evaluate
            if (sourceEvaluator) sourceEvaluator.evalute();
        }
        else
        {
            this.addOrRemoveTargets(false);
            
            // if source is evaluator, evaluate
            if (sourceEvaluator) sourceEvaluator.evalute();
        }
    }
}

ConnectAttributesCommand.prototype.addOrRemoveTargets = function(add)
{
    for (var i=0; i < this.connections.length(); i++)
    {
        var desc = this.connections.getAt(i);
        if (desc.sourceAttribute && desc.targetAttribute)
        {
            // always remove first to ensure no duplicates
            desc.sourceAttribute.removeElementTarget(desc.targetAttribute, desc.sourceIndex, desc.targetIndex);
            if (add)
            {
                desc.sourceAttribute.addElementTarget(desc.targetAttribute, desc.sourceIndex, desc.targetIndex);
            }
            
            // detect connection of a screenPosition to anything and disable display lists
            var container = desc.sourceAttribute.getContainer();
            if (container)
            {   
                var screenPosition = container.getAttribute("screenPosition");
                if (screenPosition && screenPosition == desc.sourceAttribute)
                {
                    var autoDL = container.getAttribute("autoDisplayList");
                    if (autoDL)
                    {
                        autoDL.setValueDirect(false);    
                    }
                    
                    var enableDL = container.getAttribute("enableDisplayList");
                    if (enableDL)
                    {
                        enableDL.setValueDirect(false);    
                    }
                }
            }
        }
    }
}

function ConnectAttributesCommand_SourceContainerModifiedCB(attribute, container)
{
    if (container.connections.length() == 0)
    {
        container.connections.push(new ConnectionDesc());
    }
    var connection = container.connections.top();
    connection.sourceContainer = container.registry.find(attribute.getValueDirect().join(""));       
}

function ConnectAttributesCommand_TargetContainerModifiedCB(attribute, container)
{
    if (container.connections.length() == 0)
    {
        container.connections.push(new ConnectionDesc());
    }
    var connection = container.connections.top();     
    connection.targetContainer = container.registry.find(attribute.getValueDirect().join(""));       
}

function ConnectAttributesCommand_SourceAttributeModifiedCB(attribute, container)
{
    var source = null;
    var index = -1;
    
    if (container.connections.length() == 0)
    {
        container.connections.push(new ConnectionDesc());
    }

    var connection = container.connections.top();    
    if (connection.sourceContainer)
    {
        var sourceTokens = attribute.getValueDirect().join("").split(":");
        source = connection.sourceContainer.getAttribute(sourceTokens[0]);
        if (sourceTokens.length > 1)
        {
            index = sourceTokens[1];
        }              
    }
    else
    {
        source = container.registry.find(attribute.getValueDirect().join(""));
        if (source)
        {
            connection.sourceContainer = source.getContainer();
            if (!connection.sourceContainer) connection.sourceContainer = source;     
        }
    }
    
    connection.sourceAttribute = source;
    connection.sourceAttributeName = attribute.getValueDirect().join("");
    connection.sourceIndex = index;
    
    // if source and target attributes have both been set, push another connection desc for the next source/target pair
    if (connection.sourceAttribute && connection.targetAttribute)
    {
        container.connections.push(new ConnectionDesc());
        container.connections.top().sourceContainer = connection.sourceContainer;
        container.connections.top().targetContainer = connection.targetContainer;
    }
}

function ConnectAttributesCommand_TargetAttributeModifiedCB(attribute, container)
{
    var target = null;
    var index = -1;
    
    if (container.connections.length() == 0)
    {
        container.connections.push(new ConnectionDesc());
    }
    
    var connection = container.connections.top();    
    if (connection.targetContainer)
    {
        var targetTokens = attribute.getValueDirect().join("").split(":");
        target = connection.targetContainer.getAttribute(targetTokens[0]);
        if (targetTokens.length > 1)
        {
            index = targetTokens[1];
        }              
    }
    else
    {
        target = container.registry.find(attribute.getValueDirect().join(""));
        if (target)
        {
            connection.targetContainer = target.getContainer();
            if (!connection.targetContainer) connection.targetContainer = target;     
        }
    }
    
    connection.targetAttribute = target;
    connection.targetAttributeName = attribute.getValueDirect().join("");
    connection.targetIndex = index;
        
    // if source and target attributes have both been set, push another connection desc for the next source/target pair
    if (connection.sourceAttribute && connection.targetAttribute)
    {
        container.connections.push(new ConnectionDesc());
        container.connections.top().sourceContainer = connection.sourceContainer;
        container.connections.top().targetContainer = connection.targetContainer;
    }
}

function ConnectAttributesCommand_ConnectionTypeModifiedCB(attribute, container)
{
    var helpers = gConnectionHelpers[attribute.getValueDirect().join("")];
    if (helpers)
    {
        container.connectionHelper.first = helpers.first;
        container.connectionHelper.second = helpers.second;
    }
}

function ConnectAttributesCommand_NegateModifiedCB(attribute, container)
{
    var negate = attribute.getValueDirect();
    if (negate)
    {
        container.className = "DisconnectAttributes";
        container.attrType = eAttrType.DisconnectAttributes;
    }
    else // !negate
    {
        container.className = "ConnectAttributes";
        container.attrType = eAttrType.ConnectAttributes;       
    }
}
AutoInterpolateCommand.prototype = new Command();
AutoInterpolateCommand.prototype.constructor = AutoInterpolateCommand;

function AutoInterpolateCommand()
{
    Command.call(this);
    this.className = "AutoInterpolate";
    this.attrType = eAttrType.AutoInterpolate;

    this.kfi = null;
    this.numValueChannels = 0;
    this.numReferenceChannels = 0;
    this.numChannels = 0;

    this.shape = new NumberAttr(eKeyframeShape.Linear);
    this.duration = new NumberAttr(1);
    this.preBehavior = new NumberAttr(eEndBehavior.Constant);
    this.postBehavior = new NumberAttr(eEndBehavior.Constant);
    this.renderAndRelease = new BooleanAttr(true);

    this.target.addModifiedCB(AutoInterpolateCommand_TargetModifiedCB, this);

    this.registerAttribute(this.shape, "shape");
    this.registerAttribute(this.duration, "duration");
    this.registerAttribute(this.preBehavior, "preBehavior");
    this.registerAttribute(this.postBehavior, "postBehavior");
    this.registerAttribute(this.renderAndRelease, "renderAndRelease");
}

AutoInterpolateCommand.prototype.execute = function()
{
    // TODO: enabled (?)

    this.buildMotion();
    if (this.kfi)
    {
        this.kfi.getAttribute("time").setValueDirect(0);
        this.kfi.getAttribute("enabled").setValueDirect(true);
    }
}

AutoInterpolateCommand.prototype.buildMotion = function()
{
    var factory = this.registry.find("AttributeFactory");
    this.kfi = factory.create("KeyframeInterpolator");
    if (!this.kfi)
    {
        return;
    }
    this.kfi.getAttribute("enabled").setValueDirect(false);
    this.kfi.getAttribute("renderAndRelease").copyValue(this.renderAndRelease);

    var name = this.name.getValueDirect().join("");
    name += "_AutoInterpolator";
    this.kfi.getAttribute("name").setValueDirect(name);

    for (var i = 0; i < this.attributeValuePairs.length; i++)
    {
        this.numValueChannels += this.attributeValuePairs[i].first.getLength();
    }
    for (var i = 0; i < this.attributeRefPairs.length; i++)
    {
        this.numReferenceChannels += this.attributeRefPairs[i].first.getLength();
    }
    this.numChannels = this.numValueChannels + this.numReferenceChannels;
    this.kfi.setNumChannels(this.numChannels);

    var pre = this.preBehavior.getValueDirect();
    var post = this.postBehavior.getValueDirect();
    for (var i = 0; i < this.numChannels; i++)
    {
        this.kfi.getAttribute("preBehaviors").getAt(i).setValueDirect(pre);
        this.kfi.getAttribute("postBehaviors").getAt(i).setValueDirect(post);
    }

    // apply the parsed values to the kfi
    this.applyAttributeValues();
    this.applyAttributeRefs();
}

AutoInterpolateCommand.prototype.applyAttributeValues = function()
{
    // i = channel counter, advanced by j elements each pass
    // j = element of an Attribute, always 0 for primitive Attrs or 0-length-1 for complex
    // k = index in attribute values map
    var i, j, k;
    for (i = 0, k = 0; k < this.attributeValuePairs.length; k++)
    {
        var attr = this.attributeValuePairs[k].first;
        var value = this.attributeValuePairs[k].second;

        // for each channel:
        // 1. create a starting keyframe from target's current value for each attribute
        // 2. create an ending keyframe from the value contained in the map for each attribute
        for (j = 0; j < attr.getLength(); j++)
        {
            var keyframes = this.kfi.getAttribute("channels").getAt(i + j);

            var start = new KeyframeAttr();
            var end = new KeyframeAttr();

            start.getAttribute("time").setValueDirect(0);
            end.getAttribute("time").setValueDirect(this.duration.getValueDirect());

            start.getAttribute("shape").setValueDirect(this.shape.getValueDirect());
            end.getAttribute("shape").setValueDirect(this.shape.getValueDirect());

            // ensure numerical value with parseFloat()
            var startVal = parseFloat(attr.getElement(j));
            var endVal = parseFloat(attr.getLength() > 1 ? value[j] : value);

            // if the attribute is rotational (determined by "rotation" or "angle" as the attribute name),
            // ensure motion will be the shortest path (eliminate the spin caused by 360's)
            if (this.isAttributeRotational(attr))
            {
                var shortestPath = this.shortestPath(startVal, endVal);
                startVal = shortestPath.start;
                endVal = shortestPath.end;
            }

            start.getAttribute("value").setValueDirect(startVal);
            end.getAttribute("value").setValueDirect(endVal);

            keyframes.push_back(start);
            keyframes.push_back(end);

            // connect the interpolator's output to the attribute
            this.kfi.getAttribute("resultValues").getAt(i + j).addElementTarget(attr, 0, j)
        }

        i += j;
    }
}

AutoInterpolateCommand.prototype.applyAttributeRefs = function()
{
    // i = channel counter, advanced by j elements each pass
    // j = element of an Attribute, always 0 for primitive Attrs or 0-length-1 for complex
    // k = index in attribute values map
    var i, j, k;
    for (i = 0, k = 0; k < this.attributeRefPairs.length; k++)
    {
        var ref = this.attributeRefPairs[k].first;
        var attr = this.attributeRefPairs[k].second;

        // for each channel:
        // 1. create a starting keyframe from target's current value for each attribute
        // 2. create an ending keyframe from the value contained in the map for each attribute
        for (j = 0; j < attr.getLength(); j++)
        {
            var keyframes = this.kfi.getAttribute("channels").getAt(i + j);

            var start = new KeyframeAttr();
            var end = new KeyframeAttr();

            start.getAttribute("time").setValueDirect(0);
            end.getAttribute("time").setValueDirect(this.duration.getValueDirect());

            start.getAttribute("shape").setValueDirect(this.shape.getValueDirect());
            end.getAttribute("shape").setValueDirect(this.shape.getValueDirect());

            // ensure numerical value with parseFloat()
            var startVal = parseFloat(attr.getElement(j));
            var endVal = parseFloat(ref.getElement(j));

            // if the attribute is rotational (determined by "rotation" or "angle" as the attribute name),
            // ensure motion will be the shortest path (eliminate the spin caused by 360's)
            if (this.isAttributeRotational(attr))
            {
                var shortestPath = this.shortestPath(startVal, endVal);
                startVal = shortestPath.start;
                endVal = shortestPath.end;
            }

            start.getAttribute("value").setValueDirect(startVal);
            end.getAttribute("value").setValueDirect(endVal);

            keyframes.push_back(start);
            keyframes.push_back(end);

            // connect the interpolator's output to the attribute
            this.kfi.getAttribute("resultValues").getAt(i + j).addElementTarget(attr, 0, j)
        }

        i += j;
    }
}

AutoInterpolateCommand.prototype.registerTargetAttributes = function(target, targetName)
{
    var sname;
    var myAttribute;
    var count = target.getAttributeCount();
    for (var i = 0; i < count; i++)
    {
        var attribute = target.getAttributeAt(i);
        var attributeName = target.getAttributeNameAt(i);

        // if the target has an attribute of the same name as the
        // Set, register that same attribute using a relative path
        // expression, e.g., "Container_target"
        if ((myAttribute = this.getAttribute(attributeName)) != null)
        {
            // insert relative path expression
            sName = targetName + "_";
            sName += attributeName;
        }
        else	// attribute is not already registered
        {
            sName = attributeName;
        }

        this.registerAttribute(attribute, sName);
        this.borrowedAttributes.push(attribute);
    }
}

AutoInterpolateCommand.prototype.isAttributeRotational = function(attr)
{
    var container = attr.getContainer();
    if (container)
    {
        var name = container.getAttributeName(attr);
        if (name)
        {
            if (name == "rotation" ||
                name == "angle")
            {
                return true;
            }
        }
    }

    return false;
}

AutoInterpolateCommand.prototype.shortestPath = function(start, end)
{
    // normalize start to [0, 360)
    var nstart = degreeNormalize(start);

    // normalize end to [0, 360]
    var nend = degreeNormalize(end);

    // calculate direct path
    var directPath = nend - nstart;
    if (directPath <= 180 && directPath >= -180)
    {
        return { start: start, end: end }; // direct path is shortest path, no changes necessary
    }

    // if direct path > 180 or < -180, a shorter path exists
    var shortestPath = 0;
    if (directPath > 180)
    {
        shortestPath = 360 - directPath;
    }
    else //if (directPath < -180)
    {
        shortestPath = 360 + directPath;
    }

    // update start/end so that shortest path is traversed
    start = nstart;
    if (nend > nstart)
    {
        end = nstart - shortestPath;
    }
    else
    {
        end = nstart + shortestPath;
    }

    return { start: start, end: end };
}

function AutoInterpolateCommand_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    var targets = target.split(",");

    container.targets.length = 0;
    for (var i = 0; i < targets.length; i++)
    {
        var resource = container.registry.find(targets[i]);
        if (resource)
        {
            container.registerTargetAttributes(resource, targets[i]);
        }
    }

    setAttributeBin(container.attributeValuePairs);
    setAttributePairs(container.attributeRefPairs);
}

MotionInterpolateCommand.prototype = new AutoInterpolateCommand();
MotionInterpolateCommand.prototype.constructor = MotionInterpolateCommand;

function MotionInterpolateCommand()
{
    AutoInterpolateCommand.call(this);
    this.className = "MotionInterpolateCommand";

    this.startPosition = new Vector3DAttr();
    this.endPosition = new Vector3DAttr();
    this.resultPosition = new Vector3DAttr();
    this.positionControl = new Vector3DAttr();
    this.easeIn = new BooleanAttr(true);
    this.easeOut = new BooleanAttr(true);
    this.midPosition = new Vector3DAttr();

    //this.resultPosition.addModifiedCB(MotionInterpolateCommand_ResultPositionModifiedCB, this);
    
    this.registerAttribute(this.startPosition, "startPosition");
    this.registerAttribute(this.endPosition, "endPosition");
    this.registerAttribute(this.resultPosition, "resultPosition");
    this.registerAttribute(this.positionControl, "positionControl");
    this.registerAttribute(this.easeIn, "easeIn");
    this.registerAttribute(this.easeOut, "easeOut");
}

MotionInterpolateCommand.prototype.execute = function()
{
    // call base-class implementation
    AutoInterpolateCommand.prototype.execute.call(this);
}

MotionInterpolateCommand.prototype.buildMotion = function()
{
    var factory = this.registry.find("AttributeFactory");
    this.kfi = factory.create("KeyframeInterpolator");
    if (!this.kfi)
    {
        return;
    }
    this.kfi.getAttribute("enabled").setValueDirect(false);
    this.kfi.getAttribute("renderAndRelease").copyValue(this.renderAndRelease);

    this.numChannels = 3;
    this.kfi.setNumChannels(this.numChannels);

    var pre = this.preBehavior.getValueDirect();
    var post = this.postBehavior.getValueDirect();
    for (var i = 0; i < this.numChannels; i++)
    {
        this.kfi.getAttribute("preBehaviors").getAt(i).setValueDirect(pre);
        this.kfi.getAttribute("postBehaviors").getAt(i).setValueDirect(post);
    }

    // set the keyframes
    this.setKeyframes();
}

MotionInterpolateCommand.prototype.setKeyframes = function()
{
    // get start position
    var startPosition = this.startPosition.getValueDirect();

    // get end position
    var endPosition = this.endPosition.getValueDirect();

    // get distance between start/end
    var positionDelta = distanceBetween(startPosition, endPosition);

    // get position control vector
    var positionControl = new Vector3D(); 
    positionControl.copy(this.positionControl.getValueDirect());
    positionControl.normalize();

    // get mid position
    var midPosition = new Vector3D(
        ((startPosition.x + endPosition.x) / 2) + (positionControl.x * (positionDelta / 2)),
        ((startPosition.y + endPosition.y) / 2) + (positionControl.y * (positionDelta / 2)),
        ((startPosition.z + endPosition.z) / 2) + (positionControl.z * (positionDelta / 2)));
    this.midPosition.setValueDirect(midPosition.x, midPosition.y, midPosition.z);

    // get ease-in, ease-out settings
    var easeIn = this.easeIn.getValueDirect();
    var easeOut = this.easeOut.getValueDirect();

    // get shape
    var shape = this.shape.getValueDirect();

    // get duration
    var duration = this.duration.getValueDirect();

    // for each channel...
    for (var channel = 0; channel < this.numChannels; channel++)
    {
        var keyframes = this.kfi.getAttribute("channels").getAt(channel);

        var start = new KeyframeAttr();
        var mid = new KeyframeAttr();
        var end = new KeyframeAttr();

        start.getAttribute("time").setValueDirect(0);
        mid.getAttribute("time").setValueDirect(duration * 0.5);
        end.getAttribute("time").setValueDirect(duration);

        start.getAttribute("shape").setValueDirect(shape);
        mid.getAttribute("shape").setValueDirect(shape);
        end.getAttribute("shape").setValueDirect(shape);

        start.getAttribute("value").setValueDirect(this.startPosition.getElement(channel));
        mid.getAttribute("value").setValueDirect(this.midPosition.getElement(channel));
        end.getAttribute("value").setValueDirect(this.endPosition.getElement(channel));

        keyframes.push_back(start);
        keyframes.push_back(mid);
        keyframes.push_back(end);

        this.kfi.getAttribute("resultValues").getAt(channel).addElementTarget(this.resultPosition, 0, channel);
    }
}

function MotionInterpolateCommand_ResultPositionModifiedCB(attribute, container)
{
    var value = attribute.getValueDirect();

    OutputDebugMsg("x: " + value.x + " y: " + value.y + " z: " + value.z + "\n");
}
LocateCommand.prototype = new Command();
LocateCommand.prototype.constructor = LocateCommand;

function LocateCommand()
{
    Command.call(this);
    this.className = "LocateCommand";
    this.attrType = eAttrType.Locate;

    this.targetNode = null;
    this.directive = new BBoxDirective();
    this.locator = new BBoxLocator();
    this.inspector = null;

	this.duration = new NumberAttr(1);
	this.transition = new BooleanAttr(true);
	this.updateClipPlanes = new BooleanAttr(false);
	this.shape = new NumberAttr(eKeyframeShape.TCB);
	this.easeIn = new BooleanAttr(true);
	this.easeOut = new BooleanAttr(true);
	this.resultPosition = new Vector3DAttr();
	this.resultFarDistance = new NumberAttr();
	this.resultWidth = new NumberAttr();

    this.target.addModifiedCB(LocateCommand_TargetModifiedCB, this);

	this.registerAttribute(this.duration, "duration");
	this.registerAttribute(this.transition, "transition");
	this.registerAttribute(this.updateClipPlanes, "updateClipPlanes");
	this.registerAttribute(this.shape, "shape");
	this.registerAttribute(this.easeIn, "easeIn");
	this.registerAttribute(this.easeOut, "easeOut");
	this.registerAttribute(this.resultPosition, "resultPosition");
	this.registerAttribute(this.resultFarDistance, "resultFarDistance");
	this.registerAttribute(this.resultWidth, "resultWidth");

    this.registerAttribute(this.locator.getAttribute("closeness"), "closeness");
    this.registerAttribute(this.locator.getAttribute("resultPivotDistance"), "resultPivotDistance");
}

LocateCommand.prototype.execute = function()
{
    if (this.targetNode)
    {
        this.locate();
    }
}

LocateCommand.prototype.locate = function()
{
    var selector = this.registry.find("Selector");
    var viewportMgr = this.registry.find("ViewportMgr");

    // get camera at last select point (if no selection has been made, gets camera at (0, 0))
    var clickPoint = selector.getAttribute("clickPoint").getValueDirect();
    var vp = viewportMgr.getViewportAtScreenXY(clickPoint.x, clickPoint.y);
    var camera = vp.camera;
    var viewport = vp.viewport;

    // get world-space bbox
    this.directive.execute(this.targetNode);
    var bounds = this.directive.getBounds();
    this.locator.getAttribute("bbox").setValueDirect(bounds.min, bounds.max);

    // get view-space bbox
    var view = vp.camera.getTransform();
    view.invert();
    this.directive.getAttribute("viewTransform").setValueDirect(view);
    this.directive.getAttribute("viewSpace").setValueDirect(true);
    this.directive.execute(this.targetNode);
    bounds = this.directive.getBounds();
    this.locator.getAttribute("bboxView").setValueDirect(bounds.min, bounds.max);

    // copy current viewport to the locator's viewport attribute
    this.locator.getAttribute("viewport").setValueDirect(viewport.x, viewport.y, viewport.width, viewport.height);

    // inputs
    var locatorNear = this.locator.getAttribute("nearDistance");
    var locatorVolume = this.locator.getAttribute("viewVolume");
    var locatorViewPosition = this.locator.getAttribute("viewPosition");
    var locatorTransform = this.locator.getAttribute("viewTransform");

    // outputs
    var locatorResultPosition = this.locator.getAttribute("resultPosition");
    var locatorResultWidth = this.locator.getAttribute("resultWidth");
    var locatorResultFarDistance = this.locator.getAttribute("resultFarDistance");
    var resultPivotDistance = this.locator.getAttribute("resultPivotDistance");

    // output targets (others determined later)
    var targetPivotDistance = null;
    var updateClipPlanes = this.updateClipPlanes.getValueDirect();
    var transition = this.transition.getValueDirect();

    if (this.inspector)
    {
        targetPivotDistance = this.inspector.getAttribute("pivotDistance");
    }

    if (resultPivotDistance && targetPivotDistance)
    {
        resultPivotDistance.addTarget(targetPivotDistance);
    }

    cameraNear = camera.getAttribute("nearDistance");
    cameraFar = camera.getAttribute("farDistance");
    cameraWidth = camera.getAttribute("width");
    cameraVolume = camera.getAttribute("viewVolume");
    cameraPosition = camera.getAttribute("sectorPosition");
    cameraWorldPosition = camera.getAttribute("sectorWorldPosition");
    cameraWorldTransform = camera.getAttribute("sectorWorldTransform");

    cameraNear.addTarget(locatorNear);
    cameraVolume.addTarget(locatorVolume);
    cameraWorldPosition.addTarget(locatorViewPosition);
    cameraWorldTransform.addTarget(locatorTransform);

    // if NOT transitioning, apply the result directly back to the camera
    if (transition == false)
    {
        locatorResultPosition.addTarget(cameraPosition);
        locatorResultWidth.addTarget(cameraWidth);

        if (updateClipPlanes)
        {
            locatorResultFarDistance.addTarget(cameraFar);
        }

        this.locator.evaluate();

        locatorResultPosition.removeTarget(cameraPosition);

        // removing null or non-targets is harmless,
        // so no need to check, just call remove
        locatorResultWidth.removeTarget(cameraWidth);
        locatorResultFarDistance.removeTarget(cameraFar);
    }
    else
    {
        locatorResultPosition.addTarget(this.resultPosition);
        locatorResultWidth.addTarget(this.resultWidth);

        if (updateClipPlanes)
        {
            locatorResultFarDistance.addTarget(this.resultFarDistance);
        }

        this.locator.evaluate();

        locatorResultPosition.removeTarget(this.resultPosition);

        // removing null or non-targets is harmless,
        // so no need to check, just call remove
        locatorResultWidth.removeTarget(this.resultWidth);
        locatorResultFarDistance.removeTarget(this.resultFarDistance);

        // based upon shape value, create either a normal auto-interpolator (linear), or a
        // motion-interpolator (non-linear)
        switch (this.shape.getValueDirect())
        {
            case eKeyframeShape.Stepped:
            case eKeyframeShape.TCB:
            case eKeyframeShape.Bezier1D:
            case eKeyframeShape.Bezier2D:
                {
                    var factory = this.registry.find("AttributeFactory");
                    var autoInterpolate = factory.create("MotionInterpolate");

                    autoInterpolate.getAttribute("shape").copyValue(this.shape);
                    autoInterpolate.getAttribute("easeIn").copyValue(this.easeIn);
                    autoInterpolate.getAttribute("easeOut").copyValue(this.easeOut);
                    autoInterpolate.getAttribute("startPosition").copyValue(cameraPosition);
                    autoInterpolate.getAttribute("endPosition").copyValue(this.resultPosition);
                    autoInterpolate.getAttribute("resultPosition").addTarget(cameraPosition,
                        eAttrSetOp.Replace, null, false);

                    // get camera direction vectors
                    var dirs = camera.getDirectionVectors();

                    // set the inverse camera fwd vector to the interpolator's position control
                    autoInterpolate.getAttribute("positionControl").setValueDirect(-dirs.forward.x,
					    -dirs.forward.y, -dirs.forward.z);
                }
                break;

            case eKeyframeShape.Linear:
            default:
                {
                    var factory = this.registry.find("AttributeFactory");
                    var autoInterpolate = factory.create("AutoInterpolate");

                    autoInterpolate.attributeRefPairs.push(new Pair(this.resultPosition, cameraPosition));
                }
                break;
        }

        if (updateClipPlanes)
        {
            if (cameraWidth) autoInterpolate.attributeRefPairs.push(new Pair(this.resultWidth, cameraWidth));
            if (cameraFar) autoInterpolate.attributeRefPairs.push(new Pair(this.resultFarDistance, cameraFar));
        }

        autoInterpolate.target = camera;
        autoInterpolate.getAttribute("duration").copyValue(this.duration);
        autoInterpolate.execute();
        this.registry.unregister(autoInterpolate);
    }

    if (resultPivotDistance && targetPivotDistance)
    {
        resultPivotDistance.removeTarget(targetPivotDistance);
    }
}

function LocateCommand_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    var resource = container.registry.find(target);
    if (resource)
    {
        container.targetNode = resource;

        // try and locate a scene inspector for updating pivotDistance
        container.inspector = container.registry.find("SceneInspector");
    }
    else
    {
        console.debug("TODO: " + arguments.callee.name);
        // TODO: target not found
        //_snprintf(msg, sizeof(msg), "LocateBBox: target=\"%s\" not found\n", name.c_str());
        // TODO: Locate a point on an object and/or in the world
    }
}

PlayCommand.prototype = new Command();
PlayCommand.prototype.constructor = PlayCommand;

function PlayCommand()
{
    Command.call(this);
    this.className = "Play";
    this.attrType = eAttrType.Play;

    this.evaluators = [];
    this.negate = new BooleanAttr(false);   // if true, Pause
    
    this.registerAttribute(this.negate, "negate");
    
    this.target.addModifiedCB(PlayCommand_TargetModifiedCB, this);
    this.negate.addModifiedCB(PlayCommand_NegateModifiedCB, this);
}

PlayCommand.prototype.execute = function()
{
    // TODO: enabled (?)
	var renderAgent = this.registry.find("RenderAgent");
	if (renderAgent)
	{
        // SetEvaluatorPlayState not implemented by RenderAgent
        // ePlayState_* is not implemented by RenderAgent
        if (this.evaluators.length < 1)
        {
			if (this.negate.getValueDirect() == false)
			{
				renderAgent.setEvaluatorsPlayState(ePlayState.Play);
			}
			else
			{
				renderAgent.setEvaluatorsPlayState(ePlayState.Pause);
			}
        }
        else
        {
            for (var i = 0; i < this.evaluators.length; i++)
            {
         
    			if (this.negate.getValueDirect() == false)
    			{
    				renderAgent.setEvaluatorPlayState(evaluators[i], ePlayState.Play);
    			}
    			else
    			{
    				renderAgent.setEvaluatorPlayState(evaluators[i], ePlayState.Pause);
    			}
            
            }   
        }
	}
}

function PlayCommand_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    var targets = target.split(",");

    // find one or more evaluator to play
    container.targets.length = 0;   // copied this from Set. What does it do?
    for (var i = 0; i < targets.length; i++)
    {
        var evaluator = container.registry.find(targets[i]);
        if (evaluator)
        {
            container.evaluators[i] = evaluator;
        }
    }
}

function PlayCommand_NegateModifiedCB(attribute, container)
{
    var negate = attribute.getValueDirect();
    if (negate)
    {
        container.className = "Pause";
        container.attrType = eAttrType.Pause;
    }
    else // !negate
    {
        container.className = "Play";
        container.attrType = eAttrType.Play;       
    }
}
RemoveCommand.prototype = new Command();
RemoveCommand.prototype.constructor = RemoveCommand;

function RemoveCommand()
{
    Command.call(this);
    this.className = "RemoveCommand";
    this.attrType = eAttrType.Remove;

    this.targetAttribute = null;
    
    this.target.addModifiedCB(RemoveCommand_TargetModifiedCB, this);
}

RemoveCommand.prototype.execute = function()
{
    if (this.targetAttribute)
    {
        // if node, remove from tree, and remove/unregister all children
        if (this.targetAttribute.isNode())
        {
            var i = 0;
            var parent = null;
            while ((parent = this.targetAttribute.getParent(i++)))
            {
                parent.removeChild(this.targetAttribute);
            }

            this.removeChildren(this.targetAttribute);
        }

        // remove from registry
        this.registry.unregister(this.targetAttribute);
        
        // delete
        this.targetAttribute.destroy();
    }
}

RemoveCommand.prototype.removeChildren = function(root)
{
    var child = null;
	while ((child = root.getChild(0))) // get child 0 each time because we are removing the front child
	{
		// recurse on child
		this.removeChildren(child);

		// remove from registry
		this.registry.unregister(child);

		// remove from root node
		root.removeChild(child);
	}
}

function RemoveCommand_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    container.targetAttribute = container.registry.find(target);
}

StopCommand.prototype = new Command();
StopCommand.prototype.constructor = StopCommand;

function StopCommand()
{
    Command.call(this);
    this.className = "Stop";
    this.attrType = eAttrType.Stop;

    this.evaluators = [];
    
    this.target.addModifiedCB(StopCommand_TargetModifiedCB, this);

}

StopCommand.prototype.execute = function()
{
    // TODO: enabled (?)
	var renderAgent = this.registry.find("RenderAgent");
	if (renderAgent)
	{
        // SetEvaluatorStopState not implemented by RenderAgent
        // eStopState_* is not implemented by RenderAgent
        if (this.evaluators.length < 1)
        {
			renderAgent.setEvaluatorsPlayState(ePlayState.Stop);
        }
        else
        {
            for (var i = 0; i < this.evaluators.length; i++)
            {
         
    			renderAgent.setEvaluatorPlayState(evaluators[i], ePlayState.Stop);
            }   
        }
	}
}

function StopCommand_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    var targets = target.split(",");

    // find one or more evaluator to play
    container.targets.length = 0;   // copied this from Set. What does it do?
    for (var i = 0; i < targets.length; i++)
    {
        var evaluator = container.registry.find(targets[i]);
        if (evaluator)
        {
            container.evaluators[i] = evaluator;
        }
    }
}
CommandSequence.prototype = new Command();
CommandSequence.prototype.constructor = CommandSequence;

function CommandSequence()
{
    Command.call(this);
    this.className = "CommandSequence";
    this.attrType = eAttrType.CommandSequence;
    
    this.sequence = [];
}

CommandSequence.prototype.execute = function()
{
    for (var i=0; i < this.sequence.length; i++)
    {
        this.sequence[i].execute();
    }
}

CommandSequence.prototype.addCommand = function(command)
{
    this.sequence.push(command);
    
    // register command for serialization
    var num = this.sequence.length - 1;
    var name = "Command(" + num.toString() + ")";
    this.registerAttribute(command, name);
}
CommandMgr.prototype = new AttributeContainer();
CommandMgr.prototype.constructor = CommandMgr;

function CommandMgr()
{
    AttributeContainer.call(this);
    this.className = "CommandMgr";
    
    this.commandSeqStack = new Stack();
    
    this.name = new StringAttr("CommandMgr");
    
    this.registerAttribute(this.name, "name");
}

CommandMgr.prototype.pushCommandSequence = function(sequence)
{
    this.commandSeqStack.push(sequence);
}

CommandMgr.prototype.popCommandSequence = function()
{
    this.commandSeqStack.pop();
}

CommandMgr.prototype.clearCommandSequenceStack = function()
{
    this.commandSeqStack.clear();
}

CommandMgr.prototype.addCommand = function(command)
{
    setAttributeBin(null);
    setAttributePairs(null);
    
    if (this.commandSeqStack.length() > 0)
    {
        this.commandSeqStack.top().addCommand(command);
        this.registry.unregister(command); // unregister here so command will not be serialized separately
        return;
    }
    
    // execute the command or register it for events.  If the command
    // was NOT configured for events, then Execute it and get rid of it             
    var events = command.getEventTypes();
    var trigger = command.getAttribute("trigger");
    if (events.length > 0)
    {
        var eventMgr = this.registry.find("EventMgr");
        if (eventMgr)
        {
            for (var i=0; i < events.length; i++)
            {
                eventMgr.addListener(events[i], command);
            }
        }   
    }
    else if (trigger.getLength() > 0)
    {
		trigger.addModifiedCB(CommandMgr_CommandTriggerModifiedCB, this);
		this.createCommandTrigger(command, trigger);
    }
    else // no events -- execute and remove
    {
        command.execute();
        this.registry.unregister(command);
    }
}

CommandMgr.prototype.createCommandTrigger = function(command, trigger) 
 {

 	// TODO: Support Commands that Execute from Events AND Triggers

 	// trigger syntax based on Attributes:
 	// ObjectName/Attribute=value
 	// ObjectName/Attribute[item]=value
 	// ObjectName/Attribute=value,value,value,...,value
 	// Where "ObjectName" may be an XPath-like expression
 	var attrNdx = 0;
    var valueNdx = 0;
    var rangeNdx = 0;
    var itemNdx = 0;

    var triggerString = "";
    triggerString = trigger.getValueDirect().join("");
 	attrNdx = triggerString.lastIndexOf('/');

 	if (attrNdx != -1)
 	{
 		var objectName = triggerString.substring(0, attrNdx);
 		var resource = bridgeworks.registry.find(objectName);
 		if(resource)
 		{
 			var not = false;

            var attrName = "";
            var itemString = "";
            var valueString = "";
            var rangeString = "";
            
 			valueNdx = triggerString.lastIndexOf('!');
 			if (valueNdx > 0)
 			{
 			    triggerString.replace("!", ""); // erase the '!' for subsequent processing
 			    not = true;
 			}

 			valueNdx = triggerString.lastIndexOf('=');

 			if(valueNdx > 0) 
 			{
 				itemNdx = triggerString.lastIndexOf('[');
 				if(itemNdx > 0) 
 				{
 					var itemNdx2 = triggerString.lastIndexOf(']', itemNdx); 
 					itemString = triggerString.substring(itemNdx+1, itemNdx2 - itemNdx - 1); 
 				}

 				var range = FLT_MAX; 
 				var rangeNdx = triggerString.lastIndexOf(',');
 				if(rangeNdx > 0)
 				{
 					var rangeString = triggerString.substring(rangeNdx+1, trigger.length()-rangeNdx-1);
 					range = rangeString.parseFloat(); 
 				}
 				rangeNdx = rangeNdx == -1 ? triggerString.length : rangeNdx;
 				// value is the string between '=' && (',' || end of string)
 				valueString = triggerString.substring(valueNdx+1, valueNdx+(rangeNdx-valueNdx));

 			}
 			else //TEMPEST
 			{
 				itemNdx = triggerString.lastIndexOf('[');
 				if(itemNdx > 0) 
 				{
 					var itemNdx2 = triggerString.lastIndexOf(']', itemNdx);
 					itemString = triggerString.substring(itemNdx+1, itemNdx2-itemNdx-1);
 				}
 			}
 			valueNdx = itemNdx == -1 ? (valueNdx == -1 ? triggerString.length() : valueNdx) : itemNdx;
 			attrName = triggerString.substring(attrNdx+1, valueNdx);

 			var input = resource.getAttribute(attrName);

 			var attr = this.createAttribute(input, valueString);

 			if(attr)
 			{
 				var item = -1; 
 				if(itemString != "")
 				{
 					item = parseInt(itemString);
 				}

 				var numExecutions = command.numResponses;
 				var newTrigger = new AttributeTrigger(input, attr, command, item, not, numExecutions);

 				command.setTrigger(newTrigger);
 			}
 			triggerString = objectName + "/" + attrName;

 			console.debug(trigger);
 			console.debug("\n");
 		}		
 	}
 }

CommandMgr.prototype.createAttribute = function(attribute, value)
{
	var newAttribute = null;
	if(attribute)
	{
        //console.debug(attribute);
		var etype = attribute.attrType;
		var len = attribute.getLength();
        //console.debug(etype);
//			switch (etype)
//			{
//
//			case eAttrType.BooleanAttr:
//				{
//					newAttribute = new NumberAttr();
//		            newAttribute.setValueDirect(parseInt(value));
//				}
//				break;
//            case eAttrType.NumberAttr:
//
//				{
					newAttribute = new NumberAttr();
		            newAttribute.setValueDirect(parseFloat(value));
//				}
//				break;
//
//            case eAttrType.StringAttr:
//				{
//					newAttribute = new StringAttr();
//                    newAttribute.setValueDirect(value);
//				}
//				break;
//
//			default:
//				newAttribute = null;
//				break;
//			}
		  }
        //console.debug(newAttribute);
		return newAttribute; 
}

function CommandMgr_CommandTriggerModifiedCB(attribute, container)
{
	this.createCommandTrigger(attribute, container);
}

AttributeTrigger.prototype = new Command();
AttributeTrigger.prototype.constructor = AttributeTrigger;


function AttributeTrigger(input, trigger, target, item, _not, _executionCount)
{
    this.input = input;
    this.trigger = trigger;
    this.target = target;

    this.lastValues = [];

	this.input.getValue(this.lastValues);
    this.attrType = eAttrType.AttributeTrigger;
	
    this.item = item;
    
    this.not = _not;


    this.executionCount = _executionCount;

	this.input.addModifiedCB(AttributeTrigger_InputModifiedCB, this);

	var len = this.input.getLength();

	if (len == 1)
	{
		this.item = 0;
	}
}


AttributeTrigger.prototype.execute = function()
{
	if (this.target)
	{
        var type = this.trigger.attrType;

        switch (type)
        {

        case eAttrType.StringAttr:
            {
                var vIn = [];
                var vTrig = [];
            
                this.input.getValue(vIn);
                this.trigger.getValue(vTrig);

                var pass = vIn[0] == vTrig[0] ? true : false;
                pass = this.not ? !pass : pass;
                if (pass)
                {
                    var count = this.executionCount.getValueDirect() - 1;
                    this.executionCount.setValueDirect(count);
                }

                if (this.executionCount == 0)
		        {
			        this.target = null;
		        }
            }
            break;

        default:
            {
                var vIn = [];
                var vTrig = [];

		        this.input.getValue(vIn);
		        this.trigger.getValue(vTrig);

		        // match single-item Attribute OR single item of a multi-item Attribute
		        if (this.item != -1)
		        {
			        // if equal OR descending past OR ascending past
                    var pass = ((vIn[this.item] == vTrig[0]) ||
			                     (this.lastValues[this.item] > vIn[this.item] && vIn[this.item] < vTrig[0]) ||
			                     (this.lastValues[this.item] < vIn[this.item] && vIn[this.item] > vTrig[0]));
                    pass = this.not ? !pass : pass;
                    if (pass)
			        {
						this.target.execute();
                        var count = this.executionCount.getValueDirect() - 1;
				        this.executionCount.setValueDirect(count);
			        }
		        }
		        else	// match every item in a multi-item Attribute
		        {
			        var len = this.input.getLength();
			        var matches = 0;
			        for (var i = 0; i < len; ++i)
			        {
				        // if equal OR descending past OR ascending past
				        var pass = ((vIn[i] == vTrig[i]) ||
				                     (this.lastValues[i] > vIn[i] && vIn[i] < vTrig[i]) ||
				                     (this.lastValues[i] < vIn[i] && vIn[i] > vTrig[i]));
                        pass = this.not ? !pass : pass;
                        if (pass)
				        {
					        ++matches;
				        }
			        }

			        // if every item matches simultaneously
			        if (matches = len)
			        {
						err = this.target.execute();
						this.executionCount.setValueDirect(--this.executionCount);
			        }
		        }

		        if (this.executionCount.getValueDirect() == 0)
		        {
			        this.target = null;
                    this.input.removeModifiedCB(AttributeTrigger_InputModifiedCB,this);
		        }
		        else
		        {
			        this.lastValues = vIn;
		        }
            }
            break;
        }
	}

	return;
}

function AttributeTrigger_InputModifiedCB(attribute, container)
{
	container.execute();

	// TODO:  Expand to also support EventListener::EventPerformed
}
/*
void AttributeTrigger_InputModifiedTaskProc(void* data, const bool & run)
{
	TAttributeTrigger* pTrigger = static_cast<TAttributeTrigger*>(data);
	pTrigger.Execute();
}
*/
BwRegistry.prototype = new AttributeRegistry();
BwRegistry.prototype.constructor = BwRegistry;

function BwRegistry()
{
    AttributeRegistry.call(this);
    this.className = "BwRegistry";
    this.attrType = eAttrType.AttributeRegistry;
    
    this.rootPtr = new ReferenceAttr(null);
    this.subtreePtr = new ReferenceAttr(null);
    this.sgPointer = new StringAttr("");
    this.maxAnimationTimeInSecs = new NumberAttr(0);

    this.rootPtr.addModifiedCB(BwRegistry_RootPtrModifiedCB, this);
    this.sgPointer.addModifiedCB(BwRegistry_SgPointerModifiedCB, this);
    
    this.registerAttribute(this.rootPtr, "rootPtr");
    this.registerAttribute(this.subtreePtr, "subtreePtr");
    this.registerAttribute(this.sgPointer, "sgPointer");
    this.registerAttribute(this.maxAnimationTimeInSecs, "maxAnimationTimeInSecs");
    
    this.registerByName(this, "NodeMgr");      // backward-compatibility
    this.registerByName(this, "EvaluatorMgr"); // backward-compatibility
}

BwRegistry.prototype.find = function(name)
{
    if (!name) return null;
    
    // tokenize name path
    var tokens = [];
    var index = 0;
    while ((index = name.indexOf('/')) > -1)
    {
        tokens.push(name.substring(0, index));
        name = name.substring(index+1, name.length);
    }
    tokens.push(name);
    
    // call get() on first token
    var resource = this.getByName(tokens[0]);
    if (resource) resource = resource[0];
    
    // call getAttribute() on subsequent tokens
    for (var i=1; i < tokens.length && resource; i++)
    {
        resource = resource.getAttribute(tokens[i]);
    }
    
    return resource;
}

BwRegistry.prototype.findContext = function(name, context)
{
    // TODO
}

BwRegistry.prototype.registerResource = function(container)
{
    // setup parent relationship for nodes (not all containers passed to this method will be nodes)
    if (container.isNode() && container.getAttribute("orphan").getValueDirect() == false)
    {
        this.updateTree(container);
    }
}

BwRegistry.prototype.finalizeResource = function(container)
{
    if (container.isNode() && container.getParentCount() > 0)
    {
        this.subtreePtr.setValueDirect(container.getParent(0));
    }
}

BwRegistry.prototype.register = function(container)
{
    // call base-class implementation
    AttributeRegistry.prototype.register.call(this, container);
    
    // TODO
}

BwRegistry.prototype.unregister = function(container)
{
    // call base-class implementation
    AttributeRegistry.prototype.unregister.call(this, container);
    
    // TODO
}

BwRegistry.prototype.clear = function()
{
    this.rootPtr.setValueDirect(null);
    this.subtreePtr.setValueDirect(null);
    this.sgPointer.setValueDirect(null);
    
    // call base-class implementation
    AttributeRegistry.prototype.clear.call(this);    
}

BwRegistry.prototype.updateTree = function(node)
{
    var root = this.rootPtr.getValueDirect();
    var subtree = this.subtreePtr.getValueDirect();
  
    // by default, first node is the root
    if (root == null)
    {
        root = subtree = node;
    }
    else
    {
        if (subtree)
        {
            subtree.addChild(node);
        }
        else
        {
            root.addChild(node);
        }
        
        subtree = node;
    }
    
    this.rootPtr.setValueDirect(root);
    this.subtreePtr.setValueDirect(subtree);
}

BwRegistry.prototype.updateMaxAnimationTime = function()
{
    // TODO
}

BwRegistry.prototype.formatContext = function(attribute, name)
{
    // TODO
}

BwRegistry.prototype.sgPointerModified = function()
{
    var resource = this.find(this.sgPointer.getValueDirect().join(""));
    if (resource)
    {
        this.subtreePtr.setValueDirect(resource);
    }
}

function BwRegistry_RootPtrModifiedCB(attribute, container)
{
    var resource = attribute.getValueDirect();
}

function BwRegistry_SgPointerModifiedCB(attribute, container)
{
    container.sgPointerModified();
}
BwSceneInspector.prototype = new SceneInspector();
BwSceneInspector.prototype.constructor = BwSceneInspector;

function BwSceneInspector()
{
    SceneInspector.call(this);
    this.className = "BwSceneInspector";
    this.attrType = eAttrType.SceneInspector;
    
    this.viewport = new Viewport();
    this.worldUnitsPerPixel = new Vector2D();
    this.clickPosWorld = new Vector3D();
    this.last_d3 = 0;
    
    this.translationSensitivity = new Vector3DAttr(1, 1, 1);
    this.panSensitivity = new Vector3DAttr(1, 1, 1);
    this.trackSensitivity = new Vector3DAttr(1, 1, 1);
    this.rotationSensitivity = new Vector3DAttr(1, 1, 1);
    this.zoomSensitivity = new NumberAttr(1);
    this.invertedTranslationDelta = new Vector3DAttr(0, 0, 0);
    this.invertedPanDelta = new Vector3DAttr(0, 0, 0);
    this.invertedTrackDelta = new Vector3DAttr(0, 0, 0);
    this.invertedRotationDelta = new Vector3DAttr(0, 0, 0);
    this.zoomDelta = new NumberAttr(0);
    this.invertedZoomDelta = new NumberAttr(0);
    this.selectionOccurred = new BooleanAttr(false);
    this.viewRelativeTranslationDelta = new Vector3DAttr(0, 0, 0);
    
    this.translationDelta.addModifiedCB(BwSceneInspector_TranslationDeltaModifiedCB, this);
    this.panDelta.addModifiedCB(BwSceneInspector_PanDeltaModifiedCB, this);
    this.trackDelta.addModifiedCB(BwSceneInspector_TrackDeltaModifiedCB, this);
    this.rotationDelta.addModifiedCB(BwSceneInspector_RotationDeltaModifiedCB, this);
    this.invertedTranslationDelta.addModifiedCB(BwSceneInspector_InvertedTranslationDeltaModifiedCB, this);
    this.invertedPanDelta.addModifiedCB(BwSceneInspector_InvertedPanDeltaModifiedCB, this);
    this.invertedTrackDelta.addModifiedCB(BwSceneInspector_InvertedTrackDeltaModifiedCB, this);
    this.invertedRotationDelta.addModifiedCB(BwSceneInspector_InvertedRotationDeltaModifiedCB, this);
    this.zoomDelta.addModifiedCB(BwSceneInspector_ZoomDeltaModifiedCB, this);
    this.invertedZoomDelta.addModifiedCB(BwSceneInspector_InvertedZoomDeltaModifiedCB, this);
    this.selectionOccurred.addModifiedCB(BwSceneInspector_SelectionOccurredCB, this);
    this.viewRelativeTranslationDelta.addModifiedCB(BwSceneInspector_TrackDeltaModifiedCB, this);
    
    this.registerAttribute(this.translationSensitivity, "translationSensitivity");
    this.registerAttribute(this.panSensitivity, "panSensitivity");
    this.registerAttribute(this.trackSensitivity, "trackSensitivity");
    this.registerAttribute(this.rotationSensitivity, "rotationSensitivity");
    this.registerAttribute(this.zoomSensitivity, "zoomSensitivity");
    this.registerAttribute(this.invertedTranslationDelta, "invertedTranslationDelta");
    this.registerAttribute(this.invertedPanDelta, "invertedPanDelta");
    this.registerAttribute(this.invertedTrackDelta, "invertedTrackDelta");
    this.registerAttribute(this.invertedRotationDelta, "invertedRotationDelta");
    this.registerAttribute(this.zoomDelta, "zoomDelta");
    this.registerAttribute(this.invertedZoomDelta, "invertedZoomDelta");
    this.registerAttribute(this.selectionOccurred, "selectionOccurred");
    this.registerAttribute(this.viewRelativeTranslationDelta, "viewRelativeTranslationDelta");
    
    // set orphan so that evaluator will not be added to scene graph
	this.orphan.setValueDirect(true);
	
	this.enabled.addModifiedCB(BwSceneInspector_EnabledModifiedCB, this);
}

BwSceneInspector.prototype.evaluate = function()
{
    // call base-class implementation
    SceneInspector.prototype.evaluate.call(this);
}

BwSceneInspector.prototype.translate = function(delta)
{
    if (delta.x == 0 && delta.y == 0 && delta.z == 0)
    {
        // no effect
        return;
    }
    
    // get sensitivity
    var sensitivity = this.translationSensitivity.getValueDirect();

    // calculate deltas (scale by sensitivity)
    delta.x *= sensitivity.x;
    delta.y *= sensitivity.y;
    delta.z *= sensitivity.z;

    // set deltas
    var values = [delta.x, delta.y, delta.z];
    var params = new AttributeSetParams(-1, -1, 0, true, false);
	this.translationDelta.setValue(values, params);
	
    // evaluate scene inspector
	this.evaluate();

    // clear deltas
    var zeroes = [0, 0, 0];
    this.translationDelta.setValue(zeroes, params);
    this.invertedTranslationDelta.setValue(zeroes, params);
}

BwSceneInspector.prototype.pan = function(delta)
{
    if (delta.x == 0 && delta.y == 0 && delta.z == 0)
    {
        // no effect
        return;
    }
    
    // if worldUnitsPerPixel hasn't been set, use pivot distance as default
    if (this.worldUnitsPerPixel.x == 0 && this.worldUnitsPerPixel.y == 0)
    {
        var wupp = this.getWorldUnitsPerPixel(this.pivotDistance.getValueDirect());
        this.worldUnitsPerPixel.x = wupp.x;
        this.worldUnitsPerPixel.y = wupp.y;
    }
    
    // get sensitivity
    var sensitivity = this.panSensitivity.getValueDirect();

    // calculate deltas (scale by sensitivity & worldUnitsPerPixel)
    delta.x *= sensitivity.x * this.worldUnitsPerPixel.x;
    delta.y *= sensitivity.y * this.worldUnitsPerPixel.y;
    delta.z *= sensitivity.z * this.worldUnitsPerPixel.y; // use y for z
    
    // set deltas
    var values = [delta.x, delta.y, delta.z];
    var params = new AttributeSetParams(-1, -1, 0, true, false);
	this.panDelta.setValue(values, params);
	
	// update pivot distance if panning in z-direction
	if (delta.z != 0)
	{
	    var pivotDistance = this.pivotDistance.getValueDirect();
	    pivotDistance -= delta.z;
	    this.pivotDistance.setValueDirect(pivotDistance);
	}
	
    // evaluate scene inspector
	this.evaluate();

    // clear deltas
    var zeroes = [0, 0, 0];
    this.panDelta.setValue(zeroes, params);
    this.invertedPanDelta.setValue(zeroes, params);
}

BwSceneInspector.prototype.track = function(delta)
{   
    if (delta.x == 0 && delta.y == 0 && delta.z == 0)
    {
        // no effect
        return;
    }

    // not supported for orthographic cameras
    if (this.camera == null || this.camera.attrType == eAttrType.OrthographicCamera)
    {
        return;
    }

	// check for valid viewport
	if (this.viewport.width <= 0 || this.viewport.height <= 0)
	{
		return;
	}

    // if worldUnitsPerPixel hasn't been set, use pivot distance as default
    if (this.worldUnitsPerPixel.x == 0 && this.worldUnitsPerPixel.y == 0)
    {
        var wupp = this.getWorldUnitsPerPixel(this.pivotDistance.getValueDirect());
        this.worldUnitsPerPixel.x = wupp.x;
        this.worldUnitsPerPixel.y = wupp.y;
    }

    // get sensitivity
    var sensitivity = this.trackSensitivity.getValueDirect();

    // calculate x and y deltas (scale by sensitivity & worldUnitsPerPixel)
    // calculate deltas (scale by sensitivity & worldUnitsPerPixel)
    delta.x *= sensitivity.x * this.worldUnitsPerPixel.x;
    delta.y *= sensitivity.y * this.worldUnitsPerPixel.y;
    
    // calculate z delta (scale by sensitivity)
    if (delta.z != 0)
    {
        // Let cameraPos be the sector position of the camera
		var cameraPos = this.camera.getAttribute("position").getValueDirect();

        // Let cameraRot be the world-space rotation of the camera
        var cameraRot = this.camera.getAttribute("rotation").getValueDirect();
    
        // Let cameraHeight be the delta between the clickPosWorld.y and cameraPos.y
        var cameraHeight = cameraPos.y - this.clickPosWorld.y;
        
        // STEP 2: define d1 as the distance between cameraPos and clickPosWorld
        var d1 = distanceBetween(cameraPos, this.clickPosWorld);

        // STEP 3: using the pythagorean theorem, a^2 + b^2 = c^2, where a = cameraHeight, 
        //         b = unknown, and c = d1, find the length b1 of side b
        var b1 = Math.sqrt((d1 * d1) - (cameraHeight * cameraHeight));

        // calculate distance between camera and new point
        var zoom = this.camera.getAttribute("zoom").getValueDirect();
        var fovy = 2 * Math.atan2(1, zoom);
        var radsPerPixel = fovy / this.viewport.height;
        var angleB_Radians = Math.acos(cameraHeight / d1);
        var angleA_Radians = angleB_Radians + (delta.z * radsPerPixel);
        var b2 = Math.tan(angleA_Radians) * cameraHeight;

        // STEP 7: define d3 as b2 - b1
        var d3 = b2 - b1;

        // as angle B approaches 90, use last calculated d3 (algorithm produces exponential results otherwise) 
        if (angleB_Radians >= toRadians(88) && angleB_Radians <= toRadians(92))
        {
            if (d3 < 0)
            {
                d3 = -(Math.abs(this.last_d3));
            }
            else
            {
                d3 = Math.abs(this.last_d3);
            }
        }

        var viewRotation = cameraRot;
        var fabs_bank = Math.abs(cameraRot.z);
        var flipIt = false;
        if (fabs_bank >= 90 && fabs_bank <= 270)
        {
            if (cameraRot.x > -45 && cameraRot.x < 45)
            {
                flipIt = true;
            }
        }
        if (flipIt)
        {
            d3 = -d3;
        }

        this.last_d3 = d3;

        // STEP 8: translate camera by d3 units
		delta.z = d3 * sensitivity.z * (cameraHeight < 0 ? -1 : 1);

        //var mat = new Matrix4x4();
        //mat.loadYAxisRotation(cameraRot.y);
        //var v = mat.transform(0, 0, 1, 0);
        //v.normalize();
        
        var directions = this.camera.getDirectionVectors();
        v = new Vector3D(directions.forward.x, directions.forward.y, directions.forward.z);
        v.y = 0;
        v.normalize();

        // method 1 for retrieval of angle C
        var camToClick = subtract3D(this.clickPosWorld, cameraPos);
        camToClick.y = 0;
        camToClick.normalize();
        var cosAngleBetweenCameraDirectionAndCamToClick = cosineAngleBetween(camToClick, v);
        var headingRads = Math.acos(cosAngleBetweenCameraDirectionAndCamToClick);
    
        // method 2 for retrieval of angle C
        var fovx = 2 * Math.atan(this.viewport.width / this.viewport.height * Math.tan(fovy / 2));
        var radsPerPixelX = fovx / this.viewport.width;
        var clickPoint;
        var selector = this.registry.find("Selector");
        if (selector)
        {
            clickPoint = selector.getAttribute("clickPoint").getValueDirect();
        }
        var angleC_Radians = Math.abs(this.viewport.width / 2 - clickPoint.x) * radsPerPixelX;
        headingRads = angleC_Radians;
    
        var xTrans = Math.tan(headingRads) * d3;

        var plane = new Plane(cameraPos, directions.right);
        if (pointOnNegativeSideOfPlane(this.clickPosWorld, plane))
        {
            xTrans *= -1;
        }
        if (flipIt)
        {
            xTrans *= -1;
        }

        delta.x += -xTrans;
    }
    
    // set deltas
    var values = [delta.x, delta.y, delta.z];
    var params = new AttributeSetParams(-1, -1, 0, true, false);
	this.trackDelta.setValue(values, params);
	
	// evaluate scene inspector
	this.evaluate();

    // clear deltas
    var zeroes = [0, 0, 0];
    this.trackDelta.setValue(zeroes, params);
    this.invertedTrackDelta.setValue(zeroes, params);
}

BwSceneInspector.prototype.rotate = function(delta)
{
    if (delta.x == 0 && delta.y == 0 && delta.z == 0)
    {
        // no effect
        return;
    }

    // get sensitivity
    var sensitivity = this.rotationSensitivity.getValueDirect();

    // calculate deltas (scale by sensitivity)
    delta.x *= sensitivity.x;
    delta.y *= sensitivity.y;
    delta.z *= sensitivity.z;

    // set deltas
    var values = [delta.x, delta.y, delta.z];
    var params = new AttributeSetParams(-1, -1, 0, true, false);
	this.rotationDelta.setValue(values, params);
	
    // evaluate scene inspector
	this.evaluate();

    // clear deltas
    var zeroes = [0, 0, 0];
    this.rotationDelta.setValue(zeroes, params);
    this.invertedRotationDelta.setValue(zeroes, params);
}

BwSceneInspector.prototype.zoom = function(delta)
{
    if (delta == 0)
    {
        // no effect
        return;
    }
    
    if (!this.camera)
    {
        return;
    }
    
    switch (this.camera.className)
    {
    case "PerspectiveCamera":
        {
            var zoom = this.camera.getAttribute("zoom").getValueDirect();
            zoom += delta * this.zoomSensitivity.getValueDirect();
            if (zoom < 0) zoom = 0.05; // don't go < 0
            this.camera.getAttribute("zoom").setValueDirect(zoom);
        }
        break;
        
    case "OrthographicCamera":
        {
            var width = this.camera.getAttribute("width").getValueDirect();
            width += delta * this.zoomSensitivity.getValueDirect();
            if (width < 0) width = 0; // don't go < 0
            this.camera.getAttribute("width").setValueDirect(width);
        }
        break;
    }
}

BwSceneInspector.prototype.getWorldUnitsPerPixel = function(viewSpace_Z)
{
    var x = 0;
    var y = 0;
    
    // get current viewport
    var selector = this.registry.find("Selector");
    if (selector)
    {
        var vp = selector.selections.viewports[selector.selections.viewports.length-1];
        
        if (this.camera)
        {
            switch (this.camera.attrType)
            {
            case eAttrType.PerspectiveCamera:
                {
                    // get zoom
				    var zoom = this.camera.getAttribute("zoom").getValueDirect();

				    // determine the per-pixel width and height at viewSpace_Z
				    var result = worldUnitsPerPixelPersp(vp, zoom, viewSpace_Z);
				    x = result.x;
				    y = result.y;    
                }
                break;
                
            case eAttrType.OrthographicCamera:
                {
                    // get width
				    var width = this.camera.getAttribute("width").getValueDirect();

				    // determine the per-pixel width and height
				    var result = worldUnitsPerPixelOrtho(vp, width);
				    x = result.x;
				    y = result.y;
                }
                break;
            }
        }
    }
    
    return { x: x, y: y };
}

function BwSceneInspector_TranslationDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.translate(attribute.getValueDirect());
    }
}
    
function BwSceneInspector_PanDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.pan(attribute.getValueDirect());
    }
}

function BwSceneInspector_TrackDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.track(attribute.getValueDirect());
    }
}

function BwSceneInspector_RotationDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.rotate(attribute.getValueDirect());
    }
}

function BwSceneInspector_InvertedTranslationDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        var deltas = attribute.getValueDirect();
        deltas.x *= -1;
        deltas.y *= -1;
        deltas.z *= -1;
        container.translate(deltas);
        
        if (deltas.x != 0 || deltas.y != 0 || deltas.z != 0) alert("rotate");
    }
}
 
function BwSceneInspector_InvertedPanDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        var deltas = attribute.getValueDirect();
        deltas.x *= -1;
        deltas.y *= -1;
        deltas.z *= -1;
        container.pan(deltas);
    }
}

function BwSceneInspector_InvertedTrackDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        var deltas = attribute.getValueDirect();
        deltas.x *= -1;
        deltas.y *= -1;
        deltas.z *= -1;
        container.track(deltas);
    }
}

function BwSceneInspector_InvertedRotationDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        var deltas = attribute.getValueDirect();
        deltas.x *= -1;
        deltas.y *= -1;
        deltas.z *= -1;
        container.rotate(deltas);
    }
}

function BwSceneInspector_ZoomDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.zoom(attribute.getValueDirect());
    }
}

function BwSceneInspector_InvertedZoomDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.zoom(attribute.getValueDirect() * -1);
    }
}

function BwSceneInspector_SelectionOccurredCB(attribute, container)
{
    var selector = container.registry.find("Selector");
    if (selector)
    {
        // get viewport
        if (selector.selections.viewports.length > 0)
        {
            container.viewport.loadViewport(selector.selections.viewports[0]);
        }
        
        // get click point in world-space
        container.clickPosWorld.copy(selector.getAttribute("pointWorld").getValueDirect());
        
        // get click point in view-space
        var clickPosView = selector.getAttribute("pointView").getValueDirect();
        
        // get world units per-pixel at click point z
        container.getWorldUnitsPerPixel(clickPosView.z);
    }
}

function BwSceneInspector_EnabledModifiedCB(attribute, container)
{
    var enabled = attribute.getValueDirect();
}


ObjectInspector.prototype = new ArcballInspector();
ObjectInspector.prototype.constructor = ObjectInspector;

function ObjectInspector()
{
    ArcballInspector.call(this);
    this.className = "ObjectInspector";
    this.attrType = eAttrType.ObjectInspector;
    
    this.camera = null;
    this.selectedObjects = [];
    this.pointView = new Vector3DAttr(1, 1, 1);
    this.translationDelta = new Vector3DAttr(0, 0, 0);
    this.rotationDelta = new Vector3DAttr(0, 0, 0);
    this.translationNow = new Vector3DAttr(0, 0, 0);
    this.rotationNow = new Vector3DAttr(0, 0, 0);
    this.selectionOccurred = new BooleanAttr(false);
    this.selectionCleared = new BooleanAttr(false);
    
    this.translationDelta.addModifiedCB(ObjectInspector_TranslationDeltaModifiedCB, this);
    this.rotationDelta.addModifiedCB(ObjectInspector_RotationDeltaModifiedCB, this);
    this.translationNow.addModifiedCB(ObjectInspector_TranslationNowModifiedCB, this);
    this.rotationNow.addModifiedCB(ObjectInspector_RotationNowModifiedCB, this);
    this.selectionOccurred.addModifiedCB(ObjectInspector_SelectionOccurredCB, this);
    this.selectionCleared.addModifiedCB(ObjectInspector_SelectionClearedCB, this);
    
    this.registerAttribute(this.pointView, "pointView");
    this.registerAttribute(this.translationDelta, "translationDelta");
    this.registerAttribute(this.rotationDelta, "rotationDelta");    
    this.registerAttribute(this.translationNow, "translationNow");    
    this.registerAttribute(this.rotationNow, "rotationNow");    
    this.registerAttribute(this.selectionOccurred, "selectionOccurred");
    this.registerAttribute(this.selectionCleared, "selectionCleared");
    
    // set orphan so that evaluator will not be added to scene graph
    this.orphan.setValueDirect(true);   
    
    this.enabled.addModifiedCB(ObjectInspector_EnabledModifiedCB, this)   
}

ObjectInspector.prototype.applyCameraRelativeRotation = function(selected)
{
    var i;
	
    // vectors
    var pivot  = null;
    var screen = null;
	
    // matrices
    var camXform  = null;
    var proj  = null;
    var world = null;
    
    // viewport
    var vp = this.viewport;

    // convenience
    var cam = this.camera;

    // sphere center (use world position of selected node)
    pivot = selected.worldCenter.getValueDirect();

    camXform = cam.getTransform();
    camXform.invert(); // put in view-space
    
    projection = cam.projectionMatrix;

    screen = toScreenSpace(pivot, camXform, projection, vp);
	
    this.sphereCenter.setValueDirect(screen.x, screen.y, 0);

    // sphere radius
    this.sphereRadius.setValueDirect(0.75);

    // world transform
    world = selected.getTransform();
    
    this.worldTransform.setValueDirect(world);

    // view transform
    camXform = cam.getTransform();
	
    this.viewTransform.setValueDirect(camXform);
    
    //var sPos = this.viewTransform.getValueDirect();
    //console.debug("ObjectInspector.viewTransform: " + sPos._11 + ", " + 
    //    sPos._12 + ", " + sPos._13);
}

ObjectInspector.prototype.applyCameraRelativeTranslation = function(selected)
{
    var cam = this.camera;

    // get translation delta values
    var delta = this.translationDelta.getValueDirect();
	
    if (delta.x == 0 && delta.y == 0 && delta.z == 0) 
    {
        return;
    }

    // get sector view matrix
    var camSectorXform = cam.getSectorTransform();
    camSectorXform.invert(); // put in view-space

    // get node, camera world positions
    var nodePos = selected.sectorWorldCenter.getValueDirect();
    var camPos  = cam.sectorWorldPosition.getValueDirect();

    // calculate forward vector as vector from camera world position to node world position
    var fwd = new Vector3D(nodePos.x - camPos.x, 
                           nodePos.y - camPos.y,
                           nodePos.z - camPos.z);
    fwd.normalize();

    // get viewport dimensions
    var vp = this.viewport;

    // get click point in camera space
    var v = this.pointView.getValueDirect();
    var clickPtCamSpace = new Vector3D(v.x, v.y, v.z);

    var transDelta = null;
    
    var xTransCamSpace = new Vector3D(1, 0, 0);
    var yTransCamSpace = new Vector3D(0, 1, 0);
    var zTransWorldSpace = new Vector3D(fwd.x, fwd.y, fwd.z);
    
    var destCamSpace = new Vector3D(v.x, v.y, v.z);
    
    var parent = selected.motionParent;
    var mParent = null;
    if (parent) 
    {
        mParent = parent.getTransform();
        mParent.invert();
    }
    
    var perPixelWidth = -1;
    var zoom_or_width = -1;
    
    switch (cam.attrType)
    {
        case eAttrType.PerspectiveCamera:
        {
            // get zoom
            zoom_or_width = cam.zoom.getValueDirect();

            // determine the per-pixel width and height at clickPtCamSpace.z
            perPixelWidth = worldUnitsPerPixelPersp(vp, zoom_or_width, clickPtCamSpace.z);
        }
        break;

        case eAttrType.OrthographicCamera:
        {
            // get width
            zoom_or_width = cam.width.getValueDirect();

            // determine the per-pixel width and height
            perPixelWidth = worldUnitsPerPixelOrtho(vp, zoom_or_width);

        }
        break;

        default:
            break;
    }
    
    // multiply the per-pixel width by delta.x and use this to scale the
    // camera-space vector (1, 0, 0)
    xTransCamSpace.multiplyScalar(perPixelWidth.x);
    xTransCamSpace.multiplyScalar(-delta.x);

    // multiply the per-pixel height by delta.y and use this to scale the
    // camera-space vector (0, 1, 0)
    yTransCamSpace.multiplyScalar(perPixelWidth.y);
    yTransCamSpace.multiplyScalar(delta.y);

    // multiply the per-pixel height by delta.z and use this to scale the
    // world-space forward vector
    zTransWorldSpace.multiplyScalar(perPixelWidth.y);
    zTransWorldSpace.multiplyScalar(delta.z);

    // calculate camera-space destination point as camera-space click point
    // plus xTransCamSpace and yTransCamSpace
    destCamSpace.addVector(xTransCamSpace);
    destCamSpace.addVector(yTransCamSpace);

    // convert clickPtCamSpace and destCamSpace to world space
    camSectorXform.invert();
    // if parented, multipy view with parent's inverse
    if (mParent)
    {
        camSectorXform = camSectorXform.multiply(mParent);
        zTransWorldSpace = mParent.transform(zTransWorldSpace.x, zTransWorldSpace.y, zTransWorldSpace.z, 0);
    }
    clickPtCamSpace = camSectorXform.transform(clickPtCamSpace.x, clickPtCamSpace.y, clickPtCamSpace.z, 1);
    destCamSpace = camSectorXform.transform(destCamSpace.x, destCamSpace.y, destCamSpace.z, 1);
    
    // calculate the translation delta as destCamSpace - clickPtCamSpace + zTransWorldSpace
    transDelta = new Vector3D(destCamSpace.x, destCamSpace.y, destCamSpace.z);
    transDelta.subtractVector(clickPtCamSpace);
    transDelta.addVector(zTransWorldSpace);

    // add scaled direction vectors to current node position
    var attrSetParams = new AttributeSetParams(-1, -1, eAttrSetOp.Add, true, true);
    var attrSetVals = [transDelta.x, transDelta.y, transDelta.z];
    selected.sectorPosition.setValue(attrSetVals, attrSetParams);

    var sPos = selected.sectorPosition.getValueDirect();
    //console.debug("selected.sectorPosition: " + sPos.x + ", " + 
    //    sPos.y + ", " + sPos.z);
}

ObjectInspector.prototype.translationDeltaModified = function()
{
    var pme = null;
    for (var i=0; i < this.selectedObjects.length; i++)
    {
        pme = this.getInspectionObject(this.selectedObjects[i]);
        if (!pme)
        {
            continue;
        }

        var moveable = pme.getAttribute("moveable").getValueDirect();
        if (!moveable)
        {
            continue;
        }

        this.applyCameraRelativeTranslation(pme);
    }

    var zeroes = [0, 0, 0];
    var params = new AttributeSetParams(0,0,0, true, false);

    this.translationDelta.setValue(zeroes, params);  
}

ObjectInspector.prototype.rotationDeltaModified = function()
{
    var pme = null;
    for (var i=0; i < this.selectedObjects.length; i++)
    {
        pme = this.getInspectionObject(this.selectedObjects[i]);
        if (!pme)
        {
            continue;
        }

        var moveable = pme.moveable.getValueDirect();
        if (!moveable)
        {
            continue;
        }

        this.applyCameraRelativeRotation(pme);

        var mNow = this.mouseNow.getValueDirect();
        var rDelta = this.rotationDelta.getValueDirect();

        mNow.x -= rDelta.x;
        mNow.y -= rDelta.y;

        // mouse now (formulate so that mouse coords match windows standard
        // of (0, 0) at top-left, and (width, height) at bottom-right)
        this.mouseNow.setValueDirect(mNow.y, mNow.x);

        this.evaluate();
    }
}

ObjectInspector.prototype.rotationNowModified = function()
{
    if (this.selectedObjects == null ||
        this.selectedObjects == undefined)
        return;
    
    var pme = null;
    for (var i=0; i < this.selectedObjects.length; i++)
    {
        pme = this.getInspectionObject(this.selectedObjects[i]);
		
        var moveable = pme.moveable.getValueDirect();
        if (moveable)
        {

            this.applyCameraRelativeRotation(pme);
            
            var rNow = this.rotationNow.getValueDirect();
            
            // mouse now (formulate so that mouse coords match windows standard
            // of (0, 0) at top-left, and (width, height) at bottom-right)
            this.mouseNow.setValueDirect(rNow.y, rNow.x);
            
            //console.debug("mouseNow: " + rNow.x + ", " + 
            //    rNow.y);
    
            this.evaluate();
        }
    }
}

ObjectInspector.prototype.runSelectionOccurred = function()
{       
    var selector =  this.registry.find("Selector");
    var vpMgr = this.registry.find("ViewportMgr");

    //this.registryThreadLock.Unlock();
    if (!selector || !vpMgr)
    {
        return;
    }

    // get selector click point
    // must use getAttribute here b/c it's not a native attribute to Selector
    var clickPoint = selector.getAttribute("clickPoint").getValueDirect();

    // get viewport and camera into view object
    var view = vpMgr.getViewportAtScreenXY(clickPoint.x, clickPoint.y);
    this.viewport = view.viewport;
    this.camera = view.camera;
	
    // get selected movable objects
    // TODO: don't assume models?
    this.selectedObjects = selector.selections.models.slice();

    var pResultQuat = this.resultQuat;
    var pQuatAtMouseDown = this.quatAtMouseDown;
    var pMouseDown = this.mouseDown;
    var pMouseNow = this.mouseNow;
    
    var pSelected = null;
    var pIso = null;	// TODO: support more than just Isolators
    var pChildZero = null;
    var pRotGroup = null;
    var pQuat = null;
    var pTransOut = null;
    var pTransBack = null;
    var pRotQuatAttr = null;
    var pBox = null;
    var center = 0;
    var centerNeg = 0;
	
    for (var i=0; i < this.selectedObjects.length; i++)
    {
        pResultQuat.removeAllTargets();

        pMouseDown.setValueDirect(clickPoint.x, clickPoint.y);
        pMouseNow.setValueDirect(clickPoint.x, clickPoint.y);

        pSelected = this.getInspectionObject(this.selectedObjects[i]);

        pRotGroup = getInspectionGroup(pSelected);
        //setInspectionGroupActivationState(pSelected, this.enabled.getValueDirect())
        if (pRotGroup && (pQuat = pRotGroup.getChild(2)))
        {
            // see notes in BwObjectInspector.cpp
            var values = [true];
            var params = new AttributeSetParams(-1, -1, eAttrSetOp.Replace, true, true);
            // it would seem easier to setValueDirect(true) here given params are
            // created with all default values but params are reused throughout this
            // function and setting the intended params values, per the notes in .cpp,
            // triggers a bug elsewhere. 
            pQuat.enabled.setValue(values, params);

            pRotQuatAttr = pQuat.rotationQuat;

            pResultQuat.addTarget(pRotQuatAttr, eAttrSetOp.Replace, null, false);

            var prq = pRotQuatAttr.getValueDirect();
            pQuatAtMouseDown.setValueDirect(prq);

            var box = pSelected.bbox;
            var min = box.min.getValueDirect();
            var max = box.max.getValueDirect();
            center = new Vector3D(min.x, min.y, min.z);
            center.addVector(max);
            center.multiplyScalar(0.5);

            var pivot = pSelected.pivot.getValueDirect();
            if (pSelected.pivotAboutGeometricCenter.getValueDirect())
            {
                pivot = center;
            }				
            var pivotNeg = new Vector3D(pivot.x, pivot.y, pivot.z);
            pivotNeg.multiplyScalar(-1);

            // translate to pivot before applying quaternion rotation
            // don't alert modified sinks here because this will cause antialiasing to reset
            values = [pivot.x, pivot.y, pivot.z];
            pRotGroup.getChild(0).translation.setValue(values, params);

            // don't alert modified sinks here because this will cause antialiasing to reset
            var scale = pSelected.worldScale.getValueDirect();
            var scaleInv = new Vector3D(1 / scale.x,
                1 / scale.y,
                1 / scale.z);
            values[0] = scaleInv.x;
            values[1] = scaleInv.y;
            values[2] = scaleInv.z;
            pRotGroup.getChild(1).scale.setValue(values, params);

            values[0] = scale.x;
            values[1] = scale.y;
            values[2] = scale.z;
            pRotGroup.getChild(3).scale.setValue(values, params);

            // translate back from pivot after applying quaternion rotation
            // don't alert modified sinks here because this will cause antialiasing to reset
            values[0] = pivotNeg.x;
            values[1] = pivotNeg.y;
            values[2] = pivotNeg.z;
            pRotGroup.getChild(4).translation.setValue(values, params);
        }
    }   
}

ObjectInspector.prototype.runSelectionCleared = function()
{
    this.selectedObjects = [];
}

ObjectInspector.prototype.getInspectionObject = function(selected)
{
    while (selected.motionParent)
    {
        selected = selected.motionParent;
    }
    
    return selected;
}

ObjectInspector.prototype.clearSelection = function(selected)
{
    for (var i = 0; i < this.selectedObjects.length; i++)
    {
        if (this.selectedObjects[i] == selected)
        {
            this.selectedObjects.splice(i, 1);
        }
    }
}

function ObjectInspector_TranslationDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.translationDeltaModified();
    }
}

function ObjectInspector_RotationDeltaModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.rotationDeltaModified();
    }
}

function ObjectInspector_TranslationNowModifiedCB(attribute, container)
{
// deprecated
}

function ObjectInspector_RotationNowModifiedCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.rotationNowModified();
    }
}

function ObjectInspector_SelectionOccurredCB(attribute, container)
{
    var enabled = container.enabled.getValueDirect();
    if (enabled)
    {
        container.runSelectionOccurred();
    }
}

function ObjectInspector_SelectionClearedCB(attribute, container)
{
    container.runSelectionCleared();
}

function ObjectInspector_EnabledModifiedCB(attribute, container)
{
    console.debug("ObjectInspector.enable modified: " + container.enabled.getValueDirect().toString())
}


ConnectionMgr.prototype = new AttributeContainer();
ConnectionMgr.prototype.constructor = ConnectionMgr;

function ConnectionMgr()
{
    AttributeContainer.call(this);
    this.className = "ConnectionMgr";
    
    this.name = new StringAttr("ConnectionMgr");
    
    this.registerAttribute(this.name, "name");
    
    // TODO: finish adding connection helpers
    //registerConnectionHelper("DisconnectAllSources", null, ConnectionMgr.prototype.disconnectAllSources);
    registerConnectionHelper("DisconnectAllTargets", null, ConnectionMgr.prototype.disconnectAllTargets);
    registerConnectionHelper("dissolve", ConnectionMgr.prototype.connectDissolve, ConnectionMgr.prototype.disconnectDissolve);
    registerConnectionHelper("walkSimulation", ConnectionMgr.prototype.connectWalkSimulation, ConnectionMgr.prototype.disconnectWalkSimulation);
}

ConnectionMgr.prototype.connectSceneInspection = function(inspector, camera)
{
    if (!inspector || !camera) return;
    
    var lastCamera = inspector.getCamera();
    if (lastCamera == camera)
    {
        // already connected
        return;
    }
    else if (lastCamera)
    {
        this.disconnectSceneInspection(inspector, lastCamera);
    }

    camera.getAttribute("sectorPosition").addTarget(inspector.getAttribute("viewPosition"), eAttrSetOp.Replace, null, true);
    camera.getAttribute("rotation").addTarget(inspector.getAttribute("viewRotation"), eAttrSetOp.Replace, null, true);

    inspector.getAttribute("resultPosition").addTarget(camera.getAttribute("sectorPosition"), eAttrSetOp.Replace, null, false);
    inspector.getAttribute("resultRotation").addTarget(camera.getAttribute("rotation"), eAttrSetOp.Replace, null, false);
    
    inspector.setCamera(camera);
}

ConnectionMgr.prototype.disconnectAllTargets = function(source, target)
{
    if (source)
    {
        var count = source.getAttributeCount();
        for (var i=0; i < count; i++)
        {
            var attribute = source.getAttributeAt(i);
            if (attribute)
            {
                attribute.removeAllTargets();
            }
        }
    }
}

ConnectionMgr.prototype.disconnectSceneInspection = function(inspector, camera)
{
    if (!inspector || !camera) return;
    
    camera.getAttribute("sectorPosition").removeTarget(inspector.getAttribute("viewPosition"));
    camera.getAttribute("rotation").removeTarget(inspector.getAttribute("viewRotation"));
    
    inspector.getAttribute("resultPosition").removeTarget(camera.getAttribute("sectorPosition"));
    inspector.getAttribute("resultRotation").removeTarget(camera.getAttribute("rotation"));
    
    inspector.setCamera(null);
}

ConnectionMgr.prototype.connectMapProjectionCalculator = function(mpc, pme)
{
    if (!mpc || !pme) return;

    mpc.getAttribute("resultPosition").addTarget(pme.getAttribute("position"));

    mpc.evaluate();
}

ConnectionMgr.prototype.disconnectMapProjectionCalculator = function(mpc, pme)
{
    if (!mpc || !pme) return;

    mpc.getAttribute("resultPosition").removeTarget(pme.getAttribute("position"));
}

ConnectionMgr.prototype.connectDissolve = function(evaluator, target)
{
    if (!evaluator || !target) return;
    
    var dissolve = target.getAttribute("dissolve");
    if (dissolve)
    {
        var resultValues = evaluator.getAttribute("resultValues");
        if (resultValues)
        {
            var resultValue = resultValues.getAt(0);
            if (resultValue)
            {
                resultValue.addTarget(dissolve);
            }
        }
    }
}

ConnectionMgr.prototype.disconnectDissolve = function(evaluator, target)
{
    if (!evaluator || !target) return;
    
    var dissolve = target.getAttribute("dissolve");
    if (dissolve)
    {
        var resultValues = evaluator.getAttribute("resultValues");
        if (resultValues)
        {
            var resultValue = resultValues.getAt(0);
            if (resultValue)
            {
                resultValue.removeTarget(dissolve);
            }
        }
    }
}

ConnectionMgr.prototype.connectWalkSimulation = function(simulator, target)
{
    ConnectionMgr.prototype.connectSceneInspection.call(null, simulator, target);
}

ConnectionMgr.prototype.disconnectWalkSimulation = function(simulator, target)
{
    ConnectionMgr.prototype.disconnectSceneInspection.call(null, simulator, target);
}

ConnectionMgr.prototype.connectModelsToMorph = function(source, target, morphIncr)
{
    if (!source || !target) return;
    
    var factory = this.registry.find("AttributeFactory");
    
    // get target vertices
    var targetVertices = target.getAttribute("vertices").getValueDirect();
    
    // for each geometry set in the source...
    for (var i = 0; i < source.geometry.length; i++)
    {
        // get indices
        var indices = source.geometryIndices[i];    
        if (!indices) continue;
        
        // create morph effector    
        var morpher = factory.create("MorphEffector");   
        morpher.getAttribute("renderAndRelease").setValueDirect(true);
        morpher.getAttribute("morphIncr").setValueDirect(morphIncr);
        
        // get source vertices from geometry and set to sourceVertices on morpher
        var sourceVertices = source.geometry[i].getAttribute("vertices").getValueDirect();
        morpher.getAttribute("sourceVertices").setValueDirect(sourceVertices);
        
        // set target vertices
        var morpher_targetVertices = [];
        for (var j = 0; j < indices.length; j++)
        {
            var index = indices[j];
            
            if (index * 3 + 2 < targetVertices.length)
            {
                morpher_targetVertices.push(targetVertices[index * 3    ]);
                morpher_targetVertices.push(targetVertices[index * 3 + 1]);
                morpher_targetVertices.push(targetVertices[index * 3 + 2]);
            }
            else // target deosn't contain enough points, use source
            {
                morpher_targetVertices.push(sourceVertices[j * 3    ]);
                morpher_targetVertices.push(sourceVertices[j * 3 + 1]);
                morpher_targetVertices.push(sourceVertices[j * 3 + 2]);
            }
        }
        morpher.getAttribute("targetVertices").setValueDirect(morpher_targetVertices);
        
        // connect result vertices to source vertices
        morpher.getAttribute("resultVertices").addTarget(source.geometry[i].getAttribute("vertices"));
    }
}


RenderAgent.prototype = new Agent();
RenderAgent.prototype.constructor = RenderAgent;

var ePlayState = {
    Unknown:    -1,
    
    Play:       0,
    Pause:      1,
    Stop:       2,
}

function RenderAgent(bridgeworks)
{
    Agent.call(this);
    this.className = "RenderAgent";
    
    this.bridgeworks = bridgeworks;
    
    this.name.setValueDirect("RenderAgent");
    this.timer = new Timer();
    
    this.frameRate = new NumberAttr(0);
    this.desiredFrameRate = new NumberAttr(30);
    this.timeIncrement = new NumberAttr(0);
    this.globalTimeInSecs = new NumberAttr(0);
    this.elapsedTimeInSecs = new NumberAttr(0);

    this.desiredFrameRate.addModifiedCB(RenderAgent_DesiredFrameRateModified, this);
    this.globalTimeInSecs.addModifiedCB(RenderAgent_GlobalTimeInSecsModified, this);
    
    this.registerAttribute(this.frameRate, "frameRate");
    this.registerAttribute(this.desiredFrameRate, "desiredFrameRate");
    this.registerAttribute(this.timeIncrement, "timeIncrement");
    this.registerAttribute(this.globalTimeInSecs, "globalTimeInSecs");
    this.registerAttribute(this.elapsedTimeInSecs, "elapsedTimeInSecs");
}

RenderAgent.prototype.render = function()
{
    this.timer.stop();
    var increment = this.timer.getTime();
    this.timer.start();
    this.timeIncrement.setValueDirect(increment);
    
    var elapsedTime = this.elapsedTimeInSecs.getValueDirect() + increment;
    this.elapsedTimeInSecs.setValueDirect(elapsedTime);
    // update frame rate
    this.frameRate.setValueDirect(1.0 / increment);
    //alert(this.desiredFrameRate.getValueDirect());
    this.animateEvaluators(increment);
    this.executeRenderDirectives();
}

RenderAgent.prototype.animateEvaluators = function(timeIncrement)
{
    var evaluators = this.registry.getByType(eAttrType.Evaluator);
    for (var i=0; i < evaluators.length; i++)
    {
        this.animateEvaluator(evaluators[i], timeIncrement);
    }
}

RenderAgent.prototype.animateEvaluator = function(evaluator, timeIncrement)
{
    var enabled = evaluator.getAttribute("enabled").getValueDirect();
    var expired = evaluator.getAttribute("expired").getValueDirect();

    var orphan = evaluator.getAttribute("orphan").getValueDirect();

    if (enabled && !expired)
    {
        switch (evaluator.className)
        {
            case "KeyframeInterpolator":
            {
                var params = new AttributeSetParams(-1, -1, eAttrSetOp.Add, true, true);
                evaluator.getAttribute("time").setValue(timeIncrement, params);
            }
            break;
            
            case "ObjectMover":
            case "AnimalMover":
            case "PhysicsSimulator":
            case "GoblinPhysicsSimulator":
            case "CannonPhysicsSimulator":
            case "Spinner":
            {
            	evaluator.getAttribute("timeIncrement").setValueDirect(timeIncrement);
            }
        }

        // don't evaluate scene/object inspection here, or any other evaluator not in the scene graph
        if (!orphan) evaluator.evaluate();
    }

    // if evaluator has expired, and it's set to "renderAndRelease", release it
    if (expired && evaluator.getAttribute("renderAndRelease").getValueDirect())
    {
        this.registry.unregister(evaluator);
    }
}

RenderAgent.prototype.executeRenderDirectives = function()
{
    var directives = this.registry.getByType(eAttrType.RenderDirective);
    if (directives)
    {
        this.bridgeworks.viewportMgr.layoutDirectives(directives);
        for (var i=0; i < directives.length; i++)
        {
        	directives[i].getAttribute("timeIncrement").setValueDirect(this.timeIncrement.getValueDirect());
            directives[i].execute();    
        }
    }   
}

// never executes
RenderAgent.prototype.globalTimeInSecsModified = function()
{
    var globalTime = this.globalTimeInSecs.getValueDirect();

    // synchronize elapsed time
    this.elapsedTimeInSecs.setValueDirect(globalTime);

    // get all evaluators and set their time to globalTimeInSecs
    if (this.registry)
    {
        var evaluators = this.registry.getByType(eAttrType.Evaluator);
        if (evaluators)
        {
            for (var i=0; i < evaluators.length; i++)
            {
                var evaluator = evaluators[i];
                if (evaluator)
                {
                    var time = evaluator.getAttribute("time");
                    if (time)
                    {
                        var globalTimeSyncEnabled = evaluator.getAttribute("globalTimeSyncEnabled");
                        if ((globalTimeSyncEnabled && globalTimeSyncEnabled.getValueDirect()) ||
                            !globalTimeSyncEnabled)
                        {
                            time.setValueDirect(globalTime);
                        }
                    }
                    
                    evaluator.evaluate(); // calling Evaluate() will reset "expired" flag based upon global time
                }
            }
        }

        // disable the rotation inspection group for the models in the scene;
        // this is required b/c user may have rotated models during
        // object inspection and Object Inspection uses transformation
        // nodes that will still be affecting the target
        var models = this.registry.getByType(eAttrType.Model);
        if (models)
        {
            for (var i=0; i < models.length; i++)
            {
                setInspectionGroupActivationState(models[i], false);
            }
        }
    }
}

RenderAgent.prototype.setEvaluatorPlayState = function(evaluator, state)
{
    if (!evaluator)
    {
        return this.setEvaluatorPlayState(state);
    }
    
    // perform state-specific processing
    var en = evaluator.getAttribute("enabled");
    switch (state)
    {
    case ePlayState.Play:
        {
            en.setValueDirect(true);
        }
        break;

    case ePlayState.Pause:
        {
            en.setValueDirect(false);
        }
        break;

    case ePlayState.Stop:
        {
            en.setValueDirect(false);

            // if kfi, set time to 0 and evaluate once to reset outputs to time 0
            switch (evaluator.className)
            {
            case "KeyframeInterpolator":
                {
                    evaluator.getAttribute("time").setValueDirect(0);
                    evaluator.evaluate();
                }
            }
        }
        break;
    }
    
    clearObjectPositionMap();
}

RenderAgent.prototype.setEvaluatorsPlayState = function(state)
{
    if (this.registry)
    {
        var evaluators = this.registry.getByType(eAttrType.Evaluator);
        if (evaluators)
        {
            for (i=0; i < evaluators.length; i++)
            {
                var evaluator = evaluators[i];
                
                var type = evaluator.attrType;

                // don't set play state for inspectors or any evaluators not in scenegraph
                var orphan = evaluator.getAttribute("orphan").getValueDirect();
                if (!orphan)
                {
                    this.setEvaluatorPlayState(evaluator, state)
                }

            }
        }
    }
}

RenderAgent.prototype.setDesiredFrameRate = function(rate)
{
    this.desiredFrameRate.setValueDirect(rate);
}

function RenderAgent_DesiredFrameRateModified(attribute, container)
{
}

function RenderAgent_GlobalTimeInSecsModified(attribute, container)
{
    var renderAgent = container.registry.find("RenderAgent");
    renderAgent.globalTimeInSecsModified();
}
var FRAME_RATE_DEFAULT = 30;
var FRAME_RATE_MAX = FRAME_RATE_DEFAULT * 32;
var FRAME_RATE_MIN = FRAME_RATE_DEFAULT * -32;

RenderController.prototype = new AttributeContainer();
RenderController.prototype.constructor = RenderController;

function RenderController(bridgeworks)
{
    AttributeContainer.call(this);
    this.className = "RenderController";
    
    this.playState = ePlayState.Pause;
    
    this.renderAgent = bridgeworks.renderAgent;
}

RenderController.prototype.fastForward = function()
{
    this.play();
    var rate = this.renderAgent.frameRate.getValueDirect();
    if (rate < 0)
    {
        this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_DEFAULT);
    }
    
    if (rate < FRAME_RATE_MAX)
	{
		this.renderAgent.desiredFrameRate.setValueDirect(Math.abs(this.renderAgent.frameRate) * 2);
	}
	else
	{
		// clamp to max fast forward speed
		this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_MAX);
	}
}

RenderController.prototype.pause = function()
{
    this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_DEFAULT);
    this.renderAgent.setEvaluatorsPlayState(ePlayState.Pause);
}

RenderController.prototype.play = function()
{
    this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_DEFAULT);
    this.renderAgent.setEvaluatorsPlayState(ePlayState.Play);    
}

RenderController.prototype.rewind = function()
{
    this.play();
    var rate = this.renderAgent.frameRate.getValueDirect();
    if (rate > 0)
    {
        this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_DEFAULT);
    }
    if (rate > FRAME_RATE_MIN)
    {
        this.renderAgent.desiredFrameRate.setValueDirect(Math.abs(this.renderAgent.frameRate) * -2);
    }
    else
    {
        this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_MIN);    
    }
}

RenderController.prototype.stop = function()
{
    this.renderAgent.setEvaluatorsPlayState(ePlayState.Stop);
    this.renderAgent.desiredFrameRate.setValueDirect(1);
}


/**
 *	Reverses the frame rate and updates a status label with the
 *	current playback speed.  Rewind is a negative frame rate
 *  that doubles with each push of the button until 
 *  BridgeworksObject.FRAME_RATE_MIN is reached
 *	
 *	@param void
 *	@return void
	
function DVD_Rewind()
{
    bridgeworks.updateScene("<Play/>");
    

    if (bridgeworks.renderAgent.frameRate > 0)
    {
        bridgeworks.renderAgent.setDesiredFrameRate(FRAME_RATE_DEFAULT);
    }
    
    if (bridgeworks.renderAgent.frameRate > FRAME_RATE_MIN)	// if fast forwarding or playing
	{
		bridgeworks.renderAgent.setDesiredFrameRate(Math.abs(bridgeworks.renderAgent.frameRate) * -2);
	}
	else	// max rewind value reached
	{
		// clamp to max rewind speed
		bridgeworks.renderAgent.setDesiredFrameRate(FRAME_RATE_MIN);
	}
    
    g_paused = false;

}
 */

/**
 *	Fast forwards the frame rate and updates a status label with the
 *	current playback speed.  Fast forward is a positive frame rate
 *  that doubles with each push of the button until
 *  BridgeworksObject.FRAME_RATE_MAX is reached
 *	
 *	@param void
 *	@return void

function DVD_FastForward()
{
    bridgeworks.updateScene("<Play/>");
    
    if (bridgeworks.renderAgent.frameRate < 0)
    {
        bridgeworks.renderAgent.setDesiredFrameRate(FRAME_RATE_DEFAULT);
    }
    
    if (bridgeworks.renderAgent.frameRate < FRAME_RATE_MAX)
	{
		bridgeworks.renderAgent.setDesiredFrameRate(Math.abs(bridgeworks.renderAgent.frameRate) * 2);
	}
	else
	{
		// clamp to max fast forward speed
		bridgeworks.renderAgent.setDesiredFrameRate(FRAME_RATE_MAX);
	}
    
    g_paused = false;

}
 */	

function Selections()
{
    this.viewports = [];
    this.cameras = [];
    this.lights = [];
    this.models = [];
    this.surfaces = [];
    this.labels = [];
    
    this.clear = function()
    {
        this.viewports = [];
        this.cameras = [];
        this.lights = [];
        this.models = [];
        this.surfaces = [];
        this.labels = [];
    }
}

SelectionListener.prototype = new EventListener();
SelectionListener.prototype.constructor = SelectionListener;

function SelectionListener()
{
    EventListener.call(this);
    this.className = "SelectionListener";

    this.name.setValueDirect("Selector");

    this.rayPick = null;
    this.selections = new Selections();
    this.selectionEvent = null;
    this.selected = null;
    this.unsnapped = null;
    
    this.selectionOccurred = new PulseAttr();
    this.selectionCleared = new PulseAttr();
    this.pointView = new Vector3DAttr();
    this.pointWorld = new Vector3DAttr();
    this.pointObject = new Vector3DAttr();
    this.pointGeo = new Vector3DAttr();
    this.normalView = new Vector3DAttr();
    this.normalWorld = new Vector3DAttr();
    this.normalObject = new Vector3DAttr();
    this.triIndex = new NumberAttr();
    this.distance = new NumberAttr();
    this.distanceFromScreenCenter = new NumberAttr();
    this.computePivotDistance = new BooleanAttr(true);
    this.selectedName = new StringAttr();
    this.selectedElement = new NumberAttr(-1);	// this.registered when the selection has a selected element
    this.lastSelectedName = new StringAttr();

    this.pointWorld.addModifiedCB(SelectionListener_PointWorldModifiedCB, this);

    this.registerAttribute(this.selectionOccurred, "selectionOccurred");
    this.registerAttribute(this.selectionCleared, "selectionCleared");
    this.registerAttribute(this.pointView, "pointView");
    this.registerAttribute(this.pointWorld, "pointWorld");
    this.registerAttribute(this.pointObject, "pointObject");
    this.registerAttribute(this.pointGeo, "pointGeo");
    this.registerAttribute(this.normalView, "normalView");
    this.registerAttribute(this.normalWorld, "normalWorld");
    this.registerAttribute(this.normalObject, "normalObject");
    this.registerAttribute(this.triIndex, "triIndex");
    this.registerAttribute(this.distance, "distance");
    this.registerAttribute(this.distanceFromScreenCenter, "distanceFromScreenCenter");
    this.registerAttribute(this.computePivotDistance, "computePivotDistance");
    this.registerAttribute(this.selectedName, "selectedName");
    this.registerAttribute(this.lastSelectedName, "lastSelectedName");
    
    this.numResponses.setValueDirect(-1);
}

SelectionListener.prototype.setRayPick = function(rayPick)
{
    this.rayPick = rayPick;
    
    var clickPoint = this.rayPick.getAttribute("clickPoint");
    this.registerAttribute(clickPoint, "clickPoint");
    clickPoint.addModifiedCB(SelectionListener_ClickPointModifiedCB, this);
}

SelectionListener.prototype.eventPerformed = function(event)
{
    this.selectionEvent = event;
    
    // if mouse-move event, don't process if any other mouse button is pressed (this affects object inspection)
    switch (event.type)
    {
        case eEventType.MouseMove:
        {
            if (event.inputId & MOUSEEVENT_LEFT_BUTTON ||
                event.inputId & MOUSEEVENT_MIDDLE_BUTTON ||
                event.inputId & MOUSEEVENT_RIGHT_BUTTON)
                return;        
        }
        break;
    }
    
    // TODO: allow for multi-select (clear if Ctrl is not pressed)
    this.clearSelections();
    
    this.getAttribute("clickPoint").setValueDirect(event.x, event.y);
}

SelectionListener.prototype.registerSelection = function(node, element)
{ 
    // only register first item
    if (this.selected) return;
    
    this.selected = node;
    var selected = node.getAttribute("selected");
    if (selected)
    {
        selected.setValueDirect(1);
    }
    
    // registering an attribute that has a NULL container (Get/SetContainer()) will set
    // the calling object as the container; don't want this behavior here
    var lastContainer = this.selected.getContainer();
    this.registerAttribute(this.selected, "Selected");	// unregistered in clearSelections()
    this.selected.setContainer(lastContainer);
	
    var name = node.getAttribute("name").getValueDirect().join("");
    //OutputDebugMsg("Selected: " + name);

    this.selectedName.setValueDirect(name);
    
    if (element >= 0)
    {
        this.selectedElement.setValueDirect(element);
        this.selected.registerAttribute(this.selectedElement, "selectedElement");
    }
}

SelectionListener.prototype.clearSelections = function()
{    
    this.selections.clear();
   
    this.selectedElement.setValueDirect(-1);
    if (this.selected)
    {
        this.selected.highlight.setValueDirect(false);
        this.selected.getAttribute("stopOnCollision").setValueDirect(false);
        
        var selected = this.selected.getAttribute("selected");
        if (selected)
        {
            selected.setValueDirect(0);
        }
    
    	if (this.selected.getAttribute("selectedElement"))
    	{
            this.selected.unregisterAttribute(this.selectedElement);
        }
        
        this.selectedName.setValueDirect("");
    	this.unregisterAttribute(this.selected);
    	this.selected = null;
    }
    
    this.selectionCleared.pulse();
}

SelectionListener.prototype.processPick = function(pick)
{
    for (var i=0; i < pick.path.length; i++)
    {
        var node = pick.path[i];
        
        // if selectable or show is false, or polygons are flipped, skip
        var selectable = node.getAttribute("selectable");
        var show = node.getAttribute("show");
        var flipPolygons = node.getAttribute("flipPolygons");
        if ((selectable && selectable.getValueDirect() == false) ||
            (show && show.getValueDirect() == false) ||
            (flipPolygons && flipPolygons.getValueDirect() == true))
            {
            continue;
        }      
        
        var element = -1;
        switch (node.attrType)
        {
            case eAttrType.PerspectiveCamera:
            case eAttrType.OrthographicCamera:
            {
                this.selections.cameras.push(node);
            }
            break;
		    
            case eAttrType.DirectionalLight:
            case eAttrType.PointLight:
            case eAttrType.SpotLight:
            {
                this.selections.lights.push(node);
            }
            break;
		    
            case eAttrType.Model:
            case eAttrType.SnapModel:
            {
                this.selections.models.push(node);
                this.registerSelection(node, element);
            }
            break;
            
            case eAttrType.Surface:
            {
                this.selections.surfaces.push(node);
            }
            break;

            case eAttrType.Label:
            {
                this.selections.labels.push(node);
                this.registerRasterComponentSelection(node, element);
            }
        }
    }
    
    if (this.selected)
    {
        // resnap if previously unsnapped
        if (this.unsnapped != this.selected)
        {
            if (this.unsnapped)
            {
                // restore unsnapped snapEnabled state
                this.unsnapped.snapEnabled.setValueDirect(true);
                
                // resnap previously-unsapped models (if still touching)
                var snapMgr = this.registry.find("SnapMgr");
                snapMgr.resnap(this.unsnappedModels);
               
                // mark all unsnapped models as physics-enabled and restore stopOnCollision flag (so they repel)
                for (var i = 0; i < this.unsnappedModels.length; i++)
                {
                    this.unsnappedModels[i].physicsEnabled.setValueDirect(true);
                    //this.unsnappedModels[i].stopOnCollision.setValueDirect(true);
                }
                
                this.unsnappedModels = null;
                this.unsnapped = null;
            }
        }
    
        // set stopOnCollision for the selected object (do this here because it needs to be 
        // cleared by the unsnap block below (if unsnapping)
        this.selected.getAttribute("stopOnCollision").setValueDirect(true);
        
        // unsnap if double-clicking on a snapped model and select the appropriate unsnapped model
        // corresponding to the snapped surface selected
        if (this.selectionEvent.type == eEventType.MouseLeftDblClick)
        {          
            if (this.selected.attrType == eAttrType.SnapModel)
            {
                // unsnap models
                this.unsnappedModels = this.selected.unsnapAll();
                // select selected unsnapped model
                this.unsnapped = this.selections.surfaces[0].snappedModel;
                this.unsnapped.snapEnabled.setValueDirect(false);
                this.selected = null // clear previous
                this.registerSelection(this.unsnapped, -1);
                
                // mark all unsnapped models as physics-disabled and clear stopOnCollision flag (so they won't repel)
                for (var i = 0; i < this.unsnappedModels.length; i++)
                {
                    this.unsnappedModels[i].physicsEnabled.setValueDirect(false);
                    this.unsnappedModels[i].stopOnCollision.setValueDirect(false);
                }              
            }
        }
        
        this.selected.highlight.setValueDirect(true);
        
        this.pointObject.setValueDirect(pick.intersectRecord.pointModel.x, pick.intersectRecord.pointModel.y, pick.intersectRecord.pointModel.z);
        this.pointWorld.setValueDirect(pick.intersectRecord.pointWorld.x, pick.intersectRecord.pointWorld.y, pick.intersectRecord.pointWorld.z);
        this.pointView.setValueDirect(pick.intersectRecord.pointView.x, pick.intersectRecord.pointView.y, pick.intersectRecord.pointView.z);
        this.normalObject.setValueDirect(pick.intersectRecord.normalModel.x, pick.intersectRecord.normalModel.y, pick.intersectRecord.normalModel.z);
        this.normalWorld.setValueDirect(pick.intersectRecord.normalWorld.x, pick.intersectRecord.normalWorld.y, pick.intersectRecord.normalWorld.z);
        this.normalView.setValueDirect(pick.intersectRecord.normalView.x, pick.intersectRecord.normalView.y, pick.intersectRecord.normalView.z);
        this.triIndex.setValueDirect(pick.intersectRecord.triIndex);
        this.distance.setValueDirect(pick.intersectRecord.distance);
    }
    
    return (this.selected ? true : false);
}

SelectionListener.prototype.processPicks = function(picks)
{
    for (var i=0; i < picks.length; i++)
    {
        if (this.processPick(picks[i]) == true)
        {
            return true;
        }
    }   
    
    return false;
}

SelectionListener.prototype.registerRasterComponentSelection = function(rc,element)
{
    // if a GUI has already been selected, replace if node paramter has a greater renderedSlot value
    if (this.selected)
    {
        var selected = this.selected;
        if (selected)
        {
            var renderedSlotSelection = rc.renderedSlot.getValueDirect();
            var renderedSlotSelected = selected.renderedSlot.getValueDirect();

            if (renderedSlotSelection > renderedSlotSelected)
            {
                return this.registerSelection(rc, element, true);
            }
        }
    }
    else // no previous selection, register
    {
        this.registerSelection(rc, element);
    }

}
SelectionListener.prototype.clickPointModified = function()
{
    var point = this.getAttribute("clickPoint").getValueDirect();
    var vpMgr = this.registry.find("ViewportMgr");
    var vp = vpMgr.getViewportAtScreenXY(point.x, point.y);
    this.selections.viewports.push(vp.viewport);
    this.rayPick.getAttribute("viewport").setValueDirect(vp.viewport.x, vp.viewport.y, vp.viewport.width, vp.viewport.height);
    this.rayPick.getAttribute("camera").setValueDirect(vp.camera);
    var root = this.registry.getAttribute("rootPtr").getValueDirect();
    this.rayPick.execute(root);
    if (this.rayPick.picked.length > 0)
    {
        this.processPicks(this.rayPick.picked);
        this.selectionOccurred.pulse();
    }
    // update distance from screen center
    this.updateDistanceFromScreenCenter(root);
    // update scene inspector with selected camera
    this.updateSceneInspectionCamera(vp.camera);
}

SelectionListener.prototype.updateDistanceFromScreenCenter = function(root)
{
    if (this.computePivotDistance.getValueDirect() == false)
    {
        return;
    }

    // get window center and set to ray pick's click point
    var bworks = this.registry.find("Bridgeworks");
    if (!bworks) return;
    var x = bworks.canvas.width / 2;
    var y = bworks.canvas.height / 2;
    var lastClickPoint = this.rayPick.getAttribute("clickPoint").getValueDirect();
    var params = new AttributeSetParams(-1, -1, 0, false, false);   
    this.rayPick.getAttribute("clickPoint").setValueDirect(x, y, params);
    
    // execute
    this.rayPick.execute(root);
    
    // cycle through picked list and skip labels and poly lines
    // NOTE: we may eventually want the convenience of pivoting about a label because labels are sometimes easier 
    // to intersect (i.e., when the model is too small to intersect)
    var found = false;
    for (var i=0; i < this.rayPick.picked.length && !found; i++)
    {
        if (this.rayPick.picked[i].intersectRecord.distance != 0) // labels and poly lines have a distance of 0
        {
            // found selected geometry, update distance from screen center
            this.distanceFromScreenCenter.setValueDirect(this.rayPick.picked[i].intersectRecord.distance);
            found = true;
            break;
        }
    }

    // restore previous click point
    this.rayPick.getAttribute("clickPoint").setValueDirect(lastClickPoint.x, lastClickPoint.y, params);   
}

SelectionListener.prototype.updateSceneInspectionCamera = function(camera)
{
    var si = this.registry.find("SceneInspector");
    if (si)
    {
        if (si.getCamera() == camera) return; // already connected
        
        // disconnect old camera, connect new one
        var connectionMgr = this.registry.find("ConnectionMgr");
        if (connectionMgr)
        {
            connectionMgr.disconnectSceneInspection(si, si.getCamera());
            connectionMgr.connectSceneInspection(si, camera);
        }
    }
}

function SelectionListener_ClickPointModifiedCB(attribute, container)
{
    container.clickPointModified();
}

function SelectionListener_PointWorldModifiedCB(attribute, container)
{
}
ViewportLayout.prototype = new AttributeContainer();
ViewportLayout.prototype.constructor = ViewportLayout;

function ViewportLayout()
{
    AttributeContainer.call(this);
    this.className = "ViewportLayout";
    
    this.name = new StringAttr("ViewportLayout");
    this.width = new NumberAttr(0);
    this.height = new NumberAttr(0);
    
    this.registerAttribute(this.name, "name");
    this.registerAttribute(this.width, "width");
    this.registerAttribute(this.height, "height");
}

ViewportLayout.prototype.initialize = function()
{
}

ViewportLayout.prototype.layoutDirectives = function(directives)
{
}

GridLayout.prototype = new ViewportLayout();
GridLayout.prototype.constructor = GridLayout;

function GridLayout()
{
    ViewportLayout.call(this);
    this.className = "GridLayout";
    
    this.name.setValueDirect("GridLayout");
    
    this.rows = new NumberAttr(1);
    this.cols = new NumberAttr(1);
    
    this.registerAttribute(this.rows, "rows");
    this.registerAttribute(this.cols, "cols");
}

GridLayout.prototype.initialize = function()
{
    this.rows.setValueDirect(1);
    this.cols.setValueDirect(1);
    
    // call base-class implementation
    ViewportLayout.prototype.initialize.call(this);
}

GridLayout.prototype.layoutDirectives = function(directives)
{
	if (!directives)
	{
		return;
	}

    var width = this.width.getValueDirect();
    var height = this.height.getValueDirect();
    var rows = this.rows.getValueDirect();
    var cols = this.cols.getValueDirect();
    if (width <= 0 || height <= 0 || rows <= 0 || cols <= 0)
    {
        return;
    }
    
    var vpX = 0;
    var vpY = 0;
    var vpWidth = width / cols;
	var vpHeight = height / rows;
	var values = new Array(4);

	var nDirectives = directives.length;
	for (var i=0, n=0; i < rows && n < nDirectives; i++)
	{
		for (var j=0; j < cols && n < nDirectives; j++, n++)
		{
			values[0] = vpX;
			values[1] = vpY;
			values[2] = vpWidth;
			values[3] = vpHeight;

			directives[n].getAttribute("viewport").setValue(values);

			vpX += vpWidth;
		}

		vpX = 0;
		vpY += vpHeight;
	}
}
ViewportMgr.prototype = new AttributeContainer();
ViewportMgr.prototype.constructor = ViewportMgr;

function ViewportMgr()
{
    AttributeContainer.call(this);
    this.className = "ViewportMgr";
    
    this.name = new StringAttr("ViewportMgr");
    this.cursor = new StringAttr("Arrow");
    this.width = new NumberAttr(0);
    this.height = new NumberAttr(0);
    this.layout = new ReferenceAttr(null);
    
    this.cursor.addModifiedCB(ViewportMgr_CursorModifiedCB, this);
    this.width.addModifiedCB(ViewportMgr_WidthModifiedCB, this);
    this.height.addModifiedCB(ViewportMgr_HeightModifiedCB, this);
    this.layout.addModifiedCB(ViewportMgr_LayoutModifiedCB, this);
    
    this.registerAttribute(this.name, "name");
    this.registerAttribute(this.cursor, "cursor");
    this.registerAttribute(this.width, "width");
    this.registerAttribute(this.height, "height");
    this.registerAttribute(this.layout, "layout");
}

ViewportMgr.prototype.initLayout = function()
{
    var layout = this.layout.getValueDirect();
    if (layout)
    {
        layout.initialize();
    }
}

ViewportMgr.prototype.layoutDirectives = function(directives)
{
    var layout = this.layout.getValueDirect();
    if (layout)
    {
        layout.layoutDirectives(directives);   
    }
}

ViewportMgr.prototype.getViewportAtScreenXY = function(x, y)
{
    var width = this.width.getValueDirect();
    var height = this.height.getValueDirect();
    
    // make sure x, y fall between [0, viewport width/height]
    x = clamp(x, 0, width);
    y = clamp(y, 0, height);
    
    // get cameras
    var cameras = this.registry.getByType(eAttrType.Camera);
    
    // get smallest viewport containing screen x, y (necessary for picture-in-picture)
    var minWidth = width;
    var minHeight = height;
    var camera, viewport;
    for (var i=0; i < cameras.length; i++)
    {
        if (cameras[i].viewport.containsPoint(x, y) &&
            cameras[i].viewport.width <= minWidth &&
            cameras[i].viewport.height <= minHeight)
        {
            camera = cameras[i];
            viewport = cameras[i].viewport;
            minWidth = cameras[i].viewport.width;
            minHeight = cameras[i].viewport.height
        }
    }
    
    return { viewport: viewport, camera: camera };
}

function ViewportMgr_CursorModifiedCB(attribute, container)
{
    // TODO
}

function ViewportMgr_WidthModifiedCB(attribute, container)
{
    var layout = container.layout.getValueDirect();
    if (layout)
    {
        layout.getAttribute("width").setValueDirect(attribute.getValueDirect());
    }
}

function ViewportMgr_HeightModifiedCB(attribute, container)
{
    var layout = container.layout.getValueDirect();
    if (layout)
    {
        layout.getAttribute("height").setValueDirect(attribute.getValueDirect());
    }
}

function ViewportMgr_LayoutModifiedCB(attribute, container)
{
    var layout = attribute.getValueDirect();
    if (layout)
    {
        layout.getAttribute("width").setValueDirect(container.width.getValueDirect());
        layout.getAttribute("height").setValueDirect(container.height.getValueDirect());
    }
}
RasterComponentEventListener.prototype = new EventListener();
RasterComponentEventListener.prototype.constructor = Command;

function RasterComponentEventListener()
{
    EventListener.call(this);
    this.className = "RasterComponentEventListener";

    this.rcs = [];
    this.rcsSelectionState = [];
    this.rcListenMap = [];
    this.rcEventMap = [];
    this.styleMgr = null;
    
    this.selectionEvent = new InputEvent(eEventType.Unknown, 0, 0xffffffff, 0, eEventType.Key_Up);

	this.name.setValueDirect("RasterComponentEventListener");
	this.numResponses.setValueDirect(-1);
}

RasterComponentEventListener.prototype.eventPerformed = function(event)
{
    var enabled = this.enabled.getValueDirect();
    if (!enabled)
    {
        return;
    }
    
    var currSelectionState, lastSelectionState, selectionEventSelectionState;
	for (var i=0; i < this.rcs.length; i++)
	{
		if (!this.isListening(this.rcs[i]))
		{
			continue;
		}

		lastSelectionState = this.rcsSelectionState[i];
		currSelectionState = this.rcs[i].eventPerformed(event);
		
		if (this.styleMgr)
	    {
		    if (currSelectionState)
			{
				this.styleMgr.eventPerformed(event, this.rcs[i]);

				// send selected/focus/mouseover event depending upon event type and whether 
				// component doesn't have focus/didn't have selection
				switch (event.type)
				{
				case eEventType.MouseLeftClick:
					{
						// send element focus event (once)
						if (this.isListeningEvent(this.rcs[i], eEventType.ElementFocus) &&
							this.rcs[i].hasFocus.getValueDirect() <= 0)
						{
							this.selectionEvent.synchronize(event);
							this.selectionEvent.type = eEventType.ElementFocus;
							
							selectionEventSelectionState = m_rcs[i].eventPerformed(this.selectionEvent);
							this.styleMgr.eventPerformed(this.selectionEvent, this.rcs[i]);

							this.rcs[i].hasFocus.setValueDirect(1);
					    }
					}
					break;

				case eEventType.MouseMove:
					{
						// send element selected event (once)
						if (this.isListeningEvent(this.rcs[i], eEventType.ElementSelected) &&
							this.rcs[i].selected.getValueDirect() <= 0)
						{
							this.selectionEvent.synchronize(event);
							this.selectionEvent.type = eEventType.ElementSelected;
							
							selectionEventSelectionState = this.rcs[i].eventPerformed(this.selectionEvent);
							this.styleMgr.eventPerformed(this.selectionEvent, this.rcs[i]);
							this.rcs[i].selected.setValueDirect(1);
						}

						if (!lastSelectionState &&
							this.isListeningEvent(this.rcs[i], eEventType.MouseOver))
						{
							this.selectionEvent.synchronize(event);
							this.selectionEvent.type = eEventType.MouseOver;

							selectionEventSelectionState = this.rcs[i].eventPerformed(this.selectionEvent);
							this.styleMgr.eventPerformed(this.selectionEvent, this.rcs[i]);
						}
					}
					break;
				}
			}
			else // !currSelectionState
			{
				// send unselected/blur/mouseout event depending upon event type and whether 
				// component has focus/had selection
				switch (event.type)
				{
				case eEventType.MouseLeftDown:
				case eEventType.MouseLeftClick:
				case eEventType.MouseLeftDblClick:
				case eEventType.MouseMiddleDown:
				case eEventType.MouseMiddleClick:
				case eEventType.MouseMiddleDblClick:
				case eEventType.MouseRightDown:
				case eEventType.MouseRightClick:
				case eEventType.MouseRightDblClick:
				case eEventType.MouseWheelDown:
				case eEventType.MouseBothDown:
					{
						// send element blur event (once)
						if (this.isListeningEvent(this.rcs[i], eEventType.ElementBlur) &&
							this.rcs[i].hasFocus.getValueDirect() > 0)
						{
							this.selectionEvent.synchronize(event);
							this.selectionEvent.type = eEventType.ElementBlur;
							
							selectionEventSelectionState = this.rcs[i].eventPerformed(this.selectionEvent);
							this.styleMgr.eventPerformed(this.selectionEvent, this.rcs[i]);

							this.rcs[i].hasFocus.setValueDirect(-1);
						}
					}
					break;

				case eEventType.MouseMove:
					{
						// send element unselected event (once)
						if (this.isListeningEvent(this.rcs[i], eEventType.ElementUnselected) &&
							this.rcs[i].selected.getValueDirect() > 0)
						{
							this.selectionEvent.synchronize(event);
							this.selectionEvent.type = eEventType.ElementUnselected;
							
							selectionEventSelectionState = this.rcs[i].eventPerformed(this.selectionEvent);
							this.styleMgr.eventPerformed(this.selectionEvent, this.rcs[i]);
							this.rcs[i].selected.setValueDirect(-1);
						}

						if (lastSelectionState &&
							this.isListeningEvent(this.rcs[i], eEventType.MouseOut))
						{
							this.selectionEvent.synchronize(event);
							this.selectionEvent.type = eEventType.MouseOut;

							selectionEventSelectionState = this.rcs[i].eventPerformed(this.selectionEvent);
							this.styleMgr.eventPerformed(this.selectionEvent, this.rcs[i]);
						}
					}
					break;
				}
			}
		}

		this.rcsSelectionState[i] = currSelectionState;
	}
}

RasterComponentEventListener.prototype.registerComponent = function(rc, before)
{
    if (rc)
    {
        if (before)
        {
            var i = this.rcs.indexOf(before);
            if (i < 0) i = this.rcs.length;
            
            this.rcs.splice(i, 0, rc);
            this.rcsSelectionState.splice(i, 0, rc);
        }
        else
        {
            this.rcs.push(rc);
            this.rcsSelectionState.push(rc);
        }
    }
}

RasterComponentEventListener.prototype.unregisterComponent = function(rc)
{
    if (rc)
    {
        this.rcs.splice(this.rcs.indexOf(rc), 1);
    }
}

RasterComponentEventListener.prototype.Listen = function(rc)
{
    if (rc)
    {
        this.rcListenMap[rc] = true;
    }
}

RasterComponentEventListener.prototype.Ignore = function(rc)
{
    if (rc)
    {
        this.rcListenMap[rc] = false;
    }
}

RasterComponentEventListener.prototype.listenEvent = function(rc, eventType)
{
    if (rc)
    {
        if (this.rcEventMap[rc] == undefined)
        {
            this.rcEventMap[rc] = new Array();
        }

        this.rcEventMap[rc].push(eventType);
    }
}

RasterComponentEventListener.prototype.ignoreEvent = function(rc, eventType)
{
    if (rc)
    {
        if (this.rcEventMap[rc])
        {
            this.rcEventMap[rc].splice(this.rcEventMap[rc].indexOf(eventType), 1);
        }
    }
}

RasterComponentEventListener.prototype.setStyleMgr = function(styleMgr)
{
    this.styleMgr = styleMgr;
}

RasterComponentEventListener.prototype.setSelectionState = function(rc, selected)
{
    this.rcsSelectionState[rc] = selected;
}

RasterComponentEventListener.prototype.getComponent = function(n)
{
    if (n < this.rcs.length)
    {
        return this.rcs[n];
    }

    return null;
}

RasterComponentEventListener.prototype.isListening = function(rc)
{
    if (rc)
    {
        if (this.rcListenMap[rc])
        {
            return this.rcListenMap[rc];
        }
    }

    return false;
}

RasterComponentEventListener.prototype.isListeningEvent = function(rc, eventType)
{
    if (rc)
    {
        if (this.rcEventMap[rc])
        {
            if (this.rcEventMap[rc].indexOf(eventType) >= 0)
                return true;
        }
    }

    return false;
}




var g_objPosMap = {};

function addInspectionGroup(node, factory)
{

    // ensure that rotation group has not already been added
    var rotGroup = getInspectionGroup(node);

    if (rotGroup)
        return;

    var pGrp = new Group();
    pGrp.setGraphMgr(factory.graphMgr);
    var pTranslate = new Translate();
    pTranslate.setGraphMgr(factory.graphMgr);
    var pScaleInv = new Scale();
    pScaleInv.setGraphMgr(factory.graphMgr);
    var pQuat = new QuaternionRotate();
    pQuat.setGraphMgr(factory.graphMgr);
    var pTransBack = new Translate();
    pTransBack.setGraphMgr(factory.graphMgr);
    var pScale = new Scale();
    pScale.setGraphMgr(factory.graphMgr);

    pQuat.addModifiedCB(Util_InspectionGroup_RotationQuatModifiedCB, node);

    pGrp.name.setValueDirect("InspectionGroup");
    pTranslate.name.setValueDirect("Translate");
    pScaleInv.name.setValueDirect("ScaleInverse");
    pQuat.name.setValueDirect("Quaternion");
    pTransBack.name.setValueDirect("TranslateBack");
    pScale.name.setValueDirect("Scale");

    pGrp.addChild(pTranslate); // child 0
    pGrp.addChild(pScaleInv);  // child 1
    pGrp.addChild(pQuat);      // child 2
    pGrp.addChild(pScale);     // child 3
    pGrp.addChild(pTransBack); // child 4

    var pChildZero = node.getChild(0);
    if (pChildZero)
    {
        pChildZero.insertChild(pGrp, 0);
    }

    node.registerAttribute(pTranslate.translation, "inspectionGroup_translate");
    node.registerAttribute(pScaleInv.scale, "inspectionGroup_scaleInverse");
    node.registerAttribute(pQuat.rotationQuat, "inspectionGroup_rotationQuat");
    node.registerAttribute(pQuat.enabled, "inspectionGroup_rotationEnabled");
    node.registerAttribute(pScale.scale, "inspectionGroup_scale");
    node.registerAttribute(pTransBack.translation, "inspectionGroup_translateBack");

    pTranslate.translation.setContainer(node);
    pScaleInv.scale.setContainer(node);
    pQuat.rotationQuat.setContainer(node);
    pQuat.enabled.setContainer(node);
    pScale.scale.setContainer(node);
    pTransBack.translation.setContainer(node);

    return;
}

function deleteInspectionGroup(node)
{
    var rotGroup = getInspectionGroup(node);
    if (rotGroup)
    {
        rotGroup.getChild(0).getAttribute("translation").setContainer(rotGroup.getChild(0));
        rotGroup.getChild(1).getAttribute("scale").setContainer(rotGroup.getChild(1));
        rotGroup.getChild(2).getAttribute("rotationQuat").setContainer(rotGroup.getChild(2));
        rotGroup.getChild(2).getAttribute("enabled").setContainer(rotGroup.getChild(2));
        rotGroup.getChild(3).getAttribute("scale").setContainer(rotGroup.getChild(3));
        rotGroup.getChild(4).getAttribute("translation").setContainer(rotGroup.getChild(4));

        node.unregisterAttribute(node.getAttribute("inspectionGroup_translate"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_scaleInverse"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_rotationQuat"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_rotationEnabled"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_scale"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_translateBack"));

        node.removeChild(rotGroup);

    }

    return;
}

function getInspectionGroup(moveableNode)
{
    var group = null;

    var childZero = moveableNode.getChild(0);
    if (childZero)
    {
        group = childZero.getNamedChild("InspectionGroup")
    }

    return group;
}

function setInspectionGroupActivationState(node, enable)
{
    var pRotGroup = getInspectionGroup(node);
    if (pRotGroup)
    {
        var pQuat = pRotGroup.getChild(2);
        if (pQuat)
        {
            pQuat.enabled.setValueDirect(enable);

            if (!enable)
            {
                var quat = new Quaternion();
                quat.loadIdentity();

                var quatAttr = pQuat.rotationQuat;
                quatAttr.setValueDirect(quat);
            }
        }

        var pPos = node.getAttribute("position");
        if (enable)
        {
            if (!(node in g_objPosMap))
            {
                g_objPosMap[node] = pPos.getValueDirect();
            }
        }
        else // !enable
        {
            var pos = g_objPosMap[node];
            pPos.setValueDirect(pos);
        }
    }

    return;
}

function setInspectionGroupContainer(node)
{
    var pRotGroup = getInspectionGroup(node);
    if (pRotGroup)
    {
        node.unregisterAttribute(node.getAttribute("inspectionGroup_translate"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_scaleInverse"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_rotationQuat"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_rotationEnabled"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_scale"));
        node.unregisterAttribute(node.getAttribute("inspectionGroup_translateBack"));

        node.registerAttribute(pRotGroup.getChild(0).getAttribute("translation"), "inspectionGroup_translate");
        node.registerAttribute(pRotGroup.getChild(1).getAttribute("scale"), "inspectionGroup_scaleInverse");
        node.registerAttribute(pRotGroup.getChild(2).getAttribute("rotationQuat"), "inspectionGroup_rotationQuat");
        node.registerAttribute(pRotGroup.getChild(2).getAttribute("enabled"), "inspectionGroup_rotationEnabled");
        node.registerAttribute(pRotGroup.getChild(3).getAttribute("scale"), "inspectionGroup_scale");
        node.registerAttribute(pRotGroup.getChild(4).getAttribute("translation"), "inspectionGroup_translateBack");

        pRotGroup.getChild(0).getAttribute("translation").setContainer(node);
        pRotGroup.getChild(1).getAttribute("scale").setContainer(node);
        pRotGroup.getChild(2).getAttribute("rotationQuat").setContainer(node);
        pRotGroup.getChild(2).getAttribute("enabled").setContainer(node);
        pRotGroup.getChild(3).getAttribute("scale").setContainer(node);
        pRotGroup.getChild(4).getAttribute("translation").setContainer(node);
    }

    return;
}

function zeroInspectionGroup(node)
{
    var pRotGroup = getInspectionGroup(node);
    if (pRotGroup)
    {
        var pQuat = pRotGroup.getChild(2);
        if (pQuat)
        {
            var quat = new Quaternion();
            quat.loadIdentity();

            var quatAttr = pQuat.rotationQuat;
            quatAttr.setValueDirect(quat);
        }
    }

    return;
}

function clearObjectPositionMap()
{
    g_objPosMap = {};

    return;
}

// notify node that the rotation quat rotates that it has been modified
function Util_InspectionGroup_RotationQuatModifiedCB(attribute, container)
{
    container.setModified();
}
SerializeCommand.prototype = new Command();
SerializeCommand.prototype.constructor = SerializeCommand;

function SerializeCommand()
{
    Command.call(this);
    this.className = "Serialize";
    this.attrType = eAttrType.Serialize;

    this.targetAttribute = null;
    this.target.addModifiedCB(SerializeCommand_TargetModifiedCB, this);
    this.directive = null;
    this.serialized = "";
}

SerializeCommand.prototype.execute = function()
{
    if (this.directive)
    {
//        if (this.target && this.directive)
//        {
//            if (this.directive.execute(this.target === 0))
//            {
//                this.serialized = this.directive.getSerialized();
//            }
//        }
//        else // !this.target
//        {
        this.serializeScene();
//        }
    }
}

SerializeCommand.prototype.serializeScene = function()
{
    var i;
    var container = null;
    var node = null;
    var context = new Context();
    var xstr;

    // root element open tag
    this.serialized = '<?xml version="1.0" encoding="UTF-8"?><?bw onload="initialize"?><Session broadcast="false">';

    //var attrContainerRegistry = this.registry.getAttributeContainerRegistry();
    var attrContainerRegistry = bridgeworks.registry;
    if (attrContainerRegistry)
    {
        var factory = this.registry.find("AttributeFactory");
        var serializer = factory.create("Serializer");
        var xmlSerializer = new XMLSerializer();
        // set minimum flag so that only the minimum required for recreation is serialized
        serializer.serializeMinimum.setValueDirect(true);

        var count = attrContainerRegistry.getObjectCount();

        // serialize
        var i;
        var physicsSimulators = [];
        for (i = 0; i < count; i++)
        {
            container = attrContainerRegistry.getObject(i);
            if (!container)
                continue;

            // physics simulator (serialize at end)
            if (container.attrType == eAttrType.PhysicsSimulator)
            {
                physicsSimulators.push(container);
                continue;
            }
            // device handlers
            if (container.attrType > eAttrType.DeviceHandler &&
                    container.attrType < eAttrType.DeviceHandler_End)
            {
                context.attribute = container;

                // serialize
                serializer.serialize(context.attribute, context.item, context.attributeName, context.container);
                var serialized = xmlSerializer.serializeToString(serializer.DOM);
                if (serialized == "<__InitialRoot/>")
                    continue;
                this.serialized += serialized;
            }
            // root nodes (nodes without parents)
            else if (container.attrType > eAttrType.Node &&
                    container.attrType < eAttrType.Node_End)
            {
                if (container.getParentCount() == 0)
                {
                    this.directive.execute(container);
                    this.serialized += this.directive.serialized;
                }
            }
            // directives
            else if (container.attrType > eAttrType.Directive &&
                    container.attrType < eAttrType.Directive_End)
            {
                context.attribute = container;

                // serialize
                serializer.serialize(context.attribute, context.item, context.attributeName, context.container);
                var serialized = xmlSerializer.serializeToString(serializer.DOM);
                if (serialized == "<__InitialRoot/>")
                    continue;
                this.serialized += serialized;
            }
            // SelectionListener
            else if (container.className == "SelectionListener")
            {
                var computePivotDistance = container.getAttribute("computePivotDistance").getValueDirect();

                this.serialized += "<Set target=\"Selector\" computePivotDistance=\"";
                this.serialized += (computePivotDistance ? "true" : "false");
                this.serialized += "\"/>";
            }
            // remaining attributes not fitting other criteria and not a command (commands serialized below)
            /*else if (container.attrType < eAttrType.Command || 
             container.attrType > eAttrType.Command_End)
             {
             context.attribute = container;
             
             // serialize
             serializer.serialize(context.attribute, context.item, context.attributeName, context.container);
             this.serialized += xmlSerializer.serializeToString(serializer.DOM);
             }*/
        }

        // commands

        // DisconnectAttributes commands (must come before ConnectAttributes in DefaultPreferences.xml)
        for (i = 0; i < count; i++)
        {
            container = attrContainerRegistry.getObject(i);
            if (!container)
                continue;

            if (container.className == "DisconnectAttributes")
            {
                context.attribute = container;

                // serialize
                serializer.serialize(context.attribute, context.item, context.attributeName, context.container);
                var serialized = xmlSerializer.serializeToString(serializer.DOM);
                if (serialized == "<__InitialRoot/>")
                    continue;
                this.serialized += serialized;
            }
        }

        // other commands
        for (i = 0; i < count; i++)
        {
            container = attrContainerRegistry.getObject(i);
            if (!container)
                continue;

            if (container.attrType > eAttrType.Command &&
                container.attrType < eAttrType.Command_End &&
                container.className != "DisconnectAttributes")
            {
                context.attribute = container;

                // serialize
                serializer.serialize(context.attribute, context.item, context.attributeName, context.container);
                var serialized = xmlSerializer.serializeToString(serializer.DOM);
                if (serialized == "<__InitialRoot/>")
                    continue;
                this.serialized += serialized;
            }
        }

        // snapped models
        var snapMgr = this.registry.find("SnapMgr");
        this.serialized += snapMgr.serialize();
        
        // physicsSimulators
        for (i = 0; i < physicsSimulators.length; i++)
        {
            this.directive.execute(physicsSimulators[i]);
            this.serialized += this.directive.serialized;
        }
    }

    // root element close tag
    this.serialized += "</Session>";
    serializedScene += this.serialized;
    console.log(this.serialized);

    return;
}

SerializeCommand.prototype.undo = function()
{

}

SerializeCommand.prototype.setRegistry = function(registry)
{
    // create serialize directive
    var factory = bridgeworks.registry.find("AttributeFactory");
    this.directive = factory.create("SerializeDirective");

    // call base-class implementation
    Command.prototype.setRegistry.call(this, registry);
}

SerializeCommand.prototype.getSerialized = function()
{
    return this.serialized;
}

function SerializeCommand_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    container.targetAttribute = container.registry.find(target);
}
ScreenCaptureCommand.prototype = new Command();
ScreenCaptureCommand.prototype.constructor = ScreenCaptureCommand;

function ScreenCaptureCommand()
{
    Command.call(this);
    this.className = "ScreenCapture";
    this.attrType = eAttrType.ScreenCapture;

    this.canvasId = new StringAttr();

    this.registerAttribute(this.canvasId, "canvasId");

    this.numResponses.setValueDirect(0);
}

ScreenCaptureCommand.prototype.execute = function()
{
    var bworks = this.registry.find("Bridgeworks");
    bworks.eventMgr.addListener(eEventType.RenderBegin, this);
    bworks.eventMgr.addListener(eEventType.RenderEnd, this);
}

ScreenCaptureCommand.prototype.screenCapture = function(canvasId)
{
    var canvas = document.getElementById(canvasId);
    var imageData = canvas.toDataURL('image/png');

    // 3Scape-specific: decode the base64 data into 8bit array
    cimageData = imageData;
    var cnt = imageData.lastIndexOf(',') + 1;
    imageData = imageData.substr(cnt);
    imgeData = Base64Binary.decode(imageData);
        
    // for testing with Bug-60.htm
    //document.getElementById('imgCapture').src = imageData;

    // copy to clipboard
    // TODO: investigate method described at: https://forums.mozilla.org/addons/viewtopic.php?t=9736&p=21119

    // open in new window
    //window.open(imageData);
    
    // download
    //var imageDataStream = imageData.replace("image/png", "image/octet-stream");
    //window.location.href = imageDataStream;
}

ScreenCaptureCommand.prototype.get2DElementCanvas = function(canvas3D)
{
    // create 2D canvas for labels
    var canvas2D = document.createElement('canvas');
    canvas2D.id = "canvas2D";
    canvas2D.width = canvas3D.width;
    canvas2D.height = canvas3D.height;
    var ctx = canvas2D.getContext('2d');

    // get labels
    var labels = this.registry.getByType(eAttrType.Label);
    
    // calculate mask color which is different from all labels colors
    var maskColor = "black";
    
    // setup img src data for labels
    var data = "data:image/svg+xml," + 
               "<svg xmlns='http://www.w3.org/2000/svg' width='" + canvas2D.width + "' height='" + canvas2D.height + "'>" + 
               "<foreignObject width='100%' height='100%'>" + 
               "<div xmlns='http://www.w3.org/1999/xhtml' style='background:" + maskColor + ";'>";   
    for (var i=0; i < labels.length; i++)
    {
        var style = labels[i].htmlLabel.style;
        data += "<span style='position:absolute; " +
                "font-family:" + style.fontFamily + "; " +
                "font-size:" + style.fontSize + "; " +
                "font-weight:" + style.fontWeight + "; " +
                "color:" + style.color + "; " +
                "background-color:" + style.backgroundColor + "; " +
                "text-shadow:" + style.textShadow + "; " +
                "visibility:" + style.visibility + "; " +
                "left:" + style.left + "; " +
                "top:" + style.top + "; " +
                "padding-left:" + style.paddingLeft + "; " +
                "padding-right:" + style.paddingRight + "; " +
                "padding-top:" + style.paddingTop + "; " +
                "padding-bottom:" + style.paddingBottom + "; " +
                "'>" + labels[i].text.getValueDirect().join("") + 
                "</span>";                
    }   
    data += "</div>" +
            "</foreignObject>" + 
            "</svg>";
        
    // create Image and set data as its src
    var img = new Image();
    img.src = data;

    // fill 2D canvas with background color
    ctx.fillStyle = maskColor;
    ctx.fillRect(0, 0, canvas2D.width, canvas2D.height);
    
    // draw image to 2D canvas
    ctx.drawImage(img, 0, 0);

    return { canvas: canvas2D, maskColor: maskColor }
}

ScreenCaptureCommand.prototype.eventPerformed = function(event)
{
    // if mouse-move event, don't process if any other mouse button is pressed (this affects object inspection)
    switch (event.type)
    {
        case eEventType.RenderBegin:
            {
                var screenCaptureRect = this.registry.find("ScreenCaptureRect");                    // TODO: change name
                var screenCaptureTexture = this.registry.find("ScreenCaptureTexture")
                if (screenCaptureRect && screenCaptureTexture)
                {
                    // set 2D element canvas to screen capture texture
                    var canvas2D = this.get2DElementCanvas(document.getElementById(this.canvasId.getValueDirect().join("")));
                    screenCaptureTexture.textureObj.setImageWithCanvas(canvas2D.canvas);
                    screenCaptureTexture.imageSet = true;
                    // TODO: set blendOp/maskColor
                    //screenCaptureTexture.setTextureColorMask(0, 0, 0, 1);

                    // set screen capture texture to screen capture rect object
                    screenCaptureRect.setTexture(screenCaptureTexture);

                    // show screen capture rect object
                    screenCaptureRect.enabled.setValueDirect(true);
                }
            }
            break;

        case eEventType.RenderEnd:
            {
                this.screenCapture(this.canvasId.getValueDirect().join(""));
                // hide screen capture rect object
                var screenCaptureRect = this.registry.find("ScreenCaptureRect");
                if (screenCaptureRect)
                {
                    screenCaptureRect.enabled.setValueDirect(false);
                }
            }
            break;
    }
}

ExportCommand.prototype = new Command();
ExportCommand.prototype.constructor = ExportCommand;

function ExportCommand()
{
    Command.call(this);
    this.className = "Export";
    this.attrType = eAttrType.Export;

    this.targetNode = null;
    
    this.url = new StringAttr();
    
    this.target.addModifiedCB(ExportCommand_TargetModifiedCB, this);

    this.registerAttribute(this.url, "url");
}

ExportCommand.prototype.execute = function()
{
    if (!this.targetNode) return;
    
    var url = this.url.getValueDirect().join("");   
    switch (getFileExtension(url))
    {
        case "stl":
            this.exportSTL(this.targetNode, url);
            break;
            
        default:
            break;
    }
}

ExportCommand.prototype.exportSTL = function(model, url)
{
    // name
    var name = model.name.getValueDirect().join("");
    
    // vertices/normals
    var vertices = [];
    var normals = [];   
    for (var i=0; i < model.geometry.length; i++)
    {
        var geometry = model.geometry[i];
        switch (geometry.attrType)
        {
            case eAttrType.TriList:
                {
                    vertices = vertices.concat(geometry.vertices.getValueDirect());
                    normals = normals.concat(geometry.vertices.getValueDirect());
                }
                break;
        }
    }
    if (vertices.length == 0) return;
    
    // vertices cannot have negative values, so offset vertices if negative values are present
    var x = FLT_MAX, y = FLT_MAX, z = FLT_MAX;
    for (var i=0; i < vertices.length; i+=3)
    {
        x = Math.min(x, vertices[i  ]);
        y = Math.min(y, vertices[i+1]);
        z = Math.min(z, vertices[i+2]);
    }
    if (x < 0)
    {
        x = Math.abs(x);
        for (var i=0; i < vertices.length; i+=3)
        {
            vertices[i  ] += x;
        }
    }
    if (y < 0)
    {
        y = Math.abs(y);
        for (var i=0; i < vertices.length; i+=3)
        {
            vertices[i+1] += y;
        }
    }
    if (z < 0)
    {
        z = Math.abs(z);
        for (var i=0; i < vertices.length; i+=3)
        {
            vertices[i+2] += z;
        }
    }
    
    var stl = "";
    stl += "solid " + name + "\r\n";
    for (var v=0, n=0; v < vertices.length && n < normals.length; v+=9, n+=9) // one normal per face
    {
    stl += "   facet normal " + normals[n].toExponential() + " " + normals[n+1].toExponential() + " " + normals[n+2].toExponential() + "\r\n";
    stl += "      outer loop\r\n";
    stl += "         vertex " + vertices[v  ].toExponential() + " " + vertices[v+1].toExponential() + " " + vertices[v+2].toExponential() + "\r\n";
    stl += "         vertex " + vertices[v+3].toExponential() + " " + vertices[v+4].toExponential() + " " + vertices[v+5].toExponential() + "\r\n";
    stl += "         vertex " + vertices[v+6].toExponential() + " " + vertices[v+7].toExponential() + " " + vertices[v+8].toExponential() + "\r\n";
    stl += "      endloop\r\n";
    stl += "   end facet\r\n";    
    }
    stl += "endsolid " + name;
    
    var blob = new Blob([stl], {type: "text/plain"});
    saveAs(blob, url);
}

function ExportCommand_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    var resource = container.registry.find(target);
    if (resource)
    {
        container.targetNode = resource;
    }
}


MorphCommand.prototype = new Command();
MorphCommand.prototype.constructor = MorphCommand;

function MorphCommand()
{
    Command.call(this);
    this.className = "Morph";
    this.attrType = eAttrType.Morph;

    this.sourceModel = null;
    this.targetModel = null;
    
    this.source = new StringAttr("");
    this.morphIncr = new NumberAttr(0.1);
    
    this.source.addModifiedCB(MorphCommand_SourceModifiedCB, this);
    this.target.addModifiedCB(MorphCommand_TargetModifiedCB, this);

    this.registerAttribute(this.source, "source");
    this.registerAttribute(this.morphIncr, "morphIncr");
}

MorphCommand.prototype.execute = function()
{
    if (this.sourceModel && this.targetModel)
    {
        var connectionMgr = this.registry.find("ConnectionMgr");
        if (connectionMgr)
        {
            connectionMgr.connectModelsToMorph(this.sourceModel, this.targetModel, this.morphIncr.getValueDirect());
        }    
    }
}

function MorphCommand_SourceModifiedCB(attribute, container)
{
    var source = attribute.getValueDirect().join("");
    var resource = container.registry.find(source);
    if (resource)
    {
        container.sourceModel = resource;
    }
}

function MorphCommand_TargetModifiedCB(attribute, container)
{
    var target = attribute.getValueDirect().join("");
    var resource = container.registry.find(target);
    if (resource)
    {
        container.targetModel = resource;
    }
}

SnapToCommand.prototype = new Command();
SnapToCommand.prototype.constructor = SnapToCommand;

function SnapToCommand()
{
    Command.call(this);
    this.className = "SnapTo";
    this.attrType = eAttrType.SnapTo;

    this.models = new SnapModelDescriptors();

    this.registerAttribute(this.models, "models");
    
    this.numResponses.setValueDirect(0);
}

SnapToCommand.prototype.execute = function()
{
    var i;
    var models = [];
    
    for (i = 0; i < this.models.Size(); i++)
    {
        var modelDesc = this.models.getAt(i);
        var model = this.registry.find(modelDesc.name.getValueDirect().join(""));
        if (model)
        {
            var position = modelDesc.position.getValueDirect();
            model.position.setValueDirect(position.x, position.y, position.z);
            
            var quaternion = modelDesc.quaternion.getValueDirect();
            model.quaternion.setValueDirect(quaternion);
            
            model.updateSimpleTransform();
            model.updateCompoundTransform();
            
            models.push(model);
        }
    }
    
    var snapMgr = this.registry.find("SnapMgr");
    snapMgr.resnap(models);
}
SnapMgr.prototype = new AttributeContainer();
SnapMgr.prototype.constructor = SnapMgr;

function SnapMgr()
{
    AttributeContainer.call(this);
    this.className = "SnapMgr";

    this.name = new StringAttr("SnapMgr");

    this.registerAttribute(this.name, "name");
}

SnapMgr.prototype.snapGenericToGeneric = function(snapper, snappee, snapperConnector, snappeeConnector)
{
    // set rotation
    var matrix = new Matrix4x4();
    
    // rotate so that normals are coincident; do this by rotating angle between
    // the normals degrees about the cross product of the normals
    var snappeeNormal = snappeeConnector.getAttribute("normal").getValueDirect();
    snappeeNormal = new Vector3D(snappeeNormal.x, snappeeNormal.y, snappeeNormal.z);
    snappeeNormal.normalize();

    var snapperNormal = snapperConnector.getAttribute("normal").getValueDirect();
    snapperNormal = new Vector3D(snapperNormal.x, snapperNormal.y, snapperNormal.z);
    snapperNormal.normalize();

    var cross = crossProduct(snappeeNormal, snapperNormal);
    var cosAngle = cosineAngleBetween(snappeeNormal, snapperNormal);
    var angleBetween = 180 - toDegrees(Math.acos(cosAngle));
    if (angleBetween > 0)
    {
        var rotationMatrix = new Matrix4x4();
        rotationMatrix.loadRotation(cross.x, cross.y, cross.z, angleBetween);

        matrix = rotationMatrix;
    }

    // set position

    // get positions of points to connect 
    var point1, point2;
    point1 = snapperConnector.getAttribute("point").getAttribute("center").getValueDirect();
    point1 = matrix.transform(point1.x, point1.y, point1.z, 1);
    point2 = snappeeConnector.getAttribute("point").getAttribute("center").getValueDirect();
    
    var translationMatrix = new Matrix4x4();
    translationMatrix.loadTranslation(point2.x - point1.x, point2.y - point1.y, point2.z - point1.z);
    matrix = matrix.multiply(translationMatrix);
    
    snapperConnector.getAttribute("connected").setValueDirect(true);
    snappeeConnector.getAttribute("connected").setValueDirect(true);
    
    // perform snap
    var snapped = this.snap(snapper, snappee, matrix);
    
    return snapped;
}

SnapMgr.prototype.snapPlugToSocket = function(plug, socket, plugConnector, socketConnector)
{
    // set rotation
    var matrix = new Matrix4x4();
    
    // rotate so that normals are coincident; do this by rotating angle between
    // the normals degrees about the cross product of the normals
    var socketNormal = socketConnector.getAttribute("normal").getValueDirect();
    socketNormal = new Vector3D(socketNormal.x, socketNormal.y, socketNormal.z);
    socketNormal.normalize();

    var plugNormal = plugConnector.getAttribute("normal").getValueDirect();
    plugNormal = new Vector3D(plugNormal.x, plugNormal.y, plugNormal.z);
    plugNormal.normalize();

    var cross = crossProduct(socketNormal, plugNormal);
    var cosAngle = cosineAngleBetween(socketNormal, plugNormal);
    var angleBetween = 180 - toDegrees(Math.acos(cosAngle));
    if (angleBetween > 0)
    {
        var rotationMatrix = new Matrix4x4();
        rotationMatrix.loadRotation(cross.x, cross.y, cross.z, angleBetween);

        matrix = rotationMatrix;
    }

    // line up the unconnected slot; do this by rotating the angle between the
    // remaining slot (socket unconnected - connected) and
    // (plug unconnected - connected) about the socket normal
    var pin1 = plugConnector.getAttribute("pin1").getAttribute("center").getValueDirect();
    var slot1 = socketConnector.getAttribute("slot1").getAttribute("center").getValueDirect();
    var pin2 = plugConnector.getAttribute("pin2").getAttribute("center").getValueDirect();
    var slot2 = socketConnector.getAttribute("slot2").getAttribute("center").getValueDirect();

    pin1 = matrix.transform(pin1.x, pin1.y, pin1.z, 1);
    pin2 = matrix.transform(pin2.x, pin2.y, pin2.z, 1);

    var pinToPin, slotToSlot;
    switch (socketConnector.slot)
    {
        case 1:
            pinToPin = new Vector3D(pin2.x - pin1.x, pin2.y - pin1.y, pin2.z - pin1.z);
            slotToSlot = new Vector3D(slot2.x - slot1.x, slot2.y - slot1.y, slot2.z - slot1.z);
            break;

        case 2:
            pinToPin = new Vector3D(pin1.x - pin2.x, pin1.y - pin2.y, pin1.z - pin2.z);
            slotToSlot = new Vector3D(slot1.x - slot2.x, slot1.y - slot2.y, slot1.z - slot2.z);
            break;

        default:
            return;
    }

    cosAngle = cosineAngleBetween(pinToPin, slotToSlot);
    angleBetween = toDegrees(Math.acos(cosAngle));
    if (angleBetween > 0)
    {
        var rotationMatrix = new Matrix4x4();
        rotationMatrix.loadRotation(plugNormal.x, plugNormal.y, plugNormal.z, angleBetween);

        matrix = matrix.multiply(rotationMatrix);
    }

    // set position

    // get positions of pin and slot to connect 
    var pin, slot;
    switch (socketConnector.slot)
    {
        case 1:
            pin = plugConnector.getAttribute("pin1").getAttribute("center").getValueDirect();
            slot = socketConnector.getAttribute("slot1").getAttribute("center").getValueDirect();
            break;

        case 2:
            pin = plugConnector.getAttribute("pin2").getAttribute("center").getValueDirect();
            slot = socketConnector.getAttribute("slot2").getAttribute("center").getValueDirect();
            break;

        default:
            return;
    }
    pin = matrix.transform(pin.x, pin.y, pin.z, 1);
    
    var translationMatrix = new Matrix4x4();
    translationMatrix.loadTranslation(slot.x - pin.x, slot.y - pin.y, slot.z - pin.z);
    matrix = matrix.multiply(translationMatrix);
    
    plugConnector.getAttribute("connected").setValueDirect(true);
    socketConnector.getAttribute("connected").setValueDirect(true);
    
    // perform snap
    var snapped = this.snap(plug, socket, matrix);
    
    return snapped;
}

SnapMgr.prototype.snap = function(snapper, snappee, matrix)
{
    // if snappee is not a SnapModel, create one and snap snappee onto it first
    if (snappee.attrType != eAttrType.SnapModel)
    {
        var factory = this.registry.find("AttributeFactory");
        var snapModel = factory.create("SnapModel");
        factory.finalize("Model", snapModel);
        snapModel.synchronize(snappee, true);
        // don't copy vertices/snapConnectors
        snapModel.vertices.setValueDirect(new Array());
        snapModel.genericConnectors.clear();
        snapModel.plugConnectors.clear();
        snapModel.socketConnectors.clear();
        // set name
        var name = "CompoundModel_" + snapModel.__nodeId__;
        snapModel.name.setValueDirect(name);
        // enable physics
        snapModel.physicsEnabled.setValueDirect(true);
        // update transforms
        snapModel.updateSimpleTransform();
        snapModel.updateCompoundTransform();
        
        snapModel.snap(snappee, new Matrix4x4());
        snappee.getParent(0).addChild(snapModel);
        snappee = snapModel;
    }
    
    if (snapper.attrType == eAttrType.SnapModel)
    {
        // snap snapper's snaps onto snappee
        var snaps = snapper.snaps;
        
        // remove snapper first
        snapper.getParent(0).removeChild(snapper);
        // remove from registry
        this.registry.unregister(snapper);
        // delete
        //snapper.destroy();
        
        // snap snapper's snaps
        for (var i in snaps)
        {
            if (snaps[i])
            {
                this.snap(snaps[i].model, snappee, snaps[i].matrix.multiply(matrix));
            }
        }
    }
    else // simple model (not a SnapModel)
    {
        snappee.snap(snapper, matrix);
    }
    
    return snappee;
}

SnapMgr.prototype.resnap = function(models)
{
    var i, j;
    var rootSnaps = [];
    
    var snapModels = [];
    for (i = 0; i < models.length; i++)
    {
        snapModels.push(null);
    }
    
    for (i = 0; i < models.length; i++)
    {
        if (snapModels[i] != null) continue; // already snapped
        var snapper = models[i];
        
        for (j = 0; j < models.length; j++)
        {
            if (i == j) continue; // don't test model against itself          
            var snappee = snapModels[j] ? snapModels[j] : models[j];
            
            var snapped = this.trySnap(snapper, snappee);
            if (snapped)
            {
                snapModels[i] = snapped;
                snapModels[j] = snapped;
                // if snappee is a snapModel, remove from root-level snapped shapes, because it
                // is now a part of snapped
                for (k = 0; k < rootSnaps.length; k++)
                {
                    if (rootSnaps[k] == snappee)
                    {
                        rootSnaps.splice(k, 1);
                        break;
                    }
                }
                rootSnaps.push(snapped);
                break;
            }
        }
    }
    
    // recurse on root-level snapped shapes
    if (rootSnaps.length > 1)
    {
        this.resnap(rootSnaps);
    }
}

SnapMgr.prototype.trySnap = function(snapper, snappee)
{
    var i, j;
    
    if (snapper.snapEnabled.getValueDirect() == false ||
        snappee.snapEnabled.getValueDirect() == false)
        return null;

    // if the snapper is a SnapModel, and the snappee is not a SnapModel, swap (simplifies connection)
    if (snapper.attrType == eAttrType.SnapModel &&
        snappee.attrType != eAttrType.SnapModel)
    {
        var temp = snapper;
        snapper = snappee;
        snappee = temp;
    }
        
    var snapperMatrix = snapper.sectorTransformCompound;
    var snappeeMatrix = snappee.sectorTransformCompound;
    
    // generics
    var snapperGenerics = snapper.genericConnectors;
    var snappeeGenerics = snappee.genericConnectors;
    for (i = 0; i < snapperGenerics.Size(); i++)
    {
        var snapperGeneric = snapperGenerics.getAt(i);
        if (snapperGeneric.connected.getValueDirect() == true) continue;
        
        for (j = 0; j < snappeeGenerics.Size(); j++)
        {
            var snappeeGeneric = snappeeGenerics.getAt(j);
            if (snappeeGeneric.connected.getValueDirect() == true) continue;
            if (snapperGeneric.type.getValueDirect().join("") != snappeeGeneric.type.getValueDirect().join("")) continue; // only test same types
            
            if (snapperGeneric.collides(snappeeGeneric, snapperMatrix, snappeeMatrix))
            {
                return this.snapGenericToGeneric(snapper, snappee, snapperGeneric, snappeeGeneric);
            }
        }
    }
    
    // plugs/sockets
    // TODO: might need to test snapper's sockets to snappee's plugs (?)
    var snapperPlugs = snapper.plugConnectors;
    var snappeeSockets = snappee.socketConnectors;
    for (i = 0; i < snapperPlugs.Size(); i++)
    {
        var snapperPlug = snapperPlugs.getAt(i);
        if (snapperPlug.connected.getValueDirect() == true) continue;
        
        for (j = 0; j < snappeeSockets.Size(); j++)
        {
            var snappeeSocket = snappeeSockets.getAt(j);
            if (snappeeSocket.connected.getValueDirect() == true) continue;
            if (snapperPlug.type.getValueDirect().join("") != snappeeSocket.type.getValueDirect().join("")) continue; // only test same types
            
            if ((snappeeSocket.slot = snapperPlug.collides(snappeeSocket, snapperMatrix, snappeeMatrix)) > 0)
            {
                return this.snapPlugToSocket(snapper, snappee, snapperPlug, snappeeSocket);
            }
        }
    }
    
    return null;
}

SnapMgr.prototype.serialize = function()
{
    var i;
    var serialized = "";
    
    var factory = this.registry.find("AttributeFactory");
    var serializer = factory.create("Serializer");
    var xmlSerializer = new XMLSerializer();
    var context = new Context();
        
    // get snapped models
    var snapped = this.registry.getByType(eAttrType.SnapModel);
    if (snapped)
    {    
        for (i = 0; i < snapped.length; i++)
        {
            var snapTo = new SnapToCommand();
            var descriptors = snapped[i].getSnapped();

            snapTo.models.synchronize(descriptors, false);

            // serialize
            context.attribute = snapTo;
            serializer.serialize(context.attribute, context.item, context.attributeName, context.container);
            serialized += xmlSerializer.serializeToString(serializer.DOM);
        }
    }
    
    return serialized;
}
// TODO
var eLWObjectTokens = 
{
    COLR    : 1129270354,
    DIFF    : 1145652806,
    LUMI    : 1280658761,
    SPEC    : 1397769539,
    TRAN    : 1414676814
};

function LWO2BlockData()
{
    this.type = "";
    this.ordinal = "";
    this.channel = 0;
    this.enable = 1;
    this.opacityType = 7;
    this.opacity = 1;
    this.opacityEnvelope = 0;
    this.negative = 0;
    this.center = new Vector3D();
    this.size = new Vector3D();
    this.coordSys = 0;
    this.projMode = 0;
    this.axis = 0;
    this.imageIndex = 0;
    this.widthWrap = 1;
    this.heightWrap = 1;
    this.widthWrapAmt = 0;
    this.heightWrapAmt = 0;
    this.uvMapName = "";
}

function LWO2SurfaceData()
{
    this.name = "";
    this.source = "";
    this.color = new Vector3D();
    this.diffuseLevel = 1;
    this.specularLevel = 0;
    this.luminosityLevel = 0;
    this.transparencyLevel = 0;
    this.glossiness = 0.4;
    this.doubleSided = false;
    this.smoothingAngle = 0;  
    this.blocks = [];
    this.addBlock = function()
    {
        this.blocks.push(new LWO2BlockData());
    }
    this.currentBlock = function()
    {
        return this.blocks.length > 0 ? this.blocks[this.blocks.length-1] : null;
    }
}

function LWO2ClipData()
{
    this.type = 0;
    this.negative = 0;
    
    var filename = "";
    var platformNeutralFilename = "";
    this.setPlatformNeutralFilename = function(_filename)
    {
        platformNeutralFilename = _filename;
        filename = _filename;
        if (filename.indexOf(':') >= 0)
        {
            var split = new Array();
            split = filename.split(':');
            filename = split[0] + ':' + '/' + split[1];
        }
    }
    this.setFilename = function(_filename)
    {
        filename = _filename;
        platformNeutralFilename = _filename;
        // check that filename is not in platform neutral format
        var pos = filename.indexOf(':');
        if (pos >= 0)
        {
            if (filename.charAt(pos+1) != '/' && filename.charAt(pos+1) != '\\')
            {
                var split = new Array();
                split = filename.split(':');
                filename = split[0] + ':' + '/' + split[1];
            }
        }
        // check that platform neutral filename is in platform neutral format
        pos = platformNeutralFilename.indexOf(':');
        if (pos >= 0)
        {
            if (platformNeutralFilename.charAt(pos+1) == '/' || platformNeutralFilename.charAt(pos+1) == '\\')
            {
                var split = new Array();
                split = platformNeutralFilename.split(':');
                platformNeutralFilename = split[0] + ':' + split[1].substr(1, split[1].length);
            }
        }
        this.getPlatformNeutralFilename = function()
        {
            return platformNeutralFilename;
        }
        this.getFilename = function()
        {
            return filename;
        }
    }
}

function LWO2EnvelopeData()
{
    this.userFormat = 0;
    this.type = 0;
    this.preBehavior = 0;
    this.postBehavior = 0;
    this.keyframes = [];
    
    this.currentKyframe = function()
    {
        return this.keyframes.length > 0 ? this.keyframes[this.keyframes.length-1] : null;
    }
}

function LWO2VMAPData()
{
    this.vertex = 0;
    this.u = 0;
    this.v = 0;
}

function LWO2VMADData()
{
    this.poly = 0;
    this.vertex = 0;
    this.u = 0;
    this.v = 0;
}

function LWO2PTAGData()
{
    this.poly = 0;
    this.tag = 0;
}

function LWO2LayerData()
{
    this.number = 0;
    this.name = "";
    this.pnts = [];
    this.pols = [];
    this.ptagsSURF = [];
    this.vmapsTXUV = [];
    this.vmadsTXUV = [];
    this.ptagsSURFMaxIndex = 0;
    this.pivot = new Vector3D();
    
    this.getVmap = function(type, name)
    {
        switch (type)
        {
            case 'TXUV':
                return this.vmapsTXUV[name];
                break;
            
            default: 
                return null;
        }
    }
    
    this.putVmap = function(type, name, vmap)
    {
        switch (type)
        {
            case 'TXUV':
                if (this.vmapsTXUV[name] == undefined) 
                    this.vmapsTXUV[name] = []
                this.vmapsTXUV[name].push(vmap);
                break;
        }
    }
    
    this.getVmad = function(type, name)
    {
        switch (type)
        {
            case 'TXUV':
                return this.vmadsTXUV[name];
                break;
            
            default: 
                return null;
        }
    }
    
    this.putVmad = function(type, name, vmad)
    {
        switch (type)
        {
            case 'TXUV':
                if (this.vmadsTXUV[name] == undefined) 
                    this.vmadsTXUV[name] = []
                this.vmadsTXUV[name].push(vmad);
                break;
        }
    }
    
    this.putPtag = function(ptag)
    {
        this.ptagsSURF.push(ptag);
    }
}

function LWO2Data()
{
    this.name = "";
    this.contentDir = "";
    this.layers = [];
    this.tags = [];
    this.surfaces = [];
    this.clips = [];
    this.envelopes = [];
    this.subChunkContext = "";
    this.evaluators = [];
    
    var currentClip = null;
    var currentEnvelope = null;
    var currentLayer = null;
    this.addLayer = function(number)
    {
        var layer = new LWO2LayerData();
        layer.number = number;
        if (this.layers.length <= number)
        {
            this.layers.length = number + 1;
        }
        this.layers[number] = layer;
        currentLayer = layer;
    }
    this.currentLayer = function()
    {
        return currentLayer;
    }
    this.addSurface = function(name, source)
    {
        var surface = new LWO2SurfaceData();
        surface.name = name;
        surface.source = source;
        this.surfaces.push(surface);
    }
    this.currentSurface = function()
    {
        return this.surfaces.length > 0 ? this.surfaces[this.surfaces.length-1] : null;
    }
    this.getSurface = function(name)
    {
        for (var i=0; i < this.surfaces.length; i++)
        {
            if (this.surfaces[i].name == name)
            {
                return this.surfaces[i];
            }
        }
        return null;
    }
    this.addClip = function(index)
    {
        var clip = new LWO2ClipData();
        if (this.clips.length <= index)
        {
            this.clips.length = index + 1;
        }
        this.clips[index] = clip;
        currentClip = clip;
    }
    this.currentClip = function()
    {
        return currentClip;
    }
    this.addEnvelope = function(index)
    {
        var envelope = new LWO2EnvelopeData();
        this.envelopes[index] = envelope;
        currentEnvelope = envelope;
    }
    this.currentEnvelope = function()
    {
        return currentEnvelope;
    }
}

LWObjectHandler.prototype = new ContentHandler();
LWObjectHandler.prototype.constructor = LWObjectHandler;

function LWObjectHandler()
{
    ContentHandler.call(this);
    this.className = "LWObjectHandler";
    
    this.lwo2DataHandlers = [];
    this.lwo2DataHandlersData = [];
}

LWObjectHandler.prototype.addObjectHandler = function(handler, data)
{
    this.lwo2DataHandlers.push(handler);
    this.lwo2DataHandlersData.push(data);
}

LWObjectHandler.prototype.parseFileStream = function(url)
{
    var filename = formFullPath(url, this.contentDirectory.getValueDirect().join(""));
    var filestream = loadBinaryResource(filename);
    if (filestream == null)
    {
        return -2;
    }

    var parser = new BinaryParser(filestream, true);

    // read file tag (must be 'FORM')
    if (parser.readUInt8() != 70 || // 'F'
    parser.readUInt8() != 79 || // 'O'
    parser.readUInt8() != 82 || // 'R'
    parser.readUInt8() != 77)   // 'M'
    {
        return -1;
    }

    // read file size
    var fileSize = parser.readUInt32();

    // read file type (must be 'LWO2')
    if (parser.readUInt8() != 76 || // 'L'
    parser.readUInt8() != 87 || // 'W'
    parser.readUInt8() != 79 || // 'O'
    parser.readUInt8() != 50)   // '2'
    {
        return -1;
    }
    fileSize -= 4; // subtract these 4 bytes from the file size

    var data = new LWO2Data();
    data.contentDir = this.contentDirectory.getValueDirect().join("");

    // set the model name (filename w/o extension)
    var lastSlash = url.lastIndexOf("/");
    var extension = url.lastIndexOf(".");
    data.name = url.substring(lastSlash+1, extension);

    // read file chunks into LWOData
    while (fileSize > 0)
    {
        fileSize -= this.parseChunk(parser, data);
    }

    // pass data to consumer(s)
    for (var i = 0; i < this.lwo2DataHandlers.length; i++)
    {
        this.lwo2DataHandlers[i](data, this.lwo2DataHandlersData[i]);
    }

    return 0;
}

LWObjectHandler.prototype.parseChunk = function(parser, data)
{
    var bytesRead = 0;
    
    // ASSUMPTION MADE:  file stream pointer is currently sitting at a tag
    // i.e., has been advanced past header.

    // read chunk tag
    var tag = parser.readUInt32(); // bytesRead accounted for at end of method
    //alert("tag: " + tag);
    
    // read chunk size
    var chunkSize = parser.readUInt32(); // bytesRead accounted for at end of method
    //alert("chunkSize: " + chunkSize);
    
    // read chunk size bytes
    switch (tag)
    {
        case 1279351122: // 'LAYR'
            {
                var number = parser.readUInt16(); bytesRead += 2;
            
                var flags = parser.readUInt16(); bytesRead += 2;

                var x = parser.readFloat32(); bytesRead += 4;
                var y = parser.readFloat32(); bytesRead += 4;
                var z = parser.readFloat32(); bytesRead += 4;
            
                var name = this.readString(parser); bytesRead += name.bytesRead;
            
                if (chunkSize > bytesRead)
                {
                    var parent = parser.readUInt16(); bytesRead += 2;
                }

                data.addLayer(number);
                data.currentLayer().name = name.string;
                data.currentLayer().pivot.x = x;
                data.currentLayer().pivot.y = y;
                data.currentLayer().pivot.z = z;
            }
            break;
    
        case 1347310675: // 'PNTS'
            {
                var numPnts = chunkSize / 12;

                for (var i=0; i < numPnts; i++)
                {
                    var x = parser.readFloat32(); bytesRead += 4;
                    var y = parser.readFloat32(); bytesRead += 4;
                    var z = parser.readFloat32(); bytesRead += 4; 
            
                    data.currentLayer().pnts[i] = new Vector3D();
                    data.currentLayer().pnts[i].x = x;
                    data.currentLayer().pnts[i].y = y; 
                    data.currentLayer().pnts[i].z = z;                
                }
            }
            break;
    
        case 1347374163: // 'POLS'
            {
                var type = parser.readUInt32(); bytesRead += 4;
            
                var flags, numVerts;
                while (chunkSize > bytesRead)
                {
                    var poly = [];
                
                    flags = parser.readUInt16(); bytesRead += 2;
                    numVerts = flags & 0x03ff;
                    for (var i=0; i < numVerts; i++)
                    {
                        var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                    
                        poly.push(index.index);
                    }
                
                    data.currentLayer().pols.push(poly);
                }
            }
            break;
        
        case 1413564243: // 'TAGS'
            {
                while (chunkSize > bytesRead)
                {
                    var tags = this.readString(parser); bytesRead += tags.bytesRead;
                    data.tags.push(tags.string);
                }
            }
            break;
      		
        case 1347699015: // 'PTAG'
            {
                var type = parser.readUInt32(); bytesRead += 4;
            
                while (chunkSize > bytesRead)
                {
                    var ptag = new LWO2PTAGData();
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                    ptag.poly = index.index;
                    ptag.tag = parser.readUInt16(); bytesRead += 2;
                
                    switch (type)
                    {
                        case 1398100550: // 'SURF'
                            {
                                data.currentLayer().putPtag(ptag);
                                data.currentLayer().ptagsSURFMaxIndex = Math.max(ptag.tag, data.currentLayer().ptagsSURFMaxIndex);
                            }
                            break;
                    }
                }
            }
            break;
    
        case 1447903568: // 'VMAP'
            {
                var type = parser.readUInt32(); bytesRead += 4;
                var dimension = parser.readUInt16(); bytesRead += 2;
                var name = this.readString(parser); bytesRead += name.bytesRead;
            
                var u, v, value;
                while (chunkSize > bytesRead)
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead; 
                
                    switch (type)
                    {
                        case 1415075158: // 'TXUV'
                            {
                                u = parser.readFloat32(); bytesRead += 4;
                                v = parser.readFloat32(); bytesRead += 4;
                        
                                var vmapData = new LWO2VMAPData();
                                vmapData.vertex = index.index;
                                vmapData.u = u;
                                vmapData.v = v;
                                data.currentLayer().putVmap('TXUV', name.string, vmapData);
                            }
                            break;
                    
                        default:
                            {
                                for (var i=0; i < dimension; i++)
                                {
                                    value = parser.readFloat32(); bytesRead += 4;       
                                }
                            }
                            break;    
                    }
                }
            }
            break;
        
        case 1447903556: // 'VMAD'
            {
                var type = parser.readUInt32(); bytesRead += 4;
                var dimension = parser.readUInt16(); bytesRead += 2;
                var name = this.readString(parser); bytesRead += name.bytesRead;
            
                var u, v, value;
                while (chunkSize > bytesRead)
                {
                    var vertIndex = this.readVariableLengthIndex(parser); bytesRead += vertIndex.bytesRead;
                    var polyIndex = this.readVariableLengthIndex(parser); bytesRead += polyIndex.bytesRead;
                
                    switch (type)
                    {
                        case 1415075158: // 'TXUV'
                            {
                                u = parser.readFloat32(); bytesRead += 4;
                                v = parser.readFloat32(); bytesRead += 4;
                        
                                var vmadData = new LWO2VMADData();
                                vmadData.vertex = vertIndex.index;
                                vmadData.poly = polyIndex.index;
                                vmadData.u = u;
                                vmadData.v = v;
                                data.currentLayer().putVmad('TXUV', name.string, vmadData);
                            }
                            break;
                    
                        default:
                            {
                                for (var i=0; i < dimension; i++)
                                {
                                    value = parser.readFloat32(); bytesRead += 4;       
                                }
                            }
                            break;    
                    }       
                }
            }
            break;
        
        case 1398100550: // 'SURF'
            {
                var name = this.readString(parser); bytesRead += name.bytesRead;
                var source = this.readString(parser); bytesRead += source.bytesRead;

                data.addSurface(name.string, source.string);
            
                // parse surface subchunks
                while (chunkSize > bytesRead)
                {
                    bytesRead += this.parseSubChunk(parser, data);
                }
            }
            break;
        
        case 1129072976: // 'CLIP'
            {
                var index = parser.readUInt32(); bytesRead += 4;
            
                data.addClip(index);
                data.subChunkContext = tag;
            
                // parse clip subchunks
                while (chunkSize > bytesRead)
                {
                    bytesRead += this.parseSubChunk(parser, data);
                }
            }
            break;
        
        case 1162761804: // 'ENVL'
            {
                var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
            
                data.addEnvelope(index.index);
            
                // parse envelope subchunks
                while (chunkSize > bytesRead)
                {
                    bytesRead += this.parseSubChunk(parser, data);
                }
            }
            break;
          
        default:
            {
                // unrecognized tag - seek to end of chunk
                while (chunkSize > bytesRead)
                {
                    parser.readUInt8(); bytesRead++;
                }
            }
            break;
    }
    
    // read pad byte if chunk size is odd
    if (chunkSize & 0x1)
    {
        parser.readUInt8(); bytesRead++;
    }
    
    // account for tag/chunk size (read at beginning of method)
    bytesRead += 8;
    //alert("bytesRead: " + bytesRead);
    
    return bytesRead;    
}

LWObjectHandler.prototype.parseSubChunk = function(parser, data)
{
    var bytesRead = 0;

    // read subchunk tag
    var tag = parser.readUInt32(); bytesRead += 4;

    // read subchunk size
    var subChunkSize = parser.readUInt16(); bytesRead += 2;

    // read subchunk size bytes
    switch (tag)
    {
        case 1129270354: // 'COLR'
            {
                data.currentSurface().color.x = parser.readFloat32(); bytesRead += 4;
                data.currentSurface().color.y = parser.readFloat32(); bytesRead += 4;
                data.currentSurface().color.z = parser.readFloat32(); bytesRead += 4;
            
                if (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                }    
            }
            break;
        
        case 1145652806: // 'DIFF'
            {
                data.currentSurface().diffuseLevel = parser.readFloat32(); bytesRead += 4;
            
                if (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                } 
            }
            break;
    
        case 1280658761: // 'LUMI'  
            {
                data.currentSurface().luminosityLevel = parser.readFloat32(); bytesRead += 4;
            
                if (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                }
            }
            break;
        
        case 1397769539: // 'SPEC'
            {
                data.currentSurface().specularLevel = parser.readFloat32(); bytesRead += 4;
            
                if (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                }
            }
            break;
        
        case 1414676814: // 'TRAN'
            {
                data.currentSurface().transparencyLevel = parser.readFloat32(); bytesRead += 4;
            
                if (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                }
            }
            break;
        
        case 1196183379: // 'GLOS'
            {
                data.currentSurface().glossiness = parser.readFloat32(); bytesRead += 4;
            
                if (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                }
            }
            break;
        
        case 1397310533: // 'SIDE'
            {
                data.currentSurface().doubleSided = (parser.readUInt16() == 3 ? true : false); bytesRead += 2;            
            }
            break;
        
        case 1397571918: // 'SMAN'
            {
                data.currentSurface().smoothingAngle = parser.readFloat32(); bytesRead += 4;
            }
            break;
        
        case 1398032716: // 'STIL'
        case 1095649613: // 'ANIM'
        case 1230194001: // 'ISEQ'
            {
                var filename = this.readString(parser); bytesRead += filename.bytesRead;
            
                // skip subsequent chunk data
                while (subChunkSize > (bytesRead - 6))
                {
                    parser.readUInt8(); bytesRead += 1;
                }
            
                data.currentClip().type = tag;
                data.currentClip().setFilename(filename.string);
            }
            break;
        
        case 1313163073: // 'NEGA'
            {
                var negative = parser.readUInt16(); bytesRead += 2;
            
                if (data.subChunkContext == 'IMAP')
                {
                    data.currentSurface().currentBlock().negative = negative;
                }
                else if (data.subChunkContext == 'CLIP')
                {
                    data.currentClip().negative = negative;
                }
            }
            break;
        
        case 1112297291: // 'BLOK'
            {
                data.currentSurface().addBlock();
            }
            break;
        
        case 1229799760: // 'IMAP'
            {
                var ordinal = this.readString(parser); bytesRead += ordinal.bytesRead;
            
                data.currentSurface().currentBlock().type = 'IMAP';
                data.currentSurface().currentBlock().ordinal = ordinal.string;
                data.subChunkContext = 'IMAP';
            }
            break;
        
        case 1128808782: // 'CHAN'
            {
                var channel = parser.readUInt32(); bytesRead += 4;
            
                if (data.subChunkContext == 'IMAP')
                {
                    data.currentSurface().currentBlock().channel = channel;
                }
            }
            break;
        
        case 1162756418: // 'ENAB'
            {
                data.currentSurface().currentBlock().enable = parser.readUInt16(); bytesRead += 2;
            }
            break;
        
        case 1330659651: // 'OPAC'
            {
                data.currentSurface().currentBlock().opacityType = parser.readUInt16(); bytesRead += 2;
                data.currentSurface().currentBlock().opacity = parser.readFloat32(); bytesRead += 4;
            
                if (subChunkSize > (bytesRead - 6))
                {
                    var envelope = this.readVariableLengthIndex(parser); bytesRead += envelope.bytesRead;
                
                    data.currentSurface().currentBlock().opacityEnvelope = envelope.index;
                }
            }
            break;
        
        case 1414349136: // 'TMAP'
            {
            }
            break;
         
        case 1129206866: // 'CNTR'
            {
                data.currentSurface().currentBlock().center.x = parser.readFloat32(); bytesRead += 4;
                data.currentSurface().currentBlock().center.y = parser.readFloat32(); bytesRead += 4;
                data.currentSurface().currentBlock().center.z = parser.readFloat32(); bytesRead += 4;
            
                while (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                }
            }
            break;
        
        case 1397316165: // 'SIZE'
            {
                data.currentSurface().currentBlock().size.x = parser.readFloat32(); bytesRead += 4;
                data.currentSurface().currentBlock().size.y = parser.readFloat32(); bytesRead += 4;
                data.currentSurface().currentBlock().size.z = parser.readFloat32(); bytesRead += 4;
            
                while (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                }
            }
            break;
        
        case 1129535827: // 'CSYS'
            {
                data.currentSurface().currentBlock().coordSys = parser.readUInt16(); bytesRead += 2;
            }
            break;
        
        case 1347571530: // 'PROJ'
            {
                data.currentSurface().currentBlock().projMode = parser.readUInt16(); bytesRead += 2;
            }
            break;
        
        case 1096304979: // 'AXIS'
            {
                var axis = parser.readUInt16(); bytesRead += 2;
            
                if (data.subChunkContext == 'IMAP')
                {
                    data.currentSurface().currentBlock().axis = axis;
                }
            }
            break;
        
        case 1229799751: // 'IMAG'
            {
                var image = this.readVariableLengthIndex(parser); bytesRead += image.bytesRead;
            
                data.currentSurface().currentBlock().imageIndex = image.index;
            }
            break;
        
        case 1465008464: // 'WRAP'
            {
                data.currentSurface().currentBlock().widthWrap = parser.readUInt16(); bytesRead += 2;
                data.currentSurface().currentBlock().heightWrap = parser.readUInt16(); bytesRead += 2;
            }
            break;
        
        case 1465012311: // 'WRPW'
            {
                data.currentSurface().currentBlock().widthWrapAmt = parser.readFloat32(); bytesRead += 4;
            
                if (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                }
            }
            break;
        
        case 1465012296: // 'WRPH'
            {
                data.currentSurface().currentBlock().heightWrapAmt = parser.readFloat32(); bytesRead += 4;
            
                if (subChunkSize > (bytesRead - 6))
                {
                    var index = this.readVariableLengthIndex(parser); bytesRead += index.bytesRead;
                }
            }
            break;
        
        case 1447903568: // 'VMAP'
            {
                var name = this.readString(parser); bytesRead += name.bytesRead;
            
                data.currentSurface().currentBlock().uvMapName = name.string; 
            }
            break;
        
        case 1415139397: // 'TYPE'
            {
                data.currentEnvelope().userFormat = parser.readUInt8(); bytesRead += 1;
                data.currentEnvelope().type = parser.readUInt8(); bytesRead += 1;
            }
            break;
        
        case 1347568928: // 'PRE '
            {
                data.currentEnvelope().preBehavior = parser.readUInt16(); bytesRead += 2;
            }
            break;
        
            //case 1262836000: // 'KEY '
            {
                // TODO        
            }
            break;
       
            //case 1397768526: // 'SPAN'
            {
                // TODO
                //case 1413693984: // 'TCB '
                //case 1212502605: // 'HERM'
                //case 1111841353: // 'BEZI'
                //case 1111841330: // 'BEZ2'
                //case 1398031696: // 'STEP'
                //case 1279872581: // 'LINE'
            }
            break;
        
        case 1347375956: // 'POST'
            {
                data.currentEnvelope().postBehavior = parser.readUInt16(); bytesRead += 2;
            }
            break;

        default:
            {
                // unrecognized tag - seek to end of chunk
                while (subChunkSize > (bytesRead - 6))
                {
                    parser.readUInt8(); bytesRead += 1;
                }
            }
            break;
    }
    
    // read pad byte if subchunk size is odd
    if (subChunkSize & 0x1)
    {
        parser.readUInt8(); bytesRead += 1;
    }
    
    return bytesRead;
}

LWObjectHandler.prototype.readString = function(parser)
{
    var s = "";
    var c = 0;
    var count = 0;
    do
    {
        c = parser.readUInt8(); count++;
        s += String.fromCharCode(c);
        
    } while (c);
    
    // read pad byte if length is odd
    if (count & 0x1)
    {
        parser.readUInt8(); count++;   
    }
    
    return { string: s, bytesRead: count };
}

LWObjectHandler.prototype.readVariableLengthIndex = function(parser)
{
    var i = 0;
    var c = new Array(4);
    var count = 0;
    
    c[0] = parser.readUInt8(); count++;
    c[1] = parser.readUInt8(); count++;
    
    if (c[0] < 0xff00) // 2-byte form
    {
        i = c[0] << 8 | c[1];
    }
    else // 4-byte form
    {
        c[2] = parser.readUInt8(); count++;
        c[3] = parser.readUInt8(); count++;
        
        i = c[1] << 16 | c[2] << 8 | c[3];
    }

    return { index: i, bytesRead: count };
}

LWObjectHandler.prototype.matchesType = function(type)
{
    return (type == "lwo");
}
LWObjectBuilder.prototype = new ContentBuilder();
LWObjectBuilder.prototype.constructor = LWObjectBuilder;

function LWObjectBuilder()
{
    ContentBuilder.call(this);
    this.className = "LWObjectBuilder";
    
    this.graphMgr = null;
    
    this.indexGeometry = new BooleanAttr(true);
    
    this.registerAttribute(this.indexGeometry, "indexGeometry");
}

LWObjectBuilder.prototype.visitHandler = function(handler)
{
    handler.addObjectHandler(LWObjectBuilder_ObjectHandler, this);
}

LWObjectBuilder.prototype.finalize = function()
{
}

LWObjectBuilder.prototype.matchesType = function(type)
{
    return (type == "lwo");
}

LWObjectBuilder.prototype.allocateModel = function(data)
{
    var model = null;
    var layer = this.layer;
    if (layer == 0)
    {
        for (var i=0; i < data.layers.length; i++)
        {
            // allocate model if necessary (otherwise use the model passed to the builder)
            if (!this.models[0])
            {
                var factory = this.registry.find("AttributeFactory");
                model = factory.create("Model");
                this.models.push(model);
            }
            else model = this.models[0];

            // TODO: matching model/replace model surfaces

            // define model attributes
            this.describeModel(data, data.layers[i], model);
        }
    }
    else if (layer <= data.layers.length) // layer > 0
    {
        // allocate model if necessary (otherwise use the model passed to the builder)
        if (!this.models[0])
        {
            var factory = this.registry.find("AttributeFactory");
            model = factory.create("Model");
            this.models.push(model);
        }
        else model = this.models[0];
        
        // TODO: matching model/replace model surfaces

        // define model attributes
        this.describeModel(data, data.layers[layer-1], model);
    }
}

LWObjectBuilder.prototype.describeModel = function(data, layer, model)
{
    var factory = this.registry.find("AttributeFactory");
    
    // set name if not already set by scene
    var name = model.getAttribute("name");
    if (name.modificationCount == 0)
    {
        var layerName = data.name;
        if (data.layers.length > 1)
        {
            layerName += ":Layer" + this.layer;
        }
        name.setValueDirect(layerName);
    }
    
    // set pivot if not already set by scene
    var pivot = model.getAttribute("pivot");
    if (pivot.modificationCount == 0)
    {
        pivot.setValue(layer.pivot.v());
    }

    // build list of tri, line, and point poly indices indexed by surface number
    var numSurfaces = layer.ptagsSURFMaxIndex + 1;
    var triPolys = new Array(numSurfaces);
    var linePolys = new Array(numSurfaces);
    var pointPolys = new Array(numSurfaces);
    var NPolys = new Array(numSurfaces);
    for (var i = 0; i < numSurfaces; i++)
    {
        triPolys[i] = [];
        linePolys[i] = [];
        pointPolys[i] = [];
        NPolys[i] = [];
    }

    var polyIndex, surfIndex;
    var numPtagsSURF = layer.ptagsSURF.length;
    for (var ptag = 0; ptag < numPtagsSURF; ptag++)
    {
        polyIndex = layer.ptagsSURF[ptag].poly;
        surfIndex = layer.ptagsSURF[ptag].tag;

        switch (layer.pols[polyIndex].length)
        {
            case 3: triPolys[surfIndex].push(polyIndex); break;
            case 2: linePolys[surfIndex].push(polyIndex); break;
            case 1: pointPolys[surfIndex].push(polyIndex); break;
            default: NPolys[surfIndex].push(polyIndex); break;
        }
    }

    // create surfaces for geometry
    var surfaces = new Array(numSurfaces);
    for (var surfIndex = 0; surfIndex < numSurfaces; surfIndex++)
    {
        surfaces[surfIndex] = this.allocateSurface(data, layer, surfIndex);

        // add surface to model (model will target surface and set its color to the surface)
        model.addSurface(surfaces[surfIndex]);
    }

    // create geometry (calculate polygon normals for tris)
    var vertexPolyNormals = [];
    var vertexNormals = [];
    var vertexOrder = [];
    var vertexMinMax = [];
    var polyOrder = [];
    var triLists = [];
    var triVertices = [];
    var triPolyNormals = [];
    var leg1 = new Vector3D();
    var leg2 = new Vector3D();
        
    vertexPolyNormals.length = layer.pnts.length;
    for (var i = 0; i < vertexPolyNormals.length; i++)
    {
        vertexPolyNormals[i] = [];
    }
    vertexNormals.length = numSurfaces;
    vertexOrder.length = numSurfaces;
    vertexMinMax.length = numSurfaces;
    polyOrder.length = numSurfaces;
    triLists.length = numSurfaces;
    triVertices.length = numSurfaces;
    triPolyNormals.length = numSurfaces;

    for (var surfIndex = 0; surfIndex < surfaces.length; surfIndex++)
    {
        var vertices = [];
        var normals = [];
        var surfacePnts = []; // for setting surface's layer vertices to surface
        vertexNormals[surfIndex] = []
        vertexOrder[surfIndex] = [];
        vertexMinMax[surfIndex] = new Pair();
        vertexMinMax[surfIndex].first = vertexMinMax[surfIndex].second = 0;
        polyOrder[surfIndex] = [];
        triPolyNormals[surfIndex] = [];

        // N-polys (triangulate then add to tris list)
        var polys = NPolys[surfIndex];
        var numPolys = polys.length;
        for (var polyIndex = 0; polyIndex < numPolys; polyIndex++)
        {
            var jsmPolygon = new JSM.Polygon();
            var poly = layer.pols[polys[polyIndex]];
            for (var vertex = 0; vertex < poly.length; vertex++)
            {
                var point = layer.pnts[poly[vertex]];
                surfacePnts[poly[vertex]] = point;
                
                vertices.push([point.x, point.y, point.z]);

                jsmPolygon.AddVertex(point.x, point.y, point.z);
            }
           
            var triangles = JSM.PolygonTriangulate(jsmPolygon);
            for (var i=0; i < triangles.length; i++)
            {
                var triPoly = [];
                triPoly.push(poly[triangles[i][0]]);
                triPoly.push(poly[triangles[i][1]]);
                triPoly.push(poly[triangles[i][2]]);
                
                layer.pols.push(triPoly);
                triPolys[surfIndex].push(layer.pols.length-1);
            }
        }

        // tris   
        vertices = [];
        polys = triPolys[surfIndex];
        numPolys = polys.length;
        for (var polyIndex = 0; polyIndex < numPolys; polyIndex++)
        {
            var poly = layer.pols[polys[polyIndex]];
            for (var vertex = 0; vertex < 3; vertex++)
            {
                var point = layer.pnts[poly[vertex]];
                surfacePnts[poly[vertex]] = point;
                
                vertices.push(point.x);
                vertices.push(point.y);
                vertices.push(point.z);

                vertexOrder[surfIndex].push(poly[vertex]);
                vertexMinMax[surfIndex].first = Math.min(poly[vertex], vertexMinMax[surfIndex].first);
                vertexMinMax[surfIndex].second = Math.min(poly[vertex], vertexMinMax[surfIndex].second);
                polyOrder[surfIndex].push(polys[polyIndex]);
            }

            // get vertex indices
            var vertIndex0 = poly[0];
            var vertIndex1 = poly[1];
            var vertIndex2 = poly[2];

            // calculate polygon normal
            var point0 = layer.pnts[vertIndex0];
            var point1 = layer.pnts[vertIndex1];
            var point2 = layer.pnts[vertIndex2];

            leg1.load(point1.x - point0.x,
                      point1.y - point0.y,
                      point1.z - point0.z);

            leg2.load(point2.x - point0.x,
                      point2.y - point0.y,
                      point2.z - point0.z);

            var cross = crossProduct(leg1, leg2);
            cross.normalize();

            normals.push(cross.x)
            normals.push(cross.y);
            normals.push(cross.z);

            normals.push(cross.x)
            normals.push(cross.y);
            normals.push(cross.z);

            normals.push(cross.x)
            normals.push(cross.y);
            normals.push(cross.z);

            vertexNormals[surfIndex].push(new Pair(vertIndex0, cross));
            vertexNormals[surfIndex].push(new Pair(vertIndex1, cross));
            vertexNormals[surfIndex].push(new Pair(vertIndex2, cross));

            vertexPolyNormals[vertIndex0].push(cross);
            vertexPolyNormals[vertIndex1].push(cross);
            vertexPolyNormals[vertIndex2].push(cross);

            triPolyNormals[surfIndex].push(cross);
            triPolyNormals[surfIndex].push(cross);
            triPolyNormals[surfIndex].push(cross);
        }

        if (vertices.length)
        {
            var triList = factory.create("TriList");

            model.addGeometry(triList, vertexOrder[surfIndex], surfaces[surfIndex]);

            triList.getAttribute("vertices").setValue(vertices);
            triList.getAttribute("normals").setValue(normals);

            triLists[surfIndex] = triList;
            triVertices[surfIndex] = vertices;
        }

        // lines
        vertices = [];
        polys = linePolys[surfIndex];
        numPolys = polys.length;
        
        for (var polyIndex = 0; polyIndex < numPolys; polyIndex++)
        {
            var poly = layer.pols[polyIndex];
            if (poly.length < 2) continue;
            
            for (var vertex = 0; vertex < 2; vertex++)
            {
                var point = layer.pnts[poly[vertex]];
                surfacePnts[poly[vertex]] = point;
                
                vertices.push(point.x);
                vertices.push(point.y);
                vertices.push(point.z);
                
            }
        }
        
        if (vertices.length)
        {
            var lineList = factory.create("LineList");

            model.addGeometry(lineList, null, surfaces[surfIndex]);
            
            lineList.getAttribute("vertices").setValue(vertices);
        }
        
        // points
        vertices = [];
        polys = pointPolys[surfIndex];
        numPolys = polys.length;
        
        for (var polyIndex = 0; polyIndex < numPolys; polyIndex++)
        {
            var poly = layer.pols[polyIndex];
            
            var point = layer.pnts[poly[0]];
            surfacePnts[poly[0]] = point;
            
            vertices.push(point.x);
            vertices.push(point.y);
            vertices.push(point.z);
                
        }
        
        if (vertices.length)
        {
            var pointList = factory.create("PointList");

            model.addGeometry(pointList, null, surfaces[surfIndex]);
            
            pointList.getAttribute("vertices").setValue(vertices);
        }
        
        // set surface's layer vertices to surface
        var surfaceVertices = [];
        for (var surfacePnt in surfacePnts)
        {
            surfaceVertices.push(surfacePnts[surfacePnt].x);
            surfaceVertices.push(surfacePnts[surfacePnt].y);
            surfaceVertices.push(surfacePnts[surfacePnt].z);
        }
        surfaces[surfIndex].getAttribute("vertices").setValue(surfaceVertices);
    }

    // calculate smooth normals for tris
    var smoothNormals = [];
    for (var surfIndex = 0; surfIndex < surfaces.length; surfIndex++)
    {
        if (!triLists[surfIndex]) continue;

        var surface = data.getSurface(data.tags[surfIndex]);
        if (!surface) continue;
        
        var smoothingAngle = surface.smoothingAngle;
        if (smoothingAngle <= 0) continue;

        var cosSmoothingAngle = Math.cos(smoothingAngle);

        smoothNormals.length = vertexNormals[surfIndex].length;
        for (var i = 0; i < smoothNormals.length; i++)
        {
            smoothNormals[i] = new Vector3D();
        }

        // for each vertex normal...
        for (var vn = 0; vn < vertexNormals[surfIndex].length; vn++)
        {
            var vertexIndex = vertexNormals[surfIndex][vn].first;
            var vertexNormal = vertexNormals[surfIndex][vn].second;

            // for each polygon normal...
            for (var vpn = 0; vpn < vertexPolyNormals[vertexIndex].length; vpn++)
            {
                var polyNormal = vertexPolyNormals[vertexIndex][vpn];
                var angle = cosineAngleBetween(vertexNormal, polyNormal);
                if (Math.acos(angle) <= smoothingAngle)
                {
                    smoothNormals[vn].x += polyNormal.x;
                    smoothNormals[vn].y += polyNormal.y;
                    smoothNormals[vn].z += polyNormal.z;
                }
            }

            smoothNormals[vn].normalize();
        }

        // arrange smooth normals in array
        var smoothedNormals = [];
        for (var i = 0; i < smoothNormals.length; i++)
        {
            smoothedNormals.push(smoothNormals[i].x);
            smoothedNormals.push(smoothNormals[i].y);
            smoothedNormals.push(smoothNormals[i].z);
        }
        smoothNormals.length = 0;

        triLists[surfIndex].getAttribute("normals").setValue(smoothedNormals);
    }

    // load textures
    for (var surfIndex = 0; surfIndex < surfaces.length; surfIndex++)
    {
        var surfaceData = data.getSurface(surfaces[surfIndex].getAttribute("name").getValueDirect().join(""));
        if (surfaceData)
        {
            var textures = this.loadTextures(data, layer, surfaceData, surfaces[surfIndex]);

            // calculate texture coordinates
            for (var i = 0; i < textures.length; i++)
            {
                var uvCoords = this.calculateTextureCoords(data, layer, textures[i].second, triVertices[surfIndex],
                                                       triPolyNormals[surfIndex], vertexOrder[surfIndex],
                                                       polyOrder[surfIndex]);
                if (uvCoords)
                {
                    triLists[surfIndex].getUVCoords(textures[i].first).setValueDirect(uvCoords);
                }
            }
        }
    }

    // set layer vertices to model
    var layerVertices = new Array(layer.pnts.length * 3);
    for (var layerVertex = 0; layerVertex < layer.pnts.length; layerVertex++)
    {
        layerVertices[layerVertex * 3] = layer.pnts[layerVertex].x;
        layerVertices[layerVertex * 3 + 1] = layer.pnts[layerVertex].y;
        layerVertices[layerVertex * 3 + 2] = layer.pnts[layerVertex].z;
    }
    model.getAttribute("vertices").setValue(layerVertices);
    
    // TODO: index vertices if requested
}

LWObjectBuilder.prototype.allocateSurface = function(data, layer, surfaceNumber)
{
     var factory = this.registry.find("AttributeFactory");
     surface = factory.create("Surface");
     
     var name = data.tags[surfaceNumber];
     surface.getAttribute("name").setValueDirect(name);
     
     this.describeSurface(data.getSurface(name), surface);
     
     return surface;
}

LWObjectBuilder.prototype.describeSurface = function(data, surface)
{
    // TEMPTEST
    if (!data) return;
    
    // color
    var values = [];
    values.push(data.color.x);
    values.push(data.color.y);
    values.push(data.color.z);
    values.push(1);
    surface.getAttribute("color").setValue(values);
    
    // ambient level (use diffuse since ambient level is not specified
    surface.getAttribute("ambientLevel").setValueDirect(data.diffuseLevel);
    
    // diffuse level
    surface.getAttribute("diffuseLevel").setValueDirect(data.diffuseLevel);
    
    // specular level
    surface.getAttribute("specularLevel").setValueDirect(data.specularLevel);
    
    // emissive level
    surface.getAttribute("emissiveLevel").setValueDirect(data.luminosityLevel);
    
    // glossiness
    surface.getAttribute("glossiness").setValueDirect(data.glossiness);
    
    // opacity
    surface.getAttribute("opacity").setValueDirect(1 - data.transparencyLevel);
    
    // double-sidedness
    surface.getAttribute("doubleSided").setValueDirect(data.doubleSided ? true : false);
}

LWObjectBuilder.prototype.loadTextures = function(data, layer, surfaceData, surface)
{
    var textures = [];

    // arrange blocks into ordered lists indexed by channel
    var channelBlocks = [];
    for (var i = 0; i < surfaceData.blocks.length; i++)
    {
        var block = surfaceData.blocks[i];
        if (block.type != 'IMAP') continue;

        if (!channelBlocks[block.channel])
        {
            channelBlocks[block.channel] = []
        }
        channelBlocks[block.channel].push(block);
    }

    // allocate textures for supported channel types

    // color
    if (channelBlocks[eLWObjectTokens.COLR])
    {
        this.allocateTextures(eTextureType.Color, data, layer, channelBlocks[eLWObjectTokens.COLR], surface, textures);
    }

    // diffuse
    if (channelBlocks[eLWObjectTokens.DIFF])
    {
        this.allocateTextures(eTextureType.Diffuse, data, layer, channelBlocks[eLWObjectTokens.DIFF], surface, textures);
    }

    // luminosity
    if (channelBlocks[eLWObjectTokens.LUMI])
    {
        this.allocateTextures(eTextureType.Luminosity, data, layer, channelBlocks[eLWObjectTokens.LUMI], surface, textures);
    }

    // specular
    if (channelBlocks[eLWObjectTokens.SPEC])
    {
        this.allocateTextures(eTextureType.Specular, data, layer, channelBlocks[eLWObjectTokens.SPEC], surface, textures);
    }

    // transparency
    if (channelBlocks[eLWObjectTokens.TRAN])
    {
        this.allocateTextures(eTextureType.Transparency, data, layer, channelBlocks[eLWObjectTokens.TRAN], surface, textures);
    }

    return textures;
}

LWObjectBuilder.prototype.allocateTextures = function(type, data, layer, blocks, surface, textures)
{  
    // create a media texture object for each normal or additive texture layer; if subsequent
    // layer is alpha, add as texture alpha channel
    for (var i=0; i < blocks.length; i++)
    {
        var block = blocks[i];
        if (block.opacityType != 0 && 
            block.opacityType != 7)
            continue;
            
        var imageClip = data.clips[block.imageIndex];
        if (!imageClip)
            continue;
            
        var alphaClip = null;
        if (i+1 < blocks.length)
        {
            if (blocks[i+1].opacityType == 5)
            {
                alphaClip = data.clips[blocks[i+1].imageIndex];
            }    
        } 
        
        var widthWrap, heightWrap;
        switch (block.widthWrap)
        {
        case 0: widthWrap = eTextureWrap.None; break;
        case 1: widthWrap = eTextureWrap.Repeat; break; 
        case 2: widthWrap = eTextureWrap.Mirror; break;
        case 3: widthWrap = eTextureWrap.Clamp; break;
        } 
        switch (block.heightWrap)
        {
        case 0: heightWrap = eTextureWrap.None; break;
        case 1: heightWrap = eTextureWrap.Repeat; break; 
        case 2: heightWrap = eTextureWrap.Mirror; break;
        case 3: heightWrap = eTextureWrap.Clamp; break;
        }     
        
        var filename = imageClip.getFilename();
        
        // strip any local paths saved by the modeler
        var ndx = filename.lastIndexOf('/');
        
        filename = ndx === -1 ? filename : filename.substring(ndx+1);
         
        var clipFilename = data.contentDir + "images/" + filename;
        
        // setup negate image flag based upon whether or not the graphics card uses
        // inverted alpha values, and if this is a transparency, diffuse, luminosity,
        // or specularity texture
        var negateImage = block.negative ? true : false;
        if (this.invertAlpha && 
           (type == eTextureType.Transparency ||
            type == eTextureType.Diffuse ||
            type == eTextureType.Luminosity ||
            type == eTextureType.Specularity))
        {
            negateImage = !negateImage;
        }

        // setup negate alpha flag based upon existance of an alpha clip and 
        // whether or not the graphics card uses inverted alpha values
        var negateAlpha = false;
        if (alphaClip)
        {
            negateAlpha = blocks[i+1].negative ? true : false;
            if (this.invertAlpha)
            {
                negateAlpha = !negateAlpha;
            }
        }
        
        // TODO: check if texture with same attributes has already been created;
        // if not, or if an opacity envelope is being used, allocate new one
        var mediaTexture = null;
        
        var factory = this.registry.find("AttributeFactory");
        mediaTexture = factory.create("MediaTexture");
           
        mediaTexture.getAttribute("name").setValueDirect(""); // TODO
        mediaTexture.getAttribute("textureType").setValueDirect(type);
        mediaTexture.getAttribute("opacity").setValueDirect(block.opacity);
        mediaTexture.getAttribute("widthWrap").setValueDirect(widthWrap);
        mediaTexture.getAttribute("heightWrap").setValueDirect(heightWrap);
        mediaTexture.getAttribute("mipmappingEnabled").setValueDirect(false);
        mediaTexture.getAttribute("imageFilename").setValueDirect(clipFilename);
        mediaTexture.getAttribute("negateImage").setValueDirect(negateImage);
        mediaTexture.getAttribute("negateAlpha").setValueDirect(negateAlpha);
        if (alphaClip)
        {
            mediaTexture.getAttribute("alphaFilename").setValueDirect(data.contentDir + alphaClip.getFilename());
        }
        
        // TODO: if opacity is an envelope, create a KeyframeInterpolator and attach to texture opacity attr

        textures.push(new Pair(mediaTexture, block));
        surface.addTexture(mediaTexture);
    }       
}

LWObjectBuilder.prototype.calculateTextureCoords = function(data, layer, blockData, vertices, polyNormals,
                                                            vertIndices, polyIndices)
{
    if (!data ||
        !layer ||
        !blockData ||
        !vertices ||
        !polyNormals ||
        !vertIndices ||
        !polyIndices)
    {
        return null;
    }

    var uvCoords = []
    var numVertices = vertices.length / 3;

    switch (blockData.projMode)
    {
        case 0: // planar
        case 1: // cylindrical
        case 2: // spherical
            {
                var i, vertex, uv;
                for (i = 0, vertex = 0, uv = 0; i < numVertices; i++, vertex += 3, uv += 2)
                {
                    uv = this.mapXYZtoUV(vertices[vertex], vertices[vertex + 1], vertices[vertex + 2],
                                     blockData.center, blockData.size, blockData.projMode, blockData.axis,
                                     blockData.widthWrapAmt, blockData.heightWrapAmt);
                    uvCoords.push(uv.u);
                    uvCoords.push(uv.v);
                }
            }
            break;

        case 3: // cubic
            {
                var i, vertex, uv;
                for (i = 0, vertex = 0, uv = 0; i < numVertices; i++, vertex += 3, uv += 2)
                {
                    polyNormal = polyNormals[i];

                    if (Math.acos(cosineAngleBetween(polyNormal, new Vector3D(1, 0, 0))) <= QUARTERPI ||
                    Math.acos(cosineAngleBetween(polyNormal, new Vector3D(-1, 0, 0))) <= QUARTERPI)
                    {
                        axis = 0; // x
                    }
                    else if (Math.acos(cosineAngleBetween(polyNormal, new Vector3D(0, 1, 0))) <= QUARTERPI ||
                         Math.acos(cosineAngleBetween(polyNormal, new Vector3D(0, -1, 0))) <= QUARTERPI)
                    {
                        axis = 1; // y
                    }
                    else
                    {
                        axis = 2; // z
                    }

                    uv = this.mapXYZtoUV(vertices[vertex], vertices[vertex + 1], vertices[vertex + 2],
                                     blockData.center, blockData.size, 0, axis,
                                     blockData.widthWrapAmt, blockData.heightWrapAmt);
                    uvCoords.push(uv.u);
                    uvCoords.push(uv.v);
                }
            }
            break;

        case 5: // UV
            {
                var vmap = layer.getVmap('TXUV', blockData.uvMapName);
                //if (vmap) quick_sort(vmap, LWObjectBuilder_CompareVmapEntries);

                var vmad = layer.getVmad('TXUV', blockData.uvMapName);
                //if (vmad) quick_sort(vmad, LWObjectBuilder_CompareVmadEntries);

                var i, vertIndex, polyIndex, uv, uvSet;
                for (i = 0, uv = 0; i < numVertices; i++, uv += 2)
                {
                    vertIndex = vertIndices[i];
                    polyIndex = polyIndices[i];
                    uvSet = false;

                    // check for vmad entry (overrides vmap entry)
                    if (vmad && vmad.length)
                    {
                        for (var vmad_entries = 0; vmad_entries < vmad.length; vmad_entries++)
                        {
                            if (vmad[vmad_entries].poly > polyIndex)
                            {
                                break;
                            }

                            if (vmad[vmad_entries].poly == polyIndex)
                            {
                                if (vmad[vmad_entries].vertex == vertIndex)
                                {
                                    uvCoords[uv] = vmad[vmad_entries].u;
                                    uvCoords[uv + 1] = vmad[vmad_entries].v;
                                    uvSet = true;
                                    break;
                                }
                            }
                        }

                        if (uvSet)
                        {
                            // don't retrieve from vmap
                            continue;
                        }
                    }

                    // check for vmap entry
                    if (vmap && vmap.length)
                    {
                        for (var vmap_entries = 0; vmap_entries < vmap.length; vmap_entries++)
                        {
                            if (vmap[vmap_entries].vertex > vertIndex)
                            {
                                break;
                            }

                            if (vmap[vmap_entries].vertex == vertIndex)
                            {
                                uvCoords[uv] = vmap[vmap_entries].u;
                                uvCoords[uv + 1] = vmap[vmap_entries].v;
                                uvSet = true;
                                break;
                            }
                        }
                    }

                    if (!uvSet)
                    {
                        uvCoords[uv] = 0;
                        uvCoords[uv + 1] = 0;
                    }
                }
            }
            break;

        default:
            {
                //alert(blockData.projMode);
            }
            break;
    }

    return uvCoords;
}

LWObjectBuilder.prototype.mapXYZtoUV = function(x, y, z, textureCenter, textureSize, projMode, axis, widthWrapAmt, heightWrapAmt)
{
    var lon, lat;
    var integerPart;

    var u = 0;
    var v = 0;

    switch(projMode)
    {
    case 0: // planar
        switch(axis)
        {
        case 0: // x
            u = (z - textureCenter.z) / textureSize.z + 0.5;
            v = (y - textureCenter.y) / textureSize.y + 0.5;
            break;

        case 1: // y
            u = (x - textureCenter.x) / textureSize.x + 0.5;
            v = (z - textureCenter.z) / textureSize.z + 0.5;
            break;

        case 2: // z
        default:
            u = (x - textureCenter.x) / textureSize.x + 0.5;
            v = (y - textureCenter.y) / textureSize.y + 0.5;
            break;
        }
        break;

   case 1: // cylindrical
        x -= textureCenter.x;
        y -= textureCenter.y;
        z -= textureCenter.z;
        
        switch(axis)
        {
        case 0: // x
            lon = XYZtoH(z, x, y);
            u = lon / (TWOPI * widthWrapAmt);
            v = x / textureSize.x + 0.5;
            break;

        case 1: // y
            lon = XYZtoH(x, y, z);
            u = lon / (TWOPI * widthWrapAmt);
            v = y / textureSize.y + 0.5;
            break;

        case 2: // z
        default:
            lon = XYZtoH(-x, z, -y);
            u = lon / (TWOPI * widthWrapAmt);
            v = -z / textureSize.z + 0.5;
            break;
        }

        // clamp u coordinate to range [0, 1)
        u = modf(u).fractionalPart;
        if (u < 0) u += 1;
        break;

   case 2: // spherical
        x -= textureCenter.x;
        y -= textureCenter.y;
        z -= textureCenter.z;

        switch (axis)
        {
        case 0: // x
            var hp = XYZtoHP(z, x, -y);
            lon = hp.heading;
            lat = hp.pitch;
            break;

        case 1: // y
            var hp = XYZtoHP(-x, y, z);
            lon = hp.heading;
            lat = hp.pitch;
            break;

        case 2: // z
        default:
            var hp = XYZtoHP(-x, z, -y);
            lon = hp.heading;
            lat = hp.pitch;
            break;
        }

        u = modf(1 - (lon / TWOPI * widthWrapAmt)).fractionalPart;
        v = 1 - modf(0.5 - (lat / Math.PI * heightWrapAmt)).fractionalPart;

        break;
    }
 
    return { u: u, v: v };   
}

function LWObjectBuilder_ObjectHandler(data, builder)
{
    builder.allocateModel(data);
}

function LWObjectBuilder_CompareVmapEntries(elem1, elem2)
{
    if (elem1.vertex < elem2.vertex) return -1;
    if (elem1.vertex > elem2.vertex) return 1;
    return 0;
}

function LWObjectBuilder_CompareVmadEntries(elem1, elem2)
{
    if (elem1.poly < elem2.poly) return -1;
    if (elem1.poly > elem2.poly) return 1;
    return 0;
}
LWSceneHandler.prototype = new ContentHandler();
LWSceneHandler.prototype.constructor = LWSceneHandler;

function LWSceneHandler()
{
    ContentHandler.call(this);
    this.className = "LWSceneHandler";
    
    this.tokenHandlers = [];
    this.tokenHandlersData = [];
}

LWSceneHandler.prototype.addTokenHandler = function(handler, data)
{
    this.tokenHandlers.push(handler);
    this.tokenHandlersData.push(data);
}

LWSceneHandler.prototype.parseFileStream = function(url)
{
    var filename = formFullPath(url, this.contentDirectory.getValueDirect().join(""));
    var filestream = loadTextResource(filename);
    if (filestream == null)
    {
        return -2;
    }
    
    var parser = new TextParser(filestream);
    
    var tokens;
    while (tokens = parser.readLineTokens())
    {
        if (tokens.length == 0) continue;
        
        // check for string
        if (tokens[0].indexOf("\"") != -1)
        {
            tokens.push(tokens[0].substring(1, tokens[0].length-1));
            tokens[0] = "String";    
        }
        
        // pass tokens to consumer(s)
        for (var i=0; i < this.tokenHandlers.length; i++)
        {
            this.tokenHandlers[i](tokens, this.tokenHandlersData[i]);    
        }    
    }
    
    // pass EOF to consumer(s)
    for (var i=0; i < this.tokenHandlers.length; i++)
    {
        this.tokenHandlers[i](new Array("EOF"), this.tokenHandlersData[i]);    
    }   
}
function TLWSCSceneData()
{
    var fps = 0;
    var backgroundColorR = 0;
    var backgroundColorG = 0;
    var backgroundColorB = 0;
    var backgroundImageFilename = "";
    var foregroundImageFilename = "";
    var foregroundAlphaFilename = "";
    var fadeForeground = false;
    var gridSize = 0;
    var nearClipDistance = 0.25;
}

function TLWSCv3LightDesc()
{
    this.name = "";
    this.type = 0;
    this.colorR = 0;
    this.colorG = 0;
    this.colorB = 0;
    this.intensity = 0;
    this.range = 0;
    this.coneAngle = 0; // for spot lights
    this.edgeAngle = 0; // for spot lights
    this.motion = null;
    this.parentItem = 0;
}

LWSceneBuilder.prototype = new ContentBuilder();
LWSceneBuilder.prototype.constructor = LWSceneBuilder;

function LWSceneBuilder()
{
    ContentBuilder.call(this);
    this.className = "LWSceneBuilder";

    this.root = null;
    this.sgRoot = null;
    this.evaluatorsGroup = null;
    this.camerasSelector = null;
    this.lightsGroup = null;
    this.modelsGroup = null;
    this.renderDirective = null;
    this.boneFalloffType = eBoneFalloffType.InverseDistance;
    this.parsingBgImage = false;
    this.parsingFgImage = false;
    this.parsingFgAlphaImage = false;
    this.imagePath = "";
    this.currElement = null;
    this.currChannel = 0;   // motions
    this.sceneData = new TLWSCSceneData();
    this.ambientLightDesc = new TLWSCv3LightDesc();
    this.globalLightDesc = new TLWSCv3LightDesc();
    this.lightDescs = [];
    this.parentItems = [];
    this.bones = [];
    this.objectBones = [];
    
    this.indexGeometry = new BooleanAttr(true);
    
    this.registerAttribute(this.indexGeometry, "indexGeometry");
    
    this.ambientLightDesc.colorR = 1;
    this.ambientLightDesc.colorG = 1;
    this.ambientLightDesc.colorB = 1;
    this.ambientLightDesc.intensity = 0.05;
    this.globalLightDesc.intensity = 1;
}

LWSceneBuilder.prototype.visitHandler = function(handler)
{
    handler.addTokenHandler(LWSceneBuilder_TokenHandler, this);
}

LWSceneBuilder.prototype.finalize = function()
{
}

LWSceneBuilder.prototype.matchesType = function(type)
{
    return (type == "lws" ||
            type == "mot");
}

LWSceneBuilder.prototype.handleToken = function(token, params)
{
    switch (token)
    {
        case "LWSC":
            this.handleSceneToken(params);
            break;
            
        case "LWMO":
            this.handleMotionToken(params);
            break;
            
        default:
            this.handleCommandToken(token, params);
            break;
    }
}

LWSceneBuilder.prototype.handleSceneToken = function(params)
{
    this.allocateSceneGraph();
}

LWSceneBuilder.prototype.handleMotionToken = function(params)
{

}

LWSceneBuilder.prototype.handleCommandToken = function(token, params)
{
    this.allocateSceneElement(token, params);
}

LWSceneBuilder.prototype.allocateSceneGraph = function()
{
    // root
    this.root = this.factory.create("Isolator");
    this.root.name.setValueDirect("Root");
    this.root.isolateLights.setValueDirect(true);
    this.registry.rootPtr.setValueDirect(this.root);
    
    // evaluators group
    this.evaluatorsGroup = this.factory.create("Group");
    this.evaluatorsGroup.name.setValueDirect("Evaluators");
    this.root.addChild(this.evaluatorsGroup);
    
    // cameras group
    this.camerasSelector = this.factory.create("Selector");
    this.camerasSelector.name.setValueDirect("Cameras");
    this.camerasSelector.selectee.setValueDirect(0);
    this.root.addChild(this.camerasSelector);
    
    // lights group
    this.lightsGroup = this.factory.create("Group");
    this.lightsGroup.name.setValueDirect("Lights");
    this.root.addChild(this.lightsGroup);
    
    // models group
    this.modelsGroup = this.factory.create("Group");
    this.modelsGroup.name.setValueDirect("Models");
    this.root.addChild(this.modelsGroup);
    
    // render directive
    this.renderDirective = this.factory.create("RenderDirective");
    this.renderDirective.name.setValueDirect("RenderDirective");
    this.renderDirective.rootNode.setValueDirect(this.root);
   
    return true;
}

LWSceneBuilder.prototype.allocateSceneElement = function(token, params)
{
    switch (token)
    {
        case "LoadObjectLayer":
        {
            var model = this.factory.create("Model");            
            this.currElement = model;
            
            // layer
            var layer = params[0];
            model.layer.setValueDirect(layer);
            
            // combine tokens into one string (if filename has
            // spaces, multiple tokens will be present)
            var filename = params.slice(1).join();
            filename = addSlashAfterDriveSpecifier(filename);
            model.url.setValueDirect(filename);
            
            // don't allow disableOnDissolve, because this breaks label positioning when targeted to null-object models
            model.disableOnDissolve.setValueDirect(false);
            
            this.models.push(model);
            this.modelsGroup.addChild(model);
            
            // load model
            finalizeModel(model, this.factory);
            
            this.objectBones.push(new Array());
        }
        break;
        
        case "ObjectMotion":
        {
            var kfi = this.factory.create("KeyframeInterpolator");        
            kfi.name.setValueDirect("Motion");
            
            this.evaluators.push(kfi);
            this.evaluatorsGroup.addChild(kfi);
        }
        break;
        
        case "NumChannels":
        {            
            if (this.evaluators.length > 0)
            {
                var kfi = this.evaluators[this.evaluators.length-1];                
                var numChannels = parseInt(params[0]);
                
                this.initializeKeyframeInterpolator(kfi, numChannels);
                
                var element = this.currElement || this.registry.find(kfi.getAttribute("target").getValueDirect().join(""));
                if (element)
                {
                    switch (numChannels)
                    {
                        case 1:  this.attachDissolveInterpolator(kfi, element); break;
                        default: this.attachKeyframeInterpolator(kfi, element); break;
                    }
                }
            }
        }
        break;
        
        case "Channel":
        {
            this.currChannel = parseInt(params[0]);
        }
        break;
        
        case "Key":
        {
            if (this.evaluators.length > 0)
            {
                var kfi = this.evaluators[this.evaluators.length-1];
                var keyframes = kfi.channels.getAt(this.currChannel);
                var keyframe = new KeyframeAttr();
                
                for (var i=0; i < params.length; i++)
                {
                    switch (i)
                    {
                        case 0: // value
                        {
                            var f = parseFloat(params[i]);
                            
                            // if channel 3, 4, or 5, convert value to degrees
                            if (this.currChannel == 3 || this.currChannel == 4 || this.currChannel == 5)
                            {
                                f = toDegrees(f);
                            }
                            
                            keyframe.value.setValueDirect(f);
                        }
                        break;
                        
                        case 1: // time
                        {
                            keyframe.time.setValueDirect(parseFloat(params[i]));
                        }
                        break;
                        
                        case 2:
                        {
                            var shape = parseInt(params[i]);
                            switch (shape)
                            {
                                case 0: keyframe.shape.setValueDirect(eKeyframeShape.TCB); break;
                                case 1: keyframe.shape.setValueDirect(eKeyframeShape.Hermite); break;
                                case 2: keyframe.shape.setValueDirect(eKeyframeShape.Bezier1D); break;
                                case 3: keyframe.shape.setValueDirect(eKeyframeShape.Linear); break;
                                case 4: keyframe.shape.setValueDirect(eKeyframeShape.Stepped); break;
                                case 5: keyframe.shape.setValueDirect(eKeyframeShape.Bezier2D); break;
                                default: keyframe.shape.setValueDirect(eKeyframeShape.Linear); break;
                            }
                        }
                        break;
                        
                        case 3:
                        case 4:
                        case 5:
                        case 6:
                        case 7:
                        case 8:
                            keyframe.params.getAt(i-3).setValueDirect(parseFloat(params[i]));
                            break;
                            
                        default:
                            break;
                    }   
                }
                
                keyframes.push_back(keyframe);
            }
        }
        break;
        
        case "Behaviors":
        {
            if (this.evaluators.length > 0)
            {
                var kfi = this.evaluators[this.evaluators.length-1];
                
                kfi.preBehaviors.getAt(this.currChannel).setValueDirect(parseInt(params[0]));
                kfi.postBehaviors.getAt(this.currChannel).setValueDirect(parseInt(params[1]));
            }       
        }
        break;
        
        case "ObjectDissolve":
        {
            if (params[0] == "(envelope)")
            {
                var kfi = this.factory.create("KeyframeInterpolator");
                kfi.name.setValueDirect("Dissolve");
                
                this.initializeKeyframeInterpolator(kfi, 1);
                this.attachDissolveInterpolator(kfi, this.models[this.models.length-1]);
                
                this.evaluators.push(kfi);
                this.evaluatorsGroup.addChild(kfi);
            }
            else // non-envelope dissolve
            {
                // set to last loaded model
                if (this.models.length > 0)
                {
                    this.models[this.models.length-1].dissolve.setValueDirect(parseFloat(params[0]));
                }
            }
        }
        break;
        
        case "AddCamera":
        {
            var camera = this.factory.create("PerspectiveCamera");
            this.currElement = camera;
            
            this.cameras.push(camera);
            this.camerasSelector.addChild(camera);
        }
        break;
        
        case "CameraName":
        {
            // set to last loaded camera
            if (this.cameras.length > 0)
            {
                this.cameras[this.cameras.length-1].name.setValueDirect(params[0]);
            }
        }
        break;
        
        case "CameraMotion":
        {
            var kfi = this.factory.create("KeyframeInterpolator");
            kfi.name.setValueDirect("Motion");
            
            this.evaluators.push(kfi);
            this.evaluatorsGroup.addChild(kfi);
        }
        break;
        
        case "ZoomFactor":
        {
            // set to last loaded camera
            if (this.cameras.length > 0)
            {
                this.cameras[this.cameras.length-1].zoom.setValueDirect(parseFloat(params[0]));
            }
        }
        break;
        
        case "AmbientColor":
        {
            this.ambientLightDesc.colorR = parseFloat(params[0]);
            this.ambientLightDesc.colorG = parseFloat(params[1]); 
            this.ambientLightDesc.colorB = parseFloat(params[2]); 
        }
        break;
        
        case "AmbientIntensity":
        {
            var globalIllumination = this.factory.create("GlobalIllumination");
            globalIllumination.name.setValueDirect("GLight");
            
            var intensity = parseFloat(params[0]);
            
            globalIllumination.ambient.setValueDirect(this.ambientLightDesc.colorR * intensity,
                                                      this.ambientLightDesc.colorG * intensity,
                                                      this.ambientLightDesc.colorB * intensity,
                                                      1);
                                                      
            this.lightsGroup.addChild(globalIllumination);
        }
        break;
        
        case "GlobalLightIntensity":
        {
            this.globalLightDesc.intensity = parseFloat(params[0]);
        }
        break;
        
        case "AddLight":
        {
            var lightDesc = new TLWSCv3LightDesc();
            
            // set default range (if unspecified in scene file)
            lightDesc.range = Math.sqrt(FLT_MAX);
            
            this.lightDescs.push(lightDesc);
            
            this.currElement = null;
        }
        break;
        
        case "LightName":
        {
            if (this.lightDescs.length > 0)
            {
                this.lightDescs[this.lightDescs.length-1].name = params[0];
            }
        }
        break;
        
        case "LightMotion":
        {
            var kfi = this.factory.create("KeyframeInterpolator");
            kfi.name.setValueDirect("Motion");
            
            // add to last light record
            if (this.lightDescs.length > 0)
            {
                this.lightDescs[this.lightDescs.length-1].motion = kfi;
            }
                
            this.evaluators.push(kfi);
            this.evaluatorsGroup.addChild(kfi);
        }
        break;
        
        case "LightColor":
        {
            // add to last light record
            if (this.lightDescs.length > 0)
            {
                this.lightDescs[this.lightDescs.length-1].colorR = parseFloat(params[0]);
                this.lightDescs[this.lightDescs.length-1].colorG = parseFloat(params[1]);
                this.lightDescs[this.lightDescs.length-1].colorB = parseFloat(params[2]);
            }
        }
        break;
        
        case "LightIntensity":
        {
            // add to last light record
            if (this.lightDescs.length > 0)
            {
                this.lightDescs[this.lightDescs.length-1].intensity = parseFloat(params[0]);
            }
        }
        break;
        
        case "LightRange":
        {
            // add to last light record
            if (this.lightDescs.length > 0)
            {
                this.lightDescs[this.lightDescs.length-1].range = parseFloat(params[0]);
            }
        }
        break;
        
        case "LightConeAngle":
        {
            // add to last light record
            if (this.lightDescs.length > 0)
            {
                this.lightDescs[this.lightDescs.length-1].coneAngle = parseFloat(params[0]);
            }
        }
        break;
        
        case "LightEdgeAngle":
        {
            // add to last light record
            if (this.lightDescs.length > 0)
            {
                this.lightDescs[this.lightDescs.length-1].edgeAngle = parseFloat(params[0]);
            }
        }
        break;
        
        case "LightType":
        {
            // add to last light record
            if (this.lightDescs.length > 0)
            {
                this.lightDescs[this.lightDescs.length-1].type = parseInt(params[0]);
            }
        }
        break;
        
        case "AddNullObject":
        {
            var nullObject = this.factory.create("NullObject");
            this.currElement = nullObject;
            
            this.models.push(nullObject);
            this.modelsGroup.addChild(nullObject);
            
            if (params[0])
            {
                nullObject.name.setValueDirect(params[0]);
            }
        }
        break;
        
        case "PivotPosition":
        {
            if (this.currElement)
            {
                this.currElement.pivot.setValueDirect(parseFloat(params[0]), parseFloat(params[1]), parseFloat(params[2]));
            }
        }
        break;
        
        case "BoneFalloffType":
        {
            this.boneFalloffType = parseInt(params[0]);
        }
        break;
        
        case "AddBone":
        {
            var bone = this.factory.create("Bone");
            bone.falloffType.setValueDirect(this.boneFalloffType);
            this.currElement = bone;
            this.bones.push(bone);
            this.objectBones[this.objectBones.length-1].push(bone);
            
        }
        break;
        
        case "BoneName":
        {
            var bone = this.bones.length > 0 ? this.bones[this.bones.length-1] : null;
            if (bone)
            {
                // check if this bone name has already been specified; if it has, append " (n)" to the
                // bone name, where n is the number of occurrences of this bone name
                var numOccurrences = 0;
                var s = "";
                for (var i=0; i < this.bones.length; i++)
                {
                    if (params[0] == this.bones[i].name.getValueDirect().join(""))
                    {
                        numOccurrences++;
                    }
                }
                if (numOccurrences > 0)
                {
                    params[0] += "(" + numOccurrences+1 + ")";
                }

                bone.name.setValueDirect(params[0]);
            }    
        }
        break;
        
        case "BoneRestPosition":
        {
            var bone = this.bones.length > 0 ? this.bones[this.bones.length-1] : null;
            if (bone)
            {
                bone.restPosition.setValueDirect(parseFloat(params[0]), parseFloat(params[1]), parseFloat(params[2]));
            }
        }
        break;
        
        case "BoneRestDirection":
        {
            var bone = this.bones.length > 0 ? this.bones[this.bones.length-1] : null;
            if (bone)
            {
                bone.restRotation.setValueDirect(parseFloat(params[1]), parseFloat(params[0]), parseFloat(params[2]));
            }
        }
        break;
        
        case "BoneRestLength":
        {
            var bone = this.bones.length > 0 ? this.bones[this.bones.length-1] : null;
            if (bone)
            {
                bone.restLength.setValueDirect(parseFloat(params[0]));
            }
        }
        break;
        
        case "BoneStrength":
        {
            var bone = this.bones.length > 0 ? this.bones[this.bones.length-1] : null;
            if (bone)
            {
                bone.strength.setValueDirect(parseFloat(params[0]));
            }
        }
        break;
        
        case "BoneScaleBoneStrength":
        {
            var bone = this.bones.length > 0 ? this.bones[this.bones.length-1] : null;
            if (bone)
            {
                bone.scaleBoneStrength.setValueDirect(parseFloat(params[0]));
            }
        }
        break;
        
        case "BoneMotion":
        {
            var kfi = this.factory.create("KeyframeInterpolator");
            kfi.name.setValueDirect("Motion");
            
            // add to last light record
            if (this.bones.length > 0)
            {
                this.bones[this.bones.length-1].motion = kfi;
            }
                
            this.evaluators.push(kfi);
            this.evaluatorsGroup.addChild(kfi);
        }
        break;
        
        case "ParentItem":
        {
            if (this.currElement)
            {
                this.parentItems.push(new Pair(this.currElement, params[0]));
            }
            else // !this.currElement -- current element is a light (this.currElement is NULL because 
                 // light can't be allocated until later when type is known)
            {
                if (this.lightDescs.length > 0)
                {
                    this.lightDescs[this.lightDescs.length-1].parentItem = params[0];
                }
            }
        }
        
        case "GridSize":
        {
            this.sceneData.gridSize = parseFloat(params[0]);
        }
        
        case "NearClipDistance":
        {
            // set to last camera
            if (this.cameras.length > 0)
            {
                this.cameras[this.cameras.length-1].nearDistance.setValueDirect(parseFloat(params[0]));
            }
        }
        break;
        
        case "FramesPerSecond":
        {
            this.sceneData.fps = parseFloat(params[0]);
        }
        break;
        
        case "BackdropColor":
        {
            this.sceneData.backgroundColorR = parseFloat(params[0]);
            this.sceneData.backgroundColorG = parseFloat(params[1]);
            this.sceneData.backgroundColorB = parseFloat(params[2]);
        }
        break;
        
        case "}":
        {
            this.currChannel = 0;
            
            if (this.imagePath != "")
            {
                if (this.parsingBgImage)
                {
                    this.renderDirective.backgroundImageFilename.setValueDirect(this.imagePath);
                    this.parsingBgImage = false;
                }
                else if (this.parsingFgImage)
                {
                    this.renderDirective.foregroundImageFilename.setValueDirect(this.imagePath);
                    this.parsingFgImage = false;
                }
                else if (this.parsingFgAlphaImage)
                {
                    this.renderDirective.foregroundAlphaImageFilename.setValueDirect(this.imagePath);
                    this.parsingFgAlphaImage = false;
                }
                
                this.imagePath = "";
            }
        }
        break;
        
        case "String":
        {
            if (this.parsingBgImage ||
                this.parsingFgImage ||
                this.parsingFgAlphaImage)
            {
                this.imagePath = params[0];
            }
        }
        break;
        
        case "BGImage":
        {
            this.parsingBgImage = true;
        }
        break;
        
        case "FGImage":
        {
            this.parsingFgImage = true;
        }
        break;
        
        case "FGAlphaImage":
        {
            this.parsingFgAlphaImage = true;
        }
        break;
        
        case "EOF":
        {
            this.finalize();
        }
        break;
        
        default:
        {
            // unsupported tag
        }
        break;
    }
}

LWSceneBuilder.prototype.finalize = function()
{
    // place models into name bins
    var nameBins = [];
    for (var i=0; i < this.models.length; i++)
    {
        var name = this.models[i].name.getValueDirect().join("");
        if (nameBins[name] == undefined)
        {
            nameBins[name] = new Array();
        }
        
        nameBins[name].push(this.models[i]);
    }
    
    // any name bins that contain more than 1 entry are duplicates and need to be renamed with "(n)" appended
    for (var name in nameBins)
    {
        if (nameBins[name].length > 1)
        {
            for (var i=0; i < nameBins[name].length; i++)
            {
                nameBins[name][i].name.setValueDirect(name + " (" + (i+1) + ")")
            }
        }
    }
    
    // set camera(s) clip planes
    var nearDistance, farDistance;
    for (var i=0; i < this.cameras.length; i++)
    {
        var zoom = this.cameras[i].zoom.getValueDirect();

        nearDistance = this.sceneData.gridSize * 0.1 * zoom;
        farDistance = nearDistance * 100000;
        
        this.cameras[i].nearDistance.setValueDirect(nearDistance);
        this.cameras[i].farDistance.setValueDirect(farDistance);
    }

    // allocate lights
    for (var i=0; i < this.lightDescs.length; i++)
    {
        var light = this.allocateLight(this.lightDescs[i]);
        
        // if parented, add entry in parent items map
        if (this.lightDescs[i].parentItem)
        {
            this.parentItems.push(new Pair(light, this.lightDescs[i].parentItem));
        }
        
        this.lights.push(light);
        this.lightsGroup.addChild(light);
    }
    
    // assign parents
    for (var i=0; i < this.parentItems.length; i++)
    {
        this.setParentItem(this.parentItems[i].first, this.parentItems[i].second);    
    }
    
    // setup motion controllers
    // TODO
    
    // create bone effectors
    for (var i=0; i < this.models.length; i++)
    {
        var model = this.models[i];
        if (model.bones && 
            model.bones.length > 0)
        {
            this.attachBoneEffectors(model, model.bones);
        }
    }

    // create morph effectors
    // TODO
    
    // backdrop color
    
    // register evaluators; evaluate evaluators once so that their initial values 
    // are set to their targets (e.g., models that depend upon KFI's for position)
    for (var i=0; i < this.evaluators.length; i++)
    {
        this.evaluators[i].evaluate();
    }
}

LWSceneBuilder.prototype.allocateLight = function(lightDesc)
{
    var light = null;
    switch (lightDesc.type)
    {
        case 0: // distance (directional)
        case 3: // linear (use directional to approximate)
            light = this.factory.create("DirectionalLight");
            break;
            
        case 1: // point
            light = this.factory.create("PointLight");
            break;
            
        case 2: // spot
        case 4: // area (use spot to approximate)
            light = this.factory.create("SpotLight");
            break;
    }
    if (!light) return null;
    
    // attach motion object
    if (lightDesc.motion)
    {
        this.attachKeyframeInterpolator(lightDesc.motion, light);
    }
    
    // set common attributes
    
    // name
    light.name.setValueDirect(lightDesc.name);
    
    // light color
    var red = lightDesc.colorR * lightDesc.intensity * this.globalLightDesc.intensity;
    var green = lightDesc.colorR * lightDesc.intensity * this.globalLightDesc.intensity;
    var blue = lightDesc.colorR * lightDesc.intensity * this.globalLightDesc.intensity;
    var alpha = 1;
    
    // ambient color
    light.ambient.setValueDirect(this.ambientLightDesc.colorR * this.ambientLightDesc.intensity,
                                 this.ambientLightDesc.colorG * this.ambientLightDesc.intensity,
                                 this.ambientLightDesc.colorB * this.ambientLightDesc.intensity,
                                 1);
    
    // diffuse color
    light.diffuse.setValueDirect(red, green, blue, alpha);
    
    // specular color
    light.specular.setValueDirect(red, green, blue, alpha);
    
    // set type-specific attributes
    switch (lightDesc.type)
    {
        case 0: // distance (directional)
        case 3: // linear (use directional to approximate)
            break;
            
        case 1: // point
            // range
            light.range.setValueDirect(lightDesc.range);
            break;
            
        case 2: // spot
        case 4: // area (use spot to approximate)
            // range
            light.range.setValueDirect(lightDesc.range);
            // inner cone degrees
            light.innerConeDegrees.setValueDirect(lightDesc.coneAngle);
            // outer cone degrees
            light.outerConeDegrees.setValueDirect(lightDesc.edgeAngle);
            // cone falloff
            light.coneFalloff.setValueDirect(1);
            break;
    }
    
    return light;
}

LWSceneBuilder.prototype.initializeKeyframeInterpolator = function(kfi, numChannels)
{
    kfi.setNumChannels(numChannels);
}

LWSceneBuilder.prototype.attachKeyframeInterpolator = function(kfi, target)
{
    if (!kfi || !target) return;
    
    var numChannels = kfi.getAttribute("channels").vector.length;
    
    for (var channel=0; channel < numChannels; channel++)
    {
        var resultValue = kfi.getAttribute("resultValues").getAt(channel);
        
        switch (channel)
        {
            case 0: // x pos
                resultValue.addElementTarget(target.getAttribute("position"), 0, 0);
                break;

            case 1: // y pos
                resultValue.addElementTarget(target.getAttribute("position"), 0, 1);
                break;

            case 2: // z pos
                resultValue.addElementTarget(target.getAttribute("position"), 0, 2);
                break;

            case 3: // heading (y rot)
                resultValue.addElementTarget(target.getAttribute("rotation"), 0, 1);
                break;

            case 4: // pitch (x rot)
                resultValue.addElementTarget(target.getAttribute("rotation"), 0, 0);
                break;

            case 5: // bank (z rot)
                resultValue.addElementTarget(target.getAttribute("rotation"), 0, 2);
                break;

            case 6: // x scale
                resultValue.addElementTarget(target.getAttribute("scale"), 0, 0);
                break;

            case 7: // y scale
                resultValue.addElementTarget(target.getAttribute("scale"), 0, 1);
                break;

            case 8: // z scale
                resultValue.addElementTarget(target.getAttribute("scale"), 0, 2);
                break;
        }   
    }
    
    kfi.getAttribute("time").setValueDirect(0);
}

LWSceneBuilder.prototype.attachDissolveInterpolator = function(kfi, target)
{
    if (!kfi || !target) return;
    
    var resultValue = kfi.getAttribute("resultValues").getAt(0);
    
    resultValue.addElementTarget(target.getAttribute("dissolve"), 0, 0);
}

LWSceneBuilder.prototype.attachBoneEffectors = function(model, bones)
{
    // for each geometry set in model...
    for (var i=0; i < model.geometries.length; i++)
    {
        var geometry = model.geometries[i];
        
        // allocate bone effector
        var boneEffector = this.factory.create("BoneEffector");
        this.evaluators.push(boneEffector);
        this.evaluatorsGroup.addChild(boneEffector);
        
        // add bones to bone effector
        for (var j=0; j < bones.length; j++)
        {
            boneEffector.addBoneHierarchy(bones[j]);
        }

        // get vertices/normals from geometry
        var verticesAttr = geometry.getAttribute("vertices");
        var vertices = verticesAttr.getValueDirect();

        // points/lines will not have normals
        var normalsAttr = geometry.getAttribute("normals");
        var normals = normalsAttr.getValueDirect();

        // assign to bone effector inputs
        boneEffector.getAttribute("vertices").setValueDirect(vertices);
        boneEffector.getAttribute("normals").setValueDirect(normals);

        // route bone effector outputs back to geometry
        boneEffector.getAttribute("resultVertices").addTarget(verticesAttr);
        boneEffector.getAttribute("resultNormals").addTarget(normalsAttr);
    }
}

LWSceneBuilder.prototype.setParentItem = function(object, parentItem)
{
    var itemNum = hexStrToULong(parentItem.substring(1));
    var parent = null;
    switch (parentItem.charAt(0))
    {
        case "1": // model parent
            {
                parent = this.models[itemNum];
                if (object.attrType == eAttrType.Bone)
                {
                    parent.bones.push(object);
                }
            }
            break;
    
        case "2": // light parent
            {
                parent = this.lights[itemNum];
            }
            break;
    
        case "3": // camera parent
            {
                parent = this.cameras[itemNum];
            }
            break;
    
        case "4": // bone parent
            {
                var boneNum = hexStrToULong(parentItem.substring(1, 4));
                var objNum = hexStrToULong(parentItem.substring(4));

                if (this.bones.length > boneNum)
                {
                    var childBone = object;
                    var parentBone = null;
                    if (this.objectBones.length > objNum && this.objectBones[objNum].length > boneNum)
                    {
                        parentBone = this.objectBones[objNum][boneNum];
                    }

                    if (parentBone && childBone)
                    {
                        parentBone.addChild(childBone);
                    }
                }  
            }
            break;
        
        default:
            return;
    }
    
    // assign parent
    switch (object.attrType)
    {
        case eAttrType.Bone:
            break;
        
        default:
            object.setMotionParent(parent);
            break;
    }
}

function LWSceneBuilder_TokenHandler(tokens, builder)
{
    builder.handleToken(tokens[0], tokens.slice(1));
}
AttributeFactory.prototype = new AttributeContainer();
AttributeFactory.prototype.constructor = AttributeFactory;

function AttributeFactory()
{
    AttributeContainer.call(this);
    this.className = "AttributeFactory";
    this.attrType = eAttrType.AttributeFactory;

    this.newResourceProcs = [];
    this.configureProcs = [];
    this.finalizeProcs = [];
    this.registry = null;
    this.graphMgr = null;

    this.name = new StringAttr("AttributeFactory");

    this.registerAttribute(this.name, "name");

    this.initializeNewResourceMap();
    this.initializeConfigureMap();
    this.initializeFinalizeMap();
}

AttributeFactory.prototype.create = function(name)
{
    var resource = null;

    // invoke new resource proc
    var newResourceProc = this.newResourceProcs[name];
    if (newResourceProc)
    {
        resource = newResourceProc(name, this);
    }
    if (!resource)
        return null;

    // invoke configuration proc (if specified)
    var configureProc = this.configureProcs[name];
    if (configureProc)
    {
        configureProc(resource, this);
    }

    // if resource is a container, register name and userData if not already registered
    if (resource.isContainer())
    {
        if (!resource.getAttribute("name"))
            resource.registerAttribute(new StringAttr(""), "name");
        if (!resource.getAttribute("userData"))
            resource.registerAttribute(new StringAttr(""), "userData");
    }

    // register resource
    if (this.registry)
    {
        this.registry.register(resource);
        resource.setRegistry(this.registry);
    }

    // invoke post-register proc (if specified)

    return resource;
}

AttributeFactory.prototype.finalize = function(name, attribute)
{
    // invoke finalize proc
    var finalizeProc = this.finalizeProcs[name];
    if (finalizeProc)
    {
        finalizeProc(attribute, this);
    }
}

AttributeFactory.prototype.initializeNewResourceMap = function()
{
    // attributes
    this.newResourceProcs["Styles"] = newAttribute;
    this.newResourceProcs["StyleMap"] = newAttribute;
    this.newResourceProcs["StylesMap"] = newAttribute;
    this.newResourceProcs["LabelStyle"] = newAttribute;
    this.newResourceProcs["IconStyle"] = newAttribute;
    this.newResourceProcs["FontStyle"] = newAttribute;
    this.newResourceProcs["HTMLLabelStyle"] = newAttribute;
    this.newResourceProcs["BalloonTipLabelStyle"] = newAttribute;
    this.newResourceProcs["RenderableElementStyle"] = newAttribute;
    this.newResourceProcs["Serializer"] = newAttribute;
    this.newResourceProcs["Bone"] = newAttribute;

    // nodes
    this.newResourceProcs["DirectionalLight"] = newSGNode;
    this.newResourceProcs["GlobalIllumination"] = newSGNode;
    this.newResourceProcs["Group"] = newSGNode;
    this.newResourceProcs["Isolator"] = newSGNode;
    this.newResourceProcs["Label"] = newSGNode;
    this.newResourceProcs["HTMLLabel"] = newSGNode;
    this.newResourceProcs["BalloonTipLabel"] = newSGNode;
    this.newResourceProcs["LineList"] = newSGNode;
    this.newResourceProcs["MediaTexture"] = newSGNode;
    this.newResourceProcs["Model"] = newModel;
    this.newResourceProcs["OrthographicCamera"] = newSGNode;
    this.newResourceProcs["PerspectiveCamera"] = newSGNode;
    this.newResourceProcs["PointLight"] = newSGNode;
    this.newResourceProcs["PointList"] = newSGNode;
    this.newResourceProcs["QuaternionRotate"] = newSGNode;
    this.newResourceProcs["Rotate"] = newSGNode;
    this.newResourceProcs["Scale"] = newSGNode;
    this.newResourceProcs["Selector"] = newSGNode;
    this.newResourceProcs["Surface"] = newSGNode;
    this.newResourceProcs["Translate"] = newSGNode;
    this.newResourceProcs["Transform"] = newSGNode;
    this.newResourceProcs["TriList"] = newSGNode;
    this.newResourceProcs["NullObject"] = newSGNode;
    this.newResourceProcs["Material"] = newSGNode;
    this.newResourceProcs["Cube"] = newSGNode;
    this.newResourceProcs["ScreenRect"] = newSGNode;
    this.newResourceProcs["SnapModel"] = newSnapModel;

    // directives
    this.newResourceProcs["BBoxDirective"] = newSGDirective;
    this.newResourceProcs["RayPickDirective"] = newSGDirective;
    this.newResourceProcs["RenderDirective"] = newSGDirective;
    this.newResourceProcs["SerializeDirective"] = newSGDirective;
    this.newResourceProcs["UpdateDirective"] = newSGDirective;
    this.newResourceProcs["CollideDirective"] = newSGDirective;
    this.newResourceProcs["HighlightDirective"] = newSGDirective;

    // evaluators
    this.newResourceProcs["BBoxLocator"] = newBBoxLocator;
    this.newResourceProcs["KeyframeInterpolator"] = newKeyframeInterpolator;
    this.newResourceProcs["MapProjectionCalculator"] = newMapProjectionCalculator;
    this.newResourceProcs["ObjectInspector"] = newObjectInspector;
    this.newResourceProcs["SceneInspector"] = newSceneInspector;
    this.newResourceProcs["TargetObserver"] = newTargetObserver;
    this.newResourceProcs["AnimalMover"] = newAnimalMover;
    this.newResourceProcs["WalkSimulator"] = newWalkSimulator;
    this.newResourceProcs["MorphEffector"] = newMorphEffector;
    this.newResourceProcs["BoneEffector"] = newBoneEffector;
    this.newResourceProcs["PhysicsSimulator"] = newPhysicsSimulator;
    this.newResourceProcs["GoblinPhysicsSimulator"] = newGoblinPhysicsSimulator;
    this.newResourceProcs["CannonPhysicsSimulator"] = newCannonPhysicsSimulator;
    this.newResourceProcs["Spinner"] = newAnimator;

    // commands
    this.newResourceProcs["AppendNode"] = newCommand;
    this.newResourceProcs["AutoInterpolate"] = newCommand;
    this.newResourceProcs["CommandSequence"] = newCommand;
    this.newResourceProcs["ConnectAttributes"] = newCommand;
    this.newResourceProcs["ConnectOutputs"] = newCommand;
    this.newResourceProcs["DisconnectAttributes"] = newCommand;
    this.newResourceProcs["DisconnectOutputs"] = newCommand;
    this.newResourceProcs["Export"] = newCommand;
    this.newResourceProcs["Locate"] = newCommand;
    this.newResourceProcs["MotionInterpolate"] = newCommand;
    this.newResourceProcs["Pause"] = newCommand;
    this.newResourceProcs["Play"] = newCommand;
    this.newResourceProcs["Remove"] = newCommand;
    this.newResourceProcs["ScreenCapture"] = newCommand;
    this.newResourceProcs["Serialize"] = newCommand;
    this.newResourceProcs["Set"] = newCommand;
    this.newResourceProcs["Stop"] = newCommand;
    this.newResourceProcs["Morph"] = newCommand;
    this.newResourceProcs["SnapTo"] = newCommand;

    // device handlers
    this.newResourceProcs["MouseHandler"] = newDeviceHandler;
    this.newResourceProcs["KeyboardHandler"] = newDeviceHandler;
}

AttributeFactory.prototype.initializeConfigureMap = function()
{
    // nodes
    this.configureProcs["Model"] = configureModel;

    // directives
    this.configureProcs["BBoxDirective"] = configureDirective;
    this.configureProcs["RayPickDirective"] = configureDirective;
    this.configureProcs["RenderDirective"] = configureDirective;
    this.configureProcs["SerializeDirective"] = configureDirective;
    this.configureProcs["UpdateDirective"] = configureDirective;
    this.configureProcs["CollideDirective"] = configureDirective;
    this.configureProcs["HighlightDirective"] = configureDirective;
}

AttributeFactory.prototype.initializeFinalizeMap = function()
{
    // nodes
    this.finalizeProcs["Model"] = finalizeModel;

    // directives
    this.finalizeProcs["BBoxDirective"] = finalizeDirective;
    this.finalizeProcs["RayPickDirective"] = finalizeDirective;
    this.finalizeProcs["RenderDirective"] = finalizeDirective;
    this.finalizeProcs["SerializeDirective"] = finalizeDirective;
    this.finalizeProcs["UpdateDirective"] = finalizeDirective;
    this.finalizeProcs["CollideDirective"] = finalizeDirective;
    this.finalizeProcs["HighlightDirective"] = finalizeDirective;

    // evaluators 
    this.finalizeProcs["KeyframeInterpolator"] = finalizeEvaluator;

    // commands
    this.finalizeProcs["AppendNode"] = finalizeCommand;
    this.finalizeProcs["AutoInterpolate"] = finalizeCommand;
    this.finalizeProcs["CommandSequence"] = finalizeCommand;
    this.finalizeProcs["ConnectAttributes"] = finalizeCommand;
    this.finalizeProcs["ConnectOutputs"] = finalizeCommand;
    this.finalizeProcs["DisconnectAttributes"] = finalizeCommand;
    this.finalizeProcs["DisconnectOutputs"] = finalizeCommand;
    this.finalizeProcs["Export"] = finalizeCommand;
    this.finalizeProcs["Locate"] = finalizeCommand;
    this.finalizeProcs["MotionInterpolate"] = finalizeCommand;
    this.finalizeProcs["Pause"] = finalizeCommand;
    this.finalizeProcs["Play"] = finalizeCommand;
    this.finalizeProcs["Remove"] = finalizeCommand;
    this.finalizeProcs["ScreenCapture"] = finalizeCommand;
    this.finalizeProcs["Serialize"] = finalizeCommand;
    this.finalizeProcs["Set"] = finalizeCommand;
    this.finalizeProcs["Stop"] = finalizeCommand;
    this.finalizeProcs["Morph"] = finalizeCommand;
    this.finalizeProcs["SnapTo"] = finalizeCommand;

    // device handlers
    this.finalizeProcs["MouseHandler"] = finalizeDeviceHandler;
    this.finalizeProcs["KeyboardHandler"] = finalizeDeviceHandler;
}

AttributeFactory.prototype.setRegistry = function(registry)
{
    this.registry = registry;
}

AttributeFactory.prototype.setGraphMgr = function(graphMgr)
{
    this.graphMgr = graphMgr;
}

function newAttribute(name, factory)
{
    var resource = null;

    switch (name)
    {
        case "BalloonTipLabelStyleAttr":
            resource = new BalloonTipLabelStyleAttr();
            break;
        case "BBoxAttr":
            resource = new BBoxAttr();
            break;
        case "BooleanAttr":
            resource = new BooleanAttr();
            break;
        case "ColorAttr":
            resource = new ColorAttr();
            break;
        case "FontStyleAttr":
            resource = new FontStyleAttr();
            break;
        case "IconStyleAttr":
            resource = new IconStyleAttr();
            break;
        case "ImageAttr":
            resource = new ImageAttr();
            break;
        case "KeyframeAttr":
            resource = new KeyframeAttr();
            break;
        case "KeyframesAttr":
            resource = new KeyframesAttr();
            break;
        case "LabelStyleAttr":
            resource = new LabelStyleAttr();
            break;
        case "HTMLLabelStyleAttr":
            resource = new HTMLLabelStyleAttr();
            break;
        case "NumberArrayAttr":
            resource = new NumberArrayAttr();
            break;
        case "NumberAttr":
            resource = new NumberAttr();
            break;
        case "Matrix4x4Attr":
            resource = new Matrix4x4Attr();
            break;
        case "PlaneAttr":
            resource = new PlaneAttr();
            break;
        case "PulseAttr":
            resource = new PulseAttr();
            break;
        case "QuaternionAttr":
            resource = new QuaternionAttr();
            break;
        case "RectAttr":
            resource = new RectAttr();
            break;
        case "ReferenceAttr":
            resource = new ReferenceAttr();
            break;
        case "StringAttr":
            resource = new StringAttr();
            break;
        case "StyleAttr":
            resource = new StyleAttr();
            break;
        case "StylesAttr":
            resource = new StylesAttr();
            break;
        case "StyleMapAttr":
            resource = new StyleMapAttr();
            break;
        case "StylesMapAttr":
            resource = new StylesMapAttr();
            break;
        case "Vector2DAttr":
            resource = new Vector2DAttr();
            break;
        case "Vector3DAttr":
            resource = new Vector3DAttr();
            break;
        case "ViewportAttr":
            resource = new ViewportAttr();
            break;
        case "ViewVolumeAttr":
            resource = new ViewVolumeAttr();
            break;
        case "RenderableElementStyleAttr":
            resource = new RenderableElementStyleAttr();
            break;
        case "Serializer":
            resource = new Serializer();
            break;
        case "Bone":
            resource = new Bone();
            break;
    }

    return resource;
}

function newSGNode(name, factory)
{
    var resource = null;

    switch (name)
    {
        case "DirectionalLight":
            resource = new DirectionalLight();
            registerParentableAttributes(resource, factory);
            break;
        case "GlobalIllumination":
            resource = new GlobalIllumination();
            break;
        case "Group":
            resource = new Group();
            break;
        case "Isolator":
            resource = new Isolator();
            break;
        case "Label":
            resource = new Label();
            break;
        case "HTMLLabel":
            resource = new HTMLLabel();
            break;
        case "BalloonTipLabel":
            resource = new BalloonTipLabel();
            break;
        case "LineList":
            resource = new LineList();
            break;
        case "MediaTexture":
            resource = new MediaTexture();
            break;
        case "OrthographicCamera":
            resource = new OrthographicCamera();
            registerParentableAttributes(resource, factory);
            break;
        case "PerspectiveCamera":
            resource = new PerspectiveCamera();
            registerParentableAttributes(resource, factory);
            break;
        case "PointLight":
            resource = new PointLight();
            registerParentableAttributes(resource, factory);
            break;
        case "PointList":
            resource = new PointList();
            break;
        case "QuaternionRotate":
            resource = new QuaternionRotate();
            break;
        case "Rotate":
            resource = new Rotate();
            break;
        case "Scale":
            resource = new Scale();
            break;
        case "Selector":
            resource = new Selector();
            break;
        case "Surface":
            resource = new Surface();
            break;
        case "Transform":
            resource = new Transform();
            break;
        case "Translate":
            resource = new Translate();
            break;
        case "TriList":
            resource = new TriList();
            break;
        case "NullObject":
            resource = new NullObject();
            registerParentableAttributes(resource, factory);
            break;
        case "Cube":
            resource = new Cube();
            break;
        case "Material":
            resource = new Material();
            break;
        case "ScreenRect":
            resource = new ScreenRect();
            break;
    }

    if (resource)
    {
        resource.setGraphMgr(factory.graphMgr);
    }

    return resource;
}

function newSGDirective(name, factory)
{
    var resource = null;

    switch (name)
    {
        case "BBoxDirective":
            resource = new BBoxDirective();
            break;
        case "RayPickDirective":
            resource = new RayPickDirective();
            break;
        case "RenderDirective":
            resource = new RenderDirective();
            break;
        case "SerializeDirective":
            resource = new SerializeDirective();
            break;
        case "UpdateDirective":
            resource = new UpdateDirective();
            break;
        case "CollideDirective":
            resource = new CollideDirective();
            break;
        case "HighlightDirective":
            resource = new HighlightDirective();
            break;
    }

    if (resource)
    {
        resource.setGraphMgr(factory.graphMgr);
    }

    return resource;
}

function newModel(name, factory)
{
    var resource = new Model();
    resource.setGraphMgr(factory.graphMgr);
    registerParentableAttributes(resource, factory);
    addInspectionGroup(resource, factory);
    return resource;
}

function newSnapModel(name, factory)
{
    var resource = new SnapModel();
    resource.setGraphMgr(factory.graphMgr);
    registerParentableAttributes(resource, factory);
    addInspectionGroup(resource, factory);
    return resource;
}

function newBBoxLocator(name, factory)
{
    var resource = new BBoxLocator();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newKeyframeInterpolator(name, factory)
{
    var resource = new KeyframeInterpolator();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newMapProjectionCalculator(name, factory)
{
    var resource = new MapProjectionCalculator();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newObjectInspector(name, factory)
{
    var resource = new ObjectInspector();

    registerEvaluatorAttributes(resource, factory);

    // target the Inspector's selection flag with the selector's clickPoint
    var selector = factory.registry.find("Selector");
    if (selector)
    {
        selector.getAttribute("selectionOccurred").addTarget(
                resource.getAttribute("selectionOccurred"), eAttrSetOp.Replace, null, false);

        selector.getAttribute("selectionCleared").addTarget(
                resource.getAttribute("selectionCleared"), eAttrSetOp.Replace, null, false);

        selector.getAttribute("pointView").addTarget(
                resource.getAttribute("pointView"), eAttrSetOp.Replace, null, false);
    }

    return resource;
}

function newSceneInspector(name, factory)
{
    var resource = new BwSceneInspector();

    registerEvaluatorAttributes(resource, factory);

    // target the Inspector's selection flag with the selector's clickPoint
    // target the Inspector's pivotDistance with the selector's distanceFromScreenCenter
    var selector = factory.registry.find("Selector");
    if (selector)
    {
        selector.getAttribute("selectionOccurred").addTarget(
                resource.getAttribute("selectionOccurred"), eAttrSetOp.Replace, null, false);

        selector.getAttribute("distanceFromScreenCenter").addTarget(
                resource.getAttribute("pivotDistance"), eAttrSetOp.Replace, null, false);
    }

    return resource;
}

function newTargetObserver(name, factory)
{
    var resource = new BwTargetObserver();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newAnimalMover(name, factory)
{
    var resource = new AnimalMover();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newWalkSimulator(name, factory)
{
    var resource = new WalkSimulator();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newMorphEffector(name, factory)
{
    var resource = new MorphEffector();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newBoneEffector(name, factory)
{
    var resource = new BoneEffector();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newPhysicsSimulator(name, factory)
{
    var resource = new PhysicsSimulator();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newGoblinPhysicsSimulator(name, factory)
{
    var resource = new GoblinPhysicsSimulator();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newCannonPhysicsSimulator(name, factory)
{
    var resource = new CannonPhysicsSimulator();

    registerEvaluatorAttributes(resource, factory);

    return resource;
}

function newAnimator(name, factory)
{
    var resource = null;
    
    switch (name)
    {
        case "Spinner":
            resource = new Spinner();
            break;
    }
    
    return resource;
}

function newCommand(name, factory)
{
    var resource = null;

    switch (name)
    {
        case "AppendNode":
            resource = new AppendNodeCommand();
            break;
        case "AutoInterpolate":
            resource = new AutoInterpolateCommand();
            break;
        case "CommandSequence":
            resource = new CommandSequence();
            break;
        case "ConnectAttributes":
            resource = new ConnectAttributesCommand();
            break;
        case "ConnectOutputs":
            resource = new ConnectAttributesCommand();
            break;
        case "DisconnectAttributes":
            resource = new ConnectAttributesCommand();
            resource.getAttribute("negate").setValueDirect(true);
            break;
        case "DisconnectOutputs":
            resource = new ConnectAttributesCommand();
            resource.getAttribute("negate").setValueDirect(true);
            break;
        case "Export":
            resource = new ExportCommand();
            break;
        case "Locate":
            resource = new LocateCommand();
            break;
        case "MotionInterpolate":
            resource = new MotionInterpolateCommand();
            break;
        case "Pause":
            resource = new PlayCommand();
            resource.getAttribute("negate").setValueDirect(true);
            break;
        case "Play":
            resource = new PlayCommand();
            break;
        case "Remove":
            resource = new RemoveCommand();
            break;
        case "ScreenCapture":
            resource = new ScreenCaptureCommand();
            break;
        case "Serialize":
            resource = new SerializeCommand();
            break;
        case "Set":
            resource = new SetCommand();
            break;
        case "Stop":
            resource = new StopCommand();
            break;
        case "Morph":
            resource = new MorphCommand();
            break;
        case "SnapTo":
            resource = new SnapToCommand();
            break;
    }

    // if command sequence, set to command mgr
    if (name == "CommandSequence")
    {
        var commandMgr = factory.registry.find("CommandMgr");
        if (commandMgr)
        {
            commandMgr.pushCommandSequence(resource);
        }
    }

    return resource;
}

function newDeviceHandler(name, factory)
{
    var resource = null;

    switch (name)
    {
        case "MouseHandler":
            resource = new MouseHandler();
            break;
        case "KeyboardHandler":
            resource = new KeyboardHandler();
            break;
    }

    return resource;
}

function configureModel(model, factory)
{
    // TODO
    console.debug("TODO: " + arguments.callee.name);
}

function configureDirective(directive, factory)
{
    var root = new StringAttr("");
    root.addModifiedCB(AttributeFactory_DirectiveRootModifiedCB, factory);
    directive.registerAttribute(root, "root");

    var rootNode = factory.registry.getAttribute("rootPtr").getValueDirect();
    if (rootNode)
    {
        root.setValueDirect(rootNode.getAttribute("name").getValueDirect().join(""));
    }
}

function finalizeModel(model, factory)
{
    // TODO
    console.debug("TODO: remove LWO assumption");

    var url = model.getAttribute("url").getValueDirect();
    if (url) {

        url = url.join("");

        var pathInfo = formatPath(url);
        console.debug("path: " + pathInfo[0]);
        console.debug("content dir: " + pathInfo[1]);

        var contentHandler = new LWObjectHandler();
        contentHandler.getAttribute("contentDirectory").setValueDirect(pathInfo[1]);

        var contentBuilder = new LWObjectBuilder();
        contentBuilder.setRegistry(factory.registry);
        contentBuilder.models.push(model);
        contentBuilder.layer = model.getAttribute("layer").getValueDirect();
        contentBuilder.visitHandler(contentHandler);

        contentHandler.parseFileStream(pathInfo[0]);
    }
    
    // if physicsEnabled, add this to Bridgeworks' physics simulator
    if (model.physicsEnabled.getValueDirect())
    {
        var bworks = factory.registry.find("Bridgeworks");
        bworks.physicsSimulator.bodies.push_back(model.name);
    }
}

function finalizeDirective(directive, factory)
{
}

function finalizeCommand(command, factory)
{
    command.finalize();

    var commandMgr = factory.registry.find("CommandMgr");
    if (commandMgr)
    {
        // if command sequence, clear from command mgr
        if (command.className == "CommandSequence")
        {
            commandMgr.popCommandSequence();
        }

        commandMgr.addCommand(command);
    }
}

function finalizeDeviceHandler(handler, factory)
{
    var eventMgr = factory.registry.find("EventMgr");
    if (eventMgr)
    {
        var events = handler.getEventTypes();
        for (var i = 0; i < events.length; i++)
        {
            eventMgr.addListener(events[i], handler);
        }
    }
}

function finalizeEvaluator(evaluator, factory)
{
    // TODO
    console.debug("TODO: " + arguments.callee.name);

    switch (evaluator.className)
    {
        case "KeyframeInterpolator":

            var url = evaluator.getAttribute("url").getValueDirect();
            if (url) {

                url = url.join("");

                var pathInfo = formatPath(url);

                var contentHandler = new LWSceneHandler();
                contentHandler.getAttribute("contentDirectory").setValueDirect(pathInfo[1]);

                var contentBuilder = new LWSceneBuilder();
                contentBuilder.setRegistry(factory.registry);
                contentBuilder.evaluators.push(evaluator);
                contentBuilder.visitHandler(contentHandler);

                contentHandler.parseFileStream(pathInfo[0]);
            }
            AttributeFactory_EvaluatorTargetConnectionTypeModifiedCB(evaluator.getAttribute("targetConnectionType"), factory);
            break;
    }
}

function registerEvaluatorAttributes(evaluator, factory)
{
    // url
    if (!evaluator.getAttribute("url"))
    {
        var url = new StringAttr("");
        evaluator.registerAttribute(url, "url");
    }

    // target
    if (!evaluator.getAttribute("target"))
    {
        var target = new StringAttr("");
        evaluator.registerAttribute(target, "target");
    }

    // renderAndRelease
    if (!evaluator.getAttribute("renderAndRelease"))
    {
        var renderAndRelease = new BooleanAttr(false);
        evaluator.registerAttribute(renderAndRelease, "renderAndRelease");
    }

    // targetConnectionType
    if (!evaluator.getAttribute("targetConnectionType"))
    {
        var targetConnectionType = new StringAttr("transform");
        targetConnectionType.addModifiedCB(AttributeFactory_EvaluatorTargetConnectionTypeModifiedCB, factory);
        evaluator.registerAttribute(targetConnectionType, "targetConnectionType");
    }
}

function registerParentableAttributes(pme, factory)
{
    // label
    if (!pme.getAttribute("label"))
    {
        var label = new StringAttr("");
        pme.registerAttribute(label, "label");
        label.addModifiedCB(AttributeFactory_ParentableLabelModifiedCB, factory);
    }

    // geoPosition
    if (!pme.getAttribute("geoPosition"))
    {
        var geoPosition = new Vector3DAttr();
        pme.registerAttribute(geoPosition, "geoPosition");
        geoPosition.addModifiedCB(AttributeFactory_ParentableGeoPositionModifiedCB, factory);
    }

    // altitude
    if (!pme.getAttribute("altitude"))
    {
        var altitude = new NumberAttr();
        pme.registerAttribute(altitude, "altitude");
    }

    // latitude
    if (!pme.getAttribute("latitude"))
    {
        var latitude = new NumberAttr();
        pme.registerAttribute(latitude, "latitude");
    }

    // longitude
    if (!pme.getAttribute("longitude"))
    {
        var longitude = new NumberAttr();
        pme.registerAttribute(longitude, "longitude");
    }

    // misc modified callbacks
    pme.getAttribute("worldCenter").addModifiedCB(AttributeFactory_ParentableWorldPositionModifiedCB, factory);
}

function getSceneGraph()
{
    return this.sceneGraph;
}

function AttributeFactory_DirectiveRootModifiedCB(root, factory)
{
    var directive = root.getContainer();
    var resources = factory.registry.getByName(root.getValueDirect().join(""));
    if (resources)
    {
        directive.getAttribute("rootNode").setValueDirect(resources[0]);
    }
}

function AttributeFactory_ParentableLabelModifiedCB(attribute, container)
{
    console.debug("TODO: " + arguments.callee.name);
}

function AttributeFactory_ParentableGeoPositionModifiedCB(attribute, container)
{
    var pme = attribute.getContainer();
    if (pme)
    {
        var cms = container.registry.getByName("ConnectionMgr");
        if (cms && cms.length)
        {
            var cm = cms[0];

            var mpcs = container.registry.getByType(eAttrType.MapProjectionCalculator);
            if (mpcs && mpcs.length)
            {
                var mpc = mpcs[0];

                mpc.getAttribute("geoPosition").copyValue(attribute);

                cm.connectMapProjectionCalculator(mpc, pme);
                cm.disconnectMapProjectionCalculator(mpc, pme);
            }
        }
    }
}

function AttributeFactory_ParentableWorldPositionModifiedCB(attribute, container)
{
    // TODO
    //console.debug("TODO: " + arguments.callee.name);
}

function AttributeFactory_EvaluatorTargetConnectionTypeModifiedCB(attribute, container)
{
    var evaluator = attribute.getContainer();
    if (evaluator)
    {
        var connect = new ConnectAttributesCommand();
        connect.setRegistry(container.registry);
        connect.getAttribute("sourceContainer").copyValue(evaluator.getAttribute("name"));
        connect.getAttribute("targetContainer").copyValue(evaluator.getAttribute("target"));
        connect.getAttribute("connectionType").copyValue(attribute);
        connect.execute();
    }
}
var bridgeworks = null;

Bridgeworks.prototype = new AttributeContainer();
Bridgeworks.prototype.constructor = Bridgeworks;

function Bridgeworks(canvas, bgImage, contentDir)
{
    AttributeContainer.call(this);
    this.className = "Bridgeworks";

    this.renderContext =  newRenderContext("webgl", canvas, bgImage);
    if (!this.renderContext) return;

    contentDir = contentDir == null? "BwContent" : contentDir;

    this.canvas = canvas;
    this.contentDir = contentDir;

    // allocate objects
    //this.renderContext = null;
    this.graphMgr = new GraphMgr();
    this.graphMgr.setRenderContext(this.renderContext)

    this.styleMgr = new StyleMgr();
    this.registry = new BwRegistry();
    this.factory = new AttributeFactory();
    this.parser = new XMLParser(this.factory, this.registry, this.contentDir);
    this.eventAdapter = new EventAdapter();
    this.eventMgr = new EventMgr();
    this.commandMgr = new CommandMgr();
    this.connectionMgr = new ConnectionMgr();
    this.viewportMgr = new ViewportMgr();
    this.selector = new SelectionListener();
    this.rayPick = new RayPickDirective();
    this.renderAgent = new RenderAgent(this);
    this.renderController = new RenderController(this);
    this.layout = new GridLayout();
    this.mapProjectionCalculator = new MapProjectionCalculator();
    this.rasterComponentEventListener = new RasterComponentEventListener();
    this.snapMgr = new SnapMgr();
    this.physicsSimulator = new PhysicsSimulator();

    // set registry to allocated objects
    this.graphMgr.setRegistry(this.registry);
    this.factory.setRegistry(this.registry);
    this.eventAdapter.setRegistry(this.registry);
    this.eventMgr.setRegistry(this.registry);
    this.commandMgr.setRegistry(this.registry);
    this.connectionMgr.setRegistry(this.registry);
    this.viewportMgr.setRegistry(this.registry);
    this.selector.setRegistry(this.registry);
    this.renderAgent.setRegistry(this.registry);
    this.layout.setRegistry(this.registry);
    this.mapProjectionCalculator.setRegistry(this.registry);
    this.rasterComponentEventListener.setRegistry(this.registry);
    this.snapMgr.setRegistry(this.registry);
    this.physicsSimulator.setRegistry(this.registry);

    // configure dependencies
    this.factory.setGraphMgr(this.graphMgr);
    this.selector.setRayPick(this.rayPick);
    this.rasterComponentEventListener.setStyleMgr(this.styleMgr);
    this.rasterComponents = null;
    this.physicsSimulator.orphan.setValueDirect(true);

    this.name = new StringAttr("Bridgeworks");
    this.onLoad = new StringAttr();

    this.onLoad.addModifiedCB(Bridgeworks_OnLoadModifiedCB, this);

    this.registerAttribute(this.name, "name");
    this.registerAttribute(this.onLoad, "onLoad");

    this.viewportMgr.getAttribute("width").setValueDirect(this.canvas.width);
    this.viewportMgr.getAttribute("height").setValueDirect(this.canvas.height);
    this.viewportMgr.getAttribute("layout").setValueDirect(this.layout);

    enumerateAttributeTypes();
    enumerateAttributeElementTypes();

    // TODO: remove the following when onLoadModified is defined
    console.debug("TODO: " + arguments.callee.name);
    this.initRegistry();
    this.initEventListeners();
    this.viewportMgr.initLayout();
}

Bridgeworks.prototype.get = function(name) {
  return this.registry.find(name);
}

Bridgeworks.prototype.handleEvent = function(event, eventType /* optional type override */)
{
    var bwEvent = null;

    switch (getObjectClassName(event))
    {
        case "MouseEvent":
        case "MouseEventConstructor": // Safari
        case "WheelEvent":
            {
                var absPos = getElementAbsolutePos(this.canvas);
                event.canvasX = event.clientX - absPos.x;
                event.canvasY = event.clientY - absPos.y;
                bwEvent = this.eventAdapter.createMouseEvent(event);
            }
            break;
        
        case "KeyboardEvent":
        case "KeyboardEventConstructor": // Safari
            {
                bwEvent = this.eventAdapter.createKeyboardEvent(event, eventType);
            }
            break;
            
        default:
            break;
    }

    if (bwEvent)
    {
        this.eventMgr.processEvent(bwEvent);
    }
}

Bridgeworks.prototype.initRegistry = function()
{
    // register allocated objects
    this.registry.register(this);
    this.registry.register(this.graphMgr);
    this.registry.register(this.factory);
    this.registry.register(this.eventAdapter);
    this.registry.register(this.eventMgr);
    this.registry.register(this.commandMgr);
    this.registry.register(this.connectionMgr);
    this.registry.register(this.viewportMgr);
    this.registry.register(this.selector);
    this.registry.register(this.renderAgent);
    this.registry.register(this.layout);
    this.registry.register(this.mapProjectionCalculator);
    this.registry.register(this.rasterComponentEventListener);
    this.registry.register(this.snapMgr);
    this.registry.register(this.physicsSimulator);

    // backward compatibility
    this.registry.registerByName(this.renderAgent, "AnimationAgent");
}

Bridgeworks.prototype.initEventListeners = function()
{
    // selector
    this.eventMgr.addListener(eEventType.MouseLeftDown, this.selector);
    this.eventMgr.addListener(eEventType.MouseLeftDblClick, this.selector);
    this.eventMgr.addListener(eEventType.MouseMiddleDown, this.selector);
    this.eventMgr.addListener(eEventType.MouseRightDown, this.selector);
    this.eventMgr.addListener(eEventType.MouseBothDown, this.selector);
    this.eventMgr.addListener(eEventType.MouseHover, this.selector);
    //this.eventMgr.addListener(eMOUSE_MOVE, this.selector);

    // raster component event listener
    this.eventMgr.addListener(eEventType.MouseLeftDown, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseLeftUp, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseLeftClick, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseLeftDblClick, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseMiddleDown, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseMiddleUp, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseMiddleClick, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseMiddleDblClick, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseRightDown, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseRightUp, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseRightClick, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseRightDblClick, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseWheelDown, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseWheelUp, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseBothDown, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseHover, this.rasterComponentEventListener);
    this.eventMgr.addListener(eEventType.MouseMove, this.rasterComponentEventListener);
}

Bridgeworks.prototype.onLoadModified = function()
{
    this.renderAgent.stop();
    //this.iscetAgent.stop(); There is no isectAgent in javascript version
    this.selector.stop();
    this.rasterComponentEventListener.stop();

    this.commandMgr.clearCommandSequenceStack();
    this.eventMgr.clearEvents();
    $('#RasterComponents').empty();
    //this.resouceMgr.clear(); There is no resourceMgr in javascript version
    this.selector.clearSelections();
    this.selector.getAttribute("lastSelectedName").setValueDirect("");
    this.viewportMgr.initLayout();

    this.registry.clear();
    g__nodeId__ = 0; // reset node ID counter
    
    this.initEventListeners();
    this.initRegistry();

    this.renderAgent.getAttribute("globalTimeInSecs").setValueDirect(0);

    this.graphMgr.reset();

    this.renderAgent.start();
    //this.iscetAgent.start(); There is no isectAgent in javascript version
    this.selector.start();
    this.rasterComponentEventListener.start();

    // TODO
    console.debug("TODO: " + arguments.callee.name);
}

Bridgeworks.prototype.resize = function(width, height)
{
    this.canvas.width = width;
    this.canvas.height = height;
    this.renderContext.setViewport(this.canvas.offsetLeft, this.canvas.offsetTop, width, height);

    this.viewportMgr.getAttribute("width").setValueDirect(width);
    this.viewportMgr.getAttribute("height").setValueDirect(height);
}

Bridgeworks.prototype.render = function()
{
    this.eventMgr.processEvent(new Event(eEventType.RenderBegin));

    this.renderContext.clear();
    this.renderAgent.render();

    this.eventMgr.processEvent(new Event(eEventType.RenderEnd));
}

Bridgeworks.prototype.setRenderContext = function(rc)
{
    this.renderContext = rc;
    this.graphMgr.setRenderContext(rc);
}

Bridgeworks.prototype.updateScene = function(xml)
{
    var xmlString = new String(xml);
    var extension = xmlString.substr(xmlString.length - 3, 3);
    if (extension == "xml")
    {
        xml = loadXMLResource(this.contentDir + "/" + xml);
    }

    this.parser.parse(xml);
}

function Bridgeworks_OnLoadModifiedCB(attribute, container)
{
    container.onLoadModified();
}

/*! jQuery v1.10.2 | (c) 2005, 2013 jQuery Foundation, Inc. | jquery.org/license
 //@ sourceMappingURL=jquery-1.10.2.min.map
 */
(function (e, t) {
    var n, r, i = typeof t, o = e.location, a = e.document, s = a.documentElement, l = e.jQuery, u = e.$, c = {}, p = [], f = "1.10.2", d = p.concat, h = p.push, g = p.slice, m = p.indexOf, y = c.toString, v = c.hasOwnProperty, b = f.trim, x = function (e, t) {
        return new x.fn.init(e, t, r)
    }, w = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source, T = /\S+/g, C = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, N = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/, k = /^<(\w+)\s*\/?>(?:<\/\1>|)$/, E = /^[\],:{}\s]*$/, S = /(?:^|:|,)(?:\s*\[)+/g, A = /\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g, j = /"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g, D = /^-ms-/, L = /-([\da-z])/gi, H = function (e, t) {
        return t.toUpperCase()
    }, q = function (e) {
        (a.addEventListener || "load" === e.type || "complete" === a.readyState) && (_(), x.ready())
    }, _ = function () {
        a.addEventListener ? (a.removeEventListener("DOMContentLoaded", q, !1), e.removeEventListener("load", q, !1)) : (a.detachEvent("onreadystatechange", q), e.detachEvent("onload", q))
    };
    x.fn = x.prototype = {jquery: f, constructor: x, init: function (e, n, r) {
        var i, o;
        if (!e)return this;
        if ("string" == typeof e) {
            if (i = "<" === e.charAt(0) && ">" === e.charAt(e.length - 1) && e.length >= 3 ? [null, e, null] : N.exec(e), !i || !i[1] && n)return!n || n.jquery ? (n || r).find(e) : this.constructor(n).find(e);
            if (i[1]) {
                if (n = n instanceof x ? n[0] : n, x.merge(this, x.parseHTML(i[1], n && n.nodeType ? n.ownerDocument || n : a, !0)), k.test(i[1]) && x.isPlainObject(n))for (i in n)x.isFunction(this[i]) ? this[i](n[i]) : this.attr(i, n[i]);
                return this
            }
            if (o = a.getElementById(i[2]), o && o.parentNode) {
                if (o.id !== i[2])return r.find(e);
                this.length = 1, this[0] = o
            }
            return this.context = a, this.selector = e, this
        }
        return e.nodeType ? (this.context = this[0] = e, this.length = 1, this) : x.isFunction(e) ? r.ready(e) : (e.selector !== t && (this.selector = e.selector, this.context = e.context), x.makeArray(e, this))
    }, selector: "", length: 0, toArray: function () {
        return g.call(this)
    }, get: function (e) {
        return null == e ? this.toArray() : 0 > e ? this[this.length + e] : this[e]
    }, pushStack: function (e) {
        var t = x.merge(this.constructor(), e);
        return t.prevObject = this, t.context = this.context, t
    }, each: function (e, t) {
        return x.each(this, e, t)
    }, ready: function (e) {
        return x.ready.promise().done(e), this
    }, slice: function () {
        return this.pushStack(g.apply(this, arguments))
    }, first: function () {
        return this.eq(0)
    }, last: function () {
        return this.eq(-1)
    }, eq: function (e) {
        var t = this.length, n = +e + (0 > e ? t : 0);
        return this.pushStack(n >= 0 && t > n ? [this[n]] : [])
    }, map: function (e) {
        return this.pushStack(x.map(this, function (t, n) {
            return e.call(t, n, t)
        }))
    }, end: function () {
        return this.prevObject || this.constructor(null)
    }, push: h, sort: [].sort, splice: [].splice}, x.fn.init.prototype = x.fn, x.extend = x.fn.extend = function () {
        var e, n, r, i, o, a, s = arguments[0] || {}, l = 1, u = arguments.length, c = !1;
        for ("boolean" == typeof s && (c = s, s = arguments[1] || {}, l = 2), "object" == typeof s || x.isFunction(s) || (s = {}), u === l && (s = this, --l); u > l; l++)if (null != (o = arguments[l]))for (i in o)e = s[i], r = o[i], s !== r && (c && r && (x.isPlainObject(r) || (n = x.isArray(r))) ? (n ? (n = !1, a = e && x.isArray(e) ? e : []) : a = e && x.isPlainObject(e) ? e : {}, s[i] = x.extend(c, a, r)) : r !== t && (s[i] = r));
        return s
    }, x.extend({expando: "jQuery" + (f + Math.random()).replace(/\D/g, ""), noConflict: function (t) {
        return e.$ === x && (e.$ = u), t && e.jQuery === x && (e.jQuery = l), x
    }, isReady: !1, readyWait: 1, holdReady: function (e) {
        e ? x.readyWait++ : x.ready(!0)
    }, ready: function (e) {
        if (e === !0 ? !--x.readyWait : !x.isReady) {
            if (!a.body)return setTimeout(x.ready);
            x.isReady = !0, e !== !0 && --x.readyWait > 0 || (n.resolveWith(a, [x]), x.fn.trigger && x(a).trigger("ready").off("ready"))
        }
    }, isFunction: function (e) {
        return"function" === x.type(e)
    }, isArray: Array.isArray || function (e) {
        return"array" === x.type(e)
    }, isWindow: function (e) {
        return null != e && e == e.window
    }, isNumeric: function (e) {
        return!isNaN(parseFloat(e)) && isFinite(e)
    }, type: function (e) {
        return null == e ? e + "" : "object" == typeof e || "function" == typeof e ? c[y.call(e)] || "object" : typeof e
    }, isPlainObject: function (e) {
        var n;
        if (!e || "object" !== x.type(e) || e.nodeType || x.isWindow(e))return!1;
        try {
            if (e.constructor && !v.call(e, "constructor") && !v.call(e.constructor.prototype, "isPrototypeOf"))return!1
        } catch (r) {
            return!1
        }
        if (x.support.ownLast)for (n in e)return v.call(e, n);
        for (n in e);
        return n === t || v.call(e, n)
    }, isEmptyObject: function (e) {
        var t;
        for (t in e)return!1;
        return!0
    }, error: function (e) {
        throw Error(e)
    }, parseHTML: function (e, t, n) {
        if (!e || "string" != typeof e)return null;
        "boolean" == typeof t && (n = t, t = !1), t = t || a;
        var r = k.exec(e), i = !n && [];
        return r ? [t.createElement(r[1])] : (r = x.buildFragment([e], t, i), i && x(i).remove(), x.merge([], r.childNodes))
    }, parseJSON: function (n) {
        return e.JSON && e.JSON.parse ? e.JSON.parse(n) : null === n ? n : "string" == typeof n && (n = x.trim(n), n && E.test(n.replace(A, "@").replace(j, "]").replace(S, ""))) ? Function("return " + n)() : (x.error("Invalid JSON: " + n), t)
    }, parseXML: function (n) {
        var r, i;
        if (!n || "string" != typeof n)return null;
        try {
            e.DOMParser ? (i = new DOMParser, r = i.parseFromString(n, "text/xml")) : (r = new ActiveXObject("Microsoft.XMLDOM"), r.async = "false", r.loadXML(n))
        } catch (o) {
            r = t
        }
        return r && r.documentElement && !r.getElementsByTagName("parsererror").length || x.error("Invalid XML: " + n), r
    }, noop: function () {
    }, globalEval: function (t) {
        t && x.trim(t) && (e.execScript || function (t) {
            e.eval.call(e, t)
        })(t)
    }, camelCase: function (e) {
        return e.replace(D, "ms-").replace(L, H)
    }, nodeName: function (e, t) {
        return e.nodeName && e.nodeName.toLowerCase() === t.toLowerCase()
    }, each: function (e, t, n) {
        var r, i = 0, o = e.length, a = M(e);
        if (n) {
            if (a) {
                for (; o > i; i++)if (r = t.apply(e[i], n), r === !1)break
            } else for (i in e)if (r = t.apply(e[i], n), r === !1)break
        } else if (a) {
            for (; o > i; i++)if (r = t.call(e[i], i, e[i]), r === !1)break
        } else for (i in e)if (r = t.call(e[i], i, e[i]), r === !1)break;
        return e
    }, trim: b && !b.call("\ufeff\u00a0") ? function (e) {
        return null == e ? "" : b.call(e)
    } : function (e) {
        return null == e ? "" : (e + "").replace(C, "")
    }, makeArray: function (e, t) {
        var n = t || [];
        return null != e && (M(Object(e)) ? x.merge(n, "string" == typeof e ? [e] : e) : h.call(n, e)), n
    }, inArray: function (e, t, n) {
        var r;
        if (t) {
            if (m)return m.call(t, e, n);
            for (r = t.length, n = n ? 0 > n ? Math.max(0, r + n) : n : 0; r > n; n++)if (n in t && t[n] === e)return n
        }
        return-1
    }, merge: function (e, n) {
        var r = n.length, i = e.length, o = 0;
        if ("number" == typeof r)for (; r > o; o++)e[i++] = n[o]; else while (n[o] !== t)e[i++] = n[o++];
        return e.length = i, e
    }, grep: function (e, t, n) {
        var r, i = [], o = 0, a = e.length;
        for (n = !!n; a > o; o++)r = !!t(e[o], o), n !== r && i.push(e[o]);
        return i
    }, map: function (e, t, n) {
        var r, i = 0, o = e.length, a = M(e), s = [];
        if (a)for (; o > i; i++)r = t(e[i], i, n), null != r && (s[s.length] = r); else for (i in e)r = t(e[i], i, n), null != r && (s[s.length] = r);
        return d.apply([], s)
    }, guid: 1, proxy: function (e, n) {
        var r, i, o;
        return"string" == typeof n && (o = e[n], n = e, e = o), x.isFunction(e) ? (r = g.call(arguments, 2), i = function () {
            return e.apply(n || this, r.concat(g.call(arguments)))
        }, i.guid = e.guid = e.guid || x.guid++, i) : t
    }, access: function (e, n, r, i, o, a, s) {
        var l = 0, u = e.length, c = null == r;
        if ("object" === x.type(r)) {
            o = !0;
            for (l in r)x.access(e, n, l, r[l], !0, a, s)
        } else if (i !== t && (o = !0, x.isFunction(i) || (s = !0), c && (s ? (n.call(e, i), n = null) : (c = n, n = function (e, t, n) {
            return c.call(x(e), n)
        })), n))for (; u > l; l++)n(e[l], r, s ? i : i.call(e[l], l, n(e[l], r)));
        return o ? e : c ? n.call(e) : u ? n(e[0], r) : a
    }, now: function () {
        return(new Date).getTime()
    }, swap: function (e, t, n, r) {
        var i, o, a = {};
        for (o in t)a[o] = e.style[o], e.style[o] = t[o];
        i = n.apply(e, r || []);
        for (o in t)e.style[o] = a[o];
        return i
    }}), x.ready.promise = function (t) {
        if (!n)if (n = x.Deferred(), "complete" === a.readyState)setTimeout(x.ready); else if (a.addEventListener)a.addEventListener("DOMContentLoaded", q, !1), e.addEventListener("load", q, !1); else {
            a.attachEvent("onreadystatechange", q), e.attachEvent("onload", q);
            var r = !1;
            try {
                r = null == e.frameElement && a.documentElement
            } catch (i) {
            }
            r && r.doScroll && function o() {
                if (!x.isReady) {
                    try {
                        r.doScroll("left")
                    } catch (e) {
                        return setTimeout(o, 50)
                    }
                    _(), x.ready()
                }
            }()
        }
        return n.promise(t)
    }, x.each("Boolean Number String Function Array Date RegExp Object Error".split(" "), function (e, t) {
        c["[object " + t + "]"] = t.toLowerCase()
    });
    function M(e) {
        var t = e.length, n = x.type(e);
        return x.isWindow(e) ? !1 : 1 === e.nodeType && t ? !0 : "array" === n || "function" !== n && (0 === t || "number" == typeof t && t > 0 && t - 1 in e)
    }

    r = x(a), function (e, t) {
        var n, r, i, o, a, s, l, u, c, p, f, d, h, g, m, y, v, b = "sizzle" + -new Date, w = e.document, T = 0, C = 0, N = st(), k = st(), E = st(), S = !1, A = function (e, t) {
            return e === t ? (S = !0, 0) : 0
        }, j = typeof t, D = 1 << 31, L = {}.hasOwnProperty, H = [], q = H.pop, _ = H.push, M = H.push, O = H.slice, F = H.indexOf || function (e) {
            var t = 0, n = this.length;
            for (; n > t; t++)if (this[t] === e)return t;
            return-1
        }, B = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped", P = "[\\x20\\t\\r\\n\\f]", R = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+", W = R.replace("w", "w#"), $ = "\\[" + P + "*(" + R + ")" + P + "*(?:([*^$|!~]?=)" + P + "*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|(" + W + ")|)|)" + P + "*\\]", I = ":(" + R + ")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|" + $.replace(3, 8) + ")*)|.*)\\)|)", z = RegExp("^" + P + "+|((?:^|[^\\\\])(?:\\\\.)*)" + P + "+$", "g"), X = RegExp("^" + P + "*," + P + "*"), U = RegExp("^" + P + "*([>+~]|" + P + ")" + P + "*"), V = RegExp(P + "*[+~]"), Y = RegExp("=" + P + "*([^\\]'\"]*)" + P + "*\\]", "g"), J = RegExp(I), G = RegExp("^" + W + "$"), Q = {ID: RegExp("^#(" + R + ")"), CLASS: RegExp("^\\.(" + R + ")"), TAG: RegExp("^(" + R.replace("w", "w*") + ")"), ATTR: RegExp("^" + $), PSEUDO: RegExp("^" + I), CHILD: RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + P + "*(even|odd|(([+-]|)(\\d*)n|)" + P + "*(?:([+-]|)" + P + "*(\\d+)|))" + P + "*\\)|)", "i"), bool: RegExp("^(?:" + B + ")$", "i"), needsContext: RegExp("^" + P + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + P + "*((?:-\\d)?\\d*)" + P + "*\\)|)(?=[^-]|$)", "i")}, K = /^[^{]+\{\s*\[native \w/, Z = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, et = /^(?:input|select|textarea|button)$/i, tt = /^h\d$/i, nt = /'|\\/g, rt = RegExp("\\\\([\\da-f]{1,6}" + P + "?|(" + P + ")|.)", "ig"), it = function (e, t, n) {
            var r = "0x" + t - 65536;
            return r !== r || n ? t : 0 > r ? String.fromCharCode(r + 65536) : String.fromCharCode(55296 | r >> 10, 56320 | 1023 & r)
        };
        try {
            M.apply(H = O.call(w.childNodes), w.childNodes), H[w.childNodes.length].nodeType
        } catch (ot) {
            M = {apply: H.length ? function (e, t) {
                _.apply(e, O.call(t))
            } : function (e, t) {
                var n = e.length, r = 0;
                while (e[n++] = t[r++]);
                e.length = n - 1
            }}
        }
        function at(e, t, n, i) {
            var o, a, s, l, u, c, d, m, y, x;
            if ((t ? t.ownerDocument || t : w) !== f && p(t), t = t || f, n = n || [], !e || "string" != typeof e)return n;
            if (1 !== (l = t.nodeType) && 9 !== l)return[];
            if (h && !i) {
                if (o = Z.exec(e))if (s = o[1]) {
                    if (9 === l) {
                        if (a = t.getElementById(s), !a || !a.parentNode)return n;
                        if (a.id === s)return n.push(a), n
                    } else if (t.ownerDocument && (a = t.ownerDocument.getElementById(s)) && v(t, a) && a.id === s)return n.push(a), n
                } else {
                    if (o[2])return M.apply(n, t.getElementsByTagName(e)), n;
                    if ((s = o[3]) && r.getElementsByClassName && t.getElementsByClassName)return M.apply(n, t.getElementsByClassName(s)), n
                }
                if (r.qsa && (!g || !g.test(e))) {
                    if (m = d = b, y = t, x = 9 === l && e, 1 === l && "object" !== t.nodeName.toLowerCase()) {
                        c = mt(e), (d = t.getAttribute("id")) ? m = d.replace(nt, "\\$&") : t.setAttribute("id", m), m = "[id='" + m + "'] ", u = c.length;
                        while (u--)c[u] = m + yt(c[u]);
                        y = V.test(e) && t.parentNode || t, x = c.join(",")
                    }
                    if (x)try {
                        return M.apply(n, y.querySelectorAll(x)), n
                    } catch (T) {
                    } finally {
                        d || t.removeAttribute("id")
                    }
                }
            }
            return kt(e.replace(z, "$1"), t, n, i)
        }

        function st() {
            var e = [];

            function t(n, r) {
                return e.push(n += " ") > o.cacheLength && delete t[e.shift()], t[n] = r
            }

            return t
        }

        function lt(e) {
            return e[b] = !0, e
        }

        function ut(e) {
            var t = f.createElement("div");
            try {
                return!!e(t)
            } catch (n) {
                return!1
            } finally {
                t.parentNode && t.parentNode.removeChild(t), t = null
            }
        }

        function ct(e, t) {
            var n = e.split("|"), r = e.length;
            while (r--)o.attrHandle[n[r]] = t
        }

        function pt(e, t) {
            var n = t && e, r = n && 1 === e.nodeType && 1 === t.nodeType && (~t.sourceIndex || D) - (~e.sourceIndex || D);
            if (r)return r;
            if (n)while (n = n.nextSibling)if (n === t)return-1;
            return e ? 1 : -1
        }

        function ft(e) {
            return function (t) {
                var n = t.nodeName.toLowerCase();
                return"input" === n && t.type === e
            }
        }

        function dt(e) {
            return function (t) {
                var n = t.nodeName.toLowerCase();
                return("input" === n || "button" === n) && t.type === e
            }
        }

        function ht(e) {
            return lt(function (t) {
                return t = +t, lt(function (n, r) {
                    var i, o = e([], n.length, t), a = o.length;
                    while (a--)n[i = o[a]] && (n[i] = !(r[i] = n[i]))
                })
            })
        }

        s = at.isXML = function (e) {
            var t = e && (e.ownerDocument || e).documentElement;
            return t ? "HTML" !== t.nodeName : !1
        }, r = at.support = {}, p = at.setDocument = function (e) {
            var n = e ? e.ownerDocument || e : w, i = n.defaultView;
            return n !== f && 9 === n.nodeType && n.documentElement ? (f = n, d = n.documentElement, h = !s(n), i && i.attachEvent && i !== i.top && i.attachEvent("onbeforeunload", function () {
                p()
            }), r.attributes = ut(function (e) {
                return e.className = "i", !e.getAttribute("className")
            }), r.getElementsByTagName = ut(function (e) {
                return e.appendChild(n.createComment("")), !e.getElementsByTagName("*").length
            }), r.getElementsByClassName = ut(function (e) {
                return e.innerHTML = "<div class='a'></div><div class='a i'></div>", e.firstChild.className = "i", 2 === e.getElementsByClassName("i").length
            }), r.getById = ut(function (e) {
                return d.appendChild(e).id = b, !n.getElementsByName || !n.getElementsByName(b).length
            }), r.getById ? (o.find.ID = function (e, t) {
                if (typeof t.getElementById !== j && h) {
                    var n = t.getElementById(e);
                    return n && n.parentNode ? [n] : []
                }
            }, o.filter.ID = function (e) {
                var t = e.replace(rt, it);
                return function (e) {
                    return e.getAttribute("id") === t
                }
            }) : (delete o.find.ID, o.filter.ID = function (e) {
                var t = e.replace(rt, it);
                return function (e) {
                    var n = typeof e.getAttributeNode !== j && e.getAttributeNode("id");
                    return n && n.value === t
                }
            }), o.find.TAG = r.getElementsByTagName ? function (e, n) {
                return typeof n.getElementsByTagName !== j ? n.getElementsByTagName(e) : t
            } : function (e, t) {
                var n, r = [], i = 0, o = t.getElementsByTagName(e);
                if ("*" === e) {
                    while (n = o[i++])1 === n.nodeType && r.push(n);
                    return r
                }
                return o
            }, o.find.CLASS = r.getElementsByClassName && function (e, n) {
                return typeof n.getElementsByClassName !== j && h ? n.getElementsByClassName(e) : t
            }, m = [], g = [], (r.qsa = K.test(n.querySelectorAll)) && (ut(function (e) {
                e.innerHTML = "<select><option selected=''></option></select>", e.querySelectorAll("[selected]").length || g.push("\\[" + P + "*(?:value|" + B + ")"), e.querySelectorAll(":checked").length || g.push(":checked")
            }), ut(function (e) {
                var t = n.createElement("input");
                t.setAttribute("type", "hidden"), e.appendChild(t).setAttribute("t", ""), e.querySelectorAll("[t^='']").length && g.push("[*^$]=" + P + "*(?:''|\"\")"), e.querySelectorAll(":enabled").length || g.push(":enabled", ":disabled"), e.querySelectorAll("*,:x"), g.push(",.*:")
            })), (r.matchesSelector = K.test(y = d.webkitMatchesSelector || d.mozMatchesSelector || d.oMatchesSelector || d.msMatchesSelector)) && ut(function (e) {
                r.disconnectedMatch = y.call(e, "div"), y.call(e, "[s!='']:x"), m.push("!=", I)
            }), g = g.length && RegExp(g.join("|")), m = m.length && RegExp(m.join("|")), v = K.test(d.contains) || d.compareDocumentPosition ? function (e, t) {
                var n = 9 === e.nodeType ? e.documentElement : e, r = t && t.parentNode;
                return e === r || !(!r || 1 !== r.nodeType || !(n.contains ? n.contains(r) : e.compareDocumentPosition && 16 & e.compareDocumentPosition(r)))
            } : function (e, t) {
                if (t)while (t = t.parentNode)if (t === e)return!0;
                return!1
            }, A = d.compareDocumentPosition ? function (e, t) {
                if (e === t)return S = !0, 0;
                var i = t.compareDocumentPosition && e.compareDocumentPosition && e.compareDocumentPosition(t);
                return i ? 1 & i || !r.sortDetached && t.compareDocumentPosition(e) === i ? e === n || v(w, e) ? -1 : t === n || v(w, t) ? 1 : c ? F.call(c, e) - F.call(c, t) : 0 : 4 & i ? -1 : 1 : e.compareDocumentPosition ? -1 : 1
            } : function (e, t) {
                var r, i = 0, o = e.parentNode, a = t.parentNode, s = [e], l = [t];
                if (e === t)return S = !0, 0;
                if (!o || !a)return e === n ? -1 : t === n ? 1 : o ? -1 : a ? 1 : c ? F.call(c, e) - F.call(c, t) : 0;
                if (o === a)return pt(e, t);
                r = e;
                while (r = r.parentNode)s.unshift(r);
                r = t;
                while (r = r.parentNode)l.unshift(r);
                while (s[i] === l[i])i++;
                return i ? pt(s[i], l[i]) : s[i] === w ? -1 : l[i] === w ? 1 : 0
            }, n) : f
        }, at.matches = function (e, t) {
            return at(e, null, null, t)
        }, at.matchesSelector = function (e, t) {
            if ((e.ownerDocument || e) !== f && p(e), t = t.replace(Y, "='$1']"), !(!r.matchesSelector || !h || m && m.test(t) || g && g.test(t)))try {
                var n = y.call(e, t);
                if (n || r.disconnectedMatch || e.document && 11 !== e.document.nodeType)return n
            } catch (i) {
            }
            return at(t, f, null, [e]).length > 0
        }, at.contains = function (e, t) {
            return(e.ownerDocument || e) !== f && p(e), v(e, t)
        }, at.attr = function (e, n) {
            (e.ownerDocument || e) !== f && p(e);
            var i = o.attrHandle[n.toLowerCase()], a = i && L.call(o.attrHandle, n.toLowerCase()) ? i(e, n, !h) : t;
            return a === t ? r.attributes || !h ? e.getAttribute(n) : (a = e.getAttributeNode(n)) && a.specified ? a.value : null : a
        }, at.error = function (e) {
            throw Error("Syntax error, unrecognized expression: " + e)
        }, at.uniqueSort = function (e) {
            var t, n = [], i = 0, o = 0;
            if (S = !r.detectDuplicates, c = !r.sortStable && e.slice(0), e.sort(A), S) {
                while (t = e[o++])t === e[o] && (i = n.push(o));
                while (i--)e.splice(n[i], 1)
            }
            return e
        }, a = at.getText = function (e) {
            var t, n = "", r = 0, i = e.nodeType;
            if (i) {
                if (1 === i || 9 === i || 11 === i) {
                    if ("string" == typeof e.textContent)return e.textContent;
                    for (e = e.firstChild; e; e = e.nextSibling)n += a(e)
                } else if (3 === i || 4 === i)return e.nodeValue
            } else for (; t = e[r]; r++)n += a(t);
            return n
        }, o = at.selectors = {cacheLength: 50, createPseudo: lt, match: Q, attrHandle: {}, find: {}, relative: {">": {dir: "parentNode", first: !0}, " ": {dir: "parentNode"}, "+": {dir: "previousSibling", first: !0}, "~": {dir: "previousSibling"}}, preFilter: {ATTR: function (e) {
            return e[1] = e[1].replace(rt, it), e[3] = (e[4] || e[5] || "").replace(rt, it), "~=" === e[2] && (e[3] = " " + e[3] + " "), e.slice(0, 4)
        }, CHILD: function (e) {
            return e[1] = e[1].toLowerCase(), "nth" === e[1].slice(0, 3) ? (e[3] || at.error(e[0]), e[4] = +(e[4] ? e[5] + (e[6] || 1) : 2 * ("even" === e[3] || "odd" === e[3])), e[5] = +(e[7] + e[8] || "odd" === e[3])) : e[3] && at.error(e[0]), e
        }, PSEUDO: function (e) {
            var n, r = !e[5] && e[2];
            return Q.CHILD.test(e[0]) ? null : (e[3] && e[4] !== t ? e[2] = e[4] : r && J.test(r) && (n = mt(r, !0)) && (n = r.indexOf(")", r.length - n) - r.length) && (e[0] = e[0].slice(0, n), e[2] = r.slice(0, n)), e.slice(0, 3))
        }}, filter: {TAG: function (e) {
            var t = e.replace(rt, it).toLowerCase();
            return"*" === e ? function () {
                return!0
            } : function (e) {
                return e.nodeName && e.nodeName.toLowerCase() === t
            }
        }, CLASS: function (e) {
            var t = N[e + " "];
            return t || (t = RegExp("(^|" + P + ")" + e + "(" + P + "|$)")) && N(e, function (e) {
                return t.test("string" == typeof e.className && e.className || typeof e.getAttribute !== j && e.getAttribute("class") || "")
            })
        }, ATTR: function (e, t, n) {
            return function (r) {
                var i = at.attr(r, e);
                return null == i ? "!=" === t : t ? (i += "", "=" === t ? i === n : "!=" === t ? i !== n : "^=" === t ? n && 0 === i.indexOf(n) : "*=" === t ? n && i.indexOf(n) > -1 : "$=" === t ? n && i.slice(-n.length) === n : "~=" === t ? (" " + i + " ").indexOf(n) > -1 : "|=" === t ? i === n || i.slice(0, n.length + 1) === n + "-" : !1) : !0
            }
        }, CHILD: function (e, t, n, r, i) {
            var o = "nth" !== e.slice(0, 3), a = "last" !== e.slice(-4), s = "of-type" === t;
            return 1 === r && 0 === i ? function (e) {
                return!!e.parentNode
            } : function (t, n, l) {
                var u, c, p, f, d, h, g = o !== a ? "nextSibling" : "previousSibling", m = t.parentNode, y = s && t.nodeName.toLowerCase(), v = !l && !s;
                if (m) {
                    if (o) {
                        while (g) {
                            p = t;
                            while (p = p[g])if (s ? p.nodeName.toLowerCase() === y : 1 === p.nodeType)return!1;
                            h = g = "only" === e && !h && "nextSibling"
                        }
                        return!0
                    }
                    if (h = [a ? m.firstChild : m.lastChild], a && v) {
                        c = m[b] || (m[b] = {}), u = c[e] || [], d = u[0] === T && u[1], f = u[0] === T && u[2], p = d && m.childNodes[d];
                        while (p = ++d && p && p[g] || (f = d = 0) || h.pop())if (1 === p.nodeType && ++f && p === t) {
                            c[e] = [T, d, f];
                            break
                        }
                    } else if (v && (u = (t[b] || (t[b] = {}))[e]) && u[0] === T)f = u[1]; else while (p = ++d && p && p[g] || (f = d = 0) || h.pop())if ((s ? p.nodeName.toLowerCase() === y : 1 === p.nodeType) && ++f && (v && ((p[b] || (p[b] = {}))[e] = [T, f]), p === t))break;
                    return f -= i, f === r || 0 === f % r && f / r >= 0
                }
            }
        }, PSEUDO: function (e, t) {
            var n, r = o.pseudos[e] || o.setFilters[e.toLowerCase()] || at.error("unsupported pseudo: " + e);
            return r[b] ? r(t) : r.length > 1 ? (n = [e, e, "", t], o.setFilters.hasOwnProperty(e.toLowerCase()) ? lt(function (e, n) {
                var i, o = r(e, t), a = o.length;
                while (a--)i = F.call(e, o[a]), e[i] = !(n[i] = o[a])
            }) : function (e) {
                return r(e, 0, n)
            }) : r
        }}, pseudos: {not: lt(function (e) {
            var t = [], n = [], r = l(e.replace(z, "$1"));
            return r[b] ? lt(function (e, t, n, i) {
                var o, a = r(e, null, i, []), s = e.length;
                while (s--)(o = a[s]) && (e[s] = !(t[s] = o))
            }) : function (e, i, o) {
                return t[0] = e, r(t, null, o, n), !n.pop()
            }
        }), has: lt(function (e) {
            return function (t) {
                return at(e, t).length > 0
            }
        }), contains: lt(function (e) {
            return function (t) {
                return(t.textContent || t.innerText || a(t)).indexOf(e) > -1
            }
        }), lang: lt(function (e) {
            return G.test(e || "") || at.error("unsupported lang: " + e), e = e.replace(rt, it).toLowerCase(), function (t) {
                var n;
                do if (n = h ? t.lang : t.getAttribute("xml:lang") || t.getAttribute("lang"))return n = n.toLowerCase(), n === e || 0 === n.indexOf(e + "-"); while ((t = t.parentNode) && 1 === t.nodeType);
                return!1
            }
        }), target: function (t) {
            var n = e.location && e.location.hash;
            return n && n.slice(1) === t.id
        }, root: function (e) {
            return e === d
        }, focus: function (e) {
            return e === f.activeElement && (!f.hasFocus || f.hasFocus()) && !!(e.type || e.href || ~e.tabIndex)
        }, enabled: function (e) {
            return e.disabled === !1
        }, disabled: function (e) {
            return e.disabled === !0
        }, checked: function (e) {
            var t = e.nodeName.toLowerCase();
            return"input" === t && !!e.checked || "option" === t && !!e.selected
        }, selected: function (e) {
            return e.parentNode && e.parentNode.selectedIndex, e.selected === !0
        }, empty: function (e) {
            for (e = e.firstChild; e; e = e.nextSibling)if (e.nodeName > "@" || 3 === e.nodeType || 4 === e.nodeType)return!1;
            return!0
        }, parent: function (e) {
            return!o.pseudos.empty(e)
        }, header: function (e) {
            return tt.test(e.nodeName)
        }, input: function (e) {
            return et.test(e.nodeName)
        }, button: function (e) {
            var t = e.nodeName.toLowerCase();
            return"input" === t && "button" === e.type || "button" === t
        }, text: function (e) {
            var t;
            return"input" === e.nodeName.toLowerCase() && "text" === e.type && (null == (t = e.getAttribute("type")) || t.toLowerCase() === e.type)
        }, first: ht(function () {
            return[0]
        }), last: ht(function (e, t) {
            return[t - 1]
        }), eq: ht(function (e, t, n) {
            return[0 > n ? n + t : n]
        }), even: ht(function (e, t) {
            var n = 0;
            for (; t > n; n += 2)e.push(n);
            return e
        }), odd: ht(function (e, t) {
            var n = 1;
            for (; t > n; n += 2)e.push(n);
            return e
        }), lt: ht(function (e, t, n) {
            var r = 0 > n ? n + t : n;
            for (; --r >= 0;)e.push(r);
            return e
        }), gt: ht(function (e, t, n) {
            var r = 0 > n ? n + t : n;
            for (; t > ++r;)e.push(r);
            return e
        })}}, o.pseudos.nth = o.pseudos.eq;
        for (n in{radio: !0, checkbox: !0, file: !0, password: !0, image: !0})o.pseudos[n] = ft(n);
        for (n in{submit: !0, reset: !0})o.pseudos[n] = dt(n);
        function gt() {
        }

        gt.prototype = o.filters = o.pseudos, o.setFilters = new gt;
        function mt(e, t) {
            var n, r, i, a, s, l, u, c = k[e + " "];
            if (c)return t ? 0 : c.slice(0);
            s = e, l = [], u = o.preFilter;
            while (s) {
                (!n || (r = X.exec(s))) && (r && (s = s.slice(r[0].length) || s), l.push(i = [])), n = !1, (r = U.exec(s)) && (n = r.shift(), i.push({value: n, type: r[0].replace(z, " ")}), s = s.slice(n.length));
                for (a in o.filter)!(r = Q[a].exec(s)) || u[a] && !(r = u[a](r)) || (n = r.shift(), i.push({value: n, type: a, matches: r}), s = s.slice(n.length));
                if (!n)break
            }
            return t ? s.length : s ? at.error(e) : k(e, l).slice(0)
        }

        function yt(e) {
            var t = 0, n = e.length, r = "";
            for (; n > t; t++)r += e[t].value;
            return r
        }

        function vt(e, t, n) {
            var r = t.dir, o = n && "parentNode" === r, a = C++;
            return t.first ? function (t, n, i) {
                while (t = t[r])if (1 === t.nodeType || o)return e(t, n, i)
            } : function (t, n, s) {
                var l, u, c, p = T + " " + a;
                if (s) {
                    while (t = t[r])if ((1 === t.nodeType || o) && e(t, n, s))return!0
                } else while (t = t[r])if (1 === t.nodeType || o)if (c = t[b] || (t[b] = {}), (u = c[r]) && u[0] === p) {
                    if ((l = u[1]) === !0 || l === i)return l === !0
                } else if (u = c[r] = [p], u[1] = e(t, n, s) || i, u[1] === !0)return!0
            }
        }

        function bt(e) {
            return e.length > 1 ? function (t, n, r) {
                var i = e.length;
                while (i--)if (!e[i](t, n, r))return!1;
                return!0
            } : e[0]
        }

        function xt(e, t, n, r, i) {
            var o, a = [], s = 0, l = e.length, u = null != t;
            for (; l > s; s++)(o = e[s]) && (!n || n(o, r, i)) && (a.push(o), u && t.push(s));
            return a
        }

        function wt(e, t, n, r, i, o) {
            return r && !r[b] && (r = wt(r)), i && !i[b] && (i = wt(i, o)), lt(function (o, a, s, l) {
                var u, c, p, f = [], d = [], h = a.length, g = o || Nt(t || "*", s.nodeType ? [s] : s, []), m = !e || !o && t ? g : xt(g, f, e, s, l), y = n ? i || (o ? e : h || r) ? [] : a : m;
                if (n && n(m, y, s, l), r) {
                    u = xt(y, d), r(u, [], s, l), c = u.length;
                    while (c--)(p = u[c]) && (y[d[c]] = !(m[d[c]] = p))
                }
                if (o) {
                    if (i || e) {
                        if (i) {
                            u = [], c = y.length;
                            while (c--)(p = y[c]) && u.push(m[c] = p);
                            i(null, y = [], u, l)
                        }
                        c = y.length;
                        while (c--)(p = y[c]) && (u = i ? F.call(o, p) : f[c]) > -1 && (o[u] = !(a[u] = p))
                    }
                } else y = xt(y === a ? y.splice(h, y.length) : y), i ? i(null, a, y, l) : M.apply(a, y)
            })
        }

        function Tt(e) {
            var t, n, r, i = e.length, a = o.relative[e[0].type], s = a || o.relative[" "], l = a ? 1 : 0, c = vt(function (e) {
                return e === t
            }, s, !0), p = vt(function (e) {
                return F.call(t, e) > -1
            }, s, !0), f = [function (e, n, r) {
                return!a && (r || n !== u) || ((t = n).nodeType ? c(e, n, r) : p(e, n, r))
            }];
            for (; i > l; l++)if (n = o.relative[e[l].type])f = [vt(bt(f), n)]; else {
                if (n = o.filter[e[l].type].apply(null, e[l].matches), n[b]) {
                    for (r = ++l; i > r; r++)if (o.relative[e[r].type])break;
                    return wt(l > 1 && bt(f), l > 1 && yt(e.slice(0, l - 1).concat({value: " " === e[l - 2].type ? "*" : ""})).replace(z, "$1"), n, r > l && Tt(e.slice(l, r)), i > r && Tt(e = e.slice(r)), i > r && yt(e))
                }
                f.push(n)
            }
            return bt(f)
        }

        function Ct(e, t) {
            var n = 0, r = t.length > 0, a = e.length > 0, s = function (s, l, c, p, d) {
                var h, g, m, y = [], v = 0, b = "0", x = s && [], w = null != d, C = u, N = s || a && o.find.TAG("*", d && l.parentNode || l), k = T += null == C ? 1 : Math.random() || .1;
                for (w && (u = l !== f && l, i = n); null != (h = N[b]); b++) {
                    if (a && h) {
                        g = 0;
                        while (m = e[g++])if (m(h, l, c)) {
                            p.push(h);
                            break
                        }
                        w && (T = k, i = ++n)
                    }
                    r && ((h = !m && h) && v--, s && x.push(h))
                }
                if (v += b, r && b !== v) {
                    g = 0;
                    while (m = t[g++])m(x, y, l, c);
                    if (s) {
                        if (v > 0)while (b--)x[b] || y[b] || (y[b] = q.call(p));
                        y = xt(y)
                    }
                    M.apply(p, y), w && !s && y.length > 0 && v + t.length > 1 && at.uniqueSort(p)
                }
                return w && (T = k, u = C), x
            };
            return r ? lt(s) : s
        }

        l = at.compile = function (e, t) {
            var n, r = [], i = [], o = E[e + " "];
            if (!o) {
                t || (t = mt(e)), n = t.length;
                while (n--)o = Tt(t[n]), o[b] ? r.push(o) : i.push(o);
                o = E(e, Ct(i, r))
            }
            return o
        };
        function Nt(e, t, n) {
            var r = 0, i = t.length;
            for (; i > r; r++)at(e, t[r], n);
            return n
        }

        function kt(e, t, n, i) {
            var a, s, u, c, p, f = mt(e);
            if (!i && 1 === f.length) {
                if (s = f[0] = f[0].slice(0), s.length > 2 && "ID" === (u = s[0]).type && r.getById && 9 === t.nodeType && h && o.relative[s[1].type]) {
                    if (t = (o.find.ID(u.matches[0].replace(rt, it), t) || [])[0], !t)return n;
                    e = e.slice(s.shift().value.length)
                }
                a = Q.needsContext.test(e) ? 0 : s.length;
                while (a--) {
                    if (u = s[a], o.relative[c = u.type])break;
                    if ((p = o.find[c]) && (i = p(u.matches[0].replace(rt, it), V.test(s[0].type) && t.parentNode || t))) {
                        if (s.splice(a, 1), e = i.length && yt(s), !e)return M.apply(n, i), n;
                        break
                    }
                }
            }
            return l(e, f)(i, t, !h, n, V.test(e)), n
        }

        r.sortStable = b.split("").sort(A).join("") === b, r.detectDuplicates = S, p(), r.sortDetached = ut(function (e) {
            return 1 & e.compareDocumentPosition(f.createElement("div"))
        }), ut(function (e) {
            return e.innerHTML = "<a href='#'></a>", "#" === e.firstChild.getAttribute("href")
        }) || ct("type|href|height|width", function (e, n, r) {
            return r ? t : e.getAttribute(n, "type" === n.toLowerCase() ? 1 : 2)
        }), r.attributes && ut(function (e) {
            return e.innerHTML = "<input/>", e.firstChild.setAttribute("value", ""), "" === e.firstChild.getAttribute("value")
        }) || ct("value", function (e, n, r) {
            return r || "input" !== e.nodeName.toLowerCase() ? t : e.defaultValue
        }), ut(function (e) {
            return null == e.getAttribute("disabled")
        }) || ct(B, function (e, n, r) {
            var i;
            return r ? t : (i = e.getAttributeNode(n)) && i.specified ? i.value : e[n] === !0 ? n.toLowerCase() : null
        }), x.find = at, x.expr = at.selectors, x.expr[":"] = x.expr.pseudos, x.unique = at.uniqueSort, x.text = at.getText, x.isXMLDoc = at.isXML, x.contains = at.contains
    }(e);
    var O = {};

    function F(e) {
        var t = O[e] = {};
        return x.each(e.match(T) || [], function (e, n) {
            t[n] = !0
        }), t
    }

    x.Callbacks = function (e) {
        e = "string" == typeof e ? O[e] || F(e) : x.extend({}, e);
        var n, r, i, o, a, s, l = [], u = !e.once && [], c = function (t) {
            for (r = e.memory && t, i = !0, a = s || 0, s = 0, o = l.length, n = !0; l && o > a; a++)if (l[a].apply(t[0], t[1]) === !1 && e.stopOnFalse) {
                r = !1;
                break
            }
            n = !1, l && (u ? u.length && c(u.shift()) : r ? l = [] : p.disable())
        }, p = {add: function () {
            if (l) {
                var t = l.length;
                (function i(t) {
                    x.each(t, function (t, n) {
                        var r = x.type(n);
                        "function" === r ? e.unique && p.has(n) || l.push(n) : n && n.length && "string" !== r && i(n)
                    })
                })(arguments), n ? o = l.length : r && (s = t, c(r))
            }
            return this
        }, remove: function () {
            return l && x.each(arguments, function (e, t) {
                var r;
                while ((r = x.inArray(t, l, r)) > -1)l.splice(r, 1), n && (o >= r && o--, a >= r && a--)
            }), this
        }, has: function (e) {
            return e ? x.inArray(e, l) > -1 : !(!l || !l.length)
        }, empty: function () {
            return l = [], o = 0, this
        }, disable: function () {
            return l = u = r = t, this
        }, disabled: function () {
            return!l
        }, lock: function () {
            return u = t, r || p.disable(), this
        }, locked: function () {
            return!u
        }, fireWith: function (e, t) {
            return!l || i && !u || (t = t || [], t = [e, t.slice ? t.slice() : t], n ? u.push(t) : c(t)), this
        }, fire: function () {
            return p.fireWith(this, arguments), this
        }, fired: function () {
            return!!i
        }};
        return p
    }, x.extend({Deferred: function (e) {
        var t = [
            ["resolve", "done", x.Callbacks("once memory"), "resolved"],
            ["reject", "fail", x.Callbacks("once memory"), "rejected"],
            ["notify", "progress", x.Callbacks("memory")]
        ], n = "pending", r = {state: function () {
            return n
        }, always: function () {
            return i.done(arguments).fail(arguments), this
        }, then: function () {
            var e = arguments;
            return x.Deferred(function (n) {
                x.each(t, function (t, o) {
                    var a = o[0], s = x.isFunction(e[t]) && e[t];
                    i[o[1]](function () {
                        var e = s && s.apply(this, arguments);
                        e && x.isFunction(e.promise) ? e.promise().done(n.resolve).fail(n.reject).progress(n.notify) : n[a + "With"](this === r ? n.promise() : this, s ? [e] : arguments)
                    })
                }), e = null
            }).promise()
        }, promise: function (e) {
            return null != e ? x.extend(e, r) : r
        }}, i = {};
        return r.pipe = r.then, x.each(t, function (e, o) {
            var a = o[2], s = o[3];
            r[o[1]] = a.add, s && a.add(function () {
                n = s
            }, t[1 ^ e][2].disable, t[2][2].lock), i[o[0]] = function () {
                return i[o[0] + "With"](this === i ? r : this, arguments), this
            }, i[o[0] + "With"] = a.fireWith
        }), r.promise(i), e && e.call(i, i), i
    }, when: function (e) {
        var t = 0, n = g.call(arguments), r = n.length, i = 1 !== r || e && x.isFunction(e.promise) ? r : 0, o = 1 === i ? e : x.Deferred(), a = function (e, t, n) {
            return function (r) {
                t[e] = this, n[e] = arguments.length > 1 ? g.call(arguments) : r, n === s ? o.notifyWith(t, n) : --i || o.resolveWith(t, n)
            }
        }, s, l, u;
        if (r > 1)for (s = Array(r), l = Array(r), u = Array(r); r > t; t++)n[t] && x.isFunction(n[t].promise) ? n[t].promise().done(a(t, u, n)).fail(o.reject).progress(a(t, l, s)) : --i;
        return i || o.resolveWith(u, n), o.promise()
    }}), x.support = function (t) {
        var n, r, o, s, l, u, c, p, f, d = a.createElement("div");
        if (d.setAttribute("className", "t"), d.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>", n = d.getElementsByTagName("*") || [], r = d.getElementsByTagName("a")[0], !r || !r.style || !n.length)return t;
        s = a.createElement("select"), u = s.appendChild(a.createElement("option")), o = d.getElementsByTagName("input")[0], r.style.cssText = "top:1px;float:left;opacity:.5", t.getSetAttribute = "t" !== d.className, t.leadingWhitespace = 3 === d.firstChild.nodeType, t.tbody = !d.getElementsByTagName("tbody").length, t.htmlSerialize = !!d.getElementsByTagName("link").length, t.style = /top/.test(r.getAttribute("style")), t.hrefNormalized = "/a" === r.getAttribute("href"), t.opacity = /^0.5/.test(r.style.opacity), t.cssFloat = !!r.style.cssFloat, t.checkOn = !!o.value, t.optSelected = u.selected, t.enctype = !!a.createElement("form").enctype, t.html5Clone = "<:nav></:nav>" !== a.createElement("nav").cloneNode(!0).outerHTML, t.inlineBlockNeedsLayout = !1, t.shrinkWrapBlocks = !1, t.pixelPosition = !1, t.deleteExpando = !0, t.noCloneEvent = !0, t.reliableMarginRight = !0, t.boxSizingReliable = !0, o.checked = !0, t.noCloneChecked = o.cloneNode(!0).checked, s.disabled = !0, t.optDisabled = !u.disabled;
        try {
            delete d.test
        } catch (h) {
            t.deleteExpando = !1
        }
        o = a.createElement("input"), o.setAttribute("value", ""), t.input = "" === o.getAttribute("value"), o.value = "t", o.setAttribute("type", "radio"), t.radioValue = "t" === o.value, o.setAttribute("checked", "t"), o.setAttribute("name", "t"), l = a.createDocumentFragment(), l.appendChild(o), t.appendChecked = o.checked, t.checkClone = l.cloneNode(!0).cloneNode(!0).lastChild.checked, d.attachEvent && (d.attachEvent("onclick", function () {
            t.noCloneEvent = !1
        }), d.cloneNode(!0).click());
        for (f in{submit: !0, change: !0, focusin: !0})d.setAttribute(c = "on" + f, "t"), t[f + "Bubbles"] = c in e || d.attributes[c].expando === !1;
        d.style.backgroundClip = "content-box", d.cloneNode(!0).style.backgroundClip = "", t.clearCloneStyle = "content-box" === d.style.backgroundClip;
        for (f in x(t))break;
        return t.ownLast = "0" !== f, x(function () {
            var n, r, o, s = "padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;", l = a.getElementsByTagName("body")[0];
            l && (n = a.createElement("div"), n.style.cssText = "border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px", l.appendChild(n).appendChild(d), d.innerHTML = "<table><tr><td></td><td>t</td></tr></table>", o = d.getElementsByTagName("td"), o[0].style.cssText = "padding:0;margin:0;border:0;display:none", p = 0 === o[0].offsetHeight, o[0].style.display = "", o[1].style.display = "none", t.reliableHiddenOffsets = p && 0 === o[0].offsetHeight, d.innerHTML = "", d.style.cssText = "box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;", x.swap(l, null != l.style.zoom ? {zoom: 1} : {}, function () {
                t.boxSizing = 4 === d.offsetWidth
            }), e.getComputedStyle && (t.pixelPosition = "1%" !== (e.getComputedStyle(d, null) || {}).top, t.boxSizingReliable = "4px" === (e.getComputedStyle(d, null) || {width: "4px"}).width, r = d.appendChild(a.createElement("div")), r.style.cssText = d.style.cssText = s, r.style.marginRight = r.style.width = "0", d.style.width = "1px", t.reliableMarginRight = !parseFloat((e.getComputedStyle(r, null) || {}).marginRight)), typeof d.style.zoom !== i && (d.innerHTML = "", d.style.cssText = s + "width:1px;padding:1px;display:inline;zoom:1", t.inlineBlockNeedsLayout = 3 === d.offsetWidth, d.style.display = "block", d.innerHTML = "<div></div>", d.firstChild.style.width = "5px", t.shrinkWrapBlocks = 3 !== d.offsetWidth, t.inlineBlockNeedsLayout && (l.style.zoom = 1)), l.removeChild(n), n = d = o = r = null)
        }), n = s = l = u = r = o = null, t
    }({});
    var B = /(?:\{[\s\S]*\}|\[[\s\S]*\])$/, P = /([A-Z])/g;

    function R(e, n, r, i) {
        if (x.acceptData(e)) {
            var o, a, s = x.expando, l = e.nodeType, u = l ? x.cache : e, c = l ? e[s] : e[s] && s;
            if (c && u[c] && (i || u[c].data) || r !== t || "string" != typeof n)return c || (c = l ? e[s] = p.pop() || x.guid++ : s), u[c] || (u[c] = l ? {} : {toJSON: x.noop}), ("object" == typeof n || "function" == typeof n) && (i ? u[c] = x.extend(u[c], n) : u[c].data = x.extend(u[c].data, n)), a = u[c], i || (a.data || (a.data = {}), a = a.data), r !== t && (a[x.camelCase(n)] = r), "string" == typeof n ? (o = a[n], null == o && (o = a[x.camelCase(n)])) : o = a, o
        }
    }

    function W(e, t, n) {
        if (x.acceptData(e)) {
            var r, i, o = e.nodeType, a = o ? x.cache : e, s = o ? e[x.expando] : x.expando;
            if (a[s]) {
                if (t && (r = n ? a[s] : a[s].data)) {
                    x.isArray(t) ? t = t.concat(x.map(t, x.camelCase)) : t in r ? t = [t] : (t = x.camelCase(t), t = t in r ? [t] : t.split(" ")), i = t.length;
                    while (i--)delete r[t[i]];
                    if (n ? !I(r) : !x.isEmptyObject(r))return
                }
                (n || (delete a[s].data, I(a[s]))) && (o ? x.cleanData([e], !0) : x.support.deleteExpando || a != a.window ? delete a[s] : a[s] = null)
            }
        }
    }

    x.extend({cache: {}, noData: {applet: !0, embed: !0, object: "clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"}, hasData: function (e) {
        return e = e.nodeType ? x.cache[e[x.expando]] : e[x.expando], !!e && !I(e)
    }, data: function (e, t, n) {
        return R(e, t, n)
    }, removeData: function (e, t) {
        return W(e, t)
    }, _data: function (e, t, n) {
        return R(e, t, n, !0)
    }, _removeData: function (e, t) {
        return W(e, t, !0)
    }, acceptData: function (e) {
        if (e.nodeType && 1 !== e.nodeType && 9 !== e.nodeType)return!1;
        var t = e.nodeName && x.noData[e.nodeName.toLowerCase()];
        return!t || t !== !0 && e.getAttribute("classid") === t
    }}), x.fn.extend({data: function (e, n) {
        var r, i, o = null, a = 0, s = this[0];
        if (e === t) {
            if (this.length && (o = x.data(s), 1 === s.nodeType && !x._data(s, "parsedAttrs"))) {
                for (r = s.attributes; r.length > a; a++)i = r[a].name, 0 === i.indexOf("data-") && (i = x.camelCase(i.slice(5)), $(s, i, o[i]));
                x._data(s, "parsedAttrs", !0)
            }
            return o
        }
        return"object" == typeof e ? this.each(function () {
            x.data(this, e)
        }) : arguments.length > 1 ? this.each(function () {
            x.data(this, e, n)
        }) : s ? $(s, e, x.data(s, e)) : null
    }, removeData: function (e) {
        return this.each(function () {
            x.removeData(this, e)
        })
    }});
    function $(e, n, r) {
        if (r === t && 1 === e.nodeType) {
            var i = "data-" + n.replace(P, "-$1").toLowerCase();
            if (r = e.getAttribute(i), "string" == typeof r) {
                try {
                    r = "true" === r ? !0 : "false" === r ? !1 : "null" === r ? null : +r + "" === r ? +r : B.test(r) ? x.parseJSON(r) : r
                } catch (o) {
                }
                x.data(e, n, r)
            } else r = t
        }
        return r
    }

    function I(e) {
        var t;
        for (t in e)if (("data" !== t || !x.isEmptyObject(e[t])) && "toJSON" !== t)return!1;
        return!0
    }

    x.extend({queue: function (e, n, r) {
        var i;
        return e ? (n = (n || "fx") + "queue", i = x._data(e, n), r && (!i || x.isArray(r) ? i = x._data(e, n, x.makeArray(r)) : i.push(r)), i || []) : t
    }, dequeue: function (e, t) {
        t = t || "fx";
        var n = x.queue(e, t), r = n.length, i = n.shift(), o = x._queueHooks(e, t), a = function () {
            x.dequeue(e, t)
        };
        "inprogress" === i && (i = n.shift(), r--), i && ("fx" === t && n.unshift("inprogress"), delete o.stop, i.call(e, a, o)), !r && o && o.empty.fire()
    }, _queueHooks: function (e, t) {
        var n = t + "queueHooks";
        return x._data(e, n) || x._data(e, n, {empty: x.Callbacks("once memory").add(function () {
            x._removeData(e, t + "queue"), x._removeData(e, n)
        })})
    }}), x.fn.extend({queue: function (e, n) {
        var r = 2;
        return"string" != typeof e && (n = e, e = "fx", r--), r > arguments.length ? x.queue(this[0], e) : n === t ? this : this.each(function () {
            var t = x.queue(this, e, n);
            x._queueHooks(this, e), "fx" === e && "inprogress" !== t[0] && x.dequeue(this, e)
        })
    }, dequeue: function (e) {
        return this.each(function () {
            x.dequeue(this, e)
        })
    }, delay: function (e, t) {
        return e = x.fx ? x.fx.speeds[e] || e : e, t = t || "fx", this.queue(t, function (t, n) {
            var r = setTimeout(t, e);
            n.stop = function () {
                clearTimeout(r)
            }
        })
    }, clearQueue: function (e) {
        return this.queue(e || "fx", [])
    }, promise: function (e, n) {
        var r, i = 1, o = x.Deferred(), a = this, s = this.length, l = function () {
            --i || o.resolveWith(a, [a])
        };
        "string" != typeof e && (n = e, e = t), e = e || "fx";
        while (s--)r = x._data(a[s], e + "queueHooks"), r && r.empty && (i++, r.empty.add(l));
        return l(), o.promise(n)
    }});
    var z, X, U = /[\t\r\n\f]/g, V = /\r/g, Y = /^(?:input|select|textarea|button|object)$/i, J = /^(?:a|area)$/i, G = /^(?:checked|selected)$/i, Q = x.support.getSetAttribute, K = x.support.input;
    x.fn.extend({attr: function (e, t) {
        return x.access(this, x.attr, e, t, arguments.length > 1)
    }, removeAttr: function (e) {
        return this.each(function () {
            x.removeAttr(this, e)
        })
    }, prop: function (e, t) {
        return x.access(this, x.prop, e, t, arguments.length > 1)
    }, removeProp: function (e) {
        return e = x.propFix[e] || e, this.each(function () {
            try {
                this[e] = t, delete this[e]
            } catch (n) {
            }
        })
    }, addClass: function (e) {
        var t, n, r, i, o, a = 0, s = this.length, l = "string" == typeof e && e;
        if (x.isFunction(e))return this.each(function (t) {
            x(this).addClass(e.call(this, t, this.className))
        });
        if (l)for (t = (e || "").match(T) || []; s > a; a++)if (n = this[a], r = 1 === n.nodeType && (n.className ? (" " + n.className + " ").replace(U, " ") : " ")) {
            o = 0;
            while (i = t[o++])0 > r.indexOf(" " + i + " ") && (r += i + " ");
            n.className = x.trim(r)
        }
        return this
    }, removeClass: function (e) {
        var t, n, r, i, o, a = 0, s = this.length, l = 0 === arguments.length || "string" == typeof e && e;
        if (x.isFunction(e))return this.each(function (t) {
            x(this).removeClass(e.call(this, t, this.className))
        });
        if (l)for (t = (e || "").match(T) || []; s > a; a++)if (n = this[a], r = 1 === n.nodeType && (n.className ? (" " + n.className + " ").replace(U, " ") : "")) {
            o = 0;
            while (i = t[o++])while (r.indexOf(" " + i + " ") >= 0)r = r.replace(" " + i + " ", " ");
            n.className = e ? x.trim(r) : ""
        }
        return this
    }, toggleClass: function (e, t) {
        var n = typeof e;
        return"boolean" == typeof t && "string" === n ? t ? this.addClass(e) : this.removeClass(e) : x.isFunction(e) ? this.each(function (n) {
            x(this).toggleClass(e.call(this, n, this.className, t), t)
        }) : this.each(function () {
            if ("string" === n) {
                var t, r = 0, o = x(this), a = e.match(T) || [];
                while (t = a[r++])o.hasClass(t) ? o.removeClass(t) : o.addClass(t)
            } else(n === i || "boolean" === n) && (this.className && x._data(this, "__className__", this.className), this.className = this.className || e === !1 ? "" : x._data(this, "__className__") || "")
        })
    }, hasClass: function (e) {
        var t = " " + e + " ", n = 0, r = this.length;
        for (; r > n; n++)if (1 === this[n].nodeType && (" " + this[n].className + " ").replace(U, " ").indexOf(t) >= 0)return!0;
        return!1
    }, val: function (e) {
        var n, r, i, o = this[0];
        {
            if (arguments.length)return i = x.isFunction(e), this.each(function (n) {
                var o;
                1 === this.nodeType && (o = i ? e.call(this, n, x(this).val()) : e, null == o ? o = "" : "number" == typeof o ? o += "" : x.isArray(o) && (o = x.map(o, function (e) {
                    return null == e ? "" : e + ""
                })), r = x.valHooks[this.type] || x.valHooks[this.nodeName.toLowerCase()], r && "set"in r && r.set(this, o, "value") !== t || (this.value = o))
            });
            if (o)return r = x.valHooks[o.type] || x.valHooks[o.nodeName.toLowerCase()], r && "get"in r && (n = r.get(o, "value")) !== t ? n : (n = o.value, "string" == typeof n ? n.replace(V, "") : null == n ? "" : n)
        }
    }}), x.extend({valHooks: {option: {get: function (e) {
        var t = x.find.attr(e, "value");
        return null != t ? t : e.text
    }}, select: {get: function (e) {
        var t, n, r = e.options, i = e.selectedIndex, o = "select-one" === e.type || 0 > i, a = o ? null : [], s = o ? i + 1 : r.length, l = 0 > i ? s : o ? i : 0;
        for (; s > l; l++)if (n = r[l], !(!n.selected && l !== i || (x.support.optDisabled ? n.disabled : null !== n.getAttribute("disabled")) || n.parentNode.disabled && x.nodeName(n.parentNode, "optgroup"))) {
            if (t = x(n).val(), o)return t;
            a.push(t)
        }
        return a
    }, set: function (e, t) {
        var n, r, i = e.options, o = x.makeArray(t), a = i.length;
        while (a--)r = i[a], (r.selected = x.inArray(x(r).val(), o) >= 0) && (n = !0);
        return n || (e.selectedIndex = -1), o
    }}}, attr: function (e, n, r) {
        var o, a, s = e.nodeType;
        if (e && 3 !== s && 8 !== s && 2 !== s)return typeof e.getAttribute === i ? x.prop(e, n, r) : (1 === s && x.isXMLDoc(e) || (n = n.toLowerCase(), o = x.attrHooks[n] || (x.expr.match.bool.test(n) ? X : z)), r === t ? o && "get"in o && null !== (a = o.get(e, n)) ? a : (a = x.find.attr(e, n), null == a ? t : a) : null !== r ? o && "set"in o && (a = o.set(e, r, n)) !== t ? a : (e.setAttribute(n, r + ""), r) : (x.removeAttr(e, n), t))
    }, removeAttr: function (e, t) {
        var n, r, i = 0, o = t && t.match(T);
        if (o && 1 === e.nodeType)while (n = o[i++])r = x.propFix[n] || n, x.expr.match.bool.test(n) ? K && Q || !G.test(n) ? e[r] = !1 : e[x.camelCase("default-" + n)] = e[r] = !1 : x.attr(e, n, ""), e.removeAttribute(Q ? n : r)
    }, attrHooks: {type: {set: function (e, t) {
        if (!x.support.radioValue && "radio" === t && x.nodeName(e, "input")) {
            var n = e.value;
            return e.setAttribute("type", t), n && (e.value = n), t
        }
    }}}, propFix: {"for": "htmlFor", "class": "className"}, prop: function (e, n, r) {
        var i, o, a, s = e.nodeType;
        if (e && 3 !== s && 8 !== s && 2 !== s)return a = 1 !== s || !x.isXMLDoc(e), a && (n = x.propFix[n] || n, o = x.propHooks[n]), r !== t ? o && "set"in o && (i = o.set(e, r, n)) !== t ? i : e[n] = r : o && "get"in o && null !== (i = o.get(e, n)) ? i : e[n]
    }, propHooks: {tabIndex: {get: function (e) {
        var t = x.find.attr(e, "tabindex");
        return t ? parseInt(t, 10) : Y.test(e.nodeName) || J.test(e.nodeName) && e.href ? 0 : -1
    }}}}), X = {set: function (e, t, n) {
        return t === !1 ? x.removeAttr(e, n) : K && Q || !G.test(n) ? e.setAttribute(!Q && x.propFix[n] || n, n) : e[x.camelCase("default-" + n)] = e[n] = !0, n
    }}, x.each(x.expr.match.bool.source.match(/\w+/g), function (e, n) {
        var r = x.expr.attrHandle[n] || x.find.attr;
        x.expr.attrHandle[n] = K && Q || !G.test(n) ? function (e, n, i) {
            var o = x.expr.attrHandle[n], a = i ? t : (x.expr.attrHandle[n] = t) != r(e, n, i) ? n.toLowerCase() : null;
            return x.expr.attrHandle[n] = o, a
        } : function (e, n, r) {
            return r ? t : e[x.camelCase("default-" + n)] ? n.toLowerCase() : null
        }
    }), K && Q || (x.attrHooks.value = {set: function (e, n, r) {
        return x.nodeName(e, "input") ? (e.defaultValue = n, t) : z && z.set(e, n, r)
    }}), Q || (z = {set: function (e, n, r) {
        var i = e.getAttributeNode(r);
        return i || e.setAttributeNode(i = e.ownerDocument.createAttribute(r)), i.value = n += "", "value" === r || n === e.getAttribute(r) ? n : t
    }}, x.expr.attrHandle.id = x.expr.attrHandle.name = x.expr.attrHandle.coords = function (e, n, r) {
        var i;
        return r ? t : (i = e.getAttributeNode(n)) && "" !== i.value ? i.value : null
    }, x.valHooks.button = {get: function (e, n) {
        var r = e.getAttributeNode(n);
        return r && r.specified ? r.value : t
    }, set: z.set}, x.attrHooks.contenteditable = {set: function (e, t, n) {
        z.set(e, "" === t ? !1 : t, n)
    }}, x.each(["width", "height"], function (e, n) {
        x.attrHooks[n] = {set: function (e, r) {
            return"" === r ? (e.setAttribute(n, "auto"), r) : t
        }}
    })), x.support.hrefNormalized || x.each(["href", "src"], function (e, t) {
        x.propHooks[t] = {get: function (e) {
            return e.getAttribute(t, 4)
        }}
    }), x.support.style || (x.attrHooks.style = {get: function (e) {
        return e.style.cssText || t
    }, set: function (e, t) {
        return e.style.cssText = t + ""
    }}), x.support.optSelected || (x.propHooks.selected = {get: function (e) {
        var t = e.parentNode;
        return t && (t.selectedIndex, t.parentNode && t.parentNode.selectedIndex), null
    }}), x.each(["tabIndex", "readOnly", "maxLength", "cellSpacing", "cellPadding", "rowSpan", "colSpan", "useMap", "frameBorder", "contentEditable"], function () {
        x.propFix[this.toLowerCase()] = this
    }), x.support.enctype || (x.propFix.enctype = "encoding"), x.each(["radio", "checkbox"], function () {
        x.valHooks[this] = {set: function (e, n) {
            return x.isArray(n) ? e.checked = x.inArray(x(e).val(), n) >= 0 : t
        }}, x.support.checkOn || (x.valHooks[this].get = function (e) {
            return null === e.getAttribute("value") ? "on" : e.value
        })
    });
    var Z = /^(?:input|select|textarea)$/i, et = /^key/, tt = /^(?:mouse|contextmenu)|click/, nt = /^(?:focusinfocus|focusoutblur)$/, rt = /^([^.]*)(?:\.(.+)|)$/;

    function it() {
        return!0
    }

    function ot() {
        return!1
    }

    function at() {
        try {
            return a.activeElement
        } catch (e) {
        }
    }

    x.event = {global: {}, add: function (e, n, r, o, a) {
        var s, l, u, c, p, f, d, h, g, m, y, v = x._data(e);
        if (v) {
            r.handler && (c = r, r = c.handler, a = c.selector), r.guid || (r.guid = x.guid++), (l = v.events) || (l = v.events = {}), (f = v.handle) || (f = v.handle = function (e) {
                return typeof x === i || e && x.event.triggered === e.type ? t : x.event.dispatch.apply(f.elem, arguments)
            }, f.elem = e), n = (n || "").match(T) || [""], u = n.length;
            while (u--)s = rt.exec(n[u]) || [], g = y = s[1], m = (s[2] || "").split(".").sort(), g && (p = x.event.special[g] || {}, g = (a ? p.delegateType : p.bindType) || g, p = x.event.special[g] || {}, d = x.extend({type: g, origType: y, data: o, handler: r, guid: r.guid, selector: a, needsContext: a && x.expr.match.needsContext.test(a), namespace: m.join(".")}, c), (h = l[g]) || (h = l[g] = [], h.delegateCount = 0, p.setup && p.setup.call(e, o, m, f) !== !1 || (e.addEventListener ? e.addEventListener(g, f, !1) : e.attachEvent && e.attachEvent("on" + g, f))), p.add && (p.add.call(e, d), d.handler.guid || (d.handler.guid = r.guid)), a ? h.splice(h.delegateCount++, 0, d) : h.push(d), x.event.global[g] = !0);
            e = null
        }
    }, remove: function (e, t, n, r, i) {
        var o, a, s, l, u, c, p, f, d, h, g, m = x.hasData(e) && x._data(e);
        if (m && (c = m.events)) {
            t = (t || "").match(T) || [""], u = t.length;
            while (u--)if (s = rt.exec(t[u]) || [], d = g = s[1], h = (s[2] || "").split(".").sort(), d) {
                p = x.event.special[d] || {}, d = (r ? p.delegateType : p.bindType) || d, f = c[d] || [], s = s[2] && RegExp("(^|\\.)" + h.join("\\.(?:.*\\.|)") + "(\\.|$)"), l = o = f.length;
                while (o--)a = f[o], !i && g !== a.origType || n && n.guid !== a.guid || s && !s.test(a.namespace) || r && r !== a.selector && ("**" !== r || !a.selector) || (f.splice(o, 1), a.selector && f.delegateCount--, p.remove && p.remove.call(e, a));
                l && !f.length && (p.teardown && p.teardown.call(e, h, m.handle) !== !1 || x.removeEvent(e, d, m.handle), delete c[d])
            } else for (d in c)x.event.remove(e, d + t[u], n, r, !0);
            x.isEmptyObject(c) && (delete m.handle, x._removeData(e, "events"))
        }
    }, trigger: function (n, r, i, o) {
        var s, l, u, c, p, f, d, h = [i || a], g = v.call(n, "type") ? n.type : n, m = v.call(n, "namespace") ? n.namespace.split(".") : [];
        if (u = f = i = i || a, 3 !== i.nodeType && 8 !== i.nodeType && !nt.test(g + x.event.triggered) && (g.indexOf(".") >= 0 && (m = g.split("."), g = m.shift(), m.sort()), l = 0 > g.indexOf(":") && "on" + g, n = n[x.expando] ? n : new x.Event(g, "object" == typeof n && n), n.isTrigger = o ? 2 : 3, n.namespace = m.join("."), n.namespace_re = n.namespace ? RegExp("(^|\\.)" + m.join("\\.(?:.*\\.|)") + "(\\.|$)") : null, n.result = t, n.target || (n.target = i), r = null == r ? [n] : x.makeArray(r, [n]), p = x.event.special[g] || {}, o || !p.trigger || p.trigger.apply(i, r) !== !1)) {
            if (!o && !p.noBubble && !x.isWindow(i)) {
                for (c = p.delegateType || g, nt.test(c + g) || (u = u.parentNode); u; u = u.parentNode)h.push(u), f = u;
                f === (i.ownerDocument || a) && h.push(f.defaultView || f.parentWindow || e)
            }
            d = 0;
            while ((u = h[d++]) && !n.isPropagationStopped())n.type = d > 1 ? c : p.bindType || g, s = (x._data(u, "events") || {})[n.type] && x._data(u, "handle"), s && s.apply(u, r), s = l && u[l], s && x.acceptData(u) && s.apply && s.apply(u, r) === !1 && n.preventDefault();
            if (n.type = g, !o && !n.isDefaultPrevented() && (!p._default || p._default.apply(h.pop(), r) === !1) && x.acceptData(i) && l && i[g] && !x.isWindow(i)) {
                f = i[l], f && (i[l] = null), x.event.triggered = g;
                try {
                    i[g]()
                } catch (y) {
                }
                x.event.triggered = t, f && (i[l] = f)
            }
            return n.result
        }
    }, dispatch: function (e) {
        e = x.event.fix(e);
        var n, r, i, o, a, s = [], l = g.call(arguments), u = (x._data(this, "events") || {})[e.type] || [], c = x.event.special[e.type] || {};
        if (l[0] = e, e.delegateTarget = this, !c.preDispatch || c.preDispatch.call(this, e) !== !1) {
            s = x.event.handlers.call(this, e, u), n = 0;
            while ((o = s[n++]) && !e.isPropagationStopped()) {
                e.currentTarget = o.elem, a = 0;
                while ((i = o.handlers[a++]) && !e.isImmediatePropagationStopped())(!e.namespace_re || e.namespace_re.test(i.namespace)) && (e.handleObj = i, e.data = i.data, r = ((x.event.special[i.origType] || {}).handle || i.handler).apply(o.elem, l), r !== t && (e.result = r) === !1 && (e.preventDefault(), e.stopPropagation()))
            }
            return c.postDispatch && c.postDispatch.call(this, e), e.result
        }
    }, handlers: function (e, n) {
        var r, i, o, a, s = [], l = n.delegateCount, u = e.target;
        if (l && u.nodeType && (!e.button || "click" !== e.type))for (; u != this; u = u.parentNode || this)if (1 === u.nodeType && (u.disabled !== !0 || "click" !== e.type)) {
            for (o = [], a = 0; l > a; a++)i = n[a], r = i.selector + " ", o[r] === t && (o[r] = i.needsContext ? x(r, this).index(u) >= 0 : x.find(r, this, null, [u]).length), o[r] && o.push(i);
            o.length && s.push({elem: u, handlers: o})
        }
        return n.length > l && s.push({elem: this, handlers: n.slice(l)}), s
    }, fix: function (e) {
        if (e[x.expando])return e;
        var t, n, r, i = e.type, o = e, s = this.fixHooks[i];
        s || (this.fixHooks[i] = s = tt.test(i) ? this.mouseHooks : et.test(i) ? this.keyHooks : {}), r = s.props ? this.props.concat(s.props) : this.props, e = new x.Event(o), t = r.length;
        while (t--)n = r[t], e[n] = o[n];
        return e.target || (e.target = o.srcElement || a), 3 === e.target.nodeType && (e.target = e.target.parentNode), e.metaKey = !!e.metaKey, s.filter ? s.filter(e, o) : e
    }, props: "altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "), fixHooks: {}, keyHooks: {props: "char charCode key keyCode".split(" "), filter: function (e, t) {
        return null == e.which && (e.which = null != t.charCode ? t.charCode : t.keyCode), e
    }}, mouseHooks: {props: "button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "), filter: function (e, n) {
        var r, i, o, s = n.button, l = n.fromElement;
        return null == e.pageX && null != n.clientX && (i = e.target.ownerDocument || a, o = i.documentElement, r = i.body, e.pageX = n.clientX + (o && o.scrollLeft || r && r.scrollLeft || 0) - (o && o.clientLeft || r && r.clientLeft || 0), e.pageY = n.clientY + (o && o.scrollTop || r && r.scrollTop || 0) - (o && o.clientTop || r && r.clientTop || 0)), !e.relatedTarget && l && (e.relatedTarget = l === e.target ? n.toElement : l), e.which || s === t || (e.which = 1 & s ? 1 : 2 & s ? 3 : 4 & s ? 2 : 0), e
    }}, special: {load: {noBubble: !0}, focus: {trigger: function () {
        if (this !== at() && this.focus)try {
            return this.focus(), !1
        } catch (e) {
        }
    }, delegateType: "focusin"}, blur: {trigger: function () {
        return this === at() && this.blur ? (this.blur(), !1) : t
    }, delegateType: "focusout"}, click: {trigger: function () {
        return x.nodeName(this, "input") && "checkbox" === this.type && this.click ? (this.click(), !1) : t
    }, _default: function (e) {
        return x.nodeName(e.target, "a")
    }}, beforeunload: {postDispatch: function (e) {
        e.result !== t && (e.originalEvent.returnValue = e.result)
    }}}, simulate: function (e, t, n, r) {
        var i = x.extend(new x.Event, n, {type: e, isSimulated: !0, originalEvent: {}});
        r ? x.event.trigger(i, null, t) : x.event.dispatch.call(t, i), i.isDefaultPrevented() && n.preventDefault()
    }}, x.removeEvent = a.removeEventListener ? function (e, t, n) {
        e.removeEventListener && e.removeEventListener(t, n, !1)
    } : function (e, t, n) {
        var r = "on" + t;
        e.detachEvent && (typeof e[r] === i && (e[r] = null), e.detachEvent(r, n))
    }, x.Event = function (e, n) {
        return this instanceof x.Event ? (e && e.type ? (this.originalEvent = e, this.type = e.type, this.isDefaultPrevented = e.defaultPrevented || e.returnValue === !1 || e.getPreventDefault && e.getPreventDefault() ? it : ot) : this.type = e, n && x.extend(this, n), this.timeStamp = e && e.timeStamp || x.now(), this[x.expando] = !0, t) : new x.Event(e, n)
    }, x.Event.prototype = {isDefaultPrevented: ot, isPropagationStopped: ot, isImmediatePropagationStopped: ot, preventDefault: function () {
        var e = this.originalEvent;
        this.isDefaultPrevented = it, e && (e.preventDefault ? e.preventDefault() : e.returnValue = !1)
    }, stopPropagation: function () {
        var e = this.originalEvent;
        this.isPropagationStopped = it, e && (e.stopPropagation && e.stopPropagation(), e.cancelBubble = !0)
    }, stopImmediatePropagation: function () {
        this.isImmediatePropagationStopped = it, this.stopPropagation()
    }}, x.each({mouseenter: "mouseover", mouseleave: "mouseout"}, function (e, t) {
        x.event.special[e] = {delegateType: t, bindType: t, handle: function (e) {
            var n, r = this, i = e.relatedTarget, o = e.handleObj;
            return(!i || i !== r && !x.contains(r, i)) && (e.type = o.origType, n = o.handler.apply(this, arguments), e.type = t), n
        }}
    }), x.support.submitBubbles || (x.event.special.submit = {setup: function () {
        return x.nodeName(this, "form") ? !1 : (x.event.add(this, "click._submit keypress._submit", function (e) {
            var n = e.target, r = x.nodeName(n, "input") || x.nodeName(n, "button") ? n.form : t;
            r && !x._data(r, "submitBubbles") && (x.event.add(r, "submit._submit", function (e) {
                e._submit_bubble = !0
            }), x._data(r, "submitBubbles", !0))
        }), t)
    }, postDispatch: function (e) {
        e._submit_bubble && (delete e._submit_bubble, this.parentNode && !e.isTrigger && x.event.simulate("submit", this.parentNode, e, !0))
    }, teardown: function () {
        return x.nodeName(this, "form") ? !1 : (x.event.remove(this, "._submit"), t)
    }}), x.support.changeBubbles || (x.event.special.change = {setup: function () {
        return Z.test(this.nodeName) ? (("checkbox" === this.type || "radio" === this.type) && (x.event.add(this, "propertychange._change", function (e) {
            "checked" === e.originalEvent.propertyName && (this._just_changed = !0)
        }), x.event.add(this, "click._change", function (e) {
            this._just_changed && !e.isTrigger && (this._just_changed = !1), x.event.simulate("change", this, e, !0)
        })), !1) : (x.event.add(this, "beforeactivate._change", function (e) {
            var t = e.target;
            Z.test(t.nodeName) && !x._data(t, "changeBubbles") && (x.event.add(t, "change._change", function (e) {
                !this.parentNode || e.isSimulated || e.isTrigger || x.event.simulate("change", this.parentNode, e, !0)
            }), x._data(t, "changeBubbles", !0))
        }), t)
    }, handle: function (e) {
        var n = e.target;
        return this !== n || e.isSimulated || e.isTrigger || "radio" !== n.type && "checkbox" !== n.type ? e.handleObj.handler.apply(this, arguments) : t
    }, teardown: function () {
        return x.event.remove(this, "._change"), !Z.test(this.nodeName)
    }}), x.support.focusinBubbles || x.each({focus: "focusin", blur: "focusout"}, function (e, t) {
        var n = 0, r = function (e) {
            x.event.simulate(t, e.target, x.event.fix(e), !0)
        };
        x.event.special[t] = {setup: function () {
            0 === n++ && a.addEventListener(e, r, !0)
        }, teardown: function () {
            0 === --n && a.removeEventListener(e, r, !0)
        }}
    }), x.fn.extend({on: function (e, n, r, i, o) {
        var a, s;
        if ("object" == typeof e) {
            "string" != typeof n && (r = r || n, n = t);
            for (a in e)this.on(a, n, r, e[a], o);
            return this
        }
        if (null == r && null == i ? (i = n, r = n = t) : null == i && ("string" == typeof n ? (i = r, r = t) : (i = r, r = n, n = t)), i === !1)i = ot; else if (!i)return this;
        return 1 === o && (s = i, i = function (e) {
            return x().off(e), s.apply(this, arguments)
        }, i.guid = s.guid || (s.guid = x.guid++)), this.each(function () {
            x.event.add(this, e, i, r, n)
        })
    }, one: function (e, t, n, r) {
        return this.on(e, t, n, r, 1)
    }, off: function (e, n, r) {
        var i, o;
        if (e && e.preventDefault && e.handleObj)return i = e.handleObj, x(e.delegateTarget).off(i.namespace ? i.origType + "." + i.namespace : i.origType, i.selector, i.handler), this;
        if ("object" == typeof e) {
            for (o in e)this.off(o, n, e[o]);
            return this
        }
        return(n === !1 || "function" == typeof n) && (r = n, n = t), r === !1 && (r = ot), this.each(function () {
            x.event.remove(this, e, r, n)
        })
    }, trigger: function (e, t) {
        return this.each(function () {
            x.event.trigger(e, t, this)
        })
    }, triggerHandler: function (e, n) {
        var r = this[0];
        return r ? x.event.trigger(e, n, r, !0) : t
    }});
    var st = /^.[^:#\[\.,]*$/, lt = /^(?:parents|prev(?:Until|All))/, ut = x.expr.match.needsContext, ct = {children: !0, contents: !0, next: !0, prev: !0};
    x.fn.extend({find: function (e) {
        var t, n = [], r = this, i = r.length;
        if ("string" != typeof e)return this.pushStack(x(e).filter(function () {
            for (t = 0; i > t; t++)if (x.contains(r[t], this))return!0
        }));
        for (t = 0; i > t; t++)x.find(e, r[t], n);
        return n = this.pushStack(i > 1 ? x.unique(n) : n), n.selector = this.selector ? this.selector + " " + e : e, n
    }, has: function (e) {
        var t, n = x(e, this), r = n.length;
        return this.filter(function () {
            for (t = 0; r > t; t++)if (x.contains(this, n[t]))return!0
        })
    }, not: function (e) {
        return this.pushStack(ft(this, e || [], !0))
    }, filter: function (e) {
        return this.pushStack(ft(this, e || [], !1))
    }, is: function (e) {
        return!!ft(this, "string" == typeof e && ut.test(e) ? x(e) : e || [], !1).length
    }, closest: function (e, t) {
        var n, r = 0, i = this.length, o = [], a = ut.test(e) || "string" != typeof e ? x(e, t || this.context) : 0;
        for (; i > r; r++)for (n = this[r]; n && n !== t; n = n.parentNode)if (11 > n.nodeType && (a ? a.index(n) > -1 : 1 === n.nodeType && x.find.matchesSelector(n, e))) {
            n = o.push(n);
            break
        }
        return this.pushStack(o.length > 1 ? x.unique(o) : o)
    }, index: function (e) {
        return e ? "string" == typeof e ? x.inArray(this[0], x(e)) : x.inArray(e.jquery ? e[0] : e, this) : this[0] && this[0].parentNode ? this.first().prevAll().length : -1
    }, add: function (e, t) {
        var n = "string" == typeof e ? x(e, t) : x.makeArray(e && e.nodeType ? [e] : e), r = x.merge(this.get(), n);
        return this.pushStack(x.unique(r))
    }, addBack: function (e) {
        return this.add(null == e ? this.prevObject : this.prevObject.filter(e))
    }});
    function pt(e, t) {
        do e = e[t]; while (e && 1 !== e.nodeType);
        return e
    }

    x.each({parent: function (e) {
        var t = e.parentNode;
        return t && 11 !== t.nodeType ? t : null
    }, parents: function (e) {
        return x.dir(e, "parentNode")
    }, parentsUntil: function (e, t, n) {
        return x.dir(e, "parentNode", n)
    }, next: function (e) {
        return pt(e, "nextSibling")
    }, prev: function (e) {
        return pt(e, "previousSibling")
    }, nextAll: function (e) {
        return x.dir(e, "nextSibling")
    }, prevAll: function (e) {
        return x.dir(e, "previousSibling")
    }, nextUntil: function (e, t, n) {
        return x.dir(e, "nextSibling", n)
    }, prevUntil: function (e, t, n) {
        return x.dir(e, "previousSibling", n)
    }, siblings: function (e) {
        return x.sibling((e.parentNode || {}).firstChild, e)
    }, children: function (e) {
        return x.sibling(e.firstChild)
    }, contents: function (e) {
        return x.nodeName(e, "iframe") ? e.contentDocument || e.contentWindow.document : x.merge([], e.childNodes)
    }}, function (e, t) {
        x.fn[e] = function (n, r) {
            var i = x.map(this, t, n);
            return"Until" !== e.slice(-5) && (r = n), r && "string" == typeof r && (i = x.filter(r, i)), this.length > 1 && (ct[e] || (i = x.unique(i)), lt.test(e) && (i = i.reverse())), this.pushStack(i)
        }
    }), x.extend({filter: function (e, t, n) {
        var r = t[0];
        return n && (e = ":not(" + e + ")"), 1 === t.length && 1 === r.nodeType ? x.find.matchesSelector(r, e) ? [r] : [] : x.find.matches(e, x.grep(t, function (e) {
            return 1 === e.nodeType
        }))
    }, dir: function (e, n, r) {
        var i = [], o = e[n];
        while (o && 9 !== o.nodeType && (r === t || 1 !== o.nodeType || !x(o).is(r)))1 === o.nodeType && i.push(o), o = o[n];
        return i
    }, sibling: function (e, t) {
        var n = [];
        for (; e; e = e.nextSibling)1 === e.nodeType && e !== t && n.push(e);
        return n
    }});
    function ft(e, t, n) {
        if (x.isFunction(t))return x.grep(e, function (e, r) {
            return!!t.call(e, r, e) !== n
        });
        if (t.nodeType)return x.grep(e, function (e) {
            return e === t !== n
        });
        if ("string" == typeof t) {
            if (st.test(t))return x.filter(t, e, n);
            t = x.filter(t, e)
        }
        return x.grep(e, function (e) {
            return x.inArray(e, t) >= 0 !== n
        })
    }

    function dt(e) {
        var t = ht.split("|"), n = e.createDocumentFragment();
        if (n.createElement)while (t.length)n.createElement(t.pop());
        return n
    }

    var ht = "abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video", gt = / jQuery\d+="(?:null|\d+)"/g, mt = RegExp("<(?:" + ht + ")[\\s/>]", "i"), yt = /^\s+/, vt = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi, bt = /<([\w:]+)/, xt = /<tbody/i, wt = /<|&#?\w+;/, Tt = /<(?:script|style|link)/i, Ct = /^(?:checkbox|radio)$/i, Nt = /checked\s*(?:[^=]|=\s*.checked.)/i, kt = /^$|\/(?:java|ecma)script/i, Et = /^true\/(.*)/, St = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g, At = {option: [1, "<select multiple='multiple'>", "</select>"], legend: [1, "<fieldset>", "</fieldset>"], area: [1, "<map>", "</map>"], param: [1, "<object>", "</object>"], thead: [1, "<table>", "</table>"], tr: [2, "<table><tbody>", "</tbody></table>"], col: [2, "<table><tbody></tbody><colgroup>", "</colgroup></table>"], td: [3, "<table><tbody><tr>", "</tr></tbody></table>"], _default: x.support.htmlSerialize ? [0, "", ""] : [1, "X<div>", "</div>"]}, jt = dt(a), Dt = jt.appendChild(a.createElement("div"));
    At.optgroup = At.option, At.tbody = At.tfoot = At.colgroup = At.caption = At.thead, At.th = At.td, x.fn.extend({text: function (e) {
        return x.access(this, function (e) {
            return e === t ? x.text(this) : this.empty().append((this[0] && this[0].ownerDocument || a).createTextNode(e))
        }, null, e, arguments.length)
    }, append: function () {
        return this.domManip(arguments, function (e) {
            if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) {
                var t = Lt(this, e);
                t.appendChild(e)
            }
        })
    }, prepend: function () {
        return this.domManip(arguments, function (e) {
            if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) {
                var t = Lt(this, e);
                t.insertBefore(e, t.firstChild)
            }
        })
    }, before: function () {
        return this.domManip(arguments, function (e) {
            this.parentNode && this.parentNode.insertBefore(e, this)
        })
    }, after: function () {
        return this.domManip(arguments, function (e) {
            this.parentNode && this.parentNode.insertBefore(e, this.nextSibling)
        })
    }, remove: function (e, t) {
        var n, r = e ? x.filter(e, this) : this, i = 0;
        for (; null != (n = r[i]); i++)t || 1 !== n.nodeType || x.cleanData(Ft(n)), n.parentNode && (t && x.contains(n.ownerDocument, n) && _t(Ft(n, "script")), n.parentNode.removeChild(n));
        return this
    }, empty: function () {
        var e, t = 0;
        for (; null != (e = this[t]); t++) {
            1 === e.nodeType && x.cleanData(Ft(e, !1));
            while (e.firstChild)e.removeChild(e.firstChild);
            e.options && x.nodeName(e, "select") && (e.options.length = 0)
        }
        return this
    }, clone: function (e, t) {
        return e = null == e ? !1 : e, t = null == t ? e : t, this.map(function () {
            return x.clone(this, e, t)
        })
    }, html: function (e) {
        return x.access(this, function (e) {
            var n = this[0] || {}, r = 0, i = this.length;
            if (e === t)return 1 === n.nodeType ? n.innerHTML.replace(gt, "") : t;
            if (!("string" != typeof e || Tt.test(e) || !x.support.htmlSerialize && mt.test(e) || !x.support.leadingWhitespace && yt.test(e) || At[(bt.exec(e) || ["", ""])[1].toLowerCase()])) {
                e = e.replace(vt, "<$1></$2>");
                try {
                    for (; i > r; r++)n = this[r] || {}, 1 === n.nodeType && (x.cleanData(Ft(n, !1)), n.innerHTML = e);
                    n = 0
                } catch (o) {
                }
            }
            n && this.empty().append(e)
        }, null, e, arguments.length)
    }, replaceWith: function () {
        var e = x.map(this, function (e) {
            return[e.nextSibling, e.parentNode]
        }), t = 0;
        return this.domManip(arguments, function (n) {
            var r = e[t++], i = e[t++];
            i && (r && r.parentNode !== i && (r = this.nextSibling), x(this).remove(), i.insertBefore(n, r))
        }, !0), t ? this : this.remove()
    }, detach: function (e) {
        return this.remove(e, !0)
    }, domManip: function (e, t, n) {
        e = d.apply([], e);
        var r, i, o, a, s, l, u = 0, c = this.length, p = this, f = c - 1, h = e[0], g = x.isFunction(h);
        if (g || !(1 >= c || "string" != typeof h || x.support.checkClone) && Nt.test(h))return this.each(function (r) {
            var i = p.eq(r);
            g && (e[0] = h.call(this, r, i.html())), i.domManip(e, t, n)
        });
        if (c && (l = x.buildFragment(e, this[0].ownerDocument, !1, !n && this), r = l.firstChild, 1 === l.childNodes.length && (l = r), r)) {
            for (a = x.map(Ft(l, "script"), Ht), o = a.length; c > u; u++)i = l, u !== f && (i = x.clone(i, !0, !0), o && x.merge(a, Ft(i, "script"))), t.call(this[u], i, u);
            if (o)for (s = a[a.length - 1].ownerDocument, x.map(a, qt), u = 0; o > u; u++)i = a[u], kt.test(i.type || "") && !x._data(i, "globalEval") && x.contains(s, i) && (i.src ? x._evalUrl(i.src) : x.globalEval((i.text || i.textContent || i.innerHTML || "").replace(St, "")));
            l = r = null
        }
        return this
    }});
    function Lt(e, t) {
        return x.nodeName(e, "table") && x.nodeName(1 === t.nodeType ? t : t.firstChild, "tr") ? e.getElementsByTagName("tbody")[0] || e.appendChild(e.ownerDocument.createElement("tbody")) : e
    }

    function Ht(e) {
        return e.type = (null !== x.find.attr(e, "type")) + "/" + e.type, e
    }

    function qt(e) {
        var t = Et.exec(e.type);
        return t ? e.type = t[1] : e.removeAttribute("type"), e
    }

    function _t(e, t) {
        var n, r = 0;
        for (; null != (n = e[r]); r++)x._data(n, "globalEval", !t || x._data(t[r], "globalEval"))
    }

    function Mt(e, t) {
        if (1 === t.nodeType && x.hasData(e)) {
            var n, r, i, o = x._data(e), a = x._data(t, o), s = o.events;
            if (s) {
                delete a.handle, a.events = {};
                for (n in s)for (r = 0, i = s[n].length; i > r; r++)x.event.add(t, n, s[n][r])
            }
            a.data && (a.data = x.extend({}, a.data))
        }
    }

    function Ot(e, t) {
        var n, r, i;
        if (1 === t.nodeType) {
            if (n = t.nodeName.toLowerCase(), !x.support.noCloneEvent && t[x.expando]) {
                i = x._data(t);
                for (r in i.events)x.removeEvent(t, r, i.handle);
                t.removeAttribute(x.expando)
            }
            "script" === n && t.text !== e.text ? (Ht(t).text = e.text, qt(t)) : "object" === n ? (t.parentNode && (t.outerHTML = e.outerHTML), x.support.html5Clone && e.innerHTML && !x.trim(t.innerHTML) && (t.innerHTML = e.innerHTML)) : "input" === n && Ct.test(e.type) ? (t.defaultChecked = t.checked = e.checked, t.value !== e.value && (t.value = e.value)) : "option" === n ? t.defaultSelected = t.selected = e.defaultSelected : ("input" === n || "textarea" === n) && (t.defaultValue = e.defaultValue)
        }
    }

    x.each({appendTo: "append", prependTo: "prepend", insertBefore: "before", insertAfter: "after", replaceAll: "replaceWith"}, function (e, t) {
        x.fn[e] = function (e) {
            var n, r = 0, i = [], o = x(e), a = o.length - 1;
            for (; a >= r; r++)n = r === a ? this : this.clone(!0), x(o[r])[t](n), h.apply(i, n.get());
            return this.pushStack(i)
        }
    });
    function Ft(e, n) {
        var r, o, a = 0, s = typeof e.getElementsByTagName !== i ? e.getElementsByTagName(n || "*") : typeof e.querySelectorAll !== i ? e.querySelectorAll(n || "*") : t;
        if (!s)for (s = [], r = e.childNodes || e; null != (o = r[a]); a++)!n || x.nodeName(o, n) ? s.push(o) : x.merge(s, Ft(o, n));
        return n === t || n && x.nodeName(e, n) ? x.merge([e], s) : s
    }

    function Bt(e) {
        Ct.test(e.type) && (e.defaultChecked = e.checked)
    }

    x.extend({clone: function (e, t, n) {
        var r, i, o, a, s, l = x.contains(e.ownerDocument, e);
        if (x.support.html5Clone || x.isXMLDoc(e) || !mt.test("<" + e.nodeName + ">") ? o = e.cloneNode(!0) : (Dt.innerHTML = e.outerHTML, Dt.removeChild(o = Dt.firstChild)), !(x.support.noCloneEvent && x.support.noCloneChecked || 1 !== e.nodeType && 11 !== e.nodeType || x.isXMLDoc(e)))for (r = Ft(o), s = Ft(e), a = 0; null != (i = s[a]); ++a)r[a] && Ot(i, r[a]);
        if (t)if (n)for (s = s || Ft(e), r = r || Ft(o), a = 0; null != (i = s[a]); a++)Mt(i, r[a]); else Mt(e, o);
        return r = Ft(o, "script"), r.length > 0 && _t(r, !l && Ft(e, "script")), r = s = i = null, o
    }, buildFragment: function (e, t, n, r) {
        var i, o, a, s, l, u, c, p = e.length, f = dt(t), d = [], h = 0;
        for (; p > h; h++)if (o = e[h], o || 0 === o)if ("object" === x.type(o))x.merge(d, o.nodeType ? [o] : o); else if (wt.test(o)) {
            s = s || f.appendChild(t.createElement("div")), l = (bt.exec(o) || ["", ""])[1].toLowerCase(), c = At[l] || At._default, s.innerHTML = c[1] + o.replace(vt, "<$1></$2>") + c[2], i = c[0];
            while (i--)s = s.lastChild;
            if (!x.support.leadingWhitespace && yt.test(o) && d.push(t.createTextNode(yt.exec(o)[0])), !x.support.tbody) {
                o = "table" !== l || xt.test(o) ? "<table>" !== c[1] || xt.test(o) ? 0 : s : s.firstChild, i = o && o.childNodes.length;
                while (i--)x.nodeName(u = o.childNodes[i], "tbody") && !u.childNodes.length && o.removeChild(u)
            }
            x.merge(d, s.childNodes), s.textContent = "";
            while (s.firstChild)s.removeChild(s.firstChild);
            s = f.lastChild
        } else d.push(t.createTextNode(o));
        s && f.removeChild(s), x.support.appendChecked || x.grep(Ft(d, "input"), Bt), h = 0;
        while (o = d[h++])if ((!r || -1 === x.inArray(o, r)) && (a = x.contains(o.ownerDocument, o), s = Ft(f.appendChild(o), "script"), a && _t(s), n)) {
            i = 0;
            while (o = s[i++])kt.test(o.type || "") && n.push(o)
        }
        return s = null, f
    }, cleanData: function (e, t) {
        var n, r, o, a, s = 0, l = x.expando, u = x.cache, c = x.support.deleteExpando, f = x.event.special;
        for (; null != (n = e[s]); s++)if ((t || x.acceptData(n)) && (o = n[l], a = o && u[o])) {
            if (a.events)for (r in a.events)f[r] ? x.event.remove(n, r) : x.removeEvent(n, r, a.handle);
            u[o] && (delete u[o], c ? delete n[l] : typeof n.removeAttribute !== i ? n.removeAttribute(l) : n[l] = null, p.push(o))
        }
    }, _evalUrl: function (e) {
        return x.ajax({url: e, type: "GET", dataType: "script", async: !1, global: !1, "throws": !0})
    }}), x.fn.extend({wrapAll: function (e) {
        if (x.isFunction(e))return this.each(function (t) {
            x(this).wrapAll(e.call(this, t))
        });
        if (this[0]) {
            var t = x(e, this[0].ownerDocument).eq(0).clone(!0);
            this[0].parentNode && t.insertBefore(this[0]), t.map(function () {
                var e = this;
                while (e.firstChild && 1 === e.firstChild.nodeType)e = e.firstChild;
                return e
            }).append(this)
        }
        return this
    }, wrapInner: function (e) {
        return x.isFunction(e) ? this.each(function (t) {
            x(this).wrapInner(e.call(this, t))
        }) : this.each(function () {
            var t = x(this), n = t.contents();
            n.length ? n.wrapAll(e) : t.append(e)
        })
    }, wrap: function (e) {
        var t = x.isFunction(e);
        return this.each(function (n) {
            x(this).wrapAll(t ? e.call(this, n) : e)
        })
    }, unwrap: function () {
        return this.parent().each(function () {
            x.nodeName(this, "body") || x(this).replaceWith(this.childNodes)
        }).end()
    }});
    var Pt, Rt, Wt, $t = /alpha\([^)]*\)/i, It = /opacity\s*=\s*([^)]*)/, zt = /^(top|right|bottom|left)$/, Xt = /^(none|table(?!-c[ea]).+)/, Ut = /^margin/, Vt = RegExp("^(" + w + ")(.*)$", "i"), Yt = RegExp("^(" + w + ")(?!px)[a-z%]+$", "i"), Jt = RegExp("^([+-])=(" + w + ")", "i"), Gt = {BODY: "block"}, Qt = {position: "absolute", visibility: "hidden", display: "block"}, Kt = {letterSpacing: 0, fontWeight: 400}, Zt = ["Top", "Right", "Bottom", "Left"], en = ["Webkit", "O", "Moz", "ms"];

    function tn(e, t) {
        if (t in e)return t;
        var n = t.charAt(0).toUpperCase() + t.slice(1), r = t, i = en.length;
        while (i--)if (t = en[i] + n, t in e)return t;
        return r
    }

    function nn(e, t) {
        return e = t || e, "none" === x.css(e, "display") || !x.contains(e.ownerDocument, e)
    }

    function rn(e, t) {
        var n, r, i, o = [], a = 0, s = e.length;
        for (; s > a; a++)r = e[a], r.style && (o[a] = x._data(r, "olddisplay"), n = r.style.display, t ? (o[a] || "none" !== n || (r.style.display = ""), "" === r.style.display && nn(r) && (o[a] = x._data(r, "olddisplay", ln(r.nodeName)))) : o[a] || (i = nn(r), (n && "none" !== n || !i) && x._data(r, "olddisplay", i ? n : x.css(r, "display"))));
        for (a = 0; s > a; a++)r = e[a], r.style && (t && "none" !== r.style.display && "" !== r.style.display || (r.style.display = t ? o[a] || "" : "none"));
        return e
    }

    x.fn.extend({css: function (e, n) {
        return x.access(this, function (e, n, r) {
            var i, o, a = {}, s = 0;
            if (x.isArray(n)) {
                for (o = Rt(e), i = n.length; i > s; s++)a[n[s]] = x.css(e, n[s], !1, o);
                return a
            }
            return r !== t ? x.style(e, n, r) : x.css(e, n)
        }, e, n, arguments.length > 1)
    }, show: function () {
        return rn(this, !0)
    }, hide: function () {
        return rn(this)
    }, toggle: function (e) {
        return"boolean" == typeof e ? e ? this.show() : this.hide() : this.each(function () {
            nn(this) ? x(this).show() : x(this).hide()
        })
    }}), x.extend({cssHooks: {opacity: {get: function (e, t) {
        if (t) {
            var n = Wt(e, "opacity");
            return"" === n ? "1" : n
        }
    }}}, cssNumber: {columnCount: !0, fillOpacity: !0, fontWeight: !0, lineHeight: !0, opacity: !0, order: !0, orphans: !0, widows: !0, zIndex: !0, zoom: !0}, cssProps: {"float": x.support.cssFloat ? "cssFloat" : "styleFloat"}, style: function (e, n, r, i) {
        if (e && 3 !== e.nodeType && 8 !== e.nodeType && e.style) {
            var o, a, s, l = x.camelCase(n), u = e.style;
            if (n = x.cssProps[l] || (x.cssProps[l] = tn(u, l)), s = x.cssHooks[n] || x.cssHooks[l], r === t)return s && "get"in s && (o = s.get(e, !1, i)) !== t ? o : u[n];
            if (a = typeof r, "string" === a && (o = Jt.exec(r)) && (r = (o[1] + 1) * o[2] + parseFloat(x.css(e, n)), a = "number"), !(null == r || "number" === a && isNaN(r) || ("number" !== a || x.cssNumber[l] || (r += "px"), x.support.clearCloneStyle || "" !== r || 0 !== n.indexOf("background") || (u[n] = "inherit"), s && "set"in s && (r = s.set(e, r, i)) === t)))try {
                u[n] = r
            } catch (c) {
            }
        }
    }, css: function (e, n, r, i) {
        var o, a, s, l = x.camelCase(n);
        return n = x.cssProps[l] || (x.cssProps[l] = tn(e.style, l)), s = x.cssHooks[n] || x.cssHooks[l], s && "get"in s && (a = s.get(e, !0, r)), a === t && (a = Wt(e, n, i)), "normal" === a && n in Kt && (a = Kt[n]), "" === r || r ? (o = parseFloat(a), r === !0 || x.isNumeric(o) ? o || 0 : a) : a
    }}), e.getComputedStyle ? (Rt = function (t) {
        return e.getComputedStyle(t, null)
    }, Wt = function (e, n, r) {
        var i, o, a, s = r || Rt(e), l = s ? s.getPropertyValue(n) || s[n] : t, u = e.style;
        return s && ("" !== l || x.contains(e.ownerDocument, e) || (l = x.style(e, n)), Yt.test(l) && Ut.test(n) && (i = u.width, o = u.minWidth, a = u.maxWidth, u.minWidth = u.maxWidth = u.width = l, l = s.width, u.width = i, u.minWidth = o, u.maxWidth = a)), l
    }) : a.documentElement.currentStyle && (Rt = function (e) {
        return e.currentStyle
    }, Wt = function (e, n, r) {
        var i, o, a, s = r || Rt(e), l = s ? s[n] : t, u = e.style;
        return null == l && u && u[n] && (l = u[n]), Yt.test(l) && !zt.test(n) && (i = u.left, o = e.runtimeStyle, a = o && o.left, a && (o.left = e.currentStyle.left), u.left = "fontSize" === n ? "1em" : l, l = u.pixelLeft + "px", u.left = i, a && (o.left = a)), "" === l ? "auto" : l
    });
    function on(e, t, n) {
        var r = Vt.exec(t);
        return r ? Math.max(0, r[1] - (n || 0)) + (r[2] || "px") : t
    }

    function an(e, t, n, r, i) {
        var o = n === (r ? "border" : "content") ? 4 : "width" === t ? 1 : 0, a = 0;
        for (; 4 > o; o += 2)"margin" === n && (a += x.css(e, n + Zt[o], !0, i)), r ? ("content" === n && (a -= x.css(e, "padding" + Zt[o], !0, i)), "margin" !== n && (a -= x.css(e, "border" + Zt[o] + "Width", !0, i))) : (a += x.css(e, "padding" + Zt[o], !0, i), "padding" !== n && (a += x.css(e, "border" + Zt[o] + "Width", !0, i)));
        return a
    }

    function sn(e, t, n) {
        var r = !0, i = "width" === t ? e.offsetWidth : e.offsetHeight, o = Rt(e), a = x.support.boxSizing && "border-box" === x.css(e, "boxSizing", !1, o);
        if (0 >= i || null == i) {
            if (i = Wt(e, t, o), (0 > i || null == i) && (i = e.style[t]), Yt.test(i))return i;
            r = a && (x.support.boxSizingReliable || i === e.style[t]), i = parseFloat(i) || 0
        }
        return i + an(e, t, n || (a ? "border" : "content"), r, o) + "px"
    }

    function ln(e) {
        var t = a, n = Gt[e];
        return n || (n = un(e, t), "none" !== n && n || (Pt = (Pt || x("<iframe frameborder='0' width='0' height='0'/>").css("cssText", "display:block !important")).appendTo(t.documentElement), t = (Pt[0].contentWindow || Pt[0].contentDocument).document, t.write("<!doctype html><html><body>"), t.close(), n = un(e, t), Pt.detach()), Gt[e] = n), n
    }

    function un(e, t) {
        var n = x(t.createElement(e)).appendTo(t.body), r = x.css(n[0], "display");
        return n.remove(), r
    }

    x.each(["height", "width"], function (e, n) {
        x.cssHooks[n] = {get: function (e, r, i) {
            return r ? 0 === e.offsetWidth && Xt.test(x.css(e, "display")) ? x.swap(e, Qt, function () {
                return sn(e, n, i)
            }) : sn(e, n, i) : t
        }, set: function (e, t, r) {
            var i = r && Rt(e);
            return on(e, t, r ? an(e, n, r, x.support.boxSizing && "border-box" === x.css(e, "boxSizing", !1, i), i) : 0)
        }}
    }), x.support.opacity || (x.cssHooks.opacity = {get: function (e, t) {
        return It.test((t && e.currentStyle ? e.currentStyle.filter : e.style.filter) || "") ? .01 * parseFloat(RegExp.$1) + "" : t ? "1" : ""
    }, set: function (e, t) {
        var n = e.style, r = e.currentStyle, i = x.isNumeric(t) ? "alpha(opacity=" + 100 * t + ")" : "", o = r && r.filter || n.filter || "";
        n.zoom = 1, (t >= 1 || "" === t) && "" === x.trim(o.replace($t, "")) && n.removeAttribute && (n.removeAttribute("filter"), "" === t || r && !r.filter) || (n.filter = $t.test(o) ? o.replace($t, i) : o + " " + i)
    }}), x(function () {
        x.support.reliableMarginRight || (x.cssHooks.marginRight = {get: function (e, n) {
            return n ? x.swap(e, {display: "inline-block"}, Wt, [e, "marginRight"]) : t
        }}), !x.support.pixelPosition && x.fn.position && x.each(["top", "left"], function (e, n) {
            x.cssHooks[n] = {get: function (e, r) {
                return r ? (r = Wt(e, n), Yt.test(r) ? x(e).position()[n] + "px" : r) : t
            }}
        })
    }), x.expr && x.expr.filters && (x.expr.filters.hidden = function (e) {
        return 0 >= e.offsetWidth && 0 >= e.offsetHeight || !x.support.reliableHiddenOffsets && "none" === (e.style && e.style.display || x.css(e, "display"))
    }, x.expr.filters.visible = function (e) {
        return!x.expr.filters.hidden(e)
    }), x.each({margin: "", padding: "", border: "Width"}, function (e, t) {
        x.cssHooks[e + t] = {expand: function (n) {
            var r = 0, i = {}, o = "string" == typeof n ? n.split(" ") : [n];
            for (; 4 > r; r++)i[e + Zt[r] + t] = o[r] || o[r - 2] || o[0];
            return i
        }}, Ut.test(e) || (x.cssHooks[e + t].set = on)
    });
    var cn = /%20/g, pn = /\[\]$/, fn = /\r?\n/g, dn = /^(?:submit|button|image|reset|file)$/i, hn = /^(?:input|select|textarea|keygen)/i;
    x.fn.extend({serialize: function () {
        return x.param(this.serializeArray())
    }, serializeArray: function () {
        return this.map(function () {
            var e = x.prop(this, "elements");
            return e ? x.makeArray(e) : this
        }).filter(function () {
            var e = this.type;
            return this.name && !x(this).is(":disabled") && hn.test(this.nodeName) && !dn.test(e) && (this.checked || !Ct.test(e))
        }).map(function (e, t) {
            var n = x(this).val();
            return null == n ? null : x.isArray(n) ? x.map(n, function (e) {
                return{name: t.name, value: e.replace(fn, "\r\n")}
            }) : {name: t.name, value: n.replace(fn, "\r\n")}
        }).get()
    }}), x.param = function (e, n) {
        var r, i = [], o = function (e, t) {
            t = x.isFunction(t) ? t() : null == t ? "" : t, i[i.length] = encodeURIComponent(e) + "=" + encodeURIComponent(t)
        };
        if (n === t && (n = x.ajaxSettings && x.ajaxSettings.traditional), x.isArray(e) || e.jquery && !x.isPlainObject(e))x.each(e, function () {
            o(this.name, this.value)
        }); else for (r in e)gn(r, e[r], n, o);
        return i.join("&").replace(cn, "+")
    };
    function gn(e, t, n, r) {
        var i;
        if (x.isArray(t))x.each(t, function (t, i) {
            n || pn.test(e) ? r(e, i) : gn(e + "[" + ("object" == typeof i ? t : "") + "]", i, n, r)
        }); else if (n || "object" !== x.type(t))r(e, t); else for (i in t)gn(e + "[" + i + "]", t[i], n, r)
    }

    x.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "), function (e, t) {
        x.fn[t] = function (e, n) {
            return arguments.length > 0 ? this.on(t, null, e, n) : this.trigger(t)
        }
    }), x.fn.extend({hover: function (e, t) {
        return this.mouseenter(e).mouseleave(t || e)
    }, bind: function (e, t, n) {
        return this.on(e, null, t, n)
    }, unbind: function (e, t) {
        return this.off(e, null, t)
    }, delegate: function (e, t, n, r) {
        return this.on(t, e, n, r)
    }, undelegate: function (e, t, n) {
        return 1 === arguments.length ? this.off(e, "**") : this.off(t, e || "**", n)
    }});
    var mn, yn, vn = x.now(), bn = /\?/, xn = /#.*$/, wn = /([?&])_=[^&]*/, Tn = /^(.*?):[ \t]*([^\r\n]*)\r?$/gm, Cn = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/, Nn = /^(?:GET|HEAD)$/, kn = /^\/\//, En = /^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/, Sn = x.fn.load, An = {}, jn = {}, Dn = "*/".concat("*");
    try {
        yn = o.href
    } catch (Ln) {
        yn = a.createElement("a"), yn.href = "", yn = yn.href
    }
    mn = En.exec(yn.toLowerCase()) || [];
    function Hn(e) {
        return function (t, n) {
            "string" != typeof t && (n = t, t = "*");
            var r, i = 0, o = t.toLowerCase().match(T) || [];
            if (x.isFunction(n))while (r = o[i++])"+" === r[0] ? (r = r.slice(1) || "*", (e[r] = e[r] || []).unshift(n)) : (e[r] = e[r] || []).push(n)
        }
    }

    function qn(e, n, r, i) {
        var o = {}, a = e === jn;

        function s(l) {
            var u;
            return o[l] = !0, x.each(e[l] || [], function (e, l) {
                var c = l(n, r, i);
                return"string" != typeof c || a || o[c] ? a ? !(u = c) : t : (n.dataTypes.unshift(c), s(c), !1)
            }), u
        }

        return s(n.dataTypes[0]) || !o["*"] && s("*")
    }

    function _n(e, n) {
        var r, i, o = x.ajaxSettings.flatOptions || {};
        for (i in n)n[i] !== t && ((o[i] ? e : r || (r = {}))[i] = n[i]);
        return r && x.extend(!0, e, r), e
    }

    x.fn.load = function (e, n, r) {
        if ("string" != typeof e && Sn)return Sn.apply(this, arguments);
        var i, o, a, s = this, l = e.indexOf(" ");
        return l >= 0 && (i = e.slice(l, e.length), e = e.slice(0, l)), x.isFunction(n) ? (r = n, n = t) : n && "object" == typeof n && (a = "POST"), s.length > 0 && x.ajax({url: e, type: a, dataType: "html", data: n}).done(function (e) {
            o = arguments, s.html(i ? x("<div>").append(x.parseHTML(e)).find(i) : e)
        }).complete(r && function (e, t) {
            s.each(r, o || [e.responseText, t, e])
        }), this
    }, x.each(["ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend"], function (e, t) {
        x.fn[t] = function (e) {
            return this.on(t, e)
        }
    }), x.extend({active: 0, lastModified: {}, etag: {}, ajaxSettings: {url: yn, type: "GET", isLocal: Cn.test(mn[1]), global: !0, processData: !0, async: !0, contentType: "application/x-www-form-urlencoded; charset=UTF-8", accepts: {"*": Dn, text: "text/plain", html: "text/html", xml: "application/xml, text/xml", json: "application/json, text/javascript"}, contents: {xml: /xml/, html: /html/, json: /json/}, responseFields: {xml: "responseXML", text: "responseText", json: "responseJSON"}, converters: {"* text": String, "text html": !0, "text json": x.parseJSON, "text xml": x.parseXML}, flatOptions: {url: !0, context: !0}}, ajaxSetup: function (e, t) {
        return t ? _n(_n(e, x.ajaxSettings), t) : _n(x.ajaxSettings, e)
    }, ajaxPrefilter: Hn(An), ajaxTransport: Hn(jn), ajax: function (e, n) {
        "object" == typeof e && (n = e, e = t), n = n || {};
        var r, i, o, a, s, l, u, c, p = x.ajaxSetup({}, n), f = p.context || p, d = p.context && (f.nodeType || f.jquery) ? x(f) : x.event, h = x.Deferred(), g = x.Callbacks("once memory"), m = p.statusCode || {}, y = {}, v = {}, b = 0, w = "canceled", C = {readyState: 0, getResponseHeader: function (e) {
            var t;
            if (2 === b) {
                if (!c) {
                    c = {};
                    while (t = Tn.exec(a))c[t[1].toLowerCase()] = t[2]
                }
                t = c[e.toLowerCase()]
            }
            return null == t ? null : t
        }, getAllResponseHeaders: function () {
            return 2 === b ? a : null
        }, setRequestHeader: function (e, t) {
            var n = e.toLowerCase();
            return b || (e = v[n] = v[n] || e, y[e] = t), this
        }, overrideMimeType: function (e) {
            return b || (p.mimeType = e), this
        }, statusCode: function (e) {
            var t;
            if (e)if (2 > b)for (t in e)m[t] = [m[t], e[t]]; else C.always(e[C.status]);
            return this
        }, abort: function (e) {
            var t = e || w;
            return u && u.abort(t), k(0, t), this
        }};
        if (h.promise(C).complete = g.add, C.success = C.done, C.error = C.fail, p.url = ((e || p.url || yn) + "").replace(xn, "").replace(kn, mn[1] + "//"), p.type = n.method || n.type || p.method || p.type, p.dataTypes = x.trim(p.dataType || "*").toLowerCase().match(T) || [""], null == p.crossDomain && (r = En.exec(p.url.toLowerCase()), p.crossDomain = !(!r || r[1] === mn[1] && r[2] === mn[2] && (r[3] || ("http:" === r[1] ? "80" : "443")) === (mn[3] || ("http:" === mn[1] ? "80" : "443")))), p.data && p.processData && "string" != typeof p.data && (p.data = x.param(p.data, p.traditional)), qn(An, p, n, C), 2 === b)return C;
        l = p.global, l && 0 === x.active++ && x.event.trigger("ajaxStart"), p.type = p.type.toUpperCase(), p.hasContent = !Nn.test(p.type), o = p.url, p.hasContent || (p.data && (o = p.url += (bn.test(o) ? "&" : "?") + p.data, delete p.data), p.cache === !1 && (p.url = wn.test(o) ? o.replace(wn, "$1_=" + vn++) : o + (bn.test(o) ? "&" : "?") + "_=" + vn++)), p.ifModified && (x.lastModified[o] && C.setRequestHeader("If-Modified-Since", x.lastModified[o]), x.etag[o] && C.setRequestHeader("If-None-Match", x.etag[o])), (p.data && p.hasContent && p.contentType !== !1 || n.contentType) && C.setRequestHeader("Content-Type", p.contentType), C.setRequestHeader("Accept", p.dataTypes[0] && p.accepts[p.dataTypes[0]] ? p.accepts[p.dataTypes[0]] + ("*" !== p.dataTypes[0] ? ", " + Dn + "; q=0.01" : "") : p.accepts["*"]);
        for (i in p.headers)C.setRequestHeader(i, p.headers[i]);
        if (p.beforeSend && (p.beforeSend.call(f, C, p) === !1 || 2 === b))return C.abort();
        w = "abort";
        for (i in{success: 1, error: 1, complete: 1})C[i](p[i]);
        if (u = qn(jn, p, n, C)) {
            C.readyState = 1, l && d.trigger("ajaxSend", [C, p]), p.async && p.timeout > 0 && (s = setTimeout(function () {
                C.abort("timeout")
            }, p.timeout));
            try {
                b = 1, u.send(y, k)
            } catch (N) {
                if (!(2 > b))throw N;
                k(-1, N)
            }
        } else k(-1, "No Transport");
        function k(e, n, r, i) {
            var c, y, v, w, T, N = n;
            2 !== b && (b = 2, s && clearTimeout(s), u = t, a = i || "", C.readyState = e > 0 ? 4 : 0, c = e >= 200 && 300 > e || 304 === e, r && (w = Mn(p, C, r)), w = On(p, w, C, c), c ? (p.ifModified && (T = C.getResponseHeader("Last-Modified"), T && (x.lastModified[o] = T), T = C.getResponseHeader("etag"), T && (x.etag[o] = T)), 204 === e || "HEAD" === p.type ? N = "nocontent" : 304 === e ? N = "notmodified" : (N = w.state, y = w.data, v = w.error, c = !v)) : (v = N, (e || !N) && (N = "error", 0 > e && (e = 0))), C.status = e, C.statusText = (n || N) + "", c ? h.resolveWith(f, [y, N, C]) : h.rejectWith(f, [C, N, v]), C.statusCode(m), m = t, l && d.trigger(c ? "ajaxSuccess" : "ajaxError", [C, p, c ? y : v]), g.fireWith(f, [C, N]), l && (d.trigger("ajaxComplete", [C, p]), --x.active || x.event.trigger("ajaxStop")))
        }

        return C
    }, getJSON: function (e, t, n) {
        return x.get(e, t, n, "json")
    }, getScript: function (e, n) {
        return x.get(e, t, n, "script")
    }}), x.each(["get", "post"], function (e, n) {
        x[n] = function (e, r, i, o) {
            return x.isFunction(r) && (o = o || i, i = r, r = t), x.ajax({url: e, type: n, dataType: o, data: r, success: i})
        }
    });
    function Mn(e, n, r) {
        var i, o, a, s, l = e.contents, u = e.dataTypes;
        while ("*" === u[0])u.shift(), o === t && (o = e.mimeType || n.getResponseHeader("Content-Type"));
        if (o)for (s in l)if (l[s] && l[s].test(o)) {
            u.unshift(s);
            break
        }
        if (u[0]in r)a = u[0]; else {
            for (s in r) {
                if (!u[0] || e.converters[s + " " + u[0]]) {
                    a = s;
                    break
                }
                i || (i = s)
            }
            a = a || i
        }
        return a ? (a !== u[0] && u.unshift(a), r[a]) : t
    }

    function On(e, t, n, r) {
        var i, o, a, s, l, u = {}, c = e.dataTypes.slice();
        if (c[1])for (a in e.converters)u[a.toLowerCase()] = e.converters[a];
        o = c.shift();
        while (o)if (e.responseFields[o] && (n[e.responseFields[o]] = t), !l && r && e.dataFilter && (t = e.dataFilter(t, e.dataType)), l = o, o = c.shift())if ("*" === o)o = l; else if ("*" !== l && l !== o) {
            if (a = u[l + " " + o] || u["* " + o], !a)for (i in u)if (s = i.split(" "), s[1] === o && (a = u[l + " " + s[0]] || u["* " + s[0]])) {
                a === !0 ? a = u[i] : u[i] !== !0 && (o = s[0], c.unshift(s[1]));
                break
            }
            if (a !== !0)if (a && e["throws"])t = a(t); else try {
                t = a(t)
            } catch (p) {
                return{state: "parsererror", error: a ? p : "No conversion from " + l + " to " + o}
            }
        }
        return{state: "success", data: t}
    }

    x.ajaxSetup({accepts: {script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"}, contents: {script: /(?:java|ecma)script/}, converters: {"text script": function (e) {
        return x.globalEval(e), e
    }}}), x.ajaxPrefilter("script", function (e) {
        e.cache === t && (e.cache = !1), e.crossDomain && (e.type = "GET", e.global = !1)
    }), x.ajaxTransport("script", function (e) {
        if (e.crossDomain) {
            var n, r = a.head || x("head")[0] || a.documentElement;
            return{send: function (t, i) {
                n = a.createElement("script"), n.async = !0, e.scriptCharset && (n.charset = e.scriptCharset), n.src = e.url, n.onload = n.onreadystatechange = function (e, t) {
                    (t || !n.readyState || /loaded|complete/.test(n.readyState)) && (n.onload = n.onreadystatechange = null, n.parentNode && n.parentNode.removeChild(n), n = null, t || i(200, "success"))
                }, r.insertBefore(n, r.firstChild)
            }, abort: function () {
                n && n.onload(t, !0)
            }}
        }
    });
    var Fn = [], Bn = /(=)\?(?=&|$)|\?\?/;
    x.ajaxSetup({jsonp: "callback", jsonpCallback: function () {
        var e = Fn.pop() || x.expando + "_" + vn++;
        return this[e] = !0, e
    }}), x.ajaxPrefilter("json jsonp", function (n, r, i) {
        var o, a, s, l = n.jsonp !== !1 && (Bn.test(n.url) ? "url" : "string" == typeof n.data && !(n.contentType || "").indexOf("application/x-www-form-urlencoded") && Bn.test(n.data) && "data");
        return l || "jsonp" === n.dataTypes[0] ? (o = n.jsonpCallback = x.isFunction(n.jsonpCallback) ? n.jsonpCallback() : n.jsonpCallback, l ? n[l] = n[l].replace(Bn, "$1" + o) : n.jsonp !== !1 && (n.url += (bn.test(n.url) ? "&" : "?") + n.jsonp + "=" + o), n.converters["script json"] = function () {
            return s || x.error(o + " was not called"), s[0]
        }, n.dataTypes[0] = "json", a = e[o], e[o] = function () {
            s = arguments
        }, i.always(function () {
            e[o] = a, n[o] && (n.jsonpCallback = r.jsonpCallback, Fn.push(o)), s && x.isFunction(a) && a(s[0]), s = a = t
        }), "script") : t
    });
    var Pn, Rn, Wn = 0, $n = e.ActiveXObject && function () {
        var e;
        for (e in Pn)Pn[e](t, !0)
    };

    function In() {
        try {
            return new e.XMLHttpRequest
        } catch (t) {
        }
    }

    function zn() {
        try {
            return new e.ActiveXObject("Microsoft.XMLHTTP")
        } catch (t) {
        }
    }

    x.ajaxSettings.xhr = e.ActiveXObject ? function () {
        return!this.isLocal && In() || zn()
    } : In, Rn = x.ajaxSettings.xhr(), x.support.cors = !!Rn && "withCredentials"in Rn, Rn = x.support.ajax = !!Rn, Rn && x.ajaxTransport(function (n) {
        if (!n.crossDomain || x.support.cors) {
            var r;
            return{send: function (i, o) {
                var a, s, l = n.xhr();
                if (n.username ? l.open(n.type, n.url, n.async, n.username, n.password) : l.open(n.type, n.url, n.async), n.xhrFields)for (s in n.xhrFields)l[s] = n.xhrFields[s];
                n.mimeType && l.overrideMimeType && l.overrideMimeType(n.mimeType), n.crossDomain || i["X-Requested-With"] || (i["X-Requested-With"] = "XMLHttpRequest");
                try {
                    for (s in i)l.setRequestHeader(s, i[s])
                } catch (u) {
                }
                l.send(n.hasContent && n.data || null), r = function (e, i) {
                    var s, u, c, p;
                    try {
                        if (r && (i || 4 === l.readyState))if (r = t, a && (l.onreadystatechange = x.noop, $n && delete Pn[a]), i)4 !== l.readyState && l.abort(); else {
                            p = {}, s = l.status, u = l.getAllResponseHeaders(), "string" == typeof l.responseText && (p.text = l.responseText);
                            try {
                                c = l.statusText
                            } catch (f) {
                                c = ""
                            }
                            s || !n.isLocal || n.crossDomain ? 1223 === s && (s = 204) : s = p.text ? 200 : 404
                        }
                    } catch (d) {
                        i || o(-1, d)
                    }
                    p && o(s, c, p, u)
                }, n.async ? 4 === l.readyState ? setTimeout(r) : (a = ++Wn, $n && (Pn || (Pn = {}, x(e).unload($n)), Pn[a] = r), l.onreadystatechange = r) : r()
            }, abort: function () {
                r && r(t, !0)
            }}
        }
    });
    var Xn, Un, Vn = /^(?:toggle|show|hide)$/, Yn = RegExp("^(?:([+-])=|)(" + w + ")([a-z%]*)$", "i"), Jn = /queueHooks$/, Gn = [nr], Qn = {"*": [function (e, t) {
        var n = this.createTween(e, t), r = n.cur(), i = Yn.exec(t), o = i && i[3] || (x.cssNumber[e] ? "" : "px"), a = (x.cssNumber[e] || "px" !== o && +r) && Yn.exec(x.css(n.elem, e)), s = 1, l = 20;
        if (a && a[3] !== o) {
            o = o || a[3], i = i || [], a = +r || 1;
            do s = s || ".5", a /= s, x.style(n.elem, e, a + o); while (s !== (s = n.cur() / r) && 1 !== s && --l)
        }
        return i && (a = n.start = +a || +r || 0, n.unit = o, n.end = i[1] ? a + (i[1] + 1) * i[2] : +i[2]), n
    }]};

    function Kn() {
        return setTimeout(function () {
            Xn = t
        }), Xn = x.now()
    }

    function Zn(e, t, n) {
        var r, i = (Qn[t] || []).concat(Qn["*"]), o = 0, a = i.length;
        for (; a > o; o++)if (r = i[o].call(n, t, e))return r
    }

    function er(e, t, n) {
        var r, i, o = 0, a = Gn.length, s = x.Deferred().always(function () {
            delete l.elem
        }), l = function () {
            if (i)return!1;
            var t = Xn || Kn(), n = Math.max(0, u.startTime + u.duration - t), r = n / u.duration || 0, o = 1 - r, a = 0, l = u.tweens.length;
            for (; l > a; a++)u.tweens[a].run(o);
            return s.notifyWith(e, [u, o, n]), 1 > o && l ? n : (s.resolveWith(e, [u]), !1)
        }, u = s.promise({elem: e, props: x.extend({}, t), opts: x.extend(!0, {specialEasing: {}}, n), originalProperties: t, originalOptions: n, startTime: Xn || Kn(), duration: n.duration, tweens: [], createTween: function (t, n) {
            var r = x.Tween(e, u.opts, t, n, u.opts.specialEasing[t] || u.opts.easing);
            return u.tweens.push(r), r
        }, stop: function (t) {
            var n = 0, r = t ? u.tweens.length : 0;
            if (i)return this;
            for (i = !0; r > n; n++)u.tweens[n].run(1);
            return t ? s.resolveWith(e, [u, t]) : s.rejectWith(e, [u, t]), this
        }}), c = u.props;
        for (tr(c, u.opts.specialEasing); a > o; o++)if (r = Gn[o].call(u, e, c, u.opts))return r;
        return x.map(c, Zn, u), x.isFunction(u.opts.start) && u.opts.start.call(e, u), x.fx.timer(x.extend(l, {elem: e, anim: u, queue: u.opts.queue})), u.progress(u.opts.progress).done(u.opts.done, u.opts.complete).fail(u.opts.fail).always(u.opts.always)
    }

    function tr(e, t) {
        var n, r, i, o, a;
        for (n in e)if (r = x.camelCase(n), i = t[r], o = e[n], x.isArray(o) && (i = o[1], o = e[n] = o[0]), n !== r && (e[r] = o, delete e[n]), a = x.cssHooks[r], a && "expand"in a) {
            o = a.expand(o), delete e[r];
            for (n in o)n in e || (e[n] = o[n], t[n] = i)
        } else t[r] = i
    }

    x.Animation = x.extend(er, {tweener: function (e, t) {
        x.isFunction(e) ? (t = e, e = ["*"]) : e = e.split(" ");
        var n, r = 0, i = e.length;
        for (; i > r; r++)n = e[r], Qn[n] = Qn[n] || [], Qn[n].unshift(t)
    }, prefilter: function (e, t) {
        t ? Gn.unshift(e) : Gn.push(e)
    }});
    function nr(e, t, n) {
        var r, i, o, a, s, l, u = this, c = {}, p = e.style, f = e.nodeType && nn(e), d = x._data(e, "fxshow");
        n.queue || (s = x._queueHooks(e, "fx"), null == s.unqueued && (s.unqueued = 0, l = s.empty.fire, s.empty.fire = function () {
            s.unqueued || l()
        }), s.unqueued++, u.always(function () {
            u.always(function () {
                s.unqueued--, x.queue(e, "fx").length || s.empty.fire()
            })
        })), 1 === e.nodeType && ("height"in t || "width"in t) && (n.overflow = [p.overflow, p.overflowX, p.overflowY], "inline" === x.css(e, "display") && "none" === x.css(e, "float") && (x.support.inlineBlockNeedsLayout && "inline" !== ln(e.nodeName) ? p.zoom = 1 : p.display = "inline-block")), n.overflow && (p.overflow = "hidden", x.support.shrinkWrapBlocks || u.always(function () {
            p.overflow = n.overflow[0], p.overflowX = n.overflow[1], p.overflowY = n.overflow[2]
        }));
        for (r in t)if (i = t[r], Vn.exec(i)) {
            if (delete t[r], o = o || "toggle" === i, i === (f ? "hide" : "show"))continue;
            c[r] = d && d[r] || x.style(e, r)
        }
        if (!x.isEmptyObject(c)) {
            d ? "hidden"in d && (f = d.hidden) : d = x._data(e, "fxshow", {}), o && (d.hidden = !f), f ? x(e).show() : u.done(function () {
                x(e).hide()
            }), u.done(function () {
                var t;
                x._removeData(e, "fxshow");
                for (t in c)x.style(e, t, c[t])
            });
            for (r in c)a = Zn(f ? d[r] : 0, r, u), r in d || (d[r] = a.start, f && (a.end = a.start, a.start = "width" === r || "height" === r ? 1 : 0))
        }
    }

    function rr(e, t, n, r, i) {
        return new rr.prototype.init(e, t, n, r, i)
    }

    x.Tween = rr, rr.prototype = {constructor: rr, init: function (e, t, n, r, i, o) {
        this.elem = e, this.prop = n, this.easing = i || "swing", this.options = t, this.start = this.now = this.cur(), this.end = r, this.unit = o || (x.cssNumber[n] ? "" : "px")
    }, cur: function () {
        var e = rr.propHooks[this.prop];
        return e && e.get ? e.get(this) : rr.propHooks._default.get(this)
    }, run: function (e) {
        var t, n = rr.propHooks[this.prop];
        return this.pos = t = this.options.duration ? x.easing[this.easing](e, this.options.duration * e, 0, 1, this.options.duration) : e, this.now = (this.end - this.start) * t + this.start, this.options.step && this.options.step.call(this.elem, this.now, this), n && n.set ? n.set(this) : rr.propHooks._default.set(this), this
    }}, rr.prototype.init.prototype = rr.prototype, rr.propHooks = {_default: {get: function (e) {
        var t;
        return null == e.elem[e.prop] || e.elem.style && null != e.elem.style[e.prop] ? (t = x.css(e.elem, e.prop, ""), t && "auto" !== t ? t : 0) : e.elem[e.prop]
    }, set: function (e) {
        x.fx.step[e.prop] ? x.fx.step[e.prop](e) : e.elem.style && (null != e.elem.style[x.cssProps[e.prop]] || x.cssHooks[e.prop]) ? x.style(e.elem, e.prop, e.now + e.unit) : e.elem[e.prop] = e.now
    }}}, rr.propHooks.scrollTop = rr.propHooks.scrollLeft = {set: function (e) {
        e.elem.nodeType && e.elem.parentNode && (e.elem[e.prop] = e.now)
    }}, x.each(["toggle", "show", "hide"], function (e, t) {
        var n = x.fn[t];
        x.fn[t] = function (e, r, i) {
            return null == e || "boolean" == typeof e ? n.apply(this, arguments) : this.animate(ir(t, !0), e, r, i)
        }
    }), x.fn.extend({fadeTo: function (e, t, n, r) {
        return this.filter(nn).css("opacity", 0).show().end().animate({opacity: t}, e, n, r)
    }, animate: function (e, t, n, r) {
        var i = x.isEmptyObject(e), o = x.speed(t, n, r), a = function () {
            var t = er(this, x.extend({}, e), o);
            (i || x._data(this, "finish")) && t.stop(!0)
        };
        return a.finish = a, i || o.queue === !1 ? this.each(a) : this.queue(o.queue, a)
    }, stop: function (e, n, r) {
        var i = function (e) {
            var t = e.stop;
            delete e.stop, t(r)
        };
        return"string" != typeof e && (r = n, n = e, e = t), n && e !== !1 && this.queue(e || "fx", []), this.each(function () {
            var t = !0, n = null != e && e + "queueHooks", o = x.timers, a = x._data(this);
            if (n)a[n] && a[n].stop && i(a[n]); else for (n in a)a[n] && a[n].stop && Jn.test(n) && i(a[n]);
            for (n = o.length; n--;)o[n].elem !== this || null != e && o[n].queue !== e || (o[n].anim.stop(r), t = !1, o.splice(n, 1));
            (t || !r) && x.dequeue(this, e)
        })
    }, finish: function (e) {
        return e !== !1 && (e = e || "fx"), this.each(function () {
            var t, n = x._data(this), r = n[e + "queue"], i = n[e + "queueHooks"], o = x.timers, a = r ? r.length : 0;
            for (n.finish = !0, x.queue(this, e, []), i && i.stop && i.stop.call(this, !0), t = o.length; t--;)o[t].elem === this && o[t].queue === e && (o[t].anim.stop(!0), o.splice(t, 1));
            for (t = 0; a > t; t++)r[t] && r[t].finish && r[t].finish.call(this);
            delete n.finish
        })
    }});
    function ir(e, t) {
        var n, r = {height: e}, i = 0;
        for (t = t ? 1 : 0; 4 > i; i += 2 - t)n = Zt[i], r["margin" + n] = r["padding" + n] = e;
        return t && (r.opacity = r.width = e), r
    }

    x.each({slideDown: ir("show"), slideUp: ir("hide"), slideToggle: ir("toggle"), fadeIn: {opacity: "show"}, fadeOut: {opacity: "hide"}, fadeToggle: {opacity: "toggle"}}, function (e, t) {
        x.fn[e] = function (e, n, r) {
            return this.animate(t, e, n, r)
        }
    }), x.speed = function (e, t, n) {
        var r = e && "object" == typeof e ? x.extend({}, e) : {complete: n || !n && t || x.isFunction(e) && e, duration: e, easing: n && t || t && !x.isFunction(t) && t};
        return r.duration = x.fx.off ? 0 : "number" == typeof r.duration ? r.duration : r.duration in x.fx.speeds ? x.fx.speeds[r.duration] : x.fx.speeds._default, (null == r.queue || r.queue === !0) && (r.queue = "fx"), r.old = r.complete, r.complete = function () {
            x.isFunction(r.old) && r.old.call(this), r.queue && x.dequeue(this, r.queue)
        }, r
    }, x.easing = {linear: function (e) {
        return e
    }, swing: function (e) {
        return.5 - Math.cos(e * Math.PI) / 2
    }}, x.timers = [], x.fx = rr.prototype.init, x.fx.tick = function () {
        var e, n = x.timers, r = 0;
        for (Xn = x.now(); n.length > r; r++)e = n[r], e() || n[r] !== e || n.splice(r--, 1);
        n.length || x.fx.stop(), Xn = t
    }, x.fx.timer = function (e) {
        e() && x.timers.push(e) && x.fx.start()
    }, x.fx.interval = 13, x.fx.start = function () {
        Un || (Un = setInterval(x.fx.tick, x.fx.interval))
    }, x.fx.stop = function () {
        clearInterval(Un), Un = null
    }, x.fx.speeds = {slow: 600, fast: 200, _default: 400}, x.fx.step = {}, x.expr && x.expr.filters && (x.expr.filters.animated = function (e) {
        return x.grep(x.timers,function (t) {
            return e === t.elem
        }).length
    }), x.fn.offset = function (e) {
        if (arguments.length)return e === t ? this : this.each(function (t) {
            x.offset.setOffset(this, e, t)
        });
        var n, r, o = {top: 0, left: 0}, a = this[0], s = a && a.ownerDocument;
        if (s)return n = s.documentElement, x.contains(n, a) ? (typeof a.getBoundingClientRect !== i && (o = a.getBoundingClientRect()), r = or(s), {top: o.top + (r.pageYOffset || n.scrollTop) - (n.clientTop || 0), left: o.left + (r.pageXOffset || n.scrollLeft) - (n.clientLeft || 0)}) : o
    }, x.offset = {setOffset: function (e, t, n) {
        var r = x.css(e, "position");
        "static" === r && (e.style.position = "relative");
        var i = x(e), o = i.offset(), a = x.css(e, "top"), s = x.css(e, "left"), l = ("absolute" === r || "fixed" === r) && x.inArray("auto", [a, s]) > -1, u = {}, c = {}, p, f;
        l ? (c = i.position(), p = c.top, f = c.left) : (p = parseFloat(a) || 0, f = parseFloat(s) || 0), x.isFunction(t) && (t = t.call(e, n, o)), null != t.top && (u.top = t.top - o.top + p), null != t.left && (u.left = t.left - o.left + f), "using"in t ? t.using.call(e, u) : i.css(u)
    }}, x.fn.extend({position: function () {
        if (this[0]) {
            var e, t, n = {top: 0, left: 0}, r = this[0];
            return"fixed" === x.css(r, "position") ? t = r.getBoundingClientRect() : (e = this.offsetParent(), t = this.offset(), x.nodeName(e[0], "html") || (n = e.offset()), n.top += x.css(e[0], "borderTopWidth", !0), n.left += x.css(e[0], "borderLeftWidth", !0)), {top: t.top - n.top - x.css(r, "marginTop", !0), left: t.left - n.left - x.css(r, "marginLeft", !0)}
        }
    }, offsetParent: function () {
        return this.map(function () {
            var e = this.offsetParent || s;
            while (e && !x.nodeName(e, "html") && "static" === x.css(e, "position"))e = e.offsetParent;
            return e || s
        })
    }}), x.each({scrollLeft: "pageXOffset", scrollTop: "pageYOffset"}, function (e, n) {
        var r = /Y/.test(n);
        x.fn[e] = function (i) {
            return x.access(this, function (e, i, o) {
                var a = or(e);
                return o === t ? a ? n in a ? a[n] : a.document.documentElement[i] : e[i] : (a ? a.scrollTo(r ? x(a).scrollLeft() : o, r ? o : x(a).scrollTop()) : e[i] = o, t)
            }, e, i, arguments.length, null)
        }
    });
    function or(e) {
        return x.isWindow(e) ? e : 9 === e.nodeType ? e.defaultView || e.parentWindow : !1
    }

    x.each({Height: "height", Width: "width"}, function (e, n) {
        x.each({padding: "inner" + e, content: n, "": "outer" + e}, function (r, i) {
            x.fn[i] = function (i, o) {
                var a = arguments.length && (r || "boolean" != typeof i), s = r || (i === !0 || o === !0 ? "margin" : "border");
                return x.access(this, function (n, r, i) {
                    var o;
                    return x.isWindow(n) ? n.document.documentElement["client" + e] : 9 === n.nodeType ? (o = n.documentElement, Math.max(n.body["scroll" + e], o["scroll" + e], n.body["offset" + e], o["offset" + e], o["client" + e])) : i === t ? x.css(n, r, s) : x.style(n, r, i, s)
                }, n, a ? i : t, a, null)
            }
        })
    }), x.fn.size = function () {
        return this.length
    }, x.fn.andSelf = x.fn.addBack, "object" == typeof module && module && "object" == typeof module.exports ? module.exports = x : (e.jQuery = e.$ = x, "function" == typeof define && define.amd && define("jquery", [], function () {
        return x
    }))
})(window);

/* qTip2 v2.2.0 None | qtip2.com | Licensed MIT, GPL | Sat Mar 15 2014 10:36:19 */

!function(a,b,c){!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):jQuery&&!jQuery.fn.qtip&&a(jQuery)}(function(d){"use strict";function e(a,b,c,e){this.id=c,this.target=a,this.tooltip=A,this.elements={target:a},this._id=J+"-"+c,this.timers={img:{}},this.options=b,this.plugins={},this.cache={event:{},target:d(),disabled:z,attr:e,onTooltip:z,lastClass:""},this.rendered=this.destroyed=this.disabled=this.waiting=this.hiddenDuringWait=this.positioning=this.triggering=z}function f(a){return a===A||"object"!==d.type(a)}function g(a){return!(d.isFunction(a)||a&&a.attr||a.length||"object"===d.type(a)&&(a.jquery||a.then))}function h(a){var b,c,e,h;return f(a)?z:(f(a.metadata)&&(a.metadata={type:a.metadata}),"content"in a&&(b=a.content,f(b)||b.jquery||b.done?b=a.content={text:c=g(b)?z:b}:c=b.text,"ajax"in b&&(e=b.ajax,h=e&&e.once!==z,delete b.ajax,b.text=function(a,b){var f=c||d(this).attr(b.options.content.attr)||"Loading...",g=d.ajax(d.extend({},e,{context:b})).then(e.success,A,e.error).then(function(a){return a&&h&&b.set("content.text",a),a},function(a,c,d){b.destroyed||0===a.status||b.set("content.text",c+": "+d)});return h?f:(b.set("content.text",f),g)}),"title"in b&&(f(b.title)||(b.button=b.title.button,b.title=b.title.text),g(b.title||z)&&(b.title=z))),"position"in a&&f(a.position)&&(a.position={my:a.position,at:a.position}),"show"in a&&f(a.show)&&(a.show=a.show.jquery?{target:a.show}:a.show===y?{ready:y}:{event:a.show}),"hide"in a&&f(a.hide)&&(a.hide=a.hide.jquery?{target:a.hide}:{event:a.hide}),"style"in a&&f(a.style)&&(a.style={classes:a.style}),d.each(I,function(){this.sanitize&&this.sanitize(a)}),a)}function i(a,b){for(var c,d=0,e=a,f=b.split(".");e=e[f[d++]];)d<f.length&&(c=e);return[c||a,f.pop()]}function j(a,b){var c,d,e;for(c in this.checks)for(d in this.checks[c])(e=new RegExp(d,"i").exec(a))&&(b.push(e),("builtin"===c||this.plugins[c])&&this.checks[c][d].apply(this.plugins[c]||this,b))}function k(a){return M.concat("").join(a?"-"+a+" ":" ")}function l(c){return c&&{type:c.type,pageX:c.pageX,pageY:c.pageY,target:c.target,relatedTarget:c.relatedTarget,scrollX:c.scrollX||a.pageXOffset||b.body.scrollLeft||b.documentElement.scrollLeft,scrollY:c.scrollY||a.pageYOffset||b.body.scrollTop||b.documentElement.scrollTop}||{}}function m(a,b){return b>0?setTimeout(d.proxy(a,this),b):(a.call(this),void 0)}function n(a){return this.tooltip.hasClass(T)?z:(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this.timers.show=m.call(this,function(){this.toggle(y,a)},this.options.show.delay),void 0)}function o(a){if(this.tooltip.hasClass(T))return z;var b=d(a.relatedTarget),c=b.closest(N)[0]===this.tooltip[0],e=b[0]===this.options.show.target[0];if(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this!==b[0]&&"mouse"===this.options.position.target&&c||this.options.hide.fixed&&/mouse(out|leave|move)/.test(a.type)&&(c||e))try{a.preventDefault(),a.stopImmediatePropagation()}catch(f){}else this.timers.hide=m.call(this,function(){this.toggle(z,a)},this.options.hide.delay,this)}function p(a){return this.tooltip.hasClass(T)||!this.options.hide.inactive?z:(clearTimeout(this.timers.inactive),this.timers.inactive=m.call(this,function(){this.hide(a)},this.options.hide.inactive),void 0)}function q(a){this.rendered&&this.tooltip[0].offsetWidth>0&&this.reposition(a)}function r(a,c,e){d(b.body).delegate(a,(c.split?c:c.join($+" "))+$,function(){var a=t.api[d.attr(this,L)];a&&!a.disabled&&e.apply(a,arguments)})}function s(a,c,f){var g,i,j,k,l,m=d(b.body),n=a[0]===b?m:a,o=a.metadata?a.metadata(f.metadata):A,p="html5"===f.metadata.type&&o?o[f.metadata.name]:A,q=a.data(f.metadata.name||"qtipopts");try{q="string"==typeof q?d.parseJSON(q):q}catch(r){}if(k=d.extend(y,{},t.defaults,f,"object"==typeof q?h(q):A,h(p||o)),i=k.position,k.id=c,"boolean"==typeof k.content.text){if(j=a.attr(k.content.attr),k.content.attr===z||!j)return z;k.content.text=j}if(i.container.length||(i.container=m),i.target===z&&(i.target=n),k.show.target===z&&(k.show.target=n),k.show.solo===y&&(k.show.solo=i.container.closest("body")),k.hide.target===z&&(k.hide.target=n),k.position.viewport===y&&(k.position.viewport=i.container),i.container=i.container.eq(0),i.at=new v(i.at,y),i.my=new v(i.my),a.data(J))if(k.overwrite)a.qtip("destroy",!0);else if(k.overwrite===z)return z;return a.attr(K,c),k.suppress&&(l=a.attr("title"))&&a.removeAttr("title").attr(V,l).attr("title",""),g=new e(a,k,c,!!j),a.data(J,g),a.one("remove.qtip-"+c+" removeqtip.qtip-"+c,function(){var a;(a=d(this).data(J))&&a.destroy(!0)}),g}var t,u,v,w,x,y=!0,z=!1,A=null,B="x",C="y",D="top",E="left",F="bottom",G="right",H="center",I={},J="qtip",K="data-hasqtip",L="data-qtip-id",M=["ui-widget","ui-tooltip"],N="."+J,O="click dblclick mousedown mouseup mousemove mouseleave mouseenter".split(" "),P=J+"-fixed",Q=J+"-default",R=J+"-focus",S=J+"-hover",T=J+"-disabled",U="_replacedByqTip",V="oldtitle",W={ie:function(){for(var a=3,c=b.createElement("div");(c.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->")&&c.getElementsByTagName("i")[0];);return a>4?a:0/0}(),iOS:parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||z};u=e.prototype,u._when=function(a){return d.when.apply(d,a)},u.render=function(a){if(this.rendered||this.destroyed)return this;var b,c=this,e=this.options,f=this.cache,g=this.elements,h=e.content.text,i=e.content.title,j=e.content.button,k=e.position,l=("."+this._id+" ",[]);return d.attr(this.target[0],"aria-describedby",this._id),this.tooltip=g.tooltip=b=d("<div/>",{id:this._id,"class":[J,Q,e.style.classes,J+"-pos-"+e.position.my.abbrev()].join(" "),width:e.style.width||"",height:e.style.height||"",tracking:"mouse"===k.target&&k.adjust.mouse,role:"alert","aria-live":"polite","aria-atomic":z,"aria-describedby":this._id+"-content","aria-hidden":y}).toggleClass(T,this.disabled).attr(L,this.id).data(J,this).appendTo(k.container).append(g.content=d("<div />",{"class":J+"-content",id:this._id+"-content","aria-atomic":y})),this.rendered=-1,this.positioning=y,i&&(this._createTitle(),d.isFunction(i)||l.push(this._updateTitle(i,z))),j&&this._createButton(),d.isFunction(h)||l.push(this._updateContent(h,z)),this.rendered=y,this._setWidget(),d.each(I,function(a){var b;"render"===this.initialize&&(b=this(c))&&(c.plugins[a]=b)}),this._unassignEvents(),this._assignEvents(),this._when(l).then(function(){c._trigger("render"),c.positioning=z,c.hiddenDuringWait||!e.show.ready&&!a||c.toggle(y,f.event,z),c.hiddenDuringWait=z}),t.api[this.id]=this,this},u.destroy=function(a){function b(){if(!this.destroyed){this.destroyed=y;var a=this.target,b=a.attr(V);this.rendered&&this.tooltip.stop(1,0).find("*").remove().end().remove(),d.each(this.plugins,function(){this.destroy&&this.destroy()}),clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this._unassignEvents(),a.removeData(J).removeAttr(L).removeAttr(K).removeAttr("aria-describedby"),this.options.suppress&&b&&a.attr("title",b).removeAttr(V),this._unbind(a),this.options=this.elements=this.cache=this.timers=this.plugins=this.mouse=A,delete t.api[this.id]}}return this.destroyed?this.target:(a===y&&"hide"!==this.triggering||!this.rendered?b.call(this):(this.tooltip.one("tooltiphidden",d.proxy(b,this)),!this.triggering&&this.hide()),this.target)},w=u.checks={builtin:{"^id$":function(a,b,c,e){var f=c===y?t.nextid:c,g=J+"-"+f;f!==z&&f.length>0&&!d("#"+g).length?(this._id=g,this.rendered&&(this.tooltip[0].id=this._id,this.elements.content[0].id=this._id+"-content",this.elements.title[0].id=this._id+"-title")):a[b]=e},"^prerender":function(a,b,c){c&&!this.rendered&&this.render(this.options.show.ready)},"^content.text$":function(a,b,c){this._updateContent(c)},"^content.attr$":function(a,b,c,d){this.options.content.text===this.target.attr(d)&&this._updateContent(this.target.attr(c))},"^content.title$":function(a,b,c){return c?(c&&!this.elements.title&&this._createTitle(),this._updateTitle(c),void 0):this._removeTitle()},"^content.button$":function(a,b,c){this._updateButton(c)},"^content.title.(text|button)$":function(a,b,c){this.set("content."+b,c)},"^position.(my|at)$":function(a,b,c){"string"==typeof c&&(a[b]=new v(c,"at"===b))},"^position.container$":function(a,b,c){this.rendered&&this.tooltip.appendTo(c)},"^show.ready$":function(a,b,c){c&&(!this.rendered&&this.render(y)||this.toggle(y))},"^style.classes$":function(a,b,c,d){this.rendered&&this.tooltip.removeClass(d).addClass(c)},"^style.(width|height)":function(a,b,c){this.rendered&&this.tooltip.css(b,c)},"^style.widget|content.title":function(){this.rendered&&this._setWidget()},"^style.def":function(a,b,c){this.rendered&&this.tooltip.toggleClass(Q,!!c)},"^events.(render|show|move|hide|focus|blur)$":function(a,b,c){this.rendered&&this.tooltip[(d.isFunction(c)?"":"un")+"bind"]("tooltip"+b,c)},"^(show|hide|position).(event|target|fixed|inactive|leave|distance|viewport|adjust)":function(){if(this.rendered){var a=this.options.position;this.tooltip.attr("tracking","mouse"===a.target&&a.adjust.mouse),this._unassignEvents(),this._assignEvents()}}}},u.get=function(a){if(this.destroyed)return this;var b=i(this.options,a.toLowerCase()),c=b[0][b[1]];return c.precedance?c.string():c};var X=/^position\.(my|at|adjust|target|container|viewport)|style|content|show\.ready/i,Y=/^prerender|show\.ready/i;u.set=function(a,b){if(this.destroyed)return this;{var c,e=this.rendered,f=z,g=this.options;this.checks}return"string"==typeof a?(c=a,a={},a[c]=b):a=d.extend({},a),d.each(a,function(b,c){if(e&&Y.test(b))return delete a[b],void 0;var h,j=i(g,b.toLowerCase());h=j[0][j[1]],j[0][j[1]]=c&&c.nodeType?d(c):c,f=X.test(b)||f,a[b]=[j[0],j[1],c,h]}),h(g),this.positioning=y,d.each(a,d.proxy(j,this)),this.positioning=z,this.rendered&&this.tooltip[0].offsetWidth>0&&f&&this.reposition("mouse"===g.position.target?A:this.cache.event),this},u._update=function(a,b){var c=this,e=this.cache;return this.rendered&&a?(d.isFunction(a)&&(a=a.call(this.elements.target,e.event,this)||""),d.isFunction(a.then)?(e.waiting=y,a.then(function(a){return e.waiting=z,c._update(a,b)},A,function(a){return c._update(a,b)})):a===z||!a&&""!==a?z:(a.jquery&&a.length>0?b.empty().append(a.css({display:"block",visibility:"visible"})):b.html(a),this._waitForContent(b).then(function(a){a.images&&a.images.length&&c.rendered&&c.tooltip[0].offsetWidth>0&&c.reposition(e.event,!a.length)}))):z},u._waitForContent=function(a){var b=this.cache;return b.waiting=y,(d.fn.imagesLoaded?a.imagesLoaded():d.Deferred().resolve([])).done(function(){b.waiting=z}).promise()},u._updateContent=function(a,b){this._update(a,this.elements.content,b)},u._updateTitle=function(a,b){this._update(a,this.elements.title,b)===z&&this._removeTitle(z)},u._createTitle=function(){var a=this.elements,b=this._id+"-title";a.titlebar&&this._removeTitle(),a.titlebar=d("<div />",{"class":J+"-titlebar "+(this.options.style.widget?k("header"):"")}).append(a.title=d("<div />",{id:b,"class":J+"-title","aria-atomic":y})).insertBefore(a.content).delegate(".qtip-close","mousedown keydown mouseup keyup mouseout",function(a){d(this).toggleClass("ui-state-active ui-state-focus","down"===a.type.substr(-4))}).delegate(".qtip-close","mouseover mouseout",function(a){d(this).toggleClass("ui-state-hover","mouseover"===a.type)}),this.options.content.button&&this._createButton()},u._removeTitle=function(a){var b=this.elements;b.title&&(b.titlebar.remove(),b.titlebar=b.title=b.button=A,a!==z&&this.reposition())},u.reposition=function(c,e){if(!this.rendered||this.positioning||this.destroyed)return this;this.positioning=y;var f,g,h=this.cache,i=this.tooltip,j=this.options.position,k=j.target,l=j.my,m=j.at,n=j.viewport,o=j.container,p=j.adjust,q=p.method.split(" "),r=i.outerWidth(z),s=i.outerHeight(z),t=0,u=0,v=i.css("position"),w={left:0,top:0},x=i[0].offsetWidth>0,A=c&&"scroll"===c.type,B=d(a),C=o[0].ownerDocument,J=this.mouse;if(d.isArray(k)&&2===k.length)m={x:E,y:D},w={left:k[0],top:k[1]};else if("mouse"===k)m={x:E,y:D},!J||!J.pageX||!p.mouse&&c&&c.pageX?c&&c.pageX||((!p.mouse||this.options.show.distance)&&h.origin&&h.origin.pageX?c=h.origin:(!c||c&&("resize"===c.type||"scroll"===c.type))&&(c=h.event)):c=J,"static"!==v&&(w=o.offset()),C.body.offsetWidth!==(a.innerWidth||C.documentElement.clientWidth)&&(g=d(b.body).offset()),w={left:c.pageX-w.left+(g&&g.left||0),top:c.pageY-w.top+(g&&g.top||0)},p.mouse&&A&&J&&(w.left-=(J.scrollX||0)-B.scrollLeft(),w.top-=(J.scrollY||0)-B.scrollTop());else{if("event"===k?c&&c.target&&"scroll"!==c.type&&"resize"!==c.type?h.target=d(c.target):c.target||(h.target=this.elements.target):"event"!==k&&(h.target=d(k.jquery?k:this.elements.target)),k=h.target,k=d(k).eq(0),0===k.length)return this;k[0]===b||k[0]===a?(t=W.iOS?a.innerWidth:k.width(),u=W.iOS?a.innerHeight:k.height(),k[0]===a&&(w={top:(n||k).scrollTop(),left:(n||k).scrollLeft()})):I.imagemap&&k.is("area")?f=I.imagemap(this,k,m,I.viewport?q:z):I.svg&&k&&k[0].ownerSVGElement?f=I.svg(this,k,m,I.viewport?q:z):(t=k.outerWidth(z),u=k.outerHeight(z),w=k.offset()),f&&(t=f.width,u=f.height,g=f.offset,w=f.position),w=this.reposition.offset(k,w,o),(W.iOS>3.1&&W.iOS<4.1||W.iOS>=4.3&&W.iOS<4.33||!W.iOS&&"fixed"===v)&&(w.left-=B.scrollLeft(),w.top-=B.scrollTop()),(!f||f&&f.adjustable!==z)&&(w.left+=m.x===G?t:m.x===H?t/2:0,w.top+=m.y===F?u:m.y===H?u/2:0)}return w.left+=p.x+(l.x===G?-r:l.x===H?-r/2:0),w.top+=p.y+(l.y===F?-s:l.y===H?-s/2:0),I.viewport?(w.adjusted=I.viewport(this,w,j,t,u,r,s),g&&w.adjusted.left&&(w.left+=g.left),g&&w.adjusted.top&&(w.top+=g.top)):w.adjusted={left:0,top:0},this._trigger("move",[w,n.elem||n],c)?(delete w.adjusted,e===z||!x||isNaN(w.left)||isNaN(w.top)||"mouse"===k||!d.isFunction(j.effect)?i.css(w):d.isFunction(j.effect)&&(j.effect.call(i,this,d.extend({},w)),i.queue(function(a){d(this).css({opacity:"",height:""}),W.ie&&this.style.removeAttribute("filter"),a()})),this.positioning=z,this):this},u.reposition.offset=function(a,c,e){function f(a,b){c.left+=b*a.scrollLeft(),c.top+=b*a.scrollTop()}if(!e[0])return c;var g,h,i,j,k=d(a[0].ownerDocument),l=!!W.ie&&"CSS1Compat"!==b.compatMode,m=e[0];do"static"!==(h=d.css(m,"position"))&&("fixed"===h?(i=m.getBoundingClientRect(),f(k,-1)):(i=d(m).position(),i.left+=parseFloat(d.css(m,"borderLeftWidth"))||0,i.top+=parseFloat(d.css(m,"borderTopWidth"))||0),c.left-=i.left+(parseFloat(d.css(m,"marginLeft"))||0),c.top-=i.top+(parseFloat(d.css(m,"marginTop"))||0),g||"hidden"===(j=d.css(m,"overflow"))||"visible"===j||(g=d(m)));while(m=m.offsetParent);return g&&(g[0]!==k[0]||l)&&f(g,1),c};var Z=(v=u.reposition.Corner=function(a,b){a=(""+a).replace(/([A-Z])/," $1").replace(/middle/gi,H).toLowerCase(),this.x=(a.match(/left|right/i)||a.match(/center/)||["inherit"])[0].toLowerCase(),this.y=(a.match(/top|bottom|center/i)||["inherit"])[0].toLowerCase(),this.forceY=!!b;var c=a.charAt(0);this.precedance="t"===c||"b"===c?C:B}).prototype;Z.invert=function(a,b){this[a]=this[a]===E?G:this[a]===G?E:b||this[a]},Z.string=function(){var a=this.x,b=this.y;return a===b?a:this.precedance===C||this.forceY&&"center"!==b?b+" "+a:a+" "+b},Z.abbrev=function(){var a=this.string().split(" ");return a[0].charAt(0)+(a[1]&&a[1].charAt(0)||"")},Z.clone=function(){return new v(this.string(),this.forceY)},u.toggle=function(a,c){var e=this.cache,f=this.options,g=this.tooltip;if(c){if(/over|enter/.test(c.type)&&/out|leave/.test(e.event.type)&&f.show.target.add(c.target).length===f.show.target.length&&g.has(c.relatedTarget).length)return this;e.event=l(c)}if(this.waiting&&!a&&(this.hiddenDuringWait=y),!this.rendered)return a?this.render(1):this;if(this.destroyed||this.disabled)return this;var h,i,j,k=a?"show":"hide",m=this.options[k],n=(this.options[a?"hide":"show"],this.options.position),o=this.options.content,p=this.tooltip.css("width"),q=this.tooltip.is(":visible"),r=a||1===m.target.length,s=!c||m.target.length<2||e.target[0]===c.target;return(typeof a).search("boolean|number")&&(a=!q),h=!g.is(":animated")&&q===a&&s,i=h?A:!!this._trigger(k,[90]),this.destroyed?this:(i!==z&&a&&this.focus(c),!i||h?this:(d.attr(g[0],"aria-hidden",!a),a?(e.origin=l(this.mouse),d.isFunction(o.text)&&this._updateContent(o.text,z),d.isFunction(o.title)&&this._updateTitle(o.title,z),!x&&"mouse"===n.target&&n.adjust.mouse&&(d(b).bind("mousemove."+J,this._storeMouse),x=y),p||g.css("width",g.outerWidth(z)),this.reposition(c,arguments[2]),p||g.css("width",""),m.solo&&("string"==typeof m.solo?d(m.solo):d(N,m.solo)).not(g).not(m.target).qtip("hide",d.Event("tooltipsolo"))):(clearTimeout(this.timers.show),delete e.origin,x&&!d(N+'[tracking="true"]:visible',m.solo).not(g).length&&(d(b).unbind("mousemove."+J),x=z),this.blur(c)),j=d.proxy(function(){a?(W.ie&&g[0].style.removeAttribute("filter"),g.css("overflow",""),"string"==typeof m.autofocus&&d(this.options.show.autofocus,g).focus(),this.options.show.target.trigger("qtip-"+this.id+"-inactive")):g.css({display:"",visibility:"",opacity:"",left:"",top:""}),this._trigger(a?"visible":"hidden")},this),m.effect===z||r===z?(g[k](),j()):d.isFunction(m.effect)?(g.stop(1,1),m.effect.call(g,this),g.queue("fx",function(a){j(),a()})):g.fadeTo(90,a?1:0,j),a&&m.target.trigger("qtip-"+this.id+"-inactive"),this))},u.show=function(a){return this.toggle(y,a)},u.hide=function(a){return this.toggle(z,a)},u.focus=function(a){if(!this.rendered||this.destroyed)return this;var b=d(N),c=this.tooltip,e=parseInt(c[0].style.zIndex,10),f=t.zindex+b.length;return c.hasClass(R)||this._trigger("focus",[f],a)&&(e!==f&&(b.each(function(){this.style.zIndex>e&&(this.style.zIndex=this.style.zIndex-1)}),b.filter("."+R).qtip("blur",a)),c.addClass(R)[0].style.zIndex=f),this},u.blur=function(a){return!this.rendered||this.destroyed?this:(this.tooltip.removeClass(R),this._trigger("blur",[this.tooltip.css("zIndex")],a),this)},u.disable=function(a){return this.destroyed?this:("toggle"===a?a=!(this.rendered?this.tooltip.hasClass(T):this.disabled):"boolean"!=typeof a&&(a=y),this.rendered&&this.tooltip.toggleClass(T,a).attr("aria-disabled",a),this.disabled=!!a,this)},u.enable=function(){return this.disable(z)},u._createButton=function(){var a=this,b=this.elements,c=b.tooltip,e=this.options.content.button,f="string"==typeof e,g=f?e:"Close tooltip";b.button&&b.button.remove(),b.button=e.jquery?e:d("<a />",{"class":"qtip-close "+(this.options.style.widget?"":J+"-icon"),title:g,"aria-label":g}).prepend(d("<span />",{"class":"ui-icon ui-icon-close",html:"&times;"})),b.button.appendTo(b.titlebar||c).attr("role","button").click(function(b){return c.hasClass(T)||a.hide(b),z})},u._updateButton=function(a){if(!this.rendered)return z;var b=this.elements.button;a?this._createButton():b.remove()},u._setWidget=function(){var a=this.options.style.widget,b=this.elements,c=b.tooltip,d=c.hasClass(T);c.removeClass(T),T=a?"ui-state-disabled":"qtip-disabled",c.toggleClass(T,d),c.toggleClass("ui-helper-reset "+k(),a).toggleClass(Q,this.options.style.def&&!a),b.content&&b.content.toggleClass(k("content"),a),b.titlebar&&b.titlebar.toggleClass(k("header"),a),b.button&&b.button.toggleClass(J+"-icon",!a)},u._storeMouse=function(a){(this.mouse=l(a)).type="mousemove"},u._bind=function(a,b,c,e,f){var g="."+this._id+(e?"-"+e:"");b.length&&d(a).bind((b.split?b:b.join(g+" "))+g,d.proxy(c,f||this))},u._unbind=function(a,b){d(a).unbind("."+this._id+(b?"-"+b:""))};var $="."+J;d(function(){r(N,["mouseenter","mouseleave"],function(a){var b="mouseenter"===a.type,c=d(a.currentTarget),e=d(a.relatedTarget||a.target),f=this.options;b?(this.focus(a),c.hasClass(P)&&!c.hasClass(T)&&clearTimeout(this.timers.hide)):"mouse"===f.position.target&&f.hide.event&&f.show.target&&!e.closest(f.show.target[0]).length&&this.hide(a),c.toggleClass(S,b)}),r("["+L+"]",O,p)}),u._trigger=function(a,b,c){var e=d.Event("tooltip"+a);return e.originalEvent=c&&d.extend({},c)||this.cache.event||A,this.triggering=a,this.tooltip.trigger(e,[this].concat(b||[])),this.triggering=z,!e.isDefaultPrevented()},u._bindEvents=function(a,b,c,e,f,g){if(e.add(c).length===e.length){var h=[];b=d.map(b,function(b){var c=d.inArray(b,a);return c>-1?(h.push(a.splice(c,1)[0]),void 0):b}),h.length&&this._bind(c,h,function(a){var b=this.rendered?this.tooltip[0].offsetWidth>0:!1;(b?g:f).call(this,a)})}this._bind(c,a,f),this._bind(e,b,g)},u._assignInitialEvents=function(a){function b(a){return this.disabled||this.destroyed?z:(this.cache.event=l(a),this.cache.target=a?d(a.target):[c],clearTimeout(this.timers.show),this.timers.show=m.call(this,function(){this.render("object"==typeof a||e.show.ready)},e.show.delay),void 0)}var e=this.options,f=e.show.target,g=e.hide.target,h=e.show.event?d.trim(""+e.show.event).split(" "):[],i=e.hide.event?d.trim(""+e.hide.event).split(" "):[];/mouse(over|enter)/i.test(e.show.event)&&!/mouse(out|leave)/i.test(e.hide.event)&&i.push("mouseleave"),this._bind(f,"mousemove",function(a){this._storeMouse(a),this.cache.onTarget=y}),this._bindEvents(h,i,f,g,b,function(){clearTimeout(this.timers.show)}),(e.show.ready||e.prerender)&&b.call(this,a)},u._assignEvents=function(){var c=this,e=this.options,f=e.position,g=this.tooltip,h=e.show.target,i=e.hide.target,j=f.container,k=f.viewport,l=d(b),m=(d(b.body),d(a)),r=e.show.event?d.trim(""+e.show.event).split(" "):[],s=e.hide.event?d.trim(""+e.hide.event).split(" "):[];d.each(e.events,function(a,b){c._bind(g,"toggle"===a?["tooltipshow","tooltiphide"]:["tooltip"+a],b,null,g)}),/mouse(out|leave)/i.test(e.hide.event)&&"window"===e.hide.leave&&this._bind(l,["mouseout","blur"],function(a){/select|option/.test(a.target.nodeName)||a.relatedTarget||this.hide(a)}),e.hide.fixed?i=i.add(g.addClass(P)):/mouse(over|enter)/i.test(e.show.event)&&this._bind(i,"mouseleave",function(){clearTimeout(this.timers.show)}),(""+e.hide.event).indexOf("unfocus")>-1&&this._bind(j.closest("html"),["mousedown","touchstart"],function(a){var b=d(a.target),c=this.rendered&&!this.tooltip.hasClass(T)&&this.tooltip[0].offsetWidth>0,e=b.parents(N).filter(this.tooltip[0]).length>0;b[0]===this.target[0]||b[0]===this.tooltip[0]||e||this.target.has(b[0]).length||!c||this.hide(a)}),"number"==typeof e.hide.inactive&&(this._bind(h,"qtip-"+this.id+"-inactive",p),this._bind(i.add(g),t.inactiveEvents,p,"-inactive")),this._bindEvents(r,s,h,i,n,o),this._bind(h.add(g),"mousemove",function(a){if("number"==typeof e.hide.distance){var b=this.cache.origin||{},c=this.options.hide.distance,d=Math.abs;(d(a.pageX-b.pageX)>=c||d(a.pageY-b.pageY)>=c)&&this.hide(a)}this._storeMouse(a)}),"mouse"===f.target&&f.adjust.mouse&&(e.hide.event&&this._bind(h,["mouseenter","mouseleave"],function(a){this.cache.onTarget="mouseenter"===a.type}),this._bind(l,"mousemove",function(a){this.rendered&&this.cache.onTarget&&!this.tooltip.hasClass(T)&&this.tooltip[0].offsetWidth>0&&this.reposition(a)})),(f.adjust.resize||k.length)&&this._bind(d.event.special.resize?k:m,"resize",q),f.adjust.scroll&&this._bind(m.add(f.container),"scroll",q)},u._unassignEvents=function(){var c=[this.options.show.target[0],this.options.hide.target[0],this.rendered&&this.tooltip[0],this.options.position.container[0],this.options.position.viewport[0],this.options.position.container.closest("html")[0],a,b];this._unbind(d([]).pushStack(d.grep(c,function(a){return"object"==typeof a})))},t=d.fn.qtip=function(a,b,e){var f=(""+a).toLowerCase(),g=A,i=d.makeArray(arguments).slice(1),j=i[i.length-1],k=this[0]?d.data(this[0],J):A;return!arguments.length&&k||"api"===f?k:"string"==typeof a?(this.each(function(){var a=d.data(this,J);if(!a)return y;if(j&&j.timeStamp&&(a.cache.event=j),!b||"option"!==f&&"options"!==f)a[f]&&a[f].apply(a,i);else{if(e===c&&!d.isPlainObject(b))return g=a.get(b),z;a.set(b,e)}}),g!==A?g:this):"object"!=typeof a&&arguments.length?void 0:(k=h(d.extend(y,{},a)),this.each(function(a){var b,c;return c=d.isArray(k.id)?k.id[a]:k.id,c=!c||c===z||c.length<1||t.api[c]?t.nextid++:c,b=s(d(this),c,k),b===z?y:(t.api[c]=b,d.each(I,function(){"initialize"===this.initialize&&this(b)}),b._assignInitialEvents(j),void 0)}))},d.qtip=e,t.api={},d.each({attr:function(a,b){if(this.length){var c=this[0],e="title",f=d.data(c,"qtip");if(a===e&&f&&"object"==typeof f&&f.options.suppress)return arguments.length<2?d.attr(c,V):(f&&f.options.content.attr===e&&f.cache.attr&&f.set("content.text",b),this.attr(V,b))}return d.fn["attr"+U].apply(this,arguments)},clone:function(a){var b=(d([]),d.fn["clone"+U].apply(this,arguments));return a||b.filter("["+V+"]").attr("title",function(){return d.attr(this,V)}).removeAttr(V),b}},function(a,b){if(!b||d.fn[a+U])return y;var c=d.fn[a+U]=d.fn[a];d.fn[a]=function(){return b.apply(this,arguments)||c.apply(this,arguments)}}),d.ui||(d["cleanData"+U]=d.cleanData,d.cleanData=function(a){for(var b,c=0;(b=d(a[c])).length;c++)if(b.attr(K))try{b.triggerHandler("removeqtip")}catch(e){}d["cleanData"+U].apply(this,arguments)}),t.version="2.2.0",t.nextid=0,t.inactiveEvents=O,t.zindex=15e3,t.defaults={prerender:z,id:z,overwrite:y,suppress:y,content:{text:y,attr:"title",title:z,button:z},position:{my:"top left",at:"bottom right",target:z,container:z,viewport:z,adjust:{x:0,y:0,mouse:y,scroll:y,resize:y,method:"flipinvert flipinvert"},effect:function(a,b){d(this).animate(b,{duration:200,queue:z})}},show:{target:z,event:"mouseenter",effect:y,delay:90,solo:z,ready:z,autofocus:z},hide:{target:z,event:"mouseleave",effect:y,delay:0,fixed:z,inactive:z,leave:"window",distance:z},style:{classes:"",widget:z,width:z,height:z,def:y},events:{render:A,move:A,show:A,hide:A,toggle:A,visible:A,hidden:A,focus:A,blur:A}}})}(window,document);
//# sourceMappingURL=http://cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.0//var/www/qtip2/build/tmp/tmp-119546t2z600/jquery.qtip.min.map
/**
* hoverIntent r5 // 2007.03.27 // jQuery 1.1.2+
* <http://cherne.net/brian/resources/jquery.hoverIntent.html>
* 
* @param  f  onMouseOver function || An object with configuration options
* @param  g  onMouseOut function  || Nothing (use configuration options object)
* @author    Brian Cherne <brian@cherne.net>
*/
(function($){$.fn.hoverIntent=function(f,g){var cfg={sensitivity:7,interval:100,timeout:0};cfg=$.extend(cfg,g?{over:f,out:g}:f);var cX,cY,pX,pY;var track=function(ev){cX=ev.pageX;cY=ev.pageY;};var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if((Math.abs(pX-cX)+Math.abs(pY-cY))<cfg.sensitivity){$(ob).unbind("mousemove",track);ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev]);}else{pX=cX;pY=cY;ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);},cfg.interval);}};var delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev]);};var handleHover=function(e){var p=(e.type=="mouseover"?e.fromElement:e.toElement)||e.relatedTarget;while(p&&p!=this){try{p=p.parentNode;}catch(e){p=this;}}if(p==this){return false;}var ev=jQuery.extend({},e);var ob=this;if(ob.hoverIntent_t){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);}if(e.type=="mouseover"){pX=ev.pageX;pY=ev.pageY;$(ob).bind("mousemove",track);if(ob.hoverIntent_s!=1){ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);},cfg.interval);}}else{$(ob).unbind("mousemove",track);if(ob.hoverIntent_s==1){ob.hoverIntent_t=setTimeout(function(){delay(ev,ob);},cfg.timeout);}}};return this.mouseover(handleHover).mouseout(handleHover);};})(jQuery);
/* Copyright (c) 2006 Brandon Aaron (http://brandonaaron.net)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) 
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * $LastChangedDate: 2007-07-21 18:45:56 -0500 (Sat, 21 Jul 2007) $
 * $Rev: 2447 $
 *
 * Version 2.1.1
 */
(function($){$.fn.bgIframe=$.fn.bgiframe=function(s){if($.browser.msie&&/6.0/.test(navigator.userAgent)){s=$.extend({top:'auto',left:'auto',width:'auto',height:'auto',opacity:true,src:'javascript:false;'},s||{});var prop=function(n){return n&&n.constructor==Number?n+'px':n;},html='<iframe class="bgiframe"frameborder="0"tabindex="-1"src="'+s.src+'"'+'style="display:block;position:absolute;z-index:-1;'+(s.opacity!==false?'filter:Alpha(Opacity=\'0\');':'')+'top:'+(s.top=='auto'?'expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+\'px\')':prop(s.top))+';'+'left:'+(s.left=='auto'?'expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+\'px\')':prop(s.left))+';'+'width:'+(s.width=='auto'?'expression(this.parentNode.offsetWidth+\'px\')':prop(s.width))+';'+'height:'+(s.height=='auto'?'expression(this.parentNode.offsetHeight+\'px\')':prop(s.height))+';'+'"/>';return this.each(function(){if($('> iframe.bgiframe',this).length==0)this.insertBefore(document.createElement(html),this.firstChild);});}return this;};})(jQuery);
// File:src/Three.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

var THREE = { REVISION: '69' };

// browserify support

if ( typeof module === 'object' ) {

	module.exports = THREE;

}

// polyfills

if ( Math.sign === undefined ) {

	Math.sign = function ( x ) {

		return ( x < 0 ) ? - 1 : ( x > 0 ) ? 1 : 0;

	};

}

// https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent.button

THREE.MOUSE = { LEFT: 0, MIDDLE: 1, RIGHT: 2 };

// GL STATE CONSTANTS

THREE.CullFaceNone = 0;
THREE.CullFaceBack = 1;
THREE.CullFaceFront = 2;
THREE.CullFaceFrontBack = 3;

THREE.FrontFaceDirectionCW = 0;
THREE.FrontFaceDirectionCCW = 1;

// SHADOWING TYPES

THREE.BasicShadowMap = 0;
THREE.PCFShadowMap = 1;
THREE.PCFSoftShadowMap = 2;

// MATERIAL CONSTANTS

// side

THREE.FrontSide = 0;
THREE.BackSide = 1;
THREE.DoubleSide = 2;

// shading

THREE.NoShading = 0;
THREE.FlatShading = 1;
THREE.SmoothShading = 2;

// colors

THREE.NoColors = 0;
THREE.FaceColors = 1;
THREE.VertexColors = 2;

// blending modes

THREE.NoBlending = 0;
THREE.NormalBlending = 1;
THREE.AdditiveBlending = 2;
THREE.SubtractiveBlending = 3;
THREE.MultiplyBlending = 4;
THREE.CustomBlending = 5;

// custom blending equations
// (numbers start from 100 not to clash with other
//  mappings to OpenGL constants defined in Texture.js)

THREE.AddEquation = 100;
THREE.SubtractEquation = 101;
THREE.ReverseSubtractEquation = 102;
THREE.MinEquation = 103;
THREE.MaxEquation = 104;

// custom blending destination factors

THREE.ZeroFactor = 200;
THREE.OneFactor = 201;
THREE.SrcColorFactor = 202;
THREE.OneMinusSrcColorFactor = 203;
THREE.SrcAlphaFactor = 204;
THREE.OneMinusSrcAlphaFactor = 205;
THREE.DstAlphaFactor = 206;
THREE.OneMinusDstAlphaFactor = 207;

// custom blending source factors

//THREE.ZeroFactor = 200;
//THREE.OneFactor = 201;
//THREE.SrcAlphaFactor = 204;
//THREE.OneMinusSrcAlphaFactor = 205;
//THREE.DstAlphaFactor = 206;
//THREE.OneMinusDstAlphaFactor = 207;
THREE.DstColorFactor = 208;
THREE.OneMinusDstColorFactor = 209;
THREE.SrcAlphaSaturateFactor = 210;


// TEXTURE CONSTANTS

THREE.MultiplyOperation = 0;
THREE.MixOperation = 1;
THREE.AddOperation = 2;

// Mapping modes

THREE.UVMapping = function () {};

THREE.CubeReflectionMapping = function () {};
THREE.CubeRefractionMapping = function () {};

THREE.SphericalReflectionMapping = function () {};
THREE.SphericalRefractionMapping = function () {};

// Wrapping modes

THREE.RepeatWrapping = 1000;
THREE.ClampToEdgeWrapping = 1001;
THREE.MirroredRepeatWrapping = 1002;

// Filters

THREE.NearestFilter = 1003;
THREE.NearestMipMapNearestFilter = 1004;
THREE.NearestMipMapLinearFilter = 1005;
THREE.LinearFilter = 1006;
THREE.LinearMipMapNearestFilter = 1007;
THREE.LinearMipMapLinearFilter = 1008;

// Data types

THREE.UnsignedByteType = 1009;
THREE.ByteType = 1010;
THREE.ShortType = 1011;
THREE.UnsignedShortType = 1012;
THREE.IntType = 1013;
THREE.UnsignedIntType = 1014;
THREE.FloatType = 1015;

// Pixel types

//THREE.UnsignedByteType = 1009;
THREE.UnsignedShort4444Type = 1016;
THREE.UnsignedShort5551Type = 1017;
THREE.UnsignedShort565Type = 1018;

// Pixel formats

THREE.AlphaFormat = 1019;
THREE.RGBFormat = 1020;
THREE.RGBAFormat = 1021;
THREE.LuminanceFormat = 1022;
THREE.LuminanceAlphaFormat = 1023;

// DDS / ST3C Compressed texture formats

THREE.RGB_S3TC_DXT1_Format = 2001;
THREE.RGBA_S3TC_DXT1_Format = 2002;
THREE.RGBA_S3TC_DXT3_Format = 2003;
THREE.RGBA_S3TC_DXT5_Format = 2004;


// PVRTC compressed texture formats

THREE.RGB_PVRTC_4BPPV1_Format = 2100;
THREE.RGB_PVRTC_2BPPV1_Format = 2101;
THREE.RGBA_PVRTC_4BPPV1_Format = 2102;
THREE.RGBA_PVRTC_2BPPV1_Format = 2103;


// File:src/math/Color.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.Color = function ( color ) {

	if ( arguments.length === 3 ) {

		return this.setRGB( arguments[ 0 ], arguments[ 1 ], arguments[ 2 ] );

	}

	return this.set( color )

};

THREE.Color.prototype = {

	constructor: THREE.Color,

	r: 1, g: 1, b: 1,

	set: function ( value ) {

		if ( value instanceof THREE.Color ) {

			this.copy( value );

		} else if ( typeof value === 'number' ) {

			this.setHex( value );

		} else if ( typeof value === 'string' ) {

			this.setStyle( value );

		}

		return this;

	},

	setHex: function ( hex ) {

		hex = Math.floor( hex );

		this.r = ( hex >> 16 & 255 ) / 255;
		this.g = ( hex >> 8 & 255 ) / 255;
		this.b = ( hex & 255 ) / 255;

		return this;

	},

	setRGB: function ( r, g, b ) {

		this.r = r;
		this.g = g;
		this.b = b;

		return this;

	},

	setHSL: function ( h, s, l ) {

		// h,s,l ranges are in 0.0 - 1.0

		if ( s === 0 ) {

			this.r = this.g = this.b = l;

		} else {

			var hue2rgb = function ( p, q, t ) {

				if ( t < 0 ) t += 1;
				if ( t > 1 ) t -= 1;
				if ( t < 1 / 6 ) return p + ( q - p ) * 6 * t;
				if ( t < 1 / 2 ) return q;
				if ( t < 2 / 3 ) return p + ( q - p ) * 6 * ( 2 / 3 - t );
				return p;

			};

			var p = l <= 0.5 ? l * ( 1 + s ) : l + s - ( l * s );
			var q = ( 2 * l ) - p;

			this.r = hue2rgb( q, p, h + 1 / 3 );
			this.g = hue2rgb( q, p, h );
			this.b = hue2rgb( q, p, h - 1 / 3 );

		}

		return this;

	},

	setStyle: function ( style ) {

		// rgb(255,0,0)

		if ( /^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test( style ) ) {

			var color = /^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec( style );

			this.r = Math.min( 255, parseInt( color[ 1 ], 10 ) ) / 255;
			this.g = Math.min( 255, parseInt( color[ 2 ], 10 ) ) / 255;
			this.b = Math.min( 255, parseInt( color[ 3 ], 10 ) ) / 255;

			return this;

		}

		// rgb(100%,0%,0%)

		if ( /^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test( style ) ) {

			var color = /^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec( style );

			this.r = Math.min( 100, parseInt( color[ 1 ], 10 ) ) / 100;
			this.g = Math.min( 100, parseInt( color[ 2 ], 10 ) ) / 100;
			this.b = Math.min( 100, parseInt( color[ 3 ], 10 ) ) / 100;

			return this;

		}

		// #ff0000

		if ( /^\#([0-9a-f]{6})$/i.test( style ) ) {

			var color = /^\#([0-9a-f]{6})$/i.exec( style );

			this.setHex( parseInt( color[ 1 ], 16 ) );

			return this;

		}

		// #f00

		if ( /^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test( style ) ) {

			var color = /^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec( style );

			this.setHex( parseInt( color[ 1 ] + color[ 1 ] + color[ 2 ] + color[ 2 ] + color[ 3 ] + color[ 3 ], 16 ) );

			return this;

		}

		// red

		if ( /^(\w+)$/i.test( style ) ) {

			this.setHex( THREE.ColorKeywords[ style ] );

			return this;

		}


	},

	copy: function ( color ) {

		this.r = color.r;
		this.g = color.g;
		this.b = color.b;

		return this;

	},

	copyGammaToLinear: function ( color ) {

		this.r = color.r * color.r;
		this.g = color.g * color.g;
		this.b = color.b * color.b;

		return this;

	},

	copyLinearToGamma: function ( color ) {

		this.r = Math.sqrt( color.r );
		this.g = Math.sqrt( color.g );
		this.b = Math.sqrt( color.b );

		return this;

	},

	convertGammaToLinear: function () {

		var r = this.r, g = this.g, b = this.b;

		this.r = r * r;
		this.g = g * g;
		this.b = b * b;

		return this;

	},

	convertLinearToGamma: function () {

		this.r = Math.sqrt( this.r );
		this.g = Math.sqrt( this.g );
		this.b = Math.sqrt( this.b );

		return this;

	},

	getHex: function () {

		return ( this.r * 255 ) << 16 ^ ( this.g * 255 ) << 8 ^ ( this.b * 255 ) << 0;

	},

	getHexString: function () {

		return ( '000000' + this.getHex().toString( 16 ) ).slice( - 6 );

	},

	getHSL: function ( optionalTarget ) {

		// h,s,l ranges are in 0.0 - 1.0

		var hsl = optionalTarget || { h: 0, s: 0, l: 0 };

		var r = this.r, g = this.g, b = this.b;

		var max = Math.max( r, g, b );
		var min = Math.min( r, g, b );

		var hue, saturation;
		var lightness = ( min + max ) / 2.0;

		if ( min === max ) {

			hue = 0;
			saturation = 0;

		} else {

			var delta = max - min;

			saturation = lightness <= 0.5 ? delta / ( max + min ) : delta / ( 2 - max - min );

			switch ( max ) {

				case r: hue = ( g - b ) / delta + ( g < b ? 6 : 0 ); break;
				case g: hue = ( b - r ) / delta + 2; break;
				case b: hue = ( r - g ) / delta + 4; break;

			}

			hue /= 6;

		}

		hsl.h = hue;
		hsl.s = saturation;
		hsl.l = lightness;

		return hsl;

	},

	getStyle: function () {

		return 'rgb(' + ( ( this.r * 255 ) | 0 ) + ',' + ( ( this.g * 255 ) | 0 ) + ',' + ( ( this.b * 255 ) | 0 ) + ')';

	},

	offsetHSL: function ( h, s, l ) {

		var hsl = this.getHSL();

		hsl.h += h; hsl.s += s; hsl.l += l;

		this.setHSL( hsl.h, hsl.s, hsl.l );

		return this;

	},

	add: function ( color ) {

		this.r += color.r;
		this.g += color.g;
		this.b += color.b;

		return this;

	},

	addColors: function ( color1, color2 ) {

		this.r = color1.r + color2.r;
		this.g = color1.g + color2.g;
		this.b = color1.b + color2.b;

		return this;

	},

	addScalar: function ( s ) {

		this.r += s;
		this.g += s;
		this.b += s;

		return this;

	},

	multiply: function ( color ) {

		this.r *= color.r;
		this.g *= color.g;
		this.b *= color.b;

		return this;

	},

	multiplyScalar: function ( s ) {

		this.r *= s;
		this.g *= s;
		this.b *= s;

		return this;

	},

	lerp: function ( color, alpha ) {

		this.r += ( color.r - this.r ) * alpha;
		this.g += ( color.g - this.g ) * alpha;
		this.b += ( color.b - this.b ) * alpha;

		return this;

	},

	equals: function ( c ) {

		return ( c.r === this.r ) && ( c.g === this.g ) && ( c.b === this.b );

	},

	fromArray: function ( array ) {

		this.r = array[ 0 ];
		this.g = array[ 1 ];
		this.b = array[ 2 ];

		return this;

	},

	toArray: function () {

		return [ this.r, this.g, this.b ];

	},

	clone: function () {

		return new THREE.Color().setRGB( this.r, this.g, this.b );

	}

};

THREE.ColorKeywords = { 'aliceblue': 0xF0F8FF, 'antiquewhite': 0xFAEBD7, 'aqua': 0x00FFFF, 'aquamarine': 0x7FFFD4, 'azure': 0xF0FFFF,
'beige': 0xF5F5DC, 'bisque': 0xFFE4C4, 'black': 0x000000, 'blanchedalmond': 0xFFEBCD, 'blue': 0x0000FF, 'blueviolet': 0x8A2BE2,
'brown': 0xA52A2A, 'burlywood': 0xDEB887, 'cadetblue': 0x5F9EA0, 'chartreuse': 0x7FFF00, 'chocolate': 0xD2691E, 'coral': 0xFF7F50,
'cornflowerblue': 0x6495ED, 'cornsilk': 0xFFF8DC, 'crimson': 0xDC143C, 'cyan': 0x00FFFF, 'darkblue': 0x00008B, 'darkcyan': 0x008B8B,
'darkgoldenrod': 0xB8860B, 'darkgray': 0xA9A9A9, 'darkgreen': 0x006400, 'darkgrey': 0xA9A9A9, 'darkkhaki': 0xBDB76B, 'darkmagenta': 0x8B008B,
'darkolivegreen': 0x556B2F, 'darkorange': 0xFF8C00, 'darkorchid': 0x9932CC, 'darkred': 0x8B0000, 'darksalmon': 0xE9967A, 'darkseagreen': 0x8FBC8F,
'darkslateblue': 0x483D8B, 'darkslategray': 0x2F4F4F, 'darkslategrey': 0x2F4F4F, 'darkturquoise': 0x00CED1, 'darkviolet': 0x9400D3,
'deeppink': 0xFF1493, 'deepskyblue': 0x00BFFF, 'dimgray': 0x696969, 'dimgrey': 0x696969, 'dodgerblue': 0x1E90FF, 'firebrick': 0xB22222,
'floralwhite': 0xFFFAF0, 'forestgreen': 0x228B22, 'fuchsia': 0xFF00FF, 'gainsboro': 0xDCDCDC, 'ghostwhite': 0xF8F8FF, 'gold': 0xFFD700,
'goldenrod': 0xDAA520, 'gray': 0x808080, 'green': 0x008000, 'greenyellow': 0xADFF2F, 'grey': 0x808080, 'honeydew': 0xF0FFF0, 'hotpink': 0xFF69B4,
'indianred': 0xCD5C5C, 'indigo': 0x4B0082, 'ivory': 0xFFFFF0, 'khaki': 0xF0E68C, 'lavender': 0xE6E6FA, 'lavenderblush': 0xFFF0F5, 'lawngreen': 0x7CFC00,
'lemonchiffon': 0xFFFACD, 'lightblue': 0xADD8E6, 'lightcoral': 0xF08080, 'lightcyan': 0xE0FFFF, 'lightgoldenrodyellow': 0xFAFAD2, 'lightgray': 0xD3D3D3,
'lightgreen': 0x90EE90, 'lightgrey': 0xD3D3D3, 'lightpink': 0xFFB6C1, 'lightsalmon': 0xFFA07A, 'lightseagreen': 0x20B2AA, 'lightskyblue': 0x87CEFA,
'lightslategray': 0x778899, 'lightslategrey': 0x778899, 'lightsteelblue': 0xB0C4DE, 'lightyellow': 0xFFFFE0, 'lime': 0x00FF00, 'limegreen': 0x32CD32,
'linen': 0xFAF0E6, 'magenta': 0xFF00FF, 'maroon': 0x800000, 'mediumaquamarine': 0x66CDAA, 'mediumblue': 0x0000CD, 'mediumorchid': 0xBA55D3,
'mediumpurple': 0x9370DB, 'mediumseagreen': 0x3CB371, 'mediumslateblue': 0x7B68EE, 'mediumspringgreen': 0x00FA9A, 'mediumturquoise': 0x48D1CC,
'mediumvioletred': 0xC71585, 'midnightblue': 0x191970, 'mintcream': 0xF5FFFA, 'mistyrose': 0xFFE4E1, 'moccasin': 0xFFE4B5, 'navajowhite': 0xFFDEAD,
'navy': 0x000080, 'oldlace': 0xFDF5E6, 'olive': 0x808000, 'olivedrab': 0x6B8E23, 'orange': 0xFFA500, 'orangered': 0xFF4500, 'orchid': 0xDA70D6,
'palegoldenrod': 0xEEE8AA, 'palegreen': 0x98FB98, 'paleturquoise': 0xAFEEEE, 'palevioletred': 0xDB7093, 'papayawhip': 0xFFEFD5, 'peachpuff': 0xFFDAB9,
'peru': 0xCD853F, 'pink': 0xFFC0CB, 'plum': 0xDDA0DD, 'powderblue': 0xB0E0E6, 'purple': 0x800080, 'red': 0xFF0000, 'rosybrown': 0xBC8F8F,
'royalblue': 0x4169E1, 'saddlebrown': 0x8B4513, 'salmon': 0xFA8072, 'sandybrown': 0xF4A460, 'seagreen': 0x2E8B57, 'seashell': 0xFFF5EE,
'sienna': 0xA0522D, 'silver': 0xC0C0C0, 'skyblue': 0x87CEEB, 'slateblue': 0x6A5ACD, 'slategray': 0x708090, 'slategrey': 0x708090, 'snow': 0xFFFAFA,
'springgreen': 0x00FF7F, 'steelblue': 0x4682B4, 'tan': 0xD2B48C, 'teal': 0x008080, 'thistle': 0xD8BFD8, 'tomato': 0xFF6347, 'turquoise': 0x40E0D0,
'violet': 0xEE82EE, 'wheat': 0xF5DEB3, 'white': 0xFFFFFF, 'whitesmoke': 0xF5F5F5, 'yellow': 0xFFFF00, 'yellowgreen': 0x9ACD32 };

// File:src/math/Quaternion.js

/**
 * @author mikael emtinger / http://gomo.se/
 * @author alteredq / http://alteredqualia.com/
 * @author WestLangley / http://github.com/WestLangley
 * @author bhouston / http://exocortex.com
 */

THREE.Quaternion = function ( x, y, z, w ) {

	this._x = x || 0;
	this._y = y || 0;
	this._z = z || 0;
	this._w = ( w !== undefined ) ? w : 1;

};

THREE.Quaternion.prototype = {

	constructor: THREE.Quaternion,

	_x: 0,_y: 0, _z: 0, _w: 0,

	get x () {

		return this._x;

	},

	set x ( value ) {

		this._x = value;
		this.onChangeCallback();

	},

	get y () {

		return this._y;

	},

	set y ( value ) {

		this._y = value;
		this.onChangeCallback();

	},

	get z () {

		return this._z;

	},

	set z ( value ) {

		this._z = value;
		this.onChangeCallback();

	},

	get w () {

		return this._w;

	},

	set w ( value ) {

		this._w = value;
		this.onChangeCallback();

	},

	set: function ( x, y, z, w ) {

		this._x = x;
		this._y = y;
		this._z = z;
		this._w = w;

		this.onChangeCallback();

		return this;

	},

	copy: function ( quaternion ) {

		this._x = quaternion.x;
		this._y = quaternion.y;
		this._z = quaternion.z;
		this._w = quaternion.w;

		this.onChangeCallback();

		return this;

	},

	setFromEuler: function ( euler, update ) {

		if ( euler instanceof THREE.Euler === false ) {

			throw new Error( 'THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.' );
		}

		// http://www.mathworks.com/matlabcentral/fileexchange/
		// 	20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/
		//	content/SpinCalc.m

		var c1 = Math.cos( euler._x / 2 );
		var c2 = Math.cos( euler._y / 2 );
		var c3 = Math.cos( euler._z / 2 );
		var s1 = Math.sin( euler._x / 2 );
		var s2 = Math.sin( euler._y / 2 );
		var s3 = Math.sin( euler._z / 2 );

		if ( euler.order === 'XYZ' ) {

			this._x = s1 * c2 * c3 + c1 * s2 * s3;
			this._y = c1 * s2 * c3 - s1 * c2 * s3;
			this._z = c1 * c2 * s3 + s1 * s2 * c3;
			this._w = c1 * c2 * c3 - s1 * s2 * s3;

		} else if ( euler.order === 'YXZ' ) {

			this._x = s1 * c2 * c3 + c1 * s2 * s3;
			this._y = c1 * s2 * c3 - s1 * c2 * s3;
			this._z = c1 * c2 * s3 - s1 * s2 * c3;
			this._w = c1 * c2 * c3 + s1 * s2 * s3;

		} else if ( euler.order === 'ZXY' ) {

			this._x = s1 * c2 * c3 - c1 * s2 * s3;
			this._y = c1 * s2 * c3 + s1 * c2 * s3;
			this._z = c1 * c2 * s3 + s1 * s2 * c3;
			this._w = c1 * c2 * c3 - s1 * s2 * s3;

		} else if ( euler.order === 'ZYX' ) {

			this._x = s1 * c2 * c3 - c1 * s2 * s3;
			this._y = c1 * s2 * c3 + s1 * c2 * s3;
			this._z = c1 * c2 * s3 - s1 * s2 * c3;
			this._w = c1 * c2 * c3 + s1 * s2 * s3;

		} else if ( euler.order === 'YZX' ) {

			this._x = s1 * c2 * c3 + c1 * s2 * s3;
			this._y = c1 * s2 * c3 + s1 * c2 * s3;
			this._z = c1 * c2 * s3 - s1 * s2 * c3;
			this._w = c1 * c2 * c3 - s1 * s2 * s3;

		} else if ( euler.order === 'XZY' ) {

			this._x = s1 * c2 * c3 - c1 * s2 * s3;
			this._y = c1 * s2 * c3 - s1 * c2 * s3;
			this._z = c1 * c2 * s3 + s1 * s2 * c3;
			this._w = c1 * c2 * c3 + s1 * s2 * s3;

		}

		if ( update !== false ) this.onChangeCallback();

		return this;

	},

	setFromAxisAngle: function ( axis, angle ) {

		// http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm

		// assumes axis is normalized

		var halfAngle = angle / 2, s = Math.sin( halfAngle );

		this._x = axis.x * s;
		this._y = axis.y * s;
		this._z = axis.z * s;
		this._w = Math.cos( halfAngle );

		this.onChangeCallback();

		return this;

	},

	setFromRotationMatrix: function ( m ) {

		// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm

		// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)

		var te = m.elements,

			m11 = te[ 0 ], m12 = te[ 4 ], m13 = te[ 8 ],
			m21 = te[ 1 ], m22 = te[ 5 ], m23 = te[ 9 ],
			m31 = te[ 2 ], m32 = te[ 6 ], m33 = te[ 10 ],

			trace = m11 + m22 + m33,
			s;

		if ( trace > 0 ) {

			s = 0.5 / Math.sqrt( trace + 1.0 );

			this._w = 0.25 / s;
			this._x = ( m32 - m23 ) * s;
			this._y = ( m13 - m31 ) * s;
			this._z = ( m21 - m12 ) * s;

		} else if ( m11 > m22 && m11 > m33 ) {

			s = 2.0 * Math.sqrt( 1.0 + m11 - m22 - m33 );

			this._w = ( m32 - m23 ) / s;
			this._x = 0.25 * s;
			this._y = ( m12 + m21 ) / s;
			this._z = ( m13 + m31 ) / s;

		} else if ( m22 > m33 ) {

			s = 2.0 * Math.sqrt( 1.0 + m22 - m11 - m33 );

			this._w = ( m13 - m31 ) / s;
			this._x = ( m12 + m21 ) / s;
			this._y = 0.25 * s;
			this._z = ( m23 + m32 ) / s;

		} else {

			s = 2.0 * Math.sqrt( 1.0 + m33 - m11 - m22 );

			this._w = ( m21 - m12 ) / s;
			this._x = ( m13 + m31 ) / s;
			this._y = ( m23 + m32 ) / s;
			this._z = 0.25 * s;

		}

		this.onChangeCallback();

		return this;

	},

	setFromUnitVectors: function () {

		// http://lolengine.net/blog/2014/02/24/quaternion-from-two-vectors-final

		// assumes direction vectors vFrom and vTo are normalized

		var v1, r;

		var EPS = 0.000001;

		return function ( vFrom, vTo ) {

			if ( v1 === undefined ) v1 = new THREE.Vector3();

			r = vFrom.dot( vTo ) + 1;

			if ( r < EPS ) {

				r = 0;

				if ( Math.abs( vFrom.x ) > Math.abs( vFrom.z ) ) {

					v1.set( - vFrom.y, vFrom.x, 0 );

				} else {

					v1.set( 0, - vFrom.z, vFrom.y );

				}

			} else {

				v1.crossVectors( vFrom, vTo );

			}

			this._x = v1.x;
			this._y = v1.y;
			this._z = v1.z;
			this._w = r;

			this.normalize();

			return this;

		}

	}(),

	inverse: function () {

		this.conjugate().normalize();

		return this;

	},

	conjugate: function () {

		this._x *= - 1;
		this._y *= - 1;
		this._z *= - 1;

		this.onChangeCallback();

		return this;

	},

	dot: function ( v ) {

		return this._x * v._x + this._y * v._y + this._z * v._z + this._w * v._w;

	},

	lengthSq: function () {

		return this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w;

	},

	length: function () {

		return Math.sqrt( this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w );

	},

	normalize: function () {

		var l = this.length();

		if ( l === 0 ) {

			this._x = 0;
			this._y = 0;
			this._z = 0;
			this._w = 1;

		} else {

			l = 1 / l;

			this._x = this._x * l;
			this._y = this._y * l;
			this._z = this._z * l;
			this._w = this._w * l;

		}

		this.onChangeCallback();

		return this;

	},

	multiply: function ( q, p ) {

		if ( p !== undefined ) {

			console.warn( 'THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.' );
			return this.multiplyQuaternions( q, p );

		}

		return this.multiplyQuaternions( this, q );

	},

	multiplyQuaternions: function ( a, b ) {

		// from http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/code/index.htm

		var qax = a._x, qay = a._y, qaz = a._z, qaw = a._w;
		var qbx = b._x, qby = b._y, qbz = b._z, qbw = b._w;

		this._x = qax * qbw + qaw * qbx + qay * qbz - qaz * qby;
		this._y = qay * qbw + qaw * qby + qaz * qbx - qax * qbz;
		this._z = qaz * qbw + qaw * qbz + qax * qby - qay * qbx;
		this._w = qaw * qbw - qax * qbx - qay * qby - qaz * qbz;

		this.onChangeCallback();

		return this;

	},

	multiplyVector3: function ( vector ) {

		console.warn( 'THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.' );
		return vector.applyQuaternion( this );

	},

	slerp: function ( qb, t ) {

		if ( t === 0 ) return this;
		if ( t === 1 ) return this.copy( qb );

		var x = this._x, y = this._y, z = this._z, w = this._w;

		// http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/

		var cosHalfTheta = w * qb._w + x * qb._x + y * qb._y + z * qb._z;

		if ( cosHalfTheta < 0 ) {

			this._w = - qb._w;
			this._x = - qb._x;
			this._y = - qb._y;
			this._z = - qb._z;

			cosHalfTheta = - cosHalfTheta;

		} else {

			this.copy( qb );

		}

		if ( cosHalfTheta >= 1.0 ) {

			this._w = w;
			this._x = x;
			this._y = y;
			this._z = z;

			return this;

		}

		var halfTheta = Math.acos( cosHalfTheta );
		var sinHalfTheta = Math.sqrt( 1.0 - cosHalfTheta * cosHalfTheta );

		if ( Math.abs( sinHalfTheta ) < 0.001 ) {

			this._w = 0.5 * ( w + this._w );
			this._x = 0.5 * ( x + this._x );
			this._y = 0.5 * ( y + this._y );
			this._z = 0.5 * ( z + this._z );

			return this;

		}

		var ratioA = Math.sin( ( 1 - t ) * halfTheta ) / sinHalfTheta,
		ratioB = Math.sin( t * halfTheta ) / sinHalfTheta;

		this._w = ( w * ratioA + this._w * ratioB );
		this._x = ( x * ratioA + this._x * ratioB );
		this._y = ( y * ratioA + this._y * ratioB );
		this._z = ( z * ratioA + this._z * ratioB );

		this.onChangeCallback();

		return this;

	},

	equals: function ( quaternion ) {

		return ( quaternion._x === this._x ) && ( quaternion._y === this._y ) && ( quaternion._z === this._z ) && ( quaternion._w === this._w );

	},

	fromArray: function ( array, offset ) {

		if ( offset === undefined ) offset = 0;

		this._x = array[ offset ];
		this._y = array[ offset + 1 ];
		this._z = array[ offset + 2 ];
		this._w = array[ offset + 3 ];

		this.onChangeCallback();

		return this;

	},

	toArray: function ( array, offset ) {

		if ( array === undefined ) array = [];
		if ( offset === undefined ) offset = 0;

		array[ offset ] = this._x;
		array[ offset + 1 ] = this._y;
		array[ offset + 2 ] = this._z;
		array[ offset + 3 ] = this._w;

		return array;

	},

	onChange: function ( callback ) {

		this.onChangeCallback = callback;

		return this;

	},

	onChangeCallback: function () {},

	clone: function () {

		return new THREE.Quaternion( this._x, this._y, this._z, this._w );

	}

};

THREE.Quaternion.slerp = function ( qa, qb, qm, t ) {

	return qm.copy( qa ).slerp( qb, t );

}

// File:src/math/Vector2.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author philogb / http://blog.thejit.org/
 * @author egraether / http://egraether.com/
 * @author zz85 / http://www.lab4games.net/zz85/blog
 */

THREE.Vector2 = function ( x, y ) {

	this.x = x || 0;
	this.y = y || 0;

};

THREE.Vector2.prototype = {

	constructor: THREE.Vector2,

	set: function ( x, y ) {

		this.x = x;
		this.y = y;

		return this;

	},

	setX: function ( x ) {

		this.x = x;

		return this;

	},

	setY: function ( y ) {

		this.y = y;

		return this;

	},

	setComponent: function ( index, value ) {

		switch ( index ) {

			case 0: this.x = value; break;
			case 1: this.y = value; break;
			default: throw new Error( 'index is out of range: ' + index );

		}

	},

	getComponent: function ( index ) {

		switch ( index ) {

			case 0: return this.x;
			case 1: return this.y;
			default: throw new Error( 'index is out of range: ' + index );

		}

	},

	copy: function ( v ) {

		this.x = v.x;
		this.y = v.y;

		return this;

	},

	add: function ( v, w ) {

		if ( w !== undefined ) {

			console.warn( 'THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.' );
			return this.addVectors( v, w );

		}

		this.x += v.x;
		this.y += v.y;

		return this;

	},

	addVectors: function ( a, b ) {

		this.x = a.x + b.x;
		this.y = a.y + b.y;

		return this;

	},

	addScalar: function ( s ) {

		this.x += s;
		this.y += s;

		return this;

	},

	sub: function ( v, w ) {

		if ( w !== undefined ) {

			console.warn( 'THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.' );
			return this.subVectors( v, w );

		}

		this.x -= v.x;
		this.y -= v.y;

		return this;

	},

	subVectors: function ( a, b ) {

		this.x = a.x - b.x;
		this.y = a.y - b.y;

		return this;

	},

	multiply: function ( v ) {

		this.x *= v.x;
		this.y *= v.y;

		return this;

	},

	multiplyScalar: function ( s ) {

		this.x *= s;
		this.y *= s;

		return this;

	},

	divide: function ( v ) {

		this.x /= v.x;
		this.y /= v.y;

		return this;

	},

	divideScalar: function ( scalar ) {

		if ( scalar !== 0 ) {

			var invScalar = 1 / scalar;

			this.x *= invScalar;
			this.y *= invScalar;

		} else {

			this.x = 0;
			this.y = 0;

		}

		return this;

	},

	min: function ( v ) {

		if ( this.x > v.x ) {

			this.x = v.x;

		}

		if ( this.y > v.y ) {

			this.y = v.y;

		}

		return this;

	},

	max: function ( v ) {

		if ( this.x < v.x ) {

			this.x = v.x;

		}

		if ( this.y < v.y ) {

			this.y = v.y;

		}

		return this;

	},

	clamp: function ( min, max ) {

		// This function assumes min < max, if this assumption isn't true it will not operate correctly

		if ( this.x < min.x ) {

			this.x = min.x;

		} else if ( this.x > max.x ) {

			this.x = max.x;

		}

		if ( this.y < min.y ) {

			this.y = min.y;

		} else if ( this.y > max.y ) {

			this.y = max.y;

		}

		return this;
	},

	clampScalar: ( function () {

		var min, max;

		return function ( minVal, maxVal ) {

			if ( min === undefined ) {

				min = new THREE.Vector2();
				max = new THREE.Vector2();

			}

			min.set( minVal, minVal );
			max.set( maxVal, maxVal );

			return this.clamp( min, max );

		};

	} )(),

	floor: function () {

		this.x = Math.floor( this.x );
		this.y = Math.floor( this.y );

		return this;

	},

	ceil: function () {

		this.x = Math.ceil( this.x );
		this.y = Math.ceil( this.y );

		return this;

	},

	round: function () {

		this.x = Math.round( this.x );
		this.y = Math.round( this.y );

		return this;

	},

	roundToZero: function () {

		this.x = ( this.x < 0 ) ? Math.ceil( this.x ) : Math.floor( this.x );
		this.y = ( this.y < 0 ) ? Math.ceil( this.y ) : Math.floor( this.y );

		return this;

	},

	negate: function () {

		this.x = - this.x;
		this.y = - this.y;

		return this;

	},

	dot: function ( v ) {

		return this.x * v.x + this.y * v.y;

	},

	lengthSq: function () {

		return this.x * this.x + this.y * this.y;

	},

	length: function () {

		return Math.sqrt( this.x * this.x + this.y * this.y );

	},

	normalize: function () {

		return this.divideScalar( this.length() );

	},

	distanceTo: function ( v ) {

		return Math.sqrt( this.distanceToSquared( v ) );

	},

	distanceToSquared: function ( v ) {

		var dx = this.x - v.x, dy = this.y - v.y;
		return dx * dx + dy * dy;

	},

	setLength: function ( l ) {

		var oldLength = this.length();

		if ( oldLength !== 0 && l !== oldLength ) {

			this.multiplyScalar( l / oldLength );
		}

		return this;

	},

	lerp: function ( v, alpha ) {

		this.x += ( v.x - this.x ) * alpha;
		this.y += ( v.y - this.y ) * alpha;

		return this;

	},

	equals: function ( v ) {

		return ( ( v.x === this.x ) && ( v.y === this.y ) );

	},

	fromArray: function ( array, offset ) {

		if ( offset === undefined ) offset = 0;

		this.x = array[ offset ];
		this.y = array[ offset + 1 ];

		return this;

	},

	toArray: function ( array, offset ) {

		if ( array === undefined ) array = [];
		if ( offset === undefined ) offset = 0;

		array[ offset ] = this.x;
		array[ offset + 1 ] = this.y;

		return array;

	},

	clone: function () {

		return new THREE.Vector2( this.x, this.y );

	}

};

// File:src/math/Vector3.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author *kile / http://kile.stravaganza.org/
 * @author philogb / http://blog.thejit.org/
 * @author mikael emtinger / http://gomo.se/
 * @author egraether / http://egraether.com/
 * @author WestLangley / http://github.com/WestLangley
 */

THREE.Vector3 = function ( x, y, z ) {

	this.x = x || 0;
	this.y = y || 0;
	this.z = z || 0;

};

THREE.Vector3.prototype = {

	constructor: THREE.Vector3,

	set: function ( x, y, z ) {

		this.x = x;
		this.y = y;
		this.z = z;

		return this;

	},

	setX: function ( x ) {

		this.x = x;

		return this;

	},

	setY: function ( y ) {

		this.y = y;

		return this;

	},

	setZ: function ( z ) {

		this.z = z;

		return this;

	},

	setComponent: function ( index, value ) {

		switch ( index ) {

			case 0: this.x = value; break;
			case 1: this.y = value; break;
			case 2: this.z = value; break;
			default: throw new Error( 'index is out of range: ' + index );

		}

	},

	getComponent: function ( index ) {

		switch ( index ) {

			case 0: return this.x;
			case 1: return this.y;
			case 2: return this.z;
			default: throw new Error( 'index is out of range: ' + index );

		}

	},

	copy: function ( v ) {

		this.x = v.x;
		this.y = v.y;
		this.z = v.z;

		return this;

	},

	add: function ( v, w ) {

		if ( w !== undefined ) {

			console.warn( 'THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.' );
			return this.addVectors( v, w );

		}

		this.x += v.x;
		this.y += v.y;
		this.z += v.z;

		return this;

	},

	addScalar: function ( s ) {

		this.x += s;
		this.y += s;
		this.z += s;

		return this;

	},

	addVectors: function ( a, b ) {

		this.x = a.x + b.x;
		this.y = a.y + b.y;
		this.z = a.z + b.z;

		return this;

	},

	sub: function ( v, w ) {

		if ( w !== undefined ) {

			console.warn( 'THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.' );
			return this.subVectors( v, w );

		}

		this.x -= v.x;
		this.y -= v.y;
		this.z -= v.z;

		return this;

	},

	subVectors: function ( a, b ) {

		this.x = a.x - b.x;
		this.y = a.y - b.y;
		this.z = a.z - b.z;

		return this;

	},

	multiply: function ( v, w ) {

		if ( w !== undefined ) {

			console.warn( 'THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.' );
			return this.multiplyVectors( v, w );

		}

		this.x *= v.x;
		this.y *= v.y;
		this.z *= v.z;

		return this;

	},

	multiplyScalar: function ( scalar ) {

		this.x *= scalar;
		this.y *= scalar;
		this.z *= scalar;

		return this;

	},

	multiplyVectors: function ( a, b ) {

		this.x = a.x * b.x;
		this.y = a.y * b.y;
		this.z = a.z * b.z;

		return this;

	},

	applyEuler: function () {

		var quaternion;

		return function ( euler ) {

			if ( euler instanceof THREE.Euler === false ) {

				console.error( 'THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.' );

			}

			if ( quaternion === undefined ) quaternion = new THREE.Quaternion();

			this.applyQuaternion( quaternion.setFromEuler( euler ) );

			return this;

		};

	}(),

	applyAxisAngle: function () {

		var quaternion;

		return function ( axis, angle ) {

			if ( quaternion === undefined ) quaternion = new THREE.Quaternion();

			this.applyQuaternion( quaternion.setFromAxisAngle( axis, angle ) );

			return this;

		};

	}(),

	applyMatrix3: function ( m ) {

		var x = this.x;
		var y = this.y;
		var z = this.z;

		var e = m.elements;

		this.x = e[ 0 ] * x + e[ 3 ] * y + e[ 6 ] * z;
		this.y = e[ 1 ] * x + e[ 4 ] * y + e[ 7 ] * z;
		this.z = e[ 2 ] * x + e[ 5 ] * y + e[ 8 ] * z;

		return this;

	},

	applyMatrix4: function ( m ) {

		// input: THREE.Matrix4 affine matrix

		var x = this.x, y = this.y, z = this.z;

		var e = m.elements;

		this.x = e[ 0 ] * x + e[ 4 ] * y + e[ 8 ]  * z + e[ 12 ];
		this.y = e[ 1 ] * x + e[ 5 ] * y + e[ 9 ]  * z + e[ 13 ];
		this.z = e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z + e[ 14 ];

		return this;

	},

	applyProjection: function ( m ) {

		// input: THREE.Matrix4 projection matrix

		var x = this.x, y = this.y, z = this.z;

		var e = m.elements;
		var d = 1 / ( e[ 3 ] * x + e[ 7 ] * y + e[ 11 ] * z + e[ 15 ] ); // perspective divide

		this.x = ( e[ 0 ] * x + e[ 4 ] * y + e[ 8 ]  * z + e[ 12 ] ) * d;
		this.y = ( e[ 1 ] * x + e[ 5 ] * y + e[ 9 ]  * z + e[ 13 ] ) * d;
		this.z = ( e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z + e[ 14 ] ) * d;

		return this;

	},

	applyQuaternion: function ( q ) {

		var x = this.x;
		var y = this.y;
		var z = this.z;

		var qx = q.x;
		var qy = q.y;
		var qz = q.z;
		var qw = q.w;

		// calculate quat * vector

		var ix =  qw * x + qy * z - qz * y;
		var iy =  qw * y + qz * x - qx * z;
		var iz =  qw * z + qx * y - qy * x;
		var iw = - qx * x - qy * y - qz * z;

		// calculate result * inverse quat

		this.x = ix * qw + iw * - qx + iy * - qz - iz * - qy;
		this.y = iy * qw + iw * - qy + iz * - qx - ix * - qz;
		this.z = iz * qw + iw * - qz + ix * - qy - iy * - qx;

		return this;

	},

	project: function () {

		var matrix;

		return function ( camera ) {

			if ( matrix === undefined ) matrix = new THREE.Matrix4();

			matrix.multiplyMatrices( camera.projectionMatrix, matrix.getInverse( camera.matrixWorld ) );
			return this.applyProjection( matrix );

		};

	}(),

	unproject: function () {

		var matrix;

		return function ( camera ) {

			if ( matrix === undefined ) matrix = new THREE.Matrix4();

			matrix.multiplyMatrices( camera.matrixWorld, matrix.getInverse( camera.projectionMatrix ) );
			return this.applyProjection( matrix );

		};

	}(),

	transformDirection: function ( m ) {

		// input: THREE.Matrix4 affine matrix
		// vector interpreted as a direction

		var x = this.x, y = this.y, z = this.z;

		var e = m.elements;

		this.x = e[ 0 ] * x + e[ 4 ] * y + e[ 8 ]  * z;
		this.y = e[ 1 ] * x + e[ 5 ] * y + e[ 9 ]  * z;
		this.z = e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z;

		this.normalize();

		return this;

	},

	divide: function ( v ) {

		this.x /= v.x;
		this.y /= v.y;
		this.z /= v.z;

		return this;

	},

	divideScalar: function ( scalar ) {

		if ( scalar !== 0 ) {

			var invScalar = 1 / scalar;

			this.x *= invScalar;
			this.y *= invScalar;
			this.z *= invScalar;

		} else {

			this.x = 0;
			this.y = 0;
			this.z = 0;

		}

		return this;

	},

	min: function ( v ) {

		if ( this.x > v.x ) {

			this.x = v.x;

		}

		if ( this.y > v.y ) {

			this.y = v.y;

		}

		if ( this.z > v.z ) {

			this.z = v.z;

		}

		return this;

	},

	max: function ( v ) {

		if ( this.x < v.x ) {

			this.x = v.x;

		}

		if ( this.y < v.y ) {

			this.y = v.y;

		}

		if ( this.z < v.z ) {

			this.z = v.z;

		}

		return this;

	},

	clamp: function ( min, max ) {

		// This function assumes min < max, if this assumption isn't true it will not operate correctly

		if ( this.x < min.x ) {

			this.x = min.x;

		} else if ( this.x > max.x ) {

			this.x = max.x;

		}

		if ( this.y < min.y ) {

			this.y = min.y;

		} else if ( this.y > max.y ) {

			this.y = max.y;

		}

		if ( this.z < min.z ) {

			this.z = min.z;

		} else if ( this.z > max.z ) {

			this.z = max.z;

		}

		return this;

	},

	clampScalar: ( function () {

		var min, max;

		return function ( minVal, maxVal ) {

			if ( min === undefined ) {

				min = new THREE.Vector3();
				max = new THREE.Vector3();

			}

			min.set( minVal, minVal, minVal );
			max.set( maxVal, maxVal, maxVal );

			return this.clamp( min, max );

		};

	} )(),

	floor: function () {

		this.x = Math.floor( this.x );
		this.y = Math.floor( this.y );
		this.z = Math.floor( this.z );

		return this;

	},

	ceil: function () {

		this.x = Math.ceil( this.x );
		this.y = Math.ceil( this.y );
		this.z = Math.ceil( this.z );

		return this;

	},

	round: function () {

		this.x = Math.round( this.x );
		this.y = Math.round( this.y );
		this.z = Math.round( this.z );

		return this;

	},

	roundToZero: function () {

		this.x = ( this.x < 0 ) ? Math.ceil( this.x ) : Math.floor( this.x );
		this.y = ( this.y < 0 ) ? Math.ceil( this.y ) : Math.floor( this.y );
		this.z = ( this.z < 0 ) ? Math.ceil( this.z ) : Math.floor( this.z );

		return this;

	},

	negate: function () {

		this.x = - this.x;
		this.y = - this.y;
		this.z = - this.z;

		return this;

	},

	dot: function ( v ) {

		return this.x * v.x + this.y * v.y + this.z * v.z;

	},

	lengthSq: function () {

		return this.x * this.x + this.y * this.y + this.z * this.z;

	},

	length: function () {

		return Math.sqrt( this.x * this.x + this.y * this.y + this.z * this.z );

	},

	lengthManhattan: function () {

		return Math.abs( this.x ) + Math.abs( this.y ) + Math.abs( this.z );

	},

	normalize: function () {

		return this.divideScalar( this.length() );

	},

	setLength: function ( l ) {

		var oldLength = this.length();

		if ( oldLength !== 0 && l !== oldLength  ) {

			this.multiplyScalar( l / oldLength );
		}

		return this;

	},

	lerp: function ( v, alpha ) {

		this.x += ( v.x - this.x ) * alpha;
		this.y += ( v.y - this.y ) * alpha;
		this.z += ( v.z - this.z ) * alpha;

		return this;

	},

	cross: function ( v, w ) {

		if ( w !== undefined ) {

			console.warn( 'THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.' );
			return this.crossVectors( v, w );

		}

		var x = this.x, y = this.y, z = this.z;

		this.x = y * v.z - z * v.y;
		this.y = z * v.x - x * v.z;
		this.z = x * v.y - y * v.x;

		return this;

	},

	crossVectors: function ( a, b ) {

		var ax = a.x, ay = a.y, az = a.z;
		var bx = b.x, by = b.y, bz = b.z;

		this.x = ay * bz - az * by;
		this.y = az * bx - ax * bz;
		this.z = ax * by - ay * bx;

		return this;

	},

	projectOnVector: function () {

		var v1, dot;

		return function ( vector ) {

			if ( v1 === undefined ) v1 = new THREE.Vector3();

			v1.copy( vector ).normalize();

			dot = this.dot( v1 );

			return this.copy( v1 ).multiplyScalar( dot );

		};

	}(),

	projectOnPlane: function () {

		var v1;

		return function ( planeNormal ) {

			if ( v1 === undefined ) v1 = new THREE.Vector3();

			v1.copy( this ).projectOnVector( planeNormal );

			return this.sub( v1 );

		}

	}(),

	reflect: function () {

		// reflect incident vector off plane orthogonal to normal
		// normal is assumed to have unit length

		var v1;

		return function ( normal ) {

			if ( v1 === undefined ) v1 = new THREE.Vector3();

			return this.sub( v1.copy( normal ).multiplyScalar( 2 * this.dot( normal ) ) );

		}

	}(),

	angleTo: function ( v ) {

		var theta = this.dot( v ) / ( this.length() * v.length() );

		// clamp, to handle numerical problems

		return Math.acos( THREE.Math.clamp( theta, - 1, 1 ) );

	},

	distanceTo: function ( v ) {

		return Math.sqrt( this.distanceToSquared( v ) );

	},

	distanceToSquared: function ( v ) {

		var dx = this.x - v.x;
		var dy = this.y - v.y;
		var dz = this.z - v.z;

		return dx * dx + dy * dy + dz * dz;

	},

	setEulerFromRotationMatrix: function ( m, order ) {

		console.error( 'THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.' );

	},

	setEulerFromQuaternion: function ( q, order ) {

		console.error( 'THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.' );

	},

	getPositionFromMatrix: function ( m ) {

		console.warn( 'THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().' );

		return this.setFromMatrixPosition( m );

	},

	getScaleFromMatrix: function ( m ) {

		console.warn( 'THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().' );

		return this.setFromMatrixScale( m );
	},

	getColumnFromMatrix: function ( index, matrix ) {

		console.warn( 'THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().' );

		return this.setFromMatrixColumn( index, matrix );

	},

	setFromMatrixPosition: function ( m ) {

		this.x = m.elements[ 12 ];
		this.y = m.elements[ 13 ];
		this.z = m.elements[ 14 ];

		return this;

	},

	setFromMatrixScale: function ( m ) {

		var sx = this.set( m.elements[ 0 ], m.elements[ 1 ], m.elements[  2 ] ).length();
		var sy = this.set( m.elements[ 4 ], m.elements[ 5 ], m.elements[  6 ] ).length();
		var sz = this.set( m.elements[ 8 ], m.elements[ 9 ], m.elements[ 10 ] ).length();

		this.x = sx;
		this.y = sy;
		this.z = sz;

		return this;
	},

	setFromMatrixColumn: function ( index, matrix ) {

		var offset = index * 4;

		var me = matrix.elements;

		this.x = me[ offset ];
		this.y = me[ offset + 1 ];
		this.z = me[ offset + 2 ];

		return this;

	},

	equals: function ( v ) {

		return ( ( v.x === this.x ) && ( v.y === this.y ) && ( v.z === this.z ) );

	},

	fromArray: function ( array, offset ) {

		if ( offset === undefined ) offset = 0;

		this.x = array[ offset ];
		this.y = array[ offset + 1 ];
		this.z = array[ offset + 2 ];

		return this;

	},

	toArray: function ( array, offset ) {

		if ( array === undefined ) array = [];
		if ( offset === undefined ) offset = 0;

		array[ offset ] = this.x;
		array[ offset + 1 ] = this.y;
		array[ offset + 2 ] = this.z;

		return array;

	},

	clone: function () {

		return new THREE.Vector3( this.x, this.y, this.z );

	}

};

// File:src/math/Vector4.js

/**
 * @author supereggbert / http://www.paulbrunt.co.uk/
 * @author philogb / http://blog.thejit.org/
 * @author mikael emtinger / http://gomo.se/
 * @author egraether / http://egraether.com/
 * @author WestLangley / http://github.com/WestLangley
 */

THREE.Vector4 = function ( x, y, z, w ) {

	this.x = x || 0;
	this.y = y || 0;
	this.z = z || 0;
	this.w = ( w !== undefined ) ? w : 1;

};

THREE.Vector4.prototype = {

	constructor: THREE.Vector4,

	set: function ( x, y, z, w ) {

		this.x = x;
		this.y = y;
		this.z = z;
		this.w = w;

		return this;

	},

	setX: function ( x ) {

		this.x = x;

		return this;

	},

	setY: function ( y ) {

		this.y = y;

		return this;

	},

	setZ: function ( z ) {

		this.z = z;

		return this;

	},

	setW: function ( w ) {

		this.w = w;

		return this;

	},

	setComponent: function ( index, value ) {

		switch ( index ) {

			case 0: this.x = value; break;
			case 1: this.y = value; break;
			case 2: this.z = value; break;
			case 3: this.w = value; break;
			default: throw new Error( 'index is out of range: ' + index );

		}

	},

	getComponent: function ( index ) {

		switch ( index ) {

			case 0: return this.x;
			case 1: return this.y;
			case 2: return this.z;
			case 3: return this.w;
			default: throw new Error( 'index is out of range: ' + index );

		}

	},

	copy: function ( v ) {

		this.x = v.x;
		this.y = v.y;
		this.z = v.z;
		this.w = ( v.w !== undefined ) ? v.w : 1;

		return this;

	},

	add: function ( v, w ) {

		if ( w !== undefined ) {

			console.warn( 'THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.' );
			return this.addVectors( v, w );

		}

		this.x += v.x;
		this.y += v.y;
		this.z += v.z;
		this.w += v.w;

		return this;

	},

	addScalar: function ( s ) {

		this.x += s;
		this.y += s;
		this.z += s;
		this.w += s;

		return this;

	},

	addVectors: function ( a, b ) {

		this.x = a.x + b.x;
		this.y = a.y + b.y;
		this.z = a.z + b.z;
		this.w = a.w + b.w;

		return this;

	},

	sub: function ( v, w ) {

		if ( w !== undefined ) {

			console.warn( 'THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.' );
			return this.subVectors( v, w );

		}

		this.x -= v.x;
		this.y -= v.y;
		this.z -= v.z;
		this.w -= v.w;

		return this;

	},

	subVectors: function ( a, b ) {

		this.x = a.x - b.x;
		this.y = a.y - b.y;
		this.z = a.z - b.z;
		this.w = a.w - b.w;

		return this;

	},

	multiplyScalar: function ( scalar ) {

		this.x *= scalar;
		this.y *= scalar;
		this.z *= scalar;
		this.w *= scalar;

		return this;

	},

	applyMatrix4: function ( m ) {

		var x = this.x;
		var y = this.y;
		var z = this.z;
		var w = this.w;

		var e = m.elements;

		this.x = e[ 0 ] * x + e[ 4 ] * y + e[ 8 ] * z + e[ 12 ] * w;
		this.y = e[ 1 ] * x + e[ 5 ] * y + e[ 9 ] * z + e[ 13 ] * w;
		this.z = e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z + e[ 14 ] * w;
		this.w = e[ 3 ] * x + e[ 7 ] * y + e[ 11 ] * z + e[ 15 ] * w;

		return this;

	},

	divideScalar: function ( scalar ) {

		if ( scalar !== 0 ) {

			var invScalar = 1 / scalar;

			this.x *= invScalar;
			this.y *= invScalar;
			this.z *= invScalar;
			this.w *= invScalar;

		} else {

			this.x = 0;
			this.y = 0;
			this.z = 0;
			this.w = 1;

		}

		return this;

	},

	setAxisAngleFromQuaternion: function ( q ) {

		// http://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm

		// q is assumed to be normalized

		this.w = 2 * Math.acos( q.w );

		var s = Math.sqrt( 1 - q.w * q.w );

		if ( s < 0.0001 ) {

			 this.x = 1;
			 this.y = 0;
			 this.z = 0;

		} else {

			 this.x = q.x / s;
			 this.y = q.y / s;
			 this.z = q.z / s;

		}

		return this;

	},

	setAxisAngleFromRotationMatrix: function ( m ) {

		// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToAngle/index.htm

		// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)

		var angle, x, y, z,		// variables for result
			epsilon = 0.01,		// margin to allow for rounding errors
			epsilon2 = 0.1,		// margin to distinguish between 0 and 180 degrees

			te = m.elements,

			m11 = te[ 0 ], m12 = te[ 4 ], m13 = te[ 8 ],
			m21 = te[ 1 ], m22 = te[ 5 ], m23 = te[ 9 ],
			m31 = te[ 2 ], m32 = te[ 6 ], m33 = te[ 10 ];

		if ( ( Math.abs( m12 - m21 ) < epsilon )
		   && ( Math.abs( m13 - m31 ) < epsilon )
		   && ( Math.abs( m23 - m32 ) < epsilon ) ) {

			// singularity found
			// first check for identity matrix which must have +1 for all terms
			// in leading diagonal and zero in other terms

			if ( ( Math.abs( m12 + m21 ) < epsilon2 )
			   && ( Math.abs( m13 + m31 ) < epsilon2 )
			   && ( Math.abs( m23 + m32 ) < epsilon2 )
			   && ( Math.abs( m11 + m22 + m33 - 3 ) < epsilon2 ) ) {

				// this singularity is identity matrix so angle = 0

				this.set( 1, 0, 0, 0 );

				return this; // zero angle, arbitrary axis

			}

			// otherwise this singularity is angle = 180

			angle = Math.PI;

			var xx = ( m11 + 1 ) / 2;
			var yy = ( m22 + 1 ) / 2;
			var zz = ( m33 + 1 ) / 2;
			var xy = ( m12 + m21 ) / 4;
			var xz = ( m13 + m31 ) / 4;
			var yz = ( m23 + m32 ) / 4;

			if ( ( xx > yy ) && ( xx > zz ) ) { // m11 is the largest diagonal term

				if ( xx < epsilon ) {

					x = 0;
					y = 0.707106781;
					z = 0.707106781;

				} else {

					x = Math.sqrt( xx );
					y = xy / x;
					z = xz / x;

				}

			} else if ( yy > zz ) { // m22 is the largest diagonal term

				if ( yy < epsilon ) {

					x = 0.707106781;
					y = 0;
					z = 0.707106781;

				} else {

					y = Math.sqrt( yy );
					x = xy / y;
					z = yz / y;

				}

			} else { // m33 is the largest diagonal term so base result on this

				if ( zz < epsilon ) {

					x = 0.707106781;
					y = 0.707106781;
					z = 0;

				} else {

					z = Math.sqrt( zz );
					x = xz / z;
					y = yz / z;

				}

			}

			this.set( x, y, z, angle );

			return this; // return 180 deg rotation

		}

		// as we have reached here there are no singularities so we can handle normally

		var s = Math.sqrt( ( m32 - m23 ) * ( m32 - m23 )
						  + ( m13 - m31 ) * ( m13 - m31 )
						  + ( m21 - m12 ) * ( m21 - m12 ) ); // used to normalize

		if ( Math.abs( s ) < 0.001 ) s = 1;

		// prevent divide by zero, should not happen if matrix is orthogonal and should be
		// caught by singularity test above, but I've left it in just in case

		this.x = ( m32 - m23 ) / s;
		this.y = ( m13 - m31 ) / s;
		this.z = ( m21 - m12 ) / s;
		this.w = Math.acos( ( m11 + m22 + m33 - 1 ) / 2 );

		return this;

	},

	min: function ( v ) {

		if ( this.x > v.x ) {

			this.x = v.x;

		}

		if ( this.y > v.y ) {

			this.y = v.y;

		}

		if ( this.z > v.z ) {

			this.z = v.z;

		}

		if ( this.w > v.w ) {

			this.w = v.w;

		}

		return this;

	},

	max: function ( v ) {

		if ( this.x < v.x ) {

			this.x = v.x;

		}

		if ( this.y < v.y ) {

			this.y = v.y;

		}

		if ( this.z < v.z ) {

			this.z = v.z;

		}

		if ( this.w < v.w ) {

			this.w = v.w;

		}

		return this;

	},

	clamp: function ( min, max ) {

		// This function assumes min < max, if this assumption isn't true it will not operate correctly

		if ( this.x < min.x ) {

			this.x = min.x;

		} else if ( this.x > max.x ) {

			this.x = max.x;

		}

		if ( this.y < min.y ) {

			this.y = min.y;

		} else if ( this.y > max.y ) {

			this.y = max.y;

		}

		if ( this.z < min.z ) {

			this.z = min.z;

		} else if ( this.z > max.z ) {

			this.z = max.z;

		}

		if ( this.w < min.w ) {

			this.w = min.w;

		} else if ( this.w > max.w ) {

			this.w = max.w;

		}

		return this;

	},

	clampScalar: ( function () {

		var min, max;

		return function ( minVal, maxVal ) {

			if ( min === undefined ) {

				min = new THREE.Vector4();
				max = new THREE.Vector4();

			}

			min.set( minVal, minVal, minVal, minVal );
			max.set( maxVal, maxVal, maxVal, maxVal );

			return this.clamp( min, max );

		};

	} )(),

    floor: function () {

        this.x = Math.floor( this.x );
        this.y = Math.floor( this.y );
        this.z = Math.floor( this.z );
        this.w = Math.floor( this.w );

        return this;

    },

    ceil: function () {

        this.x = Math.ceil( this.x );
        this.y = Math.ceil( this.y );
        this.z = Math.ceil( this.z );
        this.w = Math.ceil( this.w );

        return this;

    },

    round: function () {

        this.x = Math.round( this.x );
        this.y = Math.round( this.y );
        this.z = Math.round( this.z );
        this.w = Math.round( this.w );

        return this;

    },

    roundToZero: function () {

        this.x = ( this.x < 0 ) ? Math.ceil( this.x ) : Math.floor( this.x );
        this.y = ( this.y < 0 ) ? Math.ceil( this.y ) : Math.floor( this.y );
        this.z = ( this.z < 0 ) ? Math.ceil( this.z ) : Math.floor( this.z );
        this.w = ( this.w < 0 ) ? Math.ceil( this.w ) : Math.floor( this.w );

        return this;

    },

	negate: function () {

		this.x = - this.x;
		this.y = - this.y;
		this.z = - this.z;
		this.w = - this.w;

		return this;

	},

	dot: function ( v ) {

		return this.x * v.x + this.y * v.y + this.z * v.z + this.w * v.w;

	},

	lengthSq: function () {

		return this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w;

	},

	length: function () {

		return Math.sqrt( this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w );

	},

	lengthManhattan: function () {

		return Math.abs( this.x ) + Math.abs( this.y ) + Math.abs( this.z ) + Math.abs( this.w );

	},

	normalize: function () {

		return this.divideScalar( this.length() );

	},

	setLength: function ( l ) {

		var oldLength = this.length();

		if ( oldLength !== 0 && l !== oldLength ) {

			this.multiplyScalar( l / oldLength );

		}

		return this;

	},

	lerp: function ( v, alpha ) {

		this.x += ( v.x - this.x ) * alpha;
		this.y += ( v.y - this.y ) * alpha;
		this.z += ( v.z - this.z ) * alpha;
		this.w += ( v.w - this.w ) * alpha;

		return this;

	},

	equals: function ( v ) {

		return ( ( v.x === this.x ) && ( v.y === this.y ) && ( v.z === this.z ) && ( v.w === this.w ) );

	},

	fromArray: function ( array, offset ) {

		if ( offset === undefined ) offset = 0;

		this.x = array[ offset ];
		this.y = array[ offset + 1 ];
		this.z = array[ offset + 2 ];
		this.w = array[ offset + 3 ];

		return this;

	},

	toArray: function ( array, offset ) {

		if ( array === undefined ) array = [];
		if ( offset === undefined ) offset = 0;

		array[ offset ] = this.x;
		array[ offset + 1 ] = this.y;
		array[ offset + 2 ] = this.z;
		array[ offset + 3 ] = this.w;

		return array;

	},

	clone: function () {

		return new THREE.Vector4( this.x, this.y, this.z, this.w );

	}

};

// File:src/math/Euler.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author WestLangley / http://github.com/WestLangley
 * @author bhouston / http://exocortex.com
 */

THREE.Euler = function ( x, y, z, order ) {

	this._x = x || 0;
	this._y = y || 0;
	this._z = z || 0;
	this._order = order || THREE.Euler.DefaultOrder;

};

THREE.Euler.RotationOrders = [ 'XYZ', 'YZX', 'ZXY', 'XZY', 'YXZ', 'ZYX' ];

THREE.Euler.DefaultOrder = 'XYZ';

THREE.Euler.prototype = {

	constructor: THREE.Euler,

	_x: 0, _y: 0, _z: 0, _order: THREE.Euler.DefaultOrder,

	get x () {

		return this._x;

	},

	set x ( value ) {

		this._x = value;
		this.onChangeCallback();

	},

	get y () {

		return this._y;

	},

	set y ( value ) {

		this._y = value;
		this.onChangeCallback();

	},

	get z () {

		return this._z;

	},

	set z ( value ) {

		this._z = value;
		this.onChangeCallback();

	},

	get order () {

		return this._order;

	},

	set order ( value ) {

		this._order = value;
		this.onChangeCallback();

	},

	set: function ( x, y, z, order ) {

		this._x = x;
		this._y = y;
		this._z = z;
		this._order = order || this._order;

		this.onChangeCallback();

		return this;

	},

	copy: function ( euler ) {

		this._x = euler._x;
		this._y = euler._y;
		this._z = euler._z;
		this._order = euler._order;

		this.onChangeCallback();

		return this;

	},

	setFromRotationMatrix: function ( m, order ) {

		var clamp = THREE.Math.clamp;

		// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)

		var te = m.elements;
		var m11 = te[ 0 ], m12 = te[ 4 ], m13 = te[ 8 ];
		var m21 = te[ 1 ], m22 = te[ 5 ], m23 = te[ 9 ];
		var m31 = te[ 2 ], m32 = te[ 6 ], m33 = te[ 10 ];

		order = order || this._order;

		if ( order === 'XYZ' ) {

			this._y = Math.asin( clamp( m13, - 1, 1 ) );

			if ( Math.abs( m13 ) < 0.99999 ) {

				this._x = Math.atan2( - m23, m33 );
				this._z = Math.atan2( - m12, m11 );

			} else {

				this._x = Math.atan2( m32, m22 );
				this._z = 0;

			}

		} else if ( order === 'YXZ' ) {

			this._x = Math.asin( - clamp( m23, - 1, 1 ) );

			if ( Math.abs( m23 ) < 0.99999 ) {

				this._y = Math.atan2( m13, m33 );
				this._z = Math.atan2( m21, m22 );

			} else {

				this._y = Math.atan2( - m31, m11 );
				this._z = 0;

			}

		} else if ( order === 'ZXY' ) {

			this._x = Math.asin( clamp( m32, - 1, 1 ) );

			if ( Math.abs( m32 ) < 0.99999 ) {

				this._y = Math.atan2( - m31, m33 );
				this._z = Math.atan2( - m12, m22 );

			} else {

				this._y = 0;
				this._z = Math.atan2( m21, m11 );

			}

		} else if ( order === 'ZYX' ) {

			this._y = Math.asin( - clamp( m31, - 1, 1 ) );

			if ( Math.abs( m31 ) < 0.99999 ) {

				this._x = Math.atan2( m32, m33 );
				this._z = Math.atan2( m21, m11 );

			} else {

				this._x = 0;
				this._z = Math.atan2( - m12, m22 );

			}

		} else if ( order === 'YZX' ) {

			this._z = Math.asin( clamp( m21, - 1, 1 ) );

			if ( Math.abs( m21 ) < 0.99999 ) {

				this._x = Math.atan2( - m23, m22 );
				this._y = Math.atan2( - m31, m11 );

			} else {

				this._x = 0;
				this._y = Math.atan2( m13, m33 );

			}

		} else if ( order === 'XZY' ) {

			this._z = Math.asin( - clamp( m12, - 1, 1 ) );

			if ( Math.abs( m12 ) < 0.99999 ) {

				this._x = Math.atan2( m32, m22 );
				this._y = Math.atan2( m13, m11 );

			} else {

				this._x = Math.atan2( - m23, m33 );
				this._y = 0;

			}

		} else {

			console.warn( 'THREE.Euler: .setFromRotationMatrix() given unsupported order: ' + order )

		}

		this._order = order;

		this.onChangeCallback();

		return this;

	},

	setFromQuaternion: function ( q, order, update ) {

		var clamp = THREE.Math.clamp;

		// q is assumed to be normalized

		// http://www.mathworks.com/matlabcentral/fileexchange/20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/content/SpinCalc.m

		var sqx = q.x * q.x;
		var sqy = q.y * q.y;
		var sqz = q.z * q.z;
		var sqw = q.w * q.w;

		order = order || this._order;

		if ( order === 'XYZ' ) {

			this._x = Math.atan2( 2 * ( q.x * q.w - q.y * q.z ), ( sqw - sqx - sqy + sqz ) );
			this._y = Math.asin(  clamp( 2 * ( q.x * q.z + q.y * q.w ), - 1, 1 ) );
			this._z = Math.atan2( 2 * ( q.z * q.w - q.x * q.y ), ( sqw + sqx - sqy - sqz ) );

		} else if ( order ===  'YXZ' ) {

			this._x = Math.asin(  clamp( 2 * ( q.x * q.w - q.y * q.z ), - 1, 1 ) );
			this._y = Math.atan2( 2 * ( q.x * q.z + q.y * q.w ), ( sqw - sqx - sqy + sqz ) );
			this._z = Math.atan2( 2 * ( q.x * q.y + q.z * q.w ), ( sqw - sqx + sqy - sqz ) );

		} else if ( order === 'ZXY' ) {

			this._x = Math.asin(  clamp( 2 * ( q.x * q.w + q.y * q.z ), - 1, 1 ) );
			this._y = Math.atan2( 2 * ( q.y * q.w - q.z * q.x ), ( sqw - sqx - sqy + sqz ) );
			this._z = Math.atan2( 2 * ( q.z * q.w - q.x * q.y ), ( sqw - sqx + sqy - sqz ) );

		} else if ( order === 'ZYX' ) {

			this._x = Math.atan2( 2 * ( q.x * q.w + q.z * q.y ), ( sqw - sqx - sqy + sqz ) );
			this._y = Math.asin(  clamp( 2 * ( q.y * q.w - q.x * q.z ), - 1, 1 ) );
			this._z = Math.atan2( 2 * ( q.x * q.y + q.z * q.w ), ( sqw + sqx - sqy - sqz ) );

		} else if ( order === 'YZX' ) {

			this._x = Math.atan2( 2 * ( q.x * q.w - q.z * q.y ), ( sqw - sqx + sqy - sqz ) );
			this._y = Math.atan2( 2 * ( q.y * q.w - q.x * q.z ), ( sqw + sqx - sqy - sqz ) );
			this._z = Math.asin(  clamp( 2 * ( q.x * q.y + q.z * q.w ), - 1, 1 ) );

		} else if ( order === 'XZY' ) {

			this._x = Math.atan2( 2 * ( q.x * q.w + q.y * q.z ), ( sqw - sqx + sqy - sqz ) );
			this._y = Math.atan2( 2 * ( q.x * q.z + q.y * q.w ), ( sqw + sqx - sqy - sqz ) );
			this._z = Math.asin(  clamp( 2 * ( q.z * q.w - q.x * q.y ), - 1, 1 ) );

		} else {

			console.warn( 'THREE.Euler: .setFromQuaternion() given unsupported order: ' + order )

		}

		this._order = order;

		if ( update !== false ) this.onChangeCallback();

		return this;

	},

	reorder: function () {

		// WARNING: this discards revolution information -bhouston

		var q = new THREE.Quaternion();

		return function ( newOrder ) {

			q.setFromEuler( this );
			this.setFromQuaternion( q, newOrder );

		};


	}(),

	equals: function ( euler ) {

		return ( euler._x === this._x ) && ( euler._y === this._y ) && ( euler._z === this._z ) && ( euler._order === this._order );

	},

	fromArray: function ( array ) {

		this._x = array[ 0 ];
		this._y = array[ 1 ];
		this._z = array[ 2 ];
		if ( array[ 3 ] !== undefined ) this._order = array[ 3 ];

		this.onChangeCallback();

		return this;

	},

	toArray: function () {

		return [ this._x, this._y, this._z, this._order ];

	},

	onChange: function ( callback ) {

		this.onChangeCallback = callback;

		return this;

	},

	onChangeCallback: function () {},

	clone: function () {

		return new THREE.Euler( this._x, this._y, this._z, this._order );

	}

};

// File:src/math/Line3.js

/**
 * @author bhouston / http://exocortex.com
 */

THREE.Line3 = function ( start, end ) {

	this.start = ( start !== undefined ) ? start : new THREE.Vector3();
	this.end = ( end !== undefined ) ? end : new THREE.Vector3();

};

THREE.Line3.prototype = {

	constructor: THREE.Line3,

	set: function ( start, end ) {

		this.start.copy( start );
		this.end.copy( end );

		return this;

	},

	copy: function ( line ) {

		this.start.copy( line.start );
		this.end.copy( line.end );

		return this;

	},

	center: function ( optionalTarget ) {

		var result = optionalTarget || new THREE.Vector3();
		return result.addVectors( this.start, this.end ).multiplyScalar( 0.5 );

	},

	delta: function ( optionalTarget ) {

		var result = optionalTarget || new THREE.Vector3();
		return result.subVectors( this.end, this.start );

	},

	distanceSq: function () {

		return this.start.distanceToSquared( this.end );

	},

	distance: function () {

		return this.start.distanceTo( this.end );

	},

	at: function ( t, optionalTarget ) {

		var result = optionalTarget || new THREE.Vector3();

		return this.delta( result ).multiplyScalar( t ).add( this.start );

	},

	closestPointToPointParameter: function () {

		var startP = new THREE.Vector3();
		var startEnd = new THREE.Vector3();

		return function ( point, clampToLine ) {

			startP.subVectors( point, this.start );
			startEnd.subVectors( this.end, this.start );

			var startEnd2 = startEnd.dot( startEnd );
			var startEnd_startP = startEnd.dot( startP );

			var t = startEnd_startP / startEnd2;

			if ( clampToLine ) {

				t = THREE.Math.clamp( t, 0, 1 );

			}

			return t;

		};

	}(),

	closestPointToPoint: function ( point, clampToLine, optionalTarget ) {

		var t = this.closestPointToPointParameter( point, clampToLine );

		var result = optionalTarget || new THREE.Vector3();

		return this.delta( result ).multiplyScalar( t ).add( this.start );

	},

	applyMatrix4: function ( matrix ) {

		this.start.applyMatrix4( matrix );
		this.end.applyMatrix4( matrix );

		return this;

	},

	equals: function ( line ) {

		return line.start.equals( this.start ) && line.end.equals( this.end );

	},

	clone: function () {

		return new THREE.Line3().copy( this );

	}

};

// File:src/math/Box2.js

/**
 * @author bhouston / http://exocortex.com
 */

THREE.Box2 = function ( min, max ) {

	this.min = ( min !== undefined ) ? min : new THREE.Vector2( Infinity, Infinity );
	this.max = ( max !== undefined ) ? max : new THREE.Vector2( - Infinity, - Infinity );

};

THREE.Box2.prototype = {

	constructor: THREE.Box2,

	set: function ( min, max ) {

		this.min.copy( min );
		this.max.copy( max );

		return this;

	},

	setFromPoints: function ( points ) {

		this.makeEmpty();

		for ( var i = 0, il = points.length; i < il; i ++ ) {

			this.expandByPoint( points[ i ] )

		}

		return this;

	},

	setFromCenterAndSize: function () {

		var v1 = new THREE.Vector2();

		return function ( center, size ) {

			var halfSize = v1.copy( size ).multiplyScalar( 0.5 );
			this.min.copy( center ).sub( halfSize );
			this.max.copy( center ).add( halfSize );

			return this;

		};

	}(),

	copy: function ( box ) {

		this.min.copy( box.min );
		this.max.copy( box.max );

		return this;

	},

	makeEmpty: function () {

		this.min.x = this.min.y = Infinity;
		this.max.x = this.max.y = - Infinity;

		return this;

	},

	empty: function () {

		// this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes

		return ( this.max.x < this.min.x ) || ( this.max.y < this.min.y );

	},

	center: function ( optionalTarget ) {

		var result = optionalTarget || new THREE.Vector2();
		return result.addVectors( this.min, this.max ).multiplyScalar( 0.5 );

	},

	size: function ( optionalTarget ) {

		var result = optionalTarget || new THREE.Vector2();
		return result.subVectors( this.max, this.min );

	},

	expandByPoint: function ( point ) {

		this.min.min( point );
		this.max.max( point );

		return this;
	},

	expandByVector: function ( vector ) {

		this.min.sub( vector );
		this.max.add( vector );

		return this;
	},

	expandByScalar: function ( scalar ) {

		this.min.addScalar( - scalar );
		this.max.addScalar( scalar );

		return this;
	},

	containsPoint: function ( point ) {

		if ( point.x < this.min.x || point.x > this.max.x ||
		     point.y < this.min.y || point.y > this.max.y ) {

			return false;

		}

		return true;

	},

	containsBox: function ( box ) {

		if ( ( this.min.x <= box.min.x ) && ( box.max.x <= this.max.x ) &&
		     ( this.min.y <= box.min.y ) && ( box.max.y <= this.max.y ) ) {

			return true;

		}

		return false;

	},

	getParameter: function ( point, optionalTarget ) {

		// This can potentially have a divide by zero if the box
		// has a size dimension of 0.

		var result = optionalTarget || new THREE.Vector2();

		return result.set(
			( point.x - this.min.x ) / ( this.max.x - this.min.x ),
			( point.y - this.min.y ) / ( this.max.y - this.min.y )
		);

	},

	isIntersectionBox: function ( box ) {

		// using 6 splitting planes to rule out intersections.

		if ( box.max.x < this.min.x || box.min.x > this.max.x ||
		     box.max.y < this.min.y || box.min.y > this.max.y ) {

			return false;

		}

		return true;

	},

	clampPoint: function ( point, optionalTarget ) {

		var result = optionalTarget || new THREE.Vector2();
		return result.copy( point ).clamp( this.min, this.max );

	},

	distanceToPoint: function () {

		var v1 = new THREE.Vector2();

		return function ( point ) {

			var clampedPoint = v1.copy( point ).clamp( this.min, this.max );
			return clampedPoint.sub( point ).length();

		};

	}(),

	intersect: function ( box ) {

		this.min.max( box.min );
		this.max.min( box.max );

		return this;

	},

	union: function ( box ) {

		this.min.min( box.min );
		this.max.max( box.max );

		return this;

	},

	translate: function ( offset ) {

		this.min.add( offset );
		this.max.add( offset );

		return this;

	},

	equals: function ( box ) {

		return box.min.equals( this.min ) && box.max.equals( this.max );

	},

	clone: function () {

		return new THREE.Box2().copy( this );

	}

};

// File:src/math/Box3.js

/**
 * @author bhouston / http://exocortex.com
 * @author WestLangley / http://github.com/WestLangley
 */

THREE.Box3 = function ( min, max ) {

	this.min = ( min !== undefined ) ? min : new THREE.Vector3( Infinity, Infinity, Infinity );
	this.max = ( max !== undefined ) ? max : new THREE.Vector3( - Infinity, - Infinity, - Infinity );

};

THREE.Box3.prototype = {

	constructor: THREE.Box3,

	set: function ( min, max ) {

		this.min.copy( min );
		this.max.copy( max );

		return this;

	},

	setFromPoints: function ( points ) {

		this.makeEmpty();

		for ( var i = 0, il = points.length; i < il; i ++ ) {

			this.expandByPoint( points[ i ] )

		}

		return this;

	},

	setFromCenterAndSize: function () {

		var v1 = new THREE.Vector3();

		return function ( center, size ) {

			var halfSize = v1.copy( size ).multiplyScalar( 0.5 );

			this.min.copy( center ).sub( halfSize );
			this.max.copy( center ).add( halfSize );

			return this;

		};

	}(),

	setFromObject: function () {

		// Computes the world-axis-aligned bounding box of an object (including its children),
		// accounting for both the object's, and childrens', world transforms

		var v1 = new THREE.Vector3();

		return function ( object ) {

			var scope = this;

			object.updateMatrixWorld( true );

			this.makeEmpty();

			object.traverse( function ( node ) {

				var geometry = node.geometry;

				if ( geometry !== undefined ) {

					if ( geometry instanceof THREE.Geometry ) {

						var vertices = geometry.vertices;

						for ( var i = 0, il = vertices.length; i < il; i ++ ) {

							v1.copy( vertices[ i ] );

							v1.applyMatrix4( node.matrixWorld );

							scope.expandByPoint( v1 );

						}

					} else if ( geometry instanceof THREE.BufferGeometry && geometry.attributes[ 'position' ] !== undefined ) {

						var positions = geometry.attributes[ 'position' ].array;

						for ( var i = 0, il = positions.length; i < il; i += 3 ) {

							v1.set( positions[ i ], positions[ i + 1 ], positions[ i + 2 ] );

							v1.applyMatrix4( node.matrixWorld );

							scope.expandByPoint( v1 );

						}

					}

				}

			} );

			return this;

		};

	}(),

	copy: function ( box ) {

		this.min.copy( box.min );
		this.max.copy( box.max );

		return this;

	},

	makeEmpty: function () {

		this.min.x = this.min.y = this.min.z = Infinity;
		this.max.x = this.max.y = this.max.z = - Infinity;

		return this;

	},

	empty: function () {

		// this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes

		return ( this.max.x < this.min.x ) || ( this.max.y < this.min.y ) || ( this.max.z < this.min.z );

	},

	center: function ( optionalTarget ) {

		var result = optionalTarget || new THREE.Vector3();
		return result.addVectors( this.min, this.max ).multiplyScalar( 0.5 );

	},

	size: function ( optionalTarget ) {

		var result = optionalTarget || new THREE.Vector3();
		return result.subVectors( this.max, this.min );

	},

	expandByPoint: function ( point ) {

		this.min.min( point );
		this.max.max( point );

		return this;

	},

	expandByVector: function ( vector ) {

		this.min.sub( vector );
		this.max.add( vector );

		return this;

	},

	expandByScalar: function ( scalar ) {

		this.min.addScalar( - scalar );
		this.max.addScalar( scalar );

		return this;

	},

	containsPoint: function ( point ) {

		if ( point.x < this.min.x || point.x > this.max.x ||
		     point.y < this.min.y || point.y > this.max.y ||
		     point.z < this.min.z || point.z > this.max.z ) {

			return false;

		}

		return true;

	},

	containsBox: function ( box ) {

		if ( ( this.min.x <= box.min.x ) && ( box.max.x <= this.max.x ) &&
			 ( this.min.y <= box.min.y ) && ( box.max.y <= this.max.y ) &&
			 ( this.min.z <= box.min.z ) && ( box.max.z <= this.max.z ) ) {

			return true;

		}

		return false;

	},

	getParameter: function ( point, optionalTarget ) {

		// This can potentially have a divide by zero if the box
		// has a size dimension of 0.

		var result = optionalTarget || new THREE.Vector3();

		return result.set(
			( point.x - this.min.x ) / ( this.max.x - this.min.x ),
			( point.y - this.min.y ) / ( this.max.y - this.min.y ),
			( point.z - this.min.z ) / ( this.max.z - this.min.z )
		);

	},

	isIntersectionBox: function ( box ) {

		// using 6 splitting planes to rule out intersections.

		if ( box.max.x < this.min.x || box.min.x > this.max.x ||
		     box.max.y < this.min.y || box.min.y > this.max.y ||
		     box.max.z < this.min.z || box.min.z > this.max.z ) {

			return false;

		}

		return true;

	},

	clampPoint: function ( point, optionalTarget ) {

		var result = optionalTarget || new THREE.Vector3();
		return result.copy( point ).clamp( this.min, this.max );

	},

	distanceToPoint: function () {

		var v1 = new THREE.Vector3();

		return function ( point ) {

			var clampedPoint = v1.copy( point ).clamp( this.min, this.max );
			return clampedPoint.sub( point ).length();

		};

	}(),

	getBoundingSphere: function () {

		var v1 = new THREE.Vector3();

		return function ( optionalTarget ) {

			var result = optionalTarget || new THREE.Sphere();

			result.center = this.center();
			result.radius = this.size( v1 ).length() * 0.5;

			return result;

		};

	}(),

	intersect: function ( box ) {

		this.min.max( box.min );
		this.max.min( box.max );

		return this;

	},

	union: function ( box ) {

		this.min.min( box.min );
		this.max.max( box.max );

		return this;

	},

	applyMatrix4: function () {

		var points = [
			new THREE.Vector3(),
			new THREE.Vector3(),
			new THREE.Vector3(),
			new THREE.Vector3(),
			new THREE.Vector3(),
			new THREE.Vector3(),
			new THREE.Vector3(),
			new THREE.Vector3()
		];

		return function ( matrix ) {

			// NOTE: I am using a binary pattern to specify all 2^3 combinations below
			points[ 0 ].set( this.min.x, this.min.y, this.min.z ).applyMatrix4( matrix ); // 000
			points[ 1 ].set( this.min.x, this.min.y, this.max.z ).applyMatrix4( matrix ); // 001
			points[ 2 ].set( this.min.x, this.max.y, this.min.z ).applyMatrix4( matrix ); // 010
			points[ 3 ].set( this.min.x, this.max.y, this.max.z ).applyMatrix4( matrix ); // 011
			points[ 4 ].set( this.max.x, this.min.y, this.min.z ).applyMatrix4( matrix ); // 100
			points[ 5 ].set( this.max.x, this.min.y, this.max.z ).applyMatrix4( matrix ); // 101
			points[ 6 ].set( this.max.x, this.max.y, this.min.z ).applyMatrix4( matrix ); // 110
			points[ 7 ].set( this.max.x, this.max.y, this.max.z ).applyMatrix4( matrix );  // 111

			this.makeEmpty();
			this.setFromPoints( points );

			return this;

		};

	}(),

	translate: function ( offset ) {

		this.min.add( offset );
		this.max.add( offset );

		return this;

	},

	equals: function ( box ) {

		return box.min.equals( this.min ) && box.max.equals( this.max );

	},

	clone: function () {

		return new THREE.Box3().copy( this );

	}

};

// File:src/math/Matrix3.js

/**
 * @author alteredq / http://alteredqualia.com/
 * @author WestLangley / http://github.com/WestLangley
 * @author bhouston / http://exocortex.com
 */

THREE.Matrix3 = function () {

	this.elements = new Float32Array( [

		1, 0, 0,
		0, 1, 0,
		0, 0, 1

	] );

	if ( arguments.length > 0 ) {

		console.error( 'THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.' );

	}

};

THREE.Matrix3.prototype = {

	constructor: THREE.Matrix3,

	set: function ( n11, n12, n13, n21, n22, n23, n31, n32, n33 ) {

		var te = this.elements;

		te[ 0 ] = n11; te[ 3 ] = n12; te[ 6 ] = n13;
		te[ 1 ] = n21; te[ 4 ] = n22; te[ 7 ] = n23;
		te[ 2 ] = n31; te[ 5 ] = n32; te[ 8 ] = n33;

		return this;

	},

	identity: function () {

		this.set(

			1, 0, 0,
			0, 1, 0,
			0, 0, 1

		);

		return this;

	},

	copy: function ( m ) {

		var me = m.elements;

		this.set(

			me[ 0 ], me[ 3 ], me[ 6 ],
			me[ 1 ], me[ 4 ], me[ 7 ],
			me[ 2 ], me[ 5 ], me[ 8 ]

		);

		return this;

	},

	multiplyVector3: function ( vector ) {

		console.warn( 'THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.' );
		return vector.applyMatrix3( this );

	},

	multiplyVector3Array: function ( a ) {

		console.warn( 'THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.' );
		return this.applyToVector3Array( a );

	},

	applyToVector3Array: function () {

		var v1 = new THREE.Vector3();

		return function ( array, offset, length ) {

			if ( offset === undefined ) offset = 0;
			if ( length === undefined ) length = array.length;

			for ( var i = 0, j = offset, il; i < length; i += 3, j += 3 ) {

				v1.x = array[ j ];
				v1.y = array[ j + 1 ];
				v1.z = array[ j + 2 ];

				v1.applyMatrix3( this );

				array[ j ]     = v1.x;
				array[ j + 1 ] = v1.y;
				array[ j + 2 ] = v1.z;

			}

			return array;

		};

	}(),

	multiplyScalar: function ( s ) {

		var te = this.elements;

		te[ 0 ] *= s; te[ 3 ] *= s; te[ 6 ] *= s;
		te[ 1 ] *= s; te[ 4 ] *= s; te[ 7 ] *= s;
		te[ 2 ] *= s; te[ 5 ] *= s; te[ 8 ] *= s;

		return this;

	},

	determinant: function () {

		var te = this.elements;

		var a = te[ 0 ], b = te[ 1 ], c = te[ 2 ],
			d = te[ 3 ], e = te[ 4 ], f = te[ 5 ],
			g = te[ 6 ], h = te[ 7 ], i = te[ 8 ];

		return a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;

	},

	getInverse: function ( matrix, throwOnInvertible ) {

		// input: THREE.Matrix4
		// ( based on http://code.google.com/p/webgl-mjs/ )

		var me = matrix.elements;
		var te = this.elements;

		te[ 0 ] =   me[ 10 ] * me[ 5 ] - me[ 6 ] * me[ 9 ];
		te[ 1 ] = - me[ 10 ] * me[ 1 ] + me[ 2 ] * me[ 9 ];
		te[ 2 ] =   me[ 6 ] * me[ 1 ] - me[ 2 ] * me[ 5 ];
		te[ 3 ] = - me[ 10 ] * me[ 4 ] + me[ 6 ] * me[ 8 ];
		te[ 4 ] =   me[ 10 ] * me[ 0 ] - me[ 2 ] * me[ 8 ];
		te[ 5 ] = - me[ 6 ] * me[ 0 ] + me[ 2 ] * me[ 4 ];
		te[ 6 ] =   me[ 9 ] * me[ 4 ] - me[ 5 ] * me[ 8 ];
		te[ 7 ] = - me[ 9 ] * me[ 0 ] + me[ 1 ] * me[ 8 ];
		te[ 8 ] =   me[ 5 ] * me[ 0 ] - me[ 1 ] * me[ 4 ];

		var det = me[ 0 ] * te[ 0 ] + me[ 1 ] * te[ 3 ] + me[ 2 ] * te[ 6 ];

		// no inverse

		if ( det === 0 ) {

			var msg = "Matrix3.getInverse(): can't invert matrix, determinant is 0";

			if ( throwOnInvertible || false ) {

				throw new Error( msg );

			} else {

				console.warn( msg );

			}

			this.identity();

			return this;

		}

		this.multiplyScalar( 1.0 / det );

		return this;

	},

	transpose: function () {

		var tmp, m = this.elements;

		tmp = m[ 1 ]; m[ 1 ] = m[ 3 ]; m[ 3 ] = tmp;
		tmp = m[ 2 ]; m[ 2 ] = m[ 6 ]; m[ 6 ] = tmp;
		tmp = m[ 5 ]; m[ 5 ] = m[ 7 ]; m[ 7 ] = tmp;

		return this;

	},

	flattenToArrayOffset: function ( array, offset ) {

		var te = this.elements;

		array[ offset     ] = te[ 0 ];
		array[ offset + 1 ] = te[ 1 ];
		array[ offset + 2 ] = te[ 2 ];

		array[ offset + 3 ] = te[ 3 ];
		array[ offset + 4 ] = te[ 4 ];
		array[ offset + 5 ] = te[ 5 ];

		array[ offset + 6 ] = te[ 6 ];
		array[ offset + 7 ] = te[ 7 ];
		array[ offset + 8 ]  = te[ 8 ];

		return array;

	},

	getNormalMatrix: function ( m ) {

		// input: THREE.Matrix4

		this.getInverse( m ).transpose();

		return this;

	},

	transposeIntoArray: function ( r ) {

		var m = this.elements;

		r[ 0 ] = m[ 0 ];
		r[ 1 ] = m[ 3 ];
		r[ 2 ] = m[ 6 ];
		r[ 3 ] = m[ 1 ];
		r[ 4 ] = m[ 4 ];
		r[ 5 ] = m[ 7 ];
		r[ 6 ] = m[ 2 ];
		r[ 7 ] = m[ 5 ];
		r[ 8 ] = m[ 8 ];

		return this;

	},

	fromArray: function ( array ) {

		this.elements.set( array );

		return this;

	},

	toArray: function () {

		var te = this.elements;

		return [
			te[ 0 ], te[ 1 ], te[ 2 ],
			te[ 3 ], te[ 4 ], te[ 5 ],
			te[ 6 ], te[ 7 ], te[ 8 ]
		];

	},

	clone: function () {

		return new THREE.Matrix3().fromArray( this.elements );

	}

};

// File:src/math/Matrix4.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author supereggbert / http://www.paulbrunt.co.uk/
 * @author philogb / http://blog.thejit.org/
 * @author jordi_ros / http://plattsoft.com
 * @author D1plo1d / http://github.com/D1plo1d
 * @author alteredq / http://alteredqualia.com/
 * @author mikael emtinger / http://gomo.se/
 * @author timknip / http://www.floorplanner.com/
 * @author bhouston / http://exocortex.com
 * @author WestLangley / http://github.com/WestLangley
 */

THREE.Matrix4 = function () {

	this.elements = new Float32Array( [

		1, 0, 0, 0,
		0, 1, 0, 0,
		0, 0, 1, 0,
		0, 0, 0, 1

	] );

	if ( arguments.length > 0 ) {

		console.error( 'THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.' );

	}

};

THREE.Matrix4.prototype = {

	constructor: THREE.Matrix4,

	set: function ( n11, n12, n13, n14, n21, n22, n23, n24, n31, n32, n33, n34, n41, n42, n43, n44 ) {

		var te = this.elements;

		te[ 0 ] = n11; te[ 4 ] = n12; te[ 8 ] = n13; te[ 12 ] = n14;
		te[ 1 ] = n21; te[ 5 ] = n22; te[ 9 ] = n23; te[ 13 ] = n24;
		te[ 2 ] = n31; te[ 6 ] = n32; te[ 10 ] = n33; te[ 14 ] = n34;
		te[ 3 ] = n41; te[ 7 ] = n42; te[ 11 ] = n43; te[ 15 ] = n44;

		return this;

	},

	identity: function () {

		this.set(

			1, 0, 0, 0,
			0, 1, 0, 0,
			0, 0, 1, 0,
			0, 0, 0, 1

		);

		return this;

	},

	copy: function ( m ) {

		this.elements.set( m.elements );

		return this;

	},

	extractPosition: function ( m ) {

		console.warn( 'THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().' );
		return this.copyPosition( m );

	},

	copyPosition: function ( m ) {

		var te = this.elements;
		var me = m.elements;

		te[ 12 ] = me[ 12 ];
		te[ 13 ] = me[ 13 ];
		te[ 14 ] = me[ 14 ];

		return this;

	},

	extractRotation: function () {

		var v1 = new THREE.Vector3();

		return function ( m ) {

			var te = this.elements;
			var me = m.elements;

			var scaleX = 1 / v1.set( me[ 0 ], me[ 1 ], me[ 2 ] ).length();
			var scaleY = 1 / v1.set( me[ 4 ], me[ 5 ], me[ 6 ] ).length();
			var scaleZ = 1 / v1.set( me[ 8 ], me[ 9 ], me[ 10 ] ).length();

			te[ 0 ] = me[ 0 ] * scaleX;
			te[ 1 ] = me[ 1 ] * scaleX;
			te[ 2 ] = me[ 2 ] * scaleX;

			te[ 4 ] = me[ 4 ] * scaleY;
			te[ 5 ] = me[ 5 ] * scaleY;
			te[ 6 ] = me[ 6 ] * scaleY;

			te[ 8 ] = me[ 8 ] * scaleZ;
			te[ 9 ] = me[ 9 ] * scaleZ;
			te[ 10 ] = me[ 10 ] * scaleZ;

			return this;

		};

	}(),

	makeRotationFromEuler: function ( euler ) {

		if ( euler instanceof THREE.Euler === false ) {

			console.error( 'THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.' );

		}

		var te = this.elements;

		var x = euler.x, y = euler.y, z = euler.z;
		var a = Math.cos( x ), b = Math.sin( x );
		var c = Math.cos( y ), d = Math.sin( y );
		var e = Math.cos( z ), f = Math.sin( z );

		if ( euler.order === 'XYZ' ) {

			var ae = a * e, af = a * f, be = b * e, bf = b * f;

			te[ 0 ] = c * e;
			te[ 4 ] = - c * f;
			te[ 8 ] = d;

			te[ 1 ] = af + be * d;
			te[ 5 ] = ae - bf * d;
			te[ 9 ] = - b * c;

			te[ 2 ] = bf - ae * d;
			te[ 6 ] = be + af * d;
			te[ 10 ] = a * c;

		} else if ( euler.order === 'YXZ' ) {

			var ce = c * e, cf = c * f, de = d * e, df = d * f;

			te[ 0 ] = ce + df * b;
			te[ 4 ] = de * b - cf;
			te[ 8 ] = a * d;

			te[ 1 ] = a * f;
			te[ 5 ] = a * e;
			te[ 9 ] = - b;

			te[ 2 ] = cf * b - de;
			te[ 6 ] = df + ce * b;
			te[ 10 ] = a * c;

		} else if ( euler.order === 'ZXY' ) {

			var ce = c * e, cf = c * f, de = d * e, df = d * f;

			te[ 0 ] = ce - df * b;
			te[ 4 ] = - a * f;
			te[ 8 ] = de + cf * b;

			te[ 1 ] = cf + de * b;
			te[ 5 ] = a * e;
			te[ 9 ] = df - ce * b;

			te[ 2 ] = - a * d;
			te[ 6 ] = b;
			te[ 10 ] = a * c;

		} else if ( euler.order === 'ZYX' ) {

			var ae = a * e, af = a * f, be = b * e, bf = b * f;

			te[ 0 ] = c * e;
			te[ 4 ] = be * d - af;
			te[ 8 ] = ae * d + bf;

			te[ 1 ] = c * f;
			te[ 5 ] = bf * d + ae;
			te[ 9 ] = af * d - be;

			te[ 2 ] = - d;
			te[ 6 ] = b * c;
			te[ 10 ] = a * c;

		} else if ( euler.order === 'YZX' ) {

			var ac = a * c, ad = a * d, bc = b * c, bd = b * d;

			te[ 0 ] = c * e;
			te[ 4 ] = bd - ac * f;
			te[ 8 ] = bc * f + ad;

			te[ 1 ] = f;
			te[ 5 ] = a * e;
			te[ 9 ] = - b * e;

			te[ 2 ] = - d * e;
			te[ 6 ] = ad * f + bc;
			te[ 10 ] = ac - bd * f;

		} else if ( euler.order === 'XZY' ) {

			var ac = a * c, ad = a * d, bc = b * c, bd = b * d;

			te[ 0 ] = c * e;
			te[ 4 ] = - f;
			te[ 8 ] = d * e;

			te[ 1 ] = ac * f + bd;
			te[ 5 ] = a * e;
			te[ 9 ] = ad * f - bc;

			te[ 2 ] = bc * f - ad;
			te[ 6 ] = b * e;
			te[ 10 ] = bd * f + ac;

		}

		// last column
		te[ 3 ] = 0;
		te[ 7 ] = 0;
		te[ 11 ] = 0;

		// bottom row
		te[ 12 ] = 0;
		te[ 13 ] = 0;
		te[ 14 ] = 0;
		te[ 15 ] = 1;

		return this;

	},

	setRotationFromQuaternion: function ( q ) {

		console.warn( 'THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().' );

		return this.makeRotationFromQuaternion( q );

	},

	makeRotationFromQuaternion: function ( q ) {

		var te = this.elements;

		var x = q.x, y = q.y, z = q.z, w = q.w;
		var x2 = x + x, y2 = y + y, z2 = z + z;
		var xx = x * x2, xy = x * y2, xz = x * z2;
		var yy = y * y2, yz = y * z2, zz = z * z2;
		var wx = w * x2, wy = w * y2, wz = w * z2;

		te[ 0 ] = 1 - ( yy + zz );
		te[ 4 ] = xy - wz;
		te[ 8 ] = xz + wy;

		te[ 1 ] = xy + wz;
		te[ 5 ] = 1 - ( xx + zz );
		te[ 9 ] = yz - wx;

		te[ 2 ] = xz - wy;
		te[ 6 ] = yz + wx;
		te[ 10 ] = 1 - ( xx + yy );

		// last column
		te[ 3 ] = 0;
		te[ 7 ] = 0;
		te[ 11 ] = 0;

		// bottom row
		te[ 12 ] = 0;
		te[ 13 ] = 0;
		te[ 14 ] = 0;
		te[ 15 ] = 1;

		return this;

	},

	lookAt: function () {

		var x = new THREE.Vector3();
		var y = new THREE.Vector3();
		var z = new THREE.Vector3();

		return function ( eye, target, up ) {

			var te = this.elements;

			z.subVectors( eye, target ).normalize();

			if ( z.length() === 0 ) {

				z.z = 1;

			}

			x.crossVectors( up, z ).normalize();

			if ( x.length() === 0 ) {

				z.x += 0.0001;
				x.crossVectors( up, z ).normalize();

			}

			y.crossVectors( z, x );


			te[ 0 ] = x.x; te[ 4 ] = y.x; te[ 8 ] = z.x;
			te[ 1 ] = x.y; te[ 5 ] = y.y; te[ 9 ] = z.y;
			te[ 2 ] = x.z; te[ 6 ] = y.z; te[ 10 ] = z.z;

			return this;

		};

	}(),

	multiply: function ( m, n ) {

		if ( n !== undefined ) {

			console.warn( 'THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.' );
			return this.multiplyMatrices( m, n );

		}

		return this.multiplyMatrices( this, m );

	},

	multiplyMatrices: function ( a, b ) {

		var ae = a.elements;
		var be = b.elements;
		var te = this.elements;

		var a11 = ae[ 0 ], a12 = ae[ 4 ], a13 = ae[ 8 ], a14 = ae[ 12 ];
		var a21 = ae[ 1 ], a22 = ae[ 5 ], a23 = ae[ 9 ], a24 = ae[ 13 ];
		var a31 = ae[ 2 ], a32 = ae[ 6 ], a33 = ae[ 10 ], a34 = ae[ 14 ];
		var a41 = ae[ 3 ], a42 = ae[ 7 ], a43 = ae[ 11 ], a44 = ae[ 15 ];

		var b11 = be[ 0 ], b12 = be[ 4 ], b13 = be[ 8 ], b14 = be[ 12 ];
		var b21 = be[ 1 ], b22 = be[ 5 ], b23 = be[ 9 ], b24 = be[ 13 ];
		var b31 = be[ 2 ], b32 = be[ 6 ], b33 = be[ 10 ], b34 = be[ 14 ];
		var b41 = be[ 3 ], b42 = be[ 7 ], b43 = be[ 11 ], b44 = be[ 15 ];

		te[ 0 ] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;
		te[ 4 ] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;
		te[ 8 ] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;
		te[ 12 ] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;

		te[ 1 ] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;
		te[ 5 ] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;
		te[ 9 ] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;
		te[ 13 ] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;

		te[ 2 ] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;
		te[ 6 ] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;
		te[ 10 ] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;
		te[ 14 ] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;

		te[ 3 ] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;
		te[ 7 ] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;
		te[ 11 ] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;
		te[ 15 ] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;

		return this;

	},

	multiplyToArray: function ( a, b, r ) {

		var te = this.elements;

		this.multiplyMatrices( a, b );

		r[ 0 ] = te[ 0 ]; r[ 1 ] = te[ 1 ]; r[ 2 ] = te[ 2 ]; r[ 3 ] = te[ 3 ];
		r[ 4 ] = te[ 4 ]; r[ 5 ] = te[ 5 ]; r[ 6 ] = te[ 6 ]; r[ 7 ] = te[ 7 ];
		r[ 8 ]  = te[ 8 ]; r[ 9 ]  = te[ 9 ]; r[ 10 ] = te[ 10 ]; r[ 11 ] = te[ 11 ];
		r[ 12 ] = te[ 12 ]; r[ 13 ] = te[ 13 ]; r[ 14 ] = te[ 14 ]; r[ 15 ] = te[ 15 ];

		return this;

	},

	multiplyScalar: function ( s ) {

		var te = this.elements;

		te[ 0 ] *= s; te[ 4 ] *= s; te[ 8 ] *= s; te[ 12 ] *= s;
		te[ 1 ] *= s; te[ 5 ] *= s; te[ 9 ] *= s; te[ 13 ] *= s;
		te[ 2 ] *= s; te[ 6 ] *= s; te[ 10 ] *= s; te[ 14 ] *= s;
		te[ 3 ] *= s; te[ 7 ] *= s; te[ 11 ] *= s; te[ 15 ] *= s;

		return this;

	},

	multiplyVector3: function ( vector ) {

		console.warn( 'THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.' );
		return vector.applyProjection( this );

	},

	multiplyVector4: function ( vector ) {

		console.warn( 'THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.' );
		return vector.applyMatrix4( this );

	},

	multiplyVector3Array: function ( a ) {

		console.warn( 'THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.' );
		return this.applyToVector3Array( a );

	},

	applyToVector3Array: function () {

		var v1 = new THREE.Vector3();

		return function ( array, offset, length ) {

			if ( offset === undefined ) offset = 0;
			if ( length === undefined ) length = array.length;

			for ( var i = 0, j = offset, il; i < length; i += 3, j += 3 ) {

				v1.x = array[ j ];
				v1.y = array[ j + 1 ];
				v1.z = array[ j + 2 ];

				v1.applyMatrix4( this );

				array[ j ]     = v1.x;
				array[ j + 1 ] = v1.y;
				array[ j + 2 ] = v1.z;

			}

			return array;

		};

	}(),

	rotateAxis: function ( v ) {

		console.warn( 'THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.' );

		v.transformDirection( this );

	},

	crossVector: function ( vector ) {

		console.warn( 'THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.' );
		return vector.applyMatrix4( this );

	},

	determinant: function () {

		var te = this.elements;

		var n11 = te[ 0 ], n12 = te[ 4 ], n13 = te[ 8 ], n14 = te[ 12 ];
		var n21 = te[ 1 ], n22 = te[ 5 ], n23 = te[ 9 ], n24 = te[ 13 ];
		var n31 = te[ 2 ], n32 = te[ 6 ], n33 = te[ 10 ], n34 = te[ 14 ];
		var n41 = te[ 3 ], n42 = te[ 7 ], n43 = te[ 11 ], n44 = te[ 15 ];

		//TODO: make this more efficient
		//( based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm )

		return (
			n41 * (
				+ n14 * n23 * n32
				 - n13 * n24 * n32
				 - n14 * n22 * n33
				 + n12 * n24 * n33
				 + n13 * n22 * n34
				 - n12 * n23 * n34
			) +
			n42 * (
				+ n11 * n23 * n34
				 - n11 * n24 * n33
				 + n14 * n21 * n33
				 - n13 * n21 * n34
				 + n13 * n24 * n31
				 - n14 * n23 * n31
			) +
			n43 * (
				+ n11 * n24 * n32
				 - n11 * n22 * n34
				 - n14 * n21 * n32
				 + n12 * n21 * n34
				 + n14 * n22 * n31
				 - n12 * n24 * n31
			) +
			n44 * (
				- n13 * n22 * n31
				 - n11 * n23 * n32
				 + n11 * n22 * n33
				 + n13 * n21 * n32
				 - n12 * n21 * n33
				 + n12 * n23 * n31
			)

		);

	},

	transpose: function () {

		var te = this.elements;
		var tmp;

		tmp = te[ 1 ]; te[ 1 ] = te[ 4 ]; te[ 4 ] = tmp;
		tmp = te[ 2 ]; te[ 2 ] = te[ 8 ]; te[ 8 ] = tmp;
		tmp = te[ 6 ]; te[ 6 ] = te[ 9 ]; te[ 9 ] = tmp;

		tmp = te[ 3 ]; te[ 3 ] = te[ 12 ]; te[ 12 ] = tmp;
		tmp = te[ 7 ]; te[ 7 ] = te[ 13 ]; te[ 13 ] = tmp;
		tmp = te[ 11 ]; te[ 11 ] = te[ 14 ]; te[ 14 ] = tmp;

		return this;

	},

	flattenToArrayOffset: function ( array, offset ) {

		var te = this.elements;

		array[ offset     ] = te[ 0 ];
		array[ offset + 1 ] = te[ 1 ];
		array[ offset + 2 ] = te[ 2 ];
		array[ offset + 3 ] = te[ 3 ];

		array[ offset + 4 ] = te[ 4 ];
		array[ offset + 5 ] = te[ 5 ];
		array[ offset + 6 ] = te[ 6 ];
		array[ offset + 7 ] = te[ 7 ];

		array[ offset + 8 ]  = te[ 8 ];
		array[ offset + 9 ]  = te[ 9 ];
		array[ offset + 10 ] = te[ 10 ];
		array[ offset + 11 ] = te[ 11 ];

		array[ offset + 12 ] = te[ 12 ];
		array[ offset + 13 ] = te[ 13 ];
		array[ offset + 14 ] = te[ 14 ];
		array[ offset + 15 ] = te[ 15 ];

		return array;

	},

	getPosition: function () {

		var v1 = new THREE.Vector3();

		return function () {

			console.warn( 'THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.' );

			var te = this.elements;
			return v1.set( te[ 12 ], te[ 13 ], te[ 14 ] );

		};

	}(),

	setPosition: function ( v ) {

		var te = this.elements;

		te[ 12 ] = v.x;
		te[ 13 ] = v.y;
		te[ 14 ] = v.z;

		return this;

	},

	getInverse: function ( m, throwOnInvertible ) {

		// based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm
		var te = this.elements;
		var me = m.elements;

		var n11 = me[ 0 ], n12 = me[ 4 ], n13 = me[ 8 ], n14 = me[ 12 ];
		var n21 = me[ 1 ], n22 = me[ 5 ], n23 = me[ 9 ], n24 = me[ 13 ];
		var n31 = me[ 2 ], n32 = me[ 6 ], n33 = me[ 10 ], n34 = me[ 14 ];
		var n41 = me[ 3 ], n42 = me[ 7 ], n43 = me[ 11 ], n44 = me[ 15 ];

		te[ 0 ] = n23 * n34 * n42 - n24 * n33 * n42 + n24 * n32 * n43 - n22 * n34 * n43 - n23 * n32 * n44 + n22 * n33 * n44;
		te[ 4 ] = n14 * n33 * n42 - n13 * n34 * n42 - n14 * n32 * n43 + n12 * n34 * n43 + n13 * n32 * n44 - n12 * n33 * n44;
		te[ 8 ] = n13 * n24 * n42 - n14 * n23 * n42 + n14 * n22 * n43 - n12 * n24 * n43 - n13 * n22 * n44 + n12 * n23 * n44;
		te[ 12 ] = n14 * n23 * n32 - n13 * n24 * n32 - n14 * n22 * n33 + n12 * n24 * n33 + n13 * n22 * n34 - n12 * n23 * n34;
		te[ 1 ] = n24 * n33 * n41 - n23 * n34 * n41 - n24 * n31 * n43 + n21 * n34 * n43 + n23 * n31 * n44 - n21 * n33 * n44;
		te[ 5 ] = n13 * n34 * n41 - n14 * n33 * n41 + n14 * n31 * n43 - n11 * n34 * n43 - n13 * n31 * n44 + n11 * n33 * n44;
		te[ 9 ] = n14 * n23 * n41 - n13 * n24 * n41 - n14 * n21 * n43 + n11 * n24 * n43 + n13 * n21 * n44 - n11 * n23 * n44;
		te[ 13 ] = n13 * n24 * n31 - n14 * n23 * n31 + n14 * n21 * n33 - n11 * n24 * n33 - n13 * n21 * n34 + n11 * n23 * n34;
		te[ 2 ] = n22 * n34 * n41 - n24 * n32 * n41 + n24 * n31 * n42 - n21 * n34 * n42 - n22 * n31 * n44 + n21 * n32 * n44;
		te[ 6 ] = n14 * n32 * n41 - n12 * n34 * n41 - n14 * n31 * n42 + n11 * n34 * n42 + n12 * n31 * n44 - n11 * n32 * n44;
		te[ 10 ] = n12 * n24 * n41 - n14 * n22 * n41 + n14 * n21 * n42 - n11 * n24 * n42 - n12 * n21 * n44 + n11 * n22 * n44;
		te[ 14 ] = n14 * n22 * n31 - n12 * n24 * n31 - n14 * n21 * n32 + n11 * n24 * n32 + n12 * n21 * n34 - n11 * n22 * n34;
		te[ 3 ] = n23 * n32 * n41 - n22 * n33 * n41 - n23 * n31 * n42 + n21 * n33 * n42 + n22 * n31 * n43 - n21 * n32 * n43;
		te[ 7 ] = n12 * n33 * n41 - n13 * n32 * n41 + n13 * n31 * n42 - n11 * n33 * n42 - n12 * n31 * n43 + n11 * n32 * n43;
		te[ 11 ] = n13 * n22 * n41 - n12 * n23 * n41 - n13 * n21 * n42 + n11 * n23 * n42 + n12 * n21 * n43 - n11 * n22 * n43;
		te[ 15 ] = n12 * n23 * n31 - n13 * n22 * n31 + n13 * n21 * n32 - n11 * n23 * n32 - n12 * n21 * n33 + n11 * n22 * n33;

		var det = n11 * te[ 0 ] + n21 * te[ 4 ] + n31 * te[ 8 ] + n41 * te[ 12 ];

		if ( det == 0 ) {

			var msg = "Matrix4.getInverse(): can't invert matrix, determinant is 0";

			if ( throwOnInvertible || false ) {

				throw new Error( msg );

			} else {

				console.warn( msg );

			}

			this.identity();

			return this;
		}

		this.multiplyScalar( 1 / det );

		return this;

	},

	translate: function ( v ) {

		console.warn( 'THREE.Matrix4: .translate() has been removed.' );

	},

	rotateX: function ( angle ) {

		console.warn( 'THREE.Matrix4: .rotateX() has been removed.' );

	},

	rotateY: function ( angle ) {

		console.warn( 'THREE.Matrix4: .rotateY() has been removed.' );

	},

	rotateZ: function ( angle ) {

		console.warn( 'THREE.Matrix4: .rotateZ() has been removed.' );

	},

	rotateByAxis: function ( axis, angle ) {

		console.warn( 'THREE.Matrix4: .rotateByAxis() has been removed.' );

	},

	scale: function ( v ) {

		var te = this.elements;
		var x = v.x, y = v.y, z = v.z;

		te[ 0 ] *= x; te[ 4 ] *= y; te[ 8 ] *= z;
		te[ 1 ] *= x; te[ 5 ] *= y; te[ 9 ] *= z;
		te[ 2 ] *= x; te[ 6 ] *= y; te[ 10 ] *= z;
		te[ 3 ] *= x; te[ 7 ] *= y; te[ 11 ] *= z;

		return this;

	},

	getMaxScaleOnAxis: function () {

		var te = this.elements;

		var scaleXSq = te[ 0 ] * te[ 0 ] + te[ 1 ] * te[ 1 ] + te[ 2 ] * te[ 2 ];
		var scaleYSq = te[ 4 ] * te[ 4 ] + te[ 5 ] * te[ 5 ] + te[ 6 ] * te[ 6 ];
		var scaleZSq = te[ 8 ] * te[ 8 ] + te[ 9 ] * te[ 9 ] + te[ 10 ] * te[ 10 ];

		return Math.sqrt( Math.max( scaleXSq, Math.max( scaleYSq, scaleZSq ) ) );

	},

	makeTranslation: function ( x, y, z ) {

		this.set(

			1, 0, 0, x,
			0, 1, 0, y,
			0, 0, 1, z,
			0, 0, 0, 1

		);

		return this;

	},

	makeRotationX: function ( theta ) {

		var c = Math.cos( theta ), s = Math.sin( theta );

		this.set(

			1, 0,  0, 0,
			0, c, - s, 0,
			0, s,  c, 0,
			0, 0,  0, 1

		);

		return this;

	},

	makeRotationY: function ( theta ) {

		var c = Math.cos( theta ), s = Math.sin( theta );

		this.set(

			 c, 0, s, 0,
			 0, 1, 0, 0,
			- s, 0, c, 0,
			 0, 0, 0, 1

		);

		return this;

	},

	makeRotationZ: function ( theta ) {

		var c = Math.cos( theta ), s = Math.sin( theta );

		this.set(

			c, - s, 0, 0,
			s,  c, 0, 0,
			0,  0, 1, 0,
			0,  0, 0, 1

		);

		return this;

	},

	makeRotationAxis: function ( axis, angle ) {

		// Based on http://www.gamedev.net/reference/articles/article1199.asp

		var c = Math.cos( angle );
		var s = Math.sin( angle );
		var t = 1 - c;
		var x = axis.x, y = axis.y, z = axis.z;
		var tx = t * x, ty = t * y;

		this.set(

			tx * x + c, tx * y - s * z, tx * z + s * y, 0,
			tx * y + s * z, ty * y + c, ty * z - s * x, 0,
			tx * z - s * y, ty * z + s * x, t * z * z + c, 0,
			0, 0, 0, 1

		);

		 return this;

	},

	makeScale: function ( x, y, z ) {

		this.set(

			x, 0, 0, 0,
			0, y, 0, 0,
			0, 0, z, 0,
			0, 0, 0, 1

		);

		return this;

	},

	compose: function ( position, quaternion, scale ) {

		this.makeRotationFromQuaternion( quaternion );
		this.scale( scale );
		this.setPosition( position );

		return this;

	},

	decompose: function () {

		var vector = new THREE.Vector3();
		var matrix = new THREE.Matrix4();

		return function ( position, quaternion, scale ) {

			var te = this.elements;

			var sx = vector.set( te[ 0 ], te[ 1 ], te[ 2 ] ).length();
			var sy = vector.set( te[ 4 ], te[ 5 ], te[ 6 ] ).length();
			var sz = vector.set( te[ 8 ], te[ 9 ], te[ 10 ] ).length();

			// if determine is negative, we need to invert one scale
			var det = this.determinant();
			if ( det < 0 ) {
				sx = - sx;
			}

			position.x = te[ 12 ];
			position.y = te[ 13 ];
			position.z = te[ 14 ];

			// scale the rotation part

			matrix.elements.set( this.elements ); // at this point matrix is incomplete so we can't use .copy()

			var invSX = 1 / sx;
			var invSY = 1 / sy;
			var invSZ = 1 / sz;

			matrix.elements[ 0 ] *= invSX;
			matrix.elements[ 1 ] *= invSX;
			matrix.elements[ 2 ] *= invSX;

			matrix.elements[ 4 ] *= invSY;
			matrix.elements[ 5 ] *= invSY;
			matrix.elements[ 6 ] *= invSY;

			matrix.elements[ 8 ] *= invSZ;
			matrix.elements[ 9 ] *= invSZ;
			matrix.elements[ 10 ] *= invSZ;

			quaternion.setFromRotationMatrix( matrix );

			scale.x = sx;
			scale.y = sy;
			scale.z = sz;

			return this;

		};

	}(),

	makeFrustum: function ( left, right, bottom, top, near, far ) {

		var te = this.elements;
		var x = 2 * near / ( right - left );
		var y = 2 * near / ( top - bottom );

		var a = ( right + left ) / ( right - left );
		var b = ( top + bottom ) / ( top - bottom );
		var c = - ( far + near ) / ( far - near );
		var d = - 2 * far * near / ( far - near );

		te[ 0 ] = x;	te[ 4 ] = 0;	te[ 8 ] = a;	te[ 12 ] = 0;
		te[ 1 ] = 0;	te[ 5 ] = y;	te[ 9 ] = b;	te[ 13 ] = 0;
		te[ 2 ] = 0;	te[ 6 ] = 0;	te[ 10 ] = c;	te[ 14 ] = d;
		te[ 3 ] = 0;	te[ 7 ] = 0;	te[ 11 ] = - 1;	te[ 15 ] = 0;

		return this;

	},

	makePerspective: function ( fov, aspect, near, far ) {

		var ymax = near * Math.tan( THREE.Math.degToRad( fov * 0.5 ) );
		var ymin = - ymax;
		var xmin = ymin * aspect;
		var xmax = ymax * aspect;

		return this.makeFrustum( xmin, xmax, ymin, ymax, near, far );

	},

	makeOrthographic: function ( left, right, top, bottom, near, far ) {

		var te = this.elements;
		var w = right - left;
		var h = top - bottom;
		var p = far - near;

		var x = ( right + left ) / w;
		var y = ( top + bottom ) / h;
		var z = ( far + near ) / p;

		te[ 0 ] = 2 / w;	te[ 4 ] = 0;	te[ 8 ] = 0;	te[ 12 ] = - x;
		te[ 1 ] = 0;	te[ 5 ] = 2 / h;	te[ 9 ] = 0;	te[ 13 ] = - y;
		te[ 2 ] = 0;	te[ 6 ] = 0;	te[ 10 ] = - 2 / p;	te[ 14 ] = - z;
		te[ 3 ] = 0;	te[ 7 ] = 0;	te[ 11 ] = 0;	te[ 15 ] = 1;

		return this;

	},

	fromArray: function ( array ) {

		this.elements.set( array );

		return this;

	},

	toArray: function () {

		var te = this.elements;

		return [
			te[ 0 ], te[ 1 ], te[ 2 ], te[ 3 ],
			te[ 4 ], te[ 5 ], te[ 6 ], te[ 7 ],
			te[ 8 ], te[ 9 ], te[ 10 ], te[ 11 ],
			te[ 12 ], te[ 13 ], te[ 14 ], te[ 15 ]
		];

	},

	clone: function () {

		return new THREE.Matrix4().fromArray( this.elements );

	}

};

// File:src/math/Ray.js

/**
 * @author bhouston / http://exocortex.com
 */

THREE.Ray = function ( origin, direction ) {

	this.origin = ( origin !== undefined ) ? origin : new THREE.Vector3();
	this.direction = ( direction !== undefined ) ? direction : new THREE.Vector3();

};

THREE.Ray.prototype = {

	constructor: THREE.Ray,

	set: function ( origin, direction ) {

		this.origin.copy( origin );
		this.direction.copy( direction );

		return this;

	},

	copy: function ( ray ) {

		this.origin.copy( ray.origin );
		this.direction.copy( ray.direction );

		return this;

	},

	at: function ( t, optionalTarget ) {

		var result = optionalTarget || new THREE.Vector3();

		return result.copy( this.direction ).multiplyScalar( t ).add( this.origin );

	},

	recast: function () {

		var v1 = new THREE.Vector3();

		return function ( t ) {

			this.origin.copy( this.at( t, v1 ) );

			return this;

		};

	}(),

	closestPointToPoint: function ( point, optionalTarget ) {

		var result = optionalTarget || new THREE.Vector3();
		result.subVectors( point, this.origin );
		var directionDistance = result.dot( this.direction );

		if ( directionDistance < 0 ) {

			return result.copy( this.origin );

		}

		return result.copy( this.direction ).multiplyScalar( directionDistance ).add( this.origin );

	},

	distanceToPoint: function () {

		var v1 = new THREE.Vector3();

		return function ( point ) {

			var directionDistance = v1.subVectors( point, this.origin ).dot( this.direction );

			// point behind the ray

			if ( directionDistance < 0 ) {

				return this.origin.distanceTo( point );

			}

			v1.copy( this.direction ).multiplyScalar( directionDistance ).add( this.origin );

			return v1.distanceTo( point );

		};

	}(),

	distanceSqToSegment: function ( v0, v1, optionalPointOnRay, optionalPointOnSegment ) {

		// from http://www.geometrictools.com/LibMathematics/Distance/Wm5DistRay3Segment3.cpp
		// It returns the min distance between the ray and the segment
		// defined by v0 and v1
		// It can also set two optional targets :
		// - The closest point on the ray
		// - The closest point on the segment

		var segCenter = v0.clone().add( v1 ).multiplyScalar( 0.5 );
		var segDir = v1.clone().sub( v0 ).normalize();
		var segExtent = v0.distanceTo( v1 ) * 0.5;
		var diff = this.origin.clone().sub( segCenter );
		var a01 = - this.direction.dot( segDir );
		var b0 = diff.dot( this.direction );
		var b1 = - diff.dot( segDir );
		var c = diff.lengthSq();
		var det = Math.abs( 1 - a01 * a01 );
		var s0, s1, sqrDist, extDet;

		if ( det >= 0 ) {

			// The ray and segment are not parallel.

			s0 = a01 * b1 - b0;
			s1 = a01 * b0 - b1;
			extDet = segExtent * det;

			if ( s0 >= 0 ) {

				if ( s1 >= - extDet ) {

					if ( s1 <= extDet ) {

						// region 0
						// Minimum at interior points of ray and segment.

						var invDet = 1 / det;
						s0 *= invDet;
						s1 *= invDet;
						sqrDist = s0 * ( s0 + a01 * s1 + 2 * b0 ) + s1 * ( a01 * s0 + s1 + 2 * b1 ) + c;

					} else {

						// region 1

						s1 = segExtent;
						s0 = Math.max( 0, - ( a01 * s1 + b0 ) );
						sqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;

					}

				} else {

					// region 5

					s1 = - segExtent;
					s0 = Math.max( 0, - ( a01 * s1 + b0 ) );
					sqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;

				}

			} else {

				if ( s1 <= - extDet ) {

					// region 4

					s0 = Math.max( 0, - ( - a01 * segExtent + b0 ) );
					s1 = ( s0 > 0 ) ? - segExtent : Math.min( Math.max( - segExtent, - b1 ), segExtent );
					sqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;

				} else if ( s1 <= extDet ) {

					// region 3

					s0 = 0;
					s1 = Math.min( Math.max( - segExtent, - b1 ), segExtent );
					sqrDist = s1 * ( s1 + 2 * b1 ) + c;

				} else {

					// region 2

					s0 = Math.max( 0, - ( a01 * segExtent + b0 ) );
					s1 = ( s0 > 0 ) ? segExtent : Math.min( Math.max( - segExtent, - b1 ), segExtent );
					sqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;

				}

			}

		} else {

			// Ray and segment are parallel.

			s1 = ( a01 > 0 ) ? - segExtent : segExtent;
			s0 = Math.max( 0, - ( a01 * s1 + b0 ) );
			sqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;

		}

		if ( optionalPointOnRay ) {

			optionalPointOnRay.copy( this.direction.clone().multiplyScalar( s0 ).add( this.origin ) );

		}

		if ( optionalPointOnSegment ) {

			optionalPointOnSegment.copy( segDir.clone().multiplyScalar( s1 ).add( segCenter ) );

		}

		return sqrDist;

	},

	isIntersectionSphere: function ( sphere ) {

		return this.distanceToPoint( sphere.center ) <= sphere.radius;

	},

	intersectSphere: function () {

		// from http://www.scratchapixel.com/lessons/3d-basic-lessons/lesson-7-intersecting-simple-shapes/ray-sphere-intersection/

		var v1 = new THREE.Vector3();

		return function ( sphere, optionalTarget ) {

			v1.subVectors( sphere.center, this.origin );

			var tca = v1.dot( this.direction );

			var d2 = v1.dot( v1 ) - tca * tca;

			var radius2 = sphere.radius * sphere.radius;

			if ( d2 > radius2 ) return null;

			var thc = Math.sqrt( radius2 - d2 );

			// t0 = first intersect point - entrance on front of sphere
			var t0 = tca - thc;

			// t1 = second intersect point - exit point on back of sphere
			var t1 = tca + thc;

			// test to see if both t0 and t1 are behind the ray - if so, return null
			if ( t0 < 0 && t1 < 0 ) return null;

			// test to see if t0 is behind the ray:
			// if it is, the ray is inside the sphere, so return the second exit point scaled by t1,
			// in order to always return an intersect point that is in front of the ray.
			if ( t0 < 0 ) return this.at( t1, optionalTarget );

			// else t0 is in front of the ray, so return the first collision point scaled by t0 
			return this.at( t0, optionalTarget );

		}

	}(),

	isIntersectionPlane: function ( plane ) {

		// check if the ray lies on the plane first

		var distToPoint = plane.distanceToPoint( this.origin );

		if ( distToPoint === 0 ) {

			return true;

		}

		var denominator = plane.normal.dot( this.direction );

		if ( denominator * distToPoint < 0 ) {

			return true;

		}

		// ray origin is behind the plane (and is pointing behind it)

		return false;

	},

	distanceToPlane: function ( plane ) {

		var denominator = plane.normal.dot( this.direction );
		if ( denominator == 0 ) {

			// line is coplanar, return origin
			if ( plane.distanceToPoint( this.origin ) == 0 ) {

				return 0;

			}

			// Null is preferable to undefined since undefined means.... it is undefined

			return null;

		}

		var t = - ( this.origin.dot( plane.normal ) + plane.constant ) / denominator;

		// Return if the ray never intersects the plane

		return t >= 0 ? t :  null;

	},

	intersectPlane: function ( plane, optionalTarget ) {

		var t = this.distanceToPlane( plane );

		if ( t === null ) {

			return null;
		}

		return this.at( t, optionalTarget );

	},

	isIntersectionBox: function () {

		var v = new THREE.Vector3();

		return function ( box ) {

			return this.intersectBox( box, v ) !== null;

		};

	}(),

	intersectBox: function ( box , optionalTarget ) {

		// http://www.scratchapixel.com/lessons/3d-basic-lessons/lesson-7-intersecting-simple-shapes/ray-box-intersection/

		var tmin,tmax,tymin,tymax,tzmin,tzmax;

		var invdirx = 1 / this.direction.x,
			invdiry = 1 / this.direction.y,
			invdirz = 1 / this.direction.z;

		var origin = this.origin;

		if ( invdirx >= 0 ) {

			tmin = ( box.min.x - origin.x ) * invdirx;
			tmax = ( box.max.x - origin.x ) * invdirx;

		} else {

			tmin = ( box.max.x - origin.x ) * invdirx;
			tmax = ( box.min.x - origin.x ) * invdirx;
		}

		if ( invdiry >= 0 ) {

			tymin = ( box.min.y - origin.y ) * invdiry;
			tymax = ( box.max.y - origin.y ) * invdiry;

		} else {

			tymin = ( box.max.y - origin.y ) * invdiry;
			tymax = ( box.min.y - origin.y ) * invdiry;
		}

		if ( ( tmin > tymax ) || ( tymin > tmax ) ) return null;

		// These lines also handle the case where tmin or tmax is NaN
		// (result of 0 * Infinity). x !== x returns true if x is NaN

		if ( tymin > tmin || tmin !== tmin ) tmin = tymin;

		if ( tymax < tmax || tmax !== tmax ) tmax = tymax;

		if ( invdirz >= 0 ) {

			tzmin = ( box.min.z - origin.z ) * invdirz;
			tzmax = ( box.max.z - origin.z ) * invdirz;

		} else {

			tzmin = ( box.max.z - origin.z ) * invdirz;
			tzmax = ( box.min.z - origin.z ) * invdirz;
		}

		if ( ( tmin > tzmax ) || ( tzmin > tmax ) ) return null;

		if ( tzmin > tmin || tmin !== tmin ) tmin = tzmin;

		if ( tzmax < tmax || tmax !== tmax ) tmax = tzmax;

		//return point closest to the ray (positive side)

		if ( tmax < 0 ) return null;

		return this.at( tmin >= 0 ? tmin : tmax, optionalTarget );

	},

	intersectTriangle: function () {

		// Compute the offset origin, edges, and normal.
		var diff = new THREE.Vector3();
		var edge1 = new THREE.Vector3();
		var edge2 = new THREE.Vector3();
		var normal = new THREE.Vector3();

		return function ( a, b, c, backfaceCulling, optionalTarget ) {

			// from http://www.geometrictools.com/LibMathematics/Intersection/Wm5IntrRay3Triangle3.cpp

			edge1.subVectors( b, a );
			edge2.subVectors( c, a );
			normal.crossVectors( edge1, edge2 );

			// Solve Q + t*D = b1*E1 + b2*E2 (Q = kDiff, D = ray direction,
			// E1 = kEdge1, E2 = kEdge2, N = Cross(E1,E2)) by
			//   |Dot(D,N)|*b1 = sign(Dot(D,N))*Dot(D,Cross(Q,E2))
			//   |Dot(D,N)|*b2 = sign(Dot(D,N))*Dot(D,Cross(E1,Q))
			//   |Dot(D,N)|*t = -sign(Dot(D,N))*Dot(Q,N)
			var DdN = this.direction.dot( normal );
			var sign;

			if ( DdN > 0 ) {

				if ( backfaceCulling ) return null;
				sign = 1;

			} else if ( DdN < 0 ) {

				sign = - 1;
				DdN = - DdN;

			} else {

				return null;

			}

			diff.subVectors( this.origin, a );
			var DdQxE2 = sign * this.direction.dot( edge2.crossVectors( diff, edge2 ) );

			// b1 < 0, no intersection
			if ( DdQxE2 < 0 ) {

				return null;

			}

			var DdE1xQ = sign * this.direction.dot( edge1.cross( diff ) );

			// b2 < 0, no intersection
			if ( DdE1xQ < 0 ) {

				return null;

			}

			// b1+b2 > 1, no intersection
			if ( DdQxE2 + DdE1xQ > DdN ) {

				return null;

			}

			// Line intersects triangle, check if ray does.
			var QdN = - sign * diff.dot( normal );

			// t < 0, no intersection
			if ( QdN < 0 ) {

				return null;

			}

			// Ray intersects triangle.
			return this.at( QdN / DdN, optionalTarget );

		};

	}(),

	applyMatrix4: function ( matrix4 ) {

		this.direction.add( this.origin ).applyMatrix4( matrix4 );
		this.origin.applyMatrix4( matrix4 );
		this.direction.sub( this.origin );
		this.direction.normalize();

		return this;
	},

	equals: function ( ray ) {

		return ray.origin.equals( this.origin ) && ray.direction.equals( this.direction );

	},

	clone: function () {

		return new THREE.Ray().copy( this );

	}

};

// File:src/math/Sphere.js

/**
 * @author bhouston / http://exocortex.com
 * @author mrdoob / http://mrdoob.com/
 */

THREE.Sphere = function ( center, radius ) {

	this.center = ( center !== undefined ) ? center : new THREE.Vector3();
	this.radius = ( radius !== undefined ) ? radius : 0;

};

THREE.Sphere.prototype = {

	constructor: THREE.Sphere,

	set: function ( center, radius ) {

		this.center.copy( center );
		this.radius = radius;

		return this;
	},

	setFromPoints: function () {

		var box = new THREE.Box3();

		return function ( points, optionalCenter )  {

			var center = this.center;

			if ( optionalCenter !== undefined ) {

				center.copy( optionalCenter );

			} else {

				box.setFromPoints( points ).center( center );

			}

			var maxRadiusSq = 0;

			for ( var i = 0, il = points.length; i < il; i ++ ) {

				maxRadiusSq = Math.max( maxRadiusSq, center.distanceToSquared( points[ i ] ) );

			}

			this.radius = Math.sqrt( maxRadiusSq );

			return this;

 		};

	}(),

	copy: function ( sphere ) {

		this.center.copy( sphere.center );
		this.radius = sphere.radius;

		return this;

	},

	empty: function () {

		return ( this.radius <= 0 );

	},

	containsPoint: function ( point ) {

		return ( point.distanceToSquared( this.center ) <= ( this.radius * this.radius ) );

	},

	distanceToPoint: function ( point ) {

		return ( point.distanceTo( this.center ) - this.radius );

	},

	intersectsSphere: function ( sphere ) {

		var radiusSum = this.radius + sphere.radius;

		return sphere.center.distanceToSquared( this.center ) <= ( radiusSum * radiusSum );

	},

	clampPoint: function ( point, optionalTarget ) {

		var deltaLengthSq = this.center.distanceToSquared( point );

		var result = optionalTarget || new THREE.Vector3();
		result.copy( point );

		if ( deltaLengthSq > ( this.radius * this.radius ) ) {

			result.sub( this.center ).normalize();
			result.multiplyScalar( this.radius ).add( this.center );

		}

		return result;

	},

	getBoundingBox: function ( optionalTarget ) {

		var box = optionalTarget || new THREE.Box3();

		box.set( this.center, this.center );
		box.expandByScalar( this.radius );

		return box;

	},

	applyMatrix4: function ( matrix ) {

		this.center.applyMatrix4( matrix );
		this.radius = this.radius * matrix.getMaxScaleOnAxis();

		return this;

	},

	translate: function ( offset ) {

		this.center.add( offset );

		return this;

	},

	equals: function ( sphere ) {

		return sphere.center.equals( this.center ) && ( sphere.radius === this.radius );

	},

	clone: function () {

		return new THREE.Sphere().copy( this );

	}

};

// File:src/math/Frustum.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * @author bhouston / http://exocortex.com
 */

THREE.Frustum = function ( p0, p1, p2, p3, p4, p5 ) {

	this.planes = [

		( p0 !== undefined ) ? p0 : new THREE.Plane(),
		( p1 !== undefined ) ? p1 : new THREE.Plane(),
		( p2 !== undefined ) ? p2 : new THREE.Plane(),
		( p3 !== undefined ) ? p3 : new THREE.Plane(),
		( p4 !== undefined ) ? p4 : new THREE.Plane(),
		( p5 !== undefined ) ? p5 : new THREE.Plane()

	];

};

THREE.Frustum.prototype = {

	constructor: THREE.Frustum,

	set: function ( p0, p1, p2, p3, p4, p5 ) {

		var planes = this.planes;

		planes[ 0 ].copy( p0 );
		planes[ 1 ].copy( p1 );
		planes[ 2 ].copy( p2 );
		planes[ 3 ].copy( p3 );
		planes[ 4 ].copy( p4 );
		planes[ 5 ].copy( p5 );

		return this;

	},

	copy: function ( frustum ) {

		var planes = this.planes;

		for ( var i = 0; i < 6; i ++ ) {

			planes[ i ].copy( frustum.planes[ i ] );

		}

		return this;

	},

	setFromMatrix: function ( m ) {

		var planes = this.planes;
		var me = m.elements;
		var me0 = me[ 0 ], me1 = me[ 1 ], me2 = me[ 2 ], me3 = me[ 3 ];
		var me4 = me[ 4 ], me5 = me[ 5 ], me6 = me[ 6 ], me7 = me[ 7 ];
		var me8 = me[ 8 ], me9 = me[ 9 ], me10 = me[ 10 ], me11 = me[ 11 ];
		var me12 = me[ 12 ], me13 = me[ 13 ], me14 = me[ 14 ], me15 = me[ 15 ];

		planes[ 0 ].setComponents( me3 - me0, me7 - me4, me11 - me8, me15 - me12 ).normalize();
		planes[ 1 ].setComponents( me3 + me0, me7 + me4, me11 + me8, me15 + me12 ).normalize();
		planes[ 2 ].setComponents( me3 + me1, me7 + me5, me11 + me9, me15 + me13 ).normalize();
		planes[ 3 ].setComponents( me3 - me1, me7 - me5, me11 - me9, me15 - me13 ).normalize();
		planes[ 4 ].setComponents( me3 - me2, me7 - me6, me11 - me10, me15 - me14 ).normalize();
		planes[ 5 ].setComponents( me3 + me2, me7 + me6, me11 + me10, me15 + me14 ).normalize();

		return this;

	},

	intersectsObject: function () {

		var sphere = new THREE.Sphere();

		return function ( object ) {

			var geometry = object.geometry;

			if ( geometry.boundingSphere === null ) geometry.computeBoundingSphere();

			sphere.copy( geometry.boundingSphere );
			sphere.applyMatrix4( object.matrixWorld );

			return this.intersectsSphere( sphere );

		};

	}(),

	intersectsSphere: function ( sphere ) {

		var planes = this.planes;
		var center = sphere.center;
		var negRadius = - sphere.radius;

		for ( var i = 0; i < 6; i ++ ) {

			var distance = planes[ i ].distanceToPoint( center );

			if ( distance < negRadius ) {

				return false;

			}

		}

		return true;

	},

	intersectsBox: function () {

		var p1 = new THREE.Vector3(),
			p2 = new THREE.Vector3();

		return function ( box ) {

			var planes = this.planes;

			for ( var i = 0; i < 6 ; i ++ ) {

				var plane = planes[ i ];

				p1.x = plane.normal.x > 0 ? box.min.x : box.max.x;
				p2.x = plane.normal.x > 0 ? box.max.x : box.min.x;
				p1.y = plane.normal.y > 0 ? box.min.y : box.max.y;
				p2.y = plane.normal.y > 0 ? box.max.y : box.min.y;
				p1.z = plane.normal.z > 0 ? box.min.z : box.max.z;
				p2.z = plane.normal.z > 0 ? box.max.z : box.min.z;

				var d1 = plane.distanceToPoint( p1 );
				var d2 = plane.distanceToPoint( p2 );

				// if both outside plane, no intersection

				if ( d1 < 0 && d2 < 0 ) {

					return false;

				}
			}

			return true;
		};

	}(),


	containsPoint: function ( point ) {

		var planes = this.planes;

		for ( var i = 0; i < 6; i ++ ) {

			if ( planes[ i ].distanceToPoint( point ) < 0 ) {

				return false;

			}

		}

		return true;

	},

	clone: function () {

		return new THREE.Frustum().copy( this );

	}

};

// File:src/math/Plane.js

/**
 * @author bhouston / http://exocortex.com
 */

THREE.Plane = function ( normal, constant ) {

	this.normal = ( normal !== undefined ) ? normal : new THREE.Vector3( 1, 0, 0 );
	this.constant = ( constant !== undefined ) ? constant : 0;

};

THREE.Plane.prototype = {

	constructor: THREE.Plane,

	set: function ( normal, constant ) {

		this.normal.copy( normal );
		this.constant = constant;

		return this;

	},

	setComponents: function ( x, y, z, w ) {

		this.normal.set( x, y, z );
		this.constant = w;

		return this;

	},

	setFromNormalAndCoplanarPoint: function ( normal, point ) {

		this.normal.copy( normal );
		this.constant = - point.dot( this.normal );	// must be this.normal, not normal, as this.normal is normalized

		return this;

	},

	setFromCoplanarPoints: function () {

		var v1 = new THREE.Vector3();
		var v2 = new THREE.Vector3();

		return function ( a, b, c ) {

			var normal = v1.subVectors( c, b ).cross( v2.subVectors( a, b ) ).normalize();

			// Q: should an error be thrown if normal is zero (e.g. degenerate plane)?

			this.setFromNormalAndCoplanarPoint( normal, a );

			return this;

		};

	}(),


	copy: function ( plane ) {

		this.normal.copy( plane.normal );
		this.constant = plane.constant;

		return this;

	},

	normalize: function () {

		// Note: will lead to a divide by zero if the plane is invalid.

		var inverseNormalLength = 1.0 / this.normal.length();
		this.normal.multiplyScalar( inverseNormalLength );
		this.constant *= inverseNormalLength;

		return this;

	},

	negate: function () {

		this.constant *= - 1;
		this.normal.negate();

		return this;

	},

	distanceToPoint: function ( point ) {

		return this.normal.dot( point ) + this.constant;

	},

	distanceToSphere: function ( sphere ) {

		return this.distanceToPoint( sphere.center ) - sphere.radius;

	},

	projectPoint: function ( point, optionalTarget ) {

		return this.orthoPoint( point, optionalTarget ).sub( point ).negate();

	},

	orthoPoint: function ( point, optionalTarget ) {

		var perpendicularMagnitude = this.distanceToPoint( point );

		var result = optionalTarget || new THREE.Vector3();
		return result.copy( this.normal ).multiplyScalar( perpendicularMagnitude );

	},

	isIntersectionLine: function ( line ) {

		// Note: this tests if a line intersects the plane, not whether it (or its end-points) are coplanar with it.

		var startSign = this.distanceToPoint( line.start );
		var endSign = this.distanceToPoint( line.end );

		return ( startSign < 0 && endSign > 0 ) || ( endSign < 0 && startSign > 0 );

	},

	intersectLine: function () {

		var v1 = new THREE.Vector3();

		return function ( line, optionalTarget ) {

			var result = optionalTarget || new THREE.Vector3();

			var direction = line.delta( v1 );

			var denominator = this.normal.dot( direction );

			if ( denominator == 0 ) {

				// line is coplanar, return origin
				if ( this.distanceToPoint( line.start ) == 0 ) {

					return result.copy( line.start );

				}

				// Unsure if this is the correct method to handle this case.
				return undefined;

			}

			var t = - ( line.start.dot( this.normal ) + this.constant ) / denominator;

			if ( t < 0 || t > 1 ) {

				return undefined;

			}

			return result.copy( direction ).multiplyScalar( t ).add( line.start );

		};

	}(),


	coplanarPoint: function ( optionalTarget ) {

		var result = optionalTarget || new THREE.Vector3();
		return result.copy( this.normal ).multiplyScalar( - this.constant );

	},

	applyMatrix4: function () {

		var v1 = new THREE.Vector3();
		var v2 = new THREE.Vector3();
		var m1 = new THREE.Matrix3();

		return function ( matrix, optionalNormalMatrix ) {

			// compute new normal based on theory here:
			// http://www.songho.ca/opengl/gl_normaltransform.html
			var normalMatrix = optionalNormalMatrix || m1.getNormalMatrix( matrix );
			var newNormal = v1.copy( this.normal ).applyMatrix3( normalMatrix );

			var newCoplanarPoint = this.coplanarPoint( v2 );
			newCoplanarPoint.applyMatrix4( matrix );

			this.setFromNormalAndCoplanarPoint( newNormal, newCoplanarPoint );

			return this;

		};

	}(),

	translate: function ( offset ) {

		this.constant = this.constant - offset.dot( this.normal );

		return this;

	},

	equals: function ( plane ) {

		return plane.normal.equals( this.normal ) && ( plane.constant == this.constant );

	},

	clone: function () {

		return new THREE.Plane().copy( this );

	}

};

// File:src/math/Math.js

/**
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 */

THREE.Math = {

	generateUUID: function () {

		// http://www.broofa.com/Tools/Math.uuid.htm

		var chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split( '' );
		var uuid = new Array( 36 );
		var rnd = 0, r;

		return function () {

			for ( var i = 0; i < 36; i ++ ) {

				if ( i == 8 || i == 13 || i == 18 || i == 23 ) {

					uuid[ i ] = '-';

				} else if ( i == 14 ) {

					uuid[ i ] = '4';

				} else {

					if ( rnd <= 0x02 ) rnd = 0x2000000 + ( Math.random() * 0x1000000 ) | 0;
					r = rnd & 0xf;
					rnd = rnd >> 4;
					uuid[ i ] = chars[ ( i == 19 ) ? ( r & 0x3 ) | 0x8 : r ];

				}
			}

			return uuid.join( '' );

		};

	}(),

	// Clamp value to range <a, b>

	clamp: function ( x, a, b ) {

		return ( x < a ) ? a : ( ( x > b ) ? b : x );

	},

	// Clamp value to range <a, inf)

	clampBottom: function ( x, a ) {

		return x < a ? a : x;

	},

	// Linear mapping from range <a1, a2> to range <b1, b2>

	mapLinear: function ( x, a1, a2, b1, b2 ) {

		return b1 + ( x - a1 ) * ( b2 - b1 ) / ( a2 - a1 );

	},

	// http://en.wikipedia.org/wiki/Smoothstep

	smoothstep: function ( x, min, max ) {

		if ( x <= min ) return 0;
		if ( x >= max ) return 1;

		x = ( x - min ) / ( max - min );

		return x * x * ( 3 - 2 * x );

	},

	smootherstep: function ( x, min, max ) {

		if ( x <= min ) return 0;
		if ( x >= max ) return 1;

		x = ( x - min ) / ( max - min );

		return x * x * x * ( x * ( x * 6 - 15 ) + 10 );

	},

	// Random float from <0, 1> with 16 bits of randomness
	// (standard Math.random() creates repetitive patterns when applied over larger space)

	random16: function () {

		return ( 65280 * Math.random() + 255 * Math.random() ) / 65535;

	},

	// Random integer from <low, high> interval

	randInt: function ( low, high ) {

		return low + Math.floor( Math.random() * ( high - low + 1 ) );

	},

	// Random float from <low, high> interval

	randFloat: function ( low, high ) {

		return low + Math.random() * ( high - low );

	},

	// Random float from <-range/2, range/2> interval

	randFloatSpread: function ( range ) {

		return range * ( 0.5 - Math.random() );

	},

	degToRad: function () {

		var degreeToRadiansFactor = Math.PI / 180;

		return function ( degrees ) {

			return degrees * degreeToRadiansFactor;

		};

	}(),

	radToDeg: function () {

		var radianToDegreesFactor = 180 / Math.PI;

		return function ( radians ) {

			return radians * radianToDegreesFactor;

		};

	}(),

	isPowerOfTwo: function ( value ) {

		return ( value & ( value - 1 ) ) === 0 && value !== 0;

	}

};

// File:src/math/Spline.js

/**
 * Spline from Tween.js, slightly optimized (and trashed)
 * http://sole.github.com/tween.js/examples/05_spline.html
 *
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 */

THREE.Spline = function ( points ) {

	this.points = points;

	var c = [], v3 = { x: 0, y: 0, z: 0 },
	point, intPoint, weight, w2, w3,
	pa, pb, pc, pd;

	this.initFromArray = function ( a ) {

		this.points = [];

		for ( var i = 0; i < a.length; i ++ ) {

			this.points[ i ] = { x: a[ i ][ 0 ], y: a[ i ][ 1 ], z: a[ i ][ 2 ] };

		}

	};

	this.getPoint = function ( k ) {

		point = ( this.points.length - 1 ) * k;
		intPoint = Math.floor( point );
		weight = point - intPoint;

		c[ 0 ] = intPoint === 0 ? intPoint : intPoint - 1;
		c[ 1 ] = intPoint;
		c[ 2 ] = intPoint  > this.points.length - 2 ? this.points.length - 1 : intPoint + 1;
		c[ 3 ] = intPoint  > this.points.length - 3 ? this.points.length - 1 : intPoint + 2;

		pa = this.points[ c[ 0 ] ];
		pb = this.points[ c[ 1 ] ];
		pc = this.points[ c[ 2 ] ];
		pd = this.points[ c[ 3 ] ];

		w2 = weight * weight;
		w3 = weight * w2;

		v3.x = interpolate( pa.x, pb.x, pc.x, pd.x, weight, w2, w3 );
		v3.y = interpolate( pa.y, pb.y, pc.y, pd.y, weight, w2, w3 );
		v3.z = interpolate( pa.z, pb.z, pc.z, pd.z, weight, w2, w3 );

		return v3;

	};

	this.getControlPointsArray = function () {

		var i, p, l = this.points.length,
			coords = [];

		for ( i = 0; i < l; i ++ ) {

			p = this.points[ i ];
			coords[ i ] = [ p.x, p.y, p.z ];

		}

		return coords;

	};

	// approximate length by summing linear segments

	this.getLength = function ( nSubDivisions ) {

		var i, index, nSamples, position,
			point = 0, intPoint = 0, oldIntPoint = 0,
			oldPosition = new THREE.Vector3(),
			tmpVec = new THREE.Vector3(),
			chunkLengths = [],
			totalLength = 0;

		// first point has 0 length

		chunkLengths[ 0 ] = 0;

		if ( ! nSubDivisions ) nSubDivisions = 100;

		nSamples = this.points.length * nSubDivisions;

		oldPosition.copy( this.points[ 0 ] );

		for ( i = 1; i < nSamples; i ++ ) {

			index = i / nSamples;

			position = this.getPoint( index );
			tmpVec.copy( position );

			totalLength += tmpVec.distanceTo( oldPosition );

			oldPosition.copy( position );

			point = ( this.points.length - 1 ) * index;
			intPoint = Math.floor( point );

			if ( intPoint != oldIntPoint ) {

				chunkLengths[ intPoint ] = totalLength;
				oldIntPoint = intPoint;

			}

		}

		// last point ends with total length

		chunkLengths[ chunkLengths.length ] = totalLength;

		return { chunks: chunkLengths, total: totalLength };

	};

	this.reparametrizeByArcLength = function ( samplingCoef ) {

		var i, j,
			index, indexCurrent, indexNext,
			linearDistance, realDistance,
			sampling, position,
			newpoints = [],
			tmpVec = new THREE.Vector3(),
			sl = this.getLength();

		newpoints.push( tmpVec.copy( this.points[ 0 ] ).clone() );

		for ( i = 1; i < this.points.length; i ++ ) {

			//tmpVec.copy( this.points[ i - 1 ] );
			//linearDistance = tmpVec.distanceTo( this.points[ i ] );

			realDistance = sl.chunks[ i ] - sl.chunks[ i - 1 ];

			sampling = Math.ceil( samplingCoef * realDistance / sl.total );

			indexCurrent = ( i - 1 ) / ( this.points.length - 1 );
			indexNext = i / ( this.points.length - 1 );

			for ( j = 1; j < sampling - 1; j ++ ) {

				index = indexCurrent + j * ( 1 / sampling ) * ( indexNext - indexCurrent );

				position = this.getPoint( index );
				newpoints.push( tmpVec.copy( position ).clone() );

			}

			newpoints.push( tmpVec.copy( this.points[ i ] ).clone() );

		}

		this.points = newpoints;

	};

	// Catmull-Rom

	function interpolate( p0, p1, p2, p3, t, t2, t3 ) {

		var v0 = ( p2 - p0 ) * 0.5,
			v1 = ( p3 - p1 ) * 0.5;

		return ( 2 * ( p1 - p2 ) + v0 + v1 ) * t3 + ( - 3 * ( p1 - p2 ) - 2 * v0 - v1 ) * t2 + v0 * t + p1;

	};

};

// File:src/math/Triangle.js

/**
 * @author bhouston / http://exocortex.com
 * @author mrdoob / http://mrdoob.com/
 */

THREE.Triangle = function ( a, b, c ) {

	this.a = ( a !== undefined ) ? a : new THREE.Vector3();
	this.b = ( b !== undefined ) ? b : new THREE.Vector3();
	this.c = ( c !== undefined ) ? c : new THREE.Vector3();

};

THREE.Triangle.normal = function () {

	var v0 = new THREE.Vector3();

	return function ( a, b, c, optionalTarget ) {

		var result = optionalTarget || new THREE.Vector3();

		result.subVectors( c, b );
		v0.subVectors( a, b );
		result.cross( v0 );

		var resultLengthSq = result.lengthSq();
		if ( resultLengthSq > 0 ) {

			return result.multiplyScalar( 1 / Math.sqrt( resultLengthSq ) );

		}

		return result.set( 0, 0, 0 );

	};

}();

// static/instance method to calculate barycoordinates
// based on: http://www.blackpawn.com/texts/pointinpoly/default.html
THREE.Triangle.barycoordFromPoint = function () {

	var v0 = new THREE.Vector3();
	var v1 = new THREE.Vector3();
	var v2 = new THREE.Vector3();

	return function ( point, a, b, c, optionalTarget ) {

		v0.subVectors( c, a );
		v1.subVectors( b, a );
		v2.subVectors( point, a );

		var dot00 = v0.dot( v0 );
		var dot01 = v0.dot( v1 );
		var dot02 = v0.dot( v2 );
		var dot11 = v1.dot( v1 );
		var dot12 = v1.dot( v2 );

		var denom = ( dot00 * dot11 - dot01 * dot01 );

		var result = optionalTarget || new THREE.Vector3();

		// colinear or singular triangle
		if ( denom == 0 ) {
			// arbitrary location outside of triangle?
			// not sure if this is the best idea, maybe should be returning undefined
			return result.set( - 2, - 1, - 1 );
		}

		var invDenom = 1 / denom;
		var u = ( dot11 * dot02 - dot01 * dot12 ) * invDenom;
		var v = ( dot00 * dot12 - dot01 * dot02 ) * invDenom;

		// barycoordinates must always sum to 1
		return result.set( 1 - u - v, v, u );

	};

}();

THREE.Triangle.containsPoint = function () {

	var v1 = new THREE.Vector3();

	return function ( point, a, b, c ) {

		var result = THREE.Triangle.barycoordFromPoint( point, a, b, c, v1 );

		return ( result.x >= 0 ) && ( result.y >= 0 ) && ( ( result.x + result.y ) <= 1 );

	};

}();

THREE.Triangle.prototype = {

	constructor: THREE.Triangle,

	set: function ( a, b, c ) {

		this.a.copy( a );
		this.b.copy( b );
		this.c.copy( c );

		return this;

	},

	setFromPointsAndIndices: function ( points, i0, i1, i2 ) {

		this.a.copy( points[ i0 ] );
		this.b.copy( points[ i1 ] );
		this.c.copy( points[ i2 ] );

		return this;

	},

	copy: function ( triangle ) {

		this.a.copy( triangle.a );
		this.b.copy( triangle.b );
		this.c.copy( triangle.c );

		return this;

	},

	area: function () {

		var v0 = new THREE.Vector3();
		var v1 = new THREE.Vector3();

		return function () {

			v0.subVectors( this.c, this.b );
			v1.subVectors( this.a, this.b );

			return v0.cross( v1 ).length() * 0.5;

		};

	}(),

	midpoint: function ( optionalTarget ) {

		var result = optionalTarget || new THREE.Vector3();
		return result.addVectors( this.a, this.b ).add( this.c ).multiplyScalar( 1 / 3 );

	},

	normal: function ( optionalTarget ) {

		return THREE.Triangle.normal( this.a, this.b, this.c, optionalTarget );

	},

	plane: function ( optionalTarget ) {

		var result = optionalTarget || new THREE.Plane();

		return result.setFromCoplanarPoints( this.a, this.b, this.c );

	},

	barycoordFromPoint: function ( point, optionalTarget ) {

		return THREE.Triangle.barycoordFromPoint( point, this.a, this.b, this.c, optionalTarget );

	},

	containsPoint: function ( point ) {

		return THREE.Triangle.containsPoint( point, this.a, this.b, this.c );

	},

	equals: function ( triangle ) {

		return triangle.a.equals( this.a ) && triangle.b.equals( this.b ) && triangle.c.equals( this.c );

	},

	clone: function () {

		return new THREE.Triangle().copy( this );

	}

};

// File:src/core/Clock.js

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.Clock = function ( autoStart ) {

	this.autoStart = ( autoStart !== undefined ) ? autoStart : true;

	this.startTime = 0;
	this.oldTime = 0;
	this.elapsedTime = 0;

	this.running = false;

};

THREE.Clock.prototype = {

	constructor: THREE.Clock,

	start: function () {

		this.startTime = self.performance !== undefined && self.performance.now !== undefined
					 ? self.performance.now()
					 : Date.now();

		this.oldTime = this.startTime;
		this.running = true;
	},

	stop: function () {

		this.getElapsedTime();
		this.running = false;

	},

	getElapsedTime: function () {

		this.getDelta();
		return this.elapsedTime;

	},

	getDelta: function () {

		var diff = 0;

		if ( this.autoStart && ! this.running ) {

			this.start();

		}

		if ( this.running ) {

			var newTime = self.performance !== undefined && self.performance.now !== undefined
					 ? self.performance.now()
					 : Date.now();

			diff = 0.001 * ( newTime - this.oldTime );
			this.oldTime = newTime;

			this.elapsedTime += diff;

		}

		return diff;

	}

};

// File:src/core/EventDispatcher.js

/**
 * https://github.com/mrdoob/eventdispatcher.js/
 */

THREE.EventDispatcher = function () {}

THREE.EventDispatcher.prototype = {

	constructor: THREE.EventDispatcher,

	apply: function ( object ) {

		object.addEventListener = THREE.EventDispatcher.prototype.addEventListener;
		object.hasEventListener = THREE.EventDispatcher.prototype.hasEventListener;
		object.removeEventListener = THREE.EventDispatcher.prototype.removeEventListener;
		object.dispatchEvent = THREE.EventDispatcher.prototype.dispatchEvent;

	},

	addEventListener: function ( type, listener ) {

		if ( this._listeners === undefined ) this._listeners = {};

		var listeners = this._listeners;

		if ( listeners[ type ] === undefined ) {

			listeners[ type ] = [];

		}

		if ( listeners[ type ].indexOf( listener ) === - 1 ) {

			listeners[ type ].push( listener );

		}

	},

	hasEventListener: function ( type, listener ) {

		if ( this._listeners === undefined ) return false;

		var listeners = this._listeners;

		if ( listeners[ type ] !== undefined && listeners[ type ].indexOf( listener ) !== - 1 ) {

			return true;

		}

		return false;

	},

	removeEventListener: function ( type, listener ) {

		if ( this._listeners === undefined ) return;

		var listeners = this._listeners;
		var listenerArray = listeners[ type ];

		if ( listenerArray !== undefined ) {

			var index = listenerArray.indexOf( listener );

			if ( index !== - 1 ) {

				listenerArray.splice( index, 1 );

			}

		}

	},

	dispatchEvent: function ( event ) {

		if ( this._listeners === undefined ) return;

		var listeners = this._listeners;
		var listenerArray = listeners[ event.type ];

		if ( listenerArray !== undefined ) {

			event.target = this;

			var array = [];
			var length = listenerArray.length;

			for ( var i = 0; i < length; i ++ ) {

				array[ i ] = listenerArray[ i ];

			}

			for ( var i = 0; i < length; i ++ ) {

				array[ i ].call( this, event );

			}

		}

	}

};

// File:src/core/Raycaster.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author bhouston / http://exocortex.com/
 * @author stephomi / http://stephaneginier.com/
 */

( function ( THREE ) {

	THREE.Raycaster = function ( origin, direction, near, far ) {

		this.ray = new THREE.Ray( origin, direction );
		// direction is assumed to be normalized (for accurate distance calculations)

		this.near = near || 0;
		this.far = far || Infinity;

		this.params = {
			Sprite: {},
			Mesh: {},
			PointCloud: { threshold: 1 },
			LOD: {},
			Line: {}
		};

	};

	var descSort = function ( a, b ) {

		return a.distance - b.distance;

	};

	var intersectObject = function ( object, raycaster, intersects, recursive ) {

		object.raycast( raycaster, intersects );

		if ( recursive === true ) {

			var children = object.children;

			for ( var i = 0, l = children.length; i < l; i ++ ) {

				intersectObject( children[ i ], raycaster, intersects, true );

			}

		}

	};

	//

	THREE.Raycaster.prototype = {

		constructor: THREE.Raycaster,

		precision: 0.0001,
		linePrecision: 1,

		set: function ( origin, direction ) {

			this.ray.set( origin, direction );
			// direction is assumed to be normalized (for accurate distance calculations)

		},

		intersectObject: function ( object, recursive ) {

			var intersects = [];

			intersectObject( object, this, intersects, recursive );

			intersects.sort( descSort );

			return intersects;

		},

		intersectObjects: function ( objects, recursive ) {

			var intersects = [];

			if ( objects instanceof Array === false ) {

				console.log( 'THREE.Raycaster.intersectObjects: objects is not an Array.' );
				return intersects;

			}

			for ( var i = 0, l = objects.length; i < l; i ++ ) {

				intersectObject( objects[ i ], this, intersects, recursive );

			}

			intersects.sort( descSort );

			return intersects;

		}

	};

}( THREE ) );

// File:src/core/Object3D.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author mikael emtinger / http://gomo.se/
 * @author alteredq / http://alteredqualia.com/
 * @author WestLangley / http://github.com/WestLangley
 */

THREE.Object3D = function () {

	Object.defineProperty( this, 'id', { value: THREE.Object3DIdCount ++ } );

	this.uuid = THREE.Math.generateUUID();

	this.name = '';
	this.type = 'Object3D';

	this.parent = undefined;
	this.children = [];

	this.up = THREE.Object3D.DefaultUp.clone();

	var scope = this;

	var position = new THREE.Vector3();
	var rotation = new THREE.Euler();
	var quaternion = new THREE.Quaternion();
	var scale = new THREE.Vector3( 1, 1, 1 );

	var onRotationChange = function () {
		quaternion.setFromEuler( rotation, false );
	};

	var onQuaternionChange = function () {
		rotation.setFromQuaternion( quaternion, undefined, false );
	};

	rotation.onChange( onRotationChange );
	quaternion.onChange( onQuaternionChange );

	Object.defineProperties( this, {
		position: {
			enumerable: true,
			value: position
		},
		rotation: {
			enumerable: true,
			value: rotation
		},
		quaternion: {
			enumerable: true,
			value: quaternion
		},
		scale: {
			enumerable: true,
			value: scale
		},
	} );

	this.renderDepth = null;

	this.rotationAutoUpdate = true;

	this.matrix = new THREE.Matrix4();
	this.matrixWorld = new THREE.Matrix4();

	this.matrixAutoUpdate = true;
	this.matrixWorldNeedsUpdate = false;

	this.visible = true;

	this.castShadow = false;
	this.receiveShadow = false;

	this.frustumCulled = true;

	this.userData = {};

};

THREE.Object3D.DefaultUp = new THREE.Vector3( 0, 1, 0 );

THREE.Object3D.prototype = {

	constructor: THREE.Object3D,

	get eulerOrder () {

		console.warn( 'THREE.Object3D: .eulerOrder has been moved to .rotation.order.' );

		return this.rotation.order;

	},

	set eulerOrder ( value ) {

		console.warn( 'THREE.Object3D: .eulerOrder has been moved to .rotation.order.' );

		this.rotation.order = value;

	},

	get useQuaternion () {

		console.warn( 'THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.' );

	},

	set useQuaternion ( value ) {

		console.warn( 'THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.' );

	},

	applyMatrix: function ( matrix ) {

		this.matrix.multiplyMatrices( matrix, this.matrix );

		this.matrix.decompose( this.position, this.quaternion, this.scale );

	},

	setRotationFromAxisAngle: function ( axis, angle ) {

		// assumes axis is normalized

		this.quaternion.setFromAxisAngle( axis, angle );

	},

	setRotationFromEuler: function ( euler ) {

		this.quaternion.setFromEuler( euler, true );

	},

	setRotationFromMatrix: function ( m ) {

		// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)

		this.quaternion.setFromRotationMatrix( m );

	},

	setRotationFromQuaternion: function ( q ) {

		// assumes q is normalized

		this.quaternion.copy( q );

	},

	rotateOnAxis: function () {

		// rotate object on axis in object space
		// axis is assumed to be normalized

		var q1 = new THREE.Quaternion();

		return function ( axis, angle ) {

			q1.setFromAxisAngle( axis, angle );

			this.quaternion.multiply( q1 );

			return this;

		}

	}(),

	rotateX: function () {

		var v1 = new THREE.Vector3( 1, 0, 0 );

		return function ( angle ) {

			return this.rotateOnAxis( v1, angle );

		};

	}(),

	rotateY: function () {

		var v1 = new THREE.Vector3( 0, 1, 0 );

		return function ( angle ) {

			return this.rotateOnAxis( v1, angle );

		};

	}(),

	rotateZ: function () {

		var v1 = new THREE.Vector3( 0, 0, 1 );

		return function ( angle ) {

			return this.rotateOnAxis( v1, angle );

		};

	}(),

	translateOnAxis: function () {

		// translate object by distance along axis in object space
		// axis is assumed to be normalized

		var v1 = new THREE.Vector3();

		return function ( axis, distance ) {

			v1.copy( axis ).applyQuaternion( this.quaternion );

			this.position.add( v1.multiplyScalar( distance ) );

			return this;

		}

	}(),

	translate: function ( distance, axis ) {

		console.warn( 'THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.' );
		return this.translateOnAxis( axis, distance );

	},

	translateX: function () {

		var v1 = new THREE.Vector3( 1, 0, 0 );

		return function ( distance ) {

			return this.translateOnAxis( v1, distance );

		};

	}(),

	translateY: function () {

		var v1 = new THREE.Vector3( 0, 1, 0 );

		return function ( distance ) {

			return this.translateOnAxis( v1, distance );

		};

	}(),

	translateZ: function () {

		var v1 = new THREE.Vector3( 0, 0, 1 );

		return function ( distance ) {

			return this.translateOnAxis( v1, distance );

		};

	}(),

	localToWorld: function ( vector ) {

		return vector.applyMatrix4( this.matrixWorld );

	},

	worldToLocal: function () {

		var m1 = new THREE.Matrix4();

		return function ( vector ) {

			return vector.applyMatrix4( m1.getInverse( this.matrixWorld ) );

		};

	}(),

	lookAt: function () {

		// This routine does not support objects with rotated and/or translated parent(s)

		var m1 = new THREE.Matrix4();

		return function ( vector ) {

			m1.lookAt( vector, this.position, this.up );

			this.quaternion.setFromRotationMatrix( m1 );

		};

	}(),

	add: function ( object ) {

		if ( arguments.length > 1 ) {

			for ( var i = 0; i < arguments.length; i++ ) {

				this.add( arguments[ i ] );

			}

			return this;

		};

		if ( object === this ) {

			console.error( "THREE.Object3D.add:", object, "can't be added as a child of itself." );
			return this;

		}

		if ( object instanceof THREE.Object3D ) {

			if ( object.parent !== undefined ) {

				object.parent.remove( object );

			}

			object.parent = this;
			object.dispatchEvent( { type: 'added' } );

			this.children.push( object );

		} else {

			console.error( "THREE.Object3D.add:", object, "is not an instance of THREE.Object3D." );

		}

		return this;

	},

	remove: function ( object ) {

		if ( arguments.length > 1 ) {

			for ( var i = 0; i < arguments.length; i++ ) {

				this.remove( arguments[ i ] );

			}

		};

		var index = this.children.indexOf( object );

		if ( index !== - 1 ) {

			object.parent = undefined;

			object.dispatchEvent( { type: 'removed' } );

			this.children.splice( index, 1 );

		}

	},

	getChildByName: function ( name, recursive ) {

		console.warn( 'THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().' );
		return this.getObjectByName( name, recursive );

	},

	getObjectById: function ( id, recursive ) {

		if ( this.id === id ) return this;

		for ( var i = 0, l = this.children.length; i < l; i ++ ) {

			var child = this.children[ i ];
			var object = child.getObjectById( id, recursive );

			if ( object !== undefined ) {

				return object;

			}

		}

		return undefined;

	},

	getObjectByName: function ( name, recursive ) {

		if ( this.name === name ) return this;

		for ( var i = 0, l = this.children.length; i < l; i ++ ) {

			var child = this.children[ i ];
			var object = child.getObjectByName( name, recursive );

			if ( object !== undefined ) {

				return object;

			}

		}

		return undefined;

	},

	getWorldPosition: function ( optionalTarget ) {

		var result = optionalTarget || new THREE.Vector3();

		this.updateMatrixWorld( true );

		return result.setFromMatrixPosition( this.matrixWorld );

	},

	getWorldQuaternion: function () {

		var position = new THREE.Vector3();
		var scale = new THREE.Vector3();

		return function ( optionalTarget ) {

			var result = optionalTarget || new THREE.Quaternion();

			this.updateMatrixWorld( true );

			this.matrixWorld.decompose( position, result, scale );

			return result;

		}

	}(),

	getWorldRotation: function () {

		var quaternion = new THREE.Quaternion();

		return function ( optionalTarget ) {

			var result = optionalTarget || new THREE.Euler();

			this.getWorldQuaternion( quaternion );

			return result.setFromQuaternion( quaternion, this.rotation.order, false );

		}

	}(),

	getWorldScale: function () {

		var position = new THREE.Vector3();
		var quaternion = new THREE.Quaternion();

		return function ( optionalTarget ) {

			var result = optionalTarget || new THREE.Vector3();

			this.updateMatrixWorld( true );

			this.matrixWorld.decompose( position, quaternion, result );

			return result;

		}

	}(),

	getWorldDirection: function () {

		var quaternion = new THREE.Quaternion();

		return function ( optionalTarget ) {

			var result = optionalTarget || new THREE.Vector3();

			this.getWorldQuaternion( quaternion );

			return result.set( 0, 0, 1 ).applyQuaternion( quaternion );

		}

	}(),

	raycast: function () {},

	traverse: function ( callback ) {

		callback( this );

		for ( var i = 0, l = this.children.length; i < l; i ++ ) {

			this.children[ i ].traverse( callback );

		}

	},

	traverseVisible: function ( callback ) {

		if ( this.visible === false ) return;

		callback( this );

		for ( var i = 0, l = this.children.length; i < l; i ++ ) {

			this.children[ i ].traverseVisible( callback );

		}

	},

	updateMatrix: function () {

		this.matrix.compose( this.position, this.quaternion, this.scale );

		this.matrixWorldNeedsUpdate = true;

	},

	updateMatrixWorld: function ( force ) {

		if ( this.matrixAutoUpdate === true ) this.updateMatrix();

		if ( this.matrixWorldNeedsUpdate === true || force === true ) {

			if ( this.parent === undefined ) {

				this.matrixWorld.copy( this.matrix );

			} else {

				this.matrixWorld.multiplyMatrices( this.parent.matrixWorld, this.matrix );

			}

			this.matrixWorldNeedsUpdate = false;

			force = true;

		}

		// update children

		for ( var i = 0, l = this.children.length; i < l; i ++ ) {

			this.children[ i ].updateMatrixWorld( force );

		}

	},

	toJSON: function () {

		var output = {
			metadata: {
				version: 4.3,
				type: 'Object',
				generator: 'ObjectExporter'
			}
		};

		//

		var geometries = {};

		var parseGeometry = function ( geometry ) {

			if ( output.geometries === undefined ) {

				output.geometries = [];

			}

			if ( geometries[ geometry.uuid ] === undefined ) {

				var json = geometry.toJSON();

				delete json.metadata;

				geometries[ geometry.uuid ] = json;

				output.geometries.push( json );

			}

			return geometry.uuid;

		};

		//

		var materials = {};

		var parseMaterial = function ( material ) {

			if ( output.materials === undefined ) {

				output.materials = [];

			}

			if ( materials[ material.uuid ] === undefined ) {

				var json = material.toJSON();

				delete json.metadata;

				materials[ material.uuid ] = json;

				output.materials.push( json );

			}

			return material.uuid;

		};

		//

		var parseObject = function ( object ) {

			var data = {};

			data.uuid = object.uuid;
			data.type = object.type;

			if ( object.name !== '' ) data.name = object.name;
			if ( JSON.stringify( object.userData ) !== '{}' ) data.userData = object.userData;
			if ( object.visible !== true ) data.visible = object.visible;

			if ( object instanceof THREE.PerspectiveCamera ) {

				data.fov = object.fov;
				data.aspect = object.aspect;
				data.near = object.near;
				data.far = object.far;

			} else if ( object instanceof THREE.OrthographicCamera ) {

				data.left = object.left;
				data.right = object.right;
				data.top = object.top;
				data.bottom = object.bottom;
				data.near = object.near;
				data.far = object.far;

			} else if ( object instanceof THREE.AmbientLight ) {

				data.color = object.color.getHex();

			} else if ( object instanceof THREE.DirectionalLight ) {

				data.color = object.color.getHex();
				data.intensity = object.intensity;

			} else if ( object instanceof THREE.PointLight ) {

				data.color = object.color.getHex();
				data.intensity = object.intensity;
				data.distance = object.distance;

			} else if ( object instanceof THREE.SpotLight ) {

				data.color = object.color.getHex();
				data.intensity = object.intensity;
				data.distance = object.distance;
				data.angle = object.angle;
				data.exponent = object.exponent;

			} else if ( object instanceof THREE.HemisphereLight ) {

				data.color = object.color.getHex();
				data.groundColor = object.groundColor.getHex();

			} else if ( object instanceof THREE.Mesh ) {

				data.geometry = parseGeometry( object.geometry );
				data.material = parseMaterial( object.material );

			} else if ( object instanceof THREE.Line ) {

				data.geometry = parseGeometry( object.geometry );
				data.material = parseMaterial( object.material );

			} else if ( object instanceof THREE.Sprite ) {

				data.material = parseMaterial( object.material );

			}

			data.matrix = object.matrix.toArray();

			if ( object.children.length > 0 ) {

				data.children = [];

				for ( var i = 0; i < object.children.length; i ++ ) {

					data.children.push( parseObject( object.children[ i ] ) );

				}

			}

			return data;

		}

		output.object = parseObject( this );

		return output;

	},

	clone: function ( object, recursive ) {

		if ( object === undefined ) object = new THREE.Object3D();
		if ( recursive === undefined ) recursive = true;

		object.name = this.name;

		object.up.copy( this.up );

		object.position.copy( this.position );
		object.quaternion.copy( this.quaternion );
		object.scale.copy( this.scale );

		object.renderDepth = this.renderDepth;

		object.rotationAutoUpdate = this.rotationAutoUpdate;

		object.matrix.copy( this.matrix );
		object.matrixWorld.copy( this.matrixWorld );

		object.matrixAutoUpdate = this.matrixAutoUpdate;
		object.matrixWorldNeedsUpdate = this.matrixWorldNeedsUpdate;

		object.visible = this.visible;

		object.castShadow = this.castShadow;
		object.receiveShadow = this.receiveShadow;

		object.frustumCulled = this.frustumCulled;

		object.userData = JSON.parse( JSON.stringify( this.userData ) );

		if ( recursive === true ) {

			for ( var i = 0; i < this.children.length; i ++ ) {

				var child = this.children[ i ];
				object.add( child.clone() );

			}

		}

		return object;

	}

};

THREE.EventDispatcher.prototype.apply( THREE.Object3D.prototype );

THREE.Object3DIdCount = 0;

// File:src/core/Projector.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.Projector = function () {

	console.warn( 'THREE.Projector has been moved to /examples/renderers/Projector.js.' );

	this.projectVector = function ( vector, camera ) {

		console.warn( 'THREE.Projector: .projectVector() is now vector.project().' );
		vector.project( camera );

	};

	this.unprojectVector = function ( vector, camera ) {

		console.warn( 'THREE.Projector: .unprojectVector() is now vector.unproject().' );
		vector.unproject( camera );

	};

	this.pickingRay = function ( vector, camera ) {

		console.error( 'THREE.Projector: .pickingRay() has been removed.' );

	};

};

// File:src/core/Face3.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 */

THREE.Face3 = function ( a, b, c, normal, color, materialIndex ) {

	this.a = a;
	this.b = b;
	this.c = c;

	this.normal = normal instanceof THREE.Vector3 ? normal : new THREE.Vector3();
	this.vertexNormals = normal instanceof Array ? normal : [];

	this.color = color instanceof THREE.Color ? color : new THREE.Color();
	this.vertexColors = color instanceof Array ? color : [];

	this.vertexTangents = [];

	this.materialIndex = materialIndex !== undefined ? materialIndex : 0;

};

THREE.Face3.prototype = {

	constructor: THREE.Face3,

	clone: function () {

		var face = new THREE.Face3( this.a, this.b, this.c );

		face.normal.copy( this.normal );
		face.color.copy( this.color );

		face.materialIndex = this.materialIndex;

		for ( var i = 0, il = this.vertexNormals.length; i < il; i ++ ) {

			face.vertexNormals[ i ] = this.vertexNormals[ i ].clone();

		}

		for ( var i = 0, il = this.vertexColors.length; i < il; i ++ ) {

			face.vertexColors[ i ] = this.vertexColors[ i ].clone();

		}

		for ( var i = 0, il = this.vertexTangents.length; i < il; i ++ ) {

			face.vertexTangents[ i ] = this.vertexTangents[ i ].clone();

		}

		return face;

	}

};

// File:src/core/Face4.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.Face4 = function ( a, b, c, d, normal, color, materialIndex ) {

	console.warn( 'THREE.Face4 has been removed. A THREE.Face3 will be created instead.' )
	return new THREE.Face3( a, b, c, normal, color, materialIndex );

};

// File:src/core/BufferAttribute.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.BufferAttribute = function ( array, itemSize ) {

	this.array = array;
	this.itemSize = itemSize;

	this.needsUpdate = false;

};

THREE.BufferAttribute.prototype = {

	constructor: THREE.BufferAttribute,

	get length () {

		return this.array.length;

	},

	copyAt: function ( index1, attribute, index2 ) {

		index1 *= this.itemSize;
		index2 *= attribute.itemSize;

		for ( var i = 0, l = this.itemSize; i < l; i ++ ) {

			this.array[ index1 + i ] = attribute.array[ index2 + i ];

		}

	},

	set: function ( value ) {

		this.array.set( value );

		return this;

	},

	setX: function ( index, x ) {

		this.array[ index * this.itemSize ] = x;

		return this;

	},

	setY: function ( index, y ) {

		this.array[ index * this.itemSize + 1 ] = y;

		return this;

	},

	setZ: function ( index, z ) {

		this.array[ index * this.itemSize + 2 ] = z;

		return this;

	},

	setXY: function ( index, x, y ) {

		index *= this.itemSize;

		this.array[ index     ] = x;
		this.array[ index + 1 ] = y;

		return this;

	},

	setXYZ: function ( index, x, y, z ) {

		index *= this.itemSize;

		this.array[ index     ] = x;
		this.array[ index + 1 ] = y;
		this.array[ index + 2 ] = z;

		return this;

	},

	setXYZW: function ( index, x, y, z, w ) {

		index *= this.itemSize;

		this.array[ index     ] = x;
		this.array[ index + 1 ] = y;
		this.array[ index + 2 ] = z;
		this.array[ index + 3 ] = w;

		return this;

	},

	clone: function () {

		return new THREE.BufferAttribute( new this.array.constructor( this.array ), this.itemSize );

	}

};

//

THREE.Int8Attribute = function ( data, itemSize ) {

	console.warn( 'THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.' );
	return new THREE.BufferAttribute( data, itemSize );

};

THREE.Uint8Attribute = function ( data, itemSize ) {

	console.warn( 'THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.' );
	return new THREE.BufferAttribute( data, itemSize );

};

THREE.Uint8ClampedAttribute = function ( data, itemSize ) {

	console.warn( 'THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.' );
	return new THREE.BufferAttribute( data, itemSize );


};

THREE.Int16Attribute = function ( data, itemSize ) {

	console.warn( 'THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.' );
	return new THREE.BufferAttribute( data, itemSize );

};

THREE.Uint16Attribute = function ( data, itemSize ) {

	console.warn( 'THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.' );
	return new THREE.BufferAttribute( data, itemSize );

};

THREE.Int32Attribute = function ( data, itemSize ) {

	console.warn( 'THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.' );
	return new THREE.BufferAttribute( data, itemSize );

};

THREE.Uint32Attribute = function ( data, itemSize ) {

	console.warn( 'THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.' );
	return new THREE.BufferAttribute( data, itemSize );

};

THREE.Float32Attribute = function ( data, itemSize ) {

	console.warn( 'THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.' );
	return new THREE.BufferAttribute( data, itemSize );

};

THREE.Float64Attribute = function ( data, itemSize ) {

	console.warn( 'THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.' );
	return new THREE.BufferAttribute( data, itemSize );

};

// File:src/core/BufferGeometry.js

/**
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 */

THREE.BufferGeometry = function () {

	Object.defineProperty( this, 'id', { value: THREE.GeometryIdCount ++ } );

	this.uuid = THREE.Math.generateUUID();

	this.name = '';
	this.type = 'BufferGeometry';

	this.attributes = {};
	this.attributesKeys = [];

	this.drawcalls = [];
	this.offsets = this.drawcalls; // backwards compatibility

	this.boundingBox = null;
	this.boundingSphere = null;

};

THREE.BufferGeometry.prototype = {

	constructor: THREE.BufferGeometry,

	addAttribute: function ( name, attribute ) {

		if ( attribute instanceof THREE.BufferAttribute === false ) {

			console.warn( 'THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).' );

			this.attributes[ name ] = { array: arguments[ 1 ], itemSize: arguments[ 2 ] };

			return;

		}

		this.attributes[ name ] = attribute;
		this.attributesKeys = Object.keys( this.attributes );

	},

	getAttribute: function ( name ) {

		return this.attributes[ name ];

	},

	addDrawCall: function ( start, count, indexOffset ) {

		this.drawcalls.push( {

			start: start,
			count: count,
			index: indexOffset !== undefined ? indexOffset : 0

		} );

	},

	applyMatrix: function ( matrix ) {

		var position = this.attributes.position;

		if ( position !== undefined ) {

			matrix.applyToVector3Array( position.array );
			position.needsUpdate = true;

		}

		var normal = this.attributes.normal;

		if ( normal !== undefined ) {

			var normalMatrix = new THREE.Matrix3().getNormalMatrix( matrix );

			normalMatrix.applyToVector3Array( normal.array );
			normal.needsUpdate = true;

		}

	},

	center: function () {

		// TODO

	},

	fromGeometry: function ( geometry, settings ) {

		settings = settings || { 'vertexColors': THREE.NoColors };

		var vertices = geometry.vertices;
		var faces = geometry.faces;
		var faceVertexUvs = geometry.faceVertexUvs;
		var vertexColors = settings.vertexColors;
		var hasFaceVertexUv = faceVertexUvs[ 0 ].length > 0;
		var hasFaceVertexNormals = faces[ 0 ].vertexNormals.length == 3;

		var positions = new Float32Array( faces.length * 3 * 3 );
		this.addAttribute( 'position', new THREE.BufferAttribute( positions, 3 ) );

		var normals = new Float32Array( faces.length * 3 * 3 );
		this.addAttribute( 'normal', new THREE.BufferAttribute( normals, 3 ) );

		if ( vertexColors !== THREE.NoColors ) {

			var colors = new Float32Array( faces.length * 3 * 3 );
			this.addAttribute( 'color', new THREE.BufferAttribute( colors, 3 ) );

		}

		if ( hasFaceVertexUv === true ) {

			var uvs = new Float32Array( faces.length * 3 * 2 );
			this.addAttribute( 'uv', new THREE.BufferAttribute( uvs, 2 ) );

		}

		for ( var i = 0, i2 = 0, i3 = 0; i < faces.length; i ++, i2 += 6, i3 += 9 ) {

			var face = faces[ i ];

			var a = vertices[ face.a ];
			var b = vertices[ face.b ];
			var c = vertices[ face.c ];

			positions[ i3     ] = a.x;
			positions[ i3 + 1 ] = a.y;
			positions[ i3 + 2 ] = a.z;

			positions[ i3 + 3 ] = b.x;
			positions[ i3 + 4 ] = b.y;
			positions[ i3 + 5 ] = b.z;

			positions[ i3 + 6 ] = c.x;
			positions[ i3 + 7 ] = c.y;
			positions[ i3 + 8 ] = c.z;

			if ( hasFaceVertexNormals === true ) {

				var na = face.vertexNormals[ 0 ];
				var nb = face.vertexNormals[ 1 ];
				var nc = face.vertexNormals[ 2 ];

				normals[ i3     ] = na.x;
				normals[ i3 + 1 ] = na.y;
				normals[ i3 + 2 ] = na.z;

				normals[ i3 + 3 ] = nb.x;
				normals[ i3 + 4 ] = nb.y;
				normals[ i3 + 5 ] = nb.z;

				normals[ i3 + 6 ] = nc.x;
				normals[ i3 + 7 ] = nc.y;
				normals[ i3 + 8 ] = nc.z;

			} else {

				var n = face.normal;

				normals[ i3     ] = n.x;
				normals[ i3 + 1 ] = n.y;
				normals[ i3 + 2 ] = n.z;

				normals[ i3 + 3 ] = n.x;
				normals[ i3 + 4 ] = n.y;
				normals[ i3 + 5 ] = n.z;

				normals[ i3 + 6 ] = n.x;
				normals[ i3 + 7 ] = n.y;
				normals[ i3 + 8 ] = n.z;

			}

			if ( vertexColors === THREE.FaceColors ) {

				var fc = face.color;

				colors[ i3     ] = fc.r;
				colors[ i3 + 1 ] = fc.g;
				colors[ i3 + 2 ] = fc.b;

				colors[ i3 + 3 ] = fc.r;
				colors[ i3 + 4 ] = fc.g;
				colors[ i3 + 5 ] = fc.b;

				colors[ i3 + 6 ] = fc.r;
				colors[ i3 + 7 ] = fc.g;
				colors[ i3 + 8 ] = fc.b;

			} else if ( vertexColors === THREE.VertexColors ) {

				var vca = face.vertexColors[ 0 ];
				var vcb = face.vertexColors[ 1 ];
				var vcc = face.vertexColors[ 2 ];

				colors[ i3     ] = vca.r;
				colors[ i3 + 1 ] = vca.g;
				colors[ i3 + 2 ] = vca.b;

				colors[ i3 + 3 ] = vcb.r;
				colors[ i3 + 4 ] = vcb.g;
				colors[ i3 + 5 ] = vcb.b;

				colors[ i3 + 6 ] = vcc.r;
				colors[ i3 + 7 ] = vcc.g;
				colors[ i3 + 8 ] = vcc.b;

			}

			if ( hasFaceVertexUv === true ) {

				var uva = faceVertexUvs[ 0 ][ i ][ 0 ];
				var uvb = faceVertexUvs[ 0 ][ i ][ 1 ];
				var uvc = faceVertexUvs[ 0 ][ i ][ 2 ];

				uvs[ i2     ] = uva.x;
				uvs[ i2 + 1 ] = uva.y;

				uvs[ i2 + 2 ] = uvb.x;
				uvs[ i2 + 3 ] = uvb.y;

				uvs[ i2 + 4 ] = uvc.x;
				uvs[ i2 + 5 ] = uvc.y;

			}

		}

		this.computeBoundingSphere()

		return this;

	},

	computeBoundingBox: function () {

		var vector = new THREE.Vector3();

		return function () {

			if ( this.boundingBox === null ) {

				this.boundingBox = new THREE.Box3();

			}

			var positions = this.attributes.position.array;

			if ( positions ) {

				var bb = this.boundingBox;
				bb.makeEmpty();

				for ( var i = 0, il = positions.length; i < il; i += 3 ) {

					vector.set( positions[ i ], positions[ i + 1 ], positions[ i + 2 ] );
					bb.expandByPoint( vector );

				}

			}

			if ( positions === undefined || positions.length === 0 ) {

				this.boundingBox.min.set( 0, 0, 0 );
				this.boundingBox.max.set( 0, 0, 0 );

			}

			if ( isNaN( this.boundingBox.min.x ) || isNaN( this.boundingBox.min.y ) || isNaN( this.boundingBox.min.z ) ) {

				console.error( 'THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.' );

			}

		}

	}(),

	computeBoundingSphere: function () {

		var box = new THREE.Box3();
		var vector = new THREE.Vector3();

		return function () {

			if ( this.boundingSphere === null ) {

				this.boundingSphere = new THREE.Sphere();

			}

			var positions = this.attributes.position.array;

			if ( positions ) {

				box.makeEmpty();

				var center = this.boundingSphere.center;

				for ( var i = 0, il = positions.length; i < il; i += 3 ) {

					vector.set( positions[ i ], positions[ i + 1 ], positions[ i + 2 ] );
					box.expandByPoint( vector );

				}

				box.center( center );

				// hoping to find a boundingSphere with a radius smaller than the
				// boundingSphere of the boundingBox:  sqrt(3) smaller in the best case

				var maxRadiusSq = 0;

				for ( var i = 0, il = positions.length; i < il; i += 3 ) {

					vector.set( positions[ i ], positions[ i + 1 ], positions[ i + 2 ] );
					maxRadiusSq = Math.max( maxRadiusSq, center.distanceToSquared( vector ) );

				}

				this.boundingSphere.radius = Math.sqrt( maxRadiusSq );

				if ( isNaN( this.boundingSphere.radius ) ) {

					console.error( 'THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.' );

				}

			}

		}

	}(),

	computeFaceNormals: function () {

		// backwards compatibility

	},

	computeVertexNormals: function () {

		var attributes = this.attributes;

		if ( attributes.position ) {

			var positions = attributes.position.array;

			if ( attributes.normal === undefined ) {

				this.addAttribute( 'normal', new THREE.BufferAttribute( new Float32Array( positions.length ), 3 ) );

			} else {

				// reset existing normals to zero

				var normals = attributes.normal.array;

				for ( var i = 0, il = normals.length; i < il; i ++ ) {

					normals[ i ] = 0;

				}

			}

			var normals = attributes.normal.array;

			var vA, vB, vC,

			pA = new THREE.Vector3(),
			pB = new THREE.Vector3(),
			pC = new THREE.Vector3(),

			cb = new THREE.Vector3(),
			ab = new THREE.Vector3();

			// indexed elements

			if ( attributes.index ) {

				var indices = attributes.index.array;

				var offsets = ( this.offsets.length > 0 ? this.offsets : [ { start: 0, count: indices.length, index: 0 } ] );

				for ( var j = 0, jl = offsets.length; j < jl; ++ j ) {

					var start = offsets[ j ].start;
					var count = offsets[ j ].count;
					var index = offsets[ j ].index;

					for ( var i = start, il = start + count; i < il; i += 3 ) {

						vA = ( index + indices[ i     ] ) * 3;
						vB = ( index + indices[ i + 1 ] ) * 3;
						vC = ( index + indices[ i + 2 ] ) * 3;

						pA.fromArray( positions, vA );
						pB.fromArray( positions, vB );
						pC.fromArray( positions, vC );

						cb.subVectors( pC, pB );
						ab.subVectors( pA, pB );
						cb.cross( ab );

						normals[ vA     ] += cb.x;
						normals[ vA + 1 ] += cb.y;
						normals[ vA + 2 ] += cb.z;

						normals[ vB     ] += cb.x;
						normals[ vB + 1 ] += cb.y;
						normals[ vB + 2 ] += cb.z;

						normals[ vC     ] += cb.x;
						normals[ vC + 1 ] += cb.y;
						normals[ vC + 2 ] += cb.z;

					}

				}

			} else {

				// non-indexed elements (unconnected triangle soup)

				for ( var i = 0, il = positions.length; i < il; i += 9 ) {

					pA.fromArray( positions, i );
					pB.fromArray( positions, i + 3 );
					pC.fromArray( positions, i + 6 );

					cb.subVectors( pC, pB );
					ab.subVectors( pA, pB );
					cb.cross( ab );

					normals[ i     ] = cb.x;
					normals[ i + 1 ] = cb.y;
					normals[ i + 2 ] = cb.z;

					normals[ i + 3 ] = cb.x;
					normals[ i + 4 ] = cb.y;
					normals[ i + 5 ] = cb.z;

					normals[ i + 6 ] = cb.x;
					normals[ i + 7 ] = cb.y;
					normals[ i + 8 ] = cb.z;

				}

			}

			this.normalizeNormals();

			attributes.normal.needsUpdate = true;

		}

	},

	computeTangents: function () {

		// based on http://www.terathon.com/code/tangent.html
		// (per vertex tangents)

		if ( this.attributes.index === undefined ||
			 this.attributes.position === undefined ||
			 this.attributes.normal === undefined ||
			 this.attributes.uv === undefined ) {

			console.warn( 'Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()' );
			return;

		}

		var indices = this.attributes.index.array;
		var positions = this.attributes.position.array;
		var normals = this.attributes.normal.array;
		var uvs = this.attributes.uv.array;

		var nVertices = positions.length / 3;

		if ( this.attributes.tangent === undefined ) {

			this.addAttribute( 'tangent', new THREE.BufferAttribute( new Float32Array( 4 * nVertices ), 4 ) );

		}

		var tangents = this.attributes.tangent.array;

		var tan1 = [], tan2 = [];

		for ( var k = 0; k < nVertices; k ++ ) {

			tan1[ k ] = new THREE.Vector3();
			tan2[ k ] = new THREE.Vector3();

		}

		var vA = new THREE.Vector3(),
			vB = new THREE.Vector3(),
			vC = new THREE.Vector3(),

			uvA = new THREE.Vector2(),
			uvB = new THREE.Vector2(),
			uvC = new THREE.Vector2(),

			x1, x2, y1, y2, z1, z2,
			s1, s2, t1, t2, r;

		var sdir = new THREE.Vector3(), tdir = new THREE.Vector3();

		function handleTriangle( a, b, c ) {

			vA.fromArray( positions, a * 3 );
			vB.fromArray( positions, b * 3 );
			vC.fromArray( positions, c * 3 );

			uvA.fromArray( uvs, a * 2 );
			uvB.fromArray( uvs, b * 2 );
			uvC.fromArray( uvs, c * 2 );

			x1 = vB.x - vA.x;
			x2 = vC.x - vA.x;

			y1 = vB.y - vA.y;
			y2 = vC.y - vA.y;

			z1 = vB.z - vA.z;
			z2 = vC.z - vA.z;

			s1 = uvB.x - uvA.x;
			s2 = uvC.x - uvA.x;

			t1 = uvB.y - uvA.y;
			t2 = uvC.y - uvA.y;

			r = 1.0 / ( s1 * t2 - s2 * t1 );

			sdir.set(
				( t2 * x1 - t1 * x2 ) * r,
				( t2 * y1 - t1 * y2 ) * r,
				( t2 * z1 - t1 * z2 ) * r
			);

			tdir.set(
				( s1 * x2 - s2 * x1 ) * r,
				( s1 * y2 - s2 * y1 ) * r,
				( s1 * z2 - s2 * z1 ) * r
			);

			tan1[ a ].add( sdir );
			tan1[ b ].add( sdir );
			tan1[ c ].add( sdir );

			tan2[ a ].add( tdir );
			tan2[ b ].add( tdir );
			tan2[ c ].add( tdir );

		}

		var i, il;
		var j, jl;
		var iA, iB, iC;

		if ( this.drawcalls.length === 0 ) {

			this.addDrawCall( 0, indices.length, 0 );

		}

		var drawcalls = this.drawcalls;

		for ( j = 0, jl = drawcalls.length; j < jl; ++ j ) {

			var start = drawcalls[ j ].start;
			var count = drawcalls[ j ].count;
			var index = drawcalls[ j ].index;

			for ( i = start, il = start + count; i < il; i += 3 ) {

				iA = index + indices[ i ];
				iB = index + indices[ i + 1 ];
				iC = index + indices[ i + 2 ];

				handleTriangle( iA, iB, iC );

			}

		}

		var tmp = new THREE.Vector3(), tmp2 = new THREE.Vector3();
		var n = new THREE.Vector3(), n2 = new THREE.Vector3();
		var w, t, test;

		function handleVertex( v ) {

			n.fromArray( normals, v * 3 );
			n2.copy( n );

			t = tan1[ v ];

			// Gram-Schmidt orthogonalize

			tmp.copy( t );
			tmp.sub( n.multiplyScalar( n.dot( t ) ) ).normalize();

			// Calculate handedness

			tmp2.crossVectors( n2, t );
			test = tmp2.dot( tan2[ v ] );
			w = ( test < 0.0 ) ? - 1.0 : 1.0;

			tangents[ v * 4     ] = tmp.x;
			tangents[ v * 4 + 1 ] = tmp.y;
			tangents[ v * 4 + 2 ] = tmp.z;
			tangents[ v * 4 + 3 ] = w;

		}

		for ( j = 0, jl = drawcalls.length; j < jl; ++ j ) {

			var start = drawcalls[ j ].start;
			var count = drawcalls[ j ].count;
			var index = drawcalls[ j ].index;

			for ( i = start, il = start + count; i < il; i += 3 ) {

				iA = index + indices[ i ];
				iB = index + indices[ i + 1 ];
				iC = index + indices[ i + 2 ];

				handleVertex( iA );
				handleVertex( iB );
				handleVertex( iC );

			}

		}

	},

	/*
		computeOffsets
		Compute the draw offset for large models by chunking the index buffer into chunks of 65k addressable vertices.
		This method will effectively rewrite the index buffer and remap all attributes to match the new indices.
		WARNING: This method will also expand the vertex count to prevent sprawled triangles across draw offsets.
		indexBufferSize - Defaults to 65535, but allows for larger or smaller chunks.
	*/
	computeOffsets: function ( indexBufferSize ) {

		var size = indexBufferSize;
		if ( indexBufferSize === undefined )
			size = 65535; //WebGL limits type of index buffer values to 16-bit.

		var s = Date.now();

		var indices = this.attributes.index.array;
		var vertices = this.attributes.position.array;

		var verticesCount = ( vertices.length / 3 );
		var facesCount = ( indices.length / 3 );

		/*
		console.log("Computing buffers in offsets of "+size+" -> indices:"+indices.length+" vertices:"+vertices.length);
		console.log("Faces to process: "+(indices.length/3));
		console.log("Reordering "+verticesCount+" vertices.");
		*/

		var sortedIndices = new Uint16Array( indices.length ); //16-bit buffers
		var indexPtr = 0;
		var vertexPtr = 0;

		var offsets = [ { start:0, count:0, index:0 } ];
		var offset = offsets[ 0 ];

		var duplicatedVertices = 0;
		var newVerticeMaps = 0;
		var faceVertices = new Int32Array( 6 );
		var vertexMap = new Int32Array( vertices.length );
		var revVertexMap = new Int32Array( vertices.length );
		for ( var j = 0; j < vertices.length; j ++ ) { vertexMap[ j ] = - 1; revVertexMap[ j ] = - 1; }

		/*
			Traverse every face and reorder vertices in the proper offsets of 65k.
			We can have more than 65k entries in the index buffer per offset, but only reference 65k values.
		*/
		for ( var findex = 0; findex < facesCount; findex ++ ) {
			newVerticeMaps = 0;

			for ( var vo = 0; vo < 3; vo ++ ) {
				var vid = indices[ findex * 3 + vo ];
				if ( vertexMap[ vid ] == - 1 ) {
					//Unmapped vertice
					faceVertices[ vo * 2 ] = vid;
					faceVertices[ vo * 2 + 1 ] = - 1;
					newVerticeMaps ++;
				} else if ( vertexMap[ vid ] < offset.index ) {
					//Reused vertices from previous block (duplicate)
					faceVertices[ vo * 2 ] = vid;
					faceVertices[ vo * 2 + 1 ] = - 1;
					duplicatedVertices ++;
				} else {
					//Reused vertice in the current block
					faceVertices[ vo * 2 ] = vid;
					faceVertices[ vo * 2 + 1 ] = vertexMap[ vid ];
				}
			}

			var faceMax = vertexPtr + newVerticeMaps;
			if ( faceMax > ( offset.index + size ) ) {
				var new_offset = { start:indexPtr, count:0, index:vertexPtr };
				offsets.push( new_offset );
				offset = new_offset;

				//Re-evaluate reused vertices in light of new offset.
				for ( var v = 0; v < 6; v += 2 ) {
					var new_vid = faceVertices[ v + 1 ];
					if ( new_vid > - 1 && new_vid < offset.index )
						faceVertices[ v + 1 ] = - 1;
				}
			}

			//Reindex the face.
			for ( var v = 0; v < 6; v += 2 ) {
				var vid = faceVertices[ v ];
				var new_vid = faceVertices[ v + 1 ];

				if ( new_vid === - 1 )
					new_vid = vertexPtr ++;

				vertexMap[ vid ] = new_vid;
				revVertexMap[ new_vid ] = vid;
				sortedIndices[ indexPtr ++ ] = new_vid - offset.index; //XXX overflows at 16bit
				offset.count ++;
			}
		}

		/* Move all attribute values to map to the new computed indices , also expand the vertice stack to match our new vertexPtr. */
		this.reorderBuffers( sortedIndices, revVertexMap, vertexPtr );
		this.offsets = offsets;

		/*
		var orderTime = Date.now();
		console.log("Reorder time: "+(orderTime-s)+"ms");
		console.log("Duplicated "+duplicatedVertices+" vertices.");
		console.log("Compute Buffers time: "+(Date.now()-s)+"ms");
		console.log("Draw offsets: "+offsets.length);
		*/

		return offsets;
	},

	merge: function () {

		console.log( 'BufferGeometry.merge(): TODO' );

	},

	normalizeNormals: function () {

		var normals = this.attributes.normal.array;

		var x, y, z, n;

		for ( var i = 0, il = normals.length; i < il; i += 3 ) {

			x = normals[ i ];
			y = normals[ i + 1 ];
			z = normals[ i + 2 ];

			n = 1.0 / Math.sqrt( x * x + y * y + z * z );

			normals[ i     ] *= n;
			normals[ i + 1 ] *= n;
			normals[ i + 2 ] *= n;

		}

	},

	/*
		reoderBuffers:
		Reorder attributes based on a new indexBuffer and indexMap.
		indexBuffer - Uint16Array of the new ordered indices.
		indexMap - Int32Array where the position is the new vertex ID and the value the old vertex ID for each vertex.
		vertexCount - Amount of total vertices considered in this reordering (in case you want to grow the vertice stack).
	*/
	reorderBuffers: function ( indexBuffer, indexMap, vertexCount ) {

		/* Create a copy of all attributes for reordering. */
		var sortedAttributes = {};
		for ( var attr in this.attributes ) {
			if ( attr == 'index' )
				continue;
			var sourceArray = this.attributes[ attr ].array;
			sortedAttributes[ attr ] = new sourceArray.constructor( this.attributes[ attr ].itemSize * vertexCount );
		}

		/* Move attribute positions based on the new index map */
		for ( var new_vid = 0; new_vid < vertexCount; new_vid ++ ) {
			var vid = indexMap[ new_vid ];
			for ( var attr in this.attributes ) {
				if ( attr == 'index' )
					continue;
				var attrArray = this.attributes[ attr ].array;
				var attrSize = this.attributes[ attr ].itemSize;
				var sortedAttr = sortedAttributes[ attr ];
				for ( var k = 0; k < attrSize; k ++ )
					sortedAttr[ new_vid * attrSize + k ] = attrArray[ vid * attrSize + k ];
			}
		}

		/* Carry the new sorted buffers locally */
		this.attributes[ 'index' ].array = indexBuffer;
		for ( var attr in this.attributes ) {
			if ( attr == 'index' )
				continue;
			this.attributes[ attr ].array = sortedAttributes[ attr ];
			this.attributes[ attr ].numItems = this.attributes[ attr ].itemSize * vertexCount;
		}
	},

	toJSON: function () {

		var output = {
			metadata: {
				version: 4.0,
				type: 'BufferGeometry',
				generator: 'BufferGeometryExporter'
			},
			uuid: this.uuid,
			type: this.type,
			data: {
				attributes: {}
			}
		};

		var attributes = this.attributes;
		var offsets = this.offsets;
		var boundingSphere = this.boundingSphere;

		for ( var key in attributes ) {

			var attribute = attributes[ key ];

			var array = [], typeArray = attribute.array;

			for ( var i = 0, l = typeArray.length; i < l; i ++ ) {

				array[ i ] = typeArray[ i ];

			}

			output.data.attributes[ key ] = {
				itemSize: attribute.itemSize,
				type: attribute.array.constructor.name,
				array: array
			}

		}

		if ( offsets.length > 0 ) {

			output.data.offsets = JSON.parse( JSON.stringify( offsets ) );

		}

		if ( boundingSphere !== null ) {

			output.data.boundingSphere = {
				center: boundingSphere.center.toArray(),
				radius: boundingSphere.radius
			}

		}

		return output;

	},

	clone: function () {

		var geometry = new THREE.BufferGeometry();

		for ( var attr in this.attributes ) {

			var sourceAttr = this.attributes[ attr ];
			geometry.addAttribute( attr, sourceAttr.clone() );

		}

		for ( var i = 0, il = this.offsets.length; i < il; i ++ ) {

			var offset = this.offsets[ i ];

			geometry.offsets.push( {

				start: offset.start,
				index: offset.index,
				count: offset.count

			} );

		}

		return geometry;

	},

	dispose: function () {

		this.dispatchEvent( { type: 'dispose' } );

	}

};

THREE.EventDispatcher.prototype.apply( THREE.BufferGeometry.prototype );

// File:src/core/Geometry.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author kile / http://kile.stravaganza.org/
 * @author alteredq / http://alteredqualia.com/
 * @author mikael emtinger / http://gomo.se/
 * @author zz85 / http://www.lab4games.net/zz85/blog
 * @author bhouston / http://exocortex.com
 */

THREE.Geometry = function () {

	Object.defineProperty( this, 'id', { value: THREE.GeometryIdCount ++ } );

	this.uuid = THREE.Math.generateUUID();

	this.name = '';
	this.type = 'Geometry';

	this.vertices = [];
	this.colors = [];  // one-to-one vertex colors, used in Points and Line

	this.faces = [];

	this.faceVertexUvs = [ [] ];

	this.morphTargets = [];
	this.morphColors = [];
	this.morphNormals = [];

	this.skinWeights = [];
	this.skinIndices = [];

	this.lineDistances = [];

	this.boundingBox = null;
	this.boundingSphere = null;

	this.hasTangents = false;

	this.dynamic = true; // the intermediate typed arrays will be deleted when set to false

	// update flags

	this.verticesNeedUpdate = false;
	this.elementsNeedUpdate = false;
	this.uvsNeedUpdate = false;
	this.normalsNeedUpdate = false;
	this.tangentsNeedUpdate = false;
	this.colorsNeedUpdate = false;
	this.lineDistancesNeedUpdate = false;

	this.groupsNeedUpdate = false;

};

THREE.Geometry.prototype = {

	constructor: THREE.Geometry,

	applyMatrix: function ( matrix ) {

		var normalMatrix = new THREE.Matrix3().getNormalMatrix( matrix );

		for ( var i = 0, il = this.vertices.length; i < il; i ++ ) {

			var vertex = this.vertices[ i ];
			vertex.applyMatrix4( matrix );

		}

		for ( var i = 0, il = this.faces.length; i < il; i ++ ) {

			var face = this.faces[ i ];
			face.normal.applyMatrix3( normalMatrix ).normalize();

			for ( var j = 0, jl = face.vertexNormals.length; j < jl; j ++ ) {

				face.vertexNormals[ j ].applyMatrix3( normalMatrix ).normalize();

			}

		}

		if ( this.boundingBox instanceof THREE.Box3 ) {

			this.computeBoundingBox();

		}

		if ( this.boundingSphere instanceof THREE.Sphere ) {

			this.computeBoundingSphere();

		}

	},

	fromBufferGeometry: function ( geometry ) {

		var scope = this;

		var attributes = geometry.attributes;

		var vertices = attributes.position.array;
		var indices = attributes.index !== undefined ? attributes.index.array : undefined;
		var normals = attributes.normal !== undefined ? attributes.normal.array : undefined;
		var colors = attributes.color !== undefined ? attributes.color.array : undefined;
		var uvs = attributes.uv !== undefined ? attributes.uv.array : undefined;

		var tempNormals = [];
		var tempUVs = [];

		for ( var i = 0, j = 0; i < vertices.length; i += 3, j += 2 ) {

			scope.vertices.push( new THREE.Vector3( vertices[ i ], vertices[ i + 1 ], vertices[ i + 2 ] ) );

			if ( normals !== undefined ) {

				tempNormals.push( new THREE.Vector3( normals[ i ], normals[ i + 1 ], normals[ i + 2 ] ) );

			}

			if ( colors !== undefined ) {

				scope.colors.push( new THREE.Color( colors[ i ], colors[ i + 1 ], colors[ i + 2 ] ) );

			}

			if ( uvs !== undefined ) {

				tempUVs.push( new THREE.Vector2( uvs[ j ], uvs[ j + 1 ] ) );

			}

		}

		var addFace = function ( a, b, c ) {

			var vertexNormals = normals !== undefined ? [ tempNormals[ a ].clone(), tempNormals[ b ].clone(), tempNormals[ c ].clone() ] : [];
			var vertexColors = colors !== undefined ? [ scope.colors[ a ].clone(), scope.colors[ b ].clone(), scope.colors[ c ].clone() ] : [];

			scope.faces.push( new THREE.Face3( a, b, c, vertexNormals, vertexColors ) );
			scope.faceVertexUvs[ 0 ].push( [ tempUVs[ a ], tempUVs[ b ], tempUVs[ c ] ] );

		};

		if ( indices !== undefined ) {

			for ( var i = 0; i < indices.length; i += 3 ) {

				addFace( indices[ i ], indices[ i + 1 ], indices[ i + 2 ] );

			}

		} else {

			for ( var i = 0; i < vertices.length / 3; i += 3 ) {

				addFace( i, i + 1, i + 2 );

			}

		}
		
		this.computeFaceNormals();

		if ( geometry.boundingBox !== null ) {

			this.boundingBox = geometry.boundingBox.clone();

		}

		if ( geometry.boundingSphere !== null ) {

			this.boundingSphere = geometry.boundingSphere.clone();

		}

		return this;

	},

	center: function () {

		this.computeBoundingBox();

		var offset = new THREE.Vector3();

		offset.addVectors( this.boundingBox.min, this.boundingBox.max );
		offset.multiplyScalar( - 0.5 );

		this.applyMatrix( new THREE.Matrix4().makeTranslation( offset.x, offset.y, offset.z ) );
		this.computeBoundingBox();

		return offset;

	},

	computeFaceNormals: function () {

		var cb = new THREE.Vector3(), ab = new THREE.Vector3();

		for ( var f = 0, fl = this.faces.length; f < fl; f ++ ) {

			var face = this.faces[ f ];

			var vA = this.vertices[ face.a ];
			var vB = this.vertices[ face.b ];
			var vC = this.vertices[ face.c ];

			cb.subVectors( vC, vB );
			ab.subVectors( vA, vB );
			cb.cross( ab );

			cb.normalize();

			face.normal.copy( cb );

		}

	},

	computeVertexNormals: function ( areaWeighted ) {

		var v, vl, f, fl, face, vertices;

		vertices = new Array( this.vertices.length );

		for ( v = 0, vl = this.vertices.length; v < vl; v ++ ) {

			vertices[ v ] = new THREE.Vector3();

		}

		if ( areaWeighted ) {

			// vertex normals weighted by triangle areas
			// http://www.iquilezles.org/www/articles/normals/normals.htm

			var vA, vB, vC, vD;
			var cb = new THREE.Vector3(), ab = new THREE.Vector3(),
				db = new THREE.Vector3(), dc = new THREE.Vector3(), bc = new THREE.Vector3();

			for ( f = 0, fl = this.faces.length; f < fl; f ++ ) {

				face = this.faces[ f ];

				vA = this.vertices[ face.a ];
				vB = this.vertices[ face.b ];
				vC = this.vertices[ face.c ];

				cb.subVectors( vC, vB );
				ab.subVectors( vA, vB );
				cb.cross( ab );

				vertices[ face.a ].add( cb );
				vertices[ face.b ].add( cb );
				vertices[ face.c ].add( cb );

			}

		} else {

			for ( f = 0, fl = this.faces.length; f < fl; f ++ ) {

				face = this.faces[ f ];

				vertices[ face.a ].add( face.normal );
				vertices[ face.b ].add( face.normal );
				vertices[ face.c ].add( face.normal );

			}

		}

		for ( v = 0, vl = this.vertices.length; v < vl; v ++ ) {

			vertices[ v ].normalize();

		}

		for ( f = 0, fl = this.faces.length; f < fl; f ++ ) {

			face = this.faces[ f ];

			face.vertexNormals[ 0 ] = vertices[ face.a ].clone();
			face.vertexNormals[ 1 ] = vertices[ face.b ].clone();
			face.vertexNormals[ 2 ] = vertices[ face.c ].clone();

		}

	},

	computeMorphNormals: function () {

		var i, il, f, fl, face;

		// save original normals
		// - create temp variables on first access
		//   otherwise just copy (for faster repeated calls)

		for ( f = 0, fl = this.faces.length; f < fl; f ++ ) {

			face = this.faces[ f ];

			if ( ! face.__originalFaceNormal ) {

				face.__originalFaceNormal = face.normal.clone();

			} else {

				face.__originalFaceNormal.copy( face.normal );

			}

			if ( ! face.__originalVertexNormals ) face.__originalVertexNormals = [];

			for ( i = 0, il = face.vertexNormals.length; i < il; i ++ ) {

				if ( ! face.__originalVertexNormals[ i ] ) {

					face.__originalVertexNormals[ i ] = face.vertexNormals[ i ].clone();

				} else {

					face.__originalVertexNormals[ i ].copy( face.vertexNormals[ i ] );

				}

			}

		}

		// use temp geometry to compute face and vertex normals for each morph

		var tmpGeo = new THREE.Geometry();
		tmpGeo.faces = this.faces;

		for ( i = 0, il = this.morphTargets.length; i < il; i ++ ) {

			// create on first access

			if ( ! this.morphNormals[ i ] ) {

				this.morphNormals[ i ] = {};
				this.morphNormals[ i ].faceNormals = [];
				this.morphNormals[ i ].vertexNormals = [];

				var dstNormalsFace = this.morphNormals[ i ].faceNormals;
				var dstNormalsVertex = this.morphNormals[ i ].vertexNormals;

				var faceNormal, vertexNormals;

				for ( f = 0, fl = this.faces.length; f < fl; f ++ ) {

					faceNormal = new THREE.Vector3();
					vertexNormals = { a: new THREE.Vector3(), b: new THREE.Vector3(), c: new THREE.Vector3() };

					dstNormalsFace.push( faceNormal );
					dstNormalsVertex.push( vertexNormals );

				}

			}

			var morphNormals = this.morphNormals[ i ];

			// set vertices to morph target

			tmpGeo.vertices = this.morphTargets[ i ].vertices;

			// compute morph normals

			tmpGeo.computeFaceNormals();
			tmpGeo.computeVertexNormals();

			// store morph normals

			var faceNormal, vertexNormals;

			for ( f = 0, fl = this.faces.length; f < fl; f ++ ) {

				face = this.faces[ f ];

				faceNormal = morphNormals.faceNormals[ f ];
				vertexNormals = morphNormals.vertexNormals[ f ];

				faceNormal.copy( face.normal );

				vertexNormals.a.copy( face.vertexNormals[ 0 ] );
				vertexNormals.b.copy( face.vertexNormals[ 1 ] );
				vertexNormals.c.copy( face.vertexNormals[ 2 ] );

			}

		}

		// restore original normals

		for ( f = 0, fl = this.faces.length; f < fl; f ++ ) {

			face = this.faces[ f ];

			face.normal = face.__originalFaceNormal;
			face.vertexNormals = face.__originalVertexNormals;

		}

	},

	computeTangents: function () {

		// based on http://www.terathon.com/code/tangent.html
		// tangents go to vertices

		var f, fl, v, vl, i, il, vertexIndex,
			face, uv, vA, vB, vC, uvA, uvB, uvC,
			x1, x2, y1, y2, z1, z2,
			s1, s2, t1, t2, r, t, test,
			tan1 = [], tan2 = [],
			sdir = new THREE.Vector3(), tdir = new THREE.Vector3(),
			tmp = new THREE.Vector3(), tmp2 = new THREE.Vector3(),
			n = new THREE.Vector3(), w;

		for ( v = 0, vl = this.vertices.length; v < vl; v ++ ) {

			tan1[ v ] = new THREE.Vector3();
			tan2[ v ] = new THREE.Vector3();

		}

		function handleTriangle( context, a, b, c, ua, ub, uc ) {

			vA = context.vertices[ a ];
			vB = context.vertices[ b ];
			vC = context.vertices[ c ];

			uvA = uv[ ua ];
			uvB = uv[ ub ];
			uvC = uv[ uc ];

			x1 = vB.x - vA.x;
			x2 = vC.x - vA.x;
			y1 = vB.y - vA.y;
			y2 = vC.y - vA.y;
			z1 = vB.z - vA.z;
			z2 = vC.z - vA.z;

			s1 = uvB.x - uvA.x;
			s2 = uvC.x - uvA.x;
			t1 = uvB.y - uvA.y;
			t2 = uvC.y - uvA.y;

			r = 1.0 / ( s1 * t2 - s2 * t1 );
			sdir.set( ( t2 * x1 - t1 * x2 ) * r,
					  ( t2 * y1 - t1 * y2 ) * r,
					  ( t2 * z1 - t1 * z2 ) * r );
			tdir.set( ( s1 * x2 - s2 * x1 ) * r,
					  ( s1 * y2 - s2 * y1 ) * r,
					  ( s1 * z2 - s2 * z1 ) * r );

			tan1[ a ].add( sdir );
			tan1[ b ].add( sdir );
			tan1[ c ].add( sdir );

			tan2[ a ].add( tdir );
			tan2[ b ].add( tdir );
			tan2[ c ].add( tdir );

		}

		for ( f = 0, fl = this.faces.length; f < fl; f ++ ) {

			face = this.faces[ f ];
			uv = this.faceVertexUvs[ 0 ][ f ]; // use UV layer 0 for tangents

			handleTriangle( this, face.a, face.b, face.c, 0, 1, 2 );

		}

		var faceIndex = [ 'a', 'b', 'c', 'd' ];

		for ( f = 0, fl = this.faces.length; f < fl; f ++ ) {

			face = this.faces[ f ];

			for ( i = 0; i < Math.min( face.vertexNormals.length, 3 ); i ++ ) {

				n.copy( face.vertexNormals[ i ] );

				vertexIndex = face[ faceIndex[ i ] ];

				t = tan1[ vertexIndex ];

				// Gram-Schmidt orthogonalize

				tmp.copy( t );
				tmp.sub( n.multiplyScalar( n.dot( t ) ) ).normalize();

				// Calculate handedness

				tmp2.crossVectors( face.vertexNormals[ i ], t );
				test = tmp2.dot( tan2[ vertexIndex ] );
				w = ( test < 0.0 ) ? - 1.0 : 1.0;

				face.vertexTangents[ i ] = new THREE.Vector4( tmp.x, tmp.y, tmp.z, w );

			}

		}

		this.hasTangents = true;

	},

	computeLineDistances: function () {

		var d = 0;
		var vertices = this.vertices;

		for ( var i = 0, il = vertices.length; i < il; i ++ ) {

			if ( i > 0 ) {

				d += vertices[ i ].distanceTo( vertices[ i - 1 ] );

			}

			this.lineDistances[ i ] = d;

		}

	},

	computeBoundingBox: function () {

		if ( this.boundingBox === null ) {

			this.boundingBox = new THREE.Box3();

		}

		this.boundingBox.setFromPoints( this.vertices );

	},

	computeBoundingSphere: function () {

		if ( this.boundingSphere === null ) {

			this.boundingSphere = new THREE.Sphere();

		}

		this.boundingSphere.setFromPoints( this.vertices );

	},

	merge: function ( geometry, matrix, materialIndexOffset ) {

		if ( geometry instanceof THREE.Geometry === false ) {

			console.error( 'THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.', geometry );
			return;

		}

		var normalMatrix,
		vertexOffset = this.vertices.length,
		vertices1 = this.vertices,
		vertices2 = geometry.vertices,
		faces1 = this.faces,
		faces2 = geometry.faces,
		uvs1 = this.faceVertexUvs[ 0 ],
		uvs2 = geometry.faceVertexUvs[ 0 ];

		if ( materialIndexOffset === undefined ) materialIndexOffset = 0;

		if ( matrix !== undefined ) {

			normalMatrix = new THREE.Matrix3().getNormalMatrix( matrix );

		}

		// vertices

		for ( var i = 0, il = vertices2.length; i < il; i ++ ) {

			var vertex = vertices2[ i ];

			var vertexCopy = vertex.clone();

			if ( matrix !== undefined ) vertexCopy.applyMatrix4( matrix );

			vertices1.push( vertexCopy );

		}

		// faces

		for ( i = 0, il = faces2.length; i < il; i ++ ) {

			var face = faces2[ i ], faceCopy, normal, color,
			faceVertexNormals = face.vertexNormals,
			faceVertexColors = face.vertexColors;

			faceCopy = new THREE.Face3( face.a + vertexOffset, face.b + vertexOffset, face.c + vertexOffset );
			faceCopy.normal.copy( face.normal );

			if ( normalMatrix !== undefined ) {

				faceCopy.normal.applyMatrix3( normalMatrix ).normalize();

			}

			for ( var j = 0, jl = faceVertexNormals.length; j < jl; j ++ ) {

				normal = faceVertexNormals[ j ].clone();

				if ( normalMatrix !== undefined ) {

					normal.applyMatrix3( normalMatrix ).normalize();

				}

				faceCopy.vertexNormals.push( normal );

			}

			faceCopy.color.copy( face.color );

			for ( var j = 0, jl = faceVertexColors.length; j < jl; j ++ ) {

				color = faceVertexColors[ j ];
				faceCopy.vertexColors.push( color.clone() );

			}

			faceCopy.materialIndex = face.materialIndex + materialIndexOffset;

			faces1.push( faceCopy );

		}

		// uvs

		for ( i = 0, il = uvs2.length; i < il; i ++ ) {

			var uv = uvs2[ i ], uvCopy = [];

			if ( uv === undefined ) {

				continue;

			}

			for ( var j = 0, jl = uv.length; j < jl; j ++ ) {

				uvCopy.push( new THREE.Vector2( uv[ j ].x, uv[ j ].y ) );

			}

			uvs1.push( uvCopy );

		}

	},

	/*
	 * Checks for duplicate vertices with hashmap.
	 * Duplicated vertices are removed
	 * and faces' vertices are updated.
	 */

	mergeVertices: function () {

		var verticesMap = {}; // Hashmap for looking up vertice by position coordinates (and making sure they are unique)
		var unique = [], changes = [];

		var v, key;
		var precisionPoints = 4; // number of decimal points, eg. 4 for epsilon of 0.0001
		var precision = Math.pow( 10, precisionPoints );
		var i,il, face;
		var indices, k, j, jl, u;

		for ( i = 0, il = this.vertices.length; i < il; i ++ ) {

			v = this.vertices[ i ];
			key = Math.round( v.x * precision ) + '_' + Math.round( v.y * precision ) + '_' + Math.round( v.z * precision );

			if ( verticesMap[ key ] === undefined ) {

				verticesMap[ key ] = i;
				unique.push( this.vertices[ i ] );
				changes[ i ] = unique.length - 1;

			} else {

				//console.log('Duplicate vertex found. ', i, ' could be using ', verticesMap[key]);
				changes[ i ] = changes[ verticesMap[ key ] ];

			}

		};


		// if faces are completely degenerate after merging vertices, we
		// have to remove them from the geometry.
		var faceIndicesToRemove = [];

		for ( i = 0, il = this.faces.length; i < il; i ++ ) {

			face = this.faces[ i ];

			face.a = changes[ face.a ];
			face.b = changes[ face.b ];
			face.c = changes[ face.c ];

			indices = [ face.a, face.b, face.c ];

			var dupIndex = - 1;

			// if any duplicate vertices are found in a Face3
			// we have to remove the face as nothing can be saved
			for ( var n = 0; n < 3; n ++ ) {
				if ( indices[ n ] == indices[ ( n + 1 ) % 3 ] ) {

					dupIndex = n;
					faceIndicesToRemove.push( i );
					break;

				}
			}

		}

		for ( i = faceIndicesToRemove.length - 1; i >= 0; i -- ) {
			var idx = faceIndicesToRemove[ i ];

			this.faces.splice( idx, 1 );

			for ( j = 0, jl = this.faceVertexUvs.length; j < jl; j ++ ) {

				this.faceVertexUvs[ j ].splice( idx, 1 );

			}

		}

		// Use unique set of vertices

		var diff = this.vertices.length - unique.length;
		this.vertices = unique;
		return diff;

	},

	toJSON: function () {

		var output = {
			metadata: {
				version: 4.0,
				type: 'BufferGeometry',
				generator: 'BufferGeometryExporter'
			},
			uuid: this.uuid,
			type: this.type
		};

		if ( this.name !== "" ) output.name = this.name;

		if ( this.parameters !== undefined ) {

			var parameters = this.parameters;

			for ( var key in parameters ) {

				if ( parameters[ key ] !== undefined ) output[ key ] = parameters[ key ];

			}

			return output;

		}

		var vertices = [];

		for ( var i = 0; i < this.vertices.length; i ++ ) {

			var vertex = this.vertices[ i ];
			vertices.push( vertex.x, vertex.y, vertex.z );

		}

		var faces = [];
		var normals = [];
		var normalsHash = {};
		var colors = [];
		var colorsHash = {};
		var uvs = [];
		var uvsHash = {};

		for ( var i = 0; i < this.faces.length; i ++ ) {

			var face = this.faces[ i ];

			var hasMaterial = false; // face.materialIndex !== undefined;
			var hasFaceUv = false; // deprecated
			var hasFaceVertexUv = this.faceVertexUvs[ 0 ][ i ] !== undefined;
			var hasFaceNormal = face.normal.length() > 0;
			var hasFaceVertexNormal = face.vertexNormals.length > 0;
			var hasFaceColor = face.color.r !== 1 || face.color.g !== 1 || face.color.b !== 1;
			var hasFaceVertexColor = face.vertexColors.length > 0;

			var faceType = 0;

			faceType = setBit( faceType, 0, 0 );
			faceType = setBit( faceType, 1, hasMaterial );
			faceType = setBit( faceType, 2, hasFaceUv );
			faceType = setBit( faceType, 3, hasFaceVertexUv );
			faceType = setBit( faceType, 4, hasFaceNormal );
			faceType = setBit( faceType, 5, hasFaceVertexNormal );
			faceType = setBit( faceType, 6, hasFaceColor );
			faceType = setBit( faceType, 7, hasFaceVertexColor );

			faces.push( faceType );
			faces.push( face.a, face.b, face.c );


			/*
			if ( hasMaterial ) {

				faces.push( face.materialIndex );

			}
			*/

			if ( hasFaceVertexUv ) {

				var faceVertexUvs = this.faceVertexUvs[ 0 ][ i ];

				faces.push(
					getUvIndex( faceVertexUvs[ 0 ] ),
					getUvIndex( faceVertexUvs[ 1 ] ),
					getUvIndex( faceVertexUvs[ 2 ] )
				);

			}

			if ( hasFaceNormal ) {

				faces.push( getNormalIndex( face.normal ) );

			}

			if ( hasFaceVertexNormal ) {

				var vertexNormals = face.vertexNormals;

				faces.push(
					getNormalIndex( vertexNormals[ 0 ] ),
					getNormalIndex( vertexNormals[ 1 ] ),
					getNormalIndex( vertexNormals[ 2 ] )
				);

			}

			if ( hasFaceColor ) {

				faces.push( getColorIndex( face.color ) );

			}

			if ( hasFaceVertexColor ) {

				var vertexColors = face.vertexColors;

				faces.push(
					getColorIndex( vertexColors[ 0 ] ),
					getColorIndex( vertexColors[ 1 ] ),
					getColorIndex( vertexColors[ 2 ] )
				);

			}

		}

		function setBit( value, position, enabled ) {

			return enabled ? value | ( 1 << position ) : value & ( ~ ( 1 << position) );

		}

		function getNormalIndex( normal ) {

			var hash = normal.x.toString() + normal.y.toString() + normal.z.toString();

			if ( normalsHash[ hash ] !== undefined ) {

				return normalsHash[ hash ];

			}

			normalsHash[ hash ] = normals.length / 3;
			normals.push( normal.x, normal.y, normal.z );

			return normalsHash[ hash ];

		}

		function getColorIndex( color ) {

			var hash = color.r.toString() + color.g.toString() + color.b.toString();

			if ( colorsHash[ hash ] !== undefined ) {

				return colorsHash[ hash ];

			}

			colorsHash[ hash ] = colors.length;
			colors.push( color.getHex() );

			return colorsHash[ hash ];

		}

		function getUvIndex( uv ) {

			var hash = uv.x.toString() + uv.y.toString();

			if ( uvsHash[ hash ] !== undefined ) {

				return uvsHash[ hash ];

			}

			uvsHash[ hash ] = uvs.length / 2;
			uvs.push( uv.x, uv.y );

			return uvsHash[ hash ];

		}

		output.data = {};

		output.data.vertices = vertices;
		output.data.normals = normals;
		if ( colors.length > 0 ) output.data.colors = colors;
		if ( uvs.length > 0 ) output.data.uvs = [ uvs ]; // temporal backward compatibility
		output.data.faces = faces;

		//

		return output;

	},

	clone: function () {

		var geometry = new THREE.Geometry();

		var vertices = this.vertices;

		for ( var i = 0, il = vertices.length; i < il; i ++ ) {

			geometry.vertices.push( vertices[ i ].clone() );

		}

		var faces = this.faces;

		for ( var i = 0, il = faces.length; i < il; i ++ ) {

			geometry.faces.push( faces[ i ].clone() );

		}

		var uvs = this.faceVertexUvs[ 0 ];

		for ( var i = 0, il = uvs.length; i < il; i ++ ) {

			var uv = uvs[ i ], uvCopy = [];

			for ( var j = 0, jl = uv.length; j < jl; j ++ ) {

				uvCopy.push( new THREE.Vector2( uv[ j ].x, uv[ j ].y ) );

			}

			geometry.faceVertexUvs[ 0 ].push( uvCopy );

		}

		return geometry;

	},

	dispose: function () {

		this.dispatchEvent( { type: 'dispose' } );

	}

};

THREE.EventDispatcher.prototype.apply( THREE.Geometry.prototype );

THREE.GeometryIdCount = 0;

// File:src/cameras/Camera.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author mikael emtinger / http://gomo.se/
 * @author WestLangley / http://github.com/WestLangley
*/

THREE.Camera = function () {

	THREE.Object3D.call( this );

	this.type = 'Camera';

	this.matrixWorldInverse = new THREE.Matrix4();
	this.projectionMatrix = new THREE.Matrix4();

};

THREE.Camera.prototype = Object.create( THREE.Object3D.prototype );

THREE.Camera.prototype.getWorldDirection = function () {

	var quaternion = new THREE.Quaternion();

	return function ( optionalTarget ) {

		var result = optionalTarget || new THREE.Vector3();

		this.getWorldQuaternion( quaternion );

		return result.set( 0, 0, - 1 ).applyQuaternion( quaternion );

	}

}();

THREE.Camera.prototype.lookAt = function () {

	// This routine does not support cameras with rotated and/or translated parent(s)

	var m1 = new THREE.Matrix4();

	return function ( vector ) {

		m1.lookAt( this.position, vector, this.up );

		this.quaternion.setFromRotationMatrix( m1 );

	};

}();

THREE.Camera.prototype.clone = function ( camera ) {

	if ( camera === undefined ) camera = new THREE.Camera();

	THREE.Object3D.prototype.clone.call( this, camera );

	camera.matrixWorldInverse.copy( this.matrixWorldInverse );
	camera.projectionMatrix.copy( this.projectionMatrix );

	return camera;
};

// File:src/cameras/CubeCamera.js

/**
 * Camera for rendering cube maps
 *	- renders scene into axis-aligned cube
 *
 * @author alteredq / http://alteredqualia.com/
 */

THREE.CubeCamera = function ( near, far, cubeResolution ) {

	THREE.Object3D.call( this );

	this.type = 'CubeCamera';

	var fov = 90, aspect = 1;

	var cameraPX = new THREE.PerspectiveCamera( fov, aspect, near, far );
	cameraPX.up.set( 0, - 1, 0 );
	cameraPX.lookAt( new THREE.Vector3( 1, 0, 0 ) );
	this.add( cameraPX );

	var cameraNX = new THREE.PerspectiveCamera( fov, aspect, near, far );
	cameraNX.up.set( 0, - 1, 0 );
	cameraNX.lookAt( new THREE.Vector3( - 1, 0, 0 ) );
	this.add( cameraNX );

	var cameraPY = new THREE.PerspectiveCamera( fov, aspect, near, far );
	cameraPY.up.set( 0, 0, 1 );
	cameraPY.lookAt( new THREE.Vector3( 0, 1, 0 ) );
	this.add( cameraPY );

	var cameraNY = new THREE.PerspectiveCamera( fov, aspect, near, far );
	cameraNY.up.set( 0, 0, - 1 );
	cameraNY.lookAt( new THREE.Vector3( 0, - 1, 0 ) );
	this.add( cameraNY );

	var cameraPZ = new THREE.PerspectiveCamera( fov, aspect, near, far );
	cameraPZ.up.set( 0, - 1, 0 );
	cameraPZ.lookAt( new THREE.Vector3( 0, 0, 1 ) );
	this.add( cameraPZ );

	var cameraNZ = new THREE.PerspectiveCamera( fov, aspect, near, far );
	cameraNZ.up.set( 0, - 1, 0 );
	cameraNZ.lookAt( new THREE.Vector3( 0, 0, - 1 ) );
	this.add( cameraNZ );

	this.renderTarget = new THREE.WebGLRenderTargetCube( cubeResolution, cubeResolution, { format: THREE.RGBFormat, magFilter: THREE.LinearFilter, minFilter: THREE.LinearFilter } );

	this.updateCubeMap = function ( renderer, scene ) {

		var renderTarget = this.renderTarget;
		var generateMipmaps = renderTarget.generateMipmaps;

		renderTarget.generateMipmaps = false;

		renderTarget.activeCubeFace = 0;
		renderer.render( scene, cameraPX, renderTarget );

		renderTarget.activeCubeFace = 1;
		renderer.render( scene, cameraNX, renderTarget );

		renderTarget.activeCubeFace = 2;
		renderer.render( scene, cameraPY, renderTarget );

		renderTarget.activeCubeFace = 3;
		renderer.render( scene, cameraNY, renderTarget );

		renderTarget.activeCubeFace = 4;
		renderer.render( scene, cameraPZ, renderTarget );

		renderTarget.generateMipmaps = generateMipmaps;

		renderTarget.activeCubeFace = 5;
		renderer.render( scene, cameraNZ, renderTarget );

	};

};

THREE.CubeCamera.prototype = Object.create( THREE.Object3D.prototype );

// File:src/cameras/OrthographicCamera.js

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.OrthographicCamera = function ( left, right, top, bottom, near, far ) {

	THREE.Camera.call( this );

	this.type = 'OrthographicCamera';

	this.zoom = 1;

	this.left = left;
	this.right = right;
	this.top = top;
	this.bottom = bottom;

	this.near = ( near !== undefined ) ? near : 0.1;
	this.far = ( far !== undefined ) ? far : 2000;

	this.updateProjectionMatrix();

};

THREE.OrthographicCamera.prototype = Object.create( THREE.Camera.prototype );

THREE.OrthographicCamera.prototype.updateProjectionMatrix = function () {

	var dx = ( this.right - this.left ) / ( 2 * this.zoom );
	var dy = ( this.top - this.bottom ) / ( 2 * this.zoom );
	var cx = ( this.right + this.left ) / 2;
	var cy = ( this.top + this.bottom ) / 2;

	this.projectionMatrix.makeOrthographic( cx - dx, cx + dx, cy + dy, cy - dy, this.near, this.far );

};

THREE.OrthographicCamera.prototype.clone = function () {

	var camera = new THREE.OrthographicCamera();

	THREE.Camera.prototype.clone.call( this, camera );

	camera.zoom = this.zoom;

	camera.left = this.left;
	camera.right = this.right;
	camera.top = this.top;
	camera.bottom = this.bottom;

	camera.near = this.near;
	camera.far = this.far;

	camera.projectionMatrix.copy( this.projectionMatrix );

	return camera;
};

// File:src/cameras/PerspectiveCamera.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author greggman / http://games.greggman.com/
 * @author zz85 / http://www.lab4games.net/zz85/blog
 */

THREE.PerspectiveCamera = function ( fov, aspect, near, far ) {

	THREE.Camera.call( this );

	this.type = 'PerspectiveCamera';

	this.zoom = 1;

	this.fov = fov !== undefined ? fov : 50;
	this.aspect = aspect !== undefined ? aspect : 1;
	this.near = near !== undefined ? near : 0.1;
	this.far = far !== undefined ? far : 2000;

	this.updateProjectionMatrix();

};

THREE.PerspectiveCamera.prototype = Object.create( THREE.Camera.prototype );


/**
 * Uses Focal Length (in mm) to estimate and set FOV
 * 35mm (fullframe) camera is used if frame size is not specified;
 * Formula based on http://www.bobatkins.com/photography/technical/field_of_view.html
 */

THREE.PerspectiveCamera.prototype.setLens = function ( focalLength, frameHeight ) {

	if ( frameHeight === undefined ) frameHeight = 24;

	this.fov = 2 * THREE.Math.radToDeg( Math.atan( frameHeight / ( focalLength * 2 ) ) );
	this.updateProjectionMatrix();

}


/**
 * Sets an offset in a larger frustum. This is useful for multi-window or
 * multi-monitor/multi-machine setups.
 *
 * For example, if you have 3x2 monitors and each monitor is 1920x1080 and
 * the monitors are in grid like this
 *
 *   +---+---+---+
 *   | A | B | C |
 *   +---+---+---+
 *   | D | E | F |
 *   +---+---+---+
 *
 * then for each monitor you would call it like this
 *
 *   var w = 1920;
 *   var h = 1080;
 *   var fullWidth = w * 3;
 *   var fullHeight = h * 2;
 *
 *   --A--
 *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 0, w, h );
 *   --B--
 *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 0, w, h );
 *   --C--
 *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 0, w, h );
 *   --D--
 *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 1, w, h );
 *   --E--
 *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 1, w, h );
 *   --F--
 *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 1, w, h );
 *
 *   Note there is no reason monitors have to be the same size or in a grid.
 */

THREE.PerspectiveCamera.prototype.setViewOffset = function ( fullWidth, fullHeight, x, y, width, height ) {

	this.fullWidth = fullWidth;
	this.fullHeight = fullHeight;
	this.x = x;
	this.y = y;
	this.width = width;
	this.height = height;

	this.updateProjectionMatrix();

};


THREE.PerspectiveCamera.prototype.updateProjectionMatrix = function () {

	var fov = THREE.Math.radToDeg( 2 * Math.atan( Math.tan( THREE.Math.degToRad( this.fov ) * 0.5 ) / this.zoom ) );

	if ( this.fullWidth ) {

		var aspect = this.fullWidth / this.fullHeight;
		var top = Math.tan( THREE.Math.degToRad( fov * 0.5 ) ) * this.near;
		var bottom = - top;
		var left = aspect * bottom;
		var right = aspect * top;
		var width = Math.abs( right - left );
		var height = Math.abs( top - bottom );

		this.projectionMatrix.makeFrustum(
			left + this.x * width / this.fullWidth,
			left + ( this.x + this.width ) * width / this.fullWidth,
			top - ( this.y + this.height ) * height / this.fullHeight,
			top - this.y * height / this.fullHeight,
			this.near,
			this.far
		);

	} else {

		this.projectionMatrix.makePerspective( fov, this.aspect, this.near, this.far );

	}

};

THREE.PerspectiveCamera.prototype.clone = function () {

	var camera = new THREE.PerspectiveCamera();

	THREE.Camera.prototype.clone.call( this, camera );

	camera.zoom = this.zoom;

	camera.fov = this.fov;
	camera.aspect = this.aspect;
	camera.near = this.near;
	camera.far = this.far;

	camera.projectionMatrix.copy( this.projectionMatrix );

	return camera;

};

// File:src/lights/Light.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 */

THREE.Light = function ( color ) {

	THREE.Object3D.call( this );

	this.type = 'Light';
	
	this.color = new THREE.Color( color );

};

THREE.Light.prototype = Object.create( THREE.Object3D.prototype );

THREE.Light.prototype.clone = function ( light ) {

	if ( light === undefined ) light = new THREE.Light();

	THREE.Object3D.prototype.clone.call( this, light );

	light.color.copy( this.color );

	return light;

};

// File:src/lights/AmbientLight.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.AmbientLight = function ( color ) {

	THREE.Light.call( this, color );

	this.type = 'AmbientLight';

};

THREE.AmbientLight.prototype = Object.create( THREE.Light.prototype );

THREE.AmbientLight.prototype.clone = function () {

	var light = new THREE.AmbientLight();

	THREE.Light.prototype.clone.call( this, light );

	return light;

};

// File:src/lights/AreaLight.js

/**
 * @author MPanknin / http://www.redplant.de/
 * @author alteredq / http://alteredqualia.com/
 */

THREE.AreaLight = function ( color, intensity ) {

	THREE.Light.call( this, color );

	this.type = 'AreaLight';

	this.normal = new THREE.Vector3( 0, - 1, 0 );
	this.right = new THREE.Vector3( 1, 0, 0 );

	this.intensity = ( intensity !== undefined ) ? intensity : 1;

	this.width = 1.0;
	this.height = 1.0;

	this.constantAttenuation = 1.5;
	this.linearAttenuation = 0.5;
	this.quadraticAttenuation = 0.1;

};

THREE.AreaLight.prototype = Object.create( THREE.Light.prototype );


// File:src/lights/DirectionalLight.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 */

THREE.DirectionalLight = function ( color, intensity ) {

	THREE.Light.call( this, color );

	this.type = 'DirectionalLight';

	this.position.set( 0, 1, 0 );
	this.target = new THREE.Object3D();

	this.intensity = ( intensity !== undefined ) ? intensity : 1;

	this.castShadow = false;
	this.onlyShadow = false;

	//

	this.shadowCameraNear = 50;
	this.shadowCameraFar = 5000;

	this.shadowCameraLeft = - 500;
	this.shadowCameraRight = 500;
	this.shadowCameraTop = 500;
	this.shadowCameraBottom = - 500;

	this.shadowCameraVisible = false;

	this.shadowBias = 0;
	this.shadowDarkness = 0.5;

	this.shadowMapWidth = 512;
	this.shadowMapHeight = 512;

	//

	this.shadowCascade = false;

	this.shadowCascadeOffset = new THREE.Vector3( 0, 0, - 1000 );
	this.shadowCascadeCount = 2;

	this.shadowCascadeBias = [ 0, 0, 0 ];
	this.shadowCascadeWidth = [ 512, 512, 512 ];
	this.shadowCascadeHeight = [ 512, 512, 512 ];

	this.shadowCascadeNearZ = [ - 1.000, 0.990, 0.998 ];
	this.shadowCascadeFarZ  = [  0.990, 0.998, 1.000 ];

	this.shadowCascadeArray = [];

	//

	this.shadowMap = null;
	this.shadowMapSize = null;
	this.shadowCamera = null;
	this.shadowMatrix = null;

};

THREE.DirectionalLight.prototype = Object.create( THREE.Light.prototype );

THREE.DirectionalLight.prototype.clone = function () {

	var light = new THREE.DirectionalLight();

	THREE.Light.prototype.clone.call( this, light );

	light.target = this.target.clone();

	light.intensity = this.intensity;

	light.castShadow = this.castShadow;
	light.onlyShadow = this.onlyShadow;

	//

	light.shadowCameraNear = this.shadowCameraNear;
	light.shadowCameraFar = this.shadowCameraFar;

	light.shadowCameraLeft = this.shadowCameraLeft;
	light.shadowCameraRight = this.shadowCameraRight;
	light.shadowCameraTop = this.shadowCameraTop;
	light.shadowCameraBottom = this.shadowCameraBottom;

	light.shadowCameraVisible = this.shadowCameraVisible;

	light.shadowBias = this.shadowBias;
	light.shadowDarkness = this.shadowDarkness;

	light.shadowMapWidth = this.shadowMapWidth;
	light.shadowMapHeight = this.shadowMapHeight;

	//

	light.shadowCascade = this.shadowCascade;

	light.shadowCascadeOffset.copy( this.shadowCascadeOffset );
	light.shadowCascadeCount = this.shadowCascadeCount;

	light.shadowCascadeBias = this.shadowCascadeBias.slice( 0 );
	light.shadowCascadeWidth = this.shadowCascadeWidth.slice( 0 );
	light.shadowCascadeHeight = this.shadowCascadeHeight.slice( 0 );

	light.shadowCascadeNearZ = this.shadowCascadeNearZ.slice( 0 );
	light.shadowCascadeFarZ  = this.shadowCascadeFarZ.slice( 0 );

	return light;

};

// File:src/lights/HemisphereLight.js

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.HemisphereLight = function ( skyColor, groundColor, intensity ) {

	THREE.Light.call( this, skyColor );

	this.type = 'HemisphereLight';

	this.position.set( 0, 100, 0 );

	this.groundColor = new THREE.Color( groundColor );
	this.intensity = ( intensity !== undefined ) ? intensity : 1;

};

THREE.HemisphereLight.prototype = Object.create( THREE.Light.prototype );

THREE.HemisphereLight.prototype.clone = function () {

	var light = new THREE.HemisphereLight();

	THREE.Light.prototype.clone.call( this, light );

	light.groundColor.copy( this.groundColor );
	light.intensity = this.intensity;

	return light;

};

// File:src/lights/PointLight.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.PointLight = function ( color, intensity, distance ) {

	THREE.Light.call( this, color );

	this.type = 'PointLight';

	this.intensity = ( intensity !== undefined ) ? intensity : 1;
	this.distance = ( distance !== undefined ) ? distance : 0;

};

THREE.PointLight.prototype = Object.create( THREE.Light.prototype );

THREE.PointLight.prototype.clone = function () {

	var light = new THREE.PointLight();

	THREE.Light.prototype.clone.call( this, light );

	light.intensity = this.intensity;
	light.distance = this.distance;

	return light;

};

// File:src/lights/SpotLight.js

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.SpotLight = function ( color, intensity, distance, angle, exponent ) {

	THREE.Light.call( this, color );

	this.type = 'SpotLight';

	this.position.set( 0, 1, 0 );
	this.target = new THREE.Object3D();

	this.intensity = ( intensity !== undefined ) ? intensity : 1;
	this.distance = ( distance !== undefined ) ? distance : 0;
	this.angle = ( angle !== undefined ) ? angle : Math.PI / 3;
	this.exponent = ( exponent !== undefined ) ? exponent : 10;

	this.castShadow = false;
	this.onlyShadow = false;

	//

	this.shadowCameraNear = 50;
	this.shadowCameraFar = 5000;
	this.shadowCameraFov = 50;

	this.shadowCameraVisible = false;

	this.shadowBias = 0;
	this.shadowDarkness = 0.5;

	this.shadowMapWidth = 512;
	this.shadowMapHeight = 512;

	//

	this.shadowMap = null;
	this.shadowMapSize = null;
	this.shadowCamera = null;
	this.shadowMatrix = null;

};

THREE.SpotLight.prototype = Object.create( THREE.Light.prototype );

THREE.SpotLight.prototype.clone = function () {

	var light = new THREE.SpotLight();

	THREE.Light.prototype.clone.call( this, light );

	light.target = this.target.clone();

	light.intensity = this.intensity;
	light.distance = this.distance;
	light.angle = this.angle;
	light.exponent = this.exponent;

	light.castShadow = this.castShadow;
	light.onlyShadow = this.onlyShadow;

	//

	light.shadowCameraNear = this.shadowCameraNear;
	light.shadowCameraFar = this.shadowCameraFar;
	light.shadowCameraFov = this.shadowCameraFov;

	light.shadowCameraVisible = this.shadowCameraVisible;

	light.shadowBias = this.shadowBias;
	light.shadowDarkness = this.shadowDarkness;

	light.shadowMapWidth = this.shadowMapWidth;
	light.shadowMapHeight = this.shadowMapHeight;

	return light;

};

// File:src/loaders/Cache.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.Cache = function () {

	this.files = {};

};

THREE.Cache.prototype = {

	constructor: THREE.Cache,

	add: function ( key, file ) {

		// console.log( 'THREE.Cache', 'Adding key:', key );

		this.files[ key ] = file;

	},

	get: function ( key ) {

		// console.log( 'THREE.Cache', 'Checking key:', key );

		return this.files[ key ];

	},

	remove: function ( key ) {

		delete this.files[ key ];

	},

	clear: function () {

		this.files = {}

	}

};

// File:src/loaders/Loader.js

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.Loader = function ( showStatus ) {

	this.showStatus = showStatus;
	this.statusDomElement = showStatus ? THREE.Loader.prototype.addStatusElement() : null;

	this.imageLoader = new THREE.ImageLoader();

	this.onLoadStart = function () {};
	this.onLoadProgress = function () {};
	this.onLoadComplete = function () {};

};

THREE.Loader.prototype = {

	constructor: THREE.Loader,

	crossOrigin: undefined,

	addStatusElement: function () {

		var e = document.createElement( 'div' );

		e.style.position = 'absolute';
		e.style.right = '0px';
		e.style.top = '0px';
		e.style.fontSize = '0.8em';
		e.style.textAlign = 'left';
		e.style.background = 'rgba(0,0,0,0.25)';
		e.style.color = '#fff';
		e.style.width = '120px';
		e.style.padding = '0.5em 0.5em 0.5em 0.5em';
		e.style.zIndex = 1000;

		e.innerHTML = 'Loading ...';

		return e;

	},

	updateProgress: function ( progress ) {

		var message = 'Loaded ';

		if ( progress.total ) {

			message += ( 100 * progress.loaded / progress.total ).toFixed( 0 ) + '%';


		} else {

			message += ( progress.loaded / 1024 ).toFixed( 2 ) + ' KB';

		}

		this.statusDomElement.innerHTML = message;

	},

	extractUrlBase: function ( url ) {

		var parts = url.split( '/' );

		if ( parts.length === 1 ) return './';

		parts.pop();

		return parts.join( '/' ) + '/';

	},

	initMaterials: function ( materials, texturePath ) {

		var array = [];

		for ( var i = 0; i < materials.length; ++ i ) {

			array[ i ] = this.createMaterial( materials[ i ], texturePath );

		}

		return array;

	},

	needsTangents: function ( materials ) {

		for ( var i = 0, il = materials.length; i < il; i ++ ) {

			var m = materials[ i ];

			if ( m instanceof THREE.ShaderMaterial ) return true;

		}

		return false;

	},

	createMaterial: function ( m, texturePath ) {

		var scope = this;

		function nearest_pow2( n ) {

			var l = Math.log( n ) / Math.LN2;
			return Math.pow( 2, Math.round(  l ) );

		}

		function create_texture( where, name, sourceFile, repeat, offset, wrap, anisotropy ) {

			var fullPath = texturePath + sourceFile;

			var texture;

			var loader = THREE.Loader.Handlers.get( fullPath );

			if ( loader !== null ) {

				texture = loader.load( fullPath );

			} else {

				texture = new THREE.Texture();

				loader = scope.imageLoader;
				loader.crossOrigin = scope.crossOrigin;
				loader.load( fullPath, function ( image ) {

					if ( THREE.Math.isPowerOfTwo( image.width ) === false ||
						 THREE.Math.isPowerOfTwo( image.height ) === false ) {

						var width = nearest_pow2( image.width );
						var height = nearest_pow2( image.height );

						var canvas = document.createElement( 'canvas' );
						canvas.width = width;
						canvas.height = height;

						var context = canvas.getContext( '2d' );
						context.drawImage( image, 0, 0, width, height );

						texture.image = canvas;

					} else {

						texture.image = image;

					}

					texture.needsUpdate = true;

				} );

			}

			texture.sourceFile = sourceFile;

			if ( repeat ) {

				texture.repeat.set( repeat[ 0 ], repeat[ 1 ] );

				if ( repeat[ 0 ] !== 1 ) texture.wrapS = THREE.RepeatWrapping;
				if ( repeat[ 1 ] !== 1 ) texture.wrapT = THREE.RepeatWrapping;

			}

			if ( offset ) {

				texture.offset.set( offset[ 0 ], offset[ 1 ] );

			}

			if ( wrap ) {

				var wrapMap = {
					'repeat': THREE.RepeatWrapping,
					'mirror': THREE.MirroredRepeatWrapping
				}

				if ( wrapMap[ wrap[ 0 ] ] !== undefined ) texture.wrapS = wrapMap[ wrap[ 0 ] ];
				if ( wrapMap[ wrap[ 1 ] ] !== undefined ) texture.wrapT = wrapMap[ wrap[ 1 ] ];

			}

			if ( anisotropy ) {

				texture.anisotropy = anisotropy;

			}

			where[ name ] = texture;

		}

		function rgb2hex( rgb ) {

			return ( rgb[ 0 ] * 255 << 16 ) + ( rgb[ 1 ] * 255 << 8 ) + rgb[ 2 ] * 255;

		}

		// defaults

		var mtype = 'MeshLambertMaterial';
		var mpars = { color: 0xeeeeee, opacity: 1.0, map: null, lightMap: null, normalMap: null, bumpMap: null, wireframe: false };

		// parameters from model file

		if ( m.shading ) {

			var shading = m.shading.toLowerCase();

			if ( shading === 'phong' ) mtype = 'MeshPhongMaterial';
			else if ( shading === 'basic' ) mtype = 'MeshBasicMaterial';

		}

		if ( m.blending !== undefined && THREE[ m.blending ] !== undefined ) {

			mpars.blending = THREE[ m.blending ];

		}

		if ( m.transparent !== undefined || m.opacity < 1.0 ) {

			mpars.transparent = m.transparent;

		}

		if ( m.depthTest !== undefined ) {

			mpars.depthTest = m.depthTest;

		}

		if ( m.depthWrite !== undefined ) {

			mpars.depthWrite = m.depthWrite;

		}

		if ( m.visible !== undefined ) {

			mpars.visible = m.visible;

		}

		if ( m.flipSided !== undefined ) {

			mpars.side = THREE.BackSide;

		}

		if ( m.doubleSided !== undefined ) {

			mpars.side = THREE.DoubleSide;

		}

		if ( m.wireframe !== undefined ) {

			mpars.wireframe = m.wireframe;

		}

		if ( m.vertexColors !== undefined ) {

			if ( m.vertexColors === 'face' ) {

				mpars.vertexColors = THREE.FaceColors;

			} else if ( m.vertexColors ) {

				mpars.vertexColors = THREE.VertexColors;

			}

		}

		// colors

		if ( m.colorDiffuse ) {

			mpars.color = rgb2hex( m.colorDiffuse );

		} else if ( m.DbgColor ) {

			mpars.color = m.DbgColor;

		}

		if ( m.colorSpecular ) {

			mpars.specular = rgb2hex( m.colorSpecular );

		}

		if ( m.colorAmbient ) {

			mpars.ambient = rgb2hex( m.colorAmbient );

		}

		if ( m.colorEmissive ) {

			mpars.emissive = rgb2hex( m.colorEmissive );

		}

		// modifiers

		if ( m.transparency ) {

			mpars.opacity = m.transparency;

		}

		if ( m.specularCoef ) {

			mpars.shininess = m.specularCoef;

		}

		// textures

		if ( m.mapDiffuse && texturePath ) {

			create_texture( mpars, 'map', m.mapDiffuse, m.mapDiffuseRepeat, m.mapDiffuseOffset, m.mapDiffuseWrap, m.mapDiffuseAnisotropy );

		}

		if ( m.mapLight && texturePath ) {

			create_texture( mpars, 'lightMap', m.mapLight, m.mapLightRepeat, m.mapLightOffset, m.mapLightWrap, m.mapLightAnisotropy );

		}

		if ( m.mapBump && texturePath ) {

			create_texture( mpars, 'bumpMap', m.mapBump, m.mapBumpRepeat, m.mapBumpOffset, m.mapBumpWrap, m.mapBumpAnisotropy );

		}

		if ( m.mapNormal && texturePath ) {

			create_texture( mpars, 'normalMap', m.mapNormal, m.mapNormalRepeat, m.mapNormalOffset, m.mapNormalWrap, m.mapNormalAnisotropy );

		}

		if ( m.mapSpecular && texturePath ) {

			create_texture( mpars, 'specularMap', m.mapSpecular, m.mapSpecularRepeat, m.mapSpecularOffset, m.mapSpecularWrap, m.mapSpecularAnisotropy );

		}

		if ( m.mapAlpha && texturePath ) {

			create_texture( mpars, 'alphaMap', m.mapAlpha, m.mapAlphaRepeat, m.mapAlphaOffset, m.mapAlphaWrap, m.mapAlphaAnisotropy );

		}

		//

		if ( m.mapBumpScale ) {

			mpars.bumpScale = m.mapBumpScale;

		}

		// special case for normal mapped material

		if ( m.mapNormal ) {

			var shader = THREE.ShaderLib[ 'normalmap' ];
			var uniforms = THREE.UniformsUtils.clone( shader.uniforms );

			uniforms[ 'tNormal' ].value = mpars.normalMap;

			if ( m.mapNormalFactor ) {

				uniforms[ 'uNormalScale' ].value.set( m.mapNormalFactor, m.mapNormalFactor );

			}

			if ( mpars.map ) {

				uniforms[ 'tDiffuse' ].value = mpars.map;
				uniforms[ 'enableDiffuse' ].value = true;

			}

			if ( mpars.specularMap ) {

				uniforms[ 'tSpecular' ].value = mpars.specularMap;
				uniforms[ 'enableSpecular' ].value = true;

			}

			if ( mpars.lightMap ) {

				uniforms[ 'tAO' ].value = mpars.lightMap;
				uniforms[ 'enableAO' ].value = true;

			}

			// for the moment don't handle displacement texture

			uniforms[ 'diffuse' ].value.setHex( mpars.color );
			uniforms[ 'specular' ].value.setHex( mpars.specular );
			uniforms[ 'ambient' ].value.setHex( mpars.ambient );

			uniforms[ 'shininess' ].value = mpars.shininess;

			if ( mpars.opacity !== undefined ) {

				uniforms[ 'opacity' ].value = mpars.opacity;

			}

			var parameters = { fragmentShader: shader.fragmentShader, vertexShader: shader.vertexShader, uniforms: uniforms, lights: true, fog: true };
			var material = new THREE.ShaderMaterial( parameters );

			if ( mpars.transparent ) {

				material.transparent = true;

			}

		} else {

			var material = new THREE[ mtype ]( mpars );

		}

		if ( m.DbgName !== undefined ) material.name = m.DbgName;

		return material;

	}

};

THREE.Loader.Handlers = {

	handlers: [],

	add: function ( regex, loader ) {

		this.handlers.push( regex, loader );

	},

	get: function ( file ) {

		for ( var i = 0, l = this.handlers.length; i < l; i += 2 ) {

			var regex = this.handlers[ i ];
			var loader  = this.handlers[ i + 1 ];

			if ( regex.test( file ) ) {

				return loader;

			}

		}

		return null;

	}

};

// File:src/loaders/XHRLoader.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.XHRLoader = function ( manager ) {

	this.cache = new THREE.Cache();
	this.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;

};

THREE.XHRLoader.prototype = {

	constructor: THREE.XHRLoader,

	load: function ( url, onLoad, onProgress, onError ) {

		var scope = this;

		var cached = scope.cache.get( url );

		if ( cached !== undefined ) {

			if ( onLoad ) onLoad( cached );
			return;

		}

		var request = new XMLHttpRequest();
		request.open( 'GET', url, true );

		request.addEventListener( 'load', function ( event ) {

			scope.cache.add( url, this.response );

			if ( onLoad ) onLoad( this.response );

			scope.manager.itemEnd( url );

		}, false );

		if ( onProgress !== undefined ) {

			request.addEventListener( 'progress', function ( event ) {

				onProgress( event );

			}, false );

		}

		if ( onError !== undefined ) {

			request.addEventListener( 'error', function ( event ) {

				onError( event );

			}, false );

		}

		if ( this.crossOrigin !== undefined ) request.crossOrigin = this.crossOrigin;
		if ( this.responseType !== undefined ) request.responseType = this.responseType;

		request.send( null );

		scope.manager.itemStart( url );

	},

	setResponseType: function ( value ) {

		this.responseType = value;

	},

	setCrossOrigin: function ( value ) {

		this.crossOrigin = value;

	}

};

// File:src/loaders/ImageLoader.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.ImageLoader = function ( manager ) {

	this.cache = new THREE.Cache();
	this.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;

};

THREE.ImageLoader.prototype = {

	constructor: THREE.ImageLoader,

	load: function ( url, onLoad, onProgress, onError ) {

		var scope = this;

		var cached = scope.cache.get( url );

		if ( cached !== undefined ) {

			onLoad( cached );
			return;

		}

		var image = document.createElement( 'img' );

		if ( onLoad !== undefined ) {

			image.addEventListener( 'load', function ( event ) {

				scope.cache.add( url, this );

				onLoad( this );
				scope.manager.itemEnd( url );

			}, false );

		}

		if ( onProgress !== undefined ) {

			image.addEventListener( 'progress', function ( event ) {

				onProgress( event );

			}, false );

		}

		if ( onError !== undefined ) {

			image.addEventListener( 'error', function ( event ) {

				onError( event );

			}, false );

		}

		if ( this.crossOrigin !== undefined ) image.crossOrigin = this.crossOrigin;

		image.src = url;

		scope.manager.itemStart( url );

		return image;

	},

	setCrossOrigin: function ( value ) {

		this.crossOrigin = value;

	}

}

// File:src/loaders/JSONLoader.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 */

THREE.JSONLoader = function ( showStatus ) {

	THREE.Loader.call( this, showStatus );

	this.withCredentials = false;

};

THREE.JSONLoader.prototype = Object.create( THREE.Loader.prototype );

THREE.JSONLoader.prototype.load = function ( url, callback, texturePath ) {

	var scope = this;

	// todo: unify load API to for easier SceneLoader use

	texturePath = texturePath && ( typeof texturePath === 'string' ) ? texturePath : this.extractUrlBase( url );

	this.onLoadStart();
	this.loadAjaxJSON( this, url, callback, texturePath );

};

THREE.JSONLoader.prototype.loadAjaxJSON = function ( context, url, callback, texturePath, callbackProgress ) {

	var xhr = new XMLHttpRequest();

	var length = 0;

	xhr.onreadystatechange = function () {

		if ( xhr.readyState === xhr.DONE ) {

			if ( xhr.status === 200 || xhr.status === 0 ) {

				if ( xhr.responseText ) {

					var json = JSON.parse( xhr.responseText );

					if ( json.metadata !== undefined && json.metadata.type === 'scene' ) {

						console.error( 'THREE.JSONLoader: "' + url + '" seems to be a Scene. Use THREE.SceneLoader instead.' );
						return;

					}

					var result = context.parse( json, texturePath );
					callback( result.geometry, result.materials );

				} else {

					console.error( 'THREE.JSONLoader: "' + url + '" seems to be unreachable or the file is empty.' );

				}

				// in context of more complex asset initialization
				// do not block on single failed file
				// maybe should go even one more level up

				context.onLoadComplete();

			} else {

				console.error( 'THREE.JSONLoader: Couldn\'t load "' + url + '" (' + xhr.status + ')' );

			}

		} else if ( xhr.readyState === xhr.LOADING ) {

			if ( callbackProgress ) {

				if ( length === 0 ) {

					length = xhr.getResponseHeader( 'Content-Length' );

				}

				callbackProgress( { total: length, loaded: xhr.responseText.length } );

			}

		} else if ( xhr.readyState === xhr.HEADERS_RECEIVED ) {

			if ( callbackProgress !== undefined ) {

				length = xhr.getResponseHeader( 'Content-Length' );

			}

		}

	};

	xhr.open( 'GET', url, true );
	xhr.withCredentials = this.withCredentials;
	xhr.send( null );

};

THREE.JSONLoader.prototype.parse = function ( json, texturePath ) {

	var scope = this,
	geometry = new THREE.Geometry(),
	scale = ( json.scale !== undefined ) ? 1.0 / json.scale : 1.0;

	parseModel( scale );

	parseSkin();
	parseMorphing( scale );

	geometry.computeFaceNormals();
	geometry.computeBoundingSphere();

	function parseModel( scale ) {

		function isBitSet( value, position ) {

			return value & ( 1 << position );

		}

		var i, j, fi,

		offset, zLength,

		colorIndex, normalIndex, uvIndex, materialIndex,

		type,
		isQuad,
		hasMaterial,
		hasFaceVertexUv,
		hasFaceNormal, hasFaceVertexNormal,
		hasFaceColor, hasFaceVertexColor,

		vertex, face, faceA, faceB, color, hex, normal,

		uvLayer, uv, u, v,

		faces = json.faces,
		vertices = json.vertices,
		normals = json.normals,
		colors = json.colors,

		nUvLayers = 0;

		if ( json.uvs !== undefined ) {

			// disregard empty arrays

			for ( i = 0; i < json.uvs.length; i ++ ) {

				if ( json.uvs[ i ].length ) nUvLayers ++;

			}

			for ( i = 0; i < nUvLayers; i ++ ) {

				geometry.faceVertexUvs[ i ] = [];

			}

		}

		offset = 0;
		zLength = vertices.length;

		while ( offset < zLength ) {

			vertex = new THREE.Vector3();

			vertex.x = vertices[ offset ++ ] * scale;
			vertex.y = vertices[ offset ++ ] * scale;
			vertex.z = vertices[ offset ++ ] * scale;

			geometry.vertices.push( vertex );

		}

		offset = 0;
		zLength = faces.length;

		while ( offset < zLength ) {

			type = faces[ offset ++ ];


			isQuad              = isBitSet( type, 0 );
			hasMaterial         = isBitSet( type, 1 );
			hasFaceVertexUv     = isBitSet( type, 3 );
			hasFaceNormal       = isBitSet( type, 4 );
			hasFaceVertexNormal = isBitSet( type, 5 );
			hasFaceColor	     = isBitSet( type, 6 );
			hasFaceVertexColor  = isBitSet( type, 7 );

			// console.log("type", type, "bits", isQuad, hasMaterial, hasFaceVertexUv, hasFaceNormal, hasFaceVertexNormal, hasFaceColor, hasFaceVertexColor);

			if ( isQuad ) {

				faceA = new THREE.Face3();
				faceA.a = faces[ offset ];
				faceA.b = faces[ offset + 1 ];
				faceA.c = faces[ offset + 3 ];

				faceB = new THREE.Face3();
				faceB.a = faces[ offset + 1 ];
				faceB.b = faces[ offset + 2 ];
				faceB.c = faces[ offset + 3 ];

				offset += 4;

				if ( hasMaterial ) {

					materialIndex = faces[ offset ++ ];
					faceA.materialIndex = materialIndex;
					faceB.materialIndex = materialIndex;

				}

				// to get face <=> uv index correspondence

				fi = geometry.faces.length;

				if ( hasFaceVertexUv ) {

					for ( i = 0; i < nUvLayers; i ++ ) {

						uvLayer = json.uvs[ i ];

						geometry.faceVertexUvs[ i ][ fi ] = [];
						geometry.faceVertexUvs[ i ][ fi + 1 ] = []

						for ( j = 0; j < 4; j ++ ) {

							uvIndex = faces[ offset ++ ];

							u = uvLayer[ uvIndex * 2 ];
							v = uvLayer[ uvIndex * 2 + 1 ];

							uv = new THREE.Vector2( u, v );

							if ( j !== 2 ) geometry.faceVertexUvs[ i ][ fi ].push( uv );
							if ( j !== 0 ) geometry.faceVertexUvs[ i ][ fi + 1 ].push( uv );

						}

					}

				}

				if ( hasFaceNormal ) {

					normalIndex = faces[ offset ++ ] * 3;

					faceA.normal.set(
						normals[ normalIndex ++ ],
						normals[ normalIndex ++ ],
						normals[ normalIndex ]
					);

					faceB.normal.copy( faceA.normal );

				}

				if ( hasFaceVertexNormal ) {

					for ( i = 0; i < 4; i ++ ) {

						normalIndex = faces[ offset ++ ] * 3;

						normal = new THREE.Vector3(
							normals[ normalIndex ++ ],
							normals[ normalIndex ++ ],
							normals[ normalIndex ]
						);


						if ( i !== 2 ) faceA.vertexNormals.push( normal );
						if ( i !== 0 ) faceB.vertexNormals.push( normal );

					}

				}


				if ( hasFaceColor ) {

					colorIndex = faces[ offset ++ ];
					hex = colors[ colorIndex ];

					faceA.color.setHex( hex );
					faceB.color.setHex( hex );

				}


				if ( hasFaceVertexColor ) {

					for ( i = 0; i < 4; i ++ ) {

						colorIndex = faces[ offset ++ ];
						hex = colors[ colorIndex ];

						if ( i !== 2 ) faceA.vertexColors.push( new THREE.Color( hex ) );
						if ( i !== 0 ) faceB.vertexColors.push( new THREE.Color( hex ) );

					}

				}

				geometry.faces.push( faceA );
				geometry.faces.push( faceB );

			} else {

				face = new THREE.Face3();
				face.a = faces[ offset ++ ];
				face.b = faces[ offset ++ ];
				face.c = faces[ offset ++ ];

				if ( hasMaterial ) {

					materialIndex = faces[ offset ++ ];
					face.materialIndex = materialIndex;

				}

				// to get face <=> uv index correspondence

				fi = geometry.faces.length;

				if ( hasFaceVertexUv ) {

					for ( i = 0; i < nUvLayers; i ++ ) {

						uvLayer = json.uvs[ i ];

						geometry.faceVertexUvs[ i ][ fi ] = [];

						for ( j = 0; j < 3; j ++ ) {

							uvIndex = faces[ offset ++ ];

							u = uvLayer[ uvIndex * 2 ];
							v = uvLayer[ uvIndex * 2 + 1 ];

							uv = new THREE.Vector2( u, v );

							geometry.faceVertexUvs[ i ][ fi ].push( uv );

						}

					}

				}

				if ( hasFaceNormal ) {

					normalIndex = faces[ offset ++ ] * 3;

					face.normal.set(
						normals[ normalIndex ++ ],
						normals[ normalIndex ++ ],
						normals[ normalIndex ]
					);

				}

				if ( hasFaceVertexNormal ) {

					for ( i = 0; i < 3; i ++ ) {

						normalIndex = faces[ offset ++ ] * 3;

						normal = new THREE.Vector3(
							normals[ normalIndex ++ ],
							normals[ normalIndex ++ ],
							normals[ normalIndex ]
						);

						face.vertexNormals.push( normal );

					}

				}


				if ( hasFaceColor ) {

					colorIndex = faces[ offset ++ ];
					face.color.setHex( colors[ colorIndex ] );

				}


				if ( hasFaceVertexColor ) {

					for ( i = 0; i < 3; i ++ ) {

						colorIndex = faces[ offset ++ ];
						face.vertexColors.push( new THREE.Color( colors[ colorIndex ] ) );

					}

				}

				geometry.faces.push( face );

			}

		}

	};

	function parseSkin() {
		var influencesPerVertex = ( json.influencesPerVertex !== undefined ) ? json.influencesPerVertex : 2;

		if ( json.skinWeights ) {

			for ( var i = 0, l = json.skinWeights.length; i < l; i += influencesPerVertex ) {

				var x =                               json.skinWeights[ i     ];
				var y = ( influencesPerVertex > 1 ) ? json.skinWeights[ i + 1 ] : 0;
				var z = ( influencesPerVertex > 2 ) ? json.skinWeights[ i + 2 ] : 0;
				var w = ( influencesPerVertex > 3 ) ? json.skinWeights[ i + 3 ] : 0;

				geometry.skinWeights.push( new THREE.Vector4( x, y, z, w ) );

			}

		}

		if ( json.skinIndices ) {

			for ( var i = 0, l = json.skinIndices.length; i < l; i += influencesPerVertex ) {

				var a =                               json.skinIndices[ i     ];
				var b = ( influencesPerVertex > 1 ) ? json.skinIndices[ i + 1 ] : 0;
				var c = ( influencesPerVertex > 2 ) ? json.skinIndices[ i + 2 ] : 0;
				var d = ( influencesPerVertex > 3 ) ? json.skinIndices[ i + 3 ] : 0;

				geometry.skinIndices.push( new THREE.Vector4( a, b, c, d ) );

			}

		}

		geometry.bones = json.bones;

		if ( geometry.bones && geometry.bones.length > 0 && ( geometry.skinWeights.length !== geometry.skinIndices.length || geometry.skinIndices.length !== geometry.vertices.length ) ) {

				console.warn( 'When skinning, number of vertices (' + geometry.vertices.length + '), skinIndices (' +
					geometry.skinIndices.length + '), and skinWeights (' + geometry.skinWeights.length + ') should match.' );

		}


		// could change this to json.animations[0] or remove completely

		geometry.animation = json.animation;
		geometry.animations = json.animations;

	};

	function parseMorphing( scale ) {

		if ( json.morphTargets !== undefined ) {

			var i, l, v, vl, dstVertices, srcVertices;

			for ( i = 0, l = json.morphTargets.length; i < l; i ++ ) {

				geometry.morphTargets[ i ] = {};
				geometry.morphTargets[ i ].name = json.morphTargets[ i ].name;
				geometry.morphTargets[ i ].vertices = [];

				dstVertices = geometry.morphTargets[ i ].vertices;
				srcVertices = json.morphTargets [ i ].vertices;

				for ( v = 0, vl = srcVertices.length; v < vl; v += 3 ) {

					var vertex = new THREE.Vector3();
					vertex.x = srcVertices[ v ] * scale;
					vertex.y = srcVertices[ v + 1 ] * scale;
					vertex.z = srcVertices[ v + 2 ] * scale;

					dstVertices.push( vertex );

				}

			}

		}

		if ( json.morphColors !== undefined ) {

			var i, l, c, cl, dstColors, srcColors, color;

			for ( i = 0, l = json.morphColors.length; i < l; i ++ ) {

				geometry.morphColors[ i ] = {};
				geometry.morphColors[ i ].name = json.morphColors[ i ].name;
				geometry.morphColors[ i ].colors = [];

				dstColors = geometry.morphColors[ i ].colors;
				srcColors = json.morphColors [ i ].colors;

				for ( c = 0, cl = srcColors.length; c < cl; c += 3 ) {

					color = new THREE.Color( 0xffaa00 );
					color.setRGB( srcColors[ c ], srcColors[ c + 1 ], srcColors[ c + 2 ] );
					dstColors.push( color );

				}

			}

		}

	};

	if ( json.materials === undefined || json.materials.length === 0 ) {

		return { geometry: geometry };

	} else {

		var materials = this.initMaterials( json.materials, texturePath );

		if ( this.needsTangents( materials ) ) {

			geometry.computeTangents();

		}

		return { geometry: geometry, materials: materials };

	}

};

// File:src/loaders/LoadingManager.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.LoadingManager = function ( onLoad, onProgress, onError ) {

	var scope = this;

	var loaded = 0, total = 0;

	this.onLoad = onLoad;
	this.onProgress = onProgress;
	this.onError = onError;

	this.itemStart = function ( url ) {

		total ++;

	};

	this.itemEnd = function ( url ) {

		loaded ++;

		if ( scope.onProgress !== undefined ) {

			scope.onProgress( url, loaded, total );

		}

		if ( loaded === total && scope.onLoad !== undefined ) {

			scope.onLoad();

		}

	};

};

THREE.DefaultLoadingManager = new THREE.LoadingManager();

// File:src/loaders/BufferGeometryLoader.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.BufferGeometryLoader = function ( manager ) {

	this.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;

};

THREE.BufferGeometryLoader.prototype = {

	constructor: THREE.BufferGeometryLoader,

	load: function ( url, onLoad, onProgress, onError ) {

		var scope = this;

		var loader = new THREE.XHRLoader();
		loader.setCrossOrigin( this.crossOrigin );
		loader.load( url, function ( text ) {

			onLoad( scope.parse( JSON.parse( text ) ) );

		}, onProgress, onError );

	},

	setCrossOrigin: function ( value ) {

		this.crossOrigin = value;

	},

	parse: function ( json ) {

		var geometry = new THREE.BufferGeometry();

		var attributes = json.attributes;

		for ( var key in attributes ) {

			var attribute = attributes[ key ];
			var typedArray = new self[ attribute.type ]( attribute.array );

			geometry.addAttribute( key, new THREE.BufferAttribute( typedArray, attribute.itemSize ) );

		}

		var offsets = json.offsets;

		if ( offsets !== undefined ) {

			geometry.offsets = JSON.parse( JSON.stringify( offsets ) );

		}

		var boundingSphere = json.boundingSphere;

		if ( boundingSphere !== undefined ) {

			var center = new THREE.Vector3();

			if ( boundingSphere.center !== undefined ) {

				center.fromArray( boundingSphere.center );

			}

			geometry.boundingSphere = new THREE.Sphere( center, boundingSphere.radius );

		}

		return geometry;

	}

};

// File:src/loaders/MaterialLoader.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.MaterialLoader = function ( manager ) {

	this.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;

};

THREE.MaterialLoader.prototype = {

	constructor: THREE.MaterialLoader,

	load: function ( url, onLoad, onProgress, onError ) {

		var scope = this;

		var loader = new THREE.XHRLoader();
		loader.setCrossOrigin( this.crossOrigin );
		loader.load( url, function ( text ) {

			onLoad( scope.parse( JSON.parse( text ) ) );

		}, onProgress, onError );

	},

	setCrossOrigin: function ( value ) {

		this.crossOrigin = value;

	},

	parse: function ( json ) {

		var material = new THREE[ json.type ];

		if ( json.color !== undefined ) material.color.setHex( json.color );
		if ( json.ambient !== undefined ) material.ambient.setHex( json.ambient );
		if ( json.emissive !== undefined ) material.emissive.setHex( json.emissive );
		if ( json.specular !== undefined ) material.specular.setHex( json.specular );
		if ( json.shininess !== undefined ) material.shininess = json.shininess;
		if ( json.uniforms !== undefined ) material.uniforms = json.uniforms;
		if ( json.vertexShader !== undefined ) material.vertexShader = json.vertexShader;
		if ( json.fragmentShader !== undefined ) material.fragmentShader = json.fragmentShader;		
		if ( json.vertexColors !== undefined ) material.vertexColors = json.vertexColors;
		if ( json.shading !== undefined ) material.shading = json.shading;
		if ( json.blending !== undefined ) material.blending = json.blending;
		if ( json.side !== undefined ) material.side = json.side;
		if ( json.opacity !== undefined ) material.opacity = json.opacity;
		if ( json.transparent !== undefined ) material.transparent = json.transparent;
		if ( json.wireframe !== undefined ) material.wireframe = json.wireframe;

		if ( json.materials !== undefined ) {

			for ( var i = 0, l = json.materials.length; i < l; i ++ ) {

				material.materials.push( this.parse( json.materials[ i ] ) );

			}

		}

		return material;

	}

};

// File:src/loaders/ObjectLoader.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.ObjectLoader = function ( manager ) {

	this.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;

};

THREE.ObjectLoader.prototype = {

	constructor: THREE.ObjectLoader,

	load: function ( url, onLoad, onProgress, onError ) {

		var scope = this;

		var loader = new THREE.XHRLoader( scope.manager );
		loader.setCrossOrigin( this.crossOrigin );
		loader.load( url, function ( text ) {

			onLoad( scope.parse( JSON.parse( text ) ) );

		}, onProgress, onError );

	},

	setCrossOrigin: function ( value ) {

		this.crossOrigin = value;

	},

	parse: function ( json ) {

		var geometries = this.parseGeometries( json.geometries );
		var materials = this.parseMaterials( json.materials );
		var object = this.parseObject( json.object, geometries, materials );

		return object;

	},

	parseGeometries: function ( json ) {

		var geometries = {};

		if ( json !== undefined ) {

			var geometryLoader = new THREE.JSONLoader();
			var bufferGeometryLoader = new THREE.BufferGeometryLoader();

			for ( var i = 0, l = json.length; i < l; i ++ ) {

				var geometry;
				var data = json[ i ];

				switch ( data.type ) {

					case 'PlaneGeometry':

						geometry = new THREE.PlaneGeometry(
							data.width,
							data.height,
							data.widthSegments,
							data.heightSegments
						);

						break;

					case 'BoxGeometry':
					case 'CubeGeometry': // backwards compatible

						geometry = new THREE.BoxGeometry(
							data.width,
							data.height,
							data.depth,
							data.widthSegments,
							data.heightSegments,
							data.depthSegments
						);

						break;

					case 'CircleGeometry':

						geometry = new THREE.CircleGeometry(
							data.radius,
							data.segments
						);

						break;

					case 'CylinderGeometry':

						geometry = new THREE.CylinderGeometry(
							data.radiusTop,
							data.radiusBottom,
							data.height,
							data.radialSegments,
							data.heightSegments,
							data.openEnded
						);

						break;

					case 'SphereGeometry':

						geometry = new THREE.SphereGeometry(
							data.radius,
							data.widthSegments,
							data.heightSegments,
							data.phiStart,
							data.phiLength,
							data.thetaStart,
							data.thetaLength
						);

						break;

					case 'IcosahedronGeometry':

						geometry = new THREE.IcosahedronGeometry(
							data.radius,
							data.detail
						);

						break;

					case 'TorusGeometry':

						geometry = new THREE.TorusGeometry(
							data.radius,
							data.tube,
							data.radialSegments,
							data.tubularSegments,
							data.arc
						);

						break;

					case 'TorusKnotGeometry':

						geometry = new THREE.TorusKnotGeometry(
							data.radius,
							data.tube,
							data.radialSegments,
							data.tubularSegments,
							data.p,
							data.q,
							data.heightScale
						);

						break;

					case 'BufferGeometry':

						geometry = bufferGeometryLoader.parse( data.data );

						break;

					case 'Geometry':

						geometry = geometryLoader.parse( data.data ).geometry;

						break;

				}

				geometry.uuid = data.uuid;

				if ( data.name !== undefined ) geometry.name = data.name;

				geometries[ data.uuid ] = geometry;

			}

		}

		return geometries;

	},

	parseMaterials: function ( json ) {

		var materials = {};

		if ( json !== undefined ) {

			var loader = new THREE.MaterialLoader();

			for ( var i = 0, l = json.length; i < l; i ++ ) {

				var data = json[ i ];
				var material = loader.parse( data );

				material.uuid = data.uuid;

				if ( data.name !== undefined ) material.name = data.name;

				materials[ data.uuid ] = material;

			}

		}

		return materials;

	},

	parseObject: function () {

		var matrix = new THREE.Matrix4();

		return function ( data, geometries, materials ) {

			var object;

			switch ( data.type ) {

				case 'Scene':

					object = new THREE.Scene();

					break;

				case 'PerspectiveCamera':

					object = new THREE.PerspectiveCamera( data.fov, data.aspect, data.near, data.far );

					break;

				case 'OrthographicCamera':

					object = new THREE.OrthographicCamera( data.left, data.right, data.top, data.bottom, data.near, data.far );

					break;

				case 'AmbientLight':

					object = new THREE.AmbientLight( data.color );

					break;

				case 'DirectionalLight':

					object = new THREE.DirectionalLight( data.color, data.intensity );

					break;

				case 'PointLight':

					object = new THREE.PointLight( data.color, data.intensity, data.distance );

					break;

				case 'SpotLight':

					object = new THREE.SpotLight( data.color, data.intensity, data.distance, data.angle, data.exponent );

					break;

				case 'HemisphereLight':

					object = new THREE.HemisphereLight( data.color, data.groundColor, data.intensity );

					break;

				case 'Mesh':

					var geometry = geometries[ data.geometry ];
					var material = materials[ data.material ];

					if ( geometry === undefined ) {

						console.warn( 'THREE.ObjectLoader: Undefined geometry', data.geometry );

					}

					if ( material === undefined ) {

						console.warn( 'THREE.ObjectLoader: Undefined material', data.material );

					}

					object = new THREE.Mesh( geometry, material );

					break;

				case 'Line':

					var geometry = geometries[ data.geometry ];
					var material = materials[ data.material ];

					if ( geometry === undefined ) {

						console.warn( 'THREE.ObjectLoader: Undefined geometry', data.geometry );

					}

					if ( material === undefined ) {

						console.warn( 'THREE.ObjectLoader: Undefined material', data.material );

					}

					object = new THREE.Line( geometry, material );

					break;

				case 'Sprite':

					var material = materials[ data.material ];

					if ( material === undefined ) {

						console.warn( 'THREE.ObjectLoader: Undefined material', data.material );

					}

					object = new THREE.Sprite( material );

					break;

				case 'Group':

					object = new THREE.Group();

					break;

				default:

					object = new THREE.Object3D();

			}

			object.uuid = data.uuid;

			if ( data.name !== undefined ) object.name = data.name;
			if ( data.matrix !== undefined ) {

				matrix.fromArray( data.matrix );
				matrix.decompose( object.position, object.quaternion, object.scale );

			} else {

				if ( data.position !== undefined ) object.position.fromArray( data.position );
				if ( data.rotation !== undefined ) object.rotation.fromArray( data.rotation );
				if ( data.scale !== undefined ) object.scale.fromArray( data.scale );

			}

			if ( data.visible !== undefined ) object.visible = data.visible;
			if ( data.userData !== undefined ) object.userData = data.userData;

			if ( data.children !== undefined ) {

				for ( var child in data.children ) {

					object.add( this.parseObject( data.children[ child ], geometries, materials ) );

				}

			}

			return object;

		}

	}()

};

// File:src/loaders/TextureLoader.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.TextureLoader = function ( manager ) {

	this.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;

};

THREE.TextureLoader.prototype = {

	constructor: THREE.TextureLoader,

	load: function ( url, onLoad, onProgress, onError ) {

		var scope = this;

		var loader = new THREE.ImageLoader( scope.manager );
		loader.setCrossOrigin( this.crossOrigin );
		loader.load( url, function ( image ) {

			var texture = new THREE.Texture( image );
			texture.needsUpdate = true;

			if ( onLoad !== undefined ) {

				onLoad( texture );

			}

		}, onProgress, onError );

	},

	setCrossOrigin: function ( value ) {

		this.crossOrigin = value;

	}

};

// File:src/loaders/CompressedTextureLoader.js

/**
 * @author mrdoob / http://mrdoob.com/
 *
 * Abstract Base class to block based textures loader (dds, pvr, ...)
 */

THREE.CompressedTextureLoader = function () {

	// override in sub classes
	this._parser = null;

};


THREE.CompressedTextureLoader.prototype = {

	constructor: THREE.CompressedTextureLoader,

	load: function ( url, onLoad, onError ) {

		var scope = this;

		var images = [];

		var texture = new THREE.CompressedTexture();
		texture.image = images;

		var loader = new THREE.XHRLoader();
		loader.setResponseType( 'arraybuffer' );

		if ( url instanceof Array ) {

			var loaded = 0;

			var loadTexture = function ( i ) {

				loader.load( url[ i ], function ( buffer ) {

					var texDatas = scope._parser( buffer, true );

					images[ i ] = {
						width: texDatas.width,
						height: texDatas.height,
						format: texDatas.format,
						mipmaps: texDatas.mipmaps
					};

					loaded += 1;

					if ( loaded === 6 ) {

 						if (texDatas.mipmapCount == 1)
 							texture.minFilter = THREE.LinearFilter;

						texture.format = texDatas.format;
						texture.needsUpdate = true;

						if ( onLoad ) onLoad( texture );

					}

				} );

			};

			for ( var i = 0, il = url.length; i < il; ++ i ) {

				loadTexture( i );

			}

		} else {

			// compressed cubemap texture stored in a single DDS file

			loader.load( url, function ( buffer ) {

				var texDatas = scope._parser( buffer, true );

				if ( texDatas.isCubemap ) {

					var faces = texDatas.mipmaps.length / texDatas.mipmapCount;

					for ( var f = 0; f < faces; f ++ ) {

						images[ f ] = { mipmaps : [] };

						for ( var i = 0; i < texDatas.mipmapCount; i ++ ) {

							images[ f ].mipmaps.push( texDatas.mipmaps[ f * texDatas.mipmapCount + i ] );
							images[ f ].format = texDatas.format;
							images[ f ].width = texDatas.width;
							images[ f ].height = texDatas.height;

						}

					}

				} else {

					texture.image.width = texDatas.width;
					texture.image.height = texDatas.height;
					texture.mipmaps = texDatas.mipmaps;

				}

				if ( texDatas.mipmapCount === 1 ) {

					texture.minFilter = THREE.LinearFilter;

				}

				texture.format = texDatas.format;
				texture.needsUpdate = true;

				if ( onLoad ) onLoad( texture );

			} );

		}

		return texture;

	}

};

// File:src/materials/Material.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 */

THREE.Material = function () {

	Object.defineProperty( this, 'id', { value: THREE.MaterialIdCount ++ } );

	this.uuid = THREE.Math.generateUUID();

	this.name = '';
	this.type = 'Material';

	this.side = THREE.FrontSide;

	this.opacity = 1;
	this.transparent = false;

	this.blending = THREE.NormalBlending;

	this.blendSrc = THREE.SrcAlphaFactor;
	this.blendDst = THREE.OneMinusSrcAlphaFactor;
	this.blendEquation = THREE.AddEquation;

	this.depthTest = true;
	this.depthWrite = true;

	this.polygonOffset = false;
	this.polygonOffsetFactor = 0;
	this.polygonOffsetUnits = 0;

	this.alphaTest = 0;

	this.overdraw = 0; // Overdrawn pixels (typically between 0 and 1) for fixing antialiasing gaps in CanvasRenderer

	this.visible = true;

	this.needsUpdate = true;

};

THREE.Material.prototype = {

	constructor: THREE.Material,

	setValues: function ( values ) {

		if ( values === undefined ) return;

		for ( var key in values ) {

			var newValue = values[ key ];

			if ( newValue === undefined ) {

				console.warn( "THREE.Material: '" + key + "' parameter is undefined." );
				continue;

			}

			if ( key in this ) {

				var currentValue = this[ key ];

				if ( currentValue instanceof THREE.Color ) {

					currentValue.set( newValue );

				} else if ( currentValue instanceof THREE.Vector3 && newValue instanceof THREE.Vector3 ) {

					currentValue.copy( newValue );

				} else if ( key == 'overdraw' ) {

					// ensure overdraw is backwards-compatable with legacy boolean type
					this[ key ] = Number( newValue );

				} else {

					this[ key ] = newValue;

				}

			}

		}

	},

	toJSON: function () {

		var output = {
			metadata: {
				version: 4.2,
				type: 'material',
				generator: 'MaterialExporter'
			},
			uuid: this.uuid,
			type: this.type
		};

		if ( this.name !== "" ) output.name = this.name;

		if ( this instanceof THREE.MeshBasicMaterial ) {

			output.color = this.color.getHex();
			if ( this.vertexColors !== THREE.NoColors ) output.vertexColors = this.vertexColors;
			if ( this.blending !== THREE.NormalBlending ) output.blending = this.blending;
			if ( this.side !== THREE.FrontSide ) output.side = this.side;

		} else if ( this instanceof THREE.MeshLambertMaterial ) {

			output.color = this.color.getHex();
			output.ambient = this.ambient.getHex();
			output.emissive = this.emissive.getHex();
			if ( this.vertexColors !== THREE.NoColors ) output.vertexColors = this.vertexColors;
			if ( this.blending !== THREE.NormalBlending ) output.blending = this.blending;
			if ( this.side !== THREE.FrontSide ) output.side = this.side;

		} else if ( this instanceof THREE.MeshPhongMaterial ) {

			output.color = this.color.getHex();
			output.ambient = this.ambient.getHex();
			output.emissive = this.emissive.getHex();
			output.specular = this.specular.getHex();
			output.shininess = this.shininess;
			if ( this.vertexColors !== THREE.NoColors ) output.vertexColors = this.vertexColors;
			if ( this.blending !== THREE.NormalBlending ) output.blending = this.blending;
			if ( this.side !== THREE.FrontSide ) output.side = this.side;

		} else if ( this instanceof THREE.MeshNormalMaterial ) {

			if ( this.shading !== THREE.FlatShading ) output.shading = this.shading;
			if ( this.blending !== THREE.NormalBlending ) output.blending = this.blending;
			if ( this.side !== THREE.FrontSide ) output.side = this.side;

		} else if ( this instanceof THREE.MeshDepthMaterial ) {

			if ( this.blending !== THREE.NormalBlending ) output.blending = this.blending;
			if ( this.side !== THREE.FrontSide ) output.side = this.side;

		} else if ( this instanceof THREE.ShaderMaterial ) {

			output.uniforms = this.uniforms;
			output.vertexShader = this.vertexShader;
			output.fragmentShader = this.fragmentShader;

		} else if ( this instanceof THREE.SpriteMaterial ) {

			output.color = this.color.getHex();

		}

		if ( this.opacity < 1 ) output.opacity = this.opacity;
		if ( this.transparent !== false ) output.transparent = this.transparent;
		if ( this.wireframe !== false ) output.wireframe = this.wireframe;

		return output;

	},

	clone: function ( material ) {

		if ( material === undefined ) material = new THREE.Material();

		material.name = this.name;

		material.side = this.side;

		material.opacity = this.opacity;
		material.transparent = this.transparent;

		material.blending = this.blending;

		material.blendSrc = this.blendSrc;
		material.blendDst = this.blendDst;
		material.blendEquation = this.blendEquation;

		material.depthTest = this.depthTest;
		material.depthWrite = this.depthWrite;

		material.polygonOffset = this.polygonOffset;
		material.polygonOffsetFactor = this.polygonOffsetFactor;
		material.polygonOffsetUnits = this.polygonOffsetUnits;

		material.alphaTest = this.alphaTest;

		material.overdraw = this.overdraw;

		material.visible = this.visible;

		return material;

	},

	dispose: function () {

		this.dispatchEvent( { type: 'dispose' } );

	}

};

THREE.EventDispatcher.prototype.apply( THREE.Material.prototype );

THREE.MaterialIdCount = 0;

// File:src/materials/LineBasicMaterial.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  color: <hex>,
 *  opacity: <float>,
 *
 *  blending: THREE.NormalBlending,
 *  depthTest: <bool>,
 *  depthWrite: <bool>,
 *
 *  linewidth: <float>,
 *  linecap: "round",
 *  linejoin: "round",
 *
 *  vertexColors: <bool>
 *
 *  fog: <bool>
 * }
 */

THREE.LineBasicMaterial = function ( parameters ) {

	THREE.Material.call( this );

	this.type = 'LineBasicMaterial';

	this.color = new THREE.Color( 0xffffff );

	this.linewidth = 1;
	this.linecap = 'round';
	this.linejoin = 'round';

	this.vertexColors = THREE.NoColors;

	this.fog = true;

	this.setValues( parameters );

};

THREE.LineBasicMaterial.prototype = Object.create( THREE.Material.prototype );

THREE.LineBasicMaterial.prototype.clone = function () {

	var material = new THREE.LineBasicMaterial();

	THREE.Material.prototype.clone.call( this, material );

	material.color.copy( this.color );

	material.linewidth = this.linewidth;
	material.linecap = this.linecap;
	material.linejoin = this.linejoin;

	material.vertexColors = this.vertexColors;

	material.fog = this.fog;

	return material;

};

// File:src/materials/LineDashedMaterial.js

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  color: <hex>,
 *  opacity: <float>,
 *
 *  blending: THREE.NormalBlending,
 *  depthTest: <bool>,
 *  depthWrite: <bool>,
 *
 *  linewidth: <float>,
 *
 *  scale: <float>,
 *  dashSize: <float>,
 *  gapSize: <float>,
 *
 *  vertexColors: <bool>
 *
 *  fog: <bool>
 * }
 */

THREE.LineDashedMaterial = function ( parameters ) {

	THREE.Material.call( this );

	this.type = 'LineDashedMaterial';

	this.color = new THREE.Color( 0xffffff );

	this.linewidth = 1;

	this.scale = 1;
	this.dashSize = 3;
	this.gapSize = 1;

	this.vertexColors = false;

	this.fog = true;

	this.setValues( parameters );

};

THREE.LineDashedMaterial.prototype = Object.create( THREE.Material.prototype );

THREE.LineDashedMaterial.prototype.clone = function () {

	var material = new THREE.LineDashedMaterial();

	THREE.Material.prototype.clone.call( this, material );

	material.color.copy( this.color );

	material.linewidth = this.linewidth;

	material.scale = this.scale;
	material.dashSize = this.dashSize;
	material.gapSize = this.gapSize;

	material.vertexColors = this.vertexColors;

	material.fog = this.fog;

	return material;

};

// File:src/materials/MeshBasicMaterial.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  color: <hex>,
 *  opacity: <float>,
 *  map: new THREE.Texture( <Image> ),
 *
 *  lightMap: new THREE.Texture( <Image> ),
 *
 *  specularMap: new THREE.Texture( <Image> ),
 *
 *  alphaMap: new THREE.Texture( <Image> ),
 *
 *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),
 *  combine: THREE.Multiply,
 *  reflectivity: <float>,
 *  refractionRatio: <float>,
 *
 *  shading: THREE.SmoothShading,
 *  blending: THREE.NormalBlending,
 *  depthTest: <bool>,
 *  depthWrite: <bool>,
 *
 *  wireframe: <boolean>,
 *  wireframeLinewidth: <float>,
 *
 *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,
 *
 *  skinning: <bool>,
 *  morphTargets: <bool>,
 *
 *  fog: <bool>
 * }
 */

THREE.MeshBasicMaterial = function ( parameters ) {

	THREE.Material.call( this );

	this.type = 'MeshBasicMaterial';

	this.color = new THREE.Color( 0xffffff ); // emissive

	this.map = null;

	this.lightMap = null;

	this.specularMap = null;

	this.alphaMap = null;

	this.envMap = null;
	this.combine = THREE.MultiplyOperation;
	this.reflectivity = 1;
	this.refractionRatio = 0.98;

	this.fog = true;

	this.shading = THREE.SmoothShading;

	this.wireframe = false;
	this.wireframeLinewidth = 1;
	this.wireframeLinecap = 'round';
	this.wireframeLinejoin = 'round';

	this.vertexColors = THREE.NoColors;

	this.skinning = false;
	this.morphTargets = false;

	this.setValues( parameters );

};

THREE.MeshBasicMaterial.prototype = Object.create( THREE.Material.prototype );

THREE.MeshBasicMaterial.prototype.clone = function () {

	var material = new THREE.MeshBasicMaterial();

	THREE.Material.prototype.clone.call( this, material );

	material.color.copy( this.color );

	material.map = this.map;

	material.lightMap = this.lightMap;

	material.specularMap = this.specularMap;

	material.alphaMap = this.alphaMap;

	material.envMap = this.envMap;
	material.combine = this.combine;
	material.reflectivity = this.reflectivity;
	material.refractionRatio = this.refractionRatio;

	material.fog = this.fog;

	material.shading = this.shading;

	material.wireframe = this.wireframe;
	material.wireframeLinewidth = this.wireframeLinewidth;
	material.wireframeLinecap = this.wireframeLinecap;
	material.wireframeLinejoin = this.wireframeLinejoin;

	material.vertexColors = this.vertexColors;

	material.skinning = this.skinning;
	material.morphTargets = this.morphTargets;

	return material;

};

// File:src/materials/MeshLambertMaterial.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  color: <hex>,
 *  ambient: <hex>,
 *  emissive: <hex>,
 *  opacity: <float>,
 *
 *  map: new THREE.Texture( <Image> ),
 *
 *  lightMap: new THREE.Texture( <Image> ),
 *
 *  specularMap: new THREE.Texture( <Image> ),
 *
 *  alphaMap: new THREE.Texture( <Image> ),
 *
 *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),
 *  combine: THREE.Multiply,
 *  reflectivity: <float>,
 *  refractionRatio: <float>,
 *
 *  shading: THREE.SmoothShading,
 *  blending: THREE.NormalBlending,
 *  depthTest: <bool>,
 *  depthWrite: <bool>,
 *
 *  wireframe: <boolean>,
 *  wireframeLinewidth: <float>,
 *
 *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,
 *
 *  skinning: <bool>,
 *  morphTargets: <bool>,
 *  morphNormals: <bool>,
 *
 *	fog: <bool>
 * }
 */

THREE.MeshLambertMaterial = function ( parameters ) {

	THREE.Material.call( this );

	this.type = 'MeshLambertMaterial';

	this.color = new THREE.Color( 0xffffff ); // diffuse
	this.ambient = new THREE.Color( 0xffffff );
	this.emissive = new THREE.Color( 0x000000 );

	this.wrapAround = false;
	this.wrapRGB = new THREE.Vector3( 1, 1, 1 );

	this.map = null;

	this.lightMap = null;

	this.specularMap = null;

	this.alphaMap = null;

	this.envMap = null;
	this.combine = THREE.MultiplyOperation;
	this.reflectivity = 1;
	this.refractionRatio = 0.98;

	this.fog = true;

	this.shading = THREE.SmoothShading;

	this.wireframe = false;
	this.wireframeLinewidth = 1;
	this.wireframeLinecap = 'round';
	this.wireframeLinejoin = 'round';

	this.vertexColors = THREE.NoColors;

	this.skinning = false;
	this.morphTargets = false;
	this.morphNormals = false;

	this.setValues( parameters );

};

THREE.MeshLambertMaterial.prototype = Object.create( THREE.Material.prototype );

THREE.MeshLambertMaterial.prototype.clone = function () {

	var material = new THREE.MeshLambertMaterial();

	THREE.Material.prototype.clone.call( this, material );

	material.color.copy( this.color );
	material.ambient.copy( this.ambient );
	material.emissive.copy( this.emissive );

	material.wrapAround = this.wrapAround;
	material.wrapRGB.copy( this.wrapRGB );

	material.map = this.map;

	material.lightMap = this.lightMap;

	material.specularMap = this.specularMap;

	material.alphaMap = this.alphaMap;

	material.envMap = this.envMap;
	material.combine = this.combine;
	material.reflectivity = this.reflectivity;
	material.refractionRatio = this.refractionRatio;

	material.fog = this.fog;

	material.shading = this.shading;

	material.wireframe = this.wireframe;
	material.wireframeLinewidth = this.wireframeLinewidth;
	material.wireframeLinecap = this.wireframeLinecap;
	material.wireframeLinejoin = this.wireframeLinejoin;

	material.vertexColors = this.vertexColors;

	material.skinning = this.skinning;
	material.morphTargets = this.morphTargets;
	material.morphNormals = this.morphNormals;

	return material;

};

// File:src/materials/MeshPhongMaterial.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  color: <hex>,
 *  ambient: <hex>,
 *  emissive: <hex>,
 *  specular: <hex>,
 *  shininess: <float>,
 *  opacity: <float>,
 *
 *  map: new THREE.Texture( <Image> ),
 *
 *  lightMap: new THREE.Texture( <Image> ),
 *
 *  bumpMap: new THREE.Texture( <Image> ),
 *  bumpScale: <float>,
 *
 *  normalMap: new THREE.Texture( <Image> ),
 *  normalScale: <Vector2>,
 *
 *  specularMap: new THREE.Texture( <Image> ),
 *
 *  alphaMap: new THREE.Texture( <Image> ),
 *
 *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),
 *  combine: THREE.Multiply,
 *  reflectivity: <float>,
 *  refractionRatio: <float>,
 *
 *  shading: THREE.SmoothShading,
 *  blending: THREE.NormalBlending,
 *  depthTest: <bool>,
 *  depthWrite: <bool>,
 *
 *  wireframe: <boolean>,
 *  wireframeLinewidth: <float>,
 *
 *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,
 *
 *  skinning: <bool>,
 *  morphTargets: <bool>,
 *  morphNormals: <bool>,
 *
 *	fog: <bool>
 * }
 */

THREE.MeshPhongMaterial = function ( parameters ) {

	THREE.Material.call( this );

	this.type = 'MeshPhongMaterial';

	this.color = new THREE.Color( 0xffffff ); // diffuse
	this.ambient = new THREE.Color( 0xffffff );
	this.emissive = new THREE.Color( 0x000000 );
	this.specular = new THREE.Color( 0x111111 );
	this.shininess = 30;

	this.metal = false;

	this.wrapAround = false;
	this.wrapRGB = new THREE.Vector3( 1, 1, 1 );

	this.map = null;

	this.lightMap = null;

	this.bumpMap = null;
	this.bumpScale = 1;

	this.normalMap = null;
	this.normalScale = new THREE.Vector2( 1, 1 );

	this.specularMap = null;

	this.alphaMap = null;

	this.envMap = null;
	this.combine = THREE.MultiplyOperation;
	this.reflectivity = 1;
	this.refractionRatio = 0.98;

	this.fog = true;

	this.shading = THREE.SmoothShading;

	this.wireframe = false;
	this.wireframeLinewidth = 1;
	this.wireframeLinecap = 'round';
	this.wireframeLinejoin = 'round';

	this.vertexColors = THREE.NoColors;

	this.skinning = false;
	this.morphTargets = false;
	this.morphNormals = false;

	this.setValues( parameters );

};

THREE.MeshPhongMaterial.prototype = Object.create( THREE.Material.prototype );

THREE.MeshPhongMaterial.prototype.clone = function () {

	var material = new THREE.MeshPhongMaterial();

	THREE.Material.prototype.clone.call( this, material );

	material.color.copy( this.color );
	material.ambient.copy( this.ambient );
	material.emissive.copy( this.emissive );
	material.specular.copy( this.specular );
	material.shininess = this.shininess;

	material.metal = this.metal;

	material.wrapAround = this.wrapAround;
	material.wrapRGB.copy( this.wrapRGB );

	material.map = this.map;

	material.lightMap = this.lightMap;

	material.bumpMap = this.bumpMap;
	material.bumpScale = this.bumpScale;

	material.normalMap = this.normalMap;
	material.normalScale.copy( this.normalScale );

	material.specularMap = this.specularMap;

	material.alphaMap = this.alphaMap;

	material.envMap = this.envMap;
	material.combine = this.combine;
	material.reflectivity = this.reflectivity;
	material.refractionRatio = this.refractionRatio;

	material.fog = this.fog;

	material.shading = this.shading;

	material.wireframe = this.wireframe;
	material.wireframeLinewidth = this.wireframeLinewidth;
	material.wireframeLinecap = this.wireframeLinecap;
	material.wireframeLinejoin = this.wireframeLinejoin;

	material.vertexColors = this.vertexColors;

	material.skinning = this.skinning;
	material.morphTargets = this.morphTargets;
	material.morphNormals = this.morphNormals;

	return material;

};

// File:src/materials/MeshDepthMaterial.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  opacity: <float>,
 *
 *  blending: THREE.NormalBlending,
 *  depthTest: <bool>,
 *  depthWrite: <bool>,
 *
 *  wireframe: <boolean>,
 *  wireframeLinewidth: <float>
 * }
 */

THREE.MeshDepthMaterial = function ( parameters ) {

	THREE.Material.call( this );

	this.type = 'MeshDepthMaterial';

	this.morphTargets = false;
	this.wireframe = false;
	this.wireframeLinewidth = 1;

	this.setValues( parameters );

};

THREE.MeshDepthMaterial.prototype = Object.create( THREE.Material.prototype );

THREE.MeshDepthMaterial.prototype.clone = function () {

	var material = new THREE.MeshDepthMaterial();

	THREE.Material.prototype.clone.call( this, material );

	material.wireframe = this.wireframe;
	material.wireframeLinewidth = this.wireframeLinewidth;

	return material;

};

// File:src/materials/MeshNormalMaterial.js

/**
 * @author mrdoob / http://mrdoob.com/
 *
 * parameters = {
 *  opacity: <float>,
 *
 *  shading: THREE.FlatShading,
 *  blending: THREE.NormalBlending,
 *  depthTest: <bool>,
 *  depthWrite: <bool>,
 *
 *  wireframe: <boolean>,
 *  wireframeLinewidth: <float>
 * }
 */

THREE.MeshNormalMaterial = function ( parameters ) {

	THREE.Material.call( this, parameters );

	this.type = 'MeshNormalMaterial';

	this.shading = THREE.FlatShading;

	this.wireframe = false;
	this.wireframeLinewidth = 1;

	this.morphTargets = false;

	this.setValues( parameters );

};

THREE.MeshNormalMaterial.prototype = Object.create( THREE.Material.prototype );

THREE.MeshNormalMaterial.prototype.clone = function () {

	var material = new THREE.MeshNormalMaterial();

	THREE.Material.prototype.clone.call( this, material );

	material.shading = this.shading;

	material.wireframe = this.wireframe;
	material.wireframeLinewidth = this.wireframeLinewidth;

	return material;

};

// File:src/materials/MeshFaceMaterial.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.MeshFaceMaterial = function ( materials ) {

	this.uuid = THREE.Math.generateUUID();

	this.type = 'MeshFaceMaterial';
	
	this.materials = materials instanceof Array ? materials : [];

};

THREE.MeshFaceMaterial.prototype = {

	constructor: THREE.MeshFaceMaterial,

	toJSON: function () {

		var output = {
			metadata: {
				version: 4.2,
				type: 'material',
				generator: 'MaterialExporter'
			},
			uuid: this.uuid,
			type: this.type,
			materials: []
		};

		for ( var i = 0, l = this.materials.length; i < l; i ++ ) {

			output.materials.push( this.materials[ i ].toJSON() );

		}

		return output;

	},

	clone: function () {

		var material = new THREE.MeshFaceMaterial();

		for ( var i = 0; i < this.materials.length; i ++ ) {

			material.materials.push( this.materials[ i ].clone() );

		}

		return material;

	}

};

// File:src/materials/PointCloudMaterial.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  color: <hex>,
 *  opacity: <float>,
 *  map: new THREE.Texture( <Image> ),
 *
 *  size: <float>,
 *
 *  blending: THREE.NormalBlending,
 *  depthTest: <bool>,
 *  depthWrite: <bool>,
 *
 *  vertexColors: <bool>,
 *
 *  fog: <bool>
 * }
 */

THREE.PointCloudMaterial = function ( parameters ) {

	THREE.Material.call( this );

	this.type = 'PointCloudMaterial';

	this.color = new THREE.Color( 0xffffff );

	this.map = null;

	this.size = 1;
	this.sizeAttenuation = true;

	this.vertexColors = THREE.NoColors;

	this.fog = true;

	this.setValues( parameters );

};

THREE.PointCloudMaterial.prototype = Object.create( THREE.Material.prototype );

THREE.PointCloudMaterial.prototype.clone = function () {

	var material = new THREE.PointCloudMaterial();

	THREE.Material.prototype.clone.call( this, material );

	material.color.copy( this.color );

	material.map = this.map;

	material.size = this.size;
	material.sizeAttenuation = this.sizeAttenuation;

	material.vertexColors = this.vertexColors;

	material.fog = this.fog;

	return material;

};

// backwards compatibility

THREE.ParticleBasicMaterial = function ( parameters ) {

	console.warn( 'THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial.' );
	return new THREE.PointCloudMaterial( parameters );

};

THREE.ParticleSystemMaterial = function ( parameters ) {

	console.warn( 'THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial.' );
	return new THREE.PointCloudMaterial( parameters );

};

// File:src/materials/ShaderMaterial.js

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  defines: { "label" : "value" },
 *  uniforms: { "parameter1": { type: "f", value: 1.0 }, "parameter2": { type: "i" value2: 2 } },
 *
 *  fragmentShader: <string>,
 *  vertexShader: <string>,
 *
 *  shading: THREE.SmoothShading,
 *  blending: THREE.NormalBlending,
 *  depthTest: <bool>,
 *  depthWrite: <bool>,
 *
 *  wireframe: <boolean>,
 *  wireframeLinewidth: <float>,
 *
 *  lights: <bool>,
 *
 *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,
 *
 *  skinning: <bool>,
 *  morphTargets: <bool>,
 *  morphNormals: <bool>,
 *
 *	fog: <bool>
 * }
 */

THREE.ShaderMaterial = function ( parameters ) {

	THREE.Material.call( this );

	this.type = 'ShaderMaterial';

	this.defines = {};
	this.uniforms = {};
	this.attributes = null;

	this.vertexShader = 'void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}';
	this.fragmentShader = 'void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}';

	this.shading = THREE.SmoothShading;

	this.linewidth = 1;

	this.wireframe = false;
	this.wireframeLinewidth = 1;

	this.fog = false; // set to use scene fog

	this.lights = false; // set to use scene lights

	this.vertexColors = THREE.NoColors; // set to use "color" attribute stream

	this.skinning = false; // set to use skinning attribute streams

	this.morphTargets = false; // set to use morph targets
	this.morphNormals = false; // set to use morph normals

	// When rendered geometry doesn't include these attributes but the material does,
	// use these default values in WebGL. This avoids errors when buffer data is missing.
	this.defaultAttributeValues = {
		'color': [ 1, 1, 1 ],
		'uv': [ 0, 0 ],
		'uv2': [ 0, 0 ]
	};

	this.index0AttributeName = undefined;

	this.setValues( parameters );

};

THREE.ShaderMaterial.prototype = Object.create( THREE.Material.prototype );

THREE.ShaderMaterial.prototype.clone = function () {

	var material = new THREE.ShaderMaterial();

	THREE.Material.prototype.clone.call( this, material );

	material.fragmentShader = this.fragmentShader;
	material.vertexShader = this.vertexShader;

	material.uniforms = THREE.UniformsUtils.clone( this.uniforms );

	material.attributes = this.attributes;
	material.defines = this.defines;

	material.shading = this.shading;

	material.wireframe = this.wireframe;
	material.wireframeLinewidth = this.wireframeLinewidth;

	material.fog = this.fog;

	material.lights = this.lights;

	material.vertexColors = this.vertexColors;

	material.skinning = this.skinning;

	material.morphTargets = this.morphTargets;
	material.morphNormals = this.morphNormals;

	return material;

};

// File:src/materials/RawShaderMaterial.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.RawShaderMaterial = function ( parameters ) {

	THREE.ShaderMaterial.call( this, parameters );

	this.type = 'RawShaderMaterial';

};

THREE.RawShaderMaterial.prototype = Object.create( THREE.ShaderMaterial.prototype );

THREE.RawShaderMaterial.prototype.clone = function () {

	var material = new THREE.RawShaderMaterial();

	THREE.ShaderMaterial.prototype.clone.call( this, material );

	return material;

};

// File:src/materials/SpriteMaterial.js

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * parameters = {
 *  color: <hex>,
 *  opacity: <float>,
 *  map: new THREE.Texture( <Image> ),
 *
 *  blending: THREE.NormalBlending,
 *  depthTest: <bool>,
 *  depthWrite: <bool>,
 *
 *	uvOffset: new THREE.Vector2(),
 *	uvScale: new THREE.Vector2(),
 *
 *  fog: <bool>
 * }
 */

THREE.SpriteMaterial = function ( parameters ) {

	THREE.Material.call( this );

	this.type = 'SpriteMaterial';

	this.color = new THREE.Color( 0xffffff );
	this.map = null;

	this.rotation = 0;

	this.fog = false;

	// set parameters

	this.setValues( parameters );

};

THREE.SpriteMaterial.prototype = Object.create( THREE.Material.prototype );

THREE.SpriteMaterial.prototype.clone = function () {

	var material = new THREE.SpriteMaterial();

	THREE.Material.prototype.clone.call( this, material );

	material.color.copy( this.color );
	material.map = this.map;

	material.rotation = this.rotation;

	material.fog = this.fog;

	return material;

};

// File:src/textures/Texture.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * @author szimek / https://github.com/szimek/
 */

THREE.Texture = function ( image, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy ) {

	Object.defineProperty( this, 'id', { value: THREE.TextureIdCount ++ } );

	this.uuid = THREE.Math.generateUUID();

	this.name = '';

	this.image = image !== undefined ? image : THREE.Texture.DEFAULT_IMAGE;
	this.mipmaps = [];

	this.mapping = mapping !== undefined ? mapping : THREE.Texture.DEFAULT_MAPPING;

	this.wrapS = wrapS !== undefined ? wrapS : THREE.ClampToEdgeWrapping;
	this.wrapT = wrapT !== undefined ? wrapT : THREE.ClampToEdgeWrapping;

	this.magFilter = magFilter !== undefined ? magFilter : THREE.LinearFilter;
	this.minFilter = minFilter !== undefined ? minFilter : THREE.LinearMipMapLinearFilter;

	this.anisotropy = anisotropy !== undefined ? anisotropy : 1;

	this.format = format !== undefined ? format : THREE.RGBAFormat;
	this.type = type !== undefined ? type : THREE.UnsignedByteType;

	this.offset = new THREE.Vector2( 0, 0 );
	this.repeat = new THREE.Vector2( 1, 1 );

	this.generateMipmaps = true;
	this.premultiplyAlpha = false;
	this.flipY = true;
	this.unpackAlignment = 4; // valid values: 1, 2, 4, 8 (see http://www.khronos.org/opengles/sdk/docs/man/xhtml/glPixelStorei.xml)

	this._needsUpdate = false;
	this.onUpdate = null;

};

THREE.Texture.DEFAULT_IMAGE = undefined;
THREE.Texture.DEFAULT_MAPPING = new THREE.UVMapping();

THREE.Texture.prototype = {

	constructor: THREE.Texture,

	get needsUpdate () {

		return this._needsUpdate;

	},

	set needsUpdate ( value ) {

		if ( value === true ) this.update();

		this._needsUpdate = value;

	},

	clone: function ( texture ) {

		if ( texture === undefined ) texture = new THREE.Texture();

		texture.image = this.image;
		texture.mipmaps = this.mipmaps.slice( 0 );

		texture.mapping = this.mapping;

		texture.wrapS = this.wrapS;
		texture.wrapT = this.wrapT;

		texture.magFilter = this.magFilter;
		texture.minFilter = this.minFilter;

		texture.anisotropy = this.anisotropy;

		texture.format = this.format;
		texture.type = this.type;

		texture.offset.copy( this.offset );
		texture.repeat.copy( this.repeat );

		texture.generateMipmaps = this.generateMipmaps;
		texture.premultiplyAlpha = this.premultiplyAlpha;
		texture.flipY = this.flipY;
		texture.unpackAlignment = this.unpackAlignment;

		return texture;

	},

	update: function () {

		this.dispatchEvent( { type: 'update' } );

	},

	dispose: function () {

		this.dispatchEvent( { type: 'dispose' } );

	}

};

THREE.EventDispatcher.prototype.apply( THREE.Texture.prototype );

THREE.TextureIdCount = 0;

// File:src/textures/CubeTexture.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.CubeTexture = function ( images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy ) {

	THREE.Texture.call( this, images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy );

	this.images = images;

};

THREE.CubeTexture.prototype = Object.create( THREE.Texture.prototype );

THREE.CubeTexture.clone = function ( texture ) {

	if ( texture === undefined ) texture = new THREE.CubeTexture();

	THREE.Texture.prototype.clone.call( this, texture );

	texture.images = this.images;

	return texture;

};

// File:src/textures/CompressedTexture.js

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.CompressedTexture = function ( mipmaps, width, height, format, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy ) {

	THREE.Texture.call( this, null, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy );

	this.image = { width: width, height: height };
	this.mipmaps = mipmaps;

	// no flipping for cube textures
	// (also flipping doesn't work for compressed textures )

	this.flipY = false;

	// can't generate mipmaps for compressed textures
	// mips must be embedded in DDS files

	this.generateMipmaps = false;

};

THREE.CompressedTexture.prototype = Object.create( THREE.Texture.prototype );

THREE.CompressedTexture.prototype.clone = function () {

	var texture = new THREE.CompressedTexture();

	THREE.Texture.prototype.clone.call( this, texture );

	return texture;

};

// File:src/textures/DataTexture.js

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.DataTexture = function ( data, width, height, format, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy ) {

	THREE.Texture.call( this, null, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy );

	this.image = { data: data, width: width, height: height };

};

THREE.DataTexture.prototype = Object.create( THREE.Texture.prototype );

THREE.DataTexture.prototype.clone = function () {

	var texture = new THREE.DataTexture();

	THREE.Texture.prototype.clone.call( this, texture );

	return texture;

};

// File:src/textures/VideoTexture.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.VideoTexture = function ( video, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy ) {

	THREE.Texture.call( this, video, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy );

	this.generateMipmaps = false;

	var scope = this;

	var update = function () {

		requestAnimationFrame( update );

		if ( video.readyState === video.HAVE_ENOUGH_DATA ) {

			scope.needsUpdate = true;

		}

	};

	update();

};

THREE.VideoTexture.prototype = Object.create( THREE.Texture.prototype );

// File:src/objects/Group.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.Group = function () {

	THREE.Object3D.call( this );

	this.type = 'Group';

};

THREE.Group.prototype = Object.create( THREE.Object3D.prototype );

// File:src/objects/PointCloud.js

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.PointCloud = function ( geometry, material ) {

	THREE.Object3D.call( this );

	this.type = 'PointCloud';

	this.geometry = geometry !== undefined ? geometry : new THREE.Geometry();
	this.material = material !== undefined ? material : new THREE.PointCloudMaterial( { color: Math.random() * 0xffffff } );

	this.sortParticles = false;

};

THREE.PointCloud.prototype = Object.create( THREE.Object3D.prototype );

THREE.PointCloud.prototype.raycast = ( function () {

	var inverseMatrix = new THREE.Matrix4();
	var ray = new THREE.Ray();

	return function ( raycaster, intersects ) {

		var object = this;
		var geometry = object.geometry;
		var threshold = raycaster.params.PointCloud.threshold;

		inverseMatrix.getInverse( this.matrixWorld );
		ray.copy( raycaster.ray ).applyMatrix4( inverseMatrix );

		if ( geometry.boundingBox !== null ) {

			if ( ray.isIntersectionBox( geometry.boundingBox ) === false ) {

				return;

			}

		}

		var localThreshold = threshold / ( ( this.scale.x + this.scale.y + this.scale.z ) / 3 );
		var position = new THREE.Vector3();

		var testPoint = function ( point, index ) {

			var rayPointDistance = ray.distanceToPoint( point );

			if ( rayPointDistance < localThreshold ) {

				var intersectPoint = ray.closestPointToPoint( point );
				intersectPoint.applyMatrix4( object.matrixWorld );

				var distance = raycaster.ray.origin.distanceTo( intersectPoint );

				intersects.push( {

					distance: distance,
					distanceToRay: rayPointDistance,
					point: intersectPoint.clone(),
					index: index,
					face: null,
					object: object

				} );

			}

		};

		if ( geometry instanceof THREE.BufferGeometry ) {

			var attributes = geometry.attributes;
			var positions = attributes.position.array;

			if ( attributes.index !== undefined ) {

				var indices = attributes.index.array;
				var offsets = geometry.offsets;

				if ( offsets.length === 0 ) {

					var offset = {
						start: 0,
						count: indices.length,
						index: 0
					};

					offsets = [ offset ];

				}

				for ( var oi = 0, ol = offsets.length; oi < ol; ++oi ) {

					var start = offsets[ oi ].start;
					var count = offsets[ oi ].count;
					var index = offsets[ oi ].index;

					for ( var i = start, il = start + count; i < il; i ++ ) {

						var a = index + indices[ i ];

						position.fromArray( positions, a * 3 );

						testPoint( position, a );

					}

				}

			} else {

				var pointCount = positions.length / 3;

				for ( var i = 0; i < pointCount; i ++ ) {

					position.set(
						positions[ 3 * i ],
						positions[ 3 * i + 1 ],
						positions[ 3 * i + 2 ]
					);

					testPoint( position, i );

				}

			}

		} else {

			var vertices = this.geometry.vertices;

			for ( var i = 0; i < vertices.length; i ++ ) {

				testPoint( vertices[ i ], i );

			}

		}

	};

}() );

THREE.PointCloud.prototype.clone = function ( object ) {

	if ( object === undefined ) object = new THREE.PointCloud( this.geometry, this.material );

	object.sortParticles = this.sortParticles;

	THREE.Object3D.prototype.clone.call( this, object );

	return object;

};

// Backwards compatibility

THREE.ParticleSystem = function ( geometry, material ) {

	console.warn( 'THREE.ParticleSystem has been renamed to THREE.PointCloud.' );
	return new THREE.PointCloud( geometry, material );

};

// File:src/objects/Line.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.Line = function ( geometry, material, mode ) {

	THREE.Object3D.call( this );

	this.type = 'Line';

	this.geometry = geometry !== undefined ? geometry : new THREE.Geometry();
	this.material = material !== undefined ? material : new THREE.LineBasicMaterial( { color: Math.random() * 0xffffff } );

	this.mode = ( mode !== undefined ) ? mode : THREE.LineStrip;

};

THREE.LineStrip = 0;
THREE.LinePieces = 1;

THREE.Line.prototype = Object.create( THREE.Object3D.prototype );

THREE.Line.prototype.raycast = ( function () {

	var inverseMatrix = new THREE.Matrix4();
	var ray = new THREE.Ray();
	var sphere = new THREE.Sphere();

	return function ( raycaster, intersects ) {

		var precision = raycaster.linePrecision;
		var precisionSq = precision * precision;

		var geometry = this.geometry;

		if ( geometry.boundingSphere === null ) geometry.computeBoundingSphere();

		// Checking boundingSphere distance to ray

		sphere.copy( geometry.boundingSphere );
		sphere.applyMatrix4( this.matrixWorld );

		if ( raycaster.ray.isIntersectionSphere( sphere ) === false ) {

			return;

		}

		inverseMatrix.getInverse( this.matrixWorld );
		ray.copy( raycaster.ray ).applyMatrix4( inverseMatrix );

		/* if ( geometry instanceof THREE.BufferGeometry ) {

		} else */ if ( geometry instanceof THREE.Geometry ) {

			var vertices = geometry.vertices;
			var nbVertices = vertices.length;
			var interSegment = new THREE.Vector3();
			var interRay = new THREE.Vector3();
			var step = this.mode === THREE.LineStrip ? 1 : 2;

			for ( var i = 0; i < nbVertices - 1; i = i + step ) {

				var distSq = ray.distanceSqToSegment( vertices[ i ], vertices[ i + 1 ], interRay, interSegment );

				if ( distSq > precisionSq ) continue;

				var distance = ray.origin.distanceTo( interRay );

				if ( distance < raycaster.near || distance > raycaster.far ) continue;

				intersects.push( {

					distance: distance,
					// What do we want? intersection point on the ray or on the segment??
					// point: raycaster.ray.at( distance ),
					point: interSegment.clone().applyMatrix4( this.matrixWorld ),
					face: null,
					faceIndex: null,
					object: this

				} );

			}

		}

	};

}() );

THREE.Line.prototype.clone = function ( object ) {

	if ( object === undefined ) object = new THREE.Line( this.geometry, this.material, this.mode );

	THREE.Object3D.prototype.clone.call( this, object );

	return object;

};

// File:src/objects/Mesh.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * @author mikael emtinger / http://gomo.se/
 * @author jonobr1 / http://jonobr1.com/
 */

THREE.Mesh = function ( geometry, material ) {

	THREE.Object3D.call( this );

	this.type = 'Mesh';
	
	this.geometry = geometry !== undefined ? geometry : new THREE.Geometry();
	this.material = material !== undefined ? material : new THREE.MeshBasicMaterial( { color: Math.random() * 0xffffff } );

	this.updateMorphTargets();

};

THREE.Mesh.prototype = Object.create( THREE.Object3D.prototype );

THREE.Mesh.prototype.updateMorphTargets = function () {

	if ( this.geometry.morphTargets !== undefined && this.geometry.morphTargets.length > 0 ) {

		this.morphTargetBase = - 1;
		this.morphTargetForcedOrder = [];
		this.morphTargetInfluences = [];
		this.morphTargetDictionary = {};

		for ( var m = 0, ml = this.geometry.morphTargets.length; m < ml; m ++ ) {

			this.morphTargetInfluences.push( 0 );
			this.morphTargetDictionary[ this.geometry.morphTargets[ m ].name ] = m;

		}

	}

};

THREE.Mesh.prototype.getMorphTargetIndexByName = function ( name ) {

	if ( this.morphTargetDictionary[ name ] !== undefined ) {

		return this.morphTargetDictionary[ name ];

	}

	console.log( 'THREE.Mesh.getMorphTargetIndexByName: morph target ' + name + ' does not exist. Returning 0.' );

	return 0;

};


THREE.Mesh.prototype.raycast = ( function () {

	var inverseMatrix = new THREE.Matrix4();
	var ray = new THREE.Ray();
	var sphere = new THREE.Sphere();

	var vA = new THREE.Vector3();
	var vB = new THREE.Vector3();
	var vC = new THREE.Vector3();

	return function ( raycaster, intersects ) {

		var geometry = this.geometry;

		// Checking boundingSphere distance to ray

		if ( geometry.boundingSphere === null ) geometry.computeBoundingSphere();

		sphere.copy( geometry.boundingSphere );
		sphere.applyMatrix4( this.matrixWorld );

		if ( raycaster.ray.isIntersectionSphere( sphere ) === false ) {

			return;

		}

		// Check boundingBox before continuing

		inverseMatrix.getInverse( this.matrixWorld );
		ray.copy( raycaster.ray ).applyMatrix4( inverseMatrix );

		if ( geometry.boundingBox !== null ) {

			if ( ray.isIntersectionBox( geometry.boundingBox ) === false )  {

				return;

			}

		}

		if ( geometry instanceof THREE.BufferGeometry ) {

			var material = this.material;

			if ( material === undefined ) return;

			var attributes = geometry.attributes;

			var a, b, c;
			var precision = raycaster.precision;

			if ( attributes.index !== undefined ) {

				var indices = attributes.index.array;
				var positions = attributes.position.array;
				var offsets = geometry.offsets;

				if ( offsets.length === 0 ) {

					offsets = [ { start: 0, count: indices.length, index: 0 } ];

				}

				for ( var oi = 0, ol = offsets.length; oi < ol; ++oi ) {

					var start = offsets[ oi ].start;
					var count = offsets[ oi ].count;
					var index = offsets[ oi ].index;

					for ( var i = start, il = start + count; i < il; i += 3 ) {

						a = index + indices[ i ];
						b = index + indices[ i + 1 ];
						c = index + indices[ i + 2 ];

						vA.fromArray( positions, a * 3 );
						vB.fromArray( positions, b * 3 );
						vC.fromArray( positions, c * 3 );

						if ( material.side === THREE.BackSide ) {

							var intersectionPoint = ray.intersectTriangle( vC, vB, vA, true );

						} else {

							var intersectionPoint = ray.intersectTriangle( vA, vB, vC, material.side !== THREE.DoubleSide );

						}

						if ( intersectionPoint === null ) continue;

						intersectionPoint.applyMatrix4( this.matrixWorld );

						var distance = raycaster.ray.origin.distanceTo( intersectionPoint );

						if ( distance < precision || distance < raycaster.near || distance > raycaster.far ) continue;

						intersects.push( {

							distance: distance,
							point: intersectionPoint,
							face: new THREE.Face3( a, b, c, THREE.Triangle.normal( vA, vB, vC ) ),
							faceIndex: null,
							object: this

						} );

					}

				}

			} else {

				var positions = attributes.position.array;

				for ( var i = 0, j = 0, il = positions.length; i < il; i += 3, j += 9 ) {

					a = i;
					b = i + 1;
					c = i + 2;

					vA.fromArray( positions, j );
					vB.fromArray( positions, j + 3 );
					vC.fromArray( positions, j + 6 );

					if ( material.side === THREE.BackSide ) {

						var intersectionPoint = ray.intersectTriangle( vC, vB, vA, true );

					} else {

						var intersectionPoint = ray.intersectTriangle( vA, vB, vC, material.side !== THREE.DoubleSide );

					}

					if ( intersectionPoint === null ) continue;

					intersectionPoint.applyMatrix4( this.matrixWorld );

					var distance = raycaster.ray.origin.distanceTo( intersectionPoint );

					if ( distance < precision || distance < raycaster.near || distance > raycaster.far ) continue;

					intersects.push( {

						distance: distance,
						point: intersectionPoint,
						face: new THREE.Face3( a, b, c, THREE.Triangle.normal( vA, vB, vC ) ),
						faceIndex: null,
						object: this

					} );

				}

			}

		} else if ( geometry instanceof THREE.Geometry ) {

			var isFaceMaterial = this.material instanceof THREE.MeshFaceMaterial;
			var objectMaterials = isFaceMaterial === true ? this.material.materials : null;

			var a, b, c, d;
			var precision = raycaster.precision;

			var vertices = geometry.vertices;

			for ( var f = 0, fl = geometry.faces.length; f < fl; f ++ ) {

				var face = geometry.faces[ f ];

				var material = isFaceMaterial === true ? objectMaterials[ face.materialIndex ] : this.material;

				if ( material === undefined ) continue;

				a = vertices[ face.a ];
				b = vertices[ face.b ];
				c = vertices[ face.c ];

				if ( material.morphTargets === true ) {

					var morphTargets = geometry.morphTargets;
					var morphInfluences = this.morphTargetInfluences;

					vA.set( 0, 0, 0 );
					vB.set( 0, 0, 0 );
					vC.set( 0, 0, 0 );

					for ( var t = 0, tl = morphTargets.length; t < tl; t ++ ) {

						var influence = morphInfluences[ t ];

						if ( influence === 0 ) continue;

						var targets = morphTargets[ t ].vertices;

						vA.x += ( targets[ face.a ].x - a.x ) * influence;
						vA.y += ( targets[ face.a ].y - a.y ) * influence;
						vA.z += ( targets[ face.a ].z - a.z ) * influence;

						vB.x += ( targets[ face.b ].x - b.x ) * influence;
						vB.y += ( targets[ face.b ].y - b.y ) * influence;
						vB.z += ( targets[ face.b ].z - b.z ) * influence;

						vC.x += ( targets[ face.c ].x - c.x ) * influence;
						vC.y += ( targets[ face.c ].y - c.y ) * influence;
						vC.z += ( targets[ face.c ].z - c.z ) * influence;

					}

					vA.add( a );
					vB.add( b );
					vC.add( c );

					a = vA;
					b = vB;
					c = vC;

				}

				if ( material.side === THREE.BackSide ) {

					var intersectionPoint = ray.intersectTriangle( c, b, a, true );

				} else {

					var intersectionPoint = ray.intersectTriangle( a, b, c, material.side !== THREE.DoubleSide );

				}

				if ( intersectionPoint === null ) continue;

				intersectionPoint.applyMatrix4( this.matrixWorld );

				var distance = raycaster.ray.origin.distanceTo( intersectionPoint );

				if ( distance < precision || distance < raycaster.near || distance > raycaster.far ) continue;

				intersects.push( {

					distance: distance,
					point: intersectionPoint,
					face: face,
					faceIndex: f,
					object: this

				} );

			}

		}

	};

}() );

THREE.Mesh.prototype.clone = function ( object, recursive ) {

	if ( object === undefined ) object = new THREE.Mesh( this.geometry, this.material );

	THREE.Object3D.prototype.clone.call( this, object, recursive );

	return object;

};

// File:src/objects/Bone.js

/**
 * @author mikael emtinger / http://gomo.se/
 * @author alteredq / http://alteredqualia.com/
 * @author ikerr / http://verold.com
 */

THREE.Bone = function ( belongsToSkin ) {

	THREE.Object3D.call( this );

	this.skin = belongsToSkin;

};

THREE.Bone.prototype = Object.create( THREE.Object3D.prototype );


// File:src/objects/Skeleton.js

/**
 * @author mikael emtinger / http://gomo.se/
 * @author alteredq / http://alteredqualia.com/
 * @author michael guerrero / http://realitymeltdown.com
 * @author ikerr / http://verold.com
 */

THREE.Skeleton = function ( bones, boneInverses, useVertexTexture ) {

	this.useVertexTexture = useVertexTexture !== undefined ? useVertexTexture : true;

	this.identityMatrix = new THREE.Matrix4();

	// copy the bone array

	bones = bones || [];

	this.bones = bones.slice( 0 );

	// create a bone texture or an array of floats

	if ( this.useVertexTexture ) {

		// layout (1 matrix = 4 pixels)
		//      RGBA RGBA RGBA RGBA (=> column1, column2, column3, column4)
		//  with  8x8  pixel texture max   16 bones  (8 * 8  / 4)
		//       16x16 pixel texture max   64 bones (16 * 16 / 4)
		//       32x32 pixel texture max  256 bones (32 * 32 / 4)
		//       64x64 pixel texture max 1024 bones (64 * 64 / 4)

		var size;

		if ( this.bones.length > 256 )
			size = 64;
		else if ( this.bones.length > 64 )
			size = 32;
		else if ( this.bones.length > 16 )
			size = 16;
		else
			size = 8;

		this.boneTextureWidth = size;
		this.boneTextureHeight = size;

		this.boneMatrices = new Float32Array( this.boneTextureWidth * this.boneTextureHeight * 4 ); // 4 floats per RGBA pixel
		this.boneTexture = new THREE.DataTexture( this.boneMatrices, this.boneTextureWidth, this.boneTextureHeight, THREE.RGBAFormat, THREE.FloatType );
		this.boneTexture.minFilter = THREE.NearestFilter;
		this.boneTexture.magFilter = THREE.NearestFilter;
		this.boneTexture.generateMipmaps = false;
		this.boneTexture.flipY = false;

	} else {

		this.boneMatrices = new Float32Array( 16 * this.bones.length );

	}

	// use the supplied bone inverses or calculate the inverses

	if ( boneInverses === undefined ) {

		this.calculateInverses();

	} else {

		if ( this.bones.length === boneInverses.length ) {

			this.boneInverses = boneInverses.slice( 0 );

		} else {

			console.warn( 'THREE.Skeleton bonInverses is the wrong length.' );

			this.boneInverses = [];

			for ( var b = 0, bl = this.bones.length; b < bl; b ++ ) {

				this.boneInverses.push( new THREE.Matrix4() );

			}

		}

	}

};

THREE.Skeleton.prototype.calculateInverses = function () {

	this.boneInverses = [];

	for ( var b = 0, bl = this.bones.length; b < bl; b ++ ) {

		var inverse = new THREE.Matrix4();

		if ( this.bones[ b ] ) {

			inverse.getInverse( this.bones[ b ].matrixWorld );

		}

		this.boneInverses.push( inverse );

	}

};

THREE.Skeleton.prototype.pose = function () {

	var bone;

	// recover the bind-time world matrices

	for ( var b = 0, bl = this.bones.length; b < bl; b ++ ) {

		bone = this.bones[ b ];

		if ( bone ) {

			bone.matrixWorld.getInverse( this.boneInverses[ b ] );

		}

	}

	// compute the local matrices, positions, rotations and scales

	for ( var b = 0, bl = this.bones.length; b < bl; b ++ ) {

		bone = this.bones[ b ];

		if ( bone ) {

			if ( bone.parent ) {

				bone.matrix.getInverse( bone.parent.matrixWorld );
				bone.matrix.multiply( bone.matrixWorld );

			} else {

				bone.matrix.copy( bone.matrixWorld );

			}

			bone.matrix.decompose( bone.position, bone.quaternion, bone.scale );

		}

	}

};

THREE.Skeleton.prototype.update = ( function () {

	var offsetMatrix = new THREE.Matrix4();
	
	return function () {

		// flatten bone matrices to array

		for ( var b = 0, bl = this.bones.length; b < bl; b ++ ) {

			// compute the offset between the current and the original transform

			var matrix = this.bones[ b ] ? this.bones[ b ].matrixWorld : this.identityMatrix;

			offsetMatrix.multiplyMatrices( matrix, this.boneInverses[ b ] );
			offsetMatrix.flattenToArrayOffset( this.boneMatrices, b * 16 );

		}

		if ( this.useVertexTexture ) {

			this.boneTexture.needsUpdate = true;

		}
		
	};

} )();


// File:src/objects/SkinnedMesh.js

/**
 * @author mikael emtinger / http://gomo.se/
 * @author alteredq / http://alteredqualia.com/
 * @author ikerr / http://verold.com
 */

THREE.SkinnedMesh = function ( geometry, material, useVertexTexture ) {

	THREE.Mesh.call( this, geometry, material );

	this.type = 'SkinnedMesh';

	this.bindMode = "attached";
	this.bindMatrix = new THREE.Matrix4();
	this.bindMatrixInverse = new THREE.Matrix4();

	// init bones

	// TODO: remove bone creation as there is no reason (other than
	// convenience) for THREE.SkinnedMesh to do this.

	var bones = [];

	if ( this.geometry && this.geometry.bones !== undefined ) {

		var bone, gbone, p, q, s;

		for ( var b = 0, bl = this.geometry.bones.length; b < bl; ++b ) {

			gbone = this.geometry.bones[ b ];

			p = gbone.pos;
			q = gbone.rotq;
			s = gbone.scl;

			bone = new THREE.Bone( this );
			bones.push( bone );

			bone.name = gbone.name;
			bone.position.set( p[ 0 ], p[ 1 ], p[ 2 ] );
			bone.quaternion.set( q[ 0 ], q[ 1 ], q[ 2 ], q[ 3 ] );

			if ( s !== undefined ) {

				bone.scale.set( s[ 0 ], s[ 1 ], s[ 2 ] );

			} else {

				bone.scale.set( 1, 1, 1 );

			}

		}

		for ( var b = 0, bl = this.geometry.bones.length; b < bl; ++b ) {

			gbone = this.geometry.bones[ b ];

			if ( gbone.parent !== - 1 ) {

				bones[ gbone.parent ].add( bones[ b ] );

			} else {

				this.add( bones[ b ] );

			}

		}

	}

	this.normalizeSkinWeights();

	this.updateMatrixWorld( true );
	this.bind( new THREE.Skeleton( bones, undefined, useVertexTexture ) );

};


THREE.SkinnedMesh.prototype = Object.create( THREE.Mesh.prototype );

THREE.SkinnedMesh.prototype.bind = function( skeleton, bindMatrix ) {

	this.skeleton = skeleton;

	if ( bindMatrix === undefined ) {

		this.updateMatrixWorld( true );

		bindMatrix = this.matrixWorld;

	}

	this.bindMatrix.copy( bindMatrix );
	this.bindMatrixInverse.getInverse( bindMatrix );

};

THREE.SkinnedMesh.prototype.pose = function () {

	this.skeleton.pose();

};

THREE.SkinnedMesh.prototype.normalizeSkinWeights = function () {

	if ( this.geometry instanceof THREE.Geometry ) {

		for ( var i = 0; i < this.geometry.skinIndices.length; i ++ ) {

			var sw = this.geometry.skinWeights[ i ];

			var scale = 1.0 / sw.lengthManhattan();

			if ( scale !== Infinity ) {

				sw.multiplyScalar( scale );

			} else {

				sw.set( 1 ); // this will be normalized by the shader anyway

			}

		}

	} else {

		// skinning weights assumed to be normalized for THREE.BufferGeometry

	}

};

THREE.SkinnedMesh.prototype.updateMatrixWorld = function( force ) {

	THREE.Mesh.prototype.updateMatrixWorld.call( this, true );

	if ( this.bindMode === "attached" ) {

		this.bindMatrixInverse.getInverse( this.matrixWorld );

	} else if ( this.bindMode === "detached" ) {

		this.bindMatrixInverse.getInverse( this.bindMatrix );

	} else {

		console.warn( 'THREE.SkinnedMesh unreckognized bindMode: ' + this.bindMode );

	}

};

THREE.SkinnedMesh.prototype.clone = function( object ) {

	if ( object === undefined ) {

		object = new THREE.SkinnedMesh( this.geometry, this.material, this.useVertexTexture );

	}

	THREE.Mesh.prototype.clone.call( this, object );

	return object;

};


// File:src/objects/MorphAnimMesh.js

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.MorphAnimMesh = function ( geometry, material ) {

	THREE.Mesh.call( this, geometry, material );

	this.type = 'MorphAnimMesh';

	// API

	this.duration = 1000; // milliseconds
	this.mirroredLoop = false;
	this.time = 0;

	// internals

	this.lastKeyframe = 0;
	this.currentKeyframe = 0;

	this.direction = 1;
	this.directionBackwards = false;

	this.setFrameRange( 0, this.geometry.morphTargets.length - 1 );

};

THREE.MorphAnimMesh.prototype = Object.create( THREE.Mesh.prototype );

THREE.MorphAnimMesh.prototype.setFrameRange = function ( start, end ) {

	this.startKeyframe = start;
	this.endKeyframe = end;

	this.length = this.endKeyframe - this.startKeyframe + 1;

};

THREE.MorphAnimMesh.prototype.setDirectionForward = function () {

	this.direction = 1;
	this.directionBackwards = false;

};

THREE.MorphAnimMesh.prototype.setDirectionBackward = function () {

	this.direction = - 1;
	this.directionBackwards = true;

};

THREE.MorphAnimMesh.prototype.parseAnimations = function () {

	var geometry = this.geometry;

	if ( ! geometry.animations ) geometry.animations = {};

	var firstAnimation, animations = geometry.animations;

	var pattern = /([a-z]+)_?(\d+)/;

	for ( var i = 0, il = geometry.morphTargets.length; i < il; i ++ ) {

		var morph = geometry.morphTargets[ i ];
		var parts = morph.name.match( pattern );

		if ( parts && parts.length > 1 ) {

			var label = parts[ 1 ];
			var num = parts[ 2 ];

			if ( ! animations[ label ] ) animations[ label ] = { start: Infinity, end: - Infinity };

			var animation = animations[ label ];

			if ( i < animation.start ) animation.start = i;
			if ( i > animation.end ) animation.end = i;

			if ( ! firstAnimation ) firstAnimation = label;

		}

	}

	geometry.firstAnimation = firstAnimation;

};

THREE.MorphAnimMesh.prototype.setAnimationLabel = function ( label, start, end ) {

	if ( ! this.geometry.animations ) this.geometry.animations = {};

	this.geometry.animations[ label ] = { start: start, end: end };

};

THREE.MorphAnimMesh.prototype.playAnimation = function ( label, fps ) {

	var animation = this.geometry.animations[ label ];

	if ( animation ) {

		this.setFrameRange( animation.start, animation.end );
		this.duration = 1000 * ( ( animation.end - animation.start ) / fps );
		this.time = 0;

	} else {

		console.warn( 'animation[' + label + '] undefined' );

	}

};

THREE.MorphAnimMesh.prototype.updateAnimation = function ( delta ) {

	var frameTime = this.duration / this.length;

	this.time += this.direction * delta;

	if ( this.mirroredLoop ) {

		if ( this.time > this.duration || this.time < 0 ) {

			this.direction *= - 1;

			if ( this.time > this.duration ) {

				this.time = this.duration;
				this.directionBackwards = true;

			}

			if ( this.time < 0 ) {

				this.time = 0;
				this.directionBackwards = false;

			}

		}

	} else {

		this.time = this.time % this.duration;

		if ( this.time < 0 ) this.time += this.duration;

	}

	var keyframe = this.startKeyframe + THREE.Math.clamp( Math.floor( this.time / frameTime ), 0, this.length - 1 );

	if ( keyframe !== this.currentKeyframe ) {

		this.morphTargetInfluences[ this.lastKeyframe ] = 0;
		this.morphTargetInfluences[ this.currentKeyframe ] = 1;

		this.morphTargetInfluences[ keyframe ] = 0;

		this.lastKeyframe = this.currentKeyframe;
		this.currentKeyframe = keyframe;

	}

	var mix = ( this.time % frameTime ) / frameTime;

	if ( this.directionBackwards ) {

		mix = 1 - mix;

	}

	this.morphTargetInfluences[ this.currentKeyframe ] = mix;
	this.morphTargetInfluences[ this.lastKeyframe ] = 1 - mix;

};

THREE.MorphAnimMesh.prototype.interpolateTargets = function ( a, b, t ) {

	var influences = this.morphTargetInfluences;

	for ( var i = 0, l = influences.length; i < l; i ++ ) {

		influences[ i ] = 0;

	}

	if ( a > -1 ) influences[ a ] = 1 - t;
	if ( b > -1 ) influences[ b ] = t;

};

THREE.MorphAnimMesh.prototype.clone = function ( object ) {

	if ( object === undefined ) object = new THREE.MorphAnimMesh( this.geometry, this.material );

	object.duration = this.duration;
	object.mirroredLoop = this.mirroredLoop;
	object.time = this.time;

	object.lastKeyframe = this.lastKeyframe;
	object.currentKeyframe = this.currentKeyframe;

	object.direction = this.direction;
	object.directionBackwards = this.directionBackwards;

	THREE.Mesh.prototype.clone.call( this, object );

	return object;

};

// File:src/objects/LOD.js

/**
 * @author mikael emtinger / http://gomo.se/
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 */

THREE.LOD = function () {

	THREE.Object3D.call( this );

	this.objects = [];

};


THREE.LOD.prototype = Object.create( THREE.Object3D.prototype );

THREE.LOD.prototype.addLevel = function ( object, distance ) {

	if ( distance === undefined ) distance = 0;

	distance = Math.abs( distance );

	for ( var l = 0; l < this.objects.length; l ++ ) {

		if ( distance < this.objects[ l ].distance ) {

			break;

		}

	}

	this.objects.splice( l, 0, { distance: distance, object: object } );
	this.add( object );

};

THREE.LOD.prototype.getObjectForDistance = function ( distance ) {

	for ( var i = 1, l = this.objects.length; i < l; i ++ ) {

		if ( distance < this.objects[ i ].distance ) {

			break;

		}

	}

	return this.objects[ i - 1 ].object;

};

THREE.LOD.prototype.raycast = ( function () {

	var matrixPosition = new THREE.Vector3();

	return function ( raycaster, intersects ) {

		matrixPosition.setFromMatrixPosition( this.matrixWorld );

		var distance = raycaster.ray.origin.distanceTo( matrixPosition );

		this.getObjectForDistance( distance ).raycast( raycaster, intersects );

	};

}() );

THREE.LOD.prototype.update = function () {

	var v1 = new THREE.Vector3();
	var v2 = new THREE.Vector3();

	return function ( camera ) {

		if ( this.objects.length > 1 ) {

			v1.setFromMatrixPosition( camera.matrixWorld );
			v2.setFromMatrixPosition( this.matrixWorld );

			var distance = v1.distanceTo( v2 );

			this.objects[ 0 ].object.visible = true;

			for ( var i = 1, l = this.objects.length; i < l; i ++ ) {

				if ( distance >= this.objects[ i ].distance ) {

					this.objects[ i - 1 ].object.visible = false;
					this.objects[ i     ].object.visible = true;

				} else {

					break;

				}

			}

			for ( ; i < l; i ++ ) {

				this.objects[ i ].object.visible = false;

			}

		}

	};

}();

THREE.LOD.prototype.clone = function ( object ) {

	if ( object === undefined ) object = new THREE.LOD();

	THREE.Object3D.prototype.clone.call( this, object );

	for ( var i = 0, l = this.objects.length; i < l; i ++ ) {
		var x = this.objects[ i ].object.clone();
		x.visible = i === 0;
		object.addLevel( x, this.objects[ i ].distance );
	}

	return object;

};

// File:src/objects/Sprite.js

/**
 * @author mikael emtinger / http://gomo.se/
 * @author alteredq / http://alteredqualia.com/
 */

THREE.Sprite = ( function () {

	var indices = new Uint16Array( [ 0, 1, 2,  0, 2, 3 ] );
	var vertices = new Float32Array( [ - 0.5, - 0.5, 0,   0.5, - 0.5, 0,   0.5, 0.5, 0,   - 0.5, 0.5, 0 ] );
	var uvs = new Float32Array( [ 0, 0,   1, 0,   1, 1,   0, 1 ] );

	var geometry = new THREE.BufferGeometry();
	geometry.addAttribute( 'index', new THREE.BufferAttribute( indices, 1 ) );
	geometry.addAttribute( 'position', new THREE.BufferAttribute( vertices, 3 ) );
	geometry.addAttribute( 'uv', new THREE.BufferAttribute( uvs, 2 ) );

	return function ( material ) {

		THREE.Object3D.call( this );

		this.type = 'Sprite';

		this.geometry = geometry;
		this.material = ( material !== undefined ) ? material : new THREE.SpriteMaterial();

	};

} )();

THREE.Sprite.prototype = Object.create( THREE.Object3D.prototype );

THREE.Sprite.prototype.raycast = ( function () {

	var matrixPosition = new THREE.Vector3();

	return function ( raycaster, intersects ) {

		matrixPosition.setFromMatrixPosition( this.matrixWorld );

		var distance = raycaster.ray.distanceToPoint( matrixPosition );

		if ( distance > this.scale.x ) {

			return;

		}

		intersects.push( {

			distance: distance,
			point: this.position,
			face: null,
			object: this

		} );

	};

}() );

THREE.Sprite.prototype.clone = function ( object ) {

	if ( object === undefined ) object = new THREE.Sprite( this.material );

	THREE.Object3D.prototype.clone.call( this, object );

	return object;

};

// Backwards compatibility

THREE.Particle = THREE.Sprite;

// File:src/objects/LensFlare.js

/**
 * @author mikael emtinger / http://gomo.se/
 * @author alteredq / http://alteredqualia.com/
 */

THREE.LensFlare = function ( texture, size, distance, blending, color ) {

	THREE.Object3D.call( this );

	this.lensFlares = [];

	this.positionScreen = new THREE.Vector3();
	this.customUpdateCallback = undefined;

	if( texture !== undefined ) {

		this.add( texture, size, distance, blending, color );

	}

};

THREE.LensFlare.prototype = Object.create( THREE.Object3D.prototype );


/*
 * Add: adds another flare
 */

THREE.LensFlare.prototype.add = function ( texture, size, distance, blending, color, opacity ) {

	if ( size === undefined ) size = - 1;
	if ( distance === undefined ) distance = 0;
	if ( opacity === undefined ) opacity = 1;
	if ( color === undefined ) color = new THREE.Color( 0xffffff );
	if ( blending === undefined ) blending = THREE.NormalBlending;

	distance = Math.min( distance, Math.max( 0, distance ) );

	this.lensFlares.push( {
		texture: texture, 			// THREE.Texture
		size: size, 				// size in pixels (-1 = use texture.width)
		distance: distance, 		// distance (0-1) from light source (0=at light source)
		x: 0, y: 0, z: 0,			// screen position (-1 => 1) z = 0 is ontop z = 1 is back
		scale: 1, 					// scale
		rotation: 1, 				// rotation
		opacity: opacity,			// opacity
		color: color,				// color
		blending: blending			// blending
	} );

};

/*
 * Update lens flares update positions on all flares based on the screen position
 * Set myLensFlare.customUpdateCallback to alter the flares in your project specific way.
 */

THREE.LensFlare.prototype.updateLensFlares = function () {

	var f, fl = this.lensFlares.length;
	var flare;
	var vecX = - this.positionScreen.x * 2;
	var vecY = - this.positionScreen.y * 2;

	for( f = 0; f < fl; f ++ ) {

		flare = this.lensFlares[ f ];

		flare.x = this.positionScreen.x + vecX * flare.distance;
		flare.y = this.positionScreen.y + vecY * flare.distance;

		flare.wantedRotation = flare.x * Math.PI * 0.25;
		flare.rotation += ( flare.wantedRotation - flare.rotation ) * 0.25;

	}

};


// File:src/scenes/Scene.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.Scene = function () {

	THREE.Object3D.call( this );

	this.type = 'Scene';

	this.fog = null;
	this.overrideMaterial = null;

	this.autoUpdate = true; // checked by the renderer

};

THREE.Scene.prototype = Object.create( THREE.Object3D.prototype );

THREE.Scene.prototype.clone = function ( object ) {

	if ( object === undefined ) object = new THREE.Scene();

	THREE.Object3D.prototype.clone.call( this, object );

	if ( this.fog !== null ) object.fog = this.fog.clone();
	if ( this.overrideMaterial !== null ) object.overrideMaterial = this.overrideMaterial.clone();

	object.autoUpdate = this.autoUpdate;
	object.matrixAutoUpdate = this.matrixAutoUpdate;

	return object;

};

// File:src/scenes/Fog.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 */

THREE.Fog = function ( color, near, far ) {

	this.name = '';

	this.color = new THREE.Color( color );

	this.near = ( near !== undefined ) ? near : 1;
	this.far = ( far !== undefined ) ? far : 1000;

};

THREE.Fog.prototype.clone = function () {

	return new THREE.Fog( this.color.getHex(), this.near, this.far );

};

// File:src/scenes/FogExp2.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 */

THREE.FogExp2 = function ( color, density ) {

	this.name = '';

	this.color = new THREE.Color( color );
	this.density = ( density !== undefined ) ? density : 0.00025;

};

THREE.FogExp2.prototype.clone = function () {

	return new THREE.FogExp2( this.color.getHex(), this.density );

};

// File:src/renderers/shaders/ShaderChunk.js

THREE.ShaderChunk = {};

// File:src/renderers/shaders/ShaderChunk/alphatest_fragment.glsl

THREE.ShaderChunk[ 'alphatest_fragment'] = "#ifdef ALPHATEST\n\n	if ( gl_FragColor.a < ALPHATEST ) discard;\n\n#endif\n";

// File:src/renderers/shaders/ShaderChunk/lights_lambert_vertex.glsl

THREE.ShaderChunk[ 'lights_lambert_vertex'] = "vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n	vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n	vec3 dirVector = normalize( lDirection.xyz );\n\n	float dotProduct = dot( transformedNormal, dirVector );\n	vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n	#ifdef DOUBLE_SIDED\n\n		vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n		#ifdef WRAP_AROUND\n\n			vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n		#endif\n\n	#endif\n\n	#ifdef WRAP_AROUND\n\n		vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n		directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n		#ifdef DOUBLE_SIDED\n\n			directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n		#endif\n\n	#endif\n\n	vLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n	#ifdef DOUBLE_SIDED\n\n		vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n	#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n		float dotProduct = dot( transformedNormal, lVector );\n\n		vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n		#ifdef DOUBLE_SIDED\n\n			vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n			#ifdef WRAP_AROUND\n\n				vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n			#endif\n\n		#endif\n\n		#ifdef WRAP_AROUND\n\n			vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n			pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n			#ifdef DOUBLE_SIDED\n\n				pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n			#endif\n\n		#endif\n\n		vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n			float lDistance = 1.0;\n			if ( spotLightDistance[ i ] > 0.0 )\n				lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n			lVector = normalize( lVector );\n\n			float dotProduct = dot( transformedNormal, lVector );\n			vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n			#ifdef DOUBLE_SIDED\n\n				vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n				#ifdef WRAP_AROUND\n\n					vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n				#endif\n\n			#endif\n\n			#ifdef WRAP_AROUND\n\n				vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n				spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n				#ifdef DOUBLE_SIDED\n\n					spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n				#endif\n\n			#endif\n\n			vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n\n			#ifdef DOUBLE_SIDED\n\n				vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n\n			#endif\n\n		}\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n\n		float dotProduct = dot( transformedNormal, lVector );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n		float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n		#endif\n\n	}\n\n#endif\n\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/map_particle_pars_fragment.glsl

THREE.ShaderChunk[ 'map_particle_pars_fragment'] = "#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/default_vertex.glsl

THREE.ShaderChunk[ 'default_vertex'] = "vec4 mvPosition;\n\n#ifdef USE_SKINNING\n\n	mvPosition = modelViewMatrix * skinned;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\n\n	mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\n\n	mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;";

// File:src/renderers/shaders/ShaderChunk/map_pars_fragment.glsl

THREE.ShaderChunk[ 'map_pars_fragment'] = "#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/skinnormal_vertex.glsl

THREE.ShaderChunk[ 'skinnormal_vertex'] = "#ifdef USE_SKINNING\n\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n	#ifdef USE_MORPHNORMALS\n\n	vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n	#else\n\n	vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n	#endif\n\n#endif\n";

// File:src/renderers/shaders/ShaderChunk/logdepthbuf_pars_vertex.glsl

THREE.ShaderChunk[ 'logdepthbuf_pars_vertex'] = "#ifdef USE_LOGDEPTHBUF\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n	uniform float logDepthBufFC;\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/lightmap_pars_vertex.glsl

THREE.ShaderChunk[ 'lightmap_pars_vertex'] = "#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/lights_phong_fragment.glsl

THREE.ShaderChunk[ 'lights_phong_fragment'] = "vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef DOUBLE_SIDED\n\n	normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	vec3 pointDiffuse = vec3( 0.0 );\n	vec3 pointSpecular = vec3( 0.0 );\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n\n				// diffuse\n\n		float dotProduct = dot( normal, lVector );\n\n		#ifdef WRAP_AROUND\n\n			float pointDiffuseWeightFull = max( dotProduct, 0.0 );\n			float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float pointDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		pointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n\n				// specular\n\n		vec3 pointHalfVector = normalize( lVector + viewPosition );\n		float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n		float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n		pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	vec3 spotDiffuse = vec3( 0.0 );\n	vec3 spotSpecular = vec3( 0.0 );\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( spotLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n					// diffuse\n\n			float dotProduct = dot( normal, lVector );\n\n			#ifdef WRAP_AROUND\n\n				float spotDiffuseWeightFull = max( dotProduct, 0.0 );\n				float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n				vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n			#else\n\n				float spotDiffuseWeight = max( dotProduct, 0.0 );\n\n			#endif\n\n			spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\n\n					// specular\n\n			vec3 spotHalfVector = normalize( lVector + viewPosition );\n			float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n			float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n			float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n			spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	vec3 dirDiffuse = vec3( 0.0 );\n	vec3 dirSpecular = vec3( 0.0 );\n\n	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n		vec3 dirVector = normalize( lDirection.xyz );\n\n				// diffuse\n\n		float dotProduct = dot( normal, dirVector );\n\n		#ifdef WRAP_AROUND\n\n			float dirDiffuseWeightFull = max( dotProduct, 0.0 );\n			float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float dirDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		dirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n\n		// specular\n\n		vec3 dirHalfVector = normalize( dirVector + viewPosition );\n		float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n		float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n		/*\n		// fresnel term from skin shader\n		const float F0 = 0.128;\n\n		float base = 1.0 - dot( viewPosition, dirHalfVector );\n		float exponential = pow( base, 5.0 );\n\n		float fresnel = exponential + F0 * ( 1.0 - exponential );\n		*/\n\n		/*\n		// fresnel term from fresnel shader\n		const float mFresnelBias = 0.08;\n		const float mFresnelScale = 0.3;\n		const float mFresnelPower = 5.0;\n\n		float fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n		*/\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		// 		dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n		dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	vec3 hemiDiffuse = vec3( 0.0 );\n	vec3 hemiSpecular = vec3( 0.0 );\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n\n		// diffuse\n\n		float dotProduct = dot( normal, lVector );\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		hemiDiffuse += diffuse * hemiColor;\n\n		// specular (sky light)\n\n		vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n		float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n		float hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n		// specular (ground light)\n\n		vec3 lVectorGround = -lVector;\n\n		vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n		float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n		float hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n		float dotProductGround = dot( normal, lVectorGround );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n		vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n		hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n	}\n\n#endif\n\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n\n#if MAX_DIR_LIGHTS > 0\n\n	totalDiffuse += dirDiffuse;\n	totalSpecular += dirSpecular;\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	totalDiffuse += hemiDiffuse;\n	totalSpecular += hemiSpecular;\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	totalDiffuse += pointDiffuse;\n	totalSpecular += pointSpecular;\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	totalDiffuse += spotDiffuse;\n	totalSpecular += spotSpecular;\n\n#endif\n\n#ifdef METAL\n\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n\n#else\n\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/fog_pars_fragment.glsl

THREE.ShaderChunk[ 'fog_pars_fragment'] = "#ifdef USE_FOG\n\n	uniform vec3 fogColor;\n\n	#ifdef FOG_EXP2\n\n		uniform float fogDensity;\n\n	#else\n\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/morphnormal_vertex.glsl

THREE.ShaderChunk[ 'morphnormal_vertex'] = "#ifdef USE_MORPHNORMALS\n\n	vec3 morphedNormal = vec3( 0.0 );\n\n	morphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	morphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	morphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	morphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n	morphedNormal += normal;\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/envmap_pars_fragment.glsl

THREE.ShaderChunk[ 'envmap_pars_fragment'] = "#ifdef USE_ENVMAP\n\n	uniform float reflectivity;\n	uniform samplerCube envMap;\n	uniform float flipEnvMap;\n	uniform int combine;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		uniform bool useRefract;\n		uniform float refractionRatio;\n\n	#else\n\n		varying vec3 vReflect;\n\n	#endif\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/logdepthbuf_fragment.glsl

THREE.ShaderChunk[ 'logdepthbuf_fragment'] = "#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/normalmap_pars_fragment.glsl

THREE.ShaderChunk[ 'normalmap_pars_fragment'] = "#ifdef USE_NORMALMAP\n\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n\n			// Per-Pixel Tangent Space Normal Mapping\n			// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n\n		vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n\n	}\n\n#endif\n";

// File:src/renderers/shaders/ShaderChunk/lights_phong_pars_vertex.glsl

THREE.ShaderChunk[ 'lights_phong_pars_vertex'] = "#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n";

// File:src/renderers/shaders/ShaderChunk/lightmap_pars_fragment.glsl

THREE.ShaderChunk[ 'lightmap_pars_fragment'] = "#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n	uniform sampler2D lightMap;\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/shadowmap_vertex.glsl

THREE.ShaderChunk[ 'shadowmap_vertex'] = "#ifdef USE_SHADOWMAP\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n	}\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/lights_phong_vertex.glsl

THREE.ShaderChunk[ 'lights_phong_vertex'] = "#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	vWorldPosition = worldPosition.xyz;\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/map_fragment.glsl

THREE.ShaderChunk[ 'map_fragment'] = "#ifdef USE_MAP\n\n	vec4 texelColor = texture2D( map, vUv );\n\n	#ifdef GAMMA_INPUT\n\n		texelColor.xyz *= texelColor.xyz;\n\n	#endif\n\n	gl_FragColor = gl_FragColor * texelColor;\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/lightmap_vertex.glsl

THREE.ShaderChunk[ 'lightmap_vertex'] = "#ifdef USE_LIGHTMAP\n\n	vUv2 = uv2;\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/map_particle_fragment.glsl

THREE.ShaderChunk[ 'map_particle_fragment'] = "#ifdef USE_MAP\n\n	gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/color_pars_fragment.glsl

THREE.ShaderChunk[ 'color_pars_fragment'] = "#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif\n";

// File:src/renderers/shaders/ShaderChunk/color_vertex.glsl

THREE.ShaderChunk[ 'color_vertex'] = "#ifdef USE_COLOR\n\n	#ifdef GAMMA_INPUT\n\n		vColor = color * color;\n\n	#else\n\n		vColor = color;\n\n	#endif\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/skinning_vertex.glsl

THREE.ShaderChunk[ 'skinning_vertex'] = "#ifdef USE_SKINNING\n\n	#ifdef USE_MORPHTARGETS\n\n	vec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n	#else\n\n	vec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n	#endif\n\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	skinned  = bindMatrixInverse * skinned;\n\n#endif\n";

// File:src/renderers/shaders/ShaderChunk/envmap_pars_vertex.glsl

THREE.ShaderChunk[ 'envmap_pars_vertex'] = "#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	varying vec3 vReflect;\n\n	uniform float refractionRatio;\n	uniform bool useRefract;\n\n#endif\n";

// File:src/renderers/shaders/ShaderChunk/linear_to_gamma_fragment.glsl

THREE.ShaderChunk[ 'linear_to_gamma_fragment'] = "#ifdef GAMMA_OUTPUT\n\n	gl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/color_pars_vertex.glsl

THREE.ShaderChunk[ 'color_pars_vertex'] = "#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/lights_lambert_pars_vertex.glsl

THREE.ShaderChunk[ 'lights_lambert_pars_vertex'] = "uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\n\nuniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n";

// File:src/renderers/shaders/ShaderChunk/map_pars_vertex.glsl

THREE.ShaderChunk[ 'map_pars_vertex'] = "#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n\n#endif\n";

// File:src/renderers/shaders/ShaderChunk/envmap_fragment.glsl

THREE.ShaderChunk[ 'envmap_fragment'] = "#ifdef USE_ENVMAP\n\n	vec3 reflectVec;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n		// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\n		// Transforming Normal Vectors with the Inverse Transformation\n\n		vec3 worldNormal = normalize( vec3( vec4( normal, 0.0 ) * viewMatrix ) );\n\n		if ( useRefract ) {\n\n			reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n		} else { \n\n			reflectVec = reflect( cameraToVertex, worldNormal );\n\n		}\n\n	#else\n\n		reflectVec = vReflect;\n\n	#endif\n\n	#ifdef DOUBLE_SIDED\n\n		float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n		vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#else\n\n		vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#endif\n\n	#ifdef GAMMA_INPUT\n\n		cubeColor.xyz *= cubeColor.xyz;\n\n	#endif\n\n	if ( combine == 1 ) {\n\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n\n	} else if ( combine == 2 ) {\n\n		gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n\n	} else {\n\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n\n	}\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/specularmap_pars_fragment.glsl

THREE.ShaderChunk[ 'specularmap_pars_fragment'] = "#ifdef USE_SPECULARMAP\n\n	uniform sampler2D specularMap;\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/logdepthbuf_vertex.glsl

THREE.ShaderChunk[ 'logdepthbuf_vertex'] = "#ifdef USE_LOGDEPTHBUF\n\n	gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		vFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n	#endif\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/morphtarget_pars_vertex.glsl

THREE.ShaderChunk[ 'morphtarget_pars_vertex'] = "#ifdef USE_MORPHTARGETS\n\n	#ifndef USE_MORPHNORMALS\n\n	uniform float morphTargetInfluences[ 8 ];\n\n	#else\n\n	uniform float morphTargetInfluences[ 4 ];\n\n	#endif\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/specularmap_fragment.glsl

THREE.ShaderChunk[ 'specularmap_fragment'] = "float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n\n#else\n\n	specularStrength = 1.0;\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/fog_fragment.glsl

THREE.ShaderChunk[ 'fog_fragment'] = "#ifdef USE_FOG\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n	#else\n\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n	#endif\n\n	#ifdef FOG_EXP2\n\n		const float LOG2 = 1.442695;\n		float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n		fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n\n	#else\n\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n	#endif\n	\n	gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/bumpmap_pars_fragment.glsl

THREE.ShaderChunk[ 'bumpmap_pars_fragment'] = "#ifdef USE_BUMPMAP\n\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n\n			// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n			//	http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n			// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n	vec2 dHdxy_fwd() {\n\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n		return vec2( dBx, dBy );\n\n	}\n\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;		// normalized\n\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n\n		float fDet = dot( vSigmaX, R1 );\n\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n\n	}\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/defaultnormal_vertex.glsl

THREE.ShaderChunk[ 'defaultnormal_vertex'] = "vec3 objectNormal;\n\n#ifdef USE_SKINNING\n\n	objectNormal = skinnedNormal.xyz;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\n\n	objectNormal = morphedNormal;\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\n\n	objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n	objectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;";

// File:src/renderers/shaders/ShaderChunk/lights_phong_pars_fragment.glsl

THREE.ShaderChunk[ 'lights_phong_pars_fragment'] = "uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;";

// File:src/renderers/shaders/ShaderChunk/skinbase_vertex.glsl

THREE.ShaderChunk[ 'skinbase_vertex'] = "#ifdef USE_SKINNING\n\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/map_vertex.glsl

THREE.ShaderChunk[ 'map_vertex'] = "#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/lightmap_fragment.glsl

THREE.ShaderChunk[ 'lightmap_fragment'] = "#ifdef USE_LIGHTMAP\n\n	gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/shadowmap_pars_vertex.glsl

THREE.ShaderChunk[ 'shadowmap_pars_vertex'] = "#ifdef USE_SHADOWMAP\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/color_fragment.glsl

THREE.ShaderChunk[ 'color_fragment'] = "#ifdef USE_COLOR\n\n	gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/morphtarget_vertex.glsl

THREE.ShaderChunk[ 'morphtarget_vertex'] = "#ifdef USE_MORPHTARGETS\n\n	vec3 morphed = vec3( 0.0 );\n	morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n	#ifndef USE_MORPHNORMALS\n\n	morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n	#endif\n\n	morphed += position;\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/envmap_vertex.glsl

THREE.ShaderChunk[ 'envmap_vertex'] = "#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\n	worldNormal = normalize( worldNormal );\n\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n	if ( useRefract ) {\n\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n	} else {\n\n		vReflect = reflect( cameraToVertex, worldNormal );\n\n	}\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/shadowmap_fragment.glsl

THREE.ShaderChunk[ 'shadowmap_fragment'] = "#ifdef USE_SHADOWMAP\n\n	#ifdef SHADOWMAP_DEBUG\n\n		vec3 frustumColors[3];\n		frustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n		frustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n		frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n	#endif\n\n	#ifdef SHADOWMAP_CASCADE\n\n		int inFrustumCount = 0;\n\n	#endif\n\n	float fDepth;\n	vec3 shadowColor = vec3( 1.0 );\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n				// if ( something && something ) breaks ATI OpenGL shader compiler\n				// if ( all( something, something ) ) using this instead\n\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n\n				// don't shadow pixels outside of light frustum\n				// use just first frustum (for cascades)\n				// don't shadow pixels behind far plane of light frustum\n\n		#ifdef SHADOWMAP_CASCADE\n\n			inFrustumCount += int( inFrustum );\n			bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n		#else\n\n			bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n		#endif\n\n		bool frustumTest = all( frustumTestVec );\n\n		if ( frustumTest ) {\n\n			shadowCoord.z += shadowBias[ i ];\n\n			#if defined( SHADOWMAP_TYPE_PCF )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n		/*\n						// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n						// must enroll loop manually\n\n				for ( float y = -1.25; y <= 1.25; y += 1.25 )\n					for ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n						vec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n								// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n								//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n						float fDepth = unpackDepth( rgbaDepth );\n\n						if ( fDepth < shadowCoord.z )\n							shadow += 1.0;\n\n				}\n\n				shadow /= 9.0;\n\n		*/\n\n				const float shadowDelta = 1.0 / 9.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.25 * xPixelOffset;\n				float dy0 = -1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.0 * xPixelOffset;\n				float dy0 = -1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n\n				mat3 shadowKernel;\n				mat3 depthKernel;\n\n				depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n				shadowKernel[0] *= vec3(0.25);\n\n				shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n				shadowKernel[1] *= vec3(0.25);\n\n				shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n				shadowKernel[2] *= vec3(0.25);\n\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n				shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n				shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n				shadow = dot( shadowValues, vec4( 1.0 ) );\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#else\n\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n\n				if ( fDepth < shadowCoord.z )\n\n		// spot with multiple shadows is darker\n\n					shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n		// spot with multiple shadows has the same color as single shadow spot\n\n		// 					shadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n			#endif\n\n		}\n\n\n		#ifdef SHADOWMAP_DEBUG\n\n			#ifdef SHADOWMAP_CASCADE\n\n				if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n\n			#else\n\n				if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n\n			#endif\n\n		#endif\n\n	}\n\n	#ifdef GAMMA_OUTPUT\n\n		shadowColor *= shadowColor;\n\n	#endif\n\n	gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n\n#endif\n";

// File:src/renderers/shaders/ShaderChunk/worldpos_vertex.glsl

THREE.ShaderChunk[ 'worldpos_vertex'] = "#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n	#ifdef USE_SKINNING\n\n		vec4 worldPosition = modelMatrix * skinned;\n\n	#endif\n\n	#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n		vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n	#endif\n\n	#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n		vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n	#endif\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/shadowmap_pars_fragment.glsl

THREE.ShaderChunk[ 'shadowmap_pars_fragment'] = "#ifdef USE_SHADOWMAP\n\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n	float unpackDepth( const in vec4 rgba_depth ) {\n\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n\n	}\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/skinning_pars_vertex.glsl

THREE.ShaderChunk[ 'skinning_pars_vertex'] = "#ifdef USE_SKINNING\n\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n\n	#ifdef BONE_TEXTURE\n\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n\n			y = dy * ( y + 0.5 );\n\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n			mat4 bone = mat4( v1, v2, v3, v4 );\n\n			return bone;\n\n		}\n\n	#else\n\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n\n		}\n\n	#endif\n\n#endif\n";

// File:src/renderers/shaders/ShaderChunk/logdepthbuf_pars_fragment.glsl

THREE.ShaderChunk[ 'logdepthbuf_pars_fragment'] = "#ifdef USE_LOGDEPTHBUF\n\n	uniform float logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		#extension GL_EXT_frag_depth : enable\n		varying float vFragDepth;\n\n	#endif\n\n#endif";

// File:src/renderers/shaders/ShaderChunk/alphamap_fragment.glsl

THREE.ShaderChunk[ 'alphamap_fragment'] = "#ifdef USE_ALPHAMAP\n\n	gl_FragColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n";

// File:src/renderers/shaders/ShaderChunk/alphamap_pars_fragment.glsl

THREE.ShaderChunk[ 'alphamap_pars_fragment'] = "#ifdef USE_ALPHAMAP\n\n	uniform sampler2D alphaMap;\n\n#endif\n";

// File:src/renderers/shaders/UniformsUtils.js

/**
 * Uniform Utilities
 */

THREE.UniformsUtils = {

	merge: function ( uniforms ) {

		var merged = {};

		for ( var u = 0; u < uniforms.length; u ++ ) {

			var tmp = this.clone( uniforms[ u ] );

			for ( var p in tmp ) {

				merged[ p ] = tmp[ p ];

			}

		}

		return merged;

	},

	clone: function ( uniforms_src ) {

		var uniforms_dst = {};

		for ( var u in uniforms_src ) {

			uniforms_dst[ u ] = {};

			for ( var p in uniforms_src[ u ] ) {

				var parameter_src = uniforms_src[ u ][ p ];

				if ( parameter_src instanceof THREE.Color ||
					 parameter_src instanceof THREE.Vector2 ||
					 parameter_src instanceof THREE.Vector3 ||
					 parameter_src instanceof THREE.Vector4 ||
					 parameter_src instanceof THREE.Matrix4 ||
					 parameter_src instanceof THREE.Texture ) {

					uniforms_dst[ u ][ p ] = parameter_src.clone();

				} else if ( parameter_src instanceof Array ) {

					uniforms_dst[ u ][ p ] = parameter_src.slice();

				} else {

					uniforms_dst[ u ][ p ] = parameter_src;

				}

			}

		}

		return uniforms_dst;

	}

};

// File:src/renderers/shaders/UniformsLib.js

/**
 * Uniforms library for shared webgl shaders
 */

THREE.UniformsLib = {

	common: {

		"diffuse" : { type: "c", value: new THREE.Color( 0xeeeeee ) },
		"opacity" : { type: "f", value: 1.0 },

		"map" : { type: "t", value: null },
		"offsetRepeat" : { type: "v4", value: new THREE.Vector4( 0, 0, 1, 1 ) },

		"lightMap" : { type: "t", value: null },
		"specularMap" : { type: "t", value: null },
		"alphaMap" : { type: "t", value: null },

		"envMap" : { type: "t", value: null },
		"flipEnvMap" : { type: "f", value: - 1 },
		"useRefract" : { type: "i", value: 0 },
		"reflectivity" : { type: "f", value: 1.0 },
		"refractionRatio" : { type: "f", value: 0.98 },
		"combine" : { type: "i", value: 0 },

		"morphTargetInfluences" : { type: "f", value: 0 }

	},

	bump: {

		"bumpMap" : { type: "t", value: null },
		"bumpScale" : { type: "f", value: 1 }

	},

	normalmap: {

		"normalMap" : { type: "t", value: null },
		"normalScale" : { type: "v2", value: new THREE.Vector2( 1, 1 ) }
	},

	fog : {

		"fogDensity" : { type: "f", value: 0.00025 },
		"fogNear" : { type: "f", value: 1 },
		"fogFar" : { type: "f", value: 2000 },
		"fogColor" : { type: "c", value: new THREE.Color( 0xffffff ) }

	},

	lights: {

		"ambientLightColor" : { type: "fv", value: [] },

		"directionalLightDirection" : { type: "fv", value: [] },
		"directionalLightColor" : { type: "fv", value: [] },

		"hemisphereLightDirection" : { type: "fv", value: [] },
		"hemisphereLightSkyColor" : { type: "fv", value: [] },
		"hemisphereLightGroundColor" : { type: "fv", value: [] },

		"pointLightColor" : { type: "fv", value: [] },
		"pointLightPosition" : { type: "fv", value: [] },
		"pointLightDistance" : { type: "fv1", value: [] },

		"spotLightColor" : { type: "fv", value: [] },
		"spotLightPosition" : { type: "fv", value: [] },
		"spotLightDirection" : { type: "fv", value: [] },
		"spotLightDistance" : { type: "fv1", value: [] },
		"spotLightAngleCos" : { type: "fv1", value: [] },
		"spotLightExponent" : { type: "fv1", value: [] }

	},

	particle: {

		"psColor" : { type: "c", value: new THREE.Color( 0xeeeeee ) },
		"opacity" : { type: "f", value: 1.0 },
		"size" : { type: "f", value: 1.0 },
		"scale" : { type: "f", value: 1.0 },
		"map" : { type: "t", value: null },

		"fogDensity" : { type: "f", value: 0.00025 },
		"fogNear" : { type: "f", value: 1 },
		"fogFar" : { type: "f", value: 2000 },
		"fogColor" : { type: "c", value: new THREE.Color( 0xffffff ) }

	},

	shadowmap: {

		"shadowMap": { type: "tv", value: [] },
		"shadowMapSize": { type: "v2v", value: [] },

		"shadowBias" : { type: "fv1", value: [] },
		"shadowDarkness": { type: "fv1", value: [] },

		"shadowMatrix" : { type: "m4v", value: [] }

	}

};

// File:src/renderers/shaders/ShaderLib.js

/**
 * Webgl Shader Library for three.js
 *
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 * @author mikael emtinger / http://gomo.se/
 */


THREE.ShaderLib = {

	'basic': {

		uniforms: THREE.UniformsUtils.merge( [

			THREE.UniformsLib[ "common" ],
			THREE.UniformsLib[ "fog" ],
			THREE.UniformsLib[ "shadowmap" ]

		] ),

		vertexShader: [

			THREE.ShaderChunk[ "map_pars_vertex" ],
			THREE.ShaderChunk[ "lightmap_pars_vertex" ],
			THREE.ShaderChunk[ "envmap_pars_vertex" ],
			THREE.ShaderChunk[ "color_pars_vertex" ],
			THREE.ShaderChunk[ "morphtarget_pars_vertex" ],
			THREE.ShaderChunk[ "skinning_pars_vertex" ],
			THREE.ShaderChunk[ "shadowmap_pars_vertex" ],
			THREE.ShaderChunk[ "logdepthbuf_pars_vertex" ],

			"void main() {",

				THREE.ShaderChunk[ "map_vertex" ],
				THREE.ShaderChunk[ "lightmap_vertex" ],
				THREE.ShaderChunk[ "color_vertex" ],
				THREE.ShaderChunk[ "skinbase_vertex" ],

			"	#ifdef USE_ENVMAP",

				THREE.ShaderChunk[ "morphnormal_vertex" ],
				THREE.ShaderChunk[ "skinnormal_vertex" ],
				THREE.ShaderChunk[ "defaultnormal_vertex" ],

			"	#endif",

				THREE.ShaderChunk[ "morphtarget_vertex" ],
				THREE.ShaderChunk[ "skinning_vertex" ],
				THREE.ShaderChunk[ "default_vertex" ],
				THREE.ShaderChunk[ "logdepthbuf_vertex" ],

				THREE.ShaderChunk[ "worldpos_vertex" ],
				THREE.ShaderChunk[ "envmap_vertex" ],
				THREE.ShaderChunk[ "shadowmap_vertex" ],

			"}"

		].join("\n"),

		fragmentShader: [

			"uniform vec3 diffuse;",
			"uniform float opacity;",

			THREE.ShaderChunk[ "color_pars_fragment" ],
			THREE.ShaderChunk[ "map_pars_fragment" ],
			THREE.ShaderChunk[ "alphamap_pars_fragment" ],
			THREE.ShaderChunk[ "lightmap_pars_fragment" ],
			THREE.ShaderChunk[ "envmap_pars_fragment" ],
			THREE.ShaderChunk[ "fog_pars_fragment" ],
			THREE.ShaderChunk[ "shadowmap_pars_fragment" ],
			THREE.ShaderChunk[ "specularmap_pars_fragment" ],
			THREE.ShaderChunk[ "logdepthbuf_pars_fragment" ],

			"void main() {",

			"	gl_FragColor = vec4( diffuse, opacity );",

				THREE.ShaderChunk[ "logdepthbuf_fragment" ],
				THREE.ShaderChunk[ "map_fragment" ],
				THREE.ShaderChunk[ "alphamap_fragment" ],
				THREE.ShaderChunk[ "alphatest_fragment" ],
				THREE.ShaderChunk[ "specularmap_fragment" ],
				THREE.ShaderChunk[ "lightmap_fragment" ],
				THREE.ShaderChunk[ "color_fragment" ],
				THREE.ShaderChunk[ "envmap_fragment" ],
				THREE.ShaderChunk[ "shadowmap_fragment" ],

				THREE.ShaderChunk[ "linear_to_gamma_fragment" ],

				THREE.ShaderChunk[ "fog_fragment" ],

			"}"

		].join("\n")

	},

	'lambert': {

		uniforms: THREE.UniformsUtils.merge( [

			THREE.UniformsLib[ "common" ],
			THREE.UniformsLib[ "fog" ],
			THREE.UniformsLib[ "lights" ],
			THREE.UniformsLib[ "shadowmap" ],

			{
				"ambient"  : { type: "c", value: new THREE.Color( 0xffffff ) },
				"emissive" : { type: "c", value: new THREE.Color( 0x000000 ) },
				"wrapRGB"  : { type: "v3", value: new THREE.Vector3( 1, 1, 1 ) }
			}

		] ),

		vertexShader: [

			"#define LAMBERT",

			"varying vec3 vLightFront;",

			"#ifdef DOUBLE_SIDED",

			"	varying vec3 vLightBack;",

			"#endif",

			THREE.ShaderChunk[ "map_pars_vertex" ],
			THREE.ShaderChunk[ "lightmap_pars_vertex" ],
			THREE.ShaderChunk[ "envmap_pars_vertex" ],
			THREE.ShaderChunk[ "lights_lambert_pars_vertex" ],
			THREE.ShaderChunk[ "color_pars_vertex" ],
			THREE.ShaderChunk[ "morphtarget_pars_vertex" ],
			THREE.ShaderChunk[ "skinning_pars_vertex" ],
			THREE.ShaderChunk[ "shadowmap_pars_vertex" ],
			THREE.ShaderChunk[ "logdepthbuf_pars_vertex" ],

			"void main() {",

				THREE.ShaderChunk[ "map_vertex" ],
				THREE.ShaderChunk[ "lightmap_vertex" ],
				THREE.ShaderChunk[ "color_vertex" ],

				THREE.ShaderChunk[ "morphnormal_vertex" ],
				THREE.ShaderChunk[ "skinbase_vertex" ],
				THREE.ShaderChunk[ "skinnormal_vertex" ],
				THREE.ShaderChunk[ "defaultnormal_vertex" ],

				THREE.ShaderChunk[ "morphtarget_vertex" ],
				THREE.ShaderChunk[ "skinning_vertex" ],
				THREE.ShaderChunk[ "default_vertex" ],
				THREE.ShaderChunk[ "logdepthbuf_vertex" ],

				THREE.ShaderChunk[ "worldpos_vertex" ],
				THREE.ShaderChunk[ "envmap_vertex" ],
				THREE.ShaderChunk[ "lights_lambert_vertex" ],
				THREE.ShaderChunk[ "shadowmap_vertex" ],

			"}"

		].join("\n"),

		fragmentShader: [

			"uniform float opacity;",

			"varying vec3 vLightFront;",

			"#ifdef DOUBLE_SIDED",

			"	varying vec3 vLightBack;",

			"#endif",

			THREE.ShaderChunk[ "color_pars_fragment" ],
			THREE.ShaderChunk[ "map_pars_fragment" ],
			THREE.ShaderChunk[ "alphamap_pars_fragment" ],
			THREE.ShaderChunk[ "lightmap_pars_fragment" ],
			THREE.ShaderChunk[ "envmap_pars_fragment" ],
			THREE.ShaderChunk[ "fog_pars_fragment" ],
			THREE.ShaderChunk[ "shadowmap_pars_fragment" ],
			THREE.ShaderChunk[ "specularmap_pars_fragment" ],
			THREE.ShaderChunk[ "logdepthbuf_pars_fragment" ],

			"void main() {",

			"	gl_FragColor = vec4( vec3( 1.0 ), opacity );",

				THREE.ShaderChunk[ "logdepthbuf_fragment" ],
				THREE.ShaderChunk[ "map_fragment" ],
				THREE.ShaderChunk[ "alphamap_fragment" ],
				THREE.ShaderChunk[ "alphatest_fragment" ],
				THREE.ShaderChunk[ "specularmap_fragment" ],

			"	#ifdef DOUBLE_SIDED",

					//"float isFront = float( gl_FrontFacing );",
					//"gl_FragColor.xyz *= isFront * vLightFront + ( 1.0 - isFront ) * vLightBack;",

			"		if ( gl_FrontFacing )",
			"			gl_FragColor.xyz *= vLightFront;",
			"		else",
			"			gl_FragColor.xyz *= vLightBack;",

			"	#else",

			"		gl_FragColor.xyz *= vLightFront;",

			"	#endif",

				THREE.ShaderChunk[ "lightmap_fragment" ],
				THREE.ShaderChunk[ "color_fragment" ],
				THREE.ShaderChunk[ "envmap_fragment" ],
				THREE.ShaderChunk[ "shadowmap_fragment" ],

				THREE.ShaderChunk[ "linear_to_gamma_fragment" ],

				THREE.ShaderChunk[ "fog_fragment" ],

			"}"

		].join("\n")

	},

	'phong': {

		uniforms: THREE.UniformsUtils.merge( [

			THREE.UniformsLib[ "common" ],
			THREE.UniformsLib[ "bump" ],
			THREE.UniformsLib[ "normalmap" ],
			THREE.UniformsLib[ "fog" ],
			THREE.UniformsLib[ "lights" ],
			THREE.UniformsLib[ "shadowmap" ],

			{
				"ambient"  : { type: "c", value: new THREE.Color( 0xffffff ) },
				"emissive" : { type: "c", value: new THREE.Color( 0x000000 ) },
				"specular" : { type: "c", value: new THREE.Color( 0x111111 ) },
				"shininess": { type: "f", value: 30 },
				"wrapRGB"  : { type: "v3", value: new THREE.Vector3( 1, 1, 1 ) }
			}

		] ),

		vertexShader: [

			"#define PHONG",

			"varying vec3 vViewPosition;",
			"varying vec3 vNormal;",

			THREE.ShaderChunk[ "map_pars_vertex" ],
			THREE.ShaderChunk[ "lightmap_pars_vertex" ],
			THREE.ShaderChunk[ "envmap_pars_vertex" ],
			THREE.ShaderChunk[ "lights_phong_pars_vertex" ],
			THREE.ShaderChunk[ "color_pars_vertex" ],
			THREE.ShaderChunk[ "morphtarget_pars_vertex" ],
			THREE.ShaderChunk[ "skinning_pars_vertex" ],
			THREE.ShaderChunk[ "shadowmap_pars_vertex" ],
			THREE.ShaderChunk[ "logdepthbuf_pars_vertex" ],

			"void main() {",

				THREE.ShaderChunk[ "map_vertex" ],
				THREE.ShaderChunk[ "lightmap_vertex" ],
				THREE.ShaderChunk[ "color_vertex" ],

				THREE.ShaderChunk[ "morphnormal_vertex" ],
				THREE.ShaderChunk[ "skinbase_vertex" ],
				THREE.ShaderChunk[ "skinnormal_vertex" ],
				THREE.ShaderChunk[ "defaultnormal_vertex" ],

			"	vNormal = normalize( transformedNormal );",

				THREE.ShaderChunk[ "morphtarget_vertex" ],
				THREE.ShaderChunk[ "skinning_vertex" ],
				THREE.ShaderChunk[ "default_vertex" ],
				THREE.ShaderChunk[ "logdepthbuf_vertex" ],

			"	vViewPosition = -mvPosition.xyz;",

				THREE.ShaderChunk[ "worldpos_vertex" ],
				THREE.ShaderChunk[ "envmap_vertex" ],
				THREE.ShaderChunk[ "lights_phong_vertex" ],
				THREE.ShaderChunk[ "shadowmap_vertex" ],

			"}"

		].join("\n"),

		fragmentShader: [

			"#define PHONG",

			"uniform vec3 diffuse;",
			"uniform float opacity;",

			"uniform vec3 ambient;",
			"uniform vec3 emissive;",
			"uniform vec3 specular;",
			"uniform float shininess;",

			THREE.ShaderChunk[ "color_pars_fragment" ],
			THREE.ShaderChunk[ "map_pars_fragment" ],
			THREE.ShaderChunk[ "alphamap_pars_fragment" ],
			THREE.ShaderChunk[ "lightmap_pars_fragment" ],
			THREE.ShaderChunk[ "envmap_pars_fragment" ],
			THREE.ShaderChunk[ "fog_pars_fragment" ],
			THREE.ShaderChunk[ "lights_phong_pars_fragment" ],
			THREE.ShaderChunk[ "shadowmap_pars_fragment" ],
			THREE.ShaderChunk[ "bumpmap_pars_fragment" ],
			THREE.ShaderChunk[ "normalmap_pars_fragment" ],
			THREE.ShaderChunk[ "specularmap_pars_fragment" ],
			THREE.ShaderChunk[ "logdepthbuf_pars_fragment" ],

			"void main() {",

			"	gl_FragColor = vec4( vec3( 1.0 ), opacity );",

				THREE.ShaderChunk[ "logdepthbuf_fragment" ],
				THREE.ShaderChunk[ "map_fragment" ],
				THREE.ShaderChunk[ "alphamap_fragment" ],
				THREE.ShaderChunk[ "alphatest_fragment" ],
				THREE.ShaderChunk[ "specularmap_fragment" ],

				THREE.ShaderChunk[ "lights_phong_fragment" ],

				THREE.ShaderChunk[ "lightmap_fragment" ],
				THREE.ShaderChunk[ "color_fragment" ],
				THREE.ShaderChunk[ "envmap_fragment" ],
				THREE.ShaderChunk[ "shadowmap_fragment" ],

				THREE.ShaderChunk[ "linear_to_gamma_fragment" ],

				THREE.ShaderChunk[ "fog_fragment" ],

			"}"

		].join("\n")

	},

	'particle_basic': {

		uniforms: THREE.UniformsUtils.merge( [

			THREE.UniformsLib[ "particle" ],
			THREE.UniformsLib[ "shadowmap" ]

		] ),

		vertexShader: [

			"uniform float size;",
			"uniform float scale;",

			THREE.ShaderChunk[ "color_pars_vertex" ],
			THREE.ShaderChunk[ "shadowmap_pars_vertex" ],
			THREE.ShaderChunk[ "logdepthbuf_pars_vertex" ],

			"void main() {",

				THREE.ShaderChunk[ "color_vertex" ],

			"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",

			"	#ifdef USE_SIZEATTENUATION",
			"		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );",
			"	#else",
			"		gl_PointSize = size;",
			"	#endif",

			"	gl_Position = projectionMatrix * mvPosition;",

				THREE.ShaderChunk[ "logdepthbuf_vertex" ],
				THREE.ShaderChunk[ "worldpos_vertex" ],
				THREE.ShaderChunk[ "shadowmap_vertex" ],

			"}"

		].join("\n"),

		fragmentShader: [

			"uniform vec3 psColor;",
			"uniform float opacity;",

			THREE.ShaderChunk[ "color_pars_fragment" ],
			THREE.ShaderChunk[ "map_particle_pars_fragment" ],
			THREE.ShaderChunk[ "fog_pars_fragment" ],
			THREE.ShaderChunk[ "shadowmap_pars_fragment" ],
			THREE.ShaderChunk[ "logdepthbuf_pars_fragment" ],

			"void main() {",

			"	gl_FragColor = vec4( psColor, opacity );",

				THREE.ShaderChunk[ "logdepthbuf_fragment" ],
				THREE.ShaderChunk[ "map_particle_fragment" ],
				THREE.ShaderChunk[ "alphatest_fragment" ],
				THREE.ShaderChunk[ "color_fragment" ],
				THREE.ShaderChunk[ "shadowmap_fragment" ],
				THREE.ShaderChunk[ "fog_fragment" ],

			"}"

		].join("\n")

	},

	'dashed': {

		uniforms: THREE.UniformsUtils.merge( [

			THREE.UniformsLib[ "common" ],
			THREE.UniformsLib[ "fog" ],

			{
				"scale"    : { type: "f", value: 1 },
				"dashSize" : { type: "f", value: 1 },
				"totalSize": { type: "f", value: 2 }
			}

		] ),

		vertexShader: [

			"uniform float scale;",
			"attribute float lineDistance;",

			"varying float vLineDistance;",

			THREE.ShaderChunk[ "color_pars_vertex" ],
			THREE.ShaderChunk[ "logdepthbuf_pars_vertex" ],

			"void main() {",

				THREE.ShaderChunk[ "color_vertex" ],

			"	vLineDistance = scale * lineDistance;",

			"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",
			"	gl_Position = projectionMatrix * mvPosition;",

				THREE.ShaderChunk[ "logdepthbuf_vertex" ],

			"}"

		].join("\n"),

		fragmentShader: [

			"uniform vec3 diffuse;",
			"uniform float opacity;",

			"uniform float dashSize;",
			"uniform float totalSize;",

			"varying float vLineDistance;",

			THREE.ShaderChunk[ "color_pars_fragment" ],
			THREE.ShaderChunk[ "fog_pars_fragment" ],
			THREE.ShaderChunk[ "logdepthbuf_pars_fragment" ],

			"void main() {",

			"	if ( mod( vLineDistance, totalSize ) > dashSize ) {",

			"		discard;",

			"	}",

			"	gl_FragColor = vec4( diffuse, opacity );",

				THREE.ShaderChunk[ "logdepthbuf_fragment" ],
				THREE.ShaderChunk[ "color_fragment" ],
				THREE.ShaderChunk[ "fog_fragment" ],

			"}"

		].join("\n")

	},

	'depth': {

		uniforms: {

			"mNear": { type: "f", value: 1.0 },
			"mFar" : { type: "f", value: 2000.0 },
			"opacity" : { type: "f", value: 1.0 }

		},

		vertexShader: [

			THREE.ShaderChunk[ "morphtarget_pars_vertex" ],
			THREE.ShaderChunk[ "logdepthbuf_pars_vertex" ],

			"void main() {",

				THREE.ShaderChunk[ "morphtarget_vertex" ],
				THREE.ShaderChunk[ "default_vertex" ],
				THREE.ShaderChunk[ "logdepthbuf_vertex" ],

			"}"

		].join("\n"),

		fragmentShader: [

			"uniform float mNear;",
			"uniform float mFar;",
			"uniform float opacity;",

			THREE.ShaderChunk[ "logdepthbuf_pars_fragment" ],

			"void main() {",

				THREE.ShaderChunk[ "logdepthbuf_fragment" ],

			"	#ifdef USE_LOGDEPTHBUF_EXT",

			"		float depth = gl_FragDepthEXT / gl_FragCoord.w;",

			"	#else",

			"		float depth = gl_FragCoord.z / gl_FragCoord.w;",

			"	#endif",

			"	float color = 1.0 - smoothstep( mNear, mFar, depth );",
			"	gl_FragColor = vec4( vec3( color ), opacity );",

			"}"

		].join("\n")

	},

	'normal': {

		uniforms: {

			"opacity" : { type: "f", value: 1.0 }

		},

		vertexShader: [

			"varying vec3 vNormal;",

			THREE.ShaderChunk[ "morphtarget_pars_vertex" ],
			THREE.ShaderChunk[ "logdepthbuf_pars_vertex" ],

			"void main() {",

			"	vNormal = normalize( normalMatrix * normal );",

				THREE.ShaderChunk[ "morphtarget_vertex" ],
				THREE.ShaderChunk[ "default_vertex" ],
				THREE.ShaderChunk[ "logdepthbuf_vertex" ],

			"}"

		].join("\n"),

		fragmentShader: [

			"uniform float opacity;",
			"varying vec3 vNormal;",

			THREE.ShaderChunk[ "logdepthbuf_pars_fragment" ],

			"void main() {",

			"	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",

				THREE.ShaderChunk[ "logdepthbuf_fragment" ],

			"}"

		].join("\n")

	},

	/* -------------------------------------------------------------------------
	//	Normal map shader
	//		- Blinn-Phong
	//		- normal + diffuse + specular + AO + displacement + reflection + shadow maps
	//		- point and directional lights (use with "lights: true" material option)
	 ------------------------------------------------------------------------- */

	'normalmap' : {

		uniforms: THREE.UniformsUtils.merge( [

			THREE.UniformsLib[ "fog" ],
			THREE.UniformsLib[ "lights" ],
			THREE.UniformsLib[ "shadowmap" ],

			{

			"enableAO"          : { type: "i", value: 0 },
			"enableDiffuse"     : { type: "i", value: 0 },
			"enableSpecular"    : { type: "i", value: 0 },
			"enableReflection"  : { type: "i", value: 0 },
			"enableDisplacement": { type: "i", value: 0 },

			"tDisplacement": { type: "t", value: null }, // must go first as this is vertex texture
			"tDiffuse"     : { type: "t", value: null },
			"tCube"        : { type: "t", value: null },
			"tNormal"      : { type: "t", value: null },
			"tSpecular"    : { type: "t", value: null },
			"tAO"          : { type: "t", value: null },

			"uNormalScale": { type: "v2", value: new THREE.Vector2( 1, 1 ) },

			"uDisplacementBias": { type: "f", value: 0.0 },
			"uDisplacementScale": { type: "f", value: 1.0 },

			"diffuse": { type: "c", value: new THREE.Color( 0xffffff ) },
			"specular": { type: "c", value: new THREE.Color( 0x111111 ) },
			"ambient": { type: "c", value: new THREE.Color( 0xffffff ) },
			"shininess": { type: "f", value: 30 },
			"opacity": { type: "f", value: 1 },

			"useRefract": { type: "i", value: 0 },
			"refractionRatio": { type: "f", value: 0.98 },
			"reflectivity": { type: "f", value: 0.5 },

			"uOffset" : { type: "v2", value: new THREE.Vector2( 0, 0 ) },
			"uRepeat" : { type: "v2", value: new THREE.Vector2( 1, 1 ) },

			"wrapRGB" : { type: "v3", value: new THREE.Vector3( 1, 1, 1 ) }

			}

		] ),

		fragmentShader: [

			"uniform vec3 ambient;",
			"uniform vec3 diffuse;",
			"uniform vec3 specular;",
			"uniform float shininess;",
			"uniform float opacity;",

			"uniform bool enableDiffuse;",
			"uniform bool enableSpecular;",
			"uniform bool enableAO;",
			"uniform bool enableReflection;",

			"uniform sampler2D tDiffuse;",
			"uniform sampler2D tNormal;",
			"uniform sampler2D tSpecular;",
			"uniform sampler2D tAO;",

			"uniform samplerCube tCube;",

			"uniform vec2 uNormalScale;",

			"uniform bool useRefract;",
			"uniform float refractionRatio;",
			"uniform float reflectivity;",

			"varying vec3 vTangent;",
			"varying vec3 vBinormal;",
			"varying vec3 vNormal;",
			"varying vec2 vUv;",

			"uniform vec3 ambientLightColor;",

			"#if MAX_DIR_LIGHTS > 0",

			"	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];",
			"	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];",

			"#endif",

			"#if MAX_HEMI_LIGHTS > 0",

			"	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];",
			"	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];",
			"	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];",

			"#endif",

			"#if MAX_POINT_LIGHTS > 0",

			"	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];",
			"	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];",
			"	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];",

			"#endif",

			"#if MAX_SPOT_LIGHTS > 0",

			"	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];",
			"	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];",
			"	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];",
			"	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];",
			"	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];",
			"	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];",

			"#endif",

			"#ifdef WRAP_AROUND",

			"	uniform vec3 wrapRGB;",

			"#endif",

			"varying vec3 vWorldPosition;",
			"varying vec3 vViewPosition;",

			THREE.ShaderChunk[ "shadowmap_pars_fragment" ],
			THREE.ShaderChunk[ "fog_pars_fragment" ],
			THREE.ShaderChunk[ "logdepthbuf_pars_fragment" ],

			"void main() {",
				THREE.ShaderChunk[ "logdepthbuf_fragment" ],

			"	gl_FragColor = vec4( vec3( 1.0 ), opacity );",

			"	vec3 specularTex = vec3( 1.0 );",

			"	vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;",
			"	normalTex.xy *= uNormalScale;",
			"	normalTex = normalize( normalTex );",

			"	if( enableDiffuse ) {",

			"		#ifdef GAMMA_INPUT",

			"			vec4 texelColor = texture2D( tDiffuse, vUv );",
			"			texelColor.xyz *= texelColor.xyz;",

			"			gl_FragColor = gl_FragColor * texelColor;",

			"		#else",

			"			gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );",

			"		#endif",

			"	}",

			"	if( enableAO ) {",

			"		#ifdef GAMMA_INPUT",

			"			vec4 aoColor = texture2D( tAO, vUv );",
			"			aoColor.xyz *= aoColor.xyz;",

			"			gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;",

			"		#else",

			"			gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;",

			"		#endif",

			"	}",
			
			THREE.ShaderChunk[ "alphatest_fragment" ],

			"	if( enableSpecular )",
			"		specularTex = texture2D( tSpecular, vUv ).xyz;",

			"	mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );",
			"	vec3 finalNormal = tsb * normalTex;",

			"	#ifdef FLIP_SIDED",

			"		finalNormal = -finalNormal;",

			"	#endif",

			"	vec3 normal = normalize( finalNormal );",
			"	vec3 viewPosition = normalize( vViewPosition );",

				// point lights

			"	#if MAX_POINT_LIGHTS > 0",

			"		vec3 pointDiffuse = vec3( 0.0 );",
			"		vec3 pointSpecular = vec3( 0.0 );",

			"		for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {",

			"			vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );",
			"			vec3 pointVector = lPosition.xyz + vViewPosition.xyz;",

			"			float pointDistance = 1.0;",
			"			if ( pointLightDistance[ i ] > 0.0 )",
			"				pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );",

			"			pointVector = normalize( pointVector );",

						// diffuse

			"			#ifdef WRAP_AROUND",

			"				float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );",
			"				float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );",

			"				vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );",

			"			#else",

			"				float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );",

			"			#endif",

			"			pointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;",

						// specular

			"			vec3 pointHalfVector = normalize( pointVector + viewPosition );",
			"			float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );",
			"			float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );",

			"			float specularNormalization = ( shininess + 2.0 ) / 8.0;",

			"			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( pointVector, pointHalfVector ), 0.0 ), 5.0 );",
			"			pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;",

			"		}",

			"	#endif",

				// spot lights

			"	#if MAX_SPOT_LIGHTS > 0",

			"		vec3 spotDiffuse = vec3( 0.0 );",
			"		vec3 spotSpecular = vec3( 0.0 );",

			"		for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {",

			"			vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );",
			"			vec3 spotVector = lPosition.xyz + vViewPosition.xyz;",

			"			float spotDistance = 1.0;",
			"			if ( spotLightDistance[ i ] > 0.0 )",
			"				spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );",

			"			spotVector = normalize( spotVector );",

			"			float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );",

			"			if ( spotEffect > spotLightAngleCos[ i ] ) {",

			"				spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );",

							// diffuse

			"				#ifdef WRAP_AROUND",

			"					float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );",
			"					float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );",

			"					vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );",

			"				#else",

			"					float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );",

			"				#endif",

			"				spotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;",

							// specular

			"				vec3 spotHalfVector = normalize( spotVector + viewPosition );",
			"				float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );",
			"				float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );",

			"				float specularNormalization = ( shininess + 2.0 ) / 8.0;",

			"				vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( spotVector, spotHalfVector ), 0.0 ), 5.0 );",
			"				spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;",

			"			}",

			"		}",

			"	#endif",

				// directional lights

			"	#if MAX_DIR_LIGHTS > 0",

			"		vec3 dirDiffuse = vec3( 0.0 );",
			"		vec3 dirSpecular = vec3( 0.0 );",

			"		for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {",

			"			vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );",
			"			vec3 dirVector = normalize( lDirection.xyz );",

						// diffuse

			"			#ifdef WRAP_AROUND",

			"				float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );",
			"				float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );",

			"				vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );",

			"			#else",

			"				float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );",

			"			#endif",

			"			dirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;",

						// specular

			"			vec3 dirHalfVector = normalize( dirVector + viewPosition );",
			"			float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );",
			"			float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );",

			"			float specularNormalization = ( shininess + 2.0 ) / 8.0;",

			"			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );",
			"			dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;",

			"		}",

			"	#endif",

				// hemisphere lights

			"	#if MAX_HEMI_LIGHTS > 0",

			"		vec3 hemiDiffuse = vec3( 0.0 );",
			"		vec3 hemiSpecular = vec3( 0.0 );" ,

			"		for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {",

			"			vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );",
			"			vec3 lVector = normalize( lDirection.xyz );",

						// diffuse

			"			float dotProduct = dot( normal, lVector );",
			"			float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;",

			"			vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );",

			"			hemiDiffuse += diffuse * hemiColor;",

						// specular (sky light)


			"			vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );",
			"			float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;",
			"			float hemiSpecularWeightSky = specularTex.r * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );",

						// specular (ground light)

			"			vec3 lVectorGround = -lVector;",

			"			vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );",
			"			float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;",
			"			float hemiSpecularWeightGround = specularTex.r * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );",

			"			float dotProductGround = dot( normal, lVectorGround );",

			"			float specularNormalization = ( shininess + 2.0 ) / 8.0;",

			"			vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );",
			"			vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );",
			"			hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );",

			"		}",

			"	#endif",

				// all lights contribution summation

			"	vec3 totalDiffuse = vec3( 0.0 );",
			"	vec3 totalSpecular = vec3( 0.0 );",

			"	#if MAX_DIR_LIGHTS > 0",

			"		totalDiffuse += dirDiffuse;",
			"		totalSpecular += dirSpecular;",

			"	#endif",

			"	#if MAX_HEMI_LIGHTS > 0",

			"		totalDiffuse += hemiDiffuse;",
			"		totalSpecular += hemiSpecular;",

			"	#endif",

			"	#if MAX_POINT_LIGHTS > 0",

			"		totalDiffuse += pointDiffuse;",
			"		totalSpecular += pointSpecular;",

			"	#endif",

			"	#if MAX_SPOT_LIGHTS > 0",

			"		totalDiffuse += spotDiffuse;",
			"		totalSpecular += spotSpecular;",

			"	#endif",

			"	#ifdef METAL",

			"		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );",

			"	#else",

			"		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;",

			"	#endif",

			"	if ( enableReflection ) {",

			"		vec3 vReflect;",
			"		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );",

			"		if ( useRefract ) {",

			"			vReflect = refract( cameraToVertex, normal, refractionRatio );",

			"		} else {",

			"			vReflect = reflect( cameraToVertex, normal );",

			"		}",

			"		vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );",

			"		#ifdef GAMMA_INPUT",

			"			cubeColor.xyz *= cubeColor.xyz;",

			"		#endif",

			"		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );",

			"	}",

				THREE.ShaderChunk[ "shadowmap_fragment" ],
				THREE.ShaderChunk[ "linear_to_gamma_fragment" ],
				THREE.ShaderChunk[ "fog_fragment" ],

			"}"

		].join("\n"),

		vertexShader: [

			"attribute vec4 tangent;",

			"uniform vec2 uOffset;",
			"uniform vec2 uRepeat;",

			"uniform bool enableDisplacement;",

			"#ifdef VERTEX_TEXTURES",

			"	uniform sampler2D tDisplacement;",
			"	uniform float uDisplacementScale;",
			"	uniform float uDisplacementBias;",

			"#endif",

			"varying vec3 vTangent;",
			"varying vec3 vBinormal;",
			"varying vec3 vNormal;",
			"varying vec2 vUv;",

			"varying vec3 vWorldPosition;",
			"varying vec3 vViewPosition;",

			THREE.ShaderChunk[ "skinning_pars_vertex" ],
			THREE.ShaderChunk[ "shadowmap_pars_vertex" ],
			THREE.ShaderChunk[ "logdepthbuf_pars_vertex" ],

			"void main() {",

				THREE.ShaderChunk[ "skinbase_vertex" ],
				THREE.ShaderChunk[ "skinnormal_vertex" ],

				// normal, tangent and binormal vectors

			"	#ifdef USE_SKINNING",

			"		vNormal = normalize( normalMatrix * skinnedNormal.xyz );",

			"		vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );",
			"		vTangent = normalize( normalMatrix * skinnedTangent.xyz );",

			"	#else",

			"		vNormal = normalize( normalMatrix * normal );",
			"		vTangent = normalize( normalMatrix * tangent.xyz );",

			"	#endif",

			"	vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );",

			"	vUv = uv * uRepeat + uOffset;",

				// displacement mapping

			"	vec3 displacedPosition;",

			"	#ifdef VERTEX_TEXTURES",

			"		if ( enableDisplacement ) {",

			"			vec3 dv = texture2D( tDisplacement, uv ).xyz;",
			"			float df = uDisplacementScale * dv.x + uDisplacementBias;",
			"			displacedPosition = position + normalize( normal ) * df;",

			"		} else {",

			"			#ifdef USE_SKINNING",

			"				vec4 skinVertex = bindMatrix * vec4( position, 1.0 );",

			"				vec4 skinned = vec4( 0.0 );",
			"				skinned += boneMatX * skinVertex * skinWeight.x;",
			"				skinned += boneMatY * skinVertex * skinWeight.y;",
			"				skinned += boneMatZ * skinVertex * skinWeight.z;",
			"				skinned += boneMatW * skinVertex * skinWeight.w;",
			"				skinned  = bindMatrixInverse * skinned;",

			"				displacedPosition = skinned.xyz;",

			"			#else",

			"				displacedPosition = position;",

			"			#endif",

			"		}",

			"	#else",

			"		#ifdef USE_SKINNING",

			"			vec4 skinVertex = bindMatrix * vec4( position, 1.0 );",

			"			vec4 skinned = vec4( 0.0 );",
			"			skinned += boneMatX * skinVertex * skinWeight.x;",
			"			skinned += boneMatY * skinVertex * skinWeight.y;",
			"			skinned += boneMatZ * skinVertex * skinWeight.z;",
			"			skinned += boneMatW * skinVertex * skinWeight.w;",
			"			skinned  = bindMatrixInverse * skinned;",

			"			displacedPosition = skinned.xyz;",

			"		#else",

			"			displacedPosition = position;",

			"		#endif",

			"	#endif",

				//

			"	vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );",
			"	vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );",

			"	gl_Position = projectionMatrix * mvPosition;",

				THREE.ShaderChunk[ "logdepthbuf_vertex" ],

				//

			"	vWorldPosition = worldPosition.xyz;",
			"	vViewPosition = -mvPosition.xyz;",

				// shadows

			"	#ifdef USE_SHADOWMAP",

			"		for( int i = 0; i < MAX_SHADOWS; i ++ ) {",

			"			vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;",

			"		}",

			"	#endif",

			"}"

		].join("\n")

	},

	/* -------------------------------------------------------------------------
	//	Cube map shader
	 ------------------------------------------------------------------------- */

	'cube': {

		uniforms: { "tCube": { type: "t", value: null },
					"tFlip": { type: "f", value: - 1 } },

		vertexShader: [

			"varying vec3 vWorldPosition;",

			THREE.ShaderChunk[ "logdepthbuf_pars_vertex" ],

			"void main() {",

			"	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );",
			"	vWorldPosition = worldPosition.xyz;",

			"	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

				THREE.ShaderChunk[ "logdepthbuf_vertex" ],

			"}"

		].join("\n"),

		fragmentShader: [

			"uniform samplerCube tCube;",
			"uniform float tFlip;",

			"varying vec3 vWorldPosition;",

			THREE.ShaderChunk[ "logdepthbuf_pars_fragment" ],

			"void main() {",

			"	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",

				THREE.ShaderChunk[ "logdepthbuf_fragment" ],

			"}"

		].join("\n")

	},

	/* Depth encoding into RGBA texture
	 *
	 * based on SpiderGL shadow map example
	 * http://spidergl.org/example.php?id=6
	 *
	 * originally from
	 * http://www.gamedev.net/topic/442138-packing-a-float-into-a-a8r8g8b8-texture-shader/page__whichpage__1%25EF%25BF%25BD
	 *
	 * see also
	 * http://aras-p.info/blog/2009/07/30/encoding-floats-to-rgba-the-final/
	 */

	'depthRGBA': {

		uniforms: {},

		vertexShader: [

			THREE.ShaderChunk[ "morphtarget_pars_vertex" ],
			THREE.ShaderChunk[ "skinning_pars_vertex" ],
			THREE.ShaderChunk[ "logdepthbuf_pars_vertex" ],

			"void main() {",

				THREE.ShaderChunk[ "skinbase_vertex" ],
				THREE.ShaderChunk[ "morphtarget_vertex" ],
				THREE.ShaderChunk[ "skinning_vertex" ],
				THREE.ShaderChunk[ "default_vertex" ],
				THREE.ShaderChunk[ "logdepthbuf_vertex" ],

			"}"

		].join("\n"),

		fragmentShader: [

			THREE.ShaderChunk[ "logdepthbuf_pars_fragment" ],

			"vec4 pack_depth( const in float depth ) {",

			"	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );",
			"	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );",
			"	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );", // "	vec4 res = fract( depth * bit_shift );",
			"	res -= res.xxyz * bit_mask;",
			"	return res;",

			"}",

			"void main() {",

				THREE.ShaderChunk[ "logdepthbuf_fragment" ],

			"	#ifdef USE_LOGDEPTHBUF_EXT",

			"		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );",

			"	#else",

			"		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );",

			"	#endif",

				//"gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z / gl_FragCoord.w );",
				//"float z = ( ( gl_FragCoord.z / gl_FragCoord.w ) - 3.0 ) / ( 4000.0 - 3.0 );",
				//"gl_FragData[ 0 ] = pack_depth( z );",
				//"gl_FragData[ 0 ] = vec4( z, z, z, 1.0 );",

			"}"

		].join("\n")

	}

};

// File:src/renderers/WebGLRenderer.js

/**
 * @author supereggbert / http://www.paulbrunt.co.uk/
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * @author szimek / https://github.com/szimek/
 */

THREE.WebGLRenderer = function ( parameters ) {

	console.log( 'THREE.WebGLRenderer', THREE.REVISION );

	parameters = parameters || {};

	var _canvas = parameters.canvas !== undefined ? parameters.canvas : document.createElement( 'canvas' ),
	_context = parameters.context !== undefined ? parameters.context : null,

	_precision = parameters.precision !== undefined ? parameters.precision : 'highp',

	_alpha = parameters.alpha !== undefined ? parameters.alpha : false,
	_depth = parameters.depth !== undefined ? parameters.depth : true,
	_stencil = parameters.stencil !== undefined ? parameters.stencil : true,
	_antialias = parameters.antialias !== undefined ? parameters.antialias : false,
	_premultipliedAlpha = parameters.premultipliedAlpha !== undefined ? parameters.premultipliedAlpha : true,
	_preserveDrawingBuffer = parameters.preserveDrawingBuffer !== undefined ? parameters.preserveDrawingBuffer : false,
	_logarithmicDepthBuffer = parameters.logarithmicDepthBuffer !== undefined ? parameters.logarithmicDepthBuffer : false,

	_clearColor = new THREE.Color( 0x000000 ),
	_clearAlpha = 0;

	var lights = [];

	var _webglObjects = {};
	var _webglObjectsImmediate = [];

	var opaqueObjects = [];
	var transparentObjects = [];

	var sprites = [];
	var lensFlares = [];

	// public properties

	this.domElement = _canvas;
	this.context = null;
	this.devicePixelRatio = parameters.devicePixelRatio !== undefined
				 ? parameters.devicePixelRatio
				 : self.devicePixelRatio !== undefined
					 ? self.devicePixelRatio
					 : 1;

	// clearing

	this.autoClear = true;
	this.autoClearColor = true;
	this.autoClearDepth = true;
	this.autoClearStencil = true;

	// scene graph

	this.sortObjects = true;

	// physically based shading

	this.gammaInput = false;
	this.gammaOutput = false;

	// shadow map

	this.shadowMapEnabled = false;
	this.shadowMapType = THREE.PCFShadowMap;
	this.shadowMapCullFace = THREE.CullFaceFront;
	this.shadowMapDebug = false;
	this.shadowMapCascade = false;

	// morphs

	this.maxMorphTargets = 8;
	this.maxMorphNormals = 4;

	// flags

	this.autoScaleCubemaps = true;

	// info

	this.info = {

		memory: {

			programs: 0,
			geometries: 0,
			textures: 0

		},

		render: {

			calls: 0,
			vertices: 0,
			faces: 0,
			points: 0

		}

	};

	// internal properties

	var _this = this,

	_programs = [],

	// internal state cache

	_currentProgram = null,
	_currentFramebuffer = null,
	_currentMaterialId = - 1,
	_currentGeometryGroupHash = - 1,
	_currentCamera = null,

	_usedTextureUnits = 0,

	// GL state cache

	_oldDoubleSided = - 1,
	_oldFlipSided = - 1,

	_oldBlending = - 1,

	_oldBlendEquation = - 1,
	_oldBlendSrc = - 1,
	_oldBlendDst = - 1,

	_oldDepthTest = - 1,
	_oldDepthWrite = - 1,

	_oldPolygonOffset = null,
	_oldPolygonOffsetFactor = null,
	_oldPolygonOffsetUnits = null,

	_oldLineWidth = null,

	_viewportX = 0,
	_viewportY = 0,
	_viewportWidth = _canvas.width,
	_viewportHeight = _canvas.height,
	_currentWidth = 0,
	_currentHeight = 0,

	_newAttributes = new Uint8Array( 16 ),
	_enabledAttributes = new Uint8Array( 16 ),

	// frustum

	_frustum = new THREE.Frustum(),

	 // camera matrices cache

	_projScreenMatrix = new THREE.Matrix4(),
	_projScreenMatrixPS = new THREE.Matrix4(),

	_vector3 = new THREE.Vector3(),

	// light arrays cache

	_direction = new THREE.Vector3(),

	_lightsNeedUpdate = true,

	_lights = {

		ambient: [ 0, 0, 0 ],
		directional: { length: 0, colors:[], positions: [] },
		point: { length: 0, colors: [], positions: [], distances: [] },
		spot: { length: 0, colors: [], positions: [], distances: [], directions: [], anglesCos: [], exponents: [] },
		hemi: { length: 0, skyColors: [], groundColors: [], positions: [] }

	};

	// initialize

	var _gl;

	try {

		var attributes = {
			alpha: _alpha,
			depth: _depth,
			stencil: _stencil,
			antialias: _antialias,
			premultipliedAlpha: _premultipliedAlpha,
			preserveDrawingBuffer: _preserveDrawingBuffer
		};

		_gl = _context || _canvas.getContext( 'webgl', attributes ) || _canvas.getContext( 'experimental-webgl', attributes );

		if ( _gl === null ) {

			if ( _canvas.getContext( 'webgl') !== null ) {

				throw 'Error creating WebGL context with your selected attributes.';

			} else {

				throw 'Error creating WebGL context.';

			}

		}

	} catch ( error ) {

		console.error( error );

	}

	if ( _gl.getShaderPrecisionFormat === undefined ) {

		_gl.getShaderPrecisionFormat = function () {

			return {
				'rangeMin': 1,
				'rangeMax': 1,
				'precision': 1
			};

		}

	}

	var extensions = new THREE.WebGLExtensions( _gl );

	extensions.get( 'OES_texture_float' );
	extensions.get( 'OES_texture_float_linear' );
	extensions.get( 'OES_standard_derivatives' );

	if ( _logarithmicDepthBuffer ) {

		extensions.get( 'EXT_frag_depth' );

	}

	//

	function setDefaultGLState() {

		_gl.clearColor( 0, 0, 0, 1 );
		_gl.clearDepth( 1 );
		_gl.clearStencil( 0 );

		_gl.enable( _gl.DEPTH_TEST );
		_gl.depthFunc( _gl.LEQUAL );

		_gl.frontFace( _gl.CCW );
		_gl.cullFace( _gl.BACK );
		_gl.enable( _gl.CULL_FACE );

		_gl.enable( _gl.BLEND );
		_gl.blendEquation( _gl.FUNC_ADD );
		_gl.blendFunc( _gl.SRC_ALPHA, _gl.ONE_MINUS_SRC_ALPHA );

		_gl.viewport( _viewportX, _viewportY, _viewportWidth, _viewportHeight );

		_gl.clearColor( _clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha );

	}

	setDefaultGLState();

	this.context = _gl;

	// GPU capabilities

	var _maxTextures = _gl.getParameter( _gl.MAX_TEXTURE_IMAGE_UNITS );
	var _maxVertexTextures = _gl.getParameter( _gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS );
	var _maxTextureSize = _gl.getParameter( _gl.MAX_TEXTURE_SIZE );
	var _maxCubemapSize = _gl.getParameter( _gl.MAX_CUBE_MAP_TEXTURE_SIZE );

	var _supportsVertexTextures = _maxVertexTextures > 0;
	var _supportsBoneTextures = _supportsVertexTextures && extensions.get( 'OES_texture_float' );

	//

	var _vertexShaderPrecisionHighpFloat = _gl.getShaderPrecisionFormat( _gl.VERTEX_SHADER, _gl.HIGH_FLOAT );
	var _vertexShaderPrecisionMediumpFloat = _gl.getShaderPrecisionFormat( _gl.VERTEX_SHADER, _gl.MEDIUM_FLOAT );
	var _vertexShaderPrecisionLowpFloat = _gl.getShaderPrecisionFormat( _gl.VERTEX_SHADER, _gl.LOW_FLOAT );

	var _fragmentShaderPrecisionHighpFloat = _gl.getShaderPrecisionFormat( _gl.FRAGMENT_SHADER, _gl.HIGH_FLOAT );
	var _fragmentShaderPrecisionMediumpFloat = _gl.getShaderPrecisionFormat( _gl.FRAGMENT_SHADER, _gl.MEDIUM_FLOAT );
	var _fragmentShaderPrecisionLowpFloat = _gl.getShaderPrecisionFormat( _gl.FRAGMENT_SHADER, _gl.LOW_FLOAT );

	var getCompressedTextureFormats = ( function () {

		var array;

		return function () {

			if ( array !== undefined ) {

				return array;

			}

			array = [];

			if ( extensions.get( 'WEBGL_compressed_texture_pvrtc' ) || extensions.get( 'WEBGL_compressed_texture_s3tc' ) ) {

				var formats = _gl.getParameter( _gl.COMPRESSED_TEXTURE_FORMATS );

				for ( var i = 0; i < formats.length; i ++ ){

					array.push( formats[ i ] );

				}

			}
			
			return array;

		};

	} )();

	// clamp precision to maximum available

	var highpAvailable = _vertexShaderPrecisionHighpFloat.precision > 0 && _fragmentShaderPrecisionHighpFloat.precision > 0;
	var mediumpAvailable = _vertexShaderPrecisionMediumpFloat.precision > 0 && _fragmentShaderPrecisionMediumpFloat.precision > 0;

	if ( _precision === 'highp' && ! highpAvailable ) {

		if ( mediumpAvailable ) {

			_precision = 'mediump';
			console.warn( 'THREE.WebGLRenderer: highp not supported, using mediump.' );

		} else {

			_precision = 'lowp';
			console.warn( 'THREE.WebGLRenderer: highp and mediump not supported, using lowp.' );

		}

	}

	if ( _precision === 'mediump' && ! mediumpAvailable ) {

		_precision = 'lowp';
		console.warn( 'THREE.WebGLRenderer: mediump not supported, using lowp.' );

	}

	// Plugins

	var shadowMapPlugin = new THREE.ShadowMapPlugin( this, lights, _webglObjects, _webglObjectsImmediate );

	var spritePlugin = new THREE.SpritePlugin( this, sprites );
	var lensFlarePlugin = new THREE.LensFlarePlugin( this, lensFlares );

	// API

	this.getContext = function () {

		return _gl;

	};

	this.supportsVertexTextures = function () {

		return _supportsVertexTextures;

	};

	this.supportsFloatTextures = function () {

		return extensions.get( 'OES_texture_float' );

	};

	this.supportsStandardDerivatives = function () {

		return extensions.get( 'OES_standard_derivatives' );

	};

	this.supportsCompressedTextureS3TC = function () {

		return extensions.get( 'WEBGL_compressed_texture_s3tc' );

	};

	this.supportsCompressedTexturePVRTC = function () {

		return extensions.get( 'WEBGL_compressed_texture_pvrtc' );

	};

	this.supportsBlendMinMax = function () {

		return extensions.get( 'EXT_blend_minmax' );

	};

	this.getMaxAnisotropy = ( function () {

		var value;

		return function () {

			if ( value !== undefined ) {

				return value;

			}

			var extension = extensions.get( 'EXT_texture_filter_anisotropic' );

			value = extension !== null ? _gl.getParameter( extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT ) : 0;

			return value;

		}

	} )();

	this.getPrecision = function () {

		return _precision;

	};

	this.setSize = function ( width, height, updateStyle ) {

		_canvas.width = width * this.devicePixelRatio;
		_canvas.height = height * this.devicePixelRatio;

		if ( updateStyle !== false ) {

			_canvas.style.width = width + 'px';
			_canvas.style.height = height + 'px';

		}

		this.setViewport( 0, 0, width, height );

	};

	this.setViewport = function ( x, y, width, height ) {

		_viewportX = x * this.devicePixelRatio;
		_viewportY = y * this.devicePixelRatio;

		_viewportWidth = width * this.devicePixelRatio;
		_viewportHeight = height * this.devicePixelRatio;

		_gl.viewport( _viewportX, _viewportY, _viewportWidth, _viewportHeight );

	};

	this.setScissor = function ( x, y, width, height ) {

		_gl.scissor(
			x * this.devicePixelRatio,
			y * this.devicePixelRatio,
			width * this.devicePixelRatio,
			height * this.devicePixelRatio
		);

	};

	this.enableScissorTest = function ( enable ) {

		enable ? _gl.enable( _gl.SCISSOR_TEST ) : _gl.disable( _gl.SCISSOR_TEST );

	};

	// Clearing

	this.setClearColor = function ( color, alpha ) {

		_clearColor.set( color );
		_clearAlpha = alpha !== undefined ? alpha : 1;

		_gl.clearColor( _clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha );

	};

	this.setClearColorHex = function ( hex, alpha ) {

		console.warn( 'THREE.WebGLRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.' );
		this.setClearColor( hex, alpha );

	};

	this.getClearColor = function () {

		return _clearColor;

	};

	this.getClearAlpha = function () {

		return _clearAlpha;

	};

	this.clear = function ( color, depth, stencil ) {

		var bits = 0;

		if ( color === undefined || color ) bits |= _gl.COLOR_BUFFER_BIT;
		if ( depth === undefined || depth ) bits |= _gl.DEPTH_BUFFER_BIT;
		if ( stencil === undefined || stencil ) bits |= _gl.STENCIL_BUFFER_BIT;

		_gl.clear( bits );

	};

	this.clearColor = function () {

		_gl.clear( _gl.COLOR_BUFFER_BIT );

	};

	this.clearDepth = function () {

		_gl.clear( _gl.DEPTH_BUFFER_BIT );

	};

	this.clearStencil = function () {

		_gl.clear( _gl.STENCIL_BUFFER_BIT );

	};

	this.clearTarget = function ( renderTarget, color, depth, stencil ) {

		this.setRenderTarget( renderTarget );
		this.clear( color, depth, stencil );

	};

	// Reset

	this.resetGLState = function () {

		_currentProgram = null;
		_currentCamera = null;

		_oldBlending = - 1;
		_oldDepthTest = - 1;
		_oldDepthWrite = - 1;
		_oldDoubleSided = - 1;
		_oldFlipSided = - 1;
		_currentGeometryGroupHash = - 1;
		_currentMaterialId = - 1;

		_lightsNeedUpdate = true;

	};

	// Buffer allocation

	function createParticleBuffers ( geometry ) {

		geometry.__webglVertexBuffer = _gl.createBuffer();
		geometry.__webglColorBuffer = _gl.createBuffer();

		_this.info.memory.geometries ++;

	};

	function createLineBuffers ( geometry ) {

		geometry.__webglVertexBuffer = _gl.createBuffer();
		geometry.__webglColorBuffer = _gl.createBuffer();
		geometry.__webglLineDistanceBuffer = _gl.createBuffer();

		_this.info.memory.geometries ++;

	};

	function createMeshBuffers ( geometryGroup ) {

		geometryGroup.__webglVertexBuffer = _gl.createBuffer();
		geometryGroup.__webglNormalBuffer = _gl.createBuffer();
		geometryGroup.__webglTangentBuffer = _gl.createBuffer();
		geometryGroup.__webglColorBuffer = _gl.createBuffer();
		geometryGroup.__webglUVBuffer = _gl.createBuffer();
		geometryGroup.__webglUV2Buffer = _gl.createBuffer();

		geometryGroup.__webglSkinIndicesBuffer = _gl.createBuffer();
		geometryGroup.__webglSkinWeightsBuffer = _gl.createBuffer();

		geometryGroup.__webglFaceBuffer = _gl.createBuffer();
		geometryGroup.__webglLineBuffer = _gl.createBuffer();

		var m, ml;

		if ( geometryGroup.numMorphTargets ) {

			geometryGroup.__webglMorphTargetsBuffers = [];

			for ( m = 0, ml = geometryGroup.numMorphTargets; m < ml; m ++ ) {

				geometryGroup.__webglMorphTargetsBuffers.push( _gl.createBuffer() );

			}

		}

		if ( geometryGroup.numMorphNormals ) {

			geometryGroup.__webglMorphNormalsBuffers = [];

			for ( m = 0, ml = geometryGroup.numMorphNormals; m < ml; m ++ ) {

				geometryGroup.__webglMorphNormalsBuffers.push( _gl.createBuffer() );

			}

		}

		_this.info.memory.geometries ++;

	};

	// Events

	var onObjectRemoved = function ( event ) {

		var object = event.target;

		object.traverse( function ( child ) {

			child.removeEventListener( 'remove', onObjectRemoved );

			removeObject( child );

		} );

	};

	var onGeometryDispose = function ( event ) {

		var geometry = event.target;

		geometry.removeEventListener( 'dispose', onGeometryDispose );

		deallocateGeometry( geometry );

	};

	var onTextureDispose = function ( event ) {

		var texture = event.target;

		texture.removeEventListener( 'dispose', onTextureDispose );

		deallocateTexture( texture );

		_this.info.memory.textures --;


	};

	var onRenderTargetDispose = function ( event ) {

		var renderTarget = event.target;

		renderTarget.removeEventListener( 'dispose', onRenderTargetDispose );

		deallocateRenderTarget( renderTarget );

		_this.info.memory.textures --;

	};

	var onMaterialDispose = function ( event ) {

		var material = event.target;

		material.removeEventListener( 'dispose', onMaterialDispose );

		deallocateMaterial( material );

	};

	// Buffer deallocation

	var deleteBuffers = function ( geometry ) {
	
		var buffers = [
			'__webglVertexBuffer',
			'__webglNormalBuffer',
			'__webglTangentBuffer',
			'__webglColorBuffer',
			'__webglUVBuffer',
			'__webglUV2Buffer',
			
			'__webglSkinIndicesBuffer',
			'__webglSkinWeightsBuffer',
			
			'__webglFaceBuffer',
			'__webglLineBuffer',
			
			'__webglLineDistanceBuffer'
		];

		for ( var i = 0, l = buffers.length; i < l; i ++ ) {

			var name = buffers[ i ];

			if ( geometry[ name ] !== undefined ) {

				_gl.deleteBuffer( geometry[ name ] );

				delete geometry[ name ];

			}

		}

		// custom attributes

		if ( geometry.__webglCustomAttributesList !== undefined ) {

			for ( var name in geometry.__webglCustomAttributesList ) {

				_gl.deleteBuffer( geometry.__webglCustomAttributesList[ name ].buffer );

			}

			delete geometry.__webglCustomAttributesList;

		}

		_this.info.memory.geometries --;

	};

	var deallocateGeometry = function ( geometry ) {

		delete geometry.__webglInit;

		if ( geometry instanceof THREE.BufferGeometry ) {

			for ( var name in geometry.attributes ) {
			
				var attribute = geometry.attributes[ name ];

				if ( attribute.buffer !== undefined ) {

					_gl.deleteBuffer( attribute.buffer );

					delete attribute.buffer;

				}

			}

			_this.info.memory.geometries --;

		} else {

			var geometryGroupsList = geometryGroups[ geometry.id ];

			if ( geometryGroupsList !== undefined ) {

				for ( var i = 0,l = geometryGroupsList.length; i < l; i ++ ) {

					var geometryGroup = geometryGroupsList[ i ];

					if ( geometryGroup.numMorphTargets !== undefined ) {

						for ( var m = 0, ml = geometryGroup.numMorphTargets; m < ml; m ++ ) {

							_gl.deleteBuffer( geometryGroup.__webglMorphTargetsBuffers[ m ] );

						}

						delete geometryGroup.__webglMorphTargetsBuffers;

					}

					if ( geometryGroup.numMorphNormals !== undefined ) {

						for ( var m = 0, ml = geometryGroup.numMorphNormals; m < ml; m ++ ) {

							_gl.deleteBuffer( geometryGroup.__webglMorphNormalsBuffers[ m ] );

						}

						delete geometryGroup.__webglMorphNormalsBuffers;

					}

					deleteBuffers( geometryGroup );

				}

				delete geometryGroups[ geometry.id ];

			} else {

				deleteBuffers( geometry );

			}

		}

		// TOFIX: Workaround for deleted geometry being currently bound

		_currentGeometryGroupHash = - 1;

	};

	var deallocateTexture = function ( texture ) {

		if ( texture.image && texture.image.__webglTextureCube ) {

			// cube texture

			_gl.deleteTexture( texture.image.__webglTextureCube );

			delete texture.image.__webglTextureCube;

		} else {

			// 2D texture

			if ( texture.__webglInit === undefined ) return;

			_gl.deleteTexture( texture.__webglTexture );

			delete texture.__webglTexture;
			delete texture.__webglInit;

		}

	};

	var deallocateRenderTarget = function ( renderTarget ) {

		if ( ! renderTarget || renderTarget.__webglTexture === undefined ) return;

		_gl.deleteTexture( renderTarget.__webglTexture );

		delete renderTarget.__webglTexture;

		if ( renderTarget instanceof THREE.WebGLRenderTargetCube ) {

			for ( var i = 0; i < 6; i ++ ) {

				_gl.deleteFramebuffer( renderTarget.__webglFramebuffer[ i ] );
				_gl.deleteRenderbuffer( renderTarget.__webglRenderbuffer[ i ] );

			}

		} else {

			_gl.deleteFramebuffer( renderTarget.__webglFramebuffer );
			_gl.deleteRenderbuffer( renderTarget.__webglRenderbuffer );

		}

		delete renderTarget.__webglFramebuffer;
		delete renderTarget.__webglRenderbuffer;

	};

	var deallocateMaterial = function ( material ) {

		var program = material.program.program;

		if ( program === undefined ) return;

		material.program = undefined;

		// only deallocate GL program if this was the last use of shared program
		// assumed there is only single copy of any program in the _programs list
		// (that's how it's constructed)

		var i, il, programInfo;
		var deleteProgram = false;

		for ( i = 0, il = _programs.length; i < il; i ++ ) {

			programInfo = _programs[ i ];

			if ( programInfo.program === program ) {

				programInfo.usedTimes --;

				if ( programInfo.usedTimes === 0 ) {

					deleteProgram = true;

				}

				break;

			}

		}

		if ( deleteProgram === true ) {

			// avoid using array.splice, this is costlier than creating new array from scratch

			var newPrograms = [];

			for ( i = 0, il = _programs.length; i < il; i ++ ) {

				programInfo = _programs[ i ];

				if ( programInfo.program !== program ) {

					newPrograms.push( programInfo );

				}

			}

			_programs = newPrograms;

			_gl.deleteProgram( program );

			_this.info.memory.programs --;

		}

	};

	// Buffer initialization

	function initCustomAttributes ( object ) {

		var geometry = object.geometry;
		var material = object.material;

		var nvertices = geometry.vertices.length;

		if ( material.attributes ) {

			if ( geometry.__webglCustomAttributesList === undefined ) {

				geometry.__webglCustomAttributesList = [];

			}

			for ( var name in material.attributes ) {

				var attribute = material.attributes[ name ];

				if ( ! attribute.__webglInitialized || attribute.createUniqueBuffers ) {

					attribute.__webglInitialized = true;

					var size = 1;   // "f" and "i"

					if ( attribute.type === 'v2' ) size = 2;
					else if ( attribute.type === 'v3' ) size = 3;
					else if ( attribute.type === 'v4' ) size = 4;
					else if ( attribute.type === 'c'  ) size = 3;

					attribute.size = size;

					attribute.array = new Float32Array( nvertices * size );

					attribute.buffer = _gl.createBuffer();
					attribute.buffer.belongsToAttribute = name;

					attribute.needsUpdate = true;

				}

				geometry.__webglCustomAttributesList.push( attribute );

			}

		}

	};

	function initParticleBuffers ( geometry, object ) {

		var nvertices = geometry.vertices.length;

		geometry.__vertexArray = new Float32Array( nvertices * 3 );
		geometry.__colorArray = new Float32Array( nvertices * 3 );

		geometry.__sortArray = [];

		geometry.__webglParticleCount = nvertices;

		initCustomAttributes( object );

	};

	function initLineBuffers ( geometry, object ) {

		var nvertices = geometry.vertices.length;

		geometry.__vertexArray = new Float32Array( nvertices * 3 );
		geometry.__colorArray = new Float32Array( nvertices * 3 );
		geometry.__lineDistanceArray = new Float32Array( nvertices * 1 );

		geometry.__webglLineCount = nvertices;

		initCustomAttributes( object );

	};

	function initMeshBuffers ( geometryGroup, object ) {

		var geometry = object.geometry,
			faces3 = geometryGroup.faces3,

			nvertices = faces3.length * 3,
			ntris     = faces3.length * 1,
			nlines    = faces3.length * 3,

			material = getBufferMaterial( object, geometryGroup );

		geometryGroup.__vertexArray = new Float32Array( nvertices * 3 );
		geometryGroup.__normalArray = new Float32Array( nvertices * 3 );
		geometryGroup.__colorArray = new Float32Array( nvertices * 3 );
		geometryGroup.__uvArray = new Float32Array( nvertices * 2 );

		if ( geometry.faceVertexUvs.length > 1 ) {

			geometryGroup.__uv2Array = new Float32Array( nvertices * 2 );

		}

		if ( geometry.hasTangents ) {

			geometryGroup.__tangentArray = new Float32Array( nvertices * 4 );

		}

		if ( object.geometry.skinWeights.length && object.geometry.skinIndices.length ) {

			geometryGroup.__skinIndexArray = new Float32Array( nvertices * 4 );
			geometryGroup.__skinWeightArray = new Float32Array( nvertices * 4 );

		}

		var UintArray = extensions.get( 'OES_element_index_uint' ) !== null && ntris > 21845 ? Uint32Array : Uint16Array; // 65535 / 3

		geometryGroup.__typeArray = UintArray;
		geometryGroup.__faceArray = new UintArray( ntris * 3 );
		geometryGroup.__lineArray = new UintArray( nlines * 2 );

		var m, ml;

		if ( geometryGroup.numMorphTargets ) {

			geometryGroup.__morphTargetsArrays = [];

			for ( m = 0, ml = geometryGroup.numMorphTargets; m < ml; m ++ ) {

				geometryGroup.__morphTargetsArrays.push( new Float32Array( nvertices * 3 ) );

			}

		}

		if ( geometryGroup.numMorphNormals ) {

			geometryGroup.__morphNormalsArrays = [];

			for ( m = 0, ml = geometryGroup.numMorphNormals; m < ml; m ++ ) {

				geometryGroup.__morphNormalsArrays.push( new Float32Array( nvertices * 3 ) );

			}

		}

		geometryGroup.__webglFaceCount = ntris * 3;
		geometryGroup.__webglLineCount = nlines * 2;


		// custom attributes

		if ( material.attributes ) {

			if ( geometryGroup.__webglCustomAttributesList === undefined ) {

				geometryGroup.__webglCustomAttributesList = [];

			}

			for ( var name in material.attributes ) {

				// Do a shallow copy of the attribute object so different geometryGroup chunks use different
				// attribute buffers which are correctly indexed in the setMeshBuffers function

				var originalAttribute = material.attributes[ name ];

				var attribute = {};

				for ( var property in originalAttribute ) {

					attribute[ property ] = originalAttribute[ property ];

				}

				if ( ! attribute.__webglInitialized || attribute.createUniqueBuffers ) {

					attribute.__webglInitialized = true;

					var size = 1;   // "f" and "i"

					if ( attribute.type === 'v2' ) size = 2;
					else if ( attribute.type === 'v3' ) size = 3;
					else if ( attribute.type === 'v4' ) size = 4;
					else if ( attribute.type === 'c'  ) size = 3;

					attribute.size = size;

					attribute.array = new Float32Array( nvertices * size );

					attribute.buffer = _gl.createBuffer();
					attribute.buffer.belongsToAttribute = name;

					originalAttribute.needsUpdate = true;
					attribute.__original = originalAttribute;

				}

				geometryGroup.__webglCustomAttributesList.push( attribute );

			}

		}

		geometryGroup.__inittedArrays = true;

	};

	function getBufferMaterial( object, geometryGroup ) {

		return object.material instanceof THREE.MeshFaceMaterial
			 ? object.material.materials[ geometryGroup.materialIndex ]
			 : object.material;

	};

	function materialNeedsSmoothNormals ( material ) {

		return material && material.shading !== undefined && material.shading === THREE.SmoothShading;

	};

	// Buffer setting

	function setParticleBuffers ( geometry, hint, object ) {

		var v, c, vertex, offset, index, color,

		vertices = geometry.vertices,
		vl = vertices.length,

		colors = geometry.colors,
		cl = colors.length,

		vertexArray = geometry.__vertexArray,
		colorArray = geometry.__colorArray,

		sortArray = geometry.__sortArray,

		dirtyVertices = geometry.verticesNeedUpdate,
		dirtyElements = geometry.elementsNeedUpdate,
		dirtyColors = geometry.colorsNeedUpdate,

		customAttributes = geometry.__webglCustomAttributesList,
		i, il,
		a, ca, cal, value,
		customAttribute;

		if ( object.sortParticles ) {

			_projScreenMatrixPS.copy( _projScreenMatrix );
			_projScreenMatrixPS.multiply( object.matrixWorld );

			for ( v = 0; v < vl; v ++ ) {

				vertex = vertices[ v ];

				_vector3.copy( vertex );
				_vector3.applyProjection( _projScreenMatrixPS );

				sortArray[ v ] = [ _vector3.z, v ];

			}

			sortArray.sort( numericalSort );

			for ( v = 0; v < vl; v ++ ) {

				vertex = vertices[ sortArray[ v ][ 1 ] ];

				offset = v * 3;

				vertexArray[ offset ]     = vertex.x;
				vertexArray[ offset + 1 ] = vertex.y;
				vertexArray[ offset + 2 ] = vertex.z;

			}

			for ( c = 0; c < cl; c ++ ) {

				offset = c * 3;

				color = colors[ sortArray[ c ][ 1 ] ];

				colorArray[ offset ]     = color.r;
				colorArray[ offset + 1 ] = color.g;
				colorArray[ offset + 2 ] = color.b;

			}

			if ( customAttributes ) {

				for ( i = 0, il = customAttributes.length; i < il; i ++ ) {

					customAttribute = customAttributes[ i ];

					if ( ! ( customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices' ) ) continue;

					offset = 0;

					cal = customAttribute.value.length;

					if ( customAttribute.size === 1 ) {

						for ( ca = 0; ca < cal; ca ++ ) {

							index = sortArray[ ca ][ 1 ];

							customAttribute.array[ ca ] = customAttribute.value[ index ];

						}

					} else if ( customAttribute.size === 2 ) {

						for ( ca = 0; ca < cal; ca ++ ) {

							index = sortArray[ ca ][ 1 ];

							value = customAttribute.value[ index ];

							customAttribute.array[ offset ]   = value.x;
							customAttribute.array[ offset + 1 ] = value.y;

							offset += 2;

						}

					} else if ( customAttribute.size === 3 ) {

						if ( customAttribute.type === 'c' ) {

							for ( ca = 0; ca < cal; ca ++ ) {

								index = sortArray[ ca ][ 1 ];

								value = customAttribute.value[ index ];

								customAttribute.array[ offset ]     = value.r;
								customAttribute.array[ offset + 1 ] = value.g;
								customAttribute.array[ offset + 2 ] = value.b;

								offset += 3;

							}

						} else {

							for ( ca = 0; ca < cal; ca ++ ) {

								index = sortArray[ ca ][ 1 ];

								value = customAttribute.value[ index ];

								customAttribute.array[ offset ]   = value.x;
								customAttribute.array[ offset + 1 ] = value.y;
								customAttribute.array[ offset + 2 ] = value.z;

								offset += 3;

							}

						}

					} else if ( customAttribute.size === 4 ) {

						for ( ca = 0; ca < cal; ca ++ ) {

							index = sortArray[ ca ][ 1 ];

							value = customAttribute.value[ index ];

							customAttribute.array[ offset ]      = value.x;
							customAttribute.array[ offset + 1  ] = value.y;
							customAttribute.array[ offset + 2  ] = value.z;
							customAttribute.array[ offset + 3  ] = value.w;

							offset += 4;

						}

					}

				}

			}

		} else {

			if ( dirtyVertices ) {

				for ( v = 0; v < vl; v ++ ) {

					vertex = vertices[ v ];

					offset = v * 3;

					vertexArray[ offset ]     = vertex.x;
					vertexArray[ offset + 1 ] = vertex.y;
					vertexArray[ offset + 2 ] = vertex.z;

				}

			}

			if ( dirtyColors ) {

				for ( c = 0; c < cl; c ++ ) {

					color = colors[ c ];

					offset = c * 3;

					colorArray[ offset ]     = color.r;
					colorArray[ offset + 1 ] = color.g;
					colorArray[ offset + 2 ] = color.b;

				}

			}

			if ( customAttributes ) {

				for ( i = 0, il = customAttributes.length; i < il; i ++ ) {

					customAttribute = customAttributes[ i ];

					if ( customAttribute.needsUpdate &&
						 ( customAttribute.boundTo === undefined ||
							 customAttribute.boundTo === 'vertices' ) ) {

						cal = customAttribute.value.length;

						offset = 0;

						if ( customAttribute.size === 1 ) {

							for ( ca = 0; ca < cal; ca ++ ) {

								customAttribute.array[ ca ] = customAttribute.value[ ca ];

							}

						} else if ( customAttribute.size === 2 ) {

							for ( ca = 0; ca < cal; ca ++ ) {

								value = customAttribute.value[ ca ];

								customAttribute.array[ offset ]   = value.x;
								customAttribute.array[ offset + 1 ] = value.y;

								offset += 2;

							}

						} else if ( customAttribute.size === 3 ) {

							if ( customAttribute.type === 'c' ) {

								for ( ca = 0; ca < cal; ca ++ ) {

									value = customAttribute.value[ ca ];

									customAttribute.array[ offset ]   = value.r;
									customAttribute.array[ offset + 1 ] = value.g;
									customAttribute.array[ offset + 2 ] = value.b;

									offset += 3;

								}

							} else {

								for ( ca = 0; ca < cal; ca ++ ) {

									value = customAttribute.value[ ca ];

									customAttribute.array[ offset ]   = value.x;
									customAttribute.array[ offset + 1 ] = value.y;
									customAttribute.array[ offset + 2 ] = value.z;

									offset += 3;

								}

							}

						} else if ( customAttribute.size === 4 ) {

							for ( ca = 0; ca < cal; ca ++ ) {

								value = customAttribute.value[ ca ];

								customAttribute.array[ offset ]      = value.x;
								customAttribute.array[ offset + 1  ] = value.y;
								customAttribute.array[ offset + 2  ] = value.z;
								customAttribute.array[ offset + 3  ] = value.w;

								offset += 4;

							}

						}

					}

				}

			}

		}

		if ( dirtyVertices || object.sortParticles ) {

			_gl.bindBuffer( _gl.ARRAY_BUFFER, geometry.__webglVertexBuffer );
			_gl.bufferData( _gl.ARRAY_BUFFER, vertexArray, hint );

		}

		if ( dirtyColors || object.sortParticles ) {

			_gl.bindBuffer( _gl.ARRAY_BUFFER, geometry.__webglColorBuffer );
			_gl.bufferData( _gl.ARRAY_BUFFER, colorArray, hint );

		}

		if ( customAttributes ) {

			for ( i = 0, il = customAttributes.length; i < il; i ++ ) {

				customAttribute = customAttributes[ i ];

				if ( customAttribute.needsUpdate || object.sortParticles ) {

					_gl.bindBuffer( _gl.ARRAY_BUFFER, customAttribute.buffer );
					_gl.bufferData( _gl.ARRAY_BUFFER, customAttribute.array, hint );

				}

			}

		}

	}

	function setLineBuffers ( geometry, hint ) {

		var v, c, d, vertex, offset, color,

		vertices = geometry.vertices,
		colors = geometry.colors,
		lineDistances = geometry.lineDistances,

		vl = vertices.length,
		cl = colors.length,
		dl = lineDistances.length,

		vertexArray = geometry.__vertexArray,
		colorArray = geometry.__colorArray,
		lineDistanceArray = geometry.__lineDistanceArray,

		dirtyVertices = geometry.verticesNeedUpdate,
		dirtyColors = geometry.colorsNeedUpdate,
		dirtyLineDistances = geometry.lineDistancesNeedUpdate,

		customAttributes = geometry.__webglCustomAttributesList,

		i, il,
		a, ca, cal, value,
		customAttribute;

		if ( dirtyVertices ) {

			for ( v = 0; v < vl; v ++ ) {

				vertex = vertices[ v ];

				offset = v * 3;

				vertexArray[ offset ]     = vertex.x;
				vertexArray[ offset + 1 ] = vertex.y;
				vertexArray[ offset + 2 ] = vertex.z;

			}

			_gl.bindBuffer( _gl.ARRAY_BUFFER, geometry.__webglVertexBuffer );
			_gl.bufferData( _gl.ARRAY_BUFFER, vertexArray, hint );

		}

		if ( dirtyColors ) {

			for ( c = 0; c < cl; c ++ ) {

				color = colors[ c ];

				offset = c * 3;

				colorArray[ offset ]     = color.r;
				colorArray[ offset + 1 ] = color.g;
				colorArray[ offset + 2 ] = color.b;

			}

			_gl.bindBuffer( _gl.ARRAY_BUFFER, geometry.__webglColorBuffer );
			_gl.bufferData( _gl.ARRAY_BUFFER, colorArray, hint );

		}

		if ( dirtyLineDistances ) {

			for ( d = 0; d < dl; d ++ ) {

				lineDistanceArray[ d ] = lineDistances[ d ];

			}

			_gl.bindBuffer( _gl.ARRAY_BUFFER, geometry.__webglLineDistanceBuffer );
			_gl.bufferData( _gl.ARRAY_BUFFER, lineDistanceArray, hint );

		}

		if ( customAttributes ) {

			for ( i = 0, il = customAttributes.length; i < il; i ++ ) {

				customAttribute = customAttributes[ i ];

				if ( customAttribute.needsUpdate &&
					 ( customAttribute.boundTo === undefined ||
						 customAttribute.boundTo === 'vertices' ) ) {

					offset = 0;

					cal = customAttribute.value.length;

					if ( customAttribute.size === 1 ) {

						for ( ca = 0; ca < cal; ca ++ ) {

							customAttribute.array[ ca ] = customAttribute.value[ ca ];

						}

					} else if ( customAttribute.size === 2 ) {

						for ( ca = 0; ca < cal; ca ++ ) {

							value = customAttribute.value[ ca ];

							customAttribute.array[ offset ]   = value.x;
							customAttribute.array[ offset + 1 ] = value.y;

							offset += 2;

						}

					} else if ( customAttribute.size === 3 ) {

						if ( customAttribute.type === 'c' ) {

							for ( ca = 0; ca < cal; ca ++ ) {

								value = customAttribute.value[ ca ];

								customAttribute.array[ offset ]   = value.r;
								customAttribute.array[ offset + 1 ] = value.g;
								customAttribute.array[ offset + 2 ] = value.b;

								offset += 3;

							}

						} else {

							for ( ca = 0; ca < cal; ca ++ ) {

								value = customAttribute.value[ ca ];

								customAttribute.array[ offset ]   = value.x;
								customAttribute.array[ offset + 1 ] = value.y;
								customAttribute.array[ offset + 2 ] = value.z;

								offset += 3;

							}

						}

					} else if ( customAttribute.size === 4 ) {

						for ( ca = 0; ca < cal; ca ++ ) {

							value = customAttribute.value[ ca ];

							customAttribute.array[ offset ]    = value.x;
							customAttribute.array[ offset + 1  ] = value.y;
							customAttribute.array[ offset + 2  ] = value.z;
							customAttribute.array[ offset + 3  ] = value.w;

							offset += 4;

						}

					}

					_gl.bindBuffer( _gl.ARRAY_BUFFER, customAttribute.buffer );
					_gl.bufferData( _gl.ARRAY_BUFFER, customAttribute.array, hint );

				}

			}

		}

	}

	function setMeshBuffers( geometryGroup, object, hint, dispose, material ) {

		if ( ! geometryGroup.__inittedArrays ) {

			return;

		}

		var needsSmoothNormals = materialNeedsSmoothNormals( material );

		var f, fl, fi, face,
		vertexNormals, faceNormal, normal,
		vertexColors, faceColor,
		vertexTangents,
		uv, uv2, v1, v2, v3, v4, t1, t2, t3, t4, n1, n2, n3, n4,
		c1, c2, c3,
		sw1, sw2, sw3, sw4,
		si1, si2, si3, si4,
		sa1, sa2, sa3, sa4,
		sb1, sb2, sb3, sb4,
		m, ml, i, il,
		vn, uvi, uv2i,
		vk, vkl, vka,
		nka, chf, faceVertexNormals,
		a,

		vertexIndex = 0,

		offset = 0,
		offset_uv = 0,
		offset_uv2 = 0,
		offset_face = 0,
		offset_normal = 0,
		offset_tangent = 0,
		offset_line = 0,
		offset_color = 0,
		offset_skin = 0,
		offset_morphTarget = 0,
		offset_custom = 0,
		offset_customSrc = 0,

		value,

		vertexArray = geometryGroup.__vertexArray,
		uvArray = geometryGroup.__uvArray,
		uv2Array = geometryGroup.__uv2Array,
		normalArray = geometryGroup.__normalArray,
		tangentArray = geometryGroup.__tangentArray,
		colorArray = geometryGroup.__colorArray,

		skinIndexArray = geometryGroup.__skinIndexArray,
		skinWeightArray = geometryGroup.__skinWeightArray,

		morphTargetsArrays = geometryGroup.__morphTargetsArrays,
		morphNormalsArrays = geometryGroup.__morphNormalsArrays,

		customAttributes = geometryGroup.__webglCustomAttributesList,
		customAttribute,

		faceArray = geometryGroup.__faceArray,
		lineArray = geometryGroup.__lineArray,

		geometry = object.geometry, // this is shared for all chunks

		dirtyVertices = geometry.verticesNeedUpdate,
		dirtyElements = geometry.elementsNeedUpdate,
		dirtyUvs = geometry.uvsNeedUpdate,
		dirtyNormals = geometry.normalsNeedUpdate,
		dirtyTangents = geometry.tangentsNeedUpdate,
		dirtyColors = geometry.colorsNeedUpdate,
		dirtyMorphTargets = geometry.morphTargetsNeedUpdate,

		vertices = geometry.vertices,
		chunk_faces3 = geometryGroup.faces3,
		obj_faces = geometry.faces,

		obj_uvs  = geometry.faceVertexUvs[ 0 ],
		obj_uvs2 = geometry.faceVertexUvs[ 1 ],

		obj_colors = geometry.colors,

		obj_skinIndices = geometry.skinIndices,
		obj_skinWeights = geometry.skinWeights,

		morphTargets = geometry.morphTargets,
		morphNormals = geometry.morphNormals;

		if ( dirtyVertices ) {

			for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

				face = obj_faces[ chunk_faces3[ f ] ];

				v1 = vertices[ face.a ];
				v2 = vertices[ face.b ];
				v3 = vertices[ face.c ];

				vertexArray[ offset ]     = v1.x;
				vertexArray[ offset + 1 ] = v1.y;
				vertexArray[ offset + 2 ] = v1.z;

				vertexArray[ offset + 3 ] = v2.x;
				vertexArray[ offset + 4 ] = v2.y;
				vertexArray[ offset + 5 ] = v2.z;

				vertexArray[ offset + 6 ] = v3.x;
				vertexArray[ offset + 7 ] = v3.y;
				vertexArray[ offset + 8 ] = v3.z;

				offset += 9;

			}

			_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglVertexBuffer );
			_gl.bufferData( _gl.ARRAY_BUFFER, vertexArray, hint );

		}

		if ( dirtyMorphTargets ) {

			for ( vk = 0, vkl = morphTargets.length; vk < vkl; vk ++ ) {

				offset_morphTarget = 0;

				for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

					chf = chunk_faces3[ f ];
					face = obj_faces[ chf ];

					// morph positions

					v1 = morphTargets[ vk ].vertices[ face.a ];
					v2 = morphTargets[ vk ].vertices[ face.b ];
					v3 = morphTargets[ vk ].vertices[ face.c ];

					vka = morphTargetsArrays[ vk ];

					vka[ offset_morphTarget ]     = v1.x;
					vka[ offset_morphTarget + 1 ] = v1.y;
					vka[ offset_morphTarget + 2 ] = v1.z;

					vka[ offset_morphTarget + 3 ] = v2.x;
					vka[ offset_morphTarget + 4 ] = v2.y;
					vka[ offset_morphTarget + 5 ] = v2.z;

					vka[ offset_morphTarget + 6 ] = v3.x;
					vka[ offset_morphTarget + 7 ] = v3.y;
					vka[ offset_morphTarget + 8 ] = v3.z;

					// morph normals

					if ( material.morphNormals ) {

						if ( needsSmoothNormals ) {

							faceVertexNormals = morphNormals[ vk ].vertexNormals[ chf ];

							n1 = faceVertexNormals.a;
							n2 = faceVertexNormals.b;
							n3 = faceVertexNormals.c;

						} else {

							n1 = morphNormals[ vk ].faceNormals[ chf ];
							n2 = n1;
							n3 = n1;

						}

						nka = morphNormalsArrays[ vk ];

						nka[ offset_morphTarget ]     = n1.x;
						nka[ offset_morphTarget + 1 ] = n1.y;
						nka[ offset_morphTarget + 2 ] = n1.z;

						nka[ offset_morphTarget + 3 ] = n2.x;
						nka[ offset_morphTarget + 4 ] = n2.y;
						nka[ offset_morphTarget + 5 ] = n2.z;

						nka[ offset_morphTarget + 6 ] = n3.x;
						nka[ offset_morphTarget + 7 ] = n3.y;
						nka[ offset_morphTarget + 8 ] = n3.z;

					}

					//

					offset_morphTarget += 9;

				}

				_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[ vk ] );
				_gl.bufferData( _gl.ARRAY_BUFFER, morphTargetsArrays[ vk ], hint );

				if ( material.morphNormals ) {

					_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglMorphNormalsBuffers[ vk ] );
					_gl.bufferData( _gl.ARRAY_BUFFER, morphNormalsArrays[ vk ], hint );

				}

			}

		}

		if ( obj_skinWeights.length ) {

			for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

				face = obj_faces[ chunk_faces3[ f ] ];

				// weights

				sw1 = obj_skinWeights[ face.a ];
				sw2 = obj_skinWeights[ face.b ];
				sw3 = obj_skinWeights[ face.c ];

				skinWeightArray[ offset_skin ]     = sw1.x;
				skinWeightArray[ offset_skin + 1 ] = sw1.y;
				skinWeightArray[ offset_skin + 2 ] = sw1.z;
				skinWeightArray[ offset_skin + 3 ] = sw1.w;

				skinWeightArray[ offset_skin + 4 ] = sw2.x;
				skinWeightArray[ offset_skin + 5 ] = sw2.y;
				skinWeightArray[ offset_skin + 6 ] = sw2.z;
				skinWeightArray[ offset_skin + 7 ] = sw2.w;

				skinWeightArray[ offset_skin + 8 ]  = sw3.x;
				skinWeightArray[ offset_skin + 9 ]  = sw3.y;
				skinWeightArray[ offset_skin + 10 ] = sw3.z;
				skinWeightArray[ offset_skin + 11 ] = sw3.w;

				// indices

				si1 = obj_skinIndices[ face.a ];
				si2 = obj_skinIndices[ face.b ];
				si3 = obj_skinIndices[ face.c ];

				skinIndexArray[ offset_skin ]     = si1.x;
				skinIndexArray[ offset_skin + 1 ] = si1.y;
				skinIndexArray[ offset_skin + 2 ] = si1.z;
				skinIndexArray[ offset_skin + 3 ] = si1.w;

				skinIndexArray[ offset_skin + 4 ] = si2.x;
				skinIndexArray[ offset_skin + 5 ] = si2.y;
				skinIndexArray[ offset_skin + 6 ] = si2.z;
				skinIndexArray[ offset_skin + 7 ] = si2.w;

				skinIndexArray[ offset_skin + 8 ]  = si3.x;
				skinIndexArray[ offset_skin + 9 ]  = si3.y;
				skinIndexArray[ offset_skin + 10 ] = si3.z;
				skinIndexArray[ offset_skin + 11 ] = si3.w;

				offset_skin += 12;

			}

			if ( offset_skin > 0 ) {

				_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglSkinIndicesBuffer );
				_gl.bufferData( _gl.ARRAY_BUFFER, skinIndexArray, hint );

				_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglSkinWeightsBuffer );
				_gl.bufferData( _gl.ARRAY_BUFFER, skinWeightArray, hint );

			}

		}

		if ( dirtyColors ) {

			for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

				face = obj_faces[ chunk_faces3[ f ] ];

				vertexColors = face.vertexColors;
				faceColor = face.color;

				if ( vertexColors.length === 3 && material.vertexColors === THREE.VertexColors ) {

					c1 = vertexColors[ 0 ];
					c2 = vertexColors[ 1 ];
					c3 = vertexColors[ 2 ];

				} else {

					c1 = faceColor;
					c2 = faceColor;
					c3 = faceColor;

				}

				colorArray[ offset_color ]     = c1.r;
				colorArray[ offset_color + 1 ] = c1.g;
				colorArray[ offset_color + 2 ] = c1.b;

				colorArray[ offset_color + 3 ] = c2.r;
				colorArray[ offset_color + 4 ] = c2.g;
				colorArray[ offset_color + 5 ] = c2.b;

				colorArray[ offset_color + 6 ] = c3.r;
				colorArray[ offset_color + 7 ] = c3.g;
				colorArray[ offset_color + 8 ] = c3.b;

				offset_color += 9;

			}

			if ( offset_color > 0 ) {

				_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglColorBuffer );
				_gl.bufferData( _gl.ARRAY_BUFFER, colorArray, hint );

			}

		}

		if ( dirtyTangents && geometry.hasTangents ) {

			for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

				face = obj_faces[ chunk_faces3[ f ] ];

				vertexTangents = face.vertexTangents;

				t1 = vertexTangents[ 0 ];
				t2 = vertexTangents[ 1 ];
				t3 = vertexTangents[ 2 ];

				tangentArray[ offset_tangent ]     = t1.x;
				tangentArray[ offset_tangent + 1 ] = t1.y;
				tangentArray[ offset_tangent + 2 ] = t1.z;
				tangentArray[ offset_tangent + 3 ] = t1.w;

				tangentArray[ offset_tangent + 4 ] = t2.x;
				tangentArray[ offset_tangent + 5 ] = t2.y;
				tangentArray[ offset_tangent + 6 ] = t2.z;
				tangentArray[ offset_tangent + 7 ] = t2.w;

				tangentArray[ offset_tangent + 8 ]  = t3.x;
				tangentArray[ offset_tangent + 9 ]  = t3.y;
				tangentArray[ offset_tangent + 10 ] = t3.z;
				tangentArray[ offset_tangent + 11 ] = t3.w;

				offset_tangent += 12;

			}

			_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglTangentBuffer );
			_gl.bufferData( _gl.ARRAY_BUFFER, tangentArray, hint );

		}

		if ( dirtyNormals ) {

			for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

				face = obj_faces[ chunk_faces3[ f ] ];

				vertexNormals = face.vertexNormals;
				faceNormal = face.normal;

				if ( vertexNormals.length === 3 && needsSmoothNormals ) {

					for ( i = 0; i < 3; i ++ ) {

						vn = vertexNormals[ i ];

						normalArray[ offset_normal ]     = vn.x;
						normalArray[ offset_normal + 1 ] = vn.y;
						normalArray[ offset_normal + 2 ] = vn.z;

						offset_normal += 3;

					}

				} else {

					for ( i = 0; i < 3; i ++ ) {

						normalArray[ offset_normal ]     = faceNormal.x;
						normalArray[ offset_normal + 1 ] = faceNormal.y;
						normalArray[ offset_normal + 2 ] = faceNormal.z;

						offset_normal += 3;

					}

				}

			}

			_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglNormalBuffer );
			_gl.bufferData( _gl.ARRAY_BUFFER, normalArray, hint );

		}

		if ( dirtyUvs && obj_uvs ) {

			for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

				fi = chunk_faces3[ f ];

				uv = obj_uvs[ fi ];

				if ( uv === undefined ) continue;

				for ( i = 0; i < 3; i ++ ) {

					uvi = uv[ i ];

					uvArray[ offset_uv ]     = uvi.x;
					uvArray[ offset_uv + 1 ] = uvi.y;

					offset_uv += 2;

				}

			}

			if ( offset_uv > 0 ) {

				_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglUVBuffer );
				_gl.bufferData( _gl.ARRAY_BUFFER, uvArray, hint );

			}

		}

		if ( dirtyUvs && obj_uvs2 ) {

			for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

				fi = chunk_faces3[ f ];

				uv2 = obj_uvs2[ fi ];

				if ( uv2 === undefined ) continue;

				for ( i = 0; i < 3; i ++ ) {

					uv2i = uv2[ i ];

					uv2Array[ offset_uv2 ]     = uv2i.x;
					uv2Array[ offset_uv2 + 1 ] = uv2i.y;

					offset_uv2 += 2;

				}

			}

			if ( offset_uv2 > 0 ) {

				_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglUV2Buffer );
				_gl.bufferData( _gl.ARRAY_BUFFER, uv2Array, hint );

			}

		}

		if ( dirtyElements ) {

			for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

				faceArray[ offset_face ]   = vertexIndex;
				faceArray[ offset_face + 1 ] = vertexIndex + 1;
				faceArray[ offset_face + 2 ] = vertexIndex + 2;

				offset_face += 3;

				lineArray[ offset_line ]     = vertexIndex;
				lineArray[ offset_line + 1 ] = vertexIndex + 1;

				lineArray[ offset_line + 2 ] = vertexIndex;
				lineArray[ offset_line + 3 ] = vertexIndex + 2;

				lineArray[ offset_line + 4 ] = vertexIndex + 1;
				lineArray[ offset_line + 5 ] = vertexIndex + 2;

				offset_line += 6;

				vertexIndex += 3;

			}

			_gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglFaceBuffer );
			_gl.bufferData( _gl.ELEMENT_ARRAY_BUFFER, faceArray, hint );

			_gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglLineBuffer );
			_gl.bufferData( _gl.ELEMENT_ARRAY_BUFFER, lineArray, hint );

		}

		if ( customAttributes ) {

			for ( i = 0, il = customAttributes.length; i < il; i ++ ) {

				customAttribute = customAttributes[ i ];

				if ( ! customAttribute.__original.needsUpdate ) continue;

				offset_custom = 0;
				offset_customSrc = 0;

				if ( customAttribute.size === 1 ) {

					if ( customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices' ) {

						for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

							face = obj_faces[ chunk_faces3[ f ] ];

							customAttribute.array[ offset_custom ]     = customAttribute.value[ face.a ];
							customAttribute.array[ offset_custom + 1 ] = customAttribute.value[ face.b ];
							customAttribute.array[ offset_custom + 2 ] = customAttribute.value[ face.c ];

							offset_custom += 3;

						}

					} else if ( customAttribute.boundTo === 'faces' ) {

						for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

							value = customAttribute.value[ chunk_faces3[ f ] ];

							customAttribute.array[ offset_custom ]     = value;
							customAttribute.array[ offset_custom + 1 ] = value;
							customAttribute.array[ offset_custom + 2 ] = value;

							offset_custom += 3;

						}

					}

				} else if ( customAttribute.size === 2 ) {

					if ( customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices' ) {

						for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

							face = obj_faces[ chunk_faces3[ f ] ];

							v1 = customAttribute.value[ face.a ];
							v2 = customAttribute.value[ face.b ];
							v3 = customAttribute.value[ face.c ];

							customAttribute.array[ offset_custom ]     = v1.x;
							customAttribute.array[ offset_custom + 1 ] = v1.y;

							customAttribute.array[ offset_custom + 2 ] = v2.x;
							customAttribute.array[ offset_custom + 3 ] = v2.y;

							customAttribute.array[ offset_custom + 4 ] = v3.x;
							customAttribute.array[ offset_custom + 5 ] = v3.y;

							offset_custom += 6;

						}

					} else if ( customAttribute.boundTo === 'faces' ) {

						for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

							value = customAttribute.value[ chunk_faces3[ f ] ];

							v1 = value;
							v2 = value;
							v3 = value;

							customAttribute.array[ offset_custom ]     = v1.x;
							customAttribute.array[ offset_custom + 1 ] = v1.y;

							customAttribute.array[ offset_custom + 2 ] = v2.x;
							customAttribute.array[ offset_custom + 3 ] = v2.y;

							customAttribute.array[ offset_custom + 4 ] = v3.x;
							customAttribute.array[ offset_custom + 5 ] = v3.y;

							offset_custom += 6;

						}

					}

				} else if ( customAttribute.size === 3 ) {

					var pp;

					if ( customAttribute.type === 'c' ) {

						pp = [ 'r', 'g', 'b' ];

					} else {

						pp = [ 'x', 'y', 'z' ];

					}

					if ( customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices' ) {

						for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

							face = obj_faces[ chunk_faces3[ f ] ];

							v1 = customAttribute.value[ face.a ];
							v2 = customAttribute.value[ face.b ];
							v3 = customAttribute.value[ face.c ];

							customAttribute.array[ offset_custom ]     = v1[ pp[ 0 ] ];
							customAttribute.array[ offset_custom + 1 ] = v1[ pp[ 1 ] ];
							customAttribute.array[ offset_custom + 2 ] = v1[ pp[ 2 ] ];

							customAttribute.array[ offset_custom + 3 ] = v2[ pp[ 0 ] ];
							customAttribute.array[ offset_custom + 4 ] = v2[ pp[ 1 ] ];
							customAttribute.array[ offset_custom + 5 ] = v2[ pp[ 2 ] ];

							customAttribute.array[ offset_custom + 6 ] = v3[ pp[ 0 ] ];
							customAttribute.array[ offset_custom + 7 ] = v3[ pp[ 1 ] ];
							customAttribute.array[ offset_custom + 8 ] = v3[ pp[ 2 ] ];

							offset_custom += 9;

						}

					} else if ( customAttribute.boundTo === 'faces' ) {

						for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

							value = customAttribute.value[ chunk_faces3[ f ] ];

							v1 = value;
							v2 = value;
							v3 = value;

							customAttribute.array[ offset_custom ]     = v1[ pp[ 0 ] ];
							customAttribute.array[ offset_custom + 1 ] = v1[ pp[ 1 ] ];
							customAttribute.array[ offset_custom + 2 ] = v1[ pp[ 2 ] ];

							customAttribute.array[ offset_custom + 3 ] = v2[ pp[ 0 ] ];
							customAttribute.array[ offset_custom + 4 ] = v2[ pp[ 1 ] ];
							customAttribute.array[ offset_custom + 5 ] = v2[ pp[ 2 ] ];

							customAttribute.array[ offset_custom + 6 ] = v3[ pp[ 0 ] ];
							customAttribute.array[ offset_custom + 7 ] = v3[ pp[ 1 ] ];
							customAttribute.array[ offset_custom + 8 ] = v3[ pp[ 2 ] ];

							offset_custom += 9;

						}

					} else if ( customAttribute.boundTo === 'faceVertices' ) {

						for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

							value = customAttribute.value[ chunk_faces3[ f ] ];

							v1 = value[ 0 ];
							v2 = value[ 1 ];
							v3 = value[ 2 ];

							customAttribute.array[ offset_custom ]     = v1[ pp[ 0 ] ];
							customAttribute.array[ offset_custom + 1 ] = v1[ pp[ 1 ] ];
							customAttribute.array[ offset_custom + 2 ] = v1[ pp[ 2 ] ];

							customAttribute.array[ offset_custom + 3 ] = v2[ pp[ 0 ] ];
							customAttribute.array[ offset_custom + 4 ] = v2[ pp[ 1 ] ];
							customAttribute.array[ offset_custom + 5 ] = v2[ pp[ 2 ] ];

							customAttribute.array[ offset_custom + 6 ] = v3[ pp[ 0 ] ];
							customAttribute.array[ offset_custom + 7 ] = v3[ pp[ 1 ] ];
							customAttribute.array[ offset_custom + 8 ] = v3[ pp[ 2 ] ];

							offset_custom += 9;

						}

					}

				} else if ( customAttribute.size === 4 ) {

					if ( customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices' ) {

						for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

							face = obj_faces[ chunk_faces3[ f ] ];

							v1 = customAttribute.value[ face.a ];
							v2 = customAttribute.value[ face.b ];
							v3 = customAttribute.value[ face.c ];

							customAttribute.array[ offset_custom  ]   = v1.x;
							customAttribute.array[ offset_custom + 1  ] = v1.y;
							customAttribute.array[ offset_custom + 2  ] = v1.z;
							customAttribute.array[ offset_custom + 3  ] = v1.w;

							customAttribute.array[ offset_custom + 4  ] = v2.x;
							customAttribute.array[ offset_custom + 5  ] = v2.y;
							customAttribute.array[ offset_custom + 6  ] = v2.z;
							customAttribute.array[ offset_custom + 7  ] = v2.w;

							customAttribute.array[ offset_custom + 8  ] = v3.x;
							customAttribute.array[ offset_custom + 9  ] = v3.y;
							customAttribute.array[ offset_custom + 10 ] = v3.z;
							customAttribute.array[ offset_custom + 11 ] = v3.w;

							offset_custom += 12;

						}

					} else if ( customAttribute.boundTo === 'faces' ) {

						for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

							value = customAttribute.value[ chunk_faces3[ f ] ];

							v1 = value;
							v2 = value;
							v3 = value;

							customAttribute.array[ offset_custom  ]   = v1.x;
							customAttribute.array[ offset_custom + 1  ] = v1.y;
							customAttribute.array[ offset_custom + 2  ] = v1.z;
							customAttribute.array[ offset_custom + 3  ] = v1.w;

							customAttribute.array[ offset_custom + 4  ] = v2.x;
							customAttribute.array[ offset_custom + 5  ] = v2.y;
							customAttribute.array[ offset_custom + 6  ] = v2.z;
							customAttribute.array[ offset_custom + 7  ] = v2.w;

							customAttribute.array[ offset_custom + 8  ] = v3.x;
							customAttribute.array[ offset_custom + 9  ] = v3.y;
							customAttribute.array[ offset_custom + 10 ] = v3.z;
							customAttribute.array[ offset_custom + 11 ] = v3.w;

							offset_custom += 12;

						}

					} else if ( customAttribute.boundTo === 'faceVertices' ) {

						for ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {

							value = customAttribute.value[ chunk_faces3[ f ] ];

							v1 = value[ 0 ];
							v2 = value[ 1 ];
							v3 = value[ 2 ];

							customAttribute.array[ offset_custom  ]   = v1.x;
							customAttribute.array[ offset_custom + 1  ] = v1.y;
							customAttribute.array[ offset_custom + 2  ] = v1.z;
							customAttribute.array[ offset_custom + 3  ] = v1.w;

							customAttribute.array[ offset_custom + 4  ] = v2.x;
							customAttribute.array[ offset_custom + 5  ] = v2.y;
							customAttribute.array[ offset_custom + 6  ] = v2.z;
							customAttribute.array[ offset_custom + 7  ] = v2.w;

							customAttribute.array[ offset_custom + 8  ] = v3.x;
							customAttribute.array[ offset_custom + 9  ] = v3.y;
							customAttribute.array[ offset_custom + 10 ] = v3.z;
							customAttribute.array[ offset_custom + 11 ] = v3.w;

							offset_custom += 12;

						}

					}

				}

				_gl.bindBuffer( _gl.ARRAY_BUFFER, customAttribute.buffer );
				_gl.bufferData( _gl.ARRAY_BUFFER, customAttribute.array, hint );

			}

		}

		if ( dispose ) {

			delete geometryGroup.__inittedArrays;
			delete geometryGroup.__colorArray;
			delete geometryGroup.__normalArray;
			delete geometryGroup.__tangentArray;
			delete geometryGroup.__uvArray;
			delete geometryGroup.__uv2Array;
			delete geometryGroup.__faceArray;
			delete geometryGroup.__vertexArray;
			delete geometryGroup.__lineArray;
			delete geometryGroup.__skinIndexArray;
			delete geometryGroup.__skinWeightArray;

		}

	};

	function setDirectBuffers( geometry ) {

		var attributes = geometry.attributes;
		var attributesKeys = geometry.attributesKeys;

		for ( var i = 0, l = attributesKeys.length; i < l; i ++ ) {

			var key = attributesKeys[ i ];
			var attribute = attributes[ key ];

			if ( attribute.buffer === undefined ) {

				attribute.buffer = _gl.createBuffer();
				attribute.needsUpdate = true;

			}

			if ( attribute.needsUpdate === true ) {

				var bufferType = ( key === 'index' ) ? _gl.ELEMENT_ARRAY_BUFFER : _gl.ARRAY_BUFFER;

				_gl.bindBuffer( bufferType, attribute.buffer );
				_gl.bufferData( bufferType, attribute.array, _gl.STATIC_DRAW );

				attribute.needsUpdate = false;

			}

		}

	}

	// Buffer rendering

	this.renderBufferImmediate = function ( object, program, material ) {

		initAttributes();

		if ( object.hasPositions && ! object.__webglVertexBuffer ) object.__webglVertexBuffer = _gl.createBuffer();
		if ( object.hasNormals && ! object.__webglNormalBuffer ) object.__webglNormalBuffer = _gl.createBuffer();
		if ( object.hasUvs && ! object.__webglUvBuffer ) object.__webglUvBuffer = _gl.createBuffer();
		if ( object.hasColors && ! object.__webglColorBuffer ) object.__webglColorBuffer = _gl.createBuffer();

		if ( object.hasPositions ) {

			_gl.bindBuffer( _gl.ARRAY_BUFFER, object.__webglVertexBuffer );
			_gl.bufferData( _gl.ARRAY_BUFFER, object.positionArray, _gl.DYNAMIC_DRAW );
			enableAttribute( program.attributes.position );
			_gl.vertexAttribPointer( program.attributes.position, 3, _gl.FLOAT, false, 0, 0 );

		}

		if ( object.hasNormals ) {

			_gl.bindBuffer( _gl.ARRAY_BUFFER, object.__webglNormalBuffer );

			if ( material.shading === THREE.FlatShading ) {

				var nx, ny, nz,
					nax, nbx, ncx, nay, nby, ncy, naz, nbz, ncz,
					normalArray,
					i, il = object.count * 3;

				for ( i = 0; i < il; i += 9 ) {

					normalArray = object.normalArray;

					nax  = normalArray[ i ];
					nay  = normalArray[ i + 1 ];
					naz  = normalArray[ i + 2 ];

					nbx  = normalArray[ i + 3 ];
					nby  = normalArray[ i + 4 ];
					nbz  = normalArray[ i + 5 ];

					ncx  = normalArray[ i + 6 ];
					ncy  = normalArray[ i + 7 ];
					ncz  = normalArray[ i + 8 ];

					nx = ( nax + nbx + ncx ) / 3;
					ny = ( nay + nby + ncy ) / 3;
					nz = ( naz + nbz + ncz ) / 3;

					normalArray[ i ]   = nx;
					normalArray[ i + 1 ] = ny;
					normalArray[ i + 2 ] = nz;

					normalArray[ i + 3 ] = nx;
					normalArray[ i + 4 ] = ny;
					normalArray[ i + 5 ] = nz;

					normalArray[ i + 6 ] = nx;
					normalArray[ i + 7 ] = ny;
					normalArray[ i + 8 ] = nz;

				}

			}

			_gl.bufferData( _gl.ARRAY_BUFFER, object.normalArray, _gl.DYNAMIC_DRAW );
			enableAttribute( program.attributes.normal );
			_gl.vertexAttribPointer( program.attributes.normal, 3, _gl.FLOAT, false, 0, 0 );

		}

		if ( object.hasUvs && material.map ) {

			_gl.bindBuffer( _gl.ARRAY_BUFFER, object.__webglUvBuffer );
			_gl.bufferData( _gl.ARRAY_BUFFER, object.uvArray, _gl.DYNAMIC_DRAW );
			enableAttribute( program.attributes.uv );
			_gl.vertexAttribPointer( program.attributes.uv, 2, _gl.FLOAT, false, 0, 0 );

		}

		if ( object.hasColors && material.vertexColors !== THREE.NoColors ) {

			_gl.bindBuffer( _gl.ARRAY_BUFFER, object.__webglColorBuffer );
			_gl.bufferData( _gl.ARRAY_BUFFER, object.colorArray, _gl.DYNAMIC_DRAW );
			enableAttribute( program.attributes.color );
			_gl.vertexAttribPointer( program.attributes.color, 3, _gl.FLOAT, false, 0, 0 );

		}

		disableUnusedAttributes();

		_gl.drawArrays( _gl.TRIANGLES, 0, object.count );

		object.count = 0;

	};

	function setupVertexAttributes( material, program, geometry, startIndex ) {

		var geometryAttributes = geometry.attributes;

		var programAttributes = program.attributes;
		var programAttributesKeys = program.attributesKeys;

		for ( var i = 0, l = programAttributesKeys.length; i < l; i ++ ) {

			var key = programAttributesKeys[ i ];
			var programAttribute = programAttributes[ key ];

			if ( programAttribute >= 0 ) {

				var geometryAttribute = geometryAttributes[ key ];

				if ( geometryAttribute !== undefined ) {

					var size = geometryAttribute.itemSize;

					_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryAttribute.buffer );

					enableAttribute( programAttribute );

					_gl.vertexAttribPointer( programAttribute, size, _gl.FLOAT, false, 0, startIndex * size * 4 ); // 4 bytes per Float32

				} else if ( material.defaultAttributeValues !== undefined ) {

					if ( material.defaultAttributeValues[ key ].length === 2 ) {

						_gl.vertexAttrib2fv( programAttribute, material.defaultAttributeValues[ key ] );

					} else if ( material.defaultAttributeValues[ key ].length === 3 ) {

						_gl.vertexAttrib3fv( programAttribute, material.defaultAttributeValues[ key ] );

					}

				}

			}

		}

		disableUnusedAttributes();

	}

	this.renderBufferDirect = function ( camera, lights, fog, material, geometry, object ) {

		if ( material.visible === false ) return;

		var program = setProgram( camera, lights, fog, material, object );

		var updateBuffers = false,
			wireframeBit = material.wireframe ? 1 : 0,
			geometryHash = ( geometry.id * 0xffffff ) + ( program.id * 2 ) + wireframeBit;

		if ( geometryHash !== _currentGeometryGroupHash ) {

			_currentGeometryGroupHash = geometryHash;
			updateBuffers = true;

		}

		if ( updateBuffers ) {

			initAttributes();

		}

		// render mesh

		if ( object instanceof THREE.Mesh ) {

			var mode = material.wireframe === true ? _gl.LINES : _gl.TRIANGLES;

			var index = geometry.attributes.index;

			if ( index ) {

				// indexed triangles

				var type, size;

				if ( index.array instanceof Uint32Array && extensions.get( 'OES_element_index_uint' ) ) {

					type = _gl.UNSIGNED_INT;
					size = 4;

				} else {

					type = _gl.UNSIGNED_SHORT;
					size = 2;

				}

				var offsets = geometry.offsets;

				if ( offsets.length === 0 ) {

					if ( updateBuffers ) {

						setupVertexAttributes( material, program, geometry, 0 );
						_gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, index.buffer );

					}

					_gl.drawElements( mode, index.array.length, type, 0 );

					_this.info.render.calls ++;
					_this.info.render.vertices += index.array.length; // not really true, here vertices can be shared
					_this.info.render.faces += index.array.length / 3;

				} else {

					// if there is more than 1 chunk
					// must set attribute pointers to use new offsets for each chunk
					// even if geometry and materials didn't change

					updateBuffers = true;

					for ( var i = 0, il = offsets.length; i < il; i ++ ) {

						var startIndex = offsets[ i ].index;

						if ( updateBuffers ) {

							setupVertexAttributes( material, program, geometry, startIndex );
							_gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, index.buffer );

						}

						// render indexed triangles

						_gl.drawElements( mode, offsets[ i ].count, type, offsets[ i ].start * size );

						_this.info.render.calls ++;
						_this.info.render.vertices += offsets[ i ].count; // not really true, here vertices can be shared
						_this.info.render.faces += offsets[ i ].count / 3;

					}

				}

			} else {

				// non-indexed triangles

				if ( updateBuffers ) {

					setupVertexAttributes( material, program, geometry, 0 );

				}

				var position = geometry.attributes[ 'position' ];

				// render non-indexed triangles

				_gl.drawArrays( mode, 0, position.array.length / 3 );

				_this.info.render.calls ++;
				_this.info.render.vertices += position.array.length / 3;
				_this.info.render.faces += position.array.length / 9;

			}

		} else if ( object instanceof THREE.PointCloud ) {

			// render particles

			if ( updateBuffers ) {

				setupVertexAttributes( material, program, geometry, 0 );

			}

			var position = geometry.attributes.position;

			// render particles

			_gl.drawArrays( _gl.POINTS, 0, position.array.length / 3 );

			_this.info.render.calls ++;
			_this.info.render.points += position.array.length / 3;

		} else if ( object instanceof THREE.Line ) {

			var mode = ( object.mode === THREE.LineStrip ) ? _gl.LINE_STRIP : _gl.LINES;

			setLineWidth( material.linewidth );

			var index = geometry.attributes.index;

			if ( index ) {

				// indexed lines

				var type, size;

				if ( index.array instanceof Uint32Array ) {

					type = _gl.UNSIGNED_INT;
					size = 4;

				} else {

					type = _gl.UNSIGNED_SHORT;
					size = 2;

				}

				var offsets = geometry.offsets;

				if ( offsets.length === 0 ) {

					if ( updateBuffers ) {

						setupVertexAttributes( material, program, geometry, 0 );
						_gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, index.buffer );

					}

					_gl.drawElements( mode, index.array.length, type, 0 ); // 2 bytes per Uint16Array

					_this.info.render.calls ++;
					_this.info.render.vertices += index.array.length; // not really true, here vertices can be shared

				} else {

					// if there is more than 1 chunk
					// must set attribute pointers to use new offsets for each chunk
					// even if geometry and materials didn't change

					if ( offsets.length > 1 ) updateBuffers = true;

					for ( var i = 0, il = offsets.length; i < il; i ++ ) {

						var startIndex = offsets[ i ].index;

						if ( updateBuffers ) {

							setupVertexAttributes( material, program, geometry, startIndex );
							_gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, index.buffer );

						}

						// render indexed lines

						_gl.drawElements( mode, offsets[ i ].count, type, offsets[ i ].start * size ); // 2 bytes per Uint16Array

						_this.info.render.calls ++;
						_this.info.render.vertices += offsets[ i ].count; // not really true, here vertices can be shared

					}

				}

			} else {

				// non-indexed lines

				if ( updateBuffers ) {

					setupVertexAttributes( material, program, geometry, 0 );

				}

				var position = geometry.attributes.position;

				_gl.drawArrays( mode, 0, position.array.length / 3 );

				_this.info.render.calls ++;
				_this.info.render.points += position.array.length / 3;

			}

		}

	};

	this.renderBuffer = function ( camera, lights, fog, material, geometryGroup, object ) {

		if ( material.visible === false ) return;

		var program = setProgram( camera, lights, fog, material, object );

		var attributes = program.attributes;

		var updateBuffers = false,
			wireframeBit = material.wireframe ? 1 : 0,
			geometryGroupHash = ( geometryGroup.id * 0xffffff ) + ( program.id * 2 ) + wireframeBit;

		if ( geometryGroupHash !== _currentGeometryGroupHash ) {

			_currentGeometryGroupHash = geometryGroupHash;
			updateBuffers = true;

		}

		if ( updateBuffers ) {

			initAttributes();

		}

		// vertices

		if ( ! material.morphTargets && attributes.position >= 0 ) {

			if ( updateBuffers ) {

				_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglVertexBuffer );
				enableAttribute( attributes.position );
				_gl.vertexAttribPointer( attributes.position, 3, _gl.FLOAT, false, 0, 0 );

			}

		} else {

			if ( object.morphTargetBase ) {

				setupMorphTargets( material, geometryGroup, object );

			}

		}


		if ( updateBuffers ) {

			// custom attributes

			// Use the per-geometryGroup custom attribute arrays which are setup in initMeshBuffers

			if ( geometryGroup.__webglCustomAttributesList ) {

				for ( var i = 0, il = geometryGroup.__webglCustomAttributesList.length; i < il; i ++ ) {

					var attribute = geometryGroup.__webglCustomAttributesList[ i ];

					if ( attributes[ attribute.buffer.belongsToAttribute ] >= 0 ) {

						_gl.bindBuffer( _gl.ARRAY_BUFFER, attribute.buffer );
						enableAttribute( attributes[ attribute.buffer.belongsToAttribute ] );
						_gl.vertexAttribPointer( attributes[ attribute.buffer.belongsToAttribute ], attribute.size, _gl.FLOAT, false, 0, 0 );

					}

				}

			}


			// colors

			if ( attributes.color >= 0 ) {

				if ( object.geometry.colors.length > 0 || object.geometry.faces.length > 0 ) {

					_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglColorBuffer );
					enableAttribute( attributes.color );
					_gl.vertexAttribPointer( attributes.color, 3, _gl.FLOAT, false, 0, 0 );

				} else if ( material.defaultAttributeValues !== undefined ) {


					_gl.vertexAttrib3fv( attributes.color, material.defaultAttributeValues.color );

				}

			}

			// normals

			if ( attributes.normal >= 0 ) {

				_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglNormalBuffer );
				enableAttribute( attributes.normal );
				_gl.vertexAttribPointer( attributes.normal, 3, _gl.FLOAT, false, 0, 0 );

			}

			// tangents

			if ( attributes.tangent >= 0 ) {

				_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglTangentBuffer );
				enableAttribute( attributes.tangent );
				_gl.vertexAttribPointer( attributes.tangent, 4, _gl.FLOAT, false, 0, 0 );

			}

			// uvs

			if ( attributes.uv >= 0 ) {

				if ( object.geometry.faceVertexUvs[ 0 ] ) {

					_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglUVBuffer );
					enableAttribute( attributes.uv );
					_gl.vertexAttribPointer( attributes.uv, 2, _gl.FLOAT, false, 0, 0 );

				} else if ( material.defaultAttributeValues !== undefined ) {


					_gl.vertexAttrib2fv( attributes.uv, material.defaultAttributeValues.uv );

				}

			}

			if ( attributes.uv2 >= 0 ) {

				if ( object.geometry.faceVertexUvs[ 1 ] ) {

					_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglUV2Buffer );
					enableAttribute( attributes.uv2 );
					_gl.vertexAttribPointer( attributes.uv2, 2, _gl.FLOAT, false, 0, 0 );

				} else if ( material.defaultAttributeValues !== undefined ) {


					_gl.vertexAttrib2fv( attributes.uv2, material.defaultAttributeValues.uv2 );

				}

			}

			if ( material.skinning &&
				 attributes.skinIndex >= 0 && attributes.skinWeight >= 0 ) {

				_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglSkinIndicesBuffer );
				enableAttribute( attributes.skinIndex );
				_gl.vertexAttribPointer( attributes.skinIndex, 4, _gl.FLOAT, false, 0, 0 );

				_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglSkinWeightsBuffer );
				enableAttribute( attributes.skinWeight );
				_gl.vertexAttribPointer( attributes.skinWeight, 4, _gl.FLOAT, false, 0, 0 );

			}

			// line distances

			if ( attributes.lineDistance >= 0 ) {

				_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglLineDistanceBuffer );
				enableAttribute( attributes.lineDistance );
				_gl.vertexAttribPointer( attributes.lineDistance, 1, _gl.FLOAT, false, 0, 0 );

			}

		}

		disableUnusedAttributes();

		// render mesh

		if ( object instanceof THREE.Mesh ) {

			var type = geometryGroup.__typeArray === Uint32Array ? _gl.UNSIGNED_INT : _gl.UNSIGNED_SHORT;

			// wireframe

			if ( material.wireframe ) {

				setLineWidth( material.wireframeLinewidth );
				if ( updateBuffers ) _gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglLineBuffer );
				_gl.drawElements( _gl.LINES, geometryGroup.__webglLineCount, type, 0 );

			// triangles

			} else {

				if ( updateBuffers ) _gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglFaceBuffer );
				_gl.drawElements( _gl.TRIANGLES, geometryGroup.__webglFaceCount, type, 0 );

			}

			_this.info.render.calls ++;
			_this.info.render.vertices += geometryGroup.__webglFaceCount;
			_this.info.render.faces += geometryGroup.__webglFaceCount / 3;

		// render lines

		} else if ( object instanceof THREE.Line ) {

			var mode = ( object.mode === THREE.LineStrip ) ? _gl.LINE_STRIP : _gl.LINES;

			setLineWidth( material.linewidth );

			_gl.drawArrays( mode, 0, geometryGroup.__webglLineCount );

			_this.info.render.calls ++;

		// render particles

		} else if ( object instanceof THREE.PointCloud ) {

			_gl.drawArrays( _gl.POINTS, 0, geometryGroup.__webglParticleCount );

			_this.info.render.calls ++;
			_this.info.render.points += geometryGroup.__webglParticleCount;

		}

	};

	function initAttributes() {

		for ( var i = 0, l = _newAttributes.length; i < l; i ++ ) {

			_newAttributes[ i ] = 0;

		}

	}

	function enableAttribute( attribute ) {

		_newAttributes[ attribute ] = 1;

		if ( _enabledAttributes[ attribute ] === 0 ) {

			_gl.enableVertexAttribArray( attribute );
			_enabledAttributes[ attribute ] = 1;

		}

	}

	function disableUnusedAttributes() {

		for ( var i = 0, l = _enabledAttributes.length; i < l; i ++ ) {

			if ( _enabledAttributes[ i ] !== _newAttributes[ i ] ) {

				_gl.disableVertexAttribArray( i );
				_enabledAttributes[ i ] = 0;

			}

		}

	}

	function setupMorphTargets ( material, geometryGroup, object ) {

		// set base

		var attributes = material.program.attributes;

		if ( object.morphTargetBase !== - 1 && attributes.position >= 0 ) {

			_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[ object.morphTargetBase ] );
			enableAttribute( attributes.position );
			_gl.vertexAttribPointer( attributes.position, 3, _gl.FLOAT, false, 0, 0 );

		} else if ( attributes.position >= 0 ) {

			_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglVertexBuffer );
			enableAttribute( attributes.position );
			_gl.vertexAttribPointer( attributes.position, 3, _gl.FLOAT, false, 0, 0 );

		}

		if ( object.morphTargetForcedOrder.length ) {

			// set forced order

			var m = 0;
			var order = object.morphTargetForcedOrder;
			var influences = object.morphTargetInfluences;

			while ( m < material.numSupportedMorphTargets && m < order.length ) {

				if ( attributes[ 'morphTarget' + m ] >= 0 ) {

					_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[ order[ m ] ] );
					enableAttribute( attributes[ 'morphTarget' + m ] );
					_gl.vertexAttribPointer( attributes[ 'morphTarget' + m ], 3, _gl.FLOAT, false, 0, 0 );

				}

				if ( attributes[ 'morphNormal' + m ] >= 0 && material.morphNormals ) {

					_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglMorphNormalsBuffers[ order[ m ] ] );
					enableAttribute( attributes[ 'morphNormal' + m ] );
					_gl.vertexAttribPointer( attributes[ 'morphNormal' + m ], 3, _gl.FLOAT, false, 0, 0 );

				}

				object.__webglMorphTargetInfluences[ m ] = influences[ order[ m ] ];

				m ++;
			}

		} else {

			// find the most influencing

			var influence, activeInfluenceIndices = [];
			var influences = object.morphTargetInfluences;
			var i, il = influences.length;

			for ( i = 0; i < il; i ++ ) {

				influence = influences[ i ];

				if ( influence > 0 ) {

					activeInfluenceIndices.push( [ influence, i ] );

				}

			}

			if ( activeInfluenceIndices.length > material.numSupportedMorphTargets ) {

				activeInfluenceIndices.sort( numericalSort );
				activeInfluenceIndices.length = material.numSupportedMorphTargets;

			} else if ( activeInfluenceIndices.length > material.numSupportedMorphNormals ) {

				activeInfluenceIndices.sort( numericalSort );

			} else if ( activeInfluenceIndices.length === 0 ) {

				activeInfluenceIndices.push( [ 0, 0 ] );

			};

			var influenceIndex, m = 0;

			while ( m < material.numSupportedMorphTargets ) {

				if ( activeInfluenceIndices[ m ] ) {

					influenceIndex = activeInfluenceIndices[ m ][ 1 ];

					if ( attributes[ 'morphTarget' + m ] >= 0 ) {

						_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[ influenceIndex ] );
						enableAttribute( attributes[ 'morphTarget' + m ] );
						_gl.vertexAttribPointer( attributes[ 'morphTarget' + m ], 3, _gl.FLOAT, false, 0, 0 );

					}

					if ( attributes[ 'morphNormal' + m ] >= 0 && material.morphNormals ) {

						_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglMorphNormalsBuffers[ influenceIndex ] );
						enableAttribute( attributes[ 'morphNormal' + m ] );
						_gl.vertexAttribPointer( attributes[ 'morphNormal' + m ], 3, _gl.FLOAT, false, 0, 0 );


					}

					object.__webglMorphTargetInfluences[ m ] = influences[ influenceIndex ];

				} else {

					/*
					_gl.vertexAttribPointer( attributes[ "morphTarget" + m ], 3, _gl.FLOAT, false, 0, 0 );

					if ( material.morphNormals ) {

						_gl.vertexAttribPointer( attributes[ "morphNormal" + m ], 3, _gl.FLOAT, false, 0, 0 );

					}
					*/

					object.__webglMorphTargetInfluences[ m ] = 0;

				}

				m ++;

			}

		}

		// load updated influences uniform

		if ( material.program.uniforms.morphTargetInfluences !== null ) {

			_gl.uniform1fv( material.program.uniforms.morphTargetInfluences, object.__webglMorphTargetInfluences );

		}

	}

	// Sorting

	function painterSortStable ( a, b ) {

		if ( a.material.id !== b.material.id ) {

			return b.material.id - a.material.id;

		} else if ( a.z !== b.z ) {

			return b.z - a.z;

		} else {

			return a.id - b.id;

		}

	}

	function reversePainterSortStable ( a, b ) {

		if ( a.z !== b.z ) {

			return a.z - b.z;

		} else {

			return a.id - b.id;

		}

	}

	function numericalSort ( a, b ) {

		return b[ 0 ] - a[ 0 ];

	}

	// Rendering

	this.render = function ( scene, camera, renderTarget, forceClear ) {

		if ( camera instanceof THREE.Camera === false ) {

			console.error( 'THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.' );
			return;

		}

		var fog = scene.fog;

		// reset caching for this frame

		_currentGeometryGroupHash = - 1;
		_currentMaterialId = - 1;
		_currentCamera = null;
		_lightsNeedUpdate = true;

		// update scene graph

		if ( scene.autoUpdate === true ) scene.updateMatrixWorld();

		// update camera matrices and frustum

		if ( camera.parent === undefined ) camera.updateMatrixWorld();

		// update Skeleton objects

		scene.traverse( function ( object ) {

			if ( object instanceof THREE.SkinnedMesh ) {

				object.skeleton.update();

			}

		} );

		camera.matrixWorldInverse.getInverse( camera.matrixWorld );

		_projScreenMatrix.multiplyMatrices( camera.projectionMatrix, camera.matrixWorldInverse );
		_frustum.setFromMatrix( _projScreenMatrix );

		lights.length = 0;
		opaqueObjects.length = 0;
		transparentObjects.length = 0;

		sprites.length = 0;
		lensFlares.length = 0;

		projectObject( scene, scene );

		if ( _this.sortObjects === true ) {

			opaqueObjects.sort( painterSortStable );
			transparentObjects.sort( reversePainterSortStable );

		}

		// custom render plugins (pre pass)

		shadowMapPlugin.render( scene, camera );

		//

		_this.info.render.calls = 0;
		_this.info.render.vertices = 0;
		_this.info.render.faces = 0;
		_this.info.render.points = 0;

		this.setRenderTarget( renderTarget );

		if ( this.autoClear || forceClear ) {

			this.clear( this.autoClearColor, this.autoClearDepth, this.autoClearStencil );

		}

		// set matrices for immediate objects

		for ( var i = 0, il = _webglObjectsImmediate.length; i < il; i ++ ) {

			var webglObject = _webglObjectsImmediate[ i ];
			var object = webglObject.object;

			if ( object.visible ) {

				setupMatrices( object, camera );

				unrollImmediateBufferMaterial( webglObject );

			}

		}

		if ( scene.overrideMaterial ) {

			var material = scene.overrideMaterial;

			this.setBlending( material.blending, material.blendEquation, material.blendSrc, material.blendDst );
			this.setDepthTest( material.depthTest );
			this.setDepthWrite( material.depthWrite );
			setPolygonOffset( material.polygonOffset, material.polygonOffsetFactor, material.polygonOffsetUnits );

			renderObjects( opaqueObjects, camera, lights, fog, true, material );
			renderObjects( transparentObjects, camera, lights, fog, true, material );
			renderObjectsImmediate( _webglObjectsImmediate, '', camera, lights, fog, false, material );

		} else {

			var material = null;

			// opaque pass (front-to-back order)

			this.setBlending( THREE.NoBlending );

			renderObjects( opaqueObjects, camera, lights, fog, false, material );
			renderObjectsImmediate( _webglObjectsImmediate, 'opaque', camera, lights, fog, false, material );

			// transparent pass (back-to-front order)

			renderObjects( transparentObjects, camera, lights, fog, true, material );
			renderObjectsImmediate( _webglObjectsImmediate, 'transparent', camera, lights, fog, true, material );

		}

		// custom render plugins (post pass)

		spritePlugin.render( scene, camera );
		lensFlarePlugin.render( scene, camera, _currentWidth, _currentHeight );

		// Generate mipmap if we're using any kind of mipmap filtering

		if ( renderTarget && renderTarget.generateMipmaps && renderTarget.minFilter !== THREE.NearestFilter && renderTarget.minFilter !== THREE.LinearFilter ) {

			updateRenderTargetMipmap( renderTarget );

		}

		// Ensure depth buffer writing is enabled so it can be cleared on next render

		this.setDepthTest( true );
		this.setDepthWrite( true );

		// _gl.finish();

	};

	function projectObject( scene, object ) {

		if ( object.visible === false ) return;

		if ( object instanceof THREE.Scene || object instanceof THREE.Group ) {

			// skip

		} else {

			initObject( object, scene );

			if ( object instanceof THREE.Light ) {

				lights.push( object );

			} else if ( object instanceof THREE.Sprite ) {

				sprites.push( object );

			} else if ( object instanceof THREE.LensFlare ) {

				lensFlares.push( object );

			} else {

				var webglObjects = _webglObjects[ object.id ];

				if ( webglObjects && ( object.frustumCulled === false || _frustum.intersectsObject( object ) === true ) ) {

					updateObject( object, scene );

					for ( var i = 0, l = webglObjects.length; i < l; i ++ ) {

						var webglObject = webglObjects[i];

						unrollBufferMaterial( webglObject );

						webglObject.render = true;

						if ( _this.sortObjects === true ) {

							if ( object.renderDepth !== null ) {

								webglObject.z = object.renderDepth;

							} else {

								_vector3.setFromMatrixPosition( object.matrixWorld );
								_vector3.applyProjection( _projScreenMatrix );

								webglObject.z = _vector3.z;

							}

						}

					}

				}

			}

		}

		for ( var i = 0, l = object.children.length; i < l; i ++ ) {

			projectObject( scene, object.children[ i ] );

		}

	}

	function renderObjects( renderList, camera, lights, fog, useBlending, overrideMaterial ) {

		var material;

		for ( var i = renderList.length - 1; i !== - 1; i -- ) {

			var webglObject = renderList[ i ];

			var object = webglObject.object;
			var buffer = webglObject.buffer;

			setupMatrices( object, camera );

			if ( overrideMaterial ) {

				material = overrideMaterial;

			} else {

				material = webglObject.material;

				if ( ! material ) continue;

				if ( useBlending ) _this.setBlending( material.blending, material.blendEquation, material.blendSrc, material.blendDst );

				_this.setDepthTest( material.depthTest );
				_this.setDepthWrite( material.depthWrite );
				setPolygonOffset( material.polygonOffset, material.polygonOffsetFactor, material.polygonOffsetUnits );

			}

			_this.setMaterialFaces( material );

			if ( buffer instanceof THREE.BufferGeometry ) {

				_this.renderBufferDirect( camera, lights, fog, material, buffer, object );

			} else {

				_this.renderBuffer( camera, lights, fog, material, buffer, object );

			}

		}

	}

	function renderObjectsImmediate ( renderList, materialType, camera, lights, fog, useBlending, overrideMaterial ) {

		var material;

		for ( var i = 0, il = renderList.length; i < il; i ++ ) {

			var webglObject = renderList[ i ];
			var object = webglObject.object;

			if ( object.visible ) {

				if ( overrideMaterial ) {

					material = overrideMaterial;

				} else {

					material = webglObject[ materialType ];

					if ( ! material ) continue;

					if ( useBlending ) _this.setBlending( material.blending, material.blendEquation, material.blendSrc, material.blendDst );

					_this.setDepthTest( material.depthTest );
					_this.setDepthWrite( material.depthWrite );
					setPolygonOffset( material.polygonOffset, material.polygonOffsetFactor, material.polygonOffsetUnits );

				}

				_this.renderImmediateObject( camera, lights, fog, material, object );

			}

		}

	}

	this.renderImmediateObject = function ( camera, lights, fog, material, object ) {

		var program = setProgram( camera, lights, fog, material, object );

		_currentGeometryGroupHash = - 1;

		_this.setMaterialFaces( material );

		if ( object.immediateRenderCallback ) {

			object.immediateRenderCallback( program, _gl, _frustum );

		} else {

			object.render( function ( object ) { _this.renderBufferImmediate( object, program, material ); } );

		}

	};

	function unrollImmediateBufferMaterial ( globject ) {

		var object = globject.object,
			material = object.material;

		if ( material.transparent ) {

			globject.transparent = material;
			globject.opaque = null;

		} else {

			globject.opaque = material;
			globject.transparent = null;

		}

	}

	function unrollBufferMaterial ( globject ) {

		var object = globject.object;
		var buffer = globject.buffer;

		var geometry = object.geometry;
		var material = object.material;

		if ( material instanceof THREE.MeshFaceMaterial ) {

			var materialIndex = geometry instanceof THREE.BufferGeometry ? 0 : buffer.materialIndex;

			material = material.materials[ materialIndex ];

			globject.material = material;

			if ( material.transparent ) {

				transparentObjects.push( globject );

			} else {

				opaqueObjects.push( globject );

			}

		} else if ( material ) {

			globject.material = material;

			if ( material.transparent ) {

				transparentObjects.push( globject );

			} else {

				opaqueObjects.push( globject );

			}

		}

	}

	function initObject( object, scene ) {

		if ( object.__webglInit === undefined ) {

			object.__webglInit = true;
			object._modelViewMatrix = new THREE.Matrix4();
			object._normalMatrix = new THREE.Matrix3();

			object.addEventListener( 'removed', onObjectRemoved );

		}

		var geometry = object.geometry;

		if ( geometry === undefined ) {

			// ImmediateRenderObject

		} else if ( geometry.__webglInit === undefined ) {

			geometry.__webglInit = true;
			geometry.addEventListener( 'dispose', onGeometryDispose );

			if ( geometry instanceof THREE.BufferGeometry ) {

				//

			} else if ( object instanceof THREE.Mesh ) {

				initGeometryGroups( scene, object, geometry );

			} else if ( object instanceof THREE.Line ) {

				if ( geometry.__webglVertexBuffer === undefined ) {

					createLineBuffers( geometry );
					initLineBuffers( geometry, object );

					geometry.verticesNeedUpdate = true;
					geometry.colorsNeedUpdate = true;
					geometry.lineDistancesNeedUpdate = true;

				}

			} else if ( object instanceof THREE.PointCloud ) {

				if ( geometry.__webglVertexBuffer === undefined ) {

					createParticleBuffers( geometry );
					initParticleBuffers( geometry, object );

					geometry.verticesNeedUpdate = true;
					geometry.colorsNeedUpdate = true;

				}

			}

		}

		if ( object.__webglActive === undefined) {

			object.__webglActive = true;

			if ( object instanceof THREE.Mesh ) {

				if ( geometry instanceof THREE.BufferGeometry ) {

					addBuffer( _webglObjects, geometry, object );

				} else if ( geometry instanceof THREE.Geometry ) {

					var geometryGroupsList = geometryGroups[ geometry.id ];

					for ( var i = 0,l = geometryGroupsList.length; i < l; i ++ ) {

						addBuffer( _webglObjects, geometryGroupsList[ i ], object );

					}

				}

			} else if ( object instanceof THREE.Line || object instanceof THREE.PointCloud ) {

				addBuffer( _webglObjects, geometry, object );

			} else if ( object instanceof THREE.ImmediateRenderObject || object.immediateRenderCallback ) {

				addBufferImmediate( _webglObjectsImmediate, object );

			}

		}

	}

	// Geometry splitting

	var geometryGroups = {};
	var geometryGroupCounter = 0;

	function makeGroups( geometry, usesFaceMaterial ) {

		var maxVerticesInGroup = extensions.get( 'OES_element_index_uint' ) ? 4294967296 : 65535;

		var groupHash, hash_map = {};

		var numMorphTargets = geometry.morphTargets.length;
		var numMorphNormals = geometry.morphNormals.length;

		var group;
		var groups = {};
		var groupsList = [];

		for ( var f = 0, fl = geometry.faces.length; f < fl; f ++ ) {

			var face = geometry.faces[ f ];
			var materialIndex = usesFaceMaterial ? face.materialIndex : 0;

			if ( ! ( materialIndex in hash_map ) ) {

				hash_map[ materialIndex ] = { hash: materialIndex, counter: 0 };

			}

			groupHash = hash_map[ materialIndex ].hash + '_' + hash_map[ materialIndex ].counter;

			if ( ! ( groupHash in groups ) ) {

				group = {
					id: geometryGroupCounter ++,
					faces3: [],
					materialIndex: materialIndex,
					vertices: 0,
					numMorphTargets: numMorphTargets,
					numMorphNormals: numMorphNormals
				};
				
				groups[ groupHash ] = group;
				groupsList.push( group );

			}

			if ( groups[ groupHash ].vertices + 3 > maxVerticesInGroup ) {

				hash_map[ materialIndex ].counter += 1;
				groupHash = hash_map[ materialIndex ].hash + '_' + hash_map[ materialIndex ].counter;

				if ( ! ( groupHash in groups ) ) {

					group = {
						id: geometryGroupCounter ++,
						faces3: [],
						materialIndex: materialIndex,
						vertices: 0,
						numMorphTargets: numMorphTargets,
						numMorphNormals: numMorphNormals
					};
					
					groups[ groupHash ] = group;
					groupsList.push( group );

				}

			}

			groups[ groupHash ].faces3.push( f );
			groups[ groupHash ].vertices += 3;

		}

		return groupsList;

	}

	function initGeometryGroups( scene, object, geometry ) {

		var material = object.material, addBuffers = false;

		if ( geometryGroups[ geometry.id ] === undefined || geometry.groupsNeedUpdate === true ) {

			delete _webglObjects[ object.id ];

			geometryGroups[ geometry.id ] = makeGroups( geometry, material instanceof THREE.MeshFaceMaterial );

			geometry.groupsNeedUpdate = false;

		}

		var geometryGroupsList = geometryGroups[ geometry.id ];

		// create separate VBOs per geometry chunk

		for ( var i = 0, il = geometryGroupsList.length; i < il; i ++ ) {

			var geometryGroup = geometryGroupsList[ i ];

			// initialise VBO on the first access

			if ( geometryGroup.__webglVertexBuffer === undefined ) {

				createMeshBuffers( geometryGroup );
				initMeshBuffers( geometryGroup, object );

				geometry.verticesNeedUpdate = true;
				geometry.morphTargetsNeedUpdate = true;
				geometry.elementsNeedUpdate = true;
				geometry.uvsNeedUpdate = true;
				geometry.normalsNeedUpdate = true;
				geometry.tangentsNeedUpdate = true;
				geometry.colorsNeedUpdate = true;

				addBuffers = true;

			} else {

				addBuffers = false;

			}

			if ( addBuffers || object.__webglActive === undefined ) {

				addBuffer( _webglObjects, geometryGroup, object );

			}

		}

		object.__webglActive = true;

	}

	function addBuffer( objlist, buffer, object ) {

		var id = object.id;
		objlist[id] = objlist[id] || [];
		objlist[id].push(
			{
				id: id,
				buffer: buffer,
				object: object,
				material: null,
				z: 0
			}
		);

	};

	function addBufferImmediate( objlist, object ) {

		objlist.push(
			{
				id: null,
				object: object,
				opaque: null,
				transparent: null,
				z: 0
			}
		);

	};

	// Objects updates

	function updateObject( object, scene ) {

		var geometry = object.geometry, customAttributesDirty, material;

		if ( geometry instanceof THREE.BufferGeometry ) {

			setDirectBuffers( geometry );

		} else if ( object instanceof THREE.Mesh ) {

			// check all geometry groups

			if ( geometry.groupsNeedUpdate === true ) {

				initGeometryGroups( scene, object, geometry );

			}

			var geometryGroupsList = geometryGroups[ geometry.id ];

			for ( var i = 0, il = geometryGroupsList.length; i < il; i ++ ) {

				var geometryGroup = geometryGroupsList[ i ];

				material = getBufferMaterial( object, geometryGroup );

				if ( geometry.groupsNeedUpdate === true ) {

					initMeshBuffers( geometryGroup, object );

				}

				customAttributesDirty = material.attributes && areCustomAttributesDirty( material );

				if ( geometry.verticesNeedUpdate || geometry.morphTargetsNeedUpdate || geometry.elementsNeedUpdate ||
					 geometry.uvsNeedUpdate || geometry.normalsNeedUpdate ||
					 geometry.colorsNeedUpdate || geometry.tangentsNeedUpdate || customAttributesDirty ) {

					setMeshBuffers( geometryGroup, object, _gl.DYNAMIC_DRAW, ! geometry.dynamic, material );

				}

			}

			geometry.verticesNeedUpdate = false;
			geometry.morphTargetsNeedUpdate = false;
			geometry.elementsNeedUpdate = false;
			geometry.uvsNeedUpdate = false;
			geometry.normalsNeedUpdate = false;
			geometry.colorsNeedUpdate = false;
			geometry.tangentsNeedUpdate = false;

			material.attributes && clearCustomAttributes( material );

		} else if ( object instanceof THREE.Line ) {

			material = getBufferMaterial( object, geometry );

			customAttributesDirty = material.attributes && areCustomAttributesDirty( material );

			if ( geometry.verticesNeedUpdate || geometry.colorsNeedUpdate || geometry.lineDistancesNeedUpdate || customAttributesDirty ) {

				setLineBuffers( geometry, _gl.DYNAMIC_DRAW );

			}

			geometry.verticesNeedUpdate = false;
			geometry.colorsNeedUpdate = false;
			geometry.lineDistancesNeedUpdate = false;

			material.attributes && clearCustomAttributes( material );


		} else if ( object instanceof THREE.PointCloud ) {

			material = getBufferMaterial( object, geometry );

			customAttributesDirty = material.attributes && areCustomAttributesDirty( material );

			if ( geometry.verticesNeedUpdate || geometry.colorsNeedUpdate || object.sortParticles || customAttributesDirty ) {

				setParticleBuffers( geometry, _gl.DYNAMIC_DRAW, object );

			}

			geometry.verticesNeedUpdate = false;
			geometry.colorsNeedUpdate = false;

			material.attributes && clearCustomAttributes( material );

		}

	}

	// Objects updates - custom attributes check

	function areCustomAttributesDirty( material ) {

		for ( var name in material.attributes ) {

			if ( material.attributes[ name ].needsUpdate ) return true;

		}

		return false;

	}

	function clearCustomAttributes( material ) {

		for ( var name in material.attributes ) {

			material.attributes[ name ].needsUpdate = false;

		}

	}

	// Objects removal

	function removeObject( object ) {

		if ( object instanceof THREE.Mesh  ||
			 object instanceof THREE.PointCloud ||
			 object instanceof THREE.Line ) {

			delete _webglObjects[ object.id ];

		} else if ( object instanceof THREE.ImmediateRenderObject || object.immediateRenderCallback ) {

			removeInstances( _webglObjectsImmediate, object );

		}

		delete object.__webglInit;
		delete object._modelViewMatrix;
		delete object._normalMatrix;

		delete object.__webglActive;

	}

	function removeInstances( objlist, object ) {

		for ( var o = objlist.length - 1; o >= 0; o -- ) {

			if ( objlist[ o ].object === object ) {

				objlist.splice( o, 1 );

			}

		}

	}

	// Materials

	function initMaterial( material, lights, fog, object ) {

		material.addEventListener( 'dispose', onMaterialDispose );

		var shaderID;

		if ( material instanceof THREE.MeshDepthMaterial ) {

			shaderID = 'depth';

		} else if ( material instanceof THREE.MeshNormalMaterial ) {

			shaderID = 'normal';

		} else if ( material instanceof THREE.MeshBasicMaterial ) {

			shaderID = 'basic';

		} else if ( material instanceof THREE.MeshLambertMaterial ) {

			shaderID = 'lambert';

		} else if ( material instanceof THREE.MeshPhongMaterial ) {

			shaderID = 'phong';

		} else if ( material instanceof THREE.LineBasicMaterial ) {

			shaderID = 'basic';

		} else if ( material instanceof THREE.LineDashedMaterial ) {

			shaderID = 'dashed';

		} else if ( material instanceof THREE.PointCloudMaterial ) {

			shaderID = 'particle_basic';

		}

		if ( shaderID ) {

			var shader = THREE.ShaderLib[ shaderID ];

			material.__webglShader = {
				uniforms: THREE.UniformsUtils.clone( shader.uniforms ),
				vertexShader: shader.vertexShader,
				fragmentShader: shader.fragmentShader
			}

		} else {

			material.__webglShader = {
				uniforms: material.uniforms,
				vertexShader: material.vertexShader,
				fragmentShader: material.fragmentShader
			}

		}

		// heuristics to create shader parameters according to lights in the scene
		// (not to blow over maxLights budget)

		var maxLightCount = allocateLights( lights );
		var maxShadows = allocateShadows( lights );
		var maxBones = allocateBones( object );

		var parameters = {

			precision: _precision,
			supportsVertexTextures: _supportsVertexTextures,

			map: !! material.map,
			envMap: !! material.envMap,
			lightMap: !! material.lightMap,
			bumpMap: !! material.bumpMap,
			normalMap: !! material.normalMap,
			specularMap: !! material.specularMap,
			alphaMap: !! material.alphaMap,

			vertexColors: material.vertexColors,

			fog: fog,
			useFog: material.fog,
			fogExp: fog instanceof THREE.FogExp2,

			sizeAttenuation: material.sizeAttenuation,
			logarithmicDepthBuffer: _logarithmicDepthBuffer,

			skinning: material.skinning,
			maxBones: maxBones,
			useVertexTexture: _supportsBoneTextures && object && object.skeleton && object.skeleton.useVertexTexture,

			morphTargets: material.morphTargets,
			morphNormals: material.morphNormals,
			maxMorphTargets: _this.maxMorphTargets,
			maxMorphNormals: _this.maxMorphNormals,

			maxDirLights: maxLightCount.directional,
			maxPointLights: maxLightCount.point,
			maxSpotLights: maxLightCount.spot,
			maxHemiLights: maxLightCount.hemi,

			maxShadows: maxShadows,
			shadowMapEnabled: _this.shadowMapEnabled && object.receiveShadow && maxShadows > 0,
			shadowMapType: _this.shadowMapType,
			shadowMapDebug: _this.shadowMapDebug,
			shadowMapCascade: _this.shadowMapCascade,

			alphaTest: material.alphaTest,
			metal: material.metal,
			wrapAround: material.wrapAround,
			doubleSided: material.side === THREE.DoubleSide,
			flipSided: material.side === THREE.BackSide

		};

		// Generate code

		var chunks = [];

		if ( shaderID ) {

			chunks.push( shaderID );

		} else {

			chunks.push( material.fragmentShader );
			chunks.push( material.vertexShader );

		}

		if ( material.defines !== undefined ) {

			for ( var name in material.defines ) {

				chunks.push( name );
				chunks.push( material.defines[ name ] );

			}

		}

		for ( var name in parameters ) {

			chunks.push( name );
			chunks.push( parameters[ name ] );

		}

		var code = chunks.join();

		var program;

		// Check if code has been already compiled

		for ( var p = 0, pl = _programs.length; p < pl; p ++ ) {

			var programInfo = _programs[ p ];

			if ( programInfo.code === code ) {

				program = programInfo;
				program.usedTimes ++;

				break;

			}

		}

		if ( program === undefined ) {

			program = new THREE.WebGLProgram( _this, code, material, parameters );
			_programs.push( program );

			_this.info.memory.programs = _programs.length;

		}

		material.program = program;

		var attributes = program.attributes;

		if ( material.morphTargets ) {

			material.numSupportedMorphTargets = 0;

			var id, base = 'morphTarget';

			for ( var i = 0; i < _this.maxMorphTargets; i ++ ) {

				id = base + i;

				if ( attributes[ id ] >= 0 ) {

					material.numSupportedMorphTargets ++;

				}

			}

		}

		if ( material.morphNormals ) {

			material.numSupportedMorphNormals = 0;

			var id, base = 'morphNormal';

			for ( i = 0; i < _this.maxMorphNormals; i ++ ) {

				id = base + i;

				if ( attributes[ id ] >= 0 ) {

					material.numSupportedMorphNormals ++;

				}

			}

		}

		material.uniformsList = [];

		for ( var u in material.__webglShader.uniforms ) {

			var location = material.program.uniforms[ u ];

			if ( location ) {
				material.uniformsList.push( [ material.__webglShader.uniforms[ u ], location ] );
			}

		}

	}

	function setProgram( camera, lights, fog, material, object ) {

		_usedTextureUnits = 0;

		if ( material.needsUpdate ) {

			if ( material.program ) deallocateMaterial( material );

			initMaterial( material, lights, fog, object );
			material.needsUpdate = false;

		}

		if ( material.morphTargets ) {

			if ( ! object.__webglMorphTargetInfluences ) {

				object.__webglMorphTargetInfluences = new Float32Array( _this.maxMorphTargets );

			}

		}

		var refreshProgram = false;
		var refreshMaterial = false;
		var refreshLights = false;

		var program = material.program,
			p_uniforms = program.uniforms,
			m_uniforms = material.__webglShader.uniforms;

		if ( program.id !== _currentProgram ) {

			_gl.useProgram( program.program );
			_currentProgram = program.id;

			refreshProgram = true;
			refreshMaterial = true;
			refreshLights = true;

		}

		if ( material.id !== _currentMaterialId ) {

			if ( _currentMaterialId === -1 ) refreshLights = true;
			_currentMaterialId = material.id;

			refreshMaterial = true;

		}

		if ( refreshProgram || camera !== _currentCamera ) {

			_gl.uniformMatrix4fv( p_uniforms.projectionMatrix, false, camera.projectionMatrix.elements );

			if ( _logarithmicDepthBuffer ) {

				_gl.uniform1f( p_uniforms.logDepthBufFC, 2.0 / ( Math.log( camera.far + 1.0 ) / Math.LN2 ) );

			}


			if ( camera !== _currentCamera ) _currentCamera = camera;

			// load material specific uniforms
			// (shader material also gets them for the sake of genericity)

			if ( material instanceof THREE.ShaderMaterial ||
				 material instanceof THREE.MeshPhongMaterial ||
				 material.envMap ) {

				if ( p_uniforms.cameraPosition !== null ) {

					_vector3.setFromMatrixPosition( camera.matrixWorld );
					_gl.uniform3f( p_uniforms.cameraPosition, _vector3.x, _vector3.y, _vector3.z );

				}

			}

			if ( material instanceof THREE.MeshPhongMaterial ||
				 material instanceof THREE.MeshLambertMaterial ||
				 material instanceof THREE.ShaderMaterial ||
				 material.skinning ) {

				if ( p_uniforms.viewMatrix !== null ) {

					_gl.uniformMatrix4fv( p_uniforms.viewMatrix, false, camera.matrixWorldInverse.elements );

				}

			}

		}

		// skinning uniforms must be set even if material didn't change
		// auto-setting of texture unit for bone texture must go before other textures
		// not sure why, but otherwise weird things happen

		if ( material.skinning ) {

			if ( object.bindMatrix && p_uniforms.bindMatrix !== null ) {

				_gl.uniformMatrix4fv( p_uniforms.bindMatrix, false, object.bindMatrix.elements );

			}

			if ( object.bindMatrixInverse && p_uniforms.bindMatrixInverse !== null ) {

				_gl.uniformMatrix4fv( p_uniforms.bindMatrixInverse, false, object.bindMatrixInverse.elements );

			}

			if ( _supportsBoneTextures && object.skeleton && object.skeleton.useVertexTexture ) {

				if ( p_uniforms.boneTexture !== null ) {

					var textureUnit = getTextureUnit();

					_gl.uniform1i( p_uniforms.boneTexture, textureUnit );
					_this.setTexture( object.skeleton.boneTexture, textureUnit );

				}

				if ( p_uniforms.boneTextureWidth !== null ) {

					_gl.uniform1i( p_uniforms.boneTextureWidth, object.skeleton.boneTextureWidth );

				}

				if ( p_uniforms.boneTextureHeight !== null ) {

					_gl.uniform1i( p_uniforms.boneTextureHeight, object.skeleton.boneTextureHeight );

				}

			} else if ( object.skeleton && object.skeleton.boneMatrices ) {

				if ( p_uniforms.boneGlobalMatrices !== null ) {

					_gl.uniformMatrix4fv( p_uniforms.boneGlobalMatrices, false, object.skeleton.boneMatrices );

				}

			}

		}

		if ( refreshMaterial ) {

			// refresh uniforms common to several materials

			if ( fog && material.fog ) {

				refreshUniformsFog( m_uniforms, fog );

			}

			if ( material instanceof THREE.MeshPhongMaterial ||
				 material instanceof THREE.MeshLambertMaterial ||
				 material.lights ) {

				if ( _lightsNeedUpdate ) {

					refreshLights = true;
					setupLights( lights );
					_lightsNeedUpdate = false;
				}

				if ( refreshLights ) {
					refreshUniformsLights( m_uniforms, _lights );
					markUniformsLightsNeedsUpdate( m_uniforms, true );
				} else {
					markUniformsLightsNeedsUpdate( m_uniforms, false );
				}

			}

			if ( material instanceof THREE.MeshBasicMaterial ||
				 material instanceof THREE.MeshLambertMaterial ||
				 material instanceof THREE.MeshPhongMaterial ) {

				refreshUniformsCommon( m_uniforms, material );

			}

			// refresh single material specific uniforms

			if ( material instanceof THREE.LineBasicMaterial ) {

				refreshUniformsLine( m_uniforms, material );

			} else if ( material instanceof THREE.LineDashedMaterial ) {

				refreshUniformsLine( m_uniforms, material );
				refreshUniformsDash( m_uniforms, material );

			} else if ( material instanceof THREE.PointCloudMaterial ) {

				refreshUniformsParticle( m_uniforms, material );

			} else if ( material instanceof THREE.MeshPhongMaterial ) {

				refreshUniformsPhong( m_uniforms, material );

			} else if ( material instanceof THREE.MeshLambertMaterial ) {

				refreshUniformsLambert( m_uniforms, material );

			} else if ( material instanceof THREE.MeshDepthMaterial ) {

				m_uniforms.mNear.value = camera.near;
				m_uniforms.mFar.value = camera.far;
				m_uniforms.opacity.value = material.opacity;

			} else if ( material instanceof THREE.MeshNormalMaterial ) {

				m_uniforms.opacity.value = material.opacity;

			}

			if ( object.receiveShadow && ! material._shadowPass ) {

				refreshUniformsShadow( m_uniforms, lights );

			}

			// load common uniforms

			loadUniformsGeneric( material.uniformsList );

		}

		loadUniformsMatrices( p_uniforms, object );

		if ( p_uniforms.modelMatrix !== null ) {

			_gl.uniformMatrix4fv( p_uniforms.modelMatrix, false, object.matrixWorld.elements );

		}

		return program;

	}

	// Uniforms (refresh uniforms objects)

	function refreshUniformsCommon ( uniforms, material ) {

		uniforms.opacity.value = material.opacity;

		if ( _this.gammaInput ) {

			uniforms.diffuse.value.copyGammaToLinear( material.color );

		} else {

			uniforms.diffuse.value = material.color;

		}

		uniforms.map.value = material.map;
		uniforms.lightMap.value = material.lightMap;
		uniforms.specularMap.value = material.specularMap;
		uniforms.alphaMap.value = material.alphaMap;

		if ( material.bumpMap ) {

			uniforms.bumpMap.value = material.bumpMap;
			uniforms.bumpScale.value = material.bumpScale;

		}

		if ( material.normalMap ) {

			uniforms.normalMap.value = material.normalMap;
			uniforms.normalScale.value.copy( material.normalScale );

		}

		// uv repeat and offset setting priorities
		//  1. color map
		//  2. specular map
		//  3. normal map
		//  4. bump map
		//  5. alpha map

		var uvScaleMap;

		if ( material.map ) {

			uvScaleMap = material.map;

		} else if ( material.specularMap ) {

			uvScaleMap = material.specularMap;

		} else if ( material.normalMap ) {

			uvScaleMap = material.normalMap;

		} else if ( material.bumpMap ) {

			uvScaleMap = material.bumpMap;

		} else if ( material.alphaMap ) {

			uvScaleMap = material.alphaMap;

		}

		if ( uvScaleMap !== undefined ) {

			var offset = uvScaleMap.offset;
			var repeat = uvScaleMap.repeat;

			uniforms.offsetRepeat.value.set( offset.x, offset.y, repeat.x, repeat.y );

		}

		uniforms.envMap.value = material.envMap;
		uniforms.flipEnvMap.value = ( material.envMap instanceof THREE.WebGLRenderTargetCube ) ? 1 : - 1;

		if ( _this.gammaInput ) {

			//uniforms.reflectivity.value = material.reflectivity * material.reflectivity;
			uniforms.reflectivity.value = material.reflectivity;

		} else {

			uniforms.reflectivity.value = material.reflectivity;

		}

		uniforms.refractionRatio.value = material.refractionRatio;
		uniforms.combine.value = material.combine;
		uniforms.useRefract.value = material.envMap && material.envMap.mapping instanceof THREE.CubeRefractionMapping;

	}

	function refreshUniformsLine ( uniforms, material ) {

		uniforms.diffuse.value = material.color;
		uniforms.opacity.value = material.opacity;

	}

	function refreshUniformsDash ( uniforms, material ) {

		uniforms.dashSize.value = material.dashSize;
		uniforms.totalSize.value = material.dashSize + material.gapSize;
		uniforms.scale.value = material.scale;

	}

	function refreshUniformsParticle ( uniforms, material ) {

		uniforms.psColor.value = material.color;
		uniforms.opacity.value = material.opacity;
		uniforms.size.value = material.size;
		uniforms.scale.value = _canvas.height / 2.0; // TODO: Cache this.

		uniforms.map.value = material.map;

	}

	function refreshUniformsFog ( uniforms, fog ) {

		uniforms.fogColor.value = fog.color;

		if ( fog instanceof THREE.Fog ) {

			uniforms.fogNear.value = fog.near;
			uniforms.fogFar.value = fog.far;

		} else if ( fog instanceof THREE.FogExp2 ) {

			uniforms.fogDensity.value = fog.density;

		}

	}

	function refreshUniformsPhong ( uniforms, material ) {

		uniforms.shininess.value = material.shininess;

		if ( _this.gammaInput ) {

			uniforms.ambient.value.copyGammaToLinear( material.ambient );
			uniforms.emissive.value.copyGammaToLinear( material.emissive );
			uniforms.specular.value.copyGammaToLinear( material.specular );

		} else {

			uniforms.ambient.value = material.ambient;
			uniforms.emissive.value = material.emissive;
			uniforms.specular.value = material.specular;

		}

		if ( material.wrapAround ) {

			uniforms.wrapRGB.value.copy( material.wrapRGB );

		}

	}

	function refreshUniformsLambert ( uniforms, material ) {

		if ( _this.gammaInput ) {

			uniforms.ambient.value.copyGammaToLinear( material.ambient );
			uniforms.emissive.value.copyGammaToLinear( material.emissive );

		} else {

			uniforms.ambient.value = material.ambient;
			uniforms.emissive.value = material.emissive;

		}

		if ( material.wrapAround ) {

			uniforms.wrapRGB.value.copy( material.wrapRGB );

		}

	}

	function refreshUniformsLights ( uniforms, lights ) {

		uniforms.ambientLightColor.value = lights.ambient;

		uniforms.directionalLightColor.value = lights.directional.colors;
		uniforms.directionalLightDirection.value = lights.directional.positions;

		uniforms.pointLightColor.value = lights.point.colors;
		uniforms.pointLightPosition.value = lights.point.positions;
		uniforms.pointLightDistance.value = lights.point.distances;

		uniforms.spotLightColor.value = lights.spot.colors;
		uniforms.spotLightPosition.value = lights.spot.positions;
		uniforms.spotLightDistance.value = lights.spot.distances;
		uniforms.spotLightDirection.value = lights.spot.directions;
		uniforms.spotLightAngleCos.value = lights.spot.anglesCos;
		uniforms.spotLightExponent.value = lights.spot.exponents;

		uniforms.hemisphereLightSkyColor.value = lights.hemi.skyColors;
		uniforms.hemisphereLightGroundColor.value = lights.hemi.groundColors;
		uniforms.hemisphereLightDirection.value = lights.hemi.positions;

	}

	// If uniforms are marked as clean, they don't need to be loaded to the GPU.

	function markUniformsLightsNeedsUpdate ( uniforms, boolean ) {

		uniforms.ambientLightColor.needsUpdate = boolean;

		uniforms.directionalLightColor.needsUpdate = boolean;
		uniforms.directionalLightDirection.needsUpdate = boolean;

		uniforms.pointLightColor.needsUpdate = boolean;
		uniforms.pointLightPosition.needsUpdate = boolean;
		uniforms.pointLightDistance.needsUpdate = boolean;

		uniforms.spotLightColor.needsUpdate = boolean;
		uniforms.spotLightPosition.needsUpdate = boolean;
		uniforms.spotLightDistance.needsUpdate = boolean;
		uniforms.spotLightDirection.needsUpdate = boolean;
		uniforms.spotLightAngleCos.needsUpdate = boolean;
		uniforms.spotLightExponent.needsUpdate = boolean;

		uniforms.hemisphereLightSkyColor.needsUpdate = boolean;
		uniforms.hemisphereLightGroundColor.needsUpdate = boolean;
		uniforms.hemisphereLightDirection.needsUpdate = boolean;

	}

	function refreshUniformsShadow ( uniforms, lights ) {

		if ( uniforms.shadowMatrix ) {

			var j = 0;

			for ( var i = 0, il = lights.length; i < il; i ++ ) {

				var light = lights[ i ];

				if ( ! light.castShadow ) continue;

				if ( light instanceof THREE.SpotLight || ( light instanceof THREE.DirectionalLight && ! light.shadowCascade ) ) {

					uniforms.shadowMap.value[ j ] = light.shadowMap;
					uniforms.shadowMapSize.value[ j ] = light.shadowMapSize;

					uniforms.shadowMatrix.value[ j ] = light.shadowMatrix;

					uniforms.shadowDarkness.value[ j ] = light.shadowDarkness;
					uniforms.shadowBias.value[ j ] = light.shadowBias;

					j ++;

				}

			}

		}

	}

	// Uniforms (load to GPU)

	function loadUniformsMatrices ( uniforms, object ) {

		_gl.uniformMatrix4fv( uniforms.modelViewMatrix, false, object._modelViewMatrix.elements );

		if ( uniforms.normalMatrix ) {

			_gl.uniformMatrix3fv( uniforms.normalMatrix, false, object._normalMatrix.elements );

		}

	}

	function getTextureUnit() {

		var textureUnit = _usedTextureUnits;

		if ( textureUnit >= _maxTextures ) {

			console.warn( 'WebGLRenderer: trying to use ' + textureUnit + ' texture units while this GPU supports only ' + _maxTextures );

		}

		_usedTextureUnits += 1;

		return textureUnit;

	}

	function loadUniformsGeneric ( uniforms ) {

		var texture, textureUnit, offset;

		for ( var j = 0, jl = uniforms.length; j < jl; j ++ ) {

			var uniform = uniforms[ j ][ 0 ];

			// needsUpdate property is not added to all uniforms.
			if ( uniform.needsUpdate === false ) continue;

			var type = uniform.type;
			var value = uniform.value;
			var location = uniforms[ j ][ 1 ];

			switch ( type ) {

				case '1i':
					_gl.uniform1i( location, value );
					break;

				case '1f':
					_gl.uniform1f( location, value );
					break;

				case '2f':
					_gl.uniform2f( location, value[ 0 ], value[ 1 ] );
					break;

				case '3f':
					_gl.uniform3f( location, value[ 0 ], value[ 1 ], value[ 2 ] );
					break;

				case '4f':
					_gl.uniform4f( location, value[ 0 ], value[ 1 ], value[ 2 ], value[ 3 ] );
					break;

				case '1iv':
					_gl.uniform1iv( location, value );
					break;

				case '3iv':
					_gl.uniform3iv( location, value );
					break;

				case '1fv':
					_gl.uniform1fv( location, value );
					break;

				case '2fv':
					_gl.uniform2fv( location, value );
					break;

				case '3fv':
					_gl.uniform3fv( location, value );
					break;

				case '4fv':
					_gl.uniform4fv( location, value );
					break;

				case 'Matrix3fv':
					_gl.uniformMatrix3fv( location, false, value );
					break;

				case 'Matrix4fv':
					_gl.uniformMatrix4fv( location, false, value );
					break;

				//

				case 'i':

					// single integer
					_gl.uniform1i( location, value );

					break;

				case 'f':

					// single float
					_gl.uniform1f( location, value );

					break;

				case 'v2':

					// single THREE.Vector2
					_gl.uniform2f( location, value.x, value.y );

					break;

				case 'v3':

					// single THREE.Vector3
					_gl.uniform3f( location, value.x, value.y, value.z );

					break;

				case 'v4':

					// single THREE.Vector4
					_gl.uniform4f( location, value.x, value.y, value.z, value.w );

					break;

				case 'c':

					// single THREE.Color
					_gl.uniform3f( location, value.r, value.g, value.b );

					break;

				case 'iv1':

					// flat array of integers (JS or typed array)
					_gl.uniform1iv( location, value );

					break;

				case 'iv':

					// flat array of integers with 3 x N size (JS or typed array)
					_gl.uniform3iv( location, value );

					break;

				case 'fv1':

					// flat array of floats (JS or typed array)
					_gl.uniform1fv( location, value );

					break;

				case 'fv':

					// flat array of floats with 3 x N size (JS or typed array)
					_gl.uniform3fv( location, value );

					break;

				case 'v2v':

					// array of THREE.Vector2

					if ( uniform._array === undefined ) {

						uniform._array = new Float32Array( 2 * value.length );

					}

					for ( var i = 0, il = value.length; i < il; i ++ ) {

						offset = i * 2;

						uniform._array[ offset ]   = value[ i ].x;
						uniform._array[ offset + 1 ] = value[ i ].y;

					}

					_gl.uniform2fv( location, uniform._array );

					break;

				case 'v3v':

					// array of THREE.Vector3

					if ( uniform._array === undefined ) {

						uniform._array = new Float32Array( 3 * value.length );

					}

					for ( var i = 0, il = value.length; i < il; i ++ ) {

						offset = i * 3;

						uniform._array[ offset ]   = value[ i ].x;
						uniform._array[ offset + 1 ] = value[ i ].y;
						uniform._array[ offset + 2 ] = value[ i ].z;

					}

					_gl.uniform3fv( location, uniform._array );

					break;

				case 'v4v':

					// array of THREE.Vector4

					if ( uniform._array === undefined ) {

						uniform._array = new Float32Array( 4 * value.length );

					}

					for ( var i = 0, il = value.length; i < il; i ++ ) {

						offset = i * 4;

						uniform._array[ offset ]   = value[ i ].x;
						uniform._array[ offset + 1 ] = value[ i ].y;
						uniform._array[ offset + 2 ] = value[ i ].z;
						uniform._array[ offset + 3 ] = value[ i ].w;

					}

					_gl.uniform4fv( location, uniform._array );

					break;

				case 'm3':

					// single THREE.Matrix3
					_gl.uniformMatrix3fv( location, false, value.elements );

					break;

				case 'm3v':

					// array of THREE.Matrix3

					if ( uniform._array === undefined ) {

						uniform._array = new Float32Array( 9 * value.length );

					}

					for ( var i = 0, il = value.length; i < il; i ++ ) {

						value[ i ].flattenToArrayOffset( uniform._array, i * 9 );

					}

					_gl.uniformMatrix3fv( location, false, uniform._array );

					break;

				case 'm4':

					// single THREE.Matrix4
					_gl.uniformMatrix4fv( location, false, value.elements );

					break;

				case 'm4v':

					// array of THREE.Matrix4

					if ( uniform._array === undefined ) {

						uniform._array = new Float32Array( 16 * value.length );

					}

					for ( var i = 0, il = value.length; i < il; i ++ ) {

						value[ i ].flattenToArrayOffset( uniform._array, i * 16 );

					}

					_gl.uniformMatrix4fv( location, false, uniform._array );

					break;

				case 't':

					// single THREE.Texture (2d or cube)

					texture = value;
					textureUnit = getTextureUnit();

					_gl.uniform1i( location, textureUnit );

					if ( ! texture ) continue;

					if ( texture instanceof THREE.CubeTexture ||
					   ( texture.image instanceof Array && texture.image.length === 6 ) ) { // CompressedTexture can have Array in image :/

						setCubeTexture( texture, textureUnit );

					} else if ( texture instanceof THREE.WebGLRenderTargetCube ) {

						setCubeTextureDynamic( texture, textureUnit );

					} else {

						_this.setTexture( texture, textureUnit );

					}

					break;

				case 'tv':

					// array of THREE.Texture (2d)

					if ( uniform._array === undefined ) {

						uniform._array = [];

					}

					for ( var i = 0, il = uniform.value.length; i < il; i ++ ) {

						uniform._array[ i ] = getTextureUnit();

					}

					_gl.uniform1iv( location, uniform._array );

					for ( var i = 0, il = uniform.value.length; i < il; i ++ ) {

						texture = uniform.value[ i ];
						textureUnit = uniform._array[ i ];

						if ( ! texture ) continue;

						_this.setTexture( texture, textureUnit );

					}

					break;

				default:

					console.warn( 'THREE.WebGLRenderer: Unknown uniform type: ' + type );

			}

		}

	}

	function setupMatrices ( object, camera ) {

		object._modelViewMatrix.multiplyMatrices( camera.matrixWorldInverse, object.matrixWorld );
		object._normalMatrix.getNormalMatrix( object._modelViewMatrix );

	}

	//

	function setColorGamma( array, offset, color, intensitySq ) {

		array[ offset ]     = color.r * color.r * intensitySq;
		array[ offset + 1 ] = color.g * color.g * intensitySq;
		array[ offset + 2 ] = color.b * color.b * intensitySq;

	}

	function setColorLinear( array, offset, color, intensity ) {

		array[ offset ]     = color.r * intensity;
		array[ offset + 1 ] = color.g * intensity;
		array[ offset + 2 ] = color.b * intensity;

	}

	function setupLights ( lights ) {

		var l, ll, light, n,
		r = 0, g = 0, b = 0,
		color, skyColor, groundColor,
		intensity,  intensitySq,
		position,
		distance,

		zlights = _lights,

		dirColors = zlights.directional.colors,
		dirPositions = zlights.directional.positions,

		pointColors = zlights.point.colors,
		pointPositions = zlights.point.positions,
		pointDistances = zlights.point.distances,

		spotColors = zlights.spot.colors,
		spotPositions = zlights.spot.positions,
		spotDistances = zlights.spot.distances,
		spotDirections = zlights.spot.directions,
		spotAnglesCos = zlights.spot.anglesCos,
		spotExponents = zlights.spot.exponents,

		hemiSkyColors = zlights.hemi.skyColors,
		hemiGroundColors = zlights.hemi.groundColors,
		hemiPositions = zlights.hemi.positions,

		dirLength = 0,
		pointLength = 0,
		spotLength = 0,
		hemiLength = 0,

		dirCount = 0,
		pointCount = 0,
		spotCount = 0,
		hemiCount = 0,

		dirOffset = 0,
		pointOffset = 0,
		spotOffset = 0,
		hemiOffset = 0;

		for ( l = 0, ll = lights.length; l < ll; l ++ ) {

			light = lights[ l ];

			if ( light.onlyShadow ) continue;

			color = light.color;
			intensity = light.intensity;
			distance = light.distance;

			if ( light instanceof THREE.AmbientLight ) {

				if ( ! light.visible ) continue;

				if ( _this.gammaInput ) {

					r += color.r * color.r;
					g += color.g * color.g;
					b += color.b * color.b;

				} else {

					r += color.r;
					g += color.g;
					b += color.b;

				}

			} else if ( light instanceof THREE.DirectionalLight ) {

				dirCount += 1;

				if ( ! light.visible ) continue;

				_direction.setFromMatrixPosition( light.matrixWorld );
				_vector3.setFromMatrixPosition( light.target.matrixWorld );
				_direction.sub( _vector3 );
				_direction.normalize();

				dirOffset = dirLength * 3;

				dirPositions[ dirOffset ]     = _direction.x;
				dirPositions[ dirOffset + 1 ] = _direction.y;
				dirPositions[ dirOffset + 2 ] = _direction.z;

				if ( _this.gammaInput ) {

					setColorGamma( dirColors, dirOffset, color, intensity * intensity );

				} else {

					setColorLinear( dirColors, dirOffset, color, intensity );

				}

				dirLength += 1;

			} else if ( light instanceof THREE.PointLight ) {

				pointCount += 1;

				if ( ! light.visible ) continue;

				pointOffset = pointLength * 3;

				if ( _this.gammaInput ) {

					setColorGamma( pointColors, pointOffset, color, intensity * intensity );

				} else {

					setColorLinear( pointColors, pointOffset, color, intensity );

				}

				_vector3.setFromMatrixPosition( light.matrixWorld );

				pointPositions[ pointOffset ]     = _vector3.x;
				pointPositions[ pointOffset + 1 ] = _vector3.y;
				pointPositions[ pointOffset + 2 ] = _vector3.z;

				pointDistances[ pointLength ] = distance;

				pointLength += 1;

			} else if ( light instanceof THREE.SpotLight ) {

				spotCount += 1;

				if ( ! light.visible ) continue;

				spotOffset = spotLength * 3;

				if ( _this.gammaInput ) {

					setColorGamma( spotColors, spotOffset, color, intensity * intensity );

				} else {

					setColorLinear( spotColors, spotOffset, color, intensity );

				}

				_direction.setFromMatrixPosition( light.matrixWorld );

				spotPositions[ spotOffset ]     = _direction.x;
				spotPositions[ spotOffset + 1 ] = _direction.y;
				spotPositions[ spotOffset + 2 ] = _direction.z;

				spotDistances[ spotLength ] = distance;

				_vector3.setFromMatrixPosition( light.target.matrixWorld );
				_direction.sub( _vector3 );
				_direction.normalize();

				spotDirections[ spotOffset ]     = _direction.x;
				spotDirections[ spotOffset + 1 ] = _direction.y;
				spotDirections[ spotOffset + 2 ] = _direction.z;

				spotAnglesCos[ spotLength ] = Math.cos( light.angle );
				spotExponents[ spotLength ] = light.exponent;

				spotLength += 1;

			} else if ( light instanceof THREE.HemisphereLight ) {

				hemiCount += 1;

				if ( ! light.visible ) continue;

				_direction.setFromMatrixPosition( light.matrixWorld );
				_direction.normalize();

				hemiOffset = hemiLength * 3;

				hemiPositions[ hemiOffset ]     = _direction.x;
				hemiPositions[ hemiOffset + 1 ] = _direction.y;
				hemiPositions[ hemiOffset + 2 ] = _direction.z;

				skyColor = light.color;
				groundColor = light.groundColor;

				if ( _this.gammaInput ) {

					intensitySq = intensity * intensity;

					setColorGamma( hemiSkyColors, hemiOffset, skyColor, intensitySq );
					setColorGamma( hemiGroundColors, hemiOffset, groundColor, intensitySq );

				} else {

					setColorLinear( hemiSkyColors, hemiOffset, skyColor, intensity );
					setColorLinear( hemiGroundColors, hemiOffset, groundColor, intensity );

				}

				hemiLength += 1;

			}

		}

		// null eventual remains from removed lights
		// (this is to avoid if in shader)

		for ( l = dirLength * 3, ll = Math.max( dirColors.length, dirCount * 3 ); l < ll; l ++ ) dirColors[ l ] = 0.0;
		for ( l = pointLength * 3, ll = Math.max( pointColors.length, pointCount * 3 ); l < ll; l ++ ) pointColors[ l ] = 0.0;
		for ( l = spotLength * 3, ll = Math.max( spotColors.length, spotCount * 3 ); l < ll; l ++ ) spotColors[ l ] = 0.0;
		for ( l = hemiLength * 3, ll = Math.max( hemiSkyColors.length, hemiCount * 3 ); l < ll; l ++ ) hemiSkyColors[ l ] = 0.0;
		for ( l = hemiLength * 3, ll = Math.max( hemiGroundColors.length, hemiCount * 3 ); l < ll; l ++ ) hemiGroundColors[ l ] = 0.0;

		zlights.directional.length = dirLength;
		zlights.point.length = pointLength;
		zlights.spot.length = spotLength;
		zlights.hemi.length = hemiLength;

		zlights.ambient[ 0 ] = r;
		zlights.ambient[ 1 ] = g;
		zlights.ambient[ 2 ] = b;

	}

	// GL state setting

	this.setFaceCulling = function ( cullFace, frontFaceDirection ) {

		if ( cullFace === THREE.CullFaceNone ) {

			_gl.disable( _gl.CULL_FACE );

		} else {

			if ( frontFaceDirection === THREE.FrontFaceDirectionCW ) {

				_gl.frontFace( _gl.CW );

			} else {

				_gl.frontFace( _gl.CCW );

			}

			if ( cullFace === THREE.CullFaceBack ) {

				_gl.cullFace( _gl.BACK );

			} else if ( cullFace === THREE.CullFaceFront ) {

				_gl.cullFace( _gl.FRONT );

			} else {

				_gl.cullFace( _gl.FRONT_AND_BACK );

			}

			_gl.enable( _gl.CULL_FACE );

		}

	};

	this.setMaterialFaces = function ( material ) {

		var doubleSided = material.side === THREE.DoubleSide;
		var flipSided = material.side === THREE.BackSide;

		if ( _oldDoubleSided !== doubleSided ) {

			if ( doubleSided ) {

				_gl.disable( _gl.CULL_FACE );

			} else {

				_gl.enable( _gl.CULL_FACE );

			}

			_oldDoubleSided = doubleSided;

		}

		if ( _oldFlipSided !== flipSided ) {

			if ( flipSided ) {

				_gl.frontFace( _gl.CW );

			} else {

				_gl.frontFace( _gl.CCW );

			}

			_oldFlipSided = flipSided;

		}

	};

	this.setDepthTest = function ( depthTest ) {

		if ( _oldDepthTest !== depthTest ) {

			if ( depthTest ) {

				_gl.enable( _gl.DEPTH_TEST );

			} else {

				_gl.disable( _gl.DEPTH_TEST );

			}

			_oldDepthTest = depthTest;

		}

	};

	this.setDepthWrite = function ( depthWrite ) {

		if ( _oldDepthWrite !== depthWrite ) {

			_gl.depthMask( depthWrite );
			_oldDepthWrite = depthWrite;

		}

	};

	function setLineWidth ( width ) {

		if ( width !== _oldLineWidth ) {

			_gl.lineWidth( width );

			_oldLineWidth = width;

		}

	}

	function setPolygonOffset ( polygonoffset, factor, units ) {

		if ( _oldPolygonOffset !== polygonoffset ) {

			if ( polygonoffset ) {

				_gl.enable( _gl.POLYGON_OFFSET_FILL );

			} else {

				_gl.disable( _gl.POLYGON_OFFSET_FILL );

			}

			_oldPolygonOffset = polygonoffset;

		}

		if ( polygonoffset && ( _oldPolygonOffsetFactor !== factor || _oldPolygonOffsetUnits !== units ) ) {

			_gl.polygonOffset( factor, units );

			_oldPolygonOffsetFactor = factor;
			_oldPolygonOffsetUnits = units;

		}

	}

	this.setBlending = function ( blending, blendEquation, blendSrc, blendDst ) {

		if ( blending !== _oldBlending ) {

			if ( blending === THREE.NoBlending ) {

				_gl.disable( _gl.BLEND );

			} else if ( blending === THREE.AdditiveBlending ) {

				_gl.enable( _gl.BLEND );
				_gl.blendEquation( _gl.FUNC_ADD );
				_gl.blendFunc( _gl.SRC_ALPHA, _gl.ONE );

			} else if ( blending === THREE.SubtractiveBlending ) {

				// TODO: Find blendFuncSeparate() combination
				_gl.enable( _gl.BLEND );
				_gl.blendEquation( _gl.FUNC_ADD );
				_gl.blendFunc( _gl.ZERO, _gl.ONE_MINUS_SRC_COLOR );

			} else if ( blending === THREE.MultiplyBlending ) {

				// TODO: Find blendFuncSeparate() combination
				_gl.enable( _gl.BLEND );
				_gl.blendEquation( _gl.FUNC_ADD );
				_gl.blendFunc( _gl.ZERO, _gl.SRC_COLOR );

			} else if ( blending === THREE.CustomBlending ) {

				_gl.enable( _gl.BLEND );

			} else {

				_gl.enable( _gl.BLEND );
				_gl.blendEquationSeparate( _gl.FUNC_ADD, _gl.FUNC_ADD );
				_gl.blendFuncSeparate( _gl.SRC_ALPHA, _gl.ONE_MINUS_SRC_ALPHA, _gl.ONE, _gl.ONE_MINUS_SRC_ALPHA );

			}

			_oldBlending = blending;

		}

		if ( blending === THREE.CustomBlending ) {

			if ( blendEquation !== _oldBlendEquation ) {

				_gl.blendEquation( paramThreeToGL( blendEquation ) );

				_oldBlendEquation = blendEquation;

			}

			if ( blendSrc !== _oldBlendSrc || blendDst !== _oldBlendDst ) {

				_gl.blendFunc( paramThreeToGL( blendSrc ), paramThreeToGL( blendDst ) );

				_oldBlendSrc = blendSrc;
				_oldBlendDst = blendDst;

			}

		} else {

			_oldBlendEquation = null;
			_oldBlendSrc = null;
			_oldBlendDst = null;

		}

	};

	// Textures

	function setTextureParameters ( textureType, texture, isImagePowerOfTwo ) {

		var extension;

		if ( isImagePowerOfTwo ) {

			_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_S, paramThreeToGL( texture.wrapS ) );
			_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_T, paramThreeToGL( texture.wrapT ) );

			_gl.texParameteri( textureType, _gl.TEXTURE_MAG_FILTER, paramThreeToGL( texture.magFilter ) );
			_gl.texParameteri( textureType, _gl.TEXTURE_MIN_FILTER, paramThreeToGL( texture.minFilter ) );

		} else {

			_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_S, _gl.CLAMP_TO_EDGE );
			_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_T, _gl.CLAMP_TO_EDGE );

			_gl.texParameteri( textureType, _gl.TEXTURE_MAG_FILTER, filterFallback( texture.magFilter ) );
			_gl.texParameteri( textureType, _gl.TEXTURE_MIN_FILTER, filterFallback( texture.minFilter ) );

		}

		extension = extensions.get( 'EXT_texture_filter_anisotropic' );

		if ( extension && texture.type !== THREE.FloatType ) {

			if ( texture.anisotropy > 1 || texture.__oldAnisotropy ) {

				_gl.texParameterf( textureType, extension.TEXTURE_MAX_ANISOTROPY_EXT, Math.min( texture.anisotropy, _this.getMaxAnisotropy() ) );
				texture.__oldAnisotropy = texture.anisotropy;

			}

		}

	}

	this.uploadTexture = function ( texture ) {

		if ( texture.__webglInit === undefined ) {

			texture.__webglInit = true;

			texture.addEventListener( 'dispose', onTextureDispose );

			texture.__webglTexture = _gl.createTexture();

			_this.info.memory.textures ++;

		}

		_gl.bindTexture( _gl.TEXTURE_2D, texture.__webglTexture );

		_gl.pixelStorei( _gl.UNPACK_FLIP_Y_WEBGL, texture.flipY );
		_gl.pixelStorei( _gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, texture.premultiplyAlpha );
		_gl.pixelStorei( _gl.UNPACK_ALIGNMENT, texture.unpackAlignment );

		texture.image = clampToMaxSize( texture.image, _maxTextureSize );

		var image = texture.image,
		isImagePowerOfTwo = THREE.Math.isPowerOfTwo( image.width ) && THREE.Math.isPowerOfTwo( image.height ),
		glFormat = paramThreeToGL( texture.format ),
		glType = paramThreeToGL( texture.type );

		setTextureParameters( _gl.TEXTURE_2D, texture, isImagePowerOfTwo );

		var mipmap, mipmaps = texture.mipmaps;

		if ( texture instanceof THREE.DataTexture ) {

			// use manually created mipmaps if available
			// if there are no manual mipmaps
			// set 0 level mipmap and then use GL to generate other mipmap levels

			if ( mipmaps.length > 0 && isImagePowerOfTwo ) {

				for ( var i = 0, il = mipmaps.length; i < il; i ++ ) {

					mipmap = mipmaps[ i ];
					_gl.texImage2D( _gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data );

				}

				texture.generateMipmaps = false;

			} else {

				_gl.texImage2D( _gl.TEXTURE_2D, 0, glFormat, image.width, image.height, 0, glFormat, glType, image.data );

			}

		} else if ( texture instanceof THREE.CompressedTexture ) {

			for ( var i = 0, il = mipmaps.length; i < il; i ++ ) {

				mipmap = mipmaps[ i ];

				if ( texture.format !== THREE.RGBAFormat && texture.format !== THREE.RGBFormat ) {

					if ( getCompressedTextureFormats().indexOf( glFormat ) > -1 ) {

						_gl.compressedTexImage2D( _gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, mipmap.data );

					} else {

						console.warn( "Attempt to load unsupported compressed texture format" );

					}

				} else {

					_gl.texImage2D( _gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data );

				}

			}

		} else { // regular Texture (image, video, canvas)

			// use manually created mipmaps if available
			// if there are no manual mipmaps
			// set 0 level mipmap and then use GL to generate other mipmap levels

			if ( mipmaps.length > 0 && isImagePowerOfTwo ) {

				for ( var i = 0, il = mipmaps.length; i < il; i ++ ) {

					mipmap = mipmaps[ i ];
					_gl.texImage2D( _gl.TEXTURE_2D, i, glFormat, glFormat, glType, mipmap );

				}

				texture.generateMipmaps = false;

			} else {

				_gl.texImage2D( _gl.TEXTURE_2D, 0, glFormat, glFormat, glType, texture.image );

			}

		}

		if ( texture.generateMipmaps && isImagePowerOfTwo ) _gl.generateMipmap( _gl.TEXTURE_2D );

		texture.needsUpdate = false;

		if ( texture.onUpdate ) texture.onUpdate();

	};

	this.setTexture = function ( texture, slot ) {

		_gl.activeTexture( _gl.TEXTURE0 + slot );

		if ( texture.needsUpdate ) {

			_this.uploadTexture( texture );

		} else {

			_gl.bindTexture( _gl.TEXTURE_2D, texture.__webglTexture );

		}

	};

	function clampToMaxSize ( image, maxSize ) {

		if ( image.width > maxSize || image.height > maxSize ) {

			// Warning: Scaling through the canvas will only work with images that use
			// premultiplied alpha.

			var scale = maxSize / Math.max( image.width, image.height );

			var canvas = document.createElement( 'canvas' );
			canvas.width = Math.floor( image.width * scale );
			canvas.height = Math.floor( image.height * scale );

			var context = canvas.getContext( '2d' );
			context.drawImage( image, 0, 0, image.width, image.height, 0, 0, canvas.width, canvas.height );

			console.log( 'THREE.WebGLRenderer:', image, 'is too big (' + image.width + 'x' + image.height + '). Resized to ' + canvas.width + 'x' + canvas.height + '.' );

			return canvas;

		}

		return image;

	}

	function setCubeTexture ( texture, slot ) {

		if ( texture.image.length === 6 ) {

			if ( texture.needsUpdate ) {

				if ( ! texture.image.__webglTextureCube ) {

					texture.addEventListener( 'dispose', onTextureDispose );

					texture.image.__webglTextureCube = _gl.createTexture();

					_this.info.memory.textures ++;

				}

				_gl.activeTexture( _gl.TEXTURE0 + slot );
				_gl.bindTexture( _gl.TEXTURE_CUBE_MAP, texture.image.__webglTextureCube );

				_gl.pixelStorei( _gl.UNPACK_FLIP_Y_WEBGL, texture.flipY );

				var isCompressed = texture instanceof THREE.CompressedTexture;
				var isDataTexture = texture.image[ 0 ] instanceof THREE.DataTexture;

				var cubeImage = [];

				for ( var i = 0; i < 6; i ++ ) {

					if ( _this.autoScaleCubemaps && ! isCompressed && ! isDataTexture ) {

						cubeImage[ i ] = clampToMaxSize( texture.image[ i ], _maxCubemapSize );

					} else {

						cubeImage[ i ] = isDataTexture ? texture.image[ i ].image : texture.image[ i ];

					}

				}

				var image = cubeImage[ 0 ],
				isImagePowerOfTwo = THREE.Math.isPowerOfTwo( image.width ) && THREE.Math.isPowerOfTwo( image.height ),
				glFormat = paramThreeToGL( texture.format ),
				glType = paramThreeToGL( texture.type );

				setTextureParameters( _gl.TEXTURE_CUBE_MAP, texture, isImagePowerOfTwo );

				for ( var i = 0; i < 6; i ++ ) {

					if ( ! isCompressed ) {

						if ( isDataTexture ) {

							_gl.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, cubeImage[ i ].width, cubeImage[ i ].height, 0, glFormat, glType, cubeImage[ i ].data );

						} else {

							_gl.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, glFormat, glType, cubeImage[ i ] );

						}

					} else {

						var mipmap, mipmaps = cubeImage[ i ].mipmaps;

						for ( var j = 0, jl = mipmaps.length; j < jl; j ++ ) {

							mipmap = mipmaps[ j ];

							if ( texture.format !== THREE.RGBAFormat && texture.format !== THREE.RGBFormat ) {

								if ( getCompressedTextureFormats().indexOf( glFormat ) > -1 ) {

									_gl.compressedTexImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glFormat, mipmap.width, mipmap.height, 0, mipmap.data );

								} else {

									console.warn( "Attempt to load unsupported compressed texture format" );

								}

							} else {

								_gl.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data );

							}

						}

					}

				}

				if ( texture.generateMipmaps && isImagePowerOfTwo ) {

					_gl.generateMipmap( _gl.TEXTURE_CUBE_MAP );

				}

				texture.needsUpdate = false;

				if ( texture.onUpdate ) texture.onUpdate();

			} else {

				_gl.activeTexture( _gl.TEXTURE0 + slot );
				_gl.bindTexture( _gl.TEXTURE_CUBE_MAP, texture.image.__webglTextureCube );

			}

		}

	}

	function setCubeTextureDynamic ( texture, slot ) {

		_gl.activeTexture( _gl.TEXTURE0 + slot );
		_gl.bindTexture( _gl.TEXTURE_CUBE_MAP, texture.__webglTexture );

	}

	// Render targets

	function setupFrameBuffer ( framebuffer, renderTarget, textureTarget ) {

		_gl.bindFramebuffer( _gl.FRAMEBUFFER, framebuffer );
		_gl.framebufferTexture2D( _gl.FRAMEBUFFER, _gl.COLOR_ATTACHMENT0, textureTarget, renderTarget.__webglTexture, 0 );

	}

	function setupRenderBuffer ( renderbuffer, renderTarget  ) {

		_gl.bindRenderbuffer( _gl.RENDERBUFFER, renderbuffer );

		if ( renderTarget.depthBuffer && ! renderTarget.stencilBuffer ) {

			_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.DEPTH_COMPONENT16, renderTarget.width, renderTarget.height );
			_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer );

		/* For some reason this is not working. Defaulting to RGBA4.
		} else if ( ! renderTarget.depthBuffer && renderTarget.stencilBuffer ) {

			_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.STENCIL_INDEX8, renderTarget.width, renderTarget.height );
			_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer );
		*/
		} else if ( renderTarget.depthBuffer && renderTarget.stencilBuffer ) {

			_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.DEPTH_STENCIL, renderTarget.width, renderTarget.height );
			_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer );

		} else {

			_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.RGBA4, renderTarget.width, renderTarget.height );

		}

	}

	this.setRenderTarget = function ( renderTarget ) {

		var isCube = ( renderTarget instanceof THREE.WebGLRenderTargetCube );

		if ( renderTarget && renderTarget.__webglFramebuffer === undefined ) {

			if ( renderTarget.depthBuffer === undefined ) renderTarget.depthBuffer = true;
			if ( renderTarget.stencilBuffer === undefined ) renderTarget.stencilBuffer = true;

			renderTarget.addEventListener( 'dispose', onRenderTargetDispose );

			renderTarget.__webglTexture = _gl.createTexture();

			_this.info.memory.textures ++;

			// Setup texture, create render and frame buffers

			var isTargetPowerOfTwo = THREE.Math.isPowerOfTwo( renderTarget.width ) && THREE.Math.isPowerOfTwo( renderTarget.height ),
				glFormat = paramThreeToGL( renderTarget.format ),
				glType = paramThreeToGL( renderTarget.type );

			if ( isCube ) {

				renderTarget.__webglFramebuffer = [];
				renderTarget.__webglRenderbuffer = [];

				_gl.bindTexture( _gl.TEXTURE_CUBE_MAP, renderTarget.__webglTexture );
				setTextureParameters( _gl.TEXTURE_CUBE_MAP, renderTarget, isTargetPowerOfTwo );

				for ( var i = 0; i < 6; i ++ ) {

					renderTarget.__webglFramebuffer[ i ] = _gl.createFramebuffer();
					renderTarget.__webglRenderbuffer[ i ] = _gl.createRenderbuffer();

					_gl.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, renderTarget.width, renderTarget.height, 0, glFormat, glType, null );

					setupFrameBuffer( renderTarget.__webglFramebuffer[ i ], renderTarget, _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i );
					setupRenderBuffer( renderTarget.__webglRenderbuffer[ i ], renderTarget );

				}

				if ( isTargetPowerOfTwo ) _gl.generateMipmap( _gl.TEXTURE_CUBE_MAP );

			} else {

				renderTarget.__webglFramebuffer = _gl.createFramebuffer();

				if ( renderTarget.shareDepthFrom ) {

					renderTarget.__webglRenderbuffer = renderTarget.shareDepthFrom.__webglRenderbuffer;

				} else {

					renderTarget.__webglRenderbuffer = _gl.createRenderbuffer();

				}

				_gl.bindTexture( _gl.TEXTURE_2D, renderTarget.__webglTexture );
				setTextureParameters( _gl.TEXTURE_2D, renderTarget, isTargetPowerOfTwo );

				_gl.texImage2D( _gl.TEXTURE_2D, 0, glFormat, renderTarget.width, renderTarget.height, 0, glFormat, glType, null );

				setupFrameBuffer( renderTarget.__webglFramebuffer, renderTarget, _gl.TEXTURE_2D );

				if ( renderTarget.shareDepthFrom ) {

					if ( renderTarget.depthBuffer && ! renderTarget.stencilBuffer ) {

						_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.RENDERBUFFER, renderTarget.__webglRenderbuffer );

					} else if ( renderTarget.depthBuffer && renderTarget.stencilBuffer ) {

						_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderTarget.__webglRenderbuffer );

					}

				} else {

					setupRenderBuffer( renderTarget.__webglRenderbuffer, renderTarget );

				}

				if ( isTargetPowerOfTwo ) _gl.generateMipmap( _gl.TEXTURE_2D );

			}

			// Release everything

			if ( isCube ) {

				_gl.bindTexture( _gl.TEXTURE_CUBE_MAP, null );

			} else {

				_gl.bindTexture( _gl.TEXTURE_2D, null );

			}

			_gl.bindRenderbuffer( _gl.RENDERBUFFER, null );
			_gl.bindFramebuffer( _gl.FRAMEBUFFER, null );

		}

		var framebuffer, width, height, vx, vy;

		if ( renderTarget ) {

			if ( isCube ) {

				framebuffer = renderTarget.__webglFramebuffer[ renderTarget.activeCubeFace ];

			} else {

				framebuffer = renderTarget.__webglFramebuffer;

			}

			width = renderTarget.width;
			height = renderTarget.height;

			vx = 0;
			vy = 0;

		} else {

			framebuffer = null;

			width = _viewportWidth;
			height = _viewportHeight;

			vx = _viewportX;
			vy = _viewportY;

		}

		if ( framebuffer !== _currentFramebuffer ) {

			_gl.bindFramebuffer( _gl.FRAMEBUFFER, framebuffer );
			_gl.viewport( vx, vy, width, height );

			_currentFramebuffer = framebuffer;

		}

		_currentWidth = width;
		_currentHeight = height;

	};

	function updateRenderTargetMipmap ( renderTarget ) {

		if ( renderTarget instanceof THREE.WebGLRenderTargetCube ) {

			_gl.bindTexture( _gl.TEXTURE_CUBE_MAP, renderTarget.__webglTexture );
			_gl.generateMipmap( _gl.TEXTURE_CUBE_MAP );
			_gl.bindTexture( _gl.TEXTURE_CUBE_MAP, null );

		} else {

			_gl.bindTexture( _gl.TEXTURE_2D, renderTarget.__webglTexture );
			_gl.generateMipmap( _gl.TEXTURE_2D );
			_gl.bindTexture( _gl.TEXTURE_2D, null );

		}

	}

	// Fallback filters for non-power-of-2 textures

	function filterFallback ( f ) {

		if ( f === THREE.NearestFilter || f === THREE.NearestMipMapNearestFilter || f === THREE.NearestMipMapLinearFilter ) {

			return _gl.NEAREST;

		}

		return _gl.LINEAR;

	}

	// Map three.js constants to WebGL constants

	function paramThreeToGL ( p ) {

		var extension;

		if ( p === THREE.RepeatWrapping ) return _gl.REPEAT;
		if ( p === THREE.ClampToEdgeWrapping ) return _gl.CLAMP_TO_EDGE;
		if ( p === THREE.MirroredRepeatWrapping ) return _gl.MIRRORED_REPEAT;

		if ( p === THREE.NearestFilter ) return _gl.NEAREST;
		if ( p === THREE.NearestMipMapNearestFilter ) return _gl.NEAREST_MIPMAP_NEAREST;
		if ( p === THREE.NearestMipMapLinearFilter ) return _gl.NEAREST_MIPMAP_LINEAR;

		if ( p === THREE.LinearFilter ) return _gl.LINEAR;
		if ( p === THREE.LinearMipMapNearestFilter ) return _gl.LINEAR_MIPMAP_NEAREST;
		if ( p === THREE.LinearMipMapLinearFilter ) return _gl.LINEAR_MIPMAP_LINEAR;

		if ( p === THREE.UnsignedByteType ) return _gl.UNSIGNED_BYTE;
		if ( p === THREE.UnsignedShort4444Type ) return _gl.UNSIGNED_SHORT_4_4_4_4;
		if ( p === THREE.UnsignedShort5551Type ) return _gl.UNSIGNED_SHORT_5_5_5_1;
		if ( p === THREE.UnsignedShort565Type ) return _gl.UNSIGNED_SHORT_5_6_5;

		if ( p === THREE.ByteType ) return _gl.BYTE;
		if ( p === THREE.ShortType ) return _gl.SHORT;
		if ( p === THREE.UnsignedShortType ) return _gl.UNSIGNED_SHORT;
		if ( p === THREE.IntType ) return _gl.INT;
		if ( p === THREE.UnsignedIntType ) return _gl.UNSIGNED_INT;
		if ( p === THREE.FloatType ) return _gl.FLOAT;

		if ( p === THREE.AlphaFormat ) return _gl.ALPHA;
		if ( p === THREE.RGBFormat ) return _gl.RGB;
		if ( p === THREE.RGBAFormat ) return _gl.RGBA;
		if ( p === THREE.LuminanceFormat ) return _gl.LUMINANCE;
		if ( p === THREE.LuminanceAlphaFormat ) return _gl.LUMINANCE_ALPHA;

		if ( p === THREE.AddEquation ) return _gl.FUNC_ADD;
		if ( p === THREE.SubtractEquation ) return _gl.FUNC_SUBTRACT;
		if ( p === THREE.ReverseSubtractEquation ) return _gl.FUNC_REVERSE_SUBTRACT;

		if ( p === THREE.ZeroFactor ) return _gl.ZERO;
		if ( p === THREE.OneFactor ) return _gl.ONE;
		if ( p === THREE.SrcColorFactor ) return _gl.SRC_COLOR;
		if ( p === THREE.OneMinusSrcColorFactor ) return _gl.ONE_MINUS_SRC_COLOR;
		if ( p === THREE.SrcAlphaFactor ) return _gl.SRC_ALPHA;
		if ( p === THREE.OneMinusSrcAlphaFactor ) return _gl.ONE_MINUS_SRC_ALPHA;
		if ( p === THREE.DstAlphaFactor ) return _gl.DST_ALPHA;
		if ( p === THREE.OneMinusDstAlphaFactor ) return _gl.ONE_MINUS_DST_ALPHA;

		if ( p === THREE.DstColorFactor ) return _gl.DST_COLOR;
		if ( p === THREE.OneMinusDstColorFactor ) return _gl.ONE_MINUS_DST_COLOR;
		if ( p === THREE.SrcAlphaSaturateFactor ) return _gl.SRC_ALPHA_SATURATE;

		extension = extensions.get( 'WEBGL_compressed_texture_s3tc' );

		if ( extension !== null ) {

			if ( p === THREE.RGB_S3TC_DXT1_Format ) return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;
			if ( p === THREE.RGBA_S3TC_DXT1_Format ) return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;
			if ( p === THREE.RGBA_S3TC_DXT3_Format ) return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;
			if ( p === THREE.RGBA_S3TC_DXT5_Format ) return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT;

		}

		extension = extensions.get( 'WEBGL_compressed_texture_pvrtc' );

		if ( extension !== null ) {

			if ( p === THREE.RGB_PVRTC_4BPPV1_Format ) return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;
			if ( p === THREE.RGB_PVRTC_2BPPV1_Format ) return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;
			if ( p === THREE.RGBA_PVRTC_4BPPV1_Format ) return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;
			if ( p === THREE.RGBA_PVRTC_2BPPV1_Format ) return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;

		}

		extension = extensions.get( 'EXT_blend_minmax' );

		if ( extension !== null ) {

			if ( p === THREE.MinEquation ) return extension.MIN_EXT;
			if ( p === THREE.MaxEquation ) return extension.MAX_EXT;

		}

		return 0;

	}

	// Allocations

	function allocateBones ( object ) {

		if ( _supportsBoneTextures && object && object.skeleton && object.skeleton.useVertexTexture ) {

			return 1024;

		} else {

			// default for when object is not specified
			// ( for example when prebuilding shader
			//   to be used with multiple objects )
			//
			//  - leave some extra space for other uniforms
			//  - limit here is ANGLE's 254 max uniform vectors
			//    (up to 54 should be safe)

			var nVertexUniforms = _gl.getParameter( _gl.MAX_VERTEX_UNIFORM_VECTORS );
			var nVertexMatrices = Math.floor( ( nVertexUniforms - 20 ) / 4 );

			var maxBones = nVertexMatrices;

			if ( object !== undefined && object instanceof THREE.SkinnedMesh ) {

				maxBones = Math.min( object.skeleton.bones.length, maxBones );

				if ( maxBones < object.skeleton.bones.length ) {

					console.warn( 'WebGLRenderer: too many bones - ' + object.skeleton.bones.length + ', this GPU supports just ' + maxBones + ' (try OpenGL instead of ANGLE)' );

				}

			}

			return maxBones;

		}

	}

	function allocateLights( lights ) {

		var dirLights = 0;
		var pointLights = 0;
		var spotLights = 0;
		var hemiLights = 0;

		for ( var l = 0, ll = lights.length; l < ll; l ++ ) {

			var light = lights[ l ];

			if ( light.onlyShadow || light.visible === false ) continue;

			if ( light instanceof THREE.DirectionalLight ) dirLights ++;
			if ( light instanceof THREE.PointLight ) pointLights ++;
			if ( light instanceof THREE.SpotLight ) spotLights ++;
			if ( light instanceof THREE.HemisphereLight ) hemiLights ++;

		}

		return { 'directional': dirLights, 'point': pointLights, 'spot': spotLights, 'hemi': hemiLights };

	}

	function allocateShadows( lights ) {

		var maxShadows = 0;

		for ( var l = 0, ll = lights.length; l < ll; l ++ ) {

			var light = lights[ l ];

			if ( ! light.castShadow ) continue;

			if ( light instanceof THREE.SpotLight ) maxShadows ++;
			if ( light instanceof THREE.DirectionalLight && ! light.shadowCascade ) maxShadows ++;

		}

		return maxShadows;

	}

	// DEPRECATED
	
	this.initMaterial = function () {

		console.warn( 'THREE.WebGLRenderer: .initMaterial() has been removed.' );

	};

	this.addPrePlugin = function () {

		console.warn( 'THREE.WebGLRenderer: .addPrePlugin() has been removed.' );

	};

	this.addPostPlugin = function () {

		console.warn( 'THREE.WebGLRenderer: .addPostPlugin() has been removed.' );

	};

	this.updateShadowMap = function () {

		console.warn( 'THREE.WebGLRenderer: .updateShadowMap() has been removed.' );

	};

};

// File:src/renderers/WebGLRenderTarget.js

/**
 * @author szimek / https://github.com/szimek/
 * @author alteredq / http://alteredqualia.com/
 */

THREE.WebGLRenderTarget = function ( width, height, options ) {

	this.width = width;
	this.height = height;

	options = options || {};

	this.wrapS = options.wrapS !== undefined ? options.wrapS : THREE.ClampToEdgeWrapping;
	this.wrapT = options.wrapT !== undefined ? options.wrapT : THREE.ClampToEdgeWrapping;

	this.magFilter = options.magFilter !== undefined ? options.magFilter : THREE.LinearFilter;
	this.minFilter = options.minFilter !== undefined ? options.minFilter : THREE.LinearMipMapLinearFilter;

	this.anisotropy = options.anisotropy !== undefined ? options.anisotropy : 1;

	this.offset = new THREE.Vector2( 0, 0 );
	this.repeat = new THREE.Vector2( 1, 1 );

	this.format = options.format !== undefined ? options.format : THREE.RGBAFormat;
	this.type = options.type !== undefined ? options.type : THREE.UnsignedByteType;

	this.depthBuffer = options.depthBuffer !== undefined ? options.depthBuffer : true;
	this.stencilBuffer = options.stencilBuffer !== undefined ? options.stencilBuffer : true;

	this.generateMipmaps = true;

	this.shareDepthFrom = null;

};

THREE.WebGLRenderTarget.prototype = {

	constructor: THREE.WebGLRenderTarget,

	setSize: function ( width, height ) {

		this.width = width;
		this.height = height;

	},

	clone: function () {

		var tmp = new THREE.WebGLRenderTarget( this.width, this.height );

		tmp.wrapS = this.wrapS;
		tmp.wrapT = this.wrapT;

		tmp.magFilter = this.magFilter;
		tmp.minFilter = this.minFilter;

		tmp.anisotropy = this.anisotropy;

		tmp.offset.copy( this.offset );
		tmp.repeat.copy( this.repeat );

		tmp.format = this.format;
		tmp.type = this.type;

		tmp.depthBuffer = this.depthBuffer;
		tmp.stencilBuffer = this.stencilBuffer;

		tmp.generateMipmaps = this.generateMipmaps;

		tmp.shareDepthFrom = this.shareDepthFrom;

		return tmp;

	},

	dispose: function () {

		this.dispatchEvent( { type: 'dispose' } );

	}

};

THREE.EventDispatcher.prototype.apply( THREE.WebGLRenderTarget.prototype );

// File:src/renderers/WebGLRenderTargetCube.js

/**
 * @author alteredq / http://alteredqualia.com
 */

THREE.WebGLRenderTargetCube = function ( width, height, options ) {

	THREE.WebGLRenderTarget.call( this, width, height, options );

	this.activeCubeFace = 0; // PX 0, NX 1, PY 2, NY 3, PZ 4, NZ 5

};

THREE.WebGLRenderTargetCube.prototype = Object.create( THREE.WebGLRenderTarget.prototype );

// File:src/renderers/webgl/WebGLExtensions.js

THREE.WebGLExtensions = function ( gl ) {

	var extensions = {};

	this.get = function ( name ) {

		if ( extensions[ name ] !== undefined ) {

			return extensions[ name ];

		}

		var extension;

		switch ( name ) {
		
			case 'OES_texture_float':
				extension = gl.getExtension( 'OES_texture_float' );
				break;

			case 'OES_texture_float_linear':
				extension = gl.getExtension( 'OES_texture_float_linear' );
				break;

			case 'OES_standard_derivatives':
				extension = gl.getExtension( 'OES_standard_derivatives' );
				break;

			case 'EXT_texture_filter_anisotropic':
				extension = gl.getExtension( 'EXT_texture_filter_anisotropic' ) || gl.getExtension( 'MOZ_EXT_texture_filter_anisotropic' ) || gl.getExtension( 'WEBKIT_EXT_texture_filter_anisotropic' );
				break;

			case 'WEBGL_compressed_texture_s3tc':
				extension = gl.getExtension( 'WEBGL_compressed_texture_s3tc' ) || gl.getExtension( 'MOZ_WEBGL_compressed_texture_s3tc' ) || gl.getExtension( 'WEBKIT_WEBGL_compressed_texture_s3tc' );
				break;

			case 'WEBGL_compressed_texture_pvrtc':
				extension = gl.getExtension( 'WEBGL_compressed_texture_pvrtc' ) || gl.getExtension( 'WEBKIT_WEBGL_compressed_texture_pvrtc' );
				break;

			case 'OES_element_index_uint':
				extension = gl.getExtension( 'OES_element_index_uint' );
				break;

			case 'EXT_blend_minmax':
				extension = gl.getExtension( 'EXT_blend_minmax' );
				break;

			case 'EXT_frag_depth':
				extension = gl.getExtension( 'EXT_frag_depth' );
				break;

		}

		if ( extension === null ) {

			console.log( 'THREE.WebGLRenderer: ' + name + ' extension not supported.' );

		}

		extensions[ name ] = extension;

		return extension;

	};

};

// File:src/renderers/webgl/WebGLProgram.js

THREE.WebGLProgram = ( function () {

	var programIdCount = 0;

	var generateDefines = function ( defines ) {

		var value, chunk, chunks = [];

		for ( var d in defines ) {

			value = defines[ d ];
			if ( value === false ) continue;

			chunk = "#define " + d + " " + value;
			chunks.push( chunk );

		}

		return chunks.join( "\n" );

	};

	var cacheUniformLocations = function ( gl, program, identifiers ) {

		var uniforms = {};

		for ( var i = 0, l = identifiers.length; i < l; i ++ ) {

			var id = identifiers[ i ];
			uniforms[ id ] = gl.getUniformLocation( program, id );

		}

		return uniforms;

	};

	var cacheAttributeLocations = function ( gl, program, identifiers ) {

		var attributes = {};

		for ( var i = 0, l = identifiers.length; i < l; i ++ ) {

			var id = identifiers[ i ];
			attributes[ id ] = gl.getAttribLocation( program, id );

		}

		return attributes;

	};

	return function ( renderer, code, material, parameters ) {

		var _this = renderer;
		var _gl = _this.context;

		var defines = material.defines;
		var uniforms = material.__webglShader.uniforms;
		var attributes = material.attributes;

		var vertexShader = material.__webglShader.vertexShader;
		var fragmentShader = material.__webglShader.fragmentShader;

		var index0AttributeName = material.index0AttributeName;

		if ( index0AttributeName === undefined && parameters.morphTargets === true ) {

			// programs with morphTargets displace position out of attribute 0

			index0AttributeName = 'position';

		}

		var shadowMapTypeDefine = "SHADOWMAP_TYPE_BASIC";

		if ( parameters.shadowMapType === THREE.PCFShadowMap ) {

			shadowMapTypeDefine = "SHADOWMAP_TYPE_PCF";

		} else if ( parameters.shadowMapType === THREE.PCFSoftShadowMap ) {

			shadowMapTypeDefine = "SHADOWMAP_TYPE_PCF_SOFT";

		}

		// console.log( "building new program " );

		//

		var customDefines = generateDefines( defines );

		//

		var program = _gl.createProgram();

		var prefix_vertex, prefix_fragment;

		if ( material instanceof THREE.RawShaderMaterial ) {

			prefix_vertex = '';
			prefix_fragment = '';

		} else {

			prefix_vertex = [

				"precision " + parameters.precision + " float;",
				"precision " + parameters.precision + " int;",

				customDefines,

				parameters.supportsVertexTextures ? "#define VERTEX_TEXTURES" : "",

				_this.gammaInput ? "#define GAMMA_INPUT" : "",
				_this.gammaOutput ? "#define GAMMA_OUTPUT" : "",

				"#define MAX_DIR_LIGHTS " + parameters.maxDirLights,
				"#define MAX_POINT_LIGHTS " + parameters.maxPointLights,
				"#define MAX_SPOT_LIGHTS " + parameters.maxSpotLights,
				"#define MAX_HEMI_LIGHTS " + parameters.maxHemiLights,

				"#define MAX_SHADOWS " + parameters.maxShadows,

				"#define MAX_BONES " + parameters.maxBones,

				parameters.map ? "#define USE_MAP" : "",
				parameters.envMap ? "#define USE_ENVMAP" : "",
				parameters.lightMap ? "#define USE_LIGHTMAP" : "",
				parameters.bumpMap ? "#define USE_BUMPMAP" : "",
				parameters.normalMap ? "#define USE_NORMALMAP" : "",
				parameters.specularMap ? "#define USE_SPECULARMAP" : "",
				parameters.alphaMap ? "#define USE_ALPHAMAP" : "",
				parameters.vertexColors ? "#define USE_COLOR" : "",

				parameters.skinning ? "#define USE_SKINNING" : "",
				parameters.useVertexTexture ? "#define BONE_TEXTURE" : "",

				parameters.morphTargets ? "#define USE_MORPHTARGETS" : "",
				parameters.morphNormals ? "#define USE_MORPHNORMALS" : "",
				parameters.wrapAround ? "#define WRAP_AROUND" : "",
				parameters.doubleSided ? "#define DOUBLE_SIDED" : "",
				parameters.flipSided ? "#define FLIP_SIDED" : "",

				parameters.shadowMapEnabled ? "#define USE_SHADOWMAP" : "",
				parameters.shadowMapEnabled ? "#define " + shadowMapTypeDefine : "",
				parameters.shadowMapDebug ? "#define SHADOWMAP_DEBUG" : "",
				parameters.shadowMapCascade ? "#define SHADOWMAP_CASCADE" : "",

				parameters.sizeAttenuation ? "#define USE_SIZEATTENUATION" : "",

				parameters.logarithmicDepthBuffer ? "#define USE_LOGDEPTHBUF" : "",
				//_this._glExtensionFragDepth ? "#define USE_LOGDEPTHBUF_EXT" : "",


				"uniform mat4 modelMatrix;",
				"uniform mat4 modelViewMatrix;",
				"uniform mat4 projectionMatrix;",
				"uniform mat4 viewMatrix;",
				"uniform mat3 normalMatrix;",
				"uniform vec3 cameraPosition;",

				"attribute vec3 position;",
				"attribute vec3 normal;",
				"attribute vec2 uv;",
				"attribute vec2 uv2;",

				"#ifdef USE_COLOR",

				"	attribute vec3 color;",

				"#endif",

				"#ifdef USE_MORPHTARGETS",

				"	attribute vec3 morphTarget0;",
				"	attribute vec3 morphTarget1;",
				"	attribute vec3 morphTarget2;",
				"	attribute vec3 morphTarget3;",

				"	#ifdef USE_MORPHNORMALS",

				"		attribute vec3 morphNormal0;",
				"		attribute vec3 morphNormal1;",
				"		attribute vec3 morphNormal2;",
				"		attribute vec3 morphNormal3;",

				"	#else",

				"		attribute vec3 morphTarget4;",
				"		attribute vec3 morphTarget5;",
				"		attribute vec3 morphTarget6;",
				"		attribute vec3 morphTarget7;",

				"	#endif",

				"#endif",

				"#ifdef USE_SKINNING",

				"	attribute vec4 skinIndex;",
				"	attribute vec4 skinWeight;",

				"#endif",

				""

			].join( '\n' );

			prefix_fragment = [

				"precision " + parameters.precision + " float;",
				"precision " + parameters.precision + " int;",

				( parameters.bumpMap || parameters.normalMap ) ? "#extension GL_OES_standard_derivatives : enable" : "",

				customDefines,

				"#define MAX_DIR_LIGHTS " + parameters.maxDirLights,
				"#define MAX_POINT_LIGHTS " + parameters.maxPointLights,
				"#define MAX_SPOT_LIGHTS " + parameters.maxSpotLights,
				"#define MAX_HEMI_LIGHTS " + parameters.maxHemiLights,

				"#define MAX_SHADOWS " + parameters.maxShadows,

				parameters.alphaTest ? "#define ALPHATEST " + parameters.alphaTest: "",

				_this.gammaInput ? "#define GAMMA_INPUT" : "",
				_this.gammaOutput ? "#define GAMMA_OUTPUT" : "",

				( parameters.useFog && parameters.fog ) ? "#define USE_FOG" : "",
				( parameters.useFog && parameters.fogExp ) ? "#define FOG_EXP2" : "",

				parameters.map ? "#define USE_MAP" : "",
				parameters.envMap ? "#define USE_ENVMAP" : "",
				parameters.lightMap ? "#define USE_LIGHTMAP" : "",
				parameters.bumpMap ? "#define USE_BUMPMAP" : "",
				parameters.normalMap ? "#define USE_NORMALMAP" : "",
				parameters.specularMap ? "#define USE_SPECULARMAP" : "",
				parameters.alphaMap ? "#define USE_ALPHAMAP" : "",
				parameters.vertexColors ? "#define USE_COLOR" : "",

				parameters.metal ? "#define METAL" : "",
				parameters.wrapAround ? "#define WRAP_AROUND" : "",
				parameters.doubleSided ? "#define DOUBLE_SIDED" : "",
				parameters.flipSided ? "#define FLIP_SIDED" : "",

				parameters.shadowMapEnabled ? "#define USE_SHADOWMAP" : "",
				parameters.shadowMapEnabled ? "#define " + shadowMapTypeDefine : "",
				parameters.shadowMapDebug ? "#define SHADOWMAP_DEBUG" : "",
				parameters.shadowMapCascade ? "#define SHADOWMAP_CASCADE" : "",

				parameters.logarithmicDepthBuffer ? "#define USE_LOGDEPTHBUF" : "",
				//_this._glExtensionFragDepth ? "#define USE_LOGDEPTHBUF_EXT" : "",

				"uniform mat4 viewMatrix;",
				"uniform vec3 cameraPosition;",
				""

			].join( '\n' );

		}

		var glVertexShader = new THREE.WebGLShader( _gl, _gl.VERTEX_SHADER, prefix_vertex + vertexShader );
		var glFragmentShader = new THREE.WebGLShader( _gl, _gl.FRAGMENT_SHADER, prefix_fragment + fragmentShader );

		_gl.attachShader( program, glVertexShader );
		_gl.attachShader( program, glFragmentShader );

		if ( index0AttributeName !== undefined ) {

			// Force a particular attribute to index 0.
			// because potentially expensive emulation is done by browser if attribute 0 is disabled.
			// And, color, for example is often automatically bound to index 0 so disabling it

			_gl.bindAttribLocation( program, 0, index0AttributeName );

		}

		_gl.linkProgram( program );

		if ( _gl.getProgramParameter( program, _gl.LINK_STATUS ) === false ) {

			console.error( 'THREE.WebGLProgram: Could not initialise shader.' );
			console.error( 'gl.VALIDATE_STATUS', _gl.getProgramParameter( program, _gl.VALIDATE_STATUS ) );
			console.error( 'gl.getError()', _gl.getError() );

		}

		if ( _gl.getProgramInfoLog( program ) !== '' ) {

			console.warn( 'THREE.WebGLProgram: gl.getProgramInfoLog()', _gl.getProgramInfoLog( program ) );

		}

		// clean up

		_gl.deleteShader( glVertexShader );
		_gl.deleteShader( glFragmentShader );

		// cache uniform locations

		var identifiers = [

			'viewMatrix', 'modelViewMatrix', 'projectionMatrix', 'normalMatrix', 'modelMatrix', 'cameraPosition', 'morphTargetInfluences', 'bindMatrix', 'bindMatrixInverse'

		];

		if ( parameters.useVertexTexture ) {

			identifiers.push( 'boneTexture' );
			identifiers.push( 'boneTextureWidth' );
			identifiers.push( 'boneTextureHeight' );

		} else {

			identifiers.push( 'boneGlobalMatrices' );

		}

		if ( parameters.logarithmicDepthBuffer ) {

			identifiers.push('logDepthBufFC');

		}


		for ( var u in uniforms ) {

			identifiers.push( u );

		}

		this.uniforms = cacheUniformLocations( _gl, program, identifiers );

		// cache attributes locations

		identifiers = [

			"position", "normal", "uv", "uv2", "tangent", "color",
			"skinIndex", "skinWeight", "lineDistance"

		];

		for ( var i = 0; i < parameters.maxMorphTargets; i ++ ) {

			identifiers.push( "morphTarget" + i );

		}

		for ( var i = 0; i < parameters.maxMorphNormals; i ++ ) {

			identifiers.push( "morphNormal" + i );

		}

		for ( var a in attributes ) {

			identifiers.push( a );

		}

		this.attributes = cacheAttributeLocations( _gl, program, identifiers );
		this.attributesKeys = Object.keys( this.attributes );

		//

		this.id = programIdCount ++;
		this.code = code;
		this.usedTimes = 1;
		this.program = program;
		this.vertexShader = glVertexShader;
		this.fragmentShader = glFragmentShader;

		return this;

	};

} )();

// File:src/renderers/webgl/WebGLShader.js

THREE.WebGLShader = ( function () {

	var addLineNumbers = function ( string ) {

		var lines = string.split( '\n' );

		for ( var i = 0; i < lines.length; i ++ ) {

			lines[ i ] = ( i + 1 ) + ': ' + lines[ i ];

		}

		return lines.join( '\n' );

	};

	return function ( gl, type, string ) {

		var shader = gl.createShader( type ); 

		gl.shaderSource( shader, string );
		gl.compileShader( shader );

		if ( gl.getShaderParameter( shader, gl.COMPILE_STATUS ) === false ) {

			console.error( 'THREE.WebGLShader: Shader couldn\'t compile.' );

		}

		if ( gl.getShaderInfoLog( shader ) !== '' ) {

			console.warn( 'THREE.WebGLShader: gl.getShaderInfoLog()', gl.getShaderInfoLog( shader ) );
			console.warn( addLineNumbers( string ) );

		}

		// --enable-privileged-webgl-extension
		// console.log( type, gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( shader ) );

		return shader;

	};

} )();

// File:src/renderers/webgl/plugins/LensFlarePlugin.js

/**
 * @author mikael emtinger / http://gomo.se/
 * @author alteredq / http://alteredqualia.com/
 */

THREE.LensFlarePlugin = function ( renderer, flares ) {

	var gl = renderer.context;

	var vertexBuffer, elementBuffer;
	var program, attributes, uniforms;
	var hasVertexTexture;

	var tempTexture, occlusionTexture;

	var init = function () {

		var vertices = new Float32Array( [
			-1, -1,  0, 0,
			 1, -1,  1, 0,
			 1,  1,  1, 1,
			-1,  1,  0, 1
		] );

		var faces = new Uint16Array( [
			0, 1, 2,
			0, 2, 3
		] );

		// buffers

		vertexBuffer     = gl.createBuffer();
		elementBuffer    = gl.createBuffer();

		gl.bindBuffer( gl.ARRAY_BUFFER, vertexBuffer );
		gl.bufferData( gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW );

		gl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, elementBuffer );
		gl.bufferData( gl.ELEMENT_ARRAY_BUFFER, faces, gl.STATIC_DRAW );

		// textures

		tempTexture      = gl.createTexture();
		occlusionTexture = gl.createTexture();

		gl.bindTexture( gl.TEXTURE_2D, tempTexture );
		gl.texImage2D( gl.TEXTURE_2D, 0, gl.RGB, 16, 16, 0, gl.RGB, gl.UNSIGNED_BYTE, null );
		gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE );
		gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE );
		gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST );
		gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST );

		gl.bindTexture( gl.TEXTURE_2D, occlusionTexture );
		gl.texImage2D( gl.TEXTURE_2D, 0, gl.RGBA, 16, 16, 0, gl.RGBA, gl.UNSIGNED_BYTE, null );
		gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE );
		gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE );
		gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST );
		gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST );

		hasVertexTexture = gl.getParameter( gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS ) > 0;

		var shader;

		if ( hasVertexTexture ) {

			shader = {

				vertexShader: [

					"uniform lowp int renderType;",

					"uniform vec3 screenPosition;",
					"uniform vec2 scale;",
					"uniform float rotation;",

					"uniform sampler2D occlusionMap;",

					"attribute vec2 position;",
					"attribute vec2 uv;",

					"varying vec2 vUV;",
					"varying float vVisibility;",

					"void main() {",

						"vUV = uv;",

						"vec2 pos = position;",

						"if( renderType == 2 ) {",

							"vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );",
							"visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );",
							"visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );",
							"visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );",
							"visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );",
							"visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );",
							"visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );",
							"visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );",
							"visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );",

							"vVisibility =        visibility.r / 9.0;",
							"vVisibility *= 1.0 - visibility.g / 9.0;",
							"vVisibility *=       visibility.b / 9.0;",
							"vVisibility *= 1.0 - visibility.a / 9.0;",

							"pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;",
							"pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;",

						"}",

						"gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );",

					"}"

				].join( "\n" ),

				fragmentShader: [

					"uniform lowp int renderType;",

					"uniform sampler2D map;",
					"uniform float opacity;",
					"uniform vec3 color;",

					"varying vec2 vUV;",
					"varying float vVisibility;",

					"void main() {",

						// pink square

						"if( renderType == 0 ) {",

							"gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );",

						// restore

						"} else if( renderType == 1 ) {",

							"gl_FragColor = texture2D( map, vUV );",

						// flare

						"} else {",

							"vec4 texture = texture2D( map, vUV );",
							"texture.a *= opacity * vVisibility;",
							"gl_FragColor = texture;",
							"gl_FragColor.rgb *= color;",

						"}",

					"}"

				].join( "\n" )

			};

		} else {

			shader = {

				vertexShader: [

					"uniform lowp int renderType;",

					"uniform vec3 screenPosition;",
					"uniform vec2 scale;",
					"uniform float rotation;",

					"attribute vec2 position;",
					"attribute vec2 uv;",

					"varying vec2 vUV;",

					"void main() {",

						"vUV = uv;",

						"vec2 pos = position;",

						"if( renderType == 2 ) {",

							"pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;",
							"pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;",

						"}",

						"gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );",

					"}"

				].join( "\n" ),

				fragmentShader: [

					"precision mediump float;",

					"uniform lowp int renderType;",

					"uniform sampler2D map;",
					"uniform sampler2D occlusionMap;",
					"uniform float opacity;",
					"uniform vec3 color;",

					"varying vec2 vUV;",

					"void main() {",

						// pink square

						"if( renderType == 0 ) {",

							"gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );",

						// restore

						"} else if( renderType == 1 ) {",

							"gl_FragColor = texture2D( map, vUV );",

						// flare

						"} else {",

							"float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;",
							"visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;",
							"visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;",
							"visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;",
							"visibility = ( 1.0 - visibility / 4.0 );",

							"vec4 texture = texture2D( map, vUV );",
							"texture.a *= opacity * visibility;",
							"gl_FragColor = texture;",
							"gl_FragColor.rgb *= color;",

						"}",

					"}"

				].join( "\n" )

			};

		}

		program = createProgram( shader );

		attributes = {
			vertex: gl.getAttribLocation ( program, "position" ),
			uv:     gl.getAttribLocation ( program, "uv" )
		}

		uniforms = {
			renderType:     gl.getUniformLocation( program, "renderType" ),
			map:            gl.getUniformLocation( program, "map" ),
			occlusionMap:   gl.getUniformLocation( program, "occlusionMap" ),
			opacity:        gl.getUniformLocation( program, "opacity" ),
			color:          gl.getUniformLocation( program, "color" ),
			scale:          gl.getUniformLocation( program, "scale" ),
			rotation:       gl.getUniformLocation( program, "rotation" ),
			screenPosition: gl.getUniformLocation( program, "screenPosition" )
		};

	};

	/*
	 * Render lens flares
	 * Method: renders 16x16 0xff00ff-colored points scattered over the light source area,
	 *         reads these back and calculates occlusion.
	 */

	this.render = function ( scene, camera, viewportWidth, viewportHeight ) {

		if ( flares.length === 0 ) return;

		var tempPosition = new THREE.Vector3();

		var invAspect = viewportHeight / viewportWidth,
			halfViewportWidth = viewportWidth * 0.5,
			halfViewportHeight = viewportHeight * 0.5;

		var size = 16 / viewportHeight,
			scale = new THREE.Vector2( size * invAspect, size );

		var screenPosition = new THREE.Vector3( 1, 1, 0 ),
			screenPositionPixels = new THREE.Vector2( 1, 1 );

		if ( program === undefined ) {

			init();

		}

		gl.useProgram( program );

		gl.enableVertexAttribArray( attributes.vertex );
		gl.enableVertexAttribArray( attributes.uv );

		// loop through all lens flares to update their occlusion and positions
		// setup gl and common used attribs/unforms

		gl.uniform1i( uniforms.occlusionMap, 0 );
		gl.uniform1i( uniforms.map, 1 );

		gl.bindBuffer( gl.ARRAY_BUFFER, vertexBuffer );
		gl.vertexAttribPointer( attributes.vertex, 2, gl.FLOAT, false, 2 * 8, 0 );
		gl.vertexAttribPointer( attributes.uv, 2, gl.FLOAT, false, 2 * 8, 8 );

		gl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, elementBuffer );

		gl.disable( gl.CULL_FACE );
		gl.depthMask( false );

		for ( var i = 0, l = flares.length; i < l; i ++ ) {

			size = 16 / viewportHeight;
			scale.set( size * invAspect, size );

			// calc object screen position

			var flare = flares[ i ];
			
			tempPosition.set( flare.matrixWorld.elements[12], flare.matrixWorld.elements[13], flare.matrixWorld.elements[14] );

			tempPosition.applyMatrix4( camera.matrixWorldInverse );
			tempPosition.applyProjection( camera.projectionMatrix );

			// setup arrays for gl programs

			screenPosition.copy( tempPosition )

			screenPositionPixels.x = screenPosition.x * halfViewportWidth + halfViewportWidth;
			screenPositionPixels.y = screenPosition.y * halfViewportHeight + halfViewportHeight;

			// screen cull

			if ( hasVertexTexture || (
				screenPositionPixels.x > 0 &&
				screenPositionPixels.x < viewportWidth &&
				screenPositionPixels.y > 0 &&
				screenPositionPixels.y < viewportHeight ) ) {

				// save current RGB to temp texture

				gl.activeTexture( gl.TEXTURE1 );
				gl.bindTexture( gl.TEXTURE_2D, tempTexture );
				gl.copyTexImage2D( gl.TEXTURE_2D, 0, gl.RGB, screenPositionPixels.x - 8, screenPositionPixels.y - 8, 16, 16, 0 );


				// render pink quad

				gl.uniform1i( uniforms.renderType, 0 );
				gl.uniform2f( uniforms.scale, scale.x, scale.y );
				gl.uniform3f( uniforms.screenPosition, screenPosition.x, screenPosition.y, screenPosition.z );

				gl.disable( gl.BLEND );
				gl.enable( gl.DEPTH_TEST );

				gl.drawElements( gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0 );


				// copy result to occlusionMap

				gl.activeTexture( gl.TEXTURE0 );
				gl.bindTexture( gl.TEXTURE_2D, occlusionTexture );
				gl.copyTexImage2D( gl.TEXTURE_2D, 0, gl.RGBA, screenPositionPixels.x - 8, screenPositionPixels.y - 8, 16, 16, 0 );


				// restore graphics

				gl.uniform1i( uniforms.renderType, 1 );
				gl.disable( gl.DEPTH_TEST );

				gl.activeTexture( gl.TEXTURE1 );
				gl.bindTexture( gl.TEXTURE_2D, tempTexture );
				gl.drawElements( gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0 );


				// update object positions

				flare.positionScreen.copy( screenPosition )

				if ( flare.customUpdateCallback ) {

					flare.customUpdateCallback( flare );

				} else {

					flare.updateLensFlares();

				}

				// render flares

				gl.uniform1i( uniforms.renderType, 2 );
				gl.enable( gl.BLEND );

				for ( var j = 0, jl = flare.lensFlares.length; j < jl; j ++ ) {

					var sprite = flare.lensFlares[ j ];

					if ( sprite.opacity > 0.001 && sprite.scale > 0.001 ) {

						screenPosition.x = sprite.x;
						screenPosition.y = sprite.y;
						screenPosition.z = sprite.z;

						size = sprite.size * sprite.scale / viewportHeight;

						scale.x = size * invAspect;
						scale.y = size;

						gl.uniform3f( uniforms.screenPosition, screenPosition.x, screenPosition.y, screenPosition.z );
						gl.uniform2f( uniforms.scale, scale.x, scale.y );
						gl.uniform1f( uniforms.rotation, sprite.rotation );

						gl.uniform1f( uniforms.opacity, sprite.opacity );
						gl.uniform3f( uniforms.color, sprite.color.r, sprite.color.g, sprite.color.b );

						renderer.setBlending( sprite.blending, sprite.blendEquation, sprite.blendSrc, sprite.blendDst );
						renderer.setTexture( sprite.texture, 1 );

						gl.drawElements( gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0 );

					}

				}

			}

		}

		// restore gl

		gl.enable( gl.CULL_FACE );
		gl.enable( gl.DEPTH_TEST );
		gl.depthMask( true );

		renderer.resetGLState();

	};

	function createProgram ( shader ) {

		var program = gl.createProgram();

		var fragmentShader = gl.createShader( gl.FRAGMENT_SHADER );
		var vertexShader = gl.createShader( gl.VERTEX_SHADER );

		var prefix = "precision " + renderer.getPrecision() + " float;\n";

		gl.shaderSource( fragmentShader, prefix + shader.fragmentShader );
		gl.shaderSource( vertexShader, prefix + shader.vertexShader );

		gl.compileShader( fragmentShader );
		gl.compileShader( vertexShader );

		gl.attachShader( program, fragmentShader );
		gl.attachShader( program, vertexShader );

		gl.linkProgram( program );

		return program;

	}

};

// File:src/renderers/webgl/plugins/ShadowMapPlugin.js

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.ShadowMapPlugin = function ( _renderer, _lights, _webglObjects, _webglObjectsImmediate ) {

	var _gl = _renderer.context;

	var _depthMaterial, _depthMaterialMorph, _depthMaterialSkin, _depthMaterialMorphSkin,

	_frustum = new THREE.Frustum(),
	_projScreenMatrix = new THREE.Matrix4(),

	_min = new THREE.Vector3(),
	_max = new THREE.Vector3(),

	_matrixPosition = new THREE.Vector3(),
	
	_renderList = [];

	// init

	var depthShader = THREE.ShaderLib[ "depthRGBA" ];
	var depthUniforms = THREE.UniformsUtils.clone( depthShader.uniforms );

	_depthMaterial = new THREE.ShaderMaterial( {
		uniforms: depthUniforms,
		vertexShader: depthShader.vertexShader,
		fragmentShader: depthShader.fragmentShader
	 } );

	_depthMaterialMorph = new THREE.ShaderMaterial( {
		uniforms: depthUniforms,
		vertexShader: depthShader.vertexShader,
		fragmentShader: depthShader.fragmentShader,
		morphTargets: true
	} );

	_depthMaterialSkin = new THREE.ShaderMaterial( {
		uniforms: depthUniforms,
		vertexShader: depthShader.vertexShader,
		fragmentShader: depthShader.fragmentShader,
		skinning: true
	} );

	_depthMaterialMorphSkin = new THREE.ShaderMaterial( {
		uniforms: depthUniforms,
		vertexShader: depthShader.vertexShader,
		fragmentShader: depthShader.fragmentShader,
		morphTargets: true,
		skinning: true
	} );

	_depthMaterial._shadowPass = true;
	_depthMaterialMorph._shadowPass = true;
	_depthMaterialSkin._shadowPass = true;
	_depthMaterialMorphSkin._shadowPass = true;

	this.render = function ( scene, camera ) {

		if ( _renderer.shadowMapEnabled === false ) return;

		var i, il, j, jl, n,

		shadowMap, shadowMatrix, shadowCamera,
		program, buffer, material,
		webglObject, object, light,

		lights = [],
		k = 0,

		fog = null;

		// set GL state for depth map

		_gl.clearColor( 1, 1, 1, 1 );
		_gl.disable( _gl.BLEND );

		_gl.enable( _gl.CULL_FACE );
		_gl.frontFace( _gl.CCW );

		if ( _renderer.shadowMapCullFace === THREE.CullFaceFront ) {

			_gl.cullFace( _gl.FRONT );

		} else {

			_gl.cullFace( _gl.BACK );

		}

		_renderer.setDepthTest( true );

		// preprocess lights
		// 	- skip lights that are not casting shadows
		//	- create virtual lights for cascaded shadow maps

		for ( i = 0, il = _lights.length; i < il; i ++ ) {

			light = _lights[ i ];

			if ( ! light.castShadow ) continue;

			if ( ( light instanceof THREE.DirectionalLight ) && light.shadowCascade ) {

				for ( n = 0; n < light.shadowCascadeCount; n ++ ) {

					var virtualLight;

					if ( ! light.shadowCascadeArray[ n ] ) {

						virtualLight = createVirtualLight( light, n );
						virtualLight.originalCamera = camera;

						var gyro = new THREE.Gyroscope();
						gyro.position.copy( light.shadowCascadeOffset );

						gyro.add( virtualLight );
						gyro.add( virtualLight.target );

						camera.add( gyro );

						light.shadowCascadeArray[ n ] = virtualLight;

						console.log( "Created virtualLight", virtualLight );

					} else {

						virtualLight = light.shadowCascadeArray[ n ];

					}

					updateVirtualLight( light, n );

					lights[ k ] = virtualLight;
					k ++;

				}

			} else {

				lights[ k ] = light;
				k ++;

			}

		}

		// render depth map

		for ( i = 0, il = lights.length; i < il; i ++ ) {

			light = lights[ i ];

			if ( ! light.shadowMap ) {

				var shadowFilter = THREE.LinearFilter;

				if ( _renderer.shadowMapType === THREE.PCFSoftShadowMap ) {

					shadowFilter = THREE.NearestFilter;

				}

				var pars = { minFilter: shadowFilter, magFilter: shadowFilter, format: THREE.RGBAFormat };

				light.shadowMap = new THREE.WebGLRenderTarget( light.shadowMapWidth, light.shadowMapHeight, pars );
				light.shadowMapSize = new THREE.Vector2( light.shadowMapWidth, light.shadowMapHeight );

				light.shadowMatrix = new THREE.Matrix4();

			}

			if ( ! light.shadowCamera ) {

				if ( light instanceof THREE.SpotLight ) {

					light.shadowCamera = new THREE.PerspectiveCamera( light.shadowCameraFov, light.shadowMapWidth / light.shadowMapHeight, light.shadowCameraNear, light.shadowCameraFar );

				} else if ( light instanceof THREE.DirectionalLight ) {

					light.shadowCamera = new THREE.OrthographicCamera( light.shadowCameraLeft, light.shadowCameraRight, light.shadowCameraTop, light.shadowCameraBottom, light.shadowCameraNear, light.shadowCameraFar );

				} else {

					console.error( "Unsupported light type for shadow" );
					continue;

				}

				scene.add( light.shadowCamera );

				if ( scene.autoUpdate === true ) scene.updateMatrixWorld();

			}

			if ( light.shadowCameraVisible && ! light.cameraHelper ) {

				light.cameraHelper = new THREE.CameraHelper( light.shadowCamera );
				scene.add( light.cameraHelper );

			}

			if ( light.isVirtual && virtualLight.originalCamera == camera ) {

				updateShadowCamera( camera, light );

			}

			shadowMap = light.shadowMap;
			shadowMatrix = light.shadowMatrix;
			shadowCamera = light.shadowCamera;

			//

			shadowCamera.position.setFromMatrixPosition( light.matrixWorld );
			_matrixPosition.setFromMatrixPosition( light.target.matrixWorld );
			shadowCamera.lookAt( _matrixPosition );
			shadowCamera.updateMatrixWorld();

			shadowCamera.matrixWorldInverse.getInverse( shadowCamera.matrixWorld );

			//

			if ( light.cameraHelper ) light.cameraHelper.visible = light.shadowCameraVisible;
			if ( light.shadowCameraVisible ) light.cameraHelper.update();

			// compute shadow matrix

			shadowMatrix.set(
				0.5, 0.0, 0.0, 0.5,
				0.0, 0.5, 0.0, 0.5,
				0.0, 0.0, 0.5, 0.5,
				0.0, 0.0, 0.0, 1.0
			);

			shadowMatrix.multiply( shadowCamera.projectionMatrix );
			shadowMatrix.multiply( shadowCamera.matrixWorldInverse );

			// update camera matrices and frustum

			_projScreenMatrix.multiplyMatrices( shadowCamera.projectionMatrix, shadowCamera.matrixWorldInverse );
			_frustum.setFromMatrix( _projScreenMatrix );

			// render shadow map

			_renderer.setRenderTarget( shadowMap );
			_renderer.clear();

			// set object matrices & frustum culling

			_renderList.length = 0;

			projectObject( scene, scene, shadowCamera );


			// render regular objects

			var objectMaterial, useMorphing, useSkinning;

			for ( j = 0, jl = _renderList.length; j < jl; j ++ ) {

				webglObject = _renderList[ j ];

				object = webglObject.object;
				buffer = webglObject.buffer;

				// culling is overriden globally for all objects
				// while rendering depth map

				// need to deal with MeshFaceMaterial somehow
				// in that case just use the first of material.materials for now
				// (proper solution would require to break objects by materials
				//  similarly to regular rendering and then set corresponding
				//  depth materials per each chunk instead of just once per object)

				objectMaterial = getObjectMaterial( object );

				useMorphing = object.geometry.morphTargets !== undefined && object.geometry.morphTargets.length > 0 && objectMaterial.morphTargets;
				useSkinning = object instanceof THREE.SkinnedMesh && objectMaterial.skinning;

				if ( object.customDepthMaterial ) {

					material = object.customDepthMaterial;

				} else if ( useSkinning ) {

					material = useMorphing ? _depthMaterialMorphSkin : _depthMaterialSkin;

				} else if ( useMorphing ) {

					material = _depthMaterialMorph;

				} else {

					material = _depthMaterial;

				}

				_renderer.setMaterialFaces( objectMaterial );

				if ( buffer instanceof THREE.BufferGeometry ) {

					_renderer.renderBufferDirect( shadowCamera, _lights, fog, material, buffer, object );

				} else {

					_renderer.renderBuffer( shadowCamera, _lights, fog, material, buffer, object );

				}

			}

			// set matrices and render immediate objects

			for ( j = 0, jl = _webglObjectsImmediate.length; j < jl; j ++ ) {

				webglObject = _webglObjectsImmediate[ j ];
				object = webglObject.object;

				if ( object.visible && object.castShadow ) {

					object._modelViewMatrix.multiplyMatrices( shadowCamera.matrixWorldInverse, object.matrixWorld );

					_renderer.renderImmediateObject( shadowCamera, _lights, fog, _depthMaterial, object );

				}

			}

		}

		// restore GL state

		var clearColor = _renderer.getClearColor(),
		clearAlpha = _renderer.getClearAlpha();

		_gl.clearColor( clearColor.r, clearColor.g, clearColor.b, clearAlpha );
		_gl.enable( _gl.BLEND );

		if ( _renderer.shadowMapCullFace === THREE.CullFaceFront ) {

			_gl.cullFace( _gl.BACK );

		}

		_renderer.resetGLState();

	};

	function projectObject( scene, object, shadowCamera ){

		if ( object.visible ) {

			var webglObjects = _webglObjects[ object.id ];

			if ( webglObjects && object.castShadow && (object.frustumCulled === false || _frustum.intersectsObject( object ) === true) ) {

				for ( var i = 0, l = webglObjects.length; i < l; i ++ ) {

					var webglObject = webglObjects[ i ];

					object._modelViewMatrix.multiplyMatrices( shadowCamera.matrixWorldInverse, object.matrixWorld );
					_renderList.push( webglObject );

				}

			}

			for ( var i = 0, l = object.children.length; i < l; i ++ ) {

				projectObject( scene, object.children[ i ], shadowCamera );

			}

		}

	}

	function createVirtualLight( light, cascade ) {

		var virtualLight = new THREE.DirectionalLight();

		virtualLight.isVirtual = true;

		virtualLight.onlyShadow = true;
		virtualLight.castShadow = true;

		virtualLight.shadowCameraNear = light.shadowCameraNear;
		virtualLight.shadowCameraFar = light.shadowCameraFar;

		virtualLight.shadowCameraLeft = light.shadowCameraLeft;
		virtualLight.shadowCameraRight = light.shadowCameraRight;
		virtualLight.shadowCameraBottom = light.shadowCameraBottom;
		virtualLight.shadowCameraTop = light.shadowCameraTop;

		virtualLight.shadowCameraVisible = light.shadowCameraVisible;

		virtualLight.shadowDarkness = light.shadowDarkness;

		virtualLight.shadowBias = light.shadowCascadeBias[ cascade ];
		virtualLight.shadowMapWidth = light.shadowCascadeWidth[ cascade ];
		virtualLight.shadowMapHeight = light.shadowCascadeHeight[ cascade ];

		virtualLight.pointsWorld = [];
		virtualLight.pointsFrustum = [];

		var pointsWorld = virtualLight.pointsWorld,
			pointsFrustum = virtualLight.pointsFrustum;

		for ( var i = 0; i < 8; i ++ ) {

			pointsWorld[ i ] = new THREE.Vector3();
			pointsFrustum[ i ] = new THREE.Vector3();

		}

		var nearZ = light.shadowCascadeNearZ[ cascade ];
		var farZ = light.shadowCascadeFarZ[ cascade ];

		pointsFrustum[ 0 ].set( - 1, - 1, nearZ );
		pointsFrustum[ 1 ].set(  1, - 1, nearZ );
		pointsFrustum[ 2 ].set( - 1,  1, nearZ );
		pointsFrustum[ 3 ].set(  1,  1, nearZ );

		pointsFrustum[ 4 ].set( - 1, - 1, farZ );
		pointsFrustum[ 5 ].set(  1, - 1, farZ );
		pointsFrustum[ 6 ].set( - 1,  1, farZ );
		pointsFrustum[ 7 ].set(  1,  1, farZ );

		return virtualLight;

	}

	// Synchronize virtual light with the original light

	function updateVirtualLight( light, cascade ) {

		var virtualLight = light.shadowCascadeArray[ cascade ];

		virtualLight.position.copy( light.position );
		virtualLight.target.position.copy( light.target.position );
		virtualLight.lookAt( virtualLight.target );

		virtualLight.shadowCameraVisible = light.shadowCameraVisible;
		virtualLight.shadowDarkness = light.shadowDarkness;

		virtualLight.shadowBias = light.shadowCascadeBias[ cascade ];

		var nearZ = light.shadowCascadeNearZ[ cascade ];
		var farZ = light.shadowCascadeFarZ[ cascade ];

		var pointsFrustum = virtualLight.pointsFrustum;

		pointsFrustum[ 0 ].z = nearZ;
		pointsFrustum[ 1 ].z = nearZ;
		pointsFrustum[ 2 ].z = nearZ;
		pointsFrustum[ 3 ].z = nearZ;

		pointsFrustum[ 4 ].z = farZ;
		pointsFrustum[ 5 ].z = farZ;
		pointsFrustum[ 6 ].z = farZ;
		pointsFrustum[ 7 ].z = farZ;

	}

	// Fit shadow camera's ortho frustum to camera frustum

	function updateShadowCamera( camera, light ) {

		var shadowCamera = light.shadowCamera,
			pointsFrustum = light.pointsFrustum,
			pointsWorld = light.pointsWorld;

		_min.set( Infinity, Infinity, Infinity );
		_max.set( - Infinity, - Infinity, - Infinity );

		for ( var i = 0; i < 8; i ++ ) {

			var p = pointsWorld[ i ];

			p.copy( pointsFrustum[ i ] );
			p.unproject( camera );

			p.applyMatrix4( shadowCamera.matrixWorldInverse );

			if ( p.x < _min.x ) _min.x = p.x;
			if ( p.x > _max.x ) _max.x = p.x;

			if ( p.y < _min.y ) _min.y = p.y;
			if ( p.y > _max.y ) _max.y = p.y;

			if ( p.z < _min.z ) _min.z = p.z;
			if ( p.z > _max.z ) _max.z = p.z;

		}

		shadowCamera.left = _min.x;
		shadowCamera.right = _max.x;
		shadowCamera.top = _max.y;
		shadowCamera.bottom = _min.y;

		// can't really fit near/far
		//shadowCamera.near = _min.z;
		//shadowCamera.far = _max.z;

		shadowCamera.updateProjectionMatrix();

	}

	// For the moment just ignore objects that have multiple materials with different animation methods
	// Only the first material will be taken into account for deciding which depth material to use for shadow maps

	function getObjectMaterial( object ) {

		return object.material instanceof THREE.MeshFaceMaterial
			? object.material.materials[ 0 ]
			: object.material;

	};

};

// File:src/renderers/webgl/plugins/SpritePlugin.js

/**
 * @author mikael emtinger / http://gomo.se/
 * @author alteredq / http://alteredqualia.com/
 */

THREE.SpritePlugin = function ( renderer, sprites ) {

	var gl = renderer.context;

	var vertexBuffer, elementBuffer;
	var program, attributes, uniforms;

	var texture;
	
	var init = function () {

		var vertices = new Float32Array( [
			- 0.5, - 0.5,  0, 0,
			  0.5, - 0.5,  1, 0,
			  0.5,   0.5,  1, 1,
			- 0.5,   0.5,  0, 1
		] );

		var faces = new Uint16Array( [
			0, 1, 2,
			0, 2, 3
		] );

		vertexBuffer  = gl.createBuffer();
		elementBuffer = gl.createBuffer();

		gl.bindBuffer( gl.ARRAY_BUFFER, vertexBuffer );
		gl.bufferData( gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW );

		gl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, elementBuffer );
		gl.bufferData( gl.ELEMENT_ARRAY_BUFFER, faces, gl.STATIC_DRAW );

		program = createProgram();

		attributes = {
			position:			gl.getAttribLocation ( program, 'position' ),
			uv:					gl.getAttribLocation ( program, 'uv' )
		};

		uniforms = {
			uvOffset:			gl.getUniformLocation( program, 'uvOffset' ),
			uvScale:			gl.getUniformLocation( program, 'uvScale' ),

			rotation:			gl.getUniformLocation( program, 'rotation' ),
			scale:				gl.getUniformLocation( program, 'scale' ),

			color:				gl.getUniformLocation( program, 'color' ),
			map:				gl.getUniformLocation( program, 'map' ),
			opacity:			gl.getUniformLocation( program, 'opacity' ),

			modelViewMatrix: 	gl.getUniformLocation( program, 'modelViewMatrix' ),
			projectionMatrix:	gl.getUniformLocation( program, 'projectionMatrix' ),

			fogType:			gl.getUniformLocation( program, 'fogType' ),
			fogDensity:			gl.getUniformLocation( program, 'fogDensity' ),
			fogNear:			gl.getUniformLocation( program, 'fogNear' ),
			fogFar:				gl.getUniformLocation( program, 'fogFar' ),
			fogColor:			gl.getUniformLocation( program, 'fogColor' ),

			alphaTest:			gl.getUniformLocation( program, 'alphaTest' )
		};

		var canvas = document.createElement( 'canvas' );
		canvas.width = 8;
		canvas.height = 8;

		var context = canvas.getContext( '2d' );
		context.fillStyle = 'white';
		context.fillRect( 0, 0, 8, 8 );

		texture = new THREE.Texture( canvas );
		texture.needsUpdate = true;

	};

	this.render = function ( scene, camera ) {

		if ( sprites.length === 0 ) return;

		// setup gl

		if ( program === undefined ) {

			init();

		}

		gl.useProgram( program );

		gl.enableVertexAttribArray( attributes.position );
		gl.enableVertexAttribArray( attributes.uv );

		gl.disable( gl.CULL_FACE );
		gl.enable( gl.BLEND );

		gl.bindBuffer( gl.ARRAY_BUFFER, vertexBuffer );
		gl.vertexAttribPointer( attributes.position, 2, gl.FLOAT, false, 2 * 8, 0 );
		gl.vertexAttribPointer( attributes.uv, 2, gl.FLOAT, false, 2 * 8, 8 );

		gl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, elementBuffer );

		gl.uniformMatrix4fv( uniforms.projectionMatrix, false, camera.projectionMatrix.elements );

		gl.activeTexture( gl.TEXTURE0 );
		gl.uniform1i( uniforms.map, 0 );

		var oldFogType = 0;
		var sceneFogType = 0;
		var fog = scene.fog;

		if ( fog ) {

			gl.uniform3f( uniforms.fogColor, fog.color.r, fog.color.g, fog.color.b );

			if ( fog instanceof THREE.Fog ) {

				gl.uniform1f( uniforms.fogNear, fog.near );
				gl.uniform1f( uniforms.fogFar, fog.far );

				gl.uniform1i( uniforms.fogType, 1 );
				oldFogType = 1;
				sceneFogType = 1;

			} else if ( fog instanceof THREE.FogExp2 ) {

				gl.uniform1f( uniforms.fogDensity, fog.density );

				gl.uniform1i( uniforms.fogType, 2 );
				oldFogType = 2;
				sceneFogType = 2;

			}

		} else {

			gl.uniform1i( uniforms.fogType, 0 );
			oldFogType = 0;
			sceneFogType = 0;

		}


		// update positions and sort

		for ( var i = 0, l = sprites.length; i < l; i ++ ) {

			var sprite = sprites[ i ];

			sprite._modelViewMatrix.multiplyMatrices( camera.matrixWorldInverse, sprite.matrixWorld );

			if ( sprite.renderDepth === null ) {

				sprite.z = - sprite._modelViewMatrix.elements[ 14 ];

			} else {

				sprite.z = sprite.renderDepth;

			}

		}

		sprites.sort( painterSortStable );

		// render all sprites

		var scale = [];

		for ( var i = 0, l = sprites.length; i < l; i ++ ) {

			var sprite = sprites[ i ];
			var material = sprite.material;

			gl.uniform1f( uniforms.alphaTest, material.alphaTest );
			gl.uniformMatrix4fv( uniforms.modelViewMatrix, false, sprite._modelViewMatrix.elements );

			scale[ 0 ] = sprite.scale.x;
			scale[ 1 ] = sprite.scale.y;

			var fogType = 0;

			if ( scene.fog && material.fog ) {

				fogType = sceneFogType;

			}

			if ( oldFogType !== fogType ) {

				gl.uniform1i( uniforms.fogType, fogType );
				oldFogType = fogType;

			}

			if ( material.map !== null ) {

				gl.uniform2f( uniforms.uvOffset, material.map.offset.x, material.map.offset.y );
				gl.uniform2f( uniforms.uvScale, material.map.repeat.x, material.map.repeat.y );

			} else {

				gl.uniform2f( uniforms.uvOffset, 0, 0 );
				gl.uniform2f( uniforms.uvScale, 1, 1 );

			}

			gl.uniform1f( uniforms.opacity, material.opacity );
			gl.uniform3f( uniforms.color, material.color.r, material.color.g, material.color.b );

			gl.uniform1f( uniforms.rotation, material.rotation );
			gl.uniform2fv( uniforms.scale, scale );

			renderer.setBlending( material.blending, material.blendEquation, material.blendSrc, material.blendDst );
			renderer.setDepthTest( material.depthTest );
			renderer.setDepthWrite( material.depthWrite );

			if ( material.map && material.map.image && material.map.image.width ) {

				renderer.setTexture( material.map, 0 );

			} else {

				renderer.setTexture( texture, 0 );

			}

			gl.drawElements( gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0 );

		}

		// restore gl

		gl.enable( gl.CULL_FACE );
		
		renderer.resetGLState();

	};

	function createProgram () {

		var program = gl.createProgram();

		var vertexShader = gl.createShader( gl.VERTEX_SHADER );
		var fragmentShader = gl.createShader( gl.FRAGMENT_SHADER );

		gl.shaderSource( vertexShader, [

			'precision ' + renderer.getPrecision() + ' float;',

			'uniform mat4 modelViewMatrix;',
			'uniform mat4 projectionMatrix;',
			'uniform float rotation;',
			'uniform vec2 scale;',
			'uniform vec2 uvOffset;',
			'uniform vec2 uvScale;',

			'attribute vec2 position;',
			'attribute vec2 uv;',

			'varying vec2 vUV;',

			'void main() {',

				'vUV = uvOffset + uv * uvScale;',

				'vec2 alignedPosition = position * scale;',

				'vec2 rotatedPosition;',
				'rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;',
				'rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;',

				'vec4 finalPosition;',

				'finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );',
				'finalPosition.xy += rotatedPosition;',
				'finalPosition = projectionMatrix * finalPosition;',

				'gl_Position = finalPosition;',

			'}'

		].join( '\n' ) );

		gl.shaderSource( fragmentShader, [

			'precision ' + renderer.getPrecision() + ' float;',

			'uniform vec3 color;',
			'uniform sampler2D map;',
			'uniform float opacity;',

			'uniform int fogType;',
			'uniform vec3 fogColor;',
			'uniform float fogDensity;',
			'uniform float fogNear;',
			'uniform float fogFar;',
			'uniform float alphaTest;',

			'varying vec2 vUV;',

			'void main() {',

				'vec4 texture = texture2D( map, vUV );',

				'if ( texture.a < alphaTest ) discard;',

				'gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );',

				'if ( fogType > 0 ) {',

					'float depth = gl_FragCoord.z / gl_FragCoord.w;',
					'float fogFactor = 0.0;',

					'if ( fogType == 1 ) {',

						'fogFactor = smoothstep( fogNear, fogFar, depth );',

					'} else {',

						'const float LOG2 = 1.442695;',
						'float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );',
						'fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );',

					'}',

					'gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );',

				'}',

			'}'

		].join( '\n' ) );

		gl.compileShader( vertexShader );
		gl.compileShader( fragmentShader );

		gl.attachShader( program, vertexShader );
		gl.attachShader( program, fragmentShader );

		gl.linkProgram( program );

		return program;

	};

	function painterSortStable ( a, b ) {

		if ( a.z !== b.z ) {

			return b.z - a.z;

		} else {

			return b.id - a.id;

		}

	};

};

// File:src/extras/GeometryUtils.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.GeometryUtils = {

	merge: function ( geometry1, geometry2, materialIndexOffset ) {

		console.warn( 'THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.' );

		var matrix;

		if ( geometry2 instanceof THREE.Mesh ) {

			geometry2.matrixAutoUpdate && geometry2.updateMatrix();

			matrix = geometry2.matrix;
			geometry2 = geometry2.geometry;

		}

		geometry1.merge( geometry2, matrix, materialIndexOffset );

	},

	center: function ( geometry ) {

		console.warn( 'THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.' );
		return geometry.center();

	}

};

// File:src/extras/ImageUtils.js

/**
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 * @author Daosheng Mu / https://github.com/DaoshengMu/
 */

THREE.ImageUtils = {

	crossOrigin: undefined,

	loadTexture: function ( url, mapping, onLoad, onError ) {

		var loader = new THREE.ImageLoader();
		loader.crossOrigin = this.crossOrigin;

		var texture = new THREE.Texture( undefined, mapping );

		loader.load( url, function ( image ) {

			texture.image = image;
			texture.needsUpdate = true;

			if ( onLoad ) onLoad( texture );

		}, undefined, function ( event ) {

			if ( onError ) onError( event );

		} );

		texture.sourceFile = url;

		return texture;

	},

	loadTextureCube: function ( array, mapping, onLoad, onError ) {

		var images = [];

		var loader = new THREE.ImageLoader();
		loader.crossOrigin = this.crossOrigin;

		var texture = new THREE.CubeTexture( images, mapping );

		// no flipping needed for cube textures

		texture.flipY = false;

		var loaded = 0;

		var loadTexture = function ( i ) {

			loader.load( array[ i ], function ( image ) {

				texture.images[ i ] = image;

				loaded += 1;

				if ( loaded === 6 ) {

					texture.needsUpdate = true;

					if ( onLoad ) onLoad( texture );

				}

			} );

		}

		for ( var i = 0, il = array.length; i < il; ++ i ) {

			loadTexture( i );

		}

		return texture;

	},

	loadCompressedTexture: function () {

		console.error( 'THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.' )

	},

	loadCompressedTextureCube: function () {

		console.error( 'THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.' )

	},

	getNormalMap: function ( image, depth ) {

		// Adapted from http://www.paulbrunt.co.uk/lab/heightnormal/

		var cross = function ( a, b ) {

			return [ a[ 1 ] * b[ 2 ] - a[ 2 ] * b[ 1 ], a[ 2 ] * b[ 0 ] - a[ 0 ] * b[ 2 ], a[ 0 ] * b[ 1 ] - a[ 1 ] * b[ 0 ] ];

		}

		var subtract = function ( a, b ) {

			return [ a[ 0 ] - b[ 0 ], a[ 1 ] - b[ 1 ], a[ 2 ] - b[ 2 ] ];

		}

		var normalize = function ( a ) {

			var l = Math.sqrt( a[ 0 ] * a[ 0 ] + a[ 1 ] * a[ 1 ] + a[ 2 ] * a[ 2 ] );
			return [ a[ 0 ] / l, a[ 1 ] / l, a[ 2 ] / l ];

		}

		depth = depth | 1;

		var width = image.width;
		var height = image.height;

		var canvas = document.createElement( 'canvas' );
		canvas.width = width;
		canvas.height = height;

		var context = canvas.getContext( '2d' );
		context.drawImage( image, 0, 0 );

		var data = context.getImageData( 0, 0, width, height ).data;
		var imageData = context.createImageData( width, height );
		var output = imageData.data;

		for ( var x = 0; x < width; x ++ ) {

			for ( var y = 0; y < height; y ++ ) {

				var ly = y - 1 < 0 ? 0 : y - 1;
				var uy = y + 1 > height - 1 ? height - 1 : y + 1;
				var lx = x - 1 < 0 ? 0 : x - 1;
				var ux = x + 1 > width - 1 ? width - 1 : x + 1;

				var points = [];
				var origin = [ 0, 0, data[ ( y * width + x ) * 4 ] / 255 * depth ];
				points.push( [ - 1, 0, data[ ( y * width + lx ) * 4 ] / 255 * depth ] );
				points.push( [ - 1, - 1, data[ ( ly * width + lx ) * 4 ] / 255 * depth ] );
				points.push( [ 0, - 1, data[ ( ly * width + x ) * 4 ] / 255 * depth ] );
				points.push( [  1, - 1, data[ ( ly * width + ux ) * 4 ] / 255 * depth ] );
				points.push( [ 1, 0, data[ ( y * width + ux ) * 4 ] / 255 * depth ] );
				points.push( [ 1, 1, data[ ( uy * width + ux ) * 4 ] / 255 * depth ] );
				points.push( [ 0, 1, data[ ( uy * width + x ) * 4 ] / 255 * depth ] );
				points.push( [ - 1, 1, data[ ( uy * width + lx ) * 4 ] / 255 * depth ] );

				var normals = [];
				var num_points = points.length;

				for ( var i = 0; i < num_points; i ++ ) {

					var v1 = points[ i ];
					var v2 = points[ ( i + 1 ) % num_points ];
					v1 = subtract( v1, origin );
					v2 = subtract( v2, origin );
					normals.push( normalize( cross( v1, v2 ) ) );

				}

				var normal = [ 0, 0, 0 ];

				for ( var i = 0; i < normals.length; i ++ ) {

					normal[ 0 ] += normals[ i ][ 0 ];
					normal[ 1 ] += normals[ i ][ 1 ];
					normal[ 2 ] += normals[ i ][ 2 ];

				}

				normal[ 0 ] /= normals.length;
				normal[ 1 ] /= normals.length;
				normal[ 2 ] /= normals.length;

				var idx = ( y * width + x ) * 4;

				output[ idx ] = ( ( normal[ 0 ] + 1.0 ) / 2.0 * 255 ) | 0;
				output[ idx + 1 ] = ( ( normal[ 1 ] + 1.0 ) / 2.0 * 255 ) | 0;
				output[ idx + 2 ] = ( normal[ 2 ] * 255 ) | 0;
				output[ idx + 3 ] = 255;

			}

		}

		context.putImageData( imageData, 0, 0 );

		return canvas;

	},

	generateDataTexture: function ( width, height, color ) {

		var size = width * height;
		var data = new Uint8Array( 3 * size );

		var r = Math.floor( color.r * 255 );
		var g = Math.floor( color.g * 255 );
		var b = Math.floor( color.b * 255 );

		for ( var i = 0; i < size; i ++ ) {

			data[ i * 3 ] 	   = r;
			data[ i * 3 + 1 ] = g;
			data[ i * 3 + 2 ] = b;

		}

		var texture = new THREE.DataTexture( data, width, height, THREE.RGBFormat );
		texture.needsUpdate = true;

		return texture;

	}

};

// File:src/extras/SceneUtils.js

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.SceneUtils = {

	createMultiMaterialObject: function ( geometry, materials ) {

		var group = new THREE.Object3D();

		for ( var i = 0, l = materials.length; i < l; i ++ ) {

			group.add( new THREE.Mesh( geometry, materials[ i ] ) );

		}

		return group;

	},

	detach: function ( child, parent, scene ) {

		child.applyMatrix( parent.matrixWorld );
		parent.remove( child );
		scene.add( child );

	},

	attach: function ( child, scene, parent ) {

		var matrixWorldInverse = new THREE.Matrix4();
		matrixWorldInverse.getInverse( parent.matrixWorld );
		child.applyMatrix( matrixWorldInverse );

		scene.remove( child );
		parent.add( child );

	}

};

// File:src/extras/FontUtils.js

/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 * @author alteredq / http://alteredqualia.com/
 *
 * For Text operations in three.js (See TextGeometry)
 *
 * It uses techniques used in:
 *
 * 	typeface.js and canvastext
 * 		For converting fonts and rendering with javascript
 *		http://typeface.neocracy.org
 *
 *	Triangulation ported from AS3
 *		Simple Polygon Triangulation
 *		http://actionsnippet.com/?p=1462
 *
 * 	A Method to triangulate shapes with holes
 *		http://www.sakri.net/blog/2009/06/12/an-approach-to-triangulating-polygons-with-holes/
 *
 */

THREE.FontUtils = {

	faces: {},

	// Just for now. face[weight][style]

	face: 'helvetiker',
	weight: 'normal',
	style: 'normal',
	size: 150,
	divisions: 10,

	getFace: function () {

		try {

			return this.faces[ this.face ][ this.weight ][ this.style ];

		} catch (e) {

			throw "The font " + this.face + " with " + this.weight + " weight and " + this.style + " style is missing."

		};

	},

	loadFace: function ( data ) {

		var family = data.familyName.toLowerCase();

		var ThreeFont = this;

		ThreeFont.faces[ family ] = ThreeFont.faces[ family ] || {};

		ThreeFont.faces[ family ][ data.cssFontWeight ] = ThreeFont.faces[ family ][ data.cssFontWeight ] || {};
		ThreeFont.faces[ family ][ data.cssFontWeight ][ data.cssFontStyle ] = data;

		var face = ThreeFont.faces[ family ][ data.cssFontWeight ][ data.cssFontStyle ] = data;

		return data;

	},

	drawText: function ( text ) {

		var characterPts = [], allPts = [];

		// RenderText

		var i, p,
			face = this.getFace(),
			scale = this.size / face.resolution,
			offset = 0,
			chars = String( text ).split( '' ),
			length = chars.length;

		var fontPaths = [];

		for ( i = 0; i < length; i ++ ) {

			var path = new THREE.Path();

			var ret = this.extractGlyphPoints( chars[ i ], face, scale, offset, path );
			offset += ret.offset;

			fontPaths.push( ret.path );

		}

		// get the width

		var width = offset / 2;
		//
		// for ( p = 0; p < allPts.length; p++ ) {
		//
		// 	allPts[ p ].x -= width;
		//
		// }

		//var extract = this.extractPoints( allPts, characterPts );
		//extract.contour = allPts;

		//extract.paths = fontPaths;
		//extract.offset = width;

		return { paths: fontPaths, offset: width };

	},




	extractGlyphPoints: function ( c, face, scale, offset, path ) {

		var pts = [];

		var i, i2, divisions,
			outline, action, length,
			scaleX, scaleY,
			x, y, cpx, cpy, cpx0, cpy0, cpx1, cpy1, cpx2, cpy2,
			laste,
			glyph = face.glyphs[ c ] || face.glyphs[ '?' ];

		if ( ! glyph ) return;

		if ( glyph.o ) {

			outline = glyph._cachedOutline || ( glyph._cachedOutline = glyph.o.split( ' ' ) );
			length = outline.length;

			scaleX = scale;
			scaleY = scale;

			for ( i = 0; i < length; ) {

				action = outline[ i ++ ];

				//console.log( action );

				switch ( action ) {

				case 'm':

					// Move To

					x = outline[ i ++ ] * scaleX + offset;
					y = outline[ i ++ ] * scaleY;

					path.moveTo( x, y );
					break;

				case 'l':

					// Line To

					x = outline[ i ++ ] * scaleX + offset;
					y = outline[ i ++ ] * scaleY;
					path.lineTo( x,y );
					break;

				case 'q':

					// QuadraticCurveTo

					cpx  = outline[ i ++ ] * scaleX + offset;
					cpy  = outline[ i ++ ] * scaleY;
					cpx1 = outline[ i ++ ] * scaleX + offset;
					cpy1 = outline[ i ++ ] * scaleY;

					path.quadraticCurveTo( cpx1, cpy1, cpx, cpy );

					laste = pts[ pts.length - 1 ];

					if ( laste ) {

						cpx0 = laste.x;
						cpy0 = laste.y;

						for ( i2 = 1, divisions = this.divisions; i2 <= divisions; i2 ++ ) {

							var t = i2 / divisions;
							var tx = THREE.Shape.Utils.b2( t, cpx0, cpx1, cpx );
							var ty = THREE.Shape.Utils.b2( t, cpy0, cpy1, cpy );
					  }

				  }

				  break;

				case 'b':

					// Cubic Bezier Curve

					cpx  = outline[ i ++ ] *  scaleX + offset;
					cpy  = outline[ i ++ ] *  scaleY;
					cpx1 = outline[ i ++ ] *  scaleX + offset;
					cpy1 = outline[ i ++ ] *  scaleY;
					cpx2 = outline[ i ++ ] *  scaleX + offset;
					cpy2 = outline[ i ++ ] *  scaleY;

					path.bezierCurveTo( cpx1, cpy1, cpx2, cpy2, cpx, cpy );

					laste = pts[ pts.length - 1 ];

					if ( laste ) {

						cpx0 = laste.x;
						cpy0 = laste.y;

						for ( i2 = 1, divisions = this.divisions; i2 <= divisions; i2 ++ ) {

							var t = i2 / divisions;
							var tx = THREE.Shape.Utils.b3( t, cpx0, cpx1, cpx2, cpx );
							var ty = THREE.Shape.Utils.b3( t, cpy0, cpy1, cpy2, cpy );

						}

					}

					break;

				}

			}
		}



		return { offset: glyph.ha * scale, path:path };
	}

};


THREE.FontUtils.generateShapes = function ( text, parameters ) {

	// Parameters 

	parameters = parameters || {};

	var size = parameters.size !== undefined ? parameters.size : 100;
	var curveSegments = parameters.curveSegments !== undefined ? parameters.curveSegments : 4;

	var font = parameters.font !== undefined ? parameters.font : 'helvetiker';
	var weight = parameters.weight !== undefined ? parameters.weight : 'normal';
	var style = parameters.style !== undefined ? parameters.style : 'normal';

	THREE.FontUtils.size = size;
	THREE.FontUtils.divisions = curveSegments;

	THREE.FontUtils.face = font;
	THREE.FontUtils.weight = weight;
	THREE.FontUtils.style = style;

	// Get a Font data json object

	var data = THREE.FontUtils.drawText( text );

	var paths = data.paths;
	var shapes = [];

	for ( var p = 0, pl = paths.length; p < pl; p ++ ) {

		Array.prototype.push.apply( shapes, paths[ p ].toShapes() );

	}

	return shapes;

};


/**
 * This code is a quick port of code written in C++ which was submitted to
 * flipcode.com by John W. Ratcliff  // July 22, 2000
 * See original code and more information here:
 * http://www.flipcode.com/archives/Efficient_Polygon_Triangulation.shtml
 *
 * ported to actionscript by Zevan Rosser
 * www.actionsnippet.com
 *
 * ported to javascript by Joshua Koo
 * http://www.lab4games.net/zz85/blog
 *
 */


( function ( namespace ) {

	var EPSILON = 0.0000000001;

	// takes in an contour array and returns

	var process = function ( contour, indices ) {

		var n = contour.length;

		if ( n < 3 ) return null;

		var result = [],
			verts = [],
			vertIndices = [];

		/* we want a counter-clockwise polygon in verts */

		var u, v, w;

		if ( area( contour ) > 0.0 ) {

			for ( v = 0; v < n; v ++ ) verts[ v ] = v;

		} else {

			for ( v = 0; v < n; v ++ ) verts[ v ] = ( n - 1 ) - v;

		}

		var nv = n;

		/*  remove nv - 2 vertices, creating 1 triangle every time */

		var count = 2 * nv;   /* error detection */

		for ( v = nv - 1; nv > 2; ) {

			/* if we loop, it is probably a non-simple polygon */

			if ( ( count -- ) <= 0 ) {

				//** Triangulate: ERROR - probable bad polygon!

				//throw ( "Warning, unable to triangulate polygon!" );
				//return null;
				// Sometimes warning is fine, especially polygons are triangulated in reverse.
				console.log( 'Warning, unable to triangulate polygon!' );

				if ( indices ) return vertIndices;
				return result;

			}

			/* three consecutive vertices in current polygon, <u,v,w> */

			u = v; 	 	if ( nv <= u ) u = 0;     /* previous */
			v = u + 1;  if ( nv <= v ) v = 0;     /* new v    */
			w = v + 1;  if ( nv <= w ) w = 0;     /* next     */

			if ( snip( contour, u, v, w, nv, verts ) ) {

				var a, b, c, s, t;

				/* true names of the vertices */

				a = verts[ u ];
				b = verts[ v ];
				c = verts[ w ];

				/* output Triangle */

				result.push( [ contour[ a ],
					contour[ b ],
					contour[ c ] ] );


				vertIndices.push( [ verts[ u ], verts[ v ], verts[ w ] ] );

				/* remove v from the remaining polygon */

				for ( s = v, t = v + 1; t < nv; s++, t++ ) {

					verts[ s ] = verts[ t ];

				}

				nv --;

				/* reset error detection counter */

				count = 2 * nv;

			}

		}

		if ( indices ) return vertIndices;
		return result;

	};

	// calculate area of the contour polygon

	var area = function ( contour ) {

		var n = contour.length;
		var a = 0.0;

		for ( var p = n - 1, q = 0; q < n; p = q ++ ) {

			a += contour[ p ].x * contour[ q ].y - contour[ q ].x * contour[ p ].y;

		}

		return a * 0.5;

	};

	var snip = function ( contour, u, v, w, n, verts ) {

		var p;
		var ax, ay, bx, by;
		var cx, cy, px, py;

		ax = contour[ verts[ u ] ].x;
		ay = contour[ verts[ u ] ].y;

		bx = contour[ verts[ v ] ].x;
		by = contour[ verts[ v ] ].y;

		cx = contour[ verts[ w ] ].x;
		cy = contour[ verts[ w ] ].y;

		if ( EPSILON > ( ( ( bx - ax ) * ( cy - ay ) ) - ( ( by - ay ) * ( cx - ax ) ) ) ) return false;

		var aX, aY, bX, bY, cX, cY;
		var apx, apy, bpx, bpy, cpx, cpy;
		var cCROSSap, bCROSScp, aCROSSbp;

		aX = cx - bx;  aY = cy - by;
		bX = ax - cx;  bY = ay - cy;
		cX = bx - ax;  cY = by - ay;

		for ( p = 0; p < n; p ++ ) {

			px = contour[ verts[ p ] ].x
			py = contour[ verts[ p ] ].y

			if ( ( ( px === ax ) && ( py === ay ) ) ||
				 ( ( px === bx ) && ( py === by ) ) ||
				 ( ( px === cx ) && ( py === cy ) ) )	continue;

			apx = px - ax;  apy = py - ay;
			bpx = px - bx;  bpy = py - by;
			cpx = px - cx;  cpy = py - cy;

			// see if p is inside triangle abc

			aCROSSbp = aX * bpy - aY * bpx;
			cCROSSap = cX * apy - cY * apx;
			bCROSScp = bX * cpy - bY * cpx;

			if ( ( aCROSSbp >= - EPSILON ) && ( bCROSScp >= - EPSILON ) && ( cCROSSap >= - EPSILON ) ) return false;

		}

		return true;

	};


	namespace.Triangulate = process;
	namespace.Triangulate.area = area;

	return namespace;

} )( THREE.FontUtils );

// To use the typeface.js face files, hook up the API
self._typeface_js = { faces: THREE.FontUtils.faces, loadFace: THREE.FontUtils.loadFace };
THREE.typeface_js = self._typeface_js;

// File:src/extras/audio/Audio.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.Audio = function ( listener ) {

	THREE.Object3D.call( this );

	this.type = 'Audio';

	this.context = listener.context;
	this.source = this.context.createBufferSource();

	this.gain = this.context.createGain();
	this.gain.connect( this.context.destination );

	this.panner = this.context.createPanner();
	this.panner.connect( this.gain );

};

THREE.Audio.prototype = Object.create( THREE.Object3D.prototype );

THREE.Audio.prototype.load = function ( file ) {

	var scope = this;

	var request = new XMLHttpRequest();
	request.open( 'GET', file, true );
	request.responseType = 'arraybuffer';
	request.onload = function ( e ) {

		scope.context.decodeAudioData( this.response, function ( buffer ) {

			scope.source.buffer = buffer;
			scope.source.connect( scope.panner );
			scope.source.start( 0 );

		} );

	};
	request.send();

	return this;

};

THREE.Audio.prototype.setLoop = function ( value ) {

	this.source.loop = value;

};

THREE.Audio.prototype.setRefDistance = function ( value ) {

	this.panner.refDistance = value;

};

THREE.Audio.prototype.setRolloffFactor = function ( value ) {

	this.panner.rolloffFactor = value;

};

THREE.Audio.prototype.updateMatrixWorld = ( function () {

	var position = new THREE.Vector3();

	return function ( force ) {

		THREE.Object3D.prototype.updateMatrixWorld.call( this, force );

		position.setFromMatrixPosition( this.matrixWorld );

		this.panner.setPosition( position.x, position.y, position.z );

	};

} )();

// File:src/extras/audio/AudioListener.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.AudioListener = function () {

	THREE.Object3D.call( this );

	this.type = 'AudioListener';

	this.context = new ( window.AudioContext || window.webkitAudioContext )();

};

THREE.AudioListener.prototype = Object.create( THREE.Object3D.prototype );

THREE.AudioListener.prototype.updateMatrixWorld = ( function () {

	var position = new THREE.Vector3();
	var quaternion = new THREE.Quaternion();
	var scale = new THREE.Vector3();

	var orientation = new THREE.Vector3();
	var velocity = new THREE.Vector3();

	var positionPrev = new THREE.Vector3();

	return function ( force ) {

		THREE.Object3D.prototype.updateMatrixWorld.call( this, force );

		var listener = this.context.listener;

		this.matrixWorld.decompose( position, quaternion, scale );

		orientation.set( 0, 0, -1 ).applyQuaternion( quaternion );
		velocity.subVectors( position, positionPrev );

		listener.setPosition( position.x, position.y, position.z );
		listener.setOrientation( orientation.x, orientation.y, orientation.z, this.up.x, this.up.y, this.up.z );
		listener.setVelocity( velocity.x, velocity.y, velocity.z );

		positionPrev.copy( position );

	};

} )();

// File:src/extras/core/Curve.js

/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 * Extensible curve object
 *
 * Some common of Curve methods
 * .getPoint(t), getTangent(t)
 * .getPointAt(u), getTagentAt(u)
 * .getPoints(), .getSpacedPoints()
 * .getLength()
 * .updateArcLengths()
 *
 * This following classes subclasses THREE.Curve:
 *
 * -- 2d classes --
 * THREE.LineCurve
 * THREE.QuadraticBezierCurve
 * THREE.CubicBezierCurve
 * THREE.SplineCurve
 * THREE.ArcCurve
 * THREE.EllipseCurve
 *
 * -- 3d classes --
 * THREE.LineCurve3
 * THREE.QuadraticBezierCurve3
 * THREE.CubicBezierCurve3
 * THREE.SplineCurve3
 * THREE.ClosedSplineCurve3
 *
 * A series of curves can be represented as a THREE.CurvePath
 *
 **/

/**************************************************************
 *	Abstract Curve base class
 **************************************************************/

THREE.Curve = function () {

};

// Virtual base class method to overwrite and implement in subclasses
//	- t [0 .. 1]

THREE.Curve.prototype.getPoint = function ( t ) {

	console.log( "Warning, getPoint() not implemented!" );
	return null;

};

// Get point at relative position in curve according to arc length
// - u [0 .. 1]

THREE.Curve.prototype.getPointAt = function ( u ) {

	var t = this.getUtoTmapping( u );
	return this.getPoint( t );

};

// Get sequence of points using getPoint( t )

THREE.Curve.prototype.getPoints = function ( divisions ) {

	if ( ! divisions ) divisions = 5;

	var d, pts = [];

	for ( d = 0; d <= divisions; d ++ ) {

		pts.push( this.getPoint( d / divisions ) );

	}

	return pts;

};

// Get sequence of points using getPointAt( u )

THREE.Curve.prototype.getSpacedPoints = function ( divisions ) {

	if ( ! divisions ) divisions = 5;

	var d, pts = [];

	for ( d = 0; d <= divisions; d ++ ) {

		pts.push( this.getPointAt( d / divisions ) );

	}

	return pts;

};

// Get total curve arc length

THREE.Curve.prototype.getLength = function () {

	var lengths = this.getLengths();
	return lengths[ lengths.length - 1 ];

};

// Get list of cumulative segment lengths

THREE.Curve.prototype.getLengths = function ( divisions ) {

	if ( ! divisions ) divisions = (this.__arcLengthDivisions) ? (this.__arcLengthDivisions): 200;

	if ( this.cacheArcLengths
		&& ( this.cacheArcLengths.length == divisions + 1 )
		&& ! this.needsUpdate) {

		//console.log( "cached", this.cacheArcLengths );
		return this.cacheArcLengths;

	}

	this.needsUpdate = false;

	var cache = [];
	var current, last = this.getPoint( 0 );
	var p, sum = 0;

	cache.push( 0 );

	for ( p = 1; p <= divisions; p ++ ) {

		current = this.getPoint ( p / divisions );
		sum += current.distanceTo( last );
		cache.push( sum );
		last = current;

	}

	this.cacheArcLengths = cache;

	return cache; // { sums: cache, sum:sum }; Sum is in the last element.

};


THREE.Curve.prototype.updateArcLengths = function() {
	this.needsUpdate = true;
	this.getLengths();
};

// Given u ( 0 .. 1 ), get a t to find p. This gives you points which are equi distance

THREE.Curve.prototype.getUtoTmapping = function ( u, distance ) {

	var arcLengths = this.getLengths();

	var i = 0, il = arcLengths.length;

	var targetArcLength; // The targeted u distance value to get

	if ( distance ) {

		targetArcLength = distance;

	} else {

		targetArcLength = u * arcLengths[ il - 1 ];

	}

	//var time = Date.now();

	// binary search for the index with largest value smaller than target u distance

	var low = 0, high = il - 1, comparison;

	while ( low <= high ) {

		i = Math.floor( low + ( high - low ) / 2 ); // less likely to overflow, though probably not issue here, JS doesn't really have integers, all numbers are floats

		comparison = arcLengths[ i ] - targetArcLength;

		if ( comparison < 0 ) {

			low = i + 1;
			continue;

		} else if ( comparison > 0 ) {

			high = i - 1;
			continue;

		} else {

			high = i;
			break;

			// DONE

		}

	}

	i = high;

	//console.log('b' , i, low, high, Date.now()- time);

	if ( arcLengths[ i ] == targetArcLength ) {

		var t = i / ( il - 1 );
		return t;

	}

	// we could get finer grain at lengths, or use simple interpolatation between two points

	var lengthBefore = arcLengths[ i ];
    var lengthAfter = arcLengths[ i + 1 ];

    var segmentLength = lengthAfter - lengthBefore;

    // determine where we are between the 'before' and 'after' points

    var segmentFraction = ( targetArcLength - lengthBefore ) / segmentLength;

    // add that fractional amount to t

    var t = ( i + segmentFraction ) / ( il -1 );

	return t;

};

// Returns a unit vector tangent at t
// In case any sub curve does not implement its tangent derivation,
// 2 points a small delta apart will be used to find its gradient
// which seems to give a reasonable approximation

THREE.Curve.prototype.getTangent = function( t ) {

	var delta = 0.0001;
	var t1 = t - delta;
	var t2 = t + delta;

	// Capping in case of danger

	if ( t1 < 0 ) t1 = 0;
	if ( t2 > 1 ) t2 = 1;

	var pt1 = this.getPoint( t1 );
	var pt2 = this.getPoint( t2 );

	var vec = pt2.clone().sub(pt1);
	return vec.normalize();

};


THREE.Curve.prototype.getTangentAt = function ( u ) {

	var t = this.getUtoTmapping( u );
	return this.getTangent( t );

};





/**************************************************************
 *	Utils
 **************************************************************/

THREE.Curve.Utils = {

	tangentQuadraticBezier: function ( t, p0, p1, p2 ) {

		return 2 * ( 1 - t ) * ( p1 - p0 ) + 2 * t * ( p2 - p1 );

	},

	// Puay Bing, thanks for helping with this derivative!

	tangentCubicBezier: function (t, p0, p1, p2, p3 ) {

		return - 3 * p0 * (1 - t) * (1 - t)  +
			3 * p1 * (1 - t) * (1-t) - 6 *t *p1 * (1-t) +
			6 * t *  p2 * (1-t) - 3 * t * t * p2 +
			3 * t * t * p3;

	},

	tangentSpline: function ( t, p0, p1, p2, p3 ) {

		// To check if my formulas are correct

		var h00 = 6 * t * t - 6 * t; 	// derived from 2t^3 − 3t^2 + 1
		var h10 = 3 * t * t - 4 * t + 1; // t^3 − 2t^2 + t
		var h01 = - 6 * t * t + 6 * t; 	// − 2t3 + 3t2
		var h11 = 3 * t * t - 2 * t;	// t3 − t2

		return h00 + h10 + h01 + h11;

	},

	// Catmull-Rom

	interpolate: function( p0, p1, p2, p3, t ) {

		var v0 = ( p2 - p0 ) * 0.5;
		var v1 = ( p3 - p1 ) * 0.5;
		var t2 = t * t;
		var t3 = t * t2;
		return ( 2 * p1 - 2 * p2 + v0 + v1 ) * t3 + ( - 3 * p1 + 3 * p2 - 2 * v0 - v1 ) * t2 + v0 * t + p1;

	}

};


// TODO: Transformation for Curves?

/**************************************************************
 *	3D Curves
 **************************************************************/

// A Factory method for creating new curve subclasses

THREE.Curve.create = function ( constructor, getPointFunc ) {

	constructor.prototype = Object.create( THREE.Curve.prototype );
	constructor.prototype.getPoint = getPointFunc;

	return constructor;

};

// File:src/extras/core/CurvePath.js

/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 *
 **/

/**************************************************************
 *	Curved Path - a curve path is simply a array of connected
 *  curves, but retains the api of a curve
 **************************************************************/

THREE.CurvePath = function () {

	this.curves = [];
	this.bends = [];
	
	this.autoClose = false; // Automatically closes the path
};

THREE.CurvePath.prototype = Object.create( THREE.Curve.prototype );

THREE.CurvePath.prototype.add = function ( curve ) {

	this.curves.push( curve );

};

THREE.CurvePath.prototype.checkConnection = function() {
	// TODO
	// If the ending of curve is not connected to the starting
	// or the next curve, then, this is not a real path
};

THREE.CurvePath.prototype.closePath = function() {
	// TODO Test
	// and verify for vector3 (needs to implement equals)
	// Add a line curve if start and end of lines are not connected
	var startPoint = this.curves[0].getPoint(0);
	var endPoint = this.curves[this.curves.length-1].getPoint(1);
	
	if (! startPoint.equals(endPoint)) {
		this.curves.push( new THREE.LineCurve(endPoint, startPoint) );
	}
	
};

// To get accurate point with reference to
// entire path distance at time t,
// following has to be done:

// 1. Length of each sub path have to be known
// 2. Locate and identify type of curve
// 3. Get t for the curve
// 4. Return curve.getPointAt(t')

THREE.CurvePath.prototype.getPoint = function( t ) {

	var d = t * this.getLength();
	var curveLengths = this.getCurveLengths();
	var i = 0, diff, curve;

	// To think about boundaries points.

	while ( i < curveLengths.length ) {

		if ( curveLengths[ i ] >= d ) {

			diff = curveLengths[ i ] - d;
			curve = this.curves[ i ];

			var u = 1 - diff / curve.getLength();

			return curve.getPointAt( u );

			break;
		}

		i ++;

	}

	return null;

	// loop where sum != 0, sum > d , sum+1 <d

};

/*
THREE.CurvePath.prototype.getTangent = function( t ) {
};*/


// We cannot use the default THREE.Curve getPoint() with getLength() because in
// THREE.Curve, getLength() depends on getPoint() but in THREE.CurvePath
// getPoint() depends on getLength

THREE.CurvePath.prototype.getLength = function() {

	var lens = this.getCurveLengths();
	return lens[ lens.length - 1 ];

};

// Compute lengths and cache them
// We cannot overwrite getLengths() because UtoT mapping uses it.

THREE.CurvePath.prototype.getCurveLengths = function() {

	// We use cache values if curves and cache array are same length

	if ( this.cacheLengths && this.cacheLengths.length == this.curves.length ) {

		return this.cacheLengths;

	};

	// Get length of subsurve
	// Push sums into cached array

	var lengths = [], sums = 0;
	var i, il = this.curves.length;

	for ( i = 0; i < il; i ++ ) {

		sums += this.curves[ i ].getLength();
		lengths.push( sums );

	}

	this.cacheLengths = lengths;

	return lengths;

};



// Returns min and max coordinates

THREE.CurvePath.prototype.getBoundingBox = function () {

	var points = this.getPoints();

	var maxX, maxY, maxZ;
	var minX, minY, minZ;

	maxX = maxY = Number.NEGATIVE_INFINITY;
	minX = minY = Number.POSITIVE_INFINITY;

	var p, i, il, sum;

	var v3 = points[0] instanceof THREE.Vector3;

	sum = v3 ? new THREE.Vector3() : new THREE.Vector2();

	for ( i = 0, il = points.length; i < il; i ++ ) {

		p = points[ i ];

		if ( p.x > maxX ) maxX = p.x;
		else if ( p.x < minX ) minX = p.x;

		if ( p.y > maxY ) maxY = p.y;
		else if ( p.y < minY ) minY = p.y;

		if ( v3 ) {

			if ( p.z > maxZ ) maxZ = p.z;
			else if ( p.z < minZ ) minZ = p.z;

		}

		sum.add( p );

	}

	var ret = {

		minX: minX,
		minY: minY,
		maxX: maxX,
		maxY: maxY

	};

	if ( v3 ) {

		ret.maxZ = maxZ;
		ret.minZ = minZ;

	}

	return ret;

};

/**************************************************************
 *	Create Geometries Helpers
 **************************************************************/

/// Generate geometry from path points (for Line or Points objects)

THREE.CurvePath.prototype.createPointsGeometry = function( divisions ) {

	var pts = this.getPoints( divisions, true );
	return this.createGeometry( pts );

};

// Generate geometry from equidistance sampling along the path

THREE.CurvePath.prototype.createSpacedPointsGeometry = function( divisions ) {

	var pts = this.getSpacedPoints( divisions, true );
	return this.createGeometry( pts );

};

THREE.CurvePath.prototype.createGeometry = function( points ) {

	var geometry = new THREE.Geometry();

	for ( var i = 0; i < points.length; i ++ ) {

		geometry.vertices.push( new THREE.Vector3( points[ i ].x, points[ i ].y, points[ i ].z || 0) );

	}

	return geometry;

};


/**************************************************************
 *	Bend / Wrap Helper Methods
 **************************************************************/

// Wrap path / Bend modifiers?

THREE.CurvePath.prototype.addWrapPath = function ( bendpath ) {

	this.bends.push( bendpath );

};

THREE.CurvePath.prototype.getTransformedPoints = function( segments, bends ) {

	var oldPts = this.getPoints( segments ); // getPoints getSpacedPoints
	var i, il;

	if ( ! bends ) {

		bends = this.bends;

	}

	for ( i = 0, il = bends.length; i < il; i ++ ) {

		oldPts = this.getWrapPoints( oldPts, bends[ i ] );

	}

	return oldPts;

};

THREE.CurvePath.prototype.getTransformedSpacedPoints = function( segments, bends ) {

	var oldPts = this.getSpacedPoints( segments );

	var i, il;

	if ( ! bends ) {

		bends = this.bends;

	}

	for ( i = 0, il = bends.length; i < il; i ++ ) {

		oldPts = this.getWrapPoints( oldPts, bends[ i ] );

	}

	return oldPts;

};

// This returns getPoints() bend/wrapped around the contour of a path.
// Read http://www.planetclegg.com/projects/WarpingTextToSplines.html

THREE.CurvePath.prototype.getWrapPoints = function ( oldPts, path ) {

	var bounds = this.getBoundingBox();

	var i, il, p, oldX, oldY, xNorm;

	for ( i = 0, il = oldPts.length; i < il; i ++ ) {

		p = oldPts[ i ];

		oldX = p.x;
		oldY = p.y;

		xNorm = oldX / bounds.maxX;

		// If using actual distance, for length > path, requires line extrusions
		//xNorm = path.getUtoTmapping(xNorm, oldX); // 3 styles. 1) wrap stretched. 2) wrap stretch by arc length 3) warp by actual distance

		xNorm = path.getUtoTmapping( xNorm, oldX );

		// check for out of bounds?

		var pathPt = path.getPoint( xNorm );
		var normal = path.getTangent( xNorm );
		normal.set( - normal.y, normal.x ).multiplyScalar( oldY );

		p.x = pathPt.x + normal.x;
		p.y = pathPt.y + normal.y;

	}

	return oldPts;

};


// File:src/extras/core/Gyroscope.js

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.Gyroscope = function () {

	THREE.Object3D.call( this );

};

THREE.Gyroscope.prototype = Object.create( THREE.Object3D.prototype );

THREE.Gyroscope.prototype.updateMatrixWorld = ( function () {

	var translationObject = new THREE.Vector3();
	var quaternionObject = new THREE.Quaternion();
	var scaleObject = new THREE.Vector3();

	var translationWorld = new THREE.Vector3();
	var quaternionWorld = new THREE.Quaternion();
	var scaleWorld = new THREE.Vector3();

	return function ( force ) {

		this.matrixAutoUpdate && this.updateMatrix();

		// update matrixWorld

		if ( this.matrixWorldNeedsUpdate || force ) {

			if ( this.parent ) {

				this.matrixWorld.multiplyMatrices( this.parent.matrixWorld, this.matrix );

				this.matrixWorld.decompose( translationWorld, quaternionWorld, scaleWorld );
				this.matrix.decompose( translationObject, quaternionObject, scaleObject );

				this.matrixWorld.compose( translationWorld, quaternionObject, scaleWorld );


			} else {

				this.matrixWorld.copy( this.matrix );

			}


			this.matrixWorldNeedsUpdate = false;

			force = true;

		}

		// update children

		for ( var i = 0, l = this.children.length; i < l; i ++ ) {

			this.children[ i ].updateMatrixWorld( force );

		}

	};
	
}() );

// File:src/extras/core/Path.js

/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 * Creates free form 2d path using series of points, lines or curves.
 *
 **/

THREE.Path = function ( points ) {

	THREE.CurvePath.call(this);

	this.actions = [];

	if ( points ) {

		this.fromPoints( points );

	}

};

THREE.Path.prototype = Object.create( THREE.CurvePath.prototype );

THREE.PathActions = {

	MOVE_TO: 'moveTo',
	LINE_TO: 'lineTo',
	QUADRATIC_CURVE_TO: 'quadraticCurveTo', // Bezier quadratic curve
	BEZIER_CURVE_TO: 'bezierCurveTo', 		// Bezier cubic curve
	CSPLINE_THRU: 'splineThru',				// Catmull-rom spline
	ARC: 'arc',								// Circle
	ELLIPSE: 'ellipse'
};

// TODO Clean up PATH API

// Create path using straight lines to connect all points
// - vectors: array of Vector2

THREE.Path.prototype.fromPoints = function ( vectors ) {

	this.moveTo( vectors[ 0 ].x, vectors[ 0 ].y );

	for ( var v = 1, vlen = vectors.length; v < vlen; v ++ ) {

		this.lineTo( vectors[ v ].x, vectors[ v ].y );

	};

};

// startPath() endPath()?

THREE.Path.prototype.moveTo = function ( x, y ) {

	var args = Array.prototype.slice.call( arguments );
	this.actions.push( { action: THREE.PathActions.MOVE_TO, args: args } );

};

THREE.Path.prototype.lineTo = function ( x, y ) {

	var args = Array.prototype.slice.call( arguments );

	var lastargs = this.actions[ this.actions.length - 1 ].args;

	var x0 = lastargs[ lastargs.length - 2 ];
	var y0 = lastargs[ lastargs.length - 1 ];

	var curve = new THREE.LineCurve( new THREE.Vector2( x0, y0 ), new THREE.Vector2( x, y ) );
	this.curves.push( curve );

	this.actions.push( { action: THREE.PathActions.LINE_TO, args: args } );

};

THREE.Path.prototype.quadraticCurveTo = function( aCPx, aCPy, aX, aY ) {

	var args = Array.prototype.slice.call( arguments );

	var lastargs = this.actions[ this.actions.length - 1 ].args;

	var x0 = lastargs[ lastargs.length - 2 ];
	var y0 = lastargs[ lastargs.length - 1 ];

	var curve = new THREE.QuadraticBezierCurve( new THREE.Vector2( x0, y0 ),
												new THREE.Vector2( aCPx, aCPy ),
												new THREE.Vector2( aX, aY ) );
	this.curves.push( curve );

	this.actions.push( { action: THREE.PathActions.QUADRATIC_CURVE_TO, args: args } );

};

THREE.Path.prototype.bezierCurveTo = function( aCP1x, aCP1y,
											   aCP2x, aCP2y,
											   aX, aY ) {

	var args = Array.prototype.slice.call( arguments );

	var lastargs = this.actions[ this.actions.length - 1 ].args;

	var x0 = lastargs[ lastargs.length - 2 ];
	var y0 = lastargs[ lastargs.length - 1 ];

	var curve = new THREE.CubicBezierCurve( new THREE.Vector2( x0, y0 ),
											new THREE.Vector2( aCP1x, aCP1y ),
											new THREE.Vector2( aCP2x, aCP2y ),
											new THREE.Vector2( aX, aY ) );
	this.curves.push( curve );

	this.actions.push( { action: THREE.PathActions.BEZIER_CURVE_TO, args: args } );

};

THREE.Path.prototype.splineThru = function( pts /*Array of Vector*/ ) {

	var args = Array.prototype.slice.call( arguments );
	var lastargs = this.actions[ this.actions.length - 1 ].args;

	var x0 = lastargs[ lastargs.length - 2 ];
	var y0 = lastargs[ lastargs.length - 1 ];
//---
	var npts = [ new THREE.Vector2( x0, y0 ) ];
	Array.prototype.push.apply( npts, pts );

	var curve = new THREE.SplineCurve( npts );
	this.curves.push( curve );

	this.actions.push( { action: THREE.PathActions.CSPLINE_THRU, args: args } );

};

// FUTURE: Change the API or follow canvas API?

THREE.Path.prototype.arc = function ( aX, aY, aRadius,
									  aStartAngle, aEndAngle, aClockwise ) {

	var lastargs = this.actions[ this.actions.length - 1].args;
	var x0 = lastargs[ lastargs.length - 2 ];
	var y0 = lastargs[ lastargs.length - 1 ];

	this.absarc(aX + x0, aY + y0, aRadius,
		aStartAngle, aEndAngle, aClockwise );

 };

 THREE.Path.prototype.absarc = function ( aX, aY, aRadius,
									  aStartAngle, aEndAngle, aClockwise ) {
	this.absellipse(aX, aY, aRadius, aRadius, aStartAngle, aEndAngle, aClockwise);
 };

THREE.Path.prototype.ellipse = function ( aX, aY, xRadius, yRadius,
									  aStartAngle, aEndAngle, aClockwise ) {

	var lastargs = this.actions[ this.actions.length - 1].args;
	var x0 = lastargs[ lastargs.length - 2 ];
	var y0 = lastargs[ lastargs.length - 1 ];

	this.absellipse(aX + x0, aY + y0, xRadius, yRadius,
		aStartAngle, aEndAngle, aClockwise );

 };


THREE.Path.prototype.absellipse = function ( aX, aY, xRadius, yRadius,
									  aStartAngle, aEndAngle, aClockwise ) {

	var args = Array.prototype.slice.call( arguments );
	var curve = new THREE.EllipseCurve( aX, aY, xRadius, yRadius,
									aStartAngle, aEndAngle, aClockwise );
	this.curves.push( curve );

	var lastPoint = curve.getPoint(1);
	args.push(lastPoint.x);
	args.push(lastPoint.y);

	this.actions.push( { action: THREE.PathActions.ELLIPSE, args: args } );

 };

THREE.Path.prototype.getSpacedPoints = function ( divisions, closedPath ) {

	if ( ! divisions ) divisions = 40;

	var points = [];

	for ( var i = 0; i < divisions; i ++ ) {

		points.push( this.getPoint( i / divisions ) );

		//if( !this.getPoint( i / divisions ) ) throw "DIE";

	}

	// if ( closedPath ) {
	//
	// 	points.push( points[ 0 ] );
	//
	// }

	return points;

};

/* Return an array of vectors based on contour of the path */

THREE.Path.prototype.getPoints = function( divisions, closedPath ) {

	if (this.useSpacedPoints) {
		console.log('tata');
		return this.getSpacedPoints( divisions, closedPath );
	}

	divisions = divisions || 12;

	var points = [];

	var i, il, item, action, args;
	var cpx, cpy, cpx2, cpy2, cpx1, cpy1, cpx0, cpy0,
		laste, j,
		t, tx, ty;

	for ( i = 0, il = this.actions.length; i < il; i ++ ) {

		item = this.actions[ i ];

		action = item.action;
		args = item.args;

		switch( action ) {

		case THREE.PathActions.MOVE_TO:

			points.push( new THREE.Vector2( args[ 0 ], args[ 1 ] ) );

			break;

		case THREE.PathActions.LINE_TO:

			points.push( new THREE.Vector2( args[ 0 ], args[ 1 ] ) );

			break;

		case THREE.PathActions.QUADRATIC_CURVE_TO:

			cpx  = args[ 2 ];
			cpy  = args[ 3 ];

			cpx1 = args[ 0 ];
			cpy1 = args[ 1 ];

			if ( points.length > 0 ) {

				laste = points[ points.length - 1 ];

				cpx0 = laste.x;
				cpy0 = laste.y;

			} else {

				laste = this.actions[ i - 1 ].args;

				cpx0 = laste[ laste.length - 2 ];
				cpy0 = laste[ laste.length - 1 ];

			}

			for ( j = 1; j <= divisions; j ++ ) {

				t = j / divisions;

				tx = THREE.Shape.Utils.b2( t, cpx0, cpx1, cpx );
				ty = THREE.Shape.Utils.b2( t, cpy0, cpy1, cpy );

				points.push( new THREE.Vector2( tx, ty ) );

			}

			break;

		case THREE.PathActions.BEZIER_CURVE_TO:

			cpx  = args[ 4 ];
			cpy  = args[ 5 ];

			cpx1 = args[ 0 ];
			cpy1 = args[ 1 ];

			cpx2 = args[ 2 ];
			cpy2 = args[ 3 ];

			if ( points.length > 0 ) {

				laste = points[ points.length - 1 ];

				cpx0 = laste.x;
				cpy0 = laste.y;

			} else {

				laste = this.actions[ i - 1 ].args;

				cpx0 = laste[ laste.length - 2 ];
				cpy0 = laste[ laste.length - 1 ];

			}


			for ( j = 1; j <= divisions; j ++ ) {

				t = j / divisions;

				tx = THREE.Shape.Utils.b3( t, cpx0, cpx1, cpx2, cpx );
				ty = THREE.Shape.Utils.b3( t, cpy0, cpy1, cpy2, cpy );

				points.push( new THREE.Vector2( tx, ty ) );

			}

			break;

		case THREE.PathActions.CSPLINE_THRU:

			laste = this.actions[ i - 1 ].args;

			var last = new THREE.Vector2( laste[ laste.length - 2 ], laste[ laste.length - 1 ] );
			var spts = [ last ];

			var n = divisions * args[ 0 ].length;

			spts = spts.concat( args[ 0 ] );

			var spline = new THREE.SplineCurve( spts );

			for ( j = 1; j <= n; j ++ ) {

				points.push( spline.getPointAt( j / n ) ) ;

			}

			break;

		case THREE.PathActions.ARC:

			var aX = args[ 0 ], aY = args[ 1 ],
				aRadius = args[ 2 ],
				aStartAngle = args[ 3 ], aEndAngle = args[ 4 ],
				aClockwise = !! args[ 5 ];

			var deltaAngle = aEndAngle - aStartAngle;
			var angle;
			var tdivisions = divisions * 2;

			for ( j = 1; j <= tdivisions; j ++ ) {

				t = j / tdivisions;

				if ( ! aClockwise ) {

					t = 1 - t;

				}

				angle = aStartAngle + t * deltaAngle;

				tx = aX + aRadius * Math.cos( angle );
				ty = aY + aRadius * Math.sin( angle );

				//console.log('t', t, 'angle', angle, 'tx', tx, 'ty', ty);

				points.push( new THREE.Vector2( tx, ty ) );

			}

			//console.log(points);

		  break;
		  
		case THREE.PathActions.ELLIPSE:

			var aX = args[ 0 ], aY = args[ 1 ],
				xRadius = args[ 2 ],
				yRadius = args[ 3 ],
				aStartAngle = args[ 4 ], aEndAngle = args[ 5 ],
				aClockwise = !! args[ 6 ];


			var deltaAngle = aEndAngle - aStartAngle;
			var angle;
			var tdivisions = divisions * 2;

			for ( j = 1; j <= tdivisions; j ++ ) {

				t = j / tdivisions;

				if ( ! aClockwise ) {

					t = 1 - t;

				}

				angle = aStartAngle + t * deltaAngle;

				tx = aX + xRadius * Math.cos( angle );
				ty = aY + yRadius * Math.sin( angle );

				//console.log('t', t, 'angle', angle, 'tx', tx, 'ty', ty);

				points.push( new THREE.Vector2( tx, ty ) );

			}

			//console.log(points);

		  break;

		} // end switch

	}



	// Normalize to remove the closing point by default.
	var lastPoint = points[ points.length - 1];
	var EPSILON = 0.0000000001;
	if ( Math.abs(lastPoint.x - points[ 0 ].x) < EPSILON &&
			 Math.abs(lastPoint.y - points[ 0 ].y) < EPSILON)
		points.splice( points.length - 1, 1);
	if ( closedPath ) {

		points.push( points[ 0 ] );

	}

	return points;

};

//
// Breaks path into shapes
//
//	Assumptions (if parameter isCCW==true the opposite holds):
//	- solid shapes are defined clockwise (CW)
//	- holes are defined counterclockwise (CCW)
//
//	If parameter noHoles==true:
//  - all subPaths are regarded as solid shapes
//  - definition order CW/CCW has no relevance
//

THREE.Path.prototype.toShapes = function( isCCW, noHoles ) {

	function extractSubpaths( inActions ) {

		var i, il, item, action, args;

		var subPaths = [], lastPath = new THREE.Path();

		for ( i = 0, il = inActions.length; i < il; i ++ ) {

			item = inActions[ i ];

			args = item.args;
			action = item.action;

			if ( action == THREE.PathActions.MOVE_TO ) {

				if ( lastPath.actions.length != 0 ) {

					subPaths.push( lastPath );
					lastPath = new THREE.Path();

				}

			}

			lastPath[ action ].apply( lastPath, args );

		}

		if ( lastPath.actions.length != 0 ) {

			subPaths.push( lastPath );

		}

		// console.log(subPaths);

		return	subPaths;
	}

	function toShapesNoHoles( inSubpaths ) {

		var shapes = [];

		for ( var i = 0, il = inSubpaths.length; i < il; i ++ ) {

			var tmpPath = inSubpaths[ i ];

			var tmpShape = new THREE.Shape();
			tmpShape.actions = tmpPath.actions;
			tmpShape.curves = tmpPath.curves;

			shapes.push( tmpShape );
		}

		//console.log("shape", shapes);

		return shapes;
	};

	function isPointInsidePolygon( inPt, inPolygon ) {
		var EPSILON = 0.0000000001;

		var polyLen = inPolygon.length;

		// inPt on polygon contour => immediate success    or
		// toggling of inside/outside at every single! intersection point of an edge
		//  with the horizontal line through inPt, left of inPt
		//  not counting lowerY endpoints of edges and whole edges on that line
		var inside = false;
		for( var p = polyLen - 1, q = 0; q < polyLen; p = q ++ ) {
			var edgeLowPt  = inPolygon[ p ];
			var edgeHighPt = inPolygon[ q ];

			var edgeDx = edgeHighPt.x - edgeLowPt.x;
			var edgeDy = edgeHighPt.y - edgeLowPt.y;

			if ( Math.abs(edgeDy) > EPSILON ) {			// not parallel
				if ( edgeDy < 0 ) {
					edgeLowPt  = inPolygon[ q ]; edgeDx = - edgeDx;
					edgeHighPt = inPolygon[ p ]; edgeDy = - edgeDy;
				}
				if ( ( inPt.y < edgeLowPt.y ) || ( inPt.y > edgeHighPt.y ) ) 		continue;

				if ( inPt.y == edgeLowPt.y ) {
					if ( inPt.x == edgeLowPt.x )		return	true;		// inPt is on contour ?
					// continue;				// no intersection or edgeLowPt => doesn't count !!!
				} else {
					var perpEdge = edgeDy * (inPt.x - edgeLowPt.x) - edgeDx * (inPt.y - edgeLowPt.y);
					if ( perpEdge == 0 )				return	true;		// inPt is on contour ?
					if ( perpEdge < 0 ) 				continue;
					inside = ! inside;		// true intersection left of inPt
				}
			} else {		// parallel or colinear
				if ( inPt.y != edgeLowPt.y ) 		continue;			// parallel
				// egde lies on the same horizontal line as inPt
				if ( ( ( edgeHighPt.x <= inPt.x ) && ( inPt.x <= edgeLowPt.x ) ) ||
					 ( ( edgeLowPt.x <= inPt.x ) && ( inPt.x <= edgeHighPt.x ) ) )		return	true;	// inPt: Point on contour !
				// continue;
			}
		}

		return	inside;
	}


	var subPaths = extractSubpaths( this.actions );
	if ( subPaths.length == 0 ) return [];

	if ( noHoles === true )	return	toShapesNoHoles( subPaths );


	var solid, tmpPath, tmpShape, shapes = [];

	if ( subPaths.length == 1) {

		tmpPath = subPaths[0];
		tmpShape = new THREE.Shape();
		tmpShape.actions = tmpPath.actions;
		tmpShape.curves = tmpPath.curves;
		shapes.push( tmpShape );
		return shapes;

	}

	var holesFirst = ! THREE.Shape.Utils.isClockWise( subPaths[ 0 ].getPoints() );
	holesFirst = isCCW ? ! holesFirst : holesFirst;

	// console.log("Holes first", holesFirst);
	
	var betterShapeHoles = [];
	var newShapes = [];
	var newShapeHoles = [];
	var mainIdx = 0;
	var tmpPoints;

	newShapes[mainIdx] = undefined;
	newShapeHoles[mainIdx] = [];

	var i, il;

	for ( i = 0, il = subPaths.length; i < il; i ++ ) {

		tmpPath = subPaths[ i ];
		tmpPoints = tmpPath.getPoints();
		solid = THREE.Shape.Utils.isClockWise( tmpPoints );
		solid = isCCW ? ! solid : solid;

		if ( solid ) {

			if ( (! holesFirst ) && ( newShapes[mainIdx] ) )	mainIdx ++;

			newShapes[mainIdx] = { s: new THREE.Shape(), p: tmpPoints };
			newShapes[mainIdx].s.actions = tmpPath.actions;
			newShapes[mainIdx].s.curves = tmpPath.curves;
			
			if ( holesFirst )	mainIdx ++;
			newShapeHoles[mainIdx] = [];

			//console.log('cw', i);

		} else {

			newShapeHoles[mainIdx].push( { h: tmpPath, p: tmpPoints[0] } );

			//console.log('ccw', i);

		}

	}

	// only Holes? -> probably all Shapes with wrong orientation
	if ( ! newShapes[0] )	return	toShapesNoHoles( subPaths );


	if ( newShapes.length > 1 ) {
		var ambigious = false;
		var toChange = [];

		for (var sIdx = 0, sLen = newShapes.length; sIdx < sLen; sIdx ++ ) {
			betterShapeHoles[sIdx] = [];
		}
		for (var sIdx = 0, sLen = newShapes.length; sIdx < sLen; sIdx ++ ) {
			var sh = newShapes[sIdx];
			var sho = newShapeHoles[sIdx];
			for (var hIdx = 0; hIdx < sho.length; hIdx ++ ) {
				var ho = sho[hIdx];
				var hole_unassigned = true;
				for (var s2Idx = 0; s2Idx < newShapes.length; s2Idx ++ ) {
					if ( isPointInsidePolygon( ho.p, newShapes[s2Idx].p ) ) {
						if ( sIdx != s2Idx )		toChange.push( { froms: sIdx, tos: s2Idx, hole: hIdx } );
						if ( hole_unassigned ) {
							hole_unassigned = false;
							betterShapeHoles[s2Idx].push( ho );
						} else {
							ambigious = true;
						}
					}
				}
				if ( hole_unassigned ) { betterShapeHoles[sIdx].push( ho ); }
			}
		}
		// console.log("ambigious: ", ambigious);
		if ( toChange.length > 0 ) {
			// console.log("to change: ", toChange);
			if (! ambigious)	newShapeHoles = betterShapeHoles;
		}
	}

	var tmpHoles, j, jl;
	for ( i = 0, il = newShapes.length; i < il; i ++ ) {
		tmpShape = newShapes[i].s;
		shapes.push( tmpShape );
		tmpHoles = newShapeHoles[i];
		for ( j = 0, jl = tmpHoles.length; j < jl; j ++ ) {
			tmpShape.holes.push( tmpHoles[j].h );
		}
	}

	//console.log("shape", shapes);

	return shapes;

};

// File:src/extras/core/Shape.js

/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 * Defines a 2d shape plane using paths.
 **/

// STEP 1 Create a path.
// STEP 2 Turn path into shape.
// STEP 3 ExtrudeGeometry takes in Shape/Shapes
// STEP 3a - Extract points from each shape, turn to vertices
// STEP 3b - Triangulate each shape, add faces.

THREE.Shape = function () {

	THREE.Path.apply( this, arguments );
	this.holes = [];

};

THREE.Shape.prototype = Object.create( THREE.Path.prototype );

// Convenience method to return ExtrudeGeometry

THREE.Shape.prototype.extrude = function ( options ) {

	var extruded = new THREE.ExtrudeGeometry( this, options );
	return extruded;

};

// Convenience method to return ShapeGeometry

THREE.Shape.prototype.makeGeometry = function ( options ) {

	var geometry = new THREE.ShapeGeometry( this, options );
	return geometry;

};

// Get points of holes

THREE.Shape.prototype.getPointsHoles = function ( divisions ) {

	var i, il = this.holes.length, holesPts = [];

	for ( i = 0; i < il; i ++ ) {

		holesPts[ i ] = this.holes[ i ].getTransformedPoints( divisions, this.bends );

	}

	return holesPts;

};

// Get points of holes (spaced by regular distance)

THREE.Shape.prototype.getSpacedPointsHoles = function ( divisions ) {

	var i, il = this.holes.length, holesPts = [];

	for ( i = 0; i < il; i ++ ) {

		holesPts[ i ] = this.holes[ i ].getTransformedSpacedPoints( divisions, this.bends );

	}

	return holesPts;

};


// Get points of shape and holes (keypoints based on segments parameter)

THREE.Shape.prototype.extractAllPoints = function ( divisions ) {

	return {

		shape: this.getTransformedPoints( divisions ),
		holes: this.getPointsHoles( divisions )

	};

};

THREE.Shape.prototype.extractPoints = function ( divisions ) {

	if (this.useSpacedPoints) {
		return this.extractAllSpacedPoints(divisions);
	}

	return this.extractAllPoints(divisions);

};

//
// THREE.Shape.prototype.extractAllPointsWithBend = function ( divisions, bend ) {
//
// 	return {
//
// 		shape: this.transform( bend, divisions ),
// 		holes: this.getPointsHoles( divisions, bend )
//
// 	};
//
// };

// Get points of shape and holes (spaced by regular distance)

THREE.Shape.prototype.extractAllSpacedPoints = function ( divisions ) {

	return {

		shape: this.getTransformedSpacedPoints( divisions ),
		holes: this.getSpacedPointsHoles( divisions )

	};

};

/**************************************************************
 *	Utils
 **************************************************************/

THREE.Shape.Utils = {

	triangulateShape: function ( contour, holes ) {

		function point_in_segment_2D_colin( inSegPt1, inSegPt2, inOtherPt ) {
			// inOtherPt needs to be colinear to the inSegment
			if ( inSegPt1.x != inSegPt2.x ) {
				if ( inSegPt1.x < inSegPt2.x ) {
					return	( ( inSegPt1.x <= inOtherPt.x ) && ( inOtherPt.x <= inSegPt2.x ) );
				} else {
					return	( ( inSegPt2.x <= inOtherPt.x ) && ( inOtherPt.x <= inSegPt1.x ) );
				}
			} else {
				if ( inSegPt1.y < inSegPt2.y ) {
					return	( ( inSegPt1.y <= inOtherPt.y ) && ( inOtherPt.y <= inSegPt2.y ) );
				} else {
					return	( ( inSegPt2.y <= inOtherPt.y ) && ( inOtherPt.y <= inSegPt1.y ) );
				}
			}
		}

		function intersect_segments_2D( inSeg1Pt1, inSeg1Pt2, inSeg2Pt1, inSeg2Pt2, inExcludeAdjacentSegs ) {
			var EPSILON = 0.0000000001;

			var seg1dx = inSeg1Pt2.x - inSeg1Pt1.x,   seg1dy = inSeg1Pt2.y - inSeg1Pt1.y;
			var seg2dx = inSeg2Pt2.x - inSeg2Pt1.x,   seg2dy = inSeg2Pt2.y - inSeg2Pt1.y;

			var seg1seg2dx = inSeg1Pt1.x - inSeg2Pt1.x;
			var seg1seg2dy = inSeg1Pt1.y - inSeg2Pt1.y;

			var limit		= seg1dy * seg2dx - seg1dx * seg2dy;
			var perpSeg1	= seg1dy * seg1seg2dx - seg1dx * seg1seg2dy;

			if ( Math.abs(limit) > EPSILON ) {			// not parallel

				var perpSeg2;
				if ( limit > 0 ) {
					if ( ( perpSeg1 < 0 ) || ( perpSeg1 > limit ) ) 		return [];
					perpSeg2 = seg2dy * seg1seg2dx - seg2dx * seg1seg2dy;
					if ( ( perpSeg2 < 0 ) || ( perpSeg2 > limit ) ) 		return [];
				} else {
					if ( ( perpSeg1 > 0 ) || ( perpSeg1 < limit ) ) 		return [];
					perpSeg2 = seg2dy * seg1seg2dx - seg2dx * seg1seg2dy;
					if ( ( perpSeg2 > 0 ) || ( perpSeg2 < limit ) ) 		return [];
				}

				// i.e. to reduce rounding errors
				// intersection at endpoint of segment#1?
				if ( perpSeg2 == 0 ) {
					if ( ( inExcludeAdjacentSegs ) &&
						 ( ( perpSeg1 == 0 ) || ( perpSeg1 == limit ) ) )		return [];
					return  [ inSeg1Pt1 ];
				}
				if ( perpSeg2 == limit ) {
					if ( ( inExcludeAdjacentSegs ) &&
						 ( ( perpSeg1 == 0 ) || ( perpSeg1 == limit ) ) )		return [];
					return  [ inSeg1Pt2 ];
				}
				// intersection at endpoint of segment#2?
				if ( perpSeg1 == 0 )		return  [ inSeg2Pt1 ];
				if ( perpSeg1 == limit )	return  [ inSeg2Pt2 ];

				// return real intersection point
				var factorSeg1 = perpSeg2 / limit;
				return	[ { x: inSeg1Pt1.x + factorSeg1 * seg1dx,
							y: inSeg1Pt1.y + factorSeg1 * seg1dy } ];

			} else {		// parallel or colinear
				if ( ( perpSeg1 != 0 ) ||
					 ( seg2dy * seg1seg2dx != seg2dx * seg1seg2dy ) ) 			return [];

				// they are collinear or degenerate
				var seg1Pt = ( (seg1dx == 0) && (seg1dy == 0) );	// segment1 ist just a point?
				var seg2Pt = ( (seg2dx == 0) && (seg2dy == 0) );	// segment2 ist just a point?
				// both segments are points
				if ( seg1Pt && seg2Pt ) {
					if ( (inSeg1Pt1.x != inSeg2Pt1.x) ||
						 (inSeg1Pt1.y != inSeg2Pt1.y) )		return [];   	// they are distinct  points
					return  [ inSeg1Pt1 ];                 					// they are the same point
				}
				// segment#1  is a single point
				if ( seg1Pt ) {
					if (! point_in_segment_2D_colin( inSeg2Pt1, inSeg2Pt2, inSeg1Pt1 ) )		return [];		// but not in segment#2
					return  [ inSeg1Pt1 ];
				}
				// segment#2  is a single point
				if ( seg2Pt ) {
					if (! point_in_segment_2D_colin( inSeg1Pt1, inSeg1Pt2, inSeg2Pt1 ) )		return [];		// but not in segment#1
					return  [ inSeg2Pt1 ];
				}

				// they are collinear segments, which might overlap
				var seg1min, seg1max, seg1minVal, seg1maxVal;
				var seg2min, seg2max, seg2minVal, seg2maxVal;
				if (seg1dx != 0) {		// the segments are NOT on a vertical line
					if ( inSeg1Pt1.x < inSeg1Pt2.x ) {
						seg1min = inSeg1Pt1; seg1minVal = inSeg1Pt1.x;
						seg1max = inSeg1Pt2; seg1maxVal = inSeg1Pt2.x;
					} else {
						seg1min = inSeg1Pt2; seg1minVal = inSeg1Pt2.x;
						seg1max = inSeg1Pt1; seg1maxVal = inSeg1Pt1.x;
					}
					if ( inSeg2Pt1.x < inSeg2Pt2.x ) {
						seg2min = inSeg2Pt1; seg2minVal = inSeg2Pt1.x;
						seg2max = inSeg2Pt2; seg2maxVal = inSeg2Pt2.x;
					} else {
						seg2min = inSeg2Pt2; seg2minVal = inSeg2Pt2.x;
						seg2max = inSeg2Pt1; seg2maxVal = inSeg2Pt1.x;
					}
				} else {				// the segments are on a vertical line
					if ( inSeg1Pt1.y < inSeg1Pt2.y ) {
						seg1min = inSeg1Pt1; seg1minVal = inSeg1Pt1.y;
						seg1max = inSeg1Pt2; seg1maxVal = inSeg1Pt2.y;
					} else {
						seg1min = inSeg1Pt2; seg1minVal = inSeg1Pt2.y;
						seg1max = inSeg1Pt1; seg1maxVal = inSeg1Pt1.y;
					}
					if ( inSeg2Pt1.y < inSeg2Pt2.y ) {
						seg2min = inSeg2Pt1; seg2minVal = inSeg2Pt1.y;
						seg2max = inSeg2Pt2; seg2maxVal = inSeg2Pt2.y;
					} else {
						seg2min = inSeg2Pt2; seg2minVal = inSeg2Pt2.y;
						seg2max = inSeg2Pt1; seg2maxVal = inSeg2Pt1.y;
					}
				}
				if ( seg1minVal <= seg2minVal ) {
					if ( seg1maxVal <  seg2minVal )	return [];
					if ( seg1maxVal == seg2minVal )	{
						if ( inExcludeAdjacentSegs )		return [];
						return [ seg2min ];
					}
					if ( seg1maxVal <= seg2maxVal )	return [ seg2min, seg1max ];
					return	[ seg2min, seg2max ];
				} else {
					if ( seg1minVal >  seg2maxVal )	return [];
					if ( seg1minVal == seg2maxVal )	{
						if ( inExcludeAdjacentSegs )		return [];
						return [ seg1min ];
					}
					if ( seg1maxVal <= seg2maxVal )	return [ seg1min, seg1max ];
					return	[ seg1min, seg2max ];
				}
			}
		}

		function isPointInsideAngle( inVertex, inLegFromPt, inLegToPt, inOtherPt ) {
			// The order of legs is important

			var EPSILON = 0.0000000001;

			// translation of all points, so that Vertex is at (0,0)
			var legFromPtX	= inLegFromPt.x - inVertex.x,  legFromPtY	= inLegFromPt.y - inVertex.y;
			var legToPtX	= inLegToPt.x	- inVertex.x,  legToPtY		= inLegToPt.y	- inVertex.y;
			var otherPtX	= inOtherPt.x	- inVertex.x,  otherPtY		= inOtherPt.y	- inVertex.y;

			// main angle >0: < 180 deg.; 0: 180 deg.; <0: > 180 deg.
			var from2toAngle	= legFromPtX * legToPtY - legFromPtY * legToPtX;
			var from2otherAngle	= legFromPtX * otherPtY - legFromPtY * otherPtX;

			if ( Math.abs(from2toAngle) > EPSILON ) {			// angle != 180 deg.

				var other2toAngle		= otherPtX * legToPtY - otherPtY * legToPtX;
				// console.log( "from2to: " + from2toAngle + ", from2other: " + from2otherAngle + ", other2to: " + other2toAngle );

				if ( from2toAngle > 0 ) {				// main angle < 180 deg.
					return	( ( from2otherAngle >= 0 ) && ( other2toAngle >= 0 ) );
				} else {								// main angle > 180 deg.
					return	( ( from2otherAngle >= 0 ) || ( other2toAngle >= 0 ) );
				}
			} else {										// angle == 180 deg.
				// console.log( "from2to: 180 deg., from2other: " + from2otherAngle  );
				return	( from2otherAngle > 0 );
			}
		}


		function removeHoles( contour, holes ) {

			var shape = contour.concat(); // work on this shape
			var hole;

			function isCutLineInsideAngles( inShapeIdx, inHoleIdx ) {
				// Check if hole point lies within angle around shape point
				var lastShapeIdx = shape.length - 1;

				var prevShapeIdx = inShapeIdx - 1;
				if ( prevShapeIdx < 0 )			prevShapeIdx = lastShapeIdx;

				var nextShapeIdx = inShapeIdx + 1;
				if ( nextShapeIdx > lastShapeIdx )	nextShapeIdx = 0;

				var insideAngle = isPointInsideAngle( shape[inShapeIdx], shape[ prevShapeIdx ], shape[ nextShapeIdx ], hole[inHoleIdx] );
				if (! insideAngle ) {
					// console.log( "Vertex (Shape): " + inShapeIdx + ", Point: " + hole[inHoleIdx].x + "/" + hole[inHoleIdx].y );
					return	false;
				}

				// Check if shape point lies within angle around hole point
				var lastHoleIdx = hole.length - 1;

				var prevHoleIdx = inHoleIdx - 1;
				if ( prevHoleIdx < 0 )			prevHoleIdx = lastHoleIdx;

				var nextHoleIdx = inHoleIdx + 1;
				if ( nextHoleIdx > lastHoleIdx )	nextHoleIdx = 0;

				insideAngle = isPointInsideAngle( hole[inHoleIdx], hole[ prevHoleIdx ], hole[ nextHoleIdx ], shape[inShapeIdx] );
				if (! insideAngle ) {
					// console.log( "Vertex (Hole): " + inHoleIdx + ", Point: " + shape[inShapeIdx].x + "/" + shape[inShapeIdx].y );
					return	false;
				}

				return	true;
			}

			function intersectsShapeEdge( inShapePt, inHolePt ) {
				// checks for intersections with shape edges
				var sIdx, nextIdx, intersection;
				for ( sIdx = 0; sIdx < shape.length; sIdx ++ ) {
					nextIdx = sIdx+1; nextIdx %= shape.length;
					intersection = intersect_segments_2D( inShapePt, inHolePt, shape[sIdx], shape[nextIdx], true );
					if ( intersection.length > 0 )		return	true;
				}

				return	false;
			}

			var indepHoles = [];

			function intersectsHoleEdge( inShapePt, inHolePt ) {
				// checks for intersections with hole edges
				var ihIdx, chkHole,
					hIdx, nextIdx, intersection;
				for ( ihIdx = 0; ihIdx < indepHoles.length; ihIdx ++ ) {
					chkHole = holes[indepHoles[ihIdx]];
					for ( hIdx = 0; hIdx < chkHole.length; hIdx ++ ) {
						nextIdx = hIdx+1; nextIdx %= chkHole.length;
						intersection = intersect_segments_2D( inShapePt, inHolePt, chkHole[hIdx], chkHole[nextIdx], true );
						if ( intersection.length > 0 )		return	true;
					}
				}
				return	false;
			}

			var holeIndex, shapeIndex,
				shapePt, holePt,
				holeIdx, cutKey, failedCuts = [],
				tmpShape1, tmpShape2,
				tmpHole1, tmpHole2;

			for ( var h = 0, hl = holes.length; h < hl; h ++ ) {

				indepHoles.push( h );

			}

			var minShapeIndex = 0;
			var counter = indepHoles.length * 2;
			while ( indepHoles.length > 0 ) {
				counter --;
				if ( counter < 0 ) {
					console.log( "Infinite Loop! Holes left:" + indepHoles.length + ", Probably Hole outside Shape!" );
					break;
				}

				// search for shape-vertex and hole-vertex,
				// which can be connected without intersections
				for ( shapeIndex = minShapeIndex; shapeIndex < shape.length; shapeIndex ++ ) {

					shapePt = shape[ shapeIndex ];
					holeIndex	= - 1;

					// search for hole which can be reached without intersections
					for ( var h = 0; h < indepHoles.length; h ++ ) {
						holeIdx = indepHoles[h];

						// prevent multiple checks
						cutKey = shapePt.x + ":" + shapePt.y + ":" + holeIdx;
						if ( failedCuts[cutKey] !== undefined )			continue;

						hole = holes[holeIdx];
						for ( var h2 = 0; h2 < hole.length; h2 ++ ) {
							holePt = hole[ h2 ];
							if (! isCutLineInsideAngles( shapeIndex, h2 ) )		continue;
							if ( intersectsShapeEdge( shapePt, holePt ) )		continue;
							if ( intersectsHoleEdge( shapePt, holePt ) )		continue;

							holeIndex = h2;
							indepHoles.splice(h,1);

							tmpShape1 = shape.slice( 0, shapeIndex+1 );
							tmpShape2 = shape.slice( shapeIndex );
							tmpHole1 = hole.slice( holeIndex );
							tmpHole2 = hole.slice( 0, holeIndex+1 );

							shape = tmpShape1.concat( tmpHole1 ).concat( tmpHole2 ).concat( tmpShape2 );

							minShapeIndex = shapeIndex;

							// Debug only, to show the selected cuts
							// glob_CutLines.push( [ shapePt, holePt ] );

							break;
						}
						if ( holeIndex >= 0 )	break;		// hole-vertex found

						failedCuts[cutKey] = true;			// remember failure
					}
					if ( holeIndex >= 0 )	break;		// hole-vertex found
				}
			}

			return shape; 			/* shape with no holes */
		}


		var i, il, f, face,
			key, index,
			allPointsMap = {};

		// To maintain reference to old shape, one must match coordinates, or offset the indices from original arrays. It's probably easier to do the first.

		var allpoints = contour.concat();

		for ( var h = 0, hl = holes.length; h < hl; h ++ ) {

			Array.prototype.push.apply( allpoints, holes[h] );

		}

		//console.log( "allpoints",allpoints, allpoints.length );

		// prepare all points map

		for ( i = 0, il = allpoints.length; i < il; i ++ ) {

			key = allpoints[ i ].x + ":" + allpoints[ i ].y;

			if ( allPointsMap[ key ] !== undefined ) {

				console.log( "Duplicate point", key );

			}

			allPointsMap[ key ] = i;

		}

		// remove holes by cutting paths to holes and adding them to the shape
		var shapeWithoutHoles = removeHoles( contour, holes );

		var triangles = THREE.FontUtils.Triangulate( shapeWithoutHoles, false ); // True returns indices for points of spooled shape
		return triangles;
		//console.log( "triangles",triangles, triangles.length );

		// check all face vertices against all points map

		for ( i = 0, il = triangles.length; i < il; i ++ ) {

			face = triangles[ i ];

			for ( f = 0; f < 3; f ++ ) {

				key = face[ f ].x + ":" + face[ f ].y;

				index = allPointsMap[ key ];

				if ( index !== undefined ) {

					face[ f ] = index;

				}

			}

		}

		return triangles.concat();

	},

	isClockWise: function ( pts ) {

		return THREE.FontUtils.Triangulate.area( pts ) < 0;

	},

	// Bezier Curves formulas obtained from
	// http://en.wikipedia.org/wiki/B%C3%A9zier_curve

	// Quad Bezier Functions

	b2p0: function ( t, p ) {

		var k = 1 - t;
		return k * k * p;

	},

	b2p1: function ( t, p ) {

		return 2 * ( 1 - t ) * t * p;

	},

	b2p2: function ( t, p ) {

		return t * t * p;

	},

	b2: function ( t, p0, p1, p2 ) {

		return this.b2p0( t, p0 ) + this.b2p1( t, p1 ) + this.b2p2( t, p2 );

	},

	// Cubic Bezier Functions

	b3p0: function ( t, p ) {

		var k = 1 - t;
		return k * k * k * p;

	},

	b3p1: function ( t, p ) {

		var k = 1 - t;
		return 3 * k * k * t * p;

	},

	b3p2: function ( t, p ) {

		var k = 1 - t;
		return 3 * k * t * t * p;

	},

	b3p3: function ( t, p ) {

		return t * t * t * p;

	},

	b3: function ( t, p0, p1, p2, p3 ) {

		return this.b3p0( t, p0 ) + this.b3p1( t, p1 ) + this.b3p2( t, p2 ) +  this.b3p3( t, p3 );

	}

};


// File:src/extras/curves/LineCurve.js

/**************************************************************
 *	Line
 **************************************************************/

THREE.LineCurve = function ( v1, v2 ) {

	this.v1 = v1;
	this.v2 = v2;

};

THREE.LineCurve.prototype = Object.create( THREE.Curve.prototype );

THREE.LineCurve.prototype.getPoint = function ( t ) {

	var point = this.v2.clone().sub(this.v1);
	point.multiplyScalar( t ).add( this.v1 );

	return point;

};

// Line curve is linear, so we can overwrite default getPointAt

THREE.LineCurve.prototype.getPointAt = function ( u ) {

	return this.getPoint( u );

};

THREE.LineCurve.prototype.getTangent = function( t ) {

	var tangent = this.v2.clone().sub(this.v1);

	return tangent.normalize();

};

// File:src/extras/curves/QuadraticBezierCurve.js

/**************************************************************
 *	Quadratic Bezier curve
 **************************************************************/


THREE.QuadraticBezierCurve = function ( v0, v1, v2 ) {

	this.v0 = v0;
	this.v1 = v1;
	this.v2 = v2;

};

THREE.QuadraticBezierCurve.prototype = Object.create( THREE.Curve.prototype );


THREE.QuadraticBezierCurve.prototype.getPoint = function ( t ) {

	var vector = new THREE.Vector2();

	vector.x = THREE.Shape.Utils.b2( t, this.v0.x, this.v1.x, this.v2.x );
	vector.y = THREE.Shape.Utils.b2( t, this.v0.y, this.v1.y, this.v2.y );

	return vector;

};


THREE.QuadraticBezierCurve.prototype.getTangent = function( t ) {

	var vector = new THREE.Vector2();

	vector.x = THREE.Curve.Utils.tangentQuadraticBezier( t, this.v0.x, this.v1.x, this.v2.x );
	vector.y = THREE.Curve.Utils.tangentQuadraticBezier( t, this.v0.y, this.v1.y, this.v2.y );

	// returns unit vector

	return vector.normalize();

};

// File:src/extras/curves/CubicBezierCurve.js

/**************************************************************
 *	Cubic Bezier curve
 **************************************************************/

THREE.CubicBezierCurve = function ( v0, v1, v2, v3 ) {

	this.v0 = v0;
	this.v1 = v1;
	this.v2 = v2;
	this.v3 = v3;

};

THREE.CubicBezierCurve.prototype = Object.create( THREE.Curve.prototype );

THREE.CubicBezierCurve.prototype.getPoint = function ( t ) {

	var tx, ty;

	tx = THREE.Shape.Utils.b3( t, this.v0.x, this.v1.x, this.v2.x, this.v3.x );
	ty = THREE.Shape.Utils.b3( t, this.v0.y, this.v1.y, this.v2.y, this.v3.y );

	return new THREE.Vector2( tx, ty );

};

THREE.CubicBezierCurve.prototype.getTangent = function( t ) {

	var tx, ty;

	tx = THREE.Curve.Utils.tangentCubicBezier( t, this.v0.x, this.v1.x, this.v2.x, this.v3.x );
	ty = THREE.Curve.Utils.tangentCubicBezier( t, this.v0.y, this.v1.y, this.v2.y, this.v3.y );

	var tangent = new THREE.Vector2( tx, ty );
	tangent.normalize();

	return tangent;

};

// File:src/extras/curves/SplineCurve.js

/**************************************************************
 *	Spline curve
 **************************************************************/

THREE.SplineCurve = function ( points /* array of Vector2 */ ) {

	this.points = ( points == undefined ) ? [] : points;

};

THREE.SplineCurve.prototype = Object.create( THREE.Curve.prototype );

THREE.SplineCurve.prototype.getPoint = function ( t ) {

	var points = this.points;
	var point = ( points.length - 1 ) * t;

	var intPoint = Math.floor( point );
	var weight = point - intPoint;

	var point0 = points[ intPoint == 0 ? intPoint : intPoint - 1 ]
	var point1 = points[ intPoint ]
	var point2 = points[ intPoint > points.length - 2 ? points.length -1 : intPoint + 1 ]
	var point3 = points[ intPoint > points.length - 3 ? points.length -1 : intPoint + 2 ]

	var vector = new THREE.Vector2();

	vector.x = THREE.Curve.Utils.interpolate( point0.x, point1.x, point2.x, point3.x, weight );
	vector.y = THREE.Curve.Utils.interpolate( point0.y, point1.y, point2.y, point3.y, weight );

	return vector;

};

// File:src/extras/curves/EllipseCurve.js

/**************************************************************
 *	Ellipse curve
 **************************************************************/

THREE.EllipseCurve = function ( aX, aY, xRadius, yRadius, aStartAngle, aEndAngle, aClockwise ) {

	this.aX = aX;
	this.aY = aY;

	this.xRadius = xRadius;
	this.yRadius = yRadius;

	this.aStartAngle = aStartAngle;
	this.aEndAngle = aEndAngle;

	this.aClockwise = aClockwise;

};

THREE.EllipseCurve.prototype = Object.create( THREE.Curve.prototype );

THREE.EllipseCurve.prototype.getPoint = function ( t ) {

	var deltaAngle = this.aEndAngle - this.aStartAngle;

	if ( deltaAngle < 0 ) deltaAngle += Math.PI * 2;
	if ( deltaAngle > Math.PI * 2 ) deltaAngle -= Math.PI * 2;

	var angle;

	if ( this.aClockwise === true ) {

		angle = this.aEndAngle + ( 1 - t ) * ( Math.PI * 2 - deltaAngle );

	} else {

		angle = this.aStartAngle + t * deltaAngle;

	}
	
	var vector = new THREE.Vector2();

	vector.x = this.aX + this.xRadius * Math.cos( angle );
	vector.y = this.aY + this.yRadius * Math.sin( angle );

	return vector;

};

// File:src/extras/curves/ArcCurve.js

/**************************************************************
 *	Arc curve
 **************************************************************/

THREE.ArcCurve = function ( aX, aY, aRadius, aStartAngle, aEndAngle, aClockwise ) {

	THREE.EllipseCurve.call( this, aX, aY, aRadius, aRadius, aStartAngle, aEndAngle, aClockwise );
};

THREE.ArcCurve.prototype = Object.create( THREE.EllipseCurve.prototype );

// File:src/extras/curves/LineCurve3.js

/**************************************************************
 *	Line3D
 **************************************************************/

THREE.LineCurve3 = THREE.Curve.create(

	function ( v1, v2 ) {

		this.v1 = v1;
		this.v2 = v2;

	},

	function ( t ) {

		var vector = new THREE.Vector3();

		vector.subVectors( this.v2, this.v1 ); // diff
		vector.multiplyScalar( t );
		vector.add( this.v1 );

		return vector;

	}

);

// File:src/extras/curves/QuadraticBezierCurve3.js

/**************************************************************
 *	Quadratic Bezier 3D curve
 **************************************************************/

THREE.QuadraticBezierCurve3 = THREE.Curve.create(

	function ( v0, v1, v2 ) {

		this.v0 = v0;
		this.v1 = v1;
		this.v2 = v2;

	},

	function ( t ) {

		var vector = new THREE.Vector3();

		vector.x = THREE.Shape.Utils.b2( t, this.v0.x, this.v1.x, this.v2.x );
		vector.y = THREE.Shape.Utils.b2( t, this.v0.y, this.v1.y, this.v2.y );
		vector.z = THREE.Shape.Utils.b2( t, this.v0.z, this.v1.z, this.v2.z );

		return vector;

	}

);

// File:src/extras/curves/CubicBezierCurve3.js

/**************************************************************
 *	Cubic Bezier 3D curve
 **************************************************************/

THREE.CubicBezierCurve3 = THREE.Curve.create(

	function ( v0, v1, v2, v3 ) {

		this.v0 = v0;
		this.v1 = v1;
		this.v2 = v2;
		this.v3 = v3;

	},

	function ( t ) {

		var vector = new THREE.Vector3();

		vector.x = THREE.Shape.Utils.b3( t, this.v0.x, this.v1.x, this.v2.x, this.v3.x );
		vector.y = THREE.Shape.Utils.b3( t, this.v0.y, this.v1.y, this.v2.y, this.v3.y );
		vector.z = THREE.Shape.Utils.b3( t, this.v0.z, this.v1.z, this.v2.z, this.v3.z );

		return vector;

	}

);

// File:src/extras/curves/SplineCurve3.js

/**************************************************************
 *	Spline 3D curve
 **************************************************************/


THREE.SplineCurve3 = THREE.Curve.create(

	function ( points /* array of Vector3 */) {

		this.points = ( points == undefined ) ? [] : points;

	},

	function ( t ) {

		var points = this.points;
		var point = ( points.length - 1 ) * t;

		var intPoint = Math.floor( point );
		var weight = point - intPoint;

		var point0 = points[ intPoint == 0 ? intPoint : intPoint - 1 ];
		var point1 = points[ intPoint ];
		var point2 = points[ intPoint > points.length - 2 ? points.length - 1 : intPoint + 1 ];
		var point3 = points[ intPoint > points.length - 3 ? points.length - 1 : intPoint + 2 ];

		var vector = new THREE.Vector3();

		vector.x = THREE.Curve.Utils.interpolate( point0.x, point1.x, point2.x, point3.x, weight );
		vector.y = THREE.Curve.Utils.interpolate( point0.y, point1.y, point2.y, point3.y, weight );
		vector.z = THREE.Curve.Utils.interpolate( point0.z, point1.z, point2.z, point3.z, weight );

		return vector;

	}

);

// File:src/extras/curves/ClosedSplineCurve3.js

/**************************************************************
 *	Closed Spline 3D curve
 **************************************************************/


THREE.ClosedSplineCurve3 = THREE.Curve.create(

	function ( points /* array of Vector3 */) {

		this.points = ( points == undefined ) ? [] : points;

	},

	function ( t ) {

		var points = this.points;
		var point = ( points.length - 0 ) * t; // This needs to be from 0-length +1

		var intPoint = Math.floor( point );
		var weight = point - intPoint;

		intPoint += intPoint > 0 ? 0 : ( Math.floor( Math.abs( intPoint ) / points.length ) + 1 ) * points.length;

		var point0 = points[ ( intPoint - 1 ) % points.length ];
		var point1 = points[ ( intPoint     ) % points.length ];
		var point2 = points[ ( intPoint + 1 ) % points.length ];
		var point3 = points[ ( intPoint + 2 ) % points.length ];

		var vector = new THREE.Vector3();

		vector.x = THREE.Curve.Utils.interpolate( point0.x, point1.x, point2.x, point3.x, weight );
		vector.y = THREE.Curve.Utils.interpolate( point0.y, point1.y, point2.y, point3.y, weight );
		vector.z = THREE.Curve.Utils.interpolate( point0.z, point1.z, point2.z, point3.z, weight );

		return vector;

	}

);

// File:src/extras/animation/AnimationHandler.js

/**
 * @author mikael emtinger / http://gomo.se/
 */

THREE.AnimationHandler = {

	LINEAR: 0,
	CATMULLROM: 1,
	CATMULLROM_FORWARD: 2,

	//

	add: function () { console.warn( 'THREE.AnimationHandler.add() has been deprecated.' ); },
	get: function () { console.warn( 'THREE.AnimationHandler.get() has been deprecated.' ); },
	remove: function () { console.warn( 'THREE.AnimationHandler.remove() has been deprecated.' ); },

	//

	animations: [],

	init: function ( data ) {

		if ( data.initialized === true ) return;

		// loop through all keys

		for ( var h = 0; h < data.hierarchy.length; h ++ ) {

			for ( var k = 0; k < data.hierarchy[ h ].keys.length; k ++ ) {

				// remove minus times

				if ( data.hierarchy[ h ].keys[ k ].time < 0 ) {

					 data.hierarchy[ h ].keys[ k ].time = 0;

				}

				// create quaternions

				if ( data.hierarchy[ h ].keys[ k ].rot !== undefined &&
				  ! ( data.hierarchy[ h ].keys[ k ].rot instanceof THREE.Quaternion ) ) {

					var quat = data.hierarchy[ h ].keys[ k ].rot;
					data.hierarchy[ h ].keys[ k ].rot = new THREE.Quaternion().fromArray( quat );

				}

			}

			// prepare morph target keys

			if ( data.hierarchy[ h ].keys.length && data.hierarchy[ h ].keys[ 0 ].morphTargets !== undefined ) {

				// get all used

				var usedMorphTargets = {};

				for ( var k = 0; k < data.hierarchy[ h ].keys.length; k ++ ) {

					for ( var m = 0; m < data.hierarchy[ h ].keys[ k ].morphTargets.length; m ++ ) {

						var morphTargetName = data.hierarchy[ h ].keys[ k ].morphTargets[ m ];
						usedMorphTargets[ morphTargetName ] = - 1;

					}

				}

				data.hierarchy[ h ].usedMorphTargets = usedMorphTargets;


				// set all used on all frames

				for ( var k = 0; k < data.hierarchy[ h ].keys.length; k ++ ) {

					var influences = {};

					for ( var morphTargetName in usedMorphTargets ) {

						for ( var m = 0; m < data.hierarchy[ h ].keys[ k ].morphTargets.length; m ++ ) {

							if ( data.hierarchy[ h ].keys[ k ].morphTargets[ m ] === morphTargetName ) {

								influences[ morphTargetName ] = data.hierarchy[ h ].keys[ k ].morphTargetsInfluences[ m ];
								break;

							}

						}

						if ( m === data.hierarchy[ h ].keys[ k ].morphTargets.length ) {

							influences[ morphTargetName ] = 0;

						}

					}

					data.hierarchy[ h ].keys[ k ].morphTargetsInfluences = influences;

				}

			}


			// remove all keys that are on the same time

			for ( var k = 1; k < data.hierarchy[ h ].keys.length; k ++ ) {

				if ( data.hierarchy[ h ].keys[ k ].time === data.hierarchy[ h ].keys[ k - 1 ].time ) {

					data.hierarchy[ h ].keys.splice( k, 1 );
					k --;

				}

			}


			// set index

			for ( var k = 0; k < data.hierarchy[ h ].keys.length; k ++ ) {

				data.hierarchy[ h ].keys[ k ].index = k;

			}

		}

		data.initialized = true;

		return data;

	},

	parse: function ( root ) {

		var parseRecurseHierarchy = function ( root, hierarchy ) {

			hierarchy.push( root );

			for ( var c = 0; c < root.children.length; c ++ )
				parseRecurseHierarchy( root.children[ c ], hierarchy );

		};

		// setup hierarchy

		var hierarchy = [];

		if ( root instanceof THREE.SkinnedMesh ) {

			for ( var b = 0; b < root.skeleton.bones.length; b ++ ) {

				hierarchy.push( root.skeleton.bones[ b ] );

			}

		} else {

			parseRecurseHierarchy( root, hierarchy );

		}

		return hierarchy;

	},

	play: function ( animation ) {

		if ( this.animations.indexOf( animation ) === - 1 ) {

			this.animations.push( animation );

		}

	},

	stop: function ( animation ) {

		var index = this.animations.indexOf( animation );

		if ( index !== - 1 ) {

			this.animations.splice( index, 1 );

		}

	},

	update: function ( deltaTimeMS ) {

		for ( var i = 0; i < this.animations.length; i ++ ) {

			this.animations[ i ].resetBlendWeights( );

		}

		for ( var i = 0; i < this.animations.length; i ++ ) {

			this.animations[ i ].update( deltaTimeMS );

		}

	}

};

// File:src/extras/animation/Animation.js

/**
 * @author mikael emtinger / http://gomo.se/
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 */

THREE.Animation = function ( root, data ) {

	this.root = root;
	this.data = THREE.AnimationHandler.init( data );
	this.hierarchy = THREE.AnimationHandler.parse( root );

	this.currentTime = 0;
	this.timeScale = 1;

	this.isPlaying = false;
	this.loop = true;
	this.weight = 0;

	this.interpolationType = THREE.AnimationHandler.LINEAR;

};


THREE.Animation.prototype.keyTypes = [ "pos", "rot", "scl" ];


THREE.Animation.prototype.play = function ( startTime, weight ) {

	this.currentTime = startTime !== undefined ? startTime : 0;
	this.weight = weight !== undefined ? weight: 1;

	this.isPlaying = true;

	this.reset();

	THREE.AnimationHandler.play( this );

};


THREE.Animation.prototype.stop = function() {

	this.isPlaying = false;

	THREE.AnimationHandler.stop( this );

};

THREE.Animation.prototype.reset = function () {

	for ( var h = 0, hl = this.hierarchy.length; h < hl; h ++ ) {

		var object = this.hierarchy[ h ];

		object.matrixAutoUpdate = true;

		if ( object.animationCache === undefined ) {

			object.animationCache = {
				animations: {},
				blending: {
					positionWeight: 0.0,
					quaternionWeight: 0.0,
					scaleWeight: 0.0
				}
			};
		}

		if ( object.animationCache.animations[this.data.name] === undefined ) {

			object.animationCache.animations[this.data.name] = {};
			object.animationCache.animations[this.data.name].prevKey = { pos: 0, rot: 0, scl: 0 };
			object.animationCache.animations[this.data.name].nextKey = { pos: 0, rot: 0, scl: 0 };
			object.animationCache.animations[this.data.name].originalMatrix = object.matrix;

		}

		var animationCache = object.animationCache.animations[this.data.name];

		// Get keys to match our current time

		for ( var t = 0; t < 3; t ++ ) {

			var type = this.keyTypes[ t ];

			var prevKey = this.data.hierarchy[ h ].keys[ 0 ];
			var nextKey = this.getNextKeyWith( type, h, 1 );

			while ( nextKey.time < this.currentTime && nextKey.index > prevKey.index ) {

				prevKey = nextKey;
				nextKey = this.getNextKeyWith( type, h, nextKey.index + 1 );

			}

			animationCache.prevKey[ type ] = prevKey;
			animationCache.nextKey[ type ] = nextKey;

		}

	}

};

THREE.Animation.prototype.resetBlendWeights = function () {

	for ( var h = 0, hl = this.hierarchy.length; h < hl; h ++ ) {

		var object = this.hierarchy[ h ];

		if ( object.animationCache !== undefined ) {

			object.animationCache.blending.positionWeight = 0.0;
			object.animationCache.blending.quaternionWeight = 0.0;
			object.animationCache.blending.scaleWeight = 0.0;

		}

	}

};

THREE.Animation.prototype.update = (function(){

	var points = [];
	var target = new THREE.Vector3();
	var newVector = new THREE.Vector3();
	var newQuat = new THREE.Quaternion();

	// Catmull-Rom spline

	var interpolateCatmullRom = function ( points, scale ) {

		var c = [], v3 = [],
		point, intPoint, weight, w2, w3,
		pa, pb, pc, pd;

		point = ( points.length - 1 ) * scale;
		intPoint = Math.floor( point );
		weight = point - intPoint;

		c[ 0 ] = intPoint === 0 ? intPoint : intPoint - 1;
		c[ 1 ] = intPoint;
		c[ 2 ] = intPoint > points.length - 2 ? intPoint : intPoint + 1;
		c[ 3 ] = intPoint > points.length - 3 ? intPoint : intPoint + 2;

		pa = points[ c[ 0 ] ];
		pb = points[ c[ 1 ] ];
		pc = points[ c[ 2 ] ];
		pd = points[ c[ 3 ] ];

		w2 = weight * weight;
		w3 = weight * w2;

		v3[ 0 ] = interpolate( pa[ 0 ], pb[ 0 ], pc[ 0 ], pd[ 0 ], weight, w2, w3 );
		v3[ 1 ] = interpolate( pa[ 1 ], pb[ 1 ], pc[ 1 ], pd[ 1 ], weight, w2, w3 );
		v3[ 2 ] = interpolate( pa[ 2 ], pb[ 2 ], pc[ 2 ], pd[ 2 ], weight, w2, w3 );

		return v3;

	};

	var interpolate = function ( p0, p1, p2, p3, t, t2, t3 ) {

		var v0 = ( p2 - p0 ) * 0.5,
			v1 = ( p3 - p1 ) * 0.5;

		return ( 2 * ( p1 - p2 ) + v0 + v1 ) * t3 + ( - 3 * ( p1 - p2 ) - 2 * v0 - v1 ) * t2 + v0 * t + p1;

	};

	return function ( delta ) {

		if ( this.isPlaying === false ) return;

		this.currentTime += delta * this.timeScale;

		if ( this.weight === 0 )
			return;

		//

		var duration = this.data.length;

		if ( this.currentTime > duration || this.currentTime < 0 ) {

			if ( this.loop ) {

				this.currentTime %= duration;

				if ( this.currentTime < 0 )
					this.currentTime += duration;

				this.reset();

			} else {

				this.stop();
				return;

			}

		}

		for ( var h = 0, hl = this.hierarchy.length; h < hl; h ++ ) {

			var object = this.hierarchy[ h ];
			var animationCache = object.animationCache.animations[this.data.name];
			var blending = object.animationCache.blending;

			// loop through pos/rot/scl

			for ( var t = 0; t < 3; t ++ ) {

				// get keys

				var type    = this.keyTypes[ t ];
				var prevKey = animationCache.prevKey[ type ];
				var nextKey = animationCache.nextKey[ type ];

				if ( ( this.timeScale > 0 && nextKey.time <= this.currentTime ) ||
					( this.timeScale < 0 && prevKey.time >= this.currentTime ) ) {

					prevKey = this.data.hierarchy[ h ].keys[ 0 ];
					nextKey = this.getNextKeyWith( type, h, 1 );

					while ( nextKey.time < this.currentTime && nextKey.index > prevKey.index ) {

						prevKey = nextKey;
						nextKey = this.getNextKeyWith( type, h, nextKey.index + 1 );

					}

					animationCache.prevKey[ type ] = prevKey;
					animationCache.nextKey[ type ] = nextKey;

				}

				object.matrixAutoUpdate = true;
				object.matrixWorldNeedsUpdate = true;

				var scale = ( this.currentTime - prevKey.time ) / ( nextKey.time - prevKey.time );

				var prevXYZ = prevKey[ type ];
				var nextXYZ = nextKey[ type ];

				if ( scale < 0 ) scale = 0;
				if ( scale > 1 ) scale = 1;

				// interpolate

				if ( type === "pos" ) {

					if ( this.interpolationType === THREE.AnimationHandler.LINEAR ) {

						newVector.x = prevXYZ[ 0 ] + ( nextXYZ[ 0 ] - prevXYZ[ 0 ] ) * scale;
						newVector.y = prevXYZ[ 1 ] + ( nextXYZ[ 1 ] - prevXYZ[ 1 ] ) * scale;
						newVector.z = prevXYZ[ 2 ] + ( nextXYZ[ 2 ] - prevXYZ[ 2 ] ) * scale;

						// blend
						var proportionalWeight = this.weight / ( this.weight + blending.positionWeight );
						object.position.lerp( newVector, proportionalWeight );
						blending.positionWeight += this.weight;

					} else if ( this.interpolationType === THREE.AnimationHandler.CATMULLROM ||
								this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD ) {

						points[ 0 ] = this.getPrevKeyWith( "pos", h, prevKey.index - 1 )[ "pos" ];
						points[ 1 ] = prevXYZ;
						points[ 2 ] = nextXYZ;
						points[ 3 ] = this.getNextKeyWith( "pos", h, nextKey.index + 1 )[ "pos" ];

						scale = scale * 0.33 + 0.33;

						var currentPoint = interpolateCatmullRom( points, scale );
						var proportionalWeight = this.weight / ( this.weight + blending.positionWeight );
						blending.positionWeight += this.weight;

						// blend

						var vector = object.position;
						
						vector.x = vector.x + ( currentPoint[ 0 ] - vector.x ) * proportionalWeight;
						vector.y = vector.y + ( currentPoint[ 1 ] - vector.y ) * proportionalWeight;
						vector.z = vector.z + ( currentPoint[ 2 ] - vector.z ) * proportionalWeight;

						if ( this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD ) {

							var forwardPoint = interpolateCatmullRom( points, scale * 1.01 );

							target.set( forwardPoint[ 0 ], forwardPoint[ 1 ], forwardPoint[ 2 ] );
							target.sub( vector );
							target.y = 0;
							target.normalize();

							var angle = Math.atan2( target.x, target.z );
							object.rotation.set( 0, angle, 0 );

						}

					}

				} else if ( type === "rot" ) {

					THREE.Quaternion.slerp( prevXYZ, nextXYZ, newQuat, scale );

					// Avoid paying the cost of an additional slerp if we don't have to
					if ( blending.quaternionWeight === 0 ) {

						object.quaternion.copy(newQuat);
						blending.quaternionWeight = this.weight;

					} else {

						var proportionalWeight = this.weight / ( this.weight + blending.quaternionWeight );
						THREE.Quaternion.slerp( object.quaternion, newQuat, object.quaternion, proportionalWeight );
						blending.quaternionWeight += this.weight;

					}

				} else if ( type === "scl" ) {

					newVector.x = prevXYZ[ 0 ] + ( nextXYZ[ 0 ] - prevXYZ[ 0 ] ) * scale;
					newVector.y = prevXYZ[ 1 ] + ( nextXYZ[ 1 ] - prevXYZ[ 1 ] ) * scale;
					newVector.z = prevXYZ[ 2 ] + ( nextXYZ[ 2 ] - prevXYZ[ 2 ] ) * scale;

					var proportionalWeight = this.weight / ( this.weight + blending.scaleWeight );
					object.scale.lerp( newVector, proportionalWeight );
					blending.scaleWeight += this.weight;

				}

			}

		}

		return true;

	};

})();





// Get next key with

THREE.Animation.prototype.getNextKeyWith = function ( type, h, key ) {

	var keys = this.data.hierarchy[ h ].keys;

	if ( this.interpolationType === THREE.AnimationHandler.CATMULLROM ||
		 this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD ) {

		key = key < keys.length - 1 ? key : keys.length - 1;

	} else {

		key = key % keys.length;

	}

	for ( ; key < keys.length; key ++ ) {

		if ( keys[ key ][ type ] !== undefined ) {

			return keys[ key ];

		}

	}

	return this.data.hierarchy[ h ].keys[ 0 ];

};

// Get previous key with

THREE.Animation.prototype.getPrevKeyWith = function ( type, h, key ) {

	var keys = this.data.hierarchy[ h ].keys;

	if ( this.interpolationType === THREE.AnimationHandler.CATMULLROM ||
		this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD ) {

		key = key > 0 ? key : 0;

	} else {

		key = key >= 0 ? key : key + keys.length;

	}


	for ( ; key >= 0; key -- ) {

		if ( keys[ key ][ type ] !== undefined ) {

			return keys[ key ];

		}

	}

	return this.data.hierarchy[ h ].keys[ keys.length - 1 ];

};

// File:src/extras/animation/KeyFrameAnimation.js

/**
 * @author mikael emtinger / http://gomo.se/
 * @author mrdoob / http://mrdoob.com/
 * @author alteredq / http://alteredqualia.com/
 * @author khang duong
 * @author erik kitson
 */

THREE.KeyFrameAnimation = function ( data ) {

	this.root = data.node;
	this.data = THREE.AnimationHandler.init( data );
	this.hierarchy = THREE.AnimationHandler.parse( this.root );
	this.currentTime = 0;
	this.timeScale = 0.001;
	this.isPlaying = false;
	this.isPaused = true;
	this.loop = true;

	// initialize to first keyframes

	for ( var h = 0, hl = this.hierarchy.length; h < hl; h ++ ) {

		var keys = this.data.hierarchy[h].keys,
			sids = this.data.hierarchy[h].sids,
			obj = this.hierarchy[h];

		if ( keys.length && sids ) {

			for ( var s = 0; s < sids.length; s ++ ) {

				var sid = sids[ s ],
					next = this.getNextKeyWith( sid, h, 0 );

				if ( next ) {

					next.apply( sid );

				}

			}

			obj.matrixAutoUpdate = false;
			this.data.hierarchy[h].node.updateMatrix();
			obj.matrixWorldNeedsUpdate = true;

		}

	}

};


THREE.KeyFrameAnimation.prototype.play = function ( startTime ) {

	this.currentTime = startTime !== undefined ? startTime : 0;

	if ( this.isPlaying === false ) {

		this.isPlaying = true;

		// reset key cache

		var h, hl = this.hierarchy.length,
			object,
			node;

		for ( h = 0; h < hl; h ++ ) {

			object = this.hierarchy[ h ];
			node = this.data.hierarchy[ h ];

			if ( node.animationCache === undefined ) {

				node.animationCache = {};
				node.animationCache.prevKey = null;
				node.animationCache.nextKey = null;
				node.animationCache.originalMatrix = object.matrix;

			}

			var keys = this.data.hierarchy[h].keys;

			if (keys.length) {

				node.animationCache.prevKey = keys[ 0 ];
				node.animationCache.nextKey = keys[ 1 ];

				this.startTime = Math.min( keys[0].time, this.startTime );
				this.endTime = Math.max( keys[keys.length - 1].time, this.endTime );

			}

		}

		this.update( 0 );

	}

	this.isPaused = false;

	THREE.AnimationHandler.play( this );

};


THREE.KeyFrameAnimation.prototype.stop = function() {

	this.isPlaying = false;
	this.isPaused  = false;

	THREE.AnimationHandler.stop( this );

	// reset JIT matrix and remove cache

	for ( var h = 0; h < this.data.hierarchy.length; h ++ ) {
		
		var obj = this.hierarchy[ h ];
		var node = this.data.hierarchy[ h ];

		if ( node.animationCache !== undefined ) {

			var original = node.animationCache.originalMatrix;

			original.copy( obj.matrix );
			obj.matrix = original;

			delete node.animationCache;

		}

	}

};


// Update

THREE.KeyFrameAnimation.prototype.update = function ( delta ) {

	if ( this.isPlaying === false ) return;

	this.currentTime += delta * this.timeScale;

	//

	var duration = this.data.length;

	if ( this.loop === true && this.currentTime > duration ) {

		this.currentTime %= duration;

	}

	this.currentTime = Math.min( this.currentTime, duration );

	for ( var h = 0, hl = this.hierarchy.length; h < hl; h ++ ) {

		var object = this.hierarchy[ h ];
		var node = this.data.hierarchy[ h ];

		var keys = node.keys,
			animationCache = node.animationCache;


		if ( keys.length ) {

			var prevKey = animationCache.prevKey;
			var nextKey = animationCache.nextKey;

			if ( nextKey.time <= this.currentTime ) {

				while ( nextKey.time < this.currentTime && nextKey.index > prevKey.index ) {

					prevKey = nextKey;
					nextKey = keys[ prevKey.index + 1 ];

				}

				animationCache.prevKey = prevKey;
				animationCache.nextKey = nextKey;

			}

			if ( nextKey.time >= this.currentTime ) {

				prevKey.interpolate( nextKey, this.currentTime );

			} else {

				prevKey.interpolate( nextKey, nextKey.time );

			}

			this.data.hierarchy[ h ].node.updateMatrix();
			object.matrixWorldNeedsUpdate = true;

		}

	}

};

// Get next key with

THREE.KeyFrameAnimation.prototype.getNextKeyWith = function( sid, h, key ) {

	var keys = this.data.hierarchy[ h ].keys;
	key = key % keys.length;

	for ( ; key < keys.length; key ++ ) {

		if ( keys[ key ].hasTarget( sid ) ) {

			return keys[ key ];

		}

	}

	return keys[ 0 ];

};

// Get previous key with

THREE.KeyFrameAnimation.prototype.getPrevKeyWith = function( sid, h, key ) {

	var keys = this.data.hierarchy[ h ].keys;
	key = key >= 0 ? key : key + keys.length;

	for ( ; key >= 0; key -- ) {

		if ( keys[ key ].hasTarget( sid ) ) {

			return keys[ key ];

		}

	}

	return keys[ keys.length - 1 ];

};

// File:src/extras/animation/MorphAnimation.js

/**
 * @author mrdoob / http://mrdoob.com
 */

THREE.MorphAnimation = function ( mesh ) {

	this.mesh = mesh;
	this.frames = mesh.morphTargetInfluences.length;
	this.currentTime = 0;
	this.duration = 1000;
	this.loop = true;

	this.isPlaying = false;

};

THREE.MorphAnimation.prototype = {

	play: function () {

		this.isPlaying = true;

	},

	pause: function () {

		this.isPlaying = false;

	},

	update: ( function () {

		var lastFrame = 0;
		var currentFrame = 0;

		return function ( delta ) {

			if ( this.isPlaying === false ) return;

			this.currentTime += delta;

			if ( this.loop === true && this.currentTime > this.duration ) {

				this.currentTime %= this.duration;

			}

			this.currentTime = Math.min( this.currentTime, this.duration );

			var interpolation = this.duration / this.frames;
			var frame = Math.floor( this.currentTime / interpolation );

			if ( frame != currentFrame ) {

				this.mesh.morphTargetInfluences[ lastFrame ] = 0;
				this.mesh.morphTargetInfluences[ currentFrame ] = 1;
				this.mesh.morphTargetInfluences[ frame ] = 0;

				lastFrame = currentFrame;
				currentFrame = frame;

			}

			this.mesh.morphTargetInfluences[ frame ] = ( this.currentTime % interpolation ) / interpolation;
			this.mesh.morphTargetInfluences[ lastFrame ] = 1 - this.mesh.morphTargetInfluences[ frame ];

		}

	} )()

};

// File:src/extras/geometries/BoxGeometry.js

/**
 * @author mrdoob / http://mrdoob.com/
 * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Cube.as
 */

THREE.BoxGeometry = function ( width, height, depth, widthSegments, heightSegments, depthSegments ) {

	THREE.Geometry.call( this );

	this.type = 'BoxGeometry';

	this.parameters = {
		width: width,
		height: height,
		depth: depth,
		widthSegments: widthSegments,
		heightSegments: heightSegments,
		depthSegments: depthSegments
	};

	this.widthSegments = widthSegments || 1;
	this.heightSegments = heightSegments || 1;
	this.depthSegments = depthSegments || 1;

	var scope = this;

	var width_half = width / 2;
	var height_half = height / 2;
	var depth_half = depth / 2;

	buildPlane( 'z', 'y', - 1, - 1, depth, height, width_half, 0 ); // px
	buildPlane( 'z', 'y',   1, - 1, depth, height, - width_half, 1 ); // nx
	buildPlane( 'x', 'z',   1,   1, width, depth, height_half, 2 ); // py
	buildPlane( 'x', 'z',   1, - 1, width, depth, - height_half, 3 ); // ny
	buildPlane( 'x', 'y',   1, - 1, width, height, depth_half, 4 ); // pz
	buildPlane( 'x', 'y', - 1, - 1, width, height, - depth_half, 5 ); // nz

	function buildPlane( u, v, udir, vdir, width, height, depth, materialIndex ) {

		var w, ix, iy,
		gridX = scope.widthSegments,
		gridY = scope.heightSegments,
		width_half = width / 2,
		height_half = height / 2,
		offset = scope.vertices.length;

		if ( ( u === 'x' && v === 'y' ) || ( u === 'y' && v === 'x' ) ) {

			w = 'z';

		} else if ( ( u === 'x' && v === 'z' ) || ( u === 'z' && v === 'x' ) ) {

			w = 'y';
			gridY = scope.depthSegments;

		} else if ( ( u === 'z' && v === 'y' ) || ( u === 'y' && v === 'z' ) ) {

			w = 'x';
			gridX = scope.depthSegments;

		}

		var gridX1 = gridX + 1,
		gridY1 = gridY + 1,
		segment_width = width / gridX,
		segment_height = height / gridY,
		normal = new THREE.Vector3();

		normal[ w ] = depth > 0 ? 1 : - 1;

		for ( iy = 0; iy < gridY1; iy ++ ) {

			for ( ix = 0; ix < gridX1; ix ++ ) {

				var vector = new THREE.Vector3();
				vector[ u ] = ( ix * segment_width - width_half ) * udir;
				vector[ v ] = ( iy * segment_height - height_half ) * vdir;
				vector[ w ] = depth;

				scope.vertices.push( vector );

			}

		}

		for ( iy = 0; iy < gridY; iy ++ ) {

			for ( ix = 0; ix < gridX; ix ++ ) {

				var a = ix + gridX1 * iy;
				var b = ix + gridX1 * ( iy + 1 );
				var c = ( ix + 1 ) + gridX1 * ( iy + 1 );
				var d = ( ix + 1 ) + gridX1 * iy;

				var uva = new THREE.Vector2( ix / gridX, 1 - iy / gridY );
				var uvb = new THREE.Vector2( ix / gridX, 1 - ( iy + 1 ) / gridY );
				var uvc = new THREE.Vector2( ( ix + 1 ) / gridX, 1 - ( iy + 1 ) / gridY );
				var uvd = new THREE.Vector2( ( ix + 1 ) / gridX, 1 - iy / gridY );

				var face = new THREE.Face3( a + offset, b + offset, d + offset );
				face.normal.copy( normal );
				face.vertexNormals.push( normal.clone(), normal.clone(), normal.clone() );
				face.materialIndex = materialIndex;

				scope.faces.push( face );
				scope.faceVertexUvs[ 0 ].push( [ uva, uvb, uvd ] );

				face = new THREE.Face3( b + offset, c + offset, d + offset );
				face.normal.copy( normal );
				face.vertexNormals.push( normal.clone(), normal.clone(), normal.clone() );
				face.materialIndex = materialIndex;

				scope.faces.push( face );
				scope.faceVertexUvs[ 0 ].push( [ uvb.clone(), uvc, uvd.clone() ] );

			}

		}

	}

	this.mergeVertices();

};

THREE.BoxGeometry.prototype = Object.create( THREE.Geometry.prototype );

// File:src/extras/geometries/CircleGeometry.js

/**
 * @author hughes
 */

THREE.CircleGeometry = function ( radius, segments, thetaStart, thetaLength ) {

	THREE.Geometry.call( this );

	this.type = 'CircleGeometry';

	this.parameters = {
		radius: radius,
		segments: segments,
		thetaStart: thetaStart,
		thetaLength: thetaLength
	};

	radius = radius || 50;
	segments = segments !== undefined ? Math.max( 3, segments ) : 8;

	thetaStart = thetaStart !== undefined ? thetaStart : 0;
	thetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;

	var i, uvs = [],
	center = new THREE.Vector3(), centerUV = new THREE.Vector2( 0.5, 0.5 );

	this.vertices.push(center);
	uvs.push( centerUV );

	for ( i = 0; i <= segments; i ++ ) {

		var vertex = new THREE.Vector3();
		var segment = thetaStart + i / segments * thetaLength;

		vertex.x = radius * Math.cos( segment );
		vertex.y = radius * Math.sin( segment );

		this.vertices.push( vertex );
		uvs.push( new THREE.Vector2( ( vertex.x / radius + 1 ) / 2, ( vertex.y / radius + 1 ) / 2 ) );

	}

	var n = new THREE.Vector3( 0, 0, 1 );

	for ( i = 1; i <= segments; i ++ ) {

		this.faces.push( new THREE.Face3( i, i + 1, 0, [ n.clone(), n.clone(), n.clone() ] ) );
		this.faceVertexUvs[ 0 ].push( [ uvs[ i ].clone(), uvs[ i + 1 ].clone(), centerUV.clone() ] );

	}

	this.computeFaceNormals();

	this.boundingSphere = new THREE.Sphere( new THREE.Vector3(), radius );

};

THREE.CircleGeometry.prototype = Object.create( THREE.Geometry.prototype );

// File:src/extras/geometries/CubeGeometry.js

/**
 * @author mrdoob / http://mrdoob.com/
 */


THREE.CubeGeometry = function ( width, height, depth, widthSegments, heightSegments, depthSegments ) {

	console.warn( 'THREE.CubeGeometry has been renamed to THREE.BoxGeometry.' );
	return new THREE.BoxGeometry( width, height, depth, widthSegments, heightSegments, depthSegments );

 };

// File:src/extras/geometries/CylinderGeometry.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.CylinderGeometry = function ( radiusTop, radiusBottom, height, radialSegments, heightSegments, openEnded ) {

	THREE.Geometry.call( this );

	this.type = 'CylinderGeometry';

	this.parameters = {
		radiusTop: radiusTop,
		radiusBottom: radiusBottom,
		height: height,
		radialSegments: radialSegments,
		heightSegments: heightSegments,
		openEnded: openEnded
	};

	radiusTop = radiusTop !== undefined ? radiusTop : 20;
	radiusBottom = radiusBottom !== undefined ? radiusBottom : 20;
	height = height !== undefined ? height : 100;

	radialSegments = radialSegments || 8;
	heightSegments = heightSegments || 1;

	openEnded = openEnded !== undefined ? openEnded : false;

	var heightHalf = height / 2;

	var x, y, vertices = [], uvs = [];

	for ( y = 0; y <= heightSegments; y ++ ) {

		var verticesRow = [];
		var uvsRow = [];

		var v = y / heightSegments;
		var radius = v * ( radiusBottom - radiusTop ) + radiusTop;

		for ( x = 0; x <= radialSegments; x ++ ) {

			var u = x / radialSegments;

			var vertex = new THREE.Vector3();
			vertex.x = radius * Math.sin( u * Math.PI * 2 );
			vertex.y = - v * height + heightHalf;
			vertex.z = radius * Math.cos( u * Math.PI * 2 );

			this.vertices.push( vertex );

			verticesRow.push( this.vertices.length - 1 );
			uvsRow.push( new THREE.Vector2( u, 1 - v ) );

		}

		vertices.push( verticesRow );
		uvs.push( uvsRow );

	}

	var tanTheta = ( radiusBottom - radiusTop ) / height;
	var na, nb;

	for ( x = 0; x < radialSegments; x ++ ) {

		if ( radiusTop !== 0 ) {

			na = this.vertices[ vertices[ 0 ][ x ] ].clone();
			nb = this.vertices[ vertices[ 0 ][ x + 1 ] ].clone();

		} else {

			na = this.vertices[ vertices[ 1 ][ x ] ].clone();
			nb = this.vertices[ vertices[ 1 ][ x + 1 ] ].clone();

		}

		na.setY( Math.sqrt( na.x * na.x + na.z * na.z ) * tanTheta ).normalize();
		nb.setY( Math.sqrt( nb.x * nb.x + nb.z * nb.z ) * tanTheta ).normalize();

		for ( y = 0; y < heightSegments; y ++ ) {

			var v1 = vertices[ y ][ x ];
			var v2 = vertices[ y + 1 ][ x ];
			var v3 = vertices[ y + 1 ][ x + 1 ];
			var v4 = vertices[ y ][ x + 1 ];

			var n1 = na.clone();
			var n2 = na.clone();
			var n3 = nb.clone();
			var n4 = nb.clone();

			var uv1 = uvs[ y ][ x ].clone();
			var uv2 = uvs[ y + 1 ][ x ].clone();
			var uv3 = uvs[ y + 1 ][ x + 1 ].clone();
			var uv4 = uvs[ y ][ x + 1 ].clone();

			this.faces.push( new THREE.Face3( v1, v2, v4, [ n1, n2, n4 ] ) );
			this.faceVertexUvs[ 0 ].push( [ uv1, uv2, uv4 ] );

			this.faces.push( new THREE.Face3( v2, v3, v4, [ n2.clone(), n3, n4.clone() ] ) );
			this.faceVertexUvs[ 0 ].push( [ uv2.clone(), uv3, uv4.clone() ] );

		}

	}

	// top cap

	if ( openEnded === false && radiusTop > 0 ) {

		this.vertices.push( new THREE.Vector3( 0, heightHalf, 0 ) );

		for ( x = 0; x < radialSegments; x ++ ) {

			var v1 = vertices[ 0 ][ x ];
			var v2 = vertices[ 0 ][ x + 1 ];
			var v3 = this.vertices.length - 1;

			var n1 = new THREE.Vector3( 0, 1, 0 );
			var n2 = new THREE.Vector3( 0, 1, 0 );
			var n3 = new THREE.Vector3( 0, 1, 0 );

			var uv1 = uvs[ 0 ][ x ].clone();
			var uv2 = uvs[ 0 ][ x + 1 ].clone();
			var uv3 = new THREE.Vector2( uv2.x, 0 );

			this.faces.push( new THREE.Face3( v1, v2, v3, [ n1, n2, n3 ] ) );
			this.faceVertexUvs[ 0 ].push( [ uv1, uv2, uv3 ] );

		}

	}

	// bottom cap

	if ( openEnded === false && radiusBottom > 0 ) {

		this.vertices.push( new THREE.Vector3( 0, - heightHalf, 0 ) );

		for ( x = 0; x < radialSegments; x ++ ) {

			var v1 = vertices[ y ][ x + 1 ];
			var v2 = vertices[ y ][ x ];
			var v3 = this.vertices.length - 1;

			var n1 = new THREE.Vector3( 0, - 1, 0 );
			var n2 = new THREE.Vector3( 0, - 1, 0 );
			var n3 = new THREE.Vector3( 0, - 1, 0 );

			var uv1 = uvs[ y ][ x + 1 ].clone();
			var uv2 = uvs[ y ][ x ].clone();
			var uv3 = new THREE.Vector2( uv2.x, 1 );

			this.faces.push( new THREE.Face3( v1, v2, v3, [ n1, n2, n3 ] ) );
			this.faceVertexUvs[ 0 ].push( [ uv1, uv2, uv3 ] );

		}

	}

	this.computeFaceNormals();

}

THREE.CylinderGeometry.prototype = Object.create( THREE.Geometry.prototype );

// File:src/extras/geometries/ExtrudeGeometry.js

/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 *
 * Creates extruded geometry from a path shape.
 *
 * parameters = {
 *
 *  curveSegments: <int>, // number of points on the curves
 *  steps: <int>, // number of points for z-side extrusions / used for subdividing segements of extrude spline too
 *  amount: <int>, // Depth to extrude the shape
 *
 *  bevelEnabled: <bool>, // turn on bevel
 *  bevelThickness: <float>, // how deep into the original shape bevel goes
 *  bevelSize: <float>, // how far from shape outline is bevel
 *  bevelSegments: <int>, // number of bevel layers
 *
 *  extrudePath: <THREE.CurvePath> // 3d spline path to extrude shape along. (creates Frames if .frames aren't defined)
 *  frames: <THREE.TubeGeometry.FrenetFrames> // containing arrays of tangents, normals, binormals
 *
 *  material: <int> // material index for front and back faces
 *  extrudeMaterial: <int> // material index for extrusion and beveled faces
 *  uvGenerator: <Object> // object that provides UV generator functions
 *
 * }
 **/

THREE.ExtrudeGeometry = function ( shapes, options ) {

	if ( typeof( shapes ) === "undefined" ) {
		shapes = [];
		return;
	}

	THREE.Geometry.call( this );

	this.type = 'ExtrudeGeometry';

	shapes = shapes instanceof Array ? shapes : [ shapes ];

	this.addShapeList( shapes, options );

	this.computeFaceNormals();

	// can't really use automatic vertex normals
	// as then front and back sides get smoothed too
	// should do separate smoothing just for sides

	//this.computeVertexNormals();

	//console.log( "took", ( Date.now() - startTime ) );

};

THREE.ExtrudeGeometry.prototype = Object.create( THREE.Geometry.prototype );

THREE.ExtrudeGeometry.prototype.addShapeList = function ( shapes, options ) {
	var sl = shapes.length;

	for ( var s = 0; s < sl; s ++ ) {
		var shape = shapes[ s ];
		this.addShape( shape, options );
	}
};

THREE.ExtrudeGeometry.prototype.addShape = function ( shape, options ) {

	var amount = options.amount !== undefined ? options.amount : 100;

	var bevelThickness = options.bevelThickness !== undefined ? options.bevelThickness : 6; // 10
	var bevelSize = options.bevelSize !== undefined ? options.bevelSize : bevelThickness - 2; // 8
	var bevelSegments = options.bevelSegments !== undefined ? options.bevelSegments : 3;

	var bevelEnabled = options.bevelEnabled !== undefined ? options.bevelEnabled : true; // false

	var curveSegments = options.curveSegments !== undefined ? options.curveSegments : 12;

	var steps = options.steps !== undefined ? options.steps : 1;

	var extrudePath = options.extrudePath;
	var extrudePts, extrudeByPath = false;

	var material = options.material;
	var extrudeMaterial = options.extrudeMaterial;

	// Use default WorldUVGenerator if no UV generators are specified.
	var uvgen = options.UVGenerator !== undefined ? options.UVGenerator : THREE.ExtrudeGeometry.WorldUVGenerator;

	var splineTube, binormal, normal, position2;
	if ( extrudePath ) {

		extrudePts = extrudePath.getSpacedPoints( steps );

		extrudeByPath = true;
		bevelEnabled = false; // bevels not supported for path extrusion

		// SETUP TNB variables

		// Reuse TNB from TubeGeomtry for now.
		// TODO1 - have a .isClosed in spline?

		splineTube = options.frames !== undefined ? options.frames : new THREE.TubeGeometry.FrenetFrames(extrudePath, steps, false);

		// console.log(splineTube, 'splineTube', splineTube.normals.length, 'steps', steps, 'extrudePts', extrudePts.length);

		binormal = new THREE.Vector3();
		normal = new THREE.Vector3();
		position2 = new THREE.Vector3();

	}

	// Safeguards if bevels are not enabled

	if ( ! bevelEnabled ) {

		bevelSegments = 0;
		bevelThickness = 0;
		bevelSize = 0;

	}

	// Variables initalization

	var ahole, h, hl; // looping of holes
	var scope = this;
	var bevelPoints = [];

	var shapesOffset = this.vertices.length;

	var shapePoints = shape.extractPoints( curveSegments );

	var vertices = shapePoints.shape;
	var holes = shapePoints.holes;

	var reverse = ! THREE.Shape.Utils.isClockWise( vertices ) ;

	if ( reverse ) {

		vertices = vertices.reverse();

		// Maybe we should also check if holes are in the opposite direction, just to be safe ...

		for ( h = 0, hl = holes.length; h < hl; h ++ ) {

			ahole = holes[ h ];

			if ( THREE.Shape.Utils.isClockWise( ahole ) ) {

				holes[ h ] = ahole.reverse();

			}

		}

		reverse = false; // If vertices are in order now, we shouldn't need to worry about them again (hopefully)!

	}


	var faces = THREE.Shape.Utils.triangulateShape ( vertices, holes );

	/* Vertices */

	var contour = vertices; // vertices has all points but contour has only points of circumference

	for ( h = 0, hl = holes.length;  h < hl; h ++ ) {

		ahole = holes[ h ];

		vertices = vertices.concat( ahole );

	}


	function scalePt2 ( pt, vec, size ) {

		if ( ! vec ) console.log( "die" );

		return vec.clone().multiplyScalar( size ).add( pt );

	}

	var b, bs, t, z,
		vert, vlen = vertices.length,
		face, flen = faces.length,
		cont, clen = contour.length;


	// Find directions for point movement

	var RAD_TO_DEGREES = 180 / Math.PI;


	function getBevelVec( inPt, inPrev, inNext ) {

		var EPSILON = 0.0000000001;
		
		// computes for inPt the corresponding point inPt' on a new contour
		//   shiftet by 1 unit (length of normalized vector) to the left
		// if we walk along contour clockwise, this new contour is outside the old one
		//
		// inPt' is the intersection of the two lines parallel to the two
		//  adjacent edges of inPt at a distance of 1 unit on the left side.
		
		var v_trans_x, v_trans_y, shrink_by = 1;		// resulting translation vector for inPt

		// good reading for geometry algorithms (here: line-line intersection)
		// http://geomalgorithms.com/a05-_intersect-1.html

		var v_prev_x = inPt.x - inPrev.x, v_prev_y = inPt.y - inPrev.y;
		var v_next_x = inNext.x - inPt.x, v_next_y = inNext.y - inPt.y;
		
		var v_prev_lensq = ( v_prev_x * v_prev_x + v_prev_y * v_prev_y );
		
		// check for colinear edges
		var colinear0 = ( v_prev_x * v_next_y - v_prev_y * v_next_x );
		
		if ( Math.abs( colinear0 ) > EPSILON ) {		// not colinear
			
			// length of vectors for normalizing
	
			var v_prev_len = Math.sqrt( v_prev_lensq );
			var v_next_len = Math.sqrt( v_next_x * v_next_x + v_next_y * v_next_y );
			
			// shift adjacent points by unit vectors to the left
	
			var ptPrevShift_x = ( inPrev.x - v_prev_y / v_prev_len );
			var ptPrevShift_y = ( inPrev.y + v_prev_x / v_prev_len );
			
			var ptNextShift_x = ( inNext.x - v_next_y / v_next_len );
			var ptNextShift_y = ( inNext.y + v_next_x / v_next_len );
	
			// scaling factor for v_prev to intersection point
	
			var sf = (  ( ptNextShift_x - ptPrevShift_x ) * v_next_y -
						( ptNextShift_y - ptPrevShift_y ) * v_next_x    ) /
					  ( v_prev_x * v_next_y - v_prev_y * v_next_x );
	
			// vector from inPt to intersection point
	
			v_trans_x = ( ptPrevShift_x + v_prev_x * sf - inPt.x );
			v_trans_y = ( ptPrevShift_y + v_prev_y * sf - inPt.y );
	
			// Don't normalize!, otherwise sharp corners become ugly
			//  but prevent crazy spikes
			var v_trans_lensq = ( v_trans_x * v_trans_x + v_trans_y * v_trans_y )
			if ( v_trans_lensq <= 2 ) {
				return	new THREE.Vector2( v_trans_x, v_trans_y );
			} else {
				shrink_by = Math.sqrt( v_trans_lensq / 2 );
			}
			
		} else {		// handle special case of colinear edges

			var direction_eq = false;		// assumes: opposite
			if ( v_prev_x > EPSILON ) {
				if ( v_next_x > EPSILON ) { direction_eq = true; }
			} else {
				if ( v_prev_x < - EPSILON ) {
					if ( v_next_x < - EPSILON ) { direction_eq = true; }
				} else {
					if ( Math.sign(v_prev_y) == Math.sign(v_next_y) ) { direction_eq = true; }
				}
			}

			if ( direction_eq ) {
				// console.log("Warning: lines are a straight sequence");
				v_trans_x = - v_prev_y;
				v_trans_y =  v_prev_x;
				shrink_by = Math.sqrt( v_prev_lensq );
			} else {
				// console.log("Warning: lines are a straight spike");
				v_trans_x = v_prev_x;
				v_trans_y = v_prev_y;
				shrink_by = Math.sqrt( v_prev_lensq / 2 );
			}

		}

		return	new THREE.Vector2( v_trans_x / shrink_by, v_trans_y / shrink_by );

	}


	var contourMovements = [];

	for ( var i = 0, il = contour.length, j = il - 1, k = i + 1; i < il; i ++, j ++, k ++ ) {

		if ( j === il ) j = 0;
		if ( k === il ) k = 0;

		//  (j)---(i)---(k)
		// console.log('i,j,k', i, j , k)

		var pt_i = contour[ i ];
		var pt_j = contour[ j ];
		var pt_k = contour[ k ];

		contourMovements[ i ]= getBevelVec( contour[ i ], contour[ j ], contour[ k ] );

	}

	var holesMovements = [], oneHoleMovements, verticesMovements = contourMovements.concat();

	for ( h = 0, hl = holes.length; h < hl; h ++ ) {

		ahole = holes[ h ];

		oneHoleMovements = [];

		for ( i = 0, il = ahole.length, j = il - 1, k = i + 1; i < il; i ++, j ++, k ++ ) {

			if ( j === il ) j = 0;
			if ( k === il ) k = 0;

			//  (j)---(i)---(k)
			oneHoleMovements[ i ]= getBevelVec( ahole[ i ], ahole[ j ], ahole[ k ] );

		}

		holesMovements.push( oneHoleMovements );
		verticesMovements = verticesMovements.concat( oneHoleMovements );

	}


	// Loop bevelSegments, 1 for the front, 1 for the back

	for ( b = 0; b < bevelSegments; b ++ ) {
	//for ( b = bevelSegments; b > 0; b -- ) {

		t = b / bevelSegments;
		z = bevelThickness * ( 1 - t );

		//z = bevelThickness * t;
		bs = bevelSize * ( Math.sin ( t * Math.PI/2 ) ) ; // curved
		//bs = bevelSize * t ; // linear

		// contract shape

		for ( i = 0, il = contour.length; i < il; i ++ ) {

			vert = scalePt2( contour[ i ], contourMovements[ i ], bs );

			v( vert.x, vert.y,  - z );

		}

		// expand holes

		for ( h = 0, hl = holes.length; h < hl; h ++ ) {

			ahole = holes[ h ];
			oneHoleMovements = holesMovements[ h ];

			for ( i = 0, il = ahole.length; i < il; i ++ ) {

				vert = scalePt2( ahole[ i ], oneHoleMovements[ i ], bs );

				v( vert.x, vert.y,  - z );

			}

		}

	}

	bs = bevelSize;

	// Back facing vertices

	for ( i = 0; i < vlen; i ++ ) {

		vert = bevelEnabled ? scalePt2( vertices[ i ], verticesMovements[ i ], bs ) : vertices[ i ];

		if ( ! extrudeByPath ) {

			v( vert.x, vert.y, 0 );

		} else {

			// v( vert.x, vert.y + extrudePts[ 0 ].y, extrudePts[ 0 ].x );

			normal.copy( splineTube.normals[0] ).multiplyScalar(vert.x);
			binormal.copy( splineTube.binormals[0] ).multiplyScalar(vert.y);

			position2.copy( extrudePts[0] ).add(normal).add(binormal);

			v( position2.x, position2.y, position2.z );

		}

	}

	// Add stepped vertices...
	// Including front facing vertices

	var s;

	for ( s = 1; s <= steps; s ++ ) {

		for ( i = 0; i < vlen; i ++ ) {

			vert = bevelEnabled ? scalePt2( vertices[ i ], verticesMovements[ i ], bs ) : vertices[ i ];

			if ( ! extrudeByPath ) {

				v( vert.x, vert.y, amount / steps * s );

			} else {

				// v( vert.x, vert.y + extrudePts[ s - 1 ].y, extrudePts[ s - 1 ].x );

				normal.copy( splineTube.normals[s] ).multiplyScalar( vert.x );
				binormal.copy( splineTube.binormals[s] ).multiplyScalar( vert.y );

				position2.copy( extrudePts[s] ).add( normal ).add( binormal );

				v( position2.x, position2.y, position2.z );

			}

		}

	}


	// Add bevel segments planes

	//for ( b = 1; b <= bevelSegments; b ++ ) {
	for ( b = bevelSegments - 1; b >= 0; b -- ) {

		t = b / bevelSegments;
		z = bevelThickness * ( 1 - t );
		//bs = bevelSize * ( 1-Math.sin ( ( 1 - t ) * Math.PI/2 ) );
		bs = bevelSize * Math.sin ( t * Math.PI/2 ) ;

		// contract shape

		for ( i = 0, il = contour.length; i < il; i ++ ) {

			vert = scalePt2( contour[ i ], contourMovements[ i ], bs );
			v( vert.x, vert.y,  amount + z );

		}

		// expand holes

		for ( h = 0, hl = holes.length; h < hl; h ++ ) {

			ahole = holes[ h ];
			oneHoleMovements = holesMovements[ h ];

			for ( i = 0, il = ahole.length; i < il; i ++ ) {

				vert = scalePt2( ahole[ i ], oneHoleMovements[ i ], bs );

				if ( ! extrudeByPath ) {

					v( vert.x, vert.y,  amount + z );

				} else {

					v( vert.x, vert.y + extrudePts[ steps - 1 ].y, extrudePts[ steps - 1 ].x + z );

				}

			}

		}

	}

	/* Faces */

	// Top and bottom faces

	buildLidFaces();

	// Sides faces

	buildSideFaces();


	/////  Internal functions

	function buildLidFaces() {

		if ( bevelEnabled ) {

			var layer = 0 ; // steps + 1
			var offset = vlen * layer;

			// Bottom faces

			for ( i = 0; i < flen; i ++ ) {

				face = faces[ i ];
				f3( face[ 2 ]+ offset, face[ 1 ]+ offset, face[ 0 ] + offset );

			}

			layer = steps + bevelSegments * 2;
			offset = vlen * layer;

			// Top faces

			for ( i = 0; i < flen; i ++ ) {

				face = faces[ i ];
				f3( face[ 0 ] + offset, face[ 1 ] + offset, face[ 2 ] + offset );

			}

		} else {

			// Bottom faces

			for ( i = 0; i < flen; i ++ ) {

				face = faces[ i ];
				f3( face[ 2 ], face[ 1 ], face[ 0 ] );

			}

			// Top faces

			for ( i = 0; i < flen; i ++ ) {

				face = faces[ i ];
				f3( face[ 0 ] + vlen * steps, face[ 1 ] + vlen * steps, face[ 2 ] + vlen * steps );

			}
		}

	}

	// Create faces for the z-sides of the shape

	function buildSideFaces() {

		var layeroffset = 0;
		sidewalls( contour, layeroffset );
		layeroffset += contour.length;

		for ( h = 0, hl = holes.length;  h < hl; h ++ ) {

			ahole = holes[ h ];
			sidewalls( ahole, layeroffset );

			//, true
			layeroffset += ahole.length;

		}

	}

	function sidewalls( contour, layeroffset ) {

		var j, k;
		i = contour.length;

		while ( --i >= 0 ) {

			j = i;
			k = i - 1;
			if ( k < 0 ) k = contour.length - 1;

			//console.log('b', i,j, i-1, k,vertices.length);

			var s = 0, sl = steps  + bevelSegments * 2;

			for ( s = 0; s < sl; s ++ ) {

				var slen1 = vlen * s;
				var slen2 = vlen * ( s + 1 );

				var a = layeroffset + j + slen1,
					b = layeroffset + k + slen1,
					c = layeroffset + k + slen2,
					d = layeroffset + j + slen2;

				f4( a, b, c, d, contour, s, sl, j, k );

			}
		}

	}


	function v( x, y, z ) {

		scope.vertices.push( new THREE.Vector3( x, y, z ) );

	}

	function f3( a, b, c ) {

		a += shapesOffset;
		b += shapesOffset;
		c += shapesOffset;

		// normal, color, material
		scope.faces.push( new THREE.Face3( a, b, c, null, null, material ) );

		var uvs = uvgen.generateTopUV( scope, a, b, c );

 		scope.faceVertexUvs[ 0 ].push( uvs );

	}

	function f4( a, b, c, d, wallContour, stepIndex, stepsLength, contourIndex1, contourIndex2 ) {

		a += shapesOffset;
		b += shapesOffset;
		c += shapesOffset;
		d += shapesOffset;

 		scope.faces.push( new THREE.Face3( a, b, d, null, null, extrudeMaterial ) );
 		scope.faces.push( new THREE.Face3( b, c, d, null, null, extrudeMaterial ) );

 		var uvs = uvgen.generateSideWallUV( scope, a, b, c, d );

 		scope.faceVertexUvs[ 0 ].push( [ uvs[ 0 ], uvs[ 1 ], uvs[ 3 ] ] );
 		scope.faceVertexUvs[ 0 ].push( [ uvs[ 1 ], uvs[ 2 ], uvs[ 3 ] ] );

	}

};

THREE.ExtrudeGeometry.WorldUVGenerator = {

	generateTopUV: function ( geometry, indexA, indexB, indexC ) {

		var vertices = geometry.vertices;

		var a = vertices[ indexA ];
		var b = vertices[ indexB ];
		var c = vertices[ indexC ];

		return [
			new THREE.Vector2( a.x, a.y ),
			new THREE.Vector2( b.x, b.y ),
			new THREE.Vector2( c.x, c.y )
		];

	},

	generateSideWallUV: function ( geometry, indexA, indexB, indexC, indexD ) {

		var vertices = geometry.vertices;

		var a = vertices[ indexA ];
		var b = vertices[ indexB ];
		var c = vertices[ indexC ];
		var d = vertices[ indexD ];

		if ( Math.abs( a.y - b.y ) < 0.01 ) {
			return [
				new THREE.Vector2( a.x, 1 - a.z ),
				new THREE.Vector2( b.x, 1 - b.z ),
				new THREE.Vector2( c.x, 1 - c.z ),
				new THREE.Vector2( d.x, 1 - d.z )
			];
		} else {
			return [
				new THREE.Vector2( a.y, 1 - a.z ),
				new THREE.Vector2( b.y, 1 - b.z ),
				new THREE.Vector2( c.y, 1 - c.z ),
				new THREE.Vector2( d.y, 1 - d.z )
			];
		}
	}
};

// File:src/extras/geometries/ShapeGeometry.js

/**
 * @author jonobr1 / http://jonobr1.com
 *
 * Creates a one-sided polygonal geometry from a path shape. Similar to
 * ExtrudeGeometry.
 *
 * parameters = {
 *
 *	curveSegments: <int>, // number of points on the curves. NOT USED AT THE MOMENT.
 *
 *	material: <int> // material index for front and back faces
 *	uvGenerator: <Object> // object that provides UV generator functions
 *
 * }
 **/

THREE.ShapeGeometry = function ( shapes, options ) {

	THREE.Geometry.call( this );

	this.type = 'ShapeGeometry';

	if ( shapes instanceof Array === false ) shapes = [ shapes ];

	this.addShapeList( shapes, options );

	this.computeFaceNormals();

};

THREE.ShapeGeometry.prototype = Object.create( THREE.Geometry.prototype );

/**
 * Add an array of shapes to THREE.ShapeGeometry.
 */
THREE.ShapeGeometry.prototype.addShapeList = function ( shapes, options ) {

	for ( var i = 0, l = shapes.length; i < l; i ++ ) {

		this.addShape( shapes[ i ], options );

	}

	return this;

};

/**
 * Adds a shape to THREE.ShapeGeometry, based on THREE.ExtrudeGeometry.
 */
THREE.ShapeGeometry.prototype.addShape = function ( shape, options ) {

	if ( options === undefined ) options = {};
	var curveSegments = options.curveSegments !== undefined ? options.curveSegments : 12;

	var material = options.material;
	var uvgen = options.UVGenerator === undefined ? THREE.ExtrudeGeometry.WorldUVGenerator : options.UVGenerator;

	//

	var i, l, hole, s;

	var shapesOffset = this.vertices.length;
	var shapePoints = shape.extractPoints( curveSegments );

	var vertices = shapePoints.shape;
	var holes = shapePoints.holes;

	var reverse = ! THREE.Shape.Utils.isClockWise( vertices );

	if ( reverse ) {

		vertices = vertices.reverse();

		// Maybe we should also check if holes are in the opposite direction, just to be safe...

		for ( i = 0, l = holes.length; i < l; i ++ ) {

			hole = holes[ i ];

			if ( THREE.Shape.Utils.isClockWise( hole ) ) {

				holes[ i ] = hole.reverse();

			}

		}

		reverse = false;

	}

	var faces = THREE.Shape.Utils.triangulateShape( vertices, holes );

	// Vertices

	var contour = vertices;

	for ( i = 0, l = holes.length; i < l; i ++ ) {

		hole = holes[ i ];
		vertices = vertices.concat( hole );

	}

	//

	var vert, vlen = vertices.length;
	var face, flen = faces.length;
	var cont, clen = contour.length;

	for ( i = 0; i < vlen; i ++ ) {

		vert = vertices[ i ];

		this.vertices.push( new THREE.Vector3( vert.x, vert.y, 0 ) );

	}

	for ( i = 0; i < flen; i ++ ) {

		face = faces[ i ];

		var a = face[ 0 ] + shapesOffset;
		var b = face[ 1 ] + shapesOffset;
		var c = face[ 2 ] + shapesOffset;

		this.faces.push( new THREE.Face3( a, b, c, null, null, material ) );
		this.faceVertexUvs[ 0 ].push( uvgen.generateTopUV( this, a, b, c ) );

	}

};

// File:src/extras/geometries/LatheGeometry.js

/**
 * @author astrodud / http://astrodud.isgreat.org/
 * @author zz85 / https://github.com/zz85
 * @author bhouston / http://exocortex.com
 */

// points - to create a closed torus, one must use a set of points 
//    like so: [ a, b, c, d, a ], see first is the same as last.
// segments - the number of circumference segments to create
// phiStart - the starting radian
// phiLength - the radian (0 to 2*PI) range of the lathed section
//    2*pi is a closed lathe, less than 2PI is a portion.

THREE.LatheGeometry = function ( points, segments, phiStart, phiLength ) {

	THREE.Geometry.call( this );

	this.type = 'LatheGeometry';

	this.parameters = {
		points: points,
		segments: segments,
		phiStart: phiStart,
		phiLength: phiLength
	};

	segments = segments || 12;
	phiStart = phiStart || 0;
	phiLength = phiLength || 2 * Math.PI;

	var inversePointLength = 1.0 / ( points.length - 1 );
	var inverseSegments = 1.0 / segments;

	for ( var i = 0, il = segments; i <= il; i ++ ) {

		var phi = phiStart + i * inverseSegments * phiLength;

		var c = Math.cos( phi ),
			s = Math.sin( phi );

		for ( var j = 0, jl = points.length; j < jl; j ++ ) {

			var pt = points[ j ];

			var vertex = new THREE.Vector3();

			vertex.x = c * pt.x - s * pt.y;
			vertex.y = s * pt.x + c * pt.y;
			vertex.z = pt.z;

			this.vertices.push( vertex );

		}

	}

	var np = points.length;

	for ( var i = 0, il = segments; i < il; i ++ ) {

		for ( var j = 0, jl = points.length - 1; j < jl; j ++ ) {

			var base = j + np * i;
			var a = base;
			var b = base + np;
			var c = base + 1 + np;
			var d = base + 1;

			var u0 = i * inverseSegments;
			var v0 = j * inversePointLength;
			var u1 = u0 + inverseSegments;
			var v1 = v0 + inversePointLength;

			this.faces.push( new THREE.Face3( a, b, d ) );

			this.faceVertexUvs[ 0 ].push( [

				new THREE.Vector2( u0, v0 ),
				new THREE.Vector2( u1, v0 ),
				new THREE.Vector2( u0, v1 )

			] );

			this.faces.push( new THREE.Face3( b, c, d ) );

			this.faceVertexUvs[ 0 ].push( [

				new THREE.Vector2( u1, v0 ),
				new THREE.Vector2( u1, v1 ),
				new THREE.Vector2( u0, v1 )

			] );


		}

	}

	this.mergeVertices();
	this.computeFaceNormals();
	this.computeVertexNormals();

};

THREE.LatheGeometry.prototype = Object.create( THREE.Geometry.prototype );

// File:src/extras/geometries/PlaneGeometry.js

/**
 * @author mrdoob / http://mrdoob.com/
 * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Plane.as
 */

THREE.PlaneGeometry = function ( width, height, widthSegments, heightSegments ) {

	console.info( 'THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint.' );

	THREE.Geometry.call( this );

	this.type = 'PlaneGeometry';

	this.parameters = {
		width: width,
		height: height,
		widthSegments: widthSegments,
		heightSegments: heightSegments
	};

	this.fromBufferGeometry( new THREE.PlaneBufferGeometry( width, height, widthSegments, heightSegments ) );

};

THREE.PlaneGeometry.prototype = Object.create( THREE.Geometry.prototype );

// File:src/extras/geometries/PlaneBufferGeometry.js

/**
 * @author mrdoob / http://mrdoob.com/
 * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Plane.as
 */

THREE.PlaneBufferGeometry = function ( width, height, widthSegments, heightSegments ) {

	THREE.BufferGeometry.call( this );

	this.type = 'PlaneBufferGeometry';

	this.parameters = {
		width: width,
		height: height,
		widthSegments: widthSegments,
		heightSegments: heightSegments
	};

	var width_half = width / 2;
	var height_half = height / 2;

	var gridX = widthSegments || 1;
	var gridY = heightSegments || 1;

	var gridX1 = gridX + 1;
	var gridY1 = gridY + 1;

	var segment_width = width / gridX;
	var segment_height = height / gridY;

	var vertices = new Float32Array( gridX1 * gridY1 * 3 );
	var normals = new Float32Array( gridX1 * gridY1 * 3 );
	var uvs = new Float32Array( gridX1 * gridY1 * 2 );

	var offset = 0;
	var offset2 = 0;

	for ( var iy = 0; iy < gridY1; iy ++ ) {

		var y = iy * segment_height - height_half;

		for ( var ix = 0; ix < gridX1; ix ++ ) {

			var x = ix * segment_width - width_half;

			vertices[ offset     ] = x;
			vertices[ offset + 1 ] = - y;

			normals[ offset + 2 ] = 1;

			uvs[ offset2     ] = ix / gridX;
			uvs[ offset2 + 1 ] = 1 - ( iy / gridY );

			offset += 3;
			offset2 += 2;

		}

	}

	offset = 0;

	var indices = new ( ( vertices.length / 3 ) > 65535 ? Uint32Array : Uint16Array )( gridX * gridY * 6 );

	for ( var iy = 0; iy < gridY; iy ++ ) {

		for ( var ix = 0; ix < gridX; ix ++ ) {

			var a = ix + gridX1 * iy;
			var b = ix + gridX1 * ( iy + 1 );
			var c = ( ix + 1 ) + gridX1 * ( iy + 1 );
			var d = ( ix + 1 ) + gridX1 * iy;

			indices[ offset     ] = a;
			indices[ offset + 1 ] = b;
			indices[ offset + 2 ] = d;

			indices[ offset + 3 ] = b;
			indices[ offset + 4 ] = c;
			indices[ offset + 5 ] = d;

			offset += 6;

		}

	}

	this.addAttribute( 'index', new THREE.BufferAttribute( indices, 1 ) );
	this.addAttribute( 'position', new THREE.BufferAttribute( vertices, 3 ) );
	this.addAttribute( 'normal', new THREE.BufferAttribute( normals, 3 ) );
	this.addAttribute( 'uv', new THREE.BufferAttribute( uvs, 2 ) );

};

THREE.PlaneBufferGeometry.prototype = Object.create( THREE.BufferGeometry.prototype );

// File:src/extras/geometries/RingGeometry.js

/**
 * @author Kaleb Murphy
 */

THREE.RingGeometry = function ( innerRadius, outerRadius, thetaSegments, phiSegments, thetaStart, thetaLength ) {

	THREE.Geometry.call( this );

	this.type = 'RingGeometry';

	this.parameters = {
		innerRadius: innerRadius,
		outerRadius: outerRadius,
		thetaSegments: thetaSegments,
		phiSegments: phiSegments,
		thetaStart: thetaStart,
		thetaLength: thetaLength
	};

	innerRadius = innerRadius || 0;
	outerRadius = outerRadius || 50;

	thetaStart = thetaStart !== undefined ? thetaStart : 0;
	thetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;

	thetaSegments = thetaSegments !== undefined ? Math.max( 3, thetaSegments ) : 8;
	phiSegments = phiSegments !== undefined ? Math.max( 1, phiSegments ) : 8;

	var i, o, uvs = [], radius = innerRadius, radiusStep = ( ( outerRadius - innerRadius ) / phiSegments );

	for ( i = 0; i < phiSegments + 1; i ++ ) { // concentric circles inside ring

		for ( o = 0; o < thetaSegments + 1; o ++ ) { // number of segments per circle

			var vertex = new THREE.Vector3();
			var segment = thetaStart + o / thetaSegments * thetaLength;
			vertex.x = radius * Math.cos( segment );
			vertex.y = radius * Math.sin( segment );

			this.vertices.push( vertex );
			uvs.push( new THREE.Vector2( ( vertex.x / outerRadius + 1 ) / 2, ( vertex.y / outerRadius + 1 ) / 2 ) );
		}

		radius += radiusStep;

	}

	var n = new THREE.Vector3( 0, 0, 1 );

	for ( i = 0; i < phiSegments; i ++ ) { // concentric circles inside ring

		var thetaSegment = i * (thetaSegments + 1);

		for ( o = 0; o < thetaSegments ; o ++ ) { // number of segments per circle

			var segment = o + thetaSegment;

			var v1 = segment;
			var v2 = segment + thetaSegments + 1;
			var v3 = segment + thetaSegments + 2;

			this.faces.push( new THREE.Face3( v1, v2, v3, [ n.clone(), n.clone(), n.clone() ] ) );
			this.faceVertexUvs[ 0 ].push( [ uvs[ v1 ].clone(), uvs[ v2 ].clone(), uvs[ v3 ].clone() ]);

			v1 = segment;
			v2 = segment + thetaSegments + 2;
			v3 = segment + 1;

			this.faces.push( new THREE.Face3( v1, v2, v3, [ n.clone(), n.clone(), n.clone() ] ) );
			this.faceVertexUvs[ 0 ].push( [ uvs[ v1 ].clone(), uvs[ v2 ].clone(), uvs[ v3 ].clone() ]);

		}
	}

	this.computeFaceNormals();

	this.boundingSphere = new THREE.Sphere( new THREE.Vector3(), radius );

};

THREE.RingGeometry.prototype = Object.create( THREE.Geometry.prototype );


// File:src/extras/geometries/SphereGeometry.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.SphereGeometry = function ( radius, widthSegments, heightSegments, phiStart, phiLength, thetaStart, thetaLength ) {

	THREE.Geometry.call( this );

	this.type = 'SphereGeometry';

	this.parameters = {
		radius: radius,
		widthSegments: widthSegments,
		heightSegments: heightSegments,
		phiStart: phiStart,
		phiLength: phiLength,
		thetaStart: thetaStart,
		thetaLength: thetaLength 
	};

	radius = radius || 50;

	widthSegments = Math.max( 3, Math.floor( widthSegments ) || 8 );
	heightSegments = Math.max( 2, Math.floor( heightSegments ) || 6 );

	phiStart = phiStart !== undefined ? phiStart : 0;
	phiLength = phiLength !== undefined ? phiLength : Math.PI * 2;

	thetaStart = thetaStart !== undefined ? thetaStart : 0;
	thetaLength = thetaLength !== undefined ? thetaLength : Math.PI;

	var x, y, vertices = [], uvs = [];

	for ( y = 0; y <= heightSegments; y ++ ) {

		var verticesRow = [];
		var uvsRow = [];

		for ( x = 0; x <= widthSegments; x ++ ) {

			var u = x / widthSegments;
			var v = y / heightSegments;

			var vertex = new THREE.Vector3();
			vertex.x = - radius * Math.cos( phiStart + u * phiLength ) * Math.sin( thetaStart + v * thetaLength );
			vertex.y = radius * Math.cos( thetaStart + v * thetaLength );
			vertex.z = radius * Math.sin( phiStart + u * phiLength ) * Math.sin( thetaStart + v * thetaLength );

			this.vertices.push( vertex );

			verticesRow.push( this.vertices.length - 1 );
			uvsRow.push( new THREE.Vector2( u, 1 - v ) );

		}

		vertices.push( verticesRow );
		uvs.push( uvsRow );

	}

	for ( y = 0; y < heightSegments; y ++ ) {

		for ( x = 0; x < widthSegments; x ++ ) {

			var v1 = vertices[ y ][ x + 1 ];
			var v2 = vertices[ y ][ x ];
			var v3 = vertices[ y + 1 ][ x ];
			var v4 = vertices[ y + 1 ][ x + 1 ];

			var n1 = this.vertices[ v1 ].clone().normalize();
			var n2 = this.vertices[ v2 ].clone().normalize();
			var n3 = this.vertices[ v3 ].clone().normalize();
			var n4 = this.vertices[ v4 ].clone().normalize();

			var uv1 = uvs[ y ][ x + 1 ].clone();
			var uv2 = uvs[ y ][ x ].clone();
			var uv3 = uvs[ y + 1 ][ x ].clone();
			var uv4 = uvs[ y + 1 ][ x + 1 ].clone();

			if ( Math.abs( this.vertices[ v1 ].y ) === radius ) {

				uv1.x = ( uv1.x + uv2.x ) / 2;
				this.faces.push( new THREE.Face3( v1, v3, v4, [ n1, n3, n4 ] ) );
				this.faceVertexUvs[ 0 ].push( [ uv1, uv3, uv4 ] );

			} else if ( Math.abs( this.vertices[ v3 ].y ) === radius ) {

				uv3.x = ( uv3.x + uv4.x ) / 2;
				this.faces.push( new THREE.Face3( v1, v2, v3, [ n1, n2, n3 ] ) );
				this.faceVertexUvs[ 0 ].push( [ uv1, uv2, uv3 ] );

			} else {

				this.faces.push( new THREE.Face3( v1, v2, v4, [ n1, n2, n4 ] ) );
				this.faceVertexUvs[ 0 ].push( [ uv1, uv2, uv4 ] );

				this.faces.push( new THREE.Face3( v2, v3, v4, [ n2.clone(), n3, n4.clone() ] ) );
				this.faceVertexUvs[ 0 ].push( [ uv2.clone(), uv3, uv4.clone() ] );

			}

		}

	}

	this.computeFaceNormals();

	this.boundingSphere = new THREE.Sphere( new THREE.Vector3(), radius );

};

THREE.SphereGeometry.prototype = Object.create( THREE.Geometry.prototype );

// File:src/extras/geometries/TextGeometry.js

/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 * @author alteredq / http://alteredqualia.com/
 *
 * For creating 3D text geometry in three.js
 *
 * Text = 3D Text
 *
 * parameters = {
 *  size: 			<float>, 	// size of the text
 *  height: 		<float>, 	// thickness to extrude text
 *  curveSegments: 	<int>,		// number of points on the curves
 *
 *  font: 			<string>,		// font name
 *  weight: 		<string>,		// font weight (normal, bold)
 *  style: 			<string>,		// font style  (normal, italics)
 *
 *  bevelEnabled:	<bool>,			// turn on bevel
 *  bevelThickness: <float>, 		// how deep into text bevel goes
 *  bevelSize:		<float>, 		// how far from text outline is bevel
 *  }
 *
 */

/*	Usage Examples

	// TextGeometry wrapper

	var text3d = new TextGeometry( text, options );

	// Complete manner

	var textShapes = THREE.FontUtils.generateShapes( text, options );
	var text3d = new ExtrudeGeometry( textShapes, options );

*/


THREE.TextGeometry = function ( text, parameters ) {

	parameters = parameters || {};

	var textShapes = THREE.FontUtils.generateShapes( text, parameters );

	// translate parameters to ExtrudeGeometry API

	parameters.amount = parameters.height !== undefined ? parameters.height : 50;

	// defaults

	if ( parameters.bevelThickness === undefined ) parameters.bevelThickness = 10;
	if ( parameters.bevelSize === undefined ) parameters.bevelSize = 8;
	if ( parameters.bevelEnabled === undefined ) parameters.bevelEnabled = false;

	THREE.ExtrudeGeometry.call( this, textShapes, parameters );

	this.type = 'TextGeometry';

};

THREE.TextGeometry.prototype = Object.create( THREE.ExtrudeGeometry.prototype );

// File:src/extras/geometries/TorusGeometry.js

/**
 * @author oosmoxiecode
 * @author mrdoob / http://mrdoob.com/
 * based on http://code.google.com/p/away3d/source/browse/trunk/fp10/Away3DLite/src/away3dlite/primitives/Torus.as?r=2888
 */

THREE.TorusGeometry = function ( radius, tube, radialSegments, tubularSegments, arc ) {

	THREE.Geometry.call( this );

	this.type = 'TorusGeometry';

	this.parameters = {
		radius: radius,
		tube: tube,
		radialSegments: radialSegments,
		tubularSegments: tubularSegments,
		arc: arc
	};

	radius = radius || 100;
	tube = tube || 40;
	radialSegments = radialSegments || 8;
	tubularSegments = tubularSegments || 6;
	arc = arc || Math.PI * 2;

	var center = new THREE.Vector3(), uvs = [], normals = [];

	for ( var j = 0; j <= radialSegments; j ++ ) {

		for ( var i = 0; i <= tubularSegments; i ++ ) {

			var u = i / tubularSegments * arc;
			var v = j / radialSegments * Math.PI * 2;

			center.x = radius * Math.cos( u );
			center.y = radius * Math.sin( u );

			var vertex = new THREE.Vector3();
			vertex.x = ( radius + tube * Math.cos( v ) ) * Math.cos( u );
			vertex.y = ( radius + tube * Math.cos( v ) ) * Math.sin( u );
			vertex.z = tube * Math.sin( v );

			this.vertices.push( vertex );

			uvs.push( new THREE.Vector2( i / tubularSegments, j / radialSegments ) );
			normals.push( vertex.clone().sub( center ).normalize() );

		}

	}

	for ( var j = 1; j <= radialSegments; j ++ ) {

		for ( var i = 1; i <= tubularSegments; i ++ ) {

			var a = ( tubularSegments + 1 ) * j + i - 1;
			var b = ( tubularSegments + 1 ) * ( j - 1 ) + i - 1;
			var c = ( tubularSegments + 1 ) * ( j - 1 ) + i;
			var d = ( tubularSegments + 1 ) * j + i;

			var face = new THREE.Face3( a, b, d, [ normals[ a ].clone(), normals[ b ].clone(), normals[ d ].clone() ] );
			this.faces.push( face );
			this.faceVertexUvs[ 0 ].push( [ uvs[ a ].clone(), uvs[ b ].clone(), uvs[ d ].clone() ] );

			face = new THREE.Face3( b, c, d, [ normals[ b ].clone(), normals[ c ].clone(), normals[ d ].clone() ] );
			this.faces.push( face );
			this.faceVertexUvs[ 0 ].push( [ uvs[ b ].clone(), uvs[ c ].clone(), uvs[ d ].clone() ] );

		}

	}

	this.computeFaceNormals();

};

THREE.TorusGeometry.prototype = Object.create( THREE.Geometry.prototype );

// File:src/extras/geometries/TorusKnotGeometry.js

/**
 * @author oosmoxiecode
 * based on http://code.google.com/p/away3d/source/browse/trunk/fp10/Away3D/src/away3d/primitives/TorusKnot.as?spec=svn2473&r=2473
 */

THREE.TorusKnotGeometry = function ( radius, tube, radialSegments, tubularSegments, p, q, heightScale ) {

	THREE.Geometry.call( this );

	this.type = 'TorusKnotGeometry';

	this.parameters = {
		radius: radius,
		tube: tube,
		radialSegments: radialSegments,
		tubularSegments: tubularSegments,
		p: p,
		q: q,
		heightScale: heightScale
	};

	radius = radius || 100;
	tube = tube || 40;
	radialSegments = radialSegments || 64;
	tubularSegments = tubularSegments || 8;
	p = p || 2;
	q = q || 3;
	heightScale = heightScale || 1;
	
	var grid = new Array( radialSegments );
	var tang = new THREE.Vector3();
	var n = new THREE.Vector3();
	var bitan = new THREE.Vector3();

	for ( var i = 0; i < radialSegments; ++ i ) {

		grid[ i ] = new Array( tubularSegments );
		var u = i / radialSegments * 2 * p * Math.PI;
		var p1 = getPos( u, q, p, radius, heightScale );
		var p2 = getPos( u + 0.01, q, p, radius, heightScale );
		tang.subVectors( p2, p1 );
		n.addVectors( p2, p1 );

		bitan.crossVectors( tang, n );
		n.crossVectors( bitan, tang );
		bitan.normalize();
		n.normalize();

		for ( var j = 0; j < tubularSegments; ++ j ) {

			var v = j / tubularSegments * 2 * Math.PI;
			var cx = - tube * Math.cos( v ); // TODO: Hack: Negating it so it faces outside.
			var cy = tube * Math.sin( v );

			var pos = new THREE.Vector3();
			pos.x = p1.x + cx * n.x + cy * bitan.x;
			pos.y = p1.y + cx * n.y + cy * bitan.y;
			pos.z = p1.z + cx * n.z + cy * bitan.z;

			grid[ i ][ j ] = this.vertices.push( pos ) - 1;

		}

	}

	for ( var i = 0; i < radialSegments; ++ i ) {

		for ( var j = 0; j < tubularSegments; ++ j ) {

			var ip = ( i + 1 ) % radialSegments;
			var jp = ( j + 1 ) % tubularSegments;

			var a = grid[ i ][ j ];
			var b = grid[ ip ][ j ];
			var c = grid[ ip ][ jp ];
			var d = grid[ i ][ jp ];

			var uva = new THREE.Vector2( i / radialSegments, j / tubularSegments );
			var uvb = new THREE.Vector2( ( i + 1 ) / radialSegments, j / tubularSegments );
			var uvc = new THREE.Vector2( ( i + 1 ) / radialSegments, ( j + 1 ) / tubularSegments );
			var uvd = new THREE.Vector2( i / radialSegments, ( j + 1 ) / tubularSegments );

			this.faces.push( new THREE.Face3( a, b, d ) );
			this.faceVertexUvs[ 0 ].push( [ uva, uvb, uvd ] );

			this.faces.push( new THREE.Face3( b, c, d ) );
			this.faceVertexUvs[ 0 ].push( [ uvb.clone(), uvc, uvd.clone() ] );

		}
	}

	this.computeFaceNormals();
	this.computeVertexNormals();

	function getPos( u, in_q, in_p, radius, heightScale ) {

		var cu = Math.cos( u );
		var su = Math.sin( u );
		var quOverP = in_q / in_p * u;
		var cs = Math.cos( quOverP );

		var tx = radius * ( 2 + cs ) * 0.5 * cu;
		var ty = radius * ( 2 + cs ) * su * 0.5;
		var tz = heightScale * radius * Math.sin( quOverP ) * 0.5;

		return new THREE.Vector3( tx, ty, tz );

	}

};

THREE.TorusKnotGeometry.prototype = Object.create( THREE.Geometry.prototype );

// File:src/extras/geometries/TubeGeometry.js

/**
 * @author WestLangley / https://github.com/WestLangley
 * @author zz85 / https://github.com/zz85
 * @author miningold / https://github.com/miningold
 *
 * Modified from the TorusKnotGeometry by @oosmoxiecode
 *
 * Creates a tube which extrudes along a 3d spline
 *
 * Uses parallel transport frames as described in
 * http://www.cs.indiana.edu/pub/techreports/TR425.pdf
 */

THREE.TubeGeometry = function ( path, segments, radius, radialSegments, closed ) {

	THREE.Geometry.call( this );

	this.type = 'TubeGeometry';

	this.parameters = {
		path: path,
		segments: segments,
		radius: radius,
		radialSegments: radialSegments,
		closed: closed
	};

	segments = segments || 64;
	radius = radius || 1;
	radialSegments = radialSegments || 8;
	closed = closed || false;

	var grid = [];

	var scope = this,

		tangent,
		normal,
		binormal,

		numpoints = segments + 1,

		x, y, z,
		tx, ty, tz,
		u, v,

		cx, cy,
		pos, pos2 = new THREE.Vector3(),
		i, j,
		ip, jp,
		a, b, c, d,
		uva, uvb, uvc, uvd;

	var frames = new THREE.TubeGeometry.FrenetFrames( path, segments, closed ),
		tangents = frames.tangents,
		normals = frames.normals,
		binormals = frames.binormals;

	// proxy internals
	this.tangents = tangents;
	this.normals = normals;
	this.binormals = binormals;

	function vert( x, y, z ) {

		return scope.vertices.push( new THREE.Vector3( x, y, z ) ) - 1;

	}

	// consruct the grid

	for ( i = 0; i < numpoints; i ++ ) {

		grid[ i ] = [];

		u = i / ( numpoints - 1 );

		pos = path.getPointAt( u );

		tangent = tangents[ i ];
		normal = normals[ i ];
		binormal = binormals[ i ];

		for ( j = 0; j < radialSegments; j ++ ) {

			v = j / radialSegments * 2 * Math.PI;

			cx = - radius * Math.cos( v ); // TODO: Hack: Negating it so it faces outside.
			cy = radius * Math.sin( v );

			pos2.copy( pos );
			pos2.x += cx * normal.x + cy * binormal.x;
			pos2.y += cx * normal.y + cy * binormal.y;
			pos2.z += cx * normal.z + cy * binormal.z;

			grid[ i ][ j ] = vert( pos2.x, pos2.y, pos2.z );

		}
	}


	// construct the mesh

	for ( i = 0; i < segments; i ++ ) {

		for ( j = 0; j < radialSegments; j ++ ) {

			ip = ( closed ) ? (i + 1) % segments : i + 1;
			jp = (j + 1) % radialSegments;

			a = grid[ i ][ j ];		// *** NOT NECESSARILY PLANAR ! ***
			b = grid[ ip ][ j ];
			c = grid[ ip ][ jp ];
			d = grid[ i ][ jp ];

			uva = new THREE.Vector2( i / segments, j / radialSegments );
			uvb = new THREE.Vector2( ( i + 1 ) / segments, j / radialSegments );
			uvc = new THREE.Vector2( ( i + 1 ) / segments, ( j + 1 ) / radialSegments );
			uvd = new THREE.Vector2( i / segments, ( j + 1 ) / radialSegments );

			this.faces.push( new THREE.Face3( a, b, d ) );
			this.faceVertexUvs[ 0 ].push( [ uva, uvb, uvd ] );

			this.faces.push( new THREE.Face3( b, c, d ) );
			this.faceVertexUvs[ 0 ].push( [ uvb.clone(), uvc, uvd.clone() ] );

		}
	}

	this.computeFaceNormals();
	this.computeVertexNormals();

};

THREE.TubeGeometry.prototype = Object.create( THREE.Geometry.prototype );


// For computing of Frenet frames, exposing the tangents, normals and binormals the spline
THREE.TubeGeometry.FrenetFrames = function ( path, segments, closed ) {

	var	tangent = new THREE.Vector3(),
		normal = new THREE.Vector3(),
		binormal = new THREE.Vector3(),

		tangents = [],
		normals = [],
		binormals = [],

		vec = new THREE.Vector3(),
		mat = new THREE.Matrix4(),

		numpoints = segments + 1,
		theta,
		epsilon = 0.0001,
		smallest,

		tx, ty, tz,
		i, u, v;


	// expose internals
	this.tangents = tangents;
	this.normals = normals;
	this.binormals = binormals;

	// compute the tangent vectors for each segment on the path

	for ( i = 0; i < numpoints; i ++ ) {

		u = i / ( numpoints - 1 );

		tangents[ i ] = path.getTangentAt( u );
		tangents[ i ].normalize();

	}

	initialNormal3();

	/*
	function initialNormal1(lastBinormal) {
		// fixed start binormal. Has dangers of 0 vectors
		normals[ 0 ] = new THREE.Vector3();
		binormals[ 0 ] = new THREE.Vector3();
		if (lastBinormal===undefined) lastBinormal = new THREE.Vector3( 0, 0, 1 );
		normals[ 0 ].crossVectors( lastBinormal, tangents[ 0 ] ).normalize();
		binormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] ).normalize();
	}

	function initialNormal2() {

		// This uses the Frenet-Serret formula for deriving binormal
		var t2 = path.getTangentAt( epsilon );

		normals[ 0 ] = new THREE.Vector3().subVectors( t2, tangents[ 0 ] ).normalize();
		binormals[ 0 ] = new THREE.Vector3().crossVectors( tangents[ 0 ], normals[ 0 ] );

		normals[ 0 ].crossVectors( binormals[ 0 ], tangents[ 0 ] ).normalize(); // last binormal x tangent
		binormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] ).normalize();

	}
	*/

	function initialNormal3() {
		// select an initial normal vector perpenicular to the first tangent vector,
		// and in the direction of the smallest tangent xyz component

		normals[ 0 ] = new THREE.Vector3();
		binormals[ 0 ] = new THREE.Vector3();
		smallest = Number.MAX_VALUE;
		tx = Math.abs( tangents[ 0 ].x );
		ty = Math.abs( tangents[ 0 ].y );
		tz = Math.abs( tangents[ 0 ].z );

		if ( tx <= smallest ) {
			smallest = tx;
			normal.set( 1, 0, 0 );
		}

		if ( ty <= smallest ) {
			smallest = ty;
			normal.set( 0, 1, 0 );
		}

		if ( tz <= smallest ) {
			normal.set( 0, 0, 1 );
		}

		vec.crossVectors( tangents[ 0 ], normal ).normalize();

		normals[ 0 ].crossVectors( tangents[ 0 ], vec );
		binormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] );
	}


	// compute the slowly-varying normal and binormal vectors for each segment on the path

	for ( i = 1; i < numpoints; i ++ ) {

		normals[ i ] = normals[ i-1 ].clone();

		binormals[ i ] = binormals[ i-1 ].clone();

		vec.crossVectors( tangents[ i-1 ], tangents[ i ] );

		if ( vec.length() > epsilon ) {

			vec.normalize();

			theta = Math.acos( THREE.Math.clamp( tangents[ i-1 ].dot( tangents[ i ] ), - 1, 1 ) ); // clamp for floating pt errors

			normals[ i ].applyMatrix4( mat.makeRotationAxis( vec, theta ) );

		}

		binormals[ i ].crossVectors( tangents[ i ], normals[ i ] );

	}


	// if the curve is closed, postprocess the vectors so the first and last normal vectors are the same

	if ( closed ) {

		theta = Math.acos( THREE.Math.clamp( normals[ 0 ].dot( normals[ numpoints-1 ] ), - 1, 1 ) );
		theta /= ( numpoints - 1 );

		if ( tangents[ 0 ].dot( vec.crossVectors( normals[ 0 ], normals[ numpoints-1 ] ) ) > 0 ) {

			theta = - theta;

		}

		for ( i = 1; i < numpoints; i ++ ) {

			// twist a little...
			normals[ i ].applyMatrix4( mat.makeRotationAxis( tangents[ i ], theta * i ) );
			binormals[ i ].crossVectors( tangents[ i ], normals[ i ] );

		}

	}
};

// File:src/extras/geometries/PolyhedronGeometry.js

/**
 * @author clockworkgeek / https://github.com/clockworkgeek
 * @author timothypratley / https://github.com/timothypratley
 * @author WestLangley / http://github.com/WestLangley
*/

THREE.PolyhedronGeometry = function ( vertices, indices, radius, detail ) {

	THREE.Geometry.call( this );

	this.type = 'PolyhedronGeometry';

	this.parameters = {
		vertices: vertices,
		indices: indices,
		radius: radius,
		detail: detail
	};

	radius = radius || 1;
	detail = detail || 0;

	var that = this;

	for ( var i = 0, l = vertices.length; i < l; i += 3 ) {

		prepare( new THREE.Vector3( vertices[ i ], vertices[ i + 1 ], vertices[ i + 2 ] ) );

	}

	var midpoints = [], p = this.vertices;

	var faces = [];

	for ( var i = 0, j = 0, l = indices.length; i < l; i += 3, j ++ ) {

		var v1 = p[ indices[ i     ] ];
		var v2 = p[ indices[ i + 1 ] ];
		var v3 = p[ indices[ i + 2 ] ];

		faces[ j ] = new THREE.Face3( v1.index, v2.index, v3.index, [ v1.clone(), v2.clone(), v3.clone() ] );

	}

	var centroid = new THREE.Vector3();

	for ( var i = 0, l = faces.length; i < l; i ++ ) {

		subdivide( faces[ i ], detail );

	}


	// Handle case when face straddles the seam

	for ( var i = 0, l = this.faceVertexUvs[ 0 ].length; i < l; i ++ ) {

		var uvs = this.faceVertexUvs[ 0 ][ i ];

		var x0 = uvs[ 0 ].x;
		var x1 = uvs[ 1 ].x;
		var x2 = uvs[ 2 ].x;

		var max = Math.max( x0, Math.max( x1, x2 ) );
		var min = Math.min( x0, Math.min( x1, x2 ) );

		if ( max > 0.9 && min < 0.1 ) { // 0.9 is somewhat arbitrary

			if ( x0 < 0.2 ) uvs[ 0 ].x += 1;
			if ( x1 < 0.2 ) uvs[ 1 ].x += 1;
			if ( x2 < 0.2 ) uvs[ 2 ].x += 1;

		}

	}


	// Apply radius

	for ( var i = 0, l = this.vertices.length; i < l; i ++ ) {

		this.vertices[ i ].multiplyScalar( radius );

	}


	// Merge vertices

	this.mergeVertices();

	this.computeFaceNormals();

	this.boundingSphere = new THREE.Sphere( new THREE.Vector3(), radius );


	// Project vector onto sphere's surface

	function prepare( vector ) {

		var vertex = vector.normalize().clone();
		vertex.index = that.vertices.push( vertex ) - 1;

		// Texture coords are equivalent to map coords, calculate angle and convert to fraction of a circle.

		var u = azimuth( vector ) / 2 / Math.PI + 0.5;
		var v = inclination( vector ) / Math.PI + 0.5;
		vertex.uv = new THREE.Vector2( u, 1 - v );

		return vertex;

	}


	// Approximate a curved face with recursively sub-divided triangles.

	function make( v1, v2, v3 ) {

		var face = new THREE.Face3( v1.index, v2.index, v3.index, [ v1.clone(), v2.clone(), v3.clone() ] );
		that.faces.push( face );

		centroid.copy( v1 ).add( v2 ).add( v3 ).divideScalar( 3 );

		var azi = azimuth( centroid );

		that.faceVertexUvs[ 0 ].push( [
			correctUV( v1.uv, v1, azi ),
			correctUV( v2.uv, v2, azi ),
			correctUV( v3.uv, v3, azi )
		] );

	}


	// Analytically subdivide a face to the required detail level.

	function subdivide( face, detail ) {

		var cols = Math.pow(2, detail);
		var cells = Math.pow(4, detail);
		var a = prepare( that.vertices[ face.a ] );
		var b = prepare( that.vertices[ face.b ] );
		var c = prepare( that.vertices[ face.c ] );
		var v = [];

		// Construct all of the vertices for this subdivision.

		for ( var i = 0 ; i <= cols; i ++ ) {

			v[ i ] = [];

			var aj = prepare( a.clone().lerp( c, i / cols ) );
			var bj = prepare( b.clone().lerp( c, i / cols ) );
			var rows = cols - i;

			for ( var j = 0; j <= rows; j ++) {

				if ( j == 0 && i == cols ) {

					v[ i ][ j ] = aj;

				} else {

					v[ i ][ j ] = prepare( aj.clone().lerp( bj, j / rows ) );

				}

			}

		}

		// Construct all of the faces.

		for ( var i = 0; i < cols ; i ++ ) {

			for ( var j = 0; j < 2 * (cols - i) - 1; j ++ ) {

				var k = Math.floor( j / 2 );

				if ( j % 2 == 0 ) {

					make(
						v[ i ][ k + 1],
						v[ i + 1 ][ k ],
						v[ i ][ k ]
					);

				} else {

					make(
						v[ i ][ k + 1 ],
						v[ i + 1][ k + 1],
						v[ i + 1 ][ k ]
					);

				}

			}

		}

	}


	// Angle around the Y axis, counter-clockwise when looking from above.

	function azimuth( vector ) {

		return Math.atan2( vector.z, - vector.x );

	}


	// Angle above the XZ plane.

	function inclination( vector ) {

		return Math.atan2( - vector.y, Math.sqrt( ( vector.x * vector.x ) + ( vector.z * vector.z ) ) );

	}


	// Texture fixing helper. Spheres have some odd behaviours.

	function correctUV( uv, vector, azimuth ) {

		if ( ( azimuth < 0 ) && ( uv.x === 1 ) ) uv = new THREE.Vector2( uv.x - 1, uv.y );
		if ( ( vector.x === 0 ) && ( vector.z === 0 ) ) uv = new THREE.Vector2( azimuth / 2 / Math.PI + 0.5, uv.y );
		return uv.clone();

	}


};

THREE.PolyhedronGeometry.prototype = Object.create( THREE.Geometry.prototype );

// File:src/extras/geometries/DodecahedronGeometry.js

/**
 * @author Abe Pazos / https://hamoid.com
 */

THREE.DodecahedronGeometry = function ( radius, detail ) {

	this.parameters = {
		radius: radius,
		detail: detail
	};

	var t = ( 1 + Math.sqrt( 5 ) ) / 2;
	var r = 1 / t;

	var vertices = [

		// (±1, ±1, ±1)
		-1, -1, -1,    -1, -1,  1,
		-1,  1, -1,    -1,  1,  1,
		 1, -1, -1,     1, -1,  1,
		 1,  1, -1,     1,  1,  1,

		// (0, ±1/φ, ±φ)
		 0, -r, -t,     0, -r,  t,
		 0,  r, -t,     0,  r,  t,

		// (±1/φ, ±φ, 0)
		-r, -t,  0,    -r,  t,  0,
		 r, -t,  0,     r,  t,  0,

		// (±φ, 0, ±1/φ)
		-t,  0, -r,     t,  0, -r,
		-t,  0,  r,     t,  0,  r
	];

	var indices = [
		 3, 11,  7,      3,  7, 15,      3, 15, 13,
		 7, 19, 17,      7, 17,  6,      7,  6, 15,
		17,  4,  8,     17,  8, 10,     17, 10,  6,
		 8,  0, 16,      8, 16,  2,      8,  2, 10,
		 0, 12,  1,      0,  1, 18,      0, 18, 16,
		 6, 10,  2,      6,  2, 13,      6, 13, 15,
		 2, 16, 18,      2, 18,  3,      2,  3, 13,
		18,  1,  9,     18,  9, 11,     18, 11,  3,
		 4, 14, 12,      4, 12,  0,      4,  0,  8,
		11,  9,  5,     11,  5, 19,     11, 19,  7,
		19,  5, 14,     19, 14,  4,     19,  4, 17,
		 1, 12, 14,      1, 14,  5,      1,  5,  9
	];

	THREE.PolyhedronGeometry.call( this, vertices, indices, radius, detail );

};

THREE.DodecahedronGeometry.prototype = Object.create( THREE.Geometry.prototype );

// File:src/extras/geometries/IcosahedronGeometry.js

/**
 * @author timothypratley / https://github.com/timothypratley
 */

THREE.IcosahedronGeometry = function ( radius, detail ) {

	var t = ( 1 + Math.sqrt( 5 ) ) / 2;

	var vertices = [
		- 1,  t,  0,    1,  t,  0,   - 1, - t,  0,    1, - t,  0,
		 0, - 1,  t,    0,  1,  t,    0, - 1, - t,    0,  1, - t,
		 t,  0, - 1,    t,  0,  1,   - t,  0, - 1,   - t,  0,  1
	];

	var indices = [
		 0, 11,  5,    0,  5,  1,    0,  1,  7,    0,  7, 10,    0, 10, 11,
		 1,  5,  9,    5, 11,  4,   11, 10,  2,   10,  7,  6,    7,  1,  8,
		 3,  9,  4,    3,  4,  2,    3,  2,  6,    3,  6,  8,    3,  8,  9,
		 4,  9,  5,    2,  4, 11,    6,  2, 10,    8,  6,  7,    9,  8,  1
	];

	THREE.PolyhedronGeometry.call( this, vertices, indices, radius, detail );

	this.type = 'IcosahedronGeometry';

	this.parameters = {
		radius: radius,
		detail: detail
	};
};

THREE.IcosahedronGeometry.prototype = Object.create( THREE.Geometry.prototype );

// File:src/extras/geometries/OctahedronGeometry.js

/**
 * @author timothypratley / https://github.com/timothypratley
 */

THREE.OctahedronGeometry = function ( radius, detail ) {

	this.parameters = {
		radius: radius,
		detail: detail
	};

	var vertices = [
		1, 0, 0,   - 1, 0, 0,    0, 1, 0,    0,- 1, 0,    0, 0, 1,    0, 0,- 1
	];

	var indices = [
		0, 2, 4,    0, 4, 3,    0, 3, 5,    0, 5, 2,    1, 2, 5,    1, 5, 3,    1, 3, 4,    1, 4, 2
	];

	THREE.PolyhedronGeometry.call( this, vertices, indices, radius, detail );

	this.type = 'OctahedronGeometry';

	this.parameters = {
		radius: radius,
		detail: detail
	};
};

THREE.OctahedronGeometry.prototype = Object.create( THREE.Geometry.prototype );

// File:src/extras/geometries/TetrahedronGeometry.js

/**
 * @author timothypratley / https://github.com/timothypratley
 */

THREE.TetrahedronGeometry = function ( radius, detail ) {

	var vertices = [
		 1,  1,  1,   - 1, - 1,  1,   - 1,  1, - 1,    1, - 1, - 1
	];

	var indices = [
		 2,  1,  0,    0,  3,  2,    1,  3,  0,    2,  3,  1
	];

	THREE.PolyhedronGeometry.call( this, vertices, indices, radius, detail );

	this.type = 'TetrahedronGeometry';

	this.parameters = {
		radius: radius,
		detail: detail
	};

};

THREE.TetrahedronGeometry.prototype = Object.create( THREE.Geometry.prototype );

// File:src/extras/geometries/ParametricGeometry.js

/**
 * @author zz85 / https://github.com/zz85
 * Parametric Surfaces Geometry
 * based on the brilliant article by @prideout http://prideout.net/blog/?p=44
 *
 * new THREE.ParametricGeometry( parametricFunction, uSegments, ySegements );
 *
 */

THREE.ParametricGeometry = function ( func, slices, stacks ) {

	THREE.Geometry.call( this );

	this.type = 'ParametricGeometry';

	this.parameters = {
		func: func,
		slices: slices,
		stacks: stacks
	};

	var verts = this.vertices;
	var faces = this.faces;
	var uvs = this.faceVertexUvs[ 0 ];

	var i, il, j, p;
	var u, v;

	var stackCount = stacks + 1;
	var sliceCount = slices + 1;

	for ( i = 0; i <= stacks; i ++ ) {

		v = i / stacks;

		for ( j = 0; j <= slices; j ++ ) {

			u = j / slices;

			p = func( u, v );
			verts.push( p );

		}
	}

	var a, b, c, d;
	var uva, uvb, uvc, uvd;

	for ( i = 0; i < stacks; i ++ ) {

		for ( j = 0; j < slices; j ++ ) {

			a = i * sliceCount + j;
			b = i * sliceCount + j + 1;
			c = (i + 1) * sliceCount + j + 1;
			d = (i + 1) * sliceCount + j;

			uva = new THREE.Vector2( j / slices, i / stacks );
			uvb = new THREE.Vector2( ( j + 1 ) / slices, i / stacks );
			uvc = new THREE.Vector2( ( j + 1 ) / slices, ( i + 1 ) / stacks );
			uvd = new THREE.Vector2( j / slices, ( i + 1 ) / stacks );

			faces.push( new THREE.Face3( a, b, d ) );
			uvs.push( [ uva, uvb, uvd ] );

			faces.push( new THREE.Face3( b, c, d ) );
			uvs.push( [ uvb.clone(), uvc, uvd.clone() ] );

		}

	}

	// console.log(this);

	// magic bullet
	// var diff = this.mergeVertices();
	// console.log('removed ', diff, ' vertices by merging');

	this.computeFaceNormals();
	this.computeVertexNormals();

};

THREE.ParametricGeometry.prototype = Object.create( THREE.Geometry.prototype );

// File:src/extras/helpers/AxisHelper.js

/**
 * @author sroucheray / http://sroucheray.org/
 * @author mrdoob / http://mrdoob.com/
 */

THREE.AxisHelper = function ( size ) {

	size = size || 1;

	var vertices = new Float32Array( [
		0, 0, 0,  size, 0, 0,
		0, 0, 0,  0, size, 0,
		0, 0, 0,  0, 0, size
	] );

	var colors = new Float32Array( [
		1, 0, 0,  1, 0.6, 0,
		0, 1, 0,  0.6, 1, 0,
		0, 0, 1,  0, 0.6, 1
	] );

	var geometry = new THREE.BufferGeometry();
	geometry.addAttribute( 'position', new THREE.BufferAttribute( vertices, 3 ) );
	geometry.addAttribute( 'color', new THREE.BufferAttribute( colors, 3 ) );

	var material = new THREE.LineBasicMaterial( { vertexColors: THREE.VertexColors } );

	THREE.Line.call( this, geometry, material, THREE.LinePieces );

};

THREE.AxisHelper.prototype = Object.create( THREE.Line.prototype );

// File:src/extras/helpers/ArrowHelper.js

/**
 * @author WestLangley / http://github.com/WestLangley
 * @author zz85 / http://github.com/zz85
 * @author bhouston / http://exocortex.com
 *
 * Creates an arrow for visualizing directions
 *
 * Parameters:
 *  dir - Vector3
 *  origin - Vector3
 *  length - Number
 *  color - color in hex value
 *  headLength - Number
 *  headWidth - Number
 */

THREE.ArrowHelper = ( function () {

	var lineGeometry = new THREE.Geometry();
	lineGeometry.vertices.push( new THREE.Vector3( 0, 0, 0 ), new THREE.Vector3( 0, 1, 0 ) );

	var coneGeometry = new THREE.CylinderGeometry( 0, 0.5, 1, 5, 1 );
	coneGeometry.applyMatrix( new THREE.Matrix4().makeTranslation( 0, - 0.5, 0 ) );

	return function ( dir, origin, length, color, headLength, headWidth ) {

		// dir is assumed to be normalized

		THREE.Object3D.call( this );

		if ( color === undefined ) color = 0xffff00;
		if ( length === undefined ) length = 1;
		if ( headLength === undefined ) headLength = 0.2 * length;
		if ( headWidth === undefined ) headWidth = 0.2 * headLength;

		this.position.copy( origin );

		this.line = new THREE.Line( lineGeometry, new THREE.LineBasicMaterial( { color: color } ) );
		this.line.matrixAutoUpdate = false;
		this.add( this.line );

		this.cone = new THREE.Mesh( coneGeometry, new THREE.MeshBasicMaterial( { color: color } ) );
		this.cone.matrixAutoUpdate = false;
		this.add( this.cone );

		this.setDirection( dir );
		this.setLength( length, headLength, headWidth );

	}

}() );

THREE.ArrowHelper.prototype = Object.create( THREE.Object3D.prototype );

THREE.ArrowHelper.prototype.setDirection = ( function () {

	var axis = new THREE.Vector3();
	var radians;

	return function ( dir ) {

		// dir is assumed to be normalized

		if ( dir.y > 0.99999 ) {

			this.quaternion.set( 0, 0, 0, 1 );

		} else if ( dir.y < - 0.99999 ) {

			this.quaternion.set( 1, 0, 0, 0 );

		} else {

			axis.set( dir.z, 0, - dir.x ).normalize();

			radians = Math.acos( dir.y );

			this.quaternion.setFromAxisAngle( axis, radians );

		}

	};

}() );

THREE.ArrowHelper.prototype.setLength = function ( length, headLength, headWidth ) {

	if ( headLength === undefined ) headLength = 0.2 * length;
	if ( headWidth === undefined ) headWidth = 0.2 * headLength;

	this.line.scale.set( 1, length, 1 );
	this.line.updateMatrix();

	this.cone.scale.set( headWidth, headLength, headWidth );
	this.cone.position.y = length;
	this.cone.updateMatrix();

};

THREE.ArrowHelper.prototype.setColor = function ( color ) {

	this.line.material.color.set( color );
	this.cone.material.color.set( color );

};

// File:src/extras/helpers/BoxHelper.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.BoxHelper = function ( object ) {

	var geometry = new THREE.BufferGeometry();
	geometry.addAttribute( 'position', new THREE.BufferAttribute( new Float32Array( 72 ), 3 ) );

	THREE.Line.call( this, geometry, new THREE.LineBasicMaterial( { color: 0xffff00 } ), THREE.LinePieces );

	if ( object !== undefined ) {

		this.update( object );

	}

};

THREE.BoxHelper.prototype = Object.create( THREE.Line.prototype );

THREE.BoxHelper.prototype.update = function ( object ) {

	var geometry = object.geometry;

	if ( geometry.boundingBox === null ) {

		geometry.computeBoundingBox();

	}

	var min = geometry.boundingBox.min;
	var max = geometry.boundingBox.max;

	/*
	  5____4
	1/___0/|
	| 6__|_7
	2/___3/

	0: max.x, max.y, max.z
	1: min.x, max.y, max.z
	2: min.x, min.y, max.z
	3: max.x, min.y, max.z
	4: max.x, max.y, min.z
	5: min.x, max.y, min.z
	6: min.x, min.y, min.z
	7: max.x, min.y, min.z
	*/

	var vertices = this.geometry.attributes.position.array;

	vertices[  0 ] = max.x; vertices[  1 ] = max.y; vertices[  2 ] = max.z;
	vertices[  3 ] = min.x; vertices[  4 ] = max.y; vertices[  5 ] = max.z;

	vertices[  6 ] = min.x; vertices[  7 ] = max.y; vertices[  8 ] = max.z;
	vertices[  9 ] = min.x; vertices[ 10 ] = min.y; vertices[ 11 ] = max.z;

	vertices[ 12 ] = min.x; vertices[ 13 ] = min.y; vertices[ 14 ] = max.z;
	vertices[ 15 ] = max.x; vertices[ 16 ] = min.y; vertices[ 17 ] = max.z;

	vertices[ 18 ] = max.x; vertices[ 19 ] = min.y; vertices[ 20 ] = max.z;
	vertices[ 21 ] = max.x; vertices[ 22 ] = max.y; vertices[ 23 ] = max.z;

	//

	vertices[ 24 ] = max.x; vertices[ 25 ] = max.y; vertices[ 26 ] = min.z;
	vertices[ 27 ] = min.x; vertices[ 28 ] = max.y; vertices[ 29 ] = min.z;

	vertices[ 30 ] = min.x; vertices[ 31 ] = max.y; vertices[ 32 ] = min.z;
	vertices[ 33 ] = min.x; vertices[ 34 ] = min.y; vertices[ 35 ] = min.z;

	vertices[ 36 ] = min.x; vertices[ 37 ] = min.y; vertices[ 38 ] = min.z;
	vertices[ 39 ] = max.x; vertices[ 40 ] = min.y; vertices[ 41 ] = min.z;

	vertices[ 42 ] = max.x; vertices[ 43 ] = min.y; vertices[ 44 ] = min.z;
	vertices[ 45 ] = max.x; vertices[ 46 ] = max.y; vertices[ 47 ] = min.z;

	//

	vertices[ 48 ] = max.x; vertices[ 49 ] = max.y; vertices[ 50 ] = max.z;
	vertices[ 51 ] = max.x; vertices[ 52 ] = max.y; vertices[ 53 ] = min.z;

	vertices[ 54 ] = min.x; vertices[ 55 ] = max.y; vertices[ 56 ] = max.z;
	vertices[ 57 ] = min.x; vertices[ 58 ] = max.y; vertices[ 59 ] = min.z;

	vertices[ 60 ] = min.x; vertices[ 61 ] = min.y; vertices[ 62 ] = max.z;
	vertices[ 63 ] = min.x; vertices[ 64 ] = min.y; vertices[ 65 ] = min.z;

	vertices[ 66 ] = max.x; vertices[ 67 ] = min.y; vertices[ 68 ] = max.z;
	vertices[ 69 ] = max.x; vertices[ 70 ] = min.y; vertices[ 71 ] = min.z;

	this.geometry.attributes.position.needsUpdate = true;

	this.geometry.computeBoundingSphere();

	this.matrix = object.matrixWorld;
	this.matrixAutoUpdate = false;

};

// File:src/extras/helpers/BoundingBoxHelper.js

/**
 * @author WestLangley / http://github.com/WestLangley
 */

// a helper to show the world-axis-aligned bounding box for an object

THREE.BoundingBoxHelper = function ( object, hex ) {

	var color = ( hex !== undefined ) ? hex : 0x888888;

	this.object = object;

	this.box = new THREE.Box3();

	THREE.Mesh.call( this, new THREE.BoxGeometry( 1, 1, 1 ), new THREE.MeshBasicMaterial( { color: color, wireframe: true } ) );

};

THREE.BoundingBoxHelper.prototype = Object.create( THREE.Mesh.prototype );

THREE.BoundingBoxHelper.prototype.update = function () {

	this.box.setFromObject( this.object );

	this.box.size( this.scale );

	this.box.center( this.position );

};

// File:src/extras/helpers/CameraHelper.js

/**
 * @author alteredq / http://alteredqualia.com/
 *
 *	- shows frustum, line of sight and up of the camera
 *	- suitable for fast updates
 * 	- based on frustum visualization in lightgl.js shadowmap example
 *		http://evanw.github.com/lightgl.js/tests/shadowmap.html
 */

THREE.CameraHelper = function ( camera ) {

	var geometry = new THREE.Geometry();
	var material = new THREE.LineBasicMaterial( { color: 0xffffff, vertexColors: THREE.FaceColors } );

	var pointMap = {};

	// colors

	var hexFrustum = 0xffaa00;
	var hexCone = 0xff0000;
	var hexUp = 0x00aaff;
	var hexTarget = 0xffffff;
	var hexCross = 0x333333;

	// near

	addLine( "n1", "n2", hexFrustum );
	addLine( "n2", "n4", hexFrustum );
	addLine( "n4", "n3", hexFrustum );
	addLine( "n3", "n1", hexFrustum );

	// far

	addLine( "f1", "f2", hexFrustum );
	addLine( "f2", "f4", hexFrustum );
	addLine( "f4", "f3", hexFrustum );
	addLine( "f3", "f1", hexFrustum );

	// sides

	addLine( "n1", "f1", hexFrustum );
	addLine( "n2", "f2", hexFrustum );
	addLine( "n3", "f3", hexFrustum );
	addLine( "n4", "f4", hexFrustum );

	// cone

	addLine( "p", "n1", hexCone );
	addLine( "p", "n2", hexCone );
	addLine( "p", "n3", hexCone );
	addLine( "p", "n4", hexCone );

	// up

	addLine( "u1", "u2", hexUp );
	addLine( "u2", "u3", hexUp );
	addLine( "u3", "u1", hexUp );

	// target

	addLine( "c", "t", hexTarget );
	addLine( "p", "c", hexCross );

	// cross

	addLine( "cn1", "cn2", hexCross );
	addLine( "cn3", "cn4", hexCross );

	addLine( "cf1", "cf2", hexCross );
	addLine( "cf3", "cf4", hexCross );

	function addLine( a, b, hex ) {

		addPoint( a, hex );
		addPoint( b, hex );

	}

	function addPoint( id, hex ) {

		geometry.vertices.push( new THREE.Vector3() );
		geometry.colors.push( new THREE.Color( hex ) );

		if ( pointMap[ id ] === undefined ) {

			pointMap[ id ] = [];

		}

		pointMap[ id ].push( geometry.vertices.length - 1 );

	}

	THREE.Line.call( this, geometry, material, THREE.LinePieces );

	this.camera = camera;
	this.matrix = camera.matrixWorld;
	this.matrixAutoUpdate = false;

	this.pointMap = pointMap;

	this.update();

};

THREE.CameraHelper.prototype = Object.create( THREE.Line.prototype );

THREE.CameraHelper.prototype.update = function () {

	var geometry, pointMap;
	
	var vector = new THREE.Vector3();
	var camera = new THREE.Camera();

	var setPoint = function ( point, x, y, z ) {

		vector.set( x, y, z ).unproject( camera );

		var points = pointMap[ point ];

		if ( points !== undefined ) {

			for ( var i = 0, il = points.length; i < il; i ++ ) {

				geometry.vertices[ points[ i ] ].copy( vector );

			}

		}

	};

	return function () {

		geometry = this.geometry;
		pointMap = this.pointMap;

		var w = 1, h = 1;

		// we need just camera projection matrix
		// world matrix must be identity

		camera.projectionMatrix.copy( this.camera.projectionMatrix );

		// center / target

		setPoint( "c", 0, 0, - 1 );
		setPoint( "t", 0, 0,  1 );

		// near

		setPoint( "n1", - w, - h, - 1 );
		setPoint( "n2",   w, - h, - 1 );
		setPoint( "n3", - w,   h, - 1 );
		setPoint( "n4",   w,   h, - 1 );

		// far

		setPoint( "f1", - w, - h, 1 );
		setPoint( "f2",   w, - h, 1 );
		setPoint( "f3", - w,   h, 1 );
		setPoint( "f4",   w,   h, 1 );

		// up

		setPoint( "u1",   w * 0.7, h * 1.1, - 1 );
		setPoint( "u2", - w * 0.7, h * 1.1, - 1 );
		setPoint( "u3",         0, h * 2,   - 1 );

		// cross

		setPoint( "cf1", - w,   0, 1 );
		setPoint( "cf2",   w,   0, 1 );
		setPoint( "cf3",   0, - h, 1 );
		setPoint( "cf4",   0,   h, 1 );

		setPoint( "cn1", - w,   0, - 1 );
		setPoint( "cn2",   w,   0, - 1 );
		setPoint( "cn3",   0, - h, - 1 );
		setPoint( "cn4",   0,   h, - 1 );

		geometry.verticesNeedUpdate = true;

	};

}();

// File:src/extras/helpers/DirectionalLightHelper.js

/**
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 * @author WestLangley / http://github.com/WestLangley
 */

THREE.DirectionalLightHelper = function ( light, size ) {

	THREE.Object3D.call( this );

	this.light = light;
	this.light.updateMatrixWorld();

	this.matrix = light.matrixWorld;
	this.matrixAutoUpdate = false;

	size = size || 1;

	var geometry = new THREE.Geometry();
	geometry.vertices.push(
		new THREE.Vector3( - size,   size, 0 ),
		new THREE.Vector3(   size,   size, 0 ),
		new THREE.Vector3(   size, - size, 0 ),
		new THREE.Vector3( - size, - size, 0 ),
		new THREE.Vector3( - size,   size, 0 )
	);

	var material = new THREE.LineBasicMaterial( { fog: false } );
	material.color.copy( this.light.color ).multiplyScalar( this.light.intensity );

	this.lightPlane = new THREE.Line( geometry, material );
	this.add( this.lightPlane );

	geometry = new THREE.Geometry();
	geometry.vertices.push(
		new THREE.Vector3(),
		new THREE.Vector3()
	);

	material = new THREE.LineBasicMaterial( { fog: false } );
	material.color.copy( this.light.color ).multiplyScalar( this.light.intensity );

	this.targetLine = new THREE.Line( geometry, material );
	this.add( this.targetLine );

	this.update();

};

THREE.DirectionalLightHelper.prototype = Object.create( THREE.Object3D.prototype );

THREE.DirectionalLightHelper.prototype.dispose = function () {

	this.lightPlane.geometry.dispose();
	this.lightPlane.material.dispose();
	this.targetLine.geometry.dispose();
	this.targetLine.material.dispose();
};

THREE.DirectionalLightHelper.prototype.update = function () {

	var v1 = new THREE.Vector3();
	var v2 = new THREE.Vector3();
	var v3 = new THREE.Vector3();

	return function () {

		v1.setFromMatrixPosition( this.light.matrixWorld );
		v2.setFromMatrixPosition( this.light.target.matrixWorld );
		v3.subVectors( v2, v1 );

		this.lightPlane.lookAt( v3 );
		this.lightPlane.material.color.copy( this.light.color ).multiplyScalar( this.light.intensity );

		this.targetLine.geometry.vertices[ 1 ].copy( v3 );
		this.targetLine.geometry.verticesNeedUpdate = true;
		this.targetLine.material.color.copy( this.lightPlane.material.color );

	};

}();

// File:src/extras/helpers/EdgesHelper.js

/**
 * @author WestLangley / http://github.com/WestLangley
 */

THREE.EdgesHelper = function ( object, hex ) {

	var color = ( hex !== undefined ) ? hex : 0xffffff;

	var edge = [ 0, 0 ], hash = {};
	var sortFunction = function ( a, b ) { return a - b };

	var keys = [ 'a', 'b', 'c' ];
	var geometry = new THREE.BufferGeometry();

	var geometry2 = object.geometry.clone();

	geometry2.mergeVertices();
	geometry2.computeFaceNormals();

	var vertices = geometry2.vertices;
	var faces = geometry2.faces;
	var numEdges = 0;

	for ( var i = 0, l = faces.length; i < l; i ++ ) {

		var face = faces[ i ];

		for ( var j = 0; j < 3; j ++ ) {

			edge[ 0 ] = face[ keys[ j ] ];
			edge[ 1 ] = face[ keys[ ( j + 1 ) % 3 ] ];
			edge.sort( sortFunction );

			var key = edge.toString();

			if ( hash[ key ] === undefined ) {

				hash[ key ] = { vert1: edge[ 0 ], vert2: edge[ 1 ], face1: i, face2: undefined };
				numEdges ++;

			} else {

				hash[ key ].face2 = i;

			}

		}

	}

	var coords = new Float32Array( numEdges * 2 * 3 );

	var index = 0;

	for ( var key in hash ) {

		var h = hash[ key ];

		if ( h.face2 === undefined || faces[ h.face1 ].normal.dot( faces[ h.face2 ].normal ) < 0.9999 ) { // hardwired const OK

			var vertex = vertices[ h.vert1 ];
			coords[ index ++ ] = vertex.x;
			coords[ index ++ ] = vertex.y;
			coords[ index ++ ] = vertex.z;

			vertex = vertices[ h.vert2 ];
			coords[ index ++ ] = vertex.x;
			coords[ index ++ ] = vertex.y;
			coords[ index ++ ] = vertex.z;

		}

	}

	geometry.addAttribute( 'position', new THREE.BufferAttribute( coords, 3 ) );

	THREE.Line.call( this, geometry, new THREE.LineBasicMaterial( { color: color } ), THREE.LinePieces );

	this.matrix = object.matrixWorld;
	this.matrixAutoUpdate = false;

};

THREE.EdgesHelper.prototype = Object.create( THREE.Line.prototype );

// File:src/extras/helpers/FaceNormalsHelper.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author WestLangley / http://github.com/WestLangley
*/

THREE.FaceNormalsHelper = function ( object, size, hex, linewidth ) {

	this.object = object;

	this.size = ( size !== undefined ) ? size : 1;

	var color = ( hex !== undefined ) ? hex : 0xffff00;

	var width = ( linewidth !== undefined ) ? linewidth : 1;

	var geometry = new THREE.Geometry();

	var faces = this.object.geometry.faces;

	for ( var i = 0, l = faces.length; i < l; i ++ ) {

		geometry.vertices.push( new THREE.Vector3(), new THREE.Vector3() );

	}

	THREE.Line.call( this, geometry, new THREE.LineBasicMaterial( { color: color, linewidth: width } ), THREE.LinePieces );

	this.matrixAutoUpdate = false;

	this.normalMatrix = new THREE.Matrix3();

	this.update();

};

THREE.FaceNormalsHelper.prototype = Object.create( THREE.Line.prototype );

THREE.FaceNormalsHelper.prototype.update = function () {

	var vertices = this.geometry.vertices;

	var object = this.object;
	var objectVertices = object.geometry.vertices;
	var objectFaces = object.geometry.faces;
	var objectWorldMatrix = object.matrixWorld;

	object.updateMatrixWorld( true );

	this.normalMatrix.getNormalMatrix( objectWorldMatrix );

	for ( var i = 0, i2 = 0, l = objectFaces.length; i < l; i ++, i2 += 2 ) {

		var face = objectFaces[ i ];

		vertices[ i2 ].copy( objectVertices[ face.a ] )
			.add( objectVertices[ face.b ] )
			.add( objectVertices[ face.c ] )
			.divideScalar( 3 )
			.applyMatrix4( objectWorldMatrix );

		vertices[ i2 + 1 ].copy( face.normal )
			.applyMatrix3( this.normalMatrix )
			.normalize()
			.multiplyScalar( this.size )
			.add( vertices[ i2 ] );

	}

	this.geometry.verticesNeedUpdate = true;

	return this;

};


// File:src/extras/helpers/GridHelper.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.GridHelper = function ( size, step ) {

	var geometry = new THREE.Geometry();
	var material = new THREE.LineBasicMaterial( { vertexColors: THREE.VertexColors } );

	this.color1 = new THREE.Color( 0x444444 );
	this.color2 = new THREE.Color( 0x888888 );

	for ( var i = - size; i <= size; i += step ) {

		geometry.vertices.push(
			new THREE.Vector3( - size, 0, i ), new THREE.Vector3( size, 0, i ),
			new THREE.Vector3( i, 0, - size ), new THREE.Vector3( i, 0, size )
		);

		var color = i === 0 ? this.color1 : this.color2;

		geometry.colors.push( color, color, color, color );

	}

	THREE.Line.call( this, geometry, material, THREE.LinePieces );

};

THREE.GridHelper.prototype = Object.create( THREE.Line.prototype );

THREE.GridHelper.prototype.setColors = function( colorCenterLine, colorGrid ) {

	this.color1.set( colorCenterLine );
	this.color2.set( colorGrid );

	this.geometry.colorsNeedUpdate = true;

}

// File:src/extras/helpers/HemisphereLightHelper.js

/**
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 */

THREE.HemisphereLightHelper = function ( light, sphereSize, arrowLength, domeSize ) {

	THREE.Object3D.call( this );

	this.light = light;
	this.light.updateMatrixWorld();

	this.matrix = light.matrixWorld;
	this.matrixAutoUpdate = false;

	this.colors = [ new THREE.Color(), new THREE.Color() ];

	var geometry = new THREE.SphereGeometry( sphereSize, 4, 2 );
	geometry.applyMatrix( new THREE.Matrix4().makeRotationX( - Math.PI / 2 ) );

	for ( var i = 0, il = 8; i < il; i ++ ) {

		geometry.faces[ i ].color = this.colors[ i < 4 ? 0 : 1 ];

	}

	var material = new THREE.MeshBasicMaterial( { vertexColors: THREE.FaceColors, wireframe: true } );

	this.lightSphere = new THREE.Mesh( geometry, material );
	this.add( this.lightSphere );

	this.update();

};

THREE.HemisphereLightHelper.prototype = Object.create( THREE.Object3D.prototype );

THREE.HemisphereLightHelper.prototype.dispose = function () {
	this.lightSphere.geometry.dispose();
	this.lightSphere.material.dispose();
};

THREE.HemisphereLightHelper.prototype.update = function () {

	var vector = new THREE.Vector3();

	return function () {

		this.colors[ 0 ].copy( this.light.color ).multiplyScalar( this.light.intensity );
		this.colors[ 1 ].copy( this.light.groundColor ).multiplyScalar( this.light.intensity );

		this.lightSphere.lookAt( vector.setFromMatrixPosition( this.light.matrixWorld ).negate() );
		this.lightSphere.geometry.colorsNeedUpdate = true;

	}

}();

// File:src/extras/helpers/PointLightHelper.js

/**
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 */

THREE.PointLightHelper = function ( light, sphereSize ) {

	this.light = light;
	this.light.updateMatrixWorld();

	var geometry = new THREE.SphereGeometry( sphereSize, 4, 2 );
	var material = new THREE.MeshBasicMaterial( { wireframe: true, fog: false } );
	material.color.copy( this.light.color ).multiplyScalar( this.light.intensity );

	THREE.Mesh.call( this, geometry, material );

	this.matrix = this.light.matrixWorld;
	this.matrixAutoUpdate = false;

	/*
	var distanceGeometry = new THREE.IcosahedronGeometry( 1, 2 );
	var distanceMaterial = new THREE.MeshBasicMaterial( { color: hexColor, fog: false, wireframe: true, opacity: 0.1, transparent: true } );

	this.lightSphere = new THREE.Mesh( bulbGeometry, bulbMaterial );
	this.lightDistance = new THREE.Mesh( distanceGeometry, distanceMaterial );

	var d = light.distance;

	if ( d === 0.0 ) {

		this.lightDistance.visible = false;

	} else {

		this.lightDistance.scale.set( d, d, d );

	}

	this.add( this.lightDistance );
	*/

};

THREE.PointLightHelper.prototype = Object.create( THREE.Mesh.prototype );

THREE.PointLightHelper.prototype.dispose = function () {

	this.geometry.dispose();
	this.material.dispose();
};

THREE.PointLightHelper.prototype.update = function () {

	this.material.color.copy( this.light.color ).multiplyScalar( this.light.intensity );

	/*
	var d = this.light.distance;

	if ( d === 0.0 ) {

		this.lightDistance.visible = false;

	} else {

		this.lightDistance.visible = true;
		this.lightDistance.scale.set( d, d, d );

	}
	*/

};

// File:src/extras/helpers/SkeletonHelper.js

/**
 * @author Sean Griffin / http://twitter.com/sgrif
 * @author Michael Guerrero / http://realitymeltdown.com
 * @author mrdoob / http://mrdoob.com/
 * @author ikerr / http://verold.com
 */

THREE.SkeletonHelper = function ( object ) {

	this.bones = this.getBoneList( object );

	var geometry = new THREE.Geometry();

	for ( var i = 0; i < this.bones.length; i ++ ) {

		var bone = this.bones[ i ];

		if ( bone.parent instanceof THREE.Bone ) {

			geometry.vertices.push( new THREE.Vector3() );
			geometry.vertices.push( new THREE.Vector3() );
			geometry.colors.push( new THREE.Color( 0, 0, 1 ) );
			geometry.colors.push( new THREE.Color( 0, 1, 0 ) );

		}

	}

	var material = new THREE.LineBasicMaterial( { vertexColors: THREE.VertexColors, depthTest: false, depthWrite: false, transparent: true } );

	THREE.Line.call( this, geometry, material, THREE.LinePieces );

	this.root = object;

	this.matrix = object.matrixWorld;
	this.matrixAutoUpdate = false;

	this.update();

};


THREE.SkeletonHelper.prototype = Object.create( THREE.Line.prototype );

THREE.SkeletonHelper.prototype.getBoneList = function( object ) {

	var boneList = [];

	if ( object instanceof THREE.Bone ) {

		boneList.push( object );

	}

	for ( var i = 0; i < object.children.length; i ++ ) {

		boneList.push.apply( boneList, this.getBoneList( object.children[ i ] ) );

	}

	return boneList;

};

THREE.SkeletonHelper.prototype.update = function () {

	var geometry = this.geometry;

	var matrixWorldInv = new THREE.Matrix4().getInverse( this.root.matrixWorld );

	var boneMatrix = new THREE.Matrix4();

	var j = 0;

	for ( var i = 0; i < this.bones.length; i ++ ) {

		var bone = this.bones[ i ];

		if ( bone.parent instanceof THREE.Bone ) {

			boneMatrix.multiplyMatrices( matrixWorldInv, bone.matrixWorld );
			geometry.vertices[ j ].setFromMatrixPosition( boneMatrix );

			boneMatrix.multiplyMatrices( matrixWorldInv, bone.parent.matrixWorld );
			geometry.vertices[ j + 1 ].setFromMatrixPosition( boneMatrix );

			j += 2;

		}

	}

	geometry.verticesNeedUpdate = true;

	geometry.computeBoundingSphere();

};

// File:src/extras/helpers/SpotLightHelper.js

/**
 * @author alteredq / http://alteredqualia.com/
 * @author mrdoob / http://mrdoob.com/
 * @author WestLangley / http://github.com/WestLangley
*/

THREE.SpotLightHelper = function ( light ) {

	THREE.Object3D.call( this );

	this.light = light;
	this.light.updateMatrixWorld();

	this.matrix = light.matrixWorld;
	this.matrixAutoUpdate = false;

	var geometry = new THREE.CylinderGeometry( 0, 1, 1, 8, 1, true );

	geometry.applyMatrix( new THREE.Matrix4().makeTranslation( 0, - 0.5, 0 ) );
	geometry.applyMatrix( new THREE.Matrix4().makeRotationX( - Math.PI / 2 ) );

	var material = new THREE.MeshBasicMaterial( { wireframe: true, fog: false } );

	this.cone = new THREE.Mesh( geometry, material );
	this.add( this.cone );

	this.update();

};

THREE.SpotLightHelper.prototype = Object.create( THREE.Object3D.prototype );

THREE.SpotLightHelper.prototype.dispose = function () {
	this.cone.geometry.dispose();
	this.cone.material.dispose();
};

THREE.SpotLightHelper.prototype.update = function () {

	var vector = new THREE.Vector3();
	var vector2 = new THREE.Vector3();

	return function () {

		var coneLength = this.light.distance ? this.light.distance : 10000;
		var coneWidth = coneLength * Math.tan( this.light.angle );

		this.cone.scale.set( coneWidth, coneWidth, coneLength );

		vector.setFromMatrixPosition( this.light.matrixWorld );
		vector2.setFromMatrixPosition( this.light.target.matrixWorld );

		this.cone.lookAt( vector2.sub( vector ) );

		this.cone.material.color.copy( this.light.color ).multiplyScalar( this.light.intensity );

	};

}();

// File:src/extras/helpers/VertexNormalsHelper.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author WestLangley / http://github.com/WestLangley
*/

THREE.VertexNormalsHelper = function ( object, size, hex, linewidth ) {

	this.object = object;

	this.size = ( size !== undefined ) ? size : 1;

	var color = ( hex !== undefined ) ? hex : 0xff0000;

	var width = ( linewidth !== undefined ) ? linewidth : 1;

	var geometry = new THREE.Geometry();

	var vertices = object.geometry.vertices;

	var faces = object.geometry.faces;

	for ( var i = 0, l = faces.length; i < l; i ++ ) {

		var face = faces[ i ];

		for ( var j = 0, jl = face.vertexNormals.length; j < jl; j ++ ) {

			geometry.vertices.push( new THREE.Vector3(), new THREE.Vector3() );

		}

	}

	THREE.Line.call( this, geometry, new THREE.LineBasicMaterial( { color: color, linewidth: width } ), THREE.LinePieces );

	this.matrixAutoUpdate = false;

	this.normalMatrix = new THREE.Matrix3();

	this.update();

};

THREE.VertexNormalsHelper.prototype = Object.create( THREE.Line.prototype );

THREE.VertexNormalsHelper.prototype.update = ( function ( object ) {

	var v1 = new THREE.Vector3();

	return function( object ) {

		var keys = [ 'a', 'b', 'c', 'd' ];

		this.object.updateMatrixWorld( true );

		this.normalMatrix.getNormalMatrix( this.object.matrixWorld );

		var vertices = this.geometry.vertices;

		var verts = this.object.geometry.vertices;

		var faces = this.object.geometry.faces;

		var worldMatrix = this.object.matrixWorld;

		var idx = 0;

		for ( var i = 0, l = faces.length; i < l; i ++ ) {

			var face = faces[ i ];

			for ( var j = 0, jl = face.vertexNormals.length; j < jl; j ++ ) {

				var vertexId = face[ keys[ j ] ];
				var vertex = verts[ vertexId ];

				var normal = face.vertexNormals[ j ];

				vertices[ idx ].copy( vertex ).applyMatrix4( worldMatrix );

				v1.copy( normal ).applyMatrix3( this.normalMatrix ).normalize().multiplyScalar( this.size );

				v1.add( vertices[ idx ] );
				idx = idx + 1;

				vertices[ idx ].copy( v1 );
				idx = idx + 1;

			}

		}

		this.geometry.verticesNeedUpdate = true;

		return this;

	}

}());

// File:src/extras/helpers/VertexTangentsHelper.js

/**
 * @author mrdoob / http://mrdoob.com/
 * @author WestLangley / http://github.com/WestLangley
*/

THREE.VertexTangentsHelper = function ( object, size, hex, linewidth ) {

	this.object = object;

	this.size = ( size !== undefined ) ? size : 1;

	var color = ( hex !== undefined ) ? hex : 0x0000ff;

	var width = ( linewidth !== undefined ) ? linewidth : 1;

	var geometry = new THREE.Geometry();

	var vertices = object.geometry.vertices;

	var faces = object.geometry.faces;

	for ( var i = 0, l = faces.length; i < l; i ++ ) {

		var face = faces[ i ];

		for ( var j = 0, jl = face.vertexTangents.length; j < jl; j ++ ) {

			geometry.vertices.push( new THREE.Vector3() );
			geometry.vertices.push( new THREE.Vector3() );

		}

	}

	THREE.Line.call( this, geometry, new THREE.LineBasicMaterial( { color: color, linewidth: width } ), THREE.LinePieces );

	this.matrixAutoUpdate = false;

	this.update();

};

THREE.VertexTangentsHelper.prototype = Object.create( THREE.Line.prototype );

THREE.VertexTangentsHelper.prototype.update = ( function ( object ) {

	var v1 = new THREE.Vector3();

	return function( object ) {

		var keys = [ 'a', 'b', 'c', 'd' ];

		this.object.updateMatrixWorld( true );

		var vertices = this.geometry.vertices;

		var verts = this.object.geometry.vertices;

		var faces = this.object.geometry.faces;

		var worldMatrix = this.object.matrixWorld;

		var idx = 0;

		for ( var i = 0, l = faces.length; i < l; i ++ ) {

			var face = faces[ i ];

			for ( var j = 0, jl = face.vertexTangents.length; j < jl; j ++ ) {

				var vertexId = face[ keys[ j ] ];
				var vertex = verts[ vertexId ];

				var tangent = face.vertexTangents[ j ];

				vertices[ idx ].copy( vertex ).applyMatrix4( worldMatrix );

				v1.copy( tangent ).transformDirection( worldMatrix ).multiplyScalar( this.size );

				v1.add( vertices[ idx ] );
				idx = idx + 1;

				vertices[ idx ].copy( v1 );
				idx = idx + 1;

			}

		}

		this.geometry.verticesNeedUpdate = true;

		return this;

	}

}());

// File:src/extras/helpers/WireframeHelper.js

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.WireframeHelper = function ( object, hex ) {

	var color = ( hex !== undefined ) ? hex : 0xffffff;

	var edge = [ 0, 0 ], hash = {};
	var sortFunction = function ( a, b ) { return a - b };

	var keys = [ 'a', 'b', 'c' ];
	var geometry = new THREE.BufferGeometry();

	if ( object.geometry instanceof THREE.Geometry ) {

		var vertices = object.geometry.vertices;
		var faces = object.geometry.faces;
		var numEdges = 0;

		// allocate maximal size
		var edges = new Uint32Array( 6 * faces.length );

		for ( var i = 0, l = faces.length; i < l; i ++ ) {

			var face = faces[ i ];

			for ( var j = 0; j < 3; j ++ ) {

				edge[ 0 ] = face[ keys[ j ] ];
				edge[ 1 ] = face[ keys[ ( j + 1 ) % 3 ] ];
				edge.sort( sortFunction );

				var key = edge.toString();

				if ( hash[ key ] === undefined ) {

					edges[ 2 * numEdges ] = edge[ 0 ];
					edges[ 2 * numEdges + 1 ] = edge[ 1 ];
					hash[ key ] = true;
					numEdges ++;

				}

			}

		}

		var coords = new Float32Array( numEdges * 2 * 3 );

		for ( var i = 0, l = numEdges; i < l; i ++ ) {

			for ( var j = 0; j < 2; j ++ ) {

				var vertex = vertices[ edges [ 2 * i + j] ];

				var index = 6 * i + 3 * j;
				coords[ index + 0 ] = vertex.x;
				coords[ index + 1 ] = vertex.y;
				coords[ index + 2 ] = vertex.z;

			}

		}

		geometry.addAttribute( 'position', new THREE.BufferAttribute( coords, 3 ) );

	} else if ( object.geometry instanceof THREE.BufferGeometry ) {

		if ( object.geometry.attributes.index !== undefined ) { // Indexed BufferGeometry

			var vertices = object.geometry.attributes.position.array;
			var indices = object.geometry.attributes.index.array;
			var drawcalls = object.geometry.drawcalls;
			var numEdges = 0;

			if ( drawcalls.length === 0 ) {

				drawcalls = [ { count : indices.length, index : 0, start : 0 } ];

			}

			// allocate maximal size
			var edges = new Uint32Array( 2 * indices.length );

			for ( var o = 0, ol = drawcalls.length; o < ol; ++ o ) {

				var start = drawcalls[ o ].start;
				var count = drawcalls[ o ].count;
				var index = drawcalls[ o ].index;

				for ( var i = start, il = start + count; i < il; i += 3 ) {

					for ( var j = 0; j < 3; j ++ ) {

						edge[ 0 ] = index + indices[ i + j ];
						edge[ 1 ] = index + indices[ i + ( j + 1 ) % 3 ];
						edge.sort( sortFunction );

						var key = edge.toString();

						if ( hash[ key ] === undefined ) {

							edges[ 2 * numEdges ] = edge[ 0 ];
							edges[ 2 * numEdges + 1 ] = edge[ 1 ];
							hash[ key ] = true;
							numEdges ++;

						}

					}

				}

			}

			var coords = new Float32Array( numEdges * 2 * 3 );

			for ( var i = 0, l = numEdges; i < l; i ++ ) {

				for ( var j = 0; j < 2; j ++ ) {

					var index = 6 * i + 3 * j;
					var index2 = 3 * edges[ 2 * i + j];
					coords[ index + 0 ] = vertices[ index2 ];
					coords[ index + 1 ] = vertices[ index2 + 1 ];
					coords[ index + 2 ] = vertices[ index2 + 2 ];

				}

			}

			geometry.addAttribute( 'position', new THREE.BufferAttribute( coords, 3 ) );

		} else { // non-indexed BufferGeometry

			var vertices = object.geometry.attributes.position.array;
			var numEdges = vertices.length / 3;
			var numTris = numEdges / 3;

			var coords = new Float32Array( numEdges * 2 * 3 );

			for ( var i = 0, l = numTris; i < l; i ++ ) {

				for ( var j = 0; j < 3; j ++ ) {

					var index = 18 * i + 6 * j;

					var index1 = 9 * i + 3 * j;
					coords[ index + 0 ] = vertices[ index1 ];
					coords[ index + 1 ] = vertices[ index1 + 1 ];
					coords[ index + 2 ] = vertices[ index1 + 2 ];

					var index2 = 9 * i + 3 * ( ( j + 1 ) % 3 );
					coords[ index + 3 ] = vertices[ index2 ];
					coords[ index + 4 ] = vertices[ index2 + 1 ];
					coords[ index + 5 ] = vertices[ index2 + 2 ];

				}

			}

			geometry.addAttribute( 'position', new THREE.BufferAttribute( coords, 3 ) );

		}

	}

	THREE.Line.call( this, geometry, new THREE.LineBasicMaterial( { color: color } ), THREE.LinePieces );

	this.matrix = object.matrixWorld;
	this.matrixAutoUpdate = false;

};

THREE.WireframeHelper.prototype = Object.create( THREE.Line.prototype );

// File:src/extras/objects/ImmediateRenderObject.js

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.ImmediateRenderObject = function () {

	THREE.Object3D.call( this );

	this.render = function ( renderCallback ) {};

};

THREE.ImmediateRenderObject.prototype = Object.create( THREE.Object3D.prototype );

// File:src/extras/objects/MorphBlendMesh.js

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.MorphBlendMesh = function( geometry, material ) {

	THREE.Mesh.call( this, geometry, material );

	this.animationsMap = {};
	this.animationsList = [];

	// prepare default animation
	// (all frames played together in 1 second)

	var numFrames = this.geometry.morphTargets.length;

	var name = "__default";

	var startFrame = 0;
	var endFrame = numFrames - 1;

	var fps = numFrames / 1;

	this.createAnimation( name, startFrame, endFrame, fps );
	this.setAnimationWeight( name, 1 );

};

THREE.MorphBlendMesh.prototype = Object.create( THREE.Mesh.prototype );

THREE.MorphBlendMesh.prototype.createAnimation = function ( name, start, end, fps ) {

	var animation = {

		startFrame: start,
		endFrame: end,

		length: end - start + 1,

		fps: fps,
		duration: ( end - start ) / fps,

		lastFrame: 0,
		currentFrame: 0,

		active: false,

		time: 0,
		direction: 1,
		weight: 1,

		directionBackwards: false,
		mirroredLoop: false

	};

	this.animationsMap[ name ] = animation;
	this.animationsList.push( animation );

};

THREE.MorphBlendMesh.prototype.autoCreateAnimations = function ( fps ) {

	var pattern = /([a-z]+)_?(\d+)/;

	var firstAnimation, frameRanges = {};

	var geometry = this.geometry;

	for ( var i = 0, il = geometry.morphTargets.length; i < il; i ++ ) {

		var morph = geometry.morphTargets[ i ];
		var chunks = morph.name.match( pattern );

		if ( chunks && chunks.length > 1 ) {

			var name = chunks[ 1 ];
			var num = chunks[ 2 ];

			if ( ! frameRanges[ name ] ) frameRanges[ name ] = { start: Infinity, end: - Infinity };

			var range = frameRanges[ name ];

			if ( i < range.start ) range.start = i;
			if ( i > range.end ) range.end = i;

			if ( ! firstAnimation ) firstAnimation = name;

		}

	}

	for ( var name in frameRanges ) {

		var range = frameRanges[ name ];
		this.createAnimation( name, range.start, range.end, fps );

	}

	this.firstAnimation = firstAnimation;

};

THREE.MorphBlendMesh.prototype.setAnimationDirectionForward = function ( name ) {

	var animation = this.animationsMap[ name ];

	if ( animation ) {

		animation.direction = 1;
		animation.directionBackwards = false;

	}

};

THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward = function ( name ) {

	var animation = this.animationsMap[ name ];

	if ( animation ) {

		animation.direction = - 1;
		animation.directionBackwards = true;

	}

};

THREE.MorphBlendMesh.prototype.setAnimationFPS = function ( name, fps ) {

	var animation = this.animationsMap[ name ];

	if ( animation ) {

		animation.fps = fps;
		animation.duration = ( animation.end - animation.start ) / animation.fps;

	}

};

THREE.MorphBlendMesh.prototype.setAnimationDuration = function ( name, duration ) {

	var animation = this.animationsMap[ name ];

	if ( animation ) {

		animation.duration = duration;
		animation.fps = ( animation.end - animation.start ) / animation.duration;

	}

};

THREE.MorphBlendMesh.prototype.setAnimationWeight = function ( name, weight ) {

	var animation = this.animationsMap[ name ];

	if ( animation ) {

		animation.weight = weight;

	}

};

THREE.MorphBlendMesh.prototype.setAnimationTime = function ( name, time ) {

	var animation = this.animationsMap[ name ];

	if ( animation ) {

		animation.time = time;

	}

};

THREE.MorphBlendMesh.prototype.getAnimationTime = function ( name ) {

	var time = 0;

	var animation = this.animationsMap[ name ];

	if ( animation ) {

		time = animation.time;

	}

	return time;

};

THREE.MorphBlendMesh.prototype.getAnimationDuration = function ( name ) {

	var duration = - 1;

	var animation = this.animationsMap[ name ];

	if ( animation ) {

		duration = animation.duration;

	}

	return duration;

};

THREE.MorphBlendMesh.prototype.playAnimation = function ( name ) {

	var animation = this.animationsMap[ name ];

	if ( animation ) {

		animation.time = 0;
		animation.active = true;

	} else {

		console.warn( "animation[" + name + "] undefined" );

	}

};

THREE.MorphBlendMesh.prototype.stopAnimation = function ( name ) {

	var animation = this.animationsMap[ name ];

	if ( animation ) {

		animation.active = false;

	}

};

THREE.MorphBlendMesh.prototype.update = function ( delta ) {

	for ( var i = 0, il = this.animationsList.length; i < il; i ++ ) {

		var animation = this.animationsList[ i ];

		if ( ! animation.active ) continue;

		var frameTime = animation.duration / animation.length;

		animation.time += animation.direction * delta;

		if ( animation.mirroredLoop ) {

			if ( animation.time > animation.duration || animation.time < 0 ) {

				animation.direction *= - 1;

				if ( animation.time > animation.duration ) {

					animation.time = animation.duration;
					animation.directionBackwards = true;

				}

				if ( animation.time < 0 ) {

					animation.time = 0;
					animation.directionBackwards = false;

				}

			}

		} else {

			animation.time = animation.time % animation.duration;

			if ( animation.time < 0 ) animation.time += animation.duration;

		}

		var keyframe = animation.startFrame + THREE.Math.clamp( Math.floor( animation.time / frameTime ), 0, animation.length - 1 );
		var weight = animation.weight;

		if ( keyframe !== animation.currentFrame ) {

			this.morphTargetInfluences[ animation.lastFrame ] = 0;
			this.morphTargetInfluences[ animation.currentFrame ] = 1 * weight;

			this.morphTargetInfluences[ keyframe ] = 0;

			animation.lastFrame = animation.currentFrame;
			animation.currentFrame = keyframe;

		}

		var mix = ( animation.time % frameTime ) / frameTime;

		if ( animation.directionBackwards ) mix = 1 - mix;

		this.morphTargetInfluences[ animation.currentFrame ] = mix * weight;
		this.morphTargetInfluences[ animation.lastFrame ] = ( 1 - mix ) * weight;

	}

};


/* JSModeler 0.32.183 - http://www.github.com/kovacsv/JSModeler */ 'use strict';var JSM={mainVersion:0,subVersion:32,Eps:1E-8,Inf:9999999999,RadDeg:57.29577951308232,DegRad:0.017453292519943,IsZero:function(a){return Math.abs(a)<JSM.Eps},IsPositive:function(a){return a>JSM.Eps},IsNegative:function(a){return a<-JSM.Eps},IsLower:function(a,b){return b-a>JSM.Eps},IsGreater:function(a,b){return a-b>JSM.Eps},IsEqual:function(a,b){return Math.abs(b-a)<JSM.Eps},IsEqualWithEps:function(a,b,c){return Math.abs(b-a)<c},IsLowerOrEqual:function(a,b){return JSM.IsLower(a,b)||
JSM.IsEqual(a,b)},IsGreaterOrEqual:function(a,b){return JSM.IsGreater(a,b)||JSM.IsEqual(a,b)},Minimum:function(a,b){return JSM.IsLower(a,b)?a:b},Maximum:function(a,b){return JSM.IsGreater(a,b)?a:b},ArcSin:function(a){return JSM.IsGreaterOrEqual(a,1)?Math.PI/2:JSM.IsLowerOrEqual(a,-1)?-Math.PI/2:Math.asin(a)},ArcCos:function(a){return JSM.IsGreaterOrEqual(a,1)?0:JSM.IsLowerOrEqual(a,-1)?Math.PI:Math.acos(a)},RandomNumber:function(a,b){return Math.random()*(b-a)+a},RandomInt:function(a,b){return Math.floor(Math.random()*
(b-a+1)+a)},SeededRandomInt:function(a,b,c){return Math.floor((9301*c+49297)%233280/233280*(b-a+1)+a)},ValueOrDefault:function(a,b){return void 0===a||null===a?b:a},Assert:function(a,b){if(!a){var c="Assertion failed.";void 0!==b&&null!==b&&(c+=" "+b);alert(c)}},Timer:function(){this.stop=this.start=0}};JSM.Timer.prototype.Start=function(){this.start=(new Date).getTime()};JSM.Timer.prototype.Stop=function(){this.end=(new Date).getTime()};JSM.Timer.prototype.Result=function(){return this.end-this.start};
JSM.FPSCounter=function(){this.current=this.frames=this.start=null};JSM.FPSCounter.prototype.Get=function(a){var b=(new Date).getTime();null===this.start&&(this.start=b,this.current=this.frames=0);if(null===a||void 0===a)a=1E3;this.frames+=1;var c=b-this.start;c>=a&&(this.current=1E3*(this.frames/c),this.start=b,this.frames=0);return parseInt(this.current,10)};
JSM.BubbleSort=function(a,b){if(!(2>a.length||void 0===b||null===b)){var c,d;for(c=0;c<a.length-1;c++)for(d=0;d<a.length-c-1;d++)if(!b(a[d],a[d+1])){var e=a,f=d+1,g=e[d];e[d]=e[f];e[f]=g}}};JSM.AsyncEnvironment=function(a){this.parameters=a};JSM.AsyncEnvironment.prototype.OnStart=function(a,b){if(void 0!==this.parameters&&void 0!==this.parameters.onStart)this.parameters.onStart(a,b)};
JSM.AsyncEnvironment.prototype.OnProcess=function(a,b){if(void 0!==this.parameters&&void 0!==this.parameters.onProcess)this.parameters.onProcess(a,b)};JSM.AsyncEnvironment.prototype.OnFinish=function(a){if(void 0!==this.parameters&&void 0!==this.parameters.onFinish)this.parameters.onFinish(a)};
JSM.AsyncRunTask=function(a,b,c,d,e){function f(g){var h=a();b.OnProcess(g,e);h&&g<c-1?setTimeout(function(){f(g+1)},d):setTimeout(function(){b.OnFinish(e)},d)}if(void 0===b||null===b){var g,h;for(g=0;g<c&&!(h=a(),!h);g++);}else b.OnStart(c,e),f(0)};JSM.Coord2D=function(a,b){this.x=a;this.y=b};JSM.Coord2D.prototype.Set=function(a,b){this.x=a;this.y=b};JSM.Coord2D.prototype.ToString=function(){return"("+this.x+", "+this.y+")"};JSM.Coord2D.prototype.Clone=function(){return new JSM.Coord2D(this.x,this.y)};
JSM.PolarCoord=function(a,b){this.radius=a;this.angle=b};JSM.PolarCoord.prototype.Set=function(a,b){this.radius=a;this.angle=b};JSM.PolarCoord.prototype.ToString=function(){return"("+this.radius+", "+this.angle+")"};JSM.PolarCoord.prototype.Clone=function(){return new JSM.PolarCoord(this.radius,this.angle)};JSM.Coord=function(a,b,c){this.x=a;this.y=b;this.z=c};JSM.Coord.prototype.Set=function(a,b,c){this.x=a;this.y=b;this.z=c};
JSM.Coord.prototype.ToString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};JSM.Coord.prototype.Clone=function(){return new JSM.Coord(this.x,this.y,this.z)};JSM.SphericalCoord=function(a,b,c){this.radius=a;this.theta=b;this.phi=c};JSM.SphericalCoord.prototype.Set=function(a,b,c){this.radius=a;this.theta=b;this.phi=c};JSM.SphericalCoord.prototype.ToString=function(){return"("+this.radius+", "+this.theta+", "+this.phi+")"};
JSM.SphericalCoord.prototype.Clone=function(){return new JSM.SphericalCoord(this.radius,this.theta,this.phi)};JSM.Vector2D=JSM.Coord2D;JSM.Vector=JSM.Coord;JSM.MatrixDeterminant2x2=function(a,b,c,d){return a*d-b*c};JSM.MatrixDeterminant3x3=function(a,b,c,d,e,f,g,h,l){var k=JSM.MatrixDeterminant2x2(e,f,h,l);f=JSM.MatrixDeterminant2x2(d,f,g,l);d=JSM.MatrixDeterminant2x2(d,e,g,h);return a*k-b*f+c*d};
JSM.MatrixDeterminant4x4=function(a,b,c,d,e,f,g,h,l,k,m,n,p,q,r,s){var x=JSM.MatrixDeterminant3x3(f,g,h,k,m,n,q,r,s),v=JSM.MatrixDeterminant3x3(e,g,h,l,m,n,p,r,s);h=JSM.MatrixDeterminant3x3(e,f,h,l,k,n,p,q,s);e=JSM.MatrixDeterminant3x3(e,f,g,l,k,m,p,q,r);return x*a-v*b+h*c-e*d};JSM.CoordFromArray2D=function(a){return new JSM.Coord2D(a[0],a[1])};JSM.CoordFromArray=function(a){return new JSM.Coord(a[0],a[1],a[2])};JSM.CoordIsEqual2D=function(a,b){return JSM.IsEqual(a.x,b.x)&&JSM.IsEqual(a.y,b.y)};
JSM.CoordIsEqual2DWithEps=function(a,b,c){return JSM.IsEqualWithEps(a.x,b.x,c)&&JSM.IsEqualWithEps(a.y,b.y,c)};JSM.CoordDistance2D=function(a,b){var c=a.x,d=a.y,e=b.x,f=b.y;return Math.sqrt((e-c)*(e-c)+(f-d)*(f-d))};JSM.MidCoord2D=function(a,b){return new JSM.Coord2D((a.x+b.x)/2,(a.y+b.y)/2)};JSM.PolarToCartesian=function(a,b){var c=new JSM.Coord2D(0,0);c.x=a*Math.cos(b);c.y=a*Math.sin(b);return c};JSM.GetArcLengthFromAngle=function(a,b){return b*a};
JSM.GetAngleFromArcLength=function(a,b){return JSM.IsEqual(a,0)?0:b/a};JSM.CoordTurnType2D=function(a,b,c){a=JSM.MatrixDeterminant3x3(a.x,a.y,1,b.x,b.y,1,c.x,c.y,1);return JSM.IsPositive(a)?"CounterClockwise":JSM.IsNegative(a)?"Clockwise":"Collinear"};JSM.CoordIsEqual=function(a,b){return JSM.IsEqual(a.x,b.x)&&JSM.IsEqual(a.y,b.y)&&JSM.IsEqual(a.z,b.z)};JSM.CoordIsEqualWithEps=function(a,b,c){return JSM.IsEqualWithEps(a.x,b.x,c)&&JSM.IsEqualWithEps(a.y,b.y,c)&&JSM.IsEqualWithEps(a.z,b.z,c)};
JSM.SphericalCoordIsEqual=function(a,b){return JSM.IsEqual(a.radius,b.radius)&&JSM.IsEqual(a.phi,b.phi)&&JSM.IsEqual(a.theta,b.theta)};JSM.CoordDistance=function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;return Math.sqrt((f-c)*(f-c)+(g-d)*(g-d)+(h-e)*(h-e))};JSM.CoordSignedDistance=function(a,b,c){var d=JSM.CoordSub(b,a);a=JSM.CoordDistance(a,b);c=JSM.GetVectorsAngle(d,c);JSM.IsPositive(c)&&(a=-a);return a};JSM.MidCoord=function(a,b){return new JSM.Coord((a.x+b.x)/2,(a.y+b.y)/2,(a.z+b.z)/2)};
JSM.VectorMultiply=function(a,b){var c=new JSM.Vector(0,0,0);c.x=a.x*b;c.y=a.y*b;c.z=a.z*b;return c};JSM.VectorDot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};JSM.VectorCross=function(a,b){var c=new JSM.Vector(0,0,0);c.x=a.y*b.z-a.z*b.y;c.y=a.z*b.x-a.x*b.z;c.z=a.x*b.y-a.y*b.x;return c};JSM.VectorLength=function(a){var b=a.x,c=a.y;a=a.z;return Math.sqrt(b*b+c*c+a*a)};
JSM.VectorNormalize=function(a){var b=JSM.VectorLength(a),c=new JSM.Vector(0,0,0);JSM.IsGreater(b,0)&&(c=JSM.VectorMultiply(a,1/b));return c};JSM.VectorSetLength=function(a,b){var c=b/JSM.VectorLength(a);return JSM.VectorMultiply(a,c)};JSM.GetVectorsAngle=function(a,b){var c=JSM.VectorNormalize(a),d=JSM.VectorNormalize(b);if(JSM.CoordIsEqual(c,d))return 0;c=JSM.VectorDot(c,d);return JSM.ArcCos(c)};
JSM.GetVectorsFullAngle=function(a,b,c){var d=JSM.GetVectorsAngle(a,b),e=new JSM.Coord(0,0,0);"Clockwise"==JSM.CoordTurnType(a,e,b,c)&&(d=2*Math.PI-d);return d};JSM.VectorsAreCollinear=function(a,b){var c=JSM.GetVectorsAngle(a,b);return JSM.IsEqual(c,0)||JSM.IsEqual(c,Math.PI)};JSM.CoordAdd=function(a,b){return new JSM.Vector(a.x+b.x,a.y+b.y,a.z+b.z)};JSM.CoordSub=function(a,b){return new JSM.Vector(a.x-b.x,a.y-b.y,a.z-b.z)};
JSM.CoordOffset=function(a,b,c){b=JSM.VectorNormalize(b);var d=new JSM.Coord(0,0,0);d.x=a.x+b.x*c;d.y=a.y+b.y*c;d.z=a.z+b.z*c;return d};
JSM.CoordRotate=function(a,b,c,d){var e=JSM.CoordSub(a,d),f=JSM.VectorNormalize(b);b=f.x;a=f.y;var f=f.z,g=e.x,h=e.y,e=e.z,l=new JSM.Coord(0,0,0);l.x=-b*(-b*g-a*h-f*e)*(1-Math.cos(c))+g*Math.cos(c)+(-f*h+a*e)*Math.sin(c);l.y=-a*(-b*g-a*h-f*e)*(1-Math.cos(c))+h*Math.cos(c)+(f*g-b*e)*Math.sin(c);l.z=-f*(-b*g-a*h-f*e)*(1-Math.cos(c))+e*Math.cos(c)+(-a*g+b*h)*Math.sin(c);return l=JSM.CoordAdd(l,d)};
JSM.GetCoord2DFromCoord=function(a,b,c){var d=new JSM.Vector(0,0,1),e=JSM.VectorCross(c,d);c=JSM.GetVectorsAngle(c,d);a=JSM.CoordRotate(a,e,c,b);return new JSM.Coord2D(a.x,a.y)};
JSM.CoordTurnType=function(a,b,c,d){var e=new JSM.Coord(0,0,0);a=JSM.GetCoord2DFromCoord(a,e,d);b=JSM.GetCoord2DFromCoord(b,e,d);c=JSM.GetCoord2DFromCoord(c,e,d);c=JSM.CoordTurnType2D(a,b,c);e=new JSM.Vector(0,0,1);d=JSM.GetVectorsAngle(d,e);JSM.IsEqual(d,Math.PI)&&("CounterClockwise"===c?c="Clockwise":"Clockwise"===c&&(c="CounterClockwise"));return c};
JSM.CalculateCentroid=function(a){var b=a.length,c=new JSM.Coord(0,0,0);if(1<=b){var d;for(d=0;d<b;d++)c=JSM.CoordAdd(c,a[d]);c=JSM.VectorMultiply(c,1/b)}return c};JSM.CalculateTriangleNormal=function(a,b,c){b=JSM.CoordSub(b,a);a=JSM.CoordSub(c,a);c=new JSM.Vector(0,0,0);c.x=b.y*a.z-b.z*a.y;c.y=b.z*a.x-b.x*a.z;c.z=b.x*a.y-b.y*a.x;return JSM.VectorNormalize(c)};
JSM.CalculateNormal=function(a){var b=a.length,c=new JSM.Vector(0,0,0);if(3<=b){var d,e,f;for(d=0;d<b;d++)e=d%b,f=(d+1)%b,e=a[e],f=a[f],c.x+=(e.y-f.y)*(e.z+f.z),c.y+=(e.z-f.z)*(e.x+f.x),c.z+=(e.x-f.x)*(e.y+f.y)}return JSM.VectorNormalize(c)};JSM.SphericalToCartesian=function(a,b,c){var d=new JSM.Coord(0,0,0);d.x=a*Math.sin(b)*Math.cos(c);d.y=a*Math.sin(b)*Math.sin(c);d.z=a*Math.cos(b);return d};
JSM.CartesianToSpherical=function(a,b,c){var d=new JSM.SphericalCoord(0,0,0);d.radius=Math.sqrt(a*a+b*b+c*c);if(JSM.IsZero(d.radius))return d;d.theta=Math.acos(c/d.radius);d.phi=Math.atan2(b,a);return d};JSM.SphericalToCartesianWithOrigo=function(a,b){var c=JSM.SphericalToCartesian(a.radius,a.theta,a.phi);return JSM.CoordAdd(c,b)};JSM.CartesianToSphericalWithOrigo=function(a,b){var c=JSM.CoordSub(a,b);return JSM.CartesianToSpherical(c.x,c.y,c.z)};
JSM.MoveCoordOnSphere=function(a,b,c,d){a=JSM.CartesianToSphericalWithOrigo(a,b);a.theta+=c;a.phi+=d;return JSM.SphericalToCartesianWithOrigo(a,b)};JSM.CylindricalToCartesian=function(a,b,c){var d=new JSM.Coord(0,0,0);d.x=a*Math.cos(c);d.y=a*Math.sin(c);d.z=b;return d};JSM.GetArcLength=function(a,b,c){return JSM.GetVectorsAngle(a,b)*c};JSM.GetFullArcLength=function(a,b,c,d){return JSM.GetVectorsFullAngle(a,b,d)*c};JSM.MatrixIdentity=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};
JSM.MatrixClone=function(a){var b=[];b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};JSM.MatrixTranspose=function(a){var b=[];b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b};
JSM.MatrixVectorMultiply=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=a[1],h=a[2],l=a[3],k=a[5],m=a[6],n=a[7],p=a[9],q=a[10],r=a[11],s=a[13],x=a[14],v=a[15],t=[];t[0]=c*a[0]+d*a[4]+e*a[8]+f*a[12];t[1]=c*g+d*k+e*p+f*s;t[2]=c*h+d*m+e*q+f*x;t[3]=c*l+d*n+e*r+f*v;return t};
JSM.MatrixMultiply=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],l=a[6],k=a[7],m=a[8],n=a[9],p=a[10],q=a[11],r=a[12],s=a[13],x=a[14],v=a[15],t=b[0],y=b[1],F=b[2],C=b[3],u=b[4],H=b[5],z=b[6],I=b[7],J=b[8],D=b[9],A=b[10],B=b[11],K=b[12],L=b[13],M=b[14],w=b[15],G=[];G[0]=c*t+d*u+e*J+f*K;G[1]=c*y+d*H+e*D+f*L;G[2]=c*F+d*z+e*A+f*M;G[3]=c*C+d*I+e*B+f*w;G[4]=g*t+h*u+l*J+k*K;G[5]=g*y+h*H+l*D+k*L;G[6]=g*F+h*z+l*A+k*M;G[7]=g*C+h*I+l*B+k*w;G[8]=m*t+n*u+p*J+q*K;G[9]=m*y+n*H+p*D+q*L;G[10]=m*F+n*z+
p*A+q*M;G[11]=m*C+n*I+p*B+q*w;G[12]=r*t+s*u+x*J+v*K;G[13]=r*y+s*H+x*D+v*L;G[14]=r*F+s*z+x*A+v*M;G[15]=r*C+s*I+x*B+v*w;return G};JSM.MatrixDeterminant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],l=a[7],k=a[8],m=a[9],n=a[10],p=a[11],q=a[12],r=a[13],s=a[14];a=a[15];return(b*g-c*f)*(n*a-p*s)-(b*h-d*f)*(m*a-p*r)+(b*l-e*f)*(m*s-n*r)+(c*h-d*g)*(k*a-p*q)-(c*l-e*g)*(k*s-n*q)+(d*l-e*h)*(k*r-m*q)};
JSM.MatrixInvert=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],l=a[7],k=a[8],m=a[9],n=a[10],p=a[11],q=a[12],r=a[13],s=a[14];a=a[15];var x=b*g-c*f,v=b*h-d*f,t=b*l-e*f,y=c*h-d*g,F=c*l-e*g,C=d*l-e*h,u=k*r-m*q,H=k*s-n*q,z=k*a-p*q,I=m*s-n*r,J=m*a-p*r,D=n*a-p*s,A=x*D-v*J+t*I+y*z-F*H+C*u;if(JSM.IsZero(A))return null;var B=[];B[0]=(g*D-h*J+l*I)/A;B[1]=(d*J-c*D-e*I)/A;B[2]=(r*C-s*F+a*y)/A;B[3]=(n*F-m*C-p*y)/A;B[4]=(h*z-f*D-l*H)/A;B[5]=(b*D-d*z+e*H)/A;B[6]=(s*t-q*C-a*v)/A;B[7]=(k*C-n*t+p*
v)/A;B[8]=(f*J-g*z+l*u)/A;B[9]=(c*z-b*J-e*u)/A;B[10]=(q*F-r*t+a*x)/A;B[11]=(m*t-k*F-p*x)/A;B[12]=(g*H-f*I-h*u)/A;B[13]=(b*I-c*H+d*u)/A;B[14]=(r*v-q*y-s*x)/A;B[15]=(k*y-m*v+n*x)/A;return B};JSM.MatrixTranslation=function(a,b,c){var d=[1,0,0,0,0,1,0,0,0,0,1,0];d[12]=a;d[13]=b;d[14]=c;d[15]=1;return d};
JSM.MatrixRotation=function(a,b,c){var d=JSM.VectorNormalize(a);a=d.x;var e=d.y,d=d.z,f=a*a,g=e*e,h=d*d,l=Math.sin(b);b=Math.cos(b);var k=[];if(void 0===c||null===c)k[0]=f+(g+h)*b,k[1]=a*e*(1-b)+d*l,k[2]=a*d*(1-b)-e*l,k[3]=0,k[4]=a*e*(1-b)-d*l,k[5]=g+(f+h)*b,k[6]=e*d*(1-b)+a*l,k[7]=0,k[8]=a*d*(1-b)+e*l,k[9]=e*d*(1-b)-a*l,k[10]=h+(f+g)*b,k[11]=0,k[12]=0,k[13]=0,k[14]=0;else{var m=c.x,n=c.y;c=c.z;k[0]=f+(g+h)*b;k[1]=a*e*(1-b)+d*l;k[2]=a*d*(1-b)-e*l;k[3]=0;k[4]=a*e*(1-b)-d*l;k[5]=g+(f+h)*b;k[6]=e*d*
(1-b)+a*l;k[7]=0;k[8]=a*d*(1-b)+e*l;k[9]=e*d*(1-b)-a*l;k[10]=h+(f+g)*b;k[11]=0;k[12]=(m*(g+h)-a*(n*e+c*d))*(1-b)+(n*d-c*e)*l;k[13]=(n*(f+h)-e*(m*a+c*d))*(1-b)+(c*a-m*d)*l;k[14]=(c*(f+g)-d*(m*a+n*e))*(1-b)+(m*e-n*a)*l}k[15]=1;return k};
JSM.MatrixRotationQuaternion=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=b+b,g=c+c,h=d+d;a=b*f;var l=b*g,b=b*h,k=c*g,c=c*h,d=d*h,f=e*f,g=e*g,e=e*h,h=[];h[0]=1-(k+d);h[1]=l+e;h[2]=b-g;h[3]=0;h[4]=l-e;h[5]=1-(a+d);h[6]=c+f;h[7]=0;h[8]=b+g;h[9]=c-f;h[10]=1-(a+k);h[11]=0;h[12]=0;h[13]=0;h[14]=0;h[15]=1;return h};JSM.MatrixRotationX=function(a){var b=Math.sin(a);a=Math.cos(a);var c=[1,0,0,0,0];c[5]=a;c[6]=b;c[7]=0;c[8]=0;c[9]=-b;c[10]=a;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};
JSM.MatrixRotationY=function(a){var b=Math.sin(a);a=Math.cos(a);var c=[];c[0]=a;c[1]=0;c[2]=-b;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=b;c[9]=0;c[10]=a;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};JSM.MatrixRotationZ=function(a){var b=Math.sin(a);a=Math.cos(a);var c=[];c[0]=a;c[1]=b;c[2]=0;c[3]=0;c[4]=-b;c[5]=a;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};
JSM.MatrixView=function(a,b,c){if(JSM.CoordIsEqual(a,b))return JSM.MatrixIdentity();var d=[];b=JSM.VectorNormalize(JSM.CoordSub(a,b));c=JSM.VectorNormalize(JSM.VectorCross(c,b));var e=JSM.VectorNormalize(JSM.VectorCross(b,c));d[0]=c.x;d[1]=e.x;d[2]=b.x;d[3]=0;d[4]=c.y;d[5]=e.y;d[6]=b.y;d[7]=0;d[8]=c.z;d[9]=e.z;d[10]=b.z;d[11]=0;d[12]=-JSM.VectorDot(c,a);d[13]=-JSM.VectorDot(e,a);d[14]=-JSM.VectorDot(b,a);d[15]=1;return d};
JSM.MatrixPerspective=function(a,b,c,d){var e=[];a=1/Math.tan(a/2);var f=1/(c-d);e[0]=a/b;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=a;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=(d+c)*f;e[11]=-1;e[12]=0;e[13]=0;e[14]=2*d*c*f;e[15]=0;return e};JSM.ApplyTransformation=function(a,b){var c=[];c[0]=b.x;c[1]=b.y;c[2]=b.z;c[3]=1;c=JSM.MatrixVectorMultiply(a,c);return new JSM.Coord(c[0],c[1],c[2])};JSM.CoordSystem=function(a,b,c,d){this.origo=a;this.e1=b;this.e2=c;this.e3=d};
JSM.CoordSystem.prototype.Set=function(a,b,c,d){this.origo=a;this.e1=b;this.e2=c;this.e3=d};JSM.CoordSystem.prototype.Clone=function(){return new JSM.CoordSystem(this.origo.Clone(),this.e1.Clone(),this.e2.Clone(),this.e3.Clone())};JSM.CoordSystemToDirectionVectors=function(a){return new JSM.CoordSystem(a.origo,JSM.CoordSub(a.e1,a.origo),JSM.CoordSub(a.e2,a.origo),JSM.CoordSub(a.e3,a.origo))};
JSM.CoordSystemToAbsoluteCoords=function(a){return new JSM.CoordSystem(a.origo,JSM.CoordAdd(a.e1,a.origo),JSM.CoordAdd(a.e2,a.origo),JSM.CoordAdd(a.e3,a.origo))};
JSM.ChangeCoordSystem=function(a,b,c){var d=JSM.VectorNormalize(b.e1),e=JSM.VectorNormalize(b.e2),f=JSM.VectorNormalize(b.e3),g=JSM.VectorNormalize(c.e1),h=JSM.VectorNormalize(c.e2),l=JSM.VectorNormalize(c.e3);a=JSM.CoordSub(a,b.origo);b=new JSM.Coord(0,0,0);b.x=JSM.VectorDot(g,d)*a.x+JSM.VectorDot(g,e)*a.y+JSM.VectorDot(g,f)*a.z;b.y=JSM.VectorDot(h,d)*a.x+JSM.VectorDot(h,e)*a.y+JSM.VectorDot(h,f)*a.z;b.z=JSM.VectorDot(l,d)*a.x+JSM.VectorDot(l,e)*a.y+JSM.VectorDot(l,f)*a.z;return b=JSM.CoordAdd(b,
c.origo)};JSM.Sector2D=function(a,b){this.beg=a;this.end=b};JSM.Sector2D.prototype.Set=function(a,b){this.beg=a;this.end=b};JSM.Sector2D.prototype.Clone=function(){return new JSM.Sector2D(this.beg.Clone(),this.end.Clone())};JSM.Sector=function(a,b){this.beg=a;this.end=b};JSM.Sector.prototype.Set=function(a,b){this.beg=a;this.end=b};JSM.Sector.prototype.Clone=function(){return new JSM.Sector(this.beg.Clone(),this.end.Clone())};
JSM.CoordSectorPosition2D=function(a,b){var c=a.x,d=a.y,e=b.beg.x,f=b.beg.y,g=b.end.x,h=b.end.y,l=Math.pow(g-e,2)+Math.pow(h-f,2);if(JSM.IsZero(l))return JSM.CoordIsEqual2D(a,b.beg)?"CoordOnSectorEndCoord":"CoordOutsideOfSector";l=((c-e)*(g-e)+(d-f)*(h-f))/l;if(JSM.IsLower(l,0)||JSM.IsGreater(l,1))return"CoordOutsideOfSector";f+=l*(h-f);return!JSM.IsEqual(e+l*(g-e),c)||!JSM.IsEqual(f,d)?"CoordOutsideOfSector":JSM.IsEqual(l,0)||JSM.IsEqual(l,1)?"CoordOnSectorEndCoord":"CoordInsideOfSector"};
JSM.SectorSectorPosition2D=function(a,b,c){var d=a.beg.x,e=a.beg.y,f=a.end.x,g=a.end.y,h=b.beg.x,l=b.beg.y,k=b.end.x,m=b.end.y,n=(k-h)*(e-l)-(m-l)*(d-h),p=(f-d)*(e-l)-(g-e)*(d-h);if(JSM.IsZero(n)&&JSM.IsZero(p))return c=JSM.CoordSectorPosition2D(a.beg,b),d=JSM.CoordSectorPosition2D(a.end,b),e=JSM.CoordSectorPosition2D(b.beg,a),a=JSM.CoordSectorPosition2D(b.end,a),"CoordInsideOfSector"===c||("CoordInsideOfSector"===d||"CoordInsideOfSector"===e||"CoordInsideOfSector"===a)||"CoordOnSectorEndCoord"===
c&&"CoordOnSectorEndCoord"===d&&"CoordOnSectorEndCoord"===e&&"CoordOnSectorEndCoord"===a?"SectorsIntersectsCoincident":"CoordOnSectorEndCoord"===c||"CoordOnSectorEndCoord"===d||"CoordOnSectorEndCoord"===e||"CoordOnSectorEndCoord"===a?"SectorsIntersectsEndPoint":"SectorsDontIntersects";a=(m-l)*(f-d)-(k-h)*(g-e);if(JSM.IsZero(a))return"SectorsDontIntersects";n/=a;p/=a;if(JSM.IsLower(n,0)||JSM.IsGreater(n,1)||JSM.IsLower(p,0)||JSM.IsGreater(p,1))return"SectorsDontIntersects";void 0!==c&&(c.x=d+n*(f-
d),c.y=e+n*(g-e));return JSM.IsEqual(n,0)||JSM.IsEqual(n,1)||JSM.IsEqual(p,0)||JSM.IsEqual(p,1)?"SectorsIntersectsEndPoint":"SectorsIntersectsOnePoint"};JSM.GetSectorSegmentation=function(a,b,c){var d=JSM.CoordSub(a.end,a.beg),e=JSM.CoordDistance(a.beg,a.end)/b,f=0,g;for(g=0;g<=b;g++)c.push(JSM.CoordOffset(a.beg,d,f)),f+=e};JSM.Line2D=function(a,b){this.start=a;this.direction=b};JSM.Line2D.prototype.Set=function(a,b){this.start=a;this.direction=b};
JSM.Line2D.prototype.Clone=function(){return new JSM.Line2D(this.start.Clone(),this.direction.Clone())};JSM.Line=function(a,b){this.start=a;this.direction=b};JSM.Line.prototype.Set=function(a,b){this.start=a;this.direction=b};JSM.Line.prototype.Clone=function(){return new JSM.Line(this.start.Clone(),this.direction.Clone())};
JSM.CoordLinePosition2D=function(a,b){var c=b.start,d=b.direction,c=d.x*(a.y-c.y)-d.y*(a.x-c.x);return JSM.IsPositive(c)?"CoordAtLineLeft":JSM.IsNegative(c)?"CoordAtLineRight":"CoordOnLine"};
JSM.CoordLinePosition=function(a,b,c){var d=a.x,e=a.y,f=a.z,g=b.start;b=b.direction;var h=g.x,l=g.y,k=g.z,m=g.x+b.x,n=g.y+b.y,p=g.z+b.z,q=(m-h)*(m-h)+(n-l)*(n-l)+(p-k)*(p-k);if(JSM.IsZero(q))return void 0!==c&&c.Set(g.x,g.y,g.z),JSM.CoordIsEqual(g,a)?"CoordOnLine":"CoordOutsideOfLine";d=JSM.CoordAdd(g,JSM.VectorMultiply(b,((m-h)*(d-h)+(n-l)*(e-l)+(p-k)*(f-k))/q));void 0!==c&&c.Set(d.x,d.y,d.z);a=JSM.CoordDistance(a,d);return JSM.IsZero(a)?"CoordOnLine":"CoordOutsideOfLine"};
JSM.ProjectCoordToLine=function(a,b){var c=new JSM.Coord(0,0,0),d=a.x,e=a.y,f=a.z,g=b.start,h=b.direction,l=g.x,k=g.y,m=g.z,n=g.x+h.x,p=g.y+h.y,q=g.z+h.z,r=(n-l)*(n-l)+(p-k)*(p-k)+(q-m)*(q-m);if(JSM.IsZero(r))return c.Set(g.x,g.y,g.z),c;d=JSM.CoordAdd(g,JSM.VectorMultiply(h,((n-l)*(d-l)+(p-k)*(e-k)+(q-m)*(f-m))/r));c.Set(d.x,d.y,d.z);return c};
JSM.LineLineClosestPoint=function(a,b,c,d){function e(a,b,c,d,e){return(a[b].x-a[c].x)*(a[d].x-a[e].x)+(a[b].y-a[c].y)*(a[d].y-a[e].y)+(a[b].z-a[c].z)*(a[d].z-a[e].z)}var f=JSM.VectorNormalize(a.direction),g=a.start,f=JSM.CoordAdd(g,f);a=JSM.VectorNormalize(b.direction);b=b.start;var h=JSM.CoordAdd(b,a),l=[g,f,b,h],k=e(l,1,0,1,0),m=e(l,0,2,1,0),h=e(l,0,2,3,2),n=e(l,3,2,1,0),l=e(l,3,2,3,2),k=k*l-n*n;if(JSM.IsEqual(k,0))return!1;m=(h*n-m*l)/k;h=(h+m*n)/l;void 0!==c&&(f=JSM.VectorNormalize(JSM.CoordSub(f,
g)),g=JSM.CoordAdd(g,JSM.VectorMultiply(f,m)),c.Set(g.x,g.y,g.z));void 0!==d&&(c=JSM.CoordAdd(b,JSM.VectorMultiply(a,h)),d.Set(c.x,c.y,c.z));return!0};JSM.LineLinePosition=function(a,b,c){var d=new JSM.Coord(0,0,0),e=new JSM.Coord(0,0,0);return!JSM.LineLineClosestPoint(a,b,d,e)?"LinesIntersectsCoincident":JSM.CoordIsEqual(d,e)?(void 0!==c&&c.Set(d.x,d.y,d.z),"LinesIntersectsOnePoint"):"LinesDontIntersects"};JSM.Transformation=function(){this.matrix=JSM.MatrixIdentity()};
JSM.Transformation.prototype.GetMatrix=function(){return this.matrix};JSM.Transformation.prototype.SetMatrix=function(a){this.matrix=a};JSM.Transformation.prototype.Append=function(a){this.matrix=JSM.MatrixMultiply(this.matrix,a.matrix)};JSM.Transformation.prototype.Apply=function(a){return JSM.ApplyTransformation(this.matrix,a)};JSM.Transformation.prototype.Clone=function(){var a=new JSM.Transformation;a.matrix=JSM.MatrixClone(this.matrix);return a};
JSM.IdentityTransformation=function(){var a=new JSM.Transformation;a.matrix=JSM.MatrixIdentity();return a};JSM.TranslationTransformation=function(a){var b=new JSM.Transformation;b.matrix=JSM.MatrixTranslation(a.x,a.y,a.z);return b};JSM.OffsetTransformation=function(a,b){var c=JSM.VectorNormalize(a),c=JSM.VectorMultiply(c,b);return JSM.TranslationTransformation(c)};JSM.RotationTransformation=function(a,b,c){var d=new JSM.Transformation;d.matrix=JSM.MatrixRotation(a,b,c);return d};
JSM.RotationXTransformation=function(a,b){var c=new JSM.Transformation;void 0===b||null===b?c.matrix=JSM.MatrixRotationX(a):(c.Append(JSM.TranslationTransformation(new JSM.Vector(-b.x,-b.y,-b.z))),c.Append(JSM.RotationXTransformation(a)),c.Append(JSM.TranslationTransformation(new JSM.Vector(b.x,b.y,b.z))));return c};
JSM.RotationYTransformation=function(a,b){var c=new JSM.Transformation;void 0===b||null===b?c.matrix=JSM.MatrixRotationY(a):(c.Append(JSM.TranslationTransformation(new JSM.Vector(-b.x,-b.y,-b.z))),c.Append(JSM.RotationYTransformation(a)),c.Append(JSM.TranslationTransformation(new JSM.Vector(b.x,b.y,b.z))));return c};
JSM.RotationZTransformation=function(a,b){var c=new JSM.Transformation;void 0===b||null===b?c.matrix=JSM.MatrixRotationZ(a):(c.Append(JSM.TranslationTransformation(new JSM.Vector(-b.x,-b.y,-b.z))),c.Append(JSM.RotationZTransformation(a)),c.Append(JSM.TranslationTransformation(new JSM.Vector(b.x,b.y,b.z))));return c};
JSM.RotationXYZTransformation=function(a,b,c,d){var e=new JSM.Transformation;e.Append(JSM.RotationXTransformation(a,d));e.Append(JSM.RotationYTransformation(b,d));e.Append(JSM.RotationZTransformation(c,d));return e};JSM.Plane=function(a,b,c,d){this.a=a;this.b=b;this.c=c;this.d=d};JSM.Plane.prototype.Set=function(a,b,c,d){this.a=a;this.b=b;this.c=c;this.d=d};JSM.Plane.prototype.GetNormal=function(){return new JSM.Vector(this.a,this.b,this.c)};
JSM.Plane.prototype.Clone=function(){return new JSM.Plane(this.a,this.b,this.c,this.d)};JSM.GetPlaneFromCoordAndDirection=function(a,b){var c=new JSM.Plane,d=JSM.VectorNormalize(b),e=d.x,f=d.y,d=d.z;c.Set(e,f,d,-(e*a.x+f*a.y+d*a.z));return c};JSM.GetPlaneFromThreeCoords=function(a,b,c){var d=new JSM.Plane,e=(b.y-a.y)*(c.z-a.z)-(c.y-a.y)*(b.z-a.z),f=(b.z-a.z)*(c.x-a.x)-(c.z-a.z)*(b.x-a.x);b=(b.x-a.x)*(c.y-a.y)-(c.x-a.x)*(b.y-a.y);d.Set(e,f,b,-(e*a.x+f*a.y+b*a.z));return d};
JSM.CoordPlanePosition=function(a,b){var c=b.a*a.x+b.b*a.y+b.c*a.z+b.d;return JSM.IsPositive(c)?"CoordInFrontOfPlane":JSM.IsNegative(c)?"CoordAtBackOfPlane":"CoordOnPlane"};
JSM.LinePlanePosition=function(a,b,c){var d=JSM.VectorNormalize(a.direction),e=a.start.x,f=a.start.y,g=a.start.z,h=b.a,l=b.b,k=b.c;b=b.d;var m=h*(e-(a.start.x+d.x))+l*(f-(a.start.y+d.y))+k*(g-(a.start.z+d.z));if(JSM.IsZero(m))return"LineParallelToPlane";void 0!==c&&(a=JSM.CoordAdd(a.start,JSM.VectorMultiply(d,(h*e+l*f+k*g+b)/m)),c.Set(a.x,a.y,a.z));return"LineIntersectsPlane"};
JSM.LinePlaneIntersection=function(a,b){var c=JSM.VectorNormalize(a.direction),d=a.start.x,e=a.start.y,f=a.start.z,g=a.start.x+c.x,h=a.start.y+c.y,l=a.start.z+c.z,k=b.a,m=b.b,n=b.c,p=b.d,q=new JSM.Coord(0,0,0),g=k*(d-g)+m*(e-h)+n*(f-l);return JSM.IsZero(g)?q:q=JSM.CoordAdd(a.start,JSM.VectorMultiply(c,(k*d+m*e+n*f+p)/g))};JSM.CoordPlaneSignedDistance=function(a,b){var c=b.a,d=b.b,e=b.c;return(c*a.x+d*a.y+e*a.z+b.d)/Math.sqrt(c*c+d*d+e*e)};
JSM.CoordPlaneDistance=function(a,b){return Math.abs(JSM.CoordPlaneSignedDistance(a,b))};JSM.CoordPlaneSignedDirectionalDistance=function(a,b,c){var d=JSM.VectorNormalize(b);b=a.x;var e=a.y,f=a.z,g=c.a,h=c.b,l=c.c;c=c.d;var k=g*(b-(a.x+d.x))+h*(e-(a.y+d.y))+l*(f-(a.z+d.z));if(JSM.IsZero(k))return 0;d=JSM.CoordAdd(a,JSM.VectorMultiply(d,(g*b+h*e+l*f+c)/k));a=JSM.CoordDistance(a,d);JSM.IsNegative(g*b+h*e+l*f+c)&&(a=-a);return a};
JSM.CoordPlaneDirectionalDistance=function(a,b,c){return Math.abs(JSM.CoordPlaneSignedDirectionalDistance(a,b,c))};JSM.ProjectCoordToPlane=function(a,b){var c=a.x,d=a.y,e=a.z,f=b.a,g=b.b,h=b.c,l=b.d,k=JSM.CoordPlaneDistance(a,b);JSM.IsGreater(f*c+g*d+h*e+l,0)&&(k=-k);c=JSM.VectorNormalize(new JSM.Coord(f,g,h));return JSM.CoordOffset(a,c,k)};
JSM.Project=function(a,b,c,d,e,f,g,h,l){b=JSM.MatrixView(b,c,d);g=JSM.MatrixPerspective(e,f,g,h);e=new JSM.Coord(0,0,0);h=[];f=[];h[0]=a.x;h[1]=a.y;h[2]=a.z;h[3]=1;f=JSM.MatrixVectorMultiply(g,JSM.MatrixVectorMultiply(b,h));a=f[3];JSM.IsZero(a)?l=null:(f[0]=0.5*(f[0]/a)+0.5,f[1]=0.5*(f[1]/a)+0.5,f[2]=0.5*(f[2]/a)+0.5,f[0]=f[0]*l[2]+l[0],f[1]=f[1]*l[3]+l[1],e.x=f[0],e.y=f[1],e.z=f[2],l=e);return l};
JSM.ConvexHull2D=function(a){function b(a,b){var c=a.length,d=0,e;for(e=1;e<c;e++)b==d?d=e:"Clockwise"==JSM.CoordTurnType2D(a[b],a[d],a[e])&&(d=e);return d}var c=[];if(3>a.length)return c;var d=function(a){var b=a.length,c=JSM.Inf,d=-1,e,f;for(e=0;e<b;e++)f=a[e].x,JSM.IsLower(f,c)&&(c=f,d=e);return d}(a),e=d,f;do c.push(e),e=f=b(a,e);while(f!=d);return c};
JSM.ConvexHull3D=function(a){function b(){this.position=null}function c(){this.tri2=this.tri1=this.vert2=this.vert1=null}function d(){this.valid=this.edges=this.vertices=null}function e(a,c){var d=new b;d.position=c;a.vertices.push(d);return a.vertices.length-1}function f(a,b,d,e){var f=-1,g,h;for(g=0;g<a.edges.length;g++)if(h=a.edges[g],h.vert1==d&&h.vert2==e||h.vert1==e&&h.vert2==d){f=g;break}-1==f&&(f=new c,f.vert1=d,f.vert2=e,f.tri1=-1,f.tri2=-1,a.edges.push(f),f=a.edges.length-1);a=a.edges[f];
a.tri1!=b&&a.tri2!=b&&(-1==a.tri1?a.tri1=b:-1==a.tri2&&(a.tri2=b));return f}function g(a,b,c,e){var g=a.triangles.length,h=f(a,g,b,c),k=f(a,g,c,e),g=f(a,g,e,b),l=new d;l.vertices=[b,c,e];l.edges=[h,k,g];l.valid=!0;a.triangles.push(l);return a.triangles.length-1}function h(a,b,c){a=a.edges[c];a.tri1==b?a.tri1=-1:a.tri2==b&&(a.tri2=-1)}function l(a,b,c,d,e){c=a.vertices[c].position;d=a.vertices[d].position;e=a.vertices[e].position;a=JSM.CoordSub(a.vertices[b].position,e);b=JSM.CoordSub(c,e);c=JSM.CoordSub(d,
e);return JSM.VectorDot(a,JSM.VectorCross(b,c))/6}function k(a,b){var c=[],d,e;for(d=0;d<a.triangles.length;d++)e=a.triangles[d],e.valid?!JSM.IsLower(l(a,e.vertices[0],e.vertices[2],e.vertices[1],b),0)?c.push(!0):c.push(!1):c.push(!1);var f,k,m,n=[];for(d=0;d<c.length;d++)c[d]&&(e=a.triangles[d],e.valid&&(f=a.edges[e.edges[0]],k=a.edges[e.edges[1]],m=a.edges[e.edges[2]],f=-1==f.tri1||-1==f.tri2||c[f.tri1]!=c[f.tri2],k=-1==k.tri1||-1==k.tri2||c[k.tri1]!=c[k.tri2],m=-1==m.tri1||-1==m.tri2||c[m.tri1]!=
c[m.tri2],f&&n.push([e.vertices[0],e.vertices[1],b]),k&&n.push([e.vertices[1],e.vertices[2],b]),m&&n.push([e.vertices[2],e.vertices[0],b])));for(d=0;d<c.length;d++)c[d]&&(e=a.triangles[d],e.valid&&(e=a,m=d,f=e.triangles[m],f.valid&&(h(e,m,f.edges[0]),h(e,m,f.edges[1]),h(e,m,f.edges[2]),f.valid=!1)));for(d=0;d<n.length;d++)c=n[d],g(a,c[0],c[1],c[2])}var m=[],n=a.length;if(4>n)return m;var p=new function(){this.vertices=[];this.edges=[];this.triangles=[]},q;for(q=0;q<n;q++)e(p,a[q]);(function(a){var b=
-1,b=!JSM.IsLower(l(a,0,1,2,3),0)?g(a,0,1,2):g(a,0,2,1),b=a.triangles[b];g(a,b.vertices[0],b.vertices[2],3);g(a,b.vertices[2],b.vertices[1],3);g(a,b.vertices[1],b.vertices[0],3)})(p);for(q=4;q<n;q++)k(p,q);for(q=0;q<p.triangles.length;q++)a=p.triangles[q],a.valid&&m.push(a.vertices);return m};JSM.Polygon2D=function(){this.vertices=[]};JSM.Polygon2D.prototype.AddVertex=function(a,b){this.vertices.push(new JSM.Coord2D(a,b))};JSM.Polygon2D.prototype.GetVertex=function(a){return this.vertices[a]};
JSM.Polygon2D.prototype.SetVertex=function(a,b,c){this.vertices[a].Set(b,c)};JSM.Polygon2D.prototype.VertexCount=function(){return this.vertices.length};JSM.Polygon2D.prototype.Clear=function(){this.vertices=[]};JSM.Polygon2D.prototype.Clone=function(){var a=new JSM.Polygon2D,b;for(b=0;b<this.vertices.length;b++)a.vertices.push(this.vertices[b].Clone());return a};JSM.ContourPolygon2D=function(){this.polygons=[]};
JSM.ContourPolygon2D.prototype.AddVertex=function(a,b,c){void 0===this.polygons[a]&&(this.polygons[a]=new JSM.Polygon2D);this.polygons[a].AddVertex(b,c)};JSM.ContourPolygon2D.prototype.VertexCount=function(a){return void 0===this.polygons[a]?0:this.polygons[a].VertexCount()};JSM.ContourPolygon2D.prototype.GetVertex=function(a,b){return this.polygons[a].GetVertex(b)};JSM.ContourPolygon2D.prototype.SetVertex=function(a,b,c,d){this.polygons[a].SetVertex(b,c,d)};
JSM.ContourPolygon2D.prototype.AddContour=function(){this.polygons.push(new JSM.Polygon2D)};JSM.ContourPolygon2D.prototype.ContourCount=function(){return this.polygons.length};JSM.ContourPolygon2D.prototype.GetContour=function(a){return this.polygons[a]};JSM.ContourPolygon2D.prototype.Clear=function(){this.polygons=[]};JSM.ContourPolygon2D.prototype.Clone=function(){var a=new JSM.ContourPolygon2D,b;for(b=0;b<this.polygons.length;b++)a.polygons.push(this.polygons[b].Clone());return a};
JSM.Polygon=function(){this.vertices=[]};JSM.Polygon.prototype.AddVertex=function(a,b,c){this.vertices.push(new JSM.Coord(a,b,c))};JSM.Polygon.prototype.GetVertex=function(a){return this.vertices[a]};JSM.Polygon.prototype.SetVertex=function(a,b,c,d){this.vertices[a].Set(b,c,d)};JSM.Polygon.prototype.VertexCount=function(){return this.vertices.length};JSM.Polygon.prototype.Clear=function(){this.vertices=[]};
JSM.Polygon.prototype.Clone=function(){var a=new JSM.Polygon,b;for(b=0;b<this.vertices.length;b++)a.vertices.push(this.vertices[b].Clone());return a};JSM.CreatePolygonFromVertices=function(a){var b=new JSM.Polygon2D,c,d;for(c=0;c<a.length;c++)d=a[c],b.AddVertex(d.x,d.y);return b};JSM.PolygonSignedArea2D=function(a){var b=a.VertexCount(),c=0,d,e,f;for(d=0;d<b;d++)e=a.GetVertex(d),f=a.GetVertex((d+1)%b),c+=e.x*f.y-f.x*e.y;return c/2};JSM.PolygonArea2D=function(a){return Math.abs(JSM.PolygonSignedArea2D(a))};
JSM.PolygonOrientation2D=function(a){a=JSM.PolygonSignedArea2D(a);return JSM.IsPositive(a)?"CounterClockwise":JSM.IsNegative(a)?"Clockwise":"Invalid"};JSM.ChangePolygonOrientation2D=function(a){var b=a.Clone();a.Clear();var c,d;for(c=b.VertexCount()-1;0<=c;c--)d=b.GetVertex(c),a.AddVertex(d.x,d.y)};JSM.CreateCCWPolygonFromVertices=function(a){a=JSM.CreatePolygonFromVertices(a);"CounterClockwise"!=JSM.PolygonOrientation2D(a)&&JSM.ChangePolygonOrientation2D(a);return a};
JSM.PolygonComplexity2D=function(a){var b=!1,c=!1,d=a.VertexCount(),e,f,g,h;for(e=0;e<d;e++)if(f=0===e?d-1:e-1,g=e,h=e===d-1?0:e+1,f=a.GetVertex(f),g=a.GetVertex(g),h=a.GetVertex(h),h=JSM.CoordTurnType2D(f,g,h),"CounterClockwise"===h?b=!0:"Clockwise"===h&&(c=!0),b&&c)return"Concave";return!b&&!c?"Invalid":"Convex"};
JSM.CoordPolygonPosition2D=function(a,b){var c=b.VertexCount(),d,e,f;for(d=0;d<c;d++)if(e=b.GetVertex(d),f=b.GetVertex((d+1)%c),e=new JSM.Sector2D(e,f),"CoordOutsideOfSector"!==JSM.CoordSectorPosition2D(a,e))return"CoordOnPolygonEdge";var g=0,h;for(d=0;d<c;d++)h=Math.abs(b.GetVertex(d).x-a.x),JSM.IsGreater(h,g)&&(g=h);g=new JSM.Sector2D(a,new JSM.Coord2D(a.x+2*g,a.y));h=0;var l;for(d=0;d<c;d++)e=b.GetVertex(d),f=b.GetVertex((d+1)%c),e=new JSM.Sector2D(e,f),f=new JSM.Coord2D(0,0),l=JSM.SectorSectorPosition2D(g,
e,f),"SectorsDontIntersects"!==l&&("SectorsIntersectsOnePoint"===l?h++:"SectorsIntersectsEndPoint"===l&&(JSM.CoordIsEqual2D(f,e.beg)?JSM.IsGreater(e.beg.y,e.end.y)&&h++:JSM.CoordIsEqual2D(f,e.end)&&JSM.IsLower(e.beg.y,e.end.y)&&h++));return 0===h%2?"CoordOutsideOfPolygon":"CoordInsideOfPolygon"};
JSM.SectorIntersectsPolygon2D=function(a,b,c,d){var e=a.VertexCount(),f,g,h;for(f=0;f<e;f++)if(g=f,h=(f+1)%e,!(g==c||h==c||g==d||h==d))if(g=new JSM.Sector2D(a.GetVertex(g),a.GetVertex(h)),g=JSM.SectorSectorPosition2D(b,g),"SectorsDontIntersects"!==g)return!0;return!1};
JSM.IsPolygonVertexVisible2D=function(a,b,c){if(b===c)return!1;var d=a.VertexCount();if(c===(0<b?b-1:d-1)||c===(b<d-1?b+1:0))return!1;d=new JSM.Sector2D(a.GetVertex(b),a.GetVertex(c));if(JSM.SectorIntersectsPolygon2D(a,d,b,c))return!1;b=JSM.MidCoord2D(d.beg,d.end);return"CoordInsideOfPolygon"!==JSM.CoordPolygonPosition2D(b,a)?!1:!0};
JSM.CreatePolygonWithHole2D=function(a){var b=[],c=[],d=0,e;c.push(-1);for(e=0;e<a.length;e++)null===a[e]&&(c.push(e),d+=1);c.push(e);d+=1;for(e=0;e<d;e++){var f=e,g=c[f]+1,h=c[f+1];if(0===f){f=void 0;for(f=g;f<h;f++)b.push(f)}else{for(var g=void 0,g=new JSM.Polygon2D,h=new JSM.Polygon2D,l=void 0,k=void 0,k=void 0,l=0;l<b.length;l++)k=a[b[l]],g.AddVertex(k.x,k.y);for(var m=c[f]+1,n=c[f+1],l=m;l<n;l++)k=a[l],h.AddVertex(k.x,k.y);for(var p=null,q=void 0,r=void 0,s=void 0,l=0;l<g.VertexCount();l++){r=
b[l];for(k=m;k<n;k++)if(s=k-m,q=new JSM.Sector(a[r],a[k]),!JSM.SectorIntersectsPolygon2D(g,q,l,-1)&&!JSM.SectorIntersectsPolygon2D(h,q,-1,s)){p=[r,k];break}if(null!==p)break}g=p;h=c[f]+1;f=c[f+1];l=[];n=m=void 0;for(m=0;m<b.length;m++)l[m]=b[m];b=[];p=k=void 0;for(m=0;m<l.length;m++)if(b.push(l[m]),l[m]==g[0]){n=g[1];k=!0;for(p=!1;!p;)b.push(n),!k&&n==g[1]&&(p=!0),k&&(k=!1),n=n<f-1?n+1:h;b.push(l[m])}}}return b};
JSM.PolygonTriangulate2D=function(a){function b(){var a=[],b,c,d,e;for(b=0;b<g.length;b++)if(d=g[b],3===d.length)if("CounterClockwise"===k)a.push(d);else{e=[];for(c=d.length-1;0<=c;c--)e.push(f-d[c]-1);a.push(e)}return a}function c(a,b,c){if(b===c)return!1;var d=a.VertexCount(),e;if(!(e=(b<d-1?b+1:0)===c))e=(0<b?b-1:d-1)===c;return e?!1:JSM.IsPolygonVertexVisible2D(a,b,c)}function d(a,b,c){var d=a.length;if(3>=d)return!0;var e,f,h,k;for(e=0;2>e;e++){h=f=-1;0===e?(f=b,h=c):1===e&&(f=c,h=b);k=[];for(k.push(a[h]);f!==
h;f=f<d-1?f+1:0)k.push(a[f]);g.push(k)}return!0}var e=a.Clone(),f=e.VertexCount();if(3>f)return[];var g=[],h=[],l;for(a=0;a<f;a++)h.push(a);g.push(h);if(3===f)return b();var h=JSM.PolygonComplexity2D(e),k=JSM.PolygonOrientation2D(e);if("Invalid"===h||"Invalid"===k)return[];if("CounterClockwise"!==k){var m,n,p;for(a=0;a<f/2;a++)m=a,n=f-a-1,p=e.vertices[m],e.vertices[m]=e.vertices[n],e.vertices[n]=p}if("Convex"===h){for(a=0;a<f-2;a++)e=[],e.push(0),e.push((a+1)%f),e.push((a+2)%f),g.push(e);return b()}var q;
for(a=0;a<g.length;a++)if(m=g[a],n=m.length,3!==n){p=new JSM.Polygon2D;for(h=0;h<n;h++)l=e.GetVertex(m[h]),p.AddVertex(l.x,l.y);q=!1;for(h=0;h<n;h++){for(l=0;l<n;l++)if(c(p,h,l)){d(m,h,l);q=!0;break}if(q)break}}return b()};
JSM.CheckTriangulation2D=function(a,b){var c=JSM.PolygonSignedArea2D(a),d=0,e,f,g,h,l;for(e=0;e<b.length;e++){g=b[e];if(3!==g.length)return!1;h=new JSM.Polygon2D;for(f=0;f<g.length;f++)l=a.GetVertex(g[f]),h.AddVertex(l.x,l.y);d+=JSM.PolygonSignedArea2D(h)}return!JSM.IsEqual(c,d)?!1:!0};
JSM.CreatePolygonWithHole=function(a){var b=[],c;for(c=0;c<a.length;c++)null!==a[c]&&b.push(a[c]);var b=JSM.CalculateNormal(b),d=new JSM.Coord(0,0,0),e=[],f;for(c=0;c<a.length;c++)null!==a[c]?(f=JSM.GetCoord2DFromCoord(a[c],d,b),e.push(f)):e.push(null);return JSM.CreatePolygonWithHole2D(e)};
JSM.PolygonTriangulate=function(a){var b=new JSM.Polygon2D,c=JSM.CalculateNormal(a.vertices),d=new JSM.Coord(0,0,0),e=a.VertexCount(),f,g;for(f=0;f<e;f++)g=JSM.GetCoord2DFromCoord(a.GetVertex(f),d,c),b.AddVertex(g.x,g.y);return JSM.PolygonTriangulate2D(b)};
JSM.OffsetPolygonContour=function(a,b){var c=a.VertexCount(),d=JSM.CalculateNormal(a.vertices),e,f,g,h,l,k=new JSM.Polygon,m;for(m=0;m<c;m++)e=0===m?c-1:m-1,f=m,g=m===c-1?0:m+1,e=a.GetVertex(e),f=a.GetVertex(f),h=a.GetVertex(g),l=JSM.CoordSub(e,f),g=JSM.CoordSub(h,f),l=JSM.GetVectorsAngle(l,g)/2,"Clockwise"===JSM.CoordTurnType(e,f,h,d)&&(l=Math.PI-l),e=b/Math.sin(l),e=JSM.CoordOffset(f,g,e),e=JSM.CoordRotate(e,d,l,f),k.AddVertex(e.x,e.y,e.z);return k};
JSM.CutPolygonWithPlane=function(a,b,c,d,e){function f(a,b,c,d,e){1==b?c.push(a):-1==b?d.push(a):e.push(a)}function g(a,b,c,d){function e(a,b){if(!(2>b.length)){for(var c=a.GetVertex(b[0]),d=a.GetVertex(b[1]),d=JSM.CoordSub(d,c),f=JSM.GetPlaneFromCoordAndDirection(c,d),g,d=[],c=0;c<b.length;c++)g=a.GetVertex(b[c]),d.push(JSM.CoordPlaneSignedDistance(g,f));for(c=0;c<b.length-1;c++)for(f=0;f<b.length-c-1;f++)if(JSM.IsGreater(d[f],d[f+1])){g=d;var h=f+1,k=g[f];g[f]=g[h];g[h]=k;g=b;h=f+1;k=g[f];g[f]=
g[h];g[h]=k}}}function f(a,b,c,d,e,g){function h(a,b){a[a[b]]=-1;a[b]=-1}var k=[];(function(a,b,c){var d;for(d=0;d<a.VertexCount();d++)c.push(-1);for(d=0;d<b.length;d+=2){a=c;var e=b,f=d;a[e[f]]=e[f+1];a[e[f+1]]=e[f]}})(a,b,k);var l=0;g&&(l=b.length-1);for(var m=b[l],n=m,p=!1,q=0,r=new JSM.Polygon,s;;){p||(q=c[n],0!==q&&(p=!0));if(0<r.VertexCount()&&n==m)if(1==q?d.push(r):-1==q&&e.push(r),r=new JSM.Polygon,0<l&&l<b.length){n=m=b[l];continue}else break;s=a.GetVertex(n);r.AddVertex(s.x,s.y,s.z);-1!=
k[n]?(l=g?l-2:l+2,n=k[n],h(k,n)):n=n<a.VertexCount()-1?n+1:0}}var g=[];(function(a,b){var c,d,e,f;for(c=0;c<a.length;c++)if(d=a[c],0===d){d=0<c?c-1:a.length-1;e=c<a.length-1?c+1:0;f=a[d];e=a[e];if(0!==e&&0===f){for(;0===a[d];)d=0<d?d-1:a.length-1;f=a[d]}(-1==f&&1==e||1==f&&-1==e)&&b.push(c)}})(b,g);0===g.length||0!==g.length%2||(e(a,g),f(a,g,b,c,d,!1),f(a,g,b,c,d,!0))}var h=new JSM.Polygon,l=[];b=function(a,b,c,d){function e(a,c,d,f,g){function h(a,c,d,e,f,g){var k=d[d.length-1];0!==k&&(0!==g&&k!=
g)&&(e=a.GetVertex(e),a=a.GetVertex(f),a=new JSM.Line(a,JSM.CoordSub(a,e)),f=new JSM.Coord(0,0,0),"LineIntersectsPlane"==JSM.LinePlanePosition(a,b,f)&&(c.AddVertex(f.x,f.y,f.z),d.push(0)))}function k(a,b,c,d,e){a=a.GetVertex(d);b.AddVertex(a.x,a.y,a.z);c.push(e)}var l=0===c,n=c===a.VertexCount(),p;n?(c=0,p=a.VertexCount()-1):p=c-1;f=f[c];l||h(a,d,g,p,c,f);n||k(a,d,g,c,f);return f}var f=[],g=!1,h=!1,l,t,y;for(l=0;l<a.VertexCount();l++)t=a.GetVertex(l),t=JSM.CoordPlanePosition(t,b),y=0,"CoordInFrontOfPlane"==
t?(y=1,h=!0):"CoordAtBackOfPlane"==t&&(y=-1,g=!0),f.push(y);if(g&&h)for(l=0;l<=a.VertexCount();l++)e(a,l,c,f,d);else{if(g)return-1;if(h)return 1}return 0}(a,b,h,l);0===h.VertexCount()&&0===l.length?f(a,b,c,d,e):g(h,l,c,d);return 0===c.length+d.length+e.length?!1:!0};JSM.BSPNode=function(){this.outside=this.inside=this.parent=this.plane=this.userData=this.polygon=null};JSM.BSPNode.prototype.IsLeaf=function(){return null===this.inside&&null===this.outside};JSM.BSPTree=function(){this.root=null};
JSM.BSPTree.prototype.AddPolygon=function(a,b){null===this.root&&(this.root=this.GetNewNode());return this.AddPolygonToNode(this.root,a,b)};JSM.BSPTree.prototype.Traverse=function(a){this.TraverseNode(this.root,a)};JSM.BSPTree.prototype.TraverseNode=function(a,b){null!==a&&(b(a),this.TraverseNode(a.inside,b),this.TraverseNode(a.outside,b))};JSM.BSPTree.prototype.GetNodes=function(){var a=[];this.Traverse(function(b){a.push(b)});return a};
JSM.BSPTree.prototype.NodeCount=function(){var a=0;this.Traverse(function(){a+=1});return a};
JSM.BSPTree.prototype.AddPolygonToNode=function(a,b,c){if(3>b.VertexCount())return!1;var d;if(null===a.polygon){d=JSM.CalculateNormal(b.vertices);var e=JSM.GetPlaneFromCoordAndDirection(b.GetVertex(0),d);a.polygon=b;void 0!==c&&(a.userData=c);a.plane=e}else{d=[];var f=[],e=[];JSM.CutPolygonWithPlane(b,a.plane,f,d,e)&&(0<d.length&&this.AddInsidePolygonsToNode(a,d,c),0<f.length&&this.AddOutsidePolygonsToNode(a,f,c),0<e.length&&(d=JSM.CalculateNormal(b.vertices),0<JSM.VectorDot(d,a.plane.GetNormal())?
this.AddInsidePolygonsToNode(a,e,c):this.AddOutsidePolygonsToNode(a,e,c)))}return!0};JSM.BSPTree.prototype.AddInsidePolygonsToNode=function(a,b,c){null===a.inside&&(a.inside=this.GetNewNode(),a.inside.parent=a);var d;for(d=0;d<b.length;d++)this.AddPolygonToNode(a.inside,b[d],c)};JSM.BSPTree.prototype.AddOutsidePolygonsToNode=function(a,b,c){null===a.outside&&(a.outside=this.GetNewNode(),a.outside.parent=a);var d;for(d=0;d<b.length;d++)this.AddPolygonToNode(a.outside,b[d],c)};
JSM.BSPTree.prototype.GetNewNode=function(){return new JSM.BSPNode};
JSM.ClipPolygonWithBSPTree=function(a,b,c,d,e,f){function g(a,b,c){if(null!==b){var d=[],e=[],f=[];JSM.CutPolygonWithPlane(a,b.plane,e,d,f)&&(0<d.length&&l(b,d,c),0<e.length&&k(b,e,c),0<f.length&&(a=JSM.CalculateNormal(a.vertices),0<JSM.VectorDot(a,b.plane.GetNormal())?l(b,f,!0):k(b,f,!0)))}}function h(a,b){var c;for(c=0;c<a.length;c++)b.push(a[c])}function l(a,b,c){if(null!==a.inside){a=a.inside;var e;for(e=0;e<b.length;e++)g(b[e],a,c)}else h(b,c?f:d)}function k(a,b,d){if(null!==a.outside){a=a.outside;
var f;for(f=0;f<b.length;f++)g(b[f],a,d)}else h(b,d?e:c)}g(a,b.root,!1);return!0};JSM.GetGaussianCParameter=function(a,b,c,d){return Math.sqrt(-(Math.pow(a-c,2)/(2*Math.log(d/Math.abs(b)))))};JSM.GetGaussianValue=function(a,b,c,d){return b*Math.exp(-(Math.pow(a-c,2)/(2*Math.pow(d,2))))};JSM.GenerateCirclePoints=function(a,b,c){var d=[],e=2*Math.PI,f=2*Math.PI/b,g,h;for(g=0;g<b;g++)h=JSM.CylindricalToCartesian(a,0,e),void 0!==c&&null!==c&&(h=JSM.CoordAdd(h,c)),d.push(h),e+=f;return d};
JSM.GetRuledMesh=function(a,b,c,d,e){if(a.length===b.length){var f=a.length-1,g=[],h=[],l;for(l=0;l<=f;l++)g.push(JSM.CoordSub(b[l],a[l])),h.push(JSM.CoordDistance(a[l],b[l]));var k,m;for(l=0;l<=f;l++){k=h[l]/c;for(b=0;b<=c;b++)m=JSM.CoordOffset(a[l],g[l],k*b),d.push(m)}for(l=0;l<f;l++)for(b=0;b<c;b++)a=l*(c+1)+b,d=a+1,g=a+c+1,h=g+1,a=[a,g,h,d],e.push(a)}};JSM.BodyVertex=function(a){this.position=a};JSM.BodyVertex.prototype.GetPosition=function(){return this.position};
JSM.BodyVertex.prototype.SetPosition=function(a){this.position=a};JSM.BodyVertex.prototype.Clone=function(){return new JSM.BodyVertex(this.position.Clone())};JSM.BodyPolygon=function(a){this.vertices=a;this.curved=this.material=-1};JSM.BodyPolygon.prototype.AddVertexIndex=function(a){this.vertices.push(a)};JSM.BodyPolygon.prototype.GetVertexIndex=function(a){return this.vertices[a]};JSM.BodyPolygon.prototype.VertexIndexCount=function(){return this.vertices.length};
JSM.BodyPolygon.prototype.HasMaterialIndex=function(){return-1!==this.material};JSM.BodyPolygon.prototype.GetMaterialIndex=function(){return this.material};JSM.BodyPolygon.prototype.SetMaterialIndex=function(a){this.material=a};JSM.BodyPolygon.prototype.HasCurveGroup=function(){return-1!==this.curved};JSM.BodyPolygon.prototype.GetCurveGroup=function(){return this.curved};JSM.BodyPolygon.prototype.SetCurveGroup=function(a){this.curved=a};
JSM.BodyPolygon.prototype.InheritAttributes=function(a){this.material=a.material;this.curved=a.curved};JSM.BodyPolygon.prototype.Clone=function(){var a=new JSM.BodyPolygon([]),b;for(b=0;b<this.vertices.length;b++)a.vertices.push(this.vertices[b]);a.material=this.material;a.curved=this.curved;return a};JSM.Body=function(){this.vertices=[];this.polygons=[];this.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1))};
JSM.Body.prototype.AddVertex=function(a){this.vertices.push(a);return this.vertices.length-1};JSM.Body.prototype.AddPolygon=function(a){this.polygons.push(a);return this.polygons.length-1};JSM.Body.prototype.GetVertex=function(a){return this.vertices[a]};JSM.Body.prototype.GetVertexPosition=function(a){return this.vertices[a].position};JSM.Body.prototype.SetVertexPosition=function(a,b){this.vertices[a].position=b};JSM.Body.prototype.VertexCount=function(){return this.vertices.length};
JSM.Body.prototype.GetPolygon=function(a){return this.polygons[a]};JSM.Body.prototype.PolygonCount=function(){return this.polygons.length};JSM.Body.prototype.SetPolygonsMaterialIndex=function(a){var b;for(b=0;b<this.polygons.length;b++)this.polygons[b].SetMaterialIndex(a)};JSM.Body.prototype.SetPolygonsCurveGroup=function(a){var b;for(b=0;b<this.polygons.length;b++)this.polygons[b].SetCurveGroup(a)};JSM.Body.prototype.GetTextureProjectionType=function(){return this.projection};
JSM.Body.prototype.SetTextureProjectionType=function(a){this.projection=a};JSM.Body.prototype.GetTextureProjectionCoords=function(){return this.coords};JSM.Body.prototype.SetTextureProjectionCoords=function(a){this.coords=a};JSM.Body.prototype.SetPlanarTextureProjection=function(a,b,c){this.SetTextureProjectionType("Planar");this.SetTextureProjectionCoords(new JSM.CoordSystem(a,b,JSM.VectorCross(b,c),new JSM.Coord(0,0,0)))};
JSM.Body.prototype.SetCubicTextureProjection=function(a,b,c,d){this.SetTextureProjectionType("Cubic");this.SetTextureProjectionCoords(new JSM.CoordSystem(a,b,c,d))};JSM.Body.prototype.SetCylindricalTextureProjection=function(a,b,c,d){this.SetTextureProjectionType("Cylindrical");this.SetTextureProjectionCoords(new JSM.CoordSystem(a,JSM.VectorSetLength(c,b),JSM.VectorSetLength(JSM.VectorCross(d,c),b),d))};
JSM.Body.prototype.Transform=function(a){var b;for(b=0;b<this.vertices.length;b++)this.vertices[b].position=a.Apply(this.vertices[b].position);null!==this.coords&&(b=JSM.CoordSystemToAbsoluteCoords(this.coords),b.origo=a.Apply(b.origo),b.e1=a.Apply(b.e1),b.e2=a.Apply(b.e2),b.e3=a.Apply(b.e3),this.coords=JSM.CoordSystemToDirectionVectors(b))};
JSM.Body.prototype.GetBoundingBox=function(){var a=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf),b=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf),c,d;for(c=0;c<this.vertices.length;c++)d=this.vertices[c].position,a.x=JSM.Minimum(a.x,d.x),a.y=JSM.Minimum(a.y,d.y),a.z=JSM.Minimum(a.z,d.z),b.x=JSM.Maximum(b.x,d.x),b.y=JSM.Maximum(b.y,d.y),b.z=JSM.Maximum(b.z,d.z);return[a,b]};JSM.Body.prototype.GetCenter=function(){var a=this.GetBoundingBox();return JSM.MidCoord(a[0],a[1])};
JSM.Body.prototype.GetBoundingSphereRadius=function(){var a=this.GetCenter(),b=0,c,d;for(c=0;c<this.vertices.length;c++)d=JSM.CoordDistance(a,this.vertices[c].position),JSM.IsGreater(d,b)&&(b=d);return b};JSM.Body.prototype.OffsetToOrigo=function(){var a=this.GetCenter(),a=JSM.VectorMultiply(a,-1),b;for(b=0;b<this.vertices.length;b++)this.vertices[b].position=JSM.CoordAdd(this.vertices[b].position,a)};
JSM.Body.prototype.Merge=function(a){var b=this.vertices.length,c,d;for(c=0;c<a.VertexCount();c++)this.vertices.push(a.GetVertex(c).Clone());var e;for(c=0;c<a.PolygonCount();c++){e=a.GetPolygon(c).Clone();for(d=0;d<e.VertexIndexCount();d++)e.vertices[d]+=b;this.polygons.push(e)}};JSM.Body.prototype.Clear=function(){this.vertices=[];this.polygons=[];this.coords=this.projection=null};JSM.Model=function(){this.bodies=[]};
JSM.Model.prototype.AddBody=function(a){this.bodies.push(a);return this.bodies.length-1};JSM.Model.prototype.GetBody=function(a){return this.bodies[a]};JSM.Model.prototype.BodyCount=function(){return this.bodies.length};JSM.Model.prototype.VertexCount=function(){var a=0,b;for(b=0;b<this.bodies.length;b++)a+=this.bodies[b].VertexCount();return a};JSM.Model.prototype.PolygonCount=function(){var a=0,b;for(b=0;b<this.bodies.length;b++)a+=this.bodies[b].PolygonCount();return a};
JSM.HexColorToRGBComponents=function(a){for(var b=a.toString(16);6>b.length;)b="0"+b;a=parseInt(b.substr(0,2),16);var c=parseInt(b.substr(2,2),16),b=parseInt(b.substr(4,2),16);return[a,c,b]};JSM.HexColorToNormalizedRGBComponents=function(a){a=JSM.HexColorToRGBComponents(a);return[a[0]/255,a[1]/255,a[2]/255]};JSM.HexColorToRGBColor=function(a){return parseInt("0x"+a,16)};
JSM.RGBComponentsToHexColor=function(a,b,c){function d(a){for(a=parseInt(a,10).toString(16);2>a.length;)a="0"+a;return a}a=d(a);b=d(b);c=d(c);return parseInt("0x"+a+b+c,16)};JSM.Light=function(a){var b=8355711,c=8355711,d=0,e=new JSM.Vector(1,0,0);void 0!==a&&null!==a&&(b=JSM.ValueOrDefault(a.ambient,b),c=JSM.ValueOrDefault(a.diffuse,c),d=JSM.ValueOrDefault(a.specular,d),e=JSM.ValueOrDefault(a.direction,e));this.ambient=b;this.diffuse=c;this.specular=d;this.direction=e};
JSM.Material=function(a){var b=52224,c=52224,d=0,e=0,f=1,g=null,h=1,l=1;void 0!==a&&null!==a&&(b=JSM.ValueOrDefault(a.ambient,b),c=JSM.ValueOrDefault(a.diffuse,c),d=JSM.ValueOrDefault(a.specular,d),e=JSM.ValueOrDefault(a.shininess,e),f=JSM.ValueOrDefault(a.opacity,f),g=JSM.ValueOrDefault(a.texture,g),h=JSM.ValueOrDefault(a.textureWidth,h),l=JSM.ValueOrDefault(a.textureHeight,l));this.ambient=b;this.diffuse=c;this.specular=d;this.shininess=e;this.opacity=f;this.texture=g;this.textureWidth=h;this.textureHeight=
l};JSM.Materials=function(){this.materials=[];this.defaultMaterial=new JSM.Material};JSM.Materials.prototype.GetMaterial=function(a){return 0>a||a>=this.materials.length?this.defaultMaterial:this.materials[a]};JSM.Materials.prototype.AddMaterial=function(a){this.materials.push(a)};JSM.Materials.prototype.GetDefaultMaterial=function(){return this.defaultMaterial};JSM.Materials.prototype.Count=function(){return this.materials.length};
JSM.AddVertexToBody=function(a,b,c,d){a.AddVertex(new JSM.BodyVertex(new JSM.Coord(b,c,d)))};JSM.AddPolygonToBody=function(a,b){a.AddPolygon(new JSM.BodyPolygon(b))};JSM.CalculateBodyVertexToPolygon=function(a){var b=[],c,d;for(c=0;c<a.VertexCount();c++)b.push([]);var e;for(c=0;c<a.PolygonCount();c++){e=a.GetPolygon(c);for(d=0;d<e.VertexIndexCount();d++)b[e.GetVertexIndex(d)].push(c)}return b};
JSM.CalculateBodyPolygonNormal=function(a,b){var c=a.GetPolygon(b),d=c.VertexIndexCount(),e=new JSM.Vector(0,0,0);if(3<=d){var f,g,h;for(f=0;f<d;f++)g=f,h=(f+1)%d,g=a.GetVertexPosition(c.GetVertexIndex(g)),h=a.GetVertexPosition(c.GetVertexIndex(h)),e.x+=(g.y-h.y)*(g.z+h.z),e.y+=(g.z-h.z)*(g.x+h.x),e.z+=(g.x-h.x)*(g.y+h.y)}return JSM.VectorNormalize(e)};JSM.CalculateBodyPolygonNormals=function(a){var b=[],c;for(c=0;c<a.PolygonCount();c++)b.push(JSM.CalculateBodyPolygonNormal(a,c));return b};
JSM.CalculateBodyVertexNormals=function(a){var b=[],c=JSM.CalculateBodyPolygonNormals(a),d=null,e,f,g,h,l,k,m,n;for(e=0;e<a.PolygonCount();e++)if(h=a.GetPolygon(e),b[e]=[],h.HasCurveGroup()){null===d&&(d=JSM.CalculateBodyVertexToPolygon(a));for(f=0;f<h.VertexIndexCount();f++){l=new JSM.Vector(0,0,0);k=0;m=d[h.GetVertexIndex(f)];for(g=0;g<m.length;g++)n=a.GetPolygon(m[g]),n.GetCurveGroup()===h.GetCurveGroup()&&(l=JSM.CoordAdd(l,c[m[g]]),k++);l=JSM.VectorMultiply(l,1/k);l=JSM.VectorNormalize(l);b[e].push(l)}}else{g=
c[e];for(f=0;f<h.VertexIndexCount();f++)b[e].push(new JSM.Vector(g.x,g.y,g.z))}return b};JSM.MakeBodyInsideOut=function(a){var b,c,d,e,f;for(b=0;b<a.PolygonCount();b++){d=a.GetPolygon(b);f=d.vertices.slice(0);e=f.length;d.vertices=[];for(c=0;c<e;c++)d.vertices.push(f[e-c-1])}};
JSM.SoftMoveBodyVertex=function(a,b,c,d,e){b=a.GetVertex(b).position;var f=JSM.GetGaussianCParameter(c,e,0,1E-5),g,h,l;for(g=0;g<a.VertexCount();g++)h=JSM.CoordDistance(b,a.GetVertex(g).position),JSM.IsGreater(h,c)||(h=JSM.GetGaussianValue(h,e,0,f),l=a.GetVertex(g).position,a.GetVertex(g).position=JSM.CoordOffset(l,d,h))};
JSM.CalculatePolygonCentroid=function(a,b){var c=a.GetPolygon(b),d=c.VertexIndexCount(),e=new JSM.Coord(0,0,0),f;for(f=0;f<d;f++)e=JSM.CoordAdd(e,a.GetVertexPosition(c.GetVertexIndex(f)));return e=JSM.VectorMultiply(e,1/d)};
JSM.TriangulateWithCentroids=function(a){var b=new JSM.Body,c,d;for(c=0;c<a.VertexCount();c++)d=a.GetVertex(c).position,b.AddVertex(new JSM.BodyVertex(new JSM.Coord(d.x,d.y,d.z)));var e,f,g,h,l;for(c=0;c<a.PolygonCount();c++){d=JSM.CalculatePolygonCentroid(a,c);l=b.VertexCount();b.AddVertex(new JSM.BodyVertex(new JSM.Coord(d.x,d.y,d.z)));f=a.GetPolygon(c);g=f.VertexIndexCount();for(d=0;d<g;d++)e=f.GetVertexIndex(d),h=f.GetVertexIndex(d<g-1?d+1:0),e=new JSM.BodyPolygon([e,h,l]),e.material=f.material,
e.curved=f.curved,b.AddPolygon(e)}return b};
JSM.TriangulatePolygons=function(a){var b=new JSM.Body,c,d,e;for(c=0;c<a.VertexCount();c++)e=a.GetVertexPosition(c),b.AddVertex(new JSM.BodyVertex(new JSM.Coord(e.x,e.y,e.z)));var f,g;for(c=0;c<a.PolygonCount();c++){f=new JSM.Polygon;g=a.GetPolygon(c);for(d=0;d<g.VertexIndexCount();d++)e=a.GetVertexPosition(g.GetVertexIndex(d)),f.AddVertex(e.x,e.y,e.z);e=JSM.PolygonTriangulate(f);for(d=0;d<e.length;d++)f=e[d],f=new JSM.BodyPolygon([g.GetVertexIndex(f[0]),g.GetVertexIndex(f[1]),g.GetVertexIndex(f[2])]),
f.InheritAttributes(g),b.AddPolygon(f)}return b};JSM.GenerateRandomMaterials=function(a,b,c){var d,e;for(d=0;d<a.PolygonCount();d++)e=void 0!==c&&c?JSM.SeededRandomInt(0,16777215,d+1):JSM.RandomInt(0,16777215),b.AddMaterial(new JSM.Material({ambient:e,diffuse:e})),e=b.Count()-1,a.GetPolygon(d).SetMaterialIndex(e)};JSM.VertInfo=function(){this.edges=[];this.pgons=[]};JSM.EdgeInfo=function(){this.pgon2=this.pgon1=this.vert2=this.vert1=-1};JSM.PolyEdgeInfo=function(){this.index=-1;this.reverse=!1};
JSM.PgonInfo=function(){this.verts=[];this.pedges=[]};JSM.AdjacencyInfo=function(){this.verts=[];this.edges=[];this.pgons=[]};JSM.GetPolyEdgeStartVertex=function(a,b){return a.reverse?b.edges[a.index].vert2:b.edges[a.index].vert1};JSM.GetPolyEdgeEndVertex=function(a,b){return a.reverse?b.edges[a.index].vert1:b.edges[a.index].vert2};
JSM.CalculateAdjacencyInfo=function(a){var b=new JSM.AdjacencyInfo,c,d,e;for(c=0;c<a.VertexCount();c++)d=new JSM.VertInfo,b.verts.push(d);var f,g,h,l,k;for(c=0;c<a.PolygonCount();c++){f=a.GetPolygon(c);e=new JSM.PgonInfo;g=f.VertexIndexCount();for(d=0;d<g;d++){h=f.GetVertexIndex(d);l=f.GetVertexIndex(d<g-1?d+1:0);k=h;var m=l;l=c;for(var n=new JSM.PolyEdgeInfo,p=void 0,q=void 0,p=0;p<b.edges.length;p++)q=b.edges[p],q.vert1===k&&q.vert2===m?(n.index=p,n.reverse=!1):q.vert1===m&&q.vert2===k&&(n.index=
p,n.reverse=!0);-1===n.index?(p=new JSM.EdgeInfo,p.vert1=k,p.vert2=m,p.pgon1=l,p.pgon2=-1,b.edges.push(p),n.index=b.edges.length-1,n.reverse=!1):(k=b.edges[n.index],-1===k.pgon1?k.pgon1=l:k.pgon1!==l&&-1===k.pgon2&&(k.pgon2=l));k=n;e.verts.push(h);e.pedges.push(k);b.verts[h].edges.push(k.index);b.verts[h].pgons.push(c)}b.pgons.push(e)}return b};JSM.IsSolidBody=function(a){a=JSM.CalculateAdjacencyInfo(a);var b,c;for(b=0;b<a.edges.length;b++)if(c=a.edges[b],-1===c.pgon1||-1===c.pgon2)return!1;return!0};
JSM.CheckSolidBody=function(a){a=JSM.CalculateAdjacencyInfo(a);var b,c,d,e,f,g,h,l;for(b=0;b<a.edges.length;b++){d=a.edges[b];if(-1===d.pgon1||-1===d.pgon2)return!1;g=a.pgons[d.pgon1];f=!1;for(c=0;c<g.pedges.length;c++)if(e=g.pedges[c],e.index==b){h=e.reverse;f=!0;break}if(!f)return!1;d=a.pgons[d.pgon2];f=!1;for(c=0;c<d.pedges.length;c++)if(e=d.pedges[c],e.index==b){l=e.reverse;f=!0;break}if(!f||h==l)return!1}return!0};
JSM.CalculatePlanarTextureCoord=function(a,b){var c=new JSM.Coord2D(0,0),d=JSM.VectorNormalize(b.e1),e=JSM.VectorNormalize(b.e2),f=JSM.VectorCross(b.e1,b.e2),f=JSM.GetPlaneFromCoordAndDirection(b.origo,f),e=JSM.GetPlaneFromCoordAndDirection(b.origo,e),d=JSM.GetPlaneFromCoordAndDirection(b.origo,d),f=JSM.ProjectCoordToPlane(a,f);c.x=JSM.CoordPlaneSignedDistance(f,d);c.y=JSM.CoordPlaneSignedDistance(f,e);return c};
JSM.CalculateCubicTextureCoord=function(a,b,c){var d=new JSM.Coord2D(0,0),e=JSM.VectorNormalize(c.e1),f=JSM.VectorNormalize(c.e2),g=JSM.VectorNormalize(c.e3),h=-1,l=0,k,m,n;for(k=0;3>k;k++)0===k?m=e:1===k?m=f:2===k&&(m=g),n=Math.abs(JSM.VectorDot(b,m)),JSM.IsGreater(n,l)&&(h=k,l=n);if(-1===h)return d;b=null;0===h?b=new JSM.CoordSystem(c.origo,f,g,new JSM.Coord(0,0,0)):1===h?b=new JSM.CoordSystem(c.origo,e,g,new JSM.Coord(0,0,0)):2===h&&(b=new JSM.CoordSystem(c.origo,e,f,new JSM.Coord(0,0,0)));return null===
b?d:JSM.CalculatePlanarTextureCoord(a,b)};JSM.CalculateCylindricalTextureCoord=function(a,b,c){var d=new JSM.Coord2D(0,0),e=JSM.VectorNormalize(c.e3);if(JSM.VectorsAreCollinear(e,b))return d=JSM.CalculateCubicTextureCoord(a,b,c),[d,0];b=new JSM.Line(c.origo,e);var f=JSM.ProjectCoordToLine(a,b);b=JSM.CoordSignedDistance(c.origo,f,e);var g=JSM.VectorNormalize(c.e1);a=JSM.CoordSub(a,f);e=JSM.GetVectorsFullAngle(a,g,e);c=JSM.VectorLength(c.e1);d.x=e*c;d.y=b;return[d,e]};
JSM.CalculatePolygonPlanarTextureCoords=function(a,b){var c=[],d=a.GetPolygon(b),e=a.GetTextureProjectionCoords(),f,g;for(f=0;f<d.VertexIndexCount();f++)g=a.GetVertexPosition(d.GetVertexIndex(f)),c.push(JSM.CalculatePlanarTextureCoord(g,e));return c};JSM.CalculatePolygonCubicTextureCoords=function(a,b,c){var d=[];b=a.GetPolygon(b);var e=a.GetTextureProjectionCoords(),f,g;for(f=0;f<b.VertexIndexCount();f++)g=a.GetVertexPosition(b.GetVertexIndex(f)),d.push(JSM.CalculateCubicTextureCoord(g,c,e));return d};
JSM.CalculatePolygonCylindricalTextureCoords=function(a,b,c){var d=[],e=[],f=a.GetPolygon(b);b=a.GetTextureProjectionCoords();var g,h;for(g=0;g<f.VertexIndexCount();g++)h=a.GetVertexPosition(f.GetVertexIndex(g)),h=JSM.CalculateCylindricalTextureCoord(h,c,b),d.push(h[0]),e.push(h[1]);g=JSM.VectorNormalize(b.e3);if(JSM.VectorsAreCollinear(g,c))return d;a=!1;for(g=0;g<e.length;g++){for(c=g+1;c<e.length;c++)if(JSM.IsGreater(Math.abs(e[g]-e[c]),Math.PI)){a=!0;break}if(a)break}if(a){b=JSM.VectorLength(b.e1);
for(g=0;g<e.length;g++)JSM.IsLower(e[g],Math.PI)&&(d[g].x=b*(e[g]+2*Math.PI))}return d};JSM.CalculateBodyPlanarTextureCoords=function(a){var b=[],c;for(c=0;c<a.PolygonCount();c++)b.push(JSM.CalculatePolygonPlanarTextureCoords(a,c));return b};JSM.CalculateBodyCubicTextureCoords=function(a){var b=[],c=JSM.CalculateBodyPolygonNormals(a),d,e;for(d=0;d<a.PolygonCount();d++)e=c[d],b.push(JSM.CalculatePolygonCubicTextureCoords(a,d,e));return b};
JSM.CalculateBodyCylindricalTextureCoords=function(a){var b=[],c=JSM.CalculateBodyPolygonNormals(a),d,e;for(d=0;d<a.PolygonCount();d++)e=c[d],b.push(JSM.CalculatePolygonCylindricalTextureCoords(a,d,e));return b};JSM.CalculateBodyTextureCoords=function(a){var b=[],c=a.GetTextureProjectionType();"Planar"===c?b=JSM.CalculateBodyPlanarTextureCoords(a):"Cubic"===c?b=JSM.CalculateBodyCubicTextureCoords(a):"Cylindrical"===c&&(b=JSM.CalculateBodyCylindricalTextureCoords(a));return b};
JSM.CutBodyByPlane=function(a,b){function c(a,b,c){function d(a){q.push(new JSM.Coord(p.x,p.y,p.z));r.push(a)}function e(c,d){s=JSM.VectorNormalize(JSM.CoordSub(a[d],a[c]));M=new JSM.Line(a[c],s);w=JSM.LinePlaneIntersection(M,b);q.push(new JSM.Coord(w.x,w.y,w.z));r.push(-1)}var f=void 0!==c&&null!==c,g=a.length,h=[],k=[],l=!1,m,n,p;for(m=0;m<g;m++)p=a[m],n=JSM.CoordPlanePosition(p,b),k.push("CoordAtBackOfPlane"!==n),0<m&&k[m-1]!==k[m]&&(l=!0);if(!l){if(!1===k[0])return h;for(m=0;m<g;m++)p=a[m],h.push(new JSM.Coord(p.x,
p.y,p.z)),f&&c.push(m);return h}var q=[],r=[],s,M,w;for(m=0;m<g;m++)l=m-1,n=m,0===m&&(l=g-1),p=a[n],k[n]?(k[l]||e(l,n),d(n)):k[l]&&e(l,n);for(m=0;m<q.length;m++)g=q[m],k=h[h.length-1],0===m||!JSM.CoordIsEqual(k,g)?(h.push(new JSM.Coord(g.x,g.y,g.z)),f&&(g=r[m],c.push(g))):f&&(g=r[m],k=r[m-1],-1!==g?c[c.length-1]=g:-1!==k&&(c[c.length-1]=k));return h}function d(a){var b=-1,c;for(c=s;c<e.VertexCount();c++)if(JSM.CoordIsEqual(e.GetVertexPosition(c),a)){b=c;break}-1===b&&(b=e.AddVertex(new JSM.BodyVertex(new JSM.Coord(a.x,
a.y,a.z))));return b}var e=new JSM.Body,f=[],g=[],h=[],l=[],k,m,n,p,q;for(k=0;k<a.PolygonCount();k++){n=a.GetPolygon(k);p=[];for(m=0;m<n.VertexIndexCount();m++)q=a.GetVertexPosition(n.GetVertexIndex(m)),p.push(new JSM.Coord(q.x,q.y,q.z));q=[];p=c(p,b,q);for(m=0;m<q.length;m++)-1!==q[m]&&(h[n.GetVertexIndex(q[m])]=!0);f.push(p);g.push(q)}var r;for(k=0;k<a.VertexCount();k++)h[k]&&(r=a.GetVertexPosition(k),l[k]=e.AddVertex(new JSM.BodyVertex(new JSM.Coord(r.x,r.y,r.z))));var s=e.VertexCount();for(k=
0;k<a.PolygonCount();k++)if(n=a.GetPolygon(k),p=f[k],q=g[k],0!==q.length){h=[];for(m=0;m<q.length;m++)-1!==q[m]?h.push(l[n.GetVertexIndex(q[m])]):(r=p[m],h.push(d(r)));m=new JSM.BodyPolygon(h);m.InheritAttributes(n);e.AddPolygon(m)}return e};
JSM.GenerateRectangle=function(a,b){var c=new JSM.Body,d=a/2,e=b/2;c.AddVertex(new JSM.BodyVertex(new JSM.Coord(-d,-e,0)));c.AddVertex(new JSM.BodyVertex(new JSM.Coord(d,-e,0)));c.AddVertex(new JSM.BodyVertex(new JSM.Coord(d,e,0)));c.AddVertex(new JSM.BodyVertex(new JSM.Coord(-d,e,0)));c.AddPolygon(new JSM.BodyPolygon([0,1,2,3]));c.SetCubicTextureProjection(new JSM.Coord(-d,-e,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return c};
JSM.GenerateCuboid=function(a,b,c){var d=new JSM.Body;a/=2;b/=2;c/=2;d.AddVertex(new JSM.BodyVertex(new JSM.Coord(-a,-b,-c)));d.AddVertex(new JSM.BodyVertex(new JSM.Coord(a,-b,-c)));d.AddVertex(new JSM.BodyVertex(new JSM.Coord(a,-b,c)));d.AddVertex(new JSM.BodyVertex(new JSM.Coord(-a,-b,c)));d.AddVertex(new JSM.BodyVertex(new JSM.Coord(-a,b,-c)));d.AddVertex(new JSM.BodyVertex(new JSM.Coord(a,b,-c)));d.AddVertex(new JSM.BodyVertex(new JSM.Coord(a,b,c)));d.AddVertex(new JSM.BodyVertex(new JSM.Coord(-a,
b,c)));d.AddPolygon(new JSM.BodyPolygon([0,1,2,3]));d.AddPolygon(new JSM.BodyPolygon([1,5,6,2]));d.AddPolygon(new JSM.BodyPolygon([5,4,7,6]));d.AddPolygon(new JSM.BodyPolygon([4,0,3,7]));d.AddPolygon(new JSM.BodyPolygon([0,4,5,1]));d.AddPolygon(new JSM.BodyPolygon([3,2,6,7]));d.SetCubicTextureProjection(new JSM.Coord(-a,-b,-c),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return d};
JSM.GenerateCuboidSides=function(a,b,c,d){var e=new JSM.Body;a/=2;b/=2;c/=2;e.AddVertex(new JSM.BodyVertex(new JSM.Coord(-a,-b,-c)));e.AddVertex(new JSM.BodyVertex(new JSM.Coord(a,-b,-c)));e.AddVertex(new JSM.BodyVertex(new JSM.Coord(a,-b,c)));e.AddVertex(new JSM.BodyVertex(new JSM.Coord(-a,-b,c)));e.AddVertex(new JSM.BodyVertex(new JSM.Coord(-a,b,-c)));e.AddVertex(new JSM.BodyVertex(new JSM.Coord(a,b,-c)));e.AddVertex(new JSM.BodyVertex(new JSM.Coord(a,b,c)));e.AddVertex(new JSM.BodyVertex(new JSM.Coord(-a,
b,c)));d[0]&&e.AddPolygon(new JSM.BodyPolygon([0,1,2,3]));d[1]&&e.AddPolygon(new JSM.BodyPolygon([1,5,6,2]));d[2]&&e.AddPolygon(new JSM.BodyPolygon([5,4,7,6]));d[3]&&e.AddPolygon(new JSM.BodyPolygon([4,0,3,7]));d[4]&&e.AddPolygon(new JSM.BodyPolygon([0,4,5,1]));d[5]&&e.AddPolygon(new JSM.BodyPolygon([3,2,6,7]));e.SetCubicTextureProjection(new JSM.Coord(-a,-b,-c),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return e};
JSM.GenerateSegmentedRectangle=function(a,b,c,d){var e=new JSM.Body,f=a/2,g=b/2,h=a/c,l=b/d;(function(){var a,b,n;for(a=0;a<=d;a++)for(b=0;b<=c;b++)n=new JSM.Coord(b*h-f,a*l-g,0),e.AddVertex(new JSM.BodyVertex(n))})();(function(){var a,b,f,g,h,l;for(b=0;b<d;b++)for(a=0;a<c;a++)f=b*(c+1)+a,g=f+1,h=f+c+1,l=h+1,e.AddPolygon(new JSM.BodyPolygon([f,g,l,h]))})();return e};
JSM.GenerateSegmentedCuboid=function(a,b,c,d){function e(a){var b=0;0<a&&a<=d&&(b=(d+1)*(d+1)+(a-1)*4*d);return b}function f(a){var b=[],c=e(a);if(0===a||a===d){for(a=0;a<=d;a++)b.push(c+a);for(a=1;a<=d;a++)b.push(c+(a+1)*d+a);for(a=d-1;0<=a;a--)b.push(c+(d+1)*d+a);for(a=d-1;0<a;a--)b.push(c+a*(d+1))}else if(0<a&&a<d){for(a=0;a<=d;a++)b.push(c+a);for(a=1;a<d;a++)b.push(c+d+2*a);for(a=d;0<=a;a--)b.push(c+3*d+a-1);for(a=d-1;0<a;a--)b.push(c+d+2*a-1)}return b}function g(a){var b,c,e=a*r;if(0===a||a===
d)for(a=0;a<=d;a++)for(b=0;b<=d;b++)c=new JSM.Coord(b*p-k,a*q-m,e-n),l.AddVertex(new JSM.BodyVertex(c));else if(0<a&&a<d)for(a=0;a<=d;a++)for(b=0;b<=d;b++)if(0===a||a===d||0===b||b===d)c=new JSM.Coord(b*p-k,a*q-m,e-n),l.AddVertex(new JSM.BodyVertex(c))}function h(a){var b,c,f,g,h,k;if(0===a||a===d){var m=e(a);for(b=0;b<d;b++)for(c=0;c<d;c++)f=m+b*(d+1)+c,g=f+1,h=f+d+1,k=h+1,0===a?l.AddPolygon(new JSM.BodyPolygon([f,h,k,g])):l.AddPolygon(new JSM.BodyPolygon([f,g,k,h]))}if(0<a&&a<=d){c=s[a-1];a=s[a];
for(b=0;b<4*d;b++)f=c[b],h=a[b],b<4*d-1?(g=c[b+1],k=a[b+1]):(g=c[0],k=a[0]),l.AddPolygon(new JSM.BodyPolygon([f,g,k,h]))}}var l=new JSM.Body,k=a/2,m=b/2,n=c/2,p=a/d,q=b/d,r=c/d;for(a=0;a<=d;a++)g(a);var s=[];for(a=0;a<=d;a++)s.push(f(a));for(a=0;a<=d;a++)h(a);return l};
JSM.GenerateCircle=function(a,b){var c=new JSM.Body,d=JSM.GenerateCirclePoints(a,b),e;for(e=0;e<d.length;e++)c.AddVertex(new JSM.BodyVertex(d[e]));d=new JSM.BodyPolygon([]);for(e=0;e<b;e++)d.AddVertexIndex(e);c.AddPolygon(d);c.SetCylindricalTextureProjection(new JSM.Coord(0,0,0),a,new JSM.Coord(1,0,0),new JSM.Coord(0,0,1));return c};
JSM.GenerateSphere=function(a,b,c){var d=new JSM.Body,e=2*b,f=d.AddVertex(new JSM.BodyVertex(JSM.SphericalToCartesian(a,0,0))),g=Math.PI/b,h=g,l,k,m;for(l=1;l<b;l++){for(k=m=0;k<e;k++)d.AddVertex(new JSM.BodyVertex(JSM.SphericalToCartesian(a,h,m))),m+=g;h+=g}a=d.AddVertex(new JSM.BodyVertex(JSM.SphericalToCartesian(-a,0,0)));var n,p;for(l=1;l<=b;l++)if(1===l){g=1;for(k=0;k<e;k++)h=g+k,m=h+1,k===e-1&&(m=g),h=new JSM.BodyPolygon([h,m,f]),c&&h.SetCurveGroup(0),d.AddPolygon(h)}else if(l<b){g=(l-1)*e+
1;for(k=0;k<e;k++)h=g+k,m=h+1,n=h-e,p=n+1,k===e-1&&(m=g,p=g-e),h=new JSM.BodyPolygon([h,m,p,n]),c&&h.SetCurveGroup(0),d.AddPolygon(h)}else if(l===b){g=(l-2)*e+1;for(k=0;k<e;k++)h=g+k,m=h+1,k===e-1&&(m=g),h=new JSM.BodyPolygon([h,a,m]),c&&h.SetCurveGroup(0),d.AddPolygon(h)}d.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return d};
JSM.GenerateTriangulatedSphere=function(a,b,c){var d;d=new JSM.Body;var e=(1+Math.sqrt(5))/2;JSM.AddVertexToBody(d,0,1,+e);JSM.AddVertexToBody(d,0,1,-e);JSM.AddVertexToBody(d,0,-1,+e);JSM.AddVertexToBody(d,0,-1,-e);JSM.AddVertexToBody(d,1,+e,0);JSM.AddVertexToBody(d,1,-e,0);JSM.AddVertexToBody(d,-1,+e,0);JSM.AddVertexToBody(d,-1,-e,0);JSM.AddVertexToBody(d,+e,0,1);JSM.AddVertexToBody(d,-e,0,1);JSM.AddVertexToBody(d,+e,0,-1);JSM.AddVertexToBody(d,-e,0,-1);JSM.AddPolygonToBody(d,[0,2,8]);JSM.AddPolygonToBody(d,
[0,4,6]);JSM.AddPolygonToBody(d,[0,6,9]);JSM.AddPolygonToBody(d,[0,8,4]);JSM.AddPolygonToBody(d,[0,9,2]);JSM.AddPolygonToBody(d,[1,3,11]);JSM.AddPolygonToBody(d,[1,4,10]);JSM.AddPolygonToBody(d,[1,6,4]);JSM.AddPolygonToBody(d,[1,10,3]);JSM.AddPolygonToBody(d,[1,11,6]);JSM.AddPolygonToBody(d,[2,5,8]);JSM.AddPolygonToBody(d,[2,7,5]);JSM.AddPolygonToBody(d,[2,9,7]);JSM.AddPolygonToBody(d,[3,5,7]);JSM.AddPolygonToBody(d,[3,7,11]);JSM.AddPolygonToBody(d,[3,10,5]);JSM.AddPolygonToBody(d,[4,8,10]);JSM.AddPolygonToBody(d,
[6,11,9]);JSM.AddPolygonToBody(d,[5,10,8]);JSM.AddPolygonToBody(d,[7,9,11]);for(var e=JSM.VectorLength(d.GetVertexPosition(0)),f=a/e,g,h,e=0;e<d.VertexCount();e++)h=d.GetVertex(e),h.SetPosition(JSM.VectorMultiply(h.GetPosition(),f));for(var l,k,m,n,f=0;f<b;f++){g=d;d=new JSM.Body;h=JSM.CalculateAdjacencyInfo(g);for(e=0;e<h.verts.length;e++)l=g.GetVertexPosition(e),JSM.AddVertexToBody(d,l.x,l.y,l.z);l=[];for(e=0;e<h.edges.length;e++)k=h.edges[e],k=JSM.MidCoord(g.GetVertexPosition(k.vert1),g.GetVertexPosition(k.vert2)),
k=JSM.VectorMultiply(JSM.VectorNormalize(k),a),l.push(d.AddVertex(new JSM.BodyVertex(k)));for(e=0;e<h.pgons.length;e++){k=h.pgons[e];m=[];for(g=0;g<k.pedges.length;g++)n=k.pedges[g],m.push(JSM.GetPolyEdgeStartVertex(n,h)),m.push(l[n.index]);JSM.AddPolygonToBody(d,[m[0],m[1],m[5]]);JSM.AddPolygonToBody(d,[m[1],m[2],m[3]]);JSM.AddPolygonToBody(d,[m[3],m[4],m[5]]);JSM.AddPolygonToBody(d,[m[1],m[3],m[5]])}}if(c)for(e=0;e<d.PolygonCount();e++)d.GetPolygon(e).SetCurveGroup(0);d.SetCubicTextureProjection(new JSM.Coord(0,
0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return d};
JSM.GenerateCylinder=function(a,b,c,d,e){var f=new JSM.Body,g=2*Math.PI,h=2*Math.PI/c,l;for(l=0;l<c;l++)f.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(a,b/2,g))),f.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(a,-b/2,g))),g-=h;for(l=0;l<c;l++)g=2*l,h=g+2,l===c-1&&(h=0),g=new JSM.BodyPolygon([g,h,h+1,g+1]),e&&g.SetCurveGroup(0),f.AddPolygon(g);if(d){d=new JSM.BodyPolygon([]);e=new JSM.BodyPolygon([]);for(l=0;l<c;l++)d.AddVertexIndex(2*(c-l-1)),e.AddVertexIndex(2*l+1);f.AddPolygon(d);
f.AddPolygon(e)}f.SetCylindricalTextureProjection(new JSM.Coord(0,0,-(b/2)),a,new JSM.Coord(1,0,0),new JSM.Coord(0,0,1));return f};
JSM.GeneratePie=function(a,b,c,d,e,f){var g=new JSM.Body,h=c,l=c/(d-1);g.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(0,b/2,0)));g.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(0,-b/2,0)));for(c=0;c<d;c++)g.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(a,b/2,h))),g.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(a,-b/2,h))),h-=l;for(c=0;c<=d;c++)h=2*c,l=h+2,c===d&&(l=0),h=new JSM.BodyPolygon([h,l,l+1,h+1]),f&&(0<c&&c<d)&&h.SetCurveGroup(0),g.AddPolygon(h);if(e){e=
new JSM.BodyPolygon([]);f=new JSM.BodyPolygon([]);for(c=0;c<=d;c++)e.AddVertexIndex(2*(d-c)),f.AddVertexIndex(2*c+1);g.AddPolygon(e);g.AddPolygon(f)}g.SetCylindricalTextureProjection(new JSM.Coord(0,0,-(b/2)),a,new JSM.Coord(1,0,0),new JSM.Coord(0,0,1));return g};
JSM.GenerateCone=function(a,b,c,d,e,f){var g=new JSM.Body,h=JSM.IsZero(a),l=JSM.IsZero(b),k=2*Math.PI,m=2*Math.PI/d;h&&g.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(0,c/2,0)));var n;for(n=0;n<d;n++)h||g.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(a,c/2,k))),l||g.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(b,-c/2,k))),k-=m;l&&g.AddVertex(new JSM.BodyVertex(JSM.CylindricalToCartesian(0,-c/2,0)));for(n=0;n<d;n++)h?(k=n+1,m=k+1,n===d-1&&(m=1),k=new JSM.BodyPolygon([0,
m,k])):l?(k=n,m=k+1,n===d-1&&(m=0),k=new JSM.BodyPolygon([k,m,d])):(k=2*n,m=k+2,n===d-1&&(m=0),k=new JSM.BodyPolygon([k,m,m+1,k+1])),f&&k.SetCurveGroup(0),g.AddPolygon(k);if(e)if(h){f=new JSM.BodyPolygon([]);for(n=0;n<d;n++)f.AddVertexIndex(n+1);g.AddPolygon(f)}else if(l){e=new JSM.BodyPolygon([]);for(n=0;n<d;n++)e.AddVertexIndex(d-n-1);g.AddPolygon(e)}else{e=new JSM.BodyPolygon([]);f=new JSM.BodyPolygon([]);for(n=0;n<d;n++)e.AddVertexIndex(2*(d-n-1)),f.AddVertexIndex(2*n+1);g.AddPolygon(e);g.AddPolygon(f)}g.SetCylindricalTextureProjection(new JSM.Coord(0,
0,-(c/2)),(a+b)/2,new JSM.Coord(1,0,0),new JSM.Coord(0,0,1));return g};
JSM.GeneratePrism=function(a,b,c,d){var e=new JSM.Body,f=a.length,g;for(g=0;g<f;g++)e.AddVertex(new JSM.BodyVertex(a[g])),e.AddVertex(new JSM.BodyVertex(JSM.CoordOffset(a[g],b,c)));var h;for(g=0;g<f;g++)c=2*g,h=c+2,g===f-1&&(h=0),e.AddPolygon(new JSM.BodyPolygon([c,h,h+1,c+1]));if(d){d=new JSM.BodyPolygon([]);c=new JSM.BodyPolygon([]);for(g=0;g<f;g++)d.AddVertexIndex(2*g+1),c.AddVertexIndex(2*(f-g-1));e.AddPolygon(d);e.AddPolygon(c)}f=JSM.VectorNormalize(JSM.CoordSub(a[1],a[0]));a=new JSM.Coord(a[0].x,
a[0].y,a[0].z);b=JSM.VectorNormalize(b);f=JSM.VectorCross(b,f);g=JSM.VectorCross(f,b);e.SetCubicTextureProjection(a,g,f,b);return e};JSM.GenerateCurvedPrism=function(a,b,c,d,e){c=JSM.GeneratePrism(a,c,d,e);if(void 0===b||null===b||a.length!=b.length)return c;for(d=0;d<a.length;d++)e=b[d],c.GetPolygon(d).SetCurveGroup(e);return c};
JSM.GeneratePrismWithHole=function(a,b,c,d){function e(){var b=0,c=[],d;for(d=0;d<a.length;d++)null===a[d]&&(b+=1),c.push(d-b);var b=JSM.CreatePolygonWithHole(a),e=new JSM.Polygon,g;for(d=0;d<b.length;d++)g=a[b[d]],e.AddVertex(g.x,g.y,g.z);g=JSM.PolygonTriangulate(e);var h,l,x;for(d=0;d<g.length;d++){h=g[d];l=new JSM.BodyPolygon([]);x=new JSM.BodyPolygon([]);for(e=0;3>e;e++)l.AddVertexIndex(2*c[b[h[e]]]+1),x.AddVertexIndex(2*c[b[h[3-e-1]]]);f.AddPolygon(l);f.AddPolygon(x)}}var f=new JSM.Body;(function(){var d;
for(d=0;d<a.length;d++)null!==a[d]&&(f.AddVertex(new JSM.BodyVertex(a[d])),f.AddVertex(new JSM.BodyVertex(JSM.CoordOffset(a[d],b,c))))})();(function(){var b=0,c=[];c.push(0);var d;for(d=0;d<a.length;d++)null===a[d]&&(c.push(d-b),b+=1);c.push(d-b);for(b=0;b<c.length-1;b++){var e=d=void 0,g=void 0,h=c[b],l=c[b+1];for(d=h;d<l;d++)e=2*d,g=e+2,d===l-1&&(g=2*h),f.AddPolygon(new JSM.BodyPolygon([e,g,g+1,e+1]))}})();d&&e();var g=JSM.VectorNormalize(JSM.CoordSub(a[1],a[0]));d=new JSM.Coord(a[0].x,a[0].y,a[0].z);
var h=JSM.VectorNormalize(b),g=JSM.VectorCross(h,g),l=JSM.VectorCross(g,h);f.SetCubicTextureProjection(d,l,g,h);return f};JSM.GenerateCurvedPrismWithHole=function(a,b,c,d,e){c=JSM.GeneratePrismWithHole(a,c,d,e);if(void 0===b||null===b||a.length!=b.length)return c;d=0;var f;for(e=0;e<a.length;e++)f=b[e],null!==f&&(c.GetPolygon(d).SetCurveGroup(f),d++);return c};
JSM.GeneratePrismShell=function(a,b,c,d,e){var f=new JSM.Body,g=a.length,h;for(h=0;h<g;h++)f.AddVertex(new JSM.BodyVertex(a[h]));h=new JSM.Polygon;h.vertices=a;d=JSM.OffsetPolygonContour(h,d).vertices;for(h=0;h<g;h++)f.AddVertex(new JSM.BodyVertex(d[h]));var l;for(h=0;h<g;h++)l=JSM.CoordOffset(a[h],b,c),f.AddVertex(new JSM.BodyVertex(l));for(h=0;h<g;h++)l=JSM.CoordOffset(d[h],b,c),f.AddVertex(new JSM.BodyVertex(l));var k;for(h=0;h<g;h++)c=h,d=c+1,l=c+2*g,k=l+1,h===g-1&&(d=0,k=2*g),f.AddPolygon(new JSM.BodyPolygon([c,
d,k,l])),f.AddPolygon(new JSM.BodyPolygon([c+g,l+g,k+g,d+g]));if(e)for(h=0;h<g;h++)c=h,d=c+1,l=h+g,k=l+1,h===g-1&&(d=0,k=g),f.AddPolygon(new JSM.BodyPolygon([c,l,k,d])),f.AddPolygon(new JSM.BodyPolygon([c+2*g,d+2*g,k+2*g,l+2*g]));e=JSM.VectorNormalize(JSM.CoordSub(a[1],a[0]));a=new JSM.Coord(a[0].x,a[0].y,a[0].z);b=JSM.VectorNormalize(b);e=JSM.VectorCross(b,e);g=JSM.VectorCross(e,b);f.SetCubicTextureProjection(a,g,e,b);return f};
JSM.GenerateCylinderShell=function(a,b,c,d,e,f){for(var g=new JSM.Vector(0,0,1),h=-b/2,l=[],k=2*Math.PI/d,m,n=0,n=0;n<d;n++)m=n*k,m=JSM.PolarToCartesian(a,m),l.push(new JSM.Coord(m.x,m.y,h));a=JSM.GeneratePrismShell(l,g,b,c,e);if(f)for(f=0;f<d;f++)a.GetPolygon(2*f).SetCurveGroup(0),a.GetPolygon(2*f+1).SetCurveGroup(0);return a};
JSM.GenerateLineShell=function(a,b,c,d,e,f){var g=new JSM.Body,h=a.length,l=[],k,m,n,p,q,r;for(k=0;k<h;k++)0===k||k===h-1?q=Math.PI/2:(m=k-1,n=k,p=k+1,r=JSM.CoordSub(a[p],a[n]),q=JSM.CoordSub(a[m],a[n]),q=JSM.GetVectorsAngle(r,q)/2,"Clockwise"===JSM.CoordTurnType(a[m],a[n],a[p],b)&&(q=Math.PI-q)),l.push(q);r=new JSM.Vector(0,0,1);m=[];var s;for(k=0;k<h;k++)n=k,k===h-1?s=JSM.CoordSub(a[n-1],a[n]):(p=(k+1)%h,s=JSM.CoordSub(a[n],a[p])),q=l[n],p=d/Math.sin(q),p=JSM.CoordOffset(a[n],s,p),p=JSM.CoordRotate(p,
r,-(Math.PI-q),a[n]),m.push(p);for(k=0;k<h;k++)g.AddVertex(new JSM.BodyVertex(a[k]));for(k=0;k<h;k++)g.AddVertex(new JSM.BodyVertex(m[k]));for(k=0;k<h;k++)n=JSM.CoordOffset(a[k],b,c),g.AddVertex(new JSM.BodyVertex(n));for(k=0;k<h;k++)n=JSM.CoordOffset(m[k],b,c),g.AddVertex(new JSM.BodyVertex(n));for(k=0;k<h-1;k++)n=k,p=n+1,c=n+2*h,d=c+1,g.AddPolygon(new JSM.BodyPolygon([n,p,d,c])),g.AddPolygon(new JSM.BodyPolygon([n+h,c+h,d+h,p+h]));e&&(n=0,g.AddPolygon(new JSM.BodyPolygon([n,n+2*h,n+3*h,n+h])),n=
h-1,g.AddPolygon(new JSM.BodyPolygon([n,n+h,n+3*h,n+2*h])));if(f)for(k=0;k<h-1;k++)n=k,p=n+1,c=k+h,d=c+1,g.AddPolygon(new JSM.BodyPolygon([n,c,d,p])),g.AddPolygon(new JSM.BodyPolygon([n+2*h,p+2*h,d+2*h,c+2*h]));e=JSM.VectorNormalize(JSM.CoordSub(a[1],a[0]));a=new JSM.Coord(a[0].x,a[0].y,a[0].z);b=JSM.VectorNormalize(b);e=JSM.VectorCross(b,e);f=JSM.VectorCross(e,b);g.SetCubicTextureProjection(a,f,e,b);return g};
JSM.GenerateTorus=function(a,b,c,d,e){var f=new JSM.Body,g=0,h=2*Math.PI/d,l=[],k,m;for(k=0;k<d;k++)m=JSM.PolarToCartesian(b,g),m=new JSM.Coord(m.x+a,0,m.y),l.push(m),g+=h;b=new JSM.Coord(0,0,1);g=new JSM.Coord(0,0,0);h=2*Math.PI/c;for(k=0;k<c;k++)for(a=0;a<d;a++)m=JSM.CoordRotate(l[a],b,k*h,g),f.AddVertex(new JSM.BodyVertex(m));for(k=0;k<c;k++){new JSM.BodyPolygon([]);for(a=0;a<d;a++)h=k*d+a,b=h+d,l=h+1,g=b+1,a===d-1&&(l=k*d,g=(k+1)*d),k===c-1&&(b=a,g=a+1,a===d-1&&(g=0)),h=new JSM.BodyPolygon([h,
b,g,l]),e&&h.SetCurveGroup(0),f.AddPolygon(h)}f.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return f};
JSM.GeneratePolyTorus=function(a,b,c,d){var e=new JSM.Body,f=a.length,g=2*Math.PI/f,h=[],l;for(l=0;l<f;l++)g=a[l],g=new JSM.Coord(g.x+b,0,g.y),h.push(g);b=new JSM.Coord(0,0,1);var k=new JSM.Coord(0,0,0),g=2*Math.PI/c,m;for(l=0;l<c;l++)for(a=0;a<f;a++)m=JSM.CoordRotate(h[a],b,l*g,k),e.AddVertex(new JSM.BodyVertex(m));for(l=0;l<c;l++){new JSM.BodyPolygon([]);for(a=0;a<f;a++)h=l*f+a,b=h+f,g=h+1,k=b+1,a===f-1&&(g=l*f,k=(l+1)*f),l===c-1&&(b=a,k=a+1,a===f-1&&(k=0)),h=new JSM.BodyPolygon([h,b,k,g]),d&&h.SetCurveGroup(a),
e.AddPolygon(h)}e.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return e};
JSM.GenerateRuledFromSectors=function(a,b,c,d,e){var f=new JSM.Body,g=[],h=[];JSM.GetSectorSegmentation(a,c,g);JSM.GetSectorSegmentation(b,c,h);b=[];a=[];JSM.GetRuledMesh(g,h,d,b,a);for(d=0;d<b.length;d++)f.AddVertex(new JSM.BodyVertex(b[d]));for(d=0;d<a.length;d++)g=a[d],g=new JSM.BodyPolygon(g),e&&g.SetCurveGroup(0),f.AddPolygon(g);f.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return f};
JSM.GenerateGrid=function(a,b,c,d,e){var f=new JSM.Sector(new JSM.Coord(0,0,0),new JSM.Coord(a,0,0));a=new JSM.Sector(new JSM.Coord(0,b,0),new JSM.Coord(a,b,0));return JSM.GenerateRuledFromSectors(f,a,c,d,e)};JSM.GenerateSquareGrid=function(a,b,c){return JSM.GenerateGrid(a,a,b,b,c)};
JSM.GenerateRuledFromSectorsWithHeight=function(a,b,c,d,e,f){var g=new JSM.Body,h=[],l=[];JSM.GetSectorSegmentation(a,c,h);JSM.GetSectorSegmentation(b,c,l);b=[];a=[];JSM.GetRuledMesh(h,l,d,b,a);for(h=0;h<b.length;h++)g.AddVertex(new JSM.BodyVertex(b[h]));for(var k,h=0;h<a.length;h++)k=a[h],k=new JSM.BodyPolygon(k),e&&k.SetCurveGroup(0),g.AddPolygon(k);l=g.VertexCount();for(h=0;h<b.length;h++)k=b[h],k=new JSM.Coord(k.x,k.y,k.z),k.z-=f,g.AddVertex(new JSM.BodyVertex(k));for(h=0;h<a.length;h++){k=a[h];
b=[];for(f=k.length-1;0<=f;f--)b.push(k[f]+l);k=new JSM.BodyPolygon(b);e&&k.SetCurveGroup(0);g.AddPolygon(k)}for(h=0;h<d;h++)e=h+l,f=e+1,a=e-l,b=a+1,k=new JSM.BodyPolygon([e,f,b,a]),g.AddPolygon(k);for(h=0;h<d;h++)e=h+c*(d+1)+l,f=e+1,a=e-l,b=a+1,k=new JSM.BodyPolygon([e,a,b,f]),g.AddPolygon(k);for(h=0;h<c;h++)e=h*(d+1)+l,f=e+d+1,a=e-l,b=a+d+1,k=new JSM.BodyPolygon([e,a,b,f]),g.AddPolygon(k);for(h=0;h<c;h++)e=(h+1)*d+h+l,f=e+d+1,a=e-l,b=a+d+1,k=new JSM.BodyPolygon([e,f,b,a]),g.AddPolygon(k);g.SetCubicTextureProjection(new JSM.Coord(0,
0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return g};JSM.GenerateRuledFromCoords=function(a,b,c,d){var e=new JSM.Body,f=[],g=[];JSM.GetRuledMesh(a,b,c,f,g);for(a=0;a<f.length;a++)e.AddVertex(new JSM.BodyVertex(f[a]));for(a=0;a<g.length;a++)f=g[a],f=new JSM.BodyPolygon(f),d&&f.SetCurveGroup(0),e.AddPolygon(f);e.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return e};
JSM.GenerateRevolved=function(a,b,c,d,e,f){var g=new JSM.Body,h=JSM.IsEqual(c,2*Math.PI),l=a.length,k=c/d;c=JSM.CoordSub(b.end,b.beg);var m,n,p;for(m=0;m<l;m++)for(n=0;n<=d;n++)h&&n===d||(p=JSM.CoordRotate(a[m],c,n*k,b.beg),g.AddVertex(new JSM.BodyVertex(p)));var q,r;for(m=0;m<l-1;m++)for(n=0;n<d;n++)k=m*(d+1)+n,p=k+d+1,q=k+1,r=p+1,h&&(k=m*d+n,p=k+d,q=k+1,r=p+1,n===d-1&&(q=m*d,r=(m+1)*d)),k=new JSM.BodyPolygon([k,q,r,p]),f&&k.SetCurveGroup(m),g.AddPolygon(k);if(h&&e){e=new JSM.BodyPolygon([]);f=new JSM.BodyPolygon([]);
for(m=0;m<d;m++)e.AddVertexIndex(d*(l-1)+m),f.AddVertexIndex(d-m-1);g.AddPolygon(e);g.AddPolygon(f)}e=new JSM.Line(b.beg,JSM.VectorNormalize(c));for(m=d=0;m<l;m++)f=JSM.ProjectCoordToLine(a[m],e),d+=JSM.CoordDistance(f,a[m]);d/=l;b=new JSM.Coord(b.beg.x,b.beg.y,b.beg.z);l=JSM.VectorNormalize(c);c=new JSM.Line(b,c);c=JSM.ProjectCoordToLine(a[0],c);a=JSM.VectorNormalize(JSM.CoordSub(a[0],c));g.SetCylindricalTextureProjection(b,d,a,l);return g};
JSM.GenerateTube=function(a,b){var c=new JSM.Body,d=a.length,e=a[0].length,f,g;for(g=0;g<e;g++)for(f=0;f<d;f++)c.AddVertex(new JSM.BodyVertex(a[f][g]));var h,l;for(g=0;g<d-1;g++)for(f=0;f<e;f++)h=g+d*f,l=h+d,f===e-1&&(l=g),c.AddPolygon(new JSM.BodyPolygon([h,l,l+1,h+1]));if(b){g=new JSM.BodyPolygon([]);h=new JSM.BodyPolygon([]);for(f=0;f<e;f++)g.AddVertexIndex(d*f+d-1);for(f=e-1;0<=f;f--)h.AddVertexIndex(d*f);c.AddPolygon(g);c.AddPolygon(h)}c.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,
0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return c};JSM.GenerateFunctionSurface=function(a,b,c,d,e){var f=new JSM.Sector(new JSM.Coord(b.x,b.y,0),new JSM.Coord(c.x,b.y,0));b=new JSM.Sector(new JSM.Coord(b.x,c.y,0),new JSM.Coord(c.x,c.y,0));d=JSM.GenerateRuledFromSectors(f,b,d,d,e);for(e=0;e<d.VertexCount();e++)f=d.GetVertexPosition(e),f.z=a(f.x,f.y);d.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return d};
JSM.GenerateFunctionSurfaceSolid=function(a,b,c,d,e,f){var g=new JSM.Sector(new JSM.Coord(c.x,b.y,0),new JSM.Coord(b.x,b.y,0));b=new JSM.Sector(new JSM.Coord(c.x,c.y,0),new JSM.Coord(b.x,c.y,0));e=JSM.GenerateRuledFromSectorsWithHeight(g,b,d,d,e,f);g=(d+1)*(d+1);for(d=0;d<g;d++)f=e.GetVertexPosition(d),f.z=a(f.x,f.y);e.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return e};
JSM.Camera=function(a,b,c,d,e,f){this.eye=JSM.ValueOrDefault(a,new JSM.Coord(1,1,1));this.center=JSM.ValueOrDefault(b,new JSM.Coord(0,0,0));this.up=JSM.ValueOrDefault(c,new JSM.Vector(0,0,1));this.fieldOfView=JSM.ValueOrDefault(d,45);this.nearClippingPlane=JSM.ValueOrDefault(e,0.1);this.farClippingPlane=JSM.ValueOrDefault(f,1E3)};
JSM.Camera.prototype.Set=function(a,b,c,d,e,f){this.eye=a;this.center=b;this.up=c;this.fieldOfView=JSM.ValueOrDefault(d,45);this.nearClippingPlane=JSM.ValueOrDefault(e,0.1);this.farClippingPlane=JSM.ValueOrDefault(f,1E3)};JSM.Camera.prototype.Clone=function(){var a=new JSM.Camera;a.eye=this.eye;a.center=this.center;a.up=this.up;a.fieldOfView=this.fieldOfView;a.nearClippingPlane=this.nearClippingPlane;a.farClippingPlane=this.farClippingPlane;return a};
JSM.ExplodeBodyToTriangles=function(a,b,c){if(void 0===c||null===c)return!1;var d=JSM.CalculateBodyVertexNormals(a),e,f,g=!1;if(void 0!==b&&null!==b)for(e=0;e<b.Count();e++)if(null!==b.GetMaterial(e).texture){g=!0;break}var h,l;if(g){h=JSM.CalculateBodyTextureCoords(a);for(e=0;e<h.length;e++)if(f=a.GetPolygon(e),f.HasMaterialIndex()){l=b.GetMaterial(f.GetMaterialIndex());for(f=0;f<h[e].length;f++)h[e][f].x/=l.textureWidth,h[e][f].y/=-l.textureHeight}}var k=!0;void 0!==c.hasConvexPolygons&&null!==
c.hasConvexPolygons&&(k=c.hasConvexPolygons);(function(a,b,c,d,e){function f(h,l){var t=b.GetMaterial(l);if(void 0!==e.onGeometryStart&&null!==e.onGeometryStart)e.onGeometryStart(t);var x;for(x=0;x<h.length;x++){var s=h[x],v=a.GetPolygon(s),y=v.VertexIndexCount();if(!(3>y)){var D=void 0,A=void 0,B=void 0,K=void 0,L=void 0,M=void 0,w=void 0,G=void 0,N=void 0,E=void 0;if(3==y||k)for(E=0;E<y-2;E++){if(D=a.GetVertex(v.GetVertexIndex(0)).position,A=a.GetVertex(v.GetVertexIndex((E+1)%y)).position,B=a.GetVertex(v.GetVertexIndex((E+
2)%y)).position,K=c[s][0],L=c[s][(E+1)%y],M=c[s][(E+2)%y],N=G=w=null,g&&(w=d[s][0],G=d[s][(E+1)%y],N=d[s][(E+2)%y]),void 0!==e.onTriangle&&null!==e.onTriangle)e.onTriangle(D,A,B,K,L,M,w,G,N)}else{D=new JSM.Polygon;A=void 0;for(E=0;E<y;E++)A=a.GetVertex(v.vertices[E]),D.AddVertex(A.position.x,A.position.y,A.position.z);for(var E=JSM.CalculateBodyPolygonNormal(a,s),y=JSM.PolygonTriangulate(D,E),O=void 0,E=0;E<y.length;E++)if(O=y[E],D=a.GetVertex(v.GetVertexIndex(O[0])).position,A=a.GetVertex(v.GetVertexIndex(O[1])).position,
B=a.GetVertex(v.GetVertexIndex(O[2])).position,K=c[s][O[0]],L=c[s][O[1]],M=c[s][O[2]],N=G=w=null,g&&(w=d[s][O[0]],G=d[s][O[1]],N=d[s][O[2]]),void 0!==e.onTriangle&&null!==e.onTriangle)e.onTriangle(D,A,B,K,L,M,w,G,N)}}}if(void 0!==e.onGeometryEnd&&null!==e.onGeometryEnd)e.onGeometryEnd(t)}var h,l=[],t=[];if(void 0===b||null===b)b=new JSM.Materials;for(h=0;h<b.Count();h++)l[h]=[];var y;for(h=0;h<a.PolygonCount();h++)y=a.GetPolygon(h),y.HasMaterialIndex()?(y=y.GetMaterialIndex(),l[y].push(h)):t.push(h);
for(h=0;h<l.length;h++)y=l[h],0!==y.length&&f(y,h);0!==t.length&&f(t,-1)})(a,b,d,h,c);return!0};
JSM.ExportBodyContentToStl=function(a,b,c){function d(a){g+=a+"\n"}function e(a,b,c,e){d("\tfacet normal "+a.x+" "+a.y+" "+a.z);d("\t\touter loop");d("\t\t\tvertex "+b.x+" "+b.y+" "+b.z);d("\t\t\tvertex "+c.x+" "+c.y+" "+c.z);d("\t\t\tvertex "+e.x+" "+e.y+" "+e.z);d("\t\tendloop");d("\tendfacet")}function f(b){var d=a.GetPolygon(b),f=d.VertexIndexCount();if(!(3>f)){var g,n,p,q=null;if(3===f)q=JSM.CalculateBodyPolygonNormal(a,b),g=a.GetVertex(d.GetVertexIndex(0)).position,n=a.GetVertex(d.GetVertexIndex(1)).position,
p=a.GetVertex(d.GetVertexIndex(2)).position,e(q,g,n,p);else if(g=!0,void 0!==c&&c&&(g=!1),q=JSM.CalculateBodyPolygonNormal(a,b),g){g=new JSM.Polygon;for(b=0;b<f;b++)n=a.GetVertex(d.vertices[b]),g.AddVertex(n.position.x,n.position.y,n.position.z);f=JSM.PolygonTriangulate(g,q);for(b=0;b<f.length;b++)p=f[b],g=a.GetVertex(d.GetVertexIndex(p[0])).position,n=a.GetVertex(d.GetVertexIndex(p[1])).position,p=a.GetVertex(d.GetVertexIndex(p[2])).position,e(q,g,n,p)}else for(b=0;b<f-2;b++)g=a.GetVertex(d.GetVertexIndex(0)).position,
n=a.GetVertex(d.GetVertexIndex((b+1)%f)).position,p=a.GetVertex(d.GetVertexIndex((b+2)%f)).position,e(q,g,n,p)}}var g="";for(b=0;b<a.PolygonCount();b++)f(b);return g};JSM.ExportBodyToStl=function(a,b,c){a=""+("solid "+b+"\n")+JSM.ExportBodyContentToStl(a,b,c);return a+="endsolid "+b+"\n"};JSM.ExportModelToStl=function(a,b,c){var d;d=""+("solid "+b+"\n");var e,f;for(e=0;e<a.BodyCount();e++)f=a.GetBody(e),d+=JSM.ExportBodyContentToStl(f,b+(e+1).toString(),c);return d+("endsolid "+b+"\n")};
JSM.ExportBodyContentToObj=function(a,b,c){function d(b){b=a.GetVertex(b).position;g+="v "+b.x+" "+b.y+" "+b.z+"\n"}function e(b){b=JSM.CalculateBodyPolygonNormal(a,b);g+="vn "+b.x+" "+b.y+" "+b.z+"\n"}function f(d){var e=a.GetPolygon(d);g+="f ";var f;for(f=0;f<e.VertexIndexCount();f++){var h=b+e.GetVertexIndex(f)+1+"//"+(c+d+1)+" ";g+=h}g+="\n"}var g="",h;for(h=0;h<a.VertexCount();h++)d(h);for(h=0;h<a.PolygonCount();h++)e(h);for(h=0;h<a.PolygonCount();h++)f(h);return g};
JSM.ExportBodyToObj=function(a){return JSM.ExportBodyContentToObj(a,0,0)};JSM.ExportModelToObj=function(a){var b="",c=0,d=0,e,f;for(e=0;e<a.BodyCount();e++)f=a.GetBody(e),b+=JSM.ExportBodyContentToObj(f,c,d),c+=f.VertexCount(),d+=f.PolygonCount();return b};
JSM.ExportMaterialsToGdl=function(a){function b(a,b){var d=JSM.HexColorToRGBComponents(a.diffuse);c+='define material "material'+b+'" 2, '+(d[0]/255+","+d[1]/255+","+d[2]/255)+" ! "+b+"\n"}var c="",d=!1;void 0!==a&&null!==a&&(d=!0);if(d){b(a.GetDefaultMaterial(),1);for(d=0;d<a.Count();d++)b(a.GetMaterial(d),d+2)}return c};
JSM.ExportBodyGeometryToGdl=function(a,b){function c(a){if(200<a.length){var b=0,c,d;for(c=0;c<a.length;c++)d=a[c],h+=d,b++,200<b&&","==d&&(h+="\n",b=0)}else h+=a}function d(a){c(a+"\n")}function e(b){var c=a.GetVertex(b).position;d("vert "+c.x+", "+c.y+", "+c.z+" ! "+(b+1))}function f(b){var c=l.edges[b],e=0;-1!=c.pgon1&&-1!=c.pgon2&&a.GetPolygon(c.pgon1).HasCurveGroup()&&a.GetPolygon(c.pgon2).HasCurveGroup()&&a.GetPolygon(c.pgon1).GetCurveGroup()==a.GetPolygon(c.pgon2).GetCurveGroup()&&(e=2);d("edge "+
(c.vert1+1)+", "+(c.vert2+1)+", -1, -1, "+e+" ! "+(b+1))}function g(e,f){var g=-1;b&&(g=a.GetPolygon(e).GetMaterialIndex()+2,g!=f&&d('set material "material'+g+'"'));var h=l.pgons[e],k=0;a.GetPolygon(e).HasCurveGroup()&&(k=2);c("pgon "+h.pedges.length+", 0, "+k+", ");var k="",m,v;for(m=0;m<h.pedges.length;m++)v=h.pedges[m],k=v.reverse?k+-(v.index+1):k+(v.index+1),m<h.pedges.length-1&&(k+=", ");c(k);c(" ! "+(e+1));d("");return g}var h="";d("base");var l=JSM.CalculateAdjacencyInfo(a),k;for(k=0;k<l.verts.length;k++)e(k);
for(k=0;k<l.edges.length;k++)f(k);var m=-1;for(k=0;k<l.pgons.length;k++)m=g(k,m);d("body -1");return h};JSM.ExportBodyToGdl=function(a,b){var c="",d=!1;void 0!==b&&null!==b&&(c+=JSM.ExportMaterialsToGdl(b),d=!0);return c+=JSM.ExportBodyGeometryToGdl(a,d)};JSM.ExportModelToGdl=function(a,b){var c="",d=!1;void 0!==b&&null!==b&&(c+=JSM.ExportMaterialsToGdl(b),d=!0);var e,f;for(e=0;e<a.BodyCount();e++)f=a.GetBody(e),c+=JSM.ExportBodyGeometryToGdl(f,d);return c};
JSM.TriangleBody=function(a){this.name=a;this.vertices=[];this.normals=[];this.triangles=[]};JSM.TriangleBody.prototype.SetName=function(a){this.name=a};JSM.TriangleBody.prototype.GetName=function(){return this.name};JSM.TriangleBody.prototype.AddVertex=function(a,b,c){this.vertices.push(new JSM.Coord(a,b,c));return this.vertices.length-1};JSM.TriangleBody.prototype.GetVertex=function(a){return this.vertices[a]};
JSM.TriangleBody.prototype.SetVertex=function(a,b,c,d){this.vertices[a]=new JSM.Coord(b,c,d)};JSM.TriangleBody.prototype.VertexCount=function(){return this.vertices.length};JSM.TriangleBody.prototype.AddNormal=function(a,b,c){this.normals.push(new JSM.Coord(a,b,c));return this.normals.length-1};JSM.TriangleBody.prototype.GetNormal=function(a){return this.normals[a]};JSM.TriangleBody.prototype.NormalCount=function(){return this.normals.length};
JSM.TriangleBody.prototype.AddTriangle=function(a,b,c,d,e,f,g,h,l,k,m){this.triangles.push({v0:a,v1:b,v2:c,n0:d,n1:e,n2:f,u0:g,u1:h,u2:l,mat:k,curve:m});return this.triangles.length-1};JSM.TriangleBody.prototype.GetTriangle=function(a){return this.triangles[a]};JSM.TriangleBody.prototype.TriangleCount=function(){return this.triangles.length};
JSM.TriangleBody.prototype.Finalize=function(a){function b(b,c,d,f){function g(a,b,c,d,e){var f=new JSM.Vector(0,0,0),h=0;c=a.GetTriangle(c);b=e[b];var k,l;for(e=0;e<b.length;e++)k=b[e],l=a.GetTriangle(k),c.curve==l.curve&&(f=JSM.CoordAdd(f,d[k]),h+=1);f=JSM.VectorMultiply(f,1/h);f=JSM.VectorNormalize(f);return a.AddNormal(f.x,f.y,f.z)}var p=b.triangles[e];void 0===p.mat&&(p.mat=a.AddDefaultMaterial());if(void 0===p.n0||void 0===p.n1||void 0===p.n2)void 0===p.curve||0===p.curve?(c=d[e],b=b.AddNormal(c.x,
c.y,c.z),p.n0=b,p.n1=b,p.n2=b):(p.n0=g(b,p.v0,c,d,f),p.n1=g(b,p.v1,c,d,f),p.n2=g(b,p.v2,c,d,f))}var c=[],d={},e;for(e=0;e<this.vertices.length;e++)d[e]=[];var f,g;for(e=0;e<this.triangles.length;e++)f=this.triangles[e],g=JSM.CalculateTriangleNormal(this.vertices[f.v0],this.vertices[f.v1],this.vertices[f.v2]),c.push(g),d[f.v0].push(e),d[f.v1].push(e),d[f.v2].push(e);for(e=0;e<this.triangles.length;e++)b(this,e,c,d)};
JSM.TriangleBody.prototype.Clone=function(){var a=new JSM.TriangleBody(this.name),b,c;for(b=0;b<this.vertices.length;b++)a.vertices.push(this.vertices[b].Clone());for(b=0;b<this.normals.length;b++)a.normals.push(this.normals[b].Clone());for(b=0;b<this.triangles.length;b++)c=this.triangles[b],a.triangles.push({v0:c.v0,v1:c.v1,v2:c.v2,n0:c.n0,n1:c.n1,n2:c.n2,u0:c.u0,u1:c.u1,u2:c.u2,mat:c.mat,curve:c.curve});return a};
JSM.TriangleModel=function(){this.materials=[];this.bodies=[];this.defaultMaterial=-1};JSM.TriangleModel.prototype.AddMaterial=function(a,b,c,d,e){this.materials.push({name:a,ambient:b,diffuse:c,specular:d,opacity:e});return this.materials.length-1};JSM.TriangleModel.prototype.GetMaterial=function(a){return this.materials[a]};
JSM.TriangleModel.prototype.AddDefaultMaterial=function(){-1==this.defaultMaterial&&(this.materials.push({name:"Default",ambient:{r:0.5,g:0.5,b:0.5},diffuse:{r:0.5,g:0.5,b:0.5},specular:{r:0.1,g:0.1,b:0.1},opacity:1}),this.defaultMaterial=this.materials.length-1);return this.defaultMaterial};JSM.TriangleModel.prototype.GetDefaultMaterialIndex=function(){return this.AddDefaultMaterial()};JSM.TriangleModel.prototype.MaterialCount=function(){return this.materials.length};
JSM.TriangleModel.prototype.AddBody=function(a){this.bodies.push(a);return this.bodies.length-1};JSM.TriangleModel.prototype.AddBodyToIndex=function(a,b){this.bodies.splice(b,0,a);return b};JSM.TriangleModel.prototype.GetBody=function(a){return this.bodies[a]};JSM.TriangleModel.prototype.BodyCount=function(){return this.bodies.length};JSM.TriangleModel.prototype.GetBody=function(a){return this.bodies[a]};
JSM.TriangleModel.prototype.Finalize=function(){var a,b;for(a=0;a<this.bodies.length;a++)b=this.bodies[a],b.Finalize(this)};JSM.BinaryReader=function(a,b){this.arrayBuffer=a;this.dataView=new DataView(a);this.isLittleEndian=b;this.position=0};JSM.BinaryReader.prototype.GetPosition=function(){return this.position};JSM.BinaryReader.prototype.GetByteLength=function(){return this.arrayBuffer.byteLength};JSM.BinaryReader.prototype.Skip=function(a){this.position+=a};
JSM.BinaryReader.prototype.End=function(){return this.position>=this.arrayBuffer.byteLength};JSM.BinaryReader.prototype.ReadBoolean=function(){var a=this.dataView.getInt8(this.position,this.isLittleEndian);this.position+=1;return a?!0:!1};JSM.BinaryReader.prototype.ReadCharacter=function(){var a=this.dataView.getInt8(this.position,this.isLittleEndian);this.position+=1;return a};
JSM.BinaryReader.prototype.ReadUnsignedCharacter=function(){var a=this.dataView.getUint8(this.position,this.isLittleEndian);this.position+=1;return a};JSM.BinaryReader.prototype.ReadInteger16=function(){var a=this.dataView.getInt16(this.position,this.isLittleEndian);this.position+=2;return a};JSM.BinaryReader.prototype.ReadUnsignedInteger16=function(){var a=this.dataView.getUint16(this.position,this.isLittleEndian);this.position+=2;return a};
JSM.BinaryReader.prototype.ReadInteger32=function(){var a=this.dataView.getInt32(this.position,this.isLittleEndian);this.position+=4;return a};JSM.BinaryReader.prototype.ReadUnsignedInteger32=function(){var a=this.dataView.getUint32(this.position,this.isLittleEndian);this.position+=4;return a};JSM.BinaryReader.prototype.ReadFloat32=function(){var a=this.dataView.getFloat32(this.position,this.isLittleEndian);this.position+=4;return a};
JSM.BinaryReader.prototype.ReadDouble64=function(){var a=this.dataView.getFloat64(this.position,this.isLittleEndian);this.position+=8;return a};JSM.GetArrayBufferFromURL=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="arraybuffer";c.onload=function(){var a=c.response;a&&b(a)};c.send(null)};JSM.GetArrayBufferFromFile=function(a,b){var c=new FileReader;c.onloadend=function(a){a.target.readyState==FileReader.DONE&&b(a.target.result)};c.readAsArrayBuffer(a)};
JSM.GetStringBufferFromURL=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="text";c.onload=function(){var a=c.response;a&&b(a)};c.send(null)};JSM.LoadMultipleBuffers=function(a,b,c,d,e){c>=a.length?e(b):d(a[c],function(f){b.push(f);JSM.LoadMultipleBuffers(a,b,c+1,d,e)})};JSM.GetStringBufferFromFile=function(a,b){var c=new FileReader;c.onloadend=function(a){a.target.readyState==FileReader.DONE&&b(a.target.result)};c.readAsText(a)};
JSM.GetStringBuffersFromURLList=function(a,b){JSM.LoadMultipleBuffers(a,[],0,JSM.GetStringBufferFromURL,function(a){b(a)})};JSM.GetStringBuffersFromFileList=function(a,b){JSM.LoadMultipleBuffers(a,[],0,JSM.GetStringBufferFromFile,function(a){b(a)})};
JSM.ConvertTriangleModelToJsonData=function(a){function b(a,b,c){var d=[],e=a.MaterialCount(),f;for(a=0;a<b.VertexCount();a++)f=b.GetVertex(a),c.vertices.push(f.x,f.y,f.z);for(a=0;a<b.NormalCount();a++)f=b.GetNormal(a),c.normals.push(f.x,f.y,f.z);c.uvs.push(0,0);for(a=0;a<e;a++)d.push([]);for(a=0;a<b.TriangleCount();a++)f=b.GetTriangle(a),void 0===f.mat||(0>f.mat||f.mat>=e)||d[f.mat].push(a);var p,q;for(a=0;a<d.length;a++)if(p=d[a],0!==p.length){q={material:a,parameters:[]};for(e=0;e<p.length;e++)f=
b.GetTriangle(p[e]),q.parameters.push(f.v0,f.v1,f.v2,f.n0,f.n1,f.n2,0,0,0);c.triangles.push(q)}}var c={version:1,materials:[],meshes:[]};(function(a,b){var c,d;for(c=0;c<a.MaterialCount();c++)d=a.GetMaterial(c),b.push({name:d.name,ambient:[d.ambient.r,d.ambient.g,d.ambient.b],diffuse:[d.diffuse.r,d.diffuse.g,d.diffuse.b],specular:[d.specular.r,d.specular.g,d.specular.b],opacity:d.opacity})})(a,c.materials);var d,e,f;for(d=0;d<a.BodyCount();d++)e=a.GetBody(d),0!==e.TriangleCount()&&(f={name:e.GetName(),
vertices:[],normals:[],uvs:[],triangles:[]},b(a,e,f),c.meshes.push(f));return c};
JSM.MergeJsonDataMeshes=function(a){function b(a,b,c){function d(a,b,c){var h=b.material,l=c[h];void 0===l&&(a.triangles.push({material:h,parameters:[]}),l=a.triangles.length-1,c[h]=l);a=a.triangles[l].parameters;for(c=0;c<b.parameters.length;c+=9)a.push(b.parameters[c]+e,b.parameters[c+1]+e,b.parameters[c+2]+e,b.parameters[c+3]+f,b.parameters[c+4]+f,b.parameters[c+5]+f,b.parameters[c+6]+g,b.parameters[c+7]+g,b.parameters[c+8]+g)}var e=a.vertices.length/3,f=a.normals.length/3,g=a.uvs.length/2;(function(a,
b){var c;for(c=0;c<b.vertices.length;c++)a.vertices.push(b.vertices[c]);for(c=0;c<b.normals.length;c++)a.normals.push(b.normals[c]);for(c=0;c<b.uvs.length;c++)a.uvs.push(b.uvs[c])})(a,b);var r,s;for(r=0;r<b.triangles.length;r++)s=b.triangles[r],d(a,s,c)}var c={version:a.version,materials:a.materials,meshes:[]},d={name:"Merged",vertices:[],normals:[],uvs:[],triangles:[]},e={},f,g;for(f=0;f<a.meshes.length;f++)g=a.meshes[f],b(d,g,e);c.meshes.push(d);return c};
JSM.Read3dsFile=function(a,b){var c,d,e,f,g,h,l,k,m,n,p,q,r,s,x,v,t,y,F,C,u,H,z,I,J,D,A,B,K,L,M;function w(a,c){if(void 0!==b.onLog&&null!==b.onLog)b.onLog(a,c)}function G(a){for(var b="",c=0,d=0;64>d;){c=a.ReadCharacter();if(0===c)break;b+=String.fromCharCode(c);d+=1}return b}function N(a){var b=[],c;for(c=0;3>c;c++)b[c]=a.ReadFloat32();return b}function E(a,b,c){for(;a.GetPosition()<=b-6;){var d=a,e=c,f=d.ReadUnsignedInteger16(),d=d.ReadUnsignedInteger32();e(f,d)}}if(void 0===b||null===b)b={};c=
15677;d=45055;e=40960;f=40976;g=40992;h=41008;l=41024;k=41040;m=16;n=17;p=18;q=19;r=48;s=49;x=16384;v=16640;t=17920;y=18176;F=16656;C=16672;u=16736;H=16688;z=16720;I=45056;J=45058;D=45072;A=45075;B=45088;K=45089;L=45090;M=45104;(function(a){function P(a,b,c){var d={};b=a.GetPosition()+c-6;var e=!1;E(a,b,function(b,c){b==n?e||(d.r=a.ReadUnsignedCharacter()/255,d.g=a.ReadUnsignedCharacter()/255,d.b=a.ReadUnsignedCharacter()/255):b==p?(d.r=a.ReadUnsignedCharacter()/255,d.g=a.ReadUnsignedCharacter()/
255,d.b=a.ReadUnsignedCharacter()/255,e=!0):b==m?e||(d.r=a.ReadFloat32(),d.g=a.ReadFloat32(),d.b=a.ReadFloat32()):b==q?(d.r=a.ReadFloat32(),d.g=a.ReadFloat32(),d.b=a.ReadFloat32(),e=!0):a.Skip(c-6)});return d}function Q(a,b,c){var d=0;b=a.GetPosition()+c-6;E(a,b,function(b,c){b==r?d=a.ReadUnsignedInteger16()/100:b==s?d=a.ReadFloat32():a.Skip(c-6)});return d}function R(a,c,d){w("Read material chunk ("+c.toString(16)+", "+d+")",2);var m={},n=a.GetPosition()+d-6;E(a,n,function(b,n){b==e?(w("Read material name chunk ("+
c.toString(16)+", "+d+")",3),m.name=G(a)):b==f?(w("Read material ambient chunk ("+c.toString(16)+", "+d+")",3),m.ambient=P(a,b,n)):b==g?(w("Read material diffuse chunk ("+c.toString(16)+", "+d+")",3),m.diffuse=P(a,b,n)):b==h?(w("Read material specular chunk ("+c.toString(16)+", "+d+")",3),m.specular=P(a,b,n)):b==l?(w("Read material shininess chunk ("+c.toString(16)+", "+d+")",3),m.shininess=Q(a,b,n)):b==k?(w("Read material transparency chunk ("+c.toString(16)+", "+d+")",3),m.transparency=Q(a,b,n)):
(w("Skip chunk ("+b.toString(16)+", "+n+")",3),a.Skip(n-6))});if(void 0!==b.onMaterial&&null!==b.onMaterial)b.onMaterial(m)}function S(a,c,d){w("Read faces chunk ("+c.toString(16)+", "+d+")",4);c=a.GetPosition()+d-6;var e=a.ReadUnsignedInteger16(),f,g,h,l;for(d=0;d<e;d++)if(f=a.ReadUnsignedInteger16(),g=a.ReadUnsignedInteger16(),h=a.ReadUnsignedInteger16(),l=a.ReadUnsignedInteger16(),void 0!==b.onFace&&null!==b.onFace)b.onFace(f,g,h,l);E(a,c,function(c,d){if(c==H){w("Read face materials chunk ("+
c.toString(16)+", "+d+")",5);var f=G(a),g=a.ReadUnsignedInteger16(),h,l;for(h=0;h<g;h++)if(l=a.ReadUnsignedInteger16(),void 0!==b.onFaceMaterial&&null!==b.onFaceMaterial)b.onFaceMaterial(l,f)}else if(c==z){w("Read face smoothing groups chunk ("+c.toString(16)+", "+d+")",5);for(f=0;f<e;f++)if(g=a.ReadUnsignedInteger32(),void 0!==b.onFaceSmoothingGroup&&null!==b.onFaceSmoothingGroup)b.onFaceSmoothingGroup(f,g)}else w("Skip chunk ("+c.toString(16)+", "+d+")",5),a.Skip(d-6)})}function T(a,c,d,e){w("Read mesh chunk ("+
c+", "+d.toString(16)+", "+e+")",3);if(void 0!==b.onMesh&&null!==b.onMesh)b.onMesh(c);c=a.GetPosition()+e-6;E(a,c,function(c,d){if(c==F){w("Read vertices chunk ("+c.toString(16)+", "+d+")",4);var e=a.ReadUnsignedInteger16(),f,g,h,l;for(f=0;f<e;f++)if(g=a.ReadFloat32(),h=a.ReadFloat32(),l=a.ReadFloat32(),void 0!==b.onVertex&&null!==b.onVertex)b.onVertex(g,h,l)}else if(c==C)S(a,c,d);else if(c==u){w("Read transformation chunk ("+c.toString(16)+", "+d+")",4);e=[];for(f=0;4>f;f++){for(g=0;3>g;g++)e.push(a.ReadFloat32());
3>f?e.push(0):e.push(1)}if(void 0!==b.onTransformation&&null!==b.onTransformation)b.onTransformation(e)}else w("Skip chunk ("+c.toString(16)+", "+d+")",4),a.Skip(d-6)})}function U(a,b,c){w("Read object chunk ("+b.toString(16)+", "+c+")",2);b=a.GetPosition()+c-6;var d=G(a);E(a,b,function(b,c){b==v?T(a,d,b,c):(b==t?w("Skip light chunk ("+d+", "+b.toString(16)+", "+c+")",3):b==y?w("Skip camera chunk ("+d+", "+b.toString(16)+", "+c+")",3):w("Skip chunk ("+b.toString(16)+", "+c+")",3),a.Skip(c-6))})}function V(a,
b,c){w("Read editor chunk ("+b.toString(16)+", "+c+")",1);b=a.GetPosition()+c-6;E(a,b,function(b,c){b==d?R(a,b,c):b==x?U(a,b,c):(w("Skip chunk ("+b.toString(16)+", "+c+")",2),a.Skip(c-6))})}function W(a,c,d){function e(a,b){var c=[];a.Skip(10);var d,f,g,h=a.ReadInteger32();for(d=0;d<h;d++)a.ReadInteger32(),f=a.ReadUnsignedInteger16(),0!==f&&a.ReadFloat32(),b==K?(g=a.ReadFloat32(),f=N(a),f[3]=g):f=N(a),c.push(f);return c}w("Read object node chunk ("+c.toString(16)+", "+d+")",2);var f={name:"",nodeId:-1,
flags:-1,userId:-1,pivot:[0,0,0],positions:[],rotations:[],scales:[]};c=a.GetPosition()+d-6;E(a,c,function(b,c){b==D?(f.name=G(a),f.flags=a.ReadUnsignedInteger32(),f.userId=a.ReadUnsignedInteger16()):b==A?f.pivot=N(a):b==B?f.positions=e(a,B):b==K?f.rotations=e(a,K):b==L?f.scales=e(a,L):b==M?f.nodeId=a.ReadUnsignedInteger16():(w("Skip chunk ("+b.toString(16)+", "+c+")",3),a.Skip(c-6))});if(void 0!==b.onObjectNode&&null!==b.onObjectNode)b.onObjectNode(f)}function X(a,b,c){w("Read keyframe chunk ("+
b.toString(16)+", "+c+")",1);b=a.GetPosition()+c-6;E(a,b,function(b,c){b==J?W(a,b,c):(w("Skip chunk ("+b.toString(16)+", "+c+")",2),a.Skip(c-6))})}function Y(a,b,d){w("Read main chunk ("+b.toString(16)+", "+d+")",0);b=a.GetPosition()+d-6;E(a,b,function(b,d){b==c?V(a,b,d):b==I?X(a,b,d):(w("Skip chunk ("+b.toString(16)+", "+d+")",1),a.Skip(d-6))})}var Z=a.GetByteLength();E(a,Z,function(b,c){19789==b?Y(a,b,c):(w("Skip chunk ("+b.toString(16)+", "+c+")",0),a.Skip(c-6))})})(new JSM.BinaryReader(a,!0))};
JSM.Convert3dsToJsonData=function(a){var b=new JSM.TriangleModel,c=null,d={},e={},f={nodes:[],nodeIdToIndex:{}};JSM.Read3dsFile(a,{onMaterial:function(a){function c(a){return void 0===a||null===a?{r:0,g:0,b:0}:a}var e=b.AddMaterial(a.name,c(a.ambient),c(a.diffuse),c(a.specular),void 0===a.transparency||null===a.transparency?1:1-a.transparency);void 0===d[a.name]&&(d[a.name]=e)},onMesh:function(a){var d=b.AddBody(new JSM.TriangleBody(a));c=b.GetBody(d);c.meshData={faceToMaterial:{},faceToSmoothingGroup:{},
objectNodes:[],transformation:null};e[a]=d},onTransformation:function(a){null!==c&&(c.meshData.transformation=a)},onObjectNode:function(a){var c=f.nodes.length;f.nodes.push(a);f.nodeIdToIndex[a.nodeId]=c;a=e[a.name];void 0!==a&&b.GetBody(a).meshData.objectNodes.push(c)},onVertex:function(a,b,d){null!==c&&c.AddVertex(a,b,d)},onFace:function(a,b,d){null!==c&&c.AddTriangle(a,b,d)},onFaceMaterial:function(a,b){null!==c&&(c.meshData.faceToMaterial[a]=b)},onFaceSmoothingGroup:function(a,b){null!==c&&(c.meshData.faceToSmoothingGroup[a]=
b)}});(function(a,b,c){function d(a,b,c){function e(a,b){var c=b[0],d=b[1],f=b[2],g;for(g=0;4>g;g++)a[0+g]*=c,a[4+g]*=d,a[8+g]*=f;return a}function f(a,b){var c=b[0],d=b[1],e=b[2],g;for(g=0;3>g;g++)a[12+g]+=a[0+g]*c+a[4+g]*d+a[8+g]*e;return a}function g(a,b){var c,d;for(c=0;c<a.VertexCount();c++)d=a.GetVertex(c),d=JSM.ApplyTransformation(b,d),a.SetVertex(c,d.x,d.y,d.z)}function h(a,b,c){var d=JSM.MatrixDeterminant(b);JSM.IsNegative(d)&&(b=JSM.MatrixClone(b),e(b,[-1,1,1]),c=JSM.MatrixMultiply(c,b),
g(a,c))}function l(a,b){if(void 0!==a.matrix)return a.matrix;var c=JSM.MatrixIdentity(),d;d=0===a.positions.length?[0,0,0]:a.positions[0];c=f(c,d);if(0===a.rotations.length)d=[0,0,0,0];else{d=a.rotations[0];var g=[0,0,0,1],h=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);JSM.IsPositive(h)&&(g=-0.5*d[3],h=Math.sin(g)/h,g=[h*d[0],h*d[1],h*d[2],Math.cos(g)]);d=g}d=JSM.MatrixRotationQuaternion(d);c=JSM.MatrixMultiply(d,c);d=0===a.scales.length?[0,0,0,0]:a.scales[0];c=e(c,d);65535!=a.userId&&(d=b.nodeIdToIndex[a.userId],
void 0!==d&&(d=l(b.nodes[d],b),c=JSM.MatrixMultiply(c,d)));return a.matrix=c}var k=a.meshData;k=void 0===k||null===k?null:k.transformation;if(null!==k){var m=null,m=null!==b?l(b,c):k;c=JSM.MatrixClone(m);m=JSM.MatrixClone(k);k=JSM.MatrixInvert(m);null!==k&&(h(a,m,k),b=void 0===b||null===b?[0,0,0]:b.pivot,f(c,[-b[0],-b[1],-b[2]]),b=JSM.MatrixMultiply(k,c),g(a,b))}}function e(a,b,c,f){d(a,b,f);b=a.meshData;var g,h;for(f=0;f<a.TriangleCount();f++)g=a.GetTriangle(f),h=b.faceToMaterial[f],void 0!==h&&
(h=c[h],void 0!==h&&(g.mat=h)),h=b.faceToSmoothingGroup[f],void 0!==h&&(g.curve=h)}function f(a,b,c,d){b=b.Clone();b.SetName(b.GetName()+" ("+d+")");c<a.BodyCount()?a.AddBodyToIndex(b,c):a.AddBody(b);return b}var p,q,r,s,x,v,t;for(p=0;p<b.BodyCount();p++)if(r=b.GetBody(p),s=r.meshData,0===s.objectNodes.length)e(r,null,c,a);else{v=a.nodes[s.objectNodes[0]];for(q=1;q<s.objectNodes.length;q++)x=a.nodes[s.objectNodes[q]],t=f(b,r,p+1,q+1),t.meshData=r.meshData,e(t,x,c,a),p+=1;e(r,v,c,a)}})(f,b,d);b.Finalize();
return JSM.ConvertTriangleModelToJsonData(b)};
JSM.ReadObjFile=function(a,b){function c(a){a=a.split("\n");var e,f;for(e=0;e<a.length;e++){var g=f=a[e].trim();if(0!==g.length&&"#"!=g[0]&&(f=g.split(/\s+/),!(0===f.length||"#"==f[0][0]))){var h=void 0,h=void 0;if("g"==f[0]){if(!(2>f.length)){g="";for(h=1;h<f.length;h++)g+=f[h],h<f.length-1&&(g+=" ");if(void 0!==b.onMesh&&null!==b.onMesh)b.onMesh(g)}}else if("v"==f[0]){if(!(4>f.length)&&(h=parseFloat(f[1]),g=parseFloat(f[2]),f=parseFloat(f[3]),void 0!==b.onVertex&&null!==b.onVertex))b.onVertex(h,
g,f)}else if("vn"==f[0]){if(!(4>f.length)&&(h=parseFloat(f[1]),g=parseFloat(f[2]),f=parseFloat(f[3]),void 0!==b.onNormal&&null!==b.onNormal))b.onNormal(h,g,f)}else if("f"==f[0]){if(!(4>f.length)){for(var g=[],l=[],k=void 0,h=1;h<f.length;h++)k=f[h].split("/"),g.push(parseInt(k[0],10)-1),2<k.length&&0<k[2].length&&l.push(parseInt(k[2],10)-1);if(void 0!==b.onFace&&null!==b.onFace)b.onFace(g,l)}}else if("usemtl"==f[0]){if(!(2>f.length)&&void 0!==b.onUseMaterial&&null!==b.onUseMaterial)b.onUseMaterial(f[1])}else if("newmtl"==
f[0]){if(!(2>f.length)&&void 0!==b.onNewMaterial&&null!==b.onNewMaterial)b.onNewMaterial(f[1])}else if("Ka"==f[0]||"Kd"==f[0]||"Ks"==f[0]){if(!(4>f.length)&&(h=parseFloat(f[1]),g=parseFloat(f[2]),l=parseFloat(f[3]),void 0!==b.onMaterialComponent&&null!==b.onMaterialComponent))b.onMaterialComponent(f[0],h,g,l)}else if("Ka"==f[0]||"Kd"==f[0]||"Ks"==f[0]){if(!(4>f.length)&&(h=parseFloat(f[1]),g=parseFloat(f[2]),l=parseFloat(f[3]),void 0!==b.onMaterialComponent&&null!==b.onMaterialComponent))b.onMaterialComponent(f[0],
h,g,l)}else"mtllib"==f[0]&&!(2>f.length)&&(f=g.indexOf("mtllib")+6,h=g.substr(f,g.length-f).trim(),f=h.trim(),f=void 0!==b.onFileRequested&&null!==b.onFileRequested?b.onFileRequested(f):null,null!==f&&c(f))}}}c(a)};
JSM.ConvertObjToJsonData=function(a,b){var c=new JSM.TriangleModel,d=c.AddBody(new JSM.TriangleBody("Default")),e=c.GetBody(d),f={},g=null,h=null,l=[],k=[];JSM.ReadObjFile(a,{onNewMaterial:function(a){var b=c.AddMaterial(a,{r:1,g:0,b:0},{r:1,g:0,b:0},{r:0,g:0,b:0},1);g=c.GetMaterial(b);f[a]=b},onMaterialComponent:function(a,b,c,d){null!==g&&("Ka"==a?(a=g.ambient,a.r=b,a.g=c,a.b=d):"Kd"==a?(a=g.diffuse,a.r=b,a.g=c,a.b=d):"Ks"==a&&(a=g.specular,a.r=b,a.g=c,a.b=d))},onUseMaterial:function(a){a=f[a];
void 0!==a&&(h=a)},onMesh:function(a){a=c.AddBody(new JSM.TriangleBody(a));e=c.GetBody(a)},onVertex:function(a,b,c){l.push(new JSM.Coord(a,b,c))},onNormal:function(a,b,c){k.push(new JSM.Coord(a,b,c))},onFace:function(a,b){var c,d,f=a.length==b.length,g=a.length;for(c=0;c<g-2;c++)d=e.AddTriangle(a[0],a[(c+1)%g],a[(c+2)%g]),d=e.GetTriangle(d),f&&(d.n0=b[0],d.n1=b[(c+1)%g],d.n2=b[(c+2)%g]),null!==h&&(d.mat=h)},onFileRequested:function(a){return void 0!==b.onFileRequested&&null!==b.onFileRequested?b.onFileRequested(a):
null}});(function(a,b,c){function d(a,b,c,e,f){if(void 0!==c){var g=e[c];if(void 0!==g)return g;b=b[c];0===f?g=a.AddVertex(b.x,b.y,b.z):1===f&&(g=a.AddNormal(b.x,b.y,b.z));return e[c]=g}}var e,f,g,h,l,k;for(e=0;e<a.BodyCount();e++){g=a.GetBody(e);l={};k={};for(f=0;f<g.TriangleCount();f++)h=g.GetTriangle(f),h.v0=d(g,b,h.v0,l,0),h.v1=d(g,b,h.v1,l,0),h.v2=d(g,b,h.v2,l,0),h.n0=d(g,c,h.n0,k,1),h.n1=d(g,c,h.n1,k,1),h.n2=d(g,c,h.n2,k,1)}})(c,l,k);c.Finalize();return JSM.ConvertTriangleModelToJsonData(c)};
JSM.ReadBinaryStlFile=function(a,b){function c(a){var b=[],c;for(c=0;3>c;c++)b[c]=a.ReadFloat32();return b}var d=new JSM.BinaryReader(a,!0);d.Skip(80);var e=d.ReadUnsignedInteger32(),f,g,h,l,k;for(f=0;f<e;f++)if(k=c(d),g=c(d),h=c(d),l=c(d),d.Skip(2),void 0!==b.onFace&&null!==b.onFace)b.onFace(g,h,l,k)};
JSM.ReadAsciiStlFile=function(a,b){function c(a,c){var d=a[c].trim();if(0===d.length)return c+1;d=d.split(/\s+/);if(0===d.length)return c+1;if("solid"!=d[0]&&"facet"==d[0]&&"normal"==d[1]){if(5>d.length)return-1;var d=[parseFloat(d[2]),parseFloat(d[3]),parseFloat(d[4])],e=[],k,m;for(k=c+1;k<a.length&&3>e.length;k++)if(m=a[k].trim(),0!==m.length&&(m=m.split(/\s+/),0!==m.length&&"vertex"==m[0]))if(4>m.length)break;else m=[parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3])],e.push(m);k+=1;if(3!=e.length)return-1;
if(void 0!==b.onFace&&null!==b.onFace)b.onFace(e[0],e[1],e[2],d);return k}return c+1}for(var d=0,e=a.split("\n");d<e.length&&-1!=d;)d=c(e,d)};
JSM.ConvertStlToJsonData=function(a){var b=new JSM.TriangleModel,c=b.AddBody(new JSM.TriangleBody("Default")),d=b.GetBody(c);(function(a){var b=a.byteLength;if(84>b)return!1;a=new JSM.BinaryReader(a,!0);a.Skip(80);a=a.ReadUnsignedInteger32();return b!=50*a+84?!1:!0})(a)?JSM.ReadBinaryStlFile(a,{onFace:function(a,b,c,h){a=d.AddVertex(a[0],a[1],a[2]);b=d.AddVertex(b[0],b[1],b[2]);c=d.AddVertex(c[0],c[1],c[2]);h=JSM.VectorNormalize(new JSM.Vector(h[0],h[1],h[2]));h=d.AddNormal(h.x,h.y,h.z);d.AddTriangle(a,
b,c,h,h,h)}}):(a=String.fromCharCode.apply(null,new Uint8Array(a)),JSM.ReadAsciiStlFile(a,{onFace:function(a,b,c,h){a=d.AddVertex(a[0],a[1],a[2]);b=d.AddVertex(b[0],b[1],b[2]);c=d.AddVertex(c[0],c[1],c[2]);h=JSM.VectorNormalize(new JSM.Vector(h[0],h[1],h[2]));h=d.AddNormal(h.x,h.y,h.z);d.AddTriangle(a,b,c,h,h,h)}}));b.Finalize();return JSM.ConvertTriangleModelToJsonData(b)};JSM.ImportFileList=function(){this.descriptors=null};
JSM.ImportFileList.prototype.Init=function(a){this.descriptors=[];var b,c;for(b=0;b<a.length;b++)c=a[b],c={originalObject:c,originalFileName:c.name,fileName:c.name.toUpperCase(),extension:this.GetFileExtension(c.name)},this.descriptors.push(c)};JSM.ImportFileList.prototype.GetFileDescriptor=function(a){return this.descriptors[a]};
JSM.ImportFileList.prototype.GetMainFileIndex=function(a){var b;for(a=0;a<this.descriptors.length;a++)if(b=this.descriptors[a],this.IsSupportedExtension(b.extension))return a;return-1};JSM.ImportFileList.prototype.GetFileIndexByName=function(a){var b,c;for(b=0;b<this.descriptors.length;b++)if(c=this.descriptors[b],c.fileName==a.toUpperCase())return b;return-1};JSM.ImportFileList.prototype.IsSupportedExtension=function(a){return".3DS"==a||".OBJ"==a||".STL"==a?!0:!1};
JSM.ImportFileList.prototype.GetFileExtension=function(a){var b=a.lastIndexOf(".");if(-1==b)return"";a=a.substr(b);return a=a.toUpperCase()};
JSM.ConvertFileListToJsonData=function(a,b){function c(a,c){if(void 0!==b.onReady&&null!==b.onReady)b.onReady(a,c)}var d=new JSM.ImportFileList;d.Init(a);var e=d.GetMainFileIndex();if(-1===e){if(void 0!==b.onError&&null!==b.onError)b.onError()}else{var f=d.GetFileDescriptor(e),g={main:f.originalFileName,requested:[],missing:[]};".3DS"==f.extension?JSM.GetArrayBufferFromFile(f.originalObject,function(a){a=JSM.Convert3dsToJsonData(a);c(g,a)}):".OBJ"==f.extension?JSM.GetStringBuffersFromFileList(a,function(a){var b=
JSM.ConvertObjToJsonData(a[e],{onFileRequested:function(b){var c=d.GetFileIndexByName(b);if(-1==c)return g.missing.push(b),null;g.requested.push(b);return a[c]}});c(g,b)}):".STL"==f.extension&&JSM.GetArrayBufferFromFile(f.originalObject,function(a){a=JSM.ConvertStlToJsonData(a);c(g,a)})}};
JSM.GenerateSolidWithRadius=function(a,b){var c=new JSM.Body,d=!0;"Tetrahedron"===a?c=JSM.GenerateTetrahedron():"Hexahedron"===a?c=JSM.GenerateHexahedron():"Octahedron"===a?c=JSM.GenerateOctahedron():"Dodecahedron"===a?c=JSM.GenerateDodecahedron():"Icosahedron"===a?c=JSM.GenerateIcosahedron():"TruncatedTetrahedron"===a?c=JSM.GenerateTruncatedTetrahedron():"Cuboctahedron"===a?c=JSM.GenerateCuboctahedron():"TruncatedCube"===a?c=JSM.GenerateTruncatedCube():"TruncatedOctahedron"===a?c=JSM.GenerateTruncatedOctahedron():
"Rhombicuboctahedron"===a?c=JSM.GenerateRhombicuboctahedron():"TruncatedCuboctahedron"===a?c=JSM.GenerateTruncatedCuboctahedron():"SnubCube"===a?c=JSM.GenerateSnubCube():"Icosidodecahedron"===a?c=JSM.GenerateIcosidodecahedron():"TruncatedDodecahedron"===a?c=JSM.GenerateTruncatedDodecahedron():"TruncatedIcosahedron"===a?c=JSM.GenerateTruncatedIcosahedron():"Rhombicosidodecahedron"===a?c=JSM.GenerateRhombicosidodecahedron():"TruncatedIcosidodecahedron"===a?c=JSM.GenerateTruncatedIcosidodecahedron():
"SnubDodecahedron"===a?c=JSM.GenerateSnubDodecahedron():"TetrakisHexahedron"===a?(c=JSM.GenerateTetrakisHexahedron(),d=!1):"RhombicDodecahedron"===a?(c=JSM.GenerateRhombicDodecahedron(),d=!1):"PentakisDodecahedron"===a?(c=JSM.GeneratePentakisDodecahedron(),d=!1):"SmallStellatedDodecahedron"===a?(c=JSM.GenerateSmallStellatedDodecahedron(),d=!1):"GreatDodecahedron"===a?(c=JSM.GenerateGreatDodecahedron(),d=!1):"SmallTriambicIcosahedron"===a?(c=JSM.GenerateSmallTriambicIcosahedron(),d=!1):"GreatStellatedDodecahedron"===
a?(c=JSM.GenerateGreatStellatedDodecahedron(),d=!1):"SmallTriakisOctahedron"===a?(c=JSM.GenerateSmallTriakisOctahedron(),d=!1):"StellaOctangula"===a?(c=JSM.GenerateStellaOctangula(),d=!1):"TriakisTetrahedron"===a&&(c=JSM.GenerateTriakisTetrahedron(),d=!1);if(0<c.VertexCount()){var e=0;if(d)e=JSM.VectorLength(c.GetVertexPosition(0));else for(var f,d=0;d<c.VertexCount();d++)f=JSM.VectorLength(c.GetVertexPosition(d)),JSM.IsGreater(f,e)&&(e=f);e=b/e;for(d=0;d<c.VertexCount();d++)f=c.GetVertex(d),f.SetPosition(JSM.VectorMultiply(f.GetPosition(),
e))}return c};JSM.GenerateTetrahedron=function(){var a=new JSM.Body;a.AddVertex(new JSM.BodyVertex(new JSM.Coord(1,1,1)));a.AddVertex(new JSM.BodyVertex(new JSM.Coord(-1,-1,1)));a.AddVertex(new JSM.BodyVertex(new JSM.Coord(-1,1,-1)));a.AddVertex(new JSM.BodyVertex(new JSM.Coord(1,-1,-1)));a.AddPolygon(new JSM.BodyPolygon([0,1,3]));a.AddPolygon(new JSM.BodyPolygon([0,2,1]));a.AddPolygon(new JSM.BodyPolygon([0,3,2]));a.AddPolygon(new JSM.BodyPolygon([1,2,3]));return a};
JSM.GenerateHexahedron=function(){var a=new JSM.Body;JSM.AddVertexToBody(a,1,1,1);JSM.AddVertexToBody(a,1,1,-1);JSM.AddVertexToBody(a,1,-1,1);JSM.AddVertexToBody(a,-1,1,1);JSM.AddVertexToBody(a,1,-1,-1);JSM.AddVertexToBody(a,-1,1,-1);JSM.AddVertexToBody(a,-1,-1,1);JSM.AddVertexToBody(a,-1,-1,-1);JSM.AddPolygonToBody(a,[0,1,5,3]);JSM.AddPolygonToBody(a,[0,2,4,1]);JSM.AddPolygonToBody(a,[0,3,6,2]);JSM.AddPolygonToBody(a,[1,4,7,5]);JSM.AddPolygonToBody(a,[2,6,7,4]);JSM.AddPolygonToBody(a,[3,5,7,6]);
return a};JSM.GenerateOctahedron=function(){var a=new JSM.Body;JSM.AddVertexToBody(a,1,0,0);JSM.AddVertexToBody(a,-1,0,0);JSM.AddVertexToBody(a,0,1,0);JSM.AddVertexToBody(a,0,-1,0);JSM.AddVertexToBody(a,0,0,1);JSM.AddVertexToBody(a,0,0,-1);JSM.AddPolygonToBody(a,[0,2,4]);JSM.AddPolygonToBody(a,[0,3,5]);JSM.AddPolygonToBody(a,[0,4,3]);JSM.AddPolygonToBody(a,[0,5,2]);JSM.AddPolygonToBody(a,[1,2,5]);JSM.AddPolygonToBody(a,[1,3,4]);JSM.AddPolygonToBody(a,[1,4,2]);JSM.AddPolygonToBody(a,[1,5,3]);return a};
JSM.GenerateDodecahedron=function(){var a=new JSM.Body,b=(1+Math.sqrt(5))/2,c=1/b;JSM.AddVertexToBody(a,1,1,1);JSM.AddVertexToBody(a,1,1,-1);JSM.AddVertexToBody(a,1,-1,1);JSM.AddVertexToBody(a,-1,1,1);JSM.AddVertexToBody(a,1,-1,-1);JSM.AddVertexToBody(a,-1,1,-1);JSM.AddVertexToBody(a,-1,-1,1);JSM.AddVertexToBody(a,-1,-1,-1);JSM.AddVertexToBody(a,0,+c,+b);JSM.AddVertexToBody(a,0,+c,-b);JSM.AddVertexToBody(a,0,-c,+b);JSM.AddVertexToBody(a,0,-c,-b);JSM.AddVertexToBody(a,+c,+b,0);JSM.AddVertexToBody(a,
+c,-b,0);JSM.AddVertexToBody(a,-c,+b,0);JSM.AddVertexToBody(a,-c,-b,0);JSM.AddVertexToBody(a,+b,0,+c);JSM.AddVertexToBody(a,-b,0,+c);JSM.AddVertexToBody(a,+b,0,-c);JSM.AddVertexToBody(a,-b,0,-c);JSM.AddPolygonToBody(a,[0,8,10,2,16]);JSM.AddPolygonToBody(a,[0,16,18,1,12]);JSM.AddPolygonToBody(a,[0,12,14,3,8]);JSM.AddPolygonToBody(a,[1,9,5,14,12]);JSM.AddPolygonToBody(a,[1,18,4,11,9]);JSM.AddPolygonToBody(a,[2,10,6,15,13]);JSM.AddPolygonToBody(a,[2,13,4,18,16]);JSM.AddPolygonToBody(a,[3,14,5,19,17]);
JSM.AddPolygonToBody(a,[3,17,6,10,8]);JSM.AddPolygonToBody(a,[4,13,15,7,11]);JSM.AddPolygonToBody(a,[5,9,11,7,19]);JSM.AddPolygonToBody(a,[6,17,19,7,15]);return a};
JSM.GenerateIcosahedron=function(){var a=new JSM.Body,b=(1+Math.sqrt(5))/2;JSM.AddVertexToBody(a,0,1,+b);JSM.AddVertexToBody(a,0,1,-b);JSM.AddVertexToBody(a,0,-1,+b);JSM.AddVertexToBody(a,0,-1,-b);JSM.AddVertexToBody(a,1,+b,0);JSM.AddVertexToBody(a,1,-b,0);JSM.AddVertexToBody(a,-1,+b,0);JSM.AddVertexToBody(a,-1,-b,0);JSM.AddVertexToBody(a,+b,0,1);JSM.AddVertexToBody(a,-b,0,1);JSM.AddVertexToBody(a,+b,0,-1);JSM.AddVertexToBody(a,-b,0,-1);JSM.AddPolygonToBody(a,[0,2,8]);JSM.AddPolygonToBody(a,[0,4,
6]);JSM.AddPolygonToBody(a,[0,6,9]);JSM.AddPolygonToBody(a,[0,8,4]);JSM.AddPolygonToBody(a,[0,9,2]);JSM.AddPolygonToBody(a,[1,3,11]);JSM.AddPolygonToBody(a,[1,4,10]);JSM.AddPolygonToBody(a,[1,6,4]);JSM.AddPolygonToBody(a,[1,10,3]);JSM.AddPolygonToBody(a,[1,11,6]);JSM.AddPolygonToBody(a,[2,5,8]);JSM.AddPolygonToBody(a,[2,7,5]);JSM.AddPolygonToBody(a,[2,9,7]);JSM.AddPolygonToBody(a,[3,5,7]);JSM.AddPolygonToBody(a,[3,7,11]);JSM.AddPolygonToBody(a,[3,10,5]);JSM.AddPolygonToBody(a,[4,8,10]);JSM.AddPolygonToBody(a,
[6,11,9]);JSM.AddPolygonToBody(a,[5,10,8]);JSM.AddPolygonToBody(a,[7,9,11]);return a};
JSM.GenerateTruncatedTetrahedron=function(){var a=new JSM.Body;JSM.AddVertexToBody(a,1,1,3);JSM.AddVertexToBody(a,1,-1,-3);JSM.AddVertexToBody(a,-1,-1,3);JSM.AddVertexToBody(a,-1,1,-3);JSM.AddVertexToBody(a,1,3,1);JSM.AddVertexToBody(a,1,-3,-1);JSM.AddVertexToBody(a,-1,-3,1);JSM.AddVertexToBody(a,-1,3,-1);JSM.AddVertexToBody(a,3,1,1);JSM.AddVertexToBody(a,3,-1,-1);JSM.AddVertexToBody(a,-3,-1,1);JSM.AddVertexToBody(a,-3,1,-1);JSM.AddPolygonToBody(a,[0,8,4]);JSM.AddPolygonToBody(a,[1,9,5]);JSM.AddPolygonToBody(a,
[2,10,6]);JSM.AddPolygonToBody(a,[3,11,7]);JSM.AddPolygonToBody(a,[0,2,6,5,9,8]);JSM.AddPolygonToBody(a,[0,4,7,11,10,2]);JSM.AddPolygonToBody(a,[1,3,7,4,8,9]);JSM.AddPolygonToBody(a,[1,5,6,10,11,3]);return a};
JSM.GenerateCuboctahedron=function(){var a=new JSM.Body;JSM.AddVertexToBody(a,1,1,0);JSM.AddVertexToBody(a,1,-1,0);JSM.AddVertexToBody(a,-1,-1,0);JSM.AddVertexToBody(a,-1,1,0);JSM.AddVertexToBody(a,1,0,1);JSM.AddVertexToBody(a,1,0,-1);JSM.AddVertexToBody(a,-1,0,1);JSM.AddVertexToBody(a,-1,0,-1);JSM.AddVertexToBody(a,0,1,1);JSM.AddVertexToBody(a,0,-1,-1);JSM.AddVertexToBody(a,0,-1,1);JSM.AddVertexToBody(a,0,1,-1);JSM.AddPolygonToBody(a,[0,5,11]);JSM.AddPolygonToBody(a,[0,8,4]);JSM.AddPolygonToBody(a,
[1,4,10]);JSM.AddPolygonToBody(a,[1,9,5]);JSM.AddPolygonToBody(a,[2,7,9]);JSM.AddPolygonToBody(a,[2,10,6]);JSM.AddPolygonToBody(a,[3,6,8]);JSM.AddPolygonToBody(a,[3,11,7]);JSM.AddPolygonToBody(a,[0,4,1,5]);JSM.AddPolygonToBody(a,[0,11,3,8]);JSM.AddPolygonToBody(a,[1,10,2,9]);JSM.AddPolygonToBody(a,[2,6,3,7]);JSM.AddPolygonToBody(a,[4,8,6,10]);JSM.AddPolygonToBody(a,[5,9,7,11]);return a};
JSM.GenerateTruncatedCube=function(){var a=new JSM.Body,b=Math.sqrt(2)-1;JSM.AddVertexToBody(a,1,1,+b);JSM.AddVertexToBody(a,1,1,-b);JSM.AddVertexToBody(a,1,-1,+b);JSM.AddVertexToBody(a,-1,1,+b);JSM.AddVertexToBody(a,1,-1,-b);JSM.AddVertexToBody(a,-1,1,-b);JSM.AddVertexToBody(a,-1,-1,+b);JSM.AddVertexToBody(a,-1,-1,-b);JSM.AddVertexToBody(a,1,+b,1);JSM.AddVertexToBody(a,1,+b,-1);JSM.AddVertexToBody(a,1,-b,1);JSM.AddVertexToBody(a,-1,+b,1);JSM.AddVertexToBody(a,1,-b,-1);JSM.AddVertexToBody(a,-1,+b,
-1);JSM.AddVertexToBody(a,-1,-b,1);JSM.AddVertexToBody(a,-1,-b,-1);JSM.AddVertexToBody(a,+b,1,1);JSM.AddVertexToBody(a,+b,1,-1);JSM.AddVertexToBody(a,+b,-1,1);JSM.AddVertexToBody(a,-b,1,1);JSM.AddVertexToBody(a,+b,-1,-1);JSM.AddVertexToBody(a,-b,1,-1);JSM.AddVertexToBody(a,-b,-1,1);JSM.AddVertexToBody(a,-b,-1,-1);JSM.AddPolygonToBody(a,[0,16,8]);JSM.AddPolygonToBody(a,[1,9,17]);JSM.AddPolygonToBody(a,[2,10,18]);JSM.AddPolygonToBody(a,[3,11,19]);JSM.AddPolygonToBody(a,[4,20,12]);JSM.AddPolygonToBody(a,
[5,21,13]);JSM.AddPolygonToBody(a,[6,22,14]);JSM.AddPolygonToBody(a,[7,15,23]);JSM.AddPolygonToBody(a,[0,1,17,21,5,3,19,16]);JSM.AddPolygonToBody(a,[0,8,10,2,4,12,9,1]);JSM.AddPolygonToBody(a,[2,18,22,6,7,23,20,4]);JSM.AddPolygonToBody(a,[3,5,13,15,7,6,14,11]);JSM.AddPolygonToBody(a,[8,16,19,11,14,22,18,10]);JSM.AddPolygonToBody(a,[9,12,20,23,15,13,21,17]);return a};
JSM.GenerateTruncatedOctahedron=function(){var a=new JSM.Body;JSM.AddVertexToBody(a,0,1,2);JSM.AddVertexToBody(a,0,1,-2);JSM.AddVertexToBody(a,0,-1,2);JSM.AddVertexToBody(a,0,-1,-2);JSM.AddVertexToBody(a,0,2,1);JSM.AddVertexToBody(a,0,-2,1);JSM.AddVertexToBody(a,0,2,-1);JSM.AddVertexToBody(a,0,-2,-1);JSM.AddVertexToBody(a,1,0,2);JSM.AddVertexToBody(a,1,0,-2);JSM.AddVertexToBody(a,-1,0,2);JSM.AddVertexToBody(a,-1,0,-2);JSM.AddVertexToBody(a,1,2,0);JSM.AddVertexToBody(a,1,-2,0);JSM.AddVertexToBody(a,
-1,2,0);JSM.AddVertexToBody(a,-1,-2,0);JSM.AddVertexToBody(a,2,0,1);JSM.AddVertexToBody(a,-2,0,1);JSM.AddVertexToBody(a,2,0,-1);JSM.AddVertexToBody(a,-2,0,-1);JSM.AddVertexToBody(a,2,1,0);JSM.AddVertexToBody(a,-2,1,0);JSM.AddVertexToBody(a,2,-1,0);JSM.AddVertexToBody(a,-2,-1,0);JSM.AddPolygonToBody(a,[0,10,2,8]);JSM.AddPolygonToBody(a,[1,9,3,11]);JSM.AddPolygonToBody(a,[4,12,6,14]);JSM.AddPolygonToBody(a,[5,15,7,13]);JSM.AddPolygonToBody(a,[16,22,18,20]);JSM.AddPolygonToBody(a,[17,21,19,23]);JSM.AddPolygonToBody(a,
[0,4,14,21,17,10]);JSM.AddPolygonToBody(a,[0,8,16,20,12,4]);JSM.AddPolygonToBody(a,[1,6,12,20,18,9]);JSM.AddPolygonToBody(a,[1,11,19,21,14,6]);JSM.AddPolygonToBody(a,[2,5,13,22,16,8]);JSM.AddPolygonToBody(a,[2,10,17,23,15,5]);JSM.AddPolygonToBody(a,[3,7,15,23,19,11]);JSM.AddPolygonToBody(a,[3,9,18,22,13,7]);return a};
JSM.GenerateRhombicuboctahedron=function(){var a=new JSM.Body,b=1+Math.sqrt(2);JSM.AddVertexToBody(a,1,1,+b);JSM.AddVertexToBody(a,1,1,-b);JSM.AddVertexToBody(a,1,-1,+b);JSM.AddVertexToBody(a,-1,1,+b);JSM.AddVertexToBody(a,1,-1,-b);JSM.AddVertexToBody(a,-1,1,-b);JSM.AddVertexToBody(a,-1,-1,+b);JSM.AddVertexToBody(a,-1,-1,-b);JSM.AddVertexToBody(a,1,+b,1);JSM.AddVertexToBody(a,1,+b,-1);JSM.AddVertexToBody(a,1,-b,1);JSM.AddVertexToBody(a,-1,+b,1);JSM.AddVertexToBody(a,1,-b,-1);JSM.AddVertexToBody(a,
-1,+b,-1);JSM.AddVertexToBody(a,-1,-b,1);JSM.AddVertexToBody(a,-1,-b,-1);JSM.AddVertexToBody(a,+b,1,1);JSM.AddVertexToBody(a,+b,1,-1);JSM.AddVertexToBody(a,+b,-1,1);JSM.AddVertexToBody(a,-b,1,1);JSM.AddVertexToBody(a,+b,-1,-1);JSM.AddVertexToBody(a,-b,1,-1);JSM.AddVertexToBody(a,-b,-1,1);JSM.AddVertexToBody(a,-b,-1,-1);JSM.AddPolygonToBody(a,[0,16,8]);JSM.AddPolygonToBody(a,[1,9,17]);JSM.AddPolygonToBody(a,[2,10,18]);JSM.AddPolygonToBody(a,[3,11,19]);JSM.AddPolygonToBody(a,[4,20,12]);JSM.AddPolygonToBody(a,
[5,21,13]);JSM.AddPolygonToBody(a,[6,22,14]);JSM.AddPolygonToBody(a,[7,15,23]);JSM.AddPolygonToBody(a,[0,2,18,16]);JSM.AddPolygonToBody(a,[0,3,6,2]);JSM.AddPolygonToBody(a,[0,8,11,3]);JSM.AddPolygonToBody(a,[1,4,7,5]);JSM.AddPolygonToBody(a,[1,5,13,9]);JSM.AddPolygonToBody(a,[1,17,20,4]);JSM.AddPolygonToBody(a,[2,6,14,10]);JSM.AddPolygonToBody(a,[3,19,22,6]);JSM.AddPolygonToBody(a,[4,12,15,7]);JSM.AddPolygonToBody(a,[5,7,23,21]);JSM.AddPolygonToBody(a,[8,9,13,11]);JSM.AddPolygonToBody(a,[8,16,17,
9]);JSM.AddPolygonToBody(a,[10,12,20,18]);JSM.AddPolygonToBody(a,[10,14,15,12]);JSM.AddPolygonToBody(a,[11,13,21,19]);JSM.AddPolygonToBody(a,[14,22,23,15]);JSM.AddPolygonToBody(a,[16,18,20,17]);JSM.AddPolygonToBody(a,[19,21,23,22]);return a};
JSM.GenerateTruncatedCuboctahedron=function(){var a=new JSM.Body,b=1+Math.sqrt(2),c=1+2*Math.sqrt(2);JSM.AddVertexToBody(a,1,+b,+c);JSM.AddVertexToBody(a,1,+b,-c);JSM.AddVertexToBody(a,1,-b,+c);JSM.AddVertexToBody(a,-1,+b,+c);JSM.AddVertexToBody(a,1,-b,-c);JSM.AddVertexToBody(a,-1,+b,-c);JSM.AddVertexToBody(a,-1,-b,+c);JSM.AddVertexToBody(a,-1,-b,-c);JSM.AddVertexToBody(a,1,+c,+b);JSM.AddVertexToBody(a,1,-c,+b);JSM.AddVertexToBody(a,1,+c,-b);JSM.AddVertexToBody(a,-1,+c,+b);JSM.AddVertexToBody(a,1,
-c,-b);JSM.AddVertexToBody(a,-1,-c,+b);JSM.AddVertexToBody(a,-1,+c,-b);JSM.AddVertexToBody(a,-1,-c,-b);JSM.AddVertexToBody(a,+b,1,+c);JSM.AddVertexToBody(a,+b,1,-c);JSM.AddVertexToBody(a,-b,1,+c);JSM.AddVertexToBody(a,+b,-1,+c);JSM.AddVertexToBody(a,-b,1,-c);JSM.AddVertexToBody(a,+b,-1,-c);JSM.AddVertexToBody(a,-b,-1,+c);JSM.AddVertexToBody(a,-b,-1,-c);JSM.AddVertexToBody(a,+b,+c,1);JSM.AddVertexToBody(a,+b,-c,1);JSM.AddVertexToBody(a,-b,+c,1);JSM.AddVertexToBody(a,+b,+c,-1);JSM.AddVertexToBody(a,
-b,-c,1);JSM.AddVertexToBody(a,+b,-c,-1);JSM.AddVertexToBody(a,-b,+c,-1);JSM.AddVertexToBody(a,-b,-c,-1);JSM.AddVertexToBody(a,+c,1,+b);JSM.AddVertexToBody(a,-c,1,+b);JSM.AddVertexToBody(a,+c,1,-b);JSM.AddVertexToBody(a,+c,-1,+b);JSM.AddVertexToBody(a,-c,1,-b);JSM.AddVertexToBody(a,-c,-1,+b);JSM.AddVertexToBody(a,+c,-1,-b);JSM.AddVertexToBody(a,-c,-1,-b);JSM.AddVertexToBody(a,+c,+b,1);JSM.AddVertexToBody(a,-c,+b,1);JSM.AddVertexToBody(a,+c,-b,1);JSM.AddVertexToBody(a,+c,+b,-1);JSM.AddVertexToBody(a,
-c,-b,1);JSM.AddVertexToBody(a,-c,+b,-1);JSM.AddVertexToBody(a,+c,-b,-1);JSM.AddVertexToBody(a,-c,-b,-1);JSM.AddPolygonToBody(a,[0,8,11,3]);JSM.AddPolygonToBody(a,[1,5,14,10]);JSM.AddPolygonToBody(a,[2,6,13,9]);JSM.AddPolygonToBody(a,[4,12,15,7]);JSM.AddPolygonToBody(a,[16,19,35,32]);JSM.AddPolygonToBody(a,[17,34,38,21]);JSM.AddPolygonToBody(a,[18,33,37,22]);JSM.AddPolygonToBody(a,[23,39,36,20]);JSM.AddPolygonToBody(a,[24,40,43,27]);JSM.AddPolygonToBody(a,[25,29,46,42]);JSM.AddPolygonToBody(a,[26,
30,45,41]);JSM.AddPolygonToBody(a,[28,44,47,31]);JSM.AddPolygonToBody(a,[0,16,32,40,24,8]);JSM.AddPolygonToBody(a,[1,10,27,43,34,17]);JSM.AddPolygonToBody(a,[2,9,25,42,35,19]);JSM.AddPolygonToBody(a,[3,11,26,41,33,18]);JSM.AddPolygonToBody(a,[4,21,38,46,29,12]);JSM.AddPolygonToBody(a,[5,20,36,45,30,14]);JSM.AddPolygonToBody(a,[6,22,37,44,28,13]);JSM.AddPolygonToBody(a,[7,15,31,47,39,23]);JSM.AddPolygonToBody(a,[0,3,18,22,6,2,19,16]);JSM.AddPolygonToBody(a,[1,17,21,4,7,23,20,5]);JSM.AddPolygonToBody(a,
[8,24,27,10,14,30,26,11]);JSM.AddPolygonToBody(a,[9,13,28,31,15,12,29,25]);JSM.AddPolygonToBody(a,[32,35,42,46,38,34,43,40]);JSM.AddPolygonToBody(a,[33,41,45,36,39,47,44,37]);return a};
JSM.GenerateSnubCube=function(){var a=new JSM.Body,b=1/3*(Math.pow(17+3*Math.sqrt(33),1/3)-Math.pow(-17+3*Math.sqrt(33),1/3)-1),c=1/b;JSM.AddVertexToBody(a,1,+b,-c);JSM.AddVertexToBody(a,1,-b,+c);JSM.AddVertexToBody(a,-1,+b,+c);JSM.AddVertexToBody(a,-1,-b,-c);JSM.AddVertexToBody(a,+b,-c,1);JSM.AddVertexToBody(a,-b,+c,1);JSM.AddVertexToBody(a,+b,+c,-1);JSM.AddVertexToBody(a,-b,-c,-1);JSM.AddVertexToBody(a,-c,1,+b);JSM.AddVertexToBody(a,+c,1,-b);JSM.AddVertexToBody(a,+c,-1,+b);JSM.AddVertexToBody(a,
-c,-1,-b);JSM.AddVertexToBody(a,1,+c,+b);JSM.AddVertexToBody(a,1,-c,-b);JSM.AddVertexToBody(a,-1,+c,-b);JSM.AddVertexToBody(a,-1,-c,+b);JSM.AddVertexToBody(a,+b,1,+c);JSM.AddVertexToBody(a,-b,1,-c);JSM.AddVertexToBody(a,-b,-1,+c);JSM.AddVertexToBody(a,+b,-1,-c);JSM.AddVertexToBody(a,+c,+b,1);JSM.AddVertexToBody(a,-c,-b,1);JSM.AddVertexToBody(a,+c,-b,-1);JSM.AddVertexToBody(a,-c,+b,-1);JSM.AddPolygonToBody(a,[0,6,9]);JSM.AddPolygonToBody(a,[0,9,22]);JSM.AddPolygonToBody(a,[0,17,6]);JSM.AddPolygonToBody(a,
[0,22,19]);JSM.AddPolygonToBody(a,[1,4,10]);JSM.AddPolygonToBody(a,[1,10,20]);JSM.AddPolygonToBody(a,[1,18,4]);JSM.AddPolygonToBody(a,[1,20,16]);JSM.AddPolygonToBody(a,[2,5,8]);JSM.AddPolygonToBody(a,[2,8,21]);JSM.AddPolygonToBody(a,[2,16,5]);JSM.AddPolygonToBody(a,[2,21,18]);JSM.AddPolygonToBody(a,[3,7,11]);JSM.AddPolygonToBody(a,[3,11,23]);JSM.AddPolygonToBody(a,[3,19,7]);JSM.AddPolygonToBody(a,[3,23,17]);JSM.AddPolygonToBody(a,[4,13,10]);JSM.AddPolygonToBody(a,[4,18,15]);JSM.AddPolygonToBody(a,
[5,14,8]);JSM.AddPolygonToBody(a,[5,16,12]);JSM.AddPolygonToBody(a,[6,12,9]);JSM.AddPolygonToBody(a,[6,17,14]);JSM.AddPolygonToBody(a,[7,15,11]);JSM.AddPolygonToBody(a,[7,19,13]);JSM.AddPolygonToBody(a,[8,14,23]);JSM.AddPolygonToBody(a,[9,12,20]);JSM.AddPolygonToBody(a,[10,13,22]);JSM.AddPolygonToBody(a,[11,15,21]);JSM.AddPolygonToBody(a,[12,16,20]);JSM.AddPolygonToBody(a,[13,19,22]);JSM.AddPolygonToBody(a,[14,17,23]);JSM.AddPolygonToBody(a,[15,18,21]);JSM.AddPolygonToBody(a,[0,19,3,17]);JSM.AddPolygonToBody(a,
[1,16,2,18]);JSM.AddPolygonToBody(a,[4,15,7,13]);JSM.AddPolygonToBody(a,[5,12,6,14]);JSM.AddPolygonToBody(a,[8,23,11,21]);JSM.AddPolygonToBody(a,[9,20,10,22]);return a};
JSM.GenerateIcosidodecahedron=function(){var a=new JSM.Body,b=(1+Math.sqrt(5))/2,c=b/2,d=(1+b)/2;JSM.AddVertexToBody(a,0,0,+b);JSM.AddVertexToBody(a,0,0,-b);JSM.AddVertexToBody(a,0,+b,0);JSM.AddVertexToBody(a,0,-b,0);JSM.AddVertexToBody(a,+b,0,0);JSM.AddVertexToBody(a,-b,0,0);JSM.AddVertexToBody(a,0.5,+c,+d);JSM.AddVertexToBody(a,0.5,+c,-d);JSM.AddVertexToBody(a,0.5,-c,+d);JSM.AddVertexToBody(a,-0.5,+c,+d);JSM.AddVertexToBody(a,0.5,-c,-d);JSM.AddVertexToBody(a,-0.5,+c,-d);JSM.AddVertexToBody(a,-0.5,
-c,+d);JSM.AddVertexToBody(a,-0.5,-c,-d);JSM.AddVertexToBody(a,+c,+d,0.5);JSM.AddVertexToBody(a,+c,-d,0.5);JSM.AddVertexToBody(a,-c,+d,0.5);JSM.AddVertexToBody(a,+c,+d,-0.5);JSM.AddVertexToBody(a,-c,-d,0.5);JSM.AddVertexToBody(a,+c,-d,-0.5);JSM.AddVertexToBody(a,-c,+d,-0.5);JSM.AddVertexToBody(a,-c,-d,-0.5);JSM.AddVertexToBody(a,+d,0.5,+c);JSM.AddVertexToBody(a,-d,0.5,+c);JSM.AddVertexToBody(a,+d,0.5,-c);JSM.AddVertexToBody(a,+d,-0.5,+c);JSM.AddVertexToBody(a,-d,0.5,-c);JSM.AddVertexToBody(a,-d,-0.5,
+c);JSM.AddVertexToBody(a,+d,-0.5,-c);JSM.AddVertexToBody(a,-d,-0.5,-c);JSM.AddPolygonToBody(a,[0,6,9]);JSM.AddPolygonToBody(a,[0,12,8]);JSM.AddPolygonToBody(a,[1,10,13]);JSM.AddPolygonToBody(a,[1,11,7]);JSM.AddPolygonToBody(a,[2,14,17]);JSM.AddPolygonToBody(a,[2,20,16]);JSM.AddPolygonToBody(a,[3,18,21]);JSM.AddPolygonToBody(a,[3,19,15]);JSM.AddPolygonToBody(a,[4,22,25]);JSM.AddPolygonToBody(a,[4,28,24]);JSM.AddPolygonToBody(a,[5,26,29]);JSM.AddPolygonToBody(a,[5,27,23]);JSM.AddPolygonToBody(a,[6,
22,14]);JSM.AddPolygonToBody(a,[7,17,24]);JSM.AddPolygonToBody(a,[8,15,25]);JSM.AddPolygonToBody(a,[9,16,23]);JSM.AddPolygonToBody(a,[10,28,19]);JSM.AddPolygonToBody(a,[11,26,20]);JSM.AddPolygonToBody(a,[12,27,18]);JSM.AddPolygonToBody(a,[13,21,29]);JSM.AddPolygonToBody(a,[0,8,25,22,6]);JSM.AddPolygonToBody(a,[0,9,23,27,12]);JSM.AddPolygonToBody(a,[1,7,24,28,10]);JSM.AddPolygonToBody(a,[1,13,29,26,11]);JSM.AddPolygonToBody(a,[2,16,9,6,14]);JSM.AddPolygonToBody(a,[2,17,7,11,20]);JSM.AddPolygonToBody(a,
[3,15,8,12,18]);JSM.AddPolygonToBody(a,[3,21,13,10,19]);JSM.AddPolygonToBody(a,[4,24,17,14,22]);JSM.AddPolygonToBody(a,[4,25,15,19,28]);JSM.AddPolygonToBody(a,[5,23,16,20,26]);JSM.AddPolygonToBody(a,[5,29,21,18,27]);return a};
JSM.GenerateTruncatedDodecahedron=function(){var a=new JSM.Body,b=(1+Math.sqrt(5))/2,c=1/b,d=2+b,e=2*b,f=Math.pow(b,2);JSM.AddVertexToBody(a,0,+c,+d);JSM.AddVertexToBody(a,0,+c,-d);JSM.AddVertexToBody(a,0,-c,+d);JSM.AddVertexToBody(a,0,-c,-d);JSM.AddVertexToBody(a,+d,0,+c);JSM.AddVertexToBody(a,-d,0,+c);JSM.AddVertexToBody(a,+d,0,-c);JSM.AddVertexToBody(a,-d,0,-c);JSM.AddVertexToBody(a,+c,+d,0);JSM.AddVertexToBody(a,+c,-d,0);JSM.AddVertexToBody(a,-c,+d,0);JSM.AddVertexToBody(a,-c,-d,0);JSM.AddVertexToBody(a,
+c,+b,+e);JSM.AddVertexToBody(a,+c,+b,-e);JSM.AddVertexToBody(a,+c,-b,+e);JSM.AddVertexToBody(a,-c,+b,+e);JSM.AddVertexToBody(a,+c,-b,-e);JSM.AddVertexToBody(a,-c,+b,-e);JSM.AddVertexToBody(a,-c,-b,+e);JSM.AddVertexToBody(a,-c,-b,-e);JSM.AddVertexToBody(a,+e,+c,+b);JSM.AddVertexToBody(a,+e,+c,-b);JSM.AddVertexToBody(a,+e,-c,+b);JSM.AddVertexToBody(a,-e,+c,+b);JSM.AddVertexToBody(a,+e,-c,-b);JSM.AddVertexToBody(a,-e,+c,-b);JSM.AddVertexToBody(a,-e,-c,+b);JSM.AddVertexToBody(a,-e,-c,-b);JSM.AddVertexToBody(a,
+b,+e,+c);JSM.AddVertexToBody(a,+b,+e,-c);JSM.AddVertexToBody(a,+b,-e,+c);JSM.AddVertexToBody(a,-b,+e,+c);JSM.AddVertexToBody(a,+b,-e,-c);JSM.AddVertexToBody(a,-b,+e,-c);JSM.AddVertexToBody(a,-b,-e,+c);JSM.AddVertexToBody(a,-b,-e,-c);JSM.AddVertexToBody(a,+b,2,+f);JSM.AddVertexToBody(a,+b,2,-f);JSM.AddVertexToBody(a,+b,-2,+f);JSM.AddVertexToBody(a,-b,2,+f);JSM.AddVertexToBody(a,+b,-2,-f);JSM.AddVertexToBody(a,-b,2,-f);JSM.AddVertexToBody(a,-b,-2,+f);JSM.AddVertexToBody(a,-b,-2,-f);JSM.AddVertexToBody(a,
+f,+b,2);JSM.AddVertexToBody(a,+f,+b,-2);JSM.AddVertexToBody(a,+f,-b,2);JSM.AddVertexToBody(a,-f,+b,2);JSM.AddVertexToBody(a,+f,-b,-2);JSM.AddVertexToBody(a,-f,+b,-2);JSM.AddVertexToBody(a,-f,-b,2);JSM.AddVertexToBody(a,-f,-b,-2);JSM.AddVertexToBody(a,2,+f,+b);JSM.AddVertexToBody(a,2,+f,-b);JSM.AddVertexToBody(a,2,-f,+b);JSM.AddVertexToBody(a,-2,+f,+b);JSM.AddVertexToBody(a,2,-f,-b);JSM.AddVertexToBody(a,-2,+f,-b);JSM.AddVertexToBody(a,-2,-f,+b);JSM.AddVertexToBody(a,-2,-f,-b);JSM.AddPolygonToBody(a,
[0,12,15]);JSM.AddPolygonToBody(a,[1,17,13]);JSM.AddPolygonToBody(a,[2,18,14]);JSM.AddPolygonToBody(a,[3,16,19]);JSM.AddPolygonToBody(a,[4,20,22]);JSM.AddPolygonToBody(a,[5,26,23]);JSM.AddPolygonToBody(a,[6,24,21]);JSM.AddPolygonToBody(a,[7,25,27]);JSM.AddPolygonToBody(a,[8,28,29]);JSM.AddPolygonToBody(a,[9,32,30]);JSM.AddPolygonToBody(a,[10,33,31]);JSM.AddPolygonToBody(a,[11,34,35]);JSM.AddPolygonToBody(a,[36,44,52]);JSM.AddPolygonToBody(a,[37,53,45]);JSM.AddPolygonToBody(a,[38,54,46]);JSM.AddPolygonToBody(a,
[39,55,47]);JSM.AddPolygonToBody(a,[40,48,56]);JSM.AddPolygonToBody(a,[41,49,57]);JSM.AddPolygonToBody(a,[42,50,58]);JSM.AddPolygonToBody(a,[43,59,51]);JSM.AddPolygonToBody(a,[0,2,14,38,46,22,20,44,36,12]);JSM.AddPolygonToBody(a,[0,15,39,47,23,26,50,42,18,2]);JSM.AddPolygonToBody(a,[1,3,19,43,51,27,25,49,41,17]);JSM.AddPolygonToBody(a,[1,13,37,45,21,24,48,40,16,3]);JSM.AddPolygonToBody(a,[4,6,21,45,53,29,28,52,44,20]);JSM.AddPolygonToBody(a,[4,22,46,54,30,32,56,48,24,6]);JSM.AddPolygonToBody(a,[5,
7,27,51,59,35,34,58,50,26]);JSM.AddPolygonToBody(a,[5,23,47,55,31,33,57,49,25,7]);JSM.AddPolygonToBody(a,[8,10,31,55,39,15,12,36,52,28]);JSM.AddPolygonToBody(a,[8,29,53,37,13,17,41,57,33,10]);JSM.AddPolygonToBody(a,[9,11,35,59,43,19,16,40,56,32]);JSM.AddPolygonToBody(a,[9,30,54,38,14,18,42,58,34,11]);return a};
JSM.GenerateTruncatedIcosahedron=function(){var a=new JSM.Body,b=(1+Math.sqrt(5))/2,c=3*b,d=1+2*b,e=2+b,f=2*b;JSM.AddVertexToBody(a,0,1,+c);JSM.AddVertexToBody(a,0,1,-c);JSM.AddVertexToBody(a,0,-1,+c);JSM.AddVertexToBody(a,0,-1,-c);JSM.AddVertexToBody(a,1,+c,0);JSM.AddVertexToBody(a,1,-c,0);JSM.AddVertexToBody(a,-1,+c,0);JSM.AddVertexToBody(a,-1,-c,0);JSM.AddVertexToBody(a,+c,0,1);JSM.AddVertexToBody(a,-c,0,1);JSM.AddVertexToBody(a,+c,0,-1);JSM.AddVertexToBody(a,-c,0,-1);JSM.AddVertexToBody(a,2,+d,
+b);JSM.AddVertexToBody(a,2,+d,-b);JSM.AddVertexToBody(a,2,-d,+b);JSM.AddVertexToBody(a,-2,+d,+b);JSM.AddVertexToBody(a,2,-d,-b);JSM.AddVertexToBody(a,-2,+d,-b);JSM.AddVertexToBody(a,-2,-d,+b);JSM.AddVertexToBody(a,-2,-d,-b);JSM.AddVertexToBody(a,+d,+b,2);JSM.AddVertexToBody(a,+d,-b,2);JSM.AddVertexToBody(a,-d,+b,2);JSM.AddVertexToBody(a,+d,+b,-2);JSM.AddVertexToBody(a,-d,-b,2);JSM.AddVertexToBody(a,+d,-b,-2);JSM.AddVertexToBody(a,-d,+b,-2);JSM.AddVertexToBody(a,-d,-b,-2);JSM.AddVertexToBody(a,+b,
2,+d);JSM.AddVertexToBody(a,-b,2,+d);JSM.AddVertexToBody(a,+b,2,-d);JSM.AddVertexToBody(a,+b,-2,+d);JSM.AddVertexToBody(a,-b,2,-d);JSM.AddVertexToBody(a,-b,-2,+d);JSM.AddVertexToBody(a,+b,-2,-d);JSM.AddVertexToBody(a,-b,-2,-d);JSM.AddVertexToBody(a,1,+e,+f);JSM.AddVertexToBody(a,1,+e,-f);JSM.AddVertexToBody(a,1,-e,+f);JSM.AddVertexToBody(a,-1,+e,+f);JSM.AddVertexToBody(a,1,-e,-f);JSM.AddVertexToBody(a,-1,+e,-f);JSM.AddVertexToBody(a,-1,-e,+f);JSM.AddVertexToBody(a,-1,-e,-f);JSM.AddVertexToBody(a,
+e,+f,1);JSM.AddVertexToBody(a,+e,-f,1);JSM.AddVertexToBody(a,-e,+f,1);JSM.AddVertexToBody(a,+e,+f,-1);JSM.AddVertexToBody(a,-e,-f,1);JSM.AddVertexToBody(a,+e,-f,-1);JSM.AddVertexToBody(a,-e,+f,-1);JSM.AddVertexToBody(a,-e,-f,-1);JSM.AddVertexToBody(a,+f,1,+e);JSM.AddVertexToBody(a,-f,1,+e);JSM.AddVertexToBody(a,+f,1,-e);JSM.AddVertexToBody(a,+f,-1,+e);JSM.AddVertexToBody(a,-f,1,-e);JSM.AddVertexToBody(a,-f,-1,+e);JSM.AddVertexToBody(a,+f,-1,-e);JSM.AddVertexToBody(a,-f,-1,-e);JSM.AddPolygonToBody(a,
[0,28,36,39,29]);JSM.AddPolygonToBody(a,[1,32,41,37,30]);JSM.AddPolygonToBody(a,[2,33,42,38,31]);JSM.AddPolygonToBody(a,[3,34,40,43,35]);JSM.AddPolygonToBody(a,[4,12,44,47,13]);JSM.AddPolygonToBody(a,[5,16,49,45,14]);JSM.AddPolygonToBody(a,[6,17,50,46,15]);JSM.AddPolygonToBody(a,[7,18,48,51,19]);JSM.AddPolygonToBody(a,[8,20,52,55,21]);JSM.AddPolygonToBody(a,[9,24,57,53,22]);JSM.AddPolygonToBody(a,[10,25,58,54,23]);JSM.AddPolygonToBody(a,[11,26,56,59,27]);JSM.AddPolygonToBody(a,[0,2,31,55,52,28]);
JSM.AddPolygonToBody(a,[0,29,53,57,33,2]);JSM.AddPolygonToBody(a,[1,3,35,59,56,32]);JSM.AddPolygonToBody(a,[1,30,54,58,34,3]);JSM.AddPolygonToBody(a,[4,6,15,39,36,12]);JSM.AddPolygonToBody(a,[4,13,37,41,17,6]);JSM.AddPolygonToBody(a,[5,7,19,43,40,16]);JSM.AddPolygonToBody(a,[5,14,38,42,18,7]);JSM.AddPolygonToBody(a,[8,10,23,47,44,20]);JSM.AddPolygonToBody(a,[8,21,45,49,25,10]);JSM.AddPolygonToBody(a,[9,11,27,51,48,24]);JSM.AddPolygonToBody(a,[9,22,46,50,26,11]);JSM.AddPolygonToBody(a,[12,36,28,52,
20,44]);JSM.AddPolygonToBody(a,[13,47,23,54,30,37]);JSM.AddPolygonToBody(a,[14,45,21,55,31,38]);JSM.AddPolygonToBody(a,[15,46,22,53,29,39]);JSM.AddPolygonToBody(a,[16,40,34,58,25,49]);JSM.AddPolygonToBody(a,[17,41,32,56,26,50]);JSM.AddPolygonToBody(a,[18,42,33,57,24,48]);JSM.AddPolygonToBody(a,[19,51,27,59,35,43]);return a};
JSM.GenerateRhombicosidodecahedron=function(){var a=new JSM.Body,b=(1+Math.sqrt(5))/2,c=Math.pow(b,2),d=Math.pow(b,3),e=2*b,f=2+b;JSM.AddVertexToBody(a,1,1,+d);JSM.AddVertexToBody(a,1,1,-d);JSM.AddVertexToBody(a,1,-1,+d);JSM.AddVertexToBody(a,-1,1,+d);JSM.AddVertexToBody(a,1,-1,-d);JSM.AddVertexToBody(a,-1,1,-d);JSM.AddVertexToBody(a,-1,-1,+d);JSM.AddVertexToBody(a,-1,-1,-d);JSM.AddVertexToBody(a,+d,1,1);JSM.AddVertexToBody(a,+d,1,-1);JSM.AddVertexToBody(a,+d,-1,1);JSM.AddVertexToBody(a,-d,1,1);JSM.AddVertexToBody(a,
+d,-1,-1);JSM.AddVertexToBody(a,-d,1,-1);JSM.AddVertexToBody(a,-d,-1,1);JSM.AddVertexToBody(a,-d,-1,-1);JSM.AddVertexToBody(a,1,+d,1);JSM.AddVertexToBody(a,1,+d,-1);JSM.AddVertexToBody(a,1,-d,1);JSM.AddVertexToBody(a,-1,+d,1);JSM.AddVertexToBody(a,1,-d,-1);JSM.AddVertexToBody(a,-1,+d,-1);JSM.AddVertexToBody(a,-1,-d,1);JSM.AddVertexToBody(a,-1,-d,-1);JSM.AddVertexToBody(a,+c,+b,+e);JSM.AddVertexToBody(a,+c,+b,-e);JSM.AddVertexToBody(a,+c,-b,+e);JSM.AddVertexToBody(a,-c,+b,+e);JSM.AddVertexToBody(a,
+c,-b,-e);JSM.AddVertexToBody(a,-c,+b,-e);JSM.AddVertexToBody(a,-c,-b,+e);JSM.AddVertexToBody(a,-c,-b,-e);JSM.AddVertexToBody(a,+e,+c,+b);JSM.AddVertexToBody(a,+e,+c,-b);JSM.AddVertexToBody(a,+e,-c,+b);JSM.AddVertexToBody(a,-e,+c,+b);JSM.AddVertexToBody(a,+e,-c,-b);JSM.AddVertexToBody(a,-e,+c,-b);JSM.AddVertexToBody(a,-e,-c,+b);JSM.AddVertexToBody(a,-e,-c,-b);JSM.AddVertexToBody(a,+b,+e,+c);JSM.AddVertexToBody(a,+b,+e,-c);JSM.AddVertexToBody(a,+b,-e,+c);JSM.AddVertexToBody(a,-b,+e,+c);JSM.AddVertexToBody(a,
+b,-e,-c);JSM.AddVertexToBody(a,-b,+e,-c);JSM.AddVertexToBody(a,-b,-e,+c);JSM.AddVertexToBody(a,-b,-e,-c);JSM.AddVertexToBody(a,+f,0,+c);JSM.AddVertexToBody(a,+f,0,-c);JSM.AddVertexToBody(a,-f,0,+c);JSM.AddVertexToBody(a,-f,0,-c);JSM.AddVertexToBody(a,+c,+f,0);JSM.AddVertexToBody(a,-c,+f,0);JSM.AddVertexToBody(a,+c,-f,0);JSM.AddVertexToBody(a,-c,-f,0);JSM.AddVertexToBody(a,0,+c,+f);JSM.AddVertexToBody(a,0,-c,+f);JSM.AddVertexToBody(a,0,+c,-f);JSM.AddVertexToBody(a,0,-c,-f);JSM.AddPolygonToBody(a,
[0,56,3]);JSM.AddPolygonToBody(a,[1,5,58]);JSM.AddPolygonToBody(a,[2,6,57]);JSM.AddPolygonToBody(a,[4,59,7]);JSM.AddPolygonToBody(a,[8,48,10]);JSM.AddPolygonToBody(a,[9,12,49]);JSM.AddPolygonToBody(a,[11,14,50]);JSM.AddPolygonToBody(a,[13,51,15]);JSM.AddPolygonToBody(a,[16,52,17]);JSM.AddPolygonToBody(a,[18,20,54]);JSM.AddPolygonToBody(a,[19,21,53]);JSM.AddPolygonToBody(a,[22,55,23]);JSM.AddPolygonToBody(a,[24,32,40]);JSM.AddPolygonToBody(a,[25,41,33]);JSM.AddPolygonToBody(a,[26,42,34]);JSM.AddPolygonToBody(a,
[27,43,35]);JSM.AddPolygonToBody(a,[28,36,44]);JSM.AddPolygonToBody(a,[29,37,45]);JSM.AddPolygonToBody(a,[30,38,46]);JSM.AddPolygonToBody(a,[31,47,39]);JSM.AddPolygonToBody(a,[0,3,6,2]);JSM.AddPolygonToBody(a,[0,24,40,56]);JSM.AddPolygonToBody(a,[1,4,7,5]);JSM.AddPolygonToBody(a,[1,58,41,25]);JSM.AddPolygonToBody(a,[2,57,42,26]);JSM.AddPolygonToBody(a,[3,56,43,27]);JSM.AddPolygonToBody(a,[4,28,44,59]);JSM.AddPolygonToBody(a,[5,29,45,58]);JSM.AddPolygonToBody(a,[6,30,46,57]);JSM.AddPolygonToBody(a,
[7,59,47,31]);JSM.AddPolygonToBody(a,[8,10,12,9]);JSM.AddPolygonToBody(a,[8,32,24,48]);JSM.AddPolygonToBody(a,[9,49,25,33]);JSM.AddPolygonToBody(a,[10,48,26,34]);JSM.AddPolygonToBody(a,[11,13,15,14]);JSM.AddPolygonToBody(a,[11,50,27,35]);JSM.AddPolygonToBody(a,[12,36,28,49]);JSM.AddPolygonToBody(a,[13,37,29,51]);JSM.AddPolygonToBody(a,[14,38,30,50]);JSM.AddPolygonToBody(a,[15,51,31,39]);JSM.AddPolygonToBody(a,[16,17,21,19]);JSM.AddPolygonToBody(a,[16,40,32,52]);JSM.AddPolygonToBody(a,[17,52,33,41]);
JSM.AddPolygonToBody(a,[18,22,23,20]);JSM.AddPolygonToBody(a,[18,54,34,42]);JSM.AddPolygonToBody(a,[19,53,35,43]);JSM.AddPolygonToBody(a,[20,44,36,54]);JSM.AddPolygonToBody(a,[21,45,37,53]);JSM.AddPolygonToBody(a,[22,46,38,55]);JSM.AddPolygonToBody(a,[23,55,39,47]);JSM.AddPolygonToBody(a,[0,2,26,48,24]);JSM.AddPolygonToBody(a,[1,25,49,28,4]);JSM.AddPolygonToBody(a,[3,27,50,30,6]);JSM.AddPolygonToBody(a,[5,7,31,51,29]);JSM.AddPolygonToBody(a,[8,9,33,52,32]);JSM.AddPolygonToBody(a,[10,34,54,36,12]);
JSM.AddPolygonToBody(a,[11,35,53,37,13]);JSM.AddPolygonToBody(a,[14,15,39,55,38]);JSM.AddPolygonToBody(a,[16,19,43,56,40]);JSM.AddPolygonToBody(a,[17,41,58,45,21]);JSM.AddPolygonToBody(a,[18,42,57,46,22]);JSM.AddPolygonToBody(a,[20,23,47,59,44]);return a};
JSM.GenerateTruncatedIcosidodecahedron=function(){var a=new JSM.Body,b=(1+Math.sqrt(5))/2,c=1/b,d=3+b,e=2/b,f=1+2*b,g=Math.pow(b,2),h=-1+3*b,l=-1+2*b,k=2+b,m=2*b;JSM.AddVertexToBody(a,+c,+c,+d);JSM.AddVertexToBody(a,+c,+c,-d);JSM.AddVertexToBody(a,+c,-c,+d);JSM.AddVertexToBody(a,-c,+c,+d);JSM.AddVertexToBody(a,+c,-c,-d);JSM.AddVertexToBody(a,-c,+c,-d);JSM.AddVertexToBody(a,-c,-c,+d);JSM.AddVertexToBody(a,-c,-c,-d);JSM.AddVertexToBody(a,+c,+d,+c);JSM.AddVertexToBody(a,+c,-d,+c);JSM.AddVertexToBody(a,
-c,+d,+c);JSM.AddVertexToBody(a,+c,+d,-c);JSM.AddVertexToBody(a,-c,-d,+c);JSM.AddVertexToBody(a,+c,-d,-c);JSM.AddVertexToBody(a,-c,+d,-c);JSM.AddVertexToBody(a,-c,-d,-c);JSM.AddVertexToBody(a,+d,+c,+c);JSM.AddVertexToBody(a,-d,+c,+c);JSM.AddVertexToBody(a,+d,+c,-c);JSM.AddVertexToBody(a,+d,-c,+c);JSM.AddVertexToBody(a,-d,+c,-c);JSM.AddVertexToBody(a,-d,-c,+c);JSM.AddVertexToBody(a,+d,-c,-c);JSM.AddVertexToBody(a,-d,-c,-c);JSM.AddVertexToBody(a,+e,+b,+f);JSM.AddVertexToBody(a,+e,+b,-f);JSM.AddVertexToBody(a,
+e,-b,+f);JSM.AddVertexToBody(a,-e,+b,+f);JSM.AddVertexToBody(a,+e,-b,-f);JSM.AddVertexToBody(a,-e,+b,-f);JSM.AddVertexToBody(a,-e,-b,+f);JSM.AddVertexToBody(a,-e,-b,-f);JSM.AddVertexToBody(a,+b,+f,+e);JSM.AddVertexToBody(a,+b,-f,+e);JSM.AddVertexToBody(a,-b,+f,+e);JSM.AddVertexToBody(a,+b,+f,-e);JSM.AddVertexToBody(a,-b,-f,+e);JSM.AddVertexToBody(a,+b,-f,-e);JSM.AddVertexToBody(a,-b,+f,-e);JSM.AddVertexToBody(a,-b,-f,-e);JSM.AddVertexToBody(a,+f,+e,+b);JSM.AddVertexToBody(a,-f,+e,+b);JSM.AddVertexToBody(a,
+f,+e,-b);JSM.AddVertexToBody(a,+f,-e,+b);JSM.AddVertexToBody(a,-f,+e,-b);JSM.AddVertexToBody(a,-f,-e,+b);JSM.AddVertexToBody(a,+f,-e,-b);JSM.AddVertexToBody(a,-f,-e,-b);JSM.AddVertexToBody(a,+c,+g,+h);JSM.AddVertexToBody(a,+c,+g,-h);JSM.AddVertexToBody(a,+c,-g,+h);JSM.AddVertexToBody(a,-c,+g,+h);JSM.AddVertexToBody(a,+c,-g,-h);JSM.AddVertexToBody(a,-c,+g,-h);JSM.AddVertexToBody(a,-c,-g,+h);JSM.AddVertexToBody(a,-c,-g,-h);JSM.AddVertexToBody(a,+g,+h,+c);JSM.AddVertexToBody(a,+g,-h,+c);JSM.AddVertexToBody(a,
-g,+h,+c);JSM.AddVertexToBody(a,+g,+h,-c);JSM.AddVertexToBody(a,-g,-h,+c);JSM.AddVertexToBody(a,+g,-h,-c);JSM.AddVertexToBody(a,-g,+h,-c);JSM.AddVertexToBody(a,-g,-h,-c);JSM.AddVertexToBody(a,+h,+c,+g);JSM.AddVertexToBody(a,-h,+c,+g);JSM.AddVertexToBody(a,+h,+c,-g);JSM.AddVertexToBody(a,+h,-c,+g);JSM.AddVertexToBody(a,-h,+c,-g);JSM.AddVertexToBody(a,-h,-c,+g);JSM.AddVertexToBody(a,+h,-c,-g);JSM.AddVertexToBody(a,-h,-c,-g);JSM.AddVertexToBody(a,+l,2,+k);JSM.AddVertexToBody(a,+l,2,-k);JSM.AddVertexToBody(a,
+l,-2,+k);JSM.AddVertexToBody(a,-l,2,+k);JSM.AddVertexToBody(a,+l,-2,-k);JSM.AddVertexToBody(a,-l,2,-k);JSM.AddVertexToBody(a,-l,-2,+k);JSM.AddVertexToBody(a,-l,-2,-k);JSM.AddVertexToBody(a,2,+k,+l);JSM.AddVertexToBody(a,2,-k,+l);JSM.AddVertexToBody(a,-2,+k,+l);JSM.AddVertexToBody(a,2,+k,-l);JSM.AddVertexToBody(a,-2,-k,+l);JSM.AddVertexToBody(a,2,-k,-l);JSM.AddVertexToBody(a,-2,+k,-l);JSM.AddVertexToBody(a,-2,-k,-l);JSM.AddVertexToBody(a,+k,+l,2);JSM.AddVertexToBody(a,-k,+l,2);JSM.AddVertexToBody(a,
+k,+l,-2);JSM.AddVertexToBody(a,+k,-l,2);JSM.AddVertexToBody(a,-k,+l,-2);JSM.AddVertexToBody(a,-k,-l,2);JSM.AddVertexToBody(a,+k,-l,-2);JSM.AddVertexToBody(a,-k,-l,-2);JSM.AddVertexToBody(a,+b,3,+m);JSM.AddVertexToBody(a,+b,3,-m);JSM.AddVertexToBody(a,+b,-3,+m);JSM.AddVertexToBody(a,-b,3,+m);JSM.AddVertexToBody(a,+b,-3,-m);JSM.AddVertexToBody(a,-b,3,-m);JSM.AddVertexToBody(a,-b,-3,+m);JSM.AddVertexToBody(a,-b,-3,-m);JSM.AddVertexToBody(a,3,+m,+b);JSM.AddVertexToBody(a,3,-m,+b);JSM.AddVertexToBody(a,
-3,+m,+b);JSM.AddVertexToBody(a,3,+m,-b);JSM.AddVertexToBody(a,-3,-m,+b);JSM.AddVertexToBody(a,3,-m,-b);JSM.AddVertexToBody(a,-3,+m,-b);JSM.AddVertexToBody(a,-3,-m,-b);JSM.AddVertexToBody(a,+m,+b,3);JSM.AddVertexToBody(a,-m,+b,3);JSM.AddVertexToBody(a,+m,+b,-3);JSM.AddVertexToBody(a,+m,-b,3);JSM.AddVertexToBody(a,-m,+b,-3);JSM.AddVertexToBody(a,-m,-b,3);JSM.AddVertexToBody(a,+m,-b,-3);JSM.AddVertexToBody(a,-m,-b,-3);JSM.AddPolygonToBody(a,[0,3,6,2]);JSM.AddPolygonToBody(a,[1,4,7,5]);JSM.AddPolygonToBody(a,
[8,11,14,10]);JSM.AddPolygonToBody(a,[9,12,15,13]);JSM.AddPolygonToBody(a,[16,19,22,18]);JSM.AddPolygonToBody(a,[17,20,23,21]);JSM.AddPolygonToBody(a,[24,72,96,48]);JSM.AddPolygonToBody(a,[25,49,97,73]);JSM.AddPolygonToBody(a,[26,50,98,74]);JSM.AddPolygonToBody(a,[27,51,99,75]);JSM.AddPolygonToBody(a,[28,76,100,52]);JSM.AddPolygonToBody(a,[29,77,101,53]);JSM.AddPolygonToBody(a,[30,78,102,54]);JSM.AddPolygonToBody(a,[31,55,103,79]);JSM.AddPolygonToBody(a,[32,80,104,56]);JSM.AddPolygonToBody(a,[33,
57,105,81]);JSM.AddPolygonToBody(a,[34,58,106,82]);JSM.AddPolygonToBody(a,[35,59,107,83]);JSM.AddPolygonToBody(a,[36,84,108,60]);JSM.AddPolygonToBody(a,[37,85,109,61]);JSM.AddPolygonToBody(a,[38,86,110,62]);JSM.AddPolygonToBody(a,[39,63,111,87]);JSM.AddPolygonToBody(a,[40,88,112,64]);JSM.AddPolygonToBody(a,[41,65,113,89]);JSM.AddPolygonToBody(a,[42,66,114,90]);JSM.AddPolygonToBody(a,[43,67,115,91]);JSM.AddPolygonToBody(a,[44,92,116,68]);JSM.AddPolygonToBody(a,[45,93,117,69]);JSM.AddPolygonToBody(a,
[46,94,118,70]);JSM.AddPolygonToBody(a,[47,71,119,95]);JSM.AddPolygonToBody(a,[0,24,48,51,27,3]);JSM.AddPolygonToBody(a,[1,5,29,53,49,25]);JSM.AddPolygonToBody(a,[2,6,30,54,50,26]);JSM.AddPolygonToBody(a,[4,28,52,55,31,7]);JSM.AddPolygonToBody(a,[8,32,56,59,35,11]);JSM.AddPolygonToBody(a,[9,13,37,61,57,33]);JSM.AddPolygonToBody(a,[10,14,38,62,58,34]);JSM.AddPolygonToBody(a,[12,36,60,63,39,15]);JSM.AddPolygonToBody(a,[16,40,64,67,43,19]);JSM.AddPolygonToBody(a,[17,21,45,69,65,41]);JSM.AddPolygonToBody(a,
[18,22,46,70,66,42]);JSM.AddPolygonToBody(a,[20,44,68,71,47,23]);JSM.AddPolygonToBody(a,[72,112,88,104,80,96]);JSM.AddPolygonToBody(a,[73,97,83,107,90,114]);JSM.AddPolygonToBody(a,[74,98,81,105,91,115]);JSM.AddPolygonToBody(a,[75,99,82,106,89,113]);JSM.AddPolygonToBody(a,[76,118,94,109,85,100]);JSM.AddPolygonToBody(a,[78,117,93,108,84,102]);JSM.AddPolygonToBody(a,[79,103,87,111,95,119]);JSM.AddPolygonToBody(a,[86,101,77,116,92,110]);JSM.AddPolygonToBody(a,[0,2,26,74,115,67,64,112,72,24]);JSM.AddPolygonToBody(a,
[1,25,73,114,66,70,118,76,28,4]);JSM.AddPolygonToBody(a,[3,27,75,113,65,69,117,78,30,6]);JSM.AddPolygonToBody(a,[5,7,31,79,119,71,68,116,77,29]);JSM.AddPolygonToBody(a,[8,10,34,82,99,51,48,96,80,32]);JSM.AddPolygonToBody(a,[9,33,81,98,50,54,102,84,36,12]);JSM.AddPolygonToBody(a,[11,35,83,97,49,53,101,86,38,14]);JSM.AddPolygonToBody(a,[13,15,39,87,103,55,52,100,85,37]);JSM.AddPolygonToBody(a,[16,18,42,90,107,59,56,104,88,40]);JSM.AddPolygonToBody(a,[17,41,89,106,58,62,110,92,44,20]);JSM.AddPolygonToBody(a,
[19,43,91,105,57,61,109,94,46,22]);JSM.AddPolygonToBody(a,[21,23,47,95,111,63,60,108,93,45]);return a};
JSM.GenerateSnubDodecahedron=function(){var a=new JSM.Body,b=(1+Math.sqrt(5))/2,c=Math.pow(b/2+0.5*Math.sqrt(b-5/27),1/3)+Math.pow(b/2-0.5*Math.sqrt(b-5/27),1/3),d=c-1/c,e=c*b+Math.pow(b,2)+b/c,c=2*d,f=2*e,g=d+e/b+b,h=-(d*b)+e+1/b,l=d/b+e*b-1,k=-(d/b)+e*b+1,m=-d+e/b-b,n=d*b+e-1/b,p=-(d/b)+e*b-1,q=d-e/b-b,r=d*b+e+1/b,s=d+e/b-b,x=d*b-e+1/b,b=d/b+e*b+1;JSM.AddVertexToBody(a,+c,2,-f);JSM.AddVertexToBody(a,+c,-2,+f);JSM.AddVertexToBody(a,-c,2,+f);JSM.AddVertexToBody(a,-c,-2,-f);JSM.AddVertexToBody(a,2,
-f,+c);JSM.AddVertexToBody(a,-2,+f,+c);JSM.AddVertexToBody(a,2,+f,-c);JSM.AddVertexToBody(a,-2,-f,-c);JSM.AddVertexToBody(a,-f,+c,2);JSM.AddVertexToBody(a,+f,+c,-2);JSM.AddVertexToBody(a,+f,-c,2);JSM.AddVertexToBody(a,-f,-c,-2);JSM.AddVertexToBody(a,+g,+h,-l);JSM.AddVertexToBody(a,+g,-h,+l);JSM.AddVertexToBody(a,-g,+h,+l);JSM.AddVertexToBody(a,-g,-h,-l);JSM.AddVertexToBody(a,+h,-l,+g);JSM.AddVertexToBody(a,-h,+l,+g);JSM.AddVertexToBody(a,+h,+l,-g);JSM.AddVertexToBody(a,-h,-l,-g);JSM.AddVertexToBody(a,
-l,+g,+h);JSM.AddVertexToBody(a,+l,+g,-h);JSM.AddVertexToBody(a,+l,-g,+h);JSM.AddVertexToBody(a,-l,-g,-h);JSM.AddVertexToBody(a,+k,+m,-n);JSM.AddVertexToBody(a,+k,-m,+n);JSM.AddVertexToBody(a,-k,+m,+n);JSM.AddVertexToBody(a,-k,-m,-n);JSM.AddVertexToBody(a,+m,-n,+k);JSM.AddVertexToBody(a,-m,+n,+k);JSM.AddVertexToBody(a,+m,+n,-k);JSM.AddVertexToBody(a,-m,-n,-k);JSM.AddVertexToBody(a,-n,+k,+m);JSM.AddVertexToBody(a,+n,+k,-m);JSM.AddVertexToBody(a,+n,-k,+m);JSM.AddVertexToBody(a,-n,-k,-m);JSM.AddVertexToBody(a,
+p,+q,-r);JSM.AddVertexToBody(a,+p,-q,+r);JSM.AddVertexToBody(a,-p,+q,+r);JSM.AddVertexToBody(a,-p,-q,-r);JSM.AddVertexToBody(a,+q,-r,+p);JSM.AddVertexToBody(a,-q,+r,+p);JSM.AddVertexToBody(a,+q,+r,-p);JSM.AddVertexToBody(a,-q,-r,-p);JSM.AddVertexToBody(a,-r,+p,+q);JSM.AddVertexToBody(a,+r,+p,-q);JSM.AddVertexToBody(a,+r,-p,+q);JSM.AddVertexToBody(a,-r,-p,-q);JSM.AddVertexToBody(a,+s,+x,-b);JSM.AddVertexToBody(a,+s,-x,+b);JSM.AddVertexToBody(a,-s,+x,+b);JSM.AddVertexToBody(a,-s,-x,-b);JSM.AddVertexToBody(a,
+x,-b,+s);JSM.AddVertexToBody(a,-x,+b,+s);JSM.AddVertexToBody(a,+x,+b,-s);JSM.AddVertexToBody(a,-x,-b,-s);JSM.AddVertexToBody(a,-b,+s,+x);JSM.AddVertexToBody(a,+b,+s,-x);JSM.AddVertexToBody(a,+b,-s,+x);JSM.AddVertexToBody(a,-b,-s,-x);JSM.AddPolygonToBody(a,[0,3,51]);JSM.AddPolygonToBody(a,[0,30,12]);JSM.AddPolygonToBody(a,[0,48,3]);JSM.AddPolygonToBody(a,[0,51,30]);JSM.AddPolygonToBody(a,[1,2,50]);JSM.AddPolygonToBody(a,[1,28,13]);JSM.AddPolygonToBody(a,[1,49,2]);JSM.AddPolygonToBody(a,[1,50,28]);
JSM.AddPolygonToBody(a,[2,29,14]);JSM.AddPolygonToBody(a,[2,49,29]);JSM.AddPolygonToBody(a,[3,31,15]);JSM.AddPolygonToBody(a,[3,48,31]);JSM.AddPolygonToBody(a,[4,7,55]);JSM.AddPolygonToBody(a,[4,34,16]);JSM.AddPolygonToBody(a,[4,52,7]);JSM.AddPolygonToBody(a,[4,55,34]);JSM.AddPolygonToBody(a,[5,6,54]);JSM.AddPolygonToBody(a,[5,32,17]);JSM.AddPolygonToBody(a,[5,53,6]);JSM.AddPolygonToBody(a,[5,54,32]);JSM.AddPolygonToBody(a,[6,33,18]);JSM.AddPolygonToBody(a,[6,53,33]);JSM.AddPolygonToBody(a,[7,35,
19]);JSM.AddPolygonToBody(a,[7,52,35]);JSM.AddPolygonToBody(a,[8,11,59]);JSM.AddPolygonToBody(a,[8,26,20]);JSM.AddPolygonToBody(a,[8,56,11]);JSM.AddPolygonToBody(a,[8,59,26]);JSM.AddPolygonToBody(a,[9,10,58]);JSM.AddPolygonToBody(a,[9,24,21]);JSM.AddPolygonToBody(a,[9,57,10]);JSM.AddPolygonToBody(a,[9,58,24]);JSM.AddPolygonToBody(a,[10,25,22]);JSM.AddPolygonToBody(a,[10,57,25]);JSM.AddPolygonToBody(a,[11,27,23]);JSM.AddPolygonToBody(a,[11,56,27]);JSM.AddPolygonToBody(a,[12,18,21]);JSM.AddPolygonToBody(a,
[12,21,24]);JSM.AddPolygonToBody(a,[12,30,18]);JSM.AddPolygonToBody(a,[13,16,22]);JSM.AddPolygonToBody(a,[13,22,25]);JSM.AddPolygonToBody(a,[13,28,16]);JSM.AddPolygonToBody(a,[14,17,20]);JSM.AddPolygonToBody(a,[14,20,26]);JSM.AddPolygonToBody(a,[14,29,17]);JSM.AddPolygonToBody(a,[15,19,23]);JSM.AddPolygonToBody(a,[15,23,27]);JSM.AddPolygonToBody(a,[15,31,19]);JSM.AddPolygonToBody(a,[16,34,22]);JSM.AddPolygonToBody(a,[17,32,20]);JSM.AddPolygonToBody(a,[18,33,21]);JSM.AddPolygonToBody(a,[19,35,23]);
JSM.AddPolygonToBody(a,[24,58,36]);JSM.AddPolygonToBody(a,[25,57,37]);JSM.AddPolygonToBody(a,[26,59,38]);JSM.AddPolygonToBody(a,[27,56,39]);JSM.AddPolygonToBody(a,[28,50,40]);JSM.AddPolygonToBody(a,[29,49,41]);JSM.AddPolygonToBody(a,[30,51,42]);JSM.AddPolygonToBody(a,[31,48,43]);JSM.AddPolygonToBody(a,[32,54,44]);JSM.AddPolygonToBody(a,[33,53,45]);JSM.AddPolygonToBody(a,[34,55,46]);JSM.AddPolygonToBody(a,[35,52,47]);JSM.AddPolygonToBody(a,[36,43,48]);JSM.AddPolygonToBody(a,[36,46,43]);JSM.AddPolygonToBody(a,
[36,58,46]);JSM.AddPolygonToBody(a,[37,41,49]);JSM.AddPolygonToBody(a,[37,45,41]);JSM.AddPolygonToBody(a,[37,57,45]);JSM.AddPolygonToBody(a,[38,40,50]);JSM.AddPolygonToBody(a,[38,47,40]);JSM.AddPolygonToBody(a,[38,59,47]);JSM.AddPolygonToBody(a,[39,42,51]);JSM.AddPolygonToBody(a,[39,44,42]);JSM.AddPolygonToBody(a,[39,56,44]);JSM.AddPolygonToBody(a,[40,47,52]);JSM.AddPolygonToBody(a,[41,45,53]);JSM.AddPolygonToBody(a,[42,44,54]);JSM.AddPolygonToBody(a,[43,46,55]);JSM.AddPolygonToBody(a,[0,12,24,36,
48]);JSM.AddPolygonToBody(a,[1,13,25,37,49]);JSM.AddPolygonToBody(a,[2,14,26,38,50]);JSM.AddPolygonToBody(a,[3,15,27,39,51]);JSM.AddPolygonToBody(a,[4,16,28,40,52]);JSM.AddPolygonToBody(a,[5,17,29,41,53]);JSM.AddPolygonToBody(a,[6,18,30,42,54]);JSM.AddPolygonToBody(a,[7,19,31,43,55]);JSM.AddPolygonToBody(a,[8,20,32,44,56]);JSM.AddPolygonToBody(a,[9,21,33,45,57]);JSM.AddPolygonToBody(a,[10,22,34,46,58]);JSM.AddPolygonToBody(a,[11,23,35,47,59]);return a};
JSM.AddCumulatedPolygonToBody=function(a,b,c){var d=new JSM.Coord(0,0,0),e=new JSM.Vector(0,0,0),f=d,g=[],h;for(h=0;h<b.length;h++)g.push(a.GetVertexPosition(b[h]));h=JSM.CalculateCentroid(g);g=JSM.CalculateNormal(g);f.Set(h.x,h.y,h.z);e.Set(g.x,g.y,g.z);d=JSM.CoordOffset(d,e,c);c=a.VertexCount();JSM.AddVertexToBody(a,d.x,d.y,d.z);d=b.length;for(e=0;e<d;e++)f=b[e],g=b[e<d-1?e+1:0],JSM.AddPolygonToBody(a,[f,g,c])};
JSM.GenerateCumulatedTetrahedron=function(a){var b=new JSM.Body;b.AddVertex(new JSM.BodyVertex(new JSM.Coord(1,1,1)));b.AddVertex(new JSM.BodyVertex(new JSM.Coord(-1,-1,1)));b.AddVertex(new JSM.BodyVertex(new JSM.Coord(-1,1,-1)));b.AddVertex(new JSM.BodyVertex(new JSM.Coord(1,-1,-1)));a*=2*Math.sqrt(2);JSM.AddCumulatedPolygonToBody(b,[0,1,3],a);JSM.AddCumulatedPolygonToBody(b,[0,2,1],a);JSM.AddCumulatedPolygonToBody(b,[0,3,2],a);JSM.AddCumulatedPolygonToBody(b,[1,2,3],a);return b};
JSM.GenerateCumulatedHexahedron=function(a){var b=new JSM.Body;JSM.AddVertexToBody(b,1,1,1);JSM.AddVertexToBody(b,1,1,-1);JSM.AddVertexToBody(b,1,-1,1);JSM.AddVertexToBody(b,-1,1,1);JSM.AddVertexToBody(b,1,-1,-1);JSM.AddVertexToBody(b,-1,1,-1);JSM.AddVertexToBody(b,-1,-1,1);JSM.AddVertexToBody(b,-1,-1,-1);a*=2;JSM.AddCumulatedPolygonToBody(b,[0,1,5,3],a);JSM.AddCumulatedPolygonToBody(b,[0,2,4,1],a);JSM.AddCumulatedPolygonToBody(b,[0,3,6,2],a);JSM.AddCumulatedPolygonToBody(b,[1,4,7,5],a);JSM.AddCumulatedPolygonToBody(b,
[2,6,7,4],a);JSM.AddCumulatedPolygonToBody(b,[3,5,7,6],a);return b};
JSM.GenerateCumulatedOctahedron=function(a){var b=new JSM.Body;JSM.AddVertexToBody(b,1,0,0);JSM.AddVertexToBody(b,-1,0,0);JSM.AddVertexToBody(b,0,1,0);JSM.AddVertexToBody(b,0,-1,0);JSM.AddVertexToBody(b,0,0,1);JSM.AddVertexToBody(b,0,0,-1);a*=Math.sqrt(2);JSM.AddCumulatedPolygonToBody(b,[0,2,4],a);JSM.AddCumulatedPolygonToBody(b,[0,3,5],a);JSM.AddCumulatedPolygonToBody(b,[0,4,3],a);JSM.AddCumulatedPolygonToBody(b,[0,5,2],a);JSM.AddCumulatedPolygonToBody(b,[1,2,5],a);JSM.AddCumulatedPolygonToBody(b,
[1,3,4],a);JSM.AddCumulatedPolygonToBody(b,[1,4,2],a);JSM.AddCumulatedPolygonToBody(b,[1,5,3],a);return b};
JSM.GenerateCumulatedDodecahedron=function(a){var b=new JSM.Body,c=(1+Math.sqrt(5))/2,d=1/c;JSM.AddVertexToBody(b,1,1,1);JSM.AddVertexToBody(b,1,1,-1);JSM.AddVertexToBody(b,1,-1,1);JSM.AddVertexToBody(b,-1,1,1);JSM.AddVertexToBody(b,1,-1,-1);JSM.AddVertexToBody(b,-1,1,-1);JSM.AddVertexToBody(b,-1,-1,1);JSM.AddVertexToBody(b,-1,-1,-1);JSM.AddVertexToBody(b,0,+d,+c);JSM.AddVertexToBody(b,0,+d,-c);JSM.AddVertexToBody(b,0,-d,+c);JSM.AddVertexToBody(b,0,-d,-c);JSM.AddVertexToBody(b,+d,+c,0);JSM.AddVertexToBody(b,
+d,-c,0);JSM.AddVertexToBody(b,-d,+c,0);JSM.AddVertexToBody(b,-d,-c,0);JSM.AddVertexToBody(b,+c,0,+d);JSM.AddVertexToBody(b,-c,0,+d);JSM.AddVertexToBody(b,+c,0,-d);JSM.AddVertexToBody(b,-c,0,-d);a*=Math.sqrt(5)-1;JSM.AddCumulatedPolygonToBody(b,[0,8,10,2,16],a);JSM.AddCumulatedPolygonToBody(b,[0,16,18,1,12],a);JSM.AddCumulatedPolygonToBody(b,[0,12,14,3,8],a);JSM.AddCumulatedPolygonToBody(b,[1,9,5,14,12],a);JSM.AddCumulatedPolygonToBody(b,[1,18,4,11,9],a);JSM.AddCumulatedPolygonToBody(b,[2,10,6,15,
13],a);JSM.AddCumulatedPolygonToBody(b,[2,13,4,18,16],a);JSM.AddCumulatedPolygonToBody(b,[3,14,5,19,17],a);JSM.AddCumulatedPolygonToBody(b,[3,17,6,10,8],a);JSM.AddCumulatedPolygonToBody(b,[4,13,15,7,11],a);JSM.AddCumulatedPolygonToBody(b,[5,9,11,7,19],a);JSM.AddCumulatedPolygonToBody(b,[6,17,19,7,15],a);return b};
JSM.GenerateCumulatedIcosahedron=function(a){var b=new JSM.Body,c=(1+Math.sqrt(5))/2;JSM.AddVertexToBody(b,0,1,+c);JSM.AddVertexToBody(b,0,1,-c);JSM.AddVertexToBody(b,0,-1,+c);JSM.AddVertexToBody(b,0,-1,-c);JSM.AddVertexToBody(b,1,+c,0);JSM.AddVertexToBody(b,1,-c,0);JSM.AddVertexToBody(b,-1,+c,0);JSM.AddVertexToBody(b,-1,-c,0);JSM.AddVertexToBody(b,+c,0,1);JSM.AddVertexToBody(b,-c,0,1);JSM.AddVertexToBody(b,+c,0,-1);JSM.AddVertexToBody(b,-c,0,-1);a*=2;JSM.AddCumulatedPolygonToBody(b,[0,2,8],a);JSM.AddCumulatedPolygonToBody(b,
[0,4,6],a);JSM.AddCumulatedPolygonToBody(b,[0,6,9],a);JSM.AddCumulatedPolygonToBody(b,[0,8,4],a);JSM.AddCumulatedPolygonToBody(b,[0,9,2],a);JSM.AddCumulatedPolygonToBody(b,[1,3,11],a);JSM.AddCumulatedPolygonToBody(b,[1,4,10],a);JSM.AddCumulatedPolygonToBody(b,[1,6,4],a);JSM.AddCumulatedPolygonToBody(b,[1,10,3],a);JSM.AddCumulatedPolygonToBody(b,[1,11,6],a);JSM.AddCumulatedPolygonToBody(b,[2,5,8],a);JSM.AddCumulatedPolygonToBody(b,[2,7,5],a);JSM.AddCumulatedPolygonToBody(b,[2,9,7],a);JSM.AddCumulatedPolygonToBody(b,
[3,5,7],a);JSM.AddCumulatedPolygonToBody(b,[3,7,11],a);JSM.AddCumulatedPolygonToBody(b,[3,10,5],a);JSM.AddCumulatedPolygonToBody(b,[4,8,10],a);JSM.AddCumulatedPolygonToBody(b,[6,11,9],a);JSM.AddCumulatedPolygonToBody(b,[5,10,8],a);JSM.AddCumulatedPolygonToBody(b,[7,9,11],a);return b};JSM.GenerateTetrakisHexahedron=function(){return JSM.GenerateCumulatedHexahedron(0.25)};JSM.GenerateRhombicDodecahedron=function(){return JSM.GenerateCumulatedHexahedron(0.5)};
JSM.GeneratePentakisDodecahedron=function(){var a=Math.sqrt((65+22*Math.sqrt(5))/5)/19;return JSM.GenerateCumulatedDodecahedron(a)};JSM.GenerateSmallStellatedDodecahedron=function(){var a=Math.sqrt((5+2*Math.sqrt(5))/5);return JSM.GenerateCumulatedDodecahedron(a)};JSM.GenerateGreatDodecahedron=function(){var a=Math.sqrt(3)*(Math.sqrt(5)-3)/6;return JSM.GenerateCumulatedIcosahedron(a)};JSM.GenerateSmallTriambicIcosahedron=function(){var a=Math.sqrt(15)/15;return JSM.GenerateCumulatedIcosahedron(a)};
JSM.GenerateGreatStellatedDodecahedron=function(){var a=Math.sqrt(3)*(3+Math.sqrt(5))/6;return JSM.GenerateCumulatedIcosahedron(a)};JSM.GenerateSmallTriakisOctahedron=function(){var a=Math.sqrt(3)-2*Math.sqrt(6)/3;return JSM.GenerateCumulatedOctahedron(a)};JSM.GenerateStellaOctangula=function(){var a=Math.sqrt(6)/3;return JSM.GenerateCumulatedOctahedron(a)};JSM.GenerateTriakisTetrahedron=function(){var a=Math.sqrt(6)/15;return JSM.GenerateCumulatedTetrahedron(a)};
JSM.LegoDimensions=function(){this.legoWidth=0.78;this.legoSmallHeight=0.32;this.legoLargeHeight=0.96;this.legoWallWidth=0.16;this.legoCylinderWidth=0.5;this.legoCylinderHeight=0.17;this.legoBottomSmallCylinderWidth=0.3;this.legoBottomLargeCylinderWidth=0.6;this.legoBottomLargeCylinderWallWidth=0.1};
JSM.GenerateLegoBrick=function(a,b,c,d,e,f,g){function h(a,b){var c,d;for(c=0;c<a.VertexCount();c++)d=a.GetVertex(c),d.position=JSM.CoordAdd(d.position,b)}var l=new JSM.LegoDimensions,k=new JSM.Vector(0,0,1),m=l.legoWidth,n=l.legoLargeHeight;c||(n=l.legoSmallHeight);c=l.legoWallWidth;var p=l.legoCylinderWidth,q=l.legoCylinderHeight,r=l.legoBottomSmallCylinderWidth,s=l.legoBottomLargeCylinderWidth,x=l.legoBottomLargeCylinderWallWidth,v=[];v.push(new JSM.Coord(0,0,0));v.push(new JSM.Coord(m*a,0,0));
v.push(new JSM.Coord(m*a,m*b,0));v.push(new JSM.Coord(0,m*b,0));var l=new JSM.Body,t=JSM.GeneratePrismShell(v,k,n-c,c,!0);l.Merge(t);for(t=0;4>t;t++)v[t].z=n-c;t=JSM.GeneratePrism(v,k,c,!0);l.Merge(t);if(d)for(t=0;t<a;t++)for(v=0;v<b;v++)d=new JSM.Coord(m*t+m/2,m*v+m/2,n+q/2),k=JSM.GenerateCylinder(p/2,q,f,!0,g),h(k,d),l.Merge(k);if(e)if(1===a&&1<b||1===b&&1<a){e=b;p=!0;a>b&&(e=a,p=!1);for(t=0;t<e-1;t++)d=p?new JSM.Coord(m/2,m*(t+1),(n-c)/2):new JSM.Coord(m*(t+1),m/2,(n-c)/2),k=JSM.GenerateCylinder(r/
2,n-c,f,!0,g),h(k,d),l.Merge(k)}else if(1<a&&1<b)for(t=0;t<a-1;t++)for(v=0;v<b-1;v++)d=new JSM.Coord(m*(t+1),m*(v+1),(n-c)/2),k=JSM.GenerateCylinderShell(s/2,n-c,x,f,!0,g),h(k,d),l.Merge(k);l.SetCubicTextureProjection(new JSM.Coord(0,0,0),new JSM.Coord(1,0,0),new JSM.Coord(0,1,0),new JSM.Coord(0,0,1));return l};
JSM.GenerateConvexHullBody=function(a){var b=new JSM.Body,c=JSM.ConvexHull3D(a),d={},e,f,g,h;for(e=0;e<c.length;e++){g=c[e];for(f=0;f<g.length;f++)h=g[f],h in d||(d[h]=b.VertexCount(),b.AddVertex(new JSM.BodyVertex(a[h])))}for(e=0;e<c.length;e++){g=c[e];a=[];for(f=0;f<g.length;f++)h=g[f],a.push(d[h]);b.AddPolygon(new JSM.BodyPolygon(a))}return b};
JSM.GenerateSuperShape=function(a,b,c,d,e,f,g,h,l,k,m,n,p,q){function r(a){var b=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z),c=Math.asin(a.z/b);a=Math.atan2(a.y,a.x);return[b,c,a]}function s(a,b,c,d,e,f,g){b=Math.abs(Math.cos(d*a/4)/b);a=Math.abs(Math.sin(d*a/4)/c);return Math.pow(Math.pow(b,f)+Math.pow(a,g),-1/e)}function x(p,q){var x=new JSM.Coord(0,0,0),t=s(p,g,h,l,k,m,n),r=s(q,a,b,c,d,e,f);x.x=r*Math.cos(q)*t*Math.cos(p);x.y=r*Math.sin(q)*t*Math.cos(p);x.z=t*Math.sin(p);return x}p=JSM.GenerateSphere(1,
p,q);var v,t;for(q=0;q<p.VertexCount();q++)v=p.GetVertex(q),t=v.position,t=r(t),t=x(t[1],t[2]),v.SetPosition(t);return p};
JSM.OrderPolygons=function(a,b,c){var d=[],e=[],f=[],g=[],h=[],l=[],k=[],m=a.PolygonCount(),n,p;for(n=0;n<m;n++){l.push(n);k.push([]);for(p=0;p<m;p++)k[n].push(null)}(function(){var k=JSM.VectorNormalize(JSM.CoordSub(c,b)),k=JSM.GetPlaneFromCoordAndDirection(b,k),l,m,n,p,t,y;for(l=0;l<a.PolygonCount();l++){t=JSM.Inf;y=-JSM.Inf;n=a.GetPolygon(l);for(m=0;m<n.VertexIndexCount();m++)p=a.GetVertexPosition(n.GetVertexIndex(m)),p=JSM.CoordPlaneDistance(p,k),JSM.IsLower(p,t)&&(t=p),JSM.IsGreater(p,y)&&(y=
p);d.push(t);e.push(y);m=a.GetPolygon(l);n=new JSM.Coord(0,0,0);y=t=void 0;for(t=0;t<m.VertexIndexCount();t++)y=a.GetVertexPosition(m.GetVertexIndex(t)),n=JSM.CoordAdd(n,y);m=n=JSM.VectorMultiply(n,1/m.VertexIndexCount());n=JSM.CoordPlaneDistance(m,k);f.push(m);g.push(n);n=JSM.CalculateBodyPolygonNormal(a,l);t=JSM.VectorNormalize(JSM.CoordSub(m,b));t=JSM.VectorDot(n,t);JSM.IsGreaterOrEqual(t,0)&&(n=JSM.VectorMultiply(n,-1));m=JSM.GetPlaneFromCoordAndDirection(m,n);h.push(m)}})();(function(){var a=
l.length,b,c;for(b=0;b<a-1;b++)for(c=0;c<a-b-1;c++){var d;d=l[c];var f=l[c+1];d=JSM.IsLower(e[d],e[f])?!0:JSM.IsEqual(e[d],e[f])&&JSM.IsLower(g[d],g[f])?!0:!1;if(d){d=l;var f=c+1,h=d[c];d[c]=d[f];d[f]=h}}})();(function(){var b=l.length,c,f;for(c=0;c<b-1;c++)for(f=0;f<b-c-1;f++){var g;g=l[f];var m=l[f+1];if(null!==k[g][m])g=k[g][m];else{var n;if(n=JSM.IsLowerOrEqual(d[g],e[m])){var p=m;n=h[g];for(var F=h[p],C=void 0,u=void 0,H=!0,z=a.GetPolygon(g),C=0;C<z.VertexIndexCount();C++)if(u=a.GetVertexPosition(z.GetVertexIndex(C)),
"CoordInFrontOfPlane"===JSM.CoordPlanePosition(u,F)){H=!1;break}if(H)n=!1;else{F=!0;p=a.GetPolygon(p);for(C=0;C<p.VertexIndexCount();C++)if(u=a.GetVertexPosition(p.GetVertexIndex(C)),"CoordAtBackOfPlane"===JSM.CoordPlanePosition(u,n)){F=!1;break}n=F?!1:!0}}g=n?k[g][m]=!0:k[g][m]=!1}g&&(g=l,m=f+1,n=g[f],g[f]=g[m],g[m]=n)}})();return l};JSM.CanvasDrawer=function(a){this.canvas=a;this.context=this.canvas.getContext("2d")};JSM.CanvasDrawer.prototype.GetWidth=function(){return this.canvas.width};
JSM.CanvasDrawer.prototype.GetHeight=function(){return this.canvas.height};JSM.CanvasDrawer.prototype.BeginPath=function(){this.context.beginPath()};JSM.CanvasDrawer.prototype.EndPath=function(){this.context.stroke()};JSM.CanvasDrawer.prototype.Clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.fillStyle="#ffffff";this.context.fillRect(0,0,this.canvas.width,this.canvas.height)};
JSM.CanvasDrawer.prototype.DrawLine=function(a,b){this.context.moveTo(a.x,this.canvas.height-a.y);this.context.lineTo(b.x,this.canvas.height-b.y)};
JSM.CanvasDrawer.prototype.DrawPolygon=function(a,b){var c=this.context,d=JSM.HexColorToRGBComponents(b);c.fillStyle="rgb("+d[0]+","+d[1]+","+d[2]+")";this.context.beginPath();for(var e,c=0;c<a.VertexCount();c++)d=a.GetVertex(c),0===c?this.context.moveTo(d.x,this.canvas.height-d.y):this.context.lineTo(d.x,this.canvas.height-d.y);this.context.closePath();this.context.fill();this.BeginPath();for(c=0;c<a.VertexCount();c++)d=a.GetVertex(c),e=a.GetVertex(c<a.VertexCount()-1?c+1:0),this.DrawLine(d,e);this.EndPath()};
JSM.SVGDrawer=function(a){this.svgObject=a;this.svgNameSpace="http://www.w3.org/2000/svg"};JSM.SVGDrawer.prototype.GetWidth=function(){return this.svgObject.getAttribute("width")};JSM.SVGDrawer.prototype.GetHeight=function(){return this.svgObject.getAttribute("height")};JSM.SVGDrawer.prototype.BeginPath=function(){};JSM.SVGDrawer.prototype.EndPath=function(){};JSM.SVGDrawer.prototype.Clear=function(){for(;this.svgObject.lastChild;)this.svgObject.removeChild(this.svgObject.lastChild)};
JSM.SVGDrawer.prototype.DrawLine=function(a,b){var c=document.createElementNS(this.svgNameSpace,"line"),d=this.GetHeight();c.setAttributeNS(null,"stroke","black");c.setAttributeNS(null,"x1",a.x);c.setAttributeNS(null,"y1",d-a.y);c.setAttributeNS(null,"x2",b.x);c.setAttributeNS(null,"y2",d-b.y);this.svgObject.appendChild(c)};
JSM.SVGDrawer.prototype.DrawPolygon=function(a,b){var c="",d=this.GetHeight(),e,f;for(e=0;e<a.VertexCount();e++)f=a.GetVertex(e),c=c+f.x+", "+(d-f.y),e<a.VertexCount()-1&&(c+=", ");d=document.createElementNS(this.svgNameSpace,"polygon");d.setAttributeNS(null,"points",c);d.setAttributeNS(null,"fill",function(a){a=JSM.HexColorToRGBComponents(a);return"rgb("+a[0]+","+a[1]+","+a[2]+")"}(b));d.setAttributeNS(null,"fill-opacity","1.0");d.setAttributeNS(null,"stroke","black");this.svgObject.appendChild(d)};
JSM.DrawProjectedBody=function(a,b,c,d,e,f){function g(b){var c=new JSM.Polygon2D,d,e,f;for(d=0;d<b.VertexIndexCount();d++)e=a.GetVertexPosition(b.GetVertexIndex(d)),f=JSM.Project(e,l,k,m,n*JSM.DegRad,p,q,r,s),e=f.x,f=f.y,c.AddVertex(e,f);return c}e&&f.Clear();e=f.GetWidth();var h=f.GetHeight(),l=c.eye,k=c.center,m=c.up,n=c.fieldOfView,p=e/h,q=c.nearClippingPlane,r=c.farClippingPlane,s=[0,0,e,h];if("HiddenLinePainter"==d){h=JSM.OrderPolygons(a,l,k);if(void 0===b||null===b)b=new JSM.Materials;for(c=
0;c<h.length;c++)e=a.GetPolygon(h[c]),d=g(e),e=e.GetMaterialIndex(),e=b.GetMaterial(e).diffuse,f.DrawPolygon(d,e)}else if("HiddenLineFrontFacing"==d){if(void 0===b||null===b)b=new JSM.Materials;for(c=0;c<a.PolygonCount();c++)e=a.GetPolygon(c),d=g(e),"CounterClockwise"==JSM.PolygonOrientation2D(d)&&(e=e.GetMaterialIndex(),e=b.GetMaterial(e).diffuse,f.DrawPolygon(d,e))}else if("Wireframe"==d){var x,v,t;f.BeginPath();var y=[];for(c=0;c<a.PolygonCount();c++){v=x=null;e=a.GetPolygon(c);h=e.VertexIndexCount();
for(b=0;b<=h;b++)t=e.GetVertexIndex(b%h),d=a.GetVertexPosition(t),d=JSM.Project(d,l,k,m,n*JSM.DegRad,p,q,r,s),null!==x&&(null!==v&&void 0===y[[v,t]])&&(f.DrawLine(x,d),y[[v,t]]=!0,y[[t,v]]=!0),v=t,x=d}f.EndPath()}return!0};
JSM.CatmullClarkSubdivisionOneIteration=function(a){var b=new JSM.Body,c=JSM.CalculateAdjacencyInfo(a);(function(){var d,e;for(d=0;d<c.verts.length;d++)e=a.GetVertex(d).position,b.AddVertex(new JSM.BodyVertex(new JSM.Coord(e.x,e.y,e.z)))})();var d=[];(function(){var e,g,h,l,k;for(e=0;e<c.pgons.length;e++){h=c.pgons[e];k=new JSM.Coord(0,0,0);for(g=0;g<h.verts.length;g++)l=a.GetVertex(h.verts[g]).position,k=JSM.CoordAdd(k,l);k=JSM.VectorMultiply(k,1/h.verts.length);d.push(b.AddVertex(new JSM.BodyVertex(k)))}})();
var e=[];(function(){var f,g,h,l,k;for(f=0;f<c.edges.length;f++){h=c.edges[f];l=new JSM.Coord(0,0,0);l=JSM.CoordAdd(l,JSM.VectorMultiply(a.GetVertex(h.vert1).position,0.25));l=JSM.CoordAdd(l,JSM.VectorMultiply(a.GetVertex(h.vert2).position,0.25));for(g=0;2>g;g++)k=0===g?h.pgon1:h.pgon2,-1===k&&(k=0===g?h.pgon2:h.pgon1),k=b.GetVertex(d[k]).position,l=JSM.CoordAdd(l,JSM.VectorMultiply(k,0.25));e.push(b.AddVertex(new JSM.BodyVertex(l)))}})();(function(){var e=[],g,h,l,k;for(l=0;l<c.edges.length;l++)g=
c.edges[l],h=JSM.MidCoord(a.GetVertex(g.vert1).position,a.GetVertex(g.vert2).position),e.push(h);var m,n,p;for(l=0;l<c.verts.length;l++){m=c.verts[l];p=new JSM.Coord(0,0,0);g=new JSM.Coord(0,0,0);n=1/m.pgons.length;for(k=0;k<m.pgons.length;k++)h=b.GetVertex(d[m.pgons[k]]).position,p=JSM.CoordAdd(p,JSM.VectorMultiply(h,n));n=1/m.edges.length;for(k=0;k<m.edges.length;k++)h=e[m.edges[k]],g=JSM.CoordAdd(g,JSM.VectorMultiply(h,n));m=m.edges.length;k=b.GetVertex(l).position;k.x=(p.x+2*g.x+(m-3)*k.x)/m;
k.y=(p.y+2*g.y+(m-3)*k.y)/m;k.z=(p.z+2*g.z+(m-3)*k.z)/m}})();(function(){var f,g,h,l,k,m,n,p;for(m=0;m<c.pgons.length;m++){p=c.pgons[m];f=p.verts.length;for(n=0;n<f;n++)g=p.pedges[n],h=p.pedges[(n+1)%f],l=d[m],g=e[g.index],k=JSM.GetPolyEdgeStartVertex(h,c),h=e[h.index],l=new JSM.BodyPolygon([l,g,k,h]),h=a.GetPolygon(m),l.material=h.material,l.curved=h.curved,b.AddPolygon(l)}})();return b};
JSM.CatmullClarkSubdivision=function(a,b){var c=a,d;for(d=0;d<b;d++)c=JSM.CatmullClarkSubdivisionOneIteration(c);return c};
JSM.SvgToModel=function(a,b,c){function d(a,b){function c(a,b,d,e,f,g){a=a.createSVGPoint();a.x=f;a.y=g;e=a.matrixTransform(e.getCTM());a=new JSM.Coord2D(e.x,e.y);f=new JSM.Coord2D(f,g);g=b.VertexCount(d);if(0<g&&JSM.CoordIsEqual2DWithEps(b.GetVertex(d,g-1),a,0.1))return f;b.AddVertex(d,e.x,e.y);return f}function d(a,b,e,f,g,h,k){var l=document.createElementNS("http://www.w3.org/2000/svg","path"),m="M "+f.x+" "+f.y+" ",n,q,t,r,s;for(n=0;n<g.length;n++)if(q=g[n],q.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS||
q.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL)t=q.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS?"C":"c",m+=t+" "+q.x1+" "+q.y1+" "+q.x2+" "+q.y2+" "+q.x+" "+q.y+" ";else if(q.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS||q.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL)t=q.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS?"Q":"q",m+=t+" "+q.x1+" "+q.y1+" "+q.x+" "+q.y+" ";else if(q.pathSegType==SVGPathSeg.PATHSEG_ARC_ABS||q.pathSegType==SVGPathSeg.PATHSEG_ARC_REL)t=q.pathSegType==
SVGPathSeg.PATHSEG_ARC_ABS?"A":"a",r=q.largeArcFlag?1:0,s=q.sweepFlag?1:0,m+=t+" "+q.r1+" "+q.r2+" "+q.angle+" "+r+" "+s+" "+q.x+" "+q.y+" ";else if(q.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS||q.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL)t=q.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS?"S":"s",m+=t+" "+q.x2+" "+q.y2+" "+q.x+" "+q.y+" ";l.setAttributeNS(null,"d",m);m=l.getTotalLength();g=0;0<e&&(g=parseInt(m/e,10));3>g&&(g=3);e=m/g;for(m=1;m<=g;m++)f=l.getPointAtLength(m*
e),f=c(a,h,k,b,f.x,f.y);return f}function e(a,b){var c=a.VertexCount(b);if(0!==c){var d=a.GetVertex(b,0),c=a.GetVertex(b,c-1);JSM.CoordIsEqual2DWithEps(d,c,0.1)&&a.GetContour(b).vertices.pop()}}function f(a,b){return 0<a.VertexCount(b)?(e(a,b),a.AddContour(),b+1):b}var g=new JSM.ContourPolygon2D,h=document.createElementNS("http://www.w3.org/2000/svg","svg"),l;if(a instanceof SVGPathElement){var k=new JSM.Coord2D(0,0),F=new JSM.Coord2D(0,0),C=b;a.hasAttribute("segmentlength")&&(C=parseFloat(a.getAttribute("segmentlength")));
var u,H,z=0;for(l=0;l<a.pathSegList.numberOfItems;l++)if(u=a.pathSegList.getItem(l),u.pathSegType!=SVGPathSeg.PATHSEG_CLOSEPATH)if(u.pathSegType==SVGPathSeg.PATHSEG_MOVETO_ABS)z=f(g,z),k=c(h,g,z,a,u.x,u.y),F=k.Clone();else if(u.pathSegType==SVGPathSeg.PATHSEG_MOVETO_REL)z=f(g,z),k=c(h,g,z,a,F.x+u.x,F.y+u.y),F=k.Clone();else if(u.pathSegType==SVGPathSeg.PATHSEG_LINETO_ABS)k=c(h,g,z,a,u.x,u.y);else if(u.pathSegType==SVGPathSeg.PATHSEG_LINETO_REL)k=c(h,g,z,a,k.x+u.x,k.y+u.y);else if(u.pathSegType==SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS)k=
c(h,g,z,a,u.x,k.y);else if(u.pathSegType==SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS)k=c(h,g,z,a,k.x,u.y);else if(u.pathSegType==SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL)k=c(h,g,z,a,k.x+u.x,k.y);else if(u.pathSegType==SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL)k=c(h,g,z,a,k.x,k.y+u.y);else if(u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS||u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL||u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS||u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL||
u.pathSegType==SVGPathSeg.PATHSEG_ARC_ABS||u.pathSegType==SVGPathSeg.PATHSEG_ARC_REL||u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS||u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL){H=[];if(u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS||u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL){for(;l<a.pathSegList.numberOfItems;l++){u=a.pathSegList.getItem(l);if(!(u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS||u.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL))break;
H.push(u)}l-=1}else H.push(u);k=d(h,a,C,k,H,g,z)}e(g,z)}else if(a instanceof SVGRectElement)c(h,g,0,a,a.x.baseVal.value,a.y.baseVal.value),c(h,g,0,a,a.x.baseVal.value+a.width.baseVal.value,a.y.baseVal.value),c(h,g,0,a,a.x.baseVal.value+a.width.baseVal.value,a.y.baseVal.value+a.height.baseVal.value),c(h,g,0,a,a.x.baseVal.value,a.y.baseVal.value+a.height.baseVal.value);else if(a instanceof SVGPolygonElement)for(l=0;l<a.points.numberOfItems;l++)k=a.points.getItem(l),c(h,g,0,a,k.x,k.y);g.color=function(a){for(var b=
"";null!==a&&void 0!==a&&0===b.length;)b=a.getAttribute("fill"),null===b&&(b=a.style.fill),a=a.parentElement;a=0;if(0===b.length)return a;if("#"==b[0])a=JSM.HexColorToRGBColor(b.substring(1));else{var c=b.indexOf("("),d=b.indexOf(")");if(-1==c||-1==d)return a;b=b.substring(c+1,d).split(", ");if(3!=b.length)return a;a=JSM.RGBComponentsToHexColor(b[0],b[1],b[2])}return a}(a);return g}function e(a,b){function c(a,b){var d=[],e,f;if("Clockwise"==b)for(e=0;e<a.VertexCount();e++)f=a.GetVertex(e),d.push(new JSM.Coord(f.x,
0,-f.y));else for(e=a.VertexCount()-1;0<=e;e--)f=a.GetVertex(e),d.push(new JSM.Coord(f.x,0,-f.y));return d}function d(a,b,c){a.push(null);var e;if("CounterClockwise"==c)for(c=0;c<b.VertexCount();c++)e=b.GetVertex(c),a.push(new JSM.Coord(e.x,0,-e.y));else for(c=b.VertexCount()-1;0<=c;c--)e=b.GetVertex(c),a.push(new JSM.Coord(e.x,0,-e.y))}var e=[],f=new JSM.Vector(0,-1,0),g,h;h=a.ContourCount();if(1==h)h=JSM.PolygonOrientation2D(a.GetContour(0)),g=c(a.GetContour(0),h),g=JSM.GeneratePrism(g,f,b,!0),
e.push(g);else if(1<h){h=JSM.PolygonOrientation2D(a.GetContour(0));var k=c(a.GetContour(0),h),l=!1,F;for(F=1;F<a.ContourCount();F++)g=JSM.PolygonOrientation2D(a.GetContour(F)),g==h?(g=c(a.GetContour(F),h),g=JSM.GeneratePrism(g,f,b,!0),e.push(g)):(d(k,a.GetContour(F),g),l=!0);g=l?JSM.GeneratePrismWithHole(k,f,b,!0):JSM.GeneratePrism(k,f,b,!0);e.push(g)}f=new JSM.Material({ambient:a.color,diffuse:a.color});return[e,f]}var f=new JSM.Model,g=new JSM.Materials;c=function(a,b){function c(a,b,d){a=a.getElementsByTagName(b);
for(b=0;b<a.length;b++)d.push(a[b])}var e=[],f=[];c(a,"path",f);c(a,"rect",f);c(a,"polygon",f);var g=b;a.hasAttribute("segmentlength")&&(g=parseFloat(a.getAttribute("segmentlength")));var h,k;for(h=0;h<f.length;h++)k=d(f[h],g),e.push(k);return e}(a,c);a.hasAttribute("modelheight")&&(b=parseFloat(a.getAttribute("modelheight")));var h,l,k;for(a=0;a<c.length;a++){h=e(c[a],b);l=h[0];h=h[1];g.AddMaterial(h);for(h=0;h<l.length;h++)k=l[h],k.SetPolygonsMaterialIndex(g.Count()-1),f.AddBody(k)}return[f,g]};
JSM.BSPPolygonUserData=function(){this.material=this.id=null};JSM.AddBodyToBSPTree=function(a,b,c){var d,e,f;for(d=0;d<a.PolygonCount();d++){f=new JSM.BSPPolygonUserData;f.id=c;e=a;var g=f,h=e.GetPolygon(d);g.material=h.GetMaterialIndex();for(var g=new JSM.Polygon,l=void 0,k=void 0,l=0;l<h.VertexIndexCount();l++)k=e.GetVertexPosition(h.GetVertexIndex(l)),g.AddVertex(k.x,k.y,k.z);e=g;b.AddPolygon(e,f)}};
JSM.BooleanOperation=function(a,b,c){function d(a,b,c){function d(a){b.AddVertex(new JSM.BodyVertex(a));return b.VertexCount()-1}var e=new JSM.BodyPolygon([]),f;if(c)for(c=a.VertexCount()-1;0<=c;c--)f=d(a.GetVertex(c)),e.AddVertexIndex(f);else for(c=0;c<a.VertexCount();c++)f=d(a.GetVertex(c)),e.AddVertexIndex(f);void 0!==a.userData&&e.SetMaterialIndex(a.userData.material);b.AddPolygon(e)}function e(a,b,c){var e;for(e=0;e<a.length;e++)d(a[e],b,c)}function f(a,b,c,d,e,f){function g(a,b){var c;for(c=
0;c<a.length;c++)a[c].userData=b}var h,k;for(h=0;h<a.length;h++)k=a[h],JSM.ClipPolygonWithBSPTree(k.polygon,b,c,d,e,f),g(c,k.userData),g(d,k.userData),g(e,k.userData),g(f,k.userData)}var g=new JSM.BSPTree,h=new JSM.BSPTree;JSM.AddBodyToBSPTree(b,g,"a");JSM.AddBodyToBSPTree(c,h,"b");b=new JSM.Body;c=[];var l=[],k=[],m=[];f(g.GetNodes(),h,c,l,k,m);var n=[],p=[],q=[];f(h.GetNodes(),g,n,p,q,[]);"Union"==a?(e(c,b,!1),e(k,b,!1),e(m,b,!1),e(n,b,!1),e(q,b,!1)):"Difference"==a?(e(c,b,!1),e(k,b,!1),e(p,b,!0)):
"Intersection"==a&&(e(l,b,!1),e(m,b,!1),e(p,b,!1));return b};
JSM.GenerateSurface=function(a,b,c,d,e,f,g,h){var l=new JSM.Body,k=a[0],m=b[0],n=(a[1]-a[0])/c,p=(b[1]-b[0])/d;(function(){var a,b,e,f;for(a=0;a<=d;a++)for(b=0;b<=c;b++)e=k+b*n,f=m+a*p,e=g(a,b,e,f,h),l.AddVertex(new JSM.BodyVertex(e))})();(function(){var a,b,g,h,k,m;for(b=0;b<d;b++)for(a=0;a<c;a++)g=b*(c+1)+a,h=g+1,k=g+c+1,m=k+1,e?(h=new JSM.BodyPolygon([g,h,m]),f&&h.SetCurveGroup(0),l.AddPolygon(h),h=new JSM.BodyPolygon([g,m,k])):h=new JSM.BodyPolygon([g,h,m,k]),f&&h.SetCurveGroup(0),l.AddPolygon(h)})();
return l};JSM.SurfaceControlPoints=function(a,b){this.n=a;this.m=b;this.points=[];var c,d;for(c=0;c<=this.n;c++){this.points.push([]);for(d=0;d<=this.m;d++)this.points[c].push(new JSM.Coord(0,0,0))}};JSM.SurfaceControlPoints.prototype.GetNValue=function(){return this.n};JSM.SurfaceControlPoints.prototype.GetMValue=function(){return this.m};JSM.SurfaceControlPoints.prototype.GetControlPoint=function(a,b){return this.points[a][b]};
JSM.SurfaceControlPoints.prototype.InitPlanar=function(a,b){var c=a/this.n,d=b/this.m,e,f,g;for(e=0;e<=this.n;e++)for(f=0;f<=this.m;f++)g=this.points[e][f],g.x=e*c,g.y=f*d};
JSM.GenerateBezierSurface=function(a,b,c,d){return JSM.GenerateSurface([0,1],[0,1],b,c,!1,d,function(a,b,c,d,l){function k(a,b,c){var d=1,e=JSM.Minimum(a,b-a),f;for(f=0;f<e;f++)d*=b-f,d/=f+1;return d*Math.pow(c,a)*Math.pow(1-c,b-a)}var m,n,p,q=l.GetNValue(),r=l.GetMValue();m=new JSM.Coord(0,0,0);for(a=0;a<=q;a++){n=new JSM.Coord(0,0,0);for(b=0;b<=r;b++)p=k(a,q,c)*k(b,r,d),p=JSM.VectorMultiply(l.GetControlPoint(a,b),p),n=JSM.CoordAdd(n,p);m=JSM.CoordAdd(m,n)}return m},a)};
JSM.RenderMaterial=function(a,b,c,d,e,f,g){this.ambient=a;this.diffuse=b;this.specular=c;this.shininess=d;this.texture=e;this.textureWidth=f;this.textureHeight=g;this.textureImage=this.textureBuffer=null;this.textureLoaded=!1};JSM.RenderMaterial.prototype.HasTexture=function(){return null!==this.texture&&this.textureLoaded};
JSM.RenderMaterial.prototype.Compile=function(a,b){if(null!==this.texture){var c=this;this.textureBuffer=a.createTexture();this.textureImage=new Image;this.textureImage.src=this.texture;this.textureImage.onload=function(){a.bindTexture(a.TEXTURE_2D,c.textureBuffer);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,c.textureImage);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR);a.generateMipmap(a.TEXTURE_2D);
a.bindTexture(a.TEXTURE_2D,null);c.textureLoaded=!0;void 0!==b&&null!==b&&b()}}};JSM.RenderGeometry=function(){this.transformation=new JSM.Transformation;this.uvBuffer=this.normalBuffer=this.vertexBuffer=this.uvArray=this.normalArray=this.vertexArray=this.material=null};JSM.RenderGeometry.prototype.SetMaterial=function(a){this.material=a};JSM.RenderGeometry.prototype.GetMaterial=function(){return this.material};JSM.RenderGeometry.prototype.SetVertexArray=function(a){this.vertexArray=new Float32Array(a)};
JSM.RenderGeometry.prototype.SetNormalArray=function(a){this.normalArray=new Float32Array(a)};JSM.RenderGeometry.prototype.SetUVArray=function(a){this.uvArray=new Float32Array(a)};JSM.RenderGeometry.prototype.GetTransformation=function(){return this.transformation};JSM.RenderGeometry.prototype.GetTransformationMatrix=function(){return this.transformation.matrix};JSM.RenderGeometry.prototype.SetTransformation=function(a){this.transformation=a};JSM.RenderGeometry.prototype.GetVertexBuffer=function(){return this.vertexBuffer};
JSM.RenderGeometry.prototype.GetNormalBuffer=function(){return this.normalBuffer};JSM.RenderGeometry.prototype.GetUVBuffer=function(){return this.uvBuffer};JSM.RenderGeometry.prototype.VertexCount=function(){return parseInt(this.vertexArray.length/3,10)};JSM.RenderGeometry.prototype.GetVertex=function(a){return new JSM.Coord(this.vertexArray[3*a],this.vertexArray[3*a+1],this.vertexArray[3*a+2])};JSM.RenderGeometry.prototype.GetTransformedVertex=function(a){a=this.GetVertex(a);return this.transformation.Apply(a)};
JSM.RenderGeometry.prototype.Compile=function(a,b){this.material.Compile(a,b);this.vertexBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertexArray,a.STATIC_DRAW);this.vertexBuffer.itemSize=3;this.vertexBuffer.numItems=parseInt(this.vertexArray.length/3,10);this.normalBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.normalBuffer);a.bufferData(a.ARRAY_BUFFER,this.normalArray,a.STATIC_DRAW);this.normalBuffer.itemSize=3;this.normalBuffer.numItems=
parseInt(this.normalArray.length/3,10);null!==this.uvArray&&(this.uvBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),a.bufferData(a.ARRAY_BUFFER,this.uvArray,a.STATIC_DRAW),this.uvBuffer.itemSize=2,this.uvBuffer.numItems=parseInt(this.uvArray.length/2,10))};JSM.Renderer=function(){this.geometries=this.light=this.camera=this.texShader=this.shader=this.context=this.canvas=null};
JSM.Renderer.prototype.Init=function(a,b,c){return!this.InitContext(a)||!this.InitView(b,c)||!this.InitShaders()||!this.InitBuffers()?!1:!0};
JSM.Renderer.prototype.InitContext=function(a){if(!window.WebGLRenderingContext)return!1;this.canvas=document.getElementById(a);if(null===this.canvas||void 0===this.canvas.getContext)return!1;this.context=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl");if(null===this.context)return!1;this.context.viewportWidth=this.canvas.width;this.context.viewportHeight=this.canvas.height;this.context.viewport(0,0,this.context.viewportWidth,this.context.viewportHeight);this.context.clearColor(1,
1,1,1);this.context.enable(this.context.DEPTH_TEST);this.context.depthFunc(this.context.LEQUAL);this.context.enable(this.context.BLEND);this.context.blendEquation(this.context.FUNC_ADD);this.context.blendFunc(this.context.SRC_ALPHA,this.context.ONE_MINUS_SRC_ALPHA);return!0};
JSM.Renderer.prototype.InitShaders=function(){function a(a,b,c){c=a.createShader(c);a.shaderSource(c,b);a.compileShader(c);return!a.getShaderParameter(c,a.COMPILE_STATUS)?null:c}function b(b,c,d){c=a(b,c,b.FRAGMENT_SHADER);d=a(b,d,b.VERTEX_SHADER);if(null===c||null===d)return null;var e=b.createProgram();b.attachShader(e,d);b.attachShader(e,c);b.linkProgram(e);return!b.getProgramParameter(e,b.LINK_STATUS)?null:e}function c(a){var b="";a&&(b="#define USETEXTURE");return[b,"uniform highp vec3 uPolygonAmbientColor;\nuniform highp vec3 uPolygonDiffuseColor;\nuniform highp vec3 uPolygonSpecularColor;\nuniform highp float uPolygonShininess;\nuniform highp vec3 uLightAmbientColor;\nuniform highp vec3 uLightDiffuseColor;\nuniform highp vec3 uLightSpecularColor;\nvarying highp vec3 vVertex;\nvarying highp vec3 vNormal;\nvarying highp vec3 vLight;\n#ifdef USETEXTURE\nvarying highp vec2 vUV;\nuniform sampler2D uSampler;\n#endif\nvoid main (void) {\n\thighp vec3 N = normalize (vNormal);\n\tif (!gl_FrontFacing) {\n\t\tN = -N;\n\t}\n\thighp vec3 L = normalize (-vLight);\n\thighp vec3 E = normalize (-vVertex);\n\thighp vec3 R = normalize (-reflect (L, N));\n\thighp vec3 ambientComponent = uPolygonAmbientColor * uLightAmbientColor;\n\thighp vec3 diffuseComponent = uPolygonDiffuseColor * uLightDiffuseColor * max (dot (N, L), 0.0);\n\thighp vec3 specularComponent = uPolygonSpecularColor * uLightSpecularColor * pow (max (dot (R, E), 0.0), uPolygonShininess);\n#ifdef USETEXTURE\n\thighp vec3 textureColor = texture2D (uSampler, vec2 (vUV.s, vUV.t)).xyz;\n\tambientComponent = textureColor * ambientComponent;\n\tdiffuseComponent = textureColor * diffuseComponent;\n\tspecularComponent = textureColor * specularComponent;\n#endif\n\tambientComponent = clamp (ambientComponent, 0.0, 1.0);\n\tdiffuseComponent = clamp (diffuseComponent, 0.0, 1.0);\n\tspecularComponent = clamp (specularComponent, 0.0, 1.0);\n\tgl_FragColor = vec4 (ambientComponent + diffuseComponent + specularComponent, 1.0);\n}"].join("\n")}
function d(a){var b="";a&&(b="#define USETEXTURE");return[b,"attribute highp vec3 aVertexPosition;\nattribute highp vec3 aVertexNormal;\nuniform highp mat4 uViewMatrix;\nuniform highp mat4 uModelViewMatrix;\nuniform highp mat4 uProjectionMatrix;\nuniform highp vec3 uLightDirection;\nvarying highp vec3 vVertex;\nvarying highp vec3 vNormal;\nvarying highp vec3 vLight;\n#ifdef USETEXTURE\nattribute highp vec2 aVertexUV;\nvarying highp vec2 vUV;\n#endif\nvoid main (void) {\n\tvVertex = vec3 (uModelViewMatrix * vec4 (aVertexPosition, 1.0));\n\tvNormal = normalize (vec3 (uModelViewMatrix * vec4 (aVertexNormal, 0.0)));\n\tvLight = normalize (vec3 (uViewMatrix * vec4 (uLightDirection, 0.0)));\n#ifdef USETEXTURE\n\tvUV = aVertexUV;\n#endif\n\tgl_Position = uProjectionMatrix * vec4 (vVertex, 1.0);\n}"].join("\n")}
function e(a,b){b.vertexPositionAttribute=a.getAttribLocation(b,"aVertexPosition");b.vertexNormalAttribute=a.getAttribLocation(b,"aVertexNormal");b.lightAmbientColorUniform=a.getUniformLocation(b,"uLightAmbientColor");b.lightDiffuseColorUniform=a.getUniformLocation(b,"uLightDiffuseColor");b.lightSpecularColorUniform=a.getUniformLocation(b,"uLightSpecularColor");b.lightDirectionUniform=a.getUniformLocation(b,"uLightDirection");b.vMatrixUniform=a.getUniformLocation(b,"uViewMatrix");b.mvMatrixUniform=
a.getUniformLocation(b,"uModelViewMatrix");b.pMatrixUniform=a.getUniformLocation(b,"uProjectionMatrix");b.polygonAmbientColorUniform=a.getUniformLocation(b,"uPolygonAmbientColor");b.polygonDiffuseColorUniform=a.getUniformLocation(b,"uPolygonDiffuseColor");b.polygonSpecularColorUniform=a.getUniformLocation(b,"uPolygonSpecularColor");b.polygonShininessUniform=a.getUniformLocation(b,"uPolygonShininess")}this.shader=function(a){var g=c(!1),h=d(!1),g=b(a,g,h);if(null===g)return null;a.useProgram(g);e(a,
g);return g}(this.context);if(null===this.shader)return!1;this.texShader=function(a){var g=c(!0),h=d(!0),g=b(a,g,h);if(null===g)return null;a.useProgram(g);e(a,g);g.vertexUVAttribute=a.getAttribLocation(g,"aVertexUV");g.samplerUniform=a.getUniformLocation(g,"uSampler");return g}(this.context);return null===this.texShader?!1:!0};JSM.Renderer.prototype.InitBuffers=function(){this.geometries=[];return!0};
JSM.Renderer.prototype.InitView=function(a,b){this.camera=JSM.ValueOrDefault(a,new JSM.Camera);if(!this.camera)return!1;this.light=JSM.ValueOrDefault(b,new JSM.Light);return!this.light?!1:!0};JSM.Renderer.prototype.SetClearColor=function(a,b,c){this.context.clearColor(a,b,c,1)};JSM.Renderer.prototype.AddGeometries=function(a){var b,c;for(b=0;b<a.length;b++)c=a[b],c.Compile(this.context,this.Render.bind(this)),this.geometries.push(c)};
JSM.Renderer.prototype.RemoveGeometries=function(){this.geometries=[]};JSM.Renderer.prototype.Resize=function(){this.context.viewportWidth=this.canvas.width;this.context.viewportHeight=this.canvas.height;this.context.viewport(0,0,this.context.viewportWidth,this.context.viewportHeight)};
JSM.Renderer.prototype.Render=function(){this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT);var a=JSM.MatrixPerspective(this.camera.fieldOfView*JSM.DegRad,this.context.viewportWidth/this.context.viewportHeight,this.camera.nearClippingPlane,this.camera.farClippingPlane),b=JSM.MatrixView(this.camera.eye,this.camera.center,this.camera.up),c=JSM.MatrixIdentity(),d=JSM.HexColorToNormalizedRGBComponents(this.light.ambient),e=JSM.HexColorToNormalizedRGBComponents(this.light.diffuse),
f=JSM.HexColorToNormalizedRGBComponents(this.light.specular);this.light.direction=JSM.VectorNormalize(JSM.CoordSub(this.camera.center,this.camera.eye));var g,h,l,k,m,n;for(g=0;g<this.geometries.length;g++)m=this.geometries[g],c=m.GetMaterial().HasTexture()?this.texShader:this.shader,n!=c&&(n=c,this.context.useProgram(n),this.context.uniformMatrix4fv(n.pMatrixUniform,!1,a),this.context.uniformMatrix4fv(n.vMatrixUniform,!1,b),this.context.uniform3f(n.lightDirectionUniform,this.light.direction.x,this.light.direction.y,
this.light.direction.z),this.context.uniform3f(n.lightAmbientColorUniform,d[0],d[1],d[2]),this.context.uniform3f(n.lightDiffuseColorUniform,e[0],e[1],e[2]),this.context.uniform3f(n.lightSpecularColorUniform,f[0],f[1],f[2])),c=m.material.ambient,h=m.material.diffuse,l=m.material.specular,k=m.material.shininess,this.context.uniform3f(n.polygonAmbientColorUniform,c[0],c[1],c[2]),this.context.uniform3f(n.polygonDiffuseColorUniform,h[0],h[1],h[2]),this.context.uniform3f(n.polygonSpecularColorUniform,l[0],
l[1],l[2]),this.context.uniform1f(n.polygonShininessUniform,k),n==this.texShader&&(c=m.GetUVBuffer(),this.context.activeTexture(this.context.TEXTURE0),this.context.bindTexture(this.context.TEXTURE_2D,m.material.textureBuffer),this.context.bindBuffer(this.context.ARRAY_BUFFER,c),this.context.vertexAttribPointer(n.vertexUVAttribute,c.itemSize,this.context.FLOAT,!1,0,0),this.context.enableVertexAttribArray(n.vertexUVAttribute),this.context.uniform1i(n.samplerUniform,0)),c=JSM.MatrixMultiply(m.GetTransformationMatrix(),
b),this.context.uniformMatrix4fv(n.mvMatrixUniform,!1,c),c=m.GetVertexBuffer(),this.context.bindBuffer(this.context.ARRAY_BUFFER,c),this.context.enableVertexAttribArray(n.vertexPositionAttribute),this.context.vertexAttribPointer(n.vertexPositionAttribute,c.itemSize,this.context.FLOAT,!1,0,0),m=m.GetNormalBuffer(),this.context.bindBuffer(this.context.ARRAY_BUFFER,m),this.context.enableVertexAttribArray(n.vertexNormalAttribute),this.context.vertexAttribPointer(n.vertexNormalAttribute,m.itemSize,this.context.FLOAT,
!1,0,0),this.context.drawArrays(this.context.TRIANGLES,0,c.numItems)};JSM.PointCloudRenderer=function(){this.pointSize=this.points=this.camera=this.shader=this.context=this.canvas=null};JSM.PointCloudRenderer.prototype.Init=function(a,b){return!this.InitContext(a)||!this.InitShaders()||!this.InitBuffers()||!this.InitView(b)?!1:!0};
JSM.PointCloudRenderer.prototype.InitContext=function(a){if(!window.WebGLRenderingContext)return!1;this.canvas=document.getElementById(a);if(null===this.canvas||void 0===this.canvas.getContext)return!1;this.context=this.canvas.getContext("experimental-webgl");if(null===this.context)return!1;this.context.viewportWidth=this.canvas.width;this.context.viewportHeight=this.canvas.height;this.context.clearColor(1,1,1,1);this.context.enable(this.context.DEPTH_TEST);return!0};
JSM.PointCloudRenderer.prototype.InitShaders=function(){function a(a,b,c){c=a.createShader(c);a.shaderSource(c,b);a.compileShader(c);return!a.getShaderParameter(c,a.COMPILE_STATUS)?null:c}var b=a(this.context,"varying highp vec3 vColor;\nvoid main (void) {\n\tgl_FragColor = vec4 (vColor, 1.0);\n}",this.context.FRAGMENT_SHADER),c=a(this.context,"attribute highp vec3 aVertexPosition;\nattribute highp vec3 aVertexColor;\nuniform highp mat4 uViewMatrix;\nuniform highp mat4 uProjectionMatrix;\nuniform highp float uPointSize;\nvarying highp vec3 vColor;\nvoid main (void) {\n\tvColor = aVertexColor;\n\tgl_PointSize = uPointSize;\n\tgl_Position = uProjectionMatrix * uViewMatrix * vec4 (aVertexPosition, 1.0);\n}",
this.context.VERTEX_SHADER);if(null===b||null===c)return!1;this.shader=this.context.createProgram();this.context.attachShader(this.shader,c);this.context.attachShader(this.shader,b);this.context.linkProgram(this.shader);if(!this.context.getProgramParameter(this.shader,this.context.LINK_STATUS))return!1;this.context.useProgram(this.shader);this.shader.vertexPositionAttribute=this.context.getAttribLocation(this.shader,"aVertexPosition");this.context.enableVertexAttribArray(this.shader.vertexPositionAttribute);
this.shader.vertexColorAttribute=this.context.getAttribLocation(this.shader,"aVertexColor");this.context.enableVertexAttribArray(this.shader.vertexColorAttribute);this.shader.pMatrixUniform=this.context.getUniformLocation(this.shader,"uProjectionMatrix");this.shader.vMatrixUniform=this.context.getUniformLocation(this.shader,"uViewMatrix");this.shader.pointSizeUniform=this.context.getUniformLocation(this.shader,"uPointSize");return!0};
JSM.PointCloudRenderer.prototype.InitBuffers=function(){this.points=[];this.pointSize=1;return!0};JSM.PointCloudRenderer.prototype.InitView=function(a){this.camera=JSM.ValueOrDefault(a,new JSM.Camera);return!this.camera?!1:!0};JSM.PointCloudRenderer.prototype.SetClearColor=function(a,b,c){this.context.clearColor(a,b,c,1)};JSM.PointCloudRenderer.prototype.SetPointSize=function(a){this.pointSize=a};
JSM.PointCloudRenderer.prototype.AddPoints=function(a,b){var c=this.context.createBuffer(),d=new Float32Array(a);this.context.bindBuffer(this.context.ARRAY_BUFFER,c);this.context.bufferData(this.context.ARRAY_BUFFER,d,this.context.STATIC_DRAW);c.itemSize=3;c.numItems=parseInt(d.length/3,10);var e=this.context.createBuffer(),f=new Float32Array(b);this.context.bindBuffer(this.context.ARRAY_BUFFER,e);this.context.bufferData(this.context.ARRAY_BUFFER,f,this.context.STATIC_DRAW);e.itemSize=3;e.numItems=
parseInt(f.length/3,10);this.points.push({pointArray:d,pointBuffer:c,colorBuffer:e})};JSM.PointCloudRenderer.prototype.RemovePoints=function(){this.points=[]};JSM.PointCloudRenderer.prototype.Resize=function(){this.context.viewportWidth=this.canvas.width;this.context.viewportHeight=this.canvas.height};
JSM.PointCloudRenderer.prototype.Render=function(){this.context.viewport(0,0,this.context.viewportWidth,this.context.viewportHeight);this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT);var a=JSM.MatrixPerspective(this.camera.fieldOfView*JSM.DegRad,this.context.viewportWidth/this.context.viewportHeight,this.camera.nearClippingPlane,this.camera.farClippingPlane);this.context.uniformMatrix4fv(this.shader.pMatrixUniform,!1,a);a=JSM.MatrixView(this.camera.eye,this.camera.center,
this.camera.up);this.context.uniformMatrix4fv(this.shader.vMatrixUniform,!1,a);this.context.uniform1f(this.shader.pointSizeUniform,this.pointSize);for(var b,c,a=0;a<this.points.length;a++)b=this.points[a].pointBuffer,c=this.points[a].colorBuffer,this.context.bindBuffer(this.context.ARRAY_BUFFER,b),this.context.vertexAttribPointer(this.shader.vertexPositionAttribute,b.itemSize,this.context.FLOAT,!1,0,0),this.context.bindBuffer(this.context.ARRAY_BUFFER,c),this.context.vertexAttribPointer(this.shader.vertexColorAttribute,
c.itemSize,this.context.FLOAT,!1,0,0),this.context.drawArrays(this.context.POINTS,0,b.numItems)};
JSM.ConvertBodyToRenderGeometries=function(a,b){var c=[],d=null,e=null,f=null,g=null;JSM.ExplodeBodyToTriangles(a,b,{hasConvexPolygons:!1,onGeometryStart:function(a){e=[];f=[];g=[];var b=JSM.HexColorToNormalizedRGBComponents(a.ambient),k=JSM.HexColorToNormalizedRGBComponents(a.diffuse),m=JSM.HexColorToNormalizedRGBComponents(a.specular);a=new JSM.RenderMaterial(b,k,m,a.shininess,a.texture,a.textureWidth,a.textureHeight);d=new JSM.RenderGeometry;d.SetMaterial(a);c.push(d)},onGeometryEnd:function(a){d.SetVertexArray(e);
d.SetNormalArray(f);null!==a.texture&&d.SetUVArray(g)},onTriangle:function(a,b,c,d,n,p,q,r,s){e.push(a.x,a.y,a.z);e.push(b.x,b.y,b.z);e.push(c.x,c.y,c.z);f.push(d.x,d.y,d.z);f.push(n.x,n.y,n.z);f.push(p.x,p.y,p.z);null!==q&&(null!==r&&null!==s)&&(g.push(q.x,q.y),g.push(r.x,r.y),g.push(s.x,s.y))}});return c};JSM.ConvertModelToRenderGeometries=function(a,b){var c=[],d,e;for(d=0;d<a.BodyCount();d++){e=a.GetBody(d);var f=JSM.ConvertBodyToRenderGeometries(e,b,c);for(e=0;e<f.length;e++)c.push(f[e])}return c};
JSM.JSONFileLoader=function(a){this.onReady=a};JSM.JSONFileLoader.prototype.Load=function(a){var b=this,c=new XMLHttpRequest;c.overrideMimeType("application/json");c.open("GET",a,!0);c.onreadystatechange=function(){4==c.readyState&&b.OnReady(c.responseText)};c.send(null)};JSM.JSONFileLoader.prototype.OnReady=function(a){null!==this.onReady&&(a=JSON.parse(a),this.onReady(a))};
JSM.Mouse=function(){this.down=!1;this.button=0;this.alt=this.ctrl=this.shift=!1;this.diffY=this.diffX=this.currY=this.currX=this.prevY=this.prevX=0};JSM.Mouse.prototype.Down=function(a,b){var c=a;void 0===c&&(c=window.event);this.down=!0;this.button=a.which;this.shift=a.shiftKey;this.ctrl=a.ctrlKey;this.alt=a.altKey;this.SetCurrent(c,b);this.prevX=this.currX;this.prevY=this.currY};
JSM.Mouse.prototype.Move=function(a,b){var c=a;void 0===c&&(c=window.event);this.shift=a.shiftKey;this.ctrl=a.ctrlKey;this.alt=a.altKey;this.SetCurrent(c,b);this.diffX=this.currX-this.prevX;this.diffY=this.currY-this.prevY;this.prevX=this.currX;this.prevY=this.currY};JSM.Mouse.prototype.Up=function(a,b){var c=a;void 0===c&&(c=window.event);this.down=!1;this.SetCurrent(c,b)};JSM.Mouse.prototype.Out=function(a,b){var c=a;void 0===c&&(c=window.event);this.down=!1;this.SetCurrent(c,b)};
JSM.Mouse.prototype.SetCurrent=function(a,b){this.currX=a.clientX;this.currY=a.clientY;void 0!==b&&(void 0!==b.offsetLeft&&void 0!==b.offsetTop)&&(this.currX-=b.offsetLeft,this.currY-=b.offsetTop)};JSM.Touch=function(){this.down=!1;this.diffY=this.diffX=this.currY=this.currX=this.prevY=this.prevX=0};JSM.Touch.prototype.Start=function(a,b){if(0!==a.touches.length){var c=a.touches[0];this.down=!0;this.SetCurrent(c,b);this.prevX=this.currX;this.prevY=this.currY}};
JSM.Touch.prototype.Move=function(a,b){0!==a.touches.length&&(this.SetCurrent(a.touches[0],b),this.diffX=this.currX-this.prevX,this.diffY=this.currY-this.prevY,this.prevX=this.currX,this.prevY=this.currY)};JSM.Touch.prototype.End=function(a,b){if(0!==a.touches.length){var c=a.touches[0];this.down=!1;this.SetCurrent(c,b)}};
JSM.Touch.prototype.SetCurrent=function(a,b){this.currX=a.pageX;this.currY=a.pageY;void 0!==b&&(void 0!==b.offsetLeft&&void 0!==b.offsetTop)&&(this.currX=a.pageX-b.offsetLeft,this.currY=a.pageY-b.offsetTop)};JSM.Navigation=function(){this.orbitCenter=this.cameraEnableZoom=this.cameraEnablePan=this.cameraEnableOrbit=this.cameraFixUp=this.touch=this.mouse=this.resizeCallback=this.drawCallback=this.camera=this.canvas=null};
JSM.Navigation.prototype.Init=function(a,b,c,d){this.canvas=a;this.camera=b;this.drawCallback=c;this.resizeCallback=d;this.mouse=new JSM.Mouse;this.touch=new JSM.Touch;this.cameraEnableZoom=this.cameraEnablePan=this.cameraEnableOrbit=this.cameraFixUp=!0;this.orbitCenter=this.camera.center.Clone();var e=this;document.addEventListener&&(document.addEventListener("mousemove",function(a){e.OnMouseMove(a)}),document.addEventListener("mouseup",function(a){e.OnMouseUp(a)}));this.canvas.addEventListener&&
(this.canvas.addEventListener("mousedown",function(a){e.OnMouseDown(a)},!1),this.canvas.addEventListener("DOMMouseScroll",function(a){e.OnMouseWheel(a)},!1),this.canvas.addEventListener("mousewheel",function(a){e.OnMouseWheel(a)},!1),this.canvas.addEventListener("touchstart",function(a){e.OnTouchStart(a)},!1),this.canvas.addEventListener("touchmove",function(a){e.OnTouchMove(a)},!1),this.canvas.addEventListener("touchend",function(a){e.OnTouchEnd(a)},!1),this.canvas.addEventListener("contextmenu",
function(a){e.OnContextMenu(a)},!1));window.addEventListener&&window.addEventListener("resize",function(a){e.OnResize(a)},!1);return!0};JSM.Navigation.prototype.SetCamera=function(a,b,c){this.camera.Set(a,b,c);this.orbitCenter=this.camera.center.Clone()};JSM.Navigation.prototype.EnableFixUp=function(a){this.cameraFixUp=a};JSM.Navigation.prototype.EnableOrbit=function(a){this.cameraEnableOrbit=a};JSM.Navigation.prototype.EnablePan=function(a){this.cameraEnablePan=a};
JSM.Navigation.prototype.EnableZoom=function(a){this.cameraEnableZoom=a};JSM.Navigation.prototype.SetOrbitCenter=function(a){this.orbitCenter=a};
JSM.Navigation.prototype.FitInWindow=function(a,b){var c=JSM.CoordSub(this.camera.center,a);this.camera.center=a;this.camera.eye=JSM.CoordSub(this.camera.eye,c);var c=JSM.VectorNormalize(JSM.CoordSub(this.camera.eye,this.camera.center)),d=this.camera.fieldOfView/2;this.canvas.width<this.canvas.height&&(d=d*this.canvas.width/this.canvas.height);d=b/Math.sin(d*JSM.DegRad);this.camera.eye=JSM.CoordOffset(this.camera.center,c,d);this.orbitCenter=this.camera.center.Clone()};
JSM.Navigation.prototype.Orbit=function(a,b){var c=a*JSM.DegRad,d=b*JSM.DegRad,e=JSM.VectorNormalize(JSM.CoordSub(this.camera.center,this.camera.eye)),f=JSM.VectorNormalize(JSM.VectorCross(e,this.camera.up)),g=!JSM.CoordIsEqual(this.orbitCenter,this.camera.center);this.cameraFixUp?(e=JSM.GetVectorsAngle(e,this.camera.up)+d,JSM.IsGreater(e,0)&&JSM.IsLower(e,Math.PI)&&(this.camera.eye=JSM.CoordRotate(this.camera.eye,f,-d,this.orbitCenter),g&&(this.camera.center=JSM.CoordRotate(this.camera.center,f,
-d,this.orbitCenter))),this.camera.eye=JSM.CoordRotate(this.camera.eye,this.camera.up,-c,this.orbitCenter),g&&(this.camera.center=JSM.CoordRotate(this.camera.center,this.camera.up,-c,this.orbitCenter))):(e=JSM.VectorNormalize(JSM.VectorCross(f,e)),this.camera.eye=JSM.CoordRotate(this.camera.eye,f,-d,this.orbitCenter),this.camera.eye=JSM.CoordRotate(this.camera.eye,e,-c,this.orbitCenter),g&&(this.camera.center=JSM.CoordRotate(this.camera.center,f,-d,this.orbitCenter),this.camera.center=JSM.CoordRotate(this.camera.center,
e,-c,this.orbitCenter)),this.camera.up=e)};JSM.Navigation.prototype.Pan=function(a,b){var c=JSM.VectorNormalize(JSM.CoordSub(this.camera.center,this.camera.eye)),d=JSM.VectorNormalize(JSM.VectorCross(c,this.camera.up)),c=JSM.VectorNormalize(JSM.VectorCross(d,c));this.camera.eye=JSM.CoordOffset(this.camera.eye,d,-a);this.camera.center=JSM.CoordOffset(this.camera.center,d,-a);this.camera.eye=JSM.CoordOffset(this.camera.eye,c,b);this.camera.center=JSM.CoordOffset(this.camera.center,c,b)};
JSM.Navigation.prototype.Zoom=function(a){var b=JSM.CoordSub(this.camera.center,this.camera.eye),c=JSM.VectorLength(b);if(a&&0.1>c)return 0;c*=0.1;a||(c*=-1);this.camera.eye=JSM.CoordOffset(this.camera.eye,b,c)};JSM.Navigation.prototype.DrawCallback=function(){void 0!==this.drawCallback&&null!==this.drawCallback&&this.drawCallback()};JSM.Navigation.prototype.ResizeCallback=function(){void 0!==this.resizeCallback&&null!==this.resizeCallback&&this.resizeCallback()};
JSM.Navigation.prototype.OnMouseDown=function(a){a.preventDefault();this.mouse.Down(a,this.canvas)};JSM.Navigation.prototype.OnMouseMove=function(a){a.preventDefault();this.mouse.Move(a,this.canvas);this.mouse.down&&(a=0,1==this.mouse.button?this.cameraEnableOrbit&&(a=0.5,this.Orbit(this.mouse.diffX*a,this.mouse.diffY*a),this.DrawCallback()):3==this.mouse.button&&this.cameraEnablePan&&(a=0.001*JSM.CoordDistance(this.camera.eye,this.camera.center),this.Pan(this.mouse.diffX*a,this.mouse.diffY*a),this.DrawCallback()))};
JSM.Navigation.prototype.OnMouseUp=function(a){a.preventDefault();this.mouse.Up(a,this.canvas)};JSM.Navigation.prototype.OnMouseOut=function(a){a.preventDefault();this.mouse.Out(a,this.canvas)};JSM.Navigation.prototype.OnMouseWheel=function(a){a.preventDefault();if(this.cameraEnableZoom){null===a&&(a=window.event);var b=0;a.detail?b=-a.detail:a.wheelDelta&&(b=a.wheelDelta/40);this.Zoom(0<b);this.DrawCallback()}};
JSM.Navigation.prototype.OnTouchStart=function(a){a.preventDefault();this.touch.Start(a,this.canvas)};JSM.Navigation.prototype.OnTouchMove=function(a){a.preventDefault();this.touch.Move(a,this.canvas);this.touch.down&&this.cameraEnableOrbit&&(this.Orbit(0.5*this.touch.diffX,0.5*this.touch.diffY),this.DrawCallback())};JSM.Navigation.prototype.OnTouchEnd=function(a){a.preventDefault();this.touch.End(a,this.canvas)};JSM.Navigation.prototype.OnContextMenu=function(a){a.preventDefault()};
JSM.Navigation.prototype.OnResize=function(a){a.preventDefault();this.ResizeCallback()};JSM.SoftwareViewer=function(){this.navigation=this.drawMode=this.drawer=this.bodies=this.camera=this.canvas=null};JSM.SoftwareViewer.prototype.Start=function(a,b){return!this.InitCanvas(a)||!this.InitCamera(b)?!1:!0};
JSM.SoftwareViewer.prototype.InitCanvas=function(a){this.bodies=[];this.canvas=document.getElementById(a);if(!this.canvas)return!1;this.canvas instanceof HTMLCanvasElement?this.drawer=new JSM.CanvasDrawer(this.canvas):this.canvas instanceof SVGSVGElement&&(this.drawer=new JSM.SVGDrawer(this.canvas));if(!this.drawer)return!1;this.drawMode="Wireframe";return!0};
JSM.SoftwareViewer.prototype.InitCamera=function(a){this.camera=JSM.ValueOrDefault(a,new JSM.Camera);if(!this.camera)return!1;this.navigation=new JSM.Navigation;return!this.navigation.Init(this.canvas,this.camera,this.Draw.bind(this),this.Resize.bind(this))?!1:!0};JSM.SoftwareViewer.prototype.AddBody=function(a,b){this.bodies.push([a,b])};JSM.SoftwareViewer.prototype.RemoveBodies=function(){this.bodies=[]};
JSM.SoftwareViewer.prototype.FitInWindow=function(){var a=this.GetCenter(),b=this.GetBoundingSphereRadius(a);this.navigation.FitInWindow(a,b);this.Draw()};JSM.SoftwareViewer.prototype.GetCenter=function(){var a=this.GetBoundingBox();return JSM.MidCoord(a[0],a[1])};
JSM.SoftwareViewer.prototype.GetBoundingBox=function(){var a=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf),b=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf),c,d,e,f;for(c=0;c<this.bodies.length;c++){e=this.bodies[c][0];for(d=0;d<e.VertexCount();d++)f=e.GetVertex(d),a.x=JSM.Minimum(a.x,f.position.x),a.y=JSM.Minimum(a.y,f.position.y),a.z=JSM.Minimum(a.z,f.position.z),b.x=JSM.Maximum(b.x,f.position.x),b.y=JSM.Maximum(b.y,f.position.y),b.z=JSM.Maximum(b.z,f.position.z)}return[a,b]};
JSM.SoftwareViewer.prototype.GetBoundingSphereRadius=function(a){if(void 0===a||null===a)a=this.GetCenter();var b=0,c,d,e,f;for(c=0;c<this.bodies.length;c++){e=this.bodies[c][0];for(d=0;d<e.VertexCount();d++)f=e.GetVertex(d),f=JSM.CoordDistance(a,f.position),JSM.IsGreater(f,b)&&(b=f)}return b};JSM.SoftwareViewer.prototype.Resize=function(){this.Draw()};
JSM.SoftwareViewer.prototype.Draw=function(){var a,b;this.drawer.Clear();for(a=0;a<this.bodies.length;a++)b=this.bodies[a],JSM.DrawProjectedBody(b[0],b[1],this.camera,this.drawMode,!1,this.drawer);return!0};JSM.SpriteViewer=function(){this.navigation=this.projected=this.points=this.callbacks=this.camera=this.canvas=null};JSM.SpriteViewer.prototype.Start=function(a,b,c){return!this.InitCanvas(a)||!this.InitCamera(b)||!this.InitCallbacks(c)?!1:!0};
JSM.SpriteViewer.prototype.InitCanvas=function(a){this.points=[];this.canvas=document.getElementById(a);return!this.canvas?!1:!0};JSM.SpriteViewer.prototype.InitCamera=function(a){this.camera=JSM.ValueOrDefault(a,new JSM.Camera);if(!this.camera)return!1;this.navigation=new JSM.Navigation;return!this.navigation.Init(this.canvas,this.camera,this.Draw.bind(this))?!1:!0};
JSM.SpriteViewer.prototype.InitCallbacks=function(a){this.callbacks={onPointDraw:null};void 0!==a&&(void 0!==a.onDrawStart&&(this.callbacks.onDrawStart=a.onDrawStart),void 0!==a.onPointDraw&&(this.callbacks.onPointDraw=a.onPointDraw),void 0!==a.onDrawEnd&&(this.callbacks.onDrawEnd=a.onDrawEnd));return!0};JSM.SpriteViewer.prototype.AddPoint=function(a){this.points.push(a)};JSM.SpriteViewer.prototype.RemovePoints=function(){this.points=[]};JSM.SpriteViewer.prototype.Resize=function(){this.Draw()};
JSM.SpriteViewer.prototype.NearestPointUnderPosition=function(a,b,c){b=new JSM.Coord2D(b,c);c=-1;var d=JSM.Inf,e,f,g;for(e=0;e<this.projected.length;e++)f=this.projected[e],g=JSM.CoordDistance2D(new JSM.Coord2D(f.position.x,f.position.y),b),JSM.IsLower(g,a)&&JSM.IsLower(g,d)&&(c=f.originalIndex,d=g);return c};JSM.SpriteViewer.prototype.NearestPointUnderMouse=function(a){return this.NearestPointUnderPosition(a,this.navigation.mouse.currX,this.navigation.mouse.currY)};
JSM.SpriteViewer.prototype.NearestPointUnderTouch=function(a){return this.NearestPointUnderPosition(a,this.navigation.touch.currX,this.navigation.touch.currY)};JSM.SpriteViewer.prototype.FitInWindow=function(){var a=this.GetCenter(),b=this.GetBoundingSphereRadius(a);this.navigation.FitInWindow(a,b);this.Draw()};JSM.SpriteViewer.prototype.GetCenter=function(){var a=this.GetBoundingBox();return JSM.MidCoord(a[0],a[1])};
JSM.SpriteViewer.prototype.GetBoundingBox=function(){var a=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf),b=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf),c,d;for(c=0;c<this.points.length;c++)d=this.points[c],a.x=JSM.Minimum(a.x,d.x),a.y=JSM.Minimum(a.y,d.y),a.z=JSM.Minimum(a.z,d.z),b.x=JSM.Maximum(b.x,d.x),b.y=JSM.Maximum(b.y,d.y),b.z=JSM.Maximum(b.z,d.z);return[a,b]};
JSM.SpriteViewer.prototype.GetBoundingSphereRadius=function(a){if(void 0===a||null===a)a=this.GetCenter();var b=0,c,d;for(c=0;c<this.points.length;c++)d=this.points[c],d=JSM.CoordDistance(a,d),JSM.IsGreater(d,b)&&(b=d);return b};
JSM.SpriteViewer.prototype.Draw=function(){if(null!==this.callbacks.onDrawStart)this.callbacks.onDrawStart(this.canvas);var a=this.canvas.width/this.canvas.height,b=[0,0,this.canvas.width,this.canvas.height];this.projected=[];var c,d;for(c=0;c<this.points.length;c++)d=this.points[c],d=JSM.Project(d,this.camera.eye,this.camera.center,this.camera.up,this.camera.fieldOfView*JSM.DegRad,a,this.camera.nearClippingPlane,this.camera.farClippingPlane,b),d.y=this.canvas.height-d.y,null!==d&&this.projected.push({position:d,
originalIndex:c});this.projected.sort(function(a,b){return a.position.z>b.position.z?-1:a.position.z<b.position.z?1:0});for(c=0;c<this.projected.length;c++)if(null!==this.callbacks.onPointDraw)this.callbacks.onPointDraw(this.canvas,this.projected[c].originalIndex,this.projected[c].position);if(null!==this.callbacks.onDrawEnd)this.callbacks.onDrawEnd(this.canvas);return!0};JSM.Viewer=function(){this.navigation=this.renderer=this.canvas=null};
JSM.Viewer.prototype.Init=function(a,b,c){return!this.InitRenderer(a,b,c)||!this.InitNavigation()?!1:!0};JSM.Viewer.prototype.InitRenderer=function(a,b,c){this.renderer=new JSM.Renderer;return!this.renderer.Init(a,b,c)?!1:!0};JSM.Viewer.prototype.InitNavigation=function(){this.navigation=new JSM.Navigation;return!this.navigation.Init(this.renderer.canvas,this.renderer.camera,this.Draw.bind(this),this.Resize.bind(this))?!1:!0};
JSM.Viewer.prototype.SetClearColor=function(a,b,c){this.renderer.SetClearColor(a,b,c);this.Draw()};JSM.Viewer.prototype.AddGeometries=function(a){this.renderer.AddGeometries(a);this.Draw()};JSM.Viewer.prototype.RemoveGeometries=function(){this.renderer.RemoveGeometries();this.Draw()};JSM.Viewer.prototype.FitInWindow=function(){var a=this.GetCenter(),b=this.GetBoundingSphereRadius(a);this.navigation.FitInWindow(a,b);this.Draw()};
JSM.Viewer.prototype.GetCenter=function(){var a=this.GetBoundingBox();return JSM.MidCoord(a[0],a[1])};
JSM.Viewer.prototype.GetBoundingBox=function(){var a=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf),b=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf),c,d,e,f;for(c=0;c<this.renderer.geometries.length;c++){e=this.renderer.geometries[c];for(d=0;d<e.VertexCount();d+=1)f=e.GetTransformedVertex(d),a.x=JSM.Minimum(a.x,f.x),a.y=JSM.Minimum(a.y,f.y),a.z=JSM.Minimum(a.z,f.z),b.x=JSM.Maximum(b.x,f.x),b.y=JSM.Maximum(b.y,f.y),b.z=JSM.Maximum(b.z,f.z)}return[a,b]};
JSM.Viewer.prototype.GetBoundingSphereRadius=function(a){if(void 0===a||null===a)a=this.GetCenter();var b=0,c,d,e,f;for(c=0;c<this.renderer.geometries.length;c++){e=this.renderer.geometries[c];for(d=0;d<e.VertexCount();d+=1)f=e.GetTransformedVertex(d),f=JSM.CoordDistance(a,f),JSM.IsGreater(f,b)&&(b=f)}return b};JSM.Viewer.prototype.Resize=function(){this.renderer.Resize();this.Draw()};JSM.Viewer.prototype.Draw=function(){this.renderer.Render()};
JSM.PointCloudViewer=function(){this.navigation=this.renderer=this.canvas=null};JSM.PointCloudViewer.prototype.Init=function(a,b){return!this.InitRenderer(a,b)||!this.InitNavigation()?!1:!0};JSM.PointCloudViewer.prototype.InitRenderer=function(a,b){this.renderer=new JSM.PointCloudRenderer;return!this.renderer.Init(a,b)?!1:!0};
JSM.PointCloudViewer.prototype.InitNavigation=function(){this.navigation=new JSM.Navigation;return!this.navigation.Init(this.renderer.canvas,this.renderer.camera,this.Draw.bind(this),this.Resize.bind(this))?!1:!0};JSM.PointCloudViewer.prototype.SetClearColor=function(a,b,c){this.renderer.SetClearColor(a,b,c)};JSM.PointCloudViewer.prototype.SetPointSize=function(a){this.renderer.SetPointSize(a)};JSM.PointCloudViewer.prototype.AddPoints=function(a,b){this.renderer.AddPoints(a,b)};
JSM.PointCloudViewer.prototype.RemovePoints=function(){this.renderer.RemovePoints()};JSM.PointCloudViewer.prototype.FitInWindow=function(){var a=this.GetCenter(),b=this.GetBoundingSphereRadius(a);this.navigation.FitInWindow(a,b);this.Draw()};JSM.PointCloudViewer.prototype.GetCenter=function(){var a=this.GetBoundingBox();return JSM.MidCoord(a[0],a[1])};
JSM.PointCloudViewer.prototype.GetBoundingBox=function(){var a=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf),b=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf),c,d,e,f;for(c=0;c<this.renderer.points.length;c++){e=this.renderer.points[c].pointArray;for(d=0;d<e.length;d+=3)f=new JSM.Coord(e[d],e[d+1],e[d+2]),a.x=JSM.Minimum(a.x,f.x),a.y=JSM.Minimum(a.y,f.y),a.z=JSM.Minimum(a.z,f.z),b.x=JSM.Maximum(b.x,f.x),b.y=JSM.Maximum(b.y,f.y),b.z=JSM.Maximum(b.z,f.z)}return[a,b]};
JSM.PointCloudViewer.prototype.GetBoundingSphereRadius=function(a){if(void 0===a||null===a)a=this.GetCenter();var b=0,c,d,e,f;for(c=0;c<this.renderer.points.length;c++){e=this.renderer.points[c].pointArray;for(d=0;d<e.length;d+=3)f=new JSM.Coord(e[d],e[d+1],e[d+2]),f=JSM.CoordDistance(a,f),JSM.IsGreater(f,b)&&(b=f)}return b};JSM.PointCloudViewer.prototype.Resize=function(){this.renderer.Resize();this.Draw()};JSM.PointCloudViewer.prototype.Draw=function(){this.renderer.Render()};
JSM.ConvertBodyToThreeMeshes=function(a,b,c){var d={textureLoadedCallback:null,hasConvexPolygons:!1,doubleSided:!0};void 0!==c&&null!==c&&(d.textureLoadedCallback=JSM.ValueOrDefault(c.textureLoadedCallback,d.textureLoadedCallback),d.hasConvexPolygons=JSM.ValueOrDefault(c.hasConvexPolygons,d.hasConvexPolygons),d.doubleSided=JSM.ValueOrDefault(c.doubleSided,d.doubleSided));var e=[],f=null;JSM.ExplodeBodyToTriangles(a,b,{hasConvexPolygons:d.hasConvexPolygons,onGeometryStart:function(){f=new THREE.Geometry},
onGeometryEnd:function(a){var b=null!==a.texture,c=1!==a.opacity,k=new THREE.MeshPhongMaterial({ambient:a.ambient,color:a.diffuse,specular:a.specular});d.doubleSided&&(k.side=THREE.DoubleSide);c&&(k.opacity=a.opacity,k.transparent=!0);b&&(a=THREE.ImageUtils.loadTexture(a.texture,new THREE.UVMapping,function(){null!==d.textureLoadedCallback&&d.textureLoadedCallback()}),a.wrapS=THREE.RepeatWrapping,a.wrapT=THREE.RepeatWrapping,k.map=a);f.computeFaceNormals();k=new THREE.Mesh(f,k);e.push(k)},onTriangle:function(a,
b,c,d,e,n,p,q,r){var s=f.vertices.length;f.vertices.push(new THREE.Vector3(a.x,a.y,a.z));f.vertices.push(new THREE.Vector3(b.x,b.y,b.z));f.vertices.push(new THREE.Vector3(c.x,c.y,c.z));a=new THREE.Face3(s+0,s+1,s+2);f.faces.push(a);null!==d&&(null!==e&&null!==n)&&(a=[],a.push(new THREE.Vector3(d.x,d.y,d.z)),a.push(new THREE.Vector3(e.x,e.y,e.z)),a.push(new THREE.Vector3(n.x,n.y,n.z)),f.faces[f.faces.length-1].vertexNormals=a);null!==p&&(null!==q&&null!==r)&&(d=[],d.push(new THREE.Vector2(p.x,-p.y)),
d.push(new THREE.Vector2(q.x,-q.y)),d.push(new THREE.Vector2(r.x,-r.y)),f.faceVertexUvs[0].push(d))}});return e};JSM.ConvertModelToThreeMeshes=function(a,b,c){var d=[],e=[],f,g;for(f=0;f<a.BodyCount();f++){e=a.GetBody(f);e=JSM.ConvertBodyToThreeMeshes(e,b,c);for(g=0;g<e.length;g++)d.push(e[g])}return d};
JSM.ConvertJSONDataToThreeMeshes=function(a,b,c){function d(a,c){function d(a){var l=a.parameters,m=f[a.material];a=m.texture;var r=m.offset,s=m.scale,C=new THREE.Color,u=new THREE.Color,H=new THREE.Color;C.setRGB(m.ambient[0],m.ambient[1],m.ambient[2]);u.setRGB(m.diffuse[0],m.diffuse[1],m.diffuse[2]);H.setRGB(m.specular[0],m.specular[1],m.specular[2]);void 0!==a&&(C.setRGB(1,1,1),u.setRGB(1,1,1),H.setRGB(1,1,1),void 0===r&&(r=[0,0]),void 0===s&&(s=[1,1]));C=new THREE.MeshPhongMaterial({ambient:u.getHex(),
color:u.getHex(),specular:H.getHex(),side:THREE.DoubleSide});1!==m.opacity&&(C.opacity=m.opacity,C.transparent=!0);void 0!==a&&(m=THREE.ImageUtils.loadTexture(a,new THREE.UVMapping,function(){void 0!==b&&null!==b&&b()}),m.wrapS=THREE.RepeatWrapping,m.wrapT=THREE.RepeatWrapping,C.map=m);var m=new THREE.Geometry,z,I,J,D,A,B,K,L,M,w;for(w=0;w<l.length;w+=9)z=3*l[w+0],I=3*l[w+1],J=3*l[w+2],D=3*l[w+3],A=3*l[w+4],B=3*l[w+5],u=2*l[w+6],H=2*l[w+7],K=2*l[w+8],L=m.vertices.length,M=m.faces.length,m.vertices.push(new THREE.Vector3(g[z+
0],g[z+1],g[z+2])),m.vertices.push(new THREE.Vector3(g[I+0],g[I+1],g[I+2])),m.vertices.push(new THREE.Vector3(g[J+0],g[J+1],g[J+2])),m.faces.push(new THREE.Face3(L+0,L+1,L+2)),z=[],z.push(new THREE.Vector3(h[D+0],h[D+1],h[D+2])),z.push(new THREE.Vector3(h[A+0],h[A+1],h[A+2])),z.push(new THREE.Vector3(h[B+0],h[B+1],h[B+2])),m.faces[M].vertexNormals=z,void 0!==a&&(D=[],D.push(new THREE.Vector2(r[0]+q[u+0]*s[0],r[1]+q[u+1]*s[1])),D.push(new THREE.Vector2(r[0]+q[H+0]*s[0],r[1]+q[H+1]*s[1])),D.push(new THREE.Vector2(r[0]+
q[K+0]*s[0],r[1]+q[K+1]*s[1])),m.faceVertexUvs[0].push(D));l=new THREE.Mesh(m,C);l.originalJsonIndex=c;e.push(l)}var g=a.vertices;if(void 0!==g){var h=a.normals;if(void 0!==h){var q=a.uvs;if(void 0!==q){var r=a.triangles,s;for(s=0;s<r.length;s++)d(r[s])}}}}var e=[],f=a.materials;if(void 0===f)return e;var g=a.meshes;if(void 0===g)return e;var h=0;JSM.AsyncRunTask(function(){d(g[h],h);h+=1;return!0},c,g.length,0,e);return e};JSM.JSONFileConverter=function(a,b){this.onReady=a;this.onTextureLoaded=b};
JSM.JSONFileConverter.prototype.Convert=function(a){(new JSM.JSONFileLoader(this.OnReady.bind(this))).Load(a)};JSM.JSONFileConverter.prototype.OnReady=function(a){null!==this.onReady&&(a=JSM.ConvertJSONDataToThreeMeshes(a,this.onTextureLoaded),this.onReady(a))};JSM.ThreeViewer=function(){this.enableDraw=this.drawLoop=this.settings=this.navigation=this.cameraMove=this.runAfterRender=this.runBeforeRender=this.directionalLight=this.ambientLight=this.renderer=this.camera=this.scene=this.canvas=null};
JSM.ThreeViewer.prototype.Start=function(a,b){if(!this.IsWebGLEnabled()||!this.InitSettings(b)||!this.InitThree(a)||!this.InitCamera(b)||!this.InitLights())return!1;this.drawLoop=!1;this.enableDraw=!0;this.DrawIfNeeded();return!0};JSM.ThreeViewer.prototype.IsWebGLEnabled=function(){return!window.WebGLRenderingContext||!document.createElement("canvas").getContext("experimental-webgl")?!1:!0};
JSM.ThreeViewer.prototype.InitSettings=function(a){this.settings={cameraEyePosition:new JSM.Coord(1,1,1),cameraCenterPosition:new JSM.Coord(0,0,0),cameraUpVector:new JSM.Coord(0,0,1),lightAmbientColor:[0.5,0.5,0.5],lightDiffuseColor:[0.5,0.5,0.5]};void 0!==a&&(void 0!==a.cameraEyePosition&&(this.settings.cameraEyePosition=JSM.CoordFromArray(a.cameraEyePosition)),void 0!==a.cameraCenterPosition&&(this.settings.cameraCenterPosition=JSM.CoordFromArray(a.cameraCenterPosition)),void 0!==a.cameraUpVector&&
(this.settings.cameraUpVector=JSM.CoordFromArray(a.cameraUpVector)),void 0!==a.lightAmbientColor&&(this.settings.lightAmbientColor=a.lightAmbientColor),void 0!==a.lightDiffuseColor&&(this.settings.lightDiffuseColor=a.lightDiffuseColor));return!0};
JSM.ThreeViewer.prototype.InitThree=function(a){this.canvas=document.getElementById(a);if(!this.canvas||!this.canvas.getContext)return!1;this.scene=new THREE.Scene;if(!this.scene)return!1;this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,antialias:!0});if(!this.renderer)return!1;this.renderer.setClearColor(new THREE.Color(16777215));this.renderer.setSize(this.canvas.width,this.canvas.height);return!0};
JSM.ThreeViewer.prototype.InitCamera=function(a){this.cameraMove=new JSM.Camera(JSM.CoordFromArray(a.cameraEyePosition),JSM.CoordFromArray(a.cameraCenterPosition),JSM.CoordFromArray(a.cameraUpVector),a.fieldOfView,a.nearClippingPlane,a.farClippingPlane);if(!this.cameraMove)return!1;this.navigation=new JSM.Navigation;if(!this.navigation.Init(this.canvas,this.cameraMove,this.DrawIfNeeded.bind(this),this.Resize.bind(this)))return!1;this.camera=new THREE.PerspectiveCamera(this.cameraMove.fieldOfView,
this.canvas.width/this.canvas.height,this.cameraMove.nearClippingPlane,this.cameraMove.farClippingPlane);if(!this.camera)return!1;this.scene.add(this.camera);return!0};
JSM.ThreeViewer.prototype.InitLights=function(){var a=new THREE.Color,b=new THREE.Color;a.setRGB(this.settings.lightAmbientColor[0],this.settings.lightAmbientColor[1],this.settings.lightAmbientColor[2]);b.setRGB(this.settings.lightDiffuseColor[0],this.settings.lightDiffuseColor[1],this.settings.lightDiffuseColor[2]);this.ambientLight=new THREE.AmbientLight(a.getHex());if(!this.ambientLight)return!1;this.scene.add(this.ambientLight);this.directionalLight=new THREE.DirectionalLight(b.getHex());if(!this.directionalLight)return!1;
a=(new THREE.Vector3).subVectors(this.cameraMove.eye,this.cameraMove.center);this.directionalLight.position.set(a.x,a.y,a.z);this.scene.add(this.directionalLight);return!0};JSM.ThreeViewer.prototype.SetRunBeforeRender=function(a){this.runBeforeRender=a};JSM.ThreeViewer.prototype.SetRunAfterRender=function(a){this.runAfterRender=a};JSM.ThreeViewer.prototype.SetClearColor=function(a){this.renderer.setClearColor(new THREE.Color(a));this.DrawIfNeeded()};
JSM.ThreeViewer.prototype.AddMesh=function(a){this.scene.add(a);this.DrawIfNeeded()};JSM.ThreeViewer.prototype.AddMeshes=function(a){var b;for(b=0;b<a.length;b++)this.scene.add(a[b]);this.DrawIfNeeded()};JSM.ThreeViewer.prototype.MeshCount=function(){var a=0;this.scene.traverse(function(b){b instanceof THREE.Mesh&&(a+=1)});return a};JSM.ThreeViewer.prototype.VertexCount=function(){var a=0;this.scene.traverse(function(b){b instanceof THREE.Mesh&&(a+=b.geometry.vertices.length)});return a};
JSM.ThreeViewer.prototype.FaceCount=function(){var a=0;this.scene.traverse(function(b){b instanceof THREE.Mesh&&(a+=b.geometry.faces.length)});return a};JSM.ThreeViewer.prototype.GetMesh=function(a){var b=null,c=0,d;for(d=0;d<this.scene.children.length;d++)if(b=this.scene.children[d],b instanceof THREE.Mesh){if(c==a)return b;c+=1}return null};JSM.ThreeViewer.prototype.RemoveMesh=function(a){this.scene.remove(a);this.DrawIfNeeded()};
JSM.ThreeViewer.prototype.RemoveMeshes=function(){var a,b;for(b=0;b<this.scene.children.length;b++)a=this.scene.children[b],a instanceof THREE.Mesh&&(this.scene.remove(a),b--);this.DrawIfNeeded()};JSM.ThreeViewer.prototype.RemoveLastMesh=function(){var a=null;this.scene.traverse(function(b){b instanceof THREE.Mesh&&(a=b)});null!==a&&this.scene.remove(a);this.DrawIfNeeded()};
JSM.ThreeViewer.prototype.SetCamera=function(a,b,c){this.navigation.SetCamera(a,b,c);this.navigation.SetOrbitCenter(b.Clone());this.DrawIfNeeded()};JSM.ThreeViewer.prototype.Resize=function(){this.camera.aspect=this.canvas.width/this.canvas.height;this.camera.updateProjectionMatrix();this.renderer.setSize(this.canvas.width,this.canvas.height);this.DrawIfNeeded()};
JSM.ThreeViewer.prototype.FitInWindow=function(){if(0!==this.MeshCount()){var a=this.GetCenter(),b=this.GetBoundingSphereRadius(a);this.navigation.FitInWindow(a,b);this.DrawIfNeeded()}};JSM.ThreeViewer.prototype.AdjustClippingPlanes=function(a){var b=this.GetCenter();this.GetBoundingSphereRadius(b)<a?(this.camera.near=0.1,this.camera.far=1E3):(this.camera.near=10,this.camera.far=1E6);this.camera.updateProjectionMatrix();this.Draw()};
JSM.ThreeViewer.prototype.GetCenter=function(){var a=this.GetBoundingBox();return JSM.MidCoord(a[0],a[1])};
JSM.ThreeViewer.prototype.GetBoundingBox=function(){var a=new JSM.Coord(JSM.Inf,JSM.Inf,JSM.Inf),b=new JSM.Coord(-JSM.Inf,-JSM.Inf,-JSM.Inf),c,d;this.scene.traverse(function(e){if(e instanceof THREE.Mesh){c=e.geometry;var f;for(f=0;f<c.vertices.length;f++)d=c.vertices[f].clone(),d.add(e.position),a.x=JSM.Minimum(a.x,d.x),a.y=JSM.Minimum(a.y,d.y),a.z=JSM.Minimum(a.z,d.z),b.x=JSM.Maximum(b.x,d.x),b.y=JSM.Maximum(b.y,d.y),b.z=JSM.Maximum(b.z,d.z)}});return[a,b]};
JSM.ThreeViewer.prototype.GetBoundingSphereRadius=function(a){if(void 0===a||null===a)a=this.GetCenter();var b=0,c,d,e;this.scene.traverse(function(f){if(f instanceof THREE.Mesh){c=f.geometry;var g;for(g=0;g<c.vertices.length;g++)d=c.vertices[g].clone(),d.add(f.position),e=JSM.CoordDistance(a,new JSM.Coord(d.x,d.y,d.z)),JSM.IsGreater(e,b)&&(b=e)}});return b};
JSM.ThreeViewer.prototype.GetObjectsUnderPosition=function(a,b){var c=2*(a/this.canvas.width)-1,d=2*-(b/this.canvas.height)+1,e=new THREE.Projector,f=this.camera.position,c=new THREE.Vector3(c,d,0.5);e.unprojectVector(c,this.camera);c.sub(f);c.normalize();return(new THREE.Raycaster(f,c)).intersectObjects(this.scene.children)};JSM.ThreeViewer.prototype.GetObjectsUnderMouse=function(){return this.GetObjectsUnderPosition(this.navigation.mouse.currX,this.navigation.mouse.currY)};
JSM.ThreeViewer.prototype.GetObjectsUnderTouch=function(){return this.GetObjectsUnderPosition(this.navigation.touch.currX,this.navigation.touch.currY)};JSM.ThreeViewer.prototype.ProjectVector=function(a,b,c){var d=this.canvas.width/2,e=this.canvas.height/2,f=new THREE.Projector;a=new THREE.Vector3(a,b,c);f.projectVector(a,this.camera);a.x=a.x*d+d;a.y=-(a.y*e)+e;return a};JSM.ThreeViewer.prototype.EnableDraw=function(a){this.enableDraw=a};
JSM.ThreeViewer.prototype.Draw=function(){if(this.enableDraw){null!==this.runBeforeRender&&this.runBeforeRender();this.camera.position.set(this.cameraMove.eye.x,this.cameraMove.eye.y,this.cameraMove.eye.z);this.camera.up.set(this.cameraMove.up.x,this.cameraMove.up.y,this.cameraMove.up.z);this.camera.lookAt(new THREE.Vector3(this.cameraMove.center.x,this.cameraMove.center.y,this.cameraMove.center.z));var a=(new THREE.Vector3).subVectors(this.cameraMove.eye,this.cameraMove.center);this.directionalLight.position.set(a.x,
a.y,a.z);this.renderer.render(this.scene,this.camera);null!==this.runAfterRender&&this.runAfterRender();this.drawLoop&&requestAnimationFrame(this.Draw.bind(this))}};JSM.ThreeViewer.prototype.DrawIfNeeded=function(){this.drawLoop||this.Draw()};JSM.ThreeViewer.prototype.StartDrawLoop=function(){this.drawLoop=!0;this.Draw()};

// This is ammo.js, a port of Bullet Physics to JavaScript. zlib licensed.
var Ammo = (function() {
  var Module = this;

var Module;if(!Module)Module=(typeof Module!=="undefined"?Module:null)||{};var moduleOverrides={};for(var key in Module){if(Module.hasOwnProperty(key)){moduleOverrides[key]=Module[key]}}var ENVIRONMENT_IS_NODE=typeof process==="object"&&typeof require==="function";var ENVIRONMENT_IS_WEB=typeof window==="object";var ENVIRONMENT_IS_WORKER=typeof importScripts==="function";var ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;if(ENVIRONMENT_IS_NODE){if(!Module["print"])Module["print"]=function print(x){process["stdout"].write(x+"\n")};if(!Module["printErr"])Module["printErr"]=function printErr(x){process["stderr"].write(x+"\n")};var nodeFS=require("fs");var nodePath=require("path");Module["read"]=function read(filename,binary){filename=nodePath["normalize"](filename);var ret=nodeFS["readFileSync"](filename);if(!ret&&filename!=nodePath["resolve"](filename)){filename=path.join(__dirname,"..","src",filename);ret=nodeFS["readFileSync"](filename)}if(ret&&!binary)ret=ret.toString();return ret};Module["readBinary"]=function readBinary(filename){return Module["read"](filename,true)};Module["load"]=function load(f){globalEval(read(f))};Module["thisProgram"]=process["argv"][1].replace(/\\/g,"/");Module["arguments"]=process["argv"].slice(2);if(typeof module!=="undefined"){module["exports"]=Module}process["on"]("uncaughtException",(function(ex){if(!(ex instanceof ExitStatus)){throw ex}}))}else if(ENVIRONMENT_IS_SHELL){if(!Module["print"])Module["print"]=print;if(typeof printErr!="undefined")Module["printErr"]=printErr;if(typeof read!="undefined"){Module["read"]=read}else{Module["read"]=function read(){throw"no read() available (jsc?)"}}Module["readBinary"]=function readBinary(f){if(typeof readbuffer==="function"){return new Uint8Array(readbuffer(f))}var data=read(f,"binary");assert(typeof data==="object");return data};if(typeof scriptArgs!="undefined"){Module["arguments"]=scriptArgs}else if(typeof arguments!="undefined"){Module["arguments"]=arguments}this["Module"]=Module}else if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){Module["read"]=function read(url){var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.send(null);return xhr.responseText};if(typeof arguments!="undefined"){Module["arguments"]=arguments}if(typeof console!=="undefined"){if(!Module["print"])Module["print"]=function print(x){console.log(x)};if(!Module["printErr"])Module["printErr"]=function printErr(x){console.log(x)}}else{var TRY_USE_DUMP=false;if(!Module["print"])Module["print"]=TRY_USE_DUMP&&typeof dump!=="undefined"?(function(x){dump(x)}):(function(x){})}if(ENVIRONMENT_IS_WEB){window["Module"]=Module}else{Module["load"]=importScripts}}else{throw"Unknown runtime environment. Where are we?"}function globalEval(x){throw"NO_DYNAMIC_EXECUTION was set, cannot eval"}if(!Module["load"]&&Module["read"]){Module["load"]=function load(f){globalEval(Module["read"](f))}}if(!Module["print"]){Module["print"]=(function(){})}if(!Module["printErr"]){Module["printErr"]=Module["print"]}if(!Module["arguments"]){Module["arguments"]=[]}if(!Module["thisProgram"]){Module["thisProgram"]="./this.program"}Module.print=Module["print"];Module.printErr=Module["printErr"];Module["preRun"]=[];Module["postRun"]=[];for(var key in moduleOverrides){if(moduleOverrides.hasOwnProperty(key)){Module[key]=moduleOverrides[key]}}var Runtime={setTempRet0:(function(value){tempRet0=value}),getTempRet0:(function(){return tempRet0}),stackSave:(function(){return STACKTOP}),stackRestore:(function(stackTop){STACKTOP=stackTop}),getNativeTypeSize:(function(type){switch(type){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:{if(type[type.length-1]==="*"){return Runtime.QUANTUM_SIZE}else if(type[0]==="i"){var bits=parseInt(type.substr(1));assert(bits%8===0);return bits/8}else{return 0}}}}),getNativeFieldSize:(function(type){return Math.max(Runtime.getNativeTypeSize(type),Runtime.QUANTUM_SIZE)}),STACK_ALIGN:16,getAlignSize:(function(type,size,vararg){if(!vararg&&(type=="i64"||type=="double"))return 8;if(!type)return Math.min(size,8);return Math.min(size||(type?Runtime.getNativeFieldSize(type):0),Runtime.QUANTUM_SIZE)}),dynCall:(function(sig,ptr,args){if(args&&args.length){if(!args.splice)args=Array.prototype.slice.call(args);args.splice(0,0,ptr);return Module["dynCall_"+sig].apply(null,args)}else{return Module["dynCall_"+sig].call(null,ptr)}}),functionPointers:[],addFunction:(function(func){for(var i=0;i<Runtime.functionPointers.length;i++){if(!Runtime.functionPointers[i]){Runtime.functionPointers[i]=func;return 2*(1+i)}}throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."}),removeFunction:(function(index){Runtime.functionPointers[(index-2)/2]=null}),getAsmConst:(function(code,numArgs){if(!Runtime.asmConstCache)Runtime.asmConstCache={};var func=Runtime.asmConstCache[code];if(func)return func;var args=[];for(var i=0;i<numArgs;i++){args.push(String.fromCharCode(36)+i)}var source=Pointer_stringify(code);if(source[0]==='"'){if(source.indexOf('"',1)===source.length-1){source=source.substr(1,source.length-2)}else{abort("invalid EM_ASM input |"+source+"|. Please use EM_ASM(..code..) (no quotes) or EM_ASM({ ..code($0).. }, input) (to input values)")}}abort("NO_DYNAMIC_EXECUTION was set, cannot eval, so EM_ASM is not functional");return Runtime.asmConstCache[code]=evalled}),warnOnce:(function(text){if(!Runtime.warnOnce.shown)Runtime.warnOnce.shown={};if(!Runtime.warnOnce.shown[text]){Runtime.warnOnce.shown[text]=1;Module.printErr(text)}}),funcWrappers:{},getFuncWrapper:(function(func,sig){assert(sig);if(!Runtime.funcWrappers[sig]){Runtime.funcWrappers[sig]={}}var sigCache=Runtime.funcWrappers[sig];if(!sigCache[func]){sigCache[func]=function dynCall_wrapper(){return Runtime.dynCall(sig,func,arguments)}}return sigCache[func]}),UTF8Processor:(function(){var buffer=[];var needed=0;this.processCChar=(function(code){code=code&255;if(buffer.length==0){if((code&128)==0){return String.fromCharCode(code)}buffer.push(code);if((code&224)==192){needed=1}else if((code&240)==224){needed=2}else{needed=3}return""}if(needed){buffer.push(code);needed--;if(needed>0)return""}var c1=buffer[0];var c2=buffer[1];var c3=buffer[2];var c4=buffer[3];var ret;if(buffer.length==2){ret=String.fromCharCode((c1&31)<<6|c2&63)}else if(buffer.length==3){ret=String.fromCharCode((c1&15)<<12|(c2&63)<<6|c3&63)}else{var codePoint=(c1&7)<<18|(c2&63)<<12|(c3&63)<<6|c4&63;ret=String.fromCharCode(((codePoint-65536)/1024|0)+55296,(codePoint-65536)%1024+56320)}buffer.length=0;return ret});this.processJSString=function processJSString(string){string=unescape(encodeURIComponent(string));var ret=[];for(var i=0;i<string.length;i++){ret.push(string.charCodeAt(i))}return ret}}),getCompilerSetting:(function(name){throw"You must build with -s RETAIN_COMPILER_SETTINGS=1 for Runtime.getCompilerSetting or emscripten_get_compiler_setting to work"}),stackAlloc:(function(size){var ret=STACKTOP;STACKTOP=STACKTOP+size|0;STACKTOP=STACKTOP+15&-16;return ret}),staticAlloc:(function(size){var ret=STATICTOP;STATICTOP=STATICTOP+size|0;STATICTOP=STATICTOP+15&-16;return ret}),dynamicAlloc:(function(size){var ret=DYNAMICTOP;DYNAMICTOP=DYNAMICTOP+size|0;DYNAMICTOP=DYNAMICTOP+15&-16;if(DYNAMICTOP>=TOTAL_MEMORY)enlargeMemory();return ret}),alignMemory:(function(size,quantum){var ret=size=Math.ceil(size/(quantum?quantum:16))*(quantum?quantum:16);return ret}),makeBigInt:(function(low,high,unsigned){var ret=unsigned?+(low>>>0)+ +(high>>>0)*+4294967296:+(low>>>0)+ +(high|0)*+4294967296;return ret}),GLOBAL_BASE:8,QUANTUM_SIZE:4,__dummy__:0};Module["Runtime"]=Runtime;var __THREW__=0;var ABORT=false;var EXITSTATUS=0;var undef=0;var tempValue,tempInt,tempBigInt,tempInt2,tempBigInt2,tempPair,tempBigIntI,tempBigIntR,tempBigIntS,tempBigIntP,tempBigIntD,tempDouble,tempFloat;var tempI64,tempI64b;var tempRet0,tempRet1,tempRet2,tempRet3,tempRet4,tempRet5,tempRet6,tempRet7,tempRet8,tempRet9;function assert(condition,text){if(!condition){abort("Assertion failed: "+text)}}var globalScope=this;function getCFunc(ident){var func=Module["_"+ident];if(!func){abort("NO_DYNAMIC_EXECUTION was set, cannot eval - ccall/cwrap are not functional")}assert(func,"Cannot call unknown function "+ident+" (perhaps LLVM optimizations or closure removed it?)");return func}var cwrap,ccall;((function(){var stack=0;var JSfuncs={"stackSave":(function(){stack=Runtime.stackSave()}),"stackRestore":(function(){Runtime.stackRestore(stack)}),"arrayToC":(function(arr){var ret=Runtime.stackAlloc(arr.length);writeArrayToMemory(arr,ret);return ret}),"stringToC":(function(str){var ret=0;if(str!==null&&str!==undefined&&str!==0){ret=Runtime.stackAlloc((str.length<<2)+1);writeStringToMemory(str,ret)}return ret})};var toC={"string":JSfuncs["stringToC"],"array":JSfuncs["arrayToC"]};ccall=function ccallFunc(ident,returnType,argTypes,args){var func=getCFunc(ident);var cArgs=[];if(args){for(var i=0;i<args.length;i++){var converter=toC[argTypes[i]];if(converter){if(stack===0)stack=Runtime.stackSave();cArgs[i]=converter(args[i])}else{cArgs[i]=args[i]}}}var ret=func.apply(null,cArgs);if(returnType==="string")ret=Pointer_stringify(ret);if(stack!==0)JSfuncs["stackRestore"]();return ret};var sourceRegex=/^function\s*\(([^)]*)\)\s*{\s*([^*]*?)[\s;]*(?:return\s*(.*?)[;\s]*)?}$/;function parseJSFunc(jsfunc){var parsed=jsfunc.toString().match(sourceRegex).slice(1);return{arguments:parsed[0],body:parsed[1],returnValue:parsed[2]}}var JSsource={};for(var fun in JSfuncs){if(JSfuncs.hasOwnProperty(fun)){JSsource[fun]=parseJSFunc(JSfuncs[fun])}}cwrap=function cwrap(ident,returnType,argTypes){argTypes=argTypes||[];var cfunc=getCFunc(ident);var numericArgs=argTypes.every((function(type){return type==="number"}));var numericRet=returnType!=="string";if(numericRet&&numericArgs){return cfunc}var argNames=argTypes.map((function(x,i){return"$"+i}));var funcstr="(function("+argNames.join(",")+") {";var nargs=argTypes.length;if(!numericArgs){funcstr+=JSsource["stackSave"].body+";";for(var i=0;i<nargs;i++){var arg=argNames[i],type=argTypes[i];if(type==="number")continue;var convertCode=JSsource[type+"ToC"];funcstr+="var "+convertCode.arguments+" = "+arg+";";funcstr+=convertCode.body+";";funcstr+=arg+"="+convertCode.returnValue+";"}}var cfuncname=parseJSFunc((function(){return cfunc})).returnValue;funcstr+="var ret = "+cfuncname+"("+argNames.join(",")+");";if(!numericRet){var strgfy=parseJSFunc((function(){return Pointer_stringify})).returnValue;funcstr+="ret = "+strgfy+"(ret);"}if(!numericArgs){funcstr+=JSsource["stackRestore"].body+";"}funcstr+="return ret})";abort("NO_DYNAMIC_EXECUTION was set, cannot eval - ccall is not functional")}}))();Module["cwrap"]=cwrap;Module["ccall"]=ccall;function setValue(ptr,value,type,noSafe){type=type||"i8";if(type.charAt(type.length-1)==="*")type="i32";switch(type){case"i1":HEAP8[ptr>>0]=value;break;case"i8":HEAP8[ptr>>0]=value;break;case"i16":HEAP16[ptr>>1]=value;break;case"i32":HEAP32[ptr>>2]=value;break;case"i64":tempI64=[value>>>0,(tempDouble=value,+Math_abs(tempDouble)>=+1?tempDouble>+0?(Math_min(+Math_floor(tempDouble/+4294967296),+4294967295)|0)>>>0:~~+Math_ceil((tempDouble- +(~~tempDouble>>>0))/+4294967296)>>>0:0)],HEAP32[ptr>>2]=tempI64[0],HEAP32[ptr+4>>2]=tempI64[1];break;case"float":HEAPF32[ptr>>2]=value;break;case"double":HEAPF64[ptr>>3]=value;break;default:abort("invalid type for setValue: "+type)}}Module["setValue"]=setValue;function getValue(ptr,type,noSafe){type=type||"i8";if(type.charAt(type.length-1)==="*")type="i32";switch(type){case"i1":return HEAP8[ptr>>0];case"i8":return HEAP8[ptr>>0];case"i16":return HEAP16[ptr>>1];case"i32":return HEAP32[ptr>>2];case"i64":return HEAP32[ptr>>2];case"float":return HEAPF32[ptr>>2];case"double":return HEAPF64[ptr>>3];default:abort("invalid type for setValue: "+type)}return null}Module["getValue"]=getValue;var ALLOC_NORMAL=0;var ALLOC_STACK=1;var ALLOC_STATIC=2;var ALLOC_DYNAMIC=3;var ALLOC_NONE=4;Module["ALLOC_NORMAL"]=ALLOC_NORMAL;Module["ALLOC_STACK"]=ALLOC_STACK;Module["ALLOC_STATIC"]=ALLOC_STATIC;Module["ALLOC_DYNAMIC"]=ALLOC_DYNAMIC;Module["ALLOC_NONE"]=ALLOC_NONE;function allocate(slab,types,allocator,ptr){var zeroinit,size;if(typeof slab==="number"){zeroinit=true;size=slab}else{zeroinit=false;size=slab.length}var singleType=typeof types==="string"?types:null;var ret;if(allocator==ALLOC_NONE){ret=ptr}else{ret=[_malloc,Runtime.stackAlloc,Runtime.staticAlloc,Runtime.dynamicAlloc][allocator===undefined?ALLOC_STATIC:allocator](Math.max(size,singleType?1:types.length))}if(zeroinit){var ptr=ret,stop;assert((ret&3)==0);stop=ret+(size&~3);for(;ptr<stop;ptr+=4){HEAP32[ptr>>2]=0}stop=ret+size;while(ptr<stop){HEAP8[ptr++>>0]=0}return ret}if(singleType==="i8"){if(slab.subarray||slab.slice){HEAPU8.set(slab,ret)}else{HEAPU8.set(new Uint8Array(slab),ret)}return ret}var i=0,type,typeSize,previousType;while(i<size){var curr=slab[i];if(typeof curr==="function"){curr=Runtime.getFunctionIndex(curr)}type=singleType||types[i];if(type===0){i++;continue}if(type=="i64")type="i32";setValue(ret+i,curr,type);if(previousType!==type){typeSize=Runtime.getNativeTypeSize(type);previousType=type}i+=typeSize}return ret}Module["allocate"]=allocate;function Pointer_stringify(ptr,length){var hasUtf=false;var t;var i=0;while(1){t=HEAPU8[ptr+i>>0];if(t>=128)hasUtf=true;else if(t==0&&!length)break;i++;if(length&&i==length)break}if(!length)length=i;var ret="";if(!hasUtf){var MAX_CHUNK=1024;var curr;while(length>0){curr=String.fromCharCode.apply(String,HEAPU8.subarray(ptr,ptr+Math.min(length,MAX_CHUNK)));ret=ret?ret+curr:curr;ptr+=MAX_CHUNK;length-=MAX_CHUNK}return ret}var utf8=new Runtime.UTF8Processor;for(i=0;i<length;i++){t=HEAPU8[ptr+i>>0];ret+=utf8.processCChar(t)}return ret}Module["Pointer_stringify"]=Pointer_stringify;function UTF16ToString(ptr){var i=0;var str="";while(1){var codeUnit=HEAP16[ptr+i*2>>1];if(codeUnit==0)return str;++i;str+=String.fromCharCode(codeUnit)}}Module["UTF16ToString"]=UTF16ToString;function stringToUTF16(str,outPtr){for(var i=0;i<str.length;++i){var codeUnit=str.charCodeAt(i);HEAP16[outPtr+i*2>>1]=codeUnit}HEAP16[outPtr+str.length*2>>1]=0}Module["stringToUTF16"]=stringToUTF16;function UTF32ToString(ptr){var i=0;var str="";while(1){var utf32=HEAP32[ptr+i*4>>2];if(utf32==0)return str;++i;if(utf32>=65536){var ch=utf32-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}else{str+=String.fromCharCode(utf32)}}}Module["UTF32ToString"]=UTF32ToString;function stringToUTF32(str,outPtr){var iChar=0;for(var iCodeUnit=0;iCodeUnit<str.length;++iCodeUnit){var codeUnit=str.charCodeAt(iCodeUnit);if(codeUnit>=55296&&codeUnit<=57343){var trailSurrogate=str.charCodeAt(++iCodeUnit);codeUnit=65536+((codeUnit&1023)<<10)|trailSurrogate&1023}HEAP32[outPtr+iChar*4>>2]=codeUnit;++iChar}HEAP32[outPtr+iChar*4>>2]=0}Module["stringToUTF32"]=stringToUTF32;function demangle(func){var hasLibcxxabi=!!Module["___cxa_demangle"];if(hasLibcxxabi){try{var buf=_malloc(func.length);writeStringToMemory(func.substr(1),buf);var status=_malloc(4);var ret=Module["___cxa_demangle"](buf,0,0,status);if(getValue(status,"i32")===0&&ret){return Pointer_stringify(ret)}}catch(e){}finally{if(buf)_free(buf);if(status)_free(status);if(ret)_free(ret)}}var i=3;var basicTypes={"v":"void","b":"bool","c":"char","s":"short","i":"int","l":"long","f":"float","d":"double","w":"wchar_t","a":"signed char","h":"unsigned char","t":"unsigned short","j":"unsigned int","m":"unsigned long","x":"long long","y":"unsigned long long","z":"..."};var subs=[];var first=true;function dump(x){if(x)Module.print(x);Module.print(func);var pre="";for(var a=0;a<i;a++)pre+=" ";Module.print(pre+"^")}function parseNested(){i++;if(func[i]==="K")i++;var parts=[];while(func[i]!=="E"){if(func[i]==="S"){i++;var next=func.indexOf("_",i);var num=func.substring(i,next)||0;parts.push(subs[num]||"?");i=next+1;continue}if(func[i]==="C"){parts.push(parts[parts.length-1]);i+=2;continue}var size=parseInt(func.substr(i));var pre=size.toString().length;if(!size||!pre){i--;break}var curr=func.substr(i+pre,size);parts.push(curr);subs.push(curr);i+=pre+size}i++;return parts}function parse(rawList,limit,allowVoid){limit=limit||Infinity;var ret="",list=[];function flushList(){return"("+list.join(", ")+")"}var name;if(func[i]==="N"){name=parseNested().join("::");limit--;if(limit===0)return rawList?[name]:name}else{if(func[i]==="K"||first&&func[i]==="L")i++;var size=parseInt(func.substr(i));if(size){var pre=size.toString().length;name=func.substr(i+pre,size);i+=pre+size}}first=false;if(func[i]==="I"){i++;var iList=parse(true);var iRet=parse(true,1,true);ret+=iRet[0]+" "+name+"<"+iList.join(", ")+">"}else{ret=name}paramLoop:while(i<func.length&&limit-->0){var c=func[i++];if(c in basicTypes){list.push(basicTypes[c])}else{switch(c){case"P":list.push(parse(true,1,true)[0]+"*");break;case"R":list.push(parse(true,1,true)[0]+"&");break;case"L":{i++;var end=func.indexOf("E",i);var size=end-i;list.push(func.substr(i,size));i+=size+2;break};case"A":{var size=parseInt(func.substr(i));i+=size.toString().length;if(func[i]!=="_")throw"?";i++;list.push(parse(true,1,true)[0]+" ["+size+"]");break};case"E":break paramLoop;default:ret+="?"+c;break paramLoop}}}if(!allowVoid&&list.length===1&&list[0]==="void")list=[];if(rawList){if(ret){list.push(ret+"?")}return list}else{return ret+flushList()}}var final=func;try{if(func=="Object._main"||func=="_main"){return"main()"}if(typeof func==="number")func=Pointer_stringify(func);if(func[0]!=="_")return func;if(func[1]!=="_")return func;if(func[2]!=="Z")return func;switch(func[3]){case"n":return"operator new()";case"d":return"operator delete()"}final=parse()}catch(e){final+="?"}if(final.indexOf("?")>=0&&!hasLibcxxabi){Runtime.warnOnce("warning: a problem occurred in builtin C++ name demangling; build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling")}return final}function demangleAll(text){return text.replace(/__Z[\w\d_]+/g,(function(x){var y=demangle(x);return x===y?x:x+" ["+y+"]"}))}function jsStackTrace(){var err=new Error;if(!err.stack){try{throw new Error(0)}catch(e){err=e}if(!err.stack){return"(no stack trace available)"}}return err.stack.toString()}function stackTrace(){return demangleAll(jsStackTrace())}Module["stackTrace"]=stackTrace;var PAGE_SIZE=4096;function alignMemoryPage(x){return x+4095&-4096}var HEAP;var HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64;var STATIC_BASE=0,STATICTOP=0,staticSealed=false;var STACK_BASE=0,STACKTOP=0,STACK_MAX=0;var DYNAMIC_BASE=0,DYNAMICTOP=0;function enlargeMemory(){abort("Cannot enlarge memory arrays. Either (1) compile with -s TOTAL_MEMORY=X with X higher than the current value "+TOTAL_MEMORY+", (2) compile with ALLOW_MEMORY_GROWTH which adjusts the size at runtime but prevents some optimizations, or (3) set Module.TOTAL_MEMORY before the program runs.")}var TOTAL_STACK=Module["TOTAL_STACK"]||5242880;var TOTAL_MEMORY=Module["TOTAL_MEMORY"]||67108864;var FAST_MEMORY=Module["FAST_MEMORY"]||2097152;var totalMemory=64*1024;while(totalMemory<TOTAL_MEMORY||totalMemory<2*TOTAL_STACK){if(totalMemory<16*1024*1024){totalMemory*=2}else{totalMemory+=16*1024*1024}}if(totalMemory!==TOTAL_MEMORY){Module.printErr("increasing TOTAL_MEMORY to "+totalMemory+" to be compliant with the asm.js spec");TOTAL_MEMORY=totalMemory}assert(typeof Int32Array!=="undefined"&&typeof Float64Array!=="undefined"&&!!(new Int32Array(1))["subarray"]&&!!(new Int32Array(1))["set"],"JS engine does not provide full typed array support");var buffer=new ArrayBuffer(TOTAL_MEMORY);HEAP8=new Int8Array(buffer);HEAP16=new Int16Array(buffer);HEAP32=new Int32Array(buffer);HEAPU8=new Uint8Array(buffer);HEAPU16=new Uint16Array(buffer);HEAPU32=new Uint32Array(buffer);HEAPF32=new Float32Array(buffer);HEAPF64=new Float64Array(buffer);HEAP32[0]=255;assert(HEAPU8[0]===255&&HEAPU8[3]===0,"Typed arrays 2 must be run on a little-endian system");Module["HEAP"]=HEAP;Module["HEAP8"]=HEAP8;Module["HEAP16"]=HEAP16;Module["HEAP32"]=HEAP32;Module["HEAPU8"]=HEAPU8;Module["HEAPU16"]=HEAPU16;Module["HEAPU32"]=HEAPU32;Module["HEAPF32"]=HEAPF32;Module["HEAPF64"]=HEAPF64;function callRuntimeCallbacks(callbacks){while(callbacks.length>0){var callback=callbacks.shift();if(typeof callback=="function"){callback();continue}var func=callback.func;if(typeof func==="number"){if(callback.arg===undefined){Runtime.dynCall("v",func)}else{Runtime.dynCall("vi",func,[callback.arg])}}else{func(callback.arg===undefined?null:callback.arg)}}}var __ATPRERUN__=[];var __ATINIT__=[];var __ATMAIN__=[];var __ATEXIT__=[];var __ATPOSTRUN__=[];var runtimeInitialized=false;var runtimeExited=false;function preRun(){if(Module["preRun"]){if(typeof Module["preRun"]=="function")Module["preRun"]=[Module["preRun"]];while(Module["preRun"].length){addOnPreRun(Module["preRun"].shift())}}callRuntimeCallbacks(__ATPRERUN__)}function ensureInitRuntime(){if(runtimeInitialized)return;runtimeInitialized=true;callRuntimeCallbacks(__ATINIT__)}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){callRuntimeCallbacks(__ATEXIT__);runtimeExited=true}function postRun(){if(Module["postRun"]){if(typeof Module["postRun"]=="function")Module["postRun"]=[Module["postRun"]];while(Module["postRun"].length){addOnPostRun(Module["postRun"].shift())}}callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(cb){__ATPRERUN__.unshift(cb)}Module["addOnPreRun"]=Module.addOnPreRun=addOnPreRun;function addOnInit(cb){__ATINIT__.unshift(cb)}Module["addOnInit"]=Module.addOnInit=addOnInit;function addOnPreMain(cb){__ATMAIN__.unshift(cb)}Module["addOnPreMain"]=Module.addOnPreMain=addOnPreMain;function addOnExit(cb){__ATEXIT__.unshift(cb)}Module["addOnExit"]=Module.addOnExit=addOnExit;function addOnPostRun(cb){__ATPOSTRUN__.unshift(cb)}Module["addOnPostRun"]=Module.addOnPostRun=addOnPostRun;function intArrayFromString(stringy,dontAddNull,length){var ret=(new Runtime.UTF8Processor).processJSString(stringy);if(length){ret.length=length}if(!dontAddNull){ret.push(0)}return ret}Module["intArrayFromString"]=intArrayFromString;function intArrayToString(array){var ret=[];for(var i=0;i<array.length;i++){var chr=array[i];if(chr>255){chr&=255}ret.push(String.fromCharCode(chr))}return ret.join("")}Module["intArrayToString"]=intArrayToString;function writeStringToMemory(string,buffer,dontAddNull){var array=intArrayFromString(string,dontAddNull);var i=0;while(i<array.length){var chr=array[i];HEAP8[buffer+i>>0]=chr;i=i+1}}Module["writeStringToMemory"]=writeStringToMemory;function writeArrayToMemory(array,buffer){for(var i=0;i<array.length;i++){HEAP8[buffer+i>>0]=array[i]}}Module["writeArrayToMemory"]=writeArrayToMemory;function writeAsciiToMemory(str,buffer,dontAddNull){for(var i=0;i<str.length;i++){HEAP8[buffer+i>>0]=str.charCodeAt(i)}if(!dontAddNull)HEAP8[buffer+str.length>>0]=0}Module["writeAsciiToMemory"]=writeAsciiToMemory;function unSign(value,bits,ignore){if(value>=0){return value}return bits<=32?2*Math.abs(1<<bits-1)+value:Math.pow(2,bits)+value}function reSign(value,bits,ignore){if(value<=0){return value}var half=bits<=32?Math.abs(1<<bits-1):Math.pow(2,bits-1);if(value>=half&&(bits<=32||value>half)){value=-2*half+value}return value}if(!Math["imul"]||Math["imul"](4294967295,5)!==-5)Math["imul"]=function imul(a,b){var ah=a>>>16;var al=a&65535;var bh=b>>>16;var bl=b&65535;return al*bl+(ah*bl+al*bh<<16)|0};Math.imul=Math["imul"];var Math_abs=Math.abs;var Math_cos=Math.cos;var Math_sin=Math.sin;var Math_tan=Math.tan;var Math_acos=Math.acos;var Math_asin=Math.asin;var Math_atan=Math.atan;var Math_atan2=Math.atan2;var Math_exp=Math.exp;var Math_log=Math.log;var Math_sqrt=Math.sqrt;var Math_ceil=Math.ceil;var Math_floor=Math.floor;var Math_pow=Math.pow;var Math_imul=Math.imul;var Math_fround=Math.fround;var Math_min=Math.min;var runDependencies=0;var runDependencyWatcher=null;var dependenciesFulfilled=null;function addRunDependency(id){runDependencies++;if(Module["monitorRunDependencies"]){Module["monitorRunDependencies"](runDependencies)}}Module["addRunDependency"]=addRunDependency;function removeRunDependency(id){runDependencies--;if(Module["monitorRunDependencies"]){Module["monitorRunDependencies"](runDependencies)}if(runDependencies==0){if(runDependencyWatcher!==null){clearInterval(runDependencyWatcher);runDependencyWatcher=null}if(dependenciesFulfilled){var callback=dependenciesFulfilled;dependenciesFulfilled=null;callback()}}}Module["removeRunDependency"]=removeRunDependency;Module["preloadedImages"]={};Module["preloadedAudios"]={};var memoryInitializer=null;STATIC_BASE=8;STATICTOP=STATIC_BASE+Runtime.alignMemory(21635);__ATINIT__.push({func:(function(){__GLOBAL__I_a()})});allocate([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,160,0,0,0,1,0,0,0,2,0,0,0,3,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,49,55,98,116,84,121,112,101,100,67,111,110,115,116,114,97,105,110,116,0,0,0,0,0,49,51,98,116,84,121,112,101,100,79,98,106,101,99,116,0,184,81,0,0,136,0,0,0,64,82,0,0,112,0,0,0,0,0,0,0,1,0,0,0,152,0,0,0,2,4,0,0,0,0,0,0,24,1,0,0,4,0,0,0,5,0,0,0,2,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,49,57,98,116,71,104,111,115,116,80,97,105,114,67,97,108,108,98,97,99,107,0,0,0,50,53,98,116,79,118,101,114,108,97,112,112,105,110,103,80,97,105,114,67,97,108,108,98,97,99,107,0,0,0,0,0,184,81,0,0,240,0,0,0,224,81,0,0,216,0,0,0,16,1,0,0,0,0,0,0,49,56,98,116,86,101,104,105,99,108,101,82,97,121,99,97,115,116,101,114,0,0,0,0,184,81,0,0,40,1,0,0,0,0,0,0,192,1,0,0,6,0,0,0,7,0,0,0,1,0,0,0,1,0,0,0,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,52,67,108,111,115,101,115,116,82,97,121,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,0,0,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,49,55,82,97,121,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,0,184,81,0,0,144,1,0,0,224,81,0,0,96,1,0,0,184,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,152,2,0,0,8,0,0,0,9,0,0,0,1,0,0,0,2,0,0,0,50,48,98,116,68,101,102,97,117,108,116,77,111,116,105,111,110,83,116,97,116,101,0,0,49,51,98,116,77,111,116,105,111,110,83,116,97,116,101,0,184,81,0,0,128,2,0,0,224,81,0,0,104,2,0,0,144,2,0,0,0,0,0,0,0,0,0,0,48,3,0,0,10,0,0,0,11,0,0,0,2,0,0,0,2,0,0,0,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,55,67,108,111,115,101,115,116,67,111,110,118,101,120,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,0,0,0,0,0,0,0,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,48,67,111,110,118,101,120,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,0,0,0,0,0,0,184,81,0,0,248,2,0,0,224,81,0,0,192,2,0,0,40,3,0,0,0,0,0,0,0,0,0,0,176,3,0,0,12,0,0,0,13,0,0,0,3,0,0,0,1,0,0,0,50,57,67,111,110,99,114,101,116,101,67,111,110,116,97,99,116,82,101,115,117,108,116,67,97,108,108,98,97,99,107,0,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,49,67,111,110,116,97,99,116,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,0,0,0,0,0,184,81,0,0,120,3,0,0,224,81,0,0,88,3,0,0,168,3,0,0,0,0,0,0,123,32,118,97,114,32,115,101,108,102,32,61,32,77,111,100,117,108,101,91,39,103,101,116,67,97,99,104,101,39,93,40,77,111,100,117,108,101,91,39,67,111,110,99,114,101,116,101,67,111,110,116,97,99,116,82,101,115,117,108,116,67,97,108,108,98,97,99,107,39,93,41,91,36,48,93,59,32,105,102,32,40,33,115,101,108,102,46,104,97,115,79,119,110,80,114,111,112,101,114,116,121,40,39,97,100,100,83,105,110,103,108,101,82,101,115,117,108,116,39,41,41,32,116,104,114,111,119,32,39,97,32,74,83,73,109,112,108,101,109,101,110,116,97,116,105,111,110,32,109,117,115,116,32,105,109,112,108,101,109,101,110,116,32,97,108,108,32,102,117,110,99,116,105,111,110,115,44,32,121,111,117,32,102,111,114,103,111,116,32,67,111,110,99,114,101,116,101,67,111,110,116,97,99,116,82,101,115,117,108,116,67,97,108,108,98,97,99,107,58,58,97,100,100,83,105,110,103,108,101,82,101,115,117,108,116,46,39,59,32,114,101,116,117,114,110,32,115,101,108,102,46,97,100,100,83,105,110,103,108,101,82,101,115,117,108,116,40,36,49,44,36,50,44,36,51,44,36,52,44,36,53,44,36,54,44,36,55,41,59,32,125,0,0,0,0,0,0,0,0,56,5,0,0,14,0,0,0,15,0,0,0,16,0,0,0,1,0,0,0,3,0,0,0,4,0,0,0,2,0,0,0,1,0,0,0,3,0,0,0,2,0,0,0,3,0,0,0,2,0,0,0,50,49,98,116,67,111,110,101,84,119,105,115,116,67,111,110,115,116,114,97,105,110,116,0,224,81,0,0,32,5,0,0,160,0,0,0,0,0,0,0,98,116,67,111,110,101,84,119,105,115,116,67,111,110,115,116,114,97,105,110,116,68,97,116,97,0,0,0,0,0,0,0,0,0,0,0,48,8,0,0,17,0,0,0,18,0,0,0,19,0,0,0,20,0,0,0,5,0,0,0,3,0,0,0,21,0,0,0,1,0,0,0,2,0,0,0,3,0,0,0,6,0,0,0,22,0,0,0,7,0,0,0,1,0,0,0,3,0,0,0,8,0,0,0,9,0,0,0,10,0,0,0,11,0,0,0,12,0,0,0,23,0,0,0,13,0,0,0,4,0,0,0,14,0,0,0,15,0,0,0,4,0,0,0,5,0,0,0,4,0,0,0,5,0,0,0,6,0,0,0,24,0,0,0,16,0,0,0,17,0,0,0,18,0,0,0,19,0,0,0,1,0,0,0,2,0,0,0,25,0,0,0,20,0,0,0,3,0,0,0,4,0,0,0,5,0,0,0,26,0,0,0,21,0,0,0,6,0,0,0,0,0,0,0,100,101,98,117,103,68,114,97,119,87,111,114,108,100,0,0,115,121,110,99,104,114,111,110,105,122,101,77,111,116,105,111,110,83,116,97,116,101,115,0,115,116,101,112,83,105,109,117,108,97,116,105,111,110,0,0,105,110,116,101,114,110,97,108,83,105,110,103,108,101,83,116,101,112,83,105,109,117,108,97,116,105,111,110,0,0,0,0,117,112,100,97,116,101,65,99,116,105,111,110,115,0,0,0,117,112,100,97,116,101,65,99,116,105,118,97,116,105,111,110,83,116,97,116,101,0,0,0,115,111,108,118,101,67,111,110,115,116,114,97,105,110,116,115,0,0,0,0,0,0,0,0,99,97,108,99,117,108,97,116,101,83,105,109,117,108,97,116,105,111,110,73,115,108,97,110,100,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,99,114,101,97,116,101,80,114,101,100,105,99,116,105,118,101,67,111,110,116,97,99,116,115,0,0,0,0,0,0,0,0,114,101,108,101,97,115,101,32,112,114,101,100,105,99,116,105,118,101,32,99,111,110,116,97,99,116,32,109,97,110,105,102,111,108,100,115,0,0,0,0,112,114,101,100,105,99,116,105,118,101,32,99,111,110,118,101,120,83,119,101,101,112,84,101,115,116,0,0,0,0,0,0,105,110,116,101,103,114,97,116,101,84,114,97,110,115,102,111,114,109,115,0,0,0,0,0,67,67,68,32,109,111,116,105,111,110,32,99,108,97,109,112,105,110,103,0,0,0,0,0,97,112,112,108,121,32,115,112,101,99,117,108,97,116,105,118,101,32,99,111,110,116,97,99,116,32,114,101,115,116,105,116,117,116,105,111,110,0,0,0,112,114,101,100,105,99,116,85,110,99,111,110,115,116,114,97,105,110,116,77,111,116,105,111,110,0,0,0,0,0,0,0,98,116,68,121,110,97,109,105,99,115,87,111,114,108,100,70,108,111,97,116,68,97,116,97,0,0,0,0,0,0,0,0,50,51,98,116,68,105,115,99,114,101,116,101,68,121,110,97,109,105,99,115,87,111,114,108,100,0,0,0,0,0,0,0,49,53,98,116,68,121,110,97,109,105,99,115,87,111,114,108,100,0,0,0,0,0,0,0,224,81,0,0,8,8,0,0,184,29,0,0,0,0,0,0,224,81,0,0,232,7,0,0,32,8,0,0,0,0,0,0,98,116,67,111,110,118,101,120,73,110,116,101,114,110,97,108,83,104,97,112,101,68,97,116,97,0,0,0,0,0,0,0,83,80,72,69,82,69,0,0,0,0,0,0,168,8,0,0,27,0,0,0,28,0,0,0,6,0,0,0,4,0,0,0,51,52,98,116,67,108,111,115,101,115,116,78,111,116,77,101,67,111,110,118,101,120,82,101,115,117,108,116,67,97,108,108,98,97,99,107,0,0,0,0,224,81,0,0,128,8,0,0,48,3,0,0,0,0,0,0,0,0,0,0,40,9,0,0,29,0,0,0,30,0,0,0,1,0,0,0,0,0,0,0,50,55,73,110,112,108,97,99,101,83,111,108,118,101,114,73,115,108,97,110,100,67,97,108,108,98,97,99,107,0,0,0,78,50,53,98,116,83,105,109,117,108,97,116,105,111,110,73,115,108,97,110,100,77,97,110,97,103,101,114,49,52,73,115,108,97,110,100,67,97,108,108,98,97,99,107,69,0,0,0,184,81,0,0,240,8,0,0,224,81,0,0,208,8,0,0,32,9,0,0,0,0,0,0,0,0,0,0,144,9,0,0,31,0,0,0,32,0,0,0,33,0,0,0,1,0,0,0,22,0,0,0,23,0,0,0,1,0,0,0,2,0,0,0,5,0,0,0,7,0,0,0,4,0,0,0,34,0,0,0,50,51,98,116,71,101,110,101,114,105,99,54,68,111,102,67,111,110,115,116,114,97,105,110,116,0,0,0,0,0,0,0,224,81,0,0,112,9,0,0,160,0,0,0,0,0,0,0,98,116,71,101,110,101,114,105,99,54,68,111,102,67,111,110,115,116,114,97,105,110,116,68,97,116,97,0,0,0,0,0,0,0,0,0,16,10,0,0,35,0,0,0,36,0,0,0,37,0,0,0,1,0,0,0,24,0,0,0,25,0,0,0,1,0,0,0,3,0,0,0,6,0,0,0,8,0,0,0,5,0,0,0,0,0,0,0,49,55,98,116,72,105,110,103,101,67,111,110,115,116,114,97,105,110,116,0,0,0,0,0,224,81,0,0,248,9,0,0,160,0,0,0,0,0,0,0,98,116,72,105,110,103,101,67,111,110,115,116,114,97,105,110,116,70,108,111,97,116,68,97,116,97,0,0,0,0,0,0,0,0,0,0,56,11,0,0,38,0,0,0,39,0,0,0,1,0,0,0,26,0,0,0,27,0,0,0,2,0,0,0,28,0,0,0,29,0,0,0,30,0,0,0,3,0,0,0,9,0,0,0,40,0,0,0,10,0,0,0,31,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,51,48,98,116,75,105,110,101,109,97,116,105,99,67,104,97,114,97,99,116,101,114,67,111,110,116,114,111,108,108,101,114,0,0,0,0,0,0,0,0,51,48,98,116,67,104,97,114,97,99,116,101,114,67,111,110,116,114,111,108,108,101,114,73,110,116,101,114,102,97,99,101,0,0,0,0,0,0,0,0,49,55,98,116,65,99,116,105,111,110,73,110,116,101,114,102,97,99,101,0,0,0,0,0,184,81,0,0,8,11,0,0,224,81,0,0,224,10,0,0,32,11,0,0,0,0,0,0,224,81,0,0,184,10,0,0,40,11,0,0,0,0,0,0,0,0,0,0,144,11,0,0,41,0,0,0,42,0,0,0,2,0,0,0,7,0,0,0,52,51,98,116,75,105,110,101,109,97,116,105,99,67,108,111,115,101,115,116,78,111,116,77,101,67,111,110,118,101,120,82,101,115,117,108,116,67,97,108,108,98,97,99,107,0,0,0,224,81,0,0,96,11,0,0,48,3,0,0,0,0,0,0,0,0,0,0,248,11,0,0,43,0,0,0,44,0,0,0,45,0,0,0,1,0,0,0,32,0,0,0,33,0,0,0,1,0,0,0,4,0,0,0,8,0,0,0,11,0,0,0,6,0,0,0,0,0,0,0,50,51,98,116,80,111,105,110,116,50,80,111,105,110,116,67,111,110,115,116,114,97,105,110,116,0,0,0,0,0,0,0,224,81,0,0,216,11,0,0,160,0,0,0,0,0,0,0,98,116,80,111,105,110,116,50,80,111,105,110,116,67,111,110,115,116,114,97,105,110,116,70,108,111,97,116,68,97,116,97,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,224,14,0,0,46,0,0,0,47,0,0,0,4,0,0,0,34,0,0,0,7,0,0,0,8,0,0,0,5,0,0,0,0,0,0,0,49,54,98,116,82,97,121,99,97,115,116,86,101,104,105,99,108,101,0,0,0,0,0,0,224,81,0,0,200,14,0,0,32,11,0,0,0,0,0,0,0,0,0,0,40,15,0,0,48,0,0,0,49,0,0,0,2,0,0,0,0,0,0,0,50,53,98,116,68,101,102,97,117,108,116,86,101,104,105,99,108,101,82,97,121,99,97,115,116,101,114,0,0,0,0,0,224,81,0,0,8,15,0,0,64,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,152,15,0,0,7,0,0,0,50,0,0,0,51,0,0,0,35,0,0,0,12,0,0,0,7,0,0,0,36,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,98,116,82,105,103,105,100,66,111,100,121,70,108,111,97,116,68,97,116,97,0,0,0,0,49,49,98,116,82,105,103,105,100,66,111,100,121,0,0,0,224,81,0,0,136,15,0,0,160,27,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,144,16,0,0,52,0,0,0,53,0,0,0,4,0,0,0,1,0,0,0,5,0,0,0,54,0,0,0,13,0,0,0,6,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,1,0,0,0,2,0,0,0,0,0,0,0,115,111,108,118,101,71,114,111,117,112,67,97,99,104,101,70,114,105,101,110,100,108,121,83,101,116,117,112,0,0,0,0,115,111,108,118,101,71,114,111,117,112,67,97,99,104,101,70,114,105,101,110,100,108,121,73,116,101,114,97,116,105,111,110,115,0,0,0,0,0,0,0,115,111,108,118,101,71,114,111,117,112,0,0,0,0,0,0,51,53,98,116,83,101,113,117,101,110,116,105,97,108,73,109,112,117,108,115,101,67,111,110,115,116,114,97,105,110,116,83,111,108,118,101,114,0,0,0,49,56,98,116,67,111,110,115,116,114,97,105,110,116,83,111,108,118,101,114,0,0,0,0,184,81,0,0,112,16,0,0,224,81,0,0,72,16,0,0,136,16,0,0,0,0,0,0,0,0,0,0,240,16,0,0,55,0,0,0,56,0,0,0,3,0,0,0,1,0,0,0,37,0,0,0,38,0,0,0,1,0,0,0,5,0,0,0,9,0,0,0,14,0,0,0,8,0,0,0,0,0,0,0,49,56,98,116,83,108,105,100,101,114,67,111,110,115,116,114,97,105,110,116,0,0,0,0,224,81,0,0,216,16,0,0,160,0,0,0,0,0,0,0,98,116,83,108,105,100,101,114,67,111,110,115,116,114,97,105,110,116,68,97,116,97,0,0,98,116,84,121,112,101,100,67,111,110,115,116,114,97,105,110,116,70,108,111,97,116,68,97,116,97,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,72,20,0,0,57,0,0,0,58,0,0,0,1,0,0,0,6,0,0,0,1,0,0,0,7,0,0,0,2,0,0,0,8,0,0,0,39,0,0,0,15,0,0,0,16,0,0,0,7,0,0,0,40,0,0,0,59,0,0,0,49,50,98,116,65,120,105,115,83,119,101,101,112,51,0,0,50,48,98,116,65,120,105,115,83,119,101,101,112,51,73,110,116,101,114,110,97,108,73,116,69,0,0,0,0,0,0,0,50,49,98,116,66,114,111,97,100,112,104,97,115,101,73,110,116,101,114,102,97,99,101,0,184,81,0,0,24,20,0,0,224,81,0,0,248,19,0,0,48,20,0,0,0,0,0,0,224,81,0,0,232,19,0,0,56,20,0,0,0,0,0,0,0,0,0,0,56,20,0,0,60,0,0,0,61,0,0,0,1,0,0,0,6,0,0,0,1,0,0,0,7,0,0,0,2,0,0,0,8,0,0,0,39,0,0,0,15,0,0,0,16,0,0,0,7,0,0,0,40,0,0,0,59,0,0,0,0,0,0,0,48,21,0,0,62,0,0,0,63,0,0,0,9,0,0,0,3,0,0,0,8,0,0,0,17,0,0,0,18,0,0,0,19,0,0,0,9,0,0,0,20,0,0,0,10,0,0,0,41,0,0,0,11,0,0,0,10,0,0,0,21,0,0,0,42,0,0,0,43,0,0,0,0,0,0,0,49,53,98,116,78,117,108,108,80,97,105,114,67,97,99,104,101,0,0,0,0,0,0,0,50,50,98,116,79,118,101,114,108,97,112,112,105,110,103,80,97,105,114,67,97,99,104,101,0,0,0,0,0,0,0,0,224,81,0,0,0,21,0,0,16,1,0,0,0,0,0,0,224,81,0,0,232,20,0,0,32,21,0,0,0,0,0,0,0,0,0,0,216,21,0,0,64,0,0,0,65,0,0,0,9,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,44,0,0,0,22,0,0,0,1,0,0,0,23,0,0,0,45,0,0,0,9,0,0,0,2,0,0,0,24,0,0,0,11,0,0,0,46,0,0,0,13,0,0,0,14,0,0,0,2,0,0,0,10,0,0,0,11,0,0,0,25,0,0,0,15,0,0,0,8,0,0,0,26,0,0,0,27,0,0,0,12,0,0,0,16,0,0,0,28,0,0,0,13,0,0,0,1,0,0,0,17,0,0,0,49,48,98,116,66,111,120,83,104,97,112,101,0,0,0,0,224,81,0,0,200,21,0,0,128,62,0,0,0,0,0,0,66,111,120,0,0,0,0,0,0,0,0,0,136,22,0,0,66,0,0,0,67,0,0,0,14,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,47,0,0,0,29,0,0,0,2,0,0,0,30,0,0,0,45,0,0,0,10,0,0,0,3,0,0,0,31,0,0,0,12,0,0,0,46,0,0,0,15,0,0,0,18,0,0,0,19,0,0,0,48,0,0,0,49,0,0,0,0,0,0,0,98,116,84,114,105,97,110,103,108,101,77,101,115,104,83,104,97,112,101,68,97,116,97,0,50,50,98,116,66,118,104,84,114,105,97,110,103,108,101,77,101,115,104,83,104,97,112,101,0,0,0,0,0,0,0,0,224,81,0,0,104,22,0,0,112,68,0,0,0,0,0,0,66,86,72,84,82,73,65,78,71,76,69,77,69,83,72,0,0,0,0,0,80,23,0,0,68,0,0,0,69,0,0,0,20,0,0,0,0,0,0,0,90,78,75,50,50,98,116,66,118,104,84,114,105,97,110,103,108,101,77,101,115,104,83,104,97,112,101,49,57,112,114,111,99,101,115,115,65,108,108,84,114,105,97,110,103,108,101,115,69,80,49,56,98,116,84,114,105,97,110,103,108,101,67,97,108,108,98,97,99,107,82,75,57,98,116,86,101,99,116,111,114,51,83,52,95,69,50,49,77,121,78,111,100,101,79,118,101,114,108,97,112,67,97,108,108,98,97,99,107,0,0,0,50,49,98,116,78,111,100,101,79,118,101,114,108,97,112,67,97,108,108,98,97,99,107,0,184,81,0,0,48,23,0,0,224,81,0,0,192,22,0,0,72,23,0,0,0,0,0,0,0,0,0,0,240,23,0,0,70,0,0,0,71,0,0,0,21,0,0,0,0,0,0,0,90,78,50,50,98,116,66,118,104,84,114,105,97,110,103,108,101,77,101,115,104,83,104,97,112,101,49,55,112,101,114,102,111,114,109,67,111,110,118,101,120,99,97,115,116,69,80,49,56,98,116,84,114,105,97,110,103,108,101,67,97,108,108,98,97,99,107,82,75,57,98,116,86,101,99,116,111,114,51,83,52,95,83,52,95,83,52,95,69,50,49,77,121,78,111,100,101,79,118,101,114,108,97,112,67,97,108,108,98,97,99,107,0,0,0,0,0,0,0,0,224,81,0,0,120,23,0,0,72,23,0,0,0,0,0,0,0,0,0,0,128,24,0,0,72,0,0,0,73,0,0,0,22,0,0,0,0,0,0,0,90,78,50,50,98,116,66,118,104,84,114,105,97,110,103,108,101,77,101,115,104,83,104,97,112,101,49,52,112,101,114,102,111,114,109,82,97,121,99,97,115,116,69,80,49,56,98,116,84,114,105,97,110,103,108,101,67,97,108,108,98,97,99,107,82,75,57,98,116,86,101,99,116,111,114,51,83,52,95,69,50,49,77,121,78,111,100,101,79,118,101,114,108,97,112,67,97,108,108,98,97,99,107,0,224,81,0,0,24,24,0,0,72,23,0,0,0,0,0,0,0,0,0,0,224,25,0,0,74,0,0,0,75,0,0,0,16,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,50,0,0,0,22,0,0,0,3,0,0,0,32,0,0,0,51,0,0,0,11,0,0,0,2,0,0,0,33,0,0,0,13,0,0,0,46,0,0,0,23,0,0,0,24,0,0,0,2,0,0,0,17,0,0,0,11,0,0,0,34,0,0,0,25,0,0,0,0,0,0,0,0,0,0,0,8,26,0,0,76,0,0,0,77,0,0,0,16,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,50,0,0,0,22,0,0,0,3,0,0,0,35,0,0,0,51,0,0,0,11,0,0,0,2,0,0,0,33,0,0,0,13,0,0,0,46,0,0,0,23,0,0,0,24,0,0,0,2,0,0,0,17,0,0,0,11,0,0,0,34,0,0,0,25,0,0,0,0,0,0,0,0,0,0,0,48,26,0,0,78,0,0,0,79,0,0,0,16,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,50,0,0,0,22,0,0,0,3,0,0,0,36,0,0,0,51,0,0,0,11,0,0,0,2,0,0,0,33,0,0,0,13,0,0,0,46,0,0,0,23,0,0,0,24,0,0,0,2,0,0,0,17,0,0,0,11,0,0,0,34,0,0,0,25,0,0,0,0,0,0,0,49,52,98,116,67,97,112,115,117,108,101,83,104,97,112,101,0,0,0,0,0,0,0,0,224,81,0,0,200,25,0,0,104,41,0,0,0,0,0,0,49,53,98,116,67,97,112,115,117,108,101,83,104,97,112,101,88,0,0,0,0,0,0,0,224,81,0,0,240,25,0,0,224,25,0,0,0,0,0,0,49,53,98,116,67,97,112,115,117,108,101,83,104,97,112,101,90,0,0,0,0,0,0,0,224,81,0,0,24,26,0,0,224,25,0,0,0,0,0,0,67,97,112,115,117,108,101,90,0,0,0,0,0,0,0,0,67,97,112,115,117,108,101,88,0,0,0,0,0,0,0,0,98,116,67,97,112,115,117,108,101,83,104,97,112,101,68,97,116,97,0,0,0,0,0,0,67,97,112,115,117,108,101,83,104,97,112,101,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,240,26,0,0,80,0,0,0,81,0,0,0,4,0,0,0,14,0,0,0,52,0,0,0,53,0,0,0,15,0,0,0,16,0,0,0,18,0,0,0,37,0,0,0,9,0,0,0,38,0,0,0,39,0,0,0,40,0,0,0,10,0,0,0,54,0,0,0,50,49,98,116,67,111,108,108,105,115,105,111,110,68,105,115,112,97,116,99,104,101,114,0,224,81,0,0,216,26,0,0,88,50,0,0,0,0,0,0,0,0,0,0,88,27,0,0,82,0,0,0,83,0,0,0,11,0,0,0,0,0,0,0,50,51,98,116,67,111,108,108,105,115,105,111,110,80,97,105,114,67,97,108,108,98,97,99,107,0,0,0,0,0,0,0,49,55,98,116,79,118,101,114,108,97,112,67,97,108,108,98,97,99,107,0,0,0,0,0,184,81,0,0,56,27,0,0,224,81,0,0,24,27,0,0,80,27,0,0,0,0,0,0,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,70,108,111,97,116,68,97,116,97,0,0,0,0,0,0,49,55,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,0,0,0,0,0,184,81,0,0,136,27,0,0,98,116,67,111,108,108,105,115,105,111,110,83,104,97,112,101,68,97,116,97,0,0,0,0,49,54,98,116,67,111,108,108,105,115,105,111,110,83,104,97,112,101,0,0,0,0,0,0,184,81,0,0,192,27,0,0,0,0,0,0,184,29,0,0,84,0,0,0,85,0,0,0,19,0,0,0,20,0,0,0,5,0,0,0,3,0,0,0,86,0,0,0,1,0,0,0,2,0,0,0,19,0,0,0,55,0,0,0,22,0,0,0,56,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,79,118,101,114,102,108,111,119,32,105,110,32,65,65,66,66,44,32,111,98,106,101,99,116,32,114,101,109,111,118,101,100,32,102,114,111,109,32,115,105,109,117,108,97,116,105,111,110,0,0,0,0,0,0,0,0,73,102,32,121,111,117,32,99,97,110,32,114,101,112,114,111,100,117,99,101,32,116,104,105,115,44,32,112,108,101,97,115,101,32,101,109,97,105,108,32,98,117,103,115,64,99,111,110,116,105,110,117,111,117,115,112,104,121,115,105,99,115,46,99,111,109,10,0,0,0,0,0,80,108,101,97,115,101,32,105,110,99,108,117,100,101,32,97,98,111,118,101,32,105,110,102,111,114,109,97,116,105,111,110,44,32,121,111,117,114,32,80,108,97,116,102,111,114,109,44,32,118,101,114,115,105,111,110,32,111,102,32,79,83,46,10,0,0,0,0,0,0,0,0,84,104,97,110,107,115,46,10,0,0,0,0,0,0,0,0,117,112,100,97,116,101,65,97,98,98,115,0,0,0,0,0,99,97,108,99,117,108,97,116,101,79,118,101,114,108,97,112,112,105,110,103,80,97,105,114,115,0,0,0,0,0,0,0,112,101,114,102,111,114,109,68,105,115,99,114,101,116,101,67,111,108,108,105,115,105,111,110,68,101,116,101,99,116,105,111,110,0,0,0,0,0,0,0,100,105,115,112,97,116,99,104,65,108,108,67,111,108,108,105,115,105,111,110,80,97,105,114,115,0,0,0,0,0,0,0,99,111,110,118,101,120,83,119,101,101,112,67,111,109,112,111,117,110,100,0,0,0,0,0,99,111,110,118,101,120,83,119,101,101,112,84,101,115,116,0,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,0,0,0,0,0,0,184,81,0,0,160,29,0,0,0,0,0,0,8,30,0,0,87,0,0,0,88,0,0,0,20,0,0,0,21,0,0,0,252,255,255,255,8,30,0,0,89,0,0,0,90,0,0,0,22,0,0,0,0,0,0,0,49,55,68,101,98,117,103,68,114,97,119,99,97,108,108,98,97,99,107,0,0,0,0,0,64,82,0,0,240,29,0,0,0,0,0,0,2,0,0,0,88,67,0,0,2,0,0,0,136,67,0,0,2,4,0,0,0,0,0,0,104,30,0,0,91,0,0,0,92,0,0,0,26,0,0,0,27,0,0,0,3,0,0,0,0,0,0,0,50,51,98,116,66,114,105,100,103,101,100,77,97,110,105,102,111,108,100,82,101,115,117,108,116,0,0,0,0,0,0,0,224,81,0,0,72,30,0,0,240,52,0,0,0,0,0,0,50,52,98,116,66,114,111,97,100,112,104,97,115,101,65,97,98,98,67,97,108,108,98,97,99,107,0,0,0,0,0,0,184,81,0,0,120,30,0,0,0,0,0,0,0,31,0,0,93,0,0,0,94,0,0,0,12,0,0,0,0,0,0,0,50,49,98,116,83,105,110,103,108,101,83,119,101,101,112,67,97,108,108,98,97,99,107,0,50,51,98,116,66,114,111,97,100,112,104,97,115,101,82,97,121,67,97,108,108,98,97,99,107,0,0,0,0,0,0,0,224,81,0,0,208,30,0,0,152,30,0,0,0,0,0,0,224,81,0,0,184,30,0,0,240,30,0,0,0,0,0,0,0,0,0,0,64,31,0,0,95,0,0,0,96,0,0,0,13,0,0,0,0,0,0,0,49,57,98,116,83,105,110,103,108,101,82,97,121,67,97,108,108,98,97,99,107,0,0,0,224,81,0,0,40,31,0,0,240,30,0,0,0,0,0,0,0,0,0,0,8,32,0,0,97,0,0,0,98,0,0,0,14,0,0,0,10,0,0,0,90,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,53,111,98,106,101,99,116,81,117,101,114,121,83,105,110,103,108,101,73,110,116,101,114,110,97,108,69,80,75,49,51,98,116,67,111,110,118,101,120,83,104,97,112,101,82,75,49,49,98,116,84,114,97,110,115,102,111,114,109,83,53,95,80,75,50,52,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,87,114,97,112,112,101,114,82,78,83,95,50,48,67,111,110,118,101,120,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,102,69,49,52,76,111,99,97,108,73,110,102,111,65,100,100,101,114,95,49,0,0,224,81,0,0,104,31,0,0,40,3,0,0,0,0,0,0,0,0,0,0,232,32,0,0,99,0,0,0,100,0,0,0,23,0,0,0,1,0,0,0,90,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,53,111,98,106,101,99,116,81,117,101,114,121,83,105,110,103,108,101,73,110,116,101,114,110,97,108,69,80,75,49,51,98,116,67,111,110,118,101,120,83,104,97,112,101,82,75,49,49,98,116,84,114,97,110,115,102,111,114,109,83,53,95,80,75,50,52,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,87,114,97,112,112,101,114,82,78,83,95,50,48,67,111,110,118,101,120,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,102,69,51,50,66,114,105,100,103,101,84,114,105,97,110,103,108,101,67,111,110,118,101,120,99,97,115,116,67,97,108,108,98,97,99,107,95,48,0,0,0,0,0,0,0,0,224,81,0,0,48,32,0,0,224,63,0,0,0,0,0,0,0,0,0,0,192,33,0,0,101,0,0,0,102,0,0,0,23,0,0,0,2,0,0,0,90,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,53,111,98,106,101,99,116,81,117,101,114,121,83,105,110,103,108,101,73,110,116,101,114,110,97,108,69,80,75,49,51,98,116,67,111,110,118,101,120,83,104,97,112,101,82,75,49,49,98,116,84,114,97,110,115,102,111,114,109,83,53,95,80,75,50,52,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,87,114,97,112,112,101,114,82,78,83,95,50,48,67,111,110,118,101,120,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,102,69,51,50,66,114,105,100,103,101,84,114,105,97,110,103,108,101,67,111,110,118,101,120,99,97,115,116,67,97,108,108,98,97,99,107,0,0,224,81,0,0,16,33,0,0,224,63,0,0,0,0,0,0,0,0,0,0,112,34,0,0,103,0,0,0,104,0,0,0,15,0,0,0,11,0,0,0,90,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,49,114,97,121,84,101,115,116,83,105,110,103,108,101,73,110,116,101,114,110,97,108,69,82,75,49,49,98,116,84,114,97,110,115,102,111,114,109,83,50,95,80,75,50,52,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,87,114,97,112,112,101,114,82,78,83,95,49,55,82,97,121,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,69,49,53,76,111,99,97,108,73,110,102,111,65,100,100,101,114,50,0,0,0,0,224,81,0,0,232,33,0,0,184,1,0,0,0,0,0,0,0,0,0,0,72,35,0,0,105,0,0,0,106,0,0,0,28,0,0,0,57,0,0,0,5,0,0,0,16,0,0,0,17,0,0,0,0,0,0,0,90,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,49,114,97,121,84,101,115,116,83,105,110,103,108,101,73,110,116,101,114,110,97,108,69,82,75,49,49,98,116,84,114,97,110,115,102,111,114,109,83,50,95,80,75,50,52,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,87,114,97,112,112,101,114,82,78,83,95,49,55,82,97,121,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,69,57,82,97,121,84,101,115,116,101,114,95,49,0,78,54,98,116,68,98,118,116,56,73,67,111,108,108,105,100,101,69,0,0,0,0,0,0,184,81,0,0,40,35,0,0,224,81,0,0,168,34,0,0,64,35,0,0,0,0,0,0,0,0,0,0,8,36,0,0,107,0,0,0,108,0,0,0,24,0,0,0,1,0,0,0,90,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,49,114,97,121,84,101,115,116,83,105,110,103,108,101,73,110,116,101,114,110,97,108,69,82,75,49,49,98,116,84,114,97,110,115,102,111,114,109,83,50,95,80,75,50,52,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,87,114,97,112,112,101,114,82,78,83,95,49,55,82,97,121,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,69,50,57,66,114,105,100,103,101,84,114,105,97,110,103,108,101,82,97,121,99,97,115,116,67,97,108,108,98,97,99,107,95,48,0,0,0,0,224,81,0,0,112,35,0,0,176,63,0,0,0,0,0,0,0,0,0,0,200,36,0,0,109,0,0,0,110,0,0,0,24,0,0,0,2,0,0,0,90,78,49,54,98,116,67,111,108,108,105,115,105,111,110,87,111,114,108,100,50,49,114,97,121,84,101,115,116,83,105,110,103,108,101,73,110,116,101,114,110,97,108,69,82,75,49,49,98,116,84,114,97,110,115,102,111,114,109,83,50,95,80,75,50,52,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,87,114,97,112,112,101,114,82,78,83,95,49,55,82,97,121,82,101,115,117,108,116,67,97,108,108,98,97,99,107,69,69,50,57,66,114,105,100,103,101,84,114,105,97,110,103,108,101,82,97,121,99,97,115,116,67,97,108,108,98,97,99,107,0,0,0,0,0,0,224,81,0,0,48,36,0,0,176,63,0,0,0,0,0,0,0,0,0,0,24,37,0,0,12,0,0,0,58,0,0,0,29,0,0,0,111,0,0,0,112,0,0,0,0,0,0,0,78,49,50,98,116,67,111,110,118,101,120,67,97,115,116,49,48,67,97,115,116,82,101,115,117,108,116,69,0,0,0,0,184,81,0,0,248,36,0,0,0,0,0,0,192,37,0,0,113,0,0,0,114,0,0,0,25,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,59,0,0,0,41,0,0,0,4,0,0,0,42,0,0,0,45,0,0,0,13,0,0,0,4,0,0,0,43,0,0,0,17,0,0,0,46,0,0,0,60,0,0,0,115,0,0,0,98,116,67,111,109,112,111,117,110,100,83,104,97,112,101,67,104,105,108,100,68,97,116,97,0,0,0,0,0,0,0,0,98,116,67,111,109,112,111,117,110,100,83,104,97,112,101,68,97,116,97,0,0,0,0,0,49,53,98,116,67,111,109,112,111,117,110,100,83,104,97,112,101,0,0,0,0,0,0,0,224,81,0,0,168,37,0,0,216,27,0,0,0,0,0,0,67,111,109,112,111,117,110,100,0,0,0,0,0,0,0,0,0,0,0,0,40,39,0,0,116,0,0,0,117,0,0,0,26,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,61,0,0,0,22,0,0,0,5,0,0,0,44,0,0,0,62,0,0,0,14,0,0,0,2,0,0,0,45,0,0,0,18,0,0,0,46,0,0,0,30,0,0,0,31,0,0,0,2,0,0,0,27,0,0,0,11,0,0,0,34,0,0,0,25,0,0,0,0,0,0,0,0,0,0,0,72,39,0,0,118,0,0,0,119,0,0,0,26,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,61,0,0,0,22,0,0,0,5,0,0,0,46,0,0,0,63,0,0,0,14,0,0,0,2,0,0,0,45,0,0,0,18,0,0,0,46,0,0,0,30,0,0,0,31,0,0,0,2,0,0,0,27,0,0,0,11,0,0,0,34,0,0,0,25,0,0,0,0,0,0,0,0,0,0,0,104,39,0,0,120,0,0,0,121,0,0,0,26,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,61,0,0,0,22,0,0,0,5,0,0,0,47,0,0,0,64,0,0,0,14,0,0,0,2,0,0,0,45,0,0,0,18,0,0,0,46,0,0,0,30,0,0,0,31,0,0,0,2,0,0,0,27,0,0,0,11,0,0,0,34,0,0,0,25,0,0,0,0,0,0,0,49,49,98,116,67,111,110,101,83,104,97,112,101,0,0,0,224,81,0,0,24,39,0,0,104,41,0,0,0,0,0,0,49,50,98,116,67,111,110,101,83,104,97,112,101,90,0,0,224,81,0,0,56,39,0,0,40,39,0,0,0,0,0,0,49,50,98,116,67,111,110,101,83,104,97,112,101,88,0,0,224,81,0,0,88,39,0,0,40,39,0,0,0,0,0,0,67,111,110,101,88,0,0,0,67,111,110,101,90,0,0,0,98,116,67,111,110,101,83,104,97,112,101,68,97,116,97,0,67,111,110,101,0,0,0,0,0,0,0,0,216,39,0,0,122,0,0,0,123,0,0,0,1,0,0,0,0,0,0,0,50,55,98,116,67,111,110,116,105,110,117,111,117,115,67,111,110,118,101,120,67,111,108,108,105,115,105,111,110,0,0,0,224,81,0,0,184,39,0,0,120,40,0,0,0,0,0,0,0,0,0,0,88,40,0,0,124,0,0,0,125,0,0,0,32,0,0,0,33,0,0,0,4],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE);allocate([49,54,98,116,80,111,105,110,116,67,111,108,108,101,99,116,111,114,0,0,0,0,0,0,78,51,54,98,116,68,105,115,99,114,101,116,101,67,111,108,108,105,115,105,111,110,68,101,116,101,99,116,111,114,73,110,116,101,114,102,97,99,101,54,82,101,115,117,108,116,69,0,184,81,0,0,32,40,0,0,224,81,0,0,8,40,0,0,80,40,0,0,0,0,0,0,49,50,98,116,67,111,110,118,101,120,67,97,115,116,0,0,184,81,0,0,104,40,0,0,0,0,0,0,56,41,0,0,126,0,0,0,127,0,0,0,28,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,65,0,0,0,22,0,0,0,6,0,0,0,48,0,0,0,45,0,0,0,14,0,0,0,2,0,0,0,49,0,0,0,19,0,0,0,46,0,0,0,34,0,0,0,35,0,0,0,2,0,0,0,29,0,0,0,11,0,0,0,34,0,0,0,25,0,0,0,8,0,0,0,50,0,0,0,51,0,0,0,30,0,0,0,36,0,0,0,52,0,0,0,31,0,0,0,2,0,0,0,1,0,0,0,98,116,67,111,110,118,101,120,72,117,108,108,83,104,97,112,101,68,97,116,97,0,0,0,49,55,98,116,67,111,110,118,101,120,72,117,108,108,83,104,97,112,101,0,0,0,0,0,224,81,0,0,32,41,0,0,184,62,0,0,0,0,0,0,67,111,110,118,101,120,0,0,50,49,98,116,67,111,110,118,101,120,73,110,116,101,114,110,97,108,83,104,97,112,101,0,224,81,0,0,80,41,0,0,136,41,0,0,0,0,0,0,49,51,98,116,67,111,110,118,101,120,83,104,97,112,101,0,224,81,0,0,120,41,0,0,216,27,0,0,0,0,0,0,0,0,0,0,64,42,0,0,128,0,0,0,129,0,0,0,28,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,66,0,0,0,53,0,0,0,6,0,0,0,54,0,0,0,45,0,0,0,14,0,0,0,2,0,0,0,24,0,0,0,11,0,0,0,46,0,0,0,37,0,0,0,38,0,0,0,2,0,0,0,32,0,0,0,11,0,0,0,34,0,0,0,25,0,0,0,8,0,0,0,55,0,0,0,56,0,0,0,33,0,0,0,39,0,0,0,57,0,0,0,34,0,0,0,3,0,0,0,0,0,0,0,50,53,98,116,67,111,110,118,101,120,84,114,105,97,110,103,108,101,77,101,115,104,83,104,97,112,101,0,0,0,0,0,224,81,0,0,32,42,0,0,184,62,0,0,0,0,0,0,67,111,110,118,101,120,84,114,105,109,101,115,104,0,0,0,0,0,0,0,152,42,0,0,130,0,0,0,131,0,0,0,35,0,0,0,0,0,0,0,50,54,76,111,99,97,108,83,117,112,112,111,114,116,86,101,114,116,101,120,67,97,108,108,98,97,99,107,0,0,0,0,224,81,0,0,120,42,0,0,136,67,0,0,0,0,0,0,0,0,0,0,248,43,0,0,132,0,0,0,133,0,0,0,36,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,67,0,0,0,22,0,0,0,7,0,0,0,58,0,0,0,68,0,0,0,15,0,0,0,2,0,0,0,59,0,0,0,20,0,0,0,46,0,0,0,40,0,0,0,41,0,0,0,2,0,0,0,37,0,0,0,11,0,0,0,34,0,0,0,25,0,0,0,5,0,0,0,0,0,0,0,32,44,0,0,134,0,0,0,135,0,0,0,36,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,67,0,0,0,22,0,0,0,7,0,0,0,60,0,0,0,68,0,0,0,15,0,0,0,2,0,0,0,59,0,0,0,20,0,0,0,46,0,0,0,40,0,0,0,42,0,0,0,2,0,0,0,38,0,0,0,11,0,0,0,34,0,0,0,25,0,0,0,6,0,0,0,0,0,0,0,72,44,0,0,136,0,0,0,137,0,0,0,36,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,67,0,0,0,22,0,0,0,7,0,0,0,61,0,0,0,68,0,0,0,15,0,0,0,2,0,0,0,59,0,0,0,20,0,0,0,46,0,0,0,40,0,0,0,43,0,0,0,2,0,0,0,39,0,0,0,11,0,0,0,34,0,0,0,25,0,0,0,7,0,0,0,49,53,98,116,67,121,108,105,110,100,101,114,83,104,97,112,101,0,0,0,0,0,0,0,224,81,0,0,224,43,0,0,104,41,0,0,0,0,0,0,49,54,98,116,67,121,108,105,110,100,101,114,83,104,97,112,101,88,0,0,0,0,0,0,224,81,0,0,8,44,0,0,248,43,0,0,0,0,0,0,49,54,98,116,67,121,108,105,110,100,101,114,83,104,97,112,101,90,0,0,0,0,0,0,224,81,0,0,48,44,0,0,248,43,0,0,0,0,0,0,67,121,108,105,110,100,101,114,90,0,0,0,0,0,0,0,67,121,108,105,110,100,101,114,88,0,0,0,0,0,0,0,98,116,67,121,108,105,110,100,101,114,83,104,97,112,101,68,97,116,97,0,0,0,0,0,67,121,108,105,110,100,101,114,89,0,0,0,0,0,0,0,0,0,0,0,248,44,0,0,138,0,0,0,139,0,0,0,2,0,0,0,44,0,0,0,3,0,0,0,40,0,0,0,3,0,0,0,41,0,0,0,69,0,0,0,62,0,0,0,63,0,0,0,45,0,0,0,70,0,0,0,140,0,0,0,49,54,98,116,68,98,118,116,66,114,111,97,100,112,104,97,115,101,0,0,0,0,0,0,224,81,0,0,224,44,0,0,48,20,0,0,0,0,0,0,0,0,0,0,72,45,0,0,141,0,0,0,142,0,0,0,28,0,0,0,71,0,0,0,5,0,0,0,16,0,0,0,17,0,0,0,0,0,0,0,50,48,66,114,111,97,100,112,104,97,115,101,65,97,98,98,84,101,115,116,101,114,0,0,224,81,0,0,48,45,0,0,64,35,0,0,0,0,0,0,0,0,0,0,152,45,0,0,143,0,0,0,144,0,0,0,28,0,0,0,72,0,0,0,5,0,0,0,16,0,0,0,17,0,0,0,0,0,0,0,49,57,66,114,111,97,100,112,104,97,115,101,82,97,121,84,101,115,116,101,114,0,0,0,224,81,0,0,128,45,0,0,64,35,0,0,0,0,0,0,0,0,0,0,232,45,0,0,145,0,0,0,146,0,0,0,46,0,0,0,73,0,0,0,5,0,0,0,16,0,0,0,17,0,0,0,0,0,0,0,49,56,98,116,68,98,118,116,84,114,101,101,67,111,108,108,105,100,101,114,0,0,0,0,224,81,0,0,208,45,0,0,64,35,0,0,0,0,0,0,0,0,0,0,104,46,0,0,147,0,0,0,148,0,0,0,64,0,0,0,65,0,0,0,21,0,0,0,66,0,0,0,51,49,98,116,68,101,102,97,117,108,116,67,111,108,108,105,115,105,111,110,67,111,110,102,105,103,117,114,97,116,105,111,110,0,0,0,0,0,0,0,50,52,98,116,67,111,108,108,105,115,105,111,110,67,111,110,102,105,103,117,114,97,116,105,111,110,0,0,0,0,0,0,184,81,0,0,64,46,0,0,224,81,0,0,24,46,0,0,96,46,0,0,0,0,0,0,0,0,0,0,240,46,0,0,149,0,0,0,150,0,0,0,5,0,0,0,0,0,0,0,78,51,49,98,116,67,111,110,118,101,120,80,108,97,110,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,49,48,67,114,101,97,116,101,70,117,110,99,69,0,51,48,98,116,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,67,114,101,97,116,101,70,117,110,99,0,0,0,0,0,0,0,0,184,81,0,0,192,46,0,0,224,81,0,0,144,46,0,0,232,46,0,0,0,0,0,0,0,0,0,0,72,47,0,0,151,0,0,0,152,0,0,0,6,0,0,0,0,0,0,0,78,50,54,98,116,66,111,120,66,111,120,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,49,48,67,114,101,97,116,101,70,117,110,99,69,0,0,0,0,0,0,224,81,0,0,24,47,0,0,232,46,0,0,0,0,0,0,0,0,0,0,168,47,0,0,153,0,0,0,154,0,0,0,7,0,0,0,0,0,0,0,78,51,52,98,116,83,112,104,101,114,101,84,114,105,97,110,103,108,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,49,48,67,114,101,97,116,101,70,117,110,99,69,0,0,0,0,0,0,224,81,0,0,112,47,0,0,232,46,0,0,0,0,0,0,0,0,0,0,8,48,0,0,155,0,0,0,156,0,0,0,8,0,0,0,0,0,0,0,78,51,50,98,116,83,112,104,101,114,101,83,112,104,101,114,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,49,48,67,114,101,97,116,101,70,117,110,99,69,0,0,0,0,0,0,0,0,224,81,0,0,208,47,0,0,232,46,0,0,0,0,0,0,0,0,0,0,88,48,0,0,157,0,0,0,158,0,0,0,9,0,0,0,0,0,0,0,78,49,54,98,116,69,109,112,116,121,65,108,103,111,114,105,116,104,109,49,48,67,114,101,97,116,101,70,117,110,99,69,0,0,0,0,0,0,0,0,224,81,0,0,48,48,0,0,232,46,0,0,0,0,0,0,0,0,0,0,184,48,0,0,159,0,0,0,160,0,0,0,10,0,0,0,0,0,0,0,78,50,56,98,116,67,111,109,112,111,117,110,100,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,49,55,83,119,97,112,112,101,100,67,114,101,97,116,101,70,117,110,99,69,0,0,0,0,0,224,81,0,0,128,48,0,0,232,46,0,0,0,0,0,0,0,0,0,0,24,49,0,0,161,0,0,0,162,0,0,0,11,0,0,0,0,0,0,0,78,51,54,98,116,67,111,109,112,111,117,110,100,67,111,109,112,111,117,110,100,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,49,48,67,114,101,97,116,101,70,117,110,99,69,0,0,0,0,224,81,0,0,224,48,0,0,232,46,0,0,0,0,0,0,0,0,0,0,112,49,0,0,163,0,0,0,164,0,0,0,12,0,0,0,0,0,0,0,78,50,56,98,116,67,111,109,112,111,117,110,100,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,49,48,67,114,101,97,116,101,70,117,110,99,69,0,0,0,0,224,81,0,0,64,49,0,0,232,46,0,0,0,0,0,0,0,0,0,0,216,49,0,0,165,0,0,0,166,0,0,0,13,0,0,0,0,0,0,0,78,51,51,98,116,67,111,110,118,101,120,67,111,110,99,97,118,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,49,55,83,119,97,112,112,101,100,67,114,101,97,116,101,70,117,110,99,69,0,0,0,0,0,0,0,0,224,81,0,0,152,49,0,0,232,46,0,0,0,0,0,0,0,0,0,0,56,50,0,0,167,0,0,0,168,0,0,0,14,0,0,0,0,0,0,0,78,51,51,98,116,67,111,110,118,101,120,67,111,110,99,97,118,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,49,48,67,114,101,97,116,101,70,117,110,99,69,0,0,0,0,0,0,0,224,81,0,0,0,50,0,0,232,46,0,0,0,0,0,0,49,50,98,116,68,105,115,112,97,116,99,104,101,114,0,0,184,81,0,0,72,50,0,0,0,0,0,0,184,50,0,0,169,0,0,0,170,0,0,0,4,0,0,0,1,0,0,0,74,0,0,0,0,0,0,0,49,54,98,116,69,109,112,116,121,65,108,103,111,114,105,116,104,109,0,0,0,0,0,0,50,48,98,116,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,0,0,184,81,0,0,152,50,0,0,224,81,0,0,128,50,0,0,176,50,0,0,0,0,0,0,0,0,0,0,56,51,0,0,18,0,0,0,171,0,0,0,172,0,0,0,35,0,0,0,67,0,0,0,22,0,0,0,75,0,0,0,47,0,0,0,42,0,0,0,0,0,0,0,0,0,0,0,104,51,0,0,18,0,0,0,173,0,0,0,174,0,0,0,35,0,0,0,67,0,0,0,22,0,0,0,75,0,0,0,48,0,0,0,43,0,0,0,0,0,0,0,49,51,98,116,71,104,111,115,116,79,98,106,101,99,116,0,224,81,0,0,40,51,0,0,160,27,0,0,0,0,0,0,50,52,98,116,80,97,105,114,67,97,99,104,105,110,103,71,104,111,115,116,79,98,106,101,99,116,0,0,0,0,0,0,224,81,0,0,72,51,0,0,56,51,0,0,0,0,0,0,0,0,0,0,168,51,0,0,175,0,0,0,176,0,0,0,2,0,0,0,0,0,0,0,49,53,98,116,71,106,107,67,111,110,118,101,120,67,97,115,116,0,0,0,0,0,0,0,224,81,0,0,144,51,0,0,120,40,0,0,0,0,0,0,0,0,0,0,40,52,0,0,177,0,0,0,178,0,0,0,1,0,0,0,0,0,0,0,51,48,98,116,71,106,107,69,112,97,80,101,110,101,116,114,97,116,105,111,110,68,101,112,116,104,83,111,108,118,101,114,0,0,0,0,0,0,0,0,51,48,98,116,67,111,110,118,101,120,80,101,110,101,116,114,97,116,105,111,110,68,101,112,116,104,83,111,108,118,101,114,0,0,0,0,0,0,0,0,184,81,0,0,248,51,0,0,224,81,0,0,208,51,0,0,32,52,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,168,52,0,0,179,0,0,0,180,0,0,0,5,0,0,0,0,0,0,0,49,55,98,116,71,106,107,80,97,105,114,68,101,116,101,99,116,111,114,0,0,0,0,0,51,54,98,116,68,105,115,99,114,101,116,101,67,111,108,108,105,115,105,111,110,68,101,116,101,99,116,111,114,73,110,116,101,114,102,97,99,101,0,0,184,81,0,0,120,52,0,0,224,81,0,0,96,52,0,0,160,52,0,0,0,0,0,0,0,0,0,0,240,52,0,0,181,0,0,0,182,0,0,0,26,0,0,0,27,0,0,0,5,0,0,0,0,0,0,0,49,54,98,116,77,97,110,105,102,111,108,100,82,101,115,117,108,116,0,0,0,0,0,0,224,81,0,0,216,52,0,0,80,40,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40,57,0,0,183,0,0,0,184,0,0,0,2,0,0,0,0,0,0,0,51,51,98,116,77,105,110,107,111,119,115,107,105,80,101,110,101,116,114,97,116,105,111,110,68,101,112,116,104,83,111,108,118,101,114,0,0,0,0,0,224,81,0,0,0,57,0,0,32,52,0,0,0,0,0,0,0,0,0,0,8,58,0,0,185,0,0,0,186,0,0,0,49,0,0,0,50,0,0,0,6,0,0,0,0,0,0,0,90,78,51,51,98,116,77,105,110,107,111,119,115,107,105,80,101,110,101,116,114,97,116,105,111,110,68,101,112,116,104,83,111,108,118,101,114,49,50,99,97,108,99,80,101,110,68,101,112,116,104,69,82,50,50,98,116,86,111,114,111,110,111,105,83,105,109,112,108,101,120,83,111,108,118,101,114,80,75,49,51,98,116,67,111,110,118,101,120,83,104,97,112,101,83,52,95,82,75,49,49,98,116,84,114,97,110,115,102,111,114,109,83,55,95,82,57,98,116,86,101,99,116,111,114,51,83,57,95,83,57,95,80,49,50,98,116,73,68,101,98,117,103,68,114,97,119,69,50,48,98,116,73,110,116,101,114,109,101,100,105,97,116,101,82,101,115,117,108,116,0,0,0,0,0,0,224,81,0,0,88,57,0,0,80,40,0,0,0,0,0,0,0,0,0,0,88,58,0,0,187,0,0,0,188,0,0,0,15,0,0,0,68,0,0,0,23,0,0,0,76,0,0,0,77,0,0,0,16,0,0,0,49,52,98,116,79,112,116,105,109,105,122,101,100,66,118,104,0,0,0,0,0,0,0,0,224,81,0,0,64,58,0,0,112,63,0,0,0,0,0,0,0,0,0,0,224,58,0,0,189,0,0,0,190,0,0,0,44,0,0,0,0,0,0,0,90,78,49,52,98,116,79,112,116,105,109,105,122,101,100,66,118,104,53,98,117,105,108,100,69,80,50,51,98,116,83,116,114,105,100,105,110,103,77,101,115,104,73,110,116,101,114,102,97,99,101,98,82,75,57,98,116,86,101,99,116,111,114,51,83,52,95,69,50,48,78,111,100,101,84,114,105,97,110,103,108,101,67,97,108,108,98,97,99,107,95,48,0,0,0,0,224,81,0,0,128,58,0,0,136,67,0,0,0,0,0,0,0,0,0,0,112,59,0,0,191,0,0,0,192,0,0,0,45,0,0,0,0,0,0,0,90,78,49,52,98,116,79,112,116,105,109,105,122,101,100,66,118,104,53,98,117,105,108,100,69,80,50,51,98,116,83,116,114,105,100,105,110,103,77,101,115,104,73,110,116,101,114,102,97,99,101,98,82,75,57,98,116,86,101,99,116,111,114,51,83,52,95,69,50,57,81,117,97,110,116,105,122,101,100,78,111,100,101,84,114,105,97,110,103,108,101,67,97,108,108,98,97,99,107,0,0,0,0,0,224,81,0,0,8,59,0,0,136,67,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,60,0,0,193,0,0,0,194,0,0,0,24,0,0,0,17,0,0,0,51,0,0,0,69,0,0,0,70,0,0,0,71,0,0,0,52,0,0,0,72,0,0,0,53,0,0,0,78,0,0,0,54,0,0,0,25,0,0,0,73,0,0,0,79,0,0,0,80,0,0,0,0,0,0,0,50,56,98,116,72,97,115,104,101,100,79,118,101,114,108,97,112,112,105,110,103,80,97,105,114,67,97,99,104,101,0,0,224,81,0,0,240,59,0,0,32,21,0,0,0,0,0,0,0,0,0,0,192,60,0,0,195,0,0,0,196,0,0,0,19,0,0,0,0,0,0,0,90,78,50,56,98,116,72,97,115,104,101,100,79,118,101,114,108,97,112,112,105,110,103,80,97,105,114,67,97,99,104,101,51,55,114,101,109,111,118,101,79,118,101,114,108,97,112,112,105,110,103,80,97,105,114,115,67,111,110,116,97,105,110,105,110,103,80,114,111,120,121,69,80,49,55,98,116,66,114,111,97,100,112,104,97,115,101,80,114,111,120,121,80,49,50,98,116,68,105,115,112,97,116,99,104,101,114,69,49,56,82,101,109,111,118,101,80,97,105,114,67,97,108,108,98,97,99,107,0,0,0,0,0,0,0,0,224,81,0,0,56,60,0,0,80,27,0,0,0,0,0,0,0,0,0,0,88,61,0,0,197,0,0,0,198,0,0,0,20,0,0,0,0,0,0,0,90,78,50,56,98,116,72,97,115,104,101,100,79,118,101,114,108,97,112,112,105,110,103,80,97,105,114,67,97,99,104,101,49,57,99,108,101,97,110,80,114,111,120,121,70,114,111,109,80,97,105,114,115,69,80,49,55,98,116,66,114,111,97,100,112,104,97,115,101,80,114,111,120,121,80,49,50,98,116,68,105,115,112,97,116,99,104,101,114,69,49,55,67,108,101,97,110,80,97,105,114,67,97,108,108,98,97,99,107,0,0,0,224,81,0,0,232,60,0,0,80,27,0,0,0,0,0,0,10,215,163,60,0,0,0,0,0,0,0,0,128,62,0,0,199,0,0,0,200,0,0,0,26,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,81,0,0,0,22,0,0,0,6,0,0,0,1,0,0,0,45,0,0,0,14,0,0,0,2,0,0,0,24,0,0,0,11,0,0,0,46,0,0,0,23,0,0,0,55,0,0,0,2,0,0,0,46,0,0,0,11,0,0,0,34,0,0,0,25,0,0,0,8,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,50,51,98,116,80,111,108,121,104,101,100,114,97,108,67,111,110,118,101,120,83,104,97,112,101,0,0,0,0,0,0,0,224,81,0,0,96,62,0,0,104,41,0,0,0,0,0,0,51,52,98,116,80,111,108,121,104,101,100,114,97,108,67,111,110,118,101,120,65,97,98,98,67,97,99,104,105,110,103,83,104,97,112,101,0,0,0,0,224,81,0,0,144,62,0,0,128,62,0,0,0,0,0,0,0,0,0,0,112,63,0,0,201,0,0,0,202,0,0,0,15,0,0,0,68,0,0,0,23,0,0,0,76,0,0,0,77,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,98,116,79,112,116,105,109,105,122,101,100,66,118,104,78,111,100,101,68,97,116,97,0,0,98,116,81,117,97,110,116,105,122,101,100,66,118,104,78,111,100,101,68,97,116,97,0,0,98,116,66,118,104,83,117,98,116,114,101,101,73,110,102,111,68,97,116,97,0,0,0,0,98,116,81,117,97,110,116,105,122,101,100,66,118,104,70,108,111,97,116,68,97,116,97,0,49,52,98,116,81,117,97,110,116,105,122,101,100,66,118,104,0,0,0,0,0,0,0,0,184,81,0,0,88,63,0,0,0,0,0,0,224,63,0,0,203,0,0,0,204,0,0,0,23,0,0,0,1,0,0,0,50,53,98,116,84,114,105,97,110,103,108,101,82,97,121,99,97,115,116,67,97,108,108,98,97,99,107,0,0,0,0,0,224,81,0,0,144,63,0,0,88,67,0,0,0,0,0,0,50,56,98,116,84,114,105,97,110,103,108,101,67,111,110,118,101,120,99,97,115,116,67,97,108,108,98,97,99,107,0,0,224,81,0,0,192,63,0,0,88,67,0,0,0,0,0,0,0,0,0,0,144,64,0,0,205,0,0,0,206,0,0,0,47,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,81,0,0,0,22,0,0,0,8,0,0,0,74,0,0,0,45,0,0,0,14,0,0,0,2,0,0,0,24,0,0,0,11,0,0,0,46,0,0,0,23,0,0,0,56,0,0,0,2,0,0,0,48,0,0,0,11,0,0,0,75,0,0,0,57,0,0,0,8,0,0,0,76,0,0,0,77,0,0,0,49,0,0,0,58,0,0,0,78,0,0,0,50,0,0,0,4,0,0,0,51,0,0,0,49,53,98,116,84,114,105,97,110,103,108,101,83,104,97,112,101,0,0,0,0,0,0,0,224,81,0,0,120,64,0,0,128,62,0,0,0,0,0,0,84,114,105,97,110,103,108,101,0,0,0,0,0,0,0,0,0,0,0,0,24,65,0,0,207,0,0,0,208,0,0,0,59,0,0,0,82,0,0,0,105,115,108,97,110,100,85,110,105,111,110,70,105,110,100,65,110,100,81,117,105,99,107,83,111,114,116,0,0,0,0,0,112,114,111,99,101,115,115,73,115,108,97,110,100,115,0,0,50,53,98,116,83,105,109,117,108,97,116,105,111,110,73,115,108,97,110,100,77,97,110,97,103,101,114,0,0,0,0,0,184,81,0,0,248,64,0,0,0,0,0,0,152,65,0,0,209,0,0,0,210,0,0,0,52,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,81,0,0,0,22,0,0,0,9,0,0,0,79,0,0,0,45,0,0,0,16,0,0,0,8,0,0,0,24,0,0,0,11,0,0,0,46,0,0,0,60,0,0,0,61,0,0,0,2,0,0,0,53,0,0,0,11,0,0,0,34,0,0,0,25,0,0,0,0,0,0,0,49,51,98,116,83,112,104,101,114,101,83,104,97,112,101,0,224,81,0,0,136,65,0,0,104,41,0,0,0,0,0,0,0,0,0,0,240,65,0,0,211,0,0,0,212,0,0,0,6,0,0,0,2,0,0,0,83,0,0,0,0,0,0,0,51,50,98,116,83,112,104,101,114,101,83,112,104,101,114,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,0,0,0,0,0,0,224,81,0,0,200,65,0,0,208,69,0,0,0,0,0,0,0,0,0,0,72,66,0,0,213,0,0,0,214,0,0,0,7,0,0,0,3,0,0,0,84,0,0,0,0,0,0,0,51,52,98,116,83,112,104,101,114,101,84,114,105,97,110,103,108,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,0,0,0,0,224,81,0,0,32,66,0,0,208,69,0,0,0,0,0,0,0,0,0,0,192,66,0,0,215,0,0,0,216,0,0,0,54,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,85,0,0,0,80,0,0,0,10,0,0,0,81,0,0,0,45,0,0,0,10,0,0,0,3,0,0,0,82,0,0,0,26,0,0,0,46,0,0,0,55,0,0,0,0,0,0,0,49,56,98,116,83,116,97,116,105,99,80,108,97,110,101,83,104,97,112,101,0,0,0,0,224,81,0,0,168,66,0,0,232,71,0,0,0,0,0,0,98,116,83,116,97,116,105,99,80,108,97,110,101,83,104,97,112,101,68,97,116,97,0,0,83,84,65,84,73,67,80,76,65,78,69,0,0,0,0,0,0,0,0,0,48,67,0,0,217,0,0,0,218,0,0,0,3,0,0,0,0,0,0,0,50,50,98,116,83,117,98,115,105,109,112,108,101,120,67,111,110,118,101,120,67,97,115,116,0,0,0,0,0,0,0,0,224,81,0,0,16,67,0,0,120,40,0,0,0,0,0,0,49,56,98,116,84,114,105,97,110,103,108,101,67,97,108,108,98,97,99,107,0,0,0,0,184,81,0,0,64,67,0,0,51,49,98,116,73,110,116,101,114,110,97,108,84,114,105,97,110,103,108,101,73,110,100,101,120,67,97,108,108,98,97,99,107,0,0,0,0,0,0,0,184,81,0,0,96,67,0,0,0,0,0,0,240,67,0,0,219,0,0,0,220,0,0,0,56,0,0,0,1,0,0,0,2,0,0,0,86,0,0,0,87,0,0,0,83,0,0,0,88,0,0,0,89,0,0,0,84,0,0,0,62,0,0,0,63,0,0,0,85,0,0,0,27,0,0,0,0,0,0,0,49,52,98,116,84,114,105,97,110,103,108,101,77,101,115,104,0,0,0,0,0,0,0,0,224,81,0,0,216,67,0,0,32,78,0,0,0,0,0,0,0,0,0,0,112,68,0,0,221,0,0,0,222,0,0,0,14,0,0,0,12,0,0,0,1,0,0,0,1,0,0,0,90,0,0,0,29,0,0,0,2,0,0,0,86,0,0,0,45,0,0,0,10,0,0,0,3,0,0,0,87,0,0,0,28,0,0,0,46,0,0,0,57,0,0,0,18,0,0,0,19,0,0,0,0,0,0,0,49,57,98,116,84,114,105,97,110,103,108,101,77,101,115,104,83,104,97,112,101,0,0,0,224,81,0,0,88,68,0,0,232,71,0,0,0,0,0,0,84,82,73,65,78,71,76,69,77,69,83,72,0,0,0,0,0,0,0,0,192,68,0,0,223,0,0,0,224,0,0,0,58,0,0,0,0,0,0,0,50,49,83,117,112,112,111,114,116,86,101,114,116,101,120,67,97,108,108,98,97,99,107,0,224,81,0,0,168,68,0,0,88,67,0,0,0,0,0,0,0,0,0,0,80,69,0,0,225,0,0,0,226,0,0,0,59,0,0,0,0,0,0,0,90,78,75,49,57,98,116,84,114,105,97,110,103,108,101,77,101,115,104,83,104,97,112,101,49,57,112,114,111,99,101,115,115,65,108,108,84,114,105,97,110,103,108,101,115,69,80,49,56,98,116,84,114,105,97,110,103,108,101,67,97,108,108,98,97,99,107,82,75,57,98,116,86,101,99,116,111,114,51,83,52,95,69,49,54,70,105,108,116,101,114,101,100,67,97,108,108,98,97,99,107,0,0,0,224,81,0,0,232,68,0,0,136,67,0,0,0,0,0,0,0,0,0,0,152,69,0,0,227,0,0,0,228,0,0,0,8,0,0,0,0,0,0,0,50,50,83,112,104,101,114,101,84,114,105,97,110,103,108,101,68,101,116,101,99,116,111,114,0,0,0,0,0,0,0,0,224,81,0,0,120,69,0,0,160,52,0,0,0,0,0,0,51,48,98,116,65,99,116,105,118,97,116,105,110,103,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,0,0,0,0,0,0,0,0,224,81,0,0,168,69,0,0,176,50,0,0,0,0,0,0,0,0,0,0,32,70,0,0,229,0,0,0,230,0,0,0,9,0,0,0,4,0,0,0,91,0,0,0,0,0,0,0,50,54,98,116,66,111,120,66,111,120,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,0,0,0,0,224,81,0,0,0,70,0,0,208,69,0,0,0,0,0,0,0,0,0,0,96,70,0,0,231,0,0,0,232,0,0,0,10,0,0,0,0,0,0,0,49,54,98,116,66,111,120,66,111,120,68,101,116,101,99,116,111,114,0,0,0,0,0,0,224,81,0,0,72,70,0,0,160,52,0,0,0,0,0,0,0,0,0,0,176,70,0,0,233,0,0,0,234,0,0,0,11,0,0,0,5,0,0,0,92,0,0,0,0,0,0,0,50,56,98,116,67,111,109,112,111,117,110,100,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,0,0,224,81,0,0,144,70,0,0,208,69,0,0,0,0,0,0,0,0,0,0,8,71,0,0,235,0,0,0,236,0,0,0,28,0,0,0,93,0,0,0,5,0,0,0,16,0,0,0,17,0,0,0,0,0,0,0,50,50,98,116,67,111,109,112,111,117,110,100,76,101,97,102,67,97,108,108,98,97,99,107,0,0,0,0,0,0,0,0,224,81,0,0,232,70,0,0,64,35,0,0,0,0,0,0,0,0,0,0,96,71,0,0,237,0,0,0,238,0,0,0,12,0,0,0,6,0,0,0,94,0,0,0,0,0,0,0,51,54,98,116,67,111,109,112,111,117,110,100,67,111,109,112,111,117,110,100,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,0,0,224,81,0,0,56,71,0,0,208,69,0,0,0,0,0,0,0,0,0,0,192,71,0,0,239,0,0,0,240,0,0,0,64,0,0,0,95,0,0,0,5,0,0,0,16,0,0,0,17,0,0,0,0,0,0,0,51,48,98,116,67,111,109,112,111,117,110,100,67,111,109,112,111,117,110,100,76,101,97,102,67,97,108,108,98,97,99,107,0,0,0,0,0,0,0,0,224,81,0,0,152,71,0,0,64,35,0,0,0,0,0,0,49,52,98,116,67,111,110,99,97,118,101,83,104,97,112,101,0,0,0,0,0,0,0,0,224,81,0,0,208,71,0,0,216,27,0,0,0,0,0,0,0,0,0,0,88,72,0,0,241,0,0,0,242,0,0,0,13,0,0,0,7,0,0,0,96,0,0,0,0,0,0,0,0,0,0,0,136,72,0,0,243,0,0,0,244,0,0,0,60,0,0,0,0,0,0,0,51,51,98,116,67,111,110,118,101,120,67,111,110,99,97,118,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,0,0,0,0,0,224,81,0,0,48,72,0,0,208,69,0,0,0,0,0,0,50,52,98,116,67,111,110,118,101,120,84,114,105,97,110,103,108,101,67,97,108,108,98,97,99,107,0,0,0,0,0,0,224,81,0,0,104,72,0,0,88,67,0,0,0,0,0,0,0,0,0,0,80,73,0,0,245,0,0,0,246,0,0,0,61,0,0,0,0,0,0,0,90,78,51,51,98,116,67,111,110,118,101,120,67,111,110,99,97,118,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,50,49,99,97,108,99,117,108,97,116,101,84,105,109,101,79,102,73,109,112,97,99,116,69,80,49,55,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,83,49,95,82,75,49,54,98,116,68,105,115,112,97,116,99,104,101,114,73,110,102,111,80,49,54,98,116,77,97,110,105,102,111,108,100,82,101,115,117,108,116,69,51,49,76,111,99,97,108,84,114,105,97,110,103,108,101,83,112,104,101,114,101,67,97,115,116,67,97,108,108,98,97,99,107,0,0,0,224,81,0,0,176,72,0,0,88,67,0,0,0,0,0,0,0,0,0,0,240,73,0,0,247,0,0,0,248,0,0,0,18,0,0,0,0,0,0,0,0,0,0,0,184,73,0,0,249,0,0,0,250,0,0,0,14,0,0,0,8,0,0,0,97,0,0,0,0,0,0,0,50,51,98,116,67,111,110,118,101,120,67,111,110,118,101,120,65,108,103,111,114,105,116,104,109,0,0,0,0,0,0,0,224,81,0,0,152,73,0,0,208,69,0,0,0,0,0,0,78,50,51,98,116,67,111,110,118,101,120,67,111,110,118,101,120,65,108,103,111,114,105,116,104,109,49,48,67,114,101,97,116,101,70,117,110,99,69,0,224,81,0,0,200,73,0,0,232,46,0,0,0,0,0,0,0,0,0,0,64,74,0,0,251,0,0,0,252,0,0,0,26,0,0,0,27,0,0,0,7,0,0,0,0,0,0,0,50,52,98,116,80,101,114,116,117,114,98,101,100,67,111,110,116,97,99,116,82,101,115,117,108,116,0,0,0,0,0,0,224,81,0,0,32,74,0,0,240,52,0,0,0,0,0,0,0,0,0,0,0,75,0,0,253,0,0,0,254,0,0,0,65,0,0,0,66,0,0,0,8,0,0,0,0,0,0,0,90,78,50,51,98,116,67,111,110,118,101,120,67,111,110,118,101,120,65,108,103,111,114,105,116,104,109,49,54,112,114,111,99,101,115,115,67,111,108,108,105,115,105,111,110,69,80,75,50,52,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,87,114,97,112,112,101,114,83,50,95,82,75,49,54,98,116,68,105,115,112,97,116,99,104,101,114,73,110,102,111,80,49,54,98,116,77,97,110,105,102,111,108,100,82,101,115,117,108,116,69,50,49,98,116,87,105,116,104,111,117,116,77,97,114,103,105,110,82,101,115,117,108,116,95,48,0,0,224,81,0,0,112,74,0,0,80,40,0,0,0,0,0,0,0,0,0,0,184,75,0,0,255,0,0,0,0,1,0,0,67,0,0,0,68,0,0,0,9,0,0,0,0,0,0,0,90,78,50,51,98,116,67,111,110,118,101,120,67,111,110,118,101,120,65,108,103,111,114,105,116,104,109,49,54,112,114,111,99,101,115,115,67,111,108,108,105,115,105,111,110,69,80,75,50,52,98,116,67,111,108,108,105,115,105,111,110,79,98,106,101,99,116,87,114,97,112,112,101,114,83,50,95,82,75,49,54,98,116,68,105,115,112,97,116,99,104,101,114,73,110,102,111,80,49,54,98,116,77,97,110,105,102,111,108,100,82,101,115,117,108,116,69,49,51,98,116,68,117,109,109,121,82,101,115,117,108,116,0,0,0,0,224,81,0,0,48,75,0,0,80,40,0,0,0,0,0,0,0,0,0,0,16,76,0,0,1,1,0,0,2,1,0,0,15,0,0,0,9,0,0,0,98,0,0,0,0,0,0,0,51,49,98,116,67,111,110,118,101,120,80,108,97,110,101,67,111,108,108,105,115,105,111,110,65,108,103,111,114,105,116,104,109,0,0,0,0,0,0,0,224,81,0,0,232,75,0,0,176,50,0,0,0,0,0,0,0,0,0,0,72,76,0,0,3,1,0,0,4,1,0,0,49,56,98,116,67,111,110,118,101,120,80,111,108,121,104,101,100,114,111,110,0,0,0,0,184,81,0,0,48,76,0,0,2,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,200,76,0,0,5,1,0,0,6,1,0,0,29,0,0,0,30,0,0,0,88,0,0,0,0,0,0,0,50,51,98,116,72,97,115,104,101,100,83,105,109,112,108,101,80,97,105,114,67,97,99,104,101,0,0,0,0,0,0,0,184,81,0,0,168,76,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,98,116,73,110,116,73,110,100,101,120,68,97,116,97,0,0,98,116,83,104,111,114,116,73,110,116,73,110,100,101,120,84,114,105,112,108,101,116,68,97,116,97,0,0,0,0,0,0,98,116,67,104,97,114,73,110,100,101,120,84,114,105,112,108,101,116,68,97,116,97,0,0,98,116,86,101,99,116,111,114,51,70,108,111,97,116,68,97,116,97,0,0,0,0,0,0,98,116,86,101,99,116,111,114,51,68,111,117,98,108,101,68,97,116,97,0,0,0,0,0,98,116,77,101,115,104,80,97,114,116,68,97,116,97,0,0,98,116,83,116,114,105,100,105,110,103,77,101,115,104,73,110,116,101,114,102,97,99,101,68,97,116,97,0,0,0,0,0,50,51,98,116,83,116,114,105,100,105,110,103,77,101,115,104,73,110,116,101,114,102,97,99,101,0,0,0,0,0,0,0,184,81,0,0,144,77,0,0,0,0,0,0,32,78,0,0,7,1,0,0,8,1,0,0,56,0,0,0,1,0,0,0,2,0,0,0,86,0,0,0,87,0,0,0,83,0,0,0,99,0,0,0,100,0,0,0,84,0,0,0,62,0,0,0,63,0,0,0,85,0,0,0,27,0,0,0,0,0,0,0,50,54,98,116,84,114,105,97,110,103,108,101,73,110,100,101,120,86,101,114,116,101,120,65,114,114,97,121,0,0,0,0,224,81,0,0,0,78,0,0,176,77,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,82,111,111,116,0,0,0,0,72,78,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,117,110,99,97,117,103,104,116,0,0,0,0,0,0,0,0,116,101,114,109,105,110,97,116,105,110,103,32,119,105,116,104,32,37,115,32,101,120,99,101,112,116,105,111,110,32,111,102,32,116,121,112,101,32,37,115,58,32,37,115,0,0,0,0,116,101,114,109,105,110,97,116,105,110,103,32,119,105,116,104,32,37,115,32,101,120,99,101,112,116,105,111,110,32,111,102,32,116,121,112,101,32,37,115,0,0,0,0,0,0,0,0,116,101,114,109,105,110,97,116,105,110,103,32,119,105,116,104,32,37,115,32,102,111,114,101,105,103,110,32,101,120,99,101,112,116,105,111,110,0,0,0,116,101,114,109,105,110,97,116,105,110,103,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,112,116,104,114,101,97,100,95,111,110,99,101,32,102,97,105,108,117,114,101,32,105,110,32,95,95,99,120,97,95,103,101,116,95,103,108,111,98,97,108,115,95,102,97,115,116,40,41,0,0,0,0,0,0,0,0,99,97,110,110,111,116,32,99,114,101,97,116,101,32,112,116,104,114,101,97,100,32,107,101,121,32,102,111,114,32,95,95,99,120,97,95,103,101,116,95,103,108,111,98,97,108,115,40,41,0,0,0,0,0,0,0,99,97,110,110,111,116,32,122,101,114,111,32,111,117,116,32,116,104,114,101,97,100,32,118,97,108,117,101,32,102,111,114,32,95,95,99,120,97,95,103,101,116,95,103,108,111,98,97,108,115,40,41,0,0,0,0,0,0,0,0,40,80,0,0,9,1,0,0,10,1,0,0,89],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE+10240);allocate([115,116,100,58,58,98,97,100,95,97,108,108,111,99,0,0,83,116,57,98,97,100,95,97,108,108,111,99,0,0,0,0,224,81,0,0,24,80,0,0,176,80,0,0,0,0,0,0,116,101,114,109,105,110,97,116,101,95,104,97,110,100,108,101,114,32,117,110,101,120,112,101,99,116,101,100,108,121,32,114,101,116,117,114,110,101,100,0,116,101,114,109,105,110,97,116,101,95,104,97,110,100,108,101,114,32,117,110,101,120,112,101,99,116,101,100,108,121,32,116,104,114,101,119,32,97,110,32,101,120,99,101,112,116,105,111,110,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,83,116,57,101,120,99,101,112,116,105,111,110,0,0,0,0,184,81,0,0,160,80,0,0,83,116,57,116,121,112,101,95,105,110,102,111,0,0,0,0,184,81,0,0,184,80,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,54,95,95,115,104,105,109,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,0,0,0,224,81,0,0,208,80,0,0,200,80,0,0,0,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,55,95,95,99,108,97,115,115,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,0,0,224,81,0,0,8,81,0,0,248,80,0,0,0,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,57,95,95,112,111,105,110,116,101,114,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,49,55,95,95,112,98,97,115,101,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,0,0,0,224,81,0,0,104,81,0,0,248,80,0,0,0,0,0,0,224,81,0,0,64,81,0,0,144,81,0,0,0,0,0,0,0,0,0,0,48,81,0,0,11,1,0,0,12,1,0,0,13,1,0,0,14,1,0,0,31,0,0,0,4,0,0,0,16,0,0,0,62,0,0,0,0,0,0,0,40,82,0,0,11,1,0,0,15,1,0,0,13,1,0,0,14,1,0,0,31,0,0,0,5,0,0,0,17,0,0,0,63,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,50,48,95,95,115,105,95,99,108,97,115,115,95,116,121,112,101,95,105,110,102,111,69,0,0,0,0,224,81,0,0,0,82,0,0,48,81,0,0,0,0,0,0,0,0,0,0,136,82,0,0,11,1,0,0,16,1,0,0,13,1,0,0,14,1,0,0,31,0,0,0,6,0,0,0,18,0,0,0,64,0,0,0,78,49,48,95,95,99,120,120,97,98,105,118,49,50,49,95,95,118,109,105,95,99,108,97,115,115,95,116,121,112,101,95,105,110,102,111,69,0,0,0,224,81,0,0,96,82,0,0,48,81,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE+20480);var tempDoublePtr=Runtime.alignMemory(allocate(12,"i8",ALLOC_STATIC),8);assert(tempDoublePtr%8==0);function copyTempFloat(ptr){HEAP8[tempDoublePtr]=HEAP8[ptr];HEAP8[tempDoublePtr+1]=HEAP8[ptr+1];HEAP8[tempDoublePtr+2]=HEAP8[ptr+2];HEAP8[tempDoublePtr+3]=HEAP8[ptr+3]}function copyTempDouble(ptr){HEAP8[tempDoublePtr]=HEAP8[ptr];HEAP8[tempDoublePtr+1]=HEAP8[ptr+1];HEAP8[tempDoublePtr+2]=HEAP8[ptr+2];HEAP8[tempDoublePtr+3]=HEAP8[ptr+3];HEAP8[tempDoublePtr+4]=HEAP8[ptr+4];HEAP8[tempDoublePtr+5]=HEAP8[ptr+5];HEAP8[tempDoublePtr+6]=HEAP8[ptr+6];HEAP8[tempDoublePtr+7]=HEAP8[ptr+7]}var _cosf=Math_cos;Module["_i64Subtract"]=_i64Subtract;var _fabsf=Math_abs;var ___errno_state=0;function ___setErrNo(value){HEAP32[___errno_state>>2]=value;return value}var ERRNO_CODES={EPERM:1,ENOENT:2,ESRCH:3,EINTR:4,EIO:5,ENXIO:6,E2BIG:7,ENOEXEC:8,EBADF:9,ECHILD:10,EAGAIN:11,EWOULDBLOCK:11,ENOMEM:12,EACCES:13,EFAULT:14,ENOTBLK:15,EBUSY:16,EEXIST:17,EXDEV:18,ENODEV:19,ENOTDIR:20,EISDIR:21,EINVAL:22,ENFILE:23,EMFILE:24,ENOTTY:25,ETXTBSY:26,EFBIG:27,ENOSPC:28,ESPIPE:29,EROFS:30,EMLINK:31,EPIPE:32,EDOM:33,ERANGE:34,ENOMSG:42,EIDRM:43,ECHRNG:44,EL2NSYNC:45,EL3HLT:46,EL3RST:47,ELNRNG:48,EUNATCH:49,ENOCSI:50,EL2HLT:51,EDEADLK:35,ENOLCK:37,EBADE:52,EBADR:53,EXFULL:54,ENOANO:55,EBADRQC:56,EBADSLT:57,EDEADLOCK:35,EBFONT:59,ENOSTR:60,ENODATA:61,ETIME:62,ENOSR:63,ENONET:64,ENOPKG:65,EREMOTE:66,ENOLINK:67,EADV:68,ESRMNT:69,ECOMM:70,EPROTO:71,EMULTIHOP:72,EDOTDOT:73,EBADMSG:74,ENOTUNIQ:76,EBADFD:77,EREMCHG:78,ELIBACC:79,ELIBBAD:80,ELIBSCN:81,ELIBMAX:82,ELIBEXEC:83,ENOSYS:38,ENOTEMPTY:39,ENAMETOOLONG:36,ELOOP:40,EOPNOTSUPP:95,EPFNOSUPPORT:96,ECONNRESET:104,ENOBUFS:105,EAFNOSUPPORT:97,EPROTOTYPE:91,ENOTSOCK:88,ENOPROTOOPT:92,ESHUTDOWN:108,ECONNREFUSED:111,EADDRINUSE:98,ECONNABORTED:103,ENETUNREACH:101,ENETDOWN:100,ETIMEDOUT:110,EHOSTDOWN:112,EHOSTUNREACH:113,EINPROGRESS:115,EALREADY:114,EDESTADDRREQ:89,EMSGSIZE:90,EPROTONOSUPPORT:93,ESOCKTNOSUPPORT:94,EADDRNOTAVAIL:99,ENETRESET:102,EISCONN:106,ENOTCONN:107,ETOOMANYREFS:109,EUSERS:87,EDQUOT:122,ESTALE:116,ENOTSUP:95,ENOMEDIUM:123,EILSEQ:84,EOVERFLOW:75,ECANCELED:125,ENOTRECOVERABLE:131,EOWNERDEAD:130,ESTRPIPE:86};function _sysconf(name){switch(name){case 30:return PAGE_SIZE;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 79:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:{if(typeof navigator==="object")return navigator["hardwareConcurrency"]||1;return 1}}___setErrNo(ERRNO_CODES.EINVAL);return-1}function __ZSt18uncaught_exceptionv(){return!!__ZSt18uncaught_exceptionv.uncaught_exception}var EXCEPTIONS={last:0,caught:[],infos:{},deAdjust:(function(adjusted){if(!adjusted||EXCEPTIONS.infos[adjusted])return adjusted;for(var ptr in EXCEPTIONS.infos){var info=EXCEPTIONS.infos[ptr];if(info.adjusted===adjusted){return ptr}}return adjusted}),addRef:(function(ptr){if(!ptr)return;var info=EXCEPTIONS.infos[ptr];info.refcount++}),decRef:(function(ptr){if(!ptr)return;var info=EXCEPTIONS.infos[ptr];assert(info.refcount>0);info.refcount--;if(info.refcount===0){if(info.destructor){Runtime.dynCall("vi",info.destructor,[ptr])}delete EXCEPTIONS.infos[ptr];___cxa_free_exception(ptr)}}),clearRef:(function(ptr){if(!ptr)return;var info=EXCEPTIONS.infos[ptr];info.refcount=0})};function ___resumeException(ptr){if(!EXCEPTIONS.last){EXCEPTIONS.last=ptr}EXCEPTIONS.clearRef(EXCEPTIONS.deAdjust(ptr));throw ptr+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}function ___cxa_find_matching_catch(){var thrown=EXCEPTIONS.last;if(!thrown){return(asm["setTempRet0"](0),0)|0}var info=EXCEPTIONS.infos[thrown];var throwntype=info.type;if(!throwntype){return(asm["setTempRet0"](0),thrown)|0}var typeArray=Array.prototype.slice.call(arguments);var pointer=Module["___cxa_is_pointer_type"](throwntype);if(!___cxa_find_matching_catch.buffer)___cxa_find_matching_catch.buffer=_malloc(4);HEAP32[___cxa_find_matching_catch.buffer>>2]=thrown;thrown=___cxa_find_matching_catch.buffer;for(var i=0;i<typeArray.length;i++){if(typeArray[i]&&Module["___cxa_can_catch"](typeArray[i],throwntype,thrown)){thrown=HEAP32[thrown>>2];info.adjusted=thrown;return(asm["setTempRet0"](typeArray[i]),thrown)|0}}thrown=HEAP32[thrown>>2];return(asm["setTempRet0"](throwntype),thrown)|0}function ___cxa_throw(ptr,type,destructor){EXCEPTIONS.infos[ptr]={ptr:ptr,adjusted:ptr,type:type,destructor:destructor,refcount:0};EXCEPTIONS.last=ptr;if(!("uncaught_exception"in __ZSt18uncaught_exceptionv)){__ZSt18uncaught_exceptionv.uncaught_exception=1}else{__ZSt18uncaught_exceptionv.uncaught_exception++}throw ptr+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}Module["_memset"]=_memset;function _abort(){Module["abort"]()}function _pthread_once(ptr,func){if(!_pthread_once.seen)_pthread_once.seen={};if(ptr in _pthread_once.seen)return;Runtime.dynCall("v",func);_pthread_once.seen[ptr]=1}var _acosf=Math_acos;Module["_strlen"]=_strlen;var _sqrtf=Math_sqrt;var FS=undefined;var SOCKFS=undefined;function _send(fd,buf,len,flags){var sock=SOCKFS.getSocket(fd);if(!sock){___setErrNo(ERRNO_CODES.EBADF);return-1}return _write(fd,buf,len)}function _pwrite(fildes,buf,nbyte,offset){var stream=FS.getStream(fildes);if(!stream){___setErrNo(ERRNO_CODES.EBADF);return-1}try{var slab=HEAP8;return FS.write(stream,slab,buf,nbyte,offset)}catch(e){FS.handleFSError(e);return-1}}function _write(fildes,buf,nbyte){var stream=FS.getStream(fildes);if(!stream){___setErrNo(ERRNO_CODES.EBADF);return-1}try{var slab=HEAP8;return FS.write(stream,slab,buf,nbyte)}catch(e){FS.handleFSError(e);return-1}}function _fileno(stream){stream=FS.getStreamFromPtr(stream);if(!stream)return-1;return stream.fd}function _fputc(c,stream){var chr=unSign(c&255);HEAP8[_fputc.ret>>0]=chr;var fd=_fileno(stream);var ret=_write(fd,_fputc.ret,1);if(ret==-1){var streamObj=FS.getStreamFromPtr(stream);if(streamObj)streamObj.error=true;return-1}else{return chr}}var PTHREAD_SPECIFIC={};function _pthread_getspecific(key){return PTHREAD_SPECIFIC[key]||0}Module["_i64Add"]=_i64Add;var PTHREAD_SPECIFIC_NEXT_KEY=1;function _pthread_key_create(key,destructor){if(key==0){return ERRNO_CODES.EINVAL}HEAP32[key>>2]=PTHREAD_SPECIFIC_NEXT_KEY;PTHREAD_SPECIFIC[PTHREAD_SPECIFIC_NEXT_KEY]=0;PTHREAD_SPECIFIC_NEXT_KEY++;return 0}var _llvm_pow_f32=Math_pow;function _fmod(x,y){return x%y}function _fmodf(){return _fmod.apply(null,arguments)}function _pthread_setspecific(key,value){if(!(key in PTHREAD_SPECIFIC)){return ERRNO_CODES.EINVAL}PTHREAD_SPECIFIC[key]=value;return 0}var _atan2f=Math_atan2;function ___cxa_pure_virtual(){ABORT=true;throw"Pure virtual function called!"}function ___cxa_guard_release(){}var _asinf=Math_asin;function ___cxa_guard_acquire(variable){if(!HEAP8[variable>>0]){HEAP8[variable>>0]=1;return 1}return 0}function _gettimeofday(ptr){var now=Date.now();HEAP32[ptr>>2]=now/1e3|0;HEAP32[ptr+4>>2]=now%1e3*1e3|0;return 0}function _emscripten_asm_const_double(code){var args=Array.prototype.slice.call(arguments,1);return+Runtime.getAsmConst(code,args.length).apply(null,args)}function ___cxa_begin_catch(ptr){__ZSt18uncaught_exceptionv.uncaught_exception--;EXCEPTIONS.caught.push(ptr);EXCEPTIONS.addRef(EXCEPTIONS.deAdjust(ptr));return ptr}var _sinf=Math_sin;function _emscripten_memcpy_big(dest,src,num){HEAPU8.set(HEAPU8.subarray(src,src+num),dest);return dest}Module["_memcpy"]=_memcpy;function _sbrk(bytes){var self=_sbrk;if(!self.called){DYNAMICTOP=alignMemoryPage(DYNAMICTOP);self.called=true;assert(Runtime.dynamicAlloc);self.alloc=Runtime.dynamicAlloc;Runtime.dynamicAlloc=(function(){abort("cannot dynamically allocate, sbrk now has control")})}var ret=DYNAMICTOP;if(bytes!=0)self.alloc(bytes);return ret}Module["_memmove"]=_memmove;function _malloc(bytes){var ptr=Runtime.dynamicAlloc(bytes+8);return ptr+8&4294967288}Module["_malloc"]=_malloc;function ___cxa_allocate_exception(size){return _malloc(size)}function ___errno_location(){return ___errno_state}Module["_llvm_bswap_i32"]=_llvm_bswap_i32;function _llvm_trap(){abort("trap!")}function _time(ptr){var ret=Date.now()/1e3|0;if(ptr){HEAP32[ptr>>2]=ret}return ret}var _UItoF=true;function _fwrite(ptr,size,nitems,stream){var bytesToWrite=nitems*size;if(bytesToWrite==0)return 0;var fd=_fileno(stream);var bytesWritten=_write(fd,ptr,bytesToWrite);if(bytesWritten==-1){var streamObj=FS.getStreamFromPtr(stream);if(streamObj)streamObj.error=true;return 0}else{return bytesWritten/size|0}}function __reallyNegative(x){return x<0||x===0&&1/x===-Infinity}function __formatString(format,varargs){var textIndex=format;var argIndex=0;function getNextArg(type){var ret;if(type==="double"){ret=(HEAP32[tempDoublePtr>>2]=HEAP32[varargs+argIndex>>2],HEAP32[tempDoublePtr+4>>2]=HEAP32[varargs+(argIndex+4)>>2],+HEAPF64[tempDoublePtr>>3])}else if(type=="i64"){ret=[HEAP32[varargs+argIndex>>2],HEAP32[varargs+(argIndex+4)>>2]]}else{type="i32";ret=HEAP32[varargs+argIndex>>2]}argIndex+=Runtime.getNativeFieldSize(type);return ret}var ret=[];var curr,next,currArg;while(1){var startTextIndex=textIndex;curr=HEAP8[textIndex>>0];if(curr===0)break;next=HEAP8[textIndex+1>>0];if(curr==37){var flagAlwaysSigned=false;var flagLeftAlign=false;var flagAlternative=false;var flagZeroPad=false;var flagPadSign=false;flagsLoop:while(1){switch(next){case 43:flagAlwaysSigned=true;break;case 45:flagLeftAlign=true;break;case 35:flagAlternative=true;break;case 48:if(flagZeroPad){break flagsLoop}else{flagZeroPad=true;break};case 32:flagPadSign=true;break;default:break flagsLoop}textIndex++;next=HEAP8[textIndex+1>>0]}var width=0;if(next==42){width=getNextArg("i32");textIndex++;next=HEAP8[textIndex+1>>0]}else{while(next>=48&&next<=57){width=width*10+(next-48);textIndex++;next=HEAP8[textIndex+1>>0]}}var precisionSet=false,precision=-1;if(next==46){precision=0;precisionSet=true;textIndex++;next=HEAP8[textIndex+1>>0];if(next==42){precision=getNextArg("i32");textIndex++}else{while(1){var precisionChr=HEAP8[textIndex+1>>0];if(precisionChr<48||precisionChr>57)break;precision=precision*10+(precisionChr-48);textIndex++}}next=HEAP8[textIndex+1>>0]}if(precision<0){precision=6;precisionSet=false}var argSize;switch(String.fromCharCode(next)){case"h":var nextNext=HEAP8[textIndex+2>>0];if(nextNext==104){textIndex++;argSize=1}else{argSize=2}break;case"l":var nextNext=HEAP8[textIndex+2>>0];if(nextNext==108){textIndex++;argSize=8}else{argSize=4}break;case"L":case"q":case"j":argSize=8;break;case"z":case"t":case"I":argSize=4;break;default:argSize=null}if(argSize)textIndex++;next=HEAP8[textIndex+1>>0];switch(String.fromCharCode(next)){case"d":case"i":case"u":case"o":case"x":case"X":case"p":{var signed=next==100||next==105;argSize=argSize||4;var currArg=getNextArg("i"+argSize*8);var origArg=currArg;var argText;if(argSize==8){currArg=Runtime.makeBigInt(currArg[0],currArg[1],next==117)}if(argSize<=4){var limit=Math.pow(256,argSize)-1;currArg=(signed?reSign:unSign)(currArg&limit,argSize*8)}var currAbsArg=Math.abs(currArg);var prefix="";if(next==100||next==105){if(argSize==8&&i64Math)argText=i64Math.stringify(origArg[0],origArg[1],null);else argText=reSign(currArg,8*argSize,1).toString(10)}else if(next==117){if(argSize==8&&i64Math)argText=i64Math.stringify(origArg[0],origArg[1],true);else argText=unSign(currArg,8*argSize,1).toString(10);currArg=Math.abs(currArg)}else if(next==111){argText=(flagAlternative?"0":"")+currAbsArg.toString(8)}else if(next==120||next==88){prefix=flagAlternative&&currArg!=0?"0x":"";if(argSize==8&&i64Math){if(origArg[1]){argText=(origArg[1]>>>0).toString(16);var lower=(origArg[0]>>>0).toString(16);while(lower.length<8)lower="0"+lower;argText+=lower}else{argText=(origArg[0]>>>0).toString(16)}}else if(currArg<0){currArg=-currArg;argText=(currAbsArg-1).toString(16);var buffer=[];for(var i=0;i<argText.length;i++){buffer.push((15-parseInt(argText[i],16)).toString(16))}argText=buffer.join("");while(argText.length<argSize*2)argText="f"+argText}else{argText=currAbsArg.toString(16)}if(next==88){prefix=prefix.toUpperCase();argText=argText.toUpperCase()}}else if(next==112){if(currAbsArg===0){argText="(nil)"}else{prefix="0x";argText=currAbsArg.toString(16)}}if(precisionSet){while(argText.length<precision){argText="0"+argText}}if(currArg>=0){if(flagAlwaysSigned){prefix="+"+prefix}else if(flagPadSign){prefix=" "+prefix}}if(argText.charAt(0)=="-"){prefix="-"+prefix;argText=argText.substr(1)}while(prefix.length+argText.length<width){if(flagLeftAlign){argText+=" "}else{if(flagZeroPad){argText="0"+argText}else{prefix=" "+prefix}}}argText=prefix+argText;argText.split("").forEach((function(chr){ret.push(chr.charCodeAt(0))}));break};case"f":case"F":case"e":case"E":case"g":case"G":{var currArg=getNextArg("double");var argText;if(isNaN(currArg)){argText="nan";flagZeroPad=false}else if(!isFinite(currArg)){argText=(currArg<0?"-":"")+"inf";flagZeroPad=false}else{var isGeneral=false;var effectivePrecision=Math.min(precision,20);if(next==103||next==71){isGeneral=true;precision=precision||1;var exponent=parseInt(currArg.toExponential(effectivePrecision).split("e")[1],10);if(precision>exponent&&exponent>=-4){next=(next==103?"f":"F").charCodeAt(0);precision-=exponent+1}else{next=(next==103?"e":"E").charCodeAt(0);precision--}effectivePrecision=Math.min(precision,20)}if(next==101||next==69){argText=currArg.toExponential(effectivePrecision);if(/[eE][-+]\d$/.test(argText)){argText=argText.slice(0,-1)+"0"+argText.slice(-1)}}else if(next==102||next==70){argText=currArg.toFixed(effectivePrecision);if(currArg===0&&__reallyNegative(currArg)){argText="-"+argText}}var parts=argText.split("e");if(isGeneral&&!flagAlternative){while(parts[0].length>1&&parts[0].indexOf(".")!=-1&&(parts[0].slice(-1)=="0"||parts[0].slice(-1)==".")){parts[0]=parts[0].slice(0,-1)}}else{if(flagAlternative&&argText.indexOf(".")==-1)parts[0]+=".";while(precision>effectivePrecision++)parts[0]+="0"}argText=parts[0]+(parts.length>1?"e"+parts[1]:"");if(next==69)argText=argText.toUpperCase();if(currArg>=0){if(flagAlwaysSigned){argText="+"+argText}else if(flagPadSign){argText=" "+argText}}}while(argText.length<width){if(flagLeftAlign){argText+=" "}else{if(flagZeroPad&&(argText[0]=="-"||argText[0]=="+")){argText=argText[0]+"0"+argText.slice(1)}else{argText=(flagZeroPad?"0":" ")+argText}}}if(next<97)argText=argText.toUpperCase();argText.split("").forEach((function(chr){ret.push(chr.charCodeAt(0))}));break};case"s":{var arg=getNextArg("i8*");var argLength=arg?_strlen(arg):"(null)".length;if(precisionSet)argLength=Math.min(argLength,precision);if(!flagLeftAlign){while(argLength<width--){ret.push(32)}}if(arg){for(var i=0;i<argLength;i++){ret.push(HEAPU8[arg++>>0])}}else{ret=ret.concat(intArrayFromString("(null)".substr(0,argLength),true))}if(flagLeftAlign){while(argLength<width--){ret.push(32)}}break};case"c":{if(flagLeftAlign)ret.push(getNextArg("i8"));while(--width>0){ret.push(32)}if(!flagLeftAlign)ret.push(getNextArg("i8"));break};case"n":{var ptr=getNextArg("i32*");HEAP32[ptr>>2]=ret.length;break};case"%":{ret.push(curr);break};default:{for(var i=startTextIndex;i<textIndex+2;i++){ret.push(HEAP8[i>>0])}}}textIndex+=2}else{ret.push(curr);textIndex+=1}}return ret}function _fprintf(stream,format,varargs){var result=__formatString(format,varargs);var stack=Runtime.stackSave();var ret=_fwrite(allocate(result,"i8",ALLOC_STACK),1,result.length,stream);Runtime.stackRestore(stack);return ret}function _vfprintf(s,f,va_arg){return _fprintf(s,f,HEAP32[va_arg>>2])}var _stderr=allocate(1,"i32*",ALLOC_STATIC);___errno_state=Runtime.staticAlloc(4);HEAP32[___errno_state>>2]=0;_fputc.ret=allocate([0],"i8",ALLOC_STATIC);STACK_BASE=STACKTOP=Runtime.alignMemory(STATICTOP);staticSealed=true;STACK_MAX=STACK_BASE+TOTAL_STACK;DYNAMIC_BASE=DYNAMICTOP=Runtime.alignMemory(STACK_MAX);assert(DYNAMIC_BASE<TOTAL_MEMORY,"TOTAL_MEMORY not big enough for stack");var ctlz_i8=allocate([8,7,6,6,5,5,5,5,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"i8",ALLOC_DYNAMIC);var cttz_i8=allocate([8,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,7,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0],"i8",ALLOC_DYNAMIC);var Math_min=Math.min;function invoke_viiiii(index,a1,a2,a3,a4,a5){try{Module["dynCall_viiiii"](index,a1,a2,a3,a4,a5)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_vid(index,a1,a2){try{Module["dynCall_vid"](index,a1,a2)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_vi(index,a1){try{Module["dynCall_vi"](index,a1)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiidii(index,a1,a2,a3,a4,a5,a6){try{Module["dynCall_viiidii"](index,a1,a2,a3,a4,a5,a6)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_vii(index,a1,a2){try{Module["dynCall_vii"](index,a1,a2)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_iiiiiiiiiii(index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10){try{return Module["dynCall_iiiiiiiiiii"](index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_ii(index,a1){try{return Module["dynCall_ii"](index,a1)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viidi(index,a1,a2,a3,a4){try{Module["dynCall_viidi"](index,a1,a2,a3,a4)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viddiii(index,a1,a2,a3,a4,a5,a6){try{Module["dynCall_viddiii"](index,a1,a2,a3,a4,a5,a6)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_vidii(index,a1,a2,a3,a4){try{Module["dynCall_vidii"](index,a1,a2,a3,a4)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_iiiii(index,a1,a2,a3,a4){try{return Module["dynCall_iiiii"](index,a1,a2,a3,a4)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_vidi(index,a1,a2,a3){try{Module["dynCall_vidi"](index,a1,a2,a3)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_diiiiiiii(index,a1,a2,a3,a4,a5,a6,a7,a8){try{return Module["dynCall_diiiiiiii"](index,a1,a2,a3,a4,a5,a6,a7,a8)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiiiddddiid(index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11){try{Module["dynCall_viiiiddddiid"](index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_diiiii(index,a1,a2,a3,a4,a5){try{return Module["dynCall_diiiii"](index,a1,a2,a3,a4,a5)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_iiii(index,a1,a2,a3){try{return Module["dynCall_iiii"](index,a1,a2,a3)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiiiii(index,a1,a2,a3,a4,a5,a6){try{Module["dynCall_viiiiii"](index,a1,a2,a3,a4,a5,a6)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_iiid(index,a1,a2,a3){try{return Module["dynCall_iiid"](index,a1,a2,a3)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_di(index,a1){try{return Module["dynCall_di"](index,a1)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_iiiiiii(index,a1,a2,a3,a4,a5,a6){try{return Module["dynCall_iiiiiii"](index,a1,a2,a3,a4,a5,a6)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_diiidii(index,a1,a2,a3,a4,a5,a6){try{return Module["dynCall_diiidii"](index,a1,a2,a3,a4,a5,a6)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viidii(index,a1,a2,a3,a4,a5){try{Module["dynCall_viidii"](index,a1,a2,a3,a4,a5)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiiiiii(index,a1,a2,a3,a4,a5,a6,a7){try{Module["dynCall_viiiiiii"](index,a1,a2,a3,a4,a5,a6,a7)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiiiiiiii(index,a1,a2,a3,a4,a5,a6,a7,a8,a9){try{Module["dynCall_viiiiiiiii"](index,a1,a2,a3,a4,a5,a6,a7,a8,a9)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiiiiiiiii(index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10){try{Module["dynCall_viiiiiiiiii"](index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_iii(index,a1,a2){try{return Module["dynCall_iii"](index,a1,a2)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_diii(index,a1,a2,a3){try{return Module["dynCall_diii"](index,a1,a2,a3)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_diiiiiiiiii(index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10){try{return Module["dynCall_diiiiiiiiii"](index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiiid(index,a1,a2,a3,a4,a5){try{Module["dynCall_viiiid"](index,a1,a2,a3,a4,a5)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_diiiiiiiii(index,a1,a2,a3,a4,a5,a6,a7,a8,a9){try{return Module["dynCall_diiiiiiiii"](index,a1,a2,a3,a4,a5,a6,a7,a8,a9)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_did(index,a1,a2){try{return Module["dynCall_did"](index,a1,a2)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiiidddddidi(index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11,a12){try{Module["dynCall_viiiidddddidi"](index,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11,a12)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_diidii(index,a1,a2,a3,a4,a5){try{return Module["dynCall_diidii"](index,a1,a2,a3,a4,a5)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_diiii(index,a1,a2,a3,a4){try{return Module["dynCall_diiii"](index,a1,a2,a3,a4)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_iiiiiiiiii(index,a1,a2,a3,a4,a5,a6,a7,a8,a9){try{return Module["dynCall_iiiiiiiiii"](index,a1,a2,a3,a4,a5,a6,a7,a8,a9)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiid(index,a1,a2,a3,a4){try{Module["dynCall_viiid"](index,a1,a2,a3,a4)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viii(index,a1,a2,a3){try{Module["dynCall_viii"](index,a1,a2,a3)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_v(index){try{Module["dynCall_v"](index)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viid(index,a1,a2,a3){try{Module["dynCall_viid"](index,a1,a2,a3)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_iidid(index,a1,a2,a3,a4){try{return Module["dynCall_iidid"](index,a1,a2,a3,a4)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}function invoke_viiii(index,a1,a2,a3,a4){try{Module["dynCall_viiii"](index,a1,a2,a3,a4)}catch(e){if(typeof e!=="number"&&e!=="longjmp")throw e;asm["setThrew"](1,0)}}var asm=(function(global,env,buffer) {
// EMSCRIPTEN_START_ASM
"use asm";var a=new global.Int8Array(buffer);var b=new global.Int16Array(buffer);var c=new global.Int32Array(buffer);var d=new global.Uint8Array(buffer);var e=new global.Uint16Array(buffer);var f=new global.Uint32Array(buffer);var g=new global.Float32Array(buffer);var h=new global.Float64Array(buffer);var i=env.STACKTOP|0;var j=env.STACK_MAX|0;var k=env.tempDoublePtr|0;var l=env.ABORT|0;var m=env.cttz_i8|0;var n=env.ctlz_i8|0;var o=env._stderr|0;var p=0;var q=0;var r=0;var s=0;var t=+env.NaN,u=+env.Infinity;var v=0,w=0,x=0,y=0,z=0.0,A=0,B=0,C=0,D=0.0;var E=0;var F=0;var G=0;var H=0;var I=0;var J=0;var K=0;var L=0;var M=0;var N=0;var O=global.Math.floor;var P=global.Math.abs;var Q=global.Math.sqrt;var R=global.Math.pow;var S=global.Math.cos;var T=global.Math.sin;var U=global.Math.tan;var V=global.Math.acos;var W=global.Math.asin;var X=global.Math.atan;var Y=global.Math.atan2;var Z=global.Math.exp;var _=global.Math.log;var $=global.Math.ceil;var aa=global.Math.imul;var ba=env.abort;var ca=env.assert;var da=env.min;var ea=env.invoke_viiiii;var fa=env.invoke_vid;var ga=env.invoke_vi;var ha=env.invoke_viiidii;var ia=env.invoke_vii;var ja=env.invoke_iiiiiiiiiii;var ka=env.invoke_ii;var la=env.invoke_viidi;var ma=env.invoke_viddiii;var na=env.invoke_vidii;var oa=env.invoke_iiiii;var pa=env.invoke_vidi;var qa=env.invoke_diiiiiiii;var ra=env.invoke_viiiiddddiid;var sa=env.invoke_diiiii;var ta=env.invoke_iiii;var ua=env.invoke_viiiiii;var va=env.invoke_iiid;var wa=env.invoke_di;var xa=env.invoke_iiiiiii;var ya=env.invoke_diiidii;var za=env.invoke_viidii;var Aa=env.invoke_viiiiiii;var Ba=env.invoke_viiiiiiiii;var Ca=env.invoke_viiiiiiiiii;var Da=env.invoke_iii;var Ea=env.invoke_diii;var Fa=env.invoke_diiiiiiiiii;var Ga=env.invoke_viiiid;var Ha=env.invoke_diiiiiiiii;var Ia=env.invoke_did;var Ja=env.invoke_viiiidddddidi;var Ka=env.invoke_diidii;var La=env.invoke_diiii;var Ma=env.invoke_iiiiiiiiii;var Na=env.invoke_viiid;var Oa=env.invoke_viii;var Pa=env.invoke_v;var Qa=env.invoke_viid;var Ra=env.invoke_iidid;var Sa=env.invoke_viiii;var Ta=env._emscripten_asm_const_double;var Ua=env._cosf;var Va=env._send;var Wa=env._sqrtf;var Xa=env._fmod;var Ya=env.___cxa_guard_acquire;var Za=env.___setErrNo;var _a=env._vfprintf;var $a=env._atan2f;var ab=env._fmodf;var bb=env.___cxa_guard_release;var cb=env._pwrite;var db=env._acosf;var eb=env._asinf;var fb=env._fabsf;var gb=env._sbrk;var hb=env._llvm_pow_f32;var ib=env.___cxa_begin_catch;var jb=env._sinf;var kb=env._fileno;var lb=env.___resumeException;var mb=env.___cxa_find_matching_catch;var nb=env._sysconf;var ob=env.__reallyNegative;var pb=env._pthread_getspecific;var qb=env.__ZSt18uncaught_exceptionv;var rb=env._emscripten_memcpy_big;var sb=env._pthread_once;var tb=env._pthread_key_create;var ub=env._write;var vb=env.___errno_location;var wb=env._pthread_setspecific;var xb=env._fputc;var yb=env.___cxa_throw;var zb=env._abort;var Ab=env.___cxa_allocate_exception;var Bb=env._fwrite;var Cb=env._time;var Db=env._fprintf;var Eb=env._gettimeofday;var Fb=env.__formatString;var Gb=env._llvm_trap;var Hb=env.___cxa_pure_virtual;var Ib=0.0;
// EMSCRIPTEN_START_FUNCS
function wc(a){a=a|0;var b=0;b=i;i=i+a|0;i=i+15&-16;return b|0}function xc(){return i|0}function yc(a){a=a|0;i=a}function zc(a,b){a=a|0;b=b|0;if((p|0)==0){p=a;q=b}}function Ac(b){b=b|0;a[k>>0]=a[b>>0];a[k+1>>0]=a[b+1>>0];a[k+2>>0]=a[b+2>>0];a[k+3>>0]=a[b+3>>0]}function Bc(b){b=b|0;a[k>>0]=a[b>>0];a[k+1>>0]=a[b+1>>0];a[k+2>>0]=a[b+2>>0];a[k+3>>0]=a[b+3>>0];a[k+4>>0]=a[b+4>>0];a[k+5>>0]=a[b+5>>0];a[k+6>>0]=a[b+6>>0];a[k+7>>0]=a[b+7>>0]}function Cc(a){a=a|0;E=a}function Dc(){return E|0}function Ec(a){a=a|0;return 52}function Fc(a,b,c,d){a=a|0;b=+b;c=+c;d=+d;var e=0.0,f=0.0,h=0.0;e=+S(+b);f=+S(+c);h=+S(+d);b=+T(+b);c=+T(+c);d=+T(+d);g[a>>2]=f*h;g[a+4>>2]=c*b*h-e*d;g[a+8>>2]=c*e*h+b*d;g[a+12>>2]=0.0;g[a+16>>2]=f*d;g[a+20>>2]=c*b*d+e*h;g[a+24>>2]=c*e*d-b*h;g[a+28>>2]=0.0;g[a+32>>2]=-c;g[a+36>>2]=f*b;g[a+40>>2]=f*e;g[a+44>>2]=0.0;return}function Gc(a,b){a=a|0;b=b|0;var c=0;c=i;Hc(a,b);i=c;return}function Hc(a,b){a=a|0;b=b|0;var c=0,d=0.0,e=0.0,f=0.0,h=0,j=0.0,k=0,l=0;c=i;i=i+16|0;f=+g[a>>2];e=+g[a+20>>2];d=+g[a+40>>2];if(f+e+d>0.0){f=+Q(+(f+e+d+1.0));g[c+12>>2]=f*.5;j=(+g[a+36>>2]- +g[a+24>>2])*(.5/f);g[c>>2]=j;d=(+g[a+8>>2]- +g[a+32>>2])*(.5/f);g[c+4>>2]=d;e=(+g[a+16>>2]- +g[a+4>>2])*(.5/f);g[c+8>>2]=e;f=f*.5;g[b>>2]=j;h=b+4|0;g[h>>2]=d;h=b+8|0;g[h>>2]=e;h=b+12|0;g[h>>2]=f;i=c;return}if(f<e)h=e<d?2:1;else h=f<d?2:0;l=((h+1|0)>>>0)%3|0;k=((h+2|0)>>>0)%3|0;d=+Q(+(+g[a+(h<<4)+(h<<2)>>2]- +g[a+(l<<4)+(l<<2)>>2]- +g[a+(k<<4)+(k<<2)>>2]+1.0));g[c+(h<<2)>>2]=d*.5;g[c+12>>2]=(+g[a+(k<<4)+(l<<2)>>2]- +g[a+(l<<4)+(k<<2)>>2])*(.5/d);g[c+(l<<2)>>2]=(+g[a+(l<<4)+(h<<2)>>2]+ +g[a+(h<<4)+(l<<2)>>2])*(.5/d);g[c+(k<<2)>>2]=(+g[a+(k<<4)+(h<<2)>>2]+ +g[a+(h<<4)+(k<<2)>>2])*(.5/d);d=+g[c>>2];e=+g[c+4>>2];f=+g[c+8>>2];j=+g[c+12>>2];g[b>>2]=d;h=b+4|0;g[h>>2]=e;h=b+8|0;g[h>>2]=f;h=b+12|0;g[h>>2]=j;i=c;return}function Ic(a){a=a|0;var b=0;b=i;if((a|0)!=0)YE(a);i=b;return}function Jc(){var a=0,d=0,e=0;a=i;d=XE(8)|0;a:do if((d|0)==0){while(1){d=c[5158]|0;c[5158]=d+0;if((d|0)==0)break;sc[d&3]();d=XE(8)|0;if((d|0)!=0)break a}d=Ab(4)|0;c[d>>2]=20472;yb(d|0,20520,265)}while(0);e=d;c[e>>2]=0;c[e+4>>2]=0;b[d+4>>1]=1;b[d+6>>1]=-1;c[d>>2]=840;i=a;return d|0}function Kc(a,b,d,e,f,g,h,j){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;j=j|0;var k=0.0,l=0;l=i;k=+Vb[c[(c[a>>2]|0)+12>>2]&1](a,b,d,e,f,g,h,j);i=l;return+k}function Lc(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Mc(a,b){a=a|0;b=b|0;var d=0,e=0;d=i;c[5004]=(c[5004]|0)+1;e=XE(95)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}Xs(e,a,b,1);i=d;return e|0}function Nc(a){a=a|0;ib(a|0)|0;yE()}function Oc(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0;e=i;c[5004]=(c[5004]|0)+1;f=XE(95)|0;if((f|0)==0)f=0;else{c[(f+19&-16)+ -4>>2]=f;f=f+19&-16}Xs(f,a,b,d);i=e;return f|0}function Pc(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function Qc(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function Rc(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Sc(){var a=0,b=0;a=i;b=XE(196)|0;a:do if((b|0)==0){while(1){b=c[5158]|0;c[5158]=b+0;if((b|0)==0)break;sc[b&3]();b=XE(196)|0;if((b|0)!=0)break a}b=Ab(4)|0;c[b>>2]=20472;yb(b|0,20520,265)}while(0);Px(b,0);i=a;return b|0}function Tc(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Uc(a){a=a|0;var b=0;b=i;if((a|0)!=0)YE(a);i=b;return}function Vc(){var b=0,d=0;b=i;c[5004]=(c[5004]|0)+1;d=XE(215)|0;if((d|0)==0)d=0;else{c[(d+19&-16)+ -4>>2]=d;d=d+19&-16}c[d>>2]=4024;a[d+20>>0]=1;c[d+16>>2]=0;c[d+8>>2]=0;c[d+12>>2]=0;a[d+40>>0]=1;c[d+36>>2]=0;c[d+28>>2]=0;c[d+32>>2]=0;a[d+60>>0]=1;c[d+56>>2]=0;c[d+48>>2]=0;c[d+52>>2]=0;a[d+80>>0]=1;c[d+76>>2]=0;c[d+68>>2]=0;c[d+72>>2]=0;a[d+100>>0]=1;c[d+96>>2]=0;c[d+88>>2]=0;c[d+92>>2]=0;a[d+120>>0]=1;c[d+116>>2]=0;c[d+108>>2]=0;c[d+112>>2]=0;a[d+140>>0]=1;c[d+136>>2]=0;c[d+128>>2]=0;c[d+132>>2]=0;a[d+160>>0]=1;c[d+156>>2]=0;c[d+148>>2]=0;c[d+152>>2]=0;a[d+180>>0]=1;c[d+176>>2]=0;c[d+168>>2]=0;c[d+172>>2]=0;c[d+192>>2]=0;i=b;return d|0}function Wc(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Xc(a){a=a|0;return+(+g[a>>2])}function Yc(a,b){a=a|0;b=+b;g[a>>2]=b;return}function Zc(a){a=a|0;return c[a+4>>2]|0}function _c(a,b){a=a|0;b=b|0;c[a+4>>2]=b;return}function $c(a){a=a|0;return c[a+8>>2]|0}function ad(a,b){a=a|0;b=b|0;c[a+8>>2]=b;return}function bd(a){a=a|0;return+(+g[a+12>>2])}function cd(a,b){a=a|0;b=+b;g[a+12>>2]=b;return}function dd(b){b=b|0;return(a[b+16>>0]&1)!=0|0}function ed(b,c){b=b|0;c=c|0;a[b+16>>0]=c&1;return}function fd(b){b=b|0;return(a[b+24>>0]&1)!=0|0}function gd(b,c){b=b|0;c=c|0;a[b+24>>0]=c&1;return}function hd(b){b=b|0;return(a[b+25>>0]&1)!=0|0}function id(b,c){b=b|0;c=c|0;a[b+25>>0]=c&1;return}function jd(b){b=b|0;return(a[b+26>>0]&1)!=0|0}function kd(b,c){b=b|0;c=c|0;a[b+26>>0]=c&1;return}function ld(a){a=a|0;return+(+g[a+28>>2])}function md(a,b){a=a|0;b=+b;g[a+28>>2]=b;return}function nd(b){b=b|0;return(a[b+32>>0]&1)!=0|0}function od(b,c){b=b|0;c=c|0;a[b+32>>0]=c&1;return}function pd(a){a=a|0;return+(+g[a+36>>2])}function qd(a,b){a=a|0;b=+b;g[a+36>>2]=b;return}function rd(a){a=a|0;var b=0;b=i;if((a|0)!=0)YE(a);i=b;return}function sd(a,b){a=+a;b=+b;var d=0,e=0;d=i;c[5004]=(c[5004]|0)+1;e=XE(75)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}c[e+8>>2]=0;g[e+12>>2]=1.0;g[e+16>>2]=1.0;g[e+20>>2]=1.0;g[e+24>>2]=0.0;g[e+44>>2]=.03999999910593033;c[e>>2]=6296;c[e+4>>2]=10;c[e+52>>2]=1;g[e+28>>2]=a;g[e+32>>2]=b*.5;g[e+36>>2]=a;g[e+40>>2]=0.0;i=d;return e|0}function td(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function ud(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function vd(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function wd(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function xd(a,b){a=a|0;b=b|0;var d=0,e=0;d=i;c[5004]=(c[5004]|0)+1;e=XE(135)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}Qr(e,a,b,16384,0,0);i=d;return e|0}function yd(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0;e=i;c[5004]=(c[5004]|0)+1;f=XE(135)|0;if((f|0)==0)f=0;else{c[(f+19&-16)+ -4>>2]=f;f=f+19&-16}Qr(f,a,b,d&65535,0,0);i=e;return f|0}function zd(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,g=0;f=i;c[5004]=(c[5004]|0)+1;g=XE(135)|0;if((g|0)==0)g=0;else{c[(g+19&-16)+ -4>>2]=g;g=g+19&-16}Qr(g,a,b,d&65535,e,0);i=f;return g|0}function Ad(a,b,d,e,f){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;var g=0,h=0;g=i;c[5004]=(c[5004]|0)+1;h=XE(135)|0;if((h|0)==0)h=0;else{c[(h+19&-16)+ -4>>2]=h;h=h+19&-16}Qr(h,a,b,d&65535,e,f);i=g;return h|0}function Bd(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Cd(){var b=0,d=0,e=0,f=0,h=0;b=i;c[5004]=(c[5004]|0)+1;d=XE(307)|0;if((d|0)==0)d=0;else{c[(d+19&-16)+ -4>>2]=d;d=d+19&-16}g[d+164>>2]=1.0;g[d+168>>2]=1.0;g[d+172>>2]=1.0;g[d+176>>2]=0.0;c[d+180>>2]=0;g[d+184>>2]=999999984306749400.0;h=d+188|0;e=d+204|0;c[h+0>>2]=0;c[h+4>>2]=0;c[h+8>>2]=0;c[h+12>>2]=0;c[e>>2]=1;c[d+208>>2]=-1;c[d+212>>2]=-1;c[d+216>>2]=1;g[d+220>>2]=0.0;g[d+224>>2]=.5;g[d+228>>2]=0.0;g[d+232>>2]=0.0;e=d+236|0;c[d+240>>2]=0;g[d+244>>2]=1.0;h=d+248|0;f=d+4|0;c[h+0>>2]=0;c[h+4>>2]=0;c[h+8>>2]=0;c[h+12>>2]=0;g[f>>2]=1.0;f=d+8|0;h=d+24|0;c[f+0>>2]=0;c[f+4>>2]=0;c[f+8>>2]=0;c[f+12>>2]=0;g[h>>2]=1.0;h=d+28|0;f=d+44|0;c[h+0>>2]=0;c[h+4>>2]=0;c[h+8>>2]=0;c[h+12>>2]=0;g[f>>2]=1.0;f=d+48|0;c[f+0>>2]=0;c[f+4>>2]=0;c[f+8>>2]=0;c[f+12>>2]=0;c[f+16>>2]=0;a[d+280>>0]=1;c[d+276>>2]=0;c[d+268>>2]=0;c[d+272>>2]=0;c[e>>2]=4;c[d>>2]=13056;c[5004]=(c[5004]|0)+1;e=XE(95)|0;if((e|0)==0){f=0;h=d+284|0;c[h>>2]=f;i=b;return d|0}c[(e+19&-16)+ -4>>2]=e;if((e+19&-16|0)==0){f=0;h=d+284|0;c[h>>2]=f;i=b;return d|0}Oz(e+19&-16);f=e+19&-16;h=d+284|0;c[h>>2]=f;i=b;return d|0}function Dd(a){a=a|0;return c[a+192>>2]|0}function Ed(a,b){a=a|0;b=+b;g[a+184>>2]=b;return}function Fd(a,b){a=a|0;b=b|0;var d=0;d=i;if(((c[a+216>>2]|0)+ -4|0)>>>0<2){i=d;return}c[a+216>>2]=b;i=d;return}function Gd(a,b){a=a|0;b=b|0;c[a+216>>2]=b;return}function Hd(a){a=a|0;var b=0;b=i;if((c[a+204>>2]&3|0)!=0){i=b;return}if(!(((c[a+216>>2]|0)+ -4|0)>>>0<2))c[a+216>>2]=1;g[a+220>>2]=0.0;i=b;return}function Id(a,b){a=a|0;b=b|0;var d=0;d=i;if(!b?(c[a+204>>2]&3|0)!=0:0){i=d;return}if(!(((c[a+216>>2]|0)+ -4|0)>>>0<2))c[a+216>>2]=1;g[a+220>>2]=0.0;i=d;return}function Jd(a){a=a|0;a=c[a+216>>2]|0;return((a|0)==2?0:(a|0)!=5)|0}function Kd(a){a=a|0;return(c[a+204>>2]&2|0)!=0|0}function Ld(a,b){a=a|0;b=+b;c[a+260>>2]=(c[a+260>>2]|0)+1;g[a+228>>2]=b;return}function Md(a,b){a=a|0;b=+b;c[a+260>>2]=(c[a+260>>2]|0)+1;g[a+224>>2]=b;return}function Nd(a){a=a|0;return a+4|0}function Od(a){a=a|0;return c[a+204>>2]|0}function Pd(a,b){a=a|0;b=b|0;c[a+204>>2]=b;return}function Qd(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+260>>2]=(c[a+260>>2]|0)+1;c[a+4>>2]=c[b+0>>2];c[a+8>>2]=c[b+4>>2];c[a+12>>2]=c[b+8>>2];c[a+16>>2]=c[b+12>>2];c[a+20>>2]=c[b+16>>2];c[a+24>>2]=c[b+20>>2];c[a+28>>2]=c[b+24>>2];c[a+32>>2]=c[b+28>>2];c[a+36>>2]=c[b+32>>2];c[a+40>>2]=c[b+36>>2];c[a+44>>2]=c[b+40>>2];c[a+48>>2]=c[b+44>>2];c[a+52>>2]=c[b+48>>2];c[a+56>>2]=c[b+52>>2];c[a+60>>2]=c[b+56>>2];c[a+64>>2]=c[b+60>>2];i=d;return}function Rd(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+12>>2]&127](a,b);i=d;return}function Sd(a){a=a|0;return c[a+268>>2]|0}function Td(a,b){a=a|0;b=b|0;return c[(c[a+276>>2]|0)+(b<<2)>>2]|0}function Ud(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+8>>2]&511](a);i=b;return}function Vd(b,d,e){b=+b;d=d|0;e=e|0;var f=0,h=0,j=0,k=0;f=i;h=XE(140)|0;a:do if((h|0)==0){while(1){h=c[5158]|0;c[5158]=h+0;if((h|0)==0)break;sc[h&3]();h=XE(140)|0;if((h|0)!=0)break a}k=Ab(4)|0;c[k>>2]=20472;yb(k|0,20520,265)}while(0);g[h>>2]=b;c[h+4>>2]=d;d=h+8|0;j=h+56|0;k=d;do k=k+16|0;while((k|0)!=(j|0));c[h+72>>2]=e;j=h+76|0;k=h+100|0;c[j+0>>2]=0;c[j+4>>2]=0;c[j+8>>2]=0;c[j+12>>2]=0;c[j+16>>2]=0;c[j+20>>2]=0;g[k>>2]=.5;g[h+104>>2]=0.0;g[h+108>>2]=0.0;g[h+112>>2]=.800000011920929;g[h+116>>2]=1.0;a[h+120>>0]=0;g[h+124>>2]=.004999999888241291;g[h+128>>2]=.009999999776482582;g[h+132>>2]=.009999999776482582;g[h+136>>2]=.009999999776482582;an(d);i=f;return h|0}function Wd(b,d,e,f){b=+b;d=d|0;e=e|0;f=f|0;var h=0,j=0,k=0,l=0;h=i;j=XE(140)|0;a:do if((j|0)==0){while(1){j=c[5158]|0;c[5158]=j+0;if((j|0)==0)break;sc[j&3]();j=XE(140)|0;if((j|0)!=0)break a}l=Ab(4)|0;c[l>>2]=20472;yb(l|0,20520,265)}while(0);g[j>>2]=b;c[j+4>>2]=d;d=j+8|0;k=j+56|0;l=d;do l=l+16|0;while((l|0)!=(k|0));c[j+72>>2]=e;l=j+76|0;c[l+0>>2]=c[f+0>>2];c[l+4>>2]=c[f+4>>2];c[l+8>>2]=c[f+8>>2];c[l+12>>2]=c[f+12>>2];g[j+92>>2]=0.0;g[j+96>>2]=0.0;g[j+100>>2]=.5;g[j+104>>2]=0.0;g[j+108>>2]=0.0;g[j+112>>2]=.800000011920929;g[j+116>>2]=1.0;a[j+120>>0]=0;g[j+124>>2]=.004999999888241291;g[j+128>>2]=.009999999776482582;g[j+132>>2]=.009999999776482582;g[j+136>>2]=.009999999776482582;an(d);i=h;return j|0}function Xd(a){a=a|0;return+(+g[a+92>>2])}function Yd(a,b){a=a|0;b=+b;g[a+92>>2]=b;return}function Zd(a){a=a|0;return+(+g[a+96>>2])}function _d(a,b){a=a|0;b=+b;g[a+96>>2]=b;return}function $d(a){a=a|0;return+(+g[a+100>>2])}function ae(a,b){a=a|0;b=+b;g[a+100>>2]=b;return}function be(a){a=a|0;return+(+g[a+104>>2])}function ce(a,b){a=a|0;b=+b;g[a+104>>2]=b;return}function de(a){a=a|0;return+(+g[a+108>>2])}function ee(a,b){a=a|0;b=+b;g[a+108>>2]=b;return}function fe(a){a=a|0;return+(+g[a+112>>2])}function ge(a,b){a=a|0;b=+b;g[a+112>>2]=b;return}function he(a){a=a|0;return+(+g[a+116>>2])}function ie(a,b){a=a|0;b=+b;g[a+116>>2]=b;return}function je(b){b=b|0;return(a[b+120>>0]&1)!=0|0}function ke(b,c){b=b|0;c=c|0;a[b+120>>0]=c&1;return}function le(a){a=a|0;return+(+g[a+124>>2])}function me(a,b){a=a|0;b=+b;g[a+124>>2]=b;return}function ne(a){a=a|0;return+(+g[a+128>>2])}function oe(a,b){a=a|0;b=+b;g[a+128>>2]=b;return}function pe(a){a=a|0;return+(+g[a+132>>2])}function qe(a,b){a=a|0;b=+b;g[a+132>>2]=b;return}function re(a){a=a|0;return+(+g[a+136>>2])}function se(a,b){a=a|0;b=+b;g[a+136>>2]=b;return}function te(a){a=a|0;var b=0;b=i;if((a|0)!=0)YE(a);i=b;return}function ue(a){a=a|0;return a+48|0}function ve(a){a=a|0;return a+32|0}function we(a){a=a|0;return a|0}function xe(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+0>>2]=c[b+0>>2];c[a+4>>2]=c[b+4>>2];c[a+8>>2]=c[b+8>>2];c[a+12>>2]=c[b+12>>2];i=d;return}function ye(a){a=a|0;return a+16|0}function ze(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+16>>2]=c[b+0>>2];c[a+20>>2]=c[b+4>>2];c[a+24>>2]=c[b+8>>2];c[a+28>>2]=c[b+12>>2];i=d;return}function Ae(a){a=a|0;return a+32|0}function Be(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+32>>2]=c[b+0>>2];c[a+36>>2]=c[b+4>>2];c[a+40>>2]=c[b+8>>2];c[a+44>>2]=c[b+12>>2];i=d;return}function Ce(a){a=a|0;return a+48|0}function De(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+48>>2]=c[b+0>>2];c[a+52>>2]=c[b+4>>2];c[a+56>>2]=c[b+8>>2];c[a+60>>2]=c[b+12>>2];i=d;return}function Ee(a){a=a|0;return a+64|0}function Fe(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+64>>2]=c[b+0>>2];c[a+68>>2]=c[b+4>>2];c[a+72>>2]=c[b+8>>2];c[a+76>>2]=c[b+12>>2];i=d;return}function Ge(a){a=a|0;var b=0;b=i;if((a|0)!=0)YE(a);i=b;return}function He(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0;f=i;i=i+96|0;c[5004]=(c[5004]|0)+1;h=XE(1331)|0;if((h|0)==0)k=0;else{c[(h+19&-16)+ -4>>2]=h;k=h+19&-16}if((a[5024]|0)==0?(Ya(5024)|0)!=0:0){c[f+80>>2]=0;c[f+84>>2]=0;c[f+88>>2]=0;c[f+92>>2]=0;br(4408,0.0,0,0,f+80|0);bb(5024)}c[f+64>>2]=0;c[f+68>>2]=0;c[f+72>>2]=0;c[f+76>>2]=0;cr(4408,0.0,f+64|0);c[k+4>>2]=6;c[k+8>>2]=-1;c[k+12>>2]=-1;g[k+16>>2]=3.4028234663852886e+38;a[k+20>>0]=1;a[k+21>>0]=0;c[k+24>>2]=-1;j=k+28|0;c[j>>2]=4408;h=k+32|0;c[h>>2]=b;g[k+36>>2]=0.0;g[k+40>>2]=.30000001192092896;c[k+44>>2]=0;c[k>>2]=2368;l=k+112|0;c[l+0>>2]=c[d+0>>2];c[l+4>>2]=c[d+4>>2];c[l+8>>2]=c[d+8>>2];c[l+12>>2]=c[d+12>>2];o=k+128|0;c[o+0>>2]=c[d+16>>2];c[o+4>>2]=c[d+20>>2];c[o+8>>2]=c[d+24>>2];c[o+12>>2]=c[d+28>>2];o=k+144|0;c[o+0>>2]=c[d+32>>2];c[o+4>>2]=c[d+36>>2];c[o+8>>2]=c[d+40>>2];c[o+12>>2]=c[d+44>>2];o=k+160|0;c[o+0>>2]=c[d+48>>2];c[o+4>>2]=c[d+52>>2];c[o+8>>2]=c[d+56>>2];c[o+12>>2]=c[d+60>>2];o=k+48|0;p=k+740|0;m=k+756|0;d=k+680|0;n=d+48|0;do{c[d>>2]=0;d=d+4|0}while((d|0)<(n|0));c[p+0>>2]=0;c[p+4>>2]=0;c[p+8>>2]=0;c[p+12>>2]=0;g[m>>2]=.20000000298023224;g[k+760>>2]=.20000000298023224;g[k+764>>2]=.20000000298023224;n=k+768|0;p=k+728|0;c[n+0>>2]=0;c[n+4>>2]=0;c[n+8>>2]=0;c[n+12>>2]=0;c[n+16>>2]=0;g[p>>2]=.699999988079071;g[k+732>>2]=1.0;g[k+736>>2]=.5;a[k+788>>0]=0;g[k+792>>2]=0.0;g[k+808>>2]=0.0;a[k+789>>0]=0;g[k+796>>2]=0.0;g[k+812>>2]=0.0;a[k+790>>0]=0;g[k+800>>2]=0.0;g[k+816>>2]=0.0;g[k+928>>2]=0.0;g[k+876>>2]=0.0;g[k+880>>2]=.10000000149011612;g[k+884>>2]=300.0;g[k+868>>2]=1.0;g[k+872>>2]=-1.0;g[k+896>>2]=0.0;g[k+900>>2]=.20000000298023224;g[k+904>>2]=0.0;g[k+908>>2]=0.0;g[k+888>>2]=1.0;g[k+892>>2]=.5;c[k+924>>2]=0;g[k+916>>2]=0.0;a[k+912>>0]=0;g[k+992>>2]=0.0;g[k+940>>2]=0.0;g[k+944>>2]=.10000000149011612;g[k+948>>2]=300.0;g[k+932>>2]=1.0;g[k+936>>2]=-1.0;g[k+960>>2]=0.0;g[k+964>>2]=.20000000298023224;g[k+968>>2]=0.0;g[k+972>>2]=0.0;g[k+952>>2]=1.0;g[k+956>>2]=.5;c[k+988>>2]=0;g[k+980>>2]=0.0;a[k+976>>0]=0;g[k+1056>>2]=0.0;g[k+1004>>2]=0.0;g[k+1008>>2]=.10000000149011612;g[k+1012>>2]=300.0;g[k+996>>2]=1.0;g[k+1e3>>2]=-1.0;g[k+1024>>2]=0.0;g[k+1028>>2]=.20000000298023224;g[k+1032>>2]=0.0;g[k+1036>>2]=0.0;g[k+1016>>2]=1.0;g[k+1020>>2]=.5;c[k+1052>>2]=0;g[k+1044>>2]=0.0;a[k+1040>>0]=0;a[k+1300>>0]=e&1;a[k+1301>>0]=1;c[k+1304>>2]=0;a[k+1308>>0]=0;co(f,b+4|0,l);c[o+0>>2]=c[f+0>>2];c[o+4>>2]=c[f+4>>2];c[o+8>>2]=c[f+8>>2];c[o+12>>2]=c[f+12>>2];p=k+64|0;c[p+0>>2]=c[f+16>>2];c[p+4>>2]=c[f+20>>2];c[p+8>>2]=c[f+24>>2];c[p+12>>2]=c[f+28>>2];p=k+80|0;c[p+0>>2]=c[f+32>>2];c[p+4>>2]=c[f+36>>2];c[p+8>>2]=c[f+40>>2];c[p+12>>2]=c[f+44>>2];p=k+96|0;c[p+0>>2]=c[f+48>>2];c[p+4>>2]=c[f+52>>2];c[p+8>>2]=c[f+56>>2];c[p+12>>2]=c[f+60>>2];Kp(k,(c[j>>2]|0)+4|0,(c[h>>2]|0)+4|0);i=f;return k|0}function Ie(b,d,e,f,h){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0,k=0,l=0,m=0;j=i;c[5004]=(c[5004]|0)+1;k=XE(1331)|0;if((k|0)==0)l=0;else{c[(k+19&-16)+ -4>>2]=k;l=k+19&-16}c[l+4>>2]=6;c[l+8>>2]=-1;c[l+12>>2]=-1;g[l+16>>2]=3.4028234663852886e+38;a[l+20>>0]=1;a[l+21>>0]=0;c[l+24>>2]=-1;k=l+28|0;c[k>>2]=b;b=l+32|0;c[b>>2]=d;g[l+36>>2]=0.0;g[l+40>>2]=.30000001192092896;c[l+44>>2]=0;c[l>>2]=2368;m=l+48|0;c[m+0>>2]=c[e+0>>2];c[m+4>>2]=c[e+4>>2];c[m+8>>2]=c[e+8>>2];c[m+12>>2]=c[e+12>>2];m=l+64|0;c[m+0>>2]=c[e+16>>2];c[m+4>>2]=c[e+20>>2];c[m+8>>2]=c[e+24>>2];c[m+12>>2]=c[e+28>>2];m=l+80|0;c[m+0>>2]=c[e+32>>2];c[m+4>>2]=c[e+36>>2];c[m+8>>2]=c[e+40>>2];c[m+12>>2]=c[e+44>>2];m=l+96|0;c[m+0>>2]=c[e+48>>2];c[m+4>>2]=c[e+52>>2];c[m+8>>2]=c[e+56>>2];c[m+12>>2]=c[e+60>>2];e=l+112|0;c[e+0>>2]=c[f+0>>2];c[e+4>>2]=c[f+4>>2];c[e+8>>2]=c[f+8>>2];c[e+12>>2]=c[f+12>>2];e=l+128|0;c[e+0>>2]=c[f+16>>2];c[e+4>>2]=c[f+20>>2];c[e+8>>2]=c[f+24>>2];c[e+12>>2]=c[f+28>>2];e=l+144|0;c[e+0>>2]=c[f+32>>2];c[e+4>>2]=c[f+36>>2];c[e+8>>2]=c[f+40>>2];c[e+12>>2]=c[f+44>>2];e=l+160|0;c[e+0>>2]=c[f+48>>2];c[e+4>>2]=c[f+52>>2];c[e+8>>2]=c[f+56>>2];c[e+12>>2]=c[f+60>>2];e=l+740|0;f=l+756|0;m=l+680|0;d=m+48|0;do{c[m>>2]=0;m=m+4|0}while((m|0)<(d|0));c[e+0>>2]=0;c[e+4>>2]=0;c[e+8>>2]=0;c[e+12>>2]=0;g[f>>2]=.20000000298023224;g[l+760>>2]=.20000000298023224;g[l+764>>2]=.20000000298023224;f=l+768|0;m=l+728|0;c[f+0>>2]=0;c[f+4>>2]=0;c[f+8>>2]=0;c[f+12>>2]=0;c[f+16>>2]=0;g[m>>2]=.699999988079071;g[l+732>>2]=1.0;g[l+736>>2]=.5;a[l+788>>0]=0;g[l+792>>2]=0.0;g[l+808>>2]=0.0;a[l+789>>0]=0;g[l+796>>2]=0.0;g[l+812>>2]=0.0;a[l+790>>0]=0;g[l+800>>2]=0.0;g[l+816>>2]=0.0;g[l+928>>2]=0.0;g[l+876>>2]=0.0;g[l+880>>2]=.10000000149011612;g[l+884>>2]=300.0;g[l+868>>2]=1.0;g[l+872>>2]=-1.0;g[l+896>>2]=0.0;g[l+900>>2]=.20000000298023224;g[l+904>>2]=0.0;g[l+908>>2]=0.0;g[l+888>>2]=1.0;g[l+892>>2]=.5;c[l+924>>2]=0;g[l+916>>2]=0.0;a[l+912>>0]=0;g[l+992>>2]=0.0;g[l+940>>2]=0.0;g[l+944>>2]=.10000000149011612;g[l+948>>2]=300.0;g[l+932>>2]=1.0;g[l+936>>2]=-1.0;g[l+960>>2]=0.0;g[l+964>>2]=.20000000298023224;g[l+968>>2]=0.0;g[l+972>>2]=0.0;g[l+952>>2]=1.0;g[l+956>>2]=.5;c[l+988>>2]=0;g[l+980>>2]=0.0;a[l+976>>0]=0;g[l+1056>>2]=0.0;g[l+1004>>2]=0.0;g[l+1008>>2]=.10000000149011612;g[l+1012>>2]=300.0;g[l+996>>2]=1.0;g[l+1e3>>2]=-1.0;g[l+1024>>2]=0.0;g[l+1028>>2]=.20000000298023224;g[l+1032>>2]=0.0;g[l+1036>>2]=0.0;g[l+1016>>2]=1.0;g[l+1020>>2]=.5;c[l+1052>>2]=0;g[l+1044>>2]=0.0;a[l+1040>>0]=0;a[l+1300>>0]=h&1;a[l+1301>>0]=1;c[l+1304>>2]=0;a[l+1308>>0]=0;Kp(l,(c[k>>2]|0)+4|0,(c[b>>2]|0)+4|0);i=j;return l|0}function Je(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Ke(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Le(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Me(a){a=a|0;return c[a+192>>2]|0}function Ne(a,b){a=a|0;b=+b;g[a+184>>2]=b;return}function Oe(a,b){a=a|0;b=b|0;var d=0;d=i;if(((c[a+216>>2]|0)+ -4|0)>>>0<2){i=d;return}c[a+216>>2]=b;i=d;return}function Pe(a,b){a=a|0;b=b|0;c[a+216>>2]=b;return}function Qe(a){a=a|0;var b=0;b=i;if((c[a+204>>2]&3|0)!=0){i=b;return}if(!(((c[a+216>>2]|0)+ -4|0)>>>0<2))c[a+216>>2]=1;g[a+220>>2]=0.0;i=b;return}function Re(a,b){a=a|0;b=b|0;var d=0;d=i;if(!b?(c[a+204>>2]&3|0)!=0:0){i=d;return}if(!(((c[a+216>>2]|0)+ -4|0)>>>0<2))c[a+216>>2]=1;g[a+220>>2]=0.0;i=d;return}function Se(a){a=a|0;a=c[a+216>>2]|0;return((a|0)==2?0:(a|0)!=5)|0}function Te(a){a=a|0;return(c[a+204>>2]&2|0)!=0|0}function Ue(a,b){a=a|0;b=+b;c[a+260>>2]=(c[a+260>>2]|0)+1;g[a+228>>2]=b;return}function Ve(a,b){a=a|0;b=+b;c[a+260>>2]=(c[a+260>>2]|0)+1;g[a+224>>2]=b;return}function We(a){a=a|0;return a+4|0}function Xe(a){a=a|0;return c[a+204>>2]|0}function Ye(a,b){a=a|0;b=b|0;c[a+204>>2]=b;return}function Ze(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+260>>2]=(c[a+260>>2]|0)+1;c[a+4>>2]=c[b+0>>2];c[a+8>>2]=c[b+4>>2];c[a+12>>2]=c[b+8>>2];c[a+16>>2]=c[b+12>>2];c[a+20>>2]=c[b+16>>2];c[a+24>>2]=c[b+20>>2];c[a+28>>2]=c[b+24>>2];c[a+32>>2]=c[b+28>>2];c[a+36>>2]=c[b+32>>2];c[a+40>>2]=c[b+36>>2];c[a+44>>2]=c[b+40>>2];c[a+48>>2]=c[b+44>>2];c[a+52>>2]=c[b+48>>2];c[a+56>>2]=c[b+52>>2];c[a+60>>2]=c[b+56>>2];c[a+64>>2]=c[b+60>>2];i=d;return}function _e(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+12>>2]&127](a,b);i=d;return}function $e(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+8>>2]&511](a);i=b;return}function af(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var h=0,j=0,k=0,l=0,m=0;f=i;c[5004]=(c[5004]|0)+1;h=XE(343)|0;if((h|0)==0)h=0;else{c[(h+19&-16)+ -4>>2]=h;h=h+19&-16}a[h+20>>0]=1;c[h+16>>2]=0;c[h+8>>2]=0;c[h+12>>2]=0;c[h+24>>2]=b;g[h+28>>2]=0.0;c[h+32>>2]=0;c[h+36>>2]=1;g[h+40>>2]=1.0;a[h+44>>0]=1;c[h+48>>2]=0;a[h+52>>0]=0;a[h+53>>0]=1;a[h+54>>0]=1;g[h+56>>2]=.03999999910593033;a[h+60>>0]=0;g[h+64>>2]=0.0;c[h+68>>2]=d;c[h+72>>2]=0;a[h+76>>0]=1;c[h+80>>2]=0;c[h+84>>2]=0;c[h+88>>2]=0;g[h+92>>2]=.6000000238418579;g[h+96>>2]=1.0;g[h+100>>2]=.30000001192092896;g[h+104>>2]=.01666666753590107;g[h+108>>2]=0.0;g[h+116>>2]=20.0;c[h+112>>2]=10;g[h+124>>2]=.20000000298023224;g[h+128>>2]=.800000011920929;g[h+132>>2]=0.0;g[h+120>>2]=1.0;c[h+136>>2]=1;g[h+140>>2]=-.03999999910593033;g[h+144>>2]=.10000000149011612;g[h+148>>2]=0.0;g[h+152>>2]=.8500000238418579;c[h+156>>2]=260;c[h+160>>2]=2;c[h+164>>2]=128;g[h+168>>2]=100.0;g[h+172>>2]=1.0000000150474662e+30;c[h>>2]=1392;a[h+192>>0]=1;c[h+188>>2]=0;c[h+180>>2]=0;c[h+184>>2]=0;d=h+196|0;c[d>>2]=0;j=h+200|0;c[j>>2]=e;a[h+224>>0]=1;c[h+220>>2]=0;c[h+212>>2]=0;c[h+216>>2]=0;a[h+244>>0]=1;c[h+240>>2]=0;c[h+232>>2]=0;c[h+236>>2]=0;g[h+248>>2]=0.0;g[h+252>>2]=-10.0;m=h+256|0;a[h+274>>0]=0;a[h+275>>0]=0;l=h+292|0;c[m+0>>2]=0;c[m+4>>2]=0;c[m+8>>2]=0;c[m+12>>2]=0;a[l>>0]=1;c[h+288>>2]=0;c[h+280>>2]=0;c[h+284>>2]=0;c[h+296>>2]=0;a[h+300>>0]=1;a[h+320>>0]=1;c[h+316>>2]=0;c[h+308>>2]=0;c[h+312>>2]=0;if((e|0)==0){c[5004]=(c[5004]|0)+1;e=XE(215)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}c[e>>2]=4024;a[e+20>>0]=1;c[e+16>>2]=0;c[e+8>>2]=0;c[e+12>>2]=0;a[e+40>>0]=1;c[e+36>>2]=0;c[e+28>>2]=0;c[e+32>>2]=0;a[e+60>>0]=1;c[e+56>>2]=0;c[e+48>>2]=0;c[e+52>>2]=0;a[e+80>>0]=1;c[e+76>>2]=0;c[e+68>>2]=0;c[e+72>>2]=0;a[e+100>>0]=1;c[e+96>>2]=0;c[e+88>>2]=0;c[e+92>>2]=0;a[e+120>>0]=1;c[e+116>>2]=0;c[e+108>>2]=0;c[e+112>>2]=0;a[e+140>>0]=1;c[e+136>>2]=0;c[e+128>>2]=0;c[e+132>>2]=0;a[e+160>>0]=1;c[e+156>>2]=0;c[e+148>>2]=0;c[e+152>>2]=0;a[e+180>>0]=1;c[e+176>>2]=0;c[e+168>>2]=0;c[e+172>>2]=0;c[e+192>>2]=0;c[j>>2]=e;a[h+273>>0]=1}else a[h+273>>0]=0;c[5004]=(c[5004]|0)+1;e=XE(87)|0;if((e|0)!=0?(k=e+19&-16,c[k+ -4>>2]=e,(e+19&-16|0)!=0):0){c[(e+19&-16)>>2]=16568;a[k+20>>0]=1;c[k+16>>2]=0;c[k+8>>2]=0;c[k+12>>2]=0;a[k+40>>0]=1;c[k+36>>2]=0;c[k+28>>2]=0;c[k+32>>2]=0;a[k+60>>0]=1;c[k+56>>2]=0;c[k+48>>2]=0;c[k+52>>2]=0;a[k+64>>0]=1;k=e+19&-16}else k=0;c[h+204>>2]=k;a[h+272>>0]=1;c[5004]=(c[5004]|0)+1;k=XE(107)|0;if((k|0)==0){m=0;c[d>>2]=m;i=f;return h|0}e=k+19&-16;c[e+ -4>>2]=k;if((k+19&-16|0)==0){m=0;c[d>>2]=m;i=f;return h|0}m=c[j>>2]|0;c[(k+19&-16)>>2]=2240;c[e+4>>2]=0;c[e+8>>2]=m;c[e+12>>2]=0;c[e+16>>2]=0;c[e+20>>2]=0;c[e+24>>2]=b;a[e+44>>0]=1;c[e+40>>2]=0;c[e+32>>2]=0;c[e+36>>2]=0;a[e+64>>0]=1;c[e+60>>2]=0;c[e+52>>2]=0;c[e+56>>2]=0;a[e+84>>0]=1;c[e+80>>2]=0;c[e+72>>2]=0;c[e+76>>2]=0;m=k+19&-16;c[d>>2]=m;i=f;return h|0}function bf(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+72>>2]&127](a,b);i=d;return}function cf(b){b=b|0;var d=0;d=i;i=i+16|0;if((a[24]|0)==0?(Ya(24)|0)!=0:0)bb(24);Nb[c[(c[b>>2]|0)+76>>2]&127](d,b);c[2]=c[d+0>>2];c[3]=c[d+4>>2];c[4]=c[d+8>>2];c[5]=c[d+12>>2];i=d;return 8}function df(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+84>>2]&127](a,b);i=d;return}function ef(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;vc[c[(c[a>>2]|0)+88>>2]&127](a,b,d,e);i=f;return}function ff(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+92>>2]&127](a,b);i=d;return}function gf(a,b){a=a|0;b=b|0;var d=0;d=i;rc[c[(c[a>>2]|0)+56>>2]&127](a,b,0);i=d;return}function hf(a,b,d){a=a|0;b=b|0;d=d|0;var e=0;e=i;rc[c[(c[a>>2]|0)+56>>2]&127](a,b,d);i=e;return}function jf(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+60>>2]&127](a,b);i=d;return}function kf(a,b){a=a|0;b=+b;var d=0;d=i;a=uc[c[(c[a>>2]|0)+52>>2]&1](a,b,1,.01666666753590107)|0;i=d;return a|0}function lf(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;a=uc[c[(c[a>>2]|0)+52>>2]&1](a,b,d,.01666666753590107)|0;i=e;return a|0}function mf(a,b,d,e){a=a|0;b=+b;d=d|0;e=+e;var f=0;f=i;a=uc[c[(c[a>>2]|0)+52>>2]&1](a,b,d,e)|0;i=f;return a|0}function nf(a){a=a|0;return c[a+24>>2]|0}function of(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;vc[c[(c[a>>2]|0)+32>>2]&127](a,b,d,e);i=f;return}function pf(a){a=a|0;var b=0;b=i;a=c[a+68>>2]|0;a=Pb[c[(c[a>>2]|0)+36>>2]&127](a)|0;i=b;return a|0}function qf(a){a=a|0;return a+28|0}function rf(a,b){a=a|0;b=b|0;var d=0;d=i;vc[c[(c[a>>2]|0)+36>>2]&127](a,b,2,-3);i=d;return}function sf(a,b,d){a=a|0;b=b|0;d=d|0;var e=0;e=i;vc[c[(c[a>>2]|0)+36>>2]&127](a,b,d,-3);i=e;return}function tf(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;vc[c[(c[a>>2]|0)+36>>2]&127](a,b,d,e);i=f;return}function uf(a){a=a|0;return c[a+68>>2]|0}function vf(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=+f;var g=0;g=i;Eu(a,b,c,d,e,f);i=g;return}function wf(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;e=i;Gu(a,b,c,d);i=e;return}function xf(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+64>>2]&127](a,b);i=d;return}function yf(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function zf(b){b=b|0;var d=0,e=0;d=i;c[5004]=(c[5004]|0)+1;e=XE(115)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}c[e+8>>2]=0;g[e+12>>2]=1.0;g[e+16>>2]=1.0;g[e+20>>2]=1.0;g[e+24>>2]=0.0;g[e+44>>2]=.03999999910593033;c[e+52>>2]=0;g[e+56>>2]=1.0;g[e+60>>2]=1.0;g[e+64>>2]=1.0;g[e+68>>2]=0.0;g[e+72>>2]=-1.0;g[e+76>>2]=-1.0;g[e+80>>2]=-1.0;g[e+84>>2]=0.0;a[e+88>>0]=0;c[e>>2]=10656;c[e+92>>2]=b;c[e+4>>2]=3;uA(e);i=d;return e|0}function Af(b,d){b=b|0;d=d|0;var e=0,f=0;e=i;c[5004]=(c[5004]|0)+1;f=XE(115)|0;if((f|0)==0)f=0;else{c[(f+19&-16)+ -4>>2]=f;f=f+19&-16}c[f+8>>2]=0;g[f+12>>2]=1.0;g[f+16>>2]=1.0;g[f+20>>2]=1.0;g[f+24>>2]=0.0;g[f+44>>2]=.03999999910593033;c[f+52>>2]=0;g[f+56>>2]=1.0;g[f+60>>2]=1.0;g[f+64>>2]=1.0;g[f+68>>2]=0.0;g[f+72>>2]=-1.0;g[f+76>>2]=-1.0;g[f+80>>2]=-1.0;g[f+84>>2]=0.0;a[f+88>>0]=0;c[f>>2]=10656;c[f+92>>2]=b;c[f+4>>2]=3;if(!d){i=e;return f|0}uA(f);i=e;return f|0}function Bf(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function Cf(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function Df(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Ef(a){a=a|0;return+g[a+4>>2]<1.0|0}function Ff(a){a=a|0;return b[a+8>>1]|0}function Gf(a,c){a=a|0;c=c|0;b[a+8>>1]=c;return}function Hf(a){a=a|0;return b[a+10>>1]|0}function If(a,c){a=a|0;c=c|0;b[a+10>>1]=c;return}function Jf(a){a=a|0;return+(+g[a+4>>2])}function Kf(a,b){a=a|0;b=+b;g[a+4>>2]=b;return}function Lf(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Mf(b,d){b=b|0;d=d|0;var e=0,f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0;e=i;c[5004]=(c[5004]|0)+1;f=XE(379)|0;if((f|0)==0)f=0;else{c[(f+19&-16)+ -4>>2]=f;f=f+19&-16}Or(f,3,b);c[f>>2]=2984;n=f+300|0;c[n+0>>2]=c[d+0>>2];c[n+4>>2]=c[d+4>>2];c[n+8>>2]=c[d+8>>2];c[n+12>>2]=c[d+12>>2];m=+g[d>>2];l=+g[d+4>>2];k=+g[d+8>>2];j=m*+g[b+20>>2]+l*+g[b+24>>2]+k*+g[b+28>>2]+ +g[b+56>>2];h=m*+g[b+36>>2]+l*+g[b+40>>2]+k*+g[b+44>>2]+ +g[b+60>>2];g[f+316>>2]=m*+g[b+4>>2]+l*+g[b+8>>2]+k*+g[b+12>>2]+ +g[b+52>>2];g[f+320>>2]=j;g[f+324>>2]=h;g[f+328>>2]=0.0;c[f+332>>2]=0;a[f+344>>0]=0;g[f+348>>2]=.30000001192092896;g[f+352>>2]=1.0;g[f+356>>2]=0.0;i=e;return f|0}function Nf(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var h=0,j=0;h=i;c[5004]=(c[5004]|0)+1;j=XE(379)|0;if((j|0)==0)j=0;else{c[(j+19&-16)+ -4>>2]=j;j=j+19&-16}c[j+4>>2]=3;c[j+8>>2]=-1;c[j+12>>2]=-1;g[j+16>>2]=3.4028234663852886e+38;a[j+20>>0]=1;a[j+21>>0]=0;c[j+24>>2]=-1;c[j+28>>2]=b;c[j+32>>2]=d;g[j+36>>2]=0.0;g[j+40>>2]=.30000001192092896;c[j+44>>2]=0;c[j>>2]=2984;d=j+300|0;c[d+0>>2]=c[e+0>>2];c[d+4>>2]=c[e+4>>2];c[d+8>>2]=c[e+8>>2];c[d+12>>2]=c[e+12>>2];e=j+316|0;c[e+0>>2]=c[f+0>>2];c[e+4>>2]=c[f+4>>2];c[e+8>>2]=c[f+8>>2];c[e+12>>2]=c[f+12>>2];c[j+332>>2]=0;a[j+344>>0]=0;g[j+348>>2]=.30000001192092896;g[j+352>>2]=1.0;g[j+356>>2]=0.0;i=h;return j|0}function Of(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+300>>2]=c[b+0>>2];c[a+304>>2]=c[b+4>>2];c[a+308>>2]=c[b+8>>2];c[a+312>>2]=c[b+12>>2];i=d;return}function Pf(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+316>>2]=c[b+0>>2];c[a+320>>2]=c[b+4>>2];c[a+324>>2]=c[b+8>>2];c[a+328>>2]=c[b+12>>2];i=d;return}function Qf(a){a=a|0;return a+300|0}function Rf(a){a=a|0;return a+316|0}function Sf(b,c){b=b|0;c=c|0;a[b+21>>0]=c&1;return}function Tf(a){a=a|0;return a+348|0}function Uf(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+348>>2]=c[b+0>>2];c[a+352>>2]=c[b+4>>2];c[a+356>>2]=c[b+8>>2];i=d;return}function Vf(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Wf(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+8>>2]&127](a,b);i=d;return}function Xf(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+12>>2]&127](a,b);i=d;return}function Yf(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Zf(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,h=0,j=0,k=0,l=0,m=0;f=i;i=i+96|0;c[5004]=(c[5004]|0)+1;h=XE(1147)|0;if((h|0)==0)h=0;else{c[(h+19&-16)+ -4>>2]=h;h=h+19&-16}if((a[5024]|0)==0?(Ya(5024)|0)!=0:0){c[f+80>>2]=0;c[f+84>>2]=0;c[f+88>>2]=0;c[f+92>>2]=0;br(4408,0.0,0,0,f+80|0);bb(5024)}c[f+64>>2]=0;c[f+68>>2]=0;c[f+72>>2]=0;c[f+76>>2]=0;cr(4408,0.0,f+64|0);c[h+4>>2]=7;c[h+8>>2]=-1;c[h+12>>2]=-1;g[h+16>>2]=3.4028234663852886e+38;a[h+20>>0]=1;a[h+21>>0]=0;c[h+24>>2]=-1;k=h+28|0;c[k>>2]=4408;j=h+32|0;c[j>>2]=b;g[h+36>>2]=0.0;g[h+40>>2]=.30000001192092896;c[h+44>>2]=0;c[h>>2]=4264;a[h+48>>0]=0;l=h+116|0;c[l+0>>2]=c[d+0>>2];c[l+4>>2]=c[d+4>>2];c[l+8>>2]=c[d+8>>2];c[l+12>>2]=c[d+12>>2];m=h+132|0;c[m+0>>2]=c[d+16>>2];c[m+4>>2]=c[d+20>>2];c[m+8>>2]=c[d+24>>2];c[m+12>>2]=c[d+28>>2];m=h+148|0;c[m+0>>2]=c[d+32>>2];c[m+4>>2]=c[d+36>>2];c[m+8>>2]=c[d+40>>2];c[m+12>>2]=c[d+44>>2];m=h+164|0;c[m+0>>2]=c[d+48>>2];c[m+4>>2]=c[d+52>>2];c[m+8>>2]=c[d+56>>2];c[m+12>>2]=c[d+60>>2];a[h+180>>0]=e&1;d=h+52|0;co(f,b+4|0,l);c[d+0>>2]=c[f+0>>2];c[d+4>>2]=c[f+4>>2];c[d+8>>2]=c[f+8>>2];c[d+12>>2]=c[f+12>>2];d=h+68|0;c[d+0>>2]=c[f+16>>2];c[d+4>>2]=c[f+20>>2];c[d+8>>2]=c[f+24>>2];c[d+12>>2]=c[f+28>>2];d=h+84|0;c[d+0>>2]=c[f+32>>2];c[d+4>>2]=c[f+36>>2];c[d+8>>2]=c[f+40>>2];c[d+12>>2]=c[f+44>>2];d=h+100|0;c[d+0>>2]=c[f+48>>2];c[d+4>>2]=c[f+52>>2];c[d+8>>2]=c[f+56>>2];c[d+12>>2]=c[f+60>>2];g[h+184>>2]=1.0;g[h+188>>2]=-1.0;g[h+192>>2]=0.0;g[h+196>>2]=0.0;g[h+200>>2]=1.0;g[h+204>>2]=.699999988079071;g[h+208>>2]=0.0;g[h+212>>2]=0.0;g[h+216>>2]=1.0;g[h+220>>2]=.699999988079071;g[h+224>>2]=0.0;g[h+228>>2]=0.0;g[h+264>>2]=1.0;g[h+268>>2]=.699999988079071;g[h+272>>2]=1.0;g[h+276>>2]=0.0;g[h+280>>2]=1.0;g[h+284>>2]=.699999988079071;g[h+288>>2]=1.0;g[h+292>>2]=0.0;g[h+232>>2]=1.0;g[h+236>>2]=.699999988079071;g[h+240>>2]=1.0;g[h+244>>2]=0.0;g[h+248>>2]=1.0;g[h+252>>2]=.699999988079071;g[h+256>>2]=1.0;g[h+260>>2]=0.0;a[h+1096>>0]=0;d=h+1100|0;g[h+1116>>2]=0.0;g[h+1120>>2]=0.0;g[h+1124>>2]=0.0;c[h+300>>2]=0;e=h+49|0;c[d+0>>2]=0;c[d+4>>2]=0;c[d+8>>2]=0;a[d+12>>0]=0;a[e>>0]=1;Fr(h,(c[k>>2]|0)+4|0,(c[j>>2]|0)+4|0);i=f;return h|0}function _f(b,d,e,f,h){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0,k=0,l=0;j=i;c[5004]=(c[5004]|0)+1;k=XE(1147)|0;if((k|0)==0)k=0;else{c[(k+19&-16)+ -4>>2]=k;k=k+19&-16}c[k+4>>2]=7;c[k+8>>2]=-1;c[k+12>>2]=-1;g[k+16>>2]=3.4028234663852886e+38;a[k+20>>0]=1;a[k+21>>0]=0;c[k+24>>2]=-1;l=k+28|0;c[l>>2]=b;b=k+32|0;c[b>>2]=d;g[k+36>>2]=0.0;g[k+40>>2]=.30000001192092896;c[k+44>>2]=0;c[k>>2]=4264;a[k+48>>0]=0;d=k+52|0;c[d+0>>2]=c[e+0>>2];c[d+4>>2]=c[e+4>>2];c[d+8>>2]=c[e+8>>2];c[d+12>>2]=c[e+12>>2];d=k+68|0;c[d+0>>2]=c[e+16>>2];c[d+4>>2]=c[e+20>>2];c[d+8>>2]=c[e+24>>2];c[d+12>>2]=c[e+28>>2];d=k+84|0;c[d+0>>2]=c[e+32>>2];c[d+4>>2]=c[e+36>>2];c[d+8>>2]=c[e+40>>2];c[d+12>>2]=c[e+44>>2];d=k+100|0;c[d+0>>2]=c[e+48>>2];c[d+4>>2]=c[e+52>>2];c[d+8>>2]=c[e+56>>2];c[d+12>>2]=c[e+60>>2];e=k+116|0;c[e+0>>2]=c[f+0>>2];c[e+4>>2]=c[f+4>>2];c[e+8>>2]=c[f+8>>2];c[e+12>>2]=c[f+12>>2];e=k+132|0;c[e+0>>2]=c[f+16>>2];c[e+4>>2]=c[f+20>>2];c[e+8>>2]=c[f+24>>2];c[e+12>>2]=c[f+28>>2];e=k+148|0;c[e+0>>2]=c[f+32>>2];c[e+4>>2]=c[f+36>>2];c[e+8>>2]=c[f+40>>2];c[e+12>>2]=c[f+44>>2];e=k+164|0;c[e+0>>2]=c[f+48>>2];c[e+4>>2]=c[f+52>>2];c[e+8>>2]=c[f+56>>2];c[e+12>>2]=c[f+60>>2];a[k+180>>0]=h&1;g[k+184>>2]=1.0;g[k+188>>2]=-1.0;g[k+192>>2]=0.0;g[k+196>>2]=0.0;g[k+200>>2]=1.0;g[k+204>>2]=.699999988079071;g[k+208>>2]=0.0;g[k+212>>2]=0.0;g[k+216>>2]=1.0;g[k+220>>2]=.699999988079071;g[k+224>>2]=0.0;g[k+228>>2]=0.0;g[k+264>>2]=1.0;g[k+268>>2]=.699999988079071;g[k+272>>2]=1.0;g[k+276>>2]=0.0;g[k+280>>2]=1.0;g[k+284>>2]=.699999988079071;g[k+288>>2]=1.0;g[k+292>>2]=0.0;g[k+232>>2]=1.0;g[k+236>>2]=.699999988079071;g[k+240>>2]=1.0;g[k+244>>2]=0.0;g[k+248>>2]=1.0;g[k+252>>2]=.699999988079071;g[k+256>>2]=1.0;g[k+260>>2]=0.0;a[k+1096>>0]=0;f=k+1100|0;g[k+1116>>2]=0.0;g[k+1120>>2]=0.0;g[k+1124>>2]=0.0;c[k+300>>2]=0;h=k+49|0;c[f+0>>2]=0;c[f+4>>2]=0;c[f+8>>2]=0;a[f+12>>0]=0;a[h>>0]=1;Fr(k,(c[l>>2]|0)+4|0,(c[b>>2]|0)+4|0);i=j;return k|0}function $f(a,b){a=a|0;b=+b;g[a+184>>2]=b;return}function ag(a,b){a=a|0;b=+b;g[a+188>>2]=b;return}function bg(a,b){a=a|0;b=+b;var c=0;c=i;b=+ab(+b,6.2831854820251465);if(!(b<-3.1415927410125732)){if(b>3.1415927410125732)b=b+-6.2831854820251465}else b=b+6.2831854820251465;g[a+192>>2]=b;i=c;return}function cg(a,b){a=a|0;b=+b;var c=0;c=i;b=+ab(+b,6.2831854820251465);if(!(b<-3.1415927410125732)){if(b>3.1415927410125732)b=b+-6.2831854820251465}else b=b+6.2831854820251465;g[a+196>>2]=b;i=c;return}function dg(b,c){b=b|0;c=c|0;a[b+21>>0]=c&1;return}function eg(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function fg(b,d){b=b|0;d=d|0;var e=0,f=0,h=0,j=0,k=0;e=i;c[5004]=(c[5004]|0)+1;f=XE(627)|0;if((f|0)==0)f=0;else{c[(f+19&-16)+ -4>>2]=f;f=f+19&-16}Or(f,5,b);c[f>>2]=1264;k=f+300|0;c[k+0>>2]=c[d+0>>2];c[k+4>>2]=c[d+4>>2];c[k+8>>2]=c[d+8>>2];c[k+12>>2]=c[d+12>>2];j=f+316|0;c[j+0>>2]=c[d+16>>2];c[j+4>>2]=c[d+20>>2];c[j+8>>2]=c[d+24>>2];c[j+12>>2]=c[d+28>>2];h=f+332|0;c[h+0>>2]=c[d+32>>2];c[h+4>>2]=c[d+36>>2];c[h+8>>2]=c[d+40>>2];c[h+12>>2]=c[d+44>>2];b=f+348|0;c[b+0>>2]=c[d+48>>2];c[b+4>>2]=c[d+52>>2];c[b+8>>2]=c[d+56>>2];c[b+12>>2]=c[d+60>>2];b=f+364|0;d=f+524|0;a[f+527>>0]=0;c[b+0>>2]=c[k+0>>2];c[b+4>>2]=c[k+4>>2];c[b+8>>2]=c[k+8>>2];c[b+12>>2]=c[k+12>>2];b=f+380|0;c[b+0>>2]=c[j+0>>2];c[b+4>>2]=c[j+4>>2];c[b+8>>2]=c[j+8>>2];c[b+12>>2]=c[j+12>>2];b=f+396|0;c[b+0>>2]=c[h+0>>2];c[b+4>>2]=c[h+4>>2];c[b+8>>2]=c[h+8>>2];c[b+12>>2]=c[h+12>>2];b=f+412|0;a[d>>0]=0;a[f+525>>0]=0;a[f+526>>0]=0;a[f+552>>0]=0;d=f+572|0;c[b+0>>2]=0;c[b+4>>2]=0;c[b+8>>2]=0;c[b+12>>2]=0;g[d>>2]=-1.0;g[f+444>>2]=999999984306749400.0;g[f+448>>2]=999999984306749400.0;g[f+452>>2]=999999984306749400.0;g[f+428>>2]=1.0;g[f+432>>2]=.30000001192092896;g[f+436>>2]=1.0;g[f+440>>2]=.009999999776482582;g[f+456>>2]=.05000000074505806;c[f+592>>2]=0;g[f+596>>2]=0.0;g[f+600>>2]=.699999988079071;g[f+604>>2]=0.0;i=e;return f|0}function gg(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var h=0,j=0;h=i;c[5004]=(c[5004]|0)+1;j=XE(627)|0;if((j|0)==0)j=0;else{c[(j+19&-16)+ -4>>2]=j;j=j+19&-16}c[j+4>>2]=5;c[j+8>>2]=-1;c[j+12>>2]=-1;g[j+16>>2]=3.4028234663852886e+38;a[j+20>>0]=1;a[j+21>>0]=0;c[j+24>>2]=-1;c[j+28>>2]=b;c[j+32>>2]=d;g[j+36>>2]=0.0;g[j+40>>2]=.30000001192092896;c[j+44>>2]=0;c[j>>2]=1264;d=j+300|0;c[d+0>>2]=c[e+0>>2];c[d+4>>2]=c[e+4>>2];c[d+8>>2]=c[e+8>>2];c[d+12>>2]=c[e+12>>2];d=j+316|0;c[d+0>>2]=c[e+16>>2];c[d+4>>2]=c[e+20>>2];c[d+8>>2]=c[e+24>>2];c[d+12>>2]=c[e+28>>2];d=j+332|0;c[d+0>>2]=c[e+32>>2];c[d+4>>2]=c[e+36>>2];c[d+8>>2]=c[e+40>>2];c[d+12>>2]=c[e+44>>2];d=j+348|0;c[d+0>>2]=c[e+48>>2];c[d+4>>2]=c[e+52>>2];c[d+8>>2]=c[e+56>>2];c[d+12>>2]=c[e+60>>2];e=j+364|0;c[e+0>>2]=c[f+0>>2];c[e+4>>2]=c[f+4>>2];c[e+8>>2]=c[f+8>>2];c[e+12>>2]=c[f+12>>2];e=j+380|0;c[e+0>>2]=c[f+16>>2];c[e+4>>2]=c[f+20>>2];c[e+8>>2]=c[f+24>>2];c[e+12>>2]=c[f+28>>2];e=j+396|0;c[e+0>>2]=c[f+32>>2];c[e+4>>2]=c[f+36>>2];c[e+8>>2]=c[f+40>>2];c[e+12>>2]=c[f+44>>2];e=j+412|0;c[e+0>>2]=c[f+48>>2];c[e+4>>2]=c[f+52>>2];c[e+8>>2]=c[f+56>>2];c[e+12>>2]=c[f+60>>2];f=j+524|0;a[j+552>>0]=0;a[f>>0]=0;a[f+1>>0]=0;a[f+2>>0]=0;a[f+3>>0]=0;g[j+572>>2]=-1.0;g[j+444>>2]=999999984306749400.0;g[j+448>>2]=999999984306749400.0;g[j+452>>2]=999999984306749400.0;g[j+428>>2]=1.0;g[j+432>>2]=.30000001192092896;g[j+436>>2]=1.0;g[j+440>>2]=.009999999776482582;g[j+456>>2]=.05000000074505806;c[j+592>>2]=0;g[j+596>>2]=0.0;g[j+600>>2]=.699999988079071;g[j+604>>2]=0.0;i=h;return j|0}function hg(a,b,c){a=a|0;b=b|0;c=+c;var d=0;d=i;if((b|0)==4)g[a+448>>2]=c;else if((b|0)==3)g[a+452>>2]=c;else if((b|0)==5)g[a+444>>2]=c;i=d;return}function ig(b,c){b=b|0;c=c|0;a[b+524>>0]=c&1;return}function jg(a,b){a=a|0;b=+b;g[a+440>>2]=b;return}function kg(b,c){b=b|0;c=c|0;a[b+552>>0]=c&1;return}function lg(b,c){b=b|0;c=+c;g[b+572>>2]=c;a[b+553>>0]=0;return}function mg(b,c){b=b|0;c=+c;g[b+572>>2]=c;a[b+553>>0]=1;return}function ng(a,b){a=a|0;b=b|0;var c=0,d=0.0,e=0.0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0;c=i;i=i+48|0;Hc(a+364|0,c+16|0);h=-+g[c+16>>2];e=-+g[c+20>>2];m=-+g[c+24>>2];l=+g[c+28>>2];f=+g[b>>2];n=+g[b+12>>2];k=+g[b+8>>2];j=+g[b+4>>2];Hc(a+300|0,c);p=+g[c>>2];q=+g[c+12>>2];d=+g[c+8>>2];o=+g[c+4>>2];g[c+32>>2]=p*(l*n-f*h-j*e-k*m)+(l*f+n*h+k*e-j*m)*q+(f*m+(n*e+l*j)-k*h)*d-(n*m+l*k+j*h-f*e)*o;g[c+36>>2]=p*(n*m+l*k+j*h-f*e)+(q*(f*m+(n*e+l*j)-k*h)+(l*n-f*h-j*e-k*m)*o)-(l*f+n*h+k*e-j*m)*d;g[c+40>>2]=q*(n*m+l*k+j*h-f*e)+(l*n-f*h-j*e-k*m)*d+(l*f+n*h+k*e-j*m)*o-p*(f*m+(n*e+l*j)-k*h);g[c+44>>2]=(l*n-f*h-j*e-k*m)*q-p*(l*f+n*h+k*e-j*m)-(f*m+(n*e+l*j)-k*h)*o-(n*m+l*k+j*h-f*e)*d;to(a,c+32|0);i=c;return}function og(a,b){a=a|0;b=b|0;var c=0;c=i;to(a,b);i=c;return}function pg(b,c){b=b|0;c=c|0;a[b+21>>0]=c&1;return}function qg(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function rg(a,b){a=+a;b=+b;var d=0,e=0;d=i;c[5004]=(c[5004]|0)+1;e=XE(95)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}c[e+8>>2]=0;g[e+12>>2]=1.0;g[e+16>>2]=1.0;g[e+20>>2]=1.0;g[e+24>>2]=0.0;g[e+44>>2]=.03999999910593033;c[e>>2]=9704;g[e+56>>2]=a;g[e+60>>2]=b;c[e+4>>2]=11;c[e+64>>2]=0;c[e+68>>2]=1;c[e+72>>2]=2;g[e+28>>2]=a;g[e+32>>2]=b;g[e+36>>2]=a;g[e+52>>2]=a/+Q(+(a*a+b*b));i=d;return e|0}function sg(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function tg(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function ug(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function vg(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function wg(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function xg(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function yg(){var a=0,b=0;a=i;i=i+32|0;b=XE(92)|0;a:do if((b|0)==0){while(1){b=c[5158]|0;c[5158]=b+0;if((b|0)==0)break;sc[b&3]();b=XE(92)|0;if((b|0)!=0)break a}b=Ab(4)|0;c[b>>2]=20472;yb(b|0,20520,265)}while(0);c[a>>2]=0;c[a+4>>2]=0;c[a+8>>2]=4096;c[a+12>>2]=4096;c[a+16>>2]=0;c[a+20>>2]=1;py(b,a);i=a;return b|0}function zg(a){a=a|0;var b=0,d=0;b=i;d=XE(92)|0;a:do if((d|0)==0){while(1){d=c[5158]|0;c[5158]=d+0;if((d|0)==0)break;sc[d&3]();d=XE(92)|0;if((d|0)!=0)break a}d=Ab(4)|0;c[d>>2]=20472;yb(d|0,20520,265)}while(0);py(d,a);i=b;return d|0}function Ag(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Bg(a,b,d,e,f,g,h,j){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;j=j|0;var k=0.0,l=0;l=i;k=+Vb[c[(c[a>>2]|0)+12>>2]&1](a,b,d,e,f,g,h,j);i=l;return+k}function Cg(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Dg(a,b){a=+a;b=+b;var d=0,e=0;d=i;c[5004]=(c[5004]|0)+1;e=XE(95)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}c[e+8>>2]=0;g[e+12>>2]=1.0;g[e+16>>2]=1.0;g[e+20>>2]=1.0;g[e+24>>2]=0.0;g[e+44>>2]=.03999999910593033;g[e+56>>2]=a;g[e+60>>2]=b;c[e+4>>2]=11;g[e+52>>2]=a/+Q(+(a*a+b*b));c[e>>2]=9808;c[e+64>>2]=0;c[e+68>>2]=2;c[e+72>>2]=1;g[e+28>>2]=a;g[e+36>>2]=b;g[e+32>>2]=a;i=d;return e|0}function Eg(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function Fg(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function Gg(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Hg(a,b){a=+a;b=+b;var d=0,e=0;d=i;c[5004]=(c[5004]|0)+1;e=XE(95)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}c[e+8>>2]=0;g[e+12>>2]=1.0;g[e+16>>2]=1.0;g[e+20>>2]=1.0;g[e+24>>2]=0.0;g[e+44>>2]=.03999999910593033;g[e+56>>2]=a;g[e+60>>2]=b;c[e+4>>2]=11;g[e+52>>2]=a/+Q(+(a*a+b*b));c[e>>2]=9912;c[e+64>>2]=1;c[e+68>>2]=0;c[e+72>>2]=2;g[e+32>>2]=a;g[e+28>>2]=b;g[e+36>>2]=a;i=d;return e|0}function Ig(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function Jg(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function Kg(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Lg(){var a=0,b=0;a=i;c[5004]=(c[5004]|0)+1;b=XE(191)|0;if((b|0)==0)b=0;else{c[(b+19&-16)+ -4>>2]=b;b=b+19&-16}KB(b,1,1);i=a;return b|0}function Mg(a){a=a|0;var b=0,d=0;b=i;c[5004]=(c[5004]|0)+1;d=XE(191)|0;if((d|0)==0)d=0;else{c[(d+19&-16)+ -4>>2]=d;d=d+19&-16}KB(d,a,1);i=b;return d|0}function Ng(a,b){a=a|0;b=b|0;var d=0,e=0;d=i;c[5004]=(c[5004]|0)+1;e=XE(191)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}KB(e,a,b);i=d;return e|0}function Og(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,g=0;f=i;g=c[a+32>>2]|0;c[g>>2]=(c[g>>2]|0)+1;LB(a,MB(a,b,0)|0);LB(a,MB(a,d,0)|0);LB(a,MB(a,e,0)|0);i=f;return}function Pg(a,b,d,e,f){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;var g=0,h=0;g=i;h=c[a+32>>2]|0;c[h>>2]=(c[h>>2]|0)+1;LB(a,MB(a,b,f)|0);LB(a,MB(a,d,f)|0);LB(a,MB(a,e,f)|0);i=g;return}function Qg(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Rg(){var b=0,d=0;b=i;c[5004]=(c[5004]|0)+1;d=XE(131)|0;if((d|0)==0)d=0;else{c[(d+19&-16)+ -4>>2]=d;d=d+19&-16}c[d+8>>2]=0;g[d+12>>2]=1.0;g[d+16>>2]=1.0;g[d+20>>2]=1.0;g[d+24>>2]=0.0;g[d+44>>2]=.03999999910593033;c[d+52>>2]=0;g[d+56>>2]=1.0;g[d+60>>2]=1.0;g[d+64>>2]=1.0;g[d+68>>2]=0.0;g[d+72>>2]=-1.0;g[d+76>>2]=-1.0;g[d+80>>2]=-1.0;g[d+84>>2]=0.0;a[d+88>>0]=0;c[d>>2]=10376;a[d+108>>0]=1;c[d+104>>2]=0;c[d+100>>2]=0;c[d+4>>2]=4;c[d+96>>2]=0;uA(d);i=b;return d|0}function Sg(a,b){a=a|0;b=b|0;var c=0;c=i;ww(a,b,1);i=c;return}function Tg(a,b,c){a=a|0;b=b|0;c=c|0;var d=0;d=i;ww(a,b,c);i=d;return}function Ug(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function Vg(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function Wg(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Xg(){var b=0,d=0,e=0;b=i;c[5004]=(c[5004]|0)+1;d=XE(791)|0;if((d|0)==0)d=0;else{c[(d+19&-16)+ -4>>2]=d;d=d+19&-16}c[d>>2]=1025;c[d+116>>2]=0;a[d+120>>0]=0;e=d+124|0;c[e+0>>2]=0;c[e+4>>2]=0;c[e+8>>2]=0;c[e+12>>2]=0;c[e+16>>2]=0;c[e+20>>2]=0;c[e+24>>2]=0;c[e+28>>2]=0;c[d+300>>2]=0;a[d+304>>0]=0;e=d+308|0;c[e+0>>2]=0;c[e+4>>2]=0;c[e+8>>2]=0;c[e+12>>2]=0;c[e+16>>2]=0;c[e+20>>2]=0;c[e+24>>2]=0;c[e+28>>2]=0;c[d+484>>2]=0;a[d+488>>0]=0;e=d+492|0;c[e+0>>2]=0;c[e+4>>2]=0;c[e+8>>2]=0;c[e+12>>2]=0;c[e+16>>2]=0;c[e+20>>2]=0;c[e+24>>2]=0;c[e+28>>2]=0;c[d+668>>2]=0;a[d+672>>0]=0;e=d+676|0;c[e+0>>2]=0;c[e+4>>2]=0;c[e+8>>2]=0;c[e+12>>2]=0;c[e+16>>2]=0;c[e+20>>2]=0;c[e+24>>2]=0;c[e+28>>2]=0;c[d+740>>2]=0;c[d+744>>2]=0;c[d+748>>2]=0;c[d+768>>2]=0;i=b;return d|0}function Yg(a){a=a|0;return c[a+740>>2]|0}function Zg(a){a=a|0;return c[a+744>>2]|0}function _g(a){a=a|0;return c[a+748>>2]|0}function $g(a,b){a=a|0;b=b|0;return a+(b*184|0)+4|0}function ah(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function bh(a){a=a|0;var b=0,d=0,e=0,f=0,h=0,j=0,k=0.0,l=0.0,m=0.0,n=0,o=0,p=0.0,q=0,r=0.0;b=i;c[5004]=(c[5004]|0)+1;d=XE(75)|0;if((d|0)==0)d=0;else{c[(d+19&-16)+ -4>>2]=d;d=d+19&-16}c[d+8>>2]=0;h=d+12|0;g[h>>2]=1.0;e=d+16|0;g[e>>2]=1.0;f=d+20|0;g[f>>2]=1.0;g[d+24>>2]=0.0;j=d+44|0;g[j>>2]=.03999999910593033;c[d+52>>2]=0;c[d>>2]=5448;c[d+4>>2]=0;l=+g[a>>2];m=+g[a+4>>2];k=+g[a+8>>2];if(l<m)n=l<k?0:2;else n=m<k?1:2;k=+g[a+(n<<2)>>2]*.10000000149011612;if(k<.03999999910593033){r=+Js(d);p=+$b[c[(c[d>>2]|0)+48>>2]&15](d);m=+$b[c[(c[d>>2]|0)+48>>2]&15](d);q=d+28|0;r=r+ +g[q>>2];o=d+32|0;p=p+ +g[o>>2];n=d+36|0;m=m+ +g[n>>2];g[j>>2]=k;k=+$b[c[(c[d>>2]|0)+48>>2]&15](d);l=+$b[c[(c[d>>2]|0)+48>>2]&15](d);m=m- +$b[c[(c[d>>2]|0)+48>>2]&15](d);g[q>>2]=r-k;g[o>>2]=p-l;g[n>>2]=m;g[d+40>>2]=0.0;j=c[d>>2]|0}else j=5448|0;m=+$b[c[j+48>>2]&15](d);p=+$b[c[(c[d>>2]|0)+48>>2]&15](d);r=+$b[c[(c[d>>2]|0)+48>>2]&15](d);p=+g[a+4>>2]*+g[e>>2]-p;r=+g[a+8>>2]*+g[f>>2]-r;g[d+28>>2]=+g[a>>2]*+g[h>>2]-m;g[d+32>>2]=p;g[d+36>>2]=r;g[d+40>>2]=0.0;i=b;return d|0}function ch(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function dh(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function eh(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function fh(b){b=b|0;var d=0,e=0,f=0,g=0,h=0;d=i;f=XE(5260)|0;a:do if((f|0)==0){while(1){e=c[5158]|0;c[5158]=e+0;if((e|0)==0)break;sc[e&3]();f=XE(5260)|0;if((f|0)!=0)break a}g=Ab(4)|0;c[g>>2]=20472;yb(g|0,20520,265)}while(0);c[f>>2]=6808;c[f+4>>2]=2;a[f+24>>0]=1;c[f+20>>2]=0;c[f+12>>2]=0;c[f+16>>2]=0;c[f+28>>2]=13504;e=f+5256|0;c[e>>2]=b;c[f+60>>2]=69;c[f+64>>2]=Pb[c[(c[b>>2]|0)+12>>2]&127](b)|0;c[f+68>>2]=Pb[c[(c[b>>2]|0)+8>>2]&127](b)|0;b=0;do{g=0;do{h=c[e>>2]|0;c[f+(b*144|0)+(g<<2)+72>>2]=Yb[c[(c[h>>2]|0)+16>>2]&31](h,b,g)|0;g=g+1|0}while((g|0)<36);b=b+1|0}while((b|0)<36);i=d;return f|0}function gh(a){a=a|0;var b=0;b=i;a=Pb[c[(c[a>>2]|0)+36>>2]&127](a)|0;i=b;return a|0}function hh(a,b){a=a|0;b=b|0;var d=0;d=i;a=gc[c[(c[a>>2]|0)+40>>2]&31](a,b)|0;i=d;return a|0}function ih(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function jh(){var a=0,b=0;a=i;b=XE(24)|0;a:do if((b|0)==0){while(1){b=c[5158]|0;c[5158]=b+0;if((b|0)==0)break;sc[b&3]();b=XE(24)|0;if((b|0)!=0)break a}b=Ab(4)|0;c[b>>2]=20472;yb(b|0,20520,265)}while(0);g[b>>2]=5.880000114440918;g[b+4>>2]=.8299999833106995;g[b+8>>2]=.8799999952316284;g[b+12>>2]=500.0;g[b+16>>2]=10.5;g[b+20>>2]=6.0e3;i=a;return b|0}function kh(a){a=a|0;return+(+g[a>>2])}function lh(a,b){a=a|0;b=+b;g[a>>2]=b;return}function mh(a){a=a|0;return+(+g[a+4>>2])}function nh(a,b){a=a|0;b=+b;g[a+4>>2]=b;return}function oh(a){a=a|0;return+(+g[a+8>>2])}function ph(a,b){a=a|0;b=+b;g[a+8>>2]=b;return}function qh(a){a=a|0;return+(+g[a+12>>2])}function rh(a,b){a=a|0;b=+b;g[a+12>>2]=b;return}function sh(a){a=a|0;return+(+g[a+16>>2])}function th(a,b){a=a|0;b=+b;g[a+16>>2]=b;return}function uh(a){a=a|0;return+(+g[a+20>>2])}function vh(a,b){a=a|0;b=+b;g[a+20>>2]=b;return}function wh(){var a=0,b=0;a=i;c[5004]=(c[5004]|0)+1;b=XE(111)|0;if((b|0)==0)b=0;else{c[(b+19&-16)+ -4>>2]=b;b=b+19&-16}Ev(b,1);i=a;return b|0}function xh(a){a=a|0;var b=0,d=0;b=i;c[5004]=(c[5004]|0)+1;d=XE(111)|0;if((d|0)==0)d=0;else{c[(d+19&-16)+ -4>>2]=d;d=d+19&-16}Ev(d,a);i=b;return d|0}function yh(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,h=0.0,j=0,k=0,l=0,m=0,n=0,o=0,p=0.0,q=0,r=0,s=0;j=i;i=i+128|0;c[b+68>>2]=(c[b+68>>2]|0)+1;c[j+0>>2]=c[d+0>>2];c[j+4>>2]=c[d+4>>2];c[j+8>>2]=c[d+8>>2];c[j+12>>2]=c[d+12>>2];c[j+16>>2]=c[d+16>>2];c[j+20>>2]=c[d+20>>2];c[j+24>>2]=c[d+24>>2];c[j+28>>2]=c[d+28>>2];c[j+32>>2]=c[d+32>>2];c[j+36>>2]=c[d+36>>2];c[j+40>>2]=c[d+40>>2];c[j+44>>2]=c[d+44>>2];c[j+48>>2]=c[d+48>>2];c[j+52>>2]=c[d+52>>2];c[j+56>>2]=c[d+56>>2];c[j+60>>2]=c[d+60>>2];f=c[e+4>>2]|0;h=+$b[c[(c[e>>2]|0)+48>>2]&15](e);vc[c[(c[e>>2]|0)+8>>2]&127](e,d,j+112|0,j+96|0);p=+g[j+112>>2];if(+g[b+32>>2]>p)g[b+32>>2]=p;p=+g[j+96>>2];if(+g[b+48>>2]<p)g[b+48>>2]=p;p=+g[j+116>>2];if(+g[b+36>>2]>p)g[b+36>>2]=p;p=+g[j+100>>2];if(+g[b+52>>2]<p)g[b+52>>2]=p;p=+g[j+120>>2];if(+g[b+40>>2]>p)g[b+40>>2]=p;p=+g[j+104>>2];if(+g[b+56>>2]<p)g[b+56>>2]=p;d=c[b+64>>2]|0;if((d|0)==0){d=b+16|0;l=0}else{c[j+64>>2]=c[j+112>>2];c[j+68>>2]=c[j+116>>2];c[j+72>>2]=c[j+120>>2];c[j+76>>2]=c[j+124>>2];c[j+80>>2]=c[j+96>>2];c[j+84>>2]=c[j+100>>2];c[j+88>>2]=c[j+104>>2];c[j+92>>2]=c[j+108>>2];m=c[b+16>>2]|0;l=c[d+4>>2]|0;if((l|0)==0){c[5004]=(c[5004]|0)+1;o=XE(63)|0;if((o|0)!=0?(c[(o+19&-16)+ -4>>2]=o,(o+19&-16|0)!=0):0){l=(o+19&-16)+0|0;n=l+44|0;do{c[l>>2]=0;l=l+4|0}while((l|0)<(n|0));l=o+19&-16}else l=0}else c[d+4>>2]=0;c[l+32>>2]=0;c[l+36>>2]=m;c[l+40>>2]=0;c[l+0>>2]=c[j+64>>2];c[l+4>>2]=c[j+68>>2];c[l+8>>2]=c[j+72>>2];c[l+12>>2]=c[j+76>>2];c[l+16>>2]=c[j+80>>2];c[l+20>>2]=c[j+84>>2];c[l+24>>2]=c[j+88>>2];c[l+28>>2]=c[j+92>>2];Nx(d,c[d>>2]|0,l);c[d+12>>2]=(c[d+12>>2]|0)+1;d=b+16|0}o=c[d>>2]|0;if((o|0)==(c[b+20>>2]|0)?(k=(o|0)==0?1:o<<1,(o|0)<(k|0)):0){if((k|0)==0)m=0;else{c[5004]=(c[5004]|0)+1;m=XE((k*80|3)+16|0)|0;if((m|0)==0)m=0;else{c[(m+19&-16)+ -4>>2]=m;m=m+19&-16}o=c[d>>2]|0}if((o|0)>0){n=0;do{q=m+(n*80|0)|0;r=c[b+24>>2]|0;s=r+(n*80|0)|0;c[q+0>>2]=c[s+0>>2];c[q+4>>2]=c[s+4>>2];c[q+8>>2]=c[s+8>>2];c[q+12>>2]=c[s+12>>2];q=m+(n*80|0)+16|0;s=r+(n*80|0)+16|0;c[q+0>>2]=c[s+0>>2];c[q+4>>2]=c[s+4>>2];c[q+8>>2]=c[s+8>>2];c[q+12>>2]=c[s+12>>2];q=m+(n*80|0)+32|0;s=r+(n*80|0)+32|0;c[q+0>>2]=c[s+0>>2];c[q+4>>2]=c[s+4>>2];c[q+8>>2]=c[s+8>>2];c[q+12>>2]=c[s+12>>2];q=m+(n*80|0)+48|0;s=r+(n*80|0)+48|0;c[q+0>>2]=c[s+0>>2];c[q+4>>2]=c[s+4>>2];c[q+8>>2]=c[s+8>>2];c[q+12>>2]=c[s+12>>2];q=m+(n*80|0)+64|0;r=r+(n*80|0)+64|0;c[q+0>>2]=c[r+0>>2];c[q+4>>2]=c[r+4>>2];c[q+8>>2]=c[r+8>>2];c[q+12>>2]=c[r+12>>2];n=n+1|0}while((n|0)!=(o|0))}n=c[b+24>>2]|0;if((n|0)!=0){if((a[b+28>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[n+ -4>>2]|0)}c[b+24>>2]=0}a[b+28>>0]=1;c[b+24>>2]=m;c[b+20>>2]=k;o=c[d>>2]|0}s=c[b+24>>2]|0;r=s+(o*80|0)|0;c[r+0>>2]=c[j+0>>2];c[r+4>>2]=c[j+4>>2];c[r+8>>2]=c[j+8>>2];c[r+12>>2]=c[j+12>>2];r=s+(o*80|0)+16|0;c[r+0>>2]=c[j+16>>2];c[r+4>>2]=c[j+20>>2];c[r+8>>2]=c[j+24>>2];c[r+12>>2]=c[j+28>>2];r=s+(o*80|0)+32|0;c[r+0>>2]=c[j+32>>2];c[r+4>>2]=c[j+36>>2];c[r+8>>2]=c[j+40>>2];c[r+12>>2]=c[j+44>>2];r=s+(o*80|0)+48|0;c[r+0>>2]=c[j+48>>2];c[r+4>>2]=c[j+52>>2];c[r+8>>2]=c[j+56>>2];c[r+12>>2]=c[j+60>>2];s=s+(o*80|0)+64|0;c[s>>2]=e;c[s+4>>2]=f;g[s+8>>2]=h;c[s+12>>2]=l;c[d>>2]=(c[d>>2]|0)+1;i=j;return}function zh(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function Ah(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function Bh(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Ch(a,d){a=a|0;d=d|0;var e=0,f=0,h=0;e=i;f=XE(80)|0;a:do if((f|0)==0){while(1){f=c[5158]|0;c[5158]=f+0;if((f|0)==0)break;sc[f&3]();f=XE(80)|0;if((f|0)!=0)break a}f=Ab(4)|0;c[f>>2]=20472;yb(f|0,20520,265)}while(0);g[f+4>>2]=1.0;b[f+8>>1]=1;b[f+10>>1]=-1;c[f>>2]=688;h=f+12|0;c[h+0>>2]=c[a+0>>2];c[h+4>>2]=c[a+4>>2];c[h+8>>2]=c[a+8>>2];c[h+12>>2]=c[a+12>>2];a=f+28|0;c[a+0>>2]=c[d+0>>2];c[a+4>>2]=c[d+4>>2];c[a+8>>2]=c[d+8>>2];c[a+12>>2]=c[d+12>>2];c[f+76>>2]=0;i=e;return f|0}function Dh(a){a=a|0;return+g[a+4>>2]<1.0|0}function Eh(a){a=a|0;return a+12|0}function Fh(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+12>>2]=c[b+0>>2];c[a+16>>2]=c[b+4>>2];c[a+20>>2]=c[b+8>>2];c[a+24>>2]=c[b+12>>2];i=d;return}function Gh(a){a=a|0;return a+28|0}function Hh(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+28>>2]=c[b+0>>2];c[a+32>>2]=c[b+4>>2];c[a+36>>2]=c[b+8>>2];c[a+40>>2]=c[b+12>>2];i=d;return}function Ih(a){a=a|0;return a+44|0}function Jh(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+44>>2]=c[b+0>>2];c[a+48>>2]=c[b+4>>2];c[a+52>>2]=c[b+8>>2];c[a+56>>2]=c[b+12>>2];i=d;return}function Kh(a){a=a|0;return a+60|0}function Lh(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+60>>2]=c[b+0>>2];c[a+64>>2]=c[b+4>>2];c[a+68>>2]=c[b+8>>2];c[a+72>>2]=c[b+12>>2];i=d;return}function Mh(a){a=a|0;return b[a+8>>1]|0}function Nh(a,c){a=a|0;c=c|0;b[a+8>>1]=c;return}function Oh(a){a=a|0;return b[a+10>>1]|0}function Ph(a,c){a=a|0;c=c|0;b[a+10>>1]=c;return}function Qh(a){a=a|0;return+(+g[a+4>>2])}function Rh(a,b){a=a|0;b=+b;g[a+4>>2]=b;return}function Sh(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Th(){var a=0,b=0;a=i;c[5004]=(c[5004]|0)+1;b=XE(219)|0;if((b|0)==0)b=0;else{c[(b+19&-16)+ -4>>2]=b;b=b+19&-16}Vh();Vh();Uh(b,464,464);i=a;return b|0}function Uh(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0;e=i;c[a>>2]=600;f=a+4|0;do f=f+16|0;while((f|0)!=(a+52|0));c[a+4>>2]=c[b+0>>2];c[a+8>>2]=c[b+4>>2];c[a+12>>2]=c[b+8>>2];c[a+16>>2]=c[b+12>>2];c[a+20>>2]=c[b+16>>2];c[a+24>>2]=c[b+20>>2];c[a+28>>2]=c[b+24>>2];c[a+32>>2]=c[b+28>>2];c[a+36>>2]=c[b+32>>2];c[a+40>>2]=c[b+36>>2];c[a+44>>2]=c[b+40>>2];c[a+48>>2]=c[b+44>>2];c[a+52>>2]=c[b+48>>2];c[a+56>>2]=c[b+52>>2];c[a+60>>2]=c[b+56>>2];c[a+64>>2]=c[b+60>>2];f=a+68|0;do f=f+16|0;while((f|0)!=(a+116|0));c[a+68>>2]=c[d+0>>2];c[a+72>>2]=c[d+4>>2];c[a+76>>2]=c[d+8>>2];c[a+80>>2]=c[d+12>>2];c[a+84>>2]=c[d+16>>2];c[a+88>>2]=c[d+20>>2];c[a+92>>2]=c[d+24>>2];c[a+96>>2]=c[d+28>>2];c[a+100>>2]=c[d+32>>2];c[a+104>>2]=c[d+36>>2];c[a+108>>2]=c[d+40>>2];c[a+112>>2]=c[d+44>>2];c[a+116>>2]=c[d+48>>2];c[a+120>>2]=c[d+52>>2];c[a+124>>2]=c[d+56>>2];c[a+128>>2]=c[d+60>>2];d=a+132|0;do d=d+16|0;while((d|0)!=(a+180|0));c[a+132>>2]=c[b+0>>2];c[a+136>>2]=c[b+4>>2];c[a+140>>2]=c[b+8>>2];c[a+144>>2]=c[b+12>>2];c[a+148>>2]=c[b+16>>2];c[a+152>>2]=c[b+20>>2];c[a+156>>2]=c[b+24>>2];c[a+160>>2]=c[b+28>>2];c[a+164>>2]=c[b+32>>2];c[a+168>>2]=c[b+36>>2];c[a+172>>2]=c[b+40>>2];c[a+176>>2]=c[b+44>>2];c[a+180>>2]=c[b+48>>2];c[a+184>>2]=c[b+52>>2];c[a+188>>2]=c[b+56>>2];c[a+192>>2]=c[b+60>>2];c[a+196>>2]=0;i=e;return}function Vh(){var b=0,d=0;b=i;i=i+48|0;if((a[528]|0)!=0){i=b;return}if((Ya(528)|0)==0){i=b;return}if((a[584]|0)==0?(Ya(584)|0)!=0:0){g[b+32>>2]=1.0;g[b+28>>2]=0.0;g[b+24>>2]=0.0;g[b+20>>2]=0.0;g[b+16>>2]=1.0;g[b+12>>2]=0.0;g[b+8>>2]=0.0;g[b+4>>2]=0.0;g[b>>2]=1.0;Zn(536,b+32|0,b+28|0,b+24|0,b+20|0,b+16|0,b+12|0,b+8|0,b+4|0,b);bb(584);d=464}else d=464;do d=d+16|0;while((d|0)!=512);c[116]=c[134];c[117]=c[135];c[118]=c[136];c[119]=c[137];c[120]=c[138];c[121]=c[139];c[122]=c[140];c[123]=c[141];c[124]=c[142];c[125]=c[143];c[126]=c[144];c[127]=c[145];c[128]=0;c[129]=0;c[130]=0;c[131]=0;bb(528);i=b;return}function Wh(a){a=a|0;var b=0,d=0;b=i;c[5004]=(c[5004]|0)+1;d=XE(219)|0;if((d|0)==0)d=0;else{c[(d+19&-16)+ -4>>2]=d;d=d+19&-16}Vh();Uh(d,a,464);i=b;return d|0}function Xh(a,b){a=a|0;b=b|0;var d=0,e=0;d=i;c[5004]=(c[5004]|0)+1;e=XE(219)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}Uh(e,a,b);i=d;return e|0}function Yh(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+8>>2]&127](a,b);i=d;return}function Zh(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+12>>2]&127](a,b);i=d;return}function _h(a){a=a|0;return a+4|0}function $h(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+4>>2]=c[b+0>>2];c[a+8>>2]=c[b+4>>2];c[a+12>>2]=c[b+8>>2];c[a+16>>2]=c[b+12>>2];c[a+20>>2]=c[b+16>>2];c[a+24>>2]=c[b+20>>2];c[a+28>>2]=c[b+24>>2];c[a+32>>2]=c[b+28>>2];c[a+36>>2]=c[b+32>>2];c[a+40>>2]=c[b+36>>2];c[a+44>>2]=c[b+40>>2];c[a+48>>2]=c[b+44>>2];c[a+52>>2]=c[b+48>>2];c[a+56>>2]=c[b+52>>2];c[a+60>>2]=c[b+56>>2];c[a+64>>2]=c[b+60>>2];i=d;return}function ai(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function bi(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function ci(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function di(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function ei(a){a=a|0;var b=0;b=i;a=Pb[c[(c[a>>2]|0)+36>>2]&127](a)|0;i=b;return a|0}function fi(a,b){a=a|0;b=b|0;var d=0;d=i;a=gc[c[(c[a>>2]|0)+40>>2]&31](a,b)|0;i=d;return a|0}function gi(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function hi(a,d){a=a|0;d=d|0;var e=0,f=0,h=0;e=i;f=XE(84)|0;a:do if((f|0)==0){while(1){f=c[5158]|0;c[5158]=f+0;if((f|0)==0)break;sc[f&3]();f=XE(84)|0;if((f|0)!=0)break a}f=Ab(4)|0;c[f>>2]=20472;yb(f|0,20520,265)}while(0);g[f+4>>2]=1.0;c[f+8>>2]=0;b[f+12>>1]=1;b[f+14>>1]=-1;c[f+16>>2]=0;c[f>>2]=336;h=f+20|0;c[h+0>>2]=c[a+0>>2];c[h+4>>2]=c[a+4>>2];c[h+8>>2]=c[a+8>>2];c[h+12>>2]=c[a+12>>2];a=f+36|0;c[a+0>>2]=c[d+0>>2];c[a+4>>2]=c[d+4>>2];c[a+8>>2]=c[d+8>>2];c[a+12>>2]=c[d+12>>2];i=e;return f|0}function ii(a){a=a|0;return(c[a+8>>2]|0)!=0|0}function ji(a){a=a|0;return a+20|0}function ki(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+20>>2]=c[b+0>>2];c[a+24>>2]=c[b+4>>2];c[a+28>>2]=c[b+8>>2];c[a+32>>2]=c[b+12>>2];i=d;return}function li(a){a=a|0;return a+36|0}function mi(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+36>>2]=c[b+0>>2];c[a+40>>2]=c[b+4>>2];c[a+44>>2]=c[b+8>>2];c[a+48>>2]=c[b+12>>2];i=d;return}function ni(a){a=a|0;return a+52|0}function oi(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+52>>2]=c[b+0>>2];c[a+56>>2]=c[b+4>>2];c[a+60>>2]=c[b+8>>2];c[a+64>>2]=c[b+12>>2];i=d;return}function pi(a){a=a|0;return a+68|0}function qi(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+68>>2]=c[b+0>>2];c[a+72>>2]=c[b+4>>2];c[a+76>>2]=c[b+8>>2];c[a+80>>2]=c[b+12>>2];i=d;return}function ri(a){a=a|0;return b[a+12>>1]|0}function si(a,c){a=a|0;c=c|0;b[a+12>>1]=c;return}function ti(a){a=a|0;return b[a+14>>1]|0}function ui(a,c){a=a|0;c=c|0;b[a+14>>1]=c;return}function vi(a){a=a|0;return c[a+8>>2]|0}function wi(a,b){a=a|0;b=b|0;c[a+8>>2]=b;return}function xi(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function yi(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+64>>2]&127](a,b);i=d;return}function zi(a){a=a|0;return c[a+24>>2]|0}function Ai(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;vc[c[(c[a>>2]|0)+32>>2]&127](a,b,d,e);i=f;return}function Bi(a){a=a|0;var b=0;b=i;a=c[a+68>>2]|0;a=Pb[c[(c[a>>2]|0)+36>>2]&127](a)|0;i=b;return a|0}function Ci(a){a=a|0;return a+28|0}function Di(a,b){a=a|0;b=b|0;var d=0;d=i;vc[c[(c[a>>2]|0)+36>>2]&127](a,b,1,-1);i=d;return}function Ei(a,b,d){a=a|0;b=b|0;d=d|0;var e=0;e=i;vc[c[(c[a>>2]|0)+36>>2]&127](a,b,d,-1);i=e;return}function Fi(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;vc[c[(c[a>>2]|0)+36>>2]&127](a,b,d,e);i=f;return}function Gi(a){a=a|0;return c[a+68>>2]|0}function Hi(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=+f;var g=0;g=i;Eu(a,b,c,d,e,f);i=g;return}function Ii(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;e=i;Gu(a,b,c,d);i=e;return}function Ji(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Ki(a,b){a=+a;b=+b;var d=0,e=0;d=i;c[5004]=(c[5004]|0)+1;e=XE(75)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}c[e+8>>2]=0;g[e+12>>2]=1.0;g[e+16>>2]=1.0;g[e+20>>2]=1.0;g[e+24>>2]=0.0;g[e+44>>2]=.03999999910593033;c[e+4>>2]=10;c[e>>2]=6400;c[e+52>>2]=0;g[e+28>>2]=b*.5;g[e+32>>2]=a;g[e+36>>2]=a;g[e+40>>2]=0.0;i=d;return e|0}function Li(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function Mi(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function Ni(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Oi(a,b,d,e){a=+a;b=+b;d=+d;e=+e;var f=0,h=0;f=i;h=XE(16)|0;a:do if((h|0)==0){while(1){h=c[5158]|0;c[5158]=h+0;if((h|0)==0)break;sc[h&3]();h=XE(16)|0;if((h|0)!=0)break a}h=Ab(4)|0;c[h>>2]=20472;yb(h|0,20520,265)}while(0);g[h>>2]=a;g[h+4>>2]=b;g[h+8>>2]=d;g[h+12>>2]=e;i=f;return h|0}function Pi(a,b,c,d,e){a=a|0;b=+b;c=+c;d=+d;e=+e;g[a>>2]=b;g[a+4>>2]=c;g[a+8>>2]=d;g[a+12>>2]=e;return}function Qi(a){a=a|0;return+(+g[a>>2])}function Ri(a){a=a|0;return+(+g[a+4>>2])}function Si(a){a=a|0;return+(+g[a+8>>2])}function Ti(a){a=a|0;return+(+g[a+12>>2])}function Ui(a,b){a=a|0;b=+b;g[a>>2]=b;return}function Vi(a,b){a=a|0;b=+b;g[a+4>>2]=b;return}function Wi(a,b){a=a|0;b=+b;g[a+8>>2]=b;return}function Xi(a,b){a=a|0;b=+b;g[a+12>>2]=b;return}function Yi(a){a=a|0;var b=0;b=i;if((a|0)!=0)YE(a);i=b;return}function Zi(a,b){a=+a;b=+b;var d=0,e=0;d=i;c[5004]=(c[5004]|0)+1;e=XE(75)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}c[e+8>>2]=0;g[e+12>>2]=1.0;g[e+16>>2]=1.0;g[e+20>>2]=1.0;g[e+24>>2]=0.0;g[e+44>>2]=.03999999910593033;c[e+4>>2]=10;c[e>>2]=6504;c[e+52>>2]=2;g[e+28>>2]=a;g[e+32>>2]=a;g[e+36>>2]=b*.5;g[e+40>>2]=0.0;i=d;return e|0}function _i(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function $i(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function aj(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function bj(a){a=a|0;var b=0,d=0;b=i;d=XE(8)|0;a:do if((d|0)==0){while(1){d=c[5158]|0;c[5158]=d+0;if((d|0)==0)break;sc[d&3]();d=XE(8)|0;if((d|0)!=0)break a}d=Ab(4)|0;c[d>>2]=20472;yb(d|0,20520,265)}while(0);c[d>>2]=3832;c[d+4>>2]=a;i=b;return d|0}function cj(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function dj(a){a=a|0;return(c[a+8>>2]|0)!=0|0}function ej(a){a=a|0;return b[a+12>>1]|0}function fj(a,c){a=a|0;c=c|0;b[a+12>>1]=c;return}function gj(a){a=a|0;return b[a+14>>1]|0}function hj(a,c){a=a|0;c=c|0;b[a+14>>1]=c;return}function ij(a){a=a|0;return c[a+8>>2]|0}function jj(a,b){a=a|0;b=b|0;c[a+8>>2]=b;return}function kj(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function lj(a){a=a|0;return+(+g[a+216>>2])}function mj(a,b){a=a|0;b=+b;g[a+216>>2]=b;return}function nj(a){a=a|0;return+(+g[a+228>>2])}function oj(a,b){a=a|0;b=+b;g[a+228>>2]=b;return}function pj(a){a=a|0;return+(+g[a+244>>2])}function qj(a,b){a=a|0;b=+b;g[a+244>>2]=b;return}function rj(a){a=a|0;return+(+g[a+204>>2])}function sj(a,b){a=a|0;b=+b;g[a+204>>2]=b;return}function tj(a){a=a|0;return+(+g[a+212>>2])}function uj(a,b){a=a|0;b=+b;g[a+212>>2]=b;return}function vj(a){a=a|0;return+(+g[a+220>>2])}function wj(a,b){a=a|0;b=+b;g[a+220>>2]=b;return}function xj(a){a=a|0;return+(+g[a+224>>2])}function yj(a,b){a=a|0;b=+b;g[a+224>>2]=b;return}function zj(a){a=a|0;return+(+g[a+232>>2])}function Aj(a,b){a=a|0;b=+b;g[a+232>>2]=b;return}function Bj(a){a=a|0;return+(+g[a+248>>2])}function Cj(a,b){a=a|0;b=+b;g[a+248>>2]=b;return}function Dj(a){a=a|0;return+(+g[a+208>>2])}function Ej(a,b){a=a|0;b=+b;g[a+208>>2]=b;return}function Fj(a){a=a|0;var b=0;b=i;if((a|0)!=0)YE(a);i=b;return}function Gj(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function Hj(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function Ij(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Jj(){var a=0,b=0;a=i;c[5004]=(c[5004]|0)+1;b=XE(35)|0;if((b|0)==0){b=0;i=a;return b|0}c[(b+19&-16)+ -4>>2]=b;b=b+19&-16;i=a;return b|0}function Kj(a,b,d,e){a=+a;b=+b;d=+d;e=+e;var f=0,h=0;f=i;c[5004]=(c[5004]|0)+1;h=XE(35)|0;if((h|0)==0)h=0;else{c[(h+19&-16)+ -4>>2]=h;h=h+19&-16}g[h>>2]=a;g[h+4>>2]=b;g[h+8>>2]=d;g[h+12>>2]=e;i=f;return h|0}function Lj(a){a=a|0;return+(+g[a+12>>2])}function Mj(a,b,c,d,e){a=a|0;b=+b;c=+c;d=+d;e=+e;g[a>>2]=b;g[a+4>>2]=c;g[a+8>>2]=d;g[a+12>>2]=e;return}function Nj(a){a=a|0;var b=0.0,c=0.0,d=0.0;d=+g[a>>2];c=+g[a+4>>2];b=+g[a+8>>2];b=+Q(+(d*d+c*c+b*b));return+b}function Oj(a){a=a|0;return+(+g[a>>2])}function Pj(a){a=a|0;return+(+g[a+4>>2])}function Qj(a){a=a|0;return+(+g[a+8>>2])}function Rj(a,b){a=a|0;b=+b;g[a>>2]=b;return}function Sj(a,b){a=a|0;b=+b;g[a+4>>2]=b;return}function Tj(a,b){a=a|0;b=+b;g[a+8>>2]=b;return}function Uj(a,b){a=a|0;b=+b;g[a>>2]=+g[a>>2]*b;g[a+4>>2]=+g[a+4>>2]*b;g[a+8>>2]=+g[a+8>>2]*b;return a|0}function Vj(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function Wj(b,d,e){b=b|0;d=d|0;e=+e;var f=0,h=0,j=0,k=0;f=i;c[5004]=(c[5004]|0)+1;h=XE(203)|0;if((h|0)==0)h=0;else{c[(h+19&-16)+ -4>>2]=h;h=h+19&-16}c[h>>2]=2632;a[h+144>>0]=1;c[h+140>>2]=0;c[h+132>>2]=0;c[h+136>>2]=0;c[h+176>>2]=1;g[h+56>>2]=.019999999552965164;k=h+60|0;j=h+170|0;c[k+0>>2]=0;c[k+4>>2]=0;c[k+8>>2]=0;c[k+12>>2]=0;a[j>>0]=1;c[h+8>>2]=b;g[h+52>>2]=e;g[h+48>>2]=0.0;c[h+12>>2]=d;a[h+171>>0]=1;g[h+172>>2]=0.0;g[h+16>>2]=0.0;g[h+20>>2]=0.0;g[h+44>>2]=29.399999618530273;g[h+24>>2]=55.0;g[h+28>>2]=10.0;a[h+168>>0]=0;a[h+169>>0]=0;a[h+180>>0]=1;g[h+36>>2]=.7853981852531433;g[h+40>>2]=.7071067690849304;g[h+108>>2]=0.0;a[h+181>>0]=0;a[h+182>>0]=0;i=f;return h|0}function Xj(b,d,e,f){b=b|0;d=d|0;e=+e;f=f|0;var h=0,j=0,k=0;h=i;c[5004]=(c[5004]|0)+1;j=XE(203)|0;if((j|0)==0)j=0;else{c[(j+19&-16)+ -4>>2]=j;j=j+19&-16}c[j>>2]=2632;a[j+144>>0]=1;c[j+140>>2]=0;c[j+132>>2]=0;c[j+136>>2]=0;c[j+176>>2]=f;g[j+56>>2]=.019999999552965164;k=j+60|0;f=j+170|0;c[k+0>>2]=0;c[k+4>>2]=0;c[k+8>>2]=0;c[k+12>>2]=0;a[f>>0]=1;c[j+8>>2]=b;g[j+52>>2]=e;g[j+48>>2]=0.0;c[j+12>>2]=d;a[j+171>>0]=1;g[j+172>>2]=0.0;g[j+16>>2]=0.0;g[j+20>>2]=0.0;g[j+44>>2]=29.399999618530273;g[j+24>>2]=55.0;g[j+28>>2]=10.0;a[j+168>>0]=0;a[j+169>>0]=0;a[j+180>>0]=1;g[j+36>>2]=.7853981852531433;g[j+40>>2]=.7071067690849304;g[j+108>>2]=0.0;a[j+181>>0]=0;a[j+182>>0]=0;i=h;return j|0}function Yj(a,b){a=a|0;b=b|0;if((b|0)<0)b=0;else b=(b|0)>2?2:b;c[a+176>>2]=b;return}function Zj(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+16>>2]&127](a,b);i=d;return}function _j(a,b,d){a=a|0;b=b|0;d=+d;var e=0;e=i;tc[c[(c[a>>2]|0)+20>>2]&7](a,b,d);i=e;return}function $j(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+28>>2]&127](a,b);i=d;return}function ak(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+32>>2]&127](a,b);i=d;return}function bk(a,b,d){a=a|0;b=b|0;d=+d;var e=0;e=i;tc[c[(c[a>>2]|0)+36>>2]&7](a,b,d);i=e;return}function ck(a,b){a=a|0;b=+b;g[a+24>>2]=b;return}function dk(a,b){a=a|0;b=+b;g[a+28>>2]=b;return}function ek(a,b){a=a|0;b=+b;g[a+32>>2]=b;return}function fk(a){a=a|0;var b=0;b=i;a=Pb[c[(c[a>>2]|0)+40>>2]&127](a)|0;i=b;return a|0}function gk(a){a=a|0;var b=0;b=i;Lb[c[(c[a>>2]|0)+44>>2]&511](a);i=b;return}function hk(a,b){a=a|0;b=+b;g[a+44>>2]=b;return}function ik(a){a=a|0;return+(+g[a+44>>2])}function jk(a,b){a=a|0;b=+b;g[a+36>>2]=b;g[a+40>>2]=+S(+b);return}function kk(a){a=a|0;return+(+g[a+36>>2])}function lk(a){a=a|0;return c[a+8>>2]|0}function mk(b,c){b=b|0;c=c|0;a[b+170>>0]=c&1;return}function nk(a){a=a|0;var b=0;b=i;a=Pb[c[(c[a>>2]|0)+48>>2]&127](a)|0;i=b;return a|0}function ok(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function pk(a,b){a=a|0;b=+b;var d=0,e=0,f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0;d=i;c[5004]=(c[5004]|0)+1;e=XE(103)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}f=e+4|0;c[f>>2]=35;c[e+8>>2]=0;g[e+12>>2]=0.0;c[e>>2]=16992;m=+g[a>>2];l=+g[a+4>>2];k=+g[a+8>>2];h=+g[a+12>>2];j=1.0/+Q(+(m*m+l*l+k*k));g[e+48>>2]=m*j;g[e+52>>2]=l*j;g[e+56>>2]=k*j;g[e+60>>2]=h;g[e+64>>2]=b;a=e+68|0;c[a+0>>2]=0;c[a+4>>2]=0;c[a+8>>2]=0;c[a+12>>2]=0;c[f>>2]=28;i=d;return e|0}function qk(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function rk(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function sk(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function tk(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function uk(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+60>>2]&127](a,b);i=d;return}function vk(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function wk(){var a=0,b=0;a=i;c[5004]=(c[5004]|0)+1;b=XE(35)|0;if((b|0)==0){b=0;i=a;return b|0}c[(b+19&-16)+ -4>>2]=b;b=b+19&-16;i=a;return b|0}function xk(a,b,d){a=+a;b=+b;d=+d;var e=0,f=0;e=i;c[5004]=(c[5004]|0)+1;f=XE(35)|0;if((f|0)==0)f=0;else{c[(f+19&-16)+ -4>>2]=f;f=f+19&-16}g[f>>2]=a;g[f+4>>2]=b;g[f+8>>2]=d;g[f+12>>2]=0.0;i=e;return f|0}function yk(a){a=a|0;var b=0.0,c=0.0,d=0.0;d=+g[a>>2];c=+g[a+4>>2];b=+g[a+8>>2];b=+Q(+(d*d+c*c+b*b));return+b}function zk(a){a=a|0;return+(+g[a>>2])}function Ak(a){a=a|0;return+(+g[a+4>>2])}function Bk(a){a=a|0;return+(+g[a+8>>2])}function Ck(a,b){a=a|0;b=+b;g[a>>2]=b;return}function Dk(a,b){a=a|0;b=+b;g[a+4>>2]=b;return}function Ek(a,b){a=a|0;b=+b;g[a+8>>2]=b;return}function Fk(a,b,c,d){a=a|0;b=+b;c=+c;d=+d;g[a>>2]=b;g[a+4>>2]=c;g[a+8>>2]=d;g[a+12>>2]=0.0;return}function Gk(a,b){a=a|0;b=+b;g[a>>2]=+g[a>>2]*b;g[a+4>>2]=+g[a+4>>2]*b;g[a+8>>2]=+g[a+8>>2]*b;return a|0}function Hk(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function Ik(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Jk(a){a=+a;var b=0,d=0;b=i;c[5004]=(c[5004]|0)+1;d=XE(71)|0;if((d|0)==0)d=0;else{c[(d+19&-16)+ -4>>2]=d;d=d+19&-16}c[d+8>>2]=0;g[d+12>>2]=1.0;g[d+16>>2]=1.0;g[d+20>>2]=1.0;g[d+24>>2]=0.0;c[d>>2]=16680;c[d+4>>2]=8;g[d+28>>2]=a;g[d+44>>2]=a;i=b;return d|0}function Kk(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function Lk(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function Mk(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Nk(){var a=0,b=0;a=i;b=XE(24)|0;a:do if((b|0)==0){while(1){b=c[5158]|0;c[5158]=b+0;if((b|0)==0)break;sc[b&3]();b=XE(24)|0;if((b|0)!=0)break a}b=Ab(4)|0;c[b>>2]=20472;yb(b|0,20520,265)}while(0);c[b>>2]=0;c[b+4>>2]=0;c[b+8>>2]=4096;c[b+12>>2]=4096;c[b+16>>2]=0;c[b+20>>2]=1;i=a;return b|0}function Ok(a){a=a|0;var b=0;b=i;if((a|0)!=0)YE(a);i=b;return}function Pk(a,b){a=a|0;b=b|0;var d=0,e=0;d=i;c[5004]=(c[5004]|0)+1;e=XE(783)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}bq(e,a,b,0);i=d;return e|0}function Qk(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0;e=i;c[5004]=(c[5004]|0)+1;f=XE(783)|0;if((f|0)==0)f=0;else{c[(f+19&-16)+ -4>>2]=f;f=f+19&-16}bq(f,a,b,d);i=e;return f|0}function Rk(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var h=0,j=0;h=i;c[5004]=(c[5004]|0)+1;j=XE(783)|0;if((j|0)==0)j=0;else{c[(j+19&-16)+ -4>>2]=j;j=j+19&-16}c[j+4>>2]=4;c[j+8>>2]=-1;c[j+12>>2]=-1;g[j+16>>2]=3.4028234663852886e+38;a[j+20>>0]=1;a[j+21>>0]=0;c[j+24>>2]=-1;c[j+28>>2]=b;c[j+32>>2]=d;g[j+36>>2]=0.0;g[j+40>>2]=.30000001192092896;c[j+44>>2]=0;c[j>>2]=2504;d=j+552|0;c[d+0>>2]=c[e+0>>2];c[d+4>>2]=c[e+4>>2];c[d+8>>2]=c[e+8>>2];c[d+12>>2]=c[e+12>>2];d=j+568|0;c[d+0>>2]=c[e+16>>2];c[d+4>>2]=c[e+20>>2];c[d+8>>2]=c[e+24>>2];c[d+12>>2]=c[e+28>>2];d=j+584|0;c[d+0>>2]=c[e+32>>2];c[d+4>>2]=c[e+36>>2];c[d+8>>2]=c[e+40>>2];c[d+12>>2]=c[e+44>>2];d=j+600|0;c[d+0>>2]=c[e+48>>2];c[d+4>>2]=c[e+52>>2];c[d+8>>2]=c[e+56>>2];c[d+12>>2]=c[e+60>>2];e=j+616|0;c[e+0>>2]=c[f+0>>2];c[e+4>>2]=c[f+4>>2];c[e+8>>2]=c[f+8>>2];c[e+12>>2]=c[f+12>>2];e=j+632|0;c[e+0>>2]=c[f+16>>2];c[e+4>>2]=c[f+20>>2];c[e+8>>2]=c[f+24>>2];c[e+12>>2]=c[f+28>>2];e=j+648|0;c[e+0>>2]=c[f+32>>2];c[e+4>>2]=c[f+36>>2];c[e+8>>2]=c[f+40>>2];c[e+12>>2]=c[f+44>>2];e=j+664|0;c[e+0>>2]=c[f+48>>2];c[e+4>>2]=c[f+52>>2];c[e+8>>2]=c[f+56>>2];c[e+12>>2]=c[f+60>>2];g[j+688>>2]=0.0;g[j+692>>2]=-1.0;g[j+696>>2]=.8999999761581421;g[j+700>>2]=.30000001192092896;g[j+704>>2]=1.0;g[j+708>>2]=0.0;g[j+712>>2]=0.0;a[j+716>>0]=0;a[j+736>>0]=0;a[j+737>>0]=0;a[j+738>>0]=0;a[j+739>>0]=1;a[j+740>>0]=0;c[j+748>>2]=0;g[j+732>>2]=1.0;i=h;return j|0}function Sk(b,d,e,f,h){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0,k=0;j=i;c[5004]=(c[5004]|0)+1;k=XE(783)|0;if((k|0)==0)k=0;else{c[(k+19&-16)+ -4>>2]=k;k=k+19&-16}c[k+4>>2]=4;c[k+8>>2]=-1;c[k+12>>2]=-1;g[k+16>>2]=3.4028234663852886e+38;a[k+20>>0]=1;a[k+21>>0]=0;c[k+24>>2]=-1;c[k+28>>2]=b;c[k+32>>2]=d;g[k+36>>2]=0.0;g[k+40>>2]=.30000001192092896;c[k+44>>2]=0;c[k>>2]=2504;d=k+552|0;c[d+0>>2]=c[e+0>>2];c[d+4>>2]=c[e+4>>2];c[d+8>>2]=c[e+8>>2];c[d+12>>2]=c[e+12>>2];d=k+568|0;c[d+0>>2]=c[e+16>>2];c[d+4>>2]=c[e+20>>2];c[d+8>>2]=c[e+24>>2];c[d+12>>2]=c[e+28>>2];d=k+584|0;c[d+0>>2]=c[e+32>>2];c[d+4>>2]=c[e+36>>2];c[d+8>>2]=c[e+40>>2];c[d+12>>2]=c[e+44>>2];d=k+600|0;c[d+0>>2]=c[e+48>>2];c[d+4>>2]=c[e+52>>2];c[d+8>>2]=c[e+56>>2];c[d+12>>2]=c[e+60>>2];e=k+616|0;c[e+0>>2]=c[f+0>>2];c[e+4>>2]=c[f+4>>2];c[e+8>>2]=c[f+8>>2];c[e+12>>2]=c[f+12>>2];e=k+632|0;c[e+0>>2]=c[f+16>>2];c[e+4>>2]=c[f+20>>2];c[e+8>>2]=c[f+24>>2];c[e+12>>2]=c[f+28>>2];e=k+648|0;c[e+0>>2]=c[f+32>>2];c[e+4>>2]=c[f+36>>2];c[e+8>>2]=c[f+40>>2];c[e+12>>2]=c[f+44>>2];e=k+664|0;c[e+0>>2]=c[f+48>>2];c[e+4>>2]=c[f+52>>2];c[e+8>>2]=c[f+56>>2];c[e+12>>2]=c[f+60>>2];g[k+688>>2]=0.0;g[k+692>>2]=-1.0;g[k+696>>2]=.8999999761581421;g[k+700>>2]=.30000001192092896;g[k+704>>2]=1.0;g[k+708>>2]=0.0;g[k+712>>2]=0.0;a[k+716>>0]=0;a[k+736>>0]=0;a[k+737>>0]=0;a[k+738>>0]=0;a[k+739>>0]=1;a[k+740>>0]=h&1;c[k+748>>2]=0;g[k+732>>2]=h?-1.0:1.0;i=j;return k|0}function Tk(a,b,d,e,f,g){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;g=g|0;var h=0,j=0;h=i;c[5004]=(c[5004]|0)+1;j=XE(783)|0;if((j|0)==0)j=0;else{c[(j+19&-16)+ -4>>2]=j;j=j+19&-16}aq(j,a,b,d,e,f,g,0);i=h;return j|0}function Uk(a,b,d,e,f,g,h){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;var j=0,k=0;j=i;c[5004]=(c[5004]|0)+1;k=XE(783)|0;if((k|0)==0)k=0;else{c[(k+19&-16)+ -4>>2]=k;k=k+19&-16}aq(k,a,b,d,e,f,g,h);i=j;return k|0}function Vk(a,b,c,d,e){a=a|0;b=+b;c=+c;d=+d;e=+e;var f=0;f=i;g[a+692>>2]=(c-b)*.5;b=+ab(+((c-b)*.5+b),6.2831854820251465);if(!(b<-3.1415927410125732)){if(b>3.1415927410125732)b=b+-6.2831854820251465}else b=b+6.2831854820251465;g[a+688>>2]=b;g[a+696>>2]=d;g[a+700>>2]=e;g[a+704>>2]=1.0;i=f;return}function Wk(a,b,c,d,e,f){a=a|0;b=+b;c=+c;d=+d;e=+e;f=+f;var h=0;h=i;g[a+692>>2]=(c-b)*.5;b=+ab(+((c-b)*.5+b),6.2831854820251465);if(!(b<-3.1415927410125732)){if(b>3.1415927410125732)b=b+-6.2831854820251465}else b=b+6.2831854820251465;g[a+688>>2]=b;g[a+696>>2]=d;g[a+700>>2]=e;g[a+704>>2]=f;i=h;return}function Xk(b,c){b=b|0;c=c|0;a[b+21>>0]=c&1;return}function Yk(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Zk(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function _k(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function $k(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function al(){var a=0,b=0;a=i;b=XE(12)|0;a:do if((b|0)==0){while(1){b=c[5158]|0;c[5158]=b+0;if((b|0)==0)break;sc[b&3]();b=XE(12)|0;if((b|0)!=0)break a}b=Ab(4)|0;c[b>>2]=20472;yb(b|0,20520,265)}while(0);g[b>>2]=.30000001192092896;g[b+4>>2]=1.0;g[b+8>>2]=0.0;i=a;return b|0}function bl(a){a=a|0;return+(+g[a>>2])}function cl(a,b){a=a|0;b=+b;g[a>>2]=b;return}function dl(a){a=a|0;return+(+g[a+4>>2])}function el(a,b){a=a|0;b=+b;g[a+4>>2]=b;return}function fl(a){a=a|0;return+(+g[a+8>>2])}function gl(a,b){a=a|0;b=+b;g[a+8>>2]=b;return}function hl(a){a=a|0;var b=0;b=i;if((a|0)!=0)YE(a);i=b;return}function il(){var b=0,d=0,e=0,f=0,h=0;b=i;c[5004]=(c[5004]|0)+1;d=XE(303)|0;if((d|0)==0)d=0;else{c[(d+19&-16)+ -4>>2]=d;d=d+19&-16}g[d+164>>2]=1.0;g[d+168>>2]=1.0;g[d+172>>2]=1.0;g[d+176>>2]=0.0;c[d+180>>2]=0;g[d+184>>2]=999999984306749400.0;h=d+188|0;e=d+204|0;c[h+0>>2]=0;c[h+4>>2]=0;c[h+8>>2]=0;c[h+12>>2]=0;c[e>>2]=1;c[d+208>>2]=-1;c[d+212>>2]=-1;c[d+216>>2]=1;g[d+220>>2]=0.0;g[d+224>>2]=.5;g[d+228>>2]=0.0;g[d+232>>2]=0.0;e=d+236|0;c[d+240>>2]=0;g[d+244>>2]=1.0;h=d+248|0;f=d+4|0;c[h+0>>2]=0;c[h+4>>2]=0;c[h+8>>2]=0;c[h+12>>2]=0;g[f>>2]=1.0;f=d+8|0;h=d+24|0;c[f+0>>2]=0;c[f+4>>2]=0;c[f+8>>2]=0;c[f+12>>2]=0;g[h>>2]=1.0;h=d+28|0;f=d+44|0;c[h+0>>2]=0;c[h+4>>2]=0;c[h+8>>2]=0;c[h+12>>2]=0;g[f>>2]=1.0;f=d+48|0;c[f+0>>2]=0;c[f+4>>2]=0;c[f+8>>2]=0;c[f+12>>2]=0;c[f+16>>2]=0;c[d>>2]=13008;a[d+280>>0]=1;c[d+276>>2]=0;c[d+268>>2]=0;c[d+272>>2]=0;c[e>>2]=4;i=b;return d|0}function jl(a){a=a|0;return c[a+268>>2]|0}function kl(a,b){a=a|0;b=b|0;return c[(c[a+276>>2]|0)+(b<<2)>>2]|0}function ll(a){a=a|0;return c[a+192>>2]|0}function ml(a,b){a=a|0;b=+b;g[a+184>>2]=b;return}function nl(a,b){a=a|0;b=b|0;var d=0;d=i;if(((c[a+216>>2]|0)+ -4|0)>>>0<2){i=d;return}c[a+216>>2]=b;i=d;return}function ol(a,b){a=a|0;b=b|0;c[a+216>>2]=b;return}function pl(a){a=a|0;var b=0;b=i;if((c[a+204>>2]&3|0)!=0){i=b;return}if(!(((c[a+216>>2]|0)+ -4|0)>>>0<2))c[a+216>>2]=1;g[a+220>>2]=0.0;i=b;return}function ql(a,b){a=a|0;b=b|0;var d=0;d=i;if(!b?(c[a+204>>2]&3|0)!=0:0){i=d;return}if(!(((c[a+216>>2]|0)+ -4|0)>>>0<2))c[a+216>>2]=1;g[a+220>>2]=0.0;i=d;return}function rl(a){a=a|0;a=c[a+216>>2]|0;return((a|0)==2?0:(a|0)!=5)|0}function sl(a){a=a|0;return(c[a+204>>2]&2|0)!=0|0}function tl(a,b){a=a|0;b=+b;c[a+260>>2]=(c[a+260>>2]|0)+1;g[a+228>>2]=b;return}function ul(a,b){a=a|0;b=+b;c[a+260>>2]=(c[a+260>>2]|0)+1;g[a+224>>2]=b;return}function vl(a){a=a|0;return a+4|0}function wl(a){a=a|0;return c[a+204>>2]|0}function xl(a,b){a=a|0;b=b|0;c[a+204>>2]=b;return}function yl(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+260>>2]=(c[a+260>>2]|0)+1;c[a+4>>2]=c[b+0>>2];c[a+8>>2]=c[b+4>>2];c[a+12>>2]=c[b+8>>2];c[a+16>>2]=c[b+12>>2];c[a+20>>2]=c[b+16>>2];c[a+24>>2]=c[b+20>>2];c[a+28>>2]=c[b+24>>2];c[a+32>>2]=c[b+28>>2];c[a+36>>2]=c[b+32>>2];c[a+40>>2]=c[b+36>>2];c[a+44>>2]=c[b+40>>2];c[a+48>>2]=c[b+44>>2];c[a+52>>2]=c[b+48>>2];c[a+56>>2]=c[b+52>>2];c[a+60>>2]=c[b+56>>2];c[a+64>>2]=c[b+60>>2];i=d;return}function zl(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+12>>2]&127](a,b);i=d;return}function Al(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+8>>2]&511](a);i=b;return}function Bl(a){a=a|0;return c[a>>2]|0}function Cl(a,b){a=a|0;b=b|0;c[a>>2]=b;return}function Dl(a){a=a|0;return c[a+4>>2]|0}function El(a,b){a=a|0;b=b|0;c[a+4>>2]=b;return}function Fl(a){a=a|0;var b=0;b=i;if((a|0)!=0)YE(a);i=b;return}function Gl(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Hl(b,d,e){b=b|0;d=d|0;e=e|0;var f=0;b=i;f=XE(152)|0;a:do if((f|0)==0){while(1){f=c[5158]|0;c[5158]=f+0;if((f|0)==0)break;sc[f&3]();f=XE(152)|0;if((f|0)!=0)break a}f=Ab(4)|0;c[f>>2]=20472;yb(f|0,20520,265)}while(0);c[f>>2]=3752;a[f+20>>0]=1;c[f+16>>2]=0;c[f+8>>2]=0;c[f+12>>2]=0;a[f+40>>0]=1;c[f+36>>2]=0;c[f+28>>2]=0;c[f+32>>2]=0;a[f+60>>0]=1;c[f+56>>2]=0;c[f+48>>2]=0;c[f+52>>2]=0;a[f+80>>0]=1;c[f+76>>2]=0;c[f+68>>2]=0;c[f+72>>2]=0;c[f+100>>2]=e;g[f+104>>2]=0.0;a[f+148>>0]=1;c[f+144>>2]=0;c[f+136>>2]=0;c[f+140>>2]=0;c[f+116>>2]=d;c[f+120>>2]=0;c[f+124>>2]=2;c[f+128>>2]=1;g[f+112>>2]=0.0;g[f+108>>2]=0.0;i=b;return f|0}function Il(a,b,d){a=a|0;b=+b;d=d|0;g[(c[a+144>>2]|0)+(d*284|0)+252>>2]=b;return}function Jl(a,b,d){a=a|0;b=+b;d=d|0;g[(c[a+144>>2]|0)+(d*284|0)+232>>2]=b;return}function Kl(a,b){a=a|0;b=b|0;return(c[a+144>>2]|0)+(b*284|0)+92|0}function Ll(a,b,d){a=a|0;b=b|0;d=d|0;var e=0;e=i;Rq(c[a+116>>2]|0,c[a+144>>2]|0,b,d);i=e;return}function Ml(b,d,e,f,h,j,k,l){b=b|0;d=d|0;e=e|0;f=f|0;h=+h;j=+j;k=k|0;l=l|0;var m=0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0,t=0.0,u=0,v=0,w=0;m=i;i=i+288|0;c[m+144>>2]=c[d+0>>2];c[m+148>>2]=c[d+4>>2];c[m+152>>2]=c[d+8>>2];c[m+156>>2]=c[d+12>>2];w=m+160|0;c[w+0>>2]=c[e+0>>2];c[w+4>>2]=c[e+4>>2];c[w+8>>2]=c[e+8>>2];c[w+12>>2]=c[e+12>>2];v=m+176|0;c[v+0>>2]=c[f+0>>2];c[v+4>>2]=c[f+4>>2];c[v+8>>2]=c[f+8>>2];c[v+12>>2]=c[f+12>>2];o=+g[k>>2];p=+g[k+4>>2];q=+g[k+8>>2];r=+g[k+16>>2];n=+g[k+12>>2];t=+g[k+20>>2];c[m+0>>2]=c[m+144>>2];c[m+4>>2]=c[m+148>>2];c[m+8>>2]=c[m+152>>2];c[m+12>>2]=c[m+156>>2];c[m+16>>2]=c[w+0>>2];c[m+20>>2]=c[w+4>>2];c[m+24>>2]=c[w+8>>2];c[m+28>>2]=c[w+12>>2];c[m+32>>2]=c[v+0>>2];c[m+36>>2]=c[v+4>>2];c[m+40>>2]=c[v+8>>2];c[m+44>>2]=c[v+12>>2];v=c[b+136>>2]|0;if((v|0)==(c[b+140>>2]|0)?(s=(v|0)==0?1:v<<1,(v|0)<(s|0)):0){if((s|0)==0)d=0;else{c[5004]=(c[5004]|0)+1;k=XE((s*284|3)+16|0)|0;if((k|0)==0)d=0;else{c[(k+19&-16)+ -4>>2]=k;d=k+19&-16}v=c[b+136>>2]|0}if((v|0)>0){w=0;do{k=d+(w*284|0)|0;if((k|0)!=0){u=c[b+144>>2]|0;e=k+0|0;k=u+(w*284|0)+0|0;f=e+92|0;do{c[e>>2]=c[k>>2];e=e+4|0;k=k+4|0}while((e|0)<(f|0));e=d+(w*284|0)+92|0;k=u+(w*284|0)+92|0;c[e+0>>2]=c[k+0>>2];c[e+4>>2]=c[k+4>>2];c[e+8>>2]=c[k+8>>2];c[e+12>>2]=c[k+12>>2];e=d+(w*284|0)+108|0;k=u+(w*284|0)+108|0;c[e+0>>2]=c[k+0>>2];c[e+4>>2]=c[k+4>>2];c[e+8>>2]=c[k+8>>2];c[e+12>>2]=c[k+12>>2];e=d+(w*284|0)+124|0;k=u+(w*284|0)+124|0;c[e+0>>2]=c[k+0>>2];c[e+4>>2]=c[k+4>>2];c[e+8>>2]=c[k+8>>2];c[e+12>>2]=c[k+12>>2];e=d+(w*284|0)+140|0;k=u+(w*284|0)+140|0;c[e+0>>2]=c[k+0>>2];c[e+4>>2]=c[k+4>>2];c[e+8>>2]=c[k+8>>2];c[e+12>>2]=c[k+12>>2];e=d+(w*284|0)+156|0;k=u+(w*284|0)+156|0;f=e+128|0;do{c[e>>2]=c[k>>2];e=e+4|0;k=k+4|0}while((e|0)<(f|0))}w=w+1|0}while((w|0)!=(v|0))}k=c[b+144>>2]|0;if((k|0)!=0){if((a[b+148>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[k+ -4>>2]|0)}c[b+144>>2]=0}a[b+148>>0]=1;c[b+144>>2]=d;c[b+140>>2]=s;v=c[b+136>>2]|0}s=c[b+144>>2]|0;k=s+(v*284|0)|0;if((k|0)==0){w=v;d=s;v=w+1|0;c[b+136>>2]=v;w=d+(w*284|0)|0;d=b+116|0;v=c[d>>2]|0;Qq(v,w,0);v=c[b+136>>2]|0;v=v+ -1|0;d=c[d>>2]|0;u=c[b+144>>2]|0;Rq(d,u,v,0);i=m;return w|0}e=k+0|0;k=m+48|0;f=e+92|0;do{c[e>>2]=c[k>>2];e=e+4|0;k=k+4|0}while((e|0)<(f|0));e=s+(v*284|0)+92|0;c[e+0>>2]=c[m+240>>2];c[e+4>>2]=c[m+244>>2];c[e+8>>2]=c[m+248>>2];c[e+12>>2]=c[m+252>>2];e=s+(v*284|0)+108|0;c[e+0>>2]=c[m+224>>2];c[e+4>>2]=c[m+228>>2];c[e+8>>2]=c[m+232>>2];c[e+12>>2]=c[m+236>>2];e=s+(v*284|0)+124|0;c[e+0>>2]=c[m+208>>2];c[e+4>>2]=c[m+212>>2];c[e+8>>2]=c[m+216>>2];c[e+12>>2]=c[m+220>>2];e=s+(v*284|0)+140|0;c[e+0>>2]=c[m+192>>2];c[e+4>>2]=c[m+196>>2];c[e+8>>2]=c[m+200>>2];c[e+12>>2]=c[m+204>>2];s=s+(v*284|0)+156|0;e=s+0|0;k=m+0|0;f=e+48|0;do{c[e>>2]=c[k>>2];e=e+4|0;k=k+4|0}while((e|0)<(f|0));g[s+48>>2]=h;g[s+52>>2]=n;g[s+56>>2]=j;g[s+60>>2]=o;g[s+64>>2]=p;g[s+68>>2]=q;g[s+72>>2]=r;g[s+76>>2]=0.0;g[s+80>>2]=0.0;g[s+84>>2]=0.0;g[s+88>>2]=.10000000149011612;g[s+92>>2]=t;g[s+96>>2]=0.0;g[s+100>>2]=0.0;a[s+104>>0]=l&1;e=s+105|0;k=m+256|0;f=e+23|0;do{a[e>>0]=a[k>>0]|0;e=e+1|0;k=k+1|0}while((e|0)<(f|0));w=c[b+136>>2]|0;d=c[b+144>>2]|0;v=w+1|0;c[b+136>>2]=v;w=d+(w*284|0)|0;d=b+116|0;v=c[d>>2]|0;Qq(v,w,0);v=c[b+136>>2]|0;v=v+ -1|0;d=c[d>>2]|0;u=c[b+144>>2]|0;Rq(d,u,v,0);i=m;return w|0}function Nl(a){a=a|0;return c[a+136>>2]|0}function Ol(a){a=a|0;return c[a+116>>2]|0}function Pl(a,b){a=a|0;b=b|0;return(c[a+144>>2]|0)+(b*284|0)|0}function Ql(a,b,d){a=a|0;b=+b;d=d|0;g[(c[a+144>>2]|0)+(d*284|0)+256>>2]=b;return}function Rl(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;vc[c[(c[a>>2]|0)+24>>2]&127](a,b,d,e);i=f;return}function Sl(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Tl(a,b,d,e,f){a=a|0;b=b|0;d=d|0;e=e|0;f=+f;var h=0,j=0;h=i;j=XE(44)|0;a:do if((j|0)==0){while(1){j=c[5158]|0;c[5158]=j+0;if((j|0)==0)break;sc[j&3]();j=XE(44)|0;if((j|0)!=0)break a}j=Ab(4)|0;c[j>>2]=20472;yb(j|0,20520,265)}while(0);c[j>>2]=a;c[j+4>>2]=b;b=j+8|0;c[b+0>>2]=c[d+0>>2];c[b+4>>2]=c[d+4>>2];c[b+8>>2]=c[d+8>>2];c[b+12>>2]=c[d+12>>2];d=j+24|0;c[d+0>>2]=c[e+0>>2];c[d+4>>2]=c[e+4>>2];c[d+8>>2]=c[e+8>>2];c[d+12>>2]=c[e+12>>2];g[j+40>>2]=f;i=h;return j|0}function Ul(a){a=a|0;return c[a>>2]|0}function Vl(a,b){a=a|0;b=b|0;c[a>>2]=b;return}function Wl(a){a=a|0;return c[a+4>>2]|0}function Xl(a,b){a=a|0;b=b|0;c[a+4>>2]=b;return}function Yl(a){a=a|0;return a+8|0}function Zl(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+8>>2]=c[b+0>>2];c[a+12>>2]=c[b+4>>2];c[a+16>>2]=c[b+8>>2];c[a+20>>2]=c[b+12>>2];i=d;return}function _l(a){a=a|0;return a+24|0}function $l(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+24>>2]=c[b+0>>2];c[a+28>>2]=c[b+4>>2];c[a+32>>2]=c[b+8>>2];c[a+36>>2]=c[b+12>>2];i=d;return}function am(a){a=a|0;return+(+g[a+40>>2])}function bm(a,b){a=a|0;b=+b;g[a+40>>2]=b;return}function cm(a){a=a|0;var b=0;b=i;if((a|0)!=0)YE(a);i=b;return}function dm(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function em(b){b=b|0;var d=0,e=0,f=0,h=0;d=i;c[5004]=(c[5004]|0)+1;e=XE(635)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}g[e+164>>2]=1.0;g[e+168>>2]=1.0;g[e+172>>2]=1.0;g[e+176>>2]=0.0;c[e+180>>2]=0;g[e+184>>2]=999999984306749400.0;f=e+188|0;h=e+204|0;c[f+0>>2]=0;c[f+4>>2]=0;c[f+8>>2]=0;c[f+12>>2]=0;c[h>>2]=1;c[e+208>>2]=-1;c[e+212>>2]=-1;c[e+216>>2]=1;g[e+220>>2]=0.0;g[e+224>>2]=.5;g[e+228>>2]=0.0;g[e+232>>2]=0.0;c[e+236>>2]=1;c[e+240>>2]=0;g[e+244>>2]=1.0;h=e+248|0;f=e+4|0;c[h+0>>2]=0;c[h+4>>2]=0;c[h+8>>2]=0;c[h+12>>2]=0;g[f>>2]=1.0;f=e+8|0;h=e+24|0;c[f+0>>2]=0;c[f+4>>2]=0;c[f+8>>2]=0;c[f+12>>2]=0;g[h>>2]=1.0;h=e+28|0;f=e+44|0;c[h+0>>2]=0;c[h+4>>2]=0;c[h+8>>2]=0;c[h+12>>2]=0;g[f>>2]=1.0;f=e+48|0;c[f+0>>2]=0;c[f+4>>2]=0;c[f+8>>2]=0;c[f+12>>2]=0;c[f+16>>2]=0;c[e>>2]=3912;a[e+500>>0]=1;c[e+496>>2]=0;c[e+488>>2]=0;c[e+492>>2]=0;ar(e,b);i=d;return e|0}function fm(a){a=a|0;return a+4|0}function gm(a,b){a=a|0;b=b|0;var c=0;c=i;dr(a,b);i=c;return}function hm(a,b,c){a=a|0;b=+b;c=+c;g[a+472>>2]=b;g[a+476>>2]=c;return}function im(a,b,c){a=a|0;b=+b;c=+c;if(b<0.0)b=0.0;else b=b>1.0?1.0:b;g[a+444>>2]=b;if(c<0.0)c=0.0;else c=c>1.0?1.0:c;g[a+448>>2]=c;return}function jm(a,b,c){a=a|0;b=+b;c=c|0;var d=0;d=i;cr(a,b,c);i=d;return}function km(a,b){a=a|0;b=b|0;var d=0,e=0.0,f=0.0,h=0.0;d=i;c[a+348>>2]=c[b+0>>2];c[a+352>>2]=c[b+4>>2];c[a+356>>2]=c[b+8>>2];c[a+360>>2]=c[b+12>>2];h=+g[a+344>>2];f=+g[a+352>>2]*h;e=+g[a+356>>2]*h;g[a+560>>2]=+g[a+348>>2]*h;g[a+564>>2]=f;g[a+568>>2]=e;g[a+572>>2]=0.0;i=d;return}function lm(a,b){a=a|0;b=b|0;var c=0.0,d=0.0;d=+g[b+4>>2]*+g[a+548>>2];c=+g[b+8>>2]*+g[a+552>>2];g[a+428>>2]=+g[a+428>>2]+ +g[b>>2]*+g[a+544>>2];g[a+432>>2]=+g[a+432>>2]+d;g[a+436>>2]=+g[a+436>>2]+c;return}function mm(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,h=0.0,i=0.0,j=0.0,k=0.0;d=+g[a+348>>2];f=+g[a+352>>2];h=+g[b+4>>2]*f;i=+g[a+356>>2];j=+g[b+8>>2]*i;g[a+412>>2]=+g[a+412>>2]+ +g[b>>2]*d;g[a+416>>2]=+g[a+416>>2]+h;g[a+420>>2]=+g[a+420>>2]+j;d=+g[b>>2]*d;f=+g[b+4>>2]*f;i=+g[b+8>>2]*i;j=+g[c+4>>2];h=+g[c+8>>2];k=+g[c>>2];e=(h*d-k*i)*+g[a+548>>2];d=(k*f-j*d)*+g[a+552>>2];g[a+428>>2]=+g[a+428>>2]+(j*i-h*f)*+g[a+544>>2];g[a+432>>2]=+g[a+432>>2]+e;g[a+436>>2]=+g[a+436>>2]+d;return}function nm(a,b){a=a|0;b=b|0;var c=0.0,d=0.0;d=+g[b+4>>2]*+g[a+352>>2];c=+g[b+8>>2]*+g[a+356>>2];g[a+412>>2]=+g[a+412>>2]+ +g[b>>2]*+g[a+348>>2];g[a+416>>2]=+g[a+416>>2]+d;g[a+420>>2]=+g[a+420>>2]+c;return}function om(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0.0,f=0.0,h=0.0;h=+g[b>>2];f=+g[b+4>>2];e=+g[b+8>>2];d=(+g[a+280>>2]*h+ +g[a+284>>2]*f+ +g[a+288>>2]*e)*+g[a+548>>2];c=(+g[a+296>>2]*h+ +g[a+300>>2]*f+ +g[a+304>>2]*e)*+g[a+552>>2];g[a+328>>2]=+g[a+328>>2]+(+g[a+264>>2]*h+ +g[a+268>>2]*f+ +g[a+272>>2]*e)*+g[a+544>>2];g[a+332>>2]=+g[a+332>>2]+d;g[a+336>>2]=+g[a+336>>2]+c;return}function pm(a,b,c){a=a|0;b=b|0;c=c|0;var d=0;d=i;qm(a,b,c);i=d;return}function qm(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0;d=i;if(!(+g[a+344>>2]!=0.0)){i=d;return}sm(a,b);h=+g[b>>2]*+g[a+348>>2];k=+g[b+4>>2]*+g[a+352>>2];m=+g[b+8>>2]*+g[a+356>>2];j=+g[c+4>>2];n=+g[c+8>>2];l=+g[c>>2];f=(+g[a+280>>2]*(j*m-n*k)+ +g[a+284>>2]*(n*h-l*m)+ +g[a+288>>2]*(l*k-j*h))*+g[a+548>>2];e=(+g[a+296>>2]*(j*m-n*k)+ +g[a+300>>2]*(n*h-l*m)+ +g[a+304>>2]*(l*k-j*h))*+g[a+552>>2];g[a+328>>2]=+g[a+328>>2]+(+g[a+264>>2]*(j*m-n*k)+ +g[a+268>>2]*(n*h-l*m)+ +g[a+272>>2]*(l*k-j*h))*+g[a+544>>2];g[a+332>>2]=+g[a+332>>2]+f;g[a+336>>2]=+g[a+336>>2]+e;i=d;return}function rm(a,b){a=a|0;b=b|0;var c=0;c=i;sm(a,b);i=c;return}function sm(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0.0;e=+g[a+344>>2];d=+g[b+4>>2]*+g[a+352>>2]*e;c=+g[b+8>>2]*+g[a+356>>2]*e;g[a+312>>2]=+g[a+312>>2]+ +g[b>>2]*+g[a+348>>2]*e;g[a+316>>2]=+g[a+316>>2]+d;g[a+320>>2]=+g[a+320>>2]+c;return}function tm(a){a=a|0;var b=0.0,c=0.0,d=0.0,e=0.0,f=0.0,h=0.0,i=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0;n=+g[a+4>>2];h=+g[a+396>>2];m=+g[a+8>>2];e=+g[a+400>>2];l=+g[a+12>>2];c=+g[a+404>>2];k=+g[a+20>>2];j=+g[a+24>>2];i=+g[a+28>>2];f=+g[a+36>>2];d=+g[a+40>>2];b=+g[a+44>>2];g[a+264>>2]=n*n*h+m*m*e+l*l*c;g[a+268>>2]=n*h*k+m*e*j+l*c*i;g[a+272>>2]=n*h*f+m*e*d+l*c*b;g[a+276>>2]=0.0;g[a+280>>2]=n*h*k+m*e*j+l*c*i;g[a+284>>2]=k*h*k+j*e*j+i*c*i;g[a+288>>2]=h*k*f+e*j*d+c*i*b;g[a+292>>2]=0.0;g[a+296>>2]=n*h*f+m*e*d+l*c*b;g[a+300>>2]=k*h*f+j*e*d+i*c*b;g[a+304>>2]=f*h*f+d*e*d+b*c*b;g[a+308>>2]=0.0;return}function um(a){a=a|0;return a+312|0}function vm(a){a=a|0;return a+328|0}function wm(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+260>>2]=(c[a+260>>2]|0)+1;c[a+312>>2]=c[b+0>>2];c[a+316>>2]=c[b+4>>2];c[a+320>>2]=c[b+8>>2];c[a+324>>2]=c[b+12>>2];i=d;return}function xm(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+260>>2]=(c[a+260>>2]|0)+1;c[a+328>>2]=c[b+0>>2];c[a+332>>2]=c[b+4>>2];c[a+336>>2]=c[b+8>>2];c[a+340>>2]=c[b+12>>2];i=d;return}function ym(a){a=a|0;return c[a+480>>2]|0}function zm(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+260>>2]=(c[a+260>>2]|0)+1;c[a+544>>2]=c[b+0>>2];c[a+548>>2]=c[b+4>>2];c[a+552>>2]=c[b+8>>2];c[a+556>>2]=c[b+12>>2];i=d;return}function Am(a,b){a=a|0;b=b|0;if((c[b+236>>2]&2|0)==0)b=0;return b|0}function Bm(a){a=a|0;return c[a+192>>2]|0}function Cm(a,b){a=a|0;b=+b;g[a+184>>2]=b;return}function Dm(a,b){a=a|0;b=b|0;var d=0;d=i;if(((c[a+216>>2]|0)+ -4|0)>>>0<2){i=d;return}c[a+216>>2]=b;i=d;return}function Em(a,b){a=a|0;b=b|0;c[a+216>>2]=b;return}function Fm(a){a=a|0;var b=0;b=i;if((c[a+204>>2]&3|0)!=0){i=b;return}if(!(((c[a+216>>2]|0)+ -4|0)>>>0<2))c[a+216>>2]=1;g[a+220>>2]=0.0;i=b;return}function Gm(a,b){a=a|0;b=b|0;var d=0;d=i;if(!b?(c[a+204>>2]&3|0)!=0:0){i=d;return}if(!(((c[a+216>>2]|0)+ -4|0)>>>0<2))c[a+216>>2]=1;g[a+220>>2]=0.0;i=d;return}function Hm(a){a=a|0;a=c[a+216>>2]|0;return((a|0)==2?0:(a|0)!=5)|0}function Im(a){a=a|0;return(c[a+204>>2]&2|0)!=0|0}function Jm(a,b){a=a|0;b=+b;c[a+260>>2]=(c[a+260>>2]|0)+1;g[a+228>>2]=b;return}function Km(a,b){a=a|0;b=+b;c[a+260>>2]=(c[a+260>>2]|0)+1;g[a+224>>2]=b;return}function Lm(a){a=a|0;return a+4|0}function Mm(a){a=a|0;return c[a+204>>2]|0}function Nm(a,b){a=a|0;b=b|0;c[a+204>>2]=b;return}function Om(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+260>>2]=(c[a+260>>2]|0)+1;c[a+4>>2]=c[b+0>>2];c[a+8>>2]=c[b+4>>2];c[a+12>>2]=c[b+8>>2];c[a+16>>2]=c[b+12>>2];c[a+20>>2]=c[b+16>>2];c[a+24>>2]=c[b+20>>2];c[a+28>>2]=c[b+24>>2];c[a+32>>2]=c[b+28>>2];c[a+36>>2]=c[b+32>>2];c[a+40>>2]=c[b+36>>2];c[a+44>>2]=c[b+40>>2];c[a+48>>2]=c[b+44>>2];c[a+52>>2]=c[b+48>>2];c[a+56>>2]=c[b+52>>2];c[a+60>>2]=c[b+56>>2];c[a+64>>2]=c[b+60>>2];i=d;return}function Pm(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+12>>2]&127](a,b);i=d;return}function Qm(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+8>>2]&511](a);i=b;return}function Rm(a){a=a|0;var b=0,d=0;b=i;c[5004]=(c[5004]|0)+1;d=XE(75)|0;if((d|0)==0)d=0;else{c[(d+19&-16)+ -4>>2]=d;d=d+19&-16}jx(d,a);c[d>>2]=11032;c[d+52>>2]=0;i=b;return d|0}function Sm(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function Tm(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function Um(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Vm(a){a=a|0;var b=0,d=0;b=i;c[5004]=(c[5004]|0)+1;d=XE(75)|0;if((d|0)==0)d=0;else{c[(d+19&-16)+ -4>>2]=d;d=d+19&-16}jx(d,a);c[d>>2]=11136;c[d+52>>2]=2;i=b;return d|0}function Wm(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function Xm(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function Ym(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Zm(){var a=0,b=0,d=0,e=0;a=i;e=XE(64)|0;a:do if((e|0)==0){while(1){b=c[5158]|0;c[5158]=b+0;if((b|0)==0)break;sc[b&3]();e=XE(64)|0;if((e|0)!=0)break a}e=Ab(4)|0;c[e>>2]=20472;yb(e|0,20520,265)}while(0);b=e+48|0;d=e;do d=d+16|0;while((d|0)!=(b|0));i=a;return e|0}function _m(a,b){a=a|0;b=b|0;var d=0,e=0,f=0,g=0;d=i;e=XE(64)|0;a:do if((e|0)==0){while(1){e=c[5158]|0;c[5158]=e+0;if((e|0)==0)break;sc[e&3]();e=XE(64)|0;if((e|0)!=0)break a}g=Ab(4)|0;c[g>>2]=20472;yb(g|0,20520,265)}while(0);f=e+48|0;g=e;do g=g+16|0;while((g|0)!=(f|0));Un(e,a);c[f+0>>2]=c[b+0>>2];c[f+4>>2]=c[b+4>>2];c[f+8>>2]=c[b+8>>2];c[f+12>>2]=c[b+12>>2];i=d;return e|0}function $m(a){a=a|0;var b=0;b=i;an(a);i=b;return}function an(a){a=a|0;var b=0;b=i;g[a>>2]=1.0;c[a+4>>2]=0;c[a+8>>2]=0;c[a+12>>2]=0;c[a+16>>2]=0;g[a+20>>2]=1.0;c[a+24>>2]=0;c[a+28>>2]=0;c[a+32>>2]=0;c[a+36>>2]=0;g[a+40>>2]=1.0;g[a+44>>2]=0.0;c[a+48>>2]=0;c[a+52>>2]=0;c[a+56>>2]=0;c[a+60>>2]=0;i=b;return}function bn(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+48>>2]=c[b+0>>2];c[a+52>>2]=c[b+4>>2];c[a+56>>2]=c[b+8>>2];c[a+60>>2]=c[b+12>>2];i=d;return}function cn(a,b){a=a|0;b=b|0;var c=0;c=i;Un(a,b);i=c;return}function dn(a){a=a|0;return a+48|0}function en(b){b=b|0;var d=0;d=i;i=i+16|0;if((a[48]|0)==0?(Ya(48)|0)!=0:0)bb(48);Hc(b,d);c[8]=c[d+0>>2];c[9]=c[d+4>>2];c[10]=c[d+8>>2];c[11]=c[d+12>>2];i=d;return 32}function fn(a){a=a|0;return a|0}function gn(a){a=a|0;var b=0;b=i;if((a|0)!=0)YE(a);i=b;return}function hn(a){a=a|0;return c[a+24>>2]|0}function jn(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;vc[c[(c[a>>2]|0)+32>>2]&127](a,b,d,e);i=f;return}function kn(a){a=a|0;var b=0;b=i;a=c[a+68>>2]|0;a=Pb[c[(c[a>>2]|0)+36>>2]&127](a)|0;i=b;return a|0}function ln(a){a=a|0;return a+28|0}function mn(a,b){a=a|0;b=b|0;var d=0;d=i;vc[c[(c[a>>2]|0)+36>>2]&127](a,b,1,-1);i=d;return}function nn(a,b,d){a=a|0;b=b|0;d=d|0;var e=0;e=i;vc[c[(c[a>>2]|0)+36>>2]&127](a,b,d,-1);i=e;return}function on(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;vc[c[(c[a>>2]|0)+36>>2]&127](a,b,d,e);i=f;return}function pn(a){a=a|0;return c[a+68>>2]|0}function qn(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=+f;var g=0;g=i;Eu(a,b,c,d,e,f);i=g;return}function rn(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;e=i;Gu(a,b,c,d);i=e;return}function sn(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function tn(a){a=a|0;return+(+g[a>>2])}function un(a){a=a|0;return+(+g[a+4>>2])}function vn(a){a=a|0;return+(+g[a+8>>2])}function wn(a){a=a|0;return+(+g[a+12>>2])}function xn(a,b){a=a|0;b=+b;g[a>>2]=b;return}function yn(a,b){a=a|0;b=+b;g[a+4>>2]=b;return}function zn(a,b){a=a|0;b=+b;g[a+8>>2]=b;return}function An(a,b){a=a|0;b=+b;g[a+12>>2]=b;return}function Bn(a){a=a|0;var b=0;b=i;if((a|0)!=0)YE(a);i=b;return}function Cn(a){a=a|0;var b=0,d=0;b=i;c[5004]=(c[5004]|0)+1;d=XE(75)|0;if((d|0)==0)d=0;else{c[(d+19&-16)+ -4>>2]=d;d=d+19&-16}jx(d,a);i=b;return d|0}function Dn(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+24>>2]&127](a,b);i=d;return}function En(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;Ub[c[(c[a>>2]|0)+32>>2]&15](a,b,d);i=e;return}function Fn(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Gn(){var a=0,b=0,d=0;a=i;b=XE(4)|0;if((b|0)!=0){d=b;c[d>>2]=192;i=a;return d|0}while(1){b=c[5158]|0;c[5158]=b+0;if((b|0)==0){b=4;break}sc[b&3]();d=XE(4)|0;if((d|0)!=0){b=5;break}}if((b|0)==4){d=Ab(4)|0;c[d>>2]=20472;yb(d|0,20520,265)}else if((b|0)==5){c[d>>2]=192;i=a;return d|0}return 0}function Hn(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function In(b,c){b=b|0;c=c|0;a[b+21>>0]=c&1;return}function Jn(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}Lb[c[(c[a>>2]|0)+4>>2]&511](a);i=b;return}function Kn(a){a=a|0;return}function Ln(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function Mn(a){a=a|0;return}function Nn(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=+e;return}function On(a,b,c,d){a=a|0;b=b|0;c=c|0;d=+d;return}function Pn(a){a=a|0;return}function Qn(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Rn(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0;a=i;f=c[b>>2]|0;e=c[d>>2]|0;if((c[f+236>>2]|0)!=4)f=0;if((c[e+236>>2]|0)!=4)e=0;if((f|0)!=0)rc[c[(c[f>>2]|0)+28>>2]&127](f,d,b);if((e|0)==0){i=a;return 0}rc[c[(c[e>>2]|0)+28>>2]&127](e,b,d);i=a;return 0}function Sn(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,g=0;a=i;g=c[b>>2]|0;f=c[d>>2]|0;if((c[g+236>>2]|0)!=4)g=0;if((c[f+236>>2]|0)!=4)f=0;if((g|0)!=0)vc[c[(c[g>>2]|0)+32>>2]&127](g,d,e,b);if((f|0)==0){i=a;return 0}vc[c[(c[f>>2]|0)+32>>2]&127](f,b,e,d);i=a;return 0}function Tn(a,b,c){a=a|0;b=b|0;c=c|0;return}function Un(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0.0,f=0.0,h=0.0,i=0.0,j=0.0;f=+g[b>>2];d=+g[b+4>>2];j=+g[b+8>>2];h=+g[b+12>>2];e=f*(2.0/(f*f+d*d+j*j+h*h));c=d*(2.0/(f*f+d*d+j*j+h*h));i=j*(2.0/(f*f+d*d+j*j+h*h));g[a>>2]=1.0-(d*c+j*i);g[a+4>>2]=f*c-h*i;g[a+8>>2]=f*i+h*c;g[a+12>>2]=0.0;g[a+16>>2]=f*c+h*i;g[a+20>>2]=1.0-(f*e+j*i);g[a+24>>2]=d*i-h*e;g[a+28>>2]=0.0;g[a+32>>2]=f*i-h*c;g[a+36>>2]=d*i+h*e;g[a+40>>2]=1.0-(f*e+d*c);g[a+44>>2]=0.0;return}function Vn(a){a=a|0;return}function Wn(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Xn(a,c){a=a|0;c=c|0;var d=0;d=i;if((b[c+4>>1]&b[a+14>>1])<<16>>16==0){c=0;i=d;return c|0}c=(b[a+12>>1]&b[c+6>>1])<<16>>16!=0;i=d;return c|0}function Yn(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0.0,i=0.0,j=0.0,k=0.0;g[a+4>>2]=+g[b+24>>2];e=c[b>>2]|0;c[a+8>>2]=e;if(d){c[a+52>>2]=c[b+8>>2];c[a+56>>2]=c[b+12>>2];c[a+60>>2]=c[b+16>>2];c[a+64>>2]=c[b+20>>2]}else{k=+g[b+8>>2];j=+g[b+12>>2];i=+g[b+16>>2];h=+g[e+20>>2]*k+ +g[e+24>>2]*j+ +g[e+28>>2]*i;f=+g[e+36>>2]*k+ +g[e+40>>2]*j+ +g[e+44>>2]*i;g[a+52>>2]=+g[e+4>>2]*k+ +g[e+8>>2]*j+ +g[e+12>>2]*i;g[a+56>>2]=h;g[a+60>>2]=f;g[a+64>>2]=0.0}k=+g[b+24>>2];g[a+68>>2]=(1.0-k)*+g[a+20>>2]+ +g[a+36>>2]*k;g[a+72>>2]=(1.0-k)*+g[a+24>>2]+k*+g[a+40>>2];g[a+76>>2]=(1.0-k)*+g[a+28>>2]+k*+g[a+44>>2];return+(+g[b+24>>2])}function Zn(a,b,c,d,e,f,h,j,k,l){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;k=k|0;l=l|0;var m=0,n=0;n=i;m=a;do m=m+16|0;while((m|0)!=(a+48|0));g[a>>2]=+g[b>>2];g[a+4>>2]=+g[c>>2];g[a+8>>2]=+g[d>>2];g[a+12>>2]=0.0;g[a+16>>2]=+g[e>>2];g[a+20>>2]=+g[f>>2];g[a+24>>2]=+g[h>>2];g[a+28>>2]=0.0;g[a+32>>2]=+g[j>>2];g[a+36>>2]=+g[k>>2];g[a+40>>2]=+g[l>>2];g[a+44>>2]=0.0;i=n;return}function _n(a){a=a|0;return}function $n(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function ao(a,b){a=a|0;b=b|0;var d=0,e=0.0,f=0.0,h=0.0,j=0,k=0.0,l=0.0;d=i;i=i+176|0;Zn(d+128|0,a+68|0,a+84|0,a+100|0,a+72|0,a+88|0,a+104|0,a+76|0,a+92|0,a+108|0);l=-+g[a+116>>2];k=-+g[a+120>>2];h=-+g[a+124>>2];e=+g[d+128>>2]*l+ +g[d+132>>2]*k+ +g[d+136>>2]*h;f=+g[d+144>>2]*l+ +g[d+148>>2]*k+ +g[d+152>>2]*h;h=+g[d+160>>2]*l+ +g[d+164>>2]*k+ +g[d+168>>2]*h;j=d;do j=j+16|0;while((j|0)!=(d+48|0));c[d+0>>2]=c[d+128>>2];c[d+4>>2]=c[d+132>>2];c[d+8>>2]=c[d+136>>2];c[d+12>>2]=c[d+140>>2];c[d+16>>2]=c[d+144>>2];c[d+20>>2]=c[d+148>>2];c[d+24>>2]=c[d+152>>2];c[d+28>>2]=c[d+156>>2];c[d+32>>2]=c[d+160>>2];c[d+36>>2]=c[d+164>>2];c[d+40>>2]=c[d+168>>2];c[d+44>>2]=c[d+172>>2];g[d+48>>2]=e;g[d+52>>2]=f;g[d+56>>2]=h;g[d+60>>2]=0.0;co(d+64|0,d,a+4|0);c[b+0>>2]=c[d+64>>2];c[b+4>>2]=c[d+68>>2];c[b+8>>2]=c[d+72>>2];c[b+12>>2]=c[d+76>>2];c[b+16>>2]=c[d+80>>2];c[b+20>>2]=c[d+84>>2];c[b+24>>2]=c[d+88>>2];c[b+28>>2]=c[d+92>>2];c[b+32>>2]=c[d+96>>2];c[b+36>>2]=c[d+100>>2];c[b+40>>2]=c[d+104>>2];c[b+44>>2]=c[d+108>>2];c[b+48>>2]=c[d+112>>2];c[b+52>>2]=c[d+116>>2];c[b+56>>2]=c[d+120>>2];c[b+60>>2]=c[d+124>>2];i=d;return}function bo(a,b){a=a|0;b=b|0;var d=0;d=i;i=i+64|0;co(d,b,a+68|0);c[a+4>>2]=c[d+0>>2];c[a+8>>2]=c[d+4>>2];c[a+12>>2]=c[d+8>>2];c[a+16>>2]=c[d+12>>2];c[a+20>>2]=c[d+16>>2];c[a+24>>2]=c[d+20>>2];c[a+28>>2]=c[d+24>>2];c[a+32>>2]=c[d+28>>2];c[a+36>>2]=c[d+32>>2];c[a+40>>2]=c[d+36>>2];c[a+44>>2]=c[d+40>>2];c[a+48>>2]=c[d+44>>2];c[a+52>>2]=c[d+48>>2];c[a+56>>2]=c[d+52>>2];c[a+60>>2]=c[d+56>>2];c[a+64>>2]=c[d+60>>2];i=d;return}function co(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0;e=i;i=i+96|0;s=+g[d>>2];h=+g[b>>2];r=+g[d+16>>2];j=+g[b+4>>2];q=+g[d+32>>2];l=+g[b+8>>2];g[e+80>>2]=s*h+r*j+q*l;p=+g[d+4>>2];o=+g[d+20>>2];n=+g[d+36>>2];g[e+76>>2]=p*h+o*j+n*l;m=+g[d+8>>2];f=+g[d+24>>2];k=+g[d+40>>2];g[e+72>>2]=m*h+f*j+k*l;l=+g[b+16>>2];j=+g[b+20>>2];h=+g[b+24>>2];g[e+68>>2]=s*l+r*j+q*h;g[e+64>>2]=p*l+o*j+n*h;g[e+60>>2]=m*l+f*j+k*h;h=+g[b+32>>2];j=+g[b+36>>2];l=+g[b+40>>2];g[e+56>>2]=s*h+r*j+q*l;g[e+52>>2]=p*h+o*j+n*l;g[e+48>>2]=m*h+f*j+k*l;Zn(e,e+80|0,e+76|0,e+72|0,e+68|0,e+64|0,e+60|0,e+56|0,e+52|0,e+48|0);l=+g[d+48>>2];k=+g[d+52>>2];j=+g[d+56>>2];f=l*+g[b>>2]+k*+g[b+4>>2]+j*+g[b+8>>2]+ +g[b+48>>2];h=l*+g[b+16>>2]+k*+g[b+20>>2]+j*+g[b+24>>2]+ +g[b+52>>2];j=l*+g[b+32>>2]+k*+g[b+36>>2]+j*+g[b+40>>2]+ +g[b+56>>2];b=a;do b=b+16|0;while((b|0)!=(a+48|0));c[a+0>>2]=c[e+0>>2];c[a+4>>2]=c[e+4>>2];c[a+8>>2]=c[e+8>>2];c[a+12>>2]=c[e+12>>2];c[a+16>>2]=c[e+16>>2];c[a+20>>2]=c[e+20>>2];c[a+24>>2]=c[e+24>>2];c[a+28>>2]=c[e+28>>2];c[a+32>>2]=c[e+32>>2];c[a+36>>2]=c[e+36>>2];c[a+40>>2]=c[e+40>>2];c[a+44>>2]=c[e+44>>2];g[a+48>>2]=f;g[a+52>>2]=h;g[a+56>>2]=j;g[a+60>>2]=0.0;i=e;return}function eo(a){a=a|0;return}function fo(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function go(a,c){a=a|0;c=c|0;var d=0;d=i;if((b[c+4>>1]&b[a+10>>1])<<16>>16==0){c=0;i=d;return c|0}c=(b[a+8>>1]&b[c+6>>1])<<16>>16!=0;i=d;return c|0}function ho(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0;e=i;g[a+4>>2]=+g[b+40>>2];f=c[b>>2]|0;c[a+76>>2]=f;if(d){c[a+44>>2]=c[b+8>>2];c[a+48>>2]=c[b+12>>2];c[a+52>>2]=c[b+16>>2];c[a+56>>2]=c[b+20>>2];d=a+60|0;a=b+24|0;c[d+0>>2]=c[a+0>>2];c[d+4>>2]=c[a+4>>2];c[d+8>>2]=c[a+8>>2];c[d+12>>2]=c[a+12>>2];h=+g[b+40>>2];i=e;return+h}else{m=+g[b+8>>2];l=+g[b+12>>2];k=+g[b+16>>2];j=+g[f+20>>2]*m+ +g[f+24>>2]*l+ +g[f+28>>2]*k;h=+g[f+36>>2]*m+ +g[f+40>>2]*l+ +g[f+44>>2]*k;g[a+44>>2]=+g[f+4>>2]*m+ +g[f+8>>2]*l+ +g[f+12>>2]*k;g[a+48>>2]=j;g[a+52>>2]=h;g[a+56>>2]=0.0;d=a+60|0;a=b+24|0;c[d+0>>2]=c[a+0>>2];c[d+4>>2]=c[a+4>>2];c[d+8>>2]=c[a+8>>2];c[d+12>>2]=c[a+12>>2];h=+g[b+40>>2];i=e;return+h}return 0.0}function io(a){a=a|0;return}function jo(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function ko(a,c){a=a|0;c=c|0;var d=0;d=i;if((b[c+4>>1]&b[a+6>>1])<<16>>16==0){c=0;i=d;return c|0}c=(b[a+4>>1]&b[c+6>>1])<<16>>16!=0;i=d;return c|0}function lo(a,b,c,d,e,f,g,h){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;var j=0.0,k=0;k=i;j=+Ta(960,a|0,b|0,c|0,d|0,e|0,f|0,g|0,h|0);i=k;return+j}function mo(b,d){b=b|0;d=d|0;var e=0,f=0,h=0,j=0.0,k=0,l=0;e=i;if((a[b+527>>0]|0)!=0){c[d>>2]=0;c[d+4>>2]=0;i=e;return}c[d>>2]=3;c[d+4>>2]=3;l=c[b+28>>2]|0;k=c[b+32>>2]|0;no(b,l+4|0,k+4|0,l+264|0,k+264|0);if(((a[b+526>>0]|0)!=0?(f=c[d>>2]|0,c[d>>2]=f+1,h=c[d+4>>2]|0,c[d+4>>2]=h+ -1,j=+g[b+456>>2],+g[b+444>>2]<j):0)?+g[b+448>>2]<j:0){c[d>>2]=f+2;c[d+4>>2]=h+ -2}if((a[b+525>>0]|0)==0){i=e;return}c[d>>2]=(c[d>>2]|0)+1;c[d+4>>2]=(c[d+4>>2]|0)+ -1;i=e;return}function no(b,d,e,f,h){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,R=0.0,U=0.0,W=0.0,X=0.0,Z=0.0,_=0.0,$=0.0,aa=0.0,ba=0.0,ca=0.0,da=0.0,ea=0.0,fa=0.0,ga=0.0,ha=0.0,ia=0.0,ja=0.0,ka=0.0,la=0.0,ma=0.0;j=i;i=i+272|0;g[b+504>>2]=0.0;g[b+500>>2]=0.0;a[b+525>>0]=0;a[b+526>>0]=0;if((a[b+552>>0]|0)!=0?(a[b+527>>0]|0)==0:0){ia=+g[b+556>>2];ba=+g[b+560>>2];ja=+g[b+564>>2];ca=+g[b+568>>2];ea=ia*(2.0/(ia*ia+ba*ba+ja*ja+ca*ca));la=ba*(2.0/(ia*ia+ba*ba+ja*ja+ca*ca));fa=ja*(2.0/(ia*ia+ba*ba+ja*ja+ca*ca));co(j+208|0,d,b+300|0);co(j+144|0,e,b+364|0);H=+g[j+144>>2];J=+g[j+148>>2];m=+g[j+152>>2];W=(1.0-(ba*la+ja*fa))*H+(ia*la+ca*fa)*J+(ia*fa-ca*la)*m;X=(ia*la-ca*fa)*H+(1.0-(ia*ea+ja*fa))*J+(ba*fa+ca*ea)*m;Z=(ia*fa+ca*la)*H+(ba*fa-ca*ea)*J+(1.0-(ia*ea+ba*la))*m;K=+g[j+160>>2];L=+g[j+164>>2];l=+g[j+168>>2];_=(1.0-(ba*la+ja*fa))*K+(ia*la+ca*fa)*L+(ia*fa-ca*la)*l;$=(ia*la-ca*fa)*K+(1.0-(ia*ea+ja*fa))*L+(ba*fa+ca*ea)*l;aa=(ia*fa+ca*la)*K+(ba*fa-ca*ea)*L+(1.0-(ia*ea+ba*la))*l;M=+g[j+176>>2];N=+g[j+180>>2];O=+g[j+184>>2];ha=(1.0-(ba*la+ja*fa))*M+(ia*la+ca*fa)*N+(ia*fa-ca*la)*O;ja=(ia*la-ca*fa)*M+(1.0-(ia*ea+ja*fa))*N+(ba*fa+ca*ea)*O;la=(ia*fa+ca*la)*M+(ba*fa-ca*ea)*N+(1.0-(ia*ea+ba*la))*O;ba=+g[j+208>>2];ea=+g[j+224>>2];ia=+g[j+240>>2];ca=+g[j+212>>2];fa=+g[j+228>>2];ka=+g[j+244>>2];da=+g[j+216>>2];ga=+g[j+232>>2];ma=+g[j+248>>2];R=-+g[j+256>>2];U=-+g[j+260>>2];k=-+g[j+264>>2];m=H*0.0+J*0.0+m*0.0+ +g[j+192>>2]+(Z*(da*R+ga*U+ma*k)+(W*(ba*R+ea*U+ia*k)+X*(ca*R+fa*U+ka*k)));l=K*0.0+L*0.0+l*0.0+ +g[j+196>>2]+(aa*(da*R+ga*U+ma*k)+(_*(ba*R+ea*U+ia*k)+$*(ca*R+fa*U+ka*k)));k=M*0.0+N*0.0+O*0.0+ +g[j+200>>2]+(la*(da*R+ga*U+ma*k)+(ha*(ba*R+ea*U+ia*k)+ja*(ca*R+fa*U+ka*k)));g[j+80>>2]=W*ba+X*ca+Z*da;g[j+84>>2]=W*ea+X*fa+Z*ga;g[j+88>>2]=W*ia+X*ka+Z*ma;g[j+92>>2]=0.0;g[j+96>>2]=_*ba+$*ca+aa*da;g[j+100>>2]=_*ea+$*fa+aa*ga;g[j+104>>2]=_*ia+$*ka+aa*ma;g[j+108>>2]=0.0;g[j+112>>2]=ha*ba+ja*ca+la*da;g[j+116>>2]=ha*ea+ja*fa+la*ga;g[j+120>>2]=ha*ia+ja*ka+la*ma;g[j+124>>2]=0.0;g[j+128>>2]=m;g[j+132>>2]=l;g[j+136>>2]=k;g[j+140>>2]=0.0;Hc(j+80|0,j+64|0);k=+g[j+64>>2];l=+g[j+68>>2];m=+g[j+72>>2];if(+P(+(k*k+l*l+m*m))<1.1920928955078125e-7){i=j;return}g[b+472>>2]=0.0;ma=1.0/+Q(+(k*k+l*l+m*m));g[b+460>>2]=k*ma;g[b+464>>2]=l*ma;g[b+468>>2]=m*ma;ma=+g[j+76>>2];ma=ma<-1.0?-1.0:ma;ma=+V(+(ma>1.0?1.0:ma))*2.0;g[b+504>>2]=ma;if(+P(+ma)<1.1920928955078125e-7){i=j;return}a[b+526>>0]=1;i=j;return}Hc(d,j+48|0);Hc(b+300|0,j+32|0);B=+g[j+60>>2];x=+g[j+32>>2];D=+g[j+48>>2];z=+g[j+44>>2];A=+g[j+52>>2];v=+g[j+40>>2];y=+g[j+56>>2];C=+g[j+36>>2];Hc(e,j+16|0);Hc(b+364|0,j);p=+g[j+28>>2];l=+g[j>>2];r=+g[j+16>>2];n=+g[j+12>>2];o=+g[j+20>>2];s=+g[j+8>>2];m=+g[j+24>>2];q=+g[j+4>>2];k=-(p*l+r*n+o*s-m*q);w=-(l*m+(n*o+p*q)-r*s);u=-(p*s+n*m+r*q-l*o);M=(B*x+D*z+A*v-y*C)*(p*n-l*r-o*q-s*m)+(B*z-x*D-A*C-v*y)*k+(B*v+z*y+D*C-x*A)*w-(x*y+(z*A+B*C)-D*v)*u;O=(B*x+D*z+A*v-y*C)*u+((x*y+(z*A+B*C)-D*v)*(p*n-l*r-o*q-s*m)+(B*z-x*D-A*C-v*y)*w)-(B*v+z*y+D*C-x*A)*k;H=(x*y+(z*A+B*C)-D*v)*k+((B*v+z*y+D*C-x*A)*(p*n-l*r-o*q-s*m)+(B*z-x*D-A*C-v*y)*u)-(B*x+D*z+A*v-y*C)*w;R=(B*z-x*D-A*C-v*y)*(p*n-l*r-o*q-s*m)-(B*x+D*z+A*v-y*C)*k-(x*y+(z*A+B*C)-D*v)*w-(B*v+z*y+D*C-x*A)*u;E=-M-O*0.0-H*0.0;G=(H+R*0.0-M*0.0)*-H+(R*(R+O*0.0-H*0.0)+E*-M)-(R*0.0+M*0.0-O)*-O;L=(R*0.0+M*0.0-O)*-M+(R*(H+R*0.0-M*0.0)+E*-O)-(R+O*0.0-H*0.0)*-H;E=(R+O*0.0-H*0.0)*-O+(R*(R*0.0+M*0.0-O)+E*-H)-(H+R*0.0-M*0.0)*-M;K=1.0/+Q(+(E*E+(G*G+L*L)));if(K*E*0.0+(K*L*0.0+K*G)<-.9999998807907104)if(+P(0.0)>.7071067690849304){F=0.0;E=t;N=t;G=0.0}else{F=-0.0;E=1.0;N=0.0;G=0.0}else{ma=+Q(+((K*E*0.0+(K*L*0.0+K*G)+1.0)*2.0));F=(K*E*0.0-K*L*0.0)*(1.0/ma);E=(K*G*0.0-K*E)*(1.0/ma);N=(K*L-K*G*0.0)*(1.0/ma);G=ma*.5}U=1.0/+Q(+(G*G+(N*N+(E*E+F*F))));K=F*U;L=E*U;N=N*U;U=G*U;ma=1.0/+Q(+((R*U-M*-K-O*-L-H*-N)*(R*U-M*-K-O*-L-H*-N)+((O*-K+(H*U+R*-N)-M*-L)*(O*-K+(H*U+R*-N)-M*-L)+((H*-L+(M*U+R*-K)-O*-N)*(H*-L+(M*U+R*-K)-O*-N)+(M*-N+(O*U+R*-L)-H*-K)*(M*-N+(O*U+R*-L)-H*-K)))));G=ma*(H*-L+(M*U+R*-K)-O*-N);F=ma*(M*-N+(O*U+R*-L)-H*-K);E=ma*(O*-K+(H*U+R*-N)-M*-L);H=ma*(R*U-M*-K-O*-L-H*-N);M=+g[b+444>>2];O=+g[b+456>>2];if(M>=O?(J=+g[b+448>>2],J>=O):0){O=U<-1.0?-1.0:U;O=+V(+(O>1.0?1.0:O))*2.0;if(O>1.1920928955078125e-7){U=1.0/+Q(+(N*N+(K*K+L*L)));if(+P(+(L*U))>1.1920928955078125e-7){R=+Q(+((N*U*N*U/(L*U*L*U)+1.0)/(1.0/(J*J)+N*U*N*U/(L*U*L*U)/(M*M))));L=L*U;N=N*U;K=K*U}else{R=M;L=L*U;N=N*U;K=K*U}}else{R=0.0;L=0.0;N=0.0;K=0.0}W=+g[b+428>>2];U=R*W;if(O>U){a[b+526>>0]=1;if(O<R&W<.9999998807907104)R=(O-U)/(R-U);else R=1.0;g[b+528>>2]=R;g[b+504>>2]=O-U;if(+P(+L)>1.1920928955078125e-7){J=+P(+(L*-N/L*(J/M)));if(!(N<-0.0))J=-J;N=1.0/+Q(+(L*L+K*K+J*J));K=K*N;L=L*N;N=-(J*N)}la=-K;ka=-L;ja=-N;ha=(l*m+(n*o+p*q)-r*s)*ja+(p*n-l*r-o*q-s*m)*la-(p*s+n*m+r*q-l*o)*ka;ma=(p*n-l*r-o*q-s*m)*ka+(p*s+n*m+r*q-l*o)*la-(p*l+r*n+o*s-m*q)*ja;ia=(p*n-l*r-o*q-s*m)*ja+(p*l+r*n+o*s-m*q)*ka-(l*m+(n*o+p*q)-r*s)*la;ja=-((p*l+r*n+o*s-m*q)*la)-(l*m+(n*o+p*q)-r*s)*ka-(p*s+n*m+r*q-l*o)*ja;ka=ma*u+((p*n-l*r-o*q-s*m)*ha+ja*k)-ia*w;la=ia*k+((p*n-l*r-o*q-s*m)*ma+ja*w)-ha*u;ma=ha*w+((p*n-l*r-o*q-s*m)*ia+ja*u)-ma*k;g[b+460>>2]=ka;g[b+464>>2]=la;g[b+468>>2]=ma;g[b+472>>2]=0.0;c[b+536>>2]=0;c[b+540>>2]=0;c[b+544>>2]=0;c[b+548>>2]=0;g[b+492>>2]=1.0/(ka*(+g[f>>2]*ka+ +g[f+16>>2]*la+ +g[f+32>>2]*ma)+la*(ka*+g[f+4>>2]+la*+g[f+20>>2]+ma*+g[f+36>>2])+ma*(ka*+g[f+8>>2]+la*+g[f+24>>2]+ma*+g[f+40>>2])+(ka*(ka*+g[h>>2]+la*+g[h+16>>2]+ma*+g[h+32>>2])+la*(ka*+g[h+4>>2]+la*+g[h+20>>2]+ma*+g[h+36>>2])+ma*(ka*+g[h+8>>2]+la*+g[h+24>>2]+ma*+g[h+40>>2])))}}else I=23;a:do if((I|0)==23){N=+g[b+300>>2];R=+g[b+316>>2];K=+g[b+332>>2];Z=+g[d>>2];X=+g[d+4>>2];W=+g[d+8>>2];M=+g[d+16>>2];L=+g[d+20>>2];J=+g[d+24>>2];O=+g[d+32>>2];U=+g[d+36>>2];_=+g[d+40>>2];da=+g[b+304>>2];ca=+g[b+320>>2];ba=+g[b+336>>2];ga=+g[b+308>>2];fa=+g[b+324>>2];ea=+g[b+340>>2];ja=+g[b+364>>2];la=+g[b+380>>2];ha=+g[b+396>>2];$=ja*+g[e>>2]+la*+g[e+4>>2]+ha*+g[e+8>>2];aa=ja*+g[e+16>>2]+la*+g[e+20>>2]+ha*+g[e+24>>2];ha=ja*+g[e+32>>2]+la*+g[e+36>>2]+ha*+g[e+40>>2];la=(N*Z+R*X+K*W)*$+(N*M+R*L+K*J)*aa+(N*O+R*U+K*_)*ha;ja=(Z*da+X*ca+W*ba)*$+(M*da+L*ca+J*ba)*aa+(O*da+U*ca+_*ba)*ha;ia=(Z*ga+X*fa+W*ea)*$+(M*ga+L*fa+J*ea)*aa+(O*ga+U*fa+_*ea)*ha;ka=+g[b+444>>2];ma=+g[b+456>>2];do if(ka<ma){ka=+g[b+448>>2];if(ka<ma){if(+P(+ja)<1.1920928955078125e-7?+P(+ia)<1.1920928955078125e-7:0)break a;a[b+526>>0]=1;g[b+460>>2]=-((N*O+R*U+K*_)*aa-(N*M+R*L+K*J)*ha);g[b+464>>2]=-((N*Z+R*X+K*W)*ha-(N*O+R*U+K*_)*$);g[b+468>>2]=-((N*M+R*L+K*J)*$-(N*Z+R*X+K*W)*aa);g[b+472>>2]=0.0;break a}if(+P(+la)<1.1920928955078125e-7?+P(+ia)<1.1920928955078125e-7:0)break;a[b+526>>0]=1;if(ka>=ma){ja=+Y(+ia,+la);if(ja>ka){la=+S(+ka);ja=0.0;ia=+T(+ka);break}if(ja<-ka){la=+S(+ka);ja=0.0;ia=-+T(+ka)}else ja=0.0}}else{if(+P(+la)<1.1920928955078125e-7?+P(+ja)<1.1920928955078125e-7:0)break;a[b+526>>0]=1;if(ka>=ma){ia=+Y(+ja,+la);if(ia>ka){la=+S(+ka);ja=+T(+ka);ia=0.0;break}if(ia<-ka){la=+S(+ka);ja=-+T(+ka);ia=0.0}else ia=0.0}}while(0);ka=(Z*ga+X*fa+W*ea)*ia+((Z*da+X*ca+W*ba)*ja+(N*Z+R*X+K*W)*la);Z=(M*ga+L*fa+J*ea)*ia+((M*da+L*ca+J*ba)*ja+(N*M+R*L+K*J)*la);ja=(O*ga+U*fa+_*ea)*ia+((O*da+U*ca+_*ba)*ja+(N*O+R*U+K*_)*la);la=1.0/+Q(+(ja*ja+(ka*ka+Z*Z)));g[b+472>>2]=0.0;ma=+Q(+((aa*la*ja-ha*la*Z)*(aa*la*ja-ha*la*Z)+(ha*la*ka-$*la*ja)*(ha*la*ka-$*la*ja)+($*la*Z-aa*la*ka)*($*la*Z-aa*la*ka)));g[b+504>>2]=ma;g[b+460>>2]=-((aa*la*ja-ha*la*Z)*(1.0/ma));g[b+464>>2]=-((ha*la*ka-$*la*ja)*(1.0/ma));g[b+468>>2]=-(($*la*Z-aa*la*ka)*(1.0/ma))}while(0);J=+g[b+452>>2];if(!(J>=0.0)){g[b+512>>2]=0.0;i=j;return}K=H<-1.0?-1.0:H;K=+V(+(K>1.0?1.0:K))*2.0;if(K>3.1415927410125732){H=H>1.0?-1.0:-H;H=+V(+(H>1.0?1.0:H))*2.0;G=-G;F=-F;E=-E}else H=K;g[b+512>>2]=H;if(H>1.1920928955078125e-7){ma=1.0/+Q(+(E*E+(F*F+G*G)));G=G*ma;F=F*ma;E=E*ma}L=+g[b+428>>2];if(H>J*L){a[b+525>>0]=1;K=H-J*L;if(H<J&L<.9999998807907104)H=K/(J-J*L);else H=1.0;g[b+532>>2]=H;g[b+508>>2]=K;la=-G;ka=-F;ja=-E;ha=(l*m+(n*o+p*q)-r*s)*ja+(p*n-l*r-o*q-s*m)*la-(p*s+n*m+r*q-l*o)*ka;ma=(p*n-l*r-o*q-s*m)*ka+(p*s+n*m+r*q-l*o)*la-(p*l+r*n+o*s-m*q)*ja;ia=(p*n-l*r-o*q-s*m)*ja+(p*l+r*n+o*s-m*q)*ka-(l*m+(n*o+p*q)-r*s)*la;ja=-((p*l+r*n+o*s-m*q)*la)-(l*m+(n*o+p*q)-r*s)*ka-(p*s+n*m+r*q-l*o)*ja;ka=ma*u+((p*n-l*r-o*q-s*m)*ha+ja*k)-ia*w;la=ia*k+((p*n-l*r-o*q-s*m)*ma+ja*w)-ha*u;ma=ha*w+((p*n-l*r-o*q-s*m)*ia+ja*u)-ma*k;g[b+476>>2]=ka;g[b+480>>2]=la;g[b+484>>2]=ma;g[b+488>>2]=0.0;g[b+496>>2]=1.0/(ka*(+g[f>>2]*ka+ +g[f+16>>2]*la+ +g[f+32>>2]*ma)+la*(ka*+g[f+4>>2]+la*+g[f+20>>2]+ma*+g[f+36>>2])+ma*(ka*+g[f+8>>2]+la*+g[f+24>>2]+ma*+g[f+40>>2])+(ka*(ka*+g[h>>2]+la*+g[h+16>>2]+ma*+g[h+32>>2])+la*(ka*+g[h+4>>2]+la*+g[h+20>>2]+ma*+g[h+36>>2])+ma*(ka*+g[h+8>>2]+la*+g[h+24>>2]+ma*+g[h+40>>2])))}if((a[b+526>>0]|0)==0){i=j;return}ha=-G;ma=-F;ja=-E;ga=(x*y+(z*A+B*C)-D*v)*ja+(B*z-x*D-A*C-v*y)*ha-(B*v+z*y+D*C-x*A)*ma;la=(B*z-x*D-A*C-v*y)*ma+(B*v+z*y+D*C-x*A)*ha-(B*x+D*z+A*v-y*C)*ja;ia=(B*z-x*D-A*C-v*y)*ja+(B*x+D*z+A*v-y*C)*ma-(x*y+(z*A+B*C)-D*v)*ha;ja=-((B*x+D*z+A*v-y*C)*ha)-(x*y+(z*A+B*C)-D*v)*ma-(B*v+z*y+D*C-x*A)*ja;ma=-(B*x+D*z+A*v-y*C);ha=-(x*y+(z*A+B*C)-D*v);ka=-(B*v+z*y+D*C-x*A);g[b+536>>2]=la*ka+((B*z-x*D-A*C-v*y)*ga+ja*ma)-ia*ha;g[b+540>>2]=ia*ma+((B*z-x*D-A*C-v*y)*la+ja*ha)-ga*ka;g[b+544>>2]=ga*ha+((B*z-x*D-A*C-v*y)*ia+ja*ka)-la*ma;g[b+548>>2]=0.0;i=j;return}function oo(b,d){b=b|0;d=d|0;var e=0,f=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0;e=i;i=i+64|0;k=c[b+28>>2]|0;o=c[b+32>>2]|0;no(b,k+4|0,o+4|0,k+264|0,o+264|0);l=c[d+8>>2]|0;g[l>>2]=1.0;m=c[d+24>>2]|0;g[l+(m+1<<2)>>2]=1.0;g[l+((m<<1)+2<<2)>>2]=1.0;q=+g[b+348>>2];w=+g[b+352>>2];t=+g[b+356>>2];u=+g[k+4>>2]*q+ +g[k+8>>2]*w+ +g[k+12>>2]*t;r=q*+g[k+20>>2]+w*+g[k+24>>2]+t*+g[k+28>>2];t=q*+g[k+36>>2]+w*+g[k+40>>2]+t*+g[k+44>>2];l=c[d+12>>2]|0;g[l>>2]=0.0;g[l+4>>2]=t;g[l+8>>2]=-r;g[l+12>>2]=0.0;g[l+(m<<2)>>2]=-t;g[l+(m+1<<2)>>2]=0.0;g[l+(m+2<<2)>>2]=u;g[l+(m+3<<2)>>2]=0.0;g[l+(m<<1<<2)>>2]=r;g[l+((m<<1|1)<<2)>>2]=-u;g[l+((m<<1)+2<<2)>>2]=0.0;g[l+((m<<1)+3<<2)>>2]=0.0;l=c[d+16>>2]|0;g[l>>2]=-1.0;g[l+(m+1<<2)>>2]=-1.0;g[l+((m<<1)+2<<2)>>2]=-1.0;w=+g[b+412>>2];q=+g[b+416>>2];p=+g[b+420>>2];v=+g[o+4>>2]*w+ +g[o+8>>2]*q+ +g[o+12>>2]*p;s=w*+g[o+20>>2]+q*+g[o+24>>2]+p*+g[o+28>>2];p=w*+g[o+36>>2]+q*+g[o+40>>2]+p*+g[o+44>>2];l=c[d+20>>2]|0;g[l>>2]=0.0;g[l+4>>2]=-p;g[l+8>>2]=s;g[l+12>>2]=0.0;g[l+(m<<2)>>2]=p;g[l+(m+1<<2)>>2]=0.0;g[l+(m+2<<2)>>2]=-v;g[l+(m+3<<2)>>2]=0.0;g[l+(m<<1<<2)>>2]=-s;g[l+((m<<1|1)<<2)>>2]=v;g[l+((m<<1)+2<<2)>>2]=0.0;g[l+((m<<1)+3<<2)>>2]=0.0;m=c[b+592>>2]|0;q=+g[((m&2|0)==0?d+4|0:b+600|0)>>2]*+g[d>>2];f=c[d+24>>2]|0;n=c[d+28>>2]|0;j=c[d+36>>2]|0;h=c[d+40>>2]|0;g[n>>2]=q*(v+ +g[o+52>>2]-u- +g[k+52>>2]);g[j>>2]=-3.4028234663852886e+38;g[h>>2]=3.4028234663852886e+38;if((m&1|0)==0){g[n+(f<<2)>>2]=q*(s+ +g[o+56>>2]-r- +g[k+56>>2]);g[j+(f<<2)>>2]=-3.4028234663852886e+38;g[h+(f<<2)>>2]=3.4028234663852886e+38;g[n+(f<<1<<2)>>2]=q*(p+ +g[o+60>>2]-t- +g[k+60>>2]);g[j+(f<<1<<2)>>2]=-3.4028234663852886e+38;g[h+(f<<1<<2)>>2]=3.4028234663852886e+38}else{x=c[d+32>>2]|0;g[x>>2]=+g[b+596>>2];g[n+(f<<2)>>2]=q*(s+ +g[o+56>>2]-r- +g[k+56>>2]);g[j+(f<<2)>>2]=-3.4028234663852886e+38;g[h+(f<<2)>>2]=3.4028234663852886e+38;g[x+(f<<2)>>2]=+g[b+596>>2];g[n+(f<<1<<2)>>2]=q*(p+ +g[o+60>>2]-t- +g[k+60>>2]);g[j+(f<<1<<2)>>2]=-3.4028234663852886e+38;g[h+(f<<1<<2)>>2]=3.4028234663852886e+38;g[x+(f<<1<<2)>>2]=+g[b+596>>2]}do if((a[b+526>>0]|0)==0)f=f*3|0;else{o=c[d+12>>2]|0;w=+g[b+456>>2];if(+g[b+444>>2]<w?+g[b+448>>2]<w:0){co(e,k+4|0,b+300|0);q=+g[e+4>>2];r=+g[e+20>>2];s=+g[e+36>>2];u=+g[e+8>>2];v=+g[e+24>>2];w=+g[e+40>>2];m=c[d+24>>2]|0;x=m+(f*3|0)|0;g[o+(f*3<<2)>>2]=q;g[o+((f*3|0)+1<<2)>>2]=r;g[o+((f*3|0)+2<<2)>>2]=s;g[o+(x<<2)>>2]=u;g[o+(x+1<<2)>>2]=v;g[o+(x+2<<2)>>2]=w;g[l+(f*3<<2)>>2]=-q;g[l+((f*3|0)+1<<2)>>2]=-r;g[l+((f*3|0)+2<<2)>>2]=-s;g[l+(x<<2)>>2]=-u;g[l+(x+1<<2)>>2]=-v;g[l+(x+2<<2)>>2]=-w;t=+g[d>>2]*+g[b+436>>2];n=c[d+28>>2]|0;g[n+(f*3<<2)>>2]=t*(q*+g[b+460>>2]+r*+g[b+464>>2]+s*+g[b+468>>2]);g[n+(x<<2)>>2]=t*(u*+g[b+460>>2]+v*+g[b+464>>2]+w*+g[b+468>>2]);j=c[d+36>>2]|0;g[j+(f*3<<2)>>2]=-3.4028234663852886e+38;h=c[d+40>>2]|0;g[h+(f*3<<2)>>2]=3.4028234663852886e+38;g[j+(x<<2)>>2]=-3.4028234663852886e+38;g[h+(x<<2)>>2]=3.4028234663852886e+38;f=m+x|0;break}w=+g[b+436>>2];u=w*+g[b+460>>2]*w;v=w*w*+g[b+464>>2];w=w*w*+g[b+468>>2];g[o+(f*3<<2)>>2]=u;g[o+((f*3|0)+1<<2)>>2]=v;g[o+((f*3|0)+2<<2)>>2]=w;g[l+(f*3<<2)>>2]=-u;g[l+((f*3|0)+1<<2)>>2]=-v;g[l+((f*3|0)+2<<2)>>2]=-w;g[n+(f*3<<2)>>2]=+g[d>>2]*+g[b+432>>2]*+g[b+504>>2];if((m&4|0)!=0)g[(c[d+32>>2]|0)+(f*3<<2)>>2]=+g[b+604>>2];g[j+(f*3<<2)>>2]=0.0;g[h+(f*3<<2)>>2]=3.4028234663852886e+38;f=f+(f*3|0)|0}while(0);if((a[b+525>>0]|0)==0){i=e;return}w=+g[b+436>>2];u=w*+g[b+476>>2]*w;v=w*w*+g[b+480>>2];w=w*w*+g[b+484>>2];l=c[d+12>>2]|0;o=c[d+20>>2]|0;g[l+(f<<2)>>2]=u;m=f+1|0;g[l+(m<<2)>>2]=v;x=f+2|0;g[l+(x<<2)>>2]=w;g[o+(f<<2)>>2]=-u;g[o+(m<<2)>>2]=-v;g[o+(x<<2)>>2]=-w;g[n+(f<<2)>>2]=+g[d>>2]*+g[b+432>>2]*+g[b+508>>2];if((c[b+592>>2]&4|0)!=0)g[(c[d+32>>2]|0)+(f<<2)>>2]=+g[b+604>>2];if(!(+g[b+452>>2]>0.0)){g[j+(f<<2)>>2]=-3.4028234663852886e+38;g[h+(f<<2)>>2]=3.4028234663852886e+38;i=e;return}d=j+(f<<2)|0;if(+g[b+508>>2]>0.0){g[d>>2]=0.0;g[h+(f<<2)>>2]=3.4028234663852886e+38;i=e;return}else{g[d>>2]=-3.4028234663852886e+38;g[h+(f<<2)>>2]=0.0;i=e;return}}function po(b){b=b|0;var d=0,e=0.0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0,M=0;d=i;i=i+176|0;if((a[b+527>>0]|0)==0){i=d;return}g[b+36>>2]=0.0;g[b+520>>2]=0.0;g[b+516>>2]=0.0;c[b+576>>2]=0;c[b+580>>2]=0;c[b+584>>2]=0;c[b+588>>2]=0;a:do if((a[b+524>>0]|0)==0){L=c[b+28>>2]|0;A=+g[b+348>>2];z=+g[b+352>>2];f=+g[b+356>>2];e=A*+g[L+20>>2]+z*+g[L+24>>2]+f*+g[L+28>>2]+ +g[L+56>>2];y=c[b+32>>2]|0;j=+g[b+412>>2];k=+g[y+4>>2];l=+g[b+416>>2];m=+g[y+8>>2];n=+g[b+420>>2];x=+g[y+12>>2];q=+g[y+20>>2];r=+g[y+24>>2];s=+g[y+28>>2];u=+g[y+36>>2];v=+g[y+40>>2];w=+g[y+44>>2];p=+g[y+52>>2];t=+g[y+56>>2];o=+g[y+60>>2];B=j*q+l*r+n*s+t-e;h=A*+g[L+4>>2]+z*+g[L+8>>2]+f*+g[L+12>>2]+ +g[L+52>>2];f=A*+g[L+36>>2]+z*+g[L+40>>2]+f*+g[L+44>>2]+ +g[L+60>>2];z=j*k+l*m+n*x+p-h;A=j*u+l*v+n*w+o-f;if(z*z+B*B+A*A>1.1920928955078125e-7){K=1.0/+Q(+(z*z+B*B+A*A));g[d+128>>2]=z*K;g[d+132>>2]=B*K;g[d+136>>2]=A*K;g[d+140>>2]=0.0;A=A*K;B=B*K;z=z*K}else{g[d+128>>2]=1.0;g[d+132>>2]=0.0;g[d+136>>2]=0.0;g[d+140>>2]=0.0;A=0.0;B=0.0;z=1.0}if(+P(+A)>.7071067690849304){H=A*A+B*B;I=1.0/+Q(+H);g[d+144>>2]=0.0;K=-(I*A);g[d+148>>2]=K;J=I*B;g[d+152>>2]=J;g[d+160>>2]=H*I;g[d+164>>2]=-(z*J);g[d+168>>2]=z*K}else{J=z*z+B*B;K=1.0/+Q(+J);I=-(B*K);g[d+144>>2]=I;H=K*z;g[d+148>>2]=H;g[d+152>>2]=0.0;g[d+160>>2]=-(A*H);g[d+164>>2]=A*I;g[d+168>>2]=J*K}F=k;B=q;C=u;D=m;E=r;I=v;A=x;K=s;J=w;z=p;H=t;G=o;L=0;while(1){M=c[b+28>>2]|0;g[d+80>>2]=+g[M+4>>2];g[d+84>>2]=+g[M+20>>2];g[d+88>>2]=+g[M+36>>2];g[d+92>>2]=0.0;g[d+96>>2]=+g[M+8>>2];g[d+100>>2]=+g[M+24>>2];g[d+104>>2]=+g[M+40>>2];g[d+108>>2]=0.0;g[d+112>>2]=+g[M+12>>2];g[d+116>>2]=+g[M+28>>2];g[d+120>>2]=+g[M+44>>2];g[d+124>>2]=0.0;g[d+32>>2]=F;g[d+36>>2]=B;g[d+40>>2]=C;g[d+44>>2]=0.0;g[d+48>>2]=D;g[d+52>>2]=E;g[d+56>>2]=I;g[d+60>>2]=0.0;g[d+64>>2]=A;g[d+68>>2]=K;g[d+72>>2]=J;g[d+76>>2]=0.0;J=e- +g[M+56>>2];K=f- +g[M+60>>2];g[d+16>>2]=h- +g[M+52>>2];g[d+20>>2]=J;g[d+24>>2]=K;g[d+28>>2]=0.0;g[d>>2]=j*k+l*m+n*x+p-z;g[d+4>>2]=j*q+l*r+n*s+t-H;g[d+8>>2]=j*u+l*v+n*w+o-G;g[d+12>>2]=0.0;Co(b+(L*84|0)+48|0,d+80|0,d+32|0,d+16|0,d,d+128+(L<<4)|0,M+396|0,+g[M+344>>2],y+396|0,+g[y+344>>2]);L=L+1|0;if((L|0)==3){y=b+32|0;break a}y=c[b+32>>2]|0;F=+g[y+4>>2];B=+g[y+20>>2];C=+g[y+36>>2];D=+g[y+8>>2];E=+g[y+24>>2];I=+g[y+40>>2];A=+g[y+12>>2];K=+g[y+28>>2];J=+g[y+44>>2];z=+g[y+52>>2];H=+g[y+56>>2];G=+g[y+60>>2]}}else y=b+32|0;while(0);L=c[b+28>>2]|0;M=c[y>>2]|0;no(b,L+4|0,M+4|0,L+264|0,M+264|0);i=d;return}function qo(b,d,e,f){b=b|0;d=d|0;e=e|0;f=+f;var h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0,K=0,L=0,M=0,N=0,O=0,P=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0.0,X=0.0,Y=0.0,Z=0.0,_=0.0,$=0.0,aa=0.0;h=i;i=i+448|0;if((a[b+527>>0]|0)==0){i=h;return}O=c[b+28>>2]|0;I=+g[b+348>>2];E=+g[b+352>>2];F=+g[b+356>>2];C=+g[O+52>>2];D=I*+g[O+4>>2]+E*+g[O+8>>2]+F*+g[O+12>>2]+C;z=+g[O+56>>2];B=I*+g[O+20>>2]+E*+g[O+24>>2]+F*+g[O+28>>2]+z;p=+g[O+60>>2];F=I*+g[O+36>>2]+E*+g[O+40>>2]+F*+g[O+44>>2]+p;O=c[b+32>>2]|0;E=+g[b+412>>2];I=+g[b+416>>2];y=+g[b+420>>2];w=+g[O+52>>2];v=E*+g[O+4>>2]+I*+g[O+8>>2]+y*+g[O+12>>2]+w;G=+g[O+56>>2];H=E*+g[O+20>>2]+I*+g[O+24>>2]+y*+g[O+28>>2]+G;u=+g[O+60>>2];y=E*+g[O+36>>2]+I*+g[O+40>>2]+y*+g[O+44>>2]+u;if((a[b+524>>0]|0)==0){s=+g[d+192>>2]+ +g[d+80>>2];t=+g[d+196>>2]+ +g[d+84>>2];r=+g[d+200>>2]+ +g[d+88>>2];I=+g[e+192>>2]+ +g[e+80>>2];E=+g[e+196>>2]+ +g[e+84>>2];A=+g[e+200>>2]+ +g[e+88>>2];x=+g[d+176>>2]+ +g[d+64>>2]+((F-p)*t-(B-z)*r)-(+g[e+176>>2]+ +g[e+64>>2]+((y-u)*E-(H-G)*A));A=+g[d+180>>2]+ +g[d+68>>2]+((D-C)*r-(F-p)*s)-(+g[e+180>>2]+ +g[e+68>>2]+((v-w)*A-(y-u)*I));E=+g[d+184>>2]+ +g[d+72>>2]+((B-z)*s-(D-C)*t)-(+g[e+184>>2]+ +g[e+72>>2]+((H-G)*I-(v-w)*E));n=c[d+240>>2]|0;j=0;do{q=1.0/+g[b+(j*84|0)+128>>2];m=b+(j*84|0)+48|0;s=+g[m>>2];k=b+(j*84|0)+52|0;r=+g[k>>2];l=b+(j*84|0)+56|0;t=+g[l>>2];t=q*(((D-v)*s+(B-H)*r+(F-y)*t)*-.30000001192092896/f)-q*(x*s+A*r+E*t);g[b+36>>2]=+g[b+36>>2]+t;r=+g[l>>2];s=+g[k>>2];q=+g[m>>2];o=c[b+28>>2]|0;I=+g[o+344>>2];if((n|0)!=0){S=((F-p)*q-(D-C)*r)*+g[o+300>>2]+((B-z)*r-(F-p)*s)*+g[o+296>>2]+((D-C)*s-(B-z)*q)*+g[o+304>>2];P=((F-p)*q-(D-C)*r)*+g[o+284>>2]+((B-z)*r-(F-p)*s)*+g[o+280>>2]+((D-C)*s-(B-z)*q)*+g[o+288>>2];R=((F-p)*q-(D-C)*r)*+g[o+268>>2]+((B-z)*r-(F-p)*s)*+g[o+264>>2]+((D-C)*s-(B-z)*q)*+g[o+272>>2];U=t*s*I*+g[d+116>>2];T=t*r*I*+g[d+120>>2];g[d+64>>2]=t*q*I*+g[d+112>>2]+ +g[d+64>>2];g[d+68>>2]=U+ +g[d+68>>2];g[d+72>>2]=T+ +g[d+72>>2];P=P*t*+g[d+100>>2];I=S*t*+g[d+104>>2];g[d+80>>2]=R*t*+g[d+96>>2]+ +g[d+80>>2];g[d+84>>2]=P+ +g[d+84>>2];g[d+88>>2]=I+ +g[d+88>>2]}o=c[b+32>>2]|0;I=+g[o+344>>2];if((c[e+240>>2]|0)!=0){U=((y-u)*q-(v-w)*r)*+g[o+300>>2]+((H-G)*r-(y-u)*s)*+g[o+296>>2]+((v-w)*s-(H-G)*q)*+g[o+304>>2];T=((y-u)*q-(v-w)*r)*+g[o+284>>2]+((H-G)*r-(y-u)*s)*+g[o+280>>2]+((v-w)*s-(H-G)*q)*+g[o+288>>2];S=((y-u)*q-(v-w)*r)*+g[o+268>>2]+((H-G)*r-(y-u)*s)*+g[o+264>>2]+((v-w)*s-(H-G)*q)*+g[o+272>>2];P=I*+g[k>>2]*-t*+g[e+116>>2];R=I*+g[l>>2]*-t*+g[e+120>>2];g[e+64>>2]=+g[e+112>>2]*I*+g[m>>2]*-t+ +g[e+64>>2];g[e+68>>2]=P+ +g[e+68>>2];g[e+72>>2]=R+ +g[e+72>>2];T=T*+g[e+100>>2]*-t;U=U*+g[e+104>>2]*-t;g[e+80>>2]=S*+g[e+96>>2]*-t+ +g[e+80>>2];g[e+84>>2]=T+ +g[e+84>>2];g[e+88>>2]=U+ +g[e+88>>2]}j=j+1|0}while((j|0)!=3)}do if((a[b+552>>0]|0)==0){q=+g[b+440>>2];if(!(q>1.1920928955078125e-7)){n=d+80|0;N=d+196|0;m=d+84|0;M=d+200|0;o=d+88|0;L=e+192|0;k=e+80|0;K=e+196|0;l=e+84|0;J=e+200|0;j=e+88|0;O=d+192|0;break}z=+g[e+192>>2]+ +g[e+80>>2]-(+g[d+192>>2]+ +g[d+80>>2]);B=+g[e+196>>2]+ +g[e+84>>2]-(+g[d+196>>2]+ +g[d+84>>2]);A=+g[e+200>>2]+ +g[e+88>>2]-(+g[d+200>>2]+ +g[d+88>>2]);if(z*z+B*B+A*A>1.1920928955078125e-7){U=1.0/+Q(+(z*z+B*B+A*A));j=c[b+28>>2]|0;p=+g[j+264>>2];x=+g[j+280>>2];u=+g[j+296>>2];s=+g[j+268>>2];y=+g[j+284>>2];v=+g[j+300>>2];r=+g[j+272>>2];w=+g[j+288>>2];t=+g[j+304>>2];j=c[b+32>>2]|0;U=q*(1.0/(z*U*(z*U*p+B*U*x+A*U*u)+B*U*(z*U*s+B*U*y+A*U*v)+A*U*(z*U*r+B*U*w+A*U*t)+(z*U*(z*U*+g[j+264>>2]+B*U*+g[j+280>>2]+A*U*+g[j+296>>2])+B*U*(z*U*+g[j+268>>2]+B*U*+g[j+284>>2]+A*U*+g[j+300>>2])+A*U*(z*U*+g[j+272>>2]+B*U*+g[j+288>>2]+A*U*+g[j+304>>2]))));q=+Q(+(A*U*A*U+(z*U*z*U+B*U*B*U)));z=1.0/q*z*U;B=1.0/q*B*U;A=1.0/q*A*U;if((c[d+240>>2]|0)!=0){U=q*0.0*+g[d+116>>2];T=q*0.0*+g[d+120>>2];g[d+64>>2]=q*0.0*+g[d+112>>2]+ +g[d+64>>2];g[d+68>>2]=U+ +g[d+68>>2];g[d+72>>2]=T+ +g[d+72>>2];T=(B*y+z*x+A*w)*q*+g[d+100>>2];U=(B*v+z*u+A*t)*q*+g[d+104>>2];g[d+80>>2]=(B*s+z*p+A*r)*q*+g[d+96>>2]+ +g[d+80>>2];g[d+84>>2]=T+ +g[d+84>>2];g[d+88>>2]=U+ +g[d+88>>2];j=c[b+32>>2]|0}if((c[e+240>>2]|0)!=0){U=B*+g[j+300>>2]+z*+g[j+296>>2]+A*+g[j+304>>2];T=B*+g[j+284>>2]+z*+g[j+280>>2]+A*+g[j+288>>2];S=B*+g[j+268>>2]+z*+g[j+264>>2]+A*+g[j+272>>2];P=q*-0.0*+g[e+116>>2];R=q*-0.0*+g[e+120>>2];g[e+64>>2]=q*-0.0*+g[e+112>>2]+ +g[e+64>>2];g[e+68>>2]=P+ +g[e+68>>2];g[e+72>>2]=R+ +g[e+72>>2];T=T*+g[e+100>>2]*-q;U=U*+g[e+104>>2]*-q;g[e+80>>2]=S*+g[e+96>>2]*-q+ +g[e+80>>2];g[e+84>>2]=T+ +g[e+84>>2];g[e+88>>2]=U+ +g[e+88>>2];n=d+80|0;N=d+196|0;m=d+84|0;M=d+200|0;o=d+88|0;L=e+192|0;k=e+80|0;K=e+196|0;l=e+84|0;J=e+200|0;j=e+88|0;O=d+192|0}else{n=d+80|0;N=d+196|0;m=d+84|0;M=d+200|0;o=d+88|0;L=e+192|0;k=e+80|0;K=e+196|0;l=e+84|0;J=e+200|0;j=e+88|0;O=d+192|0}}else{n=d+80|0;N=d+196|0;m=d+84|0;M=d+200|0;o=d+88|0;L=e+192|0;k=e+80|0;K=e+196|0;l=e+84|0;J=e+200|0;j=e+88|0;O=d+192|0}}else{N=c[b+28>>2]|0;c[h+352>>2]=c[N+4>>2];c[h+356>>2]=c[N+8>>2];c[h+360>>2]=c[N+12>>2];c[h+364>>2]=c[N+16>>2];c[h+368>>2]=c[N+20>>2];c[h+372>>2]=c[N+24>>2];c[h+376>>2]=c[N+28>>2];c[h+380>>2]=c[N+32>>2];c[h+384>>2]=c[N+36>>2];c[h+388>>2]=c[N+40>>2];c[h+392>>2]=c[N+44>>2];c[h+396>>2]=c[N+48>>2];c[h+400>>2]=c[N+52>>2];c[h+404>>2]=c[N+56>>2];c[h+408>>2]=c[N+60>>2];c[h+412>>2]=c[N+64>>2];N=c[b+32>>2]|0;c[h+288>>2]=c[N+4>>2];c[h+292>>2]=c[N+8>>2];c[h+296>>2]=c[N+12>>2];c[h+300>>2]=c[N+16>>2];c[h+304>>2]=c[N+20>>2];c[h+308>>2]=c[N+24>>2];c[h+312>>2]=c[N+28>>2];c[h+316>>2]=c[N+32>>2];c[h+320>>2]=c[N+36>>2];c[h+324>>2]=c[N+40>>2];c[h+328>>2]=c[N+44>>2];c[h+332>>2]=c[N+48>>2];c[h+336>>2]=c[N+52>>2];c[h+340>>2]=c[N+56>>2];c[h+344>>2]=c[N+60>>2];c[h+348>>2]=c[N+64>>2];S=+g[d+196>>2]+ +g[d+84>>2];C=+g[d+200>>2]+ +g[d+88>>2];g[h+272>>2]=+g[d+192>>2]+ +g[d+80>>2];g[h+276>>2]=S;g[h+280>>2]=C;g[h+284>>2]=0.0;C=+g[e+196>>2]+ +g[e+84>>2];S=+g[e+200>>2]+ +g[e+88>>2];g[h+256>>2]=+g[e+192>>2]+ +g[e+80>>2];g[h+260>>2]=C;g[h+264>>2]=S;g[h+268>>2]=0.0;g[h+192>>2]=1.0;N=h+196|0;c[N+0>>2]=0;c[N+4>>2]=0;c[N+8>>2]=0;c[N+12>>2]=0;g[h+212>>2]=1.0;O=h+216|0;c[O+0>>2]=0;c[O+4>>2]=0;c[O+8>>2]=0;c[O+12>>2]=0;g[h+232>>2]=1.0;L=h+236|0;c[L+0>>2]=0;c[L+4>>2]=0;c[L+8>>2]=0;c[L+12>>2]=0;c[L+16>>2]=0;ro(h+352|0,0.0,0.0,0.0,h+272|0,f,h+192|0);g[h+128>>2]=1.0;L=h+132|0;c[L+0>>2]=0;c[L+4>>2]=0;c[L+8>>2]=0;c[L+12>>2]=0;g[h+148>>2]=1.0;M=h+152|0;c[M+0>>2]=0;c[M+4>>2]=0;c[M+8>>2]=0;c[M+12>>2]=0;g[h+168>>2]=1.0;K=h+172|0;c[K+0>>2]=0;c[K+4>>2]=0;c[K+8>>2]=0;c[K+12>>2]=0;c[K+16>>2]=0;ro(h+288|0,0.0,0.0,0.0,h+256|0,f,h+128|0);S=+g[b+556>>2];C=+g[b+560>>2];T=+g[b+564>>2];D=+g[b+568>>2];G=S*(2.0/(S*S+C*C+T*T+D*D));r=C*(2.0/(S*S+C*C+T*T+D*D));H=T*(2.0/(S*S+C*C+T*T+D*D));W=+g[b+364>>2];V=+g[b+368>>2];Z=+g[b+372>>2];w=(S*H-D*r)*Z+(V*(S*r+D*H)+W*(1.0-(C*r+T*H)));x=Z*(C*H+D*G)+(W*(S*r-D*H)+V*(1.0-(S*G+T*H)));y=W*(S*H+D*r)+V*(C*H-D*G)+Z*(1.0-(S*G+C*r));v=+g[b+380>>2];F=+g[b+384>>2];p=+g[b+388>>2];z=(1.0-(C*r+T*H))*v+(S*r+D*H)*F+(S*H-D*r)*p;A=(S*r-D*H)*v+(1.0-(S*G+T*H))*F+(C*H+D*G)*p;B=(S*H+D*r)*v+(C*H-D*G)*F+(1.0-(S*G+C*r))*p;P=+g[b+396>>2];q=+g[b+400>>2];s=+g[b+404>>2];R=(1.0-(C*r+T*H))*P+(S*r+D*H)*q+(S*H-D*r)*s;T=(S*r-D*H)*P+(1.0-(S*G+T*H))*q+(C*H+D*G)*s;r=(S*H+D*r)*P+(C*H-D*G)*q+(1.0-(S*G+C*r))*s;C=+g[b+300>>2];G=+g[b+316>>2];S=+g[b+332>>2];D=+g[b+304>>2];H=+g[b+320>>2];U=+g[b+336>>2];E=+g[b+308>>2];I=+g[b+324>>2];t=+g[b+340>>2];u=-+g[b+348>>2];aa=-+g[b+352>>2];Y=-+g[b+356>>2];Z=W*0.0+V*0.0+Z*0.0+ +g[b+412>>2]+(y*(E*u+I*aa+t*Y)+(w*(C*u+G*aa+S*Y)+x*(D*u+H*aa+U*Y)));p=v*0.0+F*0.0+p*0.0+ +g[b+416>>2]+(B*(E*u+I*aa+t*Y)+(z*(C*u+G*aa+S*Y)+A*(D*u+H*aa+U*Y)));Y=P*0.0+q*0.0+s*0.0+ +g[b+420>>2]+(r*(E*u+I*aa+t*Y)+(R*(C*u+G*aa+S*Y)+T*(D*u+H*aa+U*Y)));aa=+g[h+128>>2];u=+g[L>>2];s=+g[h+136>>2];q=+g[h+144>>2];P=+g[h+148>>2];F=+g[M>>2];v=+g[h+160>>2];V=+g[h+164>>2];W=+g[h+168>>2];X=s*Y+(aa*Z+u*p)+ +g[h+176>>2];_=Y*F+(q*Z+P*p)+ +g[h+180>>2];$=Z*v+p*V+Y*W+ +g[h+184>>2];g[h+64>>2]=(w*C+x*D+y*E)*aa+(z*C+A*D+B*E)*u+(R*C+T*D+r*E)*s;g[h+68>>2]=(w*G+x*H+y*I)*aa+(z*G+A*H+B*I)*u+(R*G+T*H+r*I)*s;g[h+72>>2]=(w*S+x*U+y*t)*aa+(z*S+A*U+B*t)*u+(R*S+T*U+r*t)*s;g[h+76>>2]=0.0;g[h+80>>2]=(w*C+x*D+y*E)*q+(z*C+A*D+B*E)*P+(R*C+T*D+r*E)*F;g[h+84>>2]=(w*G+x*H+y*I)*q+(z*G+A*H+B*I)*P+(R*G+T*H+r*I)*F;g[h+88>>2]=(w*S+x*U+y*t)*q+(z*S+A*U+B*t)*P+(R*S+T*U+r*t)*F;g[h+92>>2]=0.0;g[h+96>>2]=(w*C+x*D+y*E)*v+(z*C+A*D+B*E)*V+(R*C+T*D+r*E)*W;g[h+100>>2]=(w*G+x*H+y*I)*v+(z*G+A*H+B*I)*V+(R*G+T*H+r*I)*W;g[h+104>>2]=(w*S+x*U+y*t)*v+(z*S+A*U+B*t)*V+(R*S+T*U+r*t)*W;g[h+108>>2]=0.0;g[h+112>>2]=X;g[h+116>>2]=_;g[h+120>>2]=$;g[h+124>>2]=0.0;$=(R*C+T*D+r*E)*-Y+((w*C+x*D+y*E)*-Z+(z*C+A*D+B*E)*-p);_=(R*G+T*H+r*I)*-Y+((w*G+x*H+y*I)*-Z+(z*G+A*H+B*I)*-p);p=(R*S+T*U+r*t)*-Y+((w*S+x*U+y*t)*-Z+(z*S+A*U+B*t)*-p);Z=+g[h+192>>2];Y=+g[N>>2];X=+g[h+200>>2];W=+g[h+208>>2];V=+g[h+212>>2];v=+g[O>>2];F=+g[h+224>>2];P=+g[h+228>>2];q=+g[h+232>>2];s=$*Z+_*Y+p*X+ +g[h+240>>2];u=$*W+_*V+p*v+ +g[h+244>>2];p=$*F+_*P+p*q+ +g[h+248>>2];g[h>>2]=(w*C+x*D+y*E)*Z+(w*G+x*H+y*I)*Y+(w*S+x*U+y*t)*X;g[h+4>>2]=(z*C+A*D+B*E)*Z+(z*G+A*H+B*I)*Y+(z*S+A*U+B*t)*X;g[h+8>>2]=(R*C+T*D+r*E)*Z+(R*G+T*H+r*I)*Y+(R*S+T*U+r*t)*X;g[h+12>>2]=0.0;g[h+16>>2]=(w*C+x*D+y*E)*W+(w*G+x*H+y*I)*V+(w*S+x*U+y*t)*v;g[h+20>>2]=(z*C+A*D+B*E)*W+(z*G+A*H+B*I)*V+(z*S+A*U+B*t)*v;g[h+24>>2]=(R*C+T*D+r*E)*W+(R*G+T*H+r*I)*V+(R*S+T*U+r*t)*v;g[h+28>>2]=0.0;g[h+32>>2]=(w*C+x*D+y*E)*F+(w*G+x*H+y*I)*P+(w*S+x*U+y*t)*q;g[h+36>>2]=(z*C+A*D+B*E)*F+(z*G+A*H+B*I)*P+(z*S+A*U+B*t)*q;g[h+40>>2]=(R*C+T*D+r*E)*F+(R*G+T*H+r*I)*P+(R*S+T*U+r*t)*q;g[h+44>>2]=0.0;g[h+48>>2]=s;g[h+52>>2]=u;g[h+56>>2]=p;g[h+60>>2]=0.0;Bo(h+352|0,h+64|0,h+424|0,h+416|0);p=+g[h+416>>2];u=1.0/f*+g[h+424>>2]*p;s=1.0/f*p*+g[h+428>>2];p=1.0/f*p*+g[h+432>>2];Bo(h+288|0,h,h+424|0,h+416|0);q=+g[h+416>>2];u=u- +g[h+272>>2];s=s- +g[h+276>>2];p=p- +g[h+280>>2];t=1.0/f*+g[h+424>>2]*q- +g[h+256>>2];r=1.0/f*q*+g[h+428>>2]- +g[h+260>>2];q=1.0/f*q*+g[h+432>>2]- +g[h+264>>2];if(u*u+s*s+p*p>1.1920928955078125e-7){x=1.0/+Q(+(u*u+s*s+p*p));O=c[b+28>>2]|0;A=u*x*(u*x*+g[O+264>>2]+s*x*+g[O+280>>2]+p*x*+g[O+296>>2])+s*x*(u*x*+g[O+268>>2]+s*x*+g[O+284>>2]+p*x*+g[O+300>>2])+p*x*(u*x*+g[O+272>>2]+s*x*+g[O+288>>2]+p*x*+g[O+304>>2]);v=u*x;y=s*x;x=p*x}else{A=0.0;v=0.0;y=0.0;x=0.0}if(t*t+r*r+q*q>1.1920928955078125e-7){w=1.0/+Q(+(t*t+r*r+q*q));O=c[b+32>>2]|0;z=t*w*(t*w*+g[O+264>>2]+r*w*+g[O+280>>2]+q*w*+g[O+296>>2])+r*w*(t*w*+g[O+268>>2]+r*w*+g[O+284>>2]+q*w*+g[O+300>>2])+q*w*(t*w*+g[O+272>>2]+r*w*+g[O+288>>2]+q*w*+g[O+304>>2]);C=t*w;B=r*w;w=q*w}else{z=0.0;C=0.0;B=0.0;w=0.0}v=v*A+C*z;y=y*A+B*z;x=x*A+w*z;if(x*x+(v*v+y*y)>1.1920928955078125e-7){aa=1.0/+Q(+(x*x+(v*v+y*y)));k=c[b+28>>2]|0;w=v*aa*(v*aa*+g[k+264>>2]+y*aa*+g[k+280>>2]+x*aa*+g[k+296>>2])+y*aa*(v*aa*+g[k+268>>2]+y*aa*+g[k+284>>2]+x*aa*+g[k+300>>2])+x*aa*(v*aa*+g[k+272>>2]+y*aa*+g[k+288>>2]+x*aa*+g[k+304>>2]);j=c[b+32>>2]|0;v=v*aa*(v*aa*+g[j+264>>2]+y*aa*+g[j+280>>2]+x*aa*+g[j+296>>2])+y*aa*(v*aa*+g[j+268>>2]+y*aa*+g[j+284>>2]+x*aa*+g[j+300>>2])+x*aa*(v*aa*+g[j+272>>2]+y*aa*+g[j+288>>2]+x*aa*+g[j+304>>2]);t=1.0/((w+v)*(w+v))*(u*w-t*v);r=1.0/((w+v)*(w+v))*(s*w-r*v);p=1.0/((w+v)*(w+v))*(p*w-q*v);v=+g[b+572>>2];if(v>=0.0){if((a[b+553>>0]|0)!=0)v=v/w;s=+g[b+576>>2];q=+g[b+580>>2];u=+g[b+584>>2];w=+Q(+((t+s)*(t+s)+(r+q)*(r+q)+(p+u)*(p+u)));if(w>v){t=v*(t+s)*(1.0/w)-s;r=v*(r+q)*(1.0/w)-q;p=v*(p+u)*(1.0/w)-u}g[b+576>>2]=t+s;g[b+580>>2]=r+q;g[b+584>>2]=p+u}q=+Q(+(p*p+(r*r+t*t)));s=t*(1.0/q);r=r*(1.0/q);p=p*(1.0/q);if((c[d+240>>2]|0)!=0){aa=r*+g[k+300>>2]+s*+g[k+296>>2]+p*+g[k+304>>2];$=r*+g[k+284>>2]+s*+g[k+280>>2]+p*+g[k+288>>2];_=r*+g[k+268>>2]+s*+g[k+264>>2]+p*+g[k+272>>2];Y=q*0.0*+g[d+116>>2];Z=q*0.0*+g[d+120>>2];g[d+64>>2]=q*0.0*+g[d+112>>2]+ +g[d+64>>2];g[d+68>>2]=Y+ +g[d+68>>2];g[d+72>>2]=Z+ +g[d+72>>2];$=$*q*+g[d+100>>2];aa=aa*q*+g[d+104>>2];g[d+80>>2]=_*q*+g[d+96>>2]+ +g[d+80>>2];g[d+84>>2]=$+ +g[d+84>>2];g[d+88>>2]=aa+ +g[d+88>>2];j=c[b+32>>2]|0}if((c[e+240>>2]|0)!=0){aa=r*+g[j+300>>2]+s*+g[j+296>>2]+p*+g[j+304>>2];$=r*+g[j+284>>2]+s*+g[j+280>>2]+p*+g[j+288>>2];_=r*+g[j+268>>2]+s*+g[j+264>>2]+p*+g[j+272>>2];Y=q*-0.0*+g[e+116>>2];Z=q*-0.0*+g[e+120>>2];g[e+64>>2]=q*-0.0*+g[e+112>>2]+ +g[e+64>>2];g[e+68>>2]=Y+ +g[e+68>>2];g[e+72>>2]=Z+ +g[e+72>>2];$=$*+g[e+100>>2]*-q;aa=aa*+g[e+104>>2]*-q;g[e+80>>2]=_*+g[e+96>>2]*-q+ +g[e+80>>2];g[e+84>>2]=$+ +g[e+84>>2];g[e+88>>2]=aa+ +g[e+88>>2];n=d+80|0;N=d+196|0;m=d+84|0;M=d+200|0;o=d+88|0;L=e+192|0;k=e+80|0;K=e+196|0;l=e+84|0;J=e+200|0;j=e+88|0;O=d+192|0}else{n=d+80|0;N=d+196|0;m=d+84|0;M=d+200|0;o=d+88|0;L=e+192|0;k=e+80|0;K=e+196|0;l=e+84|0;J=e+200|0;j=e+88|0;O=d+192|0}}else{n=d+80|0;N=d+196|0;m=d+84|0;M=d+200|0;o=d+88|0;L=e+192|0;k=e+80|0;K=e+196|0;l=e+84|0;J=e+200|0;j=e+88|0;O=d+192|0}}while(0);p=+g[O>>2]+ +g[n>>2];q=+g[N>>2]+ +g[m>>2];r=+g[M>>2]+ +g[o>>2];s=+g[L>>2]+ +g[k>>2];t=+g[K>>2]+ +g[l>>2];u=+g[J>>2]+ +g[j>>2];if((a[b+526>>0]|0)!=0){z=+g[b+528>>2];w=z*+g[b+504>>2]*+g[b+432>>2]/f;x=+g[b+460>>2];y=+g[b+464>>2];v=+g[b+468>>2];if((s-p)*x+(t-q)*y+(u-r)*v>0.0)w=w+z*((s-p)*x+(t-q)*y+(u-r)*v)*+g[b+436>>2];_=+g[b+516>>2];Z=_+w*+g[b+492>>2];Z=Z>0.0?Z:0.0;g[b+516>>2]=Z;X=+g[b+536>>2];Y=+g[b+540>>2];$=+g[b+544>>2];aa=X*x*(Z-_)+y*(Z-_)*Y+v*(Z-_)*$;w=+Q(+((v*(Z-_)-$*aa)*(v*(Z-_)-$*aa)+((x*(Z-_)-X*aa)*(x*(Z-_)-X*aa)+(y*(Z-_)-Y*aa)*(y*(Z-_)-Y*aa))));x=1.0/w*(x*(Z-_)-X*aa);y=1.0/w*(y*(Z-_)-Y*aa);v=1.0/w*(v*(Z-_)-$*aa);J=c[b+28>>2]|0;if((c[d+240>>2]|0)!=0){aa=y*+g[J+300>>2]+x*+g[J+296>>2]+v*+g[J+304>>2];$=y*+g[J+284>>2]+x*+g[J+280>>2]+v*+g[J+288>>2];_=y*+g[J+268>>2]+x*+g[J+264>>2]+v*+g[J+272>>2];Y=w*0.0*+g[d+116>>2];Z=w*0.0*+g[d+120>>2];g[d+64>>2]=w*0.0*+g[d+112>>2]+ +g[d+64>>2];g[d+68>>2]=Y+ +g[d+68>>2];g[d+72>>2]=Z+ +g[d+72>>2];$=$*w*+g[d+100>>2];aa=aa*w*+g[d+104>>2];g[n>>2]=_*w*+g[d+96>>2]+ +g[n>>2];g[m>>2]=$+ +g[m>>2];g[o>>2]=aa+ +g[o>>2]}J=c[b+32>>2]|0;if((c[e+240>>2]|0)!=0){aa=y*+g[J+300>>2]+x*+g[J+296>>2]+v*+g[J+304>>2];$=y*+g[J+284>>2]+x*+g[J+280>>2]+v*+g[J+288>>2];_=y*+g[J+268>>2]+x*+g[J+264>>2]+v*+g[J+272>>2];Y=w*-0.0*+g[e+116>>2];Z=w*-0.0*+g[e+120>>2];g[e+64>>2]=w*-0.0*+g[e+112>>2]+ +g[e+64>>2];g[e+68>>2]=Y+ +g[e+68>>2];g[e+72>>2]=Z+ +g[e+72>>2];$=$*+g[e+100>>2]*-w;aa=aa*+g[e+104>>2]*-w;g[k>>2]=_*+g[e+96>>2]*-w+ +g[k>>2];g[l>>2]=$+ +g[l>>2];g[j>>2]=aa+ +g[j>>2]}}if((a[b+525>>0]|0)==0){i=h;return}x=+g[b+532>>2];y=x*+g[b+508>>2]*+g[b+432>>2]/f;v=+g[b+476>>2];w=+g[b+480>>2];f=+g[b+484>>2];if((s-p)*v+(t-q)*w+(u-r)*f>0.0)y=y+x*((s-p)*v+(t-q)*w+(u-r)*f)*+g[b+436>>2];p=+g[b+520>>2];q=p+y*+g[b+496>>2];q=q>0.0?q:0.0;g[b+520>>2]=q;J=c[b+28>>2]|0;if((c[d+240>>2]|0)!=0){aa=w*+g[J+300>>2]+v*+g[J+296>>2]+f*+g[J+304>>2];$=w*+g[J+284>>2]+v*+g[J+280>>2]+f*+g[J+288>>2];f=w*+g[J+268>>2]+v*+g[J+264>>2]+f*+g[J+272>>2];w=(q-p)*0.0*+g[d+116>>2];v=(q-p)*0.0*+g[d+120>>2];g[d+64>>2]=(q-p)*0.0*+g[d+112>>2]+ +g[d+64>>2];g[d+68>>2]=w+ +g[d+68>>2];g[d+72>>2]=v+ +g[d+72>>2];v=$*(q-p)*+g[d+100>>2];w=aa*(q-p)*+g[d+104>>2];g[n>>2]=f*(q-p)*+g[d+96>>2]+ +g[n>>2];g[m>>2]=v+ +g[m>>2];g[o>>2]=w+ +g[o>>2];w=+g[b+480>>2];v=+g[b+476>>2];f=+g[b+484>>2]}b=c[b+32>>2]|0;if((c[e+240>>2]|0)==0){i=h;return}aa=w*+g[b+300>>2]+v*+g[b+296>>2]+f*+g[b+304>>2];$=w*+g[b+284>>2]+v*+g[b+280>>2]+f*+g[b+288>>2];_=w*+g[b+268>>2]+v*+g[b+264>>2]+f*+g[b+272>>2];Y=(q-p)*-0.0*+g[e+116>>2];Z=(q-p)*-0.0*+g[e+120>>2];g[e+64>>2]=(q-p)*-0.0*+g[e+112>>2]+ +g[e+64>>2];g[e+68>>2]=Y+ +g[e+68>>2];g[e+72>>2]=Z+ +g[e+72>>2];$=$*+g[e+100>>2]*-(q-p);aa=aa*+g[e+104>>2]*-(q-p);g[k>>2]=_*+g[e+96>>2]*-(q-p)+ +g[k>>2];g[l>>2]=$+ +g[l>>2];g[j>>2]=aa+ +g[j>>2];i=h;return}function ro(a,b,c,d,e,f,h){a=a|0;b=+b;c=+c;d=+d;e=e|0;f=+f;h=h|0;var j=0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0;j=i;i=i+16|0;c=c*f+ +g[a+52>>2];d=d*f+ +g[a+56>>2];g[h+48>>2]=b*f+ +g[a+48>>2];g[h+52>>2]=c;g[h+56>>2]=d;g[h+60>>2]=0.0;d=+g[e>>2];b=+g[e+4>>2];c=+g[e+8>>2];k=+Q(+(d*d+b*b+c*c));if(k*f>.7853981852531433)k=.7853981852531433/f;if(k<.0010000000474974513)l=f*.5-k*f*f*f*.02083333395421505*k;else l=+T(+(k*.5*f))/k;o=l*d;b=l*b;c=l*c;q=+S(+(k*f*.5));Hc(a,j);n=+g[j>>2];p=+g[j+12>>2];f=+g[j+8>>2];l=+g[j+4>>2];r=1.0/+Q(+((q*p-o*n-b*l-c*f)*(q*p-o*n-b*l-c*f)+((c*p+q*f+o*l-b*n)*(c*p+q*f+o*l-b*n)+((q*n+o*p+b*f-c*l)*(q*n+o*p+b*f-c*l)+(c*n+(b*p+q*l)-o*f)*(c*n+(b*p+q*l)-o*f)))));d=(q*n+o*p+b*f-c*l)*r;k=r*(c*n+(b*p+q*l)-o*f);m=r*(c*p+q*f+o*l-b*n);f=r*(q*p-o*n-b*l-c*f);c=d*(2.0/(f*f+(m*m+(d*d+k*k))));l=2.0/(f*f+(m*m+(d*d+k*k)))*k;b=2.0/(f*f+(m*m+(d*d+k*k)))*m;g[h>>2]=1.0-(m*b+k*l);g[h+4>>2]=d*l-f*b;g[h+8>>2]=d*b+f*l;g[h+12>>2]=0.0;g[h+16>>2]=f*b+d*l;g[h+20>>2]=1.0-(d*c+m*b);g[h+24>>2]=k*b-f*c;g[h+28>>2]=0.0;g[h+32>>2]=d*b-f*l;g[h+36>>2]=f*c+k*b;g[h+40>>2]=1.0-(d*c+k*l);g[h+44>>2]=0.0;i=j;return}function so(a,b,c,d){a=a|0;b=b|0;c=+c;d=+d;var e=0.0,f=0.0,h=0.0,i=0.0,j=0.0,k=0.0,l=0.0;e=+S(+c);c=+T(+c);f=+g[b+444>>2];if(+P(+e)>1.1920928955078125e-7){j=+g[b+448>>2];h=c*c;i=e*e;f=+Q(+((c*c/(e*e)+1.0)/(1.0/(j*j)+c*c/(e*e)/(f*f))))}else{h=c*c;i=e*e}k=f*.5;j=+T(+k)/+Q(+(i+0.0+h));k=+S(+k);l=k*d+e*j*0.0-c*j*-0.0;i=k*0.0-c*j*d-j*0.0*0.0;f=k*0.0+j*0.0*0.0-e*j*d;h=-(j*0.0*d)-e*j*0.0-c*j*-0.0;g[a>>2]=c*j*i+(k*l+h*-(j*0.0))-f*-(e*j);g[a+4>>2]=f*-(j*0.0)+(k*i+h*-(e*j))-c*j*l;g[a+8>>2]=l*-(e*j)+(k*f+c*j*h)-i*-(j*0.0);g[a+12>>2]=0.0;return}function to(a,b){a=a|0;b=b|0;var d=0,e=0.0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,u=0.0;d=i;c[a+556>>2]=c[b+0>>2];c[a+560>>2]=c[b+4>>2];c[a+564>>2]=c[b+8>>2];c[a+568>>2]=c[b+12>>2];p=+g[a+568>>2];r=+g[a+560>>2];q=+g[a+564>>2];j=+g[a+556>>2];e=-j-r*0.0-q*0.0;h=(q+p*0.0-j*0.0)*-q+(p*(p+r*0.0-q*0.0)+e*-j)-(p*0.0+j*0.0-r)*-r;k=(p*0.0+j*0.0-r)*-j+(p*(q+p*0.0-j*0.0)+e*-r)-(p+r*0.0-q*0.0)*-q;e=(p+r*0.0-q*0.0)*-r+(p*(p*0.0+j*0.0-r)+e*-q)-(q+p*0.0-j*0.0)*-j;if(e*0.0+(k*0.0+h)<-.9999998807907104)if(+P(0.0)>.7071067690849304){f=0.0;e=t;k=t;h=0.0}else{f=-0.0;e=1.0;k=0.0;h=0.0}else{s=+Q(+((e*0.0+(k*0.0+h)+1.0)*2.0));f=(e*0.0-k*0.0)*(1.0/s);e=(h*0.0-e)*(1.0/s);k=(k-h*0.0)*(1.0/s);h=s*.5}s=1.0/+Q(+(h*h+(k*k+(e*e+f*f))));l=f*s;m=e*s;o=k*s;k=h*s;s=1.0/+Q(+((k*p-j*-l-r*-m-q*-o)*(k*p-j*-l-r*-m-q*-o)+((p*-o+k*q+r*-l-j*-m)*(p*-o+k*q+r*-l-j*-m)+((k*j+p*-l+q*-m-r*-o)*(k*j+p*-l+q*-m-r*-o)+(j*-o+(p*-m+k*r)-q*-l)*(j*-o+(p*-m+k*r)-q*-l)))));h=(k*j+p*-l+q*-m-r*-o)*s;e=s*(j*-o+(p*-m+k*r)-q*-l);f=s*(p*-o+k*q+r*-l-j*-m);j=s*(k*p-j*-l-r*-m-q*-o);s=+g[a+444>>2];if(s>=.05000000074505806?(n=+g[a+448>>2],n>=.05000000074505806):0){q=k<-1.0?-1.0:k;q=+V(+(q>1.0?1.0:q))*2.0;if(q>1.1920928955078125e-7){p=1.0/+Q(+(o*o+(l*l+m*m)));if(+P(+(m*p))>1.1920928955078125e-7){s=+Q(+((o*p*o*p/(m*p*m*p)+1.0)/(1.0/(n*n)+o*p*o*p/(m*p*m*p)/(s*s))));r=l*p;n=m*p;p=o*p}else{r=l*p;n=m*p;p=o*p}}else{s=0.0;r=0.0;n=0.0;p=0.0}if(+P(+q)>1.1920928955078125e-7){if(!(q>s)){k=-s;if(q<k)q=k}else q=s;k=q*.5;o=+T(+k)/+Q(+(p*p+(n*n+r*r)));k=+S(+k);l=r*o;m=n*o;o=p*o}}p=+g[a+452>>2];if(p>=.05000000074505806){r=j<-1.0?-1.0:j;r=+V(+(r>1.0?1.0:r))*2.0;if(r>3.1415927410125732){r=j>1.0?-1.0:-j;r=+V(+(r>1.0?1.0:r))*2.0;s=-h;n=-e;q=-f}else{s=h;n=e;q=f}if(r>1.1920928955078125e-7){u=1.0/+Q(+(q*q+(n*n+s*s)));s=s*u;n=n*u;q=q*u}if(+P(+r)>1.1920928955078125e-7){if(!(r>p))if(r<-p)p=-p;else p=r;j=p*.5;e=+T(+j)/+Q(+(q*q+(n*n+s*s)));h=s*e;j=+S(+j);f=q*e;e=n*e}}g[a+556>>2]=m*f+(l*j+k*h)-o*e;g[a+560>>2]=o*h+(m*j+k*e)-l*f;g[a+564>>2]=o*j+k*f+l*e-m*h;g[a+568>>2]=k*j-l*h-m*e-o*f;i=d;return}function uo(a,b,d,e){a=a|0;b=b|0;d=+d;e=e|0;var f=0;f=i;if((b|0)==2|(b|0)==1)if(e>>>0<3){g[a+600>>2]=d;c[a+592>>2]=c[a+592>>2]|2;i=f;return}else{g[a+432>>2]=d;i=f;return}else if((b|0)==4|(b|0)==3)if(e>>>0<3){g[a+596>>2]=d;c[a+592>>2]=c[a+592>>2]|1;i=f;return}else{g[a+604>>2]=d;c[a+592>>2]=c[a+592>>2]|4;i=f;return}else{i=f;return}}function vo(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0;d=i;do if((b|0)==2|(b|0)==1){if(c>>>0<3){e=+g[a+600>>2];break}if((c+ -3|0)>>>0<3)e=+g[a+432>>2];else e=0.0}else if((b|0)==4|(b|0)==3){if(c>>>0<3){e=+g[a+596>>2];break}if((c+ -3|0)>>>0<3)e=+g[a+604>>2];else e=0.0}else e=0.0;while(0);i=d;return+e}function wo(a,b,d){a=a|0;b=b|0;d=d|0;var e=0;e=i;c[a+300>>2]=c[b+0>>2];c[a+304>>2]=c[b+4>>2];c[a+308>>2]=c[b+8>>2];c[a+312>>2]=c[b+12>>2];c[a+316>>2]=c[b+16>>2];c[a+320>>2]=c[b+20>>2];c[a+324>>2]=c[b+24>>2];c[a+328>>2]=c[b+28>>2];c[a+332>>2]=c[b+32>>2];c[a+336>>2]=c[b+36>>2];c[a+340>>2]=c[b+40>>2];c[a+344>>2]=c[b+44>>2];c[a+348>>2]=c[b+48>>2];c[a+352>>2]=c[b+52>>2];c[a+356>>2]=c[b+56>>2];c[a+360>>2]=c[b+60>>2];c[a+364>>2]=c[d+0>>2];c[a+368>>2]=c[d+4>>2];c[a+372>>2]=c[d+8>>2];c[a+376>>2]=c[d+12>>2];c[a+380>>2]=c[d+16>>2];c[a+384>>2]=c[d+20>>2];c[a+388>>2]=c[d+24>>2];c[a+392>>2]=c[d+28>>2];c[a+396>>2]=c[d+32>>2];c[a+400>>2]=c[d+36>>2];c[a+404>>2]=c[d+40>>2];c[a+408>>2]=c[d+44>>2];c[a+412>>2]=c[d+48>>2];c[a+416>>2]=c[d+52>>2];c[a+420>>2]=c[d+56>>2];c[a+424>>2]=c[d+60>>2];Lb[c[(c[a>>2]|0)+8>>2]&511](a);i=e;return}function xo(a){a=a|0;return}function yo(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function zo(a){a=a|0;return 212}function Ao(a,b,c){a=a|0;b=b|0;c=c|0;var d=0;d=i;Pr(a,b,c)|0;g[b+52>>2]=+g[a+300>>2];g[b+56>>2]=+g[a+304>>2];g[b+60>>2]=+g[a+308>>2];g[b+64>>2]=+g[a+312>>2];g[b+68>>2]=+g[a+316>>2];g[b+72>>2]=+g[a+320>>2];g[b+76>>2]=+g[a+324>>2];g[b+80>>2]=+g[a+328>>2];g[b+84>>2]=+g[a+332>>2];g[b+88>>2]=+g[a+336>>2];g[b+92>>2]=+g[a+340>>2];g[b+96>>2]=+g[a+344>>2];g[b+100>>2]=+g[a+348>>2];g[b+104>>2]=+g[a+352>>2];g[b+108>>2]=+g[a+356>>2];g[b+112>>2]=+g[a+360>>2];g[b+116>>2]=+g[a+364>>2];g[b+120>>2]=+g[a+368>>2];g[b+124>>2]=+g[a+372>>2];g[b+128>>2]=+g[a+376>>2];g[b+132>>2]=+g[a+380>>2];g[b+136>>2]=+g[a+384>>2];g[b+140>>2]=+g[a+388>>2];g[b+144>>2]=+g[a+392>>2];g[b+148>>2]=+g[a+396>>2];g[b+152>>2]=+g[a+400>>2];g[b+156>>2]=+g[a+404>>2];g[b+160>>2]=+g[a+408>>2];g[b+164>>2]=+g[a+412>>2];g[b+168>>2]=+g[a+416>>2];g[b+172>>2]=+g[a+420>>2];g[b+176>>2]=+g[a+424>>2];g[b+180>>2]=+g[a+444>>2];g[b+184>>2]=+g[a+448>>2];g[b+188>>2]=+g[a+452>>2];g[b+192>>2]=+g[a+428>>2];g[b+196>>2]=+g[a+432>>2];g[b+200>>2]=+g[a+436>>2];g[b+204>>2]=+g[a+440>>2];i=d;return 1352}function Bo(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0;e=i;i=i+64|0;f=+g[a+20>>2];t=+g[a+40>>2];o=+g[a+24>>2];r=+g[a+36>>2];s=+g[a+32>>2];h=+g[a+16>>2];l=+g[a>>2];j=+g[a+4>>2];p=+g[a+8>>2];m=1.0/((f*t-o*r)*l+j*(o*s-t*h)+(r*h-f*s)*p);z=+g[b>>2];y=+g[b+4>>2];x=+g[b+8>>2];w=+g[b+16>>2];v=+g[b+20>>2];u=+g[b+24>>2];q=+g[b+32>>2];n=+g[b+36>>2];k=+g[b+40>>2];g[e+16>>2]=(f*t-o*r)*m*z+(o*s-t*h)*m*y+(r*h-f*s)*m*x;g[e+20>>2]=z*m*(r*p-t*j)+y*m*(t*l-s*p)+m*(s*j-r*l)*x;g[e+24>>2]=z*m*(o*j-f*p)+y*m*(h*p-o*l)+m*(f*l-h*j)*x;g[e+28>>2]=0.0;g[e+32>>2]=(f*t-o*r)*m*w+(o*s-t*h)*m*v+(r*h-f*s)*m*u;g[e+36>>2]=m*(r*p-t*j)*w+m*(t*l-s*p)*v+m*(s*j-r*l)*u;g[e+40>>2]=m*(o*j-f*p)*w+m*(h*p-o*l)*v+m*(f*l-h*j)*u;g[e+44>>2]=0.0;g[e+48>>2]=(f*t-o*r)*m*q+(o*s-t*h)*m*n+(r*h-f*s)*m*k;g[e+52>>2]=m*(r*p-t*j)*q+m*(t*l-s*p)*n+m*(s*j-r*l)*k;g[e+56>>2]=m*(o*j-f*p)*q+m*(h*p-o*l)*n+m*(f*l-h*j)*k;g[e+60>>2]=0.0;Hc(e+16|0,e);k=+g[e>>2];j=+g[e+4>>2];h=+g[e+8>>2];l=+g[e+12>>2];f=1.0/+Q(+(k*k+j*j+h*h+l*l));g[e>>2]=k*f;g[e+4>>2]=j*f;g[e+8>>2]=h*f;g[e+12>>2]=l*f;l=l*f<-1.0?-1.0:l*f;g[d>>2]=+V(+(l>1.0?1.0:l))*2.0;g[c>>2]=k*f;g[c+4>>2]=j*f;g[c+8>>2]=h*f;g[c+12>>2]=0.0;if(k*f*k*f+j*f*j*f+h*f*h*f<1.4210854715202004e-14){g[c>>2]=1.0;g[c+4>>2]=0.0;g[c+8>>2]=0.0;g[c+12>>2]=0.0;i=e;return}else{z=1.0/+Q(+(k*f*k*f+j*f*j*f+h*f*h*f));g[c>>2]=k*f*z;g[c+4>>2]=z*j*f;g[c+8>>2]=z*h*f;i=e;return}}function Co(a,b,d,e,f,h,j,k,l,m){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;k=+k;l=l|0;m=+m;var n=0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0;n=i;c[a+0>>2]=c[h+0>>2];c[a+4>>2]=c[h+4>>2];c[a+8>>2]=c[h+8>>2];c[a+12>>2]=c[h+12>>2];u=+g[e+4>>2];t=+g[a+8>>2];r=+g[e+8>>2];x=+g[a+4>>2];o=+g[a>>2];z=+g[e>>2];y=(u*t-r*x)*+g[b>>2]+ +g[b+4>>2]*(r*o-t*z)+(x*z-u*o)*+g[b+8>>2];w=(u*t-r*x)*+g[b+16>>2]+(r*o-t*z)*+g[b+20>>2]+(x*z-u*o)*+g[b+24>>2];u=(u*t-r*x)*+g[b+32>>2]+(r*o-t*z)*+g[b+36>>2]+(x*z-u*o)*+g[b+40>>2];g[a+16>>2]=y;g[a+20>>2]=w;g[a+24>>2]=u;g[a+28>>2]=0.0;z=+g[f+4>>2];r=+g[f+8>>2];v=+g[f>>2];s=+g[d>>2]*(z*-t-r*-x)+ +g[d+4>>2]*(r*-o-v*-t)+(v*-x-z*-o)*+g[d+8>>2];q=(z*-t-r*-x)*+g[d+16>>2]+(r*-o-v*-t)*+g[d+20>>2]+(v*-x-z*-o)*+g[d+24>>2];o=(z*-t-r*-x)*+g[d+32>>2]+(r*-o-v*-t)*+g[d+36>>2]+(v*-x-z*-o)*+g[d+40>>2];g[a+32>>2]=s;g[a+36>>2]=q;g[a+40>>2]=o;g[a+44>>2]=0.0;z=+g[j>>2]*y;x=+g[j+4>>2]*w;v=+g[j+8>>2]*u;g[a+48>>2]=z;g[a+52>>2]=x;g[a+56>>2]=v;g[a+60>>2]=0.0;t=+g[l>>2]*s;r=+g[l+4>>2]*q;p=+g[l+8>>2]*o;g[a+64>>2]=t;g[a+68>>2]=r;g[a+72>>2]=p;g[a+76>>2]=0.0;g[a+80>>2]=z*y+x*w+v*u+k+m+(t*s+r*q+p*o);i=n;return}function Do(a){a=a|0;var b=0;b=i;Eo(a);if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function Eo(b){b=b|0;var d=0,e=0,f=0,g=0;d=i;c[b>>2]=1392;if((a[b+272>>0]|0)!=0?(g=c[b+204>>2]|0,Lb[c[c[g>>2]>>2]&511](g),g=c[b+204>>2]|0,(g|0)!=0):0){c[5006]=(c[5006]|0)+1;YE(c[g+ -4>>2]|0)}g=c[b+196>>2]|0;if((g|0)!=0?(Lb[c[c[g>>2]>>2]&511](g),f=c[b+196>>2]|0,(f|0)!=0):0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}if((a[b+273>>0]|0)!=0?(e=c[b+200>>2]|0,Lb[c[c[e>>2]>>2]&511](e),e=c[b+200>>2]|0,(e|0)!=0):0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+316>>2]|0;if((e|0)!=0){if((a[b+320>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+316>>2]=0}a[b+320>>0]=1;c[b+316>>2]=0;c[b+308>>2]=0;c[b+312>>2]=0;e=c[b+288>>2]|0;if((e|0)!=0){if((a[b+292>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+288>>2]=0}a[b+292>>0]=1;c[b+288>>2]=0;c[b+280>>2]=0;c[b+284>>2]=0;e=c[b+240>>2]|0;if((e|0)!=0){if((a[b+244>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+240>>2]=0}a[b+244>>0]=1;c[b+240>>2]=0;c[b+232>>2]=0;c[b+236>>2]=0;e=c[b+220>>2]|0;if((e|0)!=0){if((a[b+224>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+220>>2]=0}a[b+224>>0]=1;c[b+220>>2]=0;c[b+212>>2]=0;c[b+216>>2]=0;e=c[b+188>>2]|0;if((e|0)==0){a[b+192>>0]=1;c[b+188>>2]=0;c[b+180>>2]=0;g=b+184|0;c[g>>2]=0;ru(b);i=d;return}if((a[b+192>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+188>>2]=0;a[b+192>>0]=1;c[b+188>>2]=0;c[b+180>>2]=0;g=b+184|0;c[g>>2]=0;ru(b);i=d;return}function Fo(a,b){a=a|0;b=+b;var d=0,e=0,f=0,h=0,j=0.0,k=0.0,l=0.0;d=i;i=i+32|0;h=c[a+8>>2]|0;if((h|0)<=0){i=d;return}e=0;do{f=c[(c[a+16>>2]|0)+(e<<2)>>2]|0;if((!((f|0)==0?1:(c[f+236>>2]&2|0)==0)?(c[f+216>>2]|0)!=2:0)?!((c[f+204>>2]&2|0)==0|b!=0.0^1):0){h=c[f+480>>2]|0;if((h|0)==0)h=f+4|0;else{Nb[c[(c[h>>2]|0)+8>>2]&127](h,f+4|0);h=f+4|0}k=(+g[f+56>>2]- +g[f+120>>2])*(1.0/b);l=1.0/b*(+g[f+60>>2]- +g[f+124>>2]);g[f+312>>2]=(+g[f+52>>2]- +g[f+116>>2])*(1.0/b);g[f+316>>2]=k;g[f+320>>2]=l;g[f+324>>2]=0.0;Bo(f+68|0,h,d+8|0,d);l=+g[d>>2];k=1.0/b*l*+g[d+12>>2];j=1.0/b*l*+g[d+16>>2];g[f+328>>2]=1.0/b*+g[d+8>>2]*l;g[f+332>>2]=k;g[f+336>>2]=j;g[f+340>>2]=0.0;c[f+132>>2]=c[f+312>>2];c[f+136>>2]=c[f+316>>2];c[f+140>>2]=c[f+320>>2];c[f+144>>2]=c[f+324>>2];c[f+148>>2]=c[f+328>>2];c[f+152>>2]=c[f+332>>2];c[f+156>>2]=c[f+336>>2];c[f+160>>2]=c[f+340>>2];c[f+68>>2]=c[h+0>>2];c[f+72>>2]=c[h+4>>2];c[f+76>>2]=c[h+8>>2];c[f+80>>2]=c[h+12>>2];c[f+84>>2]=c[f+20>>2];c[f+88>>2]=c[f+24>>2];c[f+92>>2]=c[f+28>>2];c[f+96>>2]=c[f+32>>2];c[f+100>>2]=c[f+36>>2];c[f+104>>2]=c[f+40>>2];c[f+108>>2]=c[f+44>>2];c[f+112>>2]=c[f+48>>2];c[f+116>>2]=c[f+52>>2];c[f+120>>2]=c[f+56>>2];c[f+124>>2]=c[f+60>>2];c[f+128>>2]=c[f+64>>2];h=c[a+8>>2]|0}e=e+1|0}while((e|0)<(h|0));i=d;return}function Go(b){b=b|0;var d=0,e=0,f=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0.0,B=0,C=0,D=0,E=0,F=0,G=0.0,H=0.0,I=0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0,P=0.0,Q=0.0,R=0.0,U=0.0,V=0.0,W=0.0;d=i;i=i+1024|0;oE(1576);Ku(b);a:do if((Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0)!=0?(I=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0,((Pb[c[(c[I>>2]|0)+48>>2]&127](I)|0)&6144|0)!=0):0){e=d+988|0;o=d+896|0;n=d+832|0;q=d+912|0;p=d+848|0;s=d+928|0;r=d+864|0;u=d+720|0;t=d+656|0;w=d+736|0;v=d+672|0;y=d+752|0;x=d+688|0;f=d+336|0;h=d+352|0;j=d+368|0;k=d+112|0;l=d+128|0;m=d+144|0;B=Pb[c[(c[b>>2]|0)+104>>2]&127](b)|0;b:while(1){z=B+ -1|0;if((B|0)<=0)break a;B=gc[c[(c[b>>2]|0)+108>>2]&31](b,z)|0;I=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;I=(Pb[c[(c[I>>2]|0)+48>>2]&127](I)|0)>>>11;C=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;C=(Pb[c[(c[C>>2]|0)+48>>2]&127](C)|0)>>>12;A=+g[B+40>>2];if(A<=0.0){B=z;continue}switch(c[B+4>>2]|0){case 3:{g[d+944>>2]=1.0;c[d+948>>2]=0;c[d+952>>2]=0;c[d+956>>2]=0;c[d+960>>2]=0;g[d+964>>2]=1.0;c[d+968>>2]=0;c[d+972>>2]=0;c[d+976>>2]=0;c[d+980>>2]=0;g[d+984>>2]=1.0;c[e+0>>2]=0;c[e+4>>2]=0;c[e+8>>2]=0;c[e+12>>2]=0;c[e+16>>2]=0;H=+g[B+300>>2];G=+g[B+304>>2];J=+g[B+308>>2];F=c[B+28>>2]|0;K=H*+g[F+20>>2]+G*+g[F+24>>2]+J*+g[F+28>>2]+ +g[F+56>>2];L=H*+g[F+36>>2]+G*+g[F+40>>2]+J*+g[F+44>>2]+ +g[F+60>>2];g[d+992>>2]=H*+g[F+4>>2]+G*+g[F+8>>2]+J*+g[F+12>>2]+ +g[F+52>>2];g[d+996>>2]=K;g[d+1e3>>2]=L;g[d+1004>>2]=0.0;F=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;tc[c[(c[F>>2]|0)+56>>2]&7](F,d+944|0,A);L=+g[B+316>>2];K=+g[B+320>>2];J=+g[B+324>>2];F=c[B+32>>2]|0;G=L*+g[F+20>>2]+K*+g[F+24>>2]+J*+g[F+28>>2]+ +g[F+56>>2];H=L*+g[F+36>>2]+K*+g[F+40>>2]+J*+g[F+44>>2]+ +g[F+60>>2];g[d+992>>2]=L*+g[F+4>>2]+K*+g[F+8>>2]+J*+g[F+12>>2]+ +g[F+52>>2];g[d+996>>2]=G;g[d+1e3>>2]=H;g[d+1004>>2]=0.0;if((I&1|0)==0){B=z;continue b}B=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;tc[c[(c[B>>2]|0)+56>>2]&7](B,d+944|0,A);B=z;continue b};case 4:{co(d+880|0,(c[B+28>>2]|0)+4|0,B+552|0);if((I&1|0)==0){co(d+816|0,(c[B+32>>2]|0)+4|0,B+616|0);c[d+880>>2]=c[d+816>>2];c[d+884>>2]=c[d+820>>2];c[d+888>>2]=c[d+824>>2];c[d+892>>2]=c[d+828>>2];c[o+0>>2]=c[n+0>>2];c[o+4>>2]=c[n+4>>2];c[o+8>>2]=c[n+8>>2];c[o+12>>2]=c[n+12>>2];c[q+0>>2]=c[p+0>>2];c[q+4>>2]=c[p+4>>2];c[q+8>>2]=c[p+8>>2];c[q+12>>2]=c[p+12>>2];c[s+0>>2]=c[r+0>>2];c[s+4>>2]=c[r+4>>2];c[s+8>>2]=c[r+8>>2];c[s+12>>2]=c[r+12>>2]}else{I=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;tc[c[(c[I>>2]|0)+56>>2]&7](I,d+880|0,A);co(d+816|0,(c[B+32>>2]|0)+4|0,B+616|0);c[d+880>>2]=c[d+816>>2];c[d+884>>2]=c[d+820>>2];c[d+888>>2]=c[d+824>>2];c[d+892>>2]=c[d+828>>2];c[o+0>>2]=c[n+0>>2];c[o+4>>2]=c[n+4>>2];c[o+8>>2]=c[n+8>>2];c[o+12>>2]=c[n+12>>2];c[q+0>>2]=c[p+0>>2];c[q+4>>2]=c[p+4>>2];c[q+8>>2]=c[p+8>>2];c[q+12>>2]=c[p+12>>2];c[s+0>>2]=c[r+0>>2];c[s+4>>2]=c[r+4>>2];c[s+8>>2]=c[r+8>>2];c[s+12>>2]=c[r+12>>2];I=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;tc[c[(c[I>>2]|0)+56>>2]&7](I,d+880|0,A)}G=+ab(+(+g[B+688>>2]- +g[B+692>>2]),6.2831854820251465);if(!(G<-3.1415927410125732)){if(G>3.1415927410125732)G=G+-6.2831854820251465}else G=G+6.2831854820251465;H=+ab(+(+g[B+688>>2]+ +g[B+692>>2]),6.2831854820251465);if(!(H<-3.1415927410125732)){if(H>3.1415927410125732)H=H+-6.2831854820251465}else H=H+6.2831854820251465;if(G==H){B=z;continue b}B=G>H;if((C&1|0)==0){B=z;continue b}g[d+800>>2]=+g[d+888>>2];g[d+804>>2]=+g[d+904>>2];g[d+808>>2]=+g[d+920>>2];g[d+812>>2]=0.0;g[d+784>>2]=+g[d+880>>2];g[d+788>>2]=+g[d+896>>2];g[d+792>>2]=+g[d+912>>2];g[d+796>>2]=0.0;I=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;F=c[(c[I>>2]|0)+60>>2]|0;c[d+768>>2]=0;c[d+772>>2]=0;c[d+776>>2]=0;c[d+780>>2]=0;Wb[F&0](I,s,d+800|0,d+784|0,A,A,B?0.0:G,B?6.2831854820251465:H,d+768|0,B^1,10.0);B=z;continue b};case 5:{co(d+704|0,(c[B+28>>2]|0)+4|0,B+300|0);if((I&1|0)==0){co(d+640|0,(c[B+32>>2]|0)+4|0,B+364|0);c[d+704>>2]=c[d+640>>2];c[d+708>>2]=c[d+644>>2];c[d+712>>2]=c[d+648>>2];c[d+716>>2]=c[d+652>>2];c[u+0>>2]=c[t+0>>2];c[u+4>>2]=c[t+4>>2];c[u+8>>2]=c[t+8>>2];c[u+12>>2]=c[t+12>>2];c[w+0>>2]=c[v+0>>2];c[w+4>>2]=c[v+4>>2];c[w+8>>2]=c[v+8>>2];c[w+12>>2]=c[v+12>>2];c[y+0>>2]=c[x+0>>2];c[y+4>>2]=c[x+4>>2];c[y+8>>2]=c[x+8>>2];c[y+12>>2]=c[x+12>>2]}else{I=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;tc[c[(c[I>>2]|0)+56>>2]&7](I,d+704|0,A);co(d+640|0,(c[B+32>>2]|0)+4|0,B+364|0);c[d+704>>2]=c[d+640>>2];c[d+708>>2]=c[d+644>>2];c[d+712>>2]=c[d+648>>2];c[d+716>>2]=c[d+652>>2];c[u+0>>2]=c[t+0>>2];c[u+4>>2]=c[t+4>>2];c[u+8>>2]=c[t+8>>2];c[u+12>>2]=c[t+12>>2];c[w+0>>2]=c[v+0>>2];c[w+4>>2]=c[v+4>>2];c[w+8>>2]=c[v+8>>2];c[w+12>>2]=c[v+12>>2];c[y+0>>2]=c[x+0>>2];c[y+4>>2]=c[x+4>>2];c[y+8>>2]=c[x+8>>2];c[y+12>>2]=c[x+12>>2];I=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;tc[c[(c[I>>2]|0)+56>>2]&7](I,d+704|0,A)}if((C&1|0)==0){B=z;continue b}so(d+624|0,B,6.0868353843688965,A);G=+g[d+624>>2];H=+g[d+628>>2];J=+g[d+632>>2];K=G*+g[d+720>>2]+H*+g[d+724>>2]+J*+g[d+728>>2]+ +g[d+756>>2];L=G*+g[d+736>>2]+H*+g[d+740>>2]+J*+g[d+744>>2]+ +g[d+760>>2];g[d+624>>2]=G*+g[d+704>>2]+H*+g[d+708>>2]+J*+g[d+712>>2]+ +g[d+752>>2];g[d+628>>2]=K;g[d+632>>2]=L;g[d+636>>2]=0.0;C=0;do{so(d+608|0,B,+(C|0)*6.283185005187988*.03125,A);G=+g[d+608>>2];H=+g[d+612>>2];J=+g[d+616>>2];K=G*+g[d+720>>2]+H*+g[d+724>>2]+J*+g[d+728>>2]+ +g[d+756>>2];L=G*+g[d+736>>2]+H*+g[d+740>>2]+J*+g[d+744>>2]+ +g[d+760>>2];g[d+608>>2]=G*+g[d+704>>2]+H*+g[d+708>>2]+J*+g[d+712>>2]+ +g[d+752>>2];g[d+612>>2]=K;g[d+616>>2]=L;g[d+620>>2]=0.0;I=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;F=c[(c[I>>2]|0)+8>>2]|0;c[d+592>>2]=0;c[d+596>>2]=0;c[d+600>>2]=0;c[d+604>>2]=0;vc[F&127](I,d+624|0,d+608|0,d+592|0);if((C&3|0)==0){I=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;F=c[(c[I>>2]|0)+8>>2]|0;c[d+576>>2]=0;c[d+580>>2]=0;c[d+584>>2]=0;c[d+588>>2]=0;vc[F&127](I,y,d+608|0,d+576|0)}c[d+624>>2]=c[d+608>>2];c[d+628>>2]=c[d+612>>2];c[d+632>>2]=c[d+616>>2];c[d+636>>2]=c[d+620>>2];C=C+1|0}while((C|0)!=32);H=+g[B+452>>2];G=+g[B+512>>2];C=c[B+32>>2]|0;if(+g[C+344>>2]>0.0){co(d+512|0,C+4|0,B+364|0);c[d+704>>2]=c[d+512>>2];c[d+708>>2]=c[d+516>>2];c[d+712>>2]=c[d+520>>2];c[d+716>>2]=c[d+524>>2];c[u+0>>2]=c[d+528>>2];c[u+4>>2]=c[d+532>>2];c[u+8>>2]=c[d+536>>2];c[u+12>>2]=c[d+540>>2];c[w+0>>2]=c[d+544>>2];c[w+4>>2]=c[d+548>>2];c[w+8>>2]=c[d+552>>2];c[w+12>>2]=c[d+556>>2];c[y+0>>2]=c[d+560>>2];c[y+4>>2]=c[d+564>>2];c[y+8>>2]=c[d+568>>2];c[y+12>>2]=c[d+572>>2]}else{co(d+448|0,(c[B+28>>2]|0)+4|0,B+300|0);c[d+704>>2]=c[d+448>>2];c[d+708>>2]=c[d+452>>2];c[d+712>>2]=c[d+456>>2];c[d+716>>2]=c[d+460>>2];c[u+0>>2]=c[d+464>>2];c[u+4>>2]=c[d+468>>2];c[u+8>>2]=c[d+472>>2];c[u+12>>2]=c[d+476>>2];c[w+0>>2]=c[d+480>>2];c[w+4>>2]=c[d+484>>2];c[w+8>>2]=c[d+488>>2];c[w+12>>2]=c[d+492>>2];c[y+0>>2]=c[d+496>>2];c[y+4>>2]=c[d+500>>2];c[y+8>>2]=c[d+504>>2];c[y+12>>2]=c[d+508>>2]}c[d+432>>2]=c[y+0>>2];c[d+436>>2]=c[y+4>>2];c[d+440>>2]=c[y+8>>2];c[d+444>>2]=c[y+12>>2];g[d+416>>2]=+g[d+704>>2];g[d+420>>2]=+g[d+720>>2];g[d+424>>2]=+g[d+736>>2];g[d+428>>2]=0.0;g[d+400>>2]=+g[d+708>>2];g[d+404>>2]=+g[d+724>>2];g[d+408>>2]=+g[d+740>>2];g[d+412>>2]=0.0;B=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;I=c[(c[B>>2]|0)+60>>2]|0;c[d+384>>2]=0;c[d+388>>2]=0;c[d+392>>2]=0;c[d+396>>2]=0;Wb[I&0](B,d+432|0,d+416|0,d+400|0,A,A,-G-H,H-G,d+384|0,1,10.0);B=z;continue b};case 6:case 9:{c[d+320>>2]=c[B+1064>>2];c[d+324>>2]=c[B+1068>>2];c[d+328>>2]=c[B+1072>>2];c[d+332>>2]=c[B+1076>>2];E=B+1080|0;c[f+0>>2]=c[E+0>>2];c[f+4>>2]=c[E+4>>2];c[f+8>>2]=c[E+8>>2];c[f+12>>2]=c[E+12>>2];F=B+1096|0;c[h+0>>2]=c[F+0>>2];c[h+4>>2]=c[F+4>>2];c[h+8>>2]=c[F+8>>2];c[h+12>>2]=c[F+12>>2];D=B+1112|0;c[j+0>>2]=c[D+0>>2];c[j+4>>2]=c[D+4>>2];c[j+8>>2]=c[D+8>>2];c[j+12>>2]=c[D+12>>2];if((I&1|0)==0){c[d+320>>2]=c[B+1128>>2];c[d+324>>2]=c[B+1132>>2];c[d+328>>2]=c[B+1136>>2];c[d+332>>2]=c[B+1140>>2];c[f+0>>2]=c[B+1144>>2];c[f+4>>2]=c[B+1148>>2];c[f+8>>2]=c[B+1152>>2];c[f+12>>2]=c[B+1156>>2];c[h+0>>2]=c[B+1160>>2];c[h+4>>2]=c[B+1164>>2];c[h+8>>2]=c[B+1168>>2];c[h+12>>2]=c[B+1172>>2];c[j+0>>2]=c[B+1176>>2];c[j+4>>2]=c[B+1180>>2];c[j+8>>2]=c[B+1184>>2];c[j+12>>2]=c[B+1188>>2]}else{I=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;tc[c[(c[I>>2]|0)+56>>2]&7](I,d+320|0,A);c[d+320>>2]=c[B+1128>>2];c[d+324>>2]=c[B+1132>>2];c[d+328>>2]=c[B+1136>>2];c[d+332>>2]=c[B+1140>>2];c[f+0>>2]=c[B+1144>>2];c[f+4>>2]=c[B+1148>>2];c[f+8>>2]=c[B+1152>>2];c[f+12>>2]=c[B+1156>>2];c[h+0>>2]=c[B+1160>>2];c[h+4>>2]=c[B+1164>>2];c[h+8>>2]=c[B+1168>>2];c[h+12>>2]=c[B+1172>>2];c[j+0>>2]=c[B+1176>>2];c[j+4>>2]=c[B+1180>>2];c[j+8>>2]=c[B+1184>>2];c[j+12>>2]=c[B+1188>>2];I=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;tc[c[(c[I>>2]|0)+56>>2]&7](I,d+320|0,A)}if((C&1|0)==0){B=z;continue b}c[d+320>>2]=c[B+1064>>2];c[d+324>>2]=c[B+1068>>2];c[d+328>>2]=c[B+1072>>2];c[d+332>>2]=c[B+1076>>2];c[f+0>>2]=c[E+0>>2];c[f+4>>2]=c[E+4>>2];c[f+8>>2]=c[E+8>>2];c[f+12>>2]=c[E+12>>2];c[h+0>>2]=c[F+0>>2];c[h+4>>2]=c[F+4>>2];c[h+8>>2]=c[F+8>>2];c[h+12>>2]=c[F+12>>2];c[j+0>>2]=c[D+0>>2];c[j+4>>2]=c[D+4>>2];c[j+8>>2]=c[D+8>>2];c[j+12>>2]=c[D+12>>2];C=B+1176|0;g[d+304>>2]=+g[d+328>>2];g[d+308>>2]=+g[d+344>>2];g[d+312>>2]=+g[d+360>>2];g[d+316>>2]=0.0;g[d+288>>2]=+g[d+320>>2];g[d+292>>2]=+g[d+336>>2];g[d+296>>2]=+g[d+352>>2];g[d+300>>2]=0.0;J=+g[B+932>>2];H=+g[B+936>>2];L=+g[B+996>>2];M=+g[B+1e3>>2];I=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;O=c[(c[I>>2]|0)+64>>2]|0;c[d+272>>2]=0;c[d+276>>2]=0;c[d+280>>2]=0;c[d+284>>2]=0;mc[O&0](I,C,d+304|0,d+288|0,A*.8999999761581421,J,H,L,M,d+272|0,10.0,1);M=+g[d+324>>2];L=+g[d+340>>2];H=+g[d+356>>2];g[d+288>>2]=M;g[d+292>>2]=L;g[d+296>>2]=H;g[d+300>>2]=0.0;J=+g[B+1196>>2];K=+g[B+1200>>2];G=+S(+J);J=+T(+J);N=+S(+K);K=+T(+K);g[d+256>>2]=G*N*M+G*K*L-J*H;g[d+260>>2]=N*L-K*M;g[d+264>>2]=J*N*M+J*K*L+G*H;c[d+320>>2]=c[B+1128>>2];c[d+324>>2]=c[B+1132>>2];c[d+328>>2]=c[B+1136>>2];c[d+332>>2]=c[B+1140>>2];c[f+0>>2]=c[B+1144>>2];c[f+4>>2]=c[B+1148>>2];c[f+8>>2]=c[B+1152>>2];c[f+12>>2]=c[B+1156>>2];c[h+0>>2]=c[B+1160>>2];c[h+4>>2]=c[B+1164>>2];c[h+8>>2]=c[B+1168>>2];c[h+12>>2]=c[B+1172>>2];c[j+0>>2]=c[C+0>>2];c[j+4>>2]=c[C+4>>2];c[j+8>>2]=c[C+8>>2];c[j+12>>2]=c[C+12>>2];H=-+g[d+336>>2];G=-+g[d+352>>2];g[d+240>>2]=-+g[d+320>>2];g[d+244>>2]=H;g[d+248>>2]=G;g[d+252>>2]=0.0;G=+g[B+868>>2];H=+g[B+872>>2];if(!(G>H)){if(G<H){O=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;I=c[(c[O>>2]|0)+60>>2]|0;c[d+208>>2]=0;c[d+212>>2]=0;c[d+216>>2]=0;c[d+220>>2]=0;Wb[I&0](O,C,d+240|0,d+256|0,A,A,G,H,d+208|0,1,10.0)}}else{O=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;I=c[(c[O>>2]|0)+60>>2]|0;c[d+224>>2]=0;c[d+228>>2]=0;c[d+232>>2]=0;c[d+236>>2]=0;Wb[I&0](O,C,d+240|0,d+256|0,A,A,-3.1415927410125732,3.1415927410125732,d+224|0,0,10.0)}c[d+320>>2]=c[B+1064>>2];c[d+324>>2]=c[B+1068>>2];c[d+328>>2]=c[B+1072>>2];c[d+332>>2]=c[B+1076>>2];c[f+0>>2]=c[E+0>>2];c[f+4>>2]=c[E+4>>2];c[f+8>>2]=c[E+8>>2];c[f+12>>2]=c[E+12>>2];c[h+0>>2]=c[F+0>>2];c[h+4>>2]=c[F+4>>2];c[h+8>>2]=c[F+8>>2];c[h+12>>2]=c[F+12>>2];c[j+0>>2]=c[D+0>>2];c[j+4>>2]=c[D+4>>2];c[j+8>>2]=c[D+8>>2];c[j+12>>2]=c[D+12>>2];c[d+192>>2]=c[B+680>>2];c[d+196>>2]=c[B+684>>2];c[d+200>>2]=c[B+688>>2];c[d+204>>2]=c[B+692>>2];c[d+176>>2]=c[B+696>>2];c[d+180>>2]=c[B+700>>2];c[d+184>>2]=c[B+704>>2];c[d+188>>2]=c[B+708>>2];B=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;O=c[(c[B>>2]|0)+72>>2]|0;c[d+160>>2]=0;c[d+164>>2]=0;c[d+168>>2]=0;c[d+172>>2]=0;Jb[O&31](B,d+192|0,d+176|0,d+320|0,d+160|0);B=z;continue b};case 7:{c[d+96>>2]=c[B+824>>2];c[d+100>>2]=c[B+828>>2];c[d+104>>2]=c[B+832>>2];c[d+108>>2]=c[B+836>>2];c[k+0>>2]=c[B+840>>2];c[k+4>>2]=c[B+844>>2];c[k+8>>2]=c[B+848>>2];c[k+12>>2]=c[B+852>>2];c[l+0>>2]=c[B+856>>2];c[l+4>>2]=c[B+860>>2];c[l+8>>2]=c[B+864>>2];c[l+12>>2]=c[B+868>>2];c[m+0>>2]=c[B+872>>2];c[m+4>>2]=c[B+876>>2];c[m+8>>2]=c[B+880>>2];c[m+12>>2]=c[B+884>>2];if((I&1|0)==0){c[d+96>>2]=c[B+888>>2];c[d+100>>2]=c[B+892>>2];c[d+104>>2]=c[B+896>>2];c[d+108>>2]=c[B+900>>2];c[k+0>>2]=c[B+904>>2];c[k+4>>2]=c[B+908>>2];c[k+8>>2]=c[B+912>>2];c[k+12>>2]=c[B+916>>2];c[l+0>>2]=c[B+920>>2];c[l+4>>2]=c[B+924>>2];c[l+8>>2]=c[B+928>>2];c[l+12>>2]=c[B+932>>2];c[m+0>>2]=c[B+936>>2];c[m+4>>2]=c[B+940>>2];c[m+8>>2]=c[B+944>>2];c[m+12>>2]=c[B+948>>2]}else{O=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;tc[c[(c[O>>2]|0)+56>>2]&7](O,d+96|0,A);c[d+96>>2]=c[B+888>>2];c[d+100>>2]=c[B+892>>2];c[d+104>>2]=c[B+896>>2];c[d+108>>2]=c[B+900>>2];c[k+0>>2]=c[B+904>>2];c[k+4>>2]=c[B+908>>2];c[k+8>>2]=c[B+912>>2];c[k+12>>2]=c[B+916>>2];c[l+0>>2]=c[B+920>>2];c[l+4>>2]=c[B+924>>2];c[l+8>>2]=c[B+928>>2];c[l+12>>2]=c[B+932>>2];c[m+0>>2]=c[B+936>>2];c[m+4>>2]=c[B+940>>2];c[m+8>>2]=c[B+944>>2];c[m+12>>2]=c[B+948>>2];O=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;tc[c[(c[O>>2]|0)+56>>2]&7](O,d+96|0,A)}if((C&1|0)==0){B=z;continue b}O=(a[B+180>>0]|0)!=0?B+824|0:B+888|0;H=+g[O>>2];L=+g[O+4>>2];J=+g[O+16>>2];N=+g[O+20>>2];K=+g[O+32>>2];M=+g[O+36>>2];W=+g[O+48>>2];U=+g[O+52>>2];Q=+g[O+56>>2];G=+g[B+184>>2];V=+g[O+8>>2]*0.0;R=+g[O+24>>2]*0.0;P=+g[O+40>>2]*0.0;g[d+80>>2]=W+(V+(L*0.0+H*G));g[d+84>>2]=U+(R+(N*0.0+J*G));g[d+88>>2]=Q+(P+(M*0.0+K*G));g[d+92>>2]=0.0;G=+g[B+188>>2];g[d+64>>2]=W+(V+(L*0.0+H*G));g[d+68>>2]=U+(R+(N*0.0+J*G));g[d+72>>2]=Q+(P+(M*0.0+K*G));g[d+76>>2]=0.0;O=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;I=c[(c[O>>2]|0)+8>>2]|0;c[d+48>>2]=0;c[d+52>>2]=0;c[d+56>>2]=0;c[d+60>>2]=0;vc[I&127](O,d+80|0,d+64|0,d+48|0);g[d+32>>2]=H;g[d+36>>2]=J;g[d+40>>2]=K;g[d+44>>2]=0.0;g[d+16>>2]=L;g[d+20>>2]=N;g[d+24>>2]=M;g[d+28>>2]=0.0;M=+g[B+192>>2];N=+g[B+196>>2];O=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;I=c[(c[O>>2]|0)+60>>2]|0;c[d+0>>2]=0;c[d+4>>2]=0;c[d+8>>2]=0;c[d+12>>2]=0;Wb[I&0](O,B+936|0,d+32|0,d+16|0,A,A,M,N,d,1,10.0);B=z;continue b};default:{B=z;continue b}}}}while(0);if(((((Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0)!=0?(O=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0,((Pb[c[(c[O>>2]|0)+48>>2]&127](O)|0)&16387|0)!=0):0)?(Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0)!=0:0)?(O=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0,(Pb[c[(c[O>>2]|0)+48>>2]&127](O)|0)!=0):0)?(c[b+280>>2]|0)>0:0){e=0;do{O=c[(c[b+288>>2]|0)+(e<<2)>>2]|0;Nb[c[(c[O>>2]|0)+12>>2]&127](O,c[b+72>>2]|0);e=e+1|0}while((e|0)<(c[b+280>>2]|0))}b=c[5022]|0;O=(c[b+16>>2]|0)+ -1|0;c[b+16>>2]=O;if((O|0)!=0){i=d;return}do if((c[b+4>>2]|0)!=0){Eb(d+1008|0,0)|0;O=c[5008]|0;g[b+8>>2]=+(((c[d+1012>>2]|0)-(c[O+4>>2]|0)+(((c[d+1008>>2]|0)-(c[O>>2]|0)|0)*1e6|0)-(c[b+12>>2]|0)|0)>>>0)/1.0e3+ +g[b+8>>2];if((c[b+16>>2]|0)==0){b=c[5022]|0;break}else{i=d;return}}while(0);c[5022]=c[b+20>>2];i=d;return}function Ho(a){a=a|0;var b=0,d=0,e=0;b=i;if((c[a+232>>2]|0)<=0){i=b;return}d=0;do{e=(c[(c[a+240>>2]|0)+(d<<2)>>2]|0)+412|0;c[e+0>>2]=0;c[e+4>>2]=0;c[e+8>>2]=0;c[e+12>>2]=0;c[e+16>>2]=0;c[e+20>>2]=0;c[e+24>>2]=0;c[e+28>>2]=0;d=d+1|0}while((d|0)<(c[a+232>>2]|0));i=b;return}function Io(a){a=a|0;var b=0,d=0,e=0,f=0,h=0,j=0.0,k=0.0;b=i;d=c[a+232>>2]|0;if((d|0)<=0){i=b;return}a=c[a+240>>2]|0;e=0;do{f=c[a+(e<<2)>>2]|0;h=c[f+216>>2]|0;if(!((h|0)==2|(h|0)==5)?(c[f+204>>2]&3|0)==0:0){k=+g[f+368>>2]*+g[f+352>>2];j=+g[f+372>>2]*+g[f+356>>2];g[f+412>>2]=+g[f+364>>2]*+g[f+348>>2]+ +g[f+412>>2];g[f+416>>2]=k+ +g[f+416>>2];g[f+420>>2]=j+ +g[f+420>>2]}e=e+1|0}while((e|0)<(d|0));i=b;return}function Jo(b){b=b|0;var d=0,e=0.0,f=0.0,h=0,j=0,k=0,l=0;d=i;i=i+144|0;oE(1592);if((a[b+274>>0]|0)==0){k=c[b+232>>2]|0;if((k|0)>0){h=0;do{j=c[(c[b+240>>2]|0)+(h<<2)>>2]|0;l=c[j+216>>2]|0;if((!((l|0)==2|(l|0)==5)?(c[j+480>>2]|0)!=0:0)?(c[j+204>>2]&3|0)==0:0){if((a[b+300>>0]|0)!=0?(e=+g[b+268>>2],e!=0.0):0)f=+g[b+264>>2]-e;else f=+g[b+264>>2]*+g[j+244>>2];ro(j+68|0,+g[j+132>>2],+g[j+136>>2],+g[j+140>>2],j+148|0,f,d);k=c[j+480>>2]|0;Nb[c[(c[k>>2]|0)+12>>2]&127](k,d);k=c[b+232>>2]|0}h=h+1|0}while((h|0)<(k|0))}}else{k=c[b+8>>2]|0;if((k|0)>0){h=0;do{j=c[(c[b+16>>2]|0)+(h<<2)>>2]|0;if((!((j|0)==0?1:(c[j+236>>2]&2|0)==0)?(c[j+480>>2]|0)!=0:0)?(c[j+204>>2]&3|0)==0:0){if((a[b+300>>0]|0)!=0?(f=+g[b+268>>2],f!=0.0):0)e=+g[b+264>>2]-f;else e=+g[b+264>>2]*+g[j+244>>2];ro(j+68|0,+g[j+132>>2],+g[j+136>>2],+g[j+140>>2],j+148|0,e,d+64|0);k=c[j+480>>2]|0;Nb[c[(c[k>>2]|0)+12>>2]&127](k,d+64|0);k=c[b+8>>2]|0}h=h+1|0}while((h|0)<(k|0))}}b=c[5022]|0;l=(c[b+16>>2]|0)+ -1|0;c[b+16>>2]=l;if((l|0)!=0){i=d;return}do if((c[b+4>>2]|0)!=0){Eb(d+128|0,0)|0;l=c[5008]|0;g[b+8>>2]=+(((c[d+132>>2]|0)-(c[l+4>>2]|0)+(((c[d+128>>2]|0)-(c[l>>2]|0)|0)*1e6|0)-(c[b+12>>2]|0)|0)>>>0)/1.0e3+ +g[b+8>>2];if((c[b+16>>2]|0)==0){b=c[5022]|0;break}else{i=d;return}}while(0);c[5022]=c[b+20>>2];i=d;return}function Ko(b,d,e,f){b=b|0;d=+d;e=e|0;f=+f;var h=0,j=0,k=0.0,l=0;h=i;i=i+16|0;Eb(c[5008]|0,0)|0;nE(20040);c[5011]=(c[5011]|0)+1;l=c[5014]|0;c[5014]=l+1;if((l|0)==0){Eb(h|0,0)|0;l=c[5008]|0;c[5013]=(c[h+4>>2]|0)-(c[l+4>>2]|0)+(((c[h>>2]|0)-(c[l>>2]|0)|0)*1e6|0)}c[5024]=0;Eb(h|0,0)|0;oE(1616);if((e|0)!=0){g[b+268>>2]=f;k=+g[b+264>>2]+d;g[b+264>>2]=k;if(!(k>=f)){d=f;j=0}else{g[b+264>>2]=k- +(~~(k/f)|0)*f;d=f;j=~~(k/f)}}else{g[b+264>>2]=(a[b+300>>0]|0)!=0?0.0:d;g[b+268>>2]=0.0;j=!(+P(+d)<1.1920928955078125e-7)&1;e=j}if((Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0)!=0){l=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;a[3896]=(Pb[c[(c[l>>2]|0)+48>>2]&127](l)|0)>>>4&1}if((j|0)!=0){e=(j|0)>(e|0)?e:j;Kb[c[(c[b>>2]|0)+164>>2]&31](b,d*+(e|0));Lb[c[(c[b>>2]|0)+168>>2]&511](b);if((e|0)>0){l=0;do{Kb[c[(c[b>>2]|0)+160>>2]&31](b,d);Lb[c[(c[b>>2]|0)+80>>2]&511](b);l=l+1|0}while((l|0)<(e|0))}}else Lb[c[(c[b>>2]|0)+80>>2]&511](b);Lb[c[(c[b>>2]|0)+120>>2]&511](b);c[5024]=(c[5024]|0)+1;b=c[5022]|0;l=(c[b+16>>2]|0)+ -1|0;c[b+16>>2]=l;if((l|0)!=0){i=h;return j|0}do if((c[b+4>>2]|0)!=0){Eb(h|0,0)|0;l=c[5008]|0;g[b+8>>2]=+(((c[h+4>>2]|0)-(c[l+4>>2]|0)+(((c[h>>2]|0)-(c[l>>2]|0)|0)*1e6|0)-(c[b+12>>2]|0)|0)>>>0)/1.0e3+ +g[b+8>>2];if((c[b+16>>2]|0)==0){b=c[5022]|0;break}else{i=h;return j|0}}while(0);c[5022]=c[b+20>>2];i=h;return j|0}function Lo(d,e){d=d|0;e=+e;var f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0,p=0,q=0,r=0,s=0,t=0,u=0.0,v=0.0,w=0.0,x=0,y=0.0,z=0,A=0,B=0,C=0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0;f=i;i=i+464|0;oE(1632);p=c[d+84>>2]|0;if((p|0)!=0)Kb[p&31](d,e);Kb[c[(c[d>>2]|0)+140>>2]&31](d,e);g[d+28>>2]=e;c[d+32>>2]=0;c[d+48>>2]=Pb[c[(c[d>>2]|0)+20>>2]&127](d)|0;oE(1768);oE(1800);q=c[d+316>>2]|0;if((c[d+308>>2]|0)>0){p=0;do{C=c[d+24>>2]|0;Nb[c[(c[C>>2]|0)+16>>2]&127](C,c[q+(p<<2)>>2]|0);p=p+1|0;q=c[d+316>>2]|0}while((p|0)<(c[d+308>>2]|0))}if((q|0)!=0){if((a[d+320>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[q+ -4>>2]|0)}c[d+316>>2]=0}a[d+320>>0]=1;c[d+316>>2]=0;c[d+308>>2]=0;c[d+312>>2]=0;p=c[5022]|0;C=(c[p+16>>2]|0)+ -1|0;c[p+16>>2]=C;do if((C|0)==0){if((c[p+4>>2]|0)!=0){Eb(f+280|0,0)|0;C=c[5008]|0;g[p+8>>2]=+(((c[f+284>>2]|0)-(c[C+4>>2]|0)+(((c[f+280>>2]|0)-(c[C>>2]|0)|0)*1e6|0)-(c[p+12>>2]|0)|0)>>>0)/1.0e3+ +g[p+8>>2];if((c[p+16>>2]|0)!=0)break;p=c[5022]|0}c[5022]=c[p+20>>2]}while(0);if((c[d+232>>2]|0)>0){p=f+264|0;s=f+164|0;r=f+400|0;q=0;do{t=c[(c[d+240>>2]|0)+(q<<2)>>2]|0;g[t+244>>2]=1.0;C=c[t+216>>2]|0;do if(((!((C|0)==2|(C|0)==5)?(c[t+204>>2]&3|0)==0:0)?(ro(t+4|0,+g[t+312>>2],+g[t+316>>2],+g[t+320>>2],t+328|0,e,f+216|0),l=+g[p>>2],h=l- +g[t+52>>2],m=+g[f+268>>2],j=m- +g[t+56>>2],n=+g[f+272>>2],k=n- +g[t+60>>2],(a[d+44>>0]|0)!=0):0)?(y=+g[t+252>>2],y*y!=0.0?y*y<h*h+j*j+k*k:0):0){oE(1840);if((c[(c[t+192>>2]|0)+4>>2]|0)<20){c[440]=(c[440]|0)+1;B=c[d+68>>2]|0;B=Pb[c[(c[B>>2]|0)+36>>2]&127](B)|0;C=c[d+24>>2]|0;g[f+124>>2]=1.0;b[f+128>>1]=1;b[f+130>>1]=-1;c[f+120>>2]=688;c[f+132>>2]=c[t+52>>2];c[f+136>>2]=c[t+56>>2];c[f+140>>2]=c[t+60>>2];c[f+144>>2]=c[t+64>>2];c[f+148>>2]=c[p+0>>2];c[f+152>>2]=c[p+4>>2];c[f+156>>2]=c[p+8>>2];c[f+160>>2]=c[p+12>>2];c[f+196>>2]=0;c[f+120>>2]=2160;c[f+200>>2]=t;g[f+204>>2]=0.0;c[f+208>>2]=B;c[f+212>>2]=C;w=+g[t+248>>2];c[f+72>>2]=0;g[f+76>>2]=1.0;g[f+80>>2]=1.0;g[f+84>>2]=1.0;g[f+88>>2]=0.0;c[f+64>>2]=16680;c[f+68>>2]=8;g[f+92>>2]=w;g[f+108>>2]=w;g[f+204>>2]=+g[d+56>>2];C=c[t+188>>2]|0;b[f+128>>1]=b[C+4>>1]|0;b[f+130>>1]=b[C+6>>1]|0;c[f+48>>2]=c[p+0>>2];c[f+52>>2]=c[p+4>>2];c[f+56>>2]=c[p+8>>2];c[f+60>>2]=c[p+12>>2];c[f+0>>2]=c[t+4>>2];c[f+4>>2]=c[t+8>>2];c[f+8>>2]=c[t+12>>2];c[f+12>>2]=c[t+16>>2];c[f+16>>2]=c[t+20>>2];c[f+20>>2]=c[t+24>>2];c[f+24>>2]=c[t+28>>2];c[f+28>>2]=c[t+32>>2];c[f+32>>2]=c[t+36>>2];c[f+36>>2]=c[t+40>>2];c[f+40>>2]=c[t+44>>2];c[f+44>>2]=c[t+48>>2];Eu(d,f+64|0,t+4|0,f,f+120|0,0.0);w=+g[f+124>>2];if(w<1.0){v=w*(l- +g[t+52>>2]);u=w*(m- +g[t+56>>2]);w=w*(n- +g[t+60>>2]);y=-(u*+g[f+168>>2])-v*+g[s>>2]-w*+g[f+172>>2];x=c[d+24>>2]|0;x=Yb[c[(c[x>>2]|0)+12>>2]&31](x,t,c[f+196>>2]|0)|0;A=c[d+308>>2]|0;if((A|0)==(c[d+312>>2]|0)?(o=(A|0)==0?1:A<<1,(A|0)<(o|0)):0){if((o|0)==0)z=0;else{c[5004]=(c[5004]|0)+1;z=XE((o<<2|3)+16|0)|0;if((z|0)==0)z=0;else{c[(z+19&-16)+ -4>>2]=z;z=z+19&-16}A=c[d+308>>2]|0}if((A|0)>0){B=0;do{C=z+(B<<2)|0;if((C|0)!=0)c[C>>2]=c[(c[d+316>>2]|0)+(B<<2)>>2];B=B+1|0}while((B|0)!=(A|0))}B=c[d+316>>2]|0;if((B|0)!=0){if((a[d+320>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[B+ -4>>2]|0);A=c[d+308>>2]|0}c[d+316>>2]=0}a[d+320>>0]=1;c[d+316>>2]=z;c[d+312>>2]=o}z=(c[d+316>>2]|0)+(A<<2)|0;if((z|0)!=0)c[z>>2]=x;c[d+308>>2]=A+1;D=v+ +g[t+52>>2];v=u+ +g[t+56>>2];w=w+ +g[t+60>>2];C=c[f+196>>2]|0;O=+g[C+4>>2];N=+g[C+20>>2];M=+g[C+36>>2];L=+g[C+8>>2];K=+g[C+24>>2];J=+g[C+40>>2];I=+g[C+12>>2];G=+g[C+28>>2];E=+g[C+44>>2];H=-+g[C+52>>2];F=-+g[C+56>>2];u=-+g[C+60>>2];c[f+280>>2]=0;c[f+284>>2]=0;c[f+288>>2]=0;c[f+292>>2]=0;g[f+296>>2]=D*O+v*N+w*M+(O*H+N*F+M*u);g[f+300>>2]=D*L+v*K+w*J+(L*H+K*F+J*u);g[f+304>>2]=D*I+v*G+w*E+(I*H+G*F+E*u);g[f+308>>2]=0.0;c[f+344>>2]=c[s+0>>2];c[f+348>>2]=c[s+4>>2];c[f+352>>2]=c[s+8>>2];c[f+356>>2]=c[s+12>>2];g[f+360>>2]=y;g[f+364>>2]=0.0;g[f+368>>2]=0.0;g[f+372>>2]=0.0;c[f+392>>2]=0;a[f+396>>0]=0;c[r+0>>2]=0;c[r+4>>2]=0;c[r+8>>2]=0;c[r+12>>2]=0;c[r+16>>2]=0;c[r+20>>2]=0;c[r+24>>2]=0;c[r+28>>2]=0;C=mA(x,f+280|0)|0;g[x+(C*184|0)+96>>2]=0.0;y=+g[t+224>>2]*+g[(c[f+196>>2]|0)+224>>2];y=y<-10.0?-10.0:y;g[x+(C*184|0)+88>>2]=y>10.0?10.0:y;c[x+(C*184|0)+52>>2]=c[t+52>>2];c[x+(C*184|0)+56>>2]=c[t+56>>2];c[x+(C*184|0)+60>>2]=c[t+60>>2];c[x+(C*184|0)+64>>2]=c[t+64>>2];g[x+(C*184|0)+36>>2]=D;g[x+(C*184|0)+40>>2]=v;g[x+(C*184|0)+44>>2]=w;g[x+(C*184|0)+48>>2]=0.0}}t=c[5022]|0;C=(c[t+16>>2]|0)+ -1|0;c[t+16>>2]=C;if((C|0)==0){if((c[t+4>>2]|0)!=0){Eb(f+280|0,0)|0;C=c[5008]|0;g[t+8>>2]=+(((c[f+284>>2]|0)-(c[C+4>>2]|0)+(((c[f+280>>2]|0)-(c[C>>2]|0)|0)*1e6|0)-(c[t+12>>2]|0)|0)>>>0)/1.0e3+ +g[t+8>>2];if((c[t+16>>2]|0)!=0)break;t=c[5022]|0}c[5022]=c[t+20>>2]}}while(0);q=q+1|0}while((q|0)<(c[d+232>>2]|0))}o=c[5022]|0;C=(c[o+16>>2]|0)+ -1|0;c[o+16>>2]=C;do if((C|0)==0){if((c[o+4>>2]|0)!=0){Eb(f+280|0,0)|0;C=c[5008]|0;g[o+8>>2]=+(((c[f+284>>2]|0)-(c[C+4>>2]|0)+(((c[f+280>>2]|0)-(c[C>>2]|0)|0)*1e6|0)-(c[o+12>>2]|0)|0)>>>0)/1.0e3+ +g[o+8>>2];if((c[o+16>>2]|0)!=0)break;o=c[5022]|0}c[5022]=c[o+20>>2]}while(0);Lb[c[(c[d>>2]|0)+44>>2]&511](d);Lb[c[(c[d>>2]|0)+148>>2]&511](d);g[d+104>>2]=e;Nb[c[(c[d>>2]|0)+152>>2]&127](d,d+92|0);Kb[c[(c[d>>2]|0)+144>>2]&31](d,e);oE(1664);if((c[d+280>>2]|0)>0){o=0;do{C=c[(c[d+288>>2]|0)+(o<<2)>>2]|0;tc[c[(c[C>>2]|0)+8>>2]&7](C,d,e);o=o+1|0}while((o|0)<(c[d+280>>2]|0))}o=c[5022]|0;C=(c[o+16>>2]|0)+ -1|0;c[o+16>>2]=C;do if((C|0)==0){if((c[o+4>>2]|0)!=0){Eb(f+280|0,0)|0;C=c[5008]|0;g[o+8>>2]=+(((c[f+284>>2]|0)-(c[C+4>>2]|0)+(((c[f+280>>2]|0)-(c[C>>2]|0)|0)*1e6|0)-(c[o+12>>2]|0)|0)>>>0)/1.0e3+ +g[o+8>>2];if((c[o+16>>2]|0)!=0)break;o=c[5022]|0}c[5022]=c[o+20>>2]}while(0);Kb[c[(c[d>>2]|0)+156>>2]&31](d,e);o=c[d+80>>2]|0;if((o|0)!=0)Kb[o&31](d,e);d=c[5022]|0;C=(c[d+16>>2]|0)+ -1|0;c[d+16>>2]=C;if((C|0)!=0){i=f;return}do if((c[d+4>>2]|0)!=0){Eb(f+280|0,0)|0;C=c[5008]|0;g[d+8>>2]=+(((c[f+284>>2]|0)-(c[C+4>>2]|0)+(((c[f+280>>2]|0)-(c[C>>2]|0)|0)*1e6|0)-(c[d+12>>2]|0)|0)>>>0)/1.0e3+ +g[d+8>>2];if((c[d+16>>2]|0)==0){d=c[5022]|0;break}else{i=f;return}}while(0);c[5022]=c[d+20>>2];i=f;return}function Mo(a,b){a=a|0;b=b|0;var d=0,e=0,f=0,h=0,j=0.0,k=0,l=0.0,m=0.0;d=i;c[a+248>>2]=c[b+0>>2];c[a+252>>2]=c[b+4>>2];c[a+256>>2]=c[b+8>>2];c[a+260>>2]=c[b+12>>2];h=c[a+232>>2]|0;if((h|0)<=0){i=d;return}e=0;do{f=c[(c[a+240>>2]|0)+(e<<2)>>2]|0;k=c[f+216>>2]|0;if(!((k|0)==2|(k|0)==5)?(c[f+504>>2]&1|0)==0:0){j=+g[f+344>>2];if(j!=0.0){m=1.0/j*+g[b+4>>2];l=1.0/j*+g[b+8>>2];g[f+364>>2]=1.0/j*+g[b>>2];g[f+368>>2]=m;g[f+372>>2]=l;g[f+376>>2]=0.0}c[f+380>>2]=c[b+0>>2];c[f+384>>2]=c[b+4>>2];c[f+388>>2]=c[b+8>>2];c[f+392>>2]=c[b+12>>2];h=c[a+232>>2]|0}e=e+1|0}while((e|0)<(h|0));i=d;return}function No(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+0>>2]=c[b+248>>2];c[a+4>>2]=c[b+252>>2];c[a+8>>2]=c[b+256>>2];c[a+12>>2]=c[b+260>>2];i=d;return}function Oo(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;e=i;su(a,b,c,d);i=e;return}function Po(a,b){a=a|0;b=b|0;var d=0;d=i;if((b|0)==0?1:(c[b+236>>2]&2|0)==0){wu(a,b);i=d;return}else{Nb[c[(c[a>>2]|0)+92>>2]&127](a,b);i=d;return}}function Qo(a,b){a=a|0;b=b|0;var d=0,e=0,f=0,g=0,h=0,j=0;e=i;d=c[a+232>>2]|0;a:do if((d|0)>0){f=c[a+240>>2]|0;g=0;while(1){h=f+(g<<2)|0;j=g+1|0;if((c[h>>2]|0)==(b|0))break;if((j|0)<(d|0))g=j;else break a}if((g|0)<(d|0)){c[h>>2]=c[f+(d+ -1<<2)>>2];c[(c[a+240>>2]|0)+(d+ -1<<2)>>2]=b;c[a+232>>2]=d+ -1}}while(0);wu(a,b);i=e;return}function Ro(b,d){b=b|0;d=d|0;var e=0,f=0,h=0,j=0,k=0,l=0,m=0.0,n=0.0,o=0.0;e=i;h=c[d+204>>2]|0;if((h&3|0)==0?(c[d+504>>2]&1|0)==0:0){m=+g[d+344>>2];if(m!=0.0){o=1.0/m*+g[b+252>>2];n=1.0/m*+g[b+256>>2];g[d+364>>2]=1.0/m*+g[b+248>>2];g[d+368>>2]=o;g[d+372>>2]=n;g[d+376>>2]=0.0}c[d+380>>2]=c[b+248>>2];c[d+384>>2]=c[b+252>>2];c[d+388>>2]=c[b+256>>2];c[d+392>>2]=c[b+260>>2]}if((c[d+192>>2]|0)==0){i=e;return}if((h&1|0)!=0){if(!(((c[d+216>>2]|0)+ -4|0)>>>0<2))c[d+216>>2]=2}else{j=c[b+232>>2]|0;if((j|0)==(c[b+236>>2]|0)?(f=(j|0)==0?1:j<<1,(j|0)<(f|0)):0){if((f|0)==0)h=0;else{c[5004]=(c[5004]|0)+1;h=XE((f<<2|3)+16|0)|0;if((h|0)==0)h=0;else{c[(h+19&-16)+ -4>>2]=h;h=h+19&-16}j=c[b+232>>2]|0}if((j|0)>0){k=0;do{l=h+(k<<2)|0;if((l|0)!=0)c[l>>2]=c[(c[b+240>>2]|0)+(k<<2)>>2];k=k+1|0}while((k|0)!=(j|0))}k=c[b+240>>2]|0;if((k|0)!=0){if((a[b+244>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[k+ -4>>2]|0);j=c[b+232>>2]|0}c[b+240>>2]=0}a[b+244>>0]=1;c[b+240>>2]=h;c[b+236>>2]=f}f=(c[b+240>>2]|0)+(j<<2)|0;if((f|0)!=0)c[f>>2]=d;c[b+232>>2]=j+1;h=c[d+204>>2]|0}if((h&1|0)==0)f=(h&2|0)==0;else f=0;vc[c[(c[b>>2]|0)+36>>2]&127](b,d,f?1:2,f?-1:-3);i=e;return}function So(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var h=0,j=0,k=0,l=0,m=0,n=0,o=0.0,p=0.0,q=0.0;h=i;k=c[d+204>>2]|0;if((k&3|0)==0?(c[d+504>>2]&1|0)==0:0){o=+g[d+344>>2];if(o!=0.0){q=1.0/o*+g[b+252>>2];p=1.0/o*+g[b+256>>2];g[d+364>>2]=1.0/o*+g[b+248>>2];g[d+368>>2]=q;g[d+372>>2]=p;g[d+376>>2]=0.0}c[d+380>>2]=c[b+248>>2];c[d+384>>2]=c[b+252>>2];c[d+388>>2]=c[b+256>>2];c[d+392>>2]=c[b+260>>2]}if((c[d+192>>2]|0)==0){i=h;return}if((k&1|0)!=0){if(!(((c[d+216>>2]|0)+ -4|0)>>>0<2))c[d+216>>2]=2}else{l=c[b+232>>2]|0;if((l|0)==(c[b+236>>2]|0)?(j=(l|0)==0?1:l<<1,(l|0)<(j|0)):0){if((j|0)==0)k=0;else{c[5004]=(c[5004]|0)+1;k=XE((j<<2|3)+16|0)|0;if((k|0)==0)k=0;else{c[(k+19&-16)+ -4>>2]=k;k=k+19&-16}l=c[b+232>>2]|0}if((l|0)>0){n=0;do{m=k+(n<<2)|0;if((m|0)!=0)c[m>>2]=c[(c[b+240>>2]|0)+(n<<2)>>2];n=n+1|0}while((n|0)!=(l|0))}m=c[b+240>>2]|0;if((m|0)!=0){if((a[b+244>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[m+ -4>>2]|0);l=c[b+232>>2]|0}c[b+240>>2]=0}a[b+244>>0]=1;c[b+240>>2]=k;c[b+236>>2]=j}j=(c[b+240>>2]|0)+(l<<2)|0;if((j|0)!=0)c[j>>2]=d;c[b+232>>2]=l+1}vc[c[(c[b>>2]|0)+36>>2]&127](b,d,e,f);i=h;return}function To(b,d){b=b|0;d=+d;var e=0,f=0,h=0,j=0,k=0,l=0,m=0.0,n=0.0,o=0.0,p=0.0;e=i;i=i+16|0;oE(1680);if((c[b+232>>2]|0)>0){f=(a[3896]|0)==0;h=0;do{k=c[(c[b+240>>2]|0)+(h<<2)>>2]|0;a:do if((k|0)!=0){l=c[k+216>>2]|0;do if(!((l|0)==4|(l|0)==2)){p=+g[k+312>>2];o=+g[k+316>>2];n=+g[k+320>>2];m=+g[k+472>>2];if(p*p+o*o+n*n<m*m?(m=+g[k+328>>2],n=+g[k+332>>2],o=+g[k+336>>2],p=+g[k+476>>2],m*m+n*n+o*o<p*p):0){g[k+220>>2]=+g[k+220>>2]+d;j=10;break}g[k+220>>2]=0.0;if(!((l+ -4|0)>>>0<2)){c[k+216>>2]=0;l=0}else j=10}else j=10;while(0);if((j|0)==10){j=0;if((l|0)==4)break}do if(f){if(!((l+ -2|0)>>>0<2)?!(+g[k+220>>2]>2.0):0)break;if((c[k+204>>2]&3|0)!=0){if((l+ -4|0)>>>0<2)break a;c[k+216>>2]=2;break a}if((l|0)==1){c[k+216>>2]=3;break a}if((l|0)!=2)break a;l=(c[k+260>>2]|0)+2|0;c[k+328>>2]=0;c[k+332>>2]=0;c[k+336>>2]=0;c[k+340>>2]=0;c[k+260>>2]=l;c[k+312>>2]=0;c[k+316>>2]=0;c[k+320>>2]=0;c[k+324>>2]=0;break a}while(0);if(!((l+ -4|0)>>>0<2))c[k+216>>2]=1}while(0);h=h+1|0}while((h|0)<(c[b+232>>2]|0))}b=c[5022]|0;l=(c[b+16>>2]|0)+ -1|0;c[b+16>>2]=l;if((l|0)!=0){i=e;return}do if((c[b+4>>2]|0)!=0){Eb(e|0,0)|0;l=c[5008]|0;g[b+8>>2]=+(((c[e+4>>2]|0)-(c[l+4>>2]|0)+(((c[e>>2]|0)-(c[l>>2]|0)|0)*1e6|0)-(c[b+12>>2]|0)|0)>>>0)/1.0e3+ +g[b+8>>2];if((c[b+16>>2]|0)==0){b=c[5022]|0;break}else{i=e;return}}while(0);c[5022]=c[b+20>>2];i=e;return}function Uo(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,k=0,l=0;f=i;j=c[b+212>>2]|0;if((j|0)==(c[b+216>>2]|0)?(g=(j|0)==0?1:j<<1,(j|0)<(g|0)):0){if((g|0)==0)h=0;else{c[5004]=(c[5004]|0)+1;h=XE((g<<2|3)+16|0)|0;if((h|0)==0)h=0;else{c[(h+19&-16)+ -4>>2]=h;h=h+19&-16}j=c[b+212>>2]|0}if((j|0)>0){k=0;do{l=h+(k<<2)|0;if((l|0)!=0)c[l>>2]=c[(c[b+220>>2]|0)+(k<<2)>>2];k=k+1|0}while((k|0)!=(j|0))}k=c[b+220>>2]|0;if((k|0)!=0){if((a[b+224>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[k+ -4>>2]|0);j=c[b+212>>2]|0}c[b+220>>2]=0}a[b+224>>0]=1;c[b+220>>2]=h;c[b+216>>2]=g}g=(c[b+220>>2]|0)+(j<<2)|0;if((g|0)!=0)c[g>>2]=d;c[b+212>>2]=j+1;if(!e){i=f;return}fr(c[d+28>>2]|0,d);fr(c[d+32>>2]|0,d);i=f;return}



function vr(b,d,e,f,h,j,k,l,m){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;k=k|0;l=l|0;m=m|0;var n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0.0,X=0.0,Y=0;m=i;i=i+320|0;c[b+188>>2]=-1;oE(4080);c[b+184>>2]=0;if((e|0)>0){p=0;do{c[(c[d+(p<<2)>>2]|0)+212>>2]=-1;p=p+1|0}while((p|0)!=(e|0))}p=c[b+12>>2]|0;if((p|0)<(e+1|0)){if((e+1|0)!=0?(c[5004]=(c[5004]|0)+1,o=XE(((e+1|0)*244|3)+16|0)|0,(o|0)!=0):0){c[(o+19&-16)+ -4>>2]=o;o=o+19&-16}else o=0;p=c[b+8>>2]|0;if((p|0)>0){q=0;do{x=o+(q*244|0)|0;Y=c[b+16>>2]|0;w=Y+(q*244|0)|0;c[x+0>>2]=c[w+0>>2];c[x+4>>2]=c[w+4>>2];c[x+8>>2]=c[w+8>>2];c[x+12>>2]=c[w+12>>2];x=o+(q*244|0)+16|0;w=Y+(q*244|0)+16|0;c[x+0>>2]=c[w+0>>2];c[x+4>>2]=c[w+4>>2];c[x+8>>2]=c[w+8>>2];c[x+12>>2]=c[w+12>>2];x=o+(q*244|0)+32|0;w=Y+(q*244|0)+32|0;c[x+0>>2]=c[w+0>>2];c[x+4>>2]=c[w+4>>2];c[x+8>>2]=c[w+8>>2];c[x+12>>2]=c[w+12>>2];x=o+(q*244|0)+48|0;w=Y+(q*244|0)+48|0;c[x+0>>2]=c[w+0>>2];c[x+4>>2]=c[w+4>>2];c[x+8>>2]=c[w+8>>2];c[x+12>>2]=c[w+12>>2];cF(o+(q*244|0)+64|0,Y+(q*244|0)+64|0,180)|0;q=q+1|0}while((q|0)!=(p|0))}p=c[b+16>>2]|0;if((p|0)!=0){if((a[b+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[p+ -4>>2]|0)}c[b+16>>2]=0}a[b+20>>0]=1;c[b+16>>2]=o;c[b+12>>2]=e+1;o=b+8|0;q=e+1|0}else{o=b+8|0;q=p}$E(m+56|0,0,244)|0;p=c[o>>2]|0;if((p|0)<0){if((q|0)<0){q=c[b+16>>2]|0;if((q|0)!=0){if((a[b+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[q+ -4>>2]|0)}c[b+16>>2]=0}a[b+20>>0]=1;c[b+16>>2]=0;c[b+12>>2]=0}do{Y=c[b+16>>2]|0;x=Y+(p*244|0)|0;c[x+0>>2]=c[m+56>>2];c[x+4>>2]=c[m+60>>2];c[x+8>>2]=c[m+64>>2];c[x+12>>2]=c[m+68>>2];x=Y+(p*244|0)+16|0;c[x+0>>2]=c[m+72>>2];c[x+4>>2]=c[m+76>>2];c[x+8>>2]=c[m+80>>2];c[x+12>>2]=c[m+84>>2];x=Y+(p*244|0)+32|0;c[x+0>>2]=c[m+88>>2];c[x+4>>2]=c[m+92>>2];c[x+8>>2]=c[m+96>>2];c[x+12>>2]=c[m+100>>2];x=Y+(p*244|0)+48|0;c[x+0>>2]=c[m+104>>2];c[x+4>>2]=c[m+108>>2];c[x+8>>2]=c[m+112>>2];c[x+12>>2]=c[m+116>>2];cF(Y+(p*244|0)+64|0,m+120|0,180)|0;p=p+1|0}while((p|0)!=0)}c[o>>2]=0;if((e|0)>0){o=0;do{p=d+(o<<2)|0;q=sr(b,c[p>>2]|0,+g[l+12>>2])|0;p=c[p>>2]|0;if((!((p|0)==0?1:(c[p+236>>2]&2|0)==0)?+g[p+344>>2]!=0.0:0)?(n=c[b+16>>2]|0,(c[p+504>>2]&2|0)!=0):0){E=+g[l+76>>2];S=1.0/+g[p+396>>2];V=1.0/+g[p+400>>2];F=1.0/+g[p+404>>2];M=+g[p+4>>2];N=+g[p+8>>2];O=+g[p+12>>2];R=+g[p+20>>2];U=+g[p+24>>2];X=+g[p+28>>2];T=+g[p+36>>2];W=+g[p+40>>2];C=+g[p+44>>2];B=+g[p+328>>2];z=+g[p+332>>2];D=+g[p+336>>2];y=(M*S*M+N*V*N+O*F*O)*B+(S*M*R+V*N*U+F*O*X)*z+(S*M*T+V*N*W+F*O*C)*D;A=(M*S*R+N*V*U+O*F*X)*B+(R*S*R+U*V*U+X*F*X)*z+(S*R*T+V*U*W+F*X*C)*D;C=D*(T*S*T+W*V*W+C*F*C)+(B*(M*S*T+N*V*W+O*F*C)+z*(R*S*T+U*V*W+X*F*C));F=(z*C-D*A)*(z*C-D*A)+(D*y-B*C)*(D*y-B*C)+(B*A-z*y)*(B*A-z*y);if(F>E*E){X=1.0/+Q(+F)*E;E=(z*C-D*A)*X;C=X*(D*y-B*C);y=X*(B*A-z*y)}else{E=z*C-D*A;C=D*y-B*C;y=B*A-z*y}V=+g[l+12>>2];W=(E*+g[p+268>>2]+C*+g[p+284>>2]+y*+g[p+300>>2])*V;X=V*(E*+g[p+272>>2]+C*+g[p+288>>2]+y*+g[p+304>>2]);g[n+(q*244|0)+224>>2]=+g[n+(q*244|0)+224>>2]-(E*+g[p+264>>2]+C*+g[p+280>>2]+y*+g[p+296>>2])*V;g[n+(q*244|0)+228>>2]=+g[n+(q*244|0)+228>>2]-W;g[n+(q*244|0)+232>>2]=+g[n+(q*244|0)+232>>2]-X}o=o+1|0}while((o|0)<(e|0))}if((k|0)>0){e=0;do{Y=c[j+(e<<2)>>2]|0;Lb[c[(c[Y>>2]|0)+8>>2]&511](Y);g[Y+36>>2]=0.0;e=e+1|0}while((e|0)<(k|0))}o=c[b+168>>2]|0;if((o|0)<(k|0)?(c[b+172>>2]|0)<(k|0):0){if((k|0)==0)e=0;else{c[5004]=(c[5004]|0)+1;e=XE((k<<3|3)+16|0)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}o=c[b+168>>2]|0}if((o|0)>0){n=0;do{d=e+(n<<3)|0;if((d|0)!=0){x=(c[b+176>>2]|0)+(n<<3)|0;Y=c[x+4>>2]|0;c[d>>2]=c[x>>2];c[d+4>>2]=Y}n=n+1|0}while((n|0)!=(o|0))}n=c[b+176>>2]|0;if((n|0)!=0){if((a[b+180>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[n+ -4>>2]|0)}c[b+176>>2]=0}a[b+180>>0]=1;c[b+176>>2]=e;c[b+172>>2]=k}c[b+168>>2]=k;if((k|0)>0){e=0;n=0;do{d=c[b+176>>2]|0;o=d+(e<<3)|0;p=j+(e<<2)|0;q=c[p>>2]|0;r=c[q+44>>2]|0;if((r|0)!=0){q=r+0|0;r=q+64|0;do{c[q>>2]=0;q=q+4|0}while((q|0)<(r|0));q=c[p>>2]|0}if((a[q+20>>0]|0)==0){c[o>>2]=0;c[d+(e<<3)+4>>2]=0;d=0}else{Nb[c[(c[q>>2]|0)+16>>2]&127](q,o);d=c[o>>2]|0}n=d+n|0;e=e+1|0}while((e|0)<(k|0))}else n=0;o=c[b+48>>2]|0;if((o|0)<(n|0)?(c[b+52>>2]|0)<(n|0):0){if((n|0)==0)e=0;else{c[5004]=(c[5004]|0)+1;e=XE((n*152|3)+16|0)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}o=c[b+48>>2]|0}if((o|0)>0){d=0;do{cF(e+(d*152|0)|0,(c[b+56>>2]|0)+(d*152|0)|0,152)|0;d=d+1|0}while((d|0)!=(o|0))}d=c[b+56>>2]|0;if((d|0)!=0){if((a[b+60>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[d+ -4>>2]|0)}c[b+56>>2]=0}a[b+60>>0]=1;c[b+56>>2]=e;c[b+52>>2]=n}c[b+48>>2]=n;if((k|0)>0){o=c[b+176>>2]|0;e=0;n=0;while(1){d=o+(n<<3)|0;if((c[d>>2]|0)==0)d=0;else{v=c[b+56>>2]|0;u=j+(n<<2)|0;t=c[u>>2]|0;o=c[t+28>>2]|0;p=c[t+32>>2]|0;s=sr(b,o,+g[l+12>>2])|0;r=sr(b,p,+g[l+12>>2])|0;q=c[b+16>>2]|0;x=c[t+24>>2]|0;if((x|0)<=0)x=c[l+20>>2]|0;if((x|0)>(c[b+184>>2]|0))c[b+184>>2]=x;if((c[d>>2]|0)>0){w=0;do{Y=w+e|0;$E(v+(Y*152|0)|0,0,152)|0;g[v+(Y*152|0)+120>>2]=-3.4028234663852886e+38;g[v+(Y*152|0)+124>>2]=3.4028234663852886e+38;g[v+(Y*152|0)+100>>2]=0.0;g[v+(Y*152|0)+96>>2]=0.0;c[v+(Y*152|0)+144>>2]=s;c[v+(Y*152|0)+148>>2]=r;c[v+(Y*152|0)+136>>2]=x;w=w+1|0}while((w|0)<(c[d>>2]|0))}c[q+(s*244|0)+64>>2]=0;c[q+(s*244|0)+68>>2]=0;c[q+(s*244|0)+72>>2]=0;c[q+(s*244|0)+76>>2]=0;c[q+(s*244|0)+80>>2]=0;c[q+(s*244|0)+84>>2]=0;c[q+(s*244|0)+88>>2]=0;c[q+(s*244|0)+92>>2]=0;c[q+(s*244|0)+144>>2]=0;c[q+(s*244|0)+148>>2]=0;c[q+(s*244|0)+152>>2]=0;c[q+(s*244|0)+156>>2]=0;c[q+(s*244|0)+160>>2]=0;c[q+(s*244|0)+164>>2]=0;c[q+(s*244|0)+168>>2]=0;c[q+(s*244|0)+172>>2]=0;c[q+(r*244|0)+64>>2]=0;c[q+(r*244|0)+68>>2]=0;c[q+(r*244|0)+72>>2]=0;c[q+(r*244|0)+76>>2]=0;c[q+(r*244|0)+80>>2]=0;c[q+(r*244|0)+84>>2]=0;c[q+(r*244|0)+88>>2]=0;c[q+(r*244|0)+92>>2]=0;c[q+(r*244|0)+144>>2]=0;c[q+(r*244|0)+148>>2]=0;c[q+(r*244|0)+152>>2]=0;c[q+(r*244|0)+156>>2]=0;c[q+(r*244|0)+160>>2]=0;c[q+(r*244|0)+164>>2]=0;c[q+(r*244|0)+168>>2]=0;c[q+(r*244|0)+172>>2]=0;g[m>>2]=1.0/+g[l+12>>2];g[m+4>>2]=+g[l+32>>2];c[m+8>>2]=v+(e*152|0)+16;c[m+12>>2]=v+(e*152|0);c[m+16>>2]=v+(e*152|0)+48;c[m+20>>2]=v+(e*152|0)+32;c[m+24>>2]=38;c[m+28>>2]=v+(e*152|0)+112;Y=v+(e*152|0)+116|0;g[Y>>2]=+g[l+40>>2];g[m+52>>2]=+g[l+4>>2];c[m+32>>2]=Y;c[m+36>>2]=v+(e*152|0)+120;c[m+40>>2]=v+(e*152|0)+124;c[m+48>>2]=c[l+20>>2];Y=c[u>>2]|0;Nb[c[(c[Y>>2]|0)+20>>2]&127](Y,m);if((c[d>>2]|0)>0){w=0;do{x=w+e|0;Y=(c[u>>2]|0)+16|0;y=+g[Y>>2];if(+g[v+(x*152|0)+124>>2]>=y){g[v+(x*152|0)+124>>2]=y;y=+g[Y>>2]}y=-y;if(+g[v+(x*152|0)+120>>2]<=y)g[v+(x*152|0)+120>>2]=y;c[v+(x*152|0)+132>>2]=t;Y=c[t+28>>2]|0;W=+g[v+(x*152|0)>>2];I=+g[v+(x*152|0)+4>>2];J=+g[v+(x*152|0)+8>>2];y=(W*+g[Y+280>>2]+I*+g[Y+284>>2]+J*+g[Y+288>>2])*+g[Y+548>>2];H=(W*+g[Y+296>>2]+I*+g[Y+300>>2]+J*+g[Y+304>>2])*+g[Y+552>>2];g[v+(x*152|0)+64>>2]=(+g[Y+264>>2]*W+ +g[Y+268>>2]*I+ +g[Y+272>>2]*J)*+g[Y+544>>2];g[v+(x*152|0)+68>>2]=y;g[v+(x*152|0)+72>>2]=H;g[v+(x*152|0)+76>>2]=0.0;Y=c[t+32>>2]|0;H=+g[v+(x*152|0)+32>>2];y=+g[v+(x*152|0)+36>>2];J=+g[v+(x*152|0)+40>>2];I=(H*+g[Y+280>>2]+y*+g[Y+284>>2]+J*+g[Y+288>>2])*+g[Y+548>>2];W=(H*+g[Y+296>>2]+y*+g[Y+300>>2]+J*+g[Y+304>>2])*+g[Y+552>>2];g[v+(x*152|0)+80>>2]=(+g[Y+264>>2]*H+ +g[Y+268>>2]*y+ +g[Y+272>>2]*J)*+g[Y+544>>2];g[v+(x*152|0)+84>>2]=I;g[v+(x*152|0)+88>>2]=W;g[v+(x*152|0)+92>>2]=0.0;W=+g[o+344>>2];I=+g[v+(x*152|0)+16>>2];H=+g[v+(x*152|0)+20>>2];G=+g[v+(x*152|0)+24>>2];F=+g[v+(x*152|0)>>2];E=+g[v+(x*152|0)+4>>2];D=+g[v+(x*152|0)+8>>2];X=+g[p+344>>2];C=+g[v+(x*152|0)+48>>2];B=+g[v+(x*152|0)+52>>2];A=+g[v+(x*152|0)+56>>2];z=+g[v+(x*152|0)+32>>2];J=I*W*I+H*W*H+G*W*G+(F*(+g[o+264>>2]*F+ +g[o+268>>2]*E+ +g[o+272>>2]*D)+E*(F*+g[o+280>>2]+E*+g[o+284>>2]+D*+g[o+288>>2])+D*(F*+g[o+296>>2]+E*+g[o+300>>2]+D*+g[o+304>>2]))+(C*X*C+B*X*B+A*X*A)+(z*(+g[p+264>>2]*z+ +g[p+268>>2]*y+ +g[p+272>>2]*J)+y*(z*+g[p+280>>2]+y*+g[p+284>>2]+J*+g[p+288>>2])+J*(z*+g[p+296>>2]+y*+g[p+300>>2]+J*+g[p+304>>2]));if(+P(+J)>1.1920928955078125e-7)T=1.0/J;else T=0.0;g[v+(x*152|0)+108>>2]=T;if((c[q+(s*244|0)+240>>2]|0)==0){X=0.0;K=0.0;L=0.0;M=0.0;N=0.0;O=0.0}else{X=+g[q+(s*244|0)+208>>2];K=+g[q+(s*244|0)+212>>2];L=+g[q+(s*244|0)+216>>2];M=+g[q+(s*244|0)+224>>2];N=+g[q+(s*244|0)+228>>2];O=+g[q+(s*244|0)+232>>2]}if((c[q+(r*244|0)+240>>2]|0)==0){W=0.0;V=0.0;U=0.0;J=0.0;S=0.0;R=0.0}else{W=+g[q+(r*244|0)+208>>2];V=+g[q+(r*244|0)+212>>2];U=+g[q+(r*244|0)+216>>2];J=+g[q+(r*244|0)+224>>2];S=+g[q+(r*244|0)+228>>2];R=+g[q+(r*244|0)+232>>2]}g[v+(x*152|0)+112>>2]=+g[v+(x*152|0)+112>>2]*T+T*(0.0- +g[m+52>>2]*((X+ +g[o+312>>2])*I+(K+ +g[o+316>>2])*H+(L+ +g[o+320>>2])*G+((M+ +g[o+328>>2])*F+(N+ +g[o+332>>2])*E+(O+ +g[o+336>>2])*D)+((W+ +g[p+312>>2])*C+(V+ +g[p+316>>2])*B+(U+ +g[p+320>>2])*A+((J+ +g[p+328>>2])*z+(S+ +g[p+332>>2])*y+(R+ +g[p+336>>2])*+g[v+(x*152|0)+40>>2]))));g[v+(x*152|0)+100>>2]=0.0;w=w+1|0}while((w|0)<(c[d>>2]|0))}d=c[b+176>>2]|0;o=d;d=c[d+(n<<3)>>2]|0}n=n+1|0;if((n|0)>=(k|0))break;else e=d+e|0}}vc[c[(c[b>>2]|0)+28>>2]&127](b,f,h,l);f=c[b+48>>2]|0;j=c[b+28>>2]|0;k=c[b+68>>2]|0;e=c[b+128>>2]|0;if((e|0)<(f|0)?(c[b+132>>2]|0)<(f|0):0){if((f|0)==0)h=0;else{c[5004]=(c[5004]|0)+1;h=XE((f<<2|3)+16|0)|0;if((h|0)==0)h=0;else{c[(h+19&-16)+ -4>>2]=h;h=h+19&-16}e=c[b+128>>2]|0}if((e|0)>0){n=0;do{d=h+(n<<2)|0;if((d|0)!=0)c[d>>2]=c[(c[b+136>>2]|0)+(n<<2)>>2];n=n+1|0}while((n|0)!=(e|0))}e=c[b+136>>2]|0;if((e|0)!=0){if((a[b+140>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+136>>2]=0}a[b+140>>0]=1;c[b+136>>2]=h;c[b+132>>2]=f}c[b+128>>2]=f;if((c[l+64>>2]&16|0)==0){h=c[b+108>>2]|0;if((h|0)<(j|0)?(c[b+112>>2]|0)<(j|0):0){if((j|0)==0)l=0;else{c[5004]=(c[5004]|0)+1;l=XE((j<<2|3)+16|0)|0;if((l|0)==0)l=0;else{c[(l+19&-16)+ -4>>2]=l;l=l+19&-16}h=c[b+108>>2]|0}if((h|0)>0){e=0;do{n=l+(e<<2)|0;if((n|0)!=0)c[n>>2]=c[(c[b+116>>2]|0)+(e<<2)>>2];e=e+1|0}while((e|0)!=(h|0))}h=c[b+116>>2]|0;if((h|0)!=0){if((a[b+120>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[b+116>>2]=0}a[b+120>>0]=1;c[b+116>>2]=l;c[b+112>>2]=j}c[b+108>>2]=j}else{n=c[b+108>>2]|0;if((n|0)<(j<<1|0)?(c[b+112>>2]|0)<(j<<1|0):0){if((j|0)==0)l=0;else{c[5004]=(c[5004]|0)+1;l=XE((j<<3|3)+16|0)|0;if((l|0)==0)l=0;else{c[(l+19&-16)+ -4>>2]=l;l=l+19&-16}n=c[b+108>>2]|0}if((n|0)>0){e=0;do{h=l+(e<<2)|0;if((h|0)!=0)c[h>>2]=c[(c[b+116>>2]|0)+(e<<2)>>2];e=e+1|0}while((e|0)!=(n|0))}h=c[b+116>>2]|0;if((h|0)!=0){if((a[b+120>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[b+116>>2]=0}a[b+120>>0]=1;c[b+116>>2]=l;c[b+112>>2]=j<<1}c[b+108>>2]=j<<1}e=c[b+148>>2]|0;if((e|0)<(k|0)?(c[b+152>>2]|0)<(k|0):0){if((k|0)==0)l=0;else{c[5004]=(c[5004]|0)+1;l=XE((k<<2|3)+16|0)|0;if((l|0)==0)l=0;else{c[(l+19&-16)+ -4>>2]=l;l=l+19&-16}e=c[b+148>>2]|0}if((e|0)>0){h=0;do{n=l+(h<<2)|0;if((n|0)!=0)c[n>>2]=c[(c[b+156>>2]|0)+(h<<2)>>2];h=h+1|0}while((h|0)!=(e|0))}h=c[b+156>>2]|0;if((h|0)!=0){if((a[b+160>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[b+156>>2]=0}a[b+160>>0]=1;c[b+156>>2]=l;c[b+152>>2]=k}c[b+148>>2]=k;if((f|0)>0){h=c[b+136>>2]|0;l=0;do{c[h+(l<<2)>>2]=l;l=l+1|0}while((l|0)!=(f|0))}if((j|0)>0){l=c[b+116>>2]|0;f=0;do{c[l+(f<<2)>>2]=f;f=f+1|0}while((f|0)!=(j|0))}if((k|0)>0){b=c[b+156>>2]|0;l=0;do{c[b+(l<<2)>>2]=l;l=l+1|0}while((l|0)!=(k|0))}b=c[5022]|0;Y=(c[b+16>>2]|0)+ -1|0;c[b+16>>2]=Y;if((Y|0)!=0){i=m;return 0.0}do if((c[b+4>>2]|0)!=0){Eb(m+304|0,0)|0;Y=c[5008]|0;g[b+8>>2]=+(((c[m+308>>2]|0)-(c[Y+4>>2]|0)+(((c[m+304>>2]|0)-(c[Y>>2]|0)|0)*1e6|0)-(c[b+12>>2]|0)|0)>>>0)/1.0e3+ +g[b+8>>2];if((c[b+16>>2]|0)==0){b=c[5022]|0;break}else{i=m;return 0.0}}while(0);c[5022]=c[b+20>>2];i=m;return 0.0}function wr(b,d,e,f,h,j,k,l,m,n){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;k=k|0;l=l|0;m=m|0;n=n|0;var o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0.0,w=0.0;j=i;n=c[b+48>>2]|0;e=c[b+28>>2]|0;h=c[b+68>>2]|0;if((c[m+64>>2]&1|0)!=0){if((n|0)>0){f=c[b+136>>2]|0;q=c[b+192>>2]|0;r=0;do{s=f+(r<<2)|0;t=c[s>>2]|0;r=r+1|0;q=(aa(q,1664525)|0)+1013904223|0;if(r>>>0<65537){u=q>>>16^q;if(r>>>0<257)if(r>>>0<17){u=(u>>>8^u)>>>4^(u>>>8^u);if(r>>>0<5)if(r>>>0<3)u=(u>>>2^u)>>>1^(u>>>2^u);else u=u>>>2^u}else u=u>>>8^u}else u=q;u=f+(((u>>>0)%(r>>>0)|0)<<2)|0;c[s>>2]=c[u>>2];c[u>>2]=t}while((r|0)!=(n|0));c[b+192>>2]=q}if((c[m+20>>2]|0)>(d|0)){if((e|0)>0){s=c[b+116>>2]|0;r=c[b+192>>2]|0;q=0;do{f=s+(q<<2)|0;n=c[f>>2]|0;q=q+1|0;r=(aa(r,1664525)|0)+1013904223|0;if(q>>>0<65537){t=r>>>16^r;if(q>>>0<257)if(q>>>0<17){t=(t>>>8^t)>>>4^(t>>>8^t);if(q>>>0<5)if(q>>>0<3)t=(t>>>2^t)>>>1^(t>>>2^t);else t=t>>>2^t}else t=t>>>8^t}else t=r;u=s+(((t>>>0)%(q>>>0)|0)<<2)|0;c[f>>2]=c[u>>2];c[u>>2]=n}while((q|0)!=(e|0));c[b+192>>2]=r}if((h|0)>0){r=c[b+156>>2]|0;q=c[b+192>>2]|0;f=0;do{n=r+(f<<2)|0;e=c[n>>2]|0;f=f+1|0;q=(aa(q,1664525)|0)+1013904223|0;if(f>>>0<65537){s=q>>>16^q;if(f>>>0<257)if(f>>>0<17){s=(s>>>8^s)>>>4^(s>>>8^s);if(f>>>0<5)if(f>>>0<3)s=(s>>>2^s)>>>1^(s>>>2^s);else s=s>>>2^s}else s=s>>>8^s}else s=q;u=r+(((s>>>0)%(f>>>0)|0)<<2)|0;c[n>>2]=c[u>>2];c[u>>2]=e}while((f|0)!=(h|0));c[b+192>>2]=q}}}f=c[b+48>>2]|0;if((c[m+64>>2]&256|0)==0){if((f|0)>0){o=0;do{h=c[(c[b+136>>2]|0)+(o<<2)>>2]|0;p=c[b+56>>2]|0;if((c[p+(h*152|0)+136>>2]|0)>(d|0)){f=c[b+16>>2]|0;lr(f+((c[p+(h*152|0)+144>>2]|0)*244|0)|0,f+((c[p+(h*152|0)+148>>2]|0)*244|0)|0,p+(h*152|0)|0);f=c[b+48>>2]|0}o=o+1|0}while((o|0)<(f|0))}if((c[m+20>>2]|0)<=(d|0)){i=j;return 0.0}if((l|0)>0){p=0;do{o=k+(p<<2)|0;d=c[o>>2]|0;if((a[d+20>>0]|0)!=0){s=sr(b,c[d+28>>2]|0,+g[m+12>>2])|0;u=sr(b,c[(c[o>>2]|0)+32>>2]|0,+g[m+12>>2])|0;t=c[b+16>>2]|0;r=c[o>>2]|0;qc[c[(c[r>>2]|0)+24>>2]&15](r,t+(s*244|0)|0,t+(u*244|0)|0,+g[m+12>>2])}p=p+1|0}while((p|0)!=(l|0))}m=c[b+28>>2]|0;if((m|0)>0){l=0;do{u=c[(c[b+116>>2]|0)+(l<<2)>>2]|0;t=c[b+36>>2]|0;s=c[b+16>>2]|0;mr(s+((c[t+(u*152|0)+144>>2]|0)*244|0)|0,s+((c[t+(u*152|0)+148>>2]|0)*244|0)|0,t+(u*152|0)|0);l=l+1|0}while((l|0)!=(m|0))}m=c[b+68>>2]|0;if((m|0)>0){l=0;do{k=c[(c[b+156>>2]|0)+(l<<2)>>2]|0;o=c[b+76>>2]|0;v=+g[(c[b+36>>2]|0)+((c[o+(k*152|0)+140>>2]|0)*152|0)+100>>2];if(v>0.0){v=v*+g[o+(k*152|0)+104>>2];g[o+(k*152|0)+120>>2]=-v;g[o+(k*152|0)+124>>2]=v;u=c[b+16>>2]|0;lr(u+((c[o+(k*152|0)+144>>2]|0)*244|0)|0,u+((c[o+(k*152|0)+148>>2]|0)*244|0)|0,o+(k*152|0)|0)}l=l+1|0}while((l|0)!=(m|0))}m=c[b+88>>2]|0;if((m|0)<=0){i=j;return 0.0}l=0;do{k=c[b+96>>2]|0;v=+g[(c[b+36>>2]|0)+((c[k+(l*152|0)+140>>2]|0)*152|0)+100>>2];if(v>0.0){w=+g[k+(l*152|0)+104>>2];v=v*w>w?w:v*w;g[k+(l*152|0)+120>>2]=-v;g[k+(l*152|0)+124>>2]=v;u=c[b+16>>2]|0;lr(u+((c[k+(l*152|0)+144>>2]|0)*244|0)|0,u+((c[k+(l*152|0)+148>>2]|0)*244|0)|0,k+(l*152|0)|0)}l=l+1|0}while((l|0)!=(m|0));i=j;return 0.0}if((f|0)>0){h=0;do{n=c[(c[b+136>>2]|0)+(h<<2)>>2]|0;e=c[b+56>>2]|0;if((c[e+(n*152|0)+136>>2]|0)>(d|0)){f=c[b+16>>2]|0;lr(f+((c[e+(n*152|0)+144>>2]|0)*244|0)|0,f+((c[e+(n*152|0)+148>>2]|0)*244|0)|0,e+(n*152|0)|0);f=c[b+48>>2]|0}h=h+1|0}while((h|0)<(f|0))}if((c[m+20>>2]|0)<=(d|0)){i=j;return 0.0}if((l|0)>0){d=0;do{e=k+(d<<2)|0;h=c[e>>2]|0;if((a[h+20>>0]|0)!=0){s=sr(b,c[h+28>>2]|0,+g[m+12>>2])|0;u=sr(b,c[(c[e>>2]|0)+32>>2]|0,+g[m+12>>2])|0;t=c[b+16>>2]|0;r=c[e>>2]|0;qc[c[(c[r>>2]|0)+24>>2]&15](r,t+(s*244|0)|0,t+(u*244|0)|0,+g[m+12>>2])}d=d+1|0}while((d|0)!=(l|0))}n=c[m+64>>2]|0;l=c[b+28>>2]|0;if((n&512|0)!=0){if((l|0)<=0){i=j;return 0.0}e=0;do{h=c[(c[b+116>>2]|0)+(e<<2)>>2]|0;d=c[b+36>>2]|0;k=c[b+16>>2]|0;mr(k+((c[d+(h*152|0)+144>>2]|0)*244|0)|0,k+((c[d+(h*152|0)+148>>2]|0)*244|0)|0,d+(h*152|0)|0);v=+g[d+(h*152|0)+100>>2];h=aa(e,(n>>>4&1)+1|0)|0;d=c[(c[b+156>>2]|0)+(h<<2)>>2]|0;k=c[b+76>>2]|0;if(v>0.0){w=v*+g[k+(d*152|0)+104>>2];g[k+(d*152|0)+120>>2]=-w;g[k+(d*152|0)+124>>2]=w;u=c[b+16>>2]|0;lr(u+((c[k+(d*152|0)+144>>2]|0)*244|0)|0,u+((c[k+(d*152|0)+148>>2]|0)*244|0)|0,k+(d*152|0)|0)}if((c[m+64>>2]&16|0)!=0?(o=c[(c[b+156>>2]|0)+(h+1<<2)>>2]|0,p=c[b+76>>2]|0,v>0.0):0){w=v*+g[p+(o*152|0)+104>>2];g[p+(o*152|0)+120>>2]=-w;g[p+(o*152|0)+124>>2]=w;u=c[b+16>>2]|0;lr(u+((c[p+(o*152|0)+144>>2]|0)*244|0)|0,u+((c[p+(o*152|0)+148>>2]|0)*244|0)|0,p+(o*152|0)|0)}e=e+1|0}while((e|0)!=(l|0));i=j;return 0.0}if((l|0)>0){m=0;do{u=c[(c[b+116>>2]|0)+(m<<2)>>2]|0;t=c[b+36>>2]|0;s=c[b+16>>2]|0;mr(s+((c[t+(u*152|0)+144>>2]|0)*244|0)|0,s+((c[t+(u*152|0)+148>>2]|0)*244|0)|0,t+(u*152|0)|0);m=m+1|0}while((m|0)!=(l|0))}m=c[b+68>>2]|0;if((m|0)>0){l=0;do{k=c[(c[b+156>>2]|0)+(l<<2)>>2]|0;o=c[b+76>>2]|0;v=+g[(c[b+36>>2]|0)+((c[o+(k*152|0)+140>>2]|0)*152|0)+100>>2];if(v>0.0){w=v*+g[o+(k*152|0)+104>>2];g[o+(k*152|0)+120>>2]=-w;g[o+(k*152|0)+124>>2]=w;u=c[b+16>>2]|0;lr(u+((c[o+(k*152|0)+144>>2]|0)*244|0)|0,u+((c[o+(k*152|0)+148>>2]|0)*244|0)|0,o+(k*152|0)|0)}l=l+1|0}while((l|0)!=(m|0))}k=c[b+88>>2]|0;if((k|0)<=0){i=j;return 0.0}l=0;do{m=c[b+96>>2]|0;v=+g[(c[b+36>>2]|0)+((c[m+(l*152|0)+140>>2]|0)*152|0)+100>>2];if(v>0.0){w=+g[m+(l*152|0)+104>>2];w=v*w>w?w:v*w;g[m+(l*152|0)+120>>2]=-w;g[m+(l*152|0)+124>>2]=w;u=c[b+16>>2]|0;lr(u+((c[m+(l*152|0)+144>>2]|0)*244|0)|0,u+((c[m+(l*152|0)+148>>2]|0)*244|0)|0,m+(l*152|0)|0)}l=l+1|0}while((l|0)!=(k|0));i=j;return 0.0}function xr(a,b,d,e,f,g,h,j,k){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;j=j|0;k=k|0;d=i;if((c[j+44>>2]|0)==0){i=d;return}h=c[j+20>>2]|0;if((c[j+64>>2]&256|0)==0){if((h|0)<=0){i=d;return}f=1;while(1){g=c[a+28>>2]|0;if((g|0)>0){h=0;do{e=c[(c[a+116>>2]|0)+(h<<2)>>2]|0;b=c[a+36>>2]|0;k=c[a+16>>2]|0;nr(k+((c[b+(e*152|0)+144>>2]|0)*244|0)|0,k+((c[b+(e*152|0)+148>>2]|0)*244|0)|0,b+(e*152|0)|0);h=h+1|0}while((h|0)!=(g|0));h=c[j+20>>2]|0}if((f|0)>=(h|0))break;f=f+1|0}i=d;return}else{if((h|0)<=0){i=d;return}f=1;while(1){g=c[a+28>>2]|0;if((g|0)>0){h=0;do{e=c[(c[a+116>>2]|0)+(h<<2)>>2]|0;b=c[a+36>>2]|0;k=c[a+16>>2]|0;nr(k+((c[b+(e*152|0)+144>>2]|0)*244|0)|0,k+((c[b+(e*152|0)+148>>2]|0)*244|0)|0,b+(e*152|0)|0);h=h+1|0}while((h|0)!=(g|0));h=c[j+20>>2]|0}if((f|0)>=(h|0))break;f=f+1|0}i=d;return}}function yr(a,b,d,e,f,h,j,k,l){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;k=k|0;l=l|0;var m=0,n=0,o=0;m=i;i=i+16|0;oE(4112);ec[c[(c[a>>2]|0)+32>>2]&1](a,b,d,e,f,h,j,k,l);o=c[a+184>>2]|0;n=c[k+20>>2]|0;n=(o|0)>(n|0)?o:n;if((n|0)>0){o=0;do{+ic[c[(c[a>>2]|0)+40>>2]&3](a,o,b,d,e,f,h,j,k,l);o=o+1|0}while((o|0)<(n|0))}h=c[5022]|0;o=(c[h+16>>2]|0)+ -1|0;c[h+16>>2]=o;if((o|0)!=0){i=m;return 0.0}do if((c[h+4>>2]|0)!=0){Eb(m|0,0)|0;o=c[5008]|0;g[h+8>>2]=+(((c[m+4>>2]|0)-(c[o+4>>2]|0)+(((c[m>>2]|0)-(c[o>>2]|0)|0)*1e6|0)-(c[h+12>>2]|0)|0)>>>0)/1.0e3+ +g[h+8>>2];if((c[h+16>>2]|0)==0){h=c[5022]|0;break}else{i=m;return 0.0}}while(0);c[5022]=c[h+20>>2];i=m;return 0.0}function zr(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var h=0,j=0,k=0,l=0,m=0.0,n=0.0,o=0.0,p=0,q=0,r=0.0,s=0;d=i;i=i+80|0;j=c[b+28>>2]|0;l=c[f+64>>2]|0;if((l&4|0)!=0&(j|0)>0){e=c[b+36>>2]|0;k=c[b+76>>2]|0;if((l&16|0)==0){l=0;do{q=c[e+(l*152|0)+132>>2]|0;g[q+120>>2]=+g[e+(l*152|0)+100>>2];g[q+124>>2]=+g[k+((c[e+(l*152|0)+140>>2]|0)*152|0)+100>>2];l=l+1|0}while((l|0)!=(j|0))}else{l=0;do{q=c[e+(l*152|0)+132>>2]|0;g[q+120>>2]=+g[e+(l*152|0)+100>>2];p=c[e+(l*152|0)+140>>2]|0;g[q+124>>2]=+g[k+(p*152|0)+100>>2];g[q+128>>2]=+g[k+((p+1|0)*152|0)+100>>2];l=l+1|0}while((l|0)!=(j|0))}}j=c[b+48>>2]|0;if((j|0)>0){k=0;do{e=c[b+56>>2]|0;l=c[e+(k*152|0)+132>>2]|0;q=c[l+44>>2]|0;p=e+(k*152|0)+100|0;if((q|0)!=0){o=+g[p>>2];s=c[l+28>>2]|0;n=1.0/+g[f+12>>2];m=o*+g[e+(k*152|0)+20>>2]*+g[s+352>>2]*n;r=o*+g[e+(k*152|0)+24>>2]*+g[s+356>>2]*n;g[q>>2]=+g[e+(k*152|0)+16>>2]*o*+g[s+348>>2]*n+ +g[q>>2];g[q+4>>2]=m+ +g[q+4>>2];g[q+8>>2]=r+ +g[q+8>>2];r=+g[p>>2];s=c[l+32>>2]|0;m=1.0/+g[f+12>>2];n=r*+g[e+(k*152|0)+52>>2]*+g[s+352>>2]*m;o=r*+g[e+(k*152|0)+56>>2]*+g[s+356>>2]*m;g[q+32>>2]=+g[e+(k*152|0)+48>>2]*r*+g[s+348>>2]*m+ +g[q+32>>2];g[q+36>>2]=n+ +g[q+36>>2];g[q+40>>2]=o+ +g[q+40>>2];s=c[l+28>>2]|0;o=+g[p>>2];n=1.0/+g[f+12>>2];m=+g[e+(k*152|0)+4>>2]*+g[s+548>>2]*o*n;r=o*+g[e+(k*152|0)+8>>2]*+g[s+552>>2]*n;g[q+16>>2]=+g[e+(k*152|0)>>2]*+g[s+544>>2]*o*n+ +g[q+16>>2];g[q+20>>2]=m+ +g[q+20>>2];g[q+24>>2]=r+ +g[q+24>>2];s=c[l+32>>2]|0;r=+g[p>>2];m=1.0/+g[f+12>>2];n=+g[e+(k*152|0)+36>>2]*+g[s+548>>2]*r*m;o=r*+g[e+(k*152|0)+40>>2]*+g[s+552>>2]*m;g[q+48>>2]=+g[e+(k*152|0)+32>>2]*+g[s+544>>2]*r*m+ +g[q+48>>2];g[q+52>>2]=n+ +g[q+52>>2];g[q+56>>2]=o+ +g[q+56>>2]}g[l+36>>2]=+g[p>>2];r=+P(+(+g[p>>2]));if(r>=+g[l+16>>2])a[l+20>>0]=0;k=k+1|0}while((k|0)!=(j|0))}p=c[b+8>>2]|0;if((p|0)>0){j=c[b+16>>2]|0;e=0;do{k=j+(e*244|0)|0;l=c[j+(e*244|0)+240>>2]|0;if((l|0)!=0){if((c[f+44>>2]|0)==0){s=j+(e*244|0)+176|0;o=+g[j+(e*244|0)+64>>2]+ +g[s>>2];g[s>>2]=o;s=j+(e*244|0)+180|0;n=+g[j+(e*244|0)+68>>2]+ +g[s>>2];g[s>>2]=n;s=j+(e*244|0)+184|0;m=+g[j+(e*244|0)+72>>2]+ +g[s>>2];g[s>>2]=m;s=j+(e*244|0)+192|0;g[s>>2]=+g[j+(e*244|0)+80>>2]+ +g[s>>2];s=j+(e*244|0)+196|0;g[s>>2]=+g[j+(e*244|0)+84>>2]+ +g[s>>2];s=j+(e*244|0)+200|0;g[s>>2]=+g[j+(e*244|0)+88>>2]+ +g[s>>2]}else{n=+g[f+12>>2];m=+g[f+52>>2];l=j+(e*244|0)+176|0;g[l>>2]=+g[j+(e*244|0)+64>>2]+ +g[l>>2];l=j+(e*244|0)+180|0;g[l>>2]=+g[j+(e*244|0)+68>>2]+ +g[l>>2];l=j+(e*244|0)+184|0;g[l>>2]=+g[j+(e*244|0)+72>>2]+ +g[l>>2];l=j+(e*244|0)+192|0;g[l>>2]=+g[j+(e*244|0)+80>>2]+ +g[l>>2];l=j+(e*244|0)+196|0;g[l>>2]=+g[j+(e*244|0)+84>>2]+ +g[l>>2];l=j+(e*244|0)+200|0;g[l>>2]=+g[j+(e*244|0)+88>>2]+ +g[l>>2];l=j+(e*244|0)+144|0;p=j+(e*244|0)+148|0;if(((((!(+g[l>>2]!=0.0)?!(+g[p>>2]!=0.0):0)?!(+g[j+(e*244|0)+152>>2]!=0.0):0)?!(+g[j+(e*244|0)+160>>2]!=0.0):0)?!(+g[j+(e*244|0)+164>>2]!=0.0):0)?!(+g[j+(e*244|0)+168>>2]!=0.0):0)k=j;else h=22;if((h|0)==22){h=0;o=+g[j+(e*244|0)+164>>2]*m;r=+g[j+(e*244|0)+168>>2]*m;g[d>>2]=+g[j+(e*244|0)+160>>2]*m;g[d+4>>2]=o;g[d+8>>2]=r;g[d+12>>2]=0.0;ro(k,+g[l>>2],+g[p>>2],+g[j+(e*244|0)+152>>2],d,n,d+16|0);c[k+0>>2]=c[d+16>>2];c[k+4>>2]=c[d+20>>2];c[k+8>>2]=c[d+24>>2];c[k+12>>2]=c[d+28>>2];k=j+(e*244|0)+16|0;c[k+0>>2]=c[d+32>>2];c[k+4>>2]=c[d+36>>2];c[k+8>>2]=c[d+40>>2];c[k+12>>2]=c[d+44>>2];k=j+(e*244|0)+32|0;c[k+0>>2]=c[d+48>>2];c[k+4>>2]=c[d+52>>2];c[k+8>>2]=c[d+56>>2];c[k+12>>2]=c[d+60>>2];k=j+(e*244|0)+48|0;c[k+0>>2]=c[d+64>>2];c[k+4>>2]=c[d+68>>2];c[k+8>>2]=c[d+72>>2];c[k+12>>2]=c[d+76>>2];k=c[b+16>>2]|0}j=k;o=+g[k+(e*244|0)+176>>2];n=+g[k+(e*244|0)+180>>2];m=+g[k+(e*244|0)+184>>2];l=c[k+(e*244|0)+240>>2]|0}r=o+ +g[j+(e*244|0)+208>>2];o=n+ +g[j+(e*244|0)+212>>2];n=m+ +g[j+(e*244|0)+216>>2];q=l+260|0;c[q>>2]=(c[q>>2]|0)+1;g[l+312>>2]=r;g[l+316>>2]=o;g[l+320>>2]=n;g[l+324>>2]=0.0;q=c[b+16>>2]|0;s=c[q+(e*244|0)+240>>2]|0;n=+g[q+(e*244|0)+192>>2]+ +g[q+(e*244|0)+224>>2];o=+g[q+(e*244|0)+196>>2]+ +g[q+(e*244|0)+228>>2];r=+g[q+(e*244|0)+200>>2]+ +g[q+(e*244|0)+232>>2];c[s+260>>2]=(c[s+260>>2]|0)+1;g[s+328>>2]=n;g[s+332>>2]=o;g[s+336>>2]=r;g[s+340>>2]=0.0;if((c[f+44>>2]|0)!=0){q=c[b+16>>2]|0;s=c[q+(e*244|0)+240>>2]|0;p=q+(e*244|0)|0;c[s+260>>2]=(c[s+260>>2]|0)+1;c[s+4>>2]=c[p+0>>2];c[s+8>>2]=c[p+4>>2];c[s+12>>2]=c[p+8>>2];c[s+16>>2]=c[p+12>>2];p=q+(e*244|0)+16|0;c[s+20>>2]=c[p+0>>2];c[s+24>>2]=c[p+4>>2];c[s+28>>2]=c[p+8>>2];c[s+32>>2]=c[p+12>>2];p=q+(e*244|0)+32|0;c[s+36>>2]=c[p+0>>2];c[s+40>>2]=c[p+4>>2];c[s+44>>2]=c[p+8>>2];c[s+48>>2]=c[p+12>>2];q=q+(e*244|0)+48|0;c[s+52>>2]=c[q+0>>2];c[s+56>>2]=c[q+4>>2];c[s+60>>2]=c[q+8>>2];c[s+64>>2]=c[q+12>>2]}j=c[b+16>>2]|0;c[(c[j+(e*244|0)+240>>2]|0)+212>>2]=-1;p=c[b+8>>2]|0}e=e+1|0}while((e|0)<(p|0))}if((c[b+28>>2]|0)<0?(c[b+32>>2]|0)<0:0){f=c[b+36>>2]|0;if((f|0)!=0){if((a[b+40>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}c[b+36>>2]=0}a[b+40>>0]=1;c[b+36>>2]=0;c[b+32>>2]=0}c[b+28>>2]=0;if((c[b+48>>2]|0)<0?(c[b+52>>2]|0)<0:0){f=c[b+56>>2]|0;if((f|0)!=0){if((a[b+60>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}c[b+56>>2]=0}a[b+60>>0]=1;c[b+56>>2]=0;c[b+52>>2]=0}c[b+48>>2]=0;if((c[b+68>>2]|0)<0?(c[b+72>>2]|0)<0:0){f=c[b+76>>2]|0;if((f|0)!=0){if((a[b+80>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}c[b+76>>2]=0}a[b+80>>0]=1;c[b+76>>2]=0;c[b+72>>2]=0}c[b+68>>2]=0;if((c[b+88>>2]|0)<0?(c[b+92>>2]|0)<0:0){f=c[b+96>>2]|0;if((f|0)!=0){if((a[b+100>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}c[b+96>>2]=0}a[b+100>>0]=1;c[b+96>>2]=0;c[b+92>>2]=0}c[b+88>>2]=0;if((c[b+8>>2]|0)>=0){c[b+8>>2]=0;i=d;return 0.0}if((c[b+12>>2]|0)>=0){c[b+8>>2]=0;i=d;return 0.0}f=c[b+16>>2]|0;if((f|0)!=0){if((a[b+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}c[b+16>>2]=0}a[b+20>>0]=1;c[b+16>>2]=0;c[b+12>>2]=0;c[b+8>>2]=0;i=d;return 0.0}function Ar(a,b,d,e,f,h,j,k,l,m){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;k=k|0;l=l|0;m=m|0;m=i;i=i+16|0;oE(4152);+kc[c[(c[a>>2]|0)+44>>2]&3](a,b,d,e,f,h,j,k,l);+kc[c[(c[a>>2]|0)+48>>2]&3](a,b,d,e,f,h,j,k,l);+oc[c[(c[a>>2]|0)+36>>2]&1](a,b,d,k);j=c[5022]|0;e=(c[j+16>>2]|0)+ -1|0;c[j+16>>2]=e;if((e|0)!=0){i=m;return 0.0}do if((c[j+4>>2]|0)!=0){Eb(m|0,0)|0;e=c[5008]|0;g[j+8>>2]=+(((c[m+4>>2]|0)-(c[e+4>>2]|0)+(((c[m>>2]|0)-(c[e>>2]|0)|0)*1e6|0)-(c[j+12>>2]|0)|0)>>>0)/1.0e3+ +g[j+8>>2];if((c[j+16>>2]|0)==0){j=c[5022]|0;break}else{i=m;return 0.0}}while(0);c[5022]=c[j+20>>2];i=m;return 0.0}function Br(a){a=a|0;c[a+192>>2]=0;return}function Cr(a,b,c){a=a|0;b=b|0;c=c|0;return}function Dr(a,b,c){a=a|0;b=b|0;c=c|0;return}function Er(a){a=a|0;return 1}function Fr(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0;f=i;i=i+256|0;if((a[b+180>>0]|0)==0?(a[b+48>>0]|0)!=0:0){co(f+64|0,e,b+116|0);c[b+824>>2]=c[f+64>>2];c[b+828>>2]=c[f+68>>2];c[b+832>>2]=c[f+72>>2];c[b+836>>2]=c[f+76>>2];c[b+840>>2]=c[f+80>>2];c[b+844>>2]=c[f+84>>2];c[b+848>>2]=c[f+88>>2];c[b+852>>2]=c[f+92>>2];c[b+856>>2]=c[f+96>>2];c[b+860>>2]=c[f+100>>2];c[b+864>>2]=c[f+104>>2];c[b+868>>2]=c[f+108>>2];c[b+872>>2]=c[f+112>>2];c[b+876>>2]=c[f+116>>2];c[b+880>>2]=c[f+120>>2];c[b+884>>2]=c[f+124>>2];co(f,d,b+52|0);c[b+888>>2]=c[f+0>>2];c[b+892>>2]=c[f+4>>2];c[b+896>>2]=c[f+8>>2];c[b+900>>2]=c[f+12>>2];c[b+904>>2]=c[f+16>>2];c[b+908>>2]=c[f+20>>2];c[b+912>>2]=c[f+24>>2];c[b+916>>2]=c[f+28>>2];c[b+920>>2]=c[f+32>>2];c[b+924>>2]=c[f+36>>2];c[b+928>>2]=c[f+40>>2];c[b+932>>2]=c[f+44>>2];c[b+936>>2]=c[f+48>>2];c[b+940>>2]=c[f+52>>2];c[b+944>>2]=c[f+56>>2];c[b+948>>2]=c[f+60>>2]}else{co(f+192|0,d,b+52|0);c[b+824>>2]=c[f+192>>2];c[b+828>>2]=c[f+196>>2];c[b+832>>2]=c[f+200>>2];c[b+836>>2]=c[f+204>>2];c[b+840>>2]=c[f+208>>2];c[b+844>>2]=c[f+212>>2];c[b+848>>2]=c[f+216>>2];c[b+852>>2]=c[f+220>>2];c[b+856>>2]=c[f+224>>2];c[b+860>>2]=c[f+228>>2];c[b+864>>2]=c[f+232>>2];c[b+868>>2]=c[f+236>>2];c[b+872>>2]=c[f+240>>2];c[b+876>>2]=c[f+244>>2];c[b+880>>2]=c[f+248>>2];c[b+884>>2]=c[f+252>>2];co(f+128|0,e,b+116|0);c[b+888>>2]=c[f+128>>2];c[b+892>>2]=c[f+132>>2];c[b+896>>2]=c[f+136>>2];c[b+900>>2]=c[f+140>>2];c[b+904>>2]=c[f+144>>2];c[b+908>>2]=c[f+148>>2];c[b+912>>2]=c[f+152>>2];c[b+916>>2]=c[f+156>>2];c[b+920>>2]=c[f+160>>2];c[b+924>>2]=c[f+164>>2];c[b+928>>2]=c[f+168>>2];c[b+932>>2]=c[f+172>>2];c[b+936>>2]=c[f+176>>2];c[b+940>>2]=c[f+180>>2];c[b+944>>2]=c[f+184>>2];c[b+948>>2]=c[f+188>>2]}c[b+968>>2]=c[b+872>>2];c[b+972>>2]=c[b+876>>2];c[b+976>>2]=c[b+880>>2];c[b+980>>2]=c[b+884>>2];c[b+984>>2]=c[b+936>>2];c[b+988>>2]=c[b+940>>2];c[b+992>>2]=c[b+944>>2];c[b+996>>2]=c[b+948>>2];k=+g[b+824>>2];j=+g[b+840>>2];h=+g[b+856>>2];g[b+952>>2]=k;g[b+956>>2]=j;g[b+960>>2]=h;g[b+964>>2]=0.0;if((a[b+180>>0]|0)==0?(a[b+48>>0]|0)==0:0){t=+g[b+968>>2];n=t- +g[b+984>>2];r=+g[b+972>>2];m=r- +g[b+988>>2];q=+g[b+976>>2];l=q- +g[b+992>>2];g[b+1016>>2]=n;g[b+1020>>2]=m;g[b+1024>>2]=l;g[b+1028>>2]=0.0;p=k*n;s=j*m;s=p+s;p=h*l;p=s+p;s=k*p;j=j*p;k=h*p;h=t+s;j=r+j;k=q+k;d=b+1e3|0;g[d>>2]=h;d=b+1004|0;g[d>>2]=j;d=b+1008|0;g[d>>2]=k;d=b+1012|0;g[d>>2]=0.0;d=b+1032|0;g[d>>2]=p;d=b+828|0;e=b+844|0;o=b+860|0;k=+g[d>>2];j=+g[e>>2];h=+g[o>>2];k=k*n;j=j*m;j=k+j;h=h*l;h=j+h;o=b+1036|0;g[o>>2]=h;o=b+832|0;e=b+848|0;d=b+864|0;h=+g[o>>2];j=+g[e>>2];k=+g[d>>2];h=h*n;j=j*m;j=h+j;k=k*l;k=j+k;d=b+1040|0;g[d>>2]=k;i=f;return}v=+g[b+968>>2];q=+g[b+984>>2]-v;u=+g[b+972>>2];s=+g[b+988>>2]-u;l=+g[b+976>>2];t=+g[b+992>>2]-l;g[b+1016>>2]=q;g[b+1020>>2]=s;g[b+1024>>2]=t;g[b+1028>>2]=0.0;r=k*q;m=j*s;m=r+m;r=h*t;r=m+r;m=k*r;n=j*r;p=h*r;m=v+m;n=u+n;p=l+p;o=b+1e3|0;g[o>>2]=m;o=b+1004|0;g[o>>2]=n;o=b+1008|0;g[o>>2]=p;o=b+1012|0;g[o>>2]=0.0;o=b+1032|0;g[o>>2]=r;o=b+828|0;d=b+844|0;e=b+860|0;r=+g[o>>2];p=+g[d>>2];n=+g[e>>2];r=r*q;p=p*s;p=r+p;n=n*t;n=p+n;e=b+1036|0;g[e>>2]=n;e=b+832|0;d=b+848|0;o=b+864|0;n=+g[e>>2];p=+g[d>>2];r=+g[o>>2];q=n*q;s=p*s;s=q+s;t=r*t;t=s+t;o=b+1040|0;g[o>>2]=t;i=f;return}function Gr(b,d){b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0,l=0.0,m=0.0;e=i;if((a[b+48>>0]|0)!=0){c[d>>2]=0;c[d+4>>2]=0;i=e;return}c[d>>2]=4;c[d+4>>2]=2;Fr(b,(c[b+28>>2]|0)+4|0,(c[b+32>>2]|0)+4|0);g[b+1088>>2]=0.0;a[b+297>>0]=0;f=+g[b+192>>2];h=+g[b+196>>2];do if(f<=h){m=+g[b+892>>2];l=+g[b+908>>2];j=+g[b+924>>2];f=+Op(+Y(+(+g[b+832>>2]*m+ +g[b+848>>2]*l+ +g[b+864>>2]*j),+(+g[b+828>>2]*m+ +g[b+844>>2]*l+ +g[b+860>>2]*j)),f,h);g[b+1084>>2]=f;h=+g[b+192>>2];if(f<h){g[b+1088>>2]=f-h;a[b+297>>0]=1;break}h=+g[b+196>>2];if(f>h){g[b+1088>>2]=f-h;a[b+297>>0]=1}}while(0);a[b+296>>0]=0;h=+g[b+1032>>2];g[b+1080>>2]=h;f=+g[b+184>>2];j=+g[b+188>>2];do if(f<=j){if(h>j){g[b+1032>>2]=h-j;a[b+296>>0]=1;k=14;break}if(h<f){g[b+1032>>2]=h-f;a[b+296>>0]=1;k=14}else k=13}else k=13;while(0);if((k|0)==13?(g[b+1032>>2]=0.0,(a[b+1096>>0]|0)!=0):0)k=14;if((k|0)==14){c[d>>2]=(c[d>>2]|0)+1;c[d+4>>2]=(c[d+4>>2]|0)+ -1}if((a[b+297>>0]|0)==0?(a[b+1112>>0]|0)==0:0){i=e;return}c[d>>2]=(c[d>>2]|0)+1;c[d+4>>2]=(c[d+4>>2]|0)+ -1;i=e;return}function Hr(b,d){b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0,m=0,n=0,o=0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0,v=0,w=0,x=0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0,H=0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0,W=0.0,X=0.0,Y=0.0,Z=0.0,_=0.0,$=0;e=i;l=c[b+28>>2]|0;m=c[b+32>>2]|0;f=+g[l+344>>2];h=+g[m+344>>2];u=c[d+24>>2]|0;k=(a[b+180>>0]|0)!=0?1.0:-1.0;r=+g[b+936>>2]- +g[b+872>>2];s=+g[b+940>>2]- +g[b+876>>2];t=+g[b+944>>2]- +g[b+880>>2];if(f<1.1920928955078125e-7)o=1;else o=h<1.1920928955078125e-7;if(f+h>0.0)q=h/(f+h);else q=.5;p=1.0-q;I=+g[b+824>>2];D=+g[b+840>>2];z=+g[b+856>>2];M=+g[b+888>>2];O=+g[b+904>>2];B=+g[b+920>>2];G=(a[b+49>>0]|0)==0;do if(!G){C=q*I+p*M;L=q*D+p*O;J=q*z+p*B;E=1.0/+Q(+(C*C+L*L+J*J));if(+P(+(J*E))>.7071067690849304){T=1.0/+Q(+(J*E*J*E+L*E*L*E));f=C*E;h=L*E;j=J*E;y=0.0;A=-(J*E*T);F=L*E*T;K=(J*E*J*E+L*E*L*E)*T;S=-(C*E*L*E*T);T=C*E*-(J*E*T);break}else{T=1.0/+Q(+(C*E*C*E+L*E*L*E));f=C*E;h=L*E;j=J*E;y=-(L*E*T);A=C*E*T;F=0.0;K=-(J*E*C*E*T);S=J*E*-(L*E*T);T=(C*E*C*E+L*E*L*E)*T;break}}else{f=I;h=D;j=z;y=+g[b+828>>2];A=+g[b+844>>2];F=+g[b+860>>2];K=+g[b+832>>2];S=+g[b+848>>2];T=+g[b+864>>2]}while(0);w=c[d+12>>2]|0;g[w>>2]=y;g[w+4>>2]=A;g[w+8>>2]=F;g[w+(u<<2)>>2]=K;g[w+(u+1<<2)>>2]=S;g[w+(u+2<<2)>>2]=T;E=-y;x=c[d+20>>2]|0;g[x>>2]=E;L=-A;g[x+4>>2]=L;N=-F;g[x+8>>2]=N;C=-K;g[x+(u<<2)>>2]=C;R=-S;g[x+(u+1<<2)>>2]=R;J=-T;g[x+(u+2<<2)>>2]=J;v=c[b+300>>2]|0;U=+g[b+280>>2];if((v&128|0)==0)U=U*+g[d+4>>2];_=U*+g[d>>2];$=c[d+28>>2]|0;g[$>>2]=_*((D*B-z*O)*y+(z*M-I*B)*A+(I*O-D*M)*F);g[$+(u<<2)>>2]=_*((D*B-z*O)*K+(z*M-I*B)*S+(I*O-D*M)*T);if((v&64|0)!=0){$=c[d+32>>2]|0;g[$>>2]=+g[b+292>>2];g[$+(u<<2)>>2]=+g[b+292>>2]}I=+g[l+52>>2];O=+g[l+56>>2];M=+g[l+60>>2];z=+g[m+52>>2];D=+g[m+56>>2];B=+g[m+60>>2];if(G){_=(D-O)*F-(B-M)*A;Z=(B-M)*y-(z-I)*F;Y=(z-I)*A-(D-O)*y;g[w+(u<<1<<2)>>2]=q*_;g[w+((u<<1|1)<<2)>>2]=q*Z;g[w+((u<<1)+2<<2)>>2]=q*Y;g[x+(u<<1<<2)>>2]=p*_;g[x+((u<<1|1)<<2)>>2]=p*Z;g[x+((u<<1)+2<<2)>>2]=p*Y;Y=(D-O)*T-(B-M)*S;Z=(B-M)*K-(z-I)*T;_=(z-I)*S-(D-O)*K;g[w+(u*3<<2)>>2]=q*Y;g[w+((u*3|0)+1<<2)>>2]=q*Z;g[w+((u*3|0)+2<<2)>>2]=q*_;g[x+(u*3<<2)>>2]=p*Y;g[x+((u*3|0)+1<<2)>>2]=p*Z;g[x+((u*3|0)+2<<2)>>2]=p*_;H=c[d+8>>2]|0;g[H+(u<<1<<2)>>2]=y;g[H+((u<<1|1)<<2)>>2]=A;g[H+((u<<1)+2<<2)>>2]=F;g[H+(u*3<<2)>>2]=K;g[H+((u*3|0)+1<<2)>>2]=S;g[H+((u*3|0)+2<<2)>>2]=T;G=c[d+16>>2]|0;g[G+(u<<1<<2)>>2]=E;g[G+((u<<1|1)<<2)>>2]=L;g[G+((u<<1)+2<<2)>>2]=N;g[G+(u*3<<2)>>2]=C;g[G+((u*3|0)+1<<2)>>2]=R;g[G+((u*3|0)+2<<2)>>2]=J;L=0.0;N=0.0;R=0.0;C=0.0;E=0.0;J=0.0;D=D-O;B=B-M;z=z-I}else{z=+g[b+936>>2]-z;C=+g[b+940>>2]-D;D=+g[b+944>>2]-B;E=f*z+h*C+j*D;B=f*E;J=h*E;E=j*E;Y=+g[b+872>>2]-I;Z=+g[b+876>>2]-O;_=+g[b+880>>2]-M;F=f*Y+h*Z+j*_;y=f*F;A=h*F;F=j*F;M=+g[b+1080>>2]- +g[b+1032>>2];I=y+f*M-B;O=A+h*M-J;M=F+j*M-E;R=Y-y+q*I;L=Z-A+q*O;N=_-F+q*M;y=q*(z-B)+p*(Y-y);A=q*(C-J)+p*(Z-A);F=q*(D-E)+p*(_-F);if(y*y+A*A+F*F>1.1920928955078125e-7){_=1.0/+Q(+(y*y+A*A+F*F));y=y*_;A=_*A;F=_*F}else{y=+g[b+828>>2];A=+g[b+844>>2];F=+g[b+860>>2]}K=h*F-j*A;S=j*y-f*F;T=f*A-h*y;g[w+(u<<1<<2)>>2]=L*F-N*A;g[w+((u<<1|1)<<2)>>2]=N*y-R*F;g[w+((u<<1)+2<<2)>>2]=R*A-L*y;$=c[d+20>>2]|0;g[$+(u<<1<<2)>>2]=-((C-J-p*O)*F-(D-E-p*M)*A);g[$+((u<<1|1)<<2)>>2]=-((D-E-p*M)*y-(z-B-p*I)*F);g[$+((u<<1)+2<<2)>>2]=-((z-B-p*I)*A-(C-J-p*O)*y);U=(C-J-p*O)*T-(D-E-p*M)*S;W=(D-E-p*M)*K-(z-B-p*I)*T;_=(z-B-p*I)*S-(C-J-p*O)*K;if(o?(a[b+297>>0]|0)!=0:0){U=p*U;W=p*W;_=p*_;Z=q*(L*T-N*S);X=q*(N*K-R*T);Y=q*(R*S-L*K)}else{Z=L*T-N*S;X=N*K-R*T;Y=R*S-L*K}x=c[d+12>>2]|0;g[x+(u*3<<2)>>2]=Z;g[x+((u*3|0)+1<<2)>>2]=X;g[x+((u*3|0)+2<<2)>>2]=Y;x=c[d+20>>2]|0;g[x+(u*3<<2)>>2]=-U;g[x+((u*3|0)+1<<2)>>2]=-W;g[x+((u*3|0)+2<<2)>>2]=-_;H=c[d+8>>2]|0;g[H+(u<<1<<2)>>2]=y;g[H+((u<<1|1)<<2)>>2]=A;g[H+((u<<1)+2<<2)>>2]=F;g[H+(u*3<<2)>>2]=K;g[H+((u*3|0)+1<<2)>>2]=S;g[H+((u*3|0)+2<<2)>>2]=T;G=c[d+16>>2]|0;g[G+(u<<1<<2)>>2]=-y;g[G+((u<<1|1)<<2)>>2]=-A;g[G+((u<<1)+2<<2)>>2]=-F;g[G+(u*3<<2)>>2]=-K;g[G+((u*3|0)+1<<2)>>2]=-S;g[G+((u*3|0)+2<<2)>>2]=-T;v=c[b+300>>2]|0;C=C-J-p*O;E=D-E-p*M;J=z-B-p*I;D=0.0;B=0.0;z=0.0}I=+g[b+264>>2];if((v&32|0)==0)I=I*+g[d+4>>2];_=I*+g[d>>2];w=c[d+28>>2]|0;g[w+(u<<1<<2)>>2]=_*(r*y+s*A+t*F);g[w+(u*3<<2)>>2]=_*(r*K+s*S+t*T);if((v&16|0)!=0){$=c[d+32>>2]|0;g[$+(u<<1<<2)>>2]=+g[b+276>>2];g[$+(u*3<<2)>>2]=+g[b+276>>2]}if((a[b+296>>0]|0)==0)if((a[b+1096>>0]|0)==0)m=4;else{V=0;$=0;u=0;r=0.0;n=30}else{r=k*+g[b+1032>>2];V=1;$=(a[b+1096>>0]|0)==0;u=r>0.0?2:1;n=30}if((n|0)==30){n=c[d+24>>2]<<2;g[H+(n<<2)>>2]=f;g[H+((n|1)<<2)>>2]=h;g[H+((n|2)<<2)>>2]=j;g[G+(n<<2)>>2]=-f;g[G+((n|1)<<2)>>2]=-h;g[G+((n|2)<<2)>>2]=-j;if((a[b+49>>0]|0)!=0){if(!o){H=c[d+12>>2]|0;g[H+(n<<2)>>2]=j*L-h*N;g[H+((n|1)<<2)>>2]=f*N-j*R;g[H+((n|2)<<2)>>2]=h*R-f*L;g[x+(n<<2)>>2]=-(j*C-h*E);g[x+((n|1)<<2)>>2]=-(f*E-j*J);g[x+((n|2)<<2)>>2]=-(h*J-f*C)}}else{Y=j*D-h*B;Z=f*B-j*z;_=h*z-f*D;H=c[d+12>>2]|0;g[H+(n<<2)>>2]=q*Y;g[H+((n|1)<<2)>>2]=q*Z;g[H+((n|2)<<2)>>2]=q*_;g[x+(n<<2)>>2]=p*Y;g[x+((n|1)<<2)>>2]=p*Z;g[x+((n|2)<<2)>>2]=p*_}G=+g[b+184>>2]==+g[b+188>>2];g[w+(n<<2)>>2]=0.0;o=(c[d+36>>2]|0)+(n<<2)|0;g[o>>2]=0.0;H=(c[d+40>>2]|0)+(n<<2)|0;g[H>>2]=0.0;p=+g[((v&512|0)==0?d+4|0:b+232|0)>>2];if(!(V&G|$)){if((v&1|0)!=0)g[(c[d+32>>2]|0)+(n<<2)>>2]=+g[b+212>>2];q=+g[b+1100>>2];y=+g[b+1080>>2];z=+g[b+184>>2];t=+g[b+188>>2];s=p*+g[d>>2];a:do if(!(z>t))if(!(z==t)){if(q/s<0.0){do if(y>=z){if(!(z-q/s>y))break;s=(z-y)/(q/s);break a}while(0);s=y<z?0.0:1.0;break}if(q/s>0.0){do if(y<=t){if(!(t-q/s<y))break;s=(t-y)/(q/s);break a}while(0);s=y>t?0.0:1.0}else s=0.0}else s=0.0;else s=1.0;while(0);g[w+(n<<2)>>2]=+g[w+(n<<2)>>2]-k*s*q;g[o>>2]=+g[o>>2]- +g[b+1104>>2]*+g[d>>2];g[H>>2]=+g[b+1104>>2]*+g[d>>2]+ +g[H>>2]}if(V){g[w+(n<<2)>>2]=+g[w+(n<<2)>>2]+r*p*+g[d>>2];if((v&256|0)!=0)g[(c[d+32>>2]|0)+(n<<2)>>2]=+g[b+244>>2];do if(!G)if((u|0)==1){g[o>>2]=-3.4028234663852886e+38;g[H>>2]=0.0;break}else{g[o>>2]=0.0;g[H>>2]=3.4028234663852886e+38;break}else{g[o>>2]=-3.4028234663852886e+38;g[H>>2]=3.4028234663852886e+38}while(0);_=1.0- +g[b+240>>2];p=+P(+_);do if(!(_!=_|0.0!=0.0|_==0.0)){k=k*(f*+g[l+312>>2]+h*+g[l+316>>2]+j*+g[l+320>>2]-(f*+g[m+312>>2]+h*+g[m+316>>2]+j*+g[m+320>>2]));if((u|0)==1){if(!(k<0.0))break;if(!(+g[w+(n<<2)>>2]<-(p*k)))break;g[w+(n<<2)>>2]=-(p*k);break}else{if(!(k>0.0))break;if(!(+g[w+(n<<2)>>2]>-(p*k)))break;g[w+(n<<2)>>2]=-(p*k);break}}while(0);g[w+(n<<2)>>2]=+g[b+232>>2]*+g[w+(n<<2)>>2];m=5}else m=5}if((a[b+297>>0]|0)==0)if((a[b+1112>>0]|0)==0){i=e;return}else{n=0;o=0;l=0;k=0.0}else{k=+g[b+1088>>2];n=1;o=(a[b+1112>>0]|0)==0;l=k>0.0?1:2}m=aa(c[d+24>>2]|0,m)|0;$=c[d+12>>2]|0;g[$+(m<<2)>>2]=f;g[$+(m+1<<2)>>2]=h;g[$+(m+2<<2)>>2]=j;g[x+(m<<2)>>2]=-f;g[x+(m+1<<2)>>2]=-h;g[x+(m+2<<2)>>2]=-j;p=+g[b+192>>2];q=+g[b+196>>2];r=+g[((v&2048|0)==0?d+4|0:b+248|0)>>2];if(!(n&p==q|o)){if((v&4|0)==0){y=q;A=p}else{g[(c[d+32>>2]|0)+(m<<2)>>2]=+g[b+228>>2];y=+g[b+196>>2];A=+g[b+192>>2]}z=+g[b+1084>>2];s=+g[b+1116>>2];t=r*+g[d>>2];b:do if(!(A>y))if(!(A==y)){if(s/t<0.0){do if(z>=A){if(!(A-s/t>z))break;t=(A-z)/(s/t);break b}while(0);t=z<A?0.0:1.0;break}if(s/t>0.0){do if(z<=y){if(!(y-s/t<z))break;t=(y-z)/(s/t);break b}while(0);t=z>y?0.0:1.0}else t=0.0}else t=0.0;else t=1.0;while(0);g[w+(m<<2)>>2]=t*s;g[(c[d+36>>2]|0)+(m<<2)>>2]=-(+g[b+1120>>2]*+g[d>>2]);g[(c[d+40>>2]|0)+(m<<2)>>2]=+g[b+1120>>2]*+g[d>>2]}if(!n){i=e;return}g[w+(m<<2)>>2]=+g[w+(m<<2)>>2]+k*r*+g[d>>2];if((v&1024|0)!=0)g[(c[d+32>>2]|0)+(m<<2)>>2]=+g[b+260>>2];do if(!(p==q)){n=(c[d+36>>2]|0)+(m<<2)|0;if((l|0)==1){g[n>>2]=0.0;g[(c[d+40>>2]|0)+(m<<2)>>2]=3.4028234663852886e+38;break}else{g[n>>2]=-3.4028234663852886e+38;g[(c[d+40>>2]|0)+(m<<2)>>2]=0.0;break}}else{g[(c[d+36>>2]|0)+(m<<2)>>2]=-3.4028234663852886e+38;g[(c[d+40>>2]|0)+(m<<2)>>2]=3.4028234663852886e+38}while(0);_=1.0- +g[b+256>>2];k=+P(+_);do if(!(_!=_|0.0!=0.0|_==0.0)){V=c[b+28>>2]|0;$=c[b+32>>2]|0;f=f*+g[V+328>>2]+h*+g[V+332>>2]+j*+g[V+336>>2]-(f*+g[$+328>>2]+h*+g[$+332>>2]+j*+g[$+336>>2]);if((l|0)==1){if(!(f<0.0))break;if(!(+g[w+(m<<2)>>2]<-(k*f)))break;g[w+(m<<2)>>2]=-(k*f);break}else{if(!(f>0.0))break;if(!(+g[w+(m<<2)>>2]>-(k*f)))break;g[w+(m<<2)>>2]=-(k*f);break}}while(0);g[w+(m<<2)>>2]=+g[b+248>>2]*+g[w+(m<<2)>>2];i=e;return}function Ir(a,b,d,e){a=a|0;b=b|0;d=+d;e=e|0;var f=0;f=i;if((b|0)==2){if((e|0)<1){g[a+232>>2]=d;c[a+300>>2]=c[a+300>>2]|512;i=f;return}if((e|0)<3){g[a+264>>2]=d;c[a+300>>2]=c[a+300>>2]|32;i=f;return}if((e|0)==3){g[a+248>>2]=d;c[a+300>>2]=c[a+300>>2]|2048;i=f;return}if((e|0)>=6){i=f;return}g[a+280>>2]=d;c[a+300>>2]=c[a+300>>2]|128;i=f;return}else if((b|0)==3){if((e|0)<1){g[a+212>>2]=d;c[a+300>>2]=c[a+300>>2]|1;i=f;return}if((e|0)!=3){i=f;return}g[a+228>>2]=d;c[a+300>>2]=c[a+300>>2]|4;i=f;return}else if((b|0)==4){if((e|0)<1){g[a+244>>2]=d;c[a+300>>2]=c[a+300>>2]|256;i=f;return}if((e|0)<3){g[a+276>>2]=d;c[a+300>>2]=c[a+300>>2]|16;i=f;return}if((e|0)==3){g[a+260>>2]=d;c[a+300>>2]=c[a+300>>2]|1024;i=f;return}if((e|0)>=6){i=f;return}g[a+292>>2]=d;c[a+300>>2]=c[a+300>>2]|64;i=f;return}else{i=f;return}}function Jr(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0;d=i;do if((b|0)==2){if((c|0)<1){e=+g[a+232>>2];break}if((c|0)<3){e=+g[a+264>>2];break}if((c|0)==3){e=+g[a+248>>2];break}if((c|0)<6)e=+g[a+280>>2];else e=3.4028234663852886e+38}else if((b|0)==4){if((c|0)<1){e=+g[a+244>>2];break}if((c|0)<3){e=+g[a+276>>2];break}if((c|0)==3){e=+g[a+260>>2];break}if((c|0)<6)e=+g[a+292>>2];else e=3.4028234663852886e+38}else if((b|0)==3){if((c|0)<1){e=+g[a+212>>2];break}if((c|0)==3)e=+g[a+228>>2];else e=3.4028234663852886e+38}else e=3.4028234663852886e+38;while(0);i=d;return+e}function Kr(a){a=a|0;return}function Lr(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function Mr(a){a=a|0;return 204}function Nr(a,b,e){a=a|0;b=b|0;e=e|0;var f=0;f=i;Pr(a,b,e)|0;g[b+52>>2]=+g[a+52>>2];g[b+56>>2]=+g[a+56>>2];g[b+60>>2]=+g[a+60>>2];g[b+64>>2]=+g[a+64>>2];g[b+68>>2]=+g[a+68>>2];g[b+72>>2]=+g[a+72>>2];g[b+76>>2]=+g[a+76>>2];g[b+80>>2]=+g[a+80>>2];g[b+84>>2]=+g[a+84>>2];g[b+88>>2]=+g[a+88>>2];g[b+92>>2]=+g[a+92>>2];g[b+96>>2]=+g[a+96>>2];g[b+100>>2]=+g[a+100>>2];g[b+104>>2]=+g[a+104>>2];g[b+108>>2]=+g[a+108>>2];g[b+112>>2]=+g[a+112>>2];g[b+116>>2]=+g[a+116>>2];g[b+120>>2]=+g[a+120>>2];g[b+124>>2]=+g[a+124>>2];g[b+128>>2]=+g[a+128>>2];g[b+132>>2]=+g[a+132>>2];g[b+136>>2]=+g[a+136>>2];g[b+140>>2]=+g[a+140>>2];g[b+144>>2]=+g[a+144>>2];g[b+148>>2]=+g[a+148>>2];g[b+152>>2]=+g[a+152>>2];g[b+156>>2]=+g[a+156>>2];g[b+160>>2]=+g[a+160>>2];g[b+164>>2]=+g[a+164>>2];g[b+168>>2]=+g[a+168>>2];g[b+172>>2]=+g[a+172>>2];g[b+176>>2]=+g[a+176>>2];g[b+180>>2]=+g[a+188>>2];g[b+184>>2]=+g[a+184>>2];g[b+188>>2]=+g[a+196>>2];g[b+192>>2]=+g[a+192>>2];c[b+196>>2]=d[a+180>>0];c[b+200>>2]=d[a+49>>0];i=f;return 4352}function Or(b,d,e){b=b|0;d=d|0;e=e|0;var f=0;f=i;i=i+32|0;c[b+4>>2]=d;c[b>>2]=64;c[b+8>>2]=-1;c[b+12>>2]=-1;g[b+16>>2]=3.4028234663852886e+38;a[b+20>>0]=1;a[b+21>>0]=0;c[b+24>>2]=-1;c[b+28>>2]=e;if((a[5024]|0)==0?(Ya(5024)|0)!=0:0){c[f+16>>2]=0;c[f+20>>2]=0;c[f+24>>2]=0;c[f+28>>2]=0;br(4408,0.0,0,0,f+16|0);bb(5024)}c[f+0>>2]=0;c[f+4>>2]=0;c[f+8>>2]=0;c[f+12>>2]=0;cr(4408,0.0,f);c[b+32>>2]=4408;g[b+36>>2]=0.0;g[b+40>>2]=.30000001192092896;c[b+44>>2]=0;i=f;return}function Pr(a,b,e){a=a|0;b=b|0;e=e|0;var f=0,h=0,j=0;f=i;c[b>>2]=gc[c[(c[e>>2]|0)+28>>2]&31](e,c[a+28>>2]|0)|0;c[b+4>>2]=gc[c[(c[e>>2]|0)+28>>2]&31](e,c[a+32>>2]|0)|0;h=gc[c[(c[e>>2]|0)+40>>2]&31](e,a)|0;j=gc[c[(c[e>>2]|0)+28>>2]&31](e,h)|0;c[b+8>>2]=j;if((j|0)!=0)Nb[c[(c[e>>2]|0)+48>>2]&127](e,h);c[b+12>>2]=c[a+4>>2];c[b+24>>2]=d[a+21>>0];c[b+40>>2]=c[a+24>>2];g[b+44>>2]=+g[a+16>>2];c[b+48>>2]=d[a+20>>0];c[b+20>>2]=c[a+12>>2];c[b+16>>2]=c[a+8>>2];g[b+28>>2]=+g[a+36>>2];g[b+32>>2]=+g[a+40>>2];c[b+36>>2]=0;h=c[a+28>>2]|0;if((c[h+488>>2]|0)>0){e=0;do{if((c[(c[h+496>>2]|0)+(e<<2)>>2]|0)==(a|0)){c[b+36>>2]=1;h=c[a+28>>2]|0}e=e+1|0}while((e|0)<(c[h+488>>2]|0))}h=c[a+32>>2]|0;if((c[h+488>>2]|0)>0)e=0;else{i=f;return 4376}do{if((c[(c[h+496>>2]|0)+(e<<2)>>2]|0)==(a|0)){c[b+36>>2]=1;h=c[a+32>>2]|0}e=e+1|0}while((e|0)<(c[h+488>>2]|0));i=f;return 4376}function Qr(d,f,h,j,k,l){d=d|0;f=f|0;h=h|0;j=j|0;k=k|0;l=l|0;var m=0,n=0,o=0.0,p=0.0,q=0.0;m=i;c[d>>2]=5216;b[d+4>>1]=-2;b[d+6>>1]=-1;c[d+92>>2]=k;c[d+96>>2]=0;a[d+100>>0]=0;c[d+104>>2]=0;c[d+108>>2]=0;if((k|0)==0){c[5004]=(c[5004]|0)+1;k=XE(95)|0;if((k|0)!=0?(c[(k+19&-16)+ -4>>2]=k,(k+19&-16|0)!=0):0){Oz(k+19&-16);k=k+19&-16}else k=0;c[d+92>>2]=k;a[d+100>>0]=1}if(!l){c[5004]=(c[5004]|0)+1;l=XE(43)|0;if((l|0)!=0?(n=l+19&-16,c[n+ -4>>2]=l,(l+19&-16|0)!=0):0){c[n+0>>2]=0;c[n+4>>2]=0;c[n+8>>2]=0;c[n+12>>2]=0;c[n+16>>2]=0;c[n+20>>2]=0;c[(l+19&-16)>>2]=5280;a[n+20>>0]=1;c[n+16>>2]=0;c[n+8>>2]=0;c[n+12>>2]=0;n=l+19&-16}else n=0;c[d+112>>2]=n;c[5004]=(c[5004]|0)+1;n=XE(215)|0;if((n|0)!=0?(c[(n+19&-16)+ -4>>2]=n,(n+19&-16|0)!=0):0){Px(n+19&-16,c[d+112>>2]|0);n=n+19&-16}else n=0;c[d+108>>2]=n;a[n+193>>0]=1}c[d+8>>2]=c[f+0>>2];c[d+12>>2]=c[f+4>>2];c[d+16>>2]=c[f+8>>2];c[d+20>>2]=c[f+12>>2];c[d+24>>2]=c[h+0>>2];c[d+28>>2]=c[h+4>>2];c[d+32>>2]=c[h+8>>2];c[d+36>>2]=c[h+12>>2];q=+(e[d+6>>1]|0);p=q/(+g[d+28>>2]- +g[d+12>>2]);o=q/(+g[d+32>>2]- +g[d+16>>2]);g[d+40>>2]=q/(+g[d+24>>2]- +g[d+8>>2]);g[d+44>>2]=p;g[d+48>>2]=o;g[d+52>>2]=0.0;f=(j&65535)+1&65535;c[5004]=(c[5004]|0)+1;h=XE(f<<6|19)|0;if((h|0)==0)h=0;else{c[(h+19&-16)+ -4>>2]=h;h=h+19&-16}if((f|0)!=0){n=h+(f<<6)|0;l=h;do{c[l>>2]=0;c[l+8>>2]=0;l=l+64|0}while((l|0)!=(n|0))}c[d+60>>2]=h;b[d+58>>1]=(j&65535)+1;b[d+56>>1]=0;b[d+64>>1]=1;if(f>>>0>1){j=1;n=1;do{b[h+(j<<6)+48>>1]=j+1;n=n+1<<16>>16;j=n&65535}while(j>>>0<f>>>0)}b[h+(f+ -1<<6)+48>>1]=0;c[5004]=(c[5004]|0)+1;j=XE((f<<3|3)+16|0)|0;if((j|0)!=0){c[(j+19&-16)+ -4>>2]=j;c[d+80>>2]=j+19&-16;if((j+19&-16|0)==0)j=0;else j=j+19&-16}else{c[d+80>>2]=0;j=0}c[d+68>>2]=j;c[5004]=(c[5004]|0)+1;j=XE((f<<3|3)+16|0)|0;if((j|0)!=0){c[(j+19&-16)+ -4>>2]=j;c[d+84>>2]=j+19&-16;if((j+19&-16|0)==0)j=0;else j=j+19&-16}else{c[d+84>>2]=0;j=0}c[d+72>>2]=j;c[5004]=(c[5004]|0)+1;j=XE((f<<3|3)+16|0)|0;if((j|0)!=0){c[(j+19&-16)+ -4>>2]=j;c[d+88>>2]=j+19&-16;if((j+19&-16|0)==0)j=0;else j=j+19&-16}else{c[d+88>>2]=0;j=0}c[d+76>>2]=j;c[c[d+60>>2]>>2]=0;k=c[d+60>>2]|0;b[k+48>>1]=0;b[k+54>>1]=1;l=c[d+68>>2]|0;b[l>>1]=0;b[l+2>>1]=0;b[l+4>>1]=b[d+6>>1]|0;b[l+6>>1]=0;b[k+50>>1]=0;b[k+56>>1]=1;l=c[d+72>>2]|0;b[l>>1]=0;b[l+2>>1]=0;b[l+4>>1]=b[d+6>>1]|0;b[l+6>>1]=0;b[k+52>>1]=0;b[k+58>>1]=1;k=c[d+76>>2]|0;b[k>>1]=0;b[k+2>>1]=0;b[k+4>>1]=b[d+6>>1]|0;b[k+6>>1]=0;c[d>>2]=5040;i=m;return}function Rr(a){a=a|0;var b=0;b=i;is(a);i=b;return}function Sr(a){a=a|0;var b=0;b=i;is(a);if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function Tr(a,d,f,h,j,k,l,m,n){a=a|0;d=d|0;f=f|0;h=h|0;j=j|0;k=k|0;l=l|0;m=m|0;n=n|0;var o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0;o=i;i=i+16|0;fs(a,o+6|0,+g[d>>2],+g[d+4>>2],+g[d+8>>2],0);fs(a,o,+g[f>>2],+g[f+4>>2],+g[f+8>>2],1);p=b[a+64>>1]|0;q=c[a+60>>2]|0;b[a+64>>1]=b[q+((p&65535)<<6)+48>>1]|0;b[a+56>>1]=(b[a+56>>1]|0)+1<<16>>16;c[q+((p&65535)<<6)+12>>2]=p&65535;c[q+((p&65535)<<6)>>2]=j;b[q+((p&65535)<<6)+4>>1]=k;b[q+((p&65535)<<6)+6>>1]=l;c[q+((p&65535)<<6)+8>>2]=n;u=(e[a+56>>1]|0)<<1;v=(u&65534)+ -1|0;s=(c[a+60>>2]|0)+54|0;b[s>>1]=(e[s>>1]|0)+2;s=c[a+68>>2]|0;r=e[s+(v<<2)>>1]|e[s+(v<<2)+2>>1]<<16;b[s+((u&65534|1)<<2)>>1]=r;b[s+((u&65534|1)<<2)+2>>1]=r>>>16;s=c[a+68>>2]|0;b[s+(v<<2)>>1]=b[o+6>>1]|0;b[s+(v<<2)+2>>1]=p;b[s+((u&65534)<<2)>>1]=b[o>>1]|0;b[s+((u&65534)<<2)+2>>1]=p;b[q+((p&65535)<<6)+48>>1]=v;b[q+((p&65535)<<6)+54>>1]=u;s=(c[a+60>>2]|0)+56|0;b[s>>1]=(e[s>>1]|0)+2;s=c[a+72>>2]|0;r=e[s+(v<<2)>>1]|e[s+(v<<2)+2>>1]<<16;b[s+((u&65534|1)<<2)>>1]=r;b[s+((u&65534|1)<<2)+2>>1]=r>>>16;s=c[a+72>>2]|0;b[s+(v<<2)>>1]=b[o+8>>1]|0;b[s+(v<<2)+2>>1]=p;b[s+((u&65534)<<2)>>1]=b[o+2>>1]|0;b[s+((u&65534)<<2)+2>>1]=p;b[q+((p&65535)<<6)+50>>1]=v;b[q+((p&65535)<<6)+56>>1]=u;s=(c[a+60>>2]|0)+58|0;b[s>>1]=(e[s>>1]|0)+2;s=c[a+76>>2]|0;r=e[s+(v<<2)>>1]|e[s+(v<<2)+2>>1]<<16;b[s+((u&65534|1)<<2)>>1]=r;b[s+((u&65534|1)<<2)+2>>1]=r>>>16;s=c[a+76>>2]|0;b[s+(v<<2)>>1]=b[o+10>>1]|0;b[s+(v<<2)+2>>1]=p;b[s+((u&65534)<<2)>>1]=b[o+4>>1]|0;b[s+((u&65534)<<2)+2>>1]=p;b[q+((p&65535)<<6)+52>>1]=v;b[q+((p&65535)<<6)+58>>1]=u;u=c[a+68>>2]|0;v=e[q+((p&65535)<<6)+48>>1]|0;s=c[a+60>>2]|0;r=b[u+(v+ -1<<2)>>1]|0;if((e[u+(v<<2)>>1]|0)<(r&65535)){n=s+((e[u+(v<<2)+2>>1]|0)<<6)+48|0;t=u+(v<<2)|0;u=u+(v+ -1<<2)|0;while(1){v=e[u+2>>1]|0;if((r&1)==0){v=s+(v<<6)+48|0;b[v>>1]=(b[v>>1]|0)+1<<16>>16}else{v=s+(v<<6)+54|0;b[v>>1]=(b[v>>1]|0)+1<<16>>16}b[n>>1]=(b[n>>1]|0)+ -1<<16>>16;r=e[t>>1]|e[t+2>>1]<<16;v=e[u>>1]|e[u+2>>1]<<16;b[t>>1]=v;b[t+2>>1]=v>>>16;b[u>>1]=r;b[u+2>>1]=r>>>16;t=t+ -4|0;u=u+ -4|0;r=b[u>>1]|0;if(!((e[t>>1]|0)<(r&65535)))break;s=c[a+60>>2]|0}n=c[a+68>>2]|0}else n=u;r=e[q+((p&65535)<<6)+54>>1]|0;u=n+(r<<2)|0;t=n+(r+ -1<<2)|0;s=b[t>>1]|0;a:do if((e[u>>1]|0)<(s&65535)){v=c[a+60>>2]|0;n=v+((e[n+(r<<2)+2>>1]|0)<<6)+54|0;r=v;while(1){v=e[t+2>>1]|0;if((s&1)==0){v=r+(v<<6)+48|0;b[v>>1]=(b[v>>1]|0)+1<<16>>16}else{v=r+(v<<6)+54|0;b[v>>1]=(b[v>>1]|0)+1<<16>>16}b[n>>1]=(b[n>>1]|0)+ -1<<16>>16;s=e[u>>1]|e[u+2>>1]<<16;v=e[t>>1]|e[t+2>>1]<<16;b[u>>1]=v;b[u+2>>1]=v>>>16;b[t>>1]=s;b[t+2>>1]=s>>>16;u=u+ -4|0;t=t+ -4|0;s=b[t>>1]|0;if(!((e[u>>1]|0)<(s&65535)))break a;r=c[a+60>>2]|0}}while(0);v=c[a+72>>2]|0;u=e[q+((p&65535)<<6)+50>>1]|0;s=c[a+60>>2]|0;r=b[v+(u+ -1<<2)>>1]|0;if((e[v+(u<<2)>>1]|0)<(r&65535)){n=s+((e[v+(u<<2)+2>>1]|0)<<6)+50|0;t=v+(u<<2)|0;u=v+(u+ -1<<2)|0;while(1){v=e[u+2>>1]|0;if((r&1)==0){v=s+(v<<6)+50|0;b[v>>1]=(b[v>>1]|0)+1<<16>>16}else{v=s+(v<<6)+56|0;b[v>>1]=(b[v>>1]|0)+1<<16>>16}b[n>>1]=(b[n>>1]|0)+ -1<<16>>16;r=e[t>>1]|e[t+2>>1]<<16;v=e[u>>1]|e[u+2>>1]<<16;b[t>>1]=v;b[t+2>>1]=v>>>16;b[u>>1]=r;b[u+2>>1]=r>>>16;t=t+ -4|0;u=u+ -4|0;r=b[u>>1]|0;if(!((e[t>>1]|0)<(r&65535)))break;s=c[a+60>>2]|0}v=c[a+72>>2]|0}n=e[q+((p&65535)<<6)+56>>1]|0;u=v+(n<<2)|0;t=v+(n+ -1<<2)|0;r=b[t>>1]|0;b:do if((e[u>>1]|0)<(r&65535)){s=c[a+60>>2]|0;n=s+((e[v+(n<<2)+2>>1]|0)<<6)+56|0;while(1){v=e[t+2>>1]|0;if((r&1)==0){v=s+(v<<6)+50|0;b[v>>1]=(b[v>>1]|0)+1<<16>>16}else{v=s+(v<<6)+56|0;b[v>>1]=(b[v>>1]|0)+1<<16>>16}b[n>>1]=(b[n>>1]|0)+ -1<<16>>16;r=e[u>>1]|e[u+2>>1]<<16;v=e[t>>1]|e[t+2>>1]<<16;b[u>>1]=v;b[u+2>>1]=v>>>16;b[t>>1]=r;b[t+2>>1]=r>>>16;u=u+ -4|0;t=t+ -4|0;r=b[t>>1]|0;if(!((e[u>>1]|0)<(r&65535)))break b;s=c[a+60>>2]|0}}while(0);gs(a,2,b[q+((p&65535)<<6)+52>>1]|0);hs(a,2,b[q+((p&65535)<<6)+58>>1]|0,m);q=c[a+60>>2]|0;a=c[a+108>>2]|0;if((a|0)==0){v=q+((p&65535)<<6)|0;i=o;return v|0}c[q+((p&65535)<<6)+60>>2]=pc[c[(c[a>>2]|0)+8>>2]&3](a,d,f,h,j,k,l,m,0)|0;v=q+((p&65535)<<6)|0;i=o;return v|0}function Ur(a,d,f){a=a|0;d=d|0;f=f|0;var g=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0;g=i;h=c[a+108>>2]|0;if((h|0)!=0)rc[c[(c[h>>2]|0)+12>>2]&127](h,c[d+60>>2]|0,f);h=c[d+12>>2]|0;d=c[a+60>>2]|0;r=c[a+92>>2]|0;if(!(Pb[c[(c[r>>2]|0)+56>>2]&127](r)|0)){r=c[a+92>>2]|0;rc[c[(c[r>>2]|0)+16>>2]&127](r,d+((h&65535)<<6)|0,f)}f=e[a+56>>1]|0;j=c[a+60>>2]|0;b[j+54>>1]=(e[j+54>>1]|0)+65534;b[j+56>>1]=(e[j+56>>1]|0)+65534;b[j+58>>1]=(e[j+58>>1]|0)+65534;j=0;do{l=a+(j<<2)+68|0;k=c[l>>2]|0;o=e[d+((h&65535)<<6)+(j<<1)+54>>1]|0;b[k+(o<<2)>>1]=b[a+6>>1]|0;p=b[k+(o+1<<2)+2>>1]|0;if(p<<16>>16==0)o=k;else{m=(c[a+60>>2]|0)+((e[k+(o<<2)+2>>1]|0)<<6)+(j<<1)+54|0;n=k+(o<<2)|0;o=k+(o+1<<2)|0;while(1){r=b[o>>1]|0;if((e[n>>1]|0)<(r&65535))break;q=c[a+60>>2]|0;p=p&65535;if((r&1)==0){r=q+(p<<6)+(j<<1)+48|0;b[r>>1]=(b[r>>1]|0)+ -1<<16>>16}else{r=q+(p<<6)+(j<<1)+54|0;b[r>>1]=(b[r>>1]|0)+ -1<<16>>16}b[m>>1]=(b[m>>1]|0)+1<<16>>16;p=e[n>>1]|e[n+2>>1]<<16;r=e[o>>1]|e[o+2>>1]<<16;b[n>>1]=r;b[n+2>>1]=r>>>16;b[o>>1]=p;b[o+2>>1]=p>>>16;p=b[o+6>>1]|0;if(p<<16>>16==0)break;else{n=n+4|0;o=o+4|0}}o=c[l>>2]|0}p=e[d+((h&65535)<<6)+(j<<1)+48>>1]|0;b[k+(p<<2)>>1]=b[a+6>>1]|0;n=b[o+(p+1<<2)+2>>1]|0;a:do if(!(n<<16>>16==0)){l=(c[a+60>>2]|0)+((e[o+(p<<2)+2>>1]|0)<<6)+(j<<1)+48|0;m=o+(p<<2)|0;o=o+(p+1<<2)|0;while(1){p=b[o>>1]|0;if((e[m>>1]|0)<(p&65535))break a;q=c[a+60>>2]|0;n=n&65535;if((p&1)==0){r=q+(n<<6)+(j<<1)+48|0;b[r>>1]=(b[r>>1]|0)+ -1<<16>>16}else{r=q+(n<<6)+(j<<1)+54|0;b[r>>1]=(b[r>>1]|0)+ -1<<16>>16}b[l>>1]=(b[l>>1]|0)+1<<16>>16;n=e[m>>1]|e[m+2>>1]<<16;r=e[o>>1]|e[o+2>>1]<<16;b[m>>1]=r;b[m+2>>1]=r>>>16;b[o>>1]=n;b[o+2>>1]=n>>>16;n=b[o+6>>1]|0;if(n<<16>>16==0)break;else{m=m+4|0;o=o+4|0}}}while(0);b[k+((f<<1)+ -1<<2)+2>>1]=0;b[k+((f<<1)+ -1<<2)>>1]=b[a+6>>1]|0;j=j+1|0}while((j|0)!=3);b[(c[a+60>>2]|0)+((h&65535)<<6)+48>>1]=b[a+64>>1]|0;b[a+64>>1]=h;b[a+56>>1]=(b[a+56>>1]|0)+ -1<<16>>16;i=g;return}function Vr(a,d,f,h,j){a=a|0;d=d|0;f=f|0;h=h|0;j=j|0;var k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0,G=0,H=0,I=0;k=i;i=i+16|0;c[d+16>>2]=c[f+0>>2];c[d+20>>2]=c[f+4>>2];c[d+24>>2]=c[f+8>>2];c[d+28>>2]=c[f+12>>2];c[d+32>>2]=c[h+0>>2];c[d+36>>2]=c[h+4>>2];c[d+40>>2]=c[h+8>>2];c[d+44>>2]=c[h+12>>2];q=c[a+60>>2]|0;r=c[d+12>>2]&65535;fs(a,k+6|0,+g[f>>2],+g[f+4>>2],+g[f+8>>2],0);fs(a,k,+g[h>>2],+g[h+4>>2],+g[h+8>>2],1);y=0;do{z=b[q+(r<<6)+(y<<1)+48>>1]|0;w=b[q+(r<<6)+(y<<1)+54>>1]|0;F=b[k+6+(y<<1)>>1]|0;A=a+(y<<2)+68|0;I=c[A>>2]|0;H=(F&65535)-(e[I+((z&65535)<<2)>>1]|0)|0;G=b[k+(y<<1)>>1]|0;x=(G&65535)-(e[I+((w&65535)<<2)>>1]|0)|0;b[I+((z&65535)<<2)>>1]=F;b[I+((w&65535)<<2)>>1]=G;if((H|0)<0)gs(a,y,z);a:do if((x|0)>0?(v=c[A>>2]|0,s=c[a+60>>2]|0,t=e[v+((w&65535)<<2)+2>>1]|0,u=b[v+((w&65535)+1<<2)+2>>1]|0,!(u<<16>>16==0)):0){B=1<<y&3;C=s+(t<<6)+(y<<1)+54|0;I=u;D=v+((w&65535)<<2)|0;E=v+((w&65535)+1<<2)|0;while(1){F=b[E>>1]|0;if((e[D>>1]|0)<(F&65535))break a;G=c[a+60>>2]|0;I=I&65535;if((F&1)==0){if(((((e[s+(t<<6)+(B<<1)+54>>1]|0)>=(e[G+(I<<6)+(B<<1)+48>>1]|0)?(e[G+(I<<6)+(B<<1)+54>>1]|0)>=(e[s+(t<<6)+(B<<1)+48>>1]|0):0)?(e[s+(t<<6)+((1<<B&3)<<1)+54>>1]|0)>=(e[G+(I<<6)+((1<<B&3)<<1)+48>>1]|0):0)?(e[G+(I<<6)+((1<<B&3)<<1)+54>>1]|0)>=(e[s+(t<<6)+((1<<B&3)<<1)+48>>1]|0):0)?(m=c[a+92>>2]|0,n=G+((e[D+2>>1]|0)<<6)|0,Yb[c[(c[m>>2]|0)+8>>2]&31](m,n,G+(I<<6)|0)|0,m=c[a+96>>2]|0,(m|0)!=0):0)Yb[c[(c[m>>2]|0)+8>>2]&31](m,n,G+(I<<6)|0)|0;I=G+(I<<6)+(y<<1)+48|0;b[I>>1]=(b[I>>1]|0)+ -1<<16>>16}else{I=G+(I<<6)+(y<<1)+54|0;b[I>>1]=(b[I>>1]|0)+ -1<<16>>16}b[C>>1]=(b[C>>1]|0)+1<<16>>16;I=e[D>>1]|e[D+2>>1]<<16;G=e[E>>1]|e[E+2>>1]<<16;b[D>>1]=G;b[D+2>>1]=G>>>16;b[E>>1]=I;b[E+2>>1]=I>>>16;I=b[E+6>>1]|0;if(I<<16>>16==0)break;else{D=D+4|0;E=E+4|0}}}while(0);b:do if((H|0)>0?(o=c[A>>2]|0,p=b[o+((z&65535)+1<<2)+2>>1]|0,!(p<<16>>16==0)):0){B=(c[a+60>>2]|0)+((e[o+((z&65535)<<2)+2>>1]|0)<<6)+(y<<1)+48|0;C=1<<y&3;E=p;A=o+((z&65535)<<2)|0;z=o+((z&65535)+1<<2)|0;while(1){F=b[z>>1]|0;if((e[A>>1]|0)<(F&65535))break b;D=c[a+60>>2]|0;E=E&65535;if((F&1)==0){I=D+(E<<6)+(y<<1)+48|0;b[I>>1]=(b[I>>1]|0)+ -1<<16>>16}else{F=e[A+2>>1]|0;if(((((e[D+(F<<6)+(C<<1)+54>>1]|0)>=(e[D+(E<<6)+(C<<1)+48>>1]|0)?(e[D+(E<<6)+(C<<1)+54>>1]|0)>=(e[D+(F<<6)+(C<<1)+48>>1]|0):0)?(e[D+(F<<6)+((1<<C&3)<<1)+54>>1]|0)>=(e[D+(E<<6)+((1<<C&3)<<1)+48>>1]|0):0)?(e[D+(E<<6)+((1<<C&3)<<1)+54>>1]|0)>=(e[D+(F<<6)+((1<<C&3)<<1)+48>>1]|0):0)?(l=c[a+92>>2]|0,Tb[c[(c[l>>2]|0)+12>>2]&31](l,D+(F<<6)|0,D+(E<<6)|0,j)|0,l=c[a+96>>2]|0,(l|0)!=0):0)Tb[c[(c[l>>2]|0)+12>>2]&31](l,D+(F<<6)|0,D+(E<<6)|0,j)|0;I=D+(E<<6)+(y<<1)+54|0;b[I>>1]=(b[I>>1]|0)+ -1<<16>>16}b[B>>1]=(b[B>>1]|0)+1<<16>>16;E=e[A>>1]|e[A+2>>1]<<16;I=e[z>>1]|e[z+2>>1]<<16;b[A>>1]=I;b[A+2>>1]=I>>>16;b[z>>1]=E;b[z+2>>1]=E>>>16;E=b[z+6>>1]|0;if(E<<16>>16==0)break;else{A=A+4|0;z=z+4|0}}}while(0);if((x|0)<0)hs(a,y,w,j);y=y+1|0}while((y|0)!=3);l=c[a+108>>2]|0;if((l|0)==0){i=k;return}Jb[c[(c[l>>2]|0)+16>>2]&31](l,c[d+60>>2]|0,f,h,j);i=k;return}function Wr(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;a=i;c[d+0>>2]=c[b+16>>2];c[d+4>>2]=c[b+20>>2];c[d+8>>2]=c[b+24>>2];c[d+12>>2]=c[b+28>>2];c[e+0>>2]=c[b+32>>2];c[e+4>>2]=c[b+36>>2];c[e+8>>2]=c[b+40>>2];c[e+12>>2]=c[b+44>>2];i=a;return}function Xr(a,d,f,g,h,j){a=a|0;d=d|0;f=f|0;g=g|0;h=h|0;j=j|0;var k=0,l=0;k=i;l=c[a+108>>2]|0;if((l|0)!=0){Zb[c[(c[l>>2]|0)+24>>2]&7](l,d,f,g,h,j);i=k;return}l=b[a+56>>1]|0;if(!((l&65535)<<1>>>0>1)){i=k;return}h=1;j=2;while(1){f=c[a+68>>2]|0;if(!((b[f+(h<<2)>>1]&1)==0)){gc[c[(c[g>>2]|0)+8>>2]&31](g,(c[a+60>>2]|0)+((e[f+(h<<2)+2>>1]|0)<<6)|0)|0;l=b[a+56>>1]|0}h=j&65535;if(!(h>>>0<((l&65535)<<1|1)>>>0))break;j=j+1<<16>>16}i=k;return}function Yr(a,d,f,h){a=a|0;d=d|0;f=f|0;h=h|0;var j=0,k=0,l=0,m=0,n=0,o=0;j=i;k=c[a+108>>2]|0;if((k|0)!=0){vc[c[(c[k>>2]|0)+28>>2]&127](k,d,f,h);i=j;return}m=b[a+56>>1]|0;if(!((m&65535)<<1>>>0>1)){i=j;return}n=1;k=2;while(1){o=c[a+68>>2]|0;if(!((b[o+(n<<2)>>1]&1)==0)){l=c[a+60>>2]|0;n=e[o+(n<<2)+2>>1]|0;if(!(+g[d>>2]>+g[l+(n<<6)+32>>2])?!(+g[f>>2]<+g[l+(n<<6)+16>>2]):0)o=1;else o=0;if(!(!(+g[d+8>>2]>+g[l+(n<<6)+40>>2])?!(+g[f+8>>2]<+g[l+(n<<6)+24>>2]):0))o=0;if(!(+g[d+4>>2]>+g[l+(n<<6)+36>>2])?!(+g[f+4>>2]<+g[l+(n<<6)+20>>2]|o^1):0){gc[c[(c[h>>2]|0)+8>>2]&31](h,l+(n<<6)|0)|0;m=b[a+56>>1]|0}}n=k&65535;if(!(n>>>0<((m&65535)<<1|1)>>>0))break;k=k+1<<16>>16}i=j;return}function Zr(a,b){a=a|0;b=b|0;var d=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0;f=i;i=i+32|0;r=c[a+92>>2]|0;if(!(Pb[c[(c[r>>2]|0)+56>>2]&127](r)|0)){i=f;return}d=c[a+92>>2]|0;d=Pb[c[(c[d>>2]|0)+28>>2]&127](d)|0;g=c[d+4>>2]|0;if((g|0)>1){es(d,0,g+ -1|0);g=c[d+4>>2]|0}o=g-(c[a+104>>2]|0)|0;c[f+16>>2]=0;c[f+20>>2]=0;c[f+24>>2]=0;c[f+28>>2]=0;ds(d,o,f+16|0);c[a+104>>2]=0;o=c[d+4>>2]|0;if((o|0)>0){h=0;p=0;m=0;g=0;while(1){j=c[d+12>>2]|0;k=j+(g<<4)|0;n=c[k>>2]|0;j=j+(g<<4)+4|0;l=c[j>>2]|0;if((n|0)==(h|0))if((l|0)==(p|0)){l=p;n=h;h=12}else{n=h;h=8}else h=8;a:do if((h|0)==8){h=0;q=n+54|0;r=n+48|0;p=0;do{if((e[q+(p<<1)>>1]|0)<(e[l+48+(p<<1)>>1]|0)){h=12;break a}if((e[l+54+(p<<1)>>1]|0)<(e[r+(p<<1)>>1]|0)){h=12;break a}p=p+1|0}while((p|0)<3)}while(0);if((h|0)==12){m=c[a+92>>2]|0;rc[c[(c[m>>2]|0)+32>>2]&127](m,k,b);c[k>>2]=0;c[j>>2]=0;m=(c[a+104>>2]|0)+1|0;c[a+104>>2]=m;c[3808]=(c[3808]|0)+ -1;o=c[d+4>>2]|0}g=g+1|0;if((g|0)>=(o|0))break;else{h=n;p=l}}if((o|0)>1){es(d,0,o+ -1|0);m=c[a+104>>2]|0;o=c[d+4>>2]|0}}else m=0;r=o-m|0;c[f+0>>2]=0;c[f+4>>2]=0;c[f+8>>2]=0;c[f+12>>2]=0;ds(d,r,f);c[a+104>>2]=0;i=f;return}function _r(a){a=a|0;return c[a+92>>2]|0}function $r(a){a=a|0;return c[a+92>>2]|0}function as(a,b,d){a=a|0;b=b|0;d=d|0;var e=0;e=i;c[b+0>>2]=c[a+8>>2];c[b+4>>2]=c[a+12>>2];c[b+8>>2]=c[a+16>>2];c[b+12>>2]=c[a+20>>2];c[d+0>>2]=c[a+24>>2];c[d+4>>2]=c[a+28>>2];c[d+8>>2]=c[a+32>>2];c[d+12>>2]=c[a+36>>2];i=e;return}function bs(a,d){a=a|0;d=d|0;var e=0,f=0,g=0;d=i;if((b[a+56>>1]|0)!=0){i=d;return}b[a+64>>1]=1;f=b[a+58>>1]|0;e=c[a+60>>2]|0;if((f&65535)>1){f=1;g=1;while(1){b[e+(f<<6)+48>>1]=f+1;g=g+1<<16>>16;f=b[a+58>>1]|0;if((g&65535)<(f&65535))f=g&65535;else break}}b[e+((f&65535)+ -1<<6)+48>>1]=0;i=d;return}function cs(a){a=a|0;return}function ds(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,k=0,l=0;f=i;g=c[b+4>>2]|0;if(!((g|0)<=(d|0)&(g|0)<(d|0))){c[b+4>>2]=d;i=f;return}if((c[b+8>>2]|0)<(d|0)){if((d|0)==0){h=0;j=g}else{c[5004]=(c[5004]|0)+1;h=XE((d<<4|3)+16|0)|0;if((h|0)==0)h=0;else{c[(h+19&-16)+ -4>>2]=h;h=h+19&-16}j=c[b+4>>2]|0}if((j|0)>0){k=0;do{l=c[b+12>>2]|0;c[h+(k<<4)>>2]=c[l+(k<<4)>>2];c[h+(k<<4)+4>>2]=c[l+(k<<4)+4>>2];c[h+(k<<4)+8>>2]=c[l+(k<<4)+8>>2];c[h+(k<<4)+12>>2]=c[l+(k<<4)+12>>2];k=k+1|0}while((k|0)!=(j|0))}j=c[b+12>>2]|0;if((j|0)!=0){if((a[b+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0)}c[b+12>>2]=0}a[b+16>>0]=1;c[b+12>>2]=h;c[b+8>>2]=d;h=b+12|0}else h=b+12|0;do{l=c[h>>2]|0;c[l+(g<<4)>>2]=c[e>>2];c[l+(g<<4)+4>>2]=c[e+4>>2];c[l+(g<<4)+8>>2]=c[e+8>>2];c[l+(g<<4)+12>>2]=c[e+12>>2];g=g+1|0}while((g|0)!=(d|0));c[b+4>>2]=d;i=f;return}function es(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0;e=i;while(1){j=(b+d|0)/2|0;g=c[a+12>>2]|0;h=c[g+(j<<4)>>2]|0;f=c[g+(j<<4)+4>>2]|0;j=c[g+(j<<4)+8>>2]|0;k=b;o=d;while(1){a:while(1){m=c[g+(k<<4)>>2]|0;if((m|0)==0)q=-1;else q=c[m+12>>2]|0;if((h|0)==0)n=-1;else n=c[h+12>>2]|0;l=c[g+(k<<4)+4>>2]|0;if((l|0)==0)r=-1;else r=c[l+12>>2]|0;if((f|0)==0)p=-1;else p=c[f+12>>2]|0;do if((q|0)<=(n|0)){n=(m|0)==(h|0)&(r|0)>(p|0);if(n|(m|0)==(h|0)^1)if(n)break;else break a;if((l|0)!=(f|0))break a;if(!((c[g+(k<<4)+8>>2]|0)>>>0>j>>>0))break a}while(0);k=k+1|0}b:do if((h|0)==0)while(1){p=c[g+(o<<4)>>2]|0;if((p|0)==0)r=-1;else r=c[p+12>>2]|0;if((f|0)==0)s=-1;else s=c[f+12>>2]|0;n=c[g+(o<<4)+4>>2]|0;if((n|0)==0)q=-1;else q=c[n+12>>2]|0;do if(!((r|0)<-1)){q=(p|0)==0&(s|0)>(q|0);if(q|(p|0)==0^1)if(q)break;else break b;if((f|0)!=(n|0))break b;if(!(j>>>0>(c[g+(o<<4)+8>>2]|0)>>>0))break b}while(0);o=o+ -1|0}else{n=c[h+12>>2]|0;q=o;while(1){p=c[g+(q<<4)>>2]|0;if((p|0)==0)t=-1;else t=c[p+12>>2]|0;if((f|0)==0)r=-1;else r=c[f+12>>2]|0;o=c[g+(q<<4)+4>>2]|0;if((o|0)==0)s=-1;else s=c[o+12>>2]|0;do if((n|0)<=(t|0)){r=(h|0)==(p|0)&(r|0)>(s|0);if(r|(h|0)==(p|0)^1)if(r)break;else{o=q;break b}if((f|0)!=(o|0)){o=q;break b}if(!(j>>>0>(c[g+(q<<4)+8>>2]|0)>>>0)){o=q;break b}}while(0);q=q+ -1|0}}while(0);if((k|0)<=(o|0)){t=g+(k<<4)|0;r=c[g+(k<<4)+8>>2]|0;s=c[g+(k<<4)+12>>2]|0;q=g+(o<<4)|0;c[t+0>>2]=c[q+0>>2];c[t+4>>2]=c[q+4>>2];c[t+8>>2]=c[q+8>>2];c[t+12>>2]=c[q+12>>2];t=c[a+12>>2]|0;c[t+(o<<4)>>2]=m;c[t+(o<<4)+4>>2]=l;c[t+(o<<4)+8>>2]=r;c[t+(o<<4)+12>>2]=s;k=k+1|0;o=o+ -1|0}if((k|0)>(o|0))break;g=c[a+12>>2]|0}if((o|0)>(b|0))es(a,b,o);if((k|0)<(d|0))b=k;else break}i=e;return}function fs(a,c,d,e,f,h){a=a|0;c=c|0;d=+d;e=+e;f=+f;h=h|0;var j=0,k=0;j=i;d=(d- +g[a+8>>2])*+g[a+40>>2];e=(e- +g[a+12>>2])*+g[a+44>>2];f=(f- +g[a+16>>2])*+g[a+48>>2];do if(!(d<=0.0)){k=b[a+6>>1]|0;if(!(d>=+(k&65535|0))){k=b[a+4>>1]&(~~d&65535)&65535|h;break}else{k=b[a+4>>1]&k&65535|h;break}}else k=h;while(0);b[c>>1]=k;do if(!(e<=0.0)){k=b[a+6>>1]|0;if(!(e>=+(k&65535|0))){k=b[a+4>>1]&(~~e&65535)&65535|h;break}else{k=b[a+4>>1]&k&65535|h;break}}else k=h;while(0);b[c+2>>1]=k;if(f<=0.0){h=h&65535;k=c+4|0;b[k>>1]=h;i=j;return}k=b[a+6>>1]|0;if(!(f>=+(k&65535|0))){h=b[a+4>>1]&(~~f&65535)&65535|h;h=h&65535;k=c+4|0;b[k>>1]=h;i=j;return}else{h=b[a+4>>1]&k&65535|h;h=h&65535;k=c+4|0;b[k>>1]=h;i=j;return}}function gs(a,d,f){a=a|0;d=d|0;f=f|0;var g=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0;l=i;p=c[a+(d<<2)+68>>2]|0;g=c[a+60>>2]|0;h=e[p+((f&65535)<<2)+2>>1]|0;n=b[p+((f&65535)+ -1<<2)>>1]|0;if(!((e[p+((f&65535)<<2)>>1]|0)<(n&65535))){i=l;return}m=g;o=p+((f&65535)<<2)|0;p=p+((f&65535)+ -1<<2)|0;while(1){f=e[p+2>>1]|0;if((n&1)==0){f=m+(f<<6)+(d<<1)+48|0;b[f>>1]=(b[f>>1]|0)+1<<16>>16}else{if(((((e[g+(h<<6)+((1<<d&3)<<1)+54>>1]|0)>=(e[m+(f<<6)+((1<<d&3)<<1)+48>>1]|0)?(e[m+(f<<6)+((1<<d&3)<<1)+54>>1]|0)>=(e[g+(h<<6)+((1<<d&3)<<1)+48>>1]|0):0)?(e[g+(h<<6)+((1<<(1<<d&3)&3)<<1)+54>>1]|0)>=(e[m+(f<<6)+((1<<(1<<d&3)&3)<<1)+48>>1]|0):0)?(e[m+(f<<6)+((1<<(1<<d&3)&3)<<1)+54>>1]|0)>=(e[g+(h<<6)+((1<<(1<<d&3)&3)<<1)+48>>1]|0):0)?(j=c[a+92>>2]|0,k=m+(f<<6)|0,Yb[c[(c[j>>2]|0)+8>>2]&31](j,g+(h<<6)|0,k)|0,j=c[a+96>>2]|0,(j|0)!=0):0)Yb[c[(c[j>>2]|0)+8>>2]&31](j,g+(h<<6)|0,k)|0;f=m+(f<<6)+(d<<1)+54|0;b[f>>1]=(b[f>>1]|0)+1<<16>>16}b[g+(h<<6)+(d<<1)+48>>1]=(b[g+(h<<6)+(d<<1)+48>>1]|0)+ -1<<16>>16;n=e[o>>1]|e[o+2>>1]<<16;f=e[p>>1]|e[p+2>>1]<<16;b[o>>1]=f;b[o+2>>1]=f>>>16;b[p>>1]=n;b[p+2>>1]=n>>>16;o=o+ -4|0;p=p+ -4|0;n=b[p>>1]|0;if(!((e[o>>1]|0)<(n&65535)))break;m=c[a+60>>2]|0}i=l;return}function hs(a,d,f,g){a=a|0;d=d|0;f=f|0;g=g|0;var h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0;j=i;q=c[a+(d<<2)+68>>2]|0;o=b[q+((f&65535)+ -1<<2)>>1]|0;if(!((e[q+((f&65535)<<2)>>1]|0)<(o&65535))){i=j;return}n=c[a+60>>2]|0;h=n+((e[q+((f&65535)<<2)+2>>1]|0)<<6)+(d<<1)+54|0;p=q+((f&65535)<<2)|0;q=q+((f&65535)+ -1<<2)|0;while(1){f=e[q+2>>1]|0;if((o&1)==0){o=e[p+2>>1]|0;if(((((e[n+(o<<6)+((1<<d&3)<<1)+54>>1]|0)>=(e[n+(f<<6)+((1<<d&3)<<1)+48>>1]|0)?(e[n+(f<<6)+((1<<d&3)<<1)+54>>1]|0)>=(e[n+(o<<6)+((1<<d&3)<<1)+48>>1]|0):0)?(e[n+(o<<6)+((1<<(1<<d&3)&3)<<1)+54>>1]|0)>=(e[n+(f<<6)+((1<<(1<<d&3)&3)<<1)+48>>1]|0):0)?(e[n+(f<<6)+((1<<(1<<d&3)&3)<<1)+54>>1]|0)>=(e[n+(o<<6)+((1<<(1<<d&3)&3)<<1)+48>>1]|0):0)?(l=c[a+92>>2]|0,m=n+(o<<6)|0,k=n+(f<<6)|0,Tb[c[(c[l>>2]|0)+12>>2]&31](l,m,k,g)|0,l=c[a+96>>2]|0,(l|0)!=0):0)Tb[c[(c[l>>2]|0)+12>>2]&31](l,m,k,g)|0;f=n+(f<<6)+(d<<1)+48|0;b[f>>1]=(b[f>>1]|0)+1<<16>>16}else{f=n+(f<<6)+(d<<1)+54|0;b[f>>1]=(b[f>>1]|0)+1<<16>>16}b[h>>1]=(b[h>>1]|0)+ -1<<16>>16;o=e[p>>1]|e[p+2>>1]<<16;f=e[q>>1]|e[q+2>>1]<<16;b[p>>1]=f;b[p+2>>1]=f>>>16;b[q>>1]=o;b[q+2>>1]=o>>>16;p=p+ -4|0;q=q+ -4|0;o=b[q>>1]|0;if(!((e[p>>1]|0)<(o&65535)))break;n=c[a+60>>2]|0}i=j;return}function is(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=5216;if((c[b+108>>2]|0)!=0){e=c[b+112>>2]|0;Lb[c[c[e>>2]>>2]&511](e);e=c[b+112>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+108>>2]|0;Lb[c[c[e>>2]>>2]&511](e);e=c[b+108>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}}e=c[b+88>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+84>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+80>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+60>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}if((a[b+100>>0]|0)==0){i=d;return}e=c[b+92>>2]|0;Lb[c[c[e>>2]>>2]&511](e);b=c[b+92>>2]|0;if((b|0)==0){i=d;return}c[5006]=(c[5006]|0)+1;YE(c[b+ -4>>2]|0);i=d;return}function js(a){a=a|0;var b=0;b=i;is(a);i=b;return}function ks(a){a=a|0;var b=0;b=i;is(a);if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function ls(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=5280;e=c[b+16>>2]|0;if((e|0)!=0){if((a[b+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+16>>2]=0}a[b+20>>0]=1;c[b+16>>2]=0;c[b+8>>2]=0;c[b+12>>2]=0;i=d;return}function ms(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=5280;e=c[b+16>>2]|0;if((e|0)!=0?(a[b+20>>0]|0)!=0:0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}YE(b);i=d;return}function ns(a,b,c){a=a|0;b=b|0;c=c|0;return 0}function os(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;return 0}function ps(a,b,c){a=a|0;b=b|0;c=c|0;return}function qs(a){a=a|0;return c[a+16>>2]|0}function rs(a){a=a|0;return c[a+16>>2]|0}function ss(a){a=a|0;return a+4|0}function ts(a,b,c){a=a|0;b=b|0;c=c|0;return}function us(a){a=a|0;return 0}function vs(a,b,c){a=a|0;b=b|0;c=c|0;return}function ws(a,b){a=a|0;b=b|0;return}function xs(a,b,c){a=a|0;b=b|0;c=c|0;return}function ys(a,b,c){a=a|0;b=b|0;c=c|0;return 0}function zs(a){a=a|0;return 1}function As(a,b){a=a|0;b=b|0;return}function Bs(a,b){a=a|0;b=b|0;return}function Cs(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0;f=i;k=+$b[c[(c[a>>2]|0)+48>>2]&15](a);o=k+ +g[a+28>>2];m=k+ +g[a+32>>2];k=k+ +g[a+36>>2];w=+P(+(+g[b>>2]));v=+P(+(+g[b+4>>2]));u=+P(+(+g[b+8>>2]));s=+P(+(+g[b+16>>2]));r=+P(+(+g[b+20>>2]));q=+P(+(+g[b+24>>2]));n=+P(+(+g[b+32>>2]));l=+P(+(+g[b+36>>2]));j=+P(+(+g[b+40>>2]));t=+g[b+48>>2];p=+g[b+52>>2];h=+g[b+56>>2];g[d>>2]=t-(o*w+m*v+k*u);g[d+4>>2]=p-(o*s+m*r+k*q);g[d+8>>2]=h-(o*n+m*l+k*j);g[d+12>>2]=0.0;g[e>>2]=o*w+m*v+k*u+t;g[e+4>>2]=o*s+m*r+k*q+p;g[e+8>>2]=o*n+m*l+k*j+h;g[e+12>>2]=0.0;i=f;return}function Ds(a,b,d){a=a|0;b=+b;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0;e=i;k=+g[a+28>>2];h=+g[a+32>>2];l=+g[a+36>>2];j=+$b[c[(c[a>>2]|0)+48>>2]&15](a);f=+$b[c[(c[a>>2]|0)+48>>2]&15](a);l=(l+ +$b[c[(c[a>>2]|0)+48>>2]&15](a))*2.0;g[d>>2]=b/12.0*((h+f)*2.0*(h+f)*2.0+l*l);g[d+4>>2]=b/12.0*((k+j)*2.0*(k+j)*2.0+l*l);g[d+8>>2]=b/12.0*((k+j)*2.0*(k+j)*2.0+(h+f)*2.0*(h+f)*2.0);g[d+12>>2]=0.0;i=e;return}function Es(a){a=a|0;var b=0,d=0;b=i;c[a>>2]=15736;d=c[a+52>>2]|0;if((d|0)==0){i=b;return}Lb[c[c[d>>2]>>2]&511](d);a=c[a+52>>2]|0;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function Fs(a){a=a|0;var b=0,d=0;b=i;c[a>>2]=15736;d=c[a+52>>2]|0;if((d|0)!=0){Lb[c[c[d>>2]>>2]&511](d);d=c[a+52>>2]|0;if((d|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[d+ -4>>2]|0)}if((a|0)==0){i=b;return}}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function Gs(a,b){a=a|0;b=b|0;var d=0,e=0.0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0;d=i;m=+$b[c[(c[a>>2]|0)+48>>2]&15](a);j=+$b[c[(c[a>>2]|0)+48>>2]&15](a);e=+$b[c[(c[a>>2]|0)+48>>2]&15](a);o=(m+ +g[a+28>>2])/+g[a+12>>2];l=(j+ +g[a+32>>2])/+g[a+16>>2];h=(e+ +g[a+36>>2])/+g[a+20>>2];n=+P(+(+g[b>>2]));k=+P(+(+g[b+4>>2]));f=+P(+(+g[b+8>>2]));g[a+12>>2]=n;g[a+16>>2]=k;g[a+20>>2]=f;g[a+24>>2]=0.0;g[a+28>>2]=o*n-m;g[a+32>>2]=l*k-j;g[a+36>>2]=h*f-e;g[a+40>>2]=0.0;i=d;return}function Hs(a){a=a|0;return 5608}function Is(a,b){a=a|0;b=+b;var d=0,e=0.0,f=0.0,h=0.0,j=0.0,k=0.0;d=i;j=+$b[c[(c[a>>2]|0)+48>>2]&15](a);f=+$b[c[(c[a>>2]|0)+48>>2]&15](a);k=+$b[c[(c[a>>2]|0)+48>>2]&15](a);j=j+ +g[a+28>>2];f=f+ +g[a+32>>2];k=k+ +g[a+36>>2];g[a+44>>2]=b;h=+$b[c[(c[a>>2]|0)+48>>2]&15](a);e=+$b[c[(c[a>>2]|0)+48>>2]&15](a);b=k- +$b[c[(c[a>>2]|0)+48>>2]&15](a);g[a+28>>2]=j-h;g[a+32>>2]=f-e;g[a+36>>2]=b;g[a+40>>2]=0.0;i=d;return}function Js(a){a=a|0;return+(+g[a+44>>2])}function Ks(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0;e=i;k=+g[b+28>>2];l=+g[b+32>>2];f=+g[b+36>>2];j=+$b[c[(c[b>>2]|0)+48>>2]&15](b);h=+$b[c[(c[b>>2]|0)+48>>2]&15](b);f=f+ +$b[c[(c[b>>2]|0)+48>>2]&15](b);h=+g[d+4>>2]>=0.0?l+h:-(l+h);f=+g[d+8>>2]>=0.0?f:-f;g[a>>2]=+g[d>>2]>=0.0?k+j:-(k+j);g[a+4>>2]=h;g[a+8>>2]=f;g[a+12>>2]=0.0;i=e;return}function Ls(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0;f=+g[b+28>>2];e=+g[b+32>>2];e=+g[c+4>>2]>=0.0?e:-e;d=+g[b+36>>2];d=+g[c+8>>2]>=0.0?d:-d;g[a>>2]=+g[c>>2]>=0.0?f:-f;g[a+4>>2]=e;g[a+8>>2]=d;g[a+12>>2]=0.0;return}function Ms(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,h=0.0,j=0.0,k=0.0;e=i;if((d|0)<=0){i=e;return}f=0;do{k=+g[a+28>>2];j=+g[a+32>>2];j=+g[b+(f<<4)+4>>2]>=0.0?j:-j;h=+g[a+36>>2];h=+g[b+(f<<4)+8>>2]>=0.0?h:-h;g[c+(f<<4)>>2]=+g[b+(f<<4)>>2]>=0.0?k:-k;g[c+(f<<4)+4>>2]=j;g[c+(f<<4)+8>>2]=h;g[c+(f<<4)+12>>2]=0.0;f=f+1|0}while((f|0)!=(d|0));i=e;return}function Ns(a){a=a|0;return 6}function Os(a,b,c){a=a|0;b=b|0;c=c|0;a=i;switch(b|0){case 3:{g[c>>2]=0.0;g[c+4>>2]=-1.0;g[c+8>>2]=0.0;g[c+12>>2]=0.0;i=a;return};case 2:{g[c>>2]=0.0;g[c+4>>2]=1.0;g[c+8>>2]=0.0;g[c+12>>2]=0.0;i=a;return};case 1:{g[c>>2]=-1.0;g[c+4>>2]=0.0;g[c+8>>2]=0.0;g[c+12>>2]=0.0;i=a;return};case 4:{g[c>>2]=0.0;g[c+4>>2]=0.0;g[c+8>>2]=1.0;g[c+12>>2]=0.0;i=a;return};case 0:{g[c>>2]=1.0;g[c+4>>2]=0.0;g[c+8>>2]=0.0;g[c+12>>2]=0.0;i=a;return};case 5:{g[c>>2]=0.0;g[c+4>>2]=0.0;g[c+8>>2]=-1.0;g[c+12>>2]=0.0;i=a;return};default:{i=a;return}}}function Ps(a){a=a|0;return 8}function Qs(a){a=a|0;return 12}function Rs(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,g=0;f=i;do switch(b|0){case 7:{g=3;break};case 1:{g=0;b=2;break};case 6:{g=2;break};case 3:{g=2;break};case 0:{g=0;b=1;break};case 11:{g=6;b=7;break};case 8:{g=4;b=5;break};case 10:{g=5;b=7;break};case 4:{g=0;break};case 2:{g=1;b=3;break};case 9:{g=4;b=6;break};case 5:{g=1;break};default:{g=0;b=0}}while(0);rc[c[(c[a>>2]|0)+108>>2]&127](a,g,d);rc[c[(c[a>>2]|0)+108>>2]&127](a,b,e);i=f;return}function Ss(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0;e=i;l=+g[a+28>>2];j=+g[a+32>>2];f=+g[a+36>>2];k=+$b[c[(c[a>>2]|0)+48>>2]&15](a);h=+$b[c[(c[a>>2]|0)+48>>2]&15](a);f=f+ +$b[c[(c[a>>2]|0)+48>>2]&15](a);g[d>>2]=+(b&1^1|0)*(l+k)- +(b&1|0)*(l+k);g[d+4>>2]=+(b>>>1&1^1|0)*(j+h)- +(b>>>1&1|0)*(j+h);g[d+8>>2]=+(b>>>2&1^1|0)*f- +(b>>>2&1|0)*f;g[d+12>>2]=0.0;i=e;return}function Ts(a){a=a|0;return 6}function Us(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0.0,j=0.0,k=0.0;f=i;i=i+48|0;rc[c[(c[a>>2]|0)+124>>2]&127](a,f+32|0,e);k=+g[f+32>>2];j=+g[f+36>>2];h=+g[f+40>>2];g[b>>2]=k;g[b+4>>2]=j;g[b+8>>2]=h;g[b+12>>2]=0.0;e=c[(c[a>>2]|0)+64>>2]|0;g[f>>2]=-k;g[f+4>>2]=-j;g[f+8>>2]=-h;g[f+12>>2]=0.0;rc[e&127](f+16|0,a,f);c[d+0>>2]=c[f+16>>2];c[d+4>>2]=c[f+20>>2];c[d+8>>2]=c[f+24>>2];c[d+12>>2]=c[f+28>>2];i=f;return}function Vs(a,b,c){a=a|0;b=b|0;c=+c;var d=0,e=0.0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0;d=i;k=+g[a+28>>2];e=+g[a+32>>2];j=+g[a+36>>2];l=+g[b>>2];if((((l<=k+c?l>=-k-c:0)?(h=+g[b+4>>2],h<=e+c):0)?h>=-e-c:0)?(f=+g[b+8>>2],f<=j+c):0)b=f>=-j-c;else b=0;i=d;return b|0}function Ws(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0.0,h=0.0;d=i;f=+g[a+28>>2];e=+g[a+32>>2];h=+g[a+36>>2];switch(c|0){case 2:{g[b>>2]=0.0;g[b+4>>2]=1.0;g[b+8>>2]=0.0;g[b+12>>2]=-e;i=d;return};case 3:{g[b>>2]=0.0;g[b+4>>2]=-1.0;g[b+8>>2]=0.0;g[b+12>>2]=-e;i=d;return};case 1:{g[b>>2]=-1.0;g[b+4>>2]=0.0;g[b+8>>2]=0.0;g[b+12>>2]=-f;i=d;return};case 0:{g[b>>2]=1.0;g[b+4>>2]=0.0;g[b+8>>2]=0.0;g[b+12>>2]=-f;i=d;return};case 4:{g[b>>2]=0.0;g[b+4>>2]=0.0;g[b+8>>2]=1.0;g[b+12>>2]=-h;i=d;return};case 5:{g[b>>2]=0.0;g[b+4>>2]=0.0;g[b+8>>2]=-1.0;g[b+12>>2]=-h;i=d;return};default:{i=d;return}}}function Xs(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var h=0;h=i;i=i+48|0;c[b+8>>2]=0;g[b+12>>2]=0.0;c[b>>2]=17416;c[b+48>>2]=d;c[b+4>>2]=21;if(Pb[c[(c[d>>2]|0)+40>>2]&127](d)|0)rc[c[(c[d>>2]|0)+48>>2]&127](d,b+16|0,b+32|0);else{c[h+32>>2]=0;c[h+36>>2]=0;c[h+40>>2]=0;c[h+44>>2]=0;g[h+32>>2]=1.0;rc[c[(c[b>>2]|0)+68>>2]&127](h+16|0,b,h+32|0);g[b+32>>2]=+g[h+16>>2]+ +g[b+12>>2];g[h+32>>2]=-1.0;rc[c[(c[b>>2]|0)+68>>2]&127](h,b,h+32|0);c[h+16>>2]=c[h+0>>2];c[h+20>>2]=c[h+4>>2];c[h+24>>2]=c[h+8>>2];c[h+28>>2]=c[h+12>>2];g[b+16>>2]=+g[h+16>>2]- +g[b+12>>2];c[h+32>>2]=0;c[h+36>>2]=0;c[h+40>>2]=0;c[h+44>>2]=0;g[h+36>>2]=1.0;rc[c[(c[b>>2]|0)+68>>2]&127](h+16|0,b,h+32|0);g[b+36>>2]=+g[h+20>>2]+ +g[b+12>>2];g[h+36>>2]=-1.0;rc[c[(c[b>>2]|0)+68>>2]&127](h,b,h+32|0);c[h+16>>2]=c[h+0>>2];c[h+20>>2]=c[h+4>>2];c[h+24>>2]=c[h+8>>2];c[h+28>>2]=c[h+12>>2];g[b+20>>2]=+g[h+20>>2]- +g[b+12>>2];c[h+32>>2]=0;c[h+36>>2]=0;c[h+40>>2]=0;c[h+44>>2]=0;g[h+40>>2]=1.0;rc[c[(c[b>>2]|0)+68>>2]&127](h+16|0,b,h+32|0);g[b+40>>2]=+g[h+24>>2]+ +g[b+12>>2];g[h+40>>2]=-1.0;rc[c[(c[b>>2]|0)+68>>2]&127](h,b,h+32|0);c[h+16>>2]=c[h+0>>2];c[h+20>>2]=c[h+4>>2];c[h+24>>2]=c[h+8>>2];c[h+28>>2]=c[h+12>>2];g[b+24>>2]=+g[h+24>>2]- +g[b+12>>2]}c[b>>2]=5624;c[b+52>>2]=0;c[b+56>>2]=0;a[b+60>>0]=e&1;a[b+61>>0]=0;c[b+4>>2]=21;if(!f){i=h;return}c[5004]=(c[5004]|0)+1;e=XE(191)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}c[e+52>>2]=282;a[e+60>>0]=0;a[e+80>>0]=1;c[e+76>>2]=0;c[e+68>>2]=0;c[e+72>>2]=0;a[e+100>>0]=1;c[e+96>>2]=0;c[e+88>>2]=0;c[e+92>>2]=0;a[e+120>>0]=1;c[e+116>>2]=0;c[e+108>>2]=0;c[e+112>>2]=0;a[e+140>>0]=1;c[e+136>>2]=0;c[e+128>>2]=0;c[e+132>>2]=0;c[e+144>>2]=0;a[e+164>>0]=1;c[e+160>>2]=0;c[e+152>>2]=0;c[e+156>>2]=0;c[e+168>>2]=0;g[e+4>>2]=-3.4028234663852886e+38;g[e+8>>2]=-3.4028234663852886e+38;g[e+12>>2]=-3.4028234663852886e+38;g[e+16>>2]=0.0;g[e+20>>2]=3.4028234663852886e+38;g[e+24>>2]=3.4028234663852886e+38;g[e+28>>2]=3.4028234663852886e+38;g[e+32>>2]=0.0;c[e>>2]=14880;c[b+52>>2]=e;Fz(e,c[b+48>>2]|0,(a[b+60>>0]|0)!=0,b+16|0,b+32|0);a[b+61>>0]=1;i=h;return}function Ys(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=5624;if((a[b+61>>0]|0)!=0){e=c[b+52>>2]|0;Lb[c[c[e>>2]>>2]&511](e);e=c[b+52>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}if((b|0)==0){i=d;return}}c[5006]=(c[5006]|0)+1;YE(c[b+ -4>>2]|0);i=d;return}function Zs(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=5624;if((a[b+61>>0]|0)==0){i=d;return}e=c[b+52>>2]|0;Lb[c[c[e>>2]>>2]&511](e);b=c[b+52>>2]|0;if((b|0)==0){i=d;return}c[5006]=(c[5006]|0)+1;YE(c[b+ -4>>2]|0);i=d;return}function _s(d,f,h,j){d=d|0;f=f|0;h=h|0;j=j|0;var k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0;k=i;i=i+80|0;w=c[d+48>>2]|0;c[k>>2]=5808;c[k+4>>2]=w;c[k+8>>2]=f;f=c[d+52>>2]|0;if((a[f+60>>0]|0)==0){n=c[f+56>>2]|0;a:do if((n|0)>0){m=0;l=c[f+96>>2]|0;d=1;while(1){if(!(+g[h>>2]>+g[l+16>>2])?!(+g[j>>2]<+g[l>>2]):0)r=1;else r=0;if(!(!(+g[h+8>>2]>+g[l+24>>2])?!(+g[j+8>>2]<+g[l+8>>2]):0))r=0;if(!(+g[h+4>>2]>+g[l+20>>2])?!(+g[j+4>>2]<+g[l+4>>2]):0){q=c[l+32>>2]|0;if((q|0)==-1&r){rc[c[(c[k>>2]|0)+8>>2]&127](k,c[l+36>>2]|0,c[l+40>>2]|0);n=c[f+56>>2]|0;o=44}else{p=(q|0)==-1;o=43}}else{q=c[l+32>>2]|0;p=(q|0)==-1;r=0;o=43}if((o|0)==43){o=0;if(r|p)o=44;else{m=q+m|0;l=l+(q<<6)|0}}if((o|0)==44){m=m+1|0;l=l+64|0}if((m|0)>=(n|0))break a;d=d+1|0}}else d=0;while(0);if((c[4028]|0)>=(d|0)){i=k;return}c[4028]=d;i=k;return}z=+g[h>>2];D=+g[h+4>>2];H=+g[h+8>>2];G=+g[f+4>>2];z=z<G?G:z;C=+g[f+8>>2];D=D<C?C:D;y=+g[f+12>>2];H=H<y?y:H;I=+g[f+20>>2];E=+g[f+24>>2];A=+g[f+28>>2];F=+g[f+36>>2];B=+g[f+40>>2];x=+g[f+44>>2];h=~~(((I<z?I:z)-G)*F)&65534;b[k+66>>1]=h;l=~~(((E<D?E:D)-C)*B)&65534;b[k+68>>1]=l;d=~~(((A<H?A:H)-y)*x)&65534;b[k+70>>1]=d;H=+g[j>>2];D=+g[j+4>>2];z=+g[j+8>>2];H=H<G?G:H;D=D<C?C:D;z=z<y?y:z;j=(~~(((I<H?I:H)-G)*F+1.0)&65535|1)&65535;b[k+60>>1]=j;n=(~~(((E<D?E:D)-C)*B+1.0)&65535|1)&65535;b[k+62>>1]=n;m=(~~(((A<z?A:z)-y)*x+1.0)&65535|1)&65535;b[k+64>>1]=m;o=c[f+144>>2]|0;if((o|0)==1){if((c[f+152>>2]|0)<=0){i=k;return}o=0;do{q=c[f+160>>2]|0;if(((j&65535)>=(e[q+(o<<5)>>1]|0)?(h&65535)<=(e[q+(o<<5)+6>>1]|0):0)&(d&65535)<=(e[q+(o<<5)+10>>1]|0)&(m&65535)>=(e[q+(o<<5)+4>>1]|0)&(l&65535)<=(e[q+(o<<5)+8>>1]|0)&(n&65535)>=(e[q+(o<<5)+2>>1]|0)){p=c[q+(o<<5)+12>>2]|0;r=c[q+(o<<5)+16>>2]|0;b:do if((r|0)>0){t=p;s=(c[f+136>>2]|0)+(p<<4)|0;q=1;while(1){u=((j&65535)>=(e[s>>1]|0)?(h&65535)<=(e[s+6>>1]|0):0)&(d&65535)<=(e[s+10>>1]|0)&(m&65535)>=(e[s+4>>1]|0)&(l&65535)<=(e[s+8>>1]|0)&(n&65535)>=(e[s+2>>1]|0);v=s+12|0;w=c[v>>2]|0;if((w|0)>-1&u)rc[c[(c[k>>2]|0)+8>>2]&127](k,w>>21,w&2097151);if(u|(w|0)>-1){t=t+1|0;s=s+16|0}else{w=c[v>>2]|0;t=t-w|0;s=s+(0-w<<4)|0}if((t|0)>=(r+p|0))break b;q=q+1|0}}else q=0;while(0);if((c[4028]|0)<(q|0))c[4028]=q}o=o+1|0}while((o|0)<(c[f+152>>2]|0));i=k;return}else if((o|0)==2){DA(c[f+136>>2]|0,k,k+66|0,k+60|0);i=k;return}else if((o|0)==0){o=c[f+56>>2]|0;c:do if((o|0)>0){p=0;q=c[f+136>>2]|0;f=1;while(1){s=((j&65535)>=(e[q>>1]|0)?(h&65535)<=(e[q+6>>1]|0):0)&(d&65535)<=(e[q+10>>1]|0)&(m&65535)>=(e[q+4>>1]|0)&(l&65535)<=(e[q+8>>1]|0)&(n&65535)>=(e[q+2>>1]|0);r=q+12|0;t=c[r>>2]|0;if((t|0)>-1&s)rc[c[(c[k>>2]|0)+8>>2]&127](k,t>>21,t&2097151);if(s|(t|0)>-1){p=p+1|0;q=q+16|0}else{w=c[r>>2]|0;p=p-w|0;q=q+(0-w<<4)|0}if((p|0)>=(o|0))break c;f=f+1|0}}else f=0;while(0);if((c[4028]|0)>=(f|0)){i=k;return}c[4028]=f;i=k;return}else{i=k;return}}function $s(b,d){b=b|0;d=d|0;var e=0,f=0,h=0.0,j=0.0,k=0.0,l=0;e=i;l=Pb[c[(c[b>>2]|0)+28>>2]&127](b)|0;k=+g[l>>2]- +g[d>>2];j=+g[l+4>>2]- +g[d+4>>2];h=+g[l+8>>2]- +g[d+8>>2];if(!(k*k+j*j+h*h>1.1920928955078125e-7)){i=e;return}ZB(b,d);if((a[b+61>>0]|0)!=0?(f=c[b+52>>2]|0,Lb[c[c[f>>2]>>2]&511](f),f=c[b+52>>2]|0,(f|0)!=0):0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}c[5004]=(c[5004]|0)+1;f=XE(191)|0;if((f|0)==0)f=0;else{c[(f+19&-16)+ -4>>2]=f;f=f+19&-16}c[f+52>>2]=282;a[f+60>>0]=0;a[f+80>>0]=1;c[f+76>>2]=0;c[f+68>>2]=0;c[f+72>>2]=0;a[f+100>>0]=1;c[f+96>>2]=0;c[f+88>>2]=0;c[f+92>>2]=0;a[f+120>>0]=1;c[f+116>>2]=0;c[f+108>>2]=0;c[f+112>>2]=0;a[f+140>>0]=1;c[f+136>>2]=0;c[f+128>>2]=0;c[f+132>>2]=0;c[f+144>>2]=0;a[f+164>>0]=1;c[f+160>>2]=0;c[f+152>>2]=0;c[f+156>>2]=0;c[f+168>>2]=0;g[f+4>>2]=-3.4028234663852886e+38;g[f+8>>2]=-3.4028234663852886e+38;g[f+12>>2]=-3.4028234663852886e+38;g[f+16>>2]=0.0;g[f+20>>2]=3.4028234663852886e+38;g[f+24>>2]=3.4028234663852886e+38;g[f+28>>2]=3.4028234663852886e+38;g[f+32>>2]=0.0;c[f>>2]=14880;c[b+52>>2]=f;Fz(f,c[b+48>>2]|0,(a[b+60>>0]|0)!=0,b+16|0,b+32|0);a[b+61>>0]=1;i=e;return}function at(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,h=0,j=0;e=i;h=gc[c[(c[d>>2]|0)+40>>2]&31](d,a)|0;j=gc[c[(c[d>>2]|0)+28>>2]&31](d,h)|0;c[b>>2]=j;if((j|0)!=0)Nb[c[(c[d>>2]|0)+48>>2]&127](d,h);c[b+4>>2]=c[a+4>>2];j=c[a+48>>2]|0;Yb[c[(c[j>>2]|0)+56>>2]&31](j,b+12|0,d)|0;g[b+52>>2]=+g[a+12>>2];do if((c[a+52>>2]|0)!=0?((Pb[c[(c[d>>2]|0)+52>>2]&127](d)|0)&1|0)==0:0){h=gc[c[(c[d>>2]|0)+24>>2]&31](d,c[a+52>>2]|0)|0;if((h|0)==0){c[b+40>>2]=gc[c[(c[d>>2]|0)+28>>2]&31](d,c[a+52>>2]|0)|0;c[b+44>>2]=0;h=c[a+52>>2]|0;h=Pb[c[(c[h>>2]|0)+12>>2]&127](h)|0;h=Yb[c[(c[d>>2]|0)+16>>2]&31](d,h,1)|0;j=c[a+52>>2]|0;j=Yb[c[(c[j>>2]|0)+16>>2]&31](j,c[h+8>>2]|0,d)|0;Jb[c[(c[d>>2]|0)+20>>2]&31](d,h,j,1213612625,c[a+52>>2]|0);break}else{c[b+40>>2]=h;c[b+44>>2]=0;break}}else f=8;while(0);if((f|0)==8){c[b+40>>2]=0;c[b+44>>2]=0}if((c[a+56>>2]|0)!=0?((Pb[c[(c[d>>2]|0)+52>>2]&127](d)|0)&2|0)==0:0){f=gc[c[(c[d>>2]|0)+24>>2]&31](d,c[a+56>>2]|0)|0;if((f|0)==0){c[b+48>>2]=gc[c[(c[d>>2]|0)+28>>2]&31](d,c[a+56>>2]|0)|0;h=c[a+56>>2]|0;h=Pb[c[(c[h>>2]|0)+8>>2]&127](h)|0;h=Yb[c[(c[d>>2]|0)+16>>2]&31](d,h,1)|0;j=c[a+56>>2]|0;j=Yb[c[(c[j>>2]|0)+12>>2]&31](j,c[h+8>>2]|0,d)|0;Jb[c[(c[d>>2]|0)+20>>2]&31](d,h,j,1346456916,c[a+56>>2]|0);i=e;return 5712}else{c[b+48>>2]=f;i=e;return 5712}}c[b+48>>2]=0;i=e;return 5712}function bt(a,b){a=a|0;b=b|0;var d=0,e=0,f=0;d=i;e=c[a+52>>2]|0;if((e|0)==0){i=d;return}f=Pb[c[(c[e>>2]|0)+12>>2]&127](e)|0;f=Yb[c[(c[b>>2]|0)+16>>2]&31](b,f,1)|0;e=c[a+52>>2]|0;e=Yb[c[(c[e>>2]|0)+16>>2]&31](e,c[f+8>>2]|0,b)|0;Jb[c[(c[b>>2]|0)+20>>2]&31](b,f,e,1213612625,c[a+52>>2]|0);i=d;return}function ct(a,b){a=a|0;b=b|0;var d=0,e=0,f=0;d=i;e=c[a+56>>2]|0;if((e|0)==0){i=d;return}f=Pb[c[(c[e>>2]|0)+8>>2]&127](e)|0;f=Yb[c[(c[b>>2]|0)+16>>2]&31](b,f,1)|0;e=c[a+56>>2]|0;e=Yb[c[(c[e>>2]|0)+12>>2]&31](e,c[f+8>>2]|0,b)|0;Jb[c[(c[b>>2]|0)+20>>2]&31](b,f,e,1346456916,c[a+56>>2]|0);i=d;return}function dt(a){a=a|0;return 5784}function et(a,b){a=a|0;b=+b;g[a+12>>2]=b;return}function ft(a){a=a|0;return+(+g[a+12>>2])}function gt(a){a=a|0;return 60}function ht(a,b,d){a=a|0;b=b|0;d=d|0;var e=0;e=i;rc[c[(c[b>>2]|0)+68>>2]&127](a,b,d);i=e;return}function it(a){a=a|0;return}function jt(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function kt(a,b,f){a=a|0;b=b|0;f=f|0;var j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0.0,s=0.0;o=i;i=i+32|0;l=c[a+4>>2]|0;fc[c[(c[l>>2]|0)+16>>2]&3](l,o+28|0,o+24|0,o+20|0,o+16|0,o+12|0,o+8|0,o+4|0,o,b);l=c[o+12>>2]|0;m=aa(c[o+8>>2]|0,f)|0;k=c[a+4>>2]|0;n=c[o>>2]|0;j=2;while(1){if((n|0)==2)q=c[l+m+(j<<2)>>2]|0;else if((n|0)==3)q=e[l+m+(j<<1)>>1]|0;else q=d[l+(j+m)>>0]|0;p=c[o+28>>2]|0;q=aa(c[o+16>>2]|0,q)|0;if((c[o+20>>2]|0)==0){s=+g[p+(q+4)>>2]*+g[k+8>>2];r=+g[p+(q+8)>>2]*+g[k+12>>2];g[a+(j<<4)+12>>2]=+g[p+q>>2]*+g[k+4>>2];g[a+(j<<4)+16>>2]=s;g[a+(j<<4)+20>>2]=r;g[a+(j<<4)+24>>2]=0.0}else{r=+h[p+(q+8)>>3]*+g[k+8>>2];s=+h[p+(q+16)>>3]*+g[k+12>>2];g[a+(j<<4)+12>>2]=+h[p+q>>3]*+g[k+4>>2];g[a+(j<<4)+16>>2]=r;g[a+(j<<4)+20>>2]=s;g[a+(j<<4)+24>>2]=0.0}if((j|0)>0)j=j+ -1|0;else break}q=c[a+8>>2]|0;vc[c[(c[q>>2]|0)+8>>2]&127](q,a+12|0,b,f);q=c[a+4>>2]|0;Nb[c[(c[q>>2]|0)+24>>2]&127](q,b);i=o;return}function lt(a){a=a|0;return}function mt(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function nt(a,b,d){a=a|0;b=b|0;d=d|0;var f=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0.0,s=0.0;n=i;i=i+80|0;l=c[a+4>>2]|0;fc[c[(c[l>>2]|0)+16>>2]&3](l,n+28|0,n+24|0,n+20|0,n+16|0,n+12|0,n+8|0,n+4|0,n,b);l=c[n+12>>2]|0;k=aa(c[n+8>>2]|0,d)|0;f=c[a+4>>2]|0;m=(c[n+20>>2]|0)==0;j=c[n+28>>2]|0;if((c[n>>2]|0)!=3){o=c[n+16>>2]|0;p=aa(o,c[l+(k+8)>>2]|0)|0;if(m){s=+g[j+(p+4)>>2]*+g[f+8>>2];r=+g[j+(p+8)>>2]*+g[f+12>>2];g[n+64>>2]=+g[j+p>>2]*+g[f+4>>2];g[n+68>>2]=s;g[n+72>>2]=r;g[n+76>>2]=0.0;q=aa(o,c[l+(k+4)>>2]|0)|0;r=+g[j+(q+4)>>2]*+g[f+8>>2];s=+g[j+(q+8)>>2]*+g[f+12>>2];g[n+48>>2]=+g[j+q>>2]*+g[f+4>>2];g[n+52>>2]=r;g[n+56>>2]=s;g[n+60>>2]=0.0;q=aa(o,c[l+k>>2]|0)|0;s=+g[j+(q+4)>>2]*+g[f+8>>2];r=+g[j+(q+8)>>2]*+g[f+12>>2];g[n+32>>2]=+g[j+q>>2]*+g[f+4>>2];g[n+36>>2]=s;g[n+40>>2]=r;g[n+44>>2]=0.0;q=a+8|0;q=c[q>>2]|0;p=c[q>>2]|0;p=p+8|0;p=c[p>>2]|0;vc[p&127](q,n+32|0,b,d);q=c[a+4>>2]|0;p=c[q>>2]|0;p=p+24|0;p=c[p>>2]|0;Nb[p&127](q,b);i=n;return}else{r=+h[j+(p+8)>>3]*+g[f+8>>2];s=+h[j+(p+16)>>3]*+g[f+12>>2];g[n+64>>2]=+h[j+p>>3]*+g[f+4>>2];g[n+68>>2]=r;g[n+72>>2]=s;g[n+76>>2]=0.0;q=aa(o,c[l+(k+4)>>2]|0)|0;s=+h[j+(q+8)>>3]*+g[f+8>>2];r=+h[j+(q+16)>>3]*+g[f+12>>2];g[n+48>>2]=+h[j+q>>3]*+g[f+4>>2];g[n+52>>2]=s;g[n+56>>2]=r;g[n+60>>2]=0.0;q=aa(o,c[l+k>>2]|0)|0;r=+h[j+(q+8)>>3]*+g[f+8>>2];s=+h[j+(q+16)>>3]*+g[f+12>>2];g[n+32>>2]=+h[j+q>>3]*+g[f+4>>2];g[n+36>>2]=r;g[n+40>>2]=s;g[n+44>>2]=0.0;q=a+8|0;q=c[q>>2]|0;p=c[q>>2]|0;p=p+8|0;p=c[p>>2]|0;vc[p&127](q,n+32|0,b,d);q=c[a+4>>2]|0;p=c[q>>2]|0;p=p+24|0;p=c[p>>2]|0;Nb[p&127](q,b);i=n;return}}o=c[n+16>>2]|0;p=2;while(1){q=aa(o,e[l+k+(p<<1)>>1]|0)|0;if(m){r=+g[j+(q+4)>>2]*+g[f+8>>2];s=+g[j+(q+8)>>2]*+g[f+12>>2];g[n+32+(p<<4)>>2]=+g[j+q>>2]*+g[f+4>>2];g[n+32+(p<<4)+4>>2]=r;g[n+32+(p<<4)+8>>2]=s;g[n+32+(p<<4)+12>>2]=0.0}else{r=+h[j+(q+8)>>3]*+g[f+8>>2];s=+h[j+(q+16)>>3]*+g[f+12>>2];g[n+32+(p<<4)>>2]=+h[j+q>>3]*+g[f+4>>2];g[n+32+(p<<4)+4>>2]=r;g[n+32+(p<<4)+8>>2]=s;g[n+32+(p<<4)+12>>2]=0.0}if((p|0)>0)p=p+ -1|0;else break}q=a+8|0;q=c[q>>2]|0;p=c[q>>2]|0;p=p+8|0;p=c[p>>2]|0;vc[p&127](q,n+32|0,b,d);q=c[a+4>>2]|0;p=c[q>>2]|0;p=p+24|0;p=c[p>>2]|0;Nb[p&127](q,b);i=n;return}function ot(a){a=a|0;return}function pt(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function qt(a,b,d){a=a|0;b=b|0;d=d|0;var f=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0.0,r=0.0;n=i;i=i+80|0;m=c[a+4>>2]|0;fc[c[(c[m>>2]|0)+16>>2]&3](m,n+28|0,n+24|0,n+20|0,n+16|0,n+12|0,n+8|0,n+4|0,n,b);m=(c[n+12>>2]|0)+(aa(c[n+8>>2]|0,d)|0)|0;k=c[a+4>>2]|0;f=(c[n>>2]|0)==3;l=(c[n+20>>2]|0)==0;j=c[n+28>>2]|0;o=2;while(1){if(f)p=e[m+(o<<1)>>1]|0;else p=c[m+(o<<2)>>2]|0;p=aa(c[n+16>>2]|0,p)|0;if(l){r=+g[j+(p+4)>>2]*+g[k+8>>2];q=+g[j+(p+8)>>2]*+g[k+12>>2];g[n+32+(o<<4)>>2]=+g[j+p>>2]*+g[k+4>>2];g[n+32+(o<<4)+4>>2]=r;g[n+32+(o<<4)+8>>2]=q;g[n+32+(o<<4)+12>>2]=0.0}else{q=+h[j+(p+8)>>3]*+g[k+8>>2];r=+h[j+(p+16)>>3]*+g[k+12>>2];g[n+32+(o<<4)>>2]=+h[j+p>>3]*+g[k+4>>2];g[n+32+(o<<4)+4>>2]=q;g[n+32+(o<<4)+8>>2]=r;g[n+32+(o<<4)+12>>2]=0.0}if((o|0)>0)o=o+ -1|0;else break}p=c[a+8>>2]|0;vc[c[(c[p>>2]|0)+8>>2]&127](p,n+32|0,b,d);p=c[a+4>>2]|0;Nb[c[(c[p>>2]|0)+24>>2]&127](p,b);i=n;return}function rt(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0;e=i;i=i+32|0;c[a+0>>2]=0;c[a+4>>2]=0;c[a+8>>2]=0;c[a+12>>2]=0;f=+g[d>>2];h=+g[d+4>>2];j=+g[d+8>>2];if(f*f+h*h+j*j<9999999747378752.0e-20){f=1.0;h=0.0;j=0.0}else{q=1.0/+Q(+(f*f+h*h+j*j));f=f*q;h=h*q;j=j*q}d=c[b+52>>2]|0;m=+g[b+(((d+2|0)%3|0)<<2)+28>>2];c[e+16>>2]=0;c[e+20>>2]=0;c[e+24>>2]=0;c[e+28>>2]=0;g[e+16+(d<<2)>>2]=+g[b+(d<<2)+28>>2];l=f*m;k=h*m;m=j*m;q=l+ +g[e+16>>2];n=k+ +g[e+20>>2];o=m+ +g[e+24>>2];p=+$b[c[(c[b>>2]|0)+48>>2]&15](b);q=q-f*p;n=n-h*p;p=o-j*p;o=j*p+(f*q+h*n);if(o>-999999984306749400.0){g[a>>2]=q;g[a+4>>2]=n;g[a+8>>2]=p;g[a+12>>2]=0.0}else o=-999999984306749400.0;c[e+0>>2]=0;c[e+4>>2]=0;c[e+8>>2]=0;c[e+12>>2]=0;d=c[b+52>>2]|0;g[e+(d<<2)>>2]=-+g[b+(d<<2)+28>>2];l=l+ +g[e>>2];k=k+ +g[e+4>>2];q=m+ +g[e+8>>2];m=+$b[c[(c[b>>2]|0)+48>>2]&15](b);l=l-f*m;k=k-h*m;m=q-j*m;if(!(j*m+(f*l+h*k)>o)){i=e;return}g[a>>2]=l;g[a+4>>2]=k;g[a+8>>2]=m;g[a+12>>2]=0.0;i=e;return}function st(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0.0,j=0,k=0,l=0,m=0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0;f=i;i=i+32|0;k=c[a+52>>2]|0;h=+g[a+(((k+2|0)%3|0)<<2)+28>>2];if((e|0)<=0){i=f;return}j=0;while(1){m=a+(k<<2)+28|0;c[f+16>>2]=0;c[f+20>>2]=0;c[f+24>>2]=0;c[f+28>>2]=0;g[f+16+(k<<2)>>2]=+g[m>>2];m=b+(j<<4)|0;l=b+(j<<4)+4|0;k=b+(j<<4)+8|0;u=h*+g[m>>2]+ +g[f+16>>2];s=h*+g[l>>2]+ +g[f+20>>2];q=h*+g[k>>2]+ +g[f+24>>2];w=+$b[c[(c[a>>2]|0)+48>>2]&15](a);t=+g[m>>2];r=+g[l>>2];v=+g[k>>2];if(t*(u-w*t)+r*(s-w*r)+v*(q-w*v)>-999999984306749400.0){g[d+(j<<4)>>2]=u-w*t;g[d+(j<<4)+4>>2]=s-w*r;g[d+(j<<4)+8>>2]=q-w*v;g[d+(j<<4)+12>>2]=0.0;p=+g[m>>2];o=+g[l>>2];n=+g[k>>2];q=t*(u-w*t)+r*(s-w*r)+v*(q-w*v)}else{p=t;o=r;n=v;q=-999999984306749400.0}c[f+0>>2]=0;c[f+4>>2]=0;c[f+8>>2]=0;c[f+12>>2]=0;x=c[a+52>>2]|0;g[f+(x<<2)>>2]=-+g[a+(x<<2)+28>>2];p=h*p+ +g[f>>2];o=h*o+ +g[f+4>>2];r=h*n+ +g[f+8>>2];n=+$b[c[(c[a>>2]|0)+48>>2]&15](a);s=+g[m>>2];t=+g[l>>2];u=+g[k>>2];if(s*(p-n*s)+t*(o-n*t)+u*(r-n*u)>q){g[d+(j<<4)>>2]=p-n*s;g[d+(j<<4)+4>>2]=o-n*t;g[d+(j<<4)+8>>2]=r-n*u;g[d+(j<<4)+12>>2]=0.0}j=j+1|0;if((j|0)==(e|0))break;k=c[a+52>>2]|0}i=f;return}function tt(a,b,d){a=a|0;b=+b;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0;e=i;i=i+16|0;k=c[a+52>>2]|0;h=+g[a+(((k+2|0)%3|0)<<2)+28>>2];g[e>>2]=h;g[e+4>>2]=h;g[e+8>>2]=h;g[e+12>>2]=0.0;g[e+(k<<2)>>2]=+g[a+(k<<2)+28>>2]+ +g[e+(k<<2)>>2];h=(+g[e>>2]+.03999999910593033)*2.0;f=(+g[e+4>>2]+.03999999910593033)*2.0;j=(+g[e+8>>2]+.03999999910593033)*2.0;g[d>>2]=b*.0833333283662796*(f*f+j*j);g[d+4>>2]=b*.0833333283662796*(h*h+j*j);g[d+8>>2]=b*.0833333283662796*(h*h+f*f);i=e;return}function ut(a){a=a|0;return}function vt(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function wt(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0;f=i;i=i+16|0;x=c[a+52>>2]|0;k=+g[a+(((x+2|0)%3|0)<<2)+28>>2];g[f>>2]=k;g[f+4>>2]=k;g[f+8>>2]=k;g[f+12>>2]=0.0;g[f+(x<<2)>>2]=k+ +g[a+(x<<2)+28>>2];k=+$b[c[(c[a>>2]|0)+48>>2]&15](a);h=+$b[c[(c[a>>2]|0)+48>>2]&15](a);n=+$b[c[(c[a>>2]|0)+48>>2]&15](a);k=k+ +g[f>>2];g[f>>2]=k;h=h+ +g[f+4>>2];g[f+4>>2]=h;n=n+ +g[f+8>>2];u=+P(+(+g[b>>2]));t=+P(+(+g[b+4>>2]));v=+P(+(+g[b+8>>2]));q=+P(+(+g[b+16>>2]));p=+P(+(+g[b+20>>2]));r=+P(+(+g[b+24>>2]));l=+P(+(+g[b+32>>2]));j=+P(+(+g[b+36>>2]));m=+P(+(+g[b+40>>2]));w=+g[b+48>>2];s=+g[b+52>>2];o=+g[b+56>>2];g[d>>2]=w-(n*v+(u*k+t*h));g[d+4>>2]=s-(n*r+(q*k+p*h));g[d+8>>2]=o-(n*m+(l*k+j*h));g[d+12>>2]=0.0;g[e>>2]=w+(n*v+(u*k+t*h));g[e+4>>2]=s+(n*r+(q*k+p*h));g[e+8>>2]=o+(n*m+(l*k+j*h));g[e+12>>2]=0.0;i=f;return}function xt(a,b){a=a|0;b=b|0;var d=0,e=0.0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0;d=i;m=+$b[c[(c[a>>2]|0)+48>>2]&15](a);j=+$b[c[(c[a>>2]|0)+48>>2]&15](a);e=+$b[c[(c[a>>2]|0)+48>>2]&15](a);o=(m+ +g[a+28>>2])/+g[a+12>>2];l=(j+ +g[a+32>>2])/+g[a+16>>2];h=(e+ +g[a+36>>2])/+g[a+20>>2];n=+P(+(+g[b>>2]));k=+P(+(+g[b+4>>2]));f=+P(+(+g[b+8>>2]));g[a+12>>2]=n;g[a+16>>2]=k;g[a+20>>2]=f;g[a+24>>2]=0.0;g[a+28>>2]=o*n-m;g[a+32>>2]=l*k-j;g[a+36>>2]=h*f-e;g[a+40>>2]=0.0;i=d;return}function yt(a){a=a|0;return 6776}function zt(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+0>>2]=0;c[a+4>>2]=0;c[a+8>>2]=0;c[a+12>>2]=0;g[a+(c[b+52>>2]<<2)>>2]=1.0;i=d;return}function At(a,b){a=a|0;b=+b;var d=0,e=0.0,f=0.0,h=0.0,j=0.0,k=0.0;d=i;j=+$b[c[(c[a>>2]|0)+48>>2]&15](a);f=+$b[c[(c[a>>2]|0)+48>>2]&15](a);k=+$b[c[(c[a>>2]|0)+48>>2]&15](a);j=j+ +g[a+28>>2];f=f+ +g[a+32>>2];k=k+ +g[a+36>>2];g[a+44>>2]=b;h=+$b[c[(c[a>>2]|0)+48>>2]&15](a);e=+$b[c[(c[a>>2]|0)+48>>2]&15](a);b=k- +$b[c[(c[a>>2]|0)+48>>2]&15](a);g[a+28>>2]=j-h;g[a+32>>2]=f-e;g[a+36>>2]=b;g[a+40>>2]=0.0;i=d;return}function Bt(a){a=a|0;return 60}function Ct(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,h=0;e=i;f=gc[c[(c[d>>2]|0)+40>>2]&31](d,a)|0;h=gc[c[(c[d>>2]|0)+28>>2]&31](d,f)|0;c[b>>2]=h;if((h|0)!=0)Nb[c[(c[d>>2]|0)+48>>2]&127](d,f);c[b+4>>2]=c[a+4>>2];g[b+28>>2]=+g[a+28>>2];g[b+32>>2]=+g[a+32>>2];g[b+36>>2]=+g[a+36>>2];g[b+40>>2]=+g[a+40>>2];g[b+12>>2]=+g[a+12>>2];g[b+16>>2]=+g[a+16>>2];g[b+20>>2]=+g[a+20>>2];g[b+24>>2]=+g[a+24>>2];g[b+44>>2]=+g[a+44>>2];c[b+52>>2]=c[a+52>>2];i=e;return 6752}function Dt(a){a=a|0;return}function Et(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function Ft(a){a=a|0;return 6736}function Gt(a){a=a|0;return}function Ht(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function It(a){a=a|0;return 6720}function Jt(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,h=0,j=0,k=0.0;e=i;i=i+80|0;f=c[c[a>>2]>>2]|0;h=c[c[a+4>>2]>>2]|0;if(!(Yb[c[(c[b>>2]|0)+24>>2]&31](b,f,h)|0)){i=e;return}j=c[f+192>>2]|0;c[e+56>>2]=0;c[e+60>>2]=j;c[e+64>>2]=f;c[e+68>>2]=f+4;c[e+72>>2]=-1;c[e+76>>2]=-1;j=c[h+192>>2]|0;c[e+32>>2]=0;c[e+36>>2]=j;c[e+40>>2]=h;c[e+44>>2]=h+4;c[e+48>>2]=-1;c[e+52>>2]=-1;j=c[a+8>>2]|0;if((j|0)==0){j=Tb[c[(c[b>>2]|0)+8>>2]&31](b,e+56|0,e+32|0,0)|0;c[a+8>>2]=j;if((j|0)==0){i=e;return}}c[e>>2]=13504;c[e+4>>2]=0;c[e+8>>2]=e+56;c[e+12>>2]=e+32;if((c[d+8>>2]|0)==1){Jb[c[(c[j>>2]|0)+8>>2]&31](j,e+56|0,e+32|0,d,e);i=e;return}k=+Xb[c[(c[j>>2]|0)+12>>2]&15](j,f,h,d,e);if(!(+g[d+12>>2]>k)){i=e;return}g[d+12>>2]=k;i=e;return}function Kt(a){a=a|0;return}function Lt(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=6808;e=c[b+20>>2]|0;if((e|0)!=0){if((a[b+24>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+20>>2]=0}a[b+24>>0]=1;c[b+20>>2]=0;c[b+12>>2]=0;c[b+16>>2]=0;YE(b);i=d;return}function Mt(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=6808;e=c[b+20>>2]|0;if((e|0)!=0){if((a[b+24>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+20>>2]=0}a[b+24>>0]=1;c[b+20>>2]=0;c[b+12>>2]=0;c[b+16>>2]=0;i=d;return}function Nt(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,h=0,j=0,k=0.0,l=0.0,m=0,n=0,o=0.0;f=i;i=i+16|0;c[1698]=(c[1698]|0)+1;if((c[b+4>>2]&2|0)==0)j=15720;else{j=c[d+192>>2]|0;k=+lc[c[(c[j>>2]|0)+20>>2]&1](j,.019999999552965164);g[f+4>>2]=k;j=c[e+192>>2]|0;l=+lc[c[(c[j>>2]|0)+20>>2]&1](j,.019999999552965164);g[f>>2]=l;j=k<l?f+4|0:f}l=+g[j>>2];o=+g[d+184>>2];k=+g[e+184>>2];k=o<k?o:k;m=c[b+68>>2]|0;j=c[m+8>>2]|0;if((j|0)==0){if((c[b+4>>2]&4|0)!=0){n=0;i=f;return n|0}c[5004]=(c[5004]|0)+1;j=XE(791)|0;if((j|0)==0)j=0;else{c[(j+19&-16)+ -4>>2]=j;j=j+19&-16}}else{n=c[m+12>>2]|0;c[m+12>>2]=c[n>>2];c[m+8>>2]=j+ -1;j=n}c[j>>2]=1025;c[j+116>>2]=0;a[j+120>>0]=0;n=j+124|0;c[n+0>>2]=0;c[n+4>>2]=0;c[n+8>>2]=0;c[n+12>>2]=0;c[n+16>>2]=0;c[n+20>>2]=0;c[n+24>>2]=0;c[n+28>>2]=0;c[j+300>>2]=0;a[j+304>>0]=0;n=j+308|0;c[n+0>>2]=0;c[n+4>>2]=0;c[n+8>>2]=0;c[n+12>>2]=0;c[n+16>>2]=0;c[n+20>>2]=0;c[n+24>>2]=0;c[n+28>>2]=0;c[j+484>>2]=0;a[j+488>>0]=0;n=j+492|0;c[n+0>>2]=0;c[n+4>>2]=0;c[n+8>>2]=0;c[n+12>>2]=0;c[n+16>>2]=0;c[n+20>>2]=0;c[n+24>>2]=0;c[n+28>>2]=0;c[j+668>>2]=0;a[j+672>>0]=0;n=j+676|0;c[n+0>>2]=0;c[n+4>>2]=0;c[n+8>>2]=0;c[n+12>>2]=0;c[n+16>>2]=0;c[n+20>>2]=0;c[n+24>>2]=0;c[n+28>>2]=0;c[j+740>>2]=d;c[j+744>>2]=e;c[j+748>>2]=0;g[j+752>>2]=l;g[j+756>>2]=k;c[j+768>>2]=c[b+12>>2];e=c[b+12>>2]|0;if((e|0)==(c[b+16>>2]|0)?(h=(e|0)==0?1:e<<1,(e|0)<(h|0)):0){if((h|0)==0)d=0;else{c[5004]=(c[5004]|0)+1;d=XE((h<<2|3)+16|0)|0;if((d|0)==0)d=0;else{c[(d+19&-16)+ -4>>2]=d;d=d+19&-16}e=c[b+12>>2]|0}if((e|0)>0){n=0;do{m=d+(n<<2)|0;if((m|0)!=0)c[m>>2]=c[(c[b+20>>2]|0)+(n<<2)>>2];n=n+1|0}while((n|0)!=(e|0))}m=c[b+20>>2]|0;if((m|0)!=0){if((a[b+24>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[m+ -4>>2]|0);e=c[b+12>>2]|0}c[b+20>>2]=0}a[b+24>>0]=1;c[b+20>>2]=d;c[b+16>>2]=h}h=(c[b+20>>2]|0)+(e<<2)|0;if((h|0)!=0)c[h>>2]=j;c[b+12>>2]=e+1;n=j;i=f;return n|0}function Ot(a,b){a=a|0;b=b|0;var d=0,e=0;a=i;d=c[b+748>>2]|0;if((d|0)>0){e=0;do e=e+1|0;while((e|0)<(d|0))}c[b+748>>2]=0;i=a;return}function Pt(a,b){a=a|0;b=b|0;var d=0,e=0,f=0,g=0,h=0;d=i;c[1698]=(c[1698]|0)+ -1;Nb[c[(c[a>>2]|0)+20>>2]&127](a,b);e=c[b+768>>2]|0;f=(c[a+12>>2]|0)+ -1|0;h=c[a+20>>2]|0;g=c[h+(e<<2)>>2]|0;c[h+(e<<2)>>2]=c[h+(f<<2)>>2];c[(c[a+20>>2]|0)+(f<<2)>>2]=g;c[(c[(c[a+20>>2]|0)+(e<<2)>>2]|0)+768>>2]=e;c[a+12>>2]=(c[a+12>>2]|0)+ -1;a=c[a+68>>2]|0;if((b|0)==0){i=d;return}h=c[a+16>>2]|0;if(!(h>>>0>b>>>0)?(h+(aa(c[a>>2]|0,c[a+4>>2]|0)|0)|0)>>>0>b>>>0:0){c[b>>2]=c[a+12>>2];c[a+12>>2]=b;c[a+8>>2]=(c[a+8>>2]|0)+1;i=d;return}c[5006]=(c[5006]|0)+1;YE(c[b+ -4>>2]|0);i=d;return}function Qt(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;i=i+16|0;c[f>>2]=a;c[f+4>>2]=e;e=c[a+((c[(c[b+4>>2]|0)+4>>2]|0)*144|0)+(c[(c[d+4>>2]|0)+4>>2]<<2)+72>>2]|0;e=Tb[c[(c[e>>2]|0)+8>>2]&31](e,f,b,d)|0;i=f;return e|0}function Rt(a,b,d){a=a|0;b=b|0;d=d|0;var e=0;a=i;b=c[b+204>>2]|0;if((b&4|0)==0?(e=c[d+204>>2]|0,(e&4|0)==0):0)if((b&3|0)==0)d=1;else d=(e&3|0)==0;else d=0;i=a;return d|0}function St(a,b,d){a=a|0;b=b|0;d=d|0;var e=0;a=i;e=c[b+216>>2]|0;if((e|0)==2|(e|0)==5?(e=c[d+216>>2]|0,(e|0)==2|(e|0)==5):0)b=0;else if((c[b+256>>2]|0)==0)b=1;else b=gc[c[c[b>>2]>>2]&31](b,d)|0;i=a;return b|0}function Tt(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;i=i+16|0;c[f>>2]=6920;c[f+4>>2]=d;c[f+8>>2]=a;rc[c[(c[b>>2]|0)+48>>2]&127](b,f,e);i=f;return}function Ut(a){a=a|0;return}function Vt(a,b){a=a|0;b=b|0;var d=0,e=0;d=i;a=c[a+64>>2]|0;e=c[a+8>>2]|0;if((e|0)!=0){b=c[a+12>>2]|0;c[a+12>>2]=c[b>>2];c[a+8>>2]=e+ -1;e=b;i=d;return e|0}c[5004]=(c[5004]|0)+1;b=XE(b+19|0)|0;if((b|0)==0){e=0;i=d;return e|0}c[(b+19&-16)+ -4>>2]=b;e=b+19&-16;i=d;return e|0}function Wt(a,b){a=a|0;b=b|0;var d=0,e=0;d=i;a=c[a+64>>2]|0;if((b|0)==0){i=d;return}e=c[a+16>>2]|0;if(!(e>>>0>b>>>0)?(e+(aa(c[a>>2]|0,c[a+4>>2]|0)|0)|0)>>>0>b>>>0:0){c[b>>2]=c[a+12>>2];c[a+12>>2]=b;c[a+8>>2]=(c[a+8>>2]|0)+1;i=d;return}c[5006]=(c[5006]|0)+1;YE(c[b+ -4>>2]|0);i=d;return}function Xt(a){a=a|0;return c[a+12>>2]|0}function Yt(a,b){a=a|0;b=b|0;return c[(c[a+20>>2]|0)+(b<<2)>>2]|0}function Zt(a){a=a|0;if((c[a+12>>2]|0)==0)a=0;else a=c[a+20>>2]|0;return a|0}function _t(a){a=a|0;return c[a+68>>2]|0}function $t(a){a=a|0;return c[a+68>>2]|0}function au(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function bu(a,b){a=a|0;b=b|0;var d=0,e=0;d=i;e=c[a+8>>2]|0;rc[c[e+60>>2]&127](b,e,c[a+4>>2]|0);i=d;return 0}function cu(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function du(a,b,d){a=a|0;b=b|0;d=d|0;c[a+16>>2]=b;c[a+24>>2]=d;return}function eu(a,b,d){a=a|0;b=b|0;d=d|0;c[a+20>>2]=b;c[a+28>>2]=d;return}function fu(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,h=0,j=0.0;e=i;g[b+16>>2]=+g[a+4>>2];g[b+20>>2]=+g[a+8>>2];g[b+24>>2]=+g[a+12>>2];g[b+28>>2]=+g[a+16>>2];g[b+32>>2]=+g[a+20>>2];g[b+36>>2]=+g[a+24>>2];g[b+40>>2]=+g[a+28>>2];g[b+44>>2]=+g[a+32>>2];g[b+48>>2]=+g[a+36>>2];g[b+52>>2]=+g[a+40>>2];g[b+56>>2]=+g[a+44>>2];g[b+60>>2]=+g[a+48>>2];g[b+64>>2]=+g[a+52>>2];g[b+68>>2]=+g[a+56>>2];g[b+72>>2]=+g[a+60>>2];g[b+76>>2]=+g[a+64>>2];g[b+80>>2]=+g[a+68>>2];g[b+84>>2]=+g[a+72>>2];g[b+88>>2]=+g[a+76>>2];g[b+92>>2]=+g[a+80>>2];g[b+96>>2]=+g[a+84>>2];g[b+100>>2]=+g[a+88>>2];g[b+104>>2]=+g[a+92>>2];g[b+108>>2]=+g[a+96>>2];g[b+112>>2]=+g[a+100>>2];g[b+116>>2]=+g[a+104>>2];g[b+120>>2]=+g[a+108>>2];g[b+124>>2]=+g[a+112>>2];g[b+128>>2]=+g[a+116>>2];g[b+132>>2]=+g[a+120>>2];g[b+136>>2]=+g[a+124>>2];g[b+140>>2]=+g[a+128>>2];g[b+144>>2]=+g[a+132>>2];g[b+148>>2]=+g[a+136>>2];g[b+152>>2]=+g[a+140>>2];g[b+156>>2]=+g[a+144>>2];g[b+160>>2]=+g[a+148>>2];g[b+164>>2]=+g[a+152>>2];g[b+168>>2]=+g[a+156>>2];g[b+172>>2]=+g[a+160>>2];g[b+176>>2]=+g[a+164>>2];g[b+180>>2]=+g[a+168>>2];g[b+184>>2]=+g[a+172>>2];g[b+188>>2]=+g[a+176>>2];c[b+224>>2]=c[a+180>>2];g[b+192>>2]=+g[a+184>>2];c[b>>2]=0;c[b+4>>2]=gc[c[(c[d>>2]|0)+28>>2]&31](d,c[a+192>>2]|0)|0;c[b+8>>2]=0;c[b+228>>2]=c[a+204>>2];c[b+232>>2]=c[a+208>>2];c[b+236>>2]=c[a+212>>2];c[b+240>>2]=c[a+216>>2];g[b+196>>2]=+g[a+220>>2];g[b+200>>2]=+g[a+224>>2];g[b+204>>2]=+g[a+232>>2];g[b+208>>2]=+g[a+228>>2];c[b+244>>2]=c[a+236>>2];f=gc[c[(c[d>>2]|0)+40>>2]&31](d,a)|0;h=gc[c[(c[d>>2]|0)+28>>2]&31](d,f)|0;c[b+12>>2]=h;if((h|0)==0){d=a+244|0;j=+g[d>>2];d=b+212|0;g[d>>2]=j;d=a+248|0;j=+g[d>>2];d=b+216|0;g[d>>2]=j;d=a+252|0;j=+g[d>>2];d=b+220|0;g[d>>2]=j;d=a+256|0;d=c[d>>2]|0;h=b+248|0;c[h>>2]=d;i=e;return 7016}Nb[c[(c[d>>2]|0)+48>>2]&127](d,f);d=a+244|0;j=+g[d>>2];d=b+212|0;g[d>>2]=j;d=a+248|0;j=+g[d>>2];d=b+216|0;g[d>>2]=j;d=a+252|0;j=+g[d>>2];d=b+220|0;g[d>>2]=j;d=a+256|0;d=c[d>>2]|0;h=b+248|0;c[h>>2]=d;i=e;return 7016}function gu(a,b){a=a|0;b=b|0;var d=0,e=0,f=0;d=i;f=Pb[c[(c[a>>2]|0)+16>>2]&127](a)|0;f=Yb[c[(c[b>>2]|0)+16>>2]&31](b,f,1)|0;e=Yb[c[(c[a>>2]|0)+20>>2]&31](a,c[f+8>>2]|0,b)|0;Jb[c[(c[b>>2]|0)+20>>2]&31](b,f,e,1245859651,a);i=d;return}function hu(a,b){a=a|0;b=b|0;return 1}function iu(a){a=a|0;return 256}function ju(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0;e=i;i=i+96|0;g[e+32>>2]=1.0;c[e+36>>2]=0;c[e+40>>2]=0;c[e+44>>2]=0;c[e+48>>2]=0;g[e+52>>2]=1.0;c[e+56>>2]=0;c[e+60>>2]=0;c[e+64>>2]=0;c[e+68>>2]=0;g[e+72>>2]=1.0;n=e+76|0;c[n+0>>2]=0;c[n+4>>2]=0;c[n+8>>2]=0;c[n+12>>2]=0;c[n+16>>2]=0;vc[c[(c[a>>2]|0)+8>>2]&127](a,e+32|0,e+16|0,e);l=+g[e>>2];m=+g[e+16>>2];j=+g[e+4>>2];k=+g[e+20>>2];f=+g[e+8>>2];h=+g[e+24>>2];g[d>>2]=+Q(+((l-m)*(l-m)+(j-k)*(j-k)+(f-h)*(f-h)))*.5;g[b>>2]=(m+l)*.5;g[b+4>>2]=(k+j)*.5;g[b+8>>2]=(h+f)*.5;g[b+12>>2]=0.0;i=e;return}function ku(a,b){a=a|0;b=+b;var d=0;d=i;b=+$b[c[(c[a>>2]|0)+16>>2]&15](a)*b;i=d;return+b}function lu(a){a=a|0;var b=0,d=0.0,e=0.0,f=0.0;b=i;i=i+32|0;rc[c[(c[a>>2]|0)+12>>2]&127](a,b+8|0,b);f=+g[b+8>>2];e=+g[b+12>>2];d=+g[b+16>>2];d=+Q(+(f*f+e*e+d*d));i=b;return+(d+ +g[b>>2])}function mu(a,b,d,e,f,h){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0;j=i;vc[c[(c[a>>2]|0)+8>>2]&127](a,b,f,h);r=+g[h>>2];p=+g[h+4>>2];k=+g[h+8>>2];m=+g[f>>2];q=+g[f+4>>2];l=+g[f+8>>2];s=+g[d>>2];o=+g[d+4>>2];n=+g[d+8>>2];if(s>0.0)r=r+s;else m=m+s;if(o>0.0)p=p+o;else q=q+o;if(n>0.0)k=k+n;else l=l+n;n=+g[e>>2];o=+g[e+4>>2];s=+g[e+8>>2];s=+Q(+(n*n+o*o+s*s));s=s*+$b[c[(c[a>>2]|0)+16>>2]&15](a);g[f>>2]=m;g[f+4>>2]=q;g[f+8>>2]=l;g[f+12>>2]=0.0;g[h>>2]=r;g[h+4>>2]=p;g[h+8>>2]=k;g[h+12>>2]=0.0;g[f>>2]=+g[f>>2]-s;g[f+4>>2]=+g[f+4>>2]-s;g[f+8>>2]=+g[f+8>>2]-s;g[h>>2]=s+ +g[h>>2];g[h+4>>2]=s+ +g[h+4>>2];g[h+8>>2]=s+ +g[h+8>>2];i=j;return}function nu(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,g=0;e=i;f=gc[c[(c[d>>2]|0)+40>>2]&31](d,a)|0;g=gc[c[(c[d>>2]|0)+28>>2]&31](d,f)|0;c[b>>2]=g;if((g|0)!=0)Nb[c[(c[d>>2]|0)+48>>2]&127](d,f);c[b+4>>2]=c[a+4>>2];i=e;return 7080}function ou(a,b){a=a|0;b=b|0;var d=0,e=0,f=0;d=i;f=Pb[c[(c[a>>2]|0)+52>>2]&127](a)|0;f=Yb[c[(c[b>>2]|0)+16>>2]&31](b,f,1)|0;e=Yb[c[(c[a>>2]|0)+56>>2]&31](a,c[f+8>>2]|0,b)|0;Jb[c[(c[b>>2]|0)+20>>2]&31](b,f,e,1346455635,a);i=d;return}function pu(a){a=a|0;return 12}function qu(a){a=a|0;var b=0;b=i;ru(a);YE(a);i=b;return}function ru(b){b=b|0;var d=0,e=0,f=0,g=0,h=0,j=0;d=i;c[b>>2]=7144;e=c[b+8>>2]|0;g=c[b+16>>2]|0;if((e|0)>0){f=0;do{h=(c[g+(f<<2)>>2]|0)+188|0;j=c[h>>2]|0;if((j|0)!=0){e=c[b+68>>2]|0;e=Pb[c[(c[e>>2]|0)+36>>2]&127](e)|0;rc[c[(c[e>>2]|0)+40>>2]&127](e,j,c[b+24>>2]|0);e=c[b+68>>2]|0;rc[c[(c[e>>2]|0)+12>>2]&127](e,j,c[b+24>>2]|0);c[h>>2]=0;e=c[b+8>>2]|0;g=c[b+16>>2]|0}f=f+1|0}while((f|0)<(e|0))}if((g|0)==0){a[b+20>>0]=1;c[b+16>>2]=0;c[b+8>>2]=0;j=b+12|0;c[j>>2]=0;i=d;return}if((a[b+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[g+ -4>>2]|0)}c[b+16>>2]=0;a[b+20>>0]=1;c[b+16>>2]=0;c[b+8>>2]=0;j=b+12|0;c[j>>2]=0;i=d;return}function su(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var g=0,h=0,j=0,k=0,l=0,m=0;g=i;i=i+96|0;k=c[b+8>>2]|0;if((k|0)==(c[b+12>>2]|0)?(h=(k|0)==0?1:k<<1,(k|0)<(h|0)):0){if((h|0)==0)j=0;else{c[5004]=(c[5004]|0)+1;j=XE((h<<2|3)+16|0)|0;if((j|0)==0)j=0;else{c[(j+19&-16)+ -4>>2]=j;j=j+19&-16}k=c[b+8>>2]|0}if((k|0)>0){l=0;do{m=j+(l<<2)|0;if((m|0)!=0)c[m>>2]=c[(c[b+16>>2]|0)+(l<<2)>>2];l=l+1|0}while((l|0)!=(k|0))}l=c[b+16>>2]|0;if((l|0)!=0){if((a[b+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[l+ -4>>2]|0);k=c[b+8>>2]|0}c[b+16>>2]=0}a[b+20>>0]=1;c[b+16>>2]=j;c[b+12>>2]=h}h=(c[b+16>>2]|0)+(k<<2)|0;if((h|0)!=0)c[h>>2]=d;c[b+8>>2]=k+1;c[g+32>>2]=c[d+4>>2];c[g+36>>2]=c[d+8>>2];c[g+40>>2]=c[d+12>>2];c[g+44>>2]=c[d+16>>2];c[g+48>>2]=c[d+20>>2];c[g+52>>2]=c[d+24>>2];c[g+56>>2]=c[d+28>>2];c[g+60>>2]=c[d+32>>2];c[g+64>>2]=c[d+36>>2];c[g+68>>2]=c[d+40>>2];c[g+72>>2]=c[d+44>>2];c[g+76>>2]=c[d+48>>2];c[g+80>>2]=c[d+52>>2];c[g+84>>2]=c[d+56>>2];c[g+88>>2]=c[d+60>>2];c[g+92>>2]=c[d+64>>2];m=c[d+192>>2]|0;vc[c[(c[m>>2]|0)+8>>2]&127](m,g+32|0,g+16|0,g);m=c[b+68>>2]|0;c[d+188>>2]=pc[c[(c[m>>2]|0)+8>>2]&3](m,g+16|0,g,c[(c[d+192>>2]|0)+4>>2]|0,d,e,f,c[b+24>>2]|0,0)|0;i=g;return}function tu(b){b=b|0;var d=0,e=0,f=0,h=0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0,r=0;d=i;i=i+64|0;oE(7424);q=c[b+8>>2]|0;if((q|0)>0){f=0;do{h=c[(c[b+16>>2]|0)+(f<<2)>>2]|0;if(!((a[b+76>>0]|0)==0?(r=c[h+216>>2]|0,(r|0)==2|(r|0)==5):0)){r=c[h+192>>2]|0;vc[c[(c[r>>2]|0)+8>>2]&127](r,h+4|0,d+48|0,d+32|0);k=+g[d+48>>2]+-.019999999552965164;g[d+48>>2]=k;j=+g[d+52>>2]+-.019999999552965164;g[d+52>>2]=j;n=+g[d+56>>2]+-.019999999552965164;g[d+56>>2]=n;o=+g[d+32>>2]+.019999999552965164;g[d+32>>2]=o;m=+g[d+36>>2]+.019999999552965164;g[d+36>>2]=m;l=+g[d+40>>2]+.019999999552965164;g[d+40>>2]=l;if(((a[b+44>>0]|0)!=0?(c[h+236>>2]|0)==2:0)?(c[h+204>>2]&3|0)==0:0){r=c[h+192>>2]|0;vc[c[(c[r>>2]|0)+8>>2]&127](r,h+68|0,d+16|0,d);k=+g[d+16>>2]+-.019999999552965164;g[d+16>>2]=k;j=+g[d+20>>2]+-.019999999552965164;g[d+20>>2]=j;n=+g[d+24>>2]+-.019999999552965164;g[d+24>>2]=n;o=+g[d>>2]+.019999999552965164;g[d>>2]=o;m=+g[d+4>>2]+.019999999552965164;g[d+4>>2]=m;l=+g[d+8>>2]+.019999999552965164;g[d+8>>2]=l;p=+g[d+48>>2];if(k<p)g[d+48>>2]=k;else k=p;p=+g[d+52>>2];if(j<p)g[d+52>>2]=j;else j=p;p=+g[d+56>>2];if(n<p)g[d+56>>2]=n;else n=p;p=+g[d+28>>2];if(p<+g[d+60>>2])g[d+60>>2]=p;p=+g[d+32>>2];if(p<o)g[d+32>>2]=o;else o=p;p=+g[d+36>>2];if(p<m)g[d+36>>2]=m;else m=p;p=+g[d+40>>2];if(p<l)g[d+40>>2]=l;else l=p;p=+g[d+12>>2];if(+g[d+44>>2]<p)g[d+44>>2]=p}q=c[b+68>>2]|0;if((c[h+204>>2]&1|0)==0?(k=o-k,o=m-j,p=l-n,!(k*k+o*o+p*p<999999995904.0)):0){if(!(((c[h+216>>2]|0)+ -4|0)>>>0<2))c[h+216>>2]=5;if((a[7200]|0)!=0?(e=c[b+72>>2]|0,(e|0)!=0):0){a[7200]=0;Nb[c[(c[e>>2]|0)+36>>2]&127](e,7208);r=c[b+72>>2]|0;Nb[c[(c[r>>2]|0)+36>>2]&127](r,7264);r=c[b+72>>2]|0;Nb[c[(c[r>>2]|0)+36>>2]&127](r,7336);r=c[b+72>>2]|0;Nb[c[(c[r>>2]|0)+36>>2]&127](r,7408)}}else Jb[c[(c[q>>2]|0)+16>>2]&31](q,c[h+188>>2]|0,d+48|0,d+32|0,c[b+24>>2]|0);q=c[b+8>>2]|0}f=f+1|0}while((f|0)<(q|0))}b=c[5022]|0;r=(c[b+16>>2]|0)+ -1|0;c[b+16>>2]=r;if((r|0)!=0){i=d;return}do if((c[b+4>>2]|0)!=0){Eb(d+48|0,0)|0;r=c[5008]|0;g[b+8>>2]=+(((c[d+52>>2]|0)-(c[r+4>>2]|0)+(((c[d+48>>2]|0)-(c[r>>2]|0)|0)*1e6|0)-(c[b+12>>2]|0)|0)>>>0)/1.0e3+ +g[b+8>>2];if((c[b+16>>2]|0)==0){b=c[5022]|0;break}else{i=d;return}}while(0);c[5022]=c[b+20>>2];i=d;return}function uu(a){a=a|0;var b=0,d=0;b=i;i=i+16|0;oE(7440);d=c[a+68>>2]|0;Nb[c[(c[d>>2]|0)+32>>2]&127](d,c[a+24>>2]|0);a=c[5022]|0;d=(c[a+16>>2]|0)+ -1|0;c[a+16>>2]=d;if((d|0)!=0){i=b;return}do if((c[a+4>>2]|0)!=0){Eb(b|0,0)|0;d=c[5008]|0;g[a+8>>2]=+(((c[b+4>>2]|0)-(c[d+4>>2]|0)+(((c[b>>2]|0)-(c[d>>2]|0)|0)*1e6|0)-(c[a+12>>2]|0)|0)>>>0)/1.0e3+ +g[a+8>>2];if((c[a+16>>2]|0)==0){a=c[5022]|0;break}else{i=b;return}}while(0);c[5022]=c[a+20>>2];i=b;return}function vu(a){a=a|0;var b=0,d=0,e=0,f=0;b=i;i=i+16|0;oE(7472);Lb[c[(c[a>>2]|0)+8>>2]&511](a);Lb[c[(c[a>>2]|0)+12>>2]&511](a);d=c[a+24>>2]|0;oE(7512);if((d|0)!=0){f=c[(c[d>>2]|0)+32>>2]|0;e=c[a+68>>2]|0;e=Pb[c[(c[e>>2]|0)+36>>2]&127](e)|0;vc[f&127](d,e,a+28|0,c[a+24>>2]|0)}a=c[5022]|0;f=(c[a+16>>2]|0)+ -1|0;c[a+16>>2]=f;do if((f|0)==0){if((c[a+4>>2]|0)!=0){Eb(b|0,0)|0;d=c[5008]|0;g[a+8>>2]=+(((c[b+4>>2]|0)-(c[d+4>>2]|0)+(((c[b>>2]|0)-(c[d>>2]|0)|0)*1e6|0)-(c[a+12>>2]|0)|0)>>>0)/1.0e3+ +g[a+8>>2];d=c[5022]|0;if((c[a+16>>2]|0)==0)a=d;else{a=d;break}}a=c[a+20>>2]|0;c[5022]=a}while(0);d=a+16|0;f=(c[d>>2]|0)+ -1|0;c[d>>2]=f;if((f|0)!=0){i=b;return}do if((c[a+4>>2]|0)!=0){Eb(b|0,0)|0;e=c[5008]|0;f=a+8|0;g[f>>2]=+(((c[b+4>>2]|0)-(c[e+4>>2]|0)+(((c[b>>2]|0)-(c[e>>2]|0)|0)*1e6|0)-(c[a+12>>2]|0)|0)>>>0)/1.0e3+ +g[f>>2];if((c[d>>2]|0)==0){a=c[5022]|0;break}else{i=b;return}}while(0);c[5022]=c[a+20>>2];i=b;return}function wu(a,b){a=a|0;b=b|0;var d=0,e=0,f=0,g=0,h=0,j=0,k=0;e=i;f=c[b+188>>2]|0;if((f|0)!=0){k=c[a+68>>2]|0;k=Pb[c[(c[k>>2]|0)+36>>2]&127](k)|0;rc[c[(c[k>>2]|0)+40>>2]&127](k,f,c[a+24>>2]|0);k=c[a+68>>2]|0;rc[c[(c[k>>2]|0)+12>>2]&127](k,f,c[a+24>>2]|0);c[b+188>>2]=0}f=c[a+8>>2]|0;if((f|0)<=0){i=e;return}g=c[a+16>>2]|0;h=0;while(1){j=g+(h<<2)|0;k=h+1|0;if((c[j>>2]|0)==(b|0))break;if((k|0)<(f|0))h=k;else{d=9;break}}if((d|0)==9){i=e;return}if((h|0)>=(f|0)){i=e;return}c[j>>2]=c[g+(f+ -1<<2)>>2];c[(c[a+16>>2]|0)+(f+ -1<<2)>>2]=b;c[a+8>>2]=f+ -1;i=e;return}function xu(d,e,f,h){d=d|0;e=e|0;f=f|0;h=h|0;var j=0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0,z=0,A=0,B=0,C=0,D=0,E=0.0,F=0.0,G=0.0,H=0.0,I=0,J=0,K=0.0,L=0.0;j=i;i=i+1392|0;c[j+1192>>2]=0;g[j+1196>>2]=1.0;g[j+1200>>2]=1.0;g[j+1204>>2]=1.0;g[j+1208>>2]=0.0;c[j+1184>>2]=16680;c[j+1188>>2]=8;g[j+1212>>2]=0.0;g[j+1228>>2]=0.0;z=c[f+4>>2]|0;y=c[f+12>>2]|0;A=c[z+4>>2]|0;if((A|0)<20){c[j+1008>>2]=9440;c[j+1176>>2]=0;g[j+1180>>2]=0.0;g[j+1172>>2]=+g[h+4>>2];g[j+956>>2]=9999999747378752.0e-20;a[j+980>>0]=0;c[j+632>>2]=17152;c[j+636>>2]=j+648;c[j+640>>2]=j+1184;c[j+644>>2]=z;c[j+616>>2]=13184;c[j+620>>2]=j+648;c[j+624>>2]=j+1184;c[j+628>>2]=z;J=(c[h+16>>2]&4|0)==0?j+616|0:j+632|0;if(!(ac[c[(c[J>>2]|0)+8>>2]&3](J,d,e,y,y,j+1008|0)|0)){i=j;return}y=j+1140|0;m=+g[y>>2];k=+g[j+1144>>2];n=+g[j+1148>>2];if(!(m*m+k*k+n*n>9999999747378752.0e-20)){i=j;return}l=+g[j+1172>>2];if(!(l<+g[h+4>>2])){i=j;return}H=1.0/+Q(+(m*m+k*k+n*n));g[y>>2]=m*H;g[j+1144>>2]=k*H;g[j+1148>>2]=n*H;c[j+584>>2]=c[f+8>>2];c[j+588>>2]=0;c[j+592>>2]=c[y+0>>2];c[j+596>>2]=c[y+4>>2];c[j+600>>2]=c[y+8>>2];c[j+604>>2]=c[y+12>>2];g[j+608>>2]=l;+hc[c[(c[h>>2]|0)+12>>2]&15](h,j+584|0,1);i=j;return}if((A+ -21|0)>>>0<9){t=+g[y>>2];u=+g[y+16>>2];s=+g[y+32>>2];v=+g[y+4>>2];w=+g[y+20>>2];r=+g[y+36>>2];G=+g[y+8>>2];H=+g[y+24>>2];q=+g[y+40>>2];x=-+g[y+48>>2];E=-+g[y+52>>2];F=-+g[y+56>>2];n=+g[d+48>>2];o=+g[d+52>>2];p=+g[d+56>>2];g[j+568>>2]=t*x+u*E+s*F+(t*n+u*o+s*p);g[j+572>>2]=v*x+w*E+r*F+(v*n+w*o+r*p);g[j+576>>2]=G*x+H*E+q*F+(G*n+H*o+q*p);g[j+580>>2]=0.0;l=+g[e+48>>2];k=+g[e+52>>2];m=+g[e+56>>2];s=t*x+u*E+s*F+(t*l+u*k+s*m);r=v*x+w*E+r*F+(v*l+w*k+r*m);q=G*x+H*E+q*F+(G*l+H*k+q*m);g[j+552>>2]=s;g[j+556>>2]=r;g[j+560>>2]=q;g[j+564>>2]=0.0;e=c[z+4>>2]|0;if((e|0)==25){J=c[f+8>>2]|0;I=c[h+16>>2]|0;c[j+316>>2]=c[j+568>>2];c[j+320>>2]=c[j+572>>2];c[j+324>>2]=c[j+576>>2];c[j+328>>2]=c[j+580>>2];c[j+332>>2]=c[j+552>>2];c[j+336>>2]=c[j+556>>2];c[j+340>>2]=c[j+560>>2];c[j+344>>2]=c[j+564>>2];c[j+348>>2]=I;g[j+352>>2]=1.0;c[j+312>>2]=9248;c[j+356>>2]=h;c[j+360>>2]=J;c[j+364>>2]=z;c[j+368>>2]=c[y+0>>2];c[j+372>>2]=c[y+4>>2];c[j+376>>2]=c[y+8>>2];c[j+380>>2]=c[y+12>>2];c[j+384>>2]=c[y+16>>2];c[j+388>>2]=c[y+20>>2];c[j+392>>2]=c[y+24>>2];c[j+396>>2]=c[y+28>>2];c[j+400>>2]=c[y+32>>2];c[j+404>>2]=c[y+36>>2];c[j+408>>2]=c[y+40>>2];c[j+412>>2]=c[y+44>>2];c[j+416>>2]=c[y+48>>2];c[j+420>>2]=c[y+52>>2];c[j+424>>2]=c[y+56>>2];c[j+428>>2]=c[y+60>>2];g[j+352>>2]=+g[h+4>>2];vc[c[(c[z>>2]|0)+144>>2]&127](z,j+312|0,j+568|0,j+552|0);i=j;return}else if((e|0)==21){J=c[f+8>>2]|0;I=c[h+16>>2]|0;c[j+436>>2]=c[j+568>>2];c[j+440>>2]=c[j+572>>2];c[j+444>>2]=c[j+576>>2];c[j+448>>2]=c[j+580>>2];c[j+452>>2]=c[j+552>>2];c[j+456>>2]=c[j+556>>2];c[j+460>>2]=c[j+560>>2];c[j+464>>2]=c[j+564>>2];c[j+468>>2]=I;g[j+472>>2]=1.0;c[j+432>>2]=9248;c[j+476>>2]=h;c[j+480>>2]=J;c[j+484>>2]=z;c[j+488>>2]=c[y+0>>2];c[j+492>>2]=c[y+4>>2];c[j+496>>2]=c[y+8>>2];c[j+500>>2]=c[y+12>>2];c[j+504>>2]=c[y+16>>2];c[j+508>>2]=c[y+20>>2];c[j+512>>2]=c[y+24>>2];c[j+516>>2]=c[y+28>>2];c[j+520>>2]=c[y+32>>2];c[j+524>>2]=c[y+36>>2];c[j+528>>2]=c[y+40>>2];c[j+532>>2]=c[y+44>>2];c[j+536>>2]=c[y+48>>2];c[j+540>>2]=c[y+52>>2];c[j+544>>2]=c[y+56>>2];c[j+548>>2]=c[y+60>>2];g[j+472>>2]=+g[h+4>>2];h=c[z+48>>2]|0;c[j+1272>>2]=6152;c[j+1276>>2]=h;c[j+1280>>2]=j+432;h=c[z+52>>2]|0;c[j+1328>>2]=0;c[j+1332>>2]=0;c[j+1336>>2]=0;c[j+1340>>2]=0;c[j+1304>>2]=0;c[j+1308>>2]=0;c[j+1312>>2]=0;c[j+1316>>2]=0;if((a[h+60>>0]|0)==0){EA(h,j+1272|0,j+568|0,s,r,q,j+1328|0,j+1304|0);i=j;return}else{FA(h,j+1272|0,j+568|0,s,r,q,j+1328|0,j+1304|0,c[h+56>>2]|0);i=j;return}}else{L=+g[y>>2];K=+g[y+16>>2];s=+g[y+32>>2];t=+g[y+4>>2];u=+g[y+20>>2];v=+g[y+36>>2];F=+g[y+8>>2];G=+g[y+24>>2];H=+g[y+40>>2];w=-+g[y+48>>2];x=-+g[y+52>>2];E=-+g[y+56>>2];r=L*w+K*x+s*E+(L*n+K*o+s*p);q=t*w+u*x+v*E+(t*n+u*o+v*p);o=F*w+G*x+H*E+(F*n+G*o+H*p);p=L*w+K*x+s*E+(L*l+K*k+s*m);n=t*w+u*x+v*E+(t*l+u*k+v*m);k=F*w+G*x+H*E+(F*l+G*k+H*m);J=c[f+8>>2]|0;I=c[h+16>>2]|0;g[j+196>>2]=r;g[j+200>>2]=q;g[j+204>>2]=o;g[j+208>>2]=0.0;g[j+212>>2]=p;g[j+216>>2]=n;g[j+220>>2]=k;g[j+224>>2]=0.0;c[j+228>>2]=I;g[j+232>>2]=1.0;c[j+192>>2]=9056;c[j+236>>2]=h;c[j+240>>2]=J;c[j+244>>2]=z;c[j+248>>2]=c[y+0>>2];c[j+252>>2]=c[y+4>>2];c[j+256>>2]=c[y+8>>2];c[j+260>>2]=c[y+12>>2];c[j+264>>2]=c[y+16>>2];c[j+268>>2]=c[y+20>>2];c[j+272>>2]=c[y+24>>2];c[j+276>>2]=c[y+28>>2];c[j+280>>2]=c[y+32>>2];c[j+284>>2]=c[y+36>>2];c[j+288>>2]=c[y+40>>2];c[j+292>>2]=c[y+44>>2];c[j+296>>2]=c[y+48>>2];c[j+300>>2]=c[y+52>>2];c[j+304>>2]=c[y+56>>2];c[j+308>>2]=c[y+60>>2];g[j+232>>2]=+g[h+4>>2];g[j+176>>2]=r;g[j+180>>2]=q;g[j+184>>2]=o;g[j+188>>2]=0.0;if(p<r)g[j+176>>2]=p;if(n<q)g[j+180>>2]=n;if(k<o)g[j+184>>2]=k;g[j+160>>2]=r;g[j+164>>2]=q;g[j+168>>2]=o;g[j+172>>2]=0.0;if(r<p)g[j+160>>2]=p;if(q<n)g[j+164>>2]=n;if(o<k)g[j+168>>2]=k;vc[c[(c[z>>2]|0)+64>>2]&127](z,j+192|0,j+176|0,j+160|0);i=j;return}}if((A|0)!=31){i=j;return}A=c[z+64>>2]|0;J=c[f+8>>2]|0;c[j+128>>2]=8840;c[j+132>>2]=J;c[j+136>>2]=z;c[j+140>>2]=y;c[j+144>>2]=d;c[j+148>>2]=e;c[j+152>>2]=h;if((A|0)==0){h=c[z+16>>2]|0;if((h|0)<=0){i=j;return}f=0;while(1){J=c[z+24>>2]|0;I=c[J+(f*80|0)+64>>2]|0;co(j+1328|0,y,J+(f*80|0)|0);J=c[j+132>>2]|0;c[j+1304>>2]=0;c[j+1308>>2]=I;c[j+1312>>2]=J;c[j+1316>>2]=j+1328;c[j+1320>>2]=-1;c[j+1324>>2]=f;J=c[j+152>>2]|0;g[j+1276>>2]=1.0;c[j+1280>>2]=0;b[j+1284>>1]=1;b[j+1286>>1]=-1;c[j+1288>>2]=0;c[j+1272>>2]=8664;c[j+1292>>2]=J;c[j+1296>>2]=f;g[j+1276>>2]=+g[J+4>>2];c[j+1288>>2]=c[J+16>>2];xu(c[j+144>>2]|0,c[j+148>>2]|0,j+1304|0,j+1272|0);f=f+1|0;if((f|0)>=(h|0))break;z=c[j+136>>2]|0;y=c[j+140>>2]|0}i=j;return}zu(j+64|0,y,d);p=+g[j+112>>2];q=+g[j+116>>2];o=+g[j+120>>2];zu(j,y,e);z=c[A>>2]|0;if((z|0)==0){i=j;return}r=+g[j+48>>2]-p;t=+g[j+52>>2]-q;u=+g[j+56>>2]-o;s=1.0/+Q(+(r*r+t*t+u*u));if(r*s==0.0)v=999999984306749400.0;else v=1.0/(r*s);if(t*s==0.0)w=999999984306749400.0;else w=1.0/(t*s);if(u*s==0.0)x=999999984306749400.0;else x=1.0/(u*s);h=v<0.0&1;y=w<0.0&1;f=x<0.0&1;c[5004]=(c[5004]|0)+1;e=XE(531)|0;if((e|0)==0)C=0;else{c[(e+19&-16)+ -4>>2]=e;C=e+19&-16}d=0;do{e=C+(d<<2)|0;if((e|0)!=0)c[e>>2]=0;d=d+1|0}while((d|0)!=128);c[C>>2]=z;A=128;D=128;z=1;B=126;do{e=z+ -1|0;d=c[C+(e<<2)>>2]|0;c[j+1240>>2]=c[d+0>>2];c[j+1244>>2]=c[d+4>>2];c[j+1248>>2]=c[d+8>>2];c[j+1252>>2]=c[d+12>>2];c[j+1256>>2]=c[d+16>>2];c[j+1260>>2]=c[d+20>>2];c[j+1264>>2]=c[d+24>>2];c[j+1268>>2]=c[d+28>>2];G=v*(+g[j+1240+(h<<4)>>2]-p);E=v*(+g[j+1240+((h^1)<<4)>>2]-p);H=w*(+g[j+1240+(y<<4)+4>>2]-q);F=w*(+g[j+1240+((y^1)<<4)+4>>2]-q);do if(((!(G>F|H>E)?(n=H>G?H:G,l=F<E?F:E,m=x*(+g[j+1240+(f<<4)+8>>2]-o),k=x*(+g[j+1240+((f^1)<<4)+8>>2]-o),!(n>k|m>l)):0)?(m>n?m:n)<r*s*r+t*s*t+u*s*u:0)?(k<l?k:l)>0.0:0){if((c[d+40>>2]|0)==0){Nb[c[(c[j+128>>2]|0)+12>>2]&127](j+128|0,d);z=e;break}if((e|0)>(B|0)){B=A<<1;if((A|0)<(B|0)){do if((D|0)<(B|0)){do if((A|0)==0)D=0;else{c[5004]=(c[5004]|0)+1;D=XE((A<<3|3)+16|0)|0;if((D|0)==0)D=0;else{c[(D+19&-16)+ -4>>2]=D;D=D+19&-16}if((A|0)>0)I=0;else break;do{J=D+(I<<2)|0;if((J|0)!=0)c[J>>2]=c[C+(I<<2)>>2];I=I+1|0}while((I|0)!=(A|0))}while(0);if((C|0)==0){C=D;D=B;break}c[5006]=(c[5006]|0)+1;YE(c[C+ -4>>2]|0);C=D;D=B}while(0);do{I=C+(A<<2)|0;if((I|0)!=0)c[I>>2]=0;A=A+1|0}while((A|0)!=(B|0))}A=B;B=B+ -2|0}c[C+(e<<2)>>2]=c[d+36>>2];c[C+(z<<2)>>2]=c[d+40>>2];z=z+1|0}else z=e;while(0)}while((z|0)!=0);if((C|0)==0){i=j;return}c[5006]=(c[5006]|0)+1;YE(c[C+ -4>>2]|0);i=j;return}function yu(a){a=a|0;return}function zu(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,h=0.0,i=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0;j=+g[c+48>>2]- +g[b+48>>2];h=+g[c+52>>2]- +g[b+52>>2];e=+g[c+56>>2]- +g[b+56>>2];p=+g[b>>2];y=+g[c>>2];o=+g[b+16>>2];x=+g[c+16>>2];n=+g[b+32>>2];w=+g[c+32>>2];v=+g[c+4>>2];u=+g[c+20>>2];t=+g[c+36>>2];s=+g[c+8>>2];r=+g[c+24>>2];q=+g[c+40>>2];m=+g[b+4>>2];l=+g[b+20>>2];k=+g[b+36>>2];i=+g[b+8>>2];f=+g[b+24>>2];d=+g[b+40>>2];g[a>>2]=p*y+o*x+n*w;g[a+4>>2]=p*v+o*u+n*t;g[a+8>>2]=p*s+o*r+n*q;g[a+12>>2]=0.0;g[a+16>>2]=y*m+x*l+w*k;g[a+20>>2]=v*m+u*l+t*k;g[a+24>>2]=s*m+r*l+q*k;g[a+28>>2]=0.0;g[a+32>>2]=y*i+x*f+w*d;g[a+36>>2]=v*i+u*f+t*d;g[a+40>>2]=s*i+r*f+q*d;g[a+44>>2]=0.0;g[a+48>>2]=j*p+h*o+e*n;g[a+52>>2]=j*m+h*l+e*k;g[a+56>>2]=j*i+h*f+e*d;g[a+60>>2]=0.0;return}function Au(d,e,f,h,j,k){d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;k=+k;var l=0,m=0,n=0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0,E=0,F=0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0;l=i;i=i+1664|0;m=c[h+4>>2]|0;n=c[h+12>>2]|0;D=c[m+4>>2]|0;if((D|0)<20){c[l+1424>>2]=9440;c[l+1592>>2]=0;g[l+1596>>2]=k;g[l+1588>>2]=+g[j+4>>2];g[l+1372>>2]=9999999747378752.0e-20;a[l+1396>>0]=0;c[l+1056>>2]=13248;c[l+1032>>2]=10152;c[l+1036>>2]=l+1064;c[l+1040>>2]=l+1056;c[l+1044>>2]=d;c[l+1048>>2]=m;c[l+1052>>2]=0;if(!(nw(l+1032|0,e,f,n,n,l+1424|0)|0)){i=l;return}m=l+1556|0;q=+g[m>>2];p=+g[l+1560>>2];o=+g[l+1564>>2];if(!(q*q+p*p+o*o>9999999747378752.0e-20)){i=l;return}k=+g[l+1588>>2];if(!(k<+g[j+4>>2])){i=l;return}C=1.0/+Q(+(q*q+p*p+o*o));g[m>>2]=q*C;g[l+1560>>2]=p*C;g[l+1564>>2]=o*C;c[l+984>>2]=c[h+8>>2];c[l+988>>2]=0;c[l+992>>2]=c[m+0>>2];c[l+996>>2]=c[m+4>>2];c[l+1e3>>2]=c[m+8>>2];c[l+1004>>2]=c[m+12>>2];c[l+1008>>2]=c[l+1572>>2];c[l+1012>>2]=c[l+1576>>2];c[l+1016>>2]=c[l+1580>>2];c[l+1020>>2]=c[l+1584>>2];g[l+1024>>2]=k;+hc[c[(c[j>>2]|0)+12>>2]&15](j,l+984|0,1);i=l;return}if(!((D+ -21|0)>>>0<9)){if((D|0)!=31){i=l;return}oE(7544);if((c[m+16>>2]|0)>0){D=0;do{F=c[m+24>>2]|0;o=+g[F+(D*80|0)>>2];r=+g[F+(D*80|0)+4>>2];u=+g[F+(D*80|0)+8>>2];p=+g[F+(D*80|0)+16>>2];s=+g[F+(D*80|0)+20>>2];w=+g[F+(D*80|0)+24>>2];q=+g[F+(D*80|0)+32>>2];t=+g[F+(D*80|0)+36>>2];y=+g[F+(D*80|0)+40>>2];N=+g[F+(D*80|0)+48>>2];M=+g[F+(D*80|0)+52>>2];C=+g[F+(D*80|0)+56>>2];F=c[F+(D*80|0)+64>>2]|0;L=+g[n>>2];K=+g[n+4>>2];J=+g[n+8>>2];I=+g[n+16>>2];H=+g[n+20>>2];G=+g[n+24>>2];v=+g[n+32>>2];x=+g[n+36>>2];z=+g[n+40>>2];A=N*L+M*K+C*J+ +g[n+48>>2];B=N*I+M*H+C*G+ +g[n+52>>2];C=N*v+M*x+C*z+ +g[n+56>>2];g[l+1600>>2]=o*L+p*K+q*J;g[l+1604>>2]=r*L+s*K+t*J;g[l+1608>>2]=u*L+w*K+y*J;g[l+1612>>2]=0.0;g[l+1616>>2]=o*I+p*H+q*G;g[l+1620>>2]=r*I+s*H+t*G;g[l+1624>>2]=u*I+w*H+y*G;g[l+1628>>2]=0.0;g[l+1632>>2]=o*v+p*x+q*z;g[l+1636>>2]=r*v+s*x+t*z;g[l+1640>>2]=u*v+w*x+y*z;g[l+1644>>2]=0.0;g[l+1648>>2]=A;g[l+1652>>2]=B;g[l+1656>>2]=C;g[l+1660>>2]=0.0;b[l+32>>1]=1;b[l+34>>1]=-1;c[l+24>>2]=8024;c[l+36>>2]=j;c[l+40>>2]=D;g[l+28>>2]=+g[j+4>>2];E=c[h+8>>2]|0;c[l>>2]=h;c[l+4>>2]=F;c[l+8>>2]=E;c[l+12>>2]=l+1600;c[l+16>>2]=-1;c[l+20>>2]=D;Au(d,e,f,l,l+24|0,k);D=D+1|0}while((D|0)<(c[m+16>>2]|0))}h=c[5022]|0;F=(c[h+16>>2]|0)+ -1|0;c[h+16>>2]=F;if((F|0)!=0){i=l;return}do if((c[h+4>>2]|0)!=0){Eb(l+1600|0,0)|0;F=c[5008]|0;g[h+8>>2]=+(((c[l+1604>>2]|0)-(c[F+4>>2]|0)+(((c[l+1600>>2]|0)-(c[F>>2]|0)|0)*1e6|0)-(c[h+12>>2]|0)|0)>>>0)/1.0e3+ +g[h+8>>2];if((c[h+16>>2]|0)==0){h=c[5022]|0;break}else{i=l;return}}while(0);c[5022]=c[h+20>>2];i=l;return}if((D|0)==21){v=+g[n>>2];p=+g[n+16>>2];q=+g[n+32>>2];r=+g[n+4>>2];s=+g[n+20>>2];t=+g[n+36>>2];C=+g[n+8>>2];A=+g[n+24>>2];y=+g[n+40>>2];u=-+g[n+48>>2];o=-+g[n+52>>2];w=-+g[n+56>>2];x=+g[e+48>>2];z=+g[e+52>>2];B=+g[e+56>>2];g[l+968>>2]=v*u+p*o+q*w+(v*x+p*z+q*B);g[l+972>>2]=r*u+s*o+t*w+(r*x+s*z+t*B);g[l+976>>2]=C*u+A*o+y*w+(C*x+A*z+y*B);g[l+980>>2]=0.0;B=+g[f+48>>2];z=+g[f+52>>2];x=+g[f+56>>2];O=+g[f>>2];G=+g[f+16>>2];H=+g[f+32>>2];I=+g[f+4>>2];J=+g[f+20>>2];K=+g[f+36>>2];L=+g[f+8>>2];M=+g[f+24>>2];N=+g[f+40>>2];g[l+904>>2]=v*O+p*G+q*H;g[l+908>>2]=v*I+p*J+q*K;g[l+912>>2]=v*L+p*M+q*N;g[l+916>>2]=0.0;g[l+920>>2]=r*O+s*G+t*H;g[l+924>>2]=r*I+s*J+t*K;g[l+928>>2]=r*L+s*M+t*N;g[l+932>>2]=0.0;g[l+936>>2]=C*O+A*G+y*H;g[l+940>>2]=C*I+A*J+y*K;g[l+944>>2]=C*L+A*M+y*N;F=l+948|0;c[F+0>>2]=0;c[F+4>>2]=0;c[F+8>>2]=0;c[F+12>>2]=0;c[F+16>>2]=0;h=c[h+8>>2]|0;N=+$b[c[(c[m>>2]|0)+48>>2]&15](m);c[l+680>>2]=16256;c[l+684>>2]=d;c[l+688>>2]=c[e+0>>2];c[l+692>>2]=c[e+4>>2];c[l+696>>2]=c[e+8>>2];c[l+700>>2]=c[e+12>>2];c[l+704>>2]=c[e+16>>2];c[l+708>>2]=c[e+20>>2];c[l+712>>2]=c[e+24>>2];c[l+716>>2]=c[e+28>>2];c[l+720>>2]=c[e+32>>2];c[l+724>>2]=c[e+36>>2];c[l+728>>2]=c[e+40>>2];c[l+732>>2]=c[e+44>>2];c[l+736>>2]=c[e+48>>2];c[l+740>>2]=c[e+52>>2];c[l+744>>2]=c[e+56>>2];c[l+748>>2]=c[e+60>>2];c[l+752>>2]=c[f+0>>2];c[l+756>>2]=c[f+4>>2];c[l+760>>2]=c[f+8>>2];c[l+764>>2]=c[f+12>>2];c[l+768>>2]=c[f+16>>2];c[l+772>>2]=c[f+20>>2];c[l+776>>2]=c[f+24>>2];c[l+780>>2]=c[f+28>>2];c[l+784>>2]=c[f+32>>2];c[l+788>>2]=c[f+36>>2];c[l+792>>2]=c[f+40>>2];c[l+796>>2]=c[f+44>>2];c[l+800>>2]=c[f+48>>2];c[l+804>>2]=c[f+52>>2];c[l+808>>2]=c[f+56>>2];c[l+812>>2]=c[f+60>>2];c[l+816>>2]=c[n+0>>2];c[l+820>>2]=c[n+4>>2];c[l+824>>2]=c[n+8>>2];c[l+828>>2]=c[n+12>>2];c[l+832>>2]=c[n+16>>2];c[l+836>>2]=c[n+20>>2];c[l+840>>2]=c[n+24>>2];c[l+844>>2]=c[n+28>>2];c[l+848>>2]=c[n+32>>2];c[l+852>>2]=c[n+36>>2];c[l+856>>2]=c[n+40>>2];c[l+860>>2]=c[n+44>>2];c[l+864>>2]=c[n+48>>2];c[l+868>>2]=c[n+52>>2];c[l+872>>2]=c[n+56>>2];c[l+876>>2]=c[n+60>>2];g[l+884>>2]=N;c[l+680>>2]=8448;c[l+892>>2]=j;c[l+896>>2]=h;c[l+900>>2]=m;g[l+880>>2]=+g[j+4>>2];g[l+888>>2]=k;vc[c[(c[d>>2]|0)+8>>2]&127](d,l+904|0,l+664|0,l+648|0);h=c[m+48>>2]|0;c[l+1600>>2]=5992;c[l+1604>>2]=h;c[l+1608>>2]=l+680;h=c[m+52>>2]|0;if((a[h+60>>0]|0)==0){EA(h,l+1600|0,l+968|0,v*u+p*o+q*w+(v*B+p*z+q*x),r*u+s*o+t*w+(r*B+s*z+t*x),C*u+A*o+y*w+(C*B+A*z+y*x),l+664|0,l+648|0);i=l;return}else{FA(h,l+1600|0,l+968|0,v*u+p*o+q*w+(v*B+p*z+q*x),r*u+s*o+t*w+(r*B+s*z+t*x),C*u+A*o+y*w+(C*B+A*z+y*x),l+664|0,l+648|0,c[h+56>>2]|0);i=l;return}}else if((D|0)==28){c[l+472>>2]=9440;c[l+640>>2]=0;g[l+644>>2]=k;g[l+636>>2]=+g[j+4>>2];c[l+448>>2]=10152;c[l+452>>2]=0;c[l+456>>2]=0;c[l+460>>2]=d;c[l+464>>2]=0;c[l+468>>2]=m;if(!(nw(l+448|0,e,f,n,n,l+472|0)|0)){i=l;return}m=l+604|0;k=+g[m>>2];o=+g[l+608>>2];p=+g[l+612>>2];if(!(k*k+o*o+p*p>9999999747378752.0e-20)){i=l;return}q=+g[l+636>>2];if(!(q<+g[j+4>>2])){i=l;return}O=1.0/+Q(+(k*k+o*o+p*p));g[m>>2]=k*O;g[l+608>>2]=o*O;g[l+612>>2]=p*O;c[l+400>>2]=c[h+8>>2];c[l+404>>2]=0;c[l+408>>2]=c[m+0>>2];c[l+412>>2]=c[m+4>>2];c[l+416>>2]=c[m+8>>2];c[l+420>>2]=c[m+12>>2];c[l+424>>2]=c[l+620>>2];c[l+428>>2]=c[l+624>>2];c[l+432>>2]=c[l+628>>2];c[l+436>>2]=c[l+632>>2];g[l+440>>2]=q;+hc[c[(c[j>>2]|0)+12>>2]&15](j,l+400|0,1);i=l;return}else{u=+g[n>>2];v=+g[n+16>>2];w=+g[n+32>>2];x=+g[n+4>>2];y=+g[n+20>>2];z=+g[n+36>>2];J=+g[n+8>>2];L=+g[n+24>>2];N=+g[n+40>>2];H=-+g[n+48>>2];G=-+g[n+52>>2];C=-+g[n+56>>2];A=+g[e+48>>2];B=+g[e+52>>2];p=+g[e+56>>2];t=u*H+v*G+w*C+(u*A+v*B+w*p);q=x*H+y*G+z*C+(x*A+y*B+z*p);p=J*H+L*G+N*C+(J*A+L*B+N*p);B=+g[f+48>>2];A=+g[f+52>>2];o=+g[f+56>>2];s=u*H+v*G+w*C+(u*B+v*A+w*o);r=x*H+y*G+z*C+(x*B+y*A+z*o);o=J*H+L*G+N*C+(J*B+L*A+N*o);A=+g[f>>2];B=+g[f+16>>2];C=+g[f+32>>2];G=+g[f+4>>2];H=+g[f+20>>2];I=+g[f+36>>2];K=+g[f+8>>2];M=+g[f+24>>2];O=+g[f+40>>2];g[l+336>>2]=u*A+v*B+w*C;g[l+340>>2]=u*G+v*H+w*I;g[l+344>>2]=u*K+v*M+w*O;g[l+348>>2]=0.0;g[l+352>>2]=x*A+y*B+z*C;g[l+356>>2]=x*G+y*H+z*I;g[l+360>>2]=x*K+y*M+z*O;g[l+364>>2]=0.0;g[l+368>>2]=J*A+L*B+N*C;g[l+372>>2]=J*G+L*H+N*I;g[l+376>>2]=J*K+L*M+N*O;F=l+380|0;c[F+0>>2]=0;c[F+4>>2]=0;c[F+8>>2]=0;c[F+12>>2]=0;c[F+16>>2]=0;F=c[h+8>>2]|0;O=+$b[c[(c[m>>2]|0)+48>>2]&15](m);c[l+112>>2]=16256;c[l+116>>2]=d;c[l+120>>2]=c[e+0>>2];c[l+124>>2]=c[e+4>>2];c[l+128>>2]=c[e+8>>2];c[l+132>>2]=c[e+12>>2];c[l+136>>2]=c[e+16>>2];c[l+140>>2]=c[e+20>>2];c[l+144>>2]=c[e+24>>2];c[l+148>>2]=c[e+28>>2];c[l+152>>2]=c[e+32>>2];c[l+156>>2]=c[e+36>>2];c[l+160>>2]=c[e+40>>2];c[l+164>>2]=c[e+44>>2];c[l+168>>2]=c[e+48>>2];c[l+172>>2]=c[e+52>>2];c[l+176>>2]=c[e+56>>2];c[l+180>>2]=c[e+60>>2];c[l+184>>2]=c[f+0>>2];c[l+188>>2]=c[f+4>>2];c[l+192>>2]=c[f+8>>2];c[l+196>>2]=c[f+12>>2];c[l+200>>2]=c[f+16>>2];c[l+204>>2]=c[f+20>>2];c[l+208>>2]=c[f+24>>2];c[l+212>>2]=c[f+28>>2];c[l+216>>2]=c[f+32>>2];c[l+220>>2]=c[f+36>>2];c[l+224>>2]=c[f+40>>2];c[l+228>>2]=c[f+44>>2];c[l+232>>2]=c[f+48>>2];c[l+236>>2]=c[f+52>>2];c[l+240>>2]=c[f+56>>2];c[l+244>>2]=c[f+60>>2];c[l+248>>2]=c[n+0>>2];c[l+252>>2]=c[n+4>>2];c[l+256>>2]=c[n+8>>2];c[l+260>>2]=c[n+12>>2];c[l+264>>2]=c[n+16>>2];c[l+268>>2]=c[n+20>>2];c[l+272>>2]=c[n+24>>2];c[l+276>>2]=c[n+28>>2];c[l+280>>2]=c[n+32>>2];c[l+284>>2]=c[n+36>>2];c[l+288>>2]=c[n+40>>2];c[l+292>>2]=c[n+44>>2];c[l+296>>2]=c[n+48>>2];c[l+300>>2]=c[n+52>>2];c[l+304>>2]=c[n+56>>2];c[l+308>>2]=c[n+60>>2];g[l+316>>2]=O;c[l+112>>2]=8224;c[l+324>>2]=j;c[l+328>>2]=F;c[l+332>>2]=m;g[l+312>>2]=+g[j+4>>2];g[l+320>>2]=k;vc[c[(c[d>>2]|0)+8>>2]&127](d,l+336|0,l+96|0,l+80|0);g[l+64>>2]=t;g[l+68>>2]=q;g[l+72>>2]=p;g[l+76>>2]=0.0;if(s<t){g[l+64>>2]=s;v=s}else v=t;if(r<q){g[l+68>>2]=r;u=r}else u=q;if(o<p){g[l+72>>2]=o;k=o}else k=p;g[l+48>>2]=t;g[l+52>>2]=q;g[l+56>>2]=p;g[l+60>>2]=0.0;if(t<s)g[l+48>>2]=s;else s=t;if(q<r){g[l+52>>2]=r;q=r}if(p<o)g[l+56>>2]=o;else o=p;g[l+64>>2]=+g[l+96>>2]+v;g[l+68>>2]=+g[l+100>>2]+u;g[l+72>>2]=+g[l+104>>2]+k;g[l+48>>2]=+g[l+80>>2]+s;g[l+52>>2]=+g[l+84>>2]+q;g[l+56>>2]=+g[l+88>>2]+o;vc[c[(c[m>>2]|0)+64>>2]&127](m,l+112|0,l+64|0,l+48|0);i=l;return}}function Bu(a){a=a|0;return}function Cu(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0,j=0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0;j=i;i=i+256|0;c[j+32>>2]=7960;h=j+68|0;c[h+0>>2]=c[b+0>>2];c[h+4>>2]=c[b+4>>2];c[h+8>>2]=c[b+8>>2];c[h+12>>2]=c[b+12>>2];f=j+84|0;c[f+0>>2]=c[d+0>>2];c[f+4>>2]=c[d+4>>2];c[f+8>>2]=c[d+8>>2];c[f+12>>2]=c[d+12>>2];c[j+244>>2]=a;c[j+248>>2]=e;g[j+100>>2]=1.0;c[j+104>>2]=0;c[j+108>>2]=0;c[j+112>>2]=0;c[j+116>>2]=0;g[j+120>>2]=1.0;c[j+124>>2]=0;c[j+128>>2]=0;c[j+132>>2]=0;c[j+136>>2]=0;g[j+140>>2]=1.0;c[j+144>>2]=0;c[j+148>>2]=c[h+0>>2];c[j+152>>2]=c[h+4>>2];c[j+156>>2]=c[h+8>>2];c[j+160>>2]=c[h+12>>2];g[j+164>>2]=1.0;c[j+168>>2]=0;c[j+172>>2]=0;c[j+176>>2]=0;c[j+180>>2]=0;g[j+184>>2]=1.0;c[j+188>>2]=0;c[j+192>>2]=0;c[j+196>>2]=0;c[j+200>>2]=0;g[j+204>>2]=1.0;c[j+208>>2]=0;c[j+212>>2]=c[d+0>>2];c[j+216>>2]=c[d+4>>2];c[j+220>>2]=c[d+8>>2];c[j+224>>2]=c[d+12>>2];n=+g[d>>2]- +g[b>>2];k=+g[d+4>>2]- +g[b+4>>2];q=+g[d+8>>2]- +g[b+8>>2];l=1.0/+Q(+(n*n+k*k+q*q));if(n*l==0.0)p=999999984306749400.0;else p=1.0/(n*l);g[j+36>>2]=p;if(k*l==0.0)o=999999984306749400.0;else o=1.0/(k*l);g[j+40>>2]=o;if(q*l==0.0)m=999999984306749400.0;else m=1.0/(q*l);g[j+44>>2]=m;c[j+52>>2]=p<0.0&1;c[j+56>>2]=o<0.0&1;c[j+60>>2]=m<0.0&1;g[j+64>>2]=n*l*(+g[f>>2]- +g[h>>2])+k*l*(+g[j+88>>2]- +g[j+72>>2])+q*l*(+g[j+92>>2]- +g[j+76>>2]);e=c[a+68>>2]|0;h=c[(c[e>>2]|0)+24>>2]|0;c[j+16>>2]=0;c[j+20>>2]=0;c[j+24>>2]=0;c[j+28>>2]=0;c[j+0>>2]=0;c[j+4>>2]=0;c[j+8>>2]=0;c[j+12>>2]=0;Zb[h&7](e,b,d,j+32|0,j+16|0,j);i=j;return}function Du(a){a=a|0;return}function Eu(a,b,d,e,f,h){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;h=+h;var j=0,k=0,l=0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0,t=0,u=0.0,v=0;j=i;i=i+416|0;oE(7568);c[j+144>>2]=c[d+0>>2];c[j+148>>2]=c[d+4>>2];c[j+152>>2]=c[d+8>>2];c[j+156>>2]=c[d+12>>2];c[j+160>>2]=c[d+16>>2];c[j+164>>2]=c[d+20>>2];c[j+168>>2]=c[d+24>>2];c[j+172>>2]=c[d+28>>2];c[j+176>>2]=c[d+32>>2];c[j+180>>2]=c[d+36>>2];c[j+184>>2]=c[d+40>>2];c[j+188>>2]=c[d+44>>2];k=j+192|0;c[k+0>>2]=c[d+48>>2];c[k+4>>2]=c[d+52>>2];c[k+8>>2]=c[d+56>>2];c[k+12>>2]=c[d+60>>2];c[j+80>>2]=c[e+0>>2];c[j+84>>2]=c[e+4>>2];c[j+88>>2]=c[e+8>>2];c[j+92>>2]=c[e+12>>2];c[j+96>>2]=c[e+16>>2];c[j+100>>2]=c[e+20>>2];c[j+104>>2]=c[e+24>>2];c[j+108>>2]=c[e+28>>2];c[j+112>>2]=c[e+32>>2];c[j+116>>2]=c[e+36>>2];c[j+120>>2]=c[e+40>>2];c[j+124>>2]=c[e+44>>2];l=j+128|0;c[l+0>>2]=c[e+48>>2];c[l+4>>2]=c[e+52>>2];c[l+8>>2]=c[e+56>>2];c[l+12>>2]=c[e+60>>2];Bo(j+144|0,j+80|0,j+212|0,j+208|0);u=+g[j+208>>2];m=u*+g[j+216>>2];r=u*+g[j+220>>2];g[j+32>>2]=+g[j+212>>2]*u;g[j+36>>2]=m;g[j+40>>2]=r;g[j+44>>2]=0.0;c[j+16>>2]=0;c[j+20>>2]=0;c[j+24>>2]=0;c[j+28>>2]=0;g[j+212>>2]=1.0;v=j+216|0;c[v+0>>2]=0;c[v+4>>2]=0;c[v+8>>2]=0;c[v+12>>2]=0;g[j+232>>2]=1.0;t=j+236|0;c[t+0>>2]=0;c[t+4>>2]=0;c[t+8>>2]=0;c[t+12>>2]=0;g[j+252>>2]=1.0;s=j+256|0;c[s+0>>2]=0;c[s+4>>2]=0;c[s+8>>2]=0;c[s+12>>2]=0;c[s+16>>2]=0;Hc(j+144|0,j);r=+g[j>>2];m=+g[j+4>>2];u=+g[j+8>>2];q=+g[j+12>>2];o=r*(2.0/(r*r+m*m+u*u+q*q));n=m*(2.0/(r*r+m*m+u*u+q*q));p=u*(2.0/(r*r+m*m+u*u+q*q));g[j+212>>2]=1.0-(m*n+u*p);g[v>>2]=r*n-q*p;g[j+220>>2]=r*p+q*n;g[j+224>>2]=0.0;g[j+228>>2]=r*n+q*p;g[j+232>>2]=1.0-(r*o+u*p);g[t>>2]=m*p-q*o;g[j+240>>2]=0.0;g[j+244>>2]=r*p-q*n;g[j+248>>2]=m*p+q*o;g[j+252>>2]=1.0-(r*o+m*n);g[s>>2]=0.0;mu(b,j+212|0,j+16|0,j+32|0,j+64|0,j+48|0);c[j+212>>2]=7848;c[j+248>>2]=c[d+0>>2];c[j+252>>2]=c[d+4>>2];c[j+256>>2]=c[d+8>>2];c[j+260>>2]=c[d+12>>2];c[j+264>>2]=c[d+16>>2];c[j+268>>2]=c[d+20>>2];c[j+272>>2]=c[d+24>>2];c[j+276>>2]=c[d+28>>2];c[j+280>>2]=c[d+32>>2];c[j+284>>2]=c[d+36>>2];c[j+288>>2]=c[d+40>>2];c[j+292>>2]=c[d+44>>2];s=j+296|0;c[s+0>>2]=c[d+48>>2];c[s+4>>2]=c[d+52>>2];c[s+8>>2]=c[d+56>>2];c[s+12>>2]=c[d+60>>2];c[j+312>>2]=c[e+0>>2];c[j+316>>2]=c[e+4>>2];c[j+320>>2]=c[e+8>>2];c[j+324>>2]=c[e+12>>2];c[j+328>>2]=c[e+16>>2];c[j+332>>2]=c[e+20>>2];c[j+336>>2]=c[e+24>>2];c[j+340>>2]=c[e+28>>2];c[j+344>>2]=c[e+32>>2];c[j+348>>2]=c[e+36>>2];c[j+352>>2]=c[e+40>>2];c[j+356>>2]=c[e+44>>2];d=j+360|0;c[d+0>>2]=c[e+48>>2];c[d+4>>2]=c[e+52>>2];c[d+8>>2]=c[e+56>>2];c[d+12>>2]=c[e+60>>2];c[j+392>>2]=a;c[j+396>>2]=f;g[j+400>>2]=h;c[j+404>>2]=b;n=+g[d>>2]- +g[s>>2];h=+g[j+364>>2]- +g[j+300>>2];m=+g[j+368>>2]- +g[j+304>>2];o=1.0/+Q(+(n*n+h*h+m*m));if(n*o==0.0)p=999999984306749400.0;else p=1.0/(n*o);g[j+216>>2]=p;if(h*o==0.0)q=999999984306749400.0;else q=1.0/(h*o);g[j+220>>2]=q;if(m*o==0.0)r=999999984306749400.0;else r=1.0/(m*o);g[j+224>>2]=r;c[j+232>>2]=p<0.0&1;c[j+236>>2]=q<0.0&1;c[j+240>>2]=r<0.0&1;g[j+244>>2]=m*m*o+(n*n*o+h*h*o);v=c[a+68>>2]|0;Zb[c[(c[v>>2]|0)+24>>2]&7](v,k,l,j+212|0,j+64|0,j+48|0);k=c[5022]|0;v=(c[k+16>>2]|0)+ -1|0;c[k+16>>2]=v;if((v|0)!=0){i=j;return}do if((c[k+4>>2]|0)!=0){Eb(j+212|0,0)|0;v=c[5008]|0;g[k+8>>2]=+(((c[j+216>>2]|0)-(c[v+4>>2]|0)+(((c[j+212>>2]|0)-(c[v>>2]|0)|0)*1e6|0)-(c[k+12>>2]|0)|0)>>>0)/1.0e3+ +g[k+8>>2];if((c[k+16>>2]|0)==0){k=c[5022]|0;break}else{i=j;return}}while(0);c[5022]=c[k+20>>2];i=j;return}function Fu(a){a=a|0;return}function Gu(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,g=0;f=i;i=i+96|0;g=c[b+192>>2]|0;c[f+64>>2]=0;c[f+68>>2]=g;c[f+72>>2]=b;c[f+76>>2]=b+4;c[f+80>>2]=-1;c[f+84>>2]=-1;b=c[d+192>>2]|0;c[f+40>>2]=0;c[f+44>>2]=b;c[f+48>>2]=d;c[f+52>>2]=d+4;c[f+56>>2]=-1;c[f+60>>2]=-1;d=c[a+24>>2]|0;d=Tb[c[(c[d>>2]|0)+8>>2]&31](d,f+64|0,f+40|0,0)|0;if((d|0)==0){i=f;return}c[f+4>>2]=0;c[f+8>>2]=f+64;c[f+12>>2]=f+40;c[f>>2]=7728;c[f+32>>2]=e;Jb[c[(c[d>>2]|0)+8>>2]&31](d,f+64|0,f+40|0,a+28|0,f);Lb[c[c[d>>2]>>2]&511](d);g=c[a+24>>2]|0;Nb[c[(c[g>>2]|0)+60>>2]&127](g,d);i=f;return}function Hu(a){a=a|0;return}function Iu(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0,j=0,k=0,l=0.0,m=0.0,n=0,o=0.0,p=0,q=0,r=0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0,N=0;f=i;i=i+480|0;h=Pb[c[(c[a>>2]|0)+20>>2]&127](a)|0;tc[c[(c[h>>2]|0)+56>>2]&7](h,b,1.0);h=c[d+4>>2]|0;switch(h|0){case 9:{h=c[d+92>>2]|0;if((h|0)<=0){i=f;return}do{h=h+ -1|0;r=c[d+100>>2]|0;D=+g[r+(h<<4)>>2];C=+g[r+(h<<4)+4>>2];m=+g[r+(h<<4)+8>>2];r=Pb[c[(c[a>>2]|0)+20>>2]&127](a)|0;q=c[(c[r>>2]|0)+16>>2]|0;o=+g[(c[d+120>>2]|0)+(h<<2)>>2];A=+g[b>>2];z=+g[b+4>>2];B=+g[b+8>>2];x=+g[b+16>>2];w=+g[b+20>>2];y=+g[b+24>>2];u=+g[b+32>>2];t=+g[b+36>>2];v=+g[b+40>>2];s=D*A+C*z+m*B+ +g[b+48>>2];l=D*x+C*w+m*y+ +g[b+52>>2];m=D*u+C*t+m*v+ +g[b+56>>2];g[f+320>>2]=A+z*0.0+B*0.0;g[f+324>>2]=A*0.0+z+B*0.0;g[f+328>>2]=B+(A*0.0+z*0.0);g[f+332>>2]=0.0;g[f+336>>2]=x+w*0.0+y*0.0;g[f+340>>2]=x*0.0+w+y*0.0;g[f+344>>2]=y+(x*0.0+w*0.0);g[f+348>>2]=0.0;g[f+352>>2]=u+t*0.0+v*0.0;g[f+356>>2]=u*0.0+t+v*0.0;g[f+360>>2]=v+(u*0.0+t*0.0);g[f+364>>2]=0.0;g[f+368>>2]=s;g[f+372>>2]=l;g[f+376>>2]=m;g[f+380>>2]=0.0;Sb[q&0](r,o,f+320|0,e)}while((h|0)>0);i=f;return};case 8:{D=+$b[c[(c[d>>2]|0)+48>>2]&15](d);r=Pb[c[(c[a>>2]|0)+20>>2]&127](a)|0;Sb[c[(c[r>>2]|0)+16>>2]&0](r,D,b,e);i=f;return};case 28:{D=+g[d+64>>2];r=Pb[c[(c[a>>2]|0)+20>>2]&127](a)|0;cc[c[(c[r>>2]|0)+88>>2]&0](r,d+48|0,D,b,e);i=f;return};case 11:{C=+g[d+56>>2];D=+g[d+60>>2];r=c[d+68>>2]|0;q=Pb[c[(c[a>>2]|0)+20>>2]&127](a)|0;Rb[c[(c[q>>2]|0)+84>>2]&0](q,C,D,r,b,e);i=f;return};case 31:{h=c[d+16>>2]|0;if((h|0)<=0){i=f;return}do{h=h+ -1|0;r=c[d+24>>2]|0;l=+g[r+(h*80|0)>>2];s=+g[r+(h*80|0)+4>>2];v=+g[r+(h*80|0)+8>>2];m=+g[r+(h*80|0)+16>>2];t=+g[r+(h*80|0)+20>>2];x=+g[r+(h*80|0)+24>>2];o=+g[r+(h*80|0)+32>>2];u=+g[r+(h*80|0)+36>>2];z=+g[r+(h*80|0)+40>>2];L=+g[r+(h*80|0)+48>>2];K=+g[r+(h*80|0)+52>>2];D=+g[r+(h*80|0)+56>>2];r=c[r+(h*80|0)+64>>2]|0;q=c[(c[a>>2]|0)+28>>2]|0;J=+g[b>>2];I=+g[b+4>>2];H=+g[b+8>>2];G=+g[b+16>>2];F=+g[b+20>>2];E=+g[b+24>>2];w=+g[b+32>>2];y=+g[b+36>>2];A=+g[b+40>>2];B=L*J+K*I+D*H+ +g[b+48>>2];C=L*G+K*F+D*E+ +g[b+52>>2];D=L*w+K*y+D*A+ +g[b+56>>2];g[f+416>>2]=l*J+m*I+o*H;g[f+420>>2]=s*J+t*I+u*H;g[f+424>>2]=v*J+x*I+z*H;g[f+428>>2]=0.0;g[f+432>>2]=l*G+m*F+o*E;g[f+436>>2]=s*G+t*F+u*E;g[f+440>>2]=v*G+x*F+z*E;g[f+444>>2]=0.0;g[f+448>>2]=l*w+m*y+o*A;g[f+452>>2]=s*w+t*y+u*A;g[f+456>>2]=v*w+x*y+z*A;g[f+460>>2]=0.0;g[f+464>>2]=B;g[f+468>>2]=C;g[f+472>>2]=D;g[f+476>>2]=0.0;vc[q&127](a,f+416|0,r,e)}while((h|0)>0);i=f;return};case 10:{r=c[d+52>>2]|0;K=+g[d+(((r+2|0)%3|0)<<2)+28>>2];L=+g[d+(r<<2)+28>>2];q=Pb[c[(c[a>>2]|0)+20>>2]&127](a)|0;Rb[c[(c[q>>2]|0)+76>>2]&0](q,K,L,r,b,e);i=f;return};case 0:{c[f+400>>2]=c[d+28>>2];c[f+404>>2]=c[d+32>>2];c[f+408>>2]=c[d+36>>2];c[f+412>>2]=c[d+40>>2];J=+$b[c[(c[d>>2]|0)+48>>2]&15](d);K=+$b[c[(c[d>>2]|0)+48>>2]&15](d);L=+$b[c[(c[d>>2]|0)+48>>2]&15](d);J=J+ +g[f+400>>2];g[f+400>>2]=J;K=K+ +g[f+404>>2];g[f+404>>2]=K;L=L+ +g[f+408>>2];g[f+408>>2]=L;r=Pb[c[(c[a>>2]|0)+20>>2]&127](a)|0;q=c[(c[r>>2]|0)+72>>2]|0;g[f+384>>2]=-J;g[f+388>>2]=-K;g[f+392>>2]=-L;g[f+396>>2]=0.0;Jb[q&31](r,f+384|0,f+400|0,b,e);i=f;return};case 13:{r=c[d+52>>2]|0;K=+$b[c[(c[d>>2]|0)+92>>2]&15](d);c[f+304>>2]=c[d+28>>2];c[f+308>>2]=c[d+32>>2];c[f+312>>2]=c[d+36>>2];c[f+316>>2]=c[d+40>>2];I=+$b[c[(c[d>>2]|0)+48>>2]&15](d);J=+$b[c[(c[d>>2]|0)+48>>2]&15](d);L=+$b[c[(c[d>>2]|0)+48>>2]&15](d);g[f+304>>2]=I+ +g[f+304>>2];g[f+308>>2]=J+ +g[f+308>>2];g[f+312>>2]=L+ +g[f+312>>2];L=+g[f+304+(r<<2)>>2];q=Pb[c[(c[a>>2]|0)+20>>2]&127](a)|0;Rb[c[(c[q>>2]|0)+80>>2]&0](q,K,L,r,b,e);i=f;return};default:{a:do if((h|0)<7){j=c[d+52>>2]|0;if((j|0)==0){if((Pb[c[(c[d>>2]|0)+100>>2]&127](d)|0)<=0)break;h=0;while(1){vc[c[(c[d>>2]|0)+104>>2]&127](d,h,f+208|0,f+192|0);J=+g[f+208>>2];x=+g[b>>2];H=+g[f+212>>2];y=+g[b+4>>2];F=+g[f+216>>2];z=+g[b+8>>2];B=+g[b+16>>2];C=+g[b+20>>2];D=+g[b+24>>2];G=+g[b+32>>2];I=+g[b+36>>2];K=+g[b+40>>2];A=+g[b+48>>2];E=+g[b+52>>2];L=+g[b+56>>2];g[f+176>>2]=J*x+H*y+F*z+A;g[f+180>>2]=J*B+H*C+F*D+E;g[f+184>>2]=J*G+H*I+F*K+L;g[f+188>>2]=0.0;F=+g[f+192>>2];H=+g[f+196>>2];J=+g[f+200>>2];g[f+160>>2]=F*x+H*y+J*z+A;g[f+164>>2]=F*B+H*C+J*D+E;g[f+168>>2]=F*G+H*I+J*K+L;g[f+172>>2]=0.0;r=Pb[c[(c[a>>2]|0)+20>>2]&127](a)|0;vc[c[(c[r>>2]|0)+8>>2]&127](r,f+176|0,f+160|0,e);h=h+1|0;if((h|0)>=(Pb[c[(c[d>>2]|0)+100>>2]&127](d)|0))break a}}if((c[j+28>>2]|0)>0){h=0;do{n=c[j+36>>2]|0;k=c[n+(h*36|0)+4>>2]|0;b:do if((k|0)>0){p=c[n+(h*36|0)+12>>2]|0;q=p;o=0.0;m=0.0;l=0.0;p=c[p+(k+ -1<<2)>>2]|0;r=0;while(1){n=c[q+(r<<2)>>2]|0;q=c[j+16>>2]|0;o=o+ +g[q+(n<<4)>>2];m=m+ +g[q+(n<<4)+4>>2];l=l+ +g[q+(n<<4)+8>>2];q=Pb[c[(c[a>>2]|0)+20>>2]&127](a)|0;M=c[(c[q>>2]|0)+8>>2]|0;N=c[j+16>>2]|0;J=+g[N+(p<<4)>>2];x=+g[b>>2];H=+g[N+(p<<4)+4>>2];y=+g[b+4>>2];F=+g[N+(p<<4)+8>>2];z=+g[b+8>>2];B=+g[b+16>>2];C=+g[b+20>>2];D=+g[b+24>>2];G=+g[b+32>>2];I=+g[b+36>>2];K=+g[b+40>>2];A=+g[b+48>>2];E=+g[b+52>>2];L=+g[b+56>>2];g[f+288>>2]=J*x+H*y+F*z+A;g[f+292>>2]=J*B+H*C+F*D+E;g[f+296>>2]=J*G+H*I+F*K+L;g[f+300>>2]=0.0;F=+g[N+(n<<4)>>2];H=+g[N+(n<<4)+4>>2];J=+g[N+(n<<4)+8>>2];g[f+272>>2]=F*x+H*y+J*z+A;g[f+276>>2]=F*B+H*C+J*D+E;g[f+280>>2]=F*G+H*I+J*K+L;g[f+284>>2]=0.0;vc[M&127](q,f+288|0,f+272|0,e);r=r+1|0;p=c[j+36>>2]|0;if((r|0)>=(c[p+(h*36|0)+4>>2]|0))break b;q=c[p+(h*36|0)+12>>2]|0;p=n}}else{o=0.0;m=0.0;l=0.0}while(0);o=o*(1.0/+(k|0));m=m*(1.0/+(k|0));l=l*(1.0/+(k|0));N=Pb[c[(c[a>>2]|0)+20>>2]&127](a)|0;if(((Pb[c[(c[N>>2]|0)+48>>2]&127](N)|0)&16384|0)!=0){g[f+256>>2]=1.0;g[f+260>>2]=1.0;g[f+264>>2]=0.0;g[f+268>>2]=0.0;N=c[j+36>>2]|0;F=+g[N+(h*36|0)+20>>2];H=+g[N+(h*36|0)+24>>2];J=+g[N+(h*36|0)+28>>2];N=Pb[c[(c[a>>2]|0)+20>>2]&127](a)|0;M=c[(c[N>>2]|0)+8>>2]|0;x=+g[b>>2];y=+g[b+4>>2];z=+g[b+8>>2];B=+g[b+16>>2];C=+g[b+20>>2];D=+g[b+24>>2];G=+g[b+32>>2];I=+g[b+36>>2];K=+g[b+40>>2];A=+g[b+48>>2];E=+g[b+52>>2];L=+g[b+56>>2];g[f+240>>2]=o*x+m*y+l*z+A;g[f+244>>2]=o*B+m*C+l*D+E;g[f+248>>2]=o*G+m*I+l*K+L;g[f+252>>2]=0.0;g[f+224>>2]=(o+F)*x+(m+H)*y+(l+J)*z+A;g[f+228>>2]=(o+F)*B+(m+H)*C+(l+J)*D+E;g[f+232>>2]=(o+F)*G+(m+H)*I+(l+J)*K+L;g[f+236>>2]=0.0;vc[M&127](N,f+240|0,f+224|0,f+256|0)}h=h+1|0}while((h|0)<(c[j+28>>2]|0))}}while(0);h=c[d+4>>2]|0;if((h+ -21|0)>>>0<9){g[f+144>>2]=999999984306749400.0;g[f+148>>2]=999999984306749400.0;g[f+152>>2]=999999984306749400.0;g[f+156>>2]=0.0;g[f+128>>2]=-999999984306749400.0;g[f+132>>2]=-999999984306749400.0;g[f+136>>2]=-999999984306749400.0;g[f+140>>2]=0.0;h=Pb[c[(c[a>>2]|0)+20>>2]&127](a)|0;c[f+32>>2]=7624;c[f+36>>2]=7648;c[f+40>>2]=h;c[f+44>>2]=c[e+0>>2];c[f+48>>2]=c[e+4>>2];c[f+52>>2]=c[e+8>>2];c[f+56>>2]=c[e+12>>2];c[f+60>>2]=c[b+0>>2];c[f+64>>2]=c[b+4>>2];c[f+68>>2]=c[b+8>>2];c[f+72>>2]=c[b+12>>2];c[f+76>>2]=c[b+16>>2];c[f+80>>2]=c[b+20>>2];c[f+84>>2]=c[b+24>>2];c[f+88>>2]=c[b+28>>2];c[f+92>>2]=c[b+32>>2];c[f+96>>2]=c[b+36>>2];c[f+100>>2]=c[b+40>>2];c[f+104>>2]=c[b+44>>2];c[f+108>>2]=c[b+48>>2];c[f+112>>2]=c[b+52>>2];c[f+116>>2]=c[b+56>>2];c[f+120>>2]=c[b+60>>2];vc[c[(c[d>>2]|0)+64>>2]&127](d,f+32|0,f+128|0,f+144|0);h=c[d+4>>2]|0}if((h|0)!=3){i=f;return}g[f+16>>2]=999999984306749400.0;g[f+20>>2]=999999984306749400.0;g[f+24>>2]=999999984306749400.0;g[f+28>>2]=0.0;g[f>>2]=-999999984306749400.0;g[f+4>>2]=-999999984306749400.0;g[f+8>>2]=-999999984306749400.0;g[f+12>>2]=0.0;N=Pb[c[(c[a>>2]|0)+20>>2]&127](a)|0;c[f+32>>2]=7624;c[f+36>>2]=7648;c[f+40>>2]=N;c[f+44>>2]=c[e+0>>2];c[f+48>>2]=c[e+4>>2];c[f+52>>2]=c[e+8>>2];c[f+56>>2]=c[e+12>>2];c[f+60>>2]=c[b+0>>2];c[f+64>>2]=c[b+4>>2];c[f+68>>2]=c[b+8>>2];c[f+72>>2]=c[b+12>>2];c[f+76>>2]=c[b+16>>2];c[f+80>>2]=c[b+20>>2];c[f+84>>2]=c[b+24>>2];c[f+88>>2]=c[b+28>>2];c[f+92>>2]=c[b+32>>2];c[f+96>>2]=c[b+36>>2];c[f+100>>2]=c[b+40>>2];c[f+104>>2]=c[b+44>>2];c[f+108>>2]=c[b+48>>2];c[f+112>>2]=c[b+52>>2];c[f+116>>2]=c[b+56>>2];c[f+120>>2]=c[b+60>>2];N=c[d+92>>2]|0;vc[c[(c[N>>2]|0)+8>>2]&127](N,f+36|0,f,f+16|0);i=f;return}}}function Ju(a){a=a|0;return}function Ku(b){b=b|0;var d=0,e=0,f=0,h=0,j=0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0,r=0;d=i;i=i+112|0;if(((Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0)!=0?(r=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0,((Pb[c[(c[r>>2]|0)+48>>2]&127](r)|0)&8|0)!=0):0)?(e=c[b+24>>2]|0,e=Pb[c[(c[e>>2]|0)+36>>2]&127](e)|0,g[d+96>>2]=1.0,g[d+100>>2]=1.0,g[d+104>>2]=0.0,g[d+108>>2]=0.0,(e|0)>0):0){q=0;do{h=c[b+24>>2]|0;h=gc[c[(c[h>>2]|0)+40>>2]&31](h,q)|0;j=c[h+748>>2]|0;if((j|0)>0){f=0;do{r=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;Mb[c[(c[r>>2]|0)+32>>2]&0](r,h+(f*184|0)+36|0,h+(f*184|0)+68|0,+g[h+(f*184|0)+84>>2],c[h+(f*184|0)+152>>2]|0,d+96|0);f=f+1|0}while((f|0)!=(j|0))}q=q+1|0}while((q|0)!=(e|0))}if((Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0)==0){i=d;return}r=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;if(((Pb[c[(c[r>>2]|0)+48>>2]&127](r)|0)&3|0)==0){i=d;return}if((c[b+8>>2]|0)<=0){i=d;return}j=d+84|0;h=d+88|0;f=d+92|0;e=0;do{q=c[(c[b+16>>2]|0)+(e<<2)>>2]|0;if((c[q+204>>2]&32|0)==0){if((Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0)!=0?(r=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0,((Pb[c[(c[r>>2]|0)+48>>2]&127](r)|0)&1|0)!=0):0){g[d+80>>2]=1.0;g[j>>2]=1.0;g[h>>2]=1.0;g[f>>2]=0.0;switch(c[q+216>>2]|0){case 1:{g[d+80>>2]=1.0;g[j>>2]=1.0;g[h>>2]=1.0;g[f>>2]=0.0;break};case 4:{g[d+80>>2]=1.0;g[j>>2]=0.0;g[h>>2]=0.0;g[f>>2]=0.0;break};case 5:{g[d+80>>2]=1.0;g[j>>2]=1.0;g[h>>2]=0.0;g[f>>2]=0.0;break};case 2:{g[d+80>>2]=0.0;g[j>>2]=1.0;g[h>>2]=0.0;g[f>>2]=0.0;break};case 3:{g[d+80>>2]=0.0;g[j>>2]=1.0;g[h>>2]=1.0;g[f>>2]=0.0;break};default:{g[d+80>>2]=1.0;g[j>>2]=0.0;g[h>>2]=0.0;g[f>>2]=0.0}}vc[c[(c[b>>2]|0)+28>>2]&127](b,q+4|0,c[q+192>>2]|0,d+80|0)}r=c[b+72>>2]|0;if((r|0)!=0?((Pb[c[(c[r>>2]|0)+48>>2]&127](r)|0)&2|0)!=0:0){g[d+32>>2]=1.0;g[d+36>>2]=0.0;g[d+40>>2]=0.0;g[d+44>>2]=0.0;r=c[q+192>>2]|0;vc[c[(c[r>>2]|0)+8>>2]&127](r,q+4|0,d+64|0,d+48|0);g[d+64>>2]=+g[d+64>>2]+-.019999999552965164;g[d+68>>2]=+g[d+68>>2]+-.019999999552965164;g[d+72>>2]=+g[d+72>>2]+-.019999999552965164;g[d+48>>2]=+g[d+48>>2]+.019999999552965164;g[d+52>>2]=+g[d+52>>2]+.019999999552965164;g[d+56>>2]=+g[d+56>>2]+.019999999552965164;do if(((a[b+44>>0]|0)!=0?(c[q+236>>2]|0)==2:0)?(c[q+204>>2]&3|0)==0:0){r=c[q+192>>2]|0;vc[c[(c[r>>2]|0)+8>>2]&127](r,q+68|0,d+16|0,d);p=+g[d+16>>2]+-.019999999552965164;g[d+16>>2]=p;o=+g[d+20>>2]+-.019999999552965164;g[d+20>>2]=o;n=+g[d+24>>2]+-.019999999552965164;g[d+24>>2]=n;m=+g[d>>2]+.019999999552965164;g[d>>2]=m;l=+g[d+4>>2]+.019999999552965164;g[d+4>>2]=l;k=+g[d+8>>2]+.019999999552965164;g[d+8>>2]=k;if(p<+g[d+64>>2])g[d+64>>2]=p;if(o<+g[d+68>>2])g[d+68>>2]=o;if(n<+g[d+72>>2])g[d+72>>2]=n;n=+g[d+28>>2];if(n<+g[d+76>>2])g[d+76>>2]=n;if(+g[d+48>>2]<m)g[d+48>>2]=m;if(+g[d+52>>2]<l)g[d+52>>2]=l;if(+g[d+56>>2]<k)g[d+56>>2]=k;k=+g[d+12>>2];if(!(+g[d+60>>2]<k))break;g[d+60>>2]=k}while(0);r=c[b+72>>2]|0;vc[c[(c[r>>2]|0)+52>>2]&127](r,d+64|0,d+48|0,d+32|0)}}e=e+1|0}while((e|0)<(c[b+8>>2]|0));i=d;return}function Lu(b,d){b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0;j=i;i=i+80|0;r=c[b+8>>2]|0;if((r|0)>0){m=0;do{n=c[(c[b+16>>2]|0)+(m<<2)>>2]|0;if((c[n+236>>2]|0)==1){Nb[c[(c[n>>2]|0)+24>>2]&127](n,d);r=c[b+8>>2]|0}m=m+1|0}while((m|0)<(r|0))}a[j+16>>0]=1;c[j+12>>2]=0;c[j+4>>2]=0;c[j+8>>2]=0;a[j+36>>0]=1;c[j+32>>2]=0;c[j+24>>2]=0;c[j+28>>2]=0;a[j+56>>0]=1;c[j+52>>2]=0;c[j+44>>2]=0;c[j+48>>2]=0;a[j+76>>0]=1;c[j+72>>2]=0;c[j+64>>2]=0;c[j+68>>2]=0;if((r|0)<=0){Nu(j);i=j;return}u=-1;t=0;p=0;s=0;q=0;m=0;while(1){n=c[(c[(c[b+16>>2]|0)+(m<<2)>>2]|0)+192>>2]|0;o=(n+~(n<<15)>>10^n+~(n<<15))*9|0;o=(o>>6^o)+~((o>>6^o)<<11)>>16^(o>>6^o)+~((o>>6^o)<<11);u=o&u;a:do if(u>>>0<t>>>0?(h=c[p+(u<<2)>>2]|0,!((h|0)==-1)):0){u=c[j+72>>2]|0;v=h;while(1){if((n|0)==(c[u+(v<<3)>>2]|0))break;v=c[s+(v<<2)>>2]|0;if((v|0)==-1){f=15;break a}}if(!(!((v|0)==-1)?((c[j+52>>2]|0)+(v<<2)|0)!=0:0))f=15}else f=15;while(0);if((f|0)==15){f=0;r=o&q+ -1;b:do if(r>>>0<t>>>0?(g=c[p+(r<<2)>>2]|0,!((g|0)==-1)):0){t=c[j+72>>2]|0;u=g;while(1){if((n|0)==(c[t+(u<<3)>>2]|0))break;u=c[s+(u<<2)>>2]|0;if((u|0)==-1){f=22;break b}}if(!((u|0)==-1))c[(c[j+52>>2]|0)+(u<<2)>>2]=n;else f=22}else f=22;while(0);if((f|0)==22){f=0;p=c[j+44>>2]|0;if((p|0)==(q|0)){s=(q|0)==0?1:q<<1;if((q|0)<(s|0)){if((s|0)!=0?(c[5004]=(c[5004]|0)+1,l=XE((s<<2|3)+16|0)|0,(l|0)!=0):0){c[(l+19&-16)+ -4>>2]=l;t=l+19&-16}else t=0;if((q|0)>0){u=0;do{v=t+(u<<2)|0;if((v|0)!=0)c[v>>2]=c[(c[j+52>>2]|0)+(u<<2)>>2];u=u+1|0}while((u|0)!=(q|0))}u=c[j+52>>2]|0;if((u|0)!=0){if((a[j+56>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[u+ -4>>2]|0)}c[j+52>>2]=0}a[j+56>>0]=1;c[j+52>>2]=t;c[j+48>>2]=s;s=q}else s=q}else s=p;t=(c[j+52>>2]|0)+(s<<2)|0;if((t|0)!=0)c[t>>2]=n;c[j+44>>2]=s+1;t=c[j+64>>2]|0;if((t|0)==(c[j+68>>2]|0)?(k=(t|0)==0?1:t<<1,(t|0)<(k|0)):0){if((k|0)!=0?(c[5004]=(c[5004]|0)+1,e=XE((k<<3|3)+16|0)|0,(e|0)!=0):0){c[(e+19&-16)+ -4>>2]=e;s=e+19&-16}else s=0;if((t|0)>0){v=0;do{u=s+(v<<3)|0;if((u|0)!=0){x=(c[j+72>>2]|0)+(v<<3)|0;w=c[x+4>>2]|0;c[u>>2]=c[x>>2];c[u+4>>2]=w}v=v+1|0}while((v|0)!=(t|0))}t=c[j+72>>2]|0;if((t|0)!=0){if((a[j+76>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[t+ -4>>2]|0)}c[j+72>>2]=0}a[j+76>>0]=1;c[j+72>>2]=s;c[j+68>>2]=k;t=c[j+64>>2]|0}s=(c[j+72>>2]|0)+(t<<3)|0;if((s|0)!=0){c[s>>2]=n;c[s+4>>2]=0}c[j+64>>2]=t+1;s=c[j+48>>2]|0;if((q|0)<(s|0)){q=c[j+4>>2]|0;do if((q|0)<(s|0)){if((q|0)<=(s|0)){if((c[j+8>>2]|0)<(s|0)){do if((s|0)==0)r=0;else{c[5004]=(c[5004]|0)+1;r=XE((s<<2|3)+16|0)|0;if((r|0)==0){r=0;break}c[(r+19&-16)+ -4>>2]=r;r=r+19&-16}while(0);v=c[j+12>>2]|0;if((q|0)>0){u=0;do{t=r+(u<<2)|0;if((t|0)!=0)c[t>>2]=c[v+(u<<2)>>2];u=u+1|0}while((u|0)!=(q|0))}if((v|0)!=0){if((a[j+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[v+ -4>>2]|0)}c[j+12>>2]=0}a[j+16>>0]=1;c[j+12>>2]=r;c[j+8>>2]=s}else r=c[j+12>>2]|0;t=q;do{u=r+(t<<2)|0;if((u|0)!=0)c[u>>2]=0;t=t+1|0}while((t|0)!=(s|0))}c[j+4>>2]=s;r=c[j+24>>2]|0;if((r|0)<(s|0)){if((c[j+28>>2]|0)<(s|0)){do if((s|0)==0)t=0;else{c[5004]=(c[5004]|0)+1;t=XE((s<<2|3)+16|0)|0;if((t|0)==0){t=0;break}c[(t+19&-16)+ -4>>2]=t;t=t+19&-16}while(0);v=c[j+32>>2]|0;if((r|0)>0){w=0;do{u=t+(w<<2)|0;if((u|0)!=0)c[u>>2]=c[v+(w<<2)>>2];w=w+1|0}while((w|0)!=(r|0))}if((v|0)!=0){if((a[j+36>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[v+ -4>>2]|0)}c[j+32>>2]=0}a[j+36>>0]=1;c[j+32>>2]=t;c[j+28>>2]=s}else t=c[j+32>>2]|0;do{u=t+(r<<2)|0;if((u|0)!=0)c[u>>2]=0;r=r+1|0}while((r|0)!=(s|0))}c[j+24>>2]=s;if((s|0)>0){$E(c[j+12>>2]|0,-1,s<<2|0)|0;$E(c[j+32>>2]|0,-1,s<<2|0)|0}if((q|0)<=0){s=c[j+48>>2]|0;break}t=c[j+72>>2]|0;r=c[j+12>>2]|0;v=c[j+32>>2]|0;s=c[j+48>>2]|0;u=0;do{x=c[t+(u<<3)>>2]|0;x=(x+~(x<<15)>>10^x+~(x<<15))*9|0;x=r+((((x>>6^x)+~((x>>6^x)<<11)>>16^(x>>6^x)+~((x>>6^x)<<11))&s+ -1)<<2)|0;c[v+(u<<2)>>2]=c[x>>2];c[x>>2]=u;u=u+1|0}while((u|0)!=(q|0))}while(0);q=s;r=o&s+ -1}else q=s;x=c[j+12>>2]|0;w=x+(r<<2)|0;s=c[j+32>>2]|0;c[s+(p<<2)>>2]=c[w>>2];c[w>>2]=p;p=x}Nb[c[(c[n>>2]|0)+60>>2]&127](n,d);r=c[b+8>>2]|0}m=m+1|0;if((m|0)>=(r|0))break;u=q+ -1|0;t=c[j+4>>2]|0}Nu(j);i=j;return}function Mu(a,b){a=a|0;b=b|0;var d=0;d=i;Lb[c[(c[b>>2]|0)+32>>2]&511](b);Lu(a,b);Lb[c[(c[b>>2]|0)+36>>2]&511](b);i=d;return}function Nu(b){b=b|0;var d=0,e=0;d=i;e=c[b+72>>2]|0;if((e|0)!=0){if((a[b+76>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+72>>2]=0}a[b+76>>0]=1;c[b+72>>2]=0;c[b+64>>2]=0;c[b+68>>2]=0;e=c[b+52>>2]|0;if((e|0)!=0){if((a[b+56>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+52>>2]=0}a[b+56>>0]=1;c[b+52>>2]=0;c[b+44>>2]=0;c[b+48>>2]=0;e=c[b+32>>2]|0;if((e|0)!=0){if((a[b+36>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+32>>2]=0}a[b+36>>0]=1;c[b+32>>2]=0;c[b+24>>2]=0;c[b+28>>2]=0;e=c[b+12>>2]|0;if((e|0)==0){a[b+16>>0]=1;c[b+12>>2]=0;c[b+4>>2]=0;e=b+8|0;c[e>>2]=0;i=d;return}if((a[b+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+12>>2]=0;a[b+16>>0]=1;c[b+12>>2]=0;c[b+4>>2]=0;e=b+8|0;c[e>>2]=0;i=d;return}function Ou(a){a=a|0;return}function Pu(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Qu(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0,G=0.0,H=0.0;d=i;i=i+96|0;p=+g[b>>2];j=+g[a+28>>2];q=+g[b+4>>2];l=+g[a+32>>2];r=+g[b+8>>2];n=+g[a+36>>2];s=+g[a+44>>2];t=+g[a+48>>2];f=+g[a+52>>2];v=+g[a+60>>2];w=+g[a+64>>2];x=+g[a+68>>2];o=+g[a+76>>2];u=+g[a+80>>2];y=+g[a+84>>2];g[d+80>>2]=p*j+q*l+r*n+o;g[d+84>>2]=p*s+q*t+r*f+u;g[d+88>>2]=p*v+q*w+r*x+y;g[d+92>>2]=0.0;h=+g[b+16>>2];k=+g[b+20>>2];m=+g[b+24>>2];g[d+64>>2]=h*j+k*l+m*n+o;g[d+68>>2]=h*s+k*t+m*f+u;g[d+72>>2]=h*v+k*w+m*x+y;g[d+76>>2]=0.0;z=+g[b+32>>2];A=+g[b+36>>2];B=+g[b+40>>2];g[d+48>>2]=z*j+A*l+B*n+o;g[d+52>>2]=z*s+A*t+B*f+u;g[d+56>>2]=z*v+A*w+B*x+y;g[d+60>>2]=0.0;C=(p*j+q*l+r*n+o+(h*j+k*l+m*n+o)+(z*j+A*l+B*n+o))*.3333333432674408;D=(p*s+q*t+r*f+u+(h*s+k*t+m*f+u)+(z*s+A*t+B*f+u))*.3333333432674408;E=(p*v+q*w+r*x+y+(h*v+k*w+m*x+y)+(z*v+A*w+B*x+y))*.3333333432674408;g[d+32>>2]=C;g[d+36>>2]=D;g[d+40>>2]=E;g[d+44>>2]=0.0;e=c[a+8>>2]|0;if(((Pb[c[(c[e>>2]|0)+48>>2]&127](e)|0)&16384|0)==0){b=c[a+8>>2]|0;F=c[b>>2]|0;F=F+8|0;F=c[F>>2]|0;e=a+12|0;vc[F&127](b,d+80|0,d+64|0,e);b=c[a+8>>2]|0;F=c[b>>2]|0;F=F+8|0;F=c[F>>2]|0;vc[F&127](b,d+64|0,d+48|0,e);b=c[a+8>>2]|0;a=c[b>>2]|0;a=a+8|0;a=c[a>>2]|0;vc[a&127](b,d+48|0,d+80|0,e);i=d;return}H=h*j+k*l+m*n+o-(p*j+q*l+r*n+o);G=h*s+k*t+m*f+u-(p*s+q*t+r*f+u);m=h*v+k*w+m*x+y-(p*v+q*w+r*x+y);o=z*j+A*l+B*n+o-(p*j+q*l+r*n+o);u=z*s+A*t+B*f+u-(p*s+q*t+r*f+u);A=z*v+A*w+B*x+y-(p*v+q*w+r*x+y);B=1.0/+Q(+((H*u-G*o)*(H*u-G*o)+((G*A-m*u)*(G*A-m*u)+(m*o-H*A)*(m*o-H*A))));g[d+16>>2]=1.0;g[d+20>>2]=1.0;g[d+24>>2]=0.0;g[d+28>>2]=0.0;e=c[a+8>>2]|0;b=c[(c[e>>2]|0)+8>>2]|0;g[d>>2]=B*(G*A-m*u)+C;g[d+4>>2]=B*(m*o-H*A)+D;g[d+8>>2]=B*(H*u-G*o)+E;g[d+12>>2]=0.0;vc[b&127](e,d+32|0,d,d+16|0);e=c[a+8>>2]|0;b=c[e>>2]|0;b=b+8|0;b=c[b>>2]|0;F=a+12|0;vc[b&127](e,d+80|0,d+64|0,F);e=c[a+8>>2]|0;b=c[e>>2]|0;b=b+8|0;b=c[b>>2]|0;vc[b&127](e,d+64|0,d+48|0,F);e=c[a+8>>2]|0;b=c[e>>2]|0;b=b+8|0;b=c[b>>2]|0;vc[b&127](e,d+48|0,d+80|0,F);i=d;return}function Ru(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;vc[c[(c[a>>2]|0)+8>>2]&127](a,b,d,e);i=f;return}function Su(a){a=a|0;var b=0;b=i;YE(a+ -4|0);i=b;return}function Tu(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;vc[c[(c[a+ -4>>2]|0)+8>>2]&127](a+ -4|0,b,d,e);i=f;return}function Uu(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Vu(b,d,e,f){b=b|0;d=d|0;e=e|0;f=+f;var h=0,j=0,k=0.0,l=0.0,m=0.0,n=0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0,x=0.0,y=0,z=0,A=0;n=i;i=i+192|0;h=c[(c[b+4>>2]|0)+740>>2]|0;j=c[(c[b+8>>2]|0)+8>>2]|0;q=+g[e>>2];k=+g[d>>2]*f+q;o=+g[e+4>>2];l=+g[d+4>>2]*f+o;p=+g[e+8>>2];m=+g[d+8>>2]*f+p;if((h|0)!=(j|0)){w=c[(c[b+12>>2]|0)+8>>2]|0;x=k- +g[w+52>>2];s=l- +g[w+56>>2];t=m- +g[w+60>>2];v=q- +g[j+52>>2];u=o- +g[j+56>>2];r=p- +g[j+60>>2];q=x*+g[w+4>>2]+s*+g[w+20>>2]+t*+g[w+36>>2];o=x*+g[w+8>>2]+s*+g[w+24>>2]+t*+g[w+40>>2];p=x*+g[w+12>>2]+s*+g[w+28>>2]+t*+g[w+44>>2];t=v*+g[j+4>>2]+u*+g[j+20>>2]+r*+g[j+36>>2];s=v*+g[j+8>>2]+u*+g[j+24>>2]+r*+g[j+40>>2];r=v*+g[j+12>>2]+u*+g[j+28>>2]+r*+g[j+44>>2]}else{u=k- +g[h+52>>2];s=l- +g[h+56>>2];t=m- +g[h+60>>2];w=c[(c[b+12>>2]|0)+8>>2]|0;v=q- +g[w+52>>2];x=o- +g[w+56>>2];r=p- +g[w+60>>2];q=u*+g[h+4>>2]+s*+g[h+20>>2]+t*+g[h+36>>2];o=u*+g[h+8>>2]+s*+g[h+24>>2]+t*+g[h+40>>2];p=u*+g[h+12>>2]+s*+g[h+28>>2]+t*+g[h+44>>2];t=v*+g[w+4>>2]+x*+g[w+20>>2]+r*+g[w+36>>2];s=v*+g[w+8>>2]+x*+g[w+24>>2]+r*+g[w+40>>2];r=v*+g[w+12>>2]+x*+g[w+28>>2]+r*+g[w+44>>2]}g[n>>2]=q;g[n+4>>2]=o;g[n+8>>2]=p;g[n+12>>2]=0.0;g[n+16>>2]=t;g[n+20>>2]=s;g[n+24>>2]=r;g[n+28>>2]=0.0;c[n+64>>2]=c[d+0>>2];c[n+68>>2]=c[d+4>>2];c[n+72>>2]=c[d+8>>2];c[n+76>>2]=c[d+12>>2];g[n+80>>2]=f;g[n+84>>2]=0.0;g[n+88>>2]=0.0;g[n+92>>2]=0.0;c[n+112>>2]=0;a[n+116>>0]=0;c[n+120>>2]=0;c[n+124>>2]=0;c[n+128>>2]=0;c[n+132>>2]=0;c[n+136>>2]=0;c[n+140>>2]=0;c[n+144>>2]=0;c[n+148>>2]=0;g[n+48>>2]=k;g[n+52>>2]=l;g[n+56>>2]=m;g[n+60>>2]=0.0;c[n+32>>2]=c[e+0>>2];c[n+36>>2]=c[e+4>>2];c[n+40>>2]=c[e+8>>2];c[n+44>>2]=c[e+12>>2];if((h|0)!=(j|0)){z=c[b+20>>2]|0;c[n+96>>2]=z;e=c[b+16>>2]|0;c[n+100>>2]=e;y=c[b+28>>2]|0;c[n+104>>2]=y;w=c[b+24>>2]|0;c[n+108>>2]=w;d=b+12|0;A=(h|0)!=(j|0)?d:b+8|0;A=c[A>>2]|0;d=(h|0)!=(j|0)?b+8|0:d;d=c[d>>2]|0;j=b+32|0;j=c[j>>2]|0;h=c[j>>2]|0;h=h+12|0;h=c[h>>2]|0;+Vb[h&1](j,n,A,z,y,d,e,w);i=n;return}else{e=c[b+16>>2]|0;c[n+96>>2]=e;z=c[b+20>>2]|0;c[n+100>>2]=z;w=c[b+24>>2]|0;c[n+104>>2]=w;A=c[b+28>>2]|0;c[n+108>>2]=A;y=b+12|0;d=(h|0)!=(j|0)?y:b+8|0;d=c[d>>2]|0;y=(h|0)!=(j|0)?b+8|0:y;y=c[y>>2]|0;j=b+32|0;j=c[j>>2]|0;h=c[j>>2]|0;h=h+12|0;h=c[h>>2]|0;+Vb[h&1](j,n,d,e,w,y,z,A);i=n;return}}function Wu(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Xu(a,b){a=a|0;b=b|0;var d=0,e=0,f=0.0,h=0,j=0;d=i;i=i+32|0;e=c[a+184>>2]|0;if(+g[e+4>>2]==0.0){b=0;i=d;return b|0}b=c[b>>2]|0;if(!(gc[c[(c[e>>2]|0)+8>>2]&31](e,c[b+188>>2]|0)|0)){b=1;i=d;return b|0}h=c[a+192>>2]|0;j=c[b+192>>2]|0;e=c[a+184>>2]|0;f=+g[a+188>>2];c[d>>2]=0;c[d+4>>2]=j;c[d+8>>2]=b;c[d+12>>2]=b+4;c[d+16>>2]=-1;c[d+20>>2]=-1;Au(h,a+36|0,a+100|0,d,e,f);b=1;i=d;return b|0}function Yu(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Zu(a,b){a=a|0;b=b|0;var d=0,e=0,f=0;d=i;i=i+32|0;e=c[a+216>>2]|0;if(+g[e+4>>2]==0.0){b=0;i=d;return b|0}b=c[b>>2]|0;if(!(gc[c[(c[e>>2]|0)+8>>2]&31](e,c[b+188>>2]|0)|0)){b=1;i=d;return b|0}f=c[b+192>>2]|0;e=c[a+216>>2]|0;c[d>>2]=0;c[d+4>>2]=f;c[d+8>>2]=b;c[d+12>>2]=b+4;c[d+16>>2]=-1;c[d+20>>2]=-1;xu(a+68|0,a+132|0,d,e);b=1;i=d;return b|0}function _u(a){a=a|0;return}function $u(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function av(a,b){a=a|0;b=b|0;var d=0;d=i;a=c[a+12>>2]|0;a=gc[c[(c[a>>2]|0)+8>>2]&31](a,b)|0;i=d;return a|0}function bv(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0;e=i;i=i+16|0;c[e>>2]=-1;c[e+4>>2]=c[a+16>>2];if((c[b+4>>2]|0)==0)c[b+4>>2]=e;h=c[a+12>>2]|0;f=+hc[c[(c[h>>2]|0)+12>>2]&15](h,b,d);g[a+4>>2]=+g[(c[a+12>>2]|0)+4>>2];i=e;return+f}function cv(a){a=a|0;return}function dv(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function ev(a,b,d,e,f,h){a=a|0;b=b|0;d=d|0;e=+e;f=f|0;h=h|0;var j=0;j=i;i=i+64|0;c[j+48>>2]=f;c[j+52>>2]=h;h=c[a+212>>2]|0;if(!(+g[h+4>>2]>=e)){i=j;return+e}c[j>>2]=c[a+216>>2];c[j+4>>2]=j+48;c[j+8>>2]=c[b+0>>2];c[j+12>>2]=c[b+4>>2];c[j+16>>2]=c[b+8>>2];c[j+20>>2]=c[b+12>>2];c[j+24>>2]=c[d+0>>2];c[j+28>>2]=c[d+4>>2];c[j+32>>2]=c[d+8>>2];c[j+36>>2]=c[d+12>>2];g[j+40>>2]=e;e=+hc[c[(c[h>>2]|0)+12>>2]&15](h,j,0);i=j;return+e}function fv(a){a=a|0;return}function gv(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function hv(a,b,d,e,f,h){a=a|0;b=b|0;d=d|0;e=+e;f=f|0;h=h|0;var j=0;j=i;i=i+64|0;c[j+48>>2]=f;c[j+52>>2]=h;h=c[a+212>>2]|0;if(!(+g[h+4>>2]>=e)){i=j;return+e}c[j>>2]=c[a+216>>2];c[j+4>>2]=j+48;c[j+8>>2]=c[b+0>>2];c[j+12>>2]=c[b+4>>2];c[j+16>>2]=c[b+8>>2];c[j+20>>2]=c[b+12>>2];c[j+24>>2]=c[d+0>>2];c[j+28>>2]=c[d+4>>2];c[j+32>>2]=c[d+8>>2];c[j+36>>2]=c[d+12>>2];g[j+40>>2]=e;e=+hc[c[(c[h>>2]|0)+12>>2]&15](h,j,1);i=j;return+e}function iv(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function jv(a){a=a|0;return}function kv(a){a=a|0;return}function lv(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function mv(a,b){a=a|0;b=b|0;var d=0;d=i;a=c[a+20>>2]|0;a=gc[c[(c[a>>2]|0)+8>>2]&31](a,b)|0;i=d;return a|0}function nv(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0;e=i;i=i+16|0;c[e>>2]=-1;c[e+4>>2]=c[a+24>>2];if((c[b+4>>2]|0)==0)c[b+4>>2]=e;h=c[a+20>>2]|0;f=+hc[c[(c[h>>2]|0)+12>>2]&15](h,b,d);g[a+4>>2]=+g[(c[a+20>>2]|0)+4>>2];i=e;return+f}function ov(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function pv(a,b,c){a=a|0;b=b|0;c=c|0;return}function qv(a,d){a=a|0;d=d|0;var e=0,f=0,h=0;e=i;i=i+128|0;f=c[d+36>>2]|0;d=c[(c[a+8>>2]|0)+24>>2]|0;h=c[d+(f*80|0)+64>>2]|0;co(e+56|0,c[a+12>>2]|0,d+(f*80|0)|0);d=c[a+4>>2]|0;c[e+32>>2]=0;c[e+36>>2]=h;c[e+40>>2]=d;c[e+44>>2]=e+56;c[e+48>>2]=-1;c[e+52>>2]=f;d=c[a+24>>2]|0;g[e+4>>2]=1.0;c[e+8>>2]=0;b[e+12>>1]=1;b[e+14>>1]=-1;c[e+16>>2]=0;c[e>>2]=8664;c[e+20>>2]=d;c[e+24>>2]=f;g[e+4>>2]=+g[d+4>>2];c[e+16>>2]=c[d+16>>2];xu(c[a+16>>2]|0,c[a+20>>2]|0,e+32|0,e);i=e;return}function rv(a,b,d){a=a|0;b=b|0;d=+d;var e=0;e=i;Nb[c[(c[a>>2]|0)+12>>2]&127](a,b);i=e;return}function sv(a,b){a=a|0;b=b|0;return 1}function tv(a,b){a=a|0;b=b|0;return 1}function uv(a){a=a|0;return}function vv(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function wv(a,b,d,e,f){a=a|0;b=b|0;d=+d;e=e|0;f=f|0;var h=0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0;h=i;i=i+48|0;c[h+32>>2]=e;c[h+36>>2]=f;n=+g[b>>2];m=+g[b+4>>2];j=+g[b+8>>2];l=+g[a+56>>2]*n+ +g[a+60>>2]*m+ +g[a+64>>2]*j;k=n*+g[a+72>>2]+m*+g[a+76>>2]+j*+g[a+80>>2];j=n*+g[a+88>>2]+m*+g[a+92>>2]+j*+g[a+96>>2];c[h>>2]=c[a+48>>2];c[h+4>>2]=h+32;g[h+8>>2]=l;g[h+12>>2]=k;g[h+16>>2]=j;g[h+20>>2]=0.0;g[h+24>>2]=d;e=c[a+44>>2]|0;d=+hc[c[(c[e>>2]|0)+12>>2]&15](e,h,1);i=h;return+d}function xv(a){a=a|0;return}function yv(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function zv(a,b,d,e,f){a=a|0;b=b|0;d=+d;e=e|0;f=f|0;var h=0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0;h=i;i=i+48|0;c[h+32>>2]=e;c[h+36>>2]=f;n=+g[b>>2];m=+g[b+4>>2];j=+g[b+8>>2];l=+g[a+56>>2]*n+ +g[a+60>>2]*m+ +g[a+64>>2]*j;k=n*+g[a+72>>2]+m*+g[a+76>>2]+j*+g[a+80>>2];j=n*+g[a+88>>2]+m*+g[a+92>>2]+j*+g[a+96>>2];c[h>>2]=c[a+48>>2];c[h+4>>2]=h+32;g[h+8>>2]=l;g[h+12>>2]=k;g[h+16>>2]=j;g[h+20>>2]=0.0;g[h+24>>2]=d;e=c[a+44>>2]|0;d=+hc[c[(c[e>>2]|0)+12>>2]&15](e,h,1);i=h;return+d}function Av(a,b){a=a|0;b=+b;return}function Bv(a,b){a=a|0;b=b|0;return}function Cv(a,b,c){a=a|0;b=b|0;c=c|0;return}function Dv(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Ev(b,d){b=b|0;d=d|0;var e=0,f=0;e=i;c[b+8>>2]=0;c[b>>2]=9512;a[b+28>>0]=1;c[b+24>>2]=0;c[b+16>>2]=0;c[b+20>>2]=0;g[b+32>>2]=999999984306749400.0;g[b+36>>2]=999999984306749400.0;g[b+40>>2]=999999984306749400.0;g[b+44>>2]=0.0;g[b+48>>2]=-999999984306749400.0;g[b+52>>2]=-999999984306749400.0;g[b+56>>2]=-999999984306749400.0;g[b+60>>2]=0.0;c[b+64>>2]=0;c[b+68>>2]=1;g[b+72>>2]=0.0;g[b+76>>2]=1.0;g[b+80>>2]=1.0;g[b+84>>2]=1.0;g[b+88>>2]=0.0;c[b+4>>2]=31;if(!d){i=e;return}c[5004]=(c[5004]|0)+1;d=XE(79)|0;if((d|0)!=0?(f=d+19&-16,c[f+ -4>>2]=d,(d+19&-16|0)!=0):0){a[f+36>>0]=1;c[f+32>>2]=0;c[f+24>>2]=0;c[f+28>>2]=0;a[f+56>>0]=1;c[f+52>>2]=0;c[f+44>>2]=0;c[f+48>>2]=0;c[(d+19&-16)>>2]=0;c[f+4>>2]=0;c[f+8>>2]=-1;c[f+12>>2]=0;c[f+16>>2]=0;f=d+19&-16}else f=0;c[b+64>>2]=f;i=e;return}function Fv(b){b=b|0;var d=0,e=0,f=0;d=i;c[b>>2]=9512;e=c[b+64>>2]|0;if((e|0)!=0?(Kx(e),f=c[b+64>>2]|0,(f|0)!=0):0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}e=c[b+24>>2]|0;if((e|0)!=0){if((a[b+28>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+24>>2]=0}a[b+28>>0]=1;c[b+24>>2]=0;c[b+16>>2]=0;c[b+20>>2]=0;if((b|0)==0){i=d;return}c[5006]=(c[5006]|0)+1;YE(c[b+ -4>>2]|0);i=d;return}function Gv(b){b=b|0;var d=0,e=0,f=0;d=i;c[b>>2]=9512;e=c[b+64>>2]|0;if((e|0)!=0?(Kx(e),f=c[b+64>>2]|0,(f|0)!=0):0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}e=c[b+24>>2]|0;if((e|0)==0){a[b+28>>0]=1;c[b+24>>2]=0;c[b+16>>2]=0;f=b+20|0;c[f>>2]=0;i=d;return}if((a[b+28>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+24>>2]=0;a[b+28>>0]=1;c[b+24>>2]=0;c[b+16>>2]=0;f=b+20|0;c[f>>2]=0;i=d;return}function Hv(a,b){a=a|0;b=b|0;var d=0,e=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0;d=i;i=i+80|0;c[a+68>>2]=(c[a+68>>2]|0)+1;e=c[a+16>>2]|0;if((e|0)<=0){h=c[a>>2]|0;h=h+68|0;h=c[h>>2]|0;Lb[h&511](a);i=d;return}h=e;do{e=e+ -1|0;g=c[a+24>>2]|0;if((c[g+(e*80|0)+64>>2]|0)==(b|0)){c[a+68>>2]=(c[a+68>>2]|0)+1;f=c[a+64>>2]|0;if((f|0)!=0){g=c[g+(e*80|0)+76>>2]|0;Ox(f,g)|0;h=c[f+4>>2]|0;if((h|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[f+4>>2]=g;c[f+12>>2]=(c[f+12>>2]|0)+ -1;h=c[a+16>>2]|0;g=c[a+24>>2]|0}h=h+ -1|0;m=g+(e*80|0)|0;c[d+0>>2]=c[m+0>>2];c[d+4>>2]=c[m+4>>2];c[d+8>>2]=c[m+8>>2];c[d+12>>2]=c[m+12>>2];l=g+(e*80|0)+16|0;c[d+16>>2]=c[l+0>>2];c[d+20>>2]=c[l+4>>2];c[d+24>>2]=c[l+8>>2];c[d+28>>2]=c[l+12>>2];k=g+(e*80|0)+32|0;c[d+32>>2]=c[k+0>>2];c[d+36>>2]=c[k+4>>2];c[d+40>>2]=c[k+8>>2];c[d+44>>2]=c[k+12>>2];j=g+(e*80|0)+48|0;c[d+48>>2]=c[j+0>>2];c[d+52>>2]=c[j+4>>2];c[d+56>>2]=c[j+8>>2];c[d+60>>2]=c[j+12>>2];f=g+(e*80|0)+64|0;c[d+64>>2]=c[f+0>>2];c[d+68>>2]=c[f+4>>2];c[d+72>>2]=c[f+8>>2];c[d+76>>2]=c[f+12>>2];n=g+(h*80|0)|0;c[m+0>>2]=c[n+0>>2];c[m+4>>2]=c[n+4>>2];c[m+8>>2]=c[n+8>>2];c[m+12>>2]=c[n+12>>2];m=g+(h*80|0)+16|0;c[l+0>>2]=c[m+0>>2];c[l+4>>2]=c[m+4>>2];c[l+8>>2]=c[m+8>>2];c[l+12>>2]=c[m+12>>2];l=g+(h*80|0)+32|0;c[k+0>>2]=c[l+0>>2];c[k+4>>2]=c[l+4>>2];c[k+8>>2]=c[l+8>>2];c[k+12>>2]=c[l+12>>2];k=g+(h*80|0)+48|0;c[j+0>>2]=c[k+0>>2];c[j+4>>2]=c[k+4>>2];c[j+8>>2]=c[k+8>>2];c[j+12>>2]=c[k+12>>2];g=g+(h*80|0)+64|0;c[f+0>>2]=c[g+0>>2];c[f+4>>2]=c[g+4>>2];c[f+8>>2]=c[g+8>>2];c[f+12>>2]=c[g+12>>2];g=c[a+24>>2]|0;c[g+(h*80|0)+0>>2]=c[d+0>>2];c[g+(h*80|0)+4>>2]=c[d+4>>2];c[g+(h*80|0)+8>>2]=c[d+8>>2];c[g+(h*80|0)+12>>2]=c[d+12>>2];c[g+(h*80|0)+16>>2]=c[d+16>>2];c[g+(h*80|0)+20>>2]=c[d+20>>2];c[g+(h*80|0)+24>>2]=c[d+24>>2];c[g+(h*80|0)+28>>2]=c[d+28>>2];c[g+(h*80|0)+32>>2]=c[d+32>>2];c[g+(h*80|0)+36>>2]=c[d+36>>2];c[g+(h*80|0)+40>>2]=c[d+40>>2];c[g+(h*80|0)+44>>2]=c[d+44>>2];c[g+(h*80|0)+48>>2]=c[d+48>>2];c[g+(h*80|0)+52>>2]=c[d+52>>2];c[g+(h*80|0)+56>>2]=c[d+56>>2];c[g+(h*80|0)+60>>2]=c[d+60>>2];c[g+(h*80|0)+64>>2]=c[d+64>>2];c[g+(h*80|0)+68>>2]=c[d+68>>2];c[g+(h*80|0)+72>>2]=c[d+72>>2];c[g+(h*80|0)+76>>2]=c[d+76>>2];if((c[a+64>>2]|0)!=0)c[(c[(c[a+24>>2]|0)+(e*80|0)+76>>2]|0)+36>>2]=e;h=(c[a+16>>2]|0)+ -1|0;c[a+16>>2]=h}}while((e|0)>0);n=c[a>>2]|0;n=n+68|0;n=c[n>>2]|0;Lb[n&511](a);i=d;return}function Iv(a){a=a|0;var b=0,d=0,e=0.0,f=0,h=0;b=i;i=i+32|0;g[a+32>>2]=999999984306749400.0;g[a+36>>2]=999999984306749400.0;g[a+40>>2]=999999984306749400.0;g[a+44>>2]=0.0;g[a+48>>2]=-999999984306749400.0;g[a+52>>2]=-999999984306749400.0;g[a+56>>2]=-999999984306749400.0;g[a+60>>2]=0.0;if((c[a+16>>2]|0)<=0){i=b;return}d=0;do{f=c[a+24>>2]|0;h=c[f+(d*80|0)+64>>2]|0;vc[c[(c[h>>2]|0)+8>>2]&127](h,f+(d*80|0)|0,b+16|0,b);e=+g[b+16>>2];if(+g[a+32>>2]>e)g[a+32>>2]=e;e=+g[b>>2];if(+g[a+48>>2]<e)g[a+48>>2]=e;e=+g[b+20>>2];if(+g[a+36>>2]>e)g[a+36>>2]=e;e=+g[b+4>>2];if(+g[a+52>>2]<e)g[a+52>>2]=e;e=+g[b+24>>2];if(+g[a+40>>2]>e)g[a+40>>2]=e;e=+g[b+8>>2];if(+g[a+56>>2]<e)g[a+56>>2]=e;d=d+1|0}while((d|0)<(c[a+16>>2]|0));i=b;return}function Jv(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0;f=i;t=+g[a+48>>2];v=+g[a+32>>2];E=+g[a+52>>2];w=+g[a+36>>2];F=+g[a+56>>2];k=+g[a+40>>2];G=(c[a+16>>2]|0)==0;x=G?0.0:(F+k)*.5;z=G?0.0:(E+w)*.5;B=G?0.0:(t+v)*.5;o=+$b[c[(c[a>>2]|0)+48>>2]&15](a);m=+$b[c[(c[a>>2]|0)+48>>2]&15](a);o=(G?0.0:(t-v)*.5)+o;m=(G?0.0:(E-w)*.5)+m;k=(G?0.0:(F-k)*.5)+ +$b[c[(c[a>>2]|0)+48>>2]&15](a);F=+g[b>>2];w=+P(+F);E=+g[b+4>>2];v=+P(+E);t=+g[b+8>>2];u=+P(+t);D=+g[b+16>>2];s=+P(+D);C=+g[b+20>>2];r=+P(+C);p=+g[b+24>>2];q=+P(+p);A=+g[b+32>>2];n=+P(+A);y=+g[b+36>>2];l=+P(+y);h=+g[b+40>>2];j=+P(+h);t=B*F+z*E+x*t+ +g[b+48>>2];p=B*D+z*C+x*p+ +g[b+52>>2];h=B*A+z*y+x*h+ +g[b+56>>2];g[d>>2]=t-(o*w+m*v+k*u);g[d+4>>2]=p-(o*s+m*r+k*q);g[d+8>>2]=h-(o*n+m*l+k*j);g[d+12>>2]=0.0;g[e>>2]=o*w+m*v+k*u+t;g[e+4>>2]=o*s+m*r+k*q+p;g[e+8>>2]=o*n+m*l+k*j+h;g[e+12>>2]=0.0;i=f;return}function Kv(a,b,d){a=a|0;b=+b;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0;e=i;i=i+96|0;g[e+32>>2]=1.0;c[e+36>>2]=0;c[e+40>>2]=0;c[e+44>>2]=0;c[e+48>>2]=0;g[e+52>>2]=1.0;c[e+56>>2]=0;c[e+60>>2]=0;c[e+64>>2]=0;c[e+68>>2]=0;g[e+72>>2]=1.0;k=e+76|0;c[k+0>>2]=0;c[k+4>>2]=0;c[k+8>>2]=0;c[k+12>>2]=0;c[k+16>>2]=0;vc[c[(c[a>>2]|0)+8>>2]&127](a,e+32|0,e+16|0,e);h=(+g[e>>2]- +g[e+16>>2])*.5*2.0;f=(+g[e+4>>2]- +g[e+20>>2])*.5*2.0;j=(+g[e+8>>2]- +g[e+24>>2])*.5*2.0;g[d>>2]=b/12.0*(f*f+j*j);g[d+4>>2]=b/12.0*(h*h+j*j);g[d+8>>2]=b/12.0*(h*h+f*f);i=e;return}function Lv(a,b){a=a|0;b=b|0;var d=0,e=0,f=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0.0,r=0.0;k=i;i=i+144|0;if((c[a+16>>2]|0)<=0){p=a+76|0;c[p+0>>2]=c[b+0>>2];c[p+4>>2]=c[b+4>>2];c[p+8>>2]=c[b+8>>2];c[p+12>>2]=c[b+12>>2];p=c[a>>2]|0;p=p+68|0;p=c[p>>2]|0;Lb[p&511](a);i=k;return}f=k+32|0;h=k+48|0;j=k+64|0;e=0;do{p=c[a+24>>2]|0;o=p+(e*80|0)|0;c[k+16>>2]=c[o+0>>2];c[k+20>>2]=c[o+4>>2];c[k+24>>2]=c[o+8>>2];c[k+28>>2]=c[o+12>>2];o=p+(e*80|0)+16|0;c[f+0>>2]=c[o+0>>2];c[f+4>>2]=c[o+4>>2];c[f+8>>2]=c[o+8>>2];c[f+12>>2]=c[o+12>>2];o=p+(e*80|0)+32|0;c[h+0>>2]=c[o+0>>2];c[h+4>>2]=c[o+4>>2];c[h+8>>2]=c[o+8>>2];c[h+12>>2]=c[o+12>>2];o=p+(e*80|0)+48|0;c[j+0>>2]=c[o+0>>2];c[j+4>>2]=c[o+4>>2];c[j+8>>2]=c[o+8>>2];c[j+12>>2]=c[o+12>>2];p=c[p+(e*80|0)+64>>2]|0;p=Pb[c[(c[p>>2]|0)+28>>2]&127](p)|0;c[k+0>>2]=c[p+0>>2];c[k+4>>2]=c[p+4>>2];c[k+8>>2]=c[p+8>>2];q=+g[k+4>>2]*+g[b+4>>2]/+g[a+80>>2];r=+g[k+8>>2]*+g[b+8>>2]/+g[a+84>>2];g[k>>2]=+g[k>>2]*+g[b>>2]/+g[a+76>>2];g[k+4>>2]=q;g[k+8>>2]=r;g[k+12>>2]=0.0;p=c[(c[a+24>>2]|0)+(e*80|0)+64>>2]|0;Nb[c[(c[p>>2]|0)+24>>2]&127](p,k);r=+g[k+68>>2]*+g[b+4>>2]/+g[a+80>>2];q=+g[k+72>>2]*+g[b+8>>2]/+g[a+84>>2];g[k+64>>2]=+g[j>>2]*+g[b>>2]/+g[a+76>>2];g[k+68>>2]=r;g[k+72>>2]=q;g[k+76>>2]=0.0;p=c[a+24>>2]|0;o=p+(e*80|0)|0;c[o+0>>2]=c[k+16>>2];c[o+4>>2]=c[k+20>>2];c[o+8>>2]=c[k+24>>2];c[o+12>>2]=c[k+28>>2];o=p+(e*80|0)+16|0;c[o+0>>2]=c[f+0>>2];c[o+4>>2]=c[f+4>>2];c[o+8>>2]=c[f+8>>2];c[o+12>>2]=c[f+12>>2];o=p+(e*80|0)+32|0;c[o+0>>2]=c[h+0>>2];c[o+4>>2]=c[h+4>>2];c[o+8>>2]=c[h+8>>2];c[o+12>>2]=c[h+12>>2];p=p+(e*80|0)+48|0;c[p+0>>2]=c[j+0>>2];c[p+4>>2]=c[j+4>>2];c[p+8>>2]=c[j+8>>2];c[p+12>>2]=c[j+12>>2];if((c[a+64>>2]|0)!=0){l=c[(c[a+24>>2]|0)+(e*80|0)+64>>2]|0;vc[c[(c[l>>2]|0)+8>>2]&127](l,k+16|0,k+128|0,k+112|0);c[k+80>>2]=c[k+128>>2];c[k+84>>2]=c[k+132>>2];c[k+88>>2]=c[k+136>>2];c[k+92>>2]=c[k+140>>2];c[k+96>>2]=c[k+112>>2];c[k+100>>2]=c[k+116>>2];c[k+104>>2]=c[k+120>>2];c[k+108>>2]=c[k+124>>2];l=c[a+64>>2]|0;d=c[(c[a+24>>2]|0)+(e*80|0)+76>>2]|0;o=Ox(l,d)|0;a:do if((o|0)!=0){m=c[l+8>>2]|0;if(!((m|0)>-1)){o=c[l>>2]|0;break}if((m|0)>0){n=0;while(1){p=c[o+32>>2]|0;n=n+1|0;if((p|0)==0)break a;if((n|0)>=(m|0)){o=p;break}else o=p}}}else o=0;while(0);c[d+0>>2]=c[k+80>>2];c[d+4>>2]=c[k+84>>2];c[d+8>>2]=c[k+88>>2];c[d+12>>2]=c[k+92>>2];c[d+16>>2]=c[k+96>>2];c[d+20>>2]=c[k+100>>2];c[d+24>>2]=c[k+104>>2];c[d+28>>2]=c[k+108>>2];Nx(l,o,d)}e=e+1|0}while((e|0)<(c[a+16>>2]|0));p=a+76|0;c[p+0>>2]=c[b+0>>2];c[p+4>>2]=c[b+4>>2];c[p+8>>2]=c[b+8>>2];c[p+12>>2]=c[b+12>>2];p=c[a>>2]|0;p=p+68|0;p=c[p>>2]|0;Lb[p&511](a);i=k;return}function Mv(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,h=0,j=0,k=0,l=0;e=i;f=gc[c[(c[d>>2]|0)+40>>2]&31](d,a)|0;k=gc[c[(c[d>>2]|0)+28>>2]&31](d,f)|0;c[b>>2]=k;if((k|0)!=0)Nb[c[(c[d>>2]|0)+48>>2]&127](d,f);c[b+4>>2]=c[a+4>>2];g[b+20>>2]=+g[a+72>>2];f=c[a+16>>2]|0;c[b+16>>2]=f;c[b+12>>2]=0;if((f|0)==0){i=e;return 9616}f=Yb[c[(c[d>>2]|0)+16>>2]&31](d,76,f)|0;k=c[f+8>>2]|0;c[b+12>>2]=gc[c[(c[d>>2]|0)+28>>2]&31](d,k)|0;if((c[b+16>>2]|0)>0){j=c[a+24>>2]|0;h=0;while(1){g[k+72>>2]=+g[j+(h*80|0)+72>>2];c[k+64>>2]=gc[c[(c[d>>2]|0)+28>>2]&31](d,c[j+(h*80|0)+64>>2]|0)|0;if((gc[c[(c[d>>2]|0)+24>>2]&31](d,c[(c[a+24>>2]|0)+(h*80|0)+64>>2]|0)|0)==0){j=c[(c[d>>2]|0)+16>>2]|0;l=c[(c[a+24>>2]|0)+(h*80|0)+64>>2]|0;l=Pb[c[(c[l>>2]|0)+52>>2]&127](l)|0;l=Yb[j&31](d,l,1)|0;j=c[(c[a+24>>2]|0)+(h*80|0)+64>>2]|0;j=Yb[c[(c[j>>2]|0)+56>>2]&31](j,c[l+8>>2]|0,d)|0;Jb[c[(c[d>>2]|0)+20>>2]&31](d,l,j,1346455635,c[(c[a+24>>2]|0)+(h*80|0)+64>>2]|0)}j=c[a+24>>2]|0;c[k+68>>2]=c[j+(h*80|0)+68>>2];g[k>>2]=+g[j+(h*80|0)>>2];g[k+4>>2]=+g[j+(h*80|0)+4>>2];g[k+8>>2]=+g[j+(h*80|0)+8>>2];g[k+12>>2]=+g[j+(h*80|0)+12>>2];g[k+16>>2]=+g[j+(h*80|0)+16>>2];g[k+20>>2]=+g[j+(h*80|0)+20>>2];g[k+24>>2]=+g[j+(h*80|0)+24>>2];g[k+28>>2]=+g[j+(h*80|0)+28>>2];g[k+32>>2]=+g[j+(h*80|0)+32>>2];g[k+36>>2]=+g[j+(h*80|0)+36>>2];g[k+40>>2]=+g[j+(h*80|0)+40>>2];g[k+44>>2]=+g[j+(h*80|0)+44>>2];g[k+48>>2]=+g[j+(h*80|0)+48>>2];g[k+52>>2]=+g[j+(h*80|0)+52>>2];g[k+56>>2]=+g[j+(h*80|0)+56>>2];g[k+60>>2]=+g[j+(h*80|0)+60>>2];h=h+1|0;if((h|0)>=(c[b+16>>2]|0)){b=d;break}else k=k+76|0}}else b=d;Jb[c[(c[b>>2]|0)+20>>2]&31](d,f,9584,1497453121,c[f+8>>2]|0);i=e;return 9616}function Nv(a){a=a|0;return a+76|0}function Ov(a){a=a|0;return 9680}function Pv(a,b){a=a|0;b=+b;g[a+72>>2]=b;return}function Qv(a){a=a|0;return+(+g[a+72>>2])}function Rv(a){a=a|0;return 24}function Sv(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0,j=0,k=0.0,l=0,m=0.0,n=0.0;j=i;i=i+48|0;f=+g[b+60>>2]*.5;e=c[b+68>>2]|0;k=+g[d>>2];m=+g[d+4>>2];n=+g[d+8>>2];n=+Q(+(k*k+m*m+n*n));h=c[b+64>>2]|0;if(+g[d+(e<<2)>>2]>n*+g[b+52>>2]){g[j+32+(h<<2)>>2]=0.0;g[j+32+(e<<2)>>2]=f;g[j+32+(c[b+72>>2]<<2)>>2]=0.0;c[a+0>>2]=c[j+32>>2];c[a+4>>2]=c[j+36>>2];c[a+8>>2]=c[j+40>>2];c[a+12>>2]=c[j+44>>2];i=j;return}k=+g[d+(h<<2)>>2];l=c[b+72>>2]|0;m=+g[d+(l<<2)>>2];n=+Q(+(k*k+m*m));if(n>1.1920928955078125e-7){n=+g[b+56>>2]/n;g[j+16+(h<<2)>>2]=k*n;g[j+16+(e<<2)>>2]=-f;g[j+16+(l<<2)>>2]=n*m;c[a+0>>2]=c[j+16>>2];c[a+4>>2]=c[j+20>>2];c[a+8>>2]=c[j+24>>2];c[a+12>>2]=c[j+28>>2];i=j;return}else{g[j+(h<<2)>>2]=0.0;g[j+(e<<2)>>2]=-f;g[j+(l<<2)>>2]=0.0;c[a+0>>2]=c[j+0>>2];c[a+4>>2]=c[j+4>>2];c[a+8>>2]=c[j+8>>2];c[a+12>>2]=c[j+12>>2];i=j;return}}function Tv(a,b,c){a=a|0;b=b|0;c=c|0;var d=0;d=i;Sv(a,b,c);i=d;return}function Uv(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,g=0,h=0;f=i;i=i+16|0;if((e|0)<=0){i=f;return}g=0;do{h=d+(g<<4)|0;Sv(f,a,b+(g<<4)|0);c[h+0>>2]=c[f+0>>2];c[h+4>>2]=c[f+4>>2];c[h+8>>2]=c[f+8>>2];c[h+12>>2]=c[f+12>>2];g=g+1|0}while((g|0)!=(e|0));i=f;return}function Vv(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0;e=i;Sv(a,b,d);if(!(+$b[c[(c[b>>2]|0)+48>>2]&15](b)!=0.0)){i=e;return}l=+g[d>>2];j=+g[d+4>>2];h=+g[d+8>>2];f=l*l+j*j+h*h<1.4210854715202004e-14?-1.0:h;k=l*l+j*j+h*h<1.4210854715202004e-14?-1.0:j;l=l*l+j*j+h*h<1.4210854715202004e-14?-1.0:l;h=1.0/+Q(+(f*f+(l*l+k*k)));j=+$b[c[(c[b>>2]|0)+48>>2]&15](b);g[a>>2]=h*l*j+ +g[a>>2];g[a+4>>2]=j*h*k+ +g[a+4>>2];g[a+8>>2]=j*h*f+ +g[a+8>>2];i=e;return}function Wv(a,b){a=a|0;b=b|0;var d=0.0,e=0.0,f=0.0,h=0,i=0,j=0;j=c[a+68>>2]|0;i=c[a+64>>2]|0;h=c[a+72>>2]|0;e=+g[b+(j<<2)>>2]/+g[a+(j<<2)+12>>2]*+g[a+60>>2];g[a+60>>2]=e;f=+g[a+56>>2]*(+g[b+(i<<2)>>2]/+g[a+(i<<2)+12>>2]+ +g[b+(h<<2)>>2]/+g[a+(h<<2)+12>>2])*.5;g[a+56>>2]=f;g[a+52>>2]=f/+Q(+(e*e+f*f));f=+P(+(+g[b>>2]));e=+P(+(+g[b+4>>2]));d=+P(+(+g[b+8>>2]));g[a+12>>2]=f;g[a+16>>2]=e;g[a+20>>2]=d;g[a+24>>2]=0.0;return}function Xv(a){a=a|0;return}function Yv(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function Zv(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;vc[c[(c[a>>2]|0)+80>>2]&127](a,b,d,e);i=f;return}function _v(a,b,d){a=a|0;b=+b;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0;e=i;i=i+96|0;g[e+32>>2]=1.0;c[e+36>>2]=0;c[e+40>>2]=0;c[e+44>>2]=0;c[e+48>>2]=0;g[e+52>>2]=1.0;c[e+56>>2]=0;c[e+60>>2]=0;c[e+64>>2]=0;c[e+68>>2]=0;g[e+72>>2]=1.0;l=e+76|0;c[l+0>>2]=0;c[l+4>>2]=0;c[l+8>>2]=0;c[l+12>>2]=0;c[l+16>>2]=0;vc[c[(c[a>>2]|0)+8>>2]&127](a,e+32|0,e+16|0,e);j=(+g[e>>2]- +g[e+16>>2])*.5;h=(+g[e+4>>2]- +g[e+20>>2])*.5;k=(+g[e+8>>2]- +g[e+24>>2])*.5;f=+$b[c[(c[a>>2]|0)+48>>2]&15](a);g[d>>2]=b*.0833333283662796*((h+f)*2.0*(h+f)*2.0+(k+f)*2.0*(k+f)*2.0);g[d+4>>2]=b*.0833333283662796*((j+f)*2.0*(j+f)*2.0+(k+f)*2.0*(k+f)*2.0);g[d+8>>2]=b*.0833333283662796*((j+f)*2.0*(j+f)*2.0+(h+f)*2.0*(h+f)*2.0);g[d+12>>2]=0.0;i=e;return}function $v(a){a=a|0;return 10136}function aw(a,b){a=a|0;b=b|0;g[a>>2]=0.0;g[a+4>>2]=1.0;g[a+8>>2]=0.0;g[a+12>>2]=0.0;return}function bw(a,b){a=a|0;b=+b;g[a+44>>2]=b;return}function cw(a){a=a|0;return 60}function dw(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,h=0;e=i;f=gc[c[(c[d>>2]|0)+40>>2]&31](d,a)|0;h=gc[c[(c[d>>2]|0)+28>>2]&31](d,f)|0;c[b>>2]=h;if((h|0)!=0)Nb[c[(c[d>>2]|0)+48>>2]&127](d,f);c[b+4>>2]=c[a+4>>2];g[b+28>>2]=+g[a+28>>2];g[b+32>>2]=+g[a+32>>2];g[b+36>>2]=+g[a+36>>2];g[b+40>>2]=+g[a+40>>2];g[b+12>>2]=+g[a+12>>2];g[b+16>>2]=+g[a+16>>2];g[b+20>>2]=+g[a+20>>2];g[b+24>>2]=+g[a+24>>2];g[b+44>>2]=+g[a+44>>2];c[b+52>>2]=c[a+68>>2];i=e;return 10120}function ew(a){a=a|0;return}function fw(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function gw(a){a=a|0;return 10112}function hw(a,b){a=a|0;b=b|0;g[a>>2]=0.0;g[a+4>>2]=0.0;g[a+8>>2]=1.0;g[a+12>>2]=0.0;return}function iw(a){a=a|0;return}function jw(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function kw(a){a=a|0;return 10104}function lw(a,b){a=a|0;b=b|0;g[a>>2]=1.0;g[a+4>>2]=0.0;g[a+8>>2]=0.0;g[a+12>>2]=0.0;return}



function Vo(a,b){a=a|0;b=b|0;var d=0,e=0,f=0,g=0,h=0,j=0,k=0;d=i;k=c[a+212>>2]|0;a:do if((k|0)>0){f=c[a+220>>2]|0;g=0;while(1){h=f+(g<<2)|0;j=g+1|0;if((c[h>>2]|0)==(b|0))break;if((j|0)<(k|0))g=j;else break a}if((g|0)<(k|0)){c[h>>2]=c[f+(k+ -1<<2)>>2];c[(c[a+220>>2]|0)+(k+ -1<<2)>>2]=b;c[a+212>>2]=k+ -1}}while(0);a=c[b+28>>2]|0;g=c[a+488>>2]|0;b:do if((g|0)>0){f=c[a+496>>2]|0;h=0;while(1){j=f+(h<<2)|0;k=h+1|0;if((c[j>>2]|0)==(b|0))break;if((k|0)<(g|0))h=k;else break b}if((h|0)<(g|0)){c[j>>2]=c[f+(g+ -1<<2)>>2];c[(c[a+496>>2]|0)+(g+ -1<<2)>>2]=b;c[a+488>>2]=g+ -1;g=g+ -1|0}}while(0);c[a+256>>2]=(g|0)>0&1;a=c[b+32>>2]|0;f=c[a+488>>2]|0;if((f|0)<=0){j=f;j=(j|0)>0;j=j&1;k=a+256|0;c[k>>2]=j;i=d;return}h=c[a+496>>2]|0;j=0;while(1){k=h+(j<<2)|0;g=j+1|0;if((c[k>>2]|0)==(b|0))break;if((g|0)<(f|0))j=g;else{e=19;break}}if((e|0)==19){j=(f|0)>0;j=j&1;k=a+256|0;c[k>>2]=j;i=d;return}if((j|0)>=(f|0)){j=f;j=(j|0)>0;j=j&1;k=a+256|0;c[k>>2]=j;i=d;return}c[k>>2]=c[h+(f+ -1<<2)>>2];c[(c[a+496>>2]|0)+(f+ -1<<2)>>2]=b;c[a+488>>2]=f+ -1;j=f+ -1|0;j=(j|0)>0;j=j&1;k=a+256|0;c[k>>2]=j;i=d;return}function Wo(b,d){b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0;e=i;h=c[b+280>>2]|0;if((h|0)==(c[b+284>>2]|0)?(f=(h|0)==0?1:h<<1,(h|0)<(f|0)):0){if((f|0)==0)g=0;else{c[5004]=(c[5004]|0)+1;g=XE((f<<2|3)+16|0)|0;if((g|0)==0)g=0;else{c[(g+19&-16)+ -4>>2]=g;g=g+19&-16}h=c[b+280>>2]|0}if((h|0)>0){j=0;do{k=g+(j<<2)|0;if((k|0)!=0)c[k>>2]=c[(c[b+288>>2]|0)+(j<<2)>>2];j=j+1|0}while((j|0)!=(h|0))}j=c[b+288>>2]|0;if((j|0)!=0){if((a[b+292>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0);h=c[b+280>>2]|0}c[b+288>>2]=0}a[b+292>>0]=1;c[b+288>>2]=g;c[b+284>>2]=f}f=(c[b+288>>2]|0)+(h<<2)|0;if((f|0)==0){k=h+1|0;c[b+280>>2]=k;i=e;return}c[f>>2]=d;k=h+1|0;c[b+280>>2]=k;i=e;return}function Xo(a,b){a=a|0;b=b|0;var d=0,e=0,f=0,g=0,h=0,j=0,k=0;e=i;f=c[a+280>>2]|0;if((f|0)<=0){i=e;return}g=c[a+288>>2]|0;h=0;while(1){j=g+(h<<2)|0;k=h+1|0;if((c[j>>2]|0)==(b|0))break;if((k|0)<(f|0))h=k;else{d=7;break}}if((d|0)==7){i=e;return}if((h|0)>=(f|0)){i=e;return}c[j>>2]=c[g+(f+ -1<<2)>>2];c[(c[a+288>>2]|0)+(f+ -1<<2)>>2]=b;c[a+280>>2]=f+ -1;i=e;return}function Yo(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+64>>2]&127](a,b);i=d;return}function Zo(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+68>>2]&127](a,b);i=d;return}function _o(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+64>>2]&127](a,b);i=d;return}function $o(a,b){a=a|0;b=b|0;var d=0;d=i;Nb[c[(c[a>>2]|0)+68>>2]&127](a,b);i=d;return}function ap(b,d){b=b|0;d=d|0;var e=0,f=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0;e=i;i=i+16|0;oE(1704);f=c[b+212>>2]|0;h=c[b+180>>2]|0;if((h|0)<(f|0)){if((c[b+184>>2]|0)<(f|0)){if((f|0)==0){k=0;n=h}else{c[5004]=(c[5004]|0)+1;k=XE((f<<2|3)+16|0)|0;if((k|0)==0)k=0;else{c[(k+19&-16)+ -4>>2]=k;k=k+19&-16}n=c[b+180>>2]|0}if((n|0)>0){l=0;do{m=k+(l<<2)|0;if((m|0)!=0)c[m>>2]=c[(c[b+188>>2]|0)+(l<<2)>>2];l=l+1|0}while((l|0)!=(n|0))}l=c[b+188>>2]|0;if((l|0)!=0){if((a[b+192>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[l+ -4>>2]|0)}c[b+188>>2]=0}a[b+192>>0]=1;c[b+188>>2]=k;c[b+184>>2]=f;k=b+188|0}else k=b+188|0;do{l=(c[k>>2]|0)+(h<<2)|0;if((l|0)!=0)c[l>>2]=0;h=h+1|0}while((h|0)!=(f|0))}c[b+180>>2]=f;f=0;while(1){if((f|0)>=(Pb[c[(c[b>>2]|0)+104>>2]&127](b)|0))break;c[(c[b+188>>2]|0)+(f<<2)>>2]=c[(c[b+220>>2]|0)+(f<<2)>>2];f=f+1|0}f=c[b+180>>2]|0;if((f|0)>1)sp(b+176|0,0,f+ -1|0);if((Pb[c[(c[b>>2]|0)+104>>2]&127](b)|0)==0)h=0;else h=c[b+188>>2]|0;f=c[b+196>>2]|0;v=c[b+180>>2]|0;k=Pb[c[(c[b>>2]|0)+20>>2]&127](b)|0;c[f+4>>2]=d;c[f+12>>2]=h;c[f+16>>2]=v;c[f+20>>2]=k;k=c[f+32>>2]|0;if((k|0)<0){if((c[f+36>>2]|0)<0){h=c[f+40>>2]|0;if((h|0)!=0){if((a[f+44>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[f+40>>2]=0}a[f+44>>0]=1;c[f+40>>2]=0;c[f+36>>2]=0;h=k}else h=k;do{k=(c[f+40>>2]|0)+(h<<2)|0;if((k|0)!=0)c[k>>2]=0;h=h+1|0}while((h|0)!=0)}c[f+32>>2]=0;h=c[f+52>>2]|0;if((h|0)<0){if((c[f+56>>2]|0)<0){k=c[f+60>>2]|0;if((k|0)!=0){if((a[f+64>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[k+ -4>>2]|0)}c[f+60>>2]=0}a[f+64>>0]=1;c[f+60>>2]=0;c[f+56>>2]=0}do{k=(c[f+60>>2]|0)+(h<<2)|0;if((k|0)!=0)c[k>>2]=0;h=h+1|0}while((h|0)!=0)}c[f+52>>2]=0;k=c[f+72>>2]|0;if((k|0)<0){if((c[f+76>>2]|0)<0){h=c[f+80>>2]|0;if((h|0)!=0){if((a[f+84>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[f+80>>2]=0}a[f+84>>0]=1;c[f+80>>2]=0;c[f+76>>2]=0;h=k}else h=k;do{k=(c[f+80>>2]|0)+(h<<2)|0;if((k|0)!=0)c[k>>2]=0;h=h+1|0}while((h|0)!=0)}c[f+72>>2]=0;f=c[b+200>>2]|0;m=c[(c[f>>2]|0)+8>>2]|0;k=c[b+8>>2]|0;h=c[b+24>>2]|0;h=Pb[c[(c[h>>2]|0)+36>>2]&127](h)|0;rc[m&127](f,k,h);h=c[b+204>>2]|0;k=c[b+24>>2]|0;f=c[b+196>>2]|0;oE(16584);m=c[h+28>>2]|0;if((m|0)<0){if((c[h+32>>2]|0)<0){l=c[h+36>>2]|0;if((l|0)!=0){if((a[h+40>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[l+ -4>>2]|0)}c[h+36>>2]=0}a[h+40>>0]=1;c[h+36>>2]=0;c[h+32>>2]=0}do{l=(c[h+36>>2]|0)+(m<<2)|0;if((l|0)!=0)c[l>>2]=0;m=m+1|0}while((m|0)!=0)}c[h+28>>2]=0;l=c[h+8>>2]|0;if((l|0)>0){m=c[h+16>>2]|0;n=0;do{o=m+(n<<3)|0;q=c[o>>2]|0;if((q|0)==(n|0))r=n;else{p=o;do{r=m+(q<<3)|0;c[p>>2]=c[r>>2];r=c[r>>2]|0;p=m+(r<<3)|0;q=c[p>>2]|0}while((r|0)!=(q|0))}c[o>>2]=r;n=n+1|0}while((n|0)!=(l|0));q=c[h+8>>2]|0;if((q|0)>1){jC(h+4|0,0,q+ -1|0);q=c[h+8>>2]|0}if((q|0)>0){p=c[h+16>>2]|0;r=0;while(1){o=c[p+(r<<3)>>2]|0;m=r;do{m=m+1|0;l=(m|0)<(q|0);if(!l)break}while((c[p+(m<<3)>>2]|0)==(o|0));if((r|0)<(m|0)){n=c[b+16>>2]|0;t=1;s=r;do{u=c[n+(c[p+(s<<3)+4>>2]<<2)>>2]|0;if((c[u+208>>2]|0)==(o|0)){v=c[u+216>>2]|0;t=t&(v|0)!=1&(v|0)!=4}s=s+1|0}while((s|0)!=(m|0));if(t){do{s=c[n+(c[p+(r<<3)+4>>2]<<2)>>2]|0;if((c[s+208>>2]|0)==(o|0)?!(((c[s+216>>2]|0)+ -4|0)>>>0<2):0)c[s+216>>2]=2;r=r+1|0}while((r|0)<(m|0))}else do{s=c[n+(c[p+(r<<3)+4>>2]<<2)>>2]|0;if((c[s+208>>2]|0)==(o|0)?(c[s+216>>2]|0)==2:0){c[s+216>>2]=3;g[s+220>>2]=0.0}r=r+1|0}while((r|0)<(m|0))}if(l)r=m;else break}}}m=Pb[c[(c[k>>2]|0)+36>>2]&127](k)|0;if((m|0)>0){l=0;do{n=gc[c[(c[k>>2]|0)+40>>2]&31](k,l)|0;o=c[n+740>>2]|0;p=c[n+744>>2]|0;if((o|0)!=0?(c[o+216>>2]|0)!=2:0)q=101;else q=99;if(((q|0)==99?(q=0,(p|0)!=0):0)?(c[p+216>>2]|0)!=2:0)q=101;if((q|0)==101){v=c[o+204>>2]|0;if((((v&2|0)!=0?(c[o+216>>2]|0)!=2:0)?(v&4|0)==0:0)?(c[p+204>>2]&3|0)==0:0){if(!(((c[p+216>>2]|0)+ -4|0)>>>0<2))c[p+216>>2]=1;g[p+220>>2]=0.0}v=c[p+204>>2]|0;if((((v&2|0)!=0?(c[p+216>>2]|0)!=2:0)?(v&4|0)==0:0)?(c[o+204>>2]&3|0)==0:0){if(!(((c[o+216>>2]|0)+ -4|0)>>>0<2))c[o+216>>2]=1;g[o+220>>2]=0.0}if((a[h+64>>0]|0)!=0?Yb[c[(c[k>>2]|0)+28>>2]&31](k,o,p)|0:0){p=c[h+28>>2]|0;if((p|0)==(c[h+32>>2]|0)?(j=(p|0)==0?1:p<<1,(p|0)<(j|0)):0){if((j|0)==0)o=0;else{c[5004]=(c[5004]|0)+1;o=XE((j<<2|3)+16|0)|0;if((o|0)==0)o=0;else{c[(o+19&-16)+ -4>>2]=o;o=o+19&-16}p=c[h+28>>2]|0}if((p|0)>0){r=0;do{q=o+(r<<2)|0;if((q|0)!=0)c[q>>2]=c[(c[h+36>>2]|0)+(r<<2)>>2];r=r+1|0}while((r|0)!=(p|0))}q=c[h+36>>2]|0;if((q|0)!=0){if((a[h+40>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[q+ -4>>2]|0);p=c[h+28>>2]|0}c[h+36>>2]=0}a[h+40>>0]=1;c[h+36>>2]=o;c[h+32>>2]=j}o=(c[h+36>>2]|0)+(p<<2)|0;if((o|0)!=0)c[o>>2]=n;c[h+28>>2]=p+1}}l=l+1|0}while((l|0)<(m|0))}j=c[5022]|0;v=(c[j+16>>2]|0)+ -1|0;c[j+16>>2]=v;do if((v|0)==0){if((c[j+4>>2]|0)!=0){Eb(e|0,0)|0;v=c[5008]|0;g[j+8>>2]=+(((c[e+4>>2]|0)-(c[v+4>>2]|0)+(((c[e>>2]|0)-(c[v>>2]|0)|0)*1e6|0)-(c[j+12>>2]|0)|0)>>>0)/1.0e3+ +g[j+8>>2];if((c[j+16>>2]|0)!=0)break;j=c[5022]|0}c[5022]=c[j+20>>2]}while(0);j=c[h+8>>2]|0;oE(16616);if((a[h+64>>0]|0)!=0){k=c[h+28>>2]|0;if((k|0)>1)hB(h+24|0,0,k+ -1|0);if((j|0)>0){n=1;o=0;l=0;do{r=c[h+16>>2]|0;m=c[r+(o<<3)>>2]|0;a:do if((o|0)<(j|0)){q=m;p=1;while(1){if((q|0)!=(m|0))break a;q=c[(c[b+16>>2]|0)+(c[r+(o<<3)+4>>2]<<2)>>2]|0;t=c[h+48>>2]|0;do if((t|0)==(c[h+52>>2]|0)){r=(t|0)==0?1:t<<1;if((t|0)>=(r|0))break;if((r|0)==0)s=0;else{c[5004]=(c[5004]|0)+1;s=XE((r<<2|3)+16|0)|0;if((s|0)==0)s=0;else{c[(s+19&-16)+ -4>>2]=s;s=s+19&-16}t=c[h+48>>2]|0}if((t|0)>0){u=0;do{v=s+(u<<2)|0;if((v|0)!=0)c[v>>2]=c[(c[h+56>>2]|0)+(u<<2)>>2];u=u+1|0}while((u|0)!=(t|0))}u=c[h+56>>2]|0;if((u|0)!=0){if((a[h+60>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[u+ -4>>2]|0);t=c[h+48>>2]|0}c[h+56>>2]=0}a[h+60>>0]=1;c[h+56>>2]=s;c[h+52>>2]=r}while(0);r=(c[h+56>>2]|0)+(t<<2)|0;if((r|0)!=0)c[r>>2]=q;c[h+48>>2]=t+1;v=c[q+216>>2]|0;p=p&((v|0)==2|(v|0)==5);o=o+1|0;if((o|0)>=(j|0))break a;r=c[h+16>>2]|0;q=c[r+(o<<3)>>2]|0}}else p=1;while(0);if((l|0)<(k|0)){r=c[h+36>>2]|0;q=r+(l<<2)|0;s=c[q>>2]|0;t=c[(c[s+740>>2]|0)+208>>2]|0;if(!((t|0)>-1))t=c[(c[s+744>>2]|0)+208>>2]|0;if((t|0)==(m|0)){s=l;do{s=s+1|0;if((s|0)>=(k|0))break;t=c[r+(s<<2)>>2]|0;n=c[(c[t+740>>2]|0)+208>>2]|0;if(!((n|0)>-1))n=c[(c[t+744>>2]|0)+208>>2]|0}while((m|0)==(n|0));n=s;r=s-l|0}else{r=0;q=0}}else{r=0;q=0}if(!p)Zb[c[(c[f>>2]|0)+8>>2]&7](f,c[h+56>>2]|0,c[h+48>>2]|0,q,r,m);l=(r|0)==0?l:n;p=c[h+48>>2]|0;if((p|0)<0){if((c[h+52>>2]|0)<0){m=c[h+56>>2]|0;if((m|0)!=0){if((a[h+60>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[m+ -4>>2]|0)}c[h+56>>2]=0}a[h+60>>0]=1;c[h+56>>2]=0;c[h+52>>2]=0}do{m=(c[h+56>>2]|0)+(p<<2)|0;if((m|0)!=0)c[m>>2]=0;p=p+1|0}while((p|0)!=0)}c[h+48>>2]=0}while((o|0)<(j|0))}}else{u=Pb[c[(c[k>>2]|0)+44>>2]&127](k)|0;v=Pb[c[(c[k>>2]|0)+36>>2]&127](k)|0;Zb[c[(c[f>>2]|0)+8>>2]&7](f,c[b+16>>2]|0,c[b+8>>2]|0,u,v,-1)}f=c[5022]|0;v=(c[f+16>>2]|0)+ -1|0;c[f+16>>2]=v;do if((v|0)==0){if((c[f+4>>2]|0)!=0){Eb(e|0,0)|0;v=c[5008]|0;g[f+8>>2]=+(((c[e+4>>2]|0)-(c[v+4>>2]|0)+(((c[e>>2]|0)-(c[v>>2]|0)|0)*1e6|0)-(c[f+12>>2]|0)|0)>>>0)/1.0e3+ +g[f+8>>2];if((c[f+16>>2]|0)!=0)break;f=c[5022]|0}c[5022]=c[f+20>>2]}while(0);bp(c[b+196>>2]|0);v=c[b+200>>2]|0;rc[c[(c[v>>2]|0)+16>>2]&127](v,d,c[b+72>>2]|0);b=c[5022]|0;v=(c[b+16>>2]|0)+ -1|0;c[b+16>>2]=v;if((v|0)!=0){i=e;return}do if((c[b+4>>2]|0)!=0){Eb(e|0,0)|0;v=c[5008]|0;g[b+8>>2]=+(((c[e+4>>2]|0)-(c[v+4>>2]|0)+(((c[e>>2]|0)-(c[v>>2]|0)|0)*1e6|0)-(c[b+12>>2]|0)|0)>>>0)/1.0e3+ +g[b+8>>2];if((c[b+16>>2]|0)==0){b=c[5022]|0;break}else{i=e;return}}while(0);c[5022]=c[b+20>>2];i=e;return}function bp(b){b=b|0;var d=0,e=0,f=0,g=0,h=0,j=0,k=0,l=0;d=i;e=c[b+32>>2]|0;if((e|0)==0)f=0;else f=c[b+40>>2]|0;g=c[b+52>>2]|0;if((g|0)==0)h=0;else h=c[b+60>>2]|0;j=c[b+72>>2]|0;if((j|0)==0)k=0;else k=c[b+80>>2]|0;l=c[b+8>>2]|0;+ic[c[(c[l>>2]|0)+12>>2]&3](l,f,e,h,g,k,j,c[b+4>>2]|0,c[b+20>>2]|0,c[b+24>>2]|0);e=c[b+32>>2]|0;if((e|0)<0){if((c[b+36>>2]|0)<0){f=c[b+40>>2]|0;if((f|0)!=0){if((a[b+44>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}c[b+40>>2]=0}a[b+44>>0]=1;c[b+40>>2]=0;c[b+36>>2]=0}do{f=(c[b+40>>2]|0)+(e<<2)|0;if((f|0)!=0)c[f>>2]=0;e=e+1|0}while((e|0)!=0)}c[b+32>>2]=0;e=c[b+52>>2]|0;if((e|0)<0){if((c[b+56>>2]|0)<0){f=c[b+60>>2]|0;if((f|0)!=0){if((a[b+64>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}c[b+60>>2]=0}a[b+64>>0]=1;c[b+60>>2]=0;c[b+56>>2]=0}do{f=(c[b+60>>2]|0)+(e<<2)|0;if((f|0)!=0)c[f>>2]=0;e=e+1|0}while((e|0)!=0)}c[b+52>>2]=0;e=c[b+72>>2]|0;if((e|0)>=0){c[b+72>>2]=0;i=d;return}if((c[b+76>>2]|0)<0){f=c[b+80>>2]|0;if((f|0)!=0){if((a[b+84>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}c[b+80>>2]=0}a[b+84>>0]=1;c[b+80>>2]=0;c[b+76>>2]=0;f=e}else f=e;do{e=(c[b+80>>2]|0)+(f<<2)|0;if((e|0)!=0)c[e>>2]=0;f=f+1|0}while((f|0)!=0);c[b+72>>2]=0;i=d;return}function cp(b){b=b|0;var d=0,e=0,f=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0;d=i;i=i+16|0;oE(1728);p=c[b+204>>2]|0;rc[c[(c[p>>2]|0)+8>>2]&127](p,b,c[b+24>>2]|0);if((c[b+308>>2]|0)>0){h=c[b+316>>2]|0;j=0;do{k=c[h+(j<<2)>>2]|0;l=c[k+740>>2]|0;k=c[k+744>>2]|0;if(((l|0)!=0?!((k|0)==0?1:(c[l+204>>2]&3|0)!=0):0)?(c[k+204>>2]&3|0)==0:0){m=c[l+208>>2]|0;l=c[k+208>>2]|0;k=c[(c[b+204>>2]|0)+16>>2]|0;n=c[k+(m<<3)>>2]|0;if((n|0)!=(m|0)){o=k+(m<<3)|0;do{m=k+(n<<3)|0;c[o>>2]=c[m>>2];m=c[m>>2]|0;o=k+(m<<3)|0;n=c[o>>2]|0}while((m|0)!=(n|0))}n=c[k+(l<<3)>>2]|0;if((n|0)!=(l|0)){o=k+(l<<3)|0;do{l=k+(n<<3)|0;c[o>>2]=c[l>>2];l=c[l>>2]|0;o=k+(l<<3)|0;n=c[o>>2]|0}while((l|0)!=(n|0))}if((m|0)!=(l|0)){c[k+(m<<3)>>2]=l;p=k+(l<<3)+4|0;c[p>>2]=(c[p>>2]|0)+(c[k+(m<<3)+4>>2]|0)}}j=j+1|0}while((j|0)<(c[b+308>>2]|0))}h=c[b+212>>2]|0;if((h|0)>0){k=c[b+220>>2]|0;j=0;do{l=c[k+(j<<2)>>2]|0;if((((a[l+20>>0]|0)!=0?(e=c[l+28>>2]|0,f=c[l+32>>2]|0,(e|0)!=0):0)?!((f|0)==0?1:(c[e+204>>2]&3|0)!=0):0)?(c[f+204>>2]&3|0)==0:0){n=c[e+208>>2]|0;m=c[f+208>>2]|0;l=c[(c[b+204>>2]|0)+16>>2]|0;o=c[l+(n<<3)>>2]|0;if((o|0)!=(n|0)){p=l+(n<<3)|0;do{n=l+(o<<3)|0;c[p>>2]=c[n>>2];n=c[n>>2]|0;p=l+(n<<3)|0;o=c[p>>2]|0}while((n|0)!=(o|0))}o=c[l+(m<<3)>>2]|0;if((o|0)!=(m|0)){p=l+(m<<3)|0;do{m=l+(o<<3)|0;c[p>>2]=c[m>>2];m=c[m>>2]|0;p=l+(m<<3)|0;o=c[p>>2]|0}while((m|0)!=(o|0))}if((n|0)!=(m|0)){c[l+(n<<3)>>2]=m;p=l+(m<<3)+4|0;c[p>>2]=(c[p>>2]|0)+(c[l+(n<<3)+4>>2]|0)}}j=j+1|0}while((j|0)!=(h|0))}p=c[b+204>>2]|0;Nb[c[(c[p>>2]|0)+12>>2]&127](p,b);b=c[5022]|0;p=(c[b+16>>2]|0)+ -1|0;c[b+16>>2]=p;if((p|0)!=0){i=d;return}do if((c[b+4>>2]|0)!=0){Eb(d|0,0)|0;p=c[5008]|0;g[b+8>>2]=+(((c[d+4>>2]|0)-(c[p+4>>2]|0)+(((c[d>>2]|0)-(c[p>>2]|0)|0)*1e6|0)-(c[b+12>>2]|0)|0)>>>0)/1.0e3+ +g[b+8>>2];if((c[b+16>>2]|0)==0){b=c[5022]|0;break}else{i=d;return}}while(0);c[5022]=c[b+20>>2];i=d;return}function dp(a){a=a|0;return}function ep(a){a=a|0;return}function fp(d,e){d=d|0;e=+e;var f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0.0,C=0.0,D=0.0,E=0.0;f=i;i=i+352|0;oE(1872);if((c[d+232>>2]|0)>0){q=f+232|0;n=0;do{o=c[(c[d+240>>2]|0)+(n<<2)>>2]|0;g[o+244>>2]=1.0;A=c[o+216>>2]|0;do if(!((A|0)==2|(A|0)==5)?(c[o+204>>2]&3|0)==0:0){ro(o+4|0,+g[o+312>>2],+g[o+316>>2],+g[o+320>>2],o+328|0,e,f+184|0);D=+g[q>>2]- +g[o+52>>2];C=+g[f+236>>2]- +g[o+56>>2];B=+g[f+240>>2]- +g[o+60>>2];if((a[d+44>>0]|0)!=0?(E=+g[o+252>>2],E*E!=0.0?E*E<D*D+C*C+B*B:0):0){oE(1896);if((c[(c[o+192>>2]|0)+4>>2]|0)<20){c[440]=(c[440]|0)+1;z=c[d+68>>2]|0;z=Pb[c[(c[z>>2]|0)+36>>2]&127](z)|0;A=c[d+24>>2]|0;g[f+252>>2]=1.0;b[f+256>>1]=1;b[f+258>>1]=-1;c[f+248>>2]=688;c[f+260>>2]=c[o+52>>2];c[f+264>>2]=c[o+56>>2];c[f+268>>2]=c[o+60>>2];c[f+272>>2]=c[o+64>>2];c[f+276>>2]=c[q+0>>2];c[f+280>>2]=c[q+4>>2];c[f+284>>2]=c[q+8>>2];c[f+288>>2]=c[q+12>>2];c[f+324>>2]=0;c[f+248>>2]=2160;c[f+328>>2]=o;g[f+332>>2]=0.0;c[f+336>>2]=z;c[f+340>>2]=A;B=+g[o+248>>2];c[f+136>>2]=0;g[f+140>>2]=1.0;g[f+144>>2]=1.0;g[f+148>>2]=1.0;g[f+152>>2]=0.0;c[f+128>>2]=16680;c[f+132>>2]=8;g[f+156>>2]=B;g[f+172>>2]=B;g[f+332>>2]=+g[d+56>>2];A=c[o+188>>2]|0;b[f+256>>1]=b[A+4>>1]|0;b[f+258>>1]=b[A+6>>1]|0;c[f+112>>2]=c[q+0>>2];c[f+116>>2]=c[q+4>>2];c[f+120>>2]=c[q+8>>2];c[f+124>>2]=c[q+12>>2];c[f+64>>2]=c[o+4>>2];c[f+68>>2]=c[o+8>>2];c[f+72>>2]=c[o+12>>2];c[f+76>>2]=c[o+16>>2];c[f+80>>2]=c[o+20>>2];c[f+84>>2]=c[o+24>>2];c[f+88>>2]=c[o+28>>2];c[f+92>>2]=c[o+32>>2];c[f+96>>2]=c[o+36>>2];c[f+100>>2]=c[o+40>>2];c[f+104>>2]=c[o+44>>2];c[f+108>>2]=c[o+48>>2];Eu(d,f+128|0,o+4|0,f+64|0,f+248|0,0.0);B=+g[f+252>>2];if(B<1.0){g[o+244>>2]=B;ro(o+4|0,+g[o+312>>2],+g[o+316>>2],+g[o+320>>2],o+328|0,B*e,f+184|0);g[o+244>>2]=0.0;dr(o,f+184|0);r=4}else r=0;if((r|0)==0)p=11}else p=11;if((p|0)==11){p=0;r=0}s=c[5022]|0;A=(c[s+16>>2]|0)+ -1|0;c[s+16>>2]=A;do if((A|0)==0){if((c[s+4>>2]|0)!=0){Eb(f+248|0,0)|0;A=c[5008]|0;g[s+8>>2]=+(((c[f+252>>2]|0)-(c[A+4>>2]|0)+(((c[f+248>>2]|0)-(c[A>>2]|0)|0)*1e6|0)-(c[s+12>>2]|0)|0)>>>0)/1.0e3+ +g[s+8>>2];if((c[s+16>>2]|0)!=0)break;s=c[5022]|0}c[5022]=c[s+20>>2]}while(0);if((r|0)==4)break}dr(o,f+184|0)}while(0);n=n+1|0}while((n|0)<(c[d+232>>2]|0))}do if((a[d+275>>0]|0)!=0){oE(1920);q=c[d+308>>2]|0;if((q|0)>0){n=0;do{o=c[(c[d+316>>2]|0)+(n<<2)>>2]|0;x=c[o+740>>2]|0;if((c[x+236>>2]&2|0)==0)x=0;p=c[o+744>>2]|0;if((c[p+236>>2]&2|0)==0)p=0;z=c[o+748>>2]|0;if((z|0)>0){s=x+52|0;r=x+56|0;q=x+60|0;v=p+52|0;t=p+56|0;u=p+60|0;w=(p|0)==0;if((x|0)==0){x=p+228|0;y=0;do{e=+g[57]*+g[x>>2];if((e>0.0?(h=+g[o+(y*184|0)+124>>2],h!=0.0):0)?(j=e*h*+g[o+(y*184|0)+68>>2],k=e*h*+g[o+(y*184|0)+72>>2],l=e*h*+g[o+(y*184|0)+76>>2],g[f+48>>2]=-j,g[f+52>>2]=-k,g[f+56>>2]=-l,g[f+60>>2]=0.0,E=+g[o+(y*184|0)+56>>2]- +g[r>>2],D=+g[o+(y*184|0)+60>>2]- +g[q>>2],g[f+32>>2]=+g[o+(y*184|0)+52>>2]- +g[s>>2],g[f+36>>2]=E,g[f+40>>2]=D,g[f+44>>2]=0.0,D=+g[o+(y*184|0)+40>>2]- +g[t>>2],E=+g[o+(y*184|0)+44>>2]- +g[u>>2],g[f+16>>2]=+g[o+(y*184|0)+36>>2]- +g[v>>2],g[f+20>>2]=D,g[f+24>>2]=E,g[f+28>>2]=0.0,!w):0){g[f>>2]=j;g[f+4>>2]=k;g[f+8>>2]=l;g[f+12>>2]=0.0;qm(p,f,f+16|0);z=c[o+748>>2]|0}y=y+1|0}while((y|0)<(z|0))}else{z=x+228|0;A=p+228|0;y=0;do{e=+g[z>>2]*+g[A>>2];if((e>0.0?(m=+g[o+(y*184|0)+124>>2],m!=0.0):0)?(D=-(e*m*+g[o+(y*184|0)+72>>2]),E=-(e*m*+g[o+(y*184|0)+76>>2]),g[f+48>>2]=-(e*m*+g[o+(y*184|0)+68>>2]),g[f+52>>2]=D,g[f+56>>2]=E,g[f+60>>2]=0.0,E=+g[o+(y*184|0)+56>>2]- +g[r>>2],D=+g[o+(y*184|0)+60>>2]- +g[q>>2],g[f+32>>2]=+g[o+(y*184|0)+52>>2]- +g[s>>2],g[f+36>>2]=E,g[f+40>>2]=D,g[f+44>>2]=0.0,D=+g[o+(y*184|0)+40>>2]- +g[t>>2],E=+g[o+(y*184|0)+44>>2]- +g[u>>2],g[f+16>>2]=+g[o+(y*184|0)+36>>2]- +g[v>>2],g[f+20>>2]=D,g[f+24>>2]=E,g[f+28>>2]=0.0,qm(x,f+48|0,f+32|0),!w):0){D=-+g[f+52>>2];E=-+g[f+56>>2];g[f>>2]=-+g[f+48>>2];g[f+4>>2]=D;g[f+8>>2]=E;g[f+12>>2]=0.0;qm(p,f,f+16|0)}y=y+1|0}while((y|0)<(c[o+748>>2]|0))}q=c[d+308>>2]|0}n=n+1|0}while((n|0)<(q|0))}d=c[5022]|0;A=(c[d+16>>2]|0)+ -1|0;c[d+16>>2]=A;if((A|0)==0){if((c[d+4>>2]|0)!=0){Eb(f+248|0,0)|0;A=c[5008]|0;g[d+8>>2]=+(((c[f+252>>2]|0)-(c[A+4>>2]|0)+(((c[f+248>>2]|0)-(c[A>>2]|0)|0)*1e6|0)-(c[d+12>>2]|0)|0)>>>0)/1.0e3+ +g[d+8>>2];if((c[d+16>>2]|0)!=0)break;d=c[5022]|0}c[5022]=c[d+20>>2]}}while(0);d=c[5022]|0;A=(c[d+16>>2]|0)+ -1|0;c[d+16>>2]=A;if((A|0)!=0){i=f;return}do if((c[d+4>>2]|0)!=0){Eb(f+248|0,0)|0;A=c[5008]|0;g[d+8>>2]=+(((c[f+252>>2]|0)-(c[A+4>>2]|0)+(((c[f+248>>2]|0)-(c[A>>2]|0)|0)*1e6|0)-(c[d+12>>2]|0)|0)>>>0)/1.0e3+ +g[d+8>>2];if((c[d+16>>2]|0)==0){d=c[5022]|0;break}else{i=f;return}}while(0);c[5022]=c[d+20>>2];i=f;return}function gp(b,d){b=b|0;d=+d;var e=0,f=0,h=0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0;e=i;i=i+16|0;oE(1960);s=c[b+232>>2]|0;if((s|0)>0){f=0;do{h=c[(c[b+240>>2]|0)+(f<<2)>>2]|0;if((c[h+204>>2]&3|0)==0){k=+g[h+444>>2];n=+R(+(1.0-k),+d);p=n*+g[h+312>>2];g[h+312>>2]=p;m=n*+g[h+316>>2];g[h+316>>2]=m;n=n*+g[h+320>>2];g[h+320>>2]=n;j=+g[h+448>>2];q=+R(+(1.0-j),+d);l=q*+g[h+328>>2];g[h+328>>2]=l;o=q*+g[h+332>>2];g[h+332>>2]=o;q=q*+g[h+336>>2];g[h+336>>2]=q;do if((a[h+452>>0]|0)!=0){if(q*q+(l*l+o*o)<+g[h+464>>2]?p*p+m*m+n*n<+g[h+460>>2]:0){r=+g[h+456>>2];g[h+328>>2]=l*r;g[h+332>>2]=r*o;g[h+336>>2]=r*q;g[h+312>>2]=r*p;g[h+316>>2]=r*m;g[h+320>>2]=r*n;p=r*p;m=r*m;n=r*n;l=l*r;o=r*o;q=r*q}r=+Q(+(p*p+m*m+n*n));do if(r<k)if(r>.004999999888241291){p=p-p*(1.0/r)*.004999999888241291;g[h+312>>2]=p;m=m-m*(1.0/r)*.004999999888241291;g[h+316>>2]=m;n=n-n*(1.0/r)*.004999999888241291;g[h+320>>2]=n;break}else{c[h+312>>2]=0;c[h+316>>2]=0;c[h+320>>2]=0;c[h+324>>2]=0;p=0.0;m=0.0;n=0.0;break}while(0);k=+Q(+(l*l+o*o+q*q));if(k<j)if(k>.004999999888241291){g[h+328>>2]=l-l*(1.0/k)*.004999999888241291;g[h+332>>2]=o-o*(1.0/k)*.004999999888241291;g[h+336>>2]=q-q*(1.0/k)*.004999999888241291;break}else{c[h+328>>2]=0;c[h+332>>2]=0;c[h+336>>2]=0;c[h+340>>2]=0;break}}while(0);ro(h+4|0,p,m,n,h+328|0,d,h+68|0);s=c[b+232>>2]|0}f=f+1|0}while((f|0)<(s|0))}b=c[5022]|0;s=(c[b+16>>2]|0)+ -1|0;c[b+16>>2]=s;if((s|0)!=0){i=e;return}do if((c[b+4>>2]|0)!=0){Eb(e|0,0)|0;s=c[5008]|0;g[b+8>>2]=+(((c[e+4>>2]|0)-(c[s+4>>2]|0)+(((c[e>>2]|0)-(c[s>>2]|0)|0)*1e6|0)-(c[b+12>>2]|0)|0)>>>0)/1.0e3+ +g[b+8>>2];if((c[b+16>>2]|0)==0){b=c[5022]|0;break}else{i=e;return}}while(0);c[5022]=c[b+20>>2];i=e;return}function hp(b,d){b=b|0;d=d|0;var e=0,f=0;e=i;if((a[b+273>>0]|0)!=0?(f=c[b+200>>2]|0,(f|0)!=0):0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}a[b+273>>0]=0;c[b+200>>2]=d;c[(c[b+196>>2]|0)+8>>2]=d;i=e;return}function ip(a){a=a|0;return c[a+200>>2]|0}function jp(a){a=a|0;return c[a+212>>2]|0}function kp(a,b){a=a|0;b=b|0;return c[(c[a+220>>2]|0)+(b<<2)>>2]|0}function lp(a,b){a=a|0;b=b|0;return c[(c[a+220>>2]|0)+(b<<2)>>2]|0}function mp(a,b){a=a|0;b=b|0;var d=0,e=0,f=0,h=0,j=0;d=i;Lb[c[(c[b>>2]|0)+32>>2]&511](b);e=Yb[c[(c[b>>2]|0)+16>>2]&31](b,104,1)|0;f=c[e+8>>2]|0;h=f+0|0;j=h+104|0;do{c[h>>2]=0;h=h+4|0}while((h|0)<(j|0));g[f+88>>2]=+g[a+248>>2];g[f+92>>2]=+g[a+252>>2];g[f+96>>2]=+g[a+256>>2];g[f+100>>2]=+g[a+260>>2];g[f>>2]=+g[a+92>>2];g[f+4>>2]=+g[a+96>>2];g[f+8>>2]=+g[a+100>>2];g[f+12>>2]=+g[a+104>>2];g[f+16>>2]=+g[a+108>>2];g[f+20>>2]=+g[a+116>>2];g[f+24>>2]=+g[a+120>>2];g[f+28>>2]=+g[a+124>>2];g[f+32>>2]=+g[a+128>>2];g[f+36>>2]=+g[a+132>>2];g[f+40>>2]=+g[a+140>>2];g[f+44>>2]=+g[a+144>>2];g[f+48>>2]=+g[a+148>>2];g[f+52>>2]=+g[a+152>>2];g[f+56>>2]=+g[a+168>>2];g[f+60>>2]=+g[a+172>>2];c[f+64>>2]=c[a+112>>2];c[f+68>>2]=c[a+156>>2];c[f+72>>2]=c[a+160>>2];c[f+76>>2]=c[a+164>>2];c[f+80>>2]=c[a+136>>2];Jb[c[(c[b>>2]|0)+20>>2]&31](b,e,1992,1145853764,f);f=c[a+8>>2]|0;if((f|0)>0){e=0;do{h=c[(c[a+16>>2]|0)+(e<<2)>>2]|0;if((c[h+236>>2]&2|0)!=0){j=Pb[c[(c[h>>2]|0)+16>>2]&127](h)|0;j=Yb[c[(c[b>>2]|0)+16>>2]&31](b,j,1)|0;f=Yb[c[(c[h>>2]|0)+20>>2]&31](h,c[j+8>>2]|0,b)|0;Jb[c[(c[b>>2]|0)+20>>2]&31](b,j,f,1497645650,h);f=c[a+8>>2]|0}e=e+1|0}while((e|0)<(f|0))}if((c[a+212>>2]|0)<=0){Lu(a,b);j=c[b>>2]|0;j=j+36|0;j=c[j>>2]|0;Lb[j&511](b);i=d;return}e=0;do{j=c[(c[a+220>>2]|0)+(e<<2)>>2]|0;f=Pb[c[(c[j>>2]|0)+36>>2]&127](j)|0;f=Yb[c[(c[b>>2]|0)+16>>2]&31](b,f,1)|0;h=Yb[c[(c[j>>2]|0)+40>>2]&31](j,c[f+8>>2]|0,b)|0;Jb[c[(c[b>>2]|0)+20>>2]&31](b,f,h,1397641027,j);e=e+1|0}while((e|0)<(c[a+212>>2]|0));Lu(a,b);j=c[b>>2]|0;j=j+36|0;j=c[j>>2]|0;Lb[j&511](b);i=d;return}function np(a,b){a=a|0;b=b|0;c[a+72>>2]=b;return}function op(a){a=a|0;return c[a+72>>2]|0}function pp(a){a=a|0;return 2}function qp(a,b){a=a|0;b=b|0;return}function rp(a,b){a=a|0;b=+b;var d=0,e=0,f=0;d=i;i=i+16|0;oE(1664);if((c[a+280>>2]|0)>0){e=0;do{f=c[(c[a+288>>2]|0)+(e<<2)>>2]|0;tc[c[(c[f>>2]|0)+8>>2]&7](f,a,b);e=e+1|0}while((e|0)<(c[a+280>>2]|0))}a=c[5022]|0;f=(c[a+16>>2]|0)+ -1|0;c[a+16>>2]=f;if((f|0)!=0){i=d;return}do if((c[a+4>>2]|0)!=0){Eb(d|0,0)|0;f=c[5008]|0;g[a+8>>2]=+(((c[d+4>>2]|0)-(c[f+4>>2]|0)+(((c[d>>2]|0)-(c[f>>2]|0)|0)*1e6|0)-(c[a+12>>2]|0)|0)>>>0)/1.0e3+ +g[a+8>>2];if((c[a+16>>2]|0)==0){a=c[5022]|0;break}else{i=d;return}}while(0);c[5022]=c[a+20>>2];i=d;return}function sp(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0;e=i;while(1){f=c[a+12>>2]|0;g=c[f+(((b+d|0)/2|0)<<2)>>2]|0;l=b;k=d;while(1){h=c[(c[g+28>>2]|0)+208>>2]|0;if((h|0)>-1)while(1){j=c[f+(l<<2)>>2]|0;m=c[(c[j+28>>2]|0)+208>>2]|0;if(!((m|0)>-1))m=c[(c[j+32>>2]|0)+208>>2]|0;if((m|0)<(h|0))l=l+1|0;else break}else{m=c[(c[g+32>>2]|0)+208>>2]|0;while(1){j=c[f+(l<<2)>>2]|0;n=c[(c[j+28>>2]|0)+208>>2]|0;if(!((n|0)>-1))n=c[(c[j+32>>2]|0)+208>>2]|0;if((n|0)<(m|0))l=l+1|0;else break}}if((h|0)>-1)while(1){m=c[f+(k<<2)>>2]|0;n=c[(c[m+28>>2]|0)+208>>2]|0;if(!((n|0)>-1))n=c[(c[m+32>>2]|0)+208>>2]|0;if((h|0)<(n|0))k=k+ -1|0;else break}else{h=c[(c[g+32>>2]|0)+208>>2]|0;while(1){m=c[f+(k<<2)>>2]|0;n=c[(c[m+28>>2]|0)+208>>2]|0;if(!((n|0)>-1))n=c[(c[m+32>>2]|0)+208>>2]|0;if((h|0)<(n|0))k=k+ -1|0;else break}}if((l|0)<=(k|0)){c[f+(l<<2)>>2]=m;c[(c[a+12>>2]|0)+(k<<2)>>2]=j;l=l+1|0;k=k+ -1|0}if((l|0)>(k|0))break;f=c[a+12>>2]|0}if((k|0)>(b|0))sp(a,b,k);if((l|0)<(d|0))b=l;else break}i=e;return}function tp(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function up(a){a=a|0;return a+12|0}function vp(a){a=a|0;return 2144}function wp(a,b){a=a|0;b=b|0;g[a>>2]=1.0;g[a+4>>2]=1.0;g[a+8>>2]=1.0;g[a+12>>2]=0.0;return}function xp(a,b){a=a|0;b=+b;g[a+44>>2]=b;return}function yp(a){a=a|0;return+(+g[a+28>>2]*+g[a+12>>2])}function zp(a){a=a|0;return 52}function Ap(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,h=0;e=i;f=gc[c[(c[d>>2]|0)+40>>2]&31](d,a)|0;h=gc[c[(c[d>>2]|0)+28>>2]&31](d,f)|0;c[b>>2]=h;if((h|0)!=0)Nb[c[(c[d>>2]|0)+48>>2]&127](d,f);c[b+4>>2]=c[a+4>>2];g[b+28>>2]=+g[a+28>>2];g[b+32>>2]=+g[a+32>>2];g[b+36>>2]=+g[a+36>>2];g[b+40>>2]=+g[a+40>>2];g[b+12>>2]=+g[a+12>>2];g[b+16>>2]=+g[a+16>>2];g[b+20>>2]=+g[a+20>>2];g[b+24>>2]=+g[a+24>>2];g[b+44>>2]=+g[a+44>>2];i=e;return 2112}function Bp(a){a=a|0;return 0}function Cp(a,b,c){a=a|0;b=b|0;c=c|0;return}function Dp(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Ep(a,d){a=a|0;d=d|0;var e=0,f=0,g=0;e=i;g=c[d>>2]|0;f=c[a+80>>2]|0;if((g|0)==(f|0)){d=0;i=e;return d|0}if((b[a+10>>1]&b[d+4>>1])<<16>>16==0){d=0;i=e;return d|0}if((b[d+6>>1]&b[a+8>>1])<<16>>16==0){d=0;i=e;return d|0}d=c[a+92>>2]|0;d=Yb[c[(c[d>>2]|0)+28>>2]&31](d,f,g)|0;i=e;return d|0}function Fp(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0;e=i;f=c[b>>2]|0;if((f|0)==(c[a+80>>2]|0)){h=1.0;i=e;return+h}if((c[f+204>>2]&4|0)!=0){h=1.0;i=e;return+h}if((+g[a+28>>2]- +g[a+12>>2])*+g[b+8>>2]+(+g[a+32>>2]- +g[a+16>>2])*+g[b+12>>2]+(+g[a+36>>2]- +g[a+20>>2])*+g[b+16>>2]>=-+g[a+84>>2]){h=1.0;i=e;return+h}g[a+4>>2]=+g[b+40>>2];c[a+76>>2]=f;if(d){c[a+44>>2]=c[b+8>>2];c[a+48>>2]=c[b+12>>2];c[a+52>>2]=c[b+16>>2];c[a+56>>2]=c[b+20>>2]}else{m=+g[b+8>>2];l=+g[b+12>>2];k=+g[b+16>>2];j=m*+g[f+20>>2]+l*+g[f+24>>2]+k*+g[f+28>>2];h=m*+g[f+36>>2]+l*+g[f+40>>2]+k*+g[f+44>>2];g[a+44>>2]=+g[f+4>>2]*m+ +g[f+8>>2]*l+ +g[f+12>>2]*k;g[a+48>>2]=j;g[a+52>>2]=h;g[a+56>>2]=0.0}c[a+60>>2]=c[b+24>>2];c[a+64>>2]=c[b+28>>2];c[a+68>>2]=c[b+32>>2];c[a+72>>2]=c[b+36>>2];m=+g[b+40>>2];i=e;return+m}function Gp(a){a=a|0;var b=0;b=i;Jp(a);i=b;return}function Hp(a){a=a|0;var b=0;b=i;Jp(a);YE(a);i=b;return}function Ip(b,d,e,f,g,h){b=b|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;var j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0;j=i;if((h|0)<0){r=c[b+8>>2]|0;+ic[c[(c[r>>2]|0)+12>>2]&3](r,d,e,f,g,c[b+12>>2]|0,c[b+16>>2]|0,c[b+4>>2]|0,c[b+20>>2]|0,c[b+24>>2]|0);i=j;return}m=c[b+16>>2]|0;a:do if((m|0)>0){l=c[b+12>>2]|0;o=0;while(1){k=l+(o<<2)|0;p=c[k>>2]|0;n=c[(c[p+28>>2]|0)+208>>2]|0;if((n|0)>-1)p=n;else p=c[(c[p+32>>2]|0)+208>>2]|0;n=o+1|0;if((p|0)==(h|0))break a;if((n|0)<(m|0))o=n;else{o=n;k=0;break}}}else{o=0;k=0}while(0);if((o|0)<(m|0)){n=c[b+12>>2]|0;l=0;do{q=c[n+(o<<2)>>2]|0;p=c[(c[q+28>>2]|0)+208>>2]|0;if(!((p|0)>-1))p=c[(c[q+32>>2]|0)+208>>2]|0;l=((p|0)==(h|0)&1)+l|0;o=o+1|0}while((o|0)<(m|0))}else l=0;h=c[b+4>>2]|0;if((c[h+72>>2]|0)<2){r=c[b+8>>2]|0;+ic[c[(c[r>>2]|0)+12>>2]&3](r,d,e,f,g,k,l,h,c[b+20>>2]|0,c[b+24>>2]|0);i=j;return}if((e|0)>0){o=c[b+32>>2]|0;p=c[b+36>>2]|0;h=0;while(1){m=d+(h<<2)|0;if((o|0)==(p|0)){n=(p|0)==0?1:p<<1;if((p|0)<(n|0)){if((n|0)==0)o=0;else{c[5004]=(c[5004]|0)+1;o=XE((n<<2|3)+16|0)|0;if((o|0)==0)o=0;else{c[(o+19&-16)+ -4>>2]=o;o=o+19&-16}p=c[b+32>>2]|0}if((p|0)>0){r=0;do{q=o+(r<<2)|0;if((q|0)!=0)c[q>>2]=c[(c[b+40>>2]|0)+(r<<2)>>2];r=r+1|0}while((r|0)!=(p|0))}q=c[b+40>>2]|0;if((q|0)!=0){if((a[b+44>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[q+ -4>>2]|0);p=c[b+32>>2]|0}c[b+40>>2]=0}a[b+44>>0]=1;c[b+40>>2]=o;c[b+36>>2]=n;o=p}else{o=p;n=p}}else n=p;p=(c[b+40>>2]|0)+(o<<2)|0;if((p|0)!=0)c[p>>2]=c[m>>2];o=o+1|0;c[b+32>>2]=o;h=h+1|0;if((h|0)==(e|0))break;else p=n}}if((g|0)>0){m=c[b+52>>2]|0;n=c[b+56>>2]|0;d=0;while(1){e=f+(d<<2)|0;if((m|0)==(n|0)){h=(n|0)==0?1:n<<1;if((n|0)<(h|0)){if((h|0)==0)m=0;else{c[5004]=(c[5004]|0)+1;m=XE((h<<2|3)+16|0)|0;if((m|0)==0)m=0;else{c[(m+19&-16)+ -4>>2]=m;m=m+19&-16}n=c[b+52>>2]|0}if((n|0)>0){p=0;do{o=m+(p<<2)|0;if((o|0)!=0)c[o>>2]=c[(c[b+60>>2]|0)+(p<<2)>>2];p=p+1|0}while((p|0)!=(n|0))}o=c[b+60>>2]|0;if((o|0)!=0){if((a[b+64>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[o+ -4>>2]|0);n=c[b+52>>2]|0}c[b+60>>2]=0}a[b+64>>0]=1;c[b+60>>2]=m;c[b+56>>2]=h;m=n}else{m=n;h=n}}else h=n;n=(c[b+60>>2]|0)+(m<<2)|0;if((n|0)!=0)c[n>>2]=c[e>>2];m=m+1|0;c[b+52>>2]=m;d=d+1|0;if((d|0)==(g|0))break;else n=h}}if((l|0)>0){e=c[b+72>>2]|0;h=c[b+76>>2]|0;f=0;while(1){g=k+(f<<2)|0;if((e|0)==(h|0)){d=(h|0)==0?1:h<<1;if((h|0)<(d|0)){if((d|0)==0)e=0;else{c[5004]=(c[5004]|0)+1;e=XE((d<<2|3)+16|0)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}h=c[b+72>>2]|0}if((h|0)>0){m=0;do{n=e+(m<<2)|0;if((n|0)!=0)c[n>>2]=c[(c[b+80>>2]|0)+(m<<2)>>2];m=m+1|0}while((m|0)!=(h|0))}m=c[b+80>>2]|0;if((m|0)!=0){if((a[b+84>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[m+ -4>>2]|0);h=c[b+72>>2]|0}c[b+80>>2]=0}a[b+84>>0]=1;c[b+80>>2]=e;c[b+76>>2]=d;e=h}else{e=h;d=h}}else d=h;h=(c[b+80>>2]|0)+(e<<2)|0;if((h|0)!=0)c[h>>2]=c[g>>2];e=e+1|0;c[b+72>>2]=e;f=f+1|0;if((f|0)==(l|0))break;else h=d}}else e=c[b+72>>2]|0;if(((c[b+52>>2]|0)+e|0)<=(c[(c[b+4>>2]|0)+72>>2]|0)){i=j;return}bp(b);i=j;return}function Jp(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=2240;e=c[b+80>>2]|0;if((e|0)!=0){if((a[b+84>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+80>>2]=0}a[b+84>>0]=1;c[b+80>>2]=0;c[b+72>>2]=0;c[b+76>>2]=0;e=c[b+60>>2]|0;if((e|0)!=0){if((a[b+64>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+60>>2]=0}a[b+64>>0]=1;c[b+60>>2]=0;c[b+52>>2]=0;c[b+56>>2]=0;e=c[b+40>>2]|0;if((e|0)==0){a[b+44>>0]=1;c[b+40>>2]=0;c[b+32>>2]=0;e=b+36|0;c[e>>2]=0;i=d;return}if((a[b+44>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+40>>2]=0;a[b+44>>0]=1;c[b+40>>2]=0;c[b+32>>2]=0;e=b+36|0;c[e>>2]=0;i=d;return}function Kp(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0;f=i;i=i+128|0;co(f+64|0,d,b+48|0);c[b+1064>>2]=c[f+64>>2];c[b+1068>>2]=c[f+68>>2];c[b+1072>>2]=c[f+72>>2];c[b+1076>>2]=c[f+76>>2];c[b+1080>>2]=c[f+80>>2];c[b+1084>>2]=c[f+84>>2];c[b+1088>>2]=c[f+88>>2];c[b+1092>>2]=c[f+92>>2];c[b+1096>>2]=c[f+96>>2];c[b+1100>>2]=c[f+100>>2];c[b+1104>>2]=c[f+104>>2];c[b+1108>>2]=c[f+108>>2];c[b+1112>>2]=c[f+112>>2];c[b+1116>>2]=c[f+116>>2];c[b+1120>>2]=c[f+120>>2];c[b+1124>>2]=c[f+124>>2];co(f,e,b+112|0);c[b+1128>>2]=c[f+0>>2];c[b+1132>>2]=c[f+4>>2];c[b+1136>>2]=c[f+8>>2];c[b+1140>>2]=c[f+12>>2];c[b+1144>>2]=c[f+16>>2];c[b+1148>>2]=c[f+20>>2];c[b+1152>>2]=c[f+24>>2];c[b+1156>>2]=c[f+28>>2];c[b+1160>>2]=c[f+32>>2];c[b+1164>>2]=c[f+36>>2];c[b+1168>>2]=c[f+40>>2];c[b+1172>>2]=c[f+44>>2];c[b+1176>>2]=c[f+48>>2];c[b+1180>>2]=c[f+52>>2];c[b+1184>>2]=c[f+56>>2];c[b+1188>>2]=c[f+60>>2];w=+g[b+1176>>2]- +g[b+1112>>2];x=+g[b+1180>>2]- +g[b+1116>>2];t=+g[b+1184>>2]- +g[b+1120>>2];r=+g[b+1084>>2];q=+g[b+1104>>2];m=+g[b+1088>>2];h=+g[b+1100>>2];s=+g[b+1096>>2];n=+g[b+1080>>2];o=+g[b+1064>>2];l=+g[b+1068>>2];k=+g[b+1072>>2];j=1.0/((r*q-m*h)*o+l*(m*s-q*n)+(h*n-r*s)*k);p=(h*n-r*s)*j;v=(r*q-m*h)*j*w+j*(h*k-q*l)*x+j*(m*l-r*k)*t;u=w*(m*s-q*n)*j+x*j*(q*o-s*k)+j*(n*k-m*o)*t;t=w*p+j*(s*l-h*o)*x+j*(r*o-n*l)*t;g[b+1256>>2]=v;g[b+1260>>2]=u;g[b+1264>>2]=t;g[b+1268>>2]=0.0;g[b+840>>2]=v;x=+g[b+680>>2];w=+g[b+696>>2];do if(!(x>w)){if(x>v){c[b+856>>2]=2;g[b+824>>2]=v-x;break}if(w<v){c[b+856>>2]=1;g[b+824>>2]=v-w;break}else{c[b+856>>2]=0;g[b+824>>2]=0.0;break}}else{c[b+856>>2]=0;g[b+824>>2]=0.0}while(0);g[b+844>>2]=u;w=+g[b+684>>2];v=+g[b+700>>2];do if(!(w>v)){if(w>u){c[b+860>>2]=2;g[b+828>>2]=u-w;break}if(v<u){c[b+860>>2]=1;g[b+828>>2]=u-v;break}else{c[b+860>>2]=0;g[b+828>>2]=0.0;break}}else{c[b+860>>2]=0;g[b+828>>2]=0.0}while(0);g[b+848>>2]=t;v=+g[b+688>>2];u=+g[b+704>>2];do if(!(v>u)){if(v>t){c[b+864>>2]=2;g[b+832>>2]=t-v;break}if(u<t){c[b+864>>2]=1;g[b+832>>2]=t-u;break}else{c[b+864>>2]=0;g[b+832>>2]=0.0;break}}else{c[b+864>>2]=0;g[b+832>>2]=0.0}while(0);B=+g[b+1128>>2];A=+g[b+1144>>2];w=+g[b+1160>>2];u=+g[b+1132>>2];v=+g[b+1148>>2];x=+g[b+1164>>2];C=(r*q-m*h)*j*u+j*(h*k-q*l)*v+j*(m*l-r*k)*x;t=(m*s-q*n)*j*u+j*(q*o-s*k)*v+j*(n*k-m*o)*x;z=B*p+j*(s*l-h*o)*A+j*(r*o-n*l)*w;y=p*+g[b+1136>>2]+j*(s*l-h*o)*+g[b+1152>>2]+j*(r*o-n*l)*+g[b+1168>>2];do if(z<1.0)if(z>-1.0){g[b+1192>>2]=+Y(+-(p*u+j*(s*l-h*o)*v+j*(r*o-n*l)*x),+y);C=z<-1.0?-1.0:z;g[b+1196>>2]=+W(+(C>1.0?1.0:C));g[b+1200>>2]=+Y(+-(B*(m*s-q*n)*j+A*j*(q*o-s*k)+j*(n*k-m*o)*w),+(B*(r*q-m*h)*j+A*j*(h*k-q*l)+j*(m*l-r*k)*w));break}else{g[b+1192>>2]=-+Y(+C,+t);g[b+1196>>2]=-1.5707963705062866;g[b+1200>>2]=0.0;break}else{g[b+1192>>2]=+Y(+C,+t);g[b+1196>>2]=1.5707963705062866;g[b+1200>>2]=0.0}while(0);g[b+1236>>2]=0.0;t=q*(B*q-w*k)-m*(A*k-B*m);u=k*(A*k-B*m)-q*(w*m-A*q);v=m*(w*m-A*q)-k*(B*q-w*k);g[b+1220>>2]=0.0;x=A*(A*k-B*m)-w*(B*q-w*k);y=w*(w*m-A*q)-B*(A*k-B*m);z=B*(B*q-w*k)-A*(w*m-A*q);g[b+1252>>2]=0.0;C=1.0/+Q(+(t*t+u*u+v*v));g[b+1208>>2]=t*C;g[b+1212>>2]=u*C;g[b+1216>>2]=v*C;C=1.0/+Q(+((w*m-A*q)*(w*m-A*q)+(B*q-w*k)*(B*q-w*k)+(A*k-B*m)*(A*k-B*m)));g[b+1224>>2]=(w*m-A*q)*C;g[b+1228>>2]=(B*q-w*k)*C;g[b+1232>>2]=(A*k-B*m)*C;C=1.0/+Q(+(x*x+y*y+z*z));g[b+1240>>2]=x*C;g[b+1244>>2]=y*C;g[b+1248>>2]=z*C;if((a[b+1301>>0]|0)==0){i=f;return}j=+g[(c[b+28>>2]|0)+344>>2];h=+g[(c[b+32>>2]|0)+344>>2];if(j<1.1920928955078125e-7)d=1;else d=h<1.1920928955078125e-7&1;a[b+1280>>0]=d;if(j+h>0.0){g[b+1272>>2]=h/(j+h);h=h/(j+h)}else{g[b+1272>>2]=.5;h=.5}g[b+1276>>2]=1.0-h;i=f;return}function Lp(a,b,d,e,f,h,j,k,l){a=a|0;b=b|0;d=d|0;e=+e;f=+f;h=+h;j=+j;k=+k;l=+l;var m=0,n=0;m=i;i=i+128|0;if((b|0)==0){i=m;return}n=c[a+28>>2]|0;g[m+80>>2]=+g[n+4>>2];g[m+84>>2]=+g[n+20>>2];g[m+88>>2]=+g[n+36>>2];g[m+92>>2]=0.0;g[m+96>>2]=+g[n+8>>2];g[m+100>>2]=+g[n+24>>2];g[m+104>>2]=+g[n+40>>2];g[m+108>>2]=0.0;g[m+112>>2]=+g[n+12>>2];g[m+116>>2]=+g[n+28>>2];g[m+120>>2]=+g[n+44>>2];g[m+124>>2]=0.0;a=c[a+32>>2]|0;g[m+32>>2]=+g[a+4>>2];g[m+36>>2]=+g[a+20>>2];g[m+40>>2]=+g[a+36>>2];g[m+44>>2]=0.0;g[m+48>>2]=+g[a+8>>2];g[m+52>>2]=+g[a+24>>2];g[m+56>>2]=+g[a+40>>2];g[m+60>>2]=0.0;g[m+64>>2]=+g[a+12>>2];g[m+68>>2]=+g[a+28>>2];g[m+72>>2]=+g[a+44>>2];g[m+76>>2]=0.0;f=f- +g[n+56>>2];h=h- +g[n+60>>2];g[m+16>>2]=e- +g[n+52>>2];g[m+20>>2]=f;g[m+24>>2]=h;g[m+28>>2]=0.0;k=k- +g[a+56>>2];l=l- +g[a+60>>2];g[m>>2]=j- +g[a+52>>2];g[m+4>>2]=k;g[m+8>>2]=l;g[m+12>>2]=0.0;Co(b,m+80|0,m+32|0,m+16|0,m,d,n+396|0,+g[n+344>>2],a+396|0,+g[a+344>>2]);i=m;return}function Mp(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0;e=i;if((b|0)==0){i=e;return}L=c[a+28>>2]|0;u=+g[L+4>>2];t=+g[L+20>>2];s=+g[L+36>>2];q=+g[L+8>>2];p=+g[L+24>>2];o=+g[L+40>>2];m=+g[L+12>>2];k=+g[L+28>>2];h=+g[L+44>>2];a=c[a+32>>2]|0;K=+g[a+4>>2];J=+g[a+20>>2];I=+g[a+36>>2];G=+g[a+8>>2];F=+g[a+24>>2];E=+g[a+40>>2];C=+g[a+12>>2];A=+g[a+28>>2];y=+g[a+44>>2];c[b+0>>2]=0;c[b+4>>2]=0;c[b+8>>2]=0;c[b+12>>2]=0;l=+g[d>>2];j=+g[d+4>>2];f=+g[d+8>>2];g[b+16>>2]=u*l+t*j+s*f;g[b+20>>2]=q*l+p*j+o*f;g[b+24>>2]=m*l+k*j+h*f;g[b+28>>2]=0.0;B=-+g[d>>2];z=-+g[d+4>>2];x=-+g[d+8>>2];g[b+32>>2]=K*B+J*z+I*x;g[b+36>>2]=G*B+F*z+E*x;g[b+40>>2]=C*B+A*z+y*x;g[b+44>>2]=0.0;v=(u*l+t*j+s*f)*+g[L+396>>2];r=(q*l+p*j+o*f)*+g[L+400>>2];n=(m*l+k*j+h*f)*+g[L+404>>2];g[b+48>>2]=v;g[b+52>>2]=r;g[b+56>>2]=n;g[b+60>>2]=0.0;H=(K*B+J*z+I*x)*+g[a+396>>2];D=(G*B+F*z+E*x)*+g[a+400>>2];w=(C*B+A*z+y*x)*+g[a+404>>2];g[b+64>>2]=H;g[b+68>>2]=D;g[b+72>>2]=w;g[b+76>>2]=0.0;g[b+80>>2]=(K*B+J*z+I*x)*H+(G*B+F*z+E*x)*D+(C*B+A*z+y*x)*w+(v*(u*l+t*j+s*f)+r*(q*l+p*j+o*f)+n*(m*l+k*j+h*f));i=e;return}function Np(b,d){b=b|0;d=d|0;var e=0,f=0,h=0.0,j=0.0,k=0.0;f=i;h=+Op(+g[b+(d<<2)+1192>>2],+g[b+(d<<6)+868>>2],+g[b+(d<<6)+872>>2]);g[b+(d<<6)+920>>2]=h;j=+g[b+(d<<6)+868>>2];k=+g[b+(d<<6)+872>>2];do if(!(j>k)){if(j>h){c[b+(d<<6)+924>>2]=1;g[b+(d<<6)+916>>2]=h-j;if(h-j>3.1415927410125732){g[b+(d<<6)+916>>2]=h-j+-6.2831854820251465;break}if(!(h-j<-3.1415927410125732))break;g[b+(d<<6)+916>>2]=h-j+6.2831854820251465;break}if(!(k<h)){c[b+(d<<6)+924>>2]=0;e=14;break}c[b+(d<<6)+924>>2]=2;g[b+(d<<6)+916>>2]=h-k;if(h-k>3.1415927410125732){g[b+(d<<6)+916>>2]=h-k+-6.2831854820251465;break}if(h-k<-3.1415927410125732)g[b+(d<<6)+916>>2]=h-k+6.2831854820251465}else{c[b+(d<<6)+924>>2]=0;e=14}while(0);if((e|0)==14?(a[b+(d<<6)+912>>0]|0)==0:0){d=0;i=f;return d|0}d=1;i=f;return d|0}function Op(a,b,c){a=+a;b=+b;c=+c;var d=0;d=i;if(b>=c){b=a;i=d;return+b}if(a<b){b=+ab(+(b-a),6.2831854820251465);if(!(b<-3.1415927410125732)){if(b>3.1415927410125732)b=b+-6.2831854820251465}else b=b+6.2831854820251465;b=+P(+b);c=+ab(+(c-a),6.2831854820251465);if(!(c<-3.1415927410125732)){if(c>3.1415927410125732)c=c+-6.2831854820251465}else c=c+6.2831854820251465;if(b<+P(+c)){b=a;i=d;return+b}b=a+6.2831854820251465;i=d;return+b}if(!(a>c)){b=a;i=d;return+b}c=+ab(+(a-c),6.2831854820251465);if(!(c<-3.1415927410125732)){if(c>3.1415927410125732)c=c+-6.2831854820251465}else c=c+6.2831854820251465;c=+P(+c);b=+ab(+(a-b),6.2831854820251465);if(!(b<-3.1415927410125732)){if(b>3.1415927410125732)b=b+-6.2831854820251465}else b=b+6.2831854820251465;if(!(+P(+b)<c)){b=a;i=d;return+b}b=a+-6.2831854820251465;i=d;return+b}function Pp(b){b=b|0;var d=0.0,e=0.0,f=0.0,h=0,j=0,k=0,l=0,m=0.0,n=0.0;h=i;i=i+16|0;if((a[b+1308>>0]|0)==0){i=h;return}g[b+928>>2]=0.0;g[b+992>>2]=0.0;g[b+1056>>2]=0.0;c[b+712>>2]=0;c[b+716>>2]=0;c[b+720>>2]=0;c[b+724>>2]=0;Kp(b,(c[b+28>>2]|0)+4|0,(c[b+32>>2]|0)+4|0);Lb[c[(c[b>>2]|0)+44>>2]&511](b);d=+g[b+1284>>2];e=+g[b+1288>>2];f=+g[b+1292>>2];if(+g[b+696>>2]>=+g[b+680>>2]){if((a[b+1300>>0]|0)==0){l=b+1160|0;k=b+1144|0;j=b+1128|0}else{l=b+1096|0;k=b+1080|0;j=b+1064|0}m=+g[l>>2];n=+g[k>>2];g[h>>2]=+g[j>>2];g[h+4>>2]=n;g[h+8>>2]=m;g[h+12>>2]=0.0;Lp(b,b+176|0,h,d,e,f,d,e,f)}if(+g[b+700>>2]>=+g[b+684>>2]){if((a[b+1300>>0]|0)==0){l=b+1164|0;k=b+1148|0;j=b+1132|0}else{l=b+1100|0;k=b+1084|0;j=b+1068|0}n=+g[l>>2];m=+g[k>>2];g[h>>2]=+g[j>>2];g[h+4>>2]=m;g[h+8>>2]=n;g[h+12>>2]=0.0;Lp(b,b+260|0,h,d,e,f,d,e,f)}if(+g[b+704>>2]>=+g[b+688>>2]){if((a[b+1300>>0]|0)==0){j=b+1168|0;l=b+1152|0;k=b+1136|0}else{j=b+1104|0;l=b+1088|0;k=b+1072|0}n=+g[j>>2];m=+g[l>>2];g[h>>2]=+g[k>>2];g[h+4>>2]=m;g[h+8>>2]=n;g[h+12>>2]=0.0;Lp(b,b+344|0,h,d,e,f,d,e,f)}if(Np(b,0)|0){c[h+0>>2]=c[b+1208>>2];c[h+4>>2]=c[b+1212>>2];c[h+8>>2]=c[b+1216>>2];c[h+12>>2]=c[b+1220>>2];Mp(b,b+428|0,h)}if(Np(b,1)|0){c[h+0>>2]=c[b+1224>>2];c[h+4>>2]=c[b+1228>>2];c[h+8>>2]=c[b+1232>>2];c[h+12>>2]=c[b+1236>>2];Mp(b,b+512|0,h)}if(!(Np(b,2)|0)){i=h;return}c[h+0>>2]=c[b+1240>>2];c[h+4>>2]=c[b+1244>>2];c[h+8>>2]=c[b+1248>>2];c[h+12>>2]=c[b+1252>>2];Mp(b,b+596|0,h);i=h;return}function Qp(b,d){b=b|0;d=d|0;var e=0,f=0,g=0;e=i;if((a[b+1308>>0]|0)!=0){c[d>>2]=0;c[d+4>>2]=0;i=e;return}Kp(b,(c[b+28>>2]|0)+4|0,(c[b+32>>2]|0)+4|0);c[d>>2]=0;c[d+4>>2]=6;if((c[b+856>>2]|0)==0?(a[b+788>>0]|0)==0:0){g=0;f=6}else{c[d>>2]=1;c[d+4>>2]=5;g=1;f=5}if(!((c[b+860>>2]|0)==0?(a[b+789>>0]|0)==0:0)){g=g+1|0;c[d>>2]=g;f=f+ -1|0;c[d+4>>2]=f}if(!((c[b+864>>2]|0)==0?(a[b+790>>0]|0)==0:0)){c[d>>2]=g+1;c[d+4>>2]=f+ -1}if(Np(b,0)|0){c[d>>2]=(c[d>>2]|0)+1;c[d+4>>2]=(c[d+4>>2]|0)+ -1}if(Np(b,1)|0){c[d>>2]=(c[d>>2]|0)+1;c[d+4>>2]=(c[d+4>>2]|0)+ -1}if(!(Np(b,2)|0)){i=e;return}c[d>>2]=(c[d>>2]|0)+1;c[d+4>>2]=(c[d+4>>2]|0)+ -1;i=e;return}function Rp(b,d){b=b|0;d=d|0;var e=0,f=0,g=0;e=i;g=c[b+28>>2]|0;f=c[b+32>>2]|0;if((a[b+1301>>0]|0)==0){Sp(b,d,Tp(b,d,0,g+4|0,f+4|0,g+312|0,f+312|0,g+328|0,f+328|0)|0,g+4|0,f+4|0,g+312|0,f+312|0,g+328|0,f+328|0)|0;i=e;return}else{Tp(b,d,Sp(b,d,0,g+4|0,f+4|0,g+312|0,f+312|0,g+328|0,f+328|0)|0,g+4|0,f+4|0,g+312|0,f+312|0,g+328|0,f+328|0)|0;i=e;return}}function Sp(b,d,e,f,h,j,k,l,m){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;k=k|0;l=l|0;m=m|0;var n=0,o=0,p=0,q=0;o=i;i=i+16|0;n=0;do{p=b+(n<<6)+868|0;if(!((c[b+(n<<6)+924>>2]|0)==0?(a[b+(n<<6)+912>>0]|0)==0:0)){q=b+(n<<4)+1208|0;c[o+0>>2]=c[q+0>>2];c[o+4>>2]=c[q+4>>2];c[o+8>>2]=c[q+8>>2];c[o+12>>2]=c[q+12>>2];q=c[b+1304>>2]>>(n*3|0)+9;if((q&1|0)==0)g[b+(n<<6)+896>>2]=+g[c[d+32>>2]>>2];if((q&2|0)==0)g[b+(n<<6)+904>>2]=+g[c[d+32>>2]>>2];if((q&4|0)==0)g[b+(n<<6)+900>>2]=+g[d+4>>2];e=(Up(b,p,f,h,j,k,l,m,d,e,o,1,0)|0)+e|0}n=n+1|0}while((n|0)!=3);i=o;return e|0}function Tp(b,d,e,f,h,j,k,l,m){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;k=k|0;l=l|0;m=m|0;var n=0,o=0,p=0,q=0;n=i;i=i+80|0;g[n+76>>2]=0.0;g[n+24>>2]=0.0;g[n+28>>2]=.10000000149011612;g[n+32>>2]=300.0;g[n+16>>2]=1.0;g[n+20>>2]=-1.0;g[n+44>>2]=0.0;g[n+48>>2]=.20000000298023224;g[n+52>>2]=0.0;g[n+56>>2]=0.0;g[n+36>>2]=1.0;g[n+40>>2]=.5;c[n+72>>2]=0;g[n+64>>2]=0.0;a[n+60>>0]=0;o=0;do{q=c[b+(o<<2)+856>>2]|0;p=a[b+o+788>>0]|0;do if(!((q|0)==0&p<<24>>24==0)){g[n+56>>2]=0.0;c[n+72>>2]=q;g[n+68>>2]=+g[b+(o<<2)+840>>2];g[n+64>>2]=+g[b+(o<<2)+824>>2];g[n+36>>2]=+g[b+732>>2];a[n+60>>0]=p;g[n+20>>2]=+g[b+(o<<2)+696>>2];g[n+40>>2]=+g[b+728>>2];g[n+16>>2]=+g[b+(o<<2)+680>>2];g[n+32>>2]=0.0;g[n+28>>2]=+g[b+(o<<2)+808>>2];g[n+24>>2]=+g[b+(o<<2)+792>>2];g[n>>2]=+g[b+(o<<2)+1064>>2];g[n+4>>2]=+g[b+(o<<2)+1080>>2];g[n+8>>2]=+g[b+(o<<2)+1096>>2];g[n+12>>2]=0.0;p=c[b+1304>>2]>>o*3;if((p&1|0)==0)q=c[d+32>>2]|0;else q=b+(o<<2)+740|0;g[n+44>>2]=+g[q>>2];if((p&2|0)==0)q=c[d+32>>2]|0;else q=b+(o<<2)+772|0;g[n+52>>2]=+g[q>>2];if((p&4|0)==0)p=d+4|0;else p=b+(o<<2)+756|0;g[n+48>>2]=+g[p>>2];if((a[b+1301>>0]|0)==0){e=(Up(b,n+16|0,f,h,j,k,l,m,d,e,n,0,0)|0)+e|0;break}q=o+1|0;if((c[b+(((q|0)==3?0:q)<<6)+924>>2]|0)==0)p=1;else p=(c[b+(((o+2|0)%3|0)<<6)+924>>2]|0)==0&1;e=(Up(b,n+16|0,f,h,j,k,l,m,d,e,n,0,p)|0)+e|0}while(0);o=o+1|0}while((o|0)!=3);i=n;return e|0}function Up(b,d,e,f,h,j,k,l,m,n,o,p,q){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;k=k|0;l=l|0;m=m|0;n=n|0;o=o|0;p=p|0;q=q|0;var r=0,s=0,t=0,u=0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0,E=0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0;r=i;s=aa(c[m+24>>2]|0,n)|0;u=(a[d+44>>0]|0)==0;n=c[d+56>>2]|0;if(u&(n|0)==0){f=0;i=r;return f|0}E=c[((p|0)!=0?m+12|0:m+8|0)>>2]|0;D=c[((p|0)!=0?m+20|0:m+16|0)>>2]|0;g[E+(s<<2)>>2]=+g[o>>2];g[E+(s+1<<2)>>2]=+g[o+4>>2];g[E+(s+2<<2)>>2]=+g[o+8>>2];g[D+(s<<2)>>2]=-+g[o>>2];g[D+(s+1<<2)>>2]=-+g[o+4>>2];g[D+(s+2<<2)>>2]=-+g[o+8>>2];do if((p|0)==0){v=+g[b+1176>>2];if((a[b+1301>>0]|0)==0){y=v- +g[e+48>>2];B=+g[b+1180>>2]- +g[e+52>>2];C=+g[b+1184>>2]- +g[e+56>>2];A=+g[o+8>>2];x=+g[o+4>>2];z=+g[o>>2];E=c[m+12>>2]|0;g[E+(s<<2)>>2]=B*A-C*x;g[E+(s+1<<2)>>2]=C*z-y*A;g[E+(s+2<<2)>>2]=y*x-B*z;z=+g[b+1176>>2]- +g[f+48>>2];B=+g[b+1180>>2]- +g[f+52>>2];x=+g[b+1184>>2]- +g[f+56>>2];y=+g[o+8>>2];A=+g[o+4>>2];C=+g[o>>2];E=c[m+20>>2]|0;g[E+(s<<2)>>2]=-(B*y-x*A);g[E+(s+1<<2)>>2]=-(x*C-z*y);g[E+(s+2<<2)>>2]=-(z*A-B*C);break}K=v- +g[f+48>>2];I=+g[b+1180>>2]- +g[f+52>>2];G=+g[b+1184>>2]- +g[f+56>>2];J=+g[o>>2];H=+g[o+4>>2];F=+g[o+8>>2];M=+g[b+1112>>2]- +g[e+48>>2];z=+g[b+1116>>2]- +g[e+52>>2];v=+g[b+1120>>2]- +g[e+56>>2];A=+g[d+52>>2]- +g[d+48>>2];L=J*(J*M+H*z+F*v)+J*A-J*(K*J+I*H+G*F);B=H*(J*M+H*z+F*v)+H*A-H*(K*J+I*H+G*F);A=F*(J*M+H*z+F*v)+F*A-F*(K*J+I*H+G*F);w=+g[b+1272>>2];C=+g[b+1276>>2];y=F*(z-H*(J*M+H*z+F*v)+w*B)-H*(v-F*(J*M+H*z+F*v)+w*A);x=J*(v-F*(J*M+H*z+F*v)+w*A)-F*(M-J*(J*M+H*z+F*v)+w*L);v=H*(M-J*(J*M+H*z+F*v)+w*L)-J*(z-H*(J*M+H*z+F*v)+w*B);z=F*(I-H*(K*J+I*H+G*F)-C*B)-H*(G-F*(K*J+I*H+G*F)-C*A);A=J*(G-F*(K*J+I*H+G*F)-C*A)-F*(K-J*(K*J+I*H+G*F)-C*L);B=H*(K-J*(K*J+I*H+G*F)-C*L)-J*(I-H*(K*J+I*H+G*F)-C*B);if((a[b+1280>>0]|0)!=0&(q|0)==0){z=C*z;A=C*A;B=C*B;y=w*y;x=w*x;v=w*v}E=c[m+12>>2]|0;g[E+(s<<2)>>2]=y;g[E+(s+1<<2)>>2]=x;g[E+(s+2<<2)>>2]=v;E=c[m+20>>2]|0;g[E+(s<<2)>>2]=-z;g[E+(s+1<<2)>>2]=-A;g[E+(s+2<<2)>>2]=-B}while(0);if((n|0)!=0?+g[d>>2]==+g[d+4>>2]:0){u=c[m+28>>2]|0;g[u+(s<<2)>>2]=0.0}else t=11;do if((t|0)==11){t=c[m+28>>2]|0;g[t+(s<<2)>>2]=0.0;if(!u){g[(c[m+32>>2]|0)+(s<<2)>>2]=+g[d+28>>2];if((n|0)!=0){u=t;break}v=+g[d+8>>2];if((p|0)!=0)z=v;else z=-v;x=+g[d+52>>2];y=+g[d>>2];w=+g[d+4>>2];A=+g[m>>2]*+g[d+32>>2];do if(!(y>w))if(!(y==w)){z=z/A;if(z<0.0){if(x>=y?y-z>x:0){w=(y-x)/z;break}w=x<y?0.0:1.0;break}if(z>0.0){if(x<=w?w-z<x:0){w=(w-x)/z;break}w=x>w?0.0:1.0}else w=0.0}else w=0.0;else w=1.0;while(0);g[t+(s<<2)>>2]=w*v+ +g[t+(s<<2)>>2];g[(c[m+36>>2]|0)+(s<<2)>>2]=-+g[d+12>>2];g[(c[m+40>>2]|0)+(s<<2)>>2]=+g[d+12>>2]}if((n|0)!=0)u=t;else{E=1;i=r;return E|0}}while(0);v=+g[m>>2]*+g[d+32>>2]*+g[d+48>>2];t=u+(s<<2)|0;w=+g[t>>2];if((p|0)!=0)v=w-v;else v=v+w;g[t>>2]=v;g[(c[m+32>>2]|0)+(s<<2)>>2]=+g[d+36>>2];if(+g[d>>2]==+g[d+4>>2]){g[(c[m+36>>2]|0)+(s<<2)>>2]=-3.4028234663852886e+38;g[(c[m+40>>2]|0)+(s<<2)>>2]=3.4028234663852886e+38;E=1;i=r;return E|0}u=(c[m+36>>2]|0)+(s<<2)|0;if((n|0)==1){g[u>>2]=0.0;g[(c[m+40>>2]|0)+(s<<2)>>2]=3.4028234663852886e+38}else{g[u>>2]=-3.4028234663852886e+38;g[(c[m+40>>2]|0)+(s<<2)>>2]=0.0}v=+g[d+40>>2];if(!(v>0.0)){E=1;i=r;return E|0}if((p|0)!=0){L=+g[o>>2];M=+g[o+4>>2];w=+g[o+8>>2];w=+g[k>>2]*L+ +g[k+4>>2]*M+ +g[k+8>>2]*w-(L*+g[l>>2]+M*+g[l+4>>2]+w*+g[l+8>>2])}else{L=+g[o>>2];M=+g[o+4>>2];w=+g[o+8>>2];w=+g[h>>2]*L+ +g[h+4>>2]*M+ +g[h+8>>2]*w-(L*+g[j>>2]+M*+g[j+4>>2]+w*+g[j+8>>2])}if((n|0)==1){if(!(w<0.0)){E=1;i=r;return E|0}v=-(w*v);if(!(+g[t>>2]<v)){E=1;i=r;return E|0}g[t>>2]=v;E=1;i=r;return E|0}else{if(!(w>0.0)){E=1;i=r;return E|0}v=-(w*v);if(!(+g[t>>2]>v)){E=1;i=r;return E|0}g[t>>2]=v;E=1;i=r;return E|0}return 0}function Vp(a){a=a|0;var b=0.0,d=0.0,e=0.0,f=0.0;d=+g[(c[a+28>>2]|0)+344>>2];b=+g[(c[a+32>>2]|0)+344>>2];if(b==0.0)b=1.0;else b=d/(d+b);f=1.0-b;e=b*+g[a+1116>>2]+f*+g[a+1180>>2];d=b*+g[a+1120>>2]+f*+g[a+1184>>2];g[a+1284>>2]=b*+g[a+1112>>2]+f*+g[a+1176>>2];g[a+1288>>2]=e;g[a+1292>>2]=d;g[a+1296>>2]=0.0;return}function Wp(a,b,d,e){a=a|0;b=b|0;d=+d;e=e|0;var f=0;f=i;if(e>>>0<3)if((b|0)==2){g[a+(e<<2)+756>>2]=d;c[a+1304>>2]=c[a+1304>>2]|4<<e*3;i=f;return}else if((b|0)==3){g[a+(e<<2)+740>>2]=d;c[a+1304>>2]=c[a+1304>>2]|1<<e*3;i=f;return}else if((b|0)==4){g[a+(e<<2)+772>>2]=d;c[a+1304>>2]=c[a+1304>>2]|2<<e*3;i=f;return}else{i=f;return}if(!((e+ -3|0)>>>0<3)){i=f;return}if((b|0)==3){g[a+(e+ -3<<6)+896>>2]=d;c[a+1304>>2]=c[a+1304>>2]|1<<e*3;i=f;return}else if((b|0)==4){g[a+(e+ -3<<6)+904>>2]=d;c[a+1304>>2]=c[a+1304>>2]|2<<e*3;i=f;return}else if((b|0)==2){g[a+(e+ -3<<6)+900>>2]=d;c[a+1304>>2]=c[a+1304>>2]|4<<e*3;i=f;return}else{i=f;return}}function Xp(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0;d=i;do if(c>>>0<3)if((b|0)==2){e=+g[a+(c<<2)+756>>2];break}else if((b|0)==3){e=+g[a+(c<<2)+740>>2];break}else if((b|0)==4){e=+g[a+(c<<2)+772>>2];break}else{e=0.0;break}else if((c+ -3|0)>>>0<3)if((b|0)==3){e=+g[a+(c+ -3<<6)+896>>2];break}else if((b|0)==4){e=+g[a+(c+ -3<<6)+904>>2];break}else if((b|0)==2){e=+g[a+(c+ -3<<6)+900>>2];break}else{e=0.0;break}else e=0.0;while(0);i=d;return+e}function Yp(a){a=a|0;return}function Zp(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function _p(a){a=a|0;return 252}function $p(a,b,e){a=a|0;b=b|0;e=e|0;var f=0;f=i;Pr(a,b,e)|0;g[b+52>>2]=+g[a+48>>2];g[b+56>>2]=+g[a+52>>2];g[b+60>>2]=+g[a+56>>2];g[b+64>>2]=+g[a+60>>2];g[b+68>>2]=+g[a+64>>2];g[b+72>>2]=+g[a+68>>2];g[b+76>>2]=+g[a+72>>2];g[b+80>>2]=+g[a+76>>2];g[b+84>>2]=+g[a+80>>2];g[b+88>>2]=+g[a+84>>2];g[b+92>>2]=+g[a+88>>2];g[b+96>>2]=+g[a+92>>2];g[b+100>>2]=+g[a+96>>2];g[b+104>>2]=+g[a+100>>2];g[b+108>>2]=+g[a+104>>2];g[b+112>>2]=+g[a+108>>2];g[b+116>>2]=+g[a+112>>2];g[b+120>>2]=+g[a+116>>2];g[b+124>>2]=+g[a+120>>2];g[b+128>>2]=+g[a+124>>2];g[b+132>>2]=+g[a+128>>2];g[b+136>>2]=+g[a+132>>2];g[b+140>>2]=+g[a+136>>2];g[b+144>>2]=+g[a+140>>2];g[b+148>>2]=+g[a+144>>2];g[b+152>>2]=+g[a+148>>2];g[b+156>>2]=+g[a+152>>2];g[b+160>>2]=+g[a+156>>2];g[b+164>>2]=+g[a+160>>2];g[b+168>>2]=+g[a+164>>2];g[b+172>>2]=+g[a+168>>2];g[b+176>>2]=+g[a+172>>2];g[b+228>>2]=+g[a+868>>2];g[b+212>>2]=+g[a+872>>2];g[b+196>>2]=+g[a+680>>2];g[b+180>>2]=+g[a+696>>2];g[b+232>>2]=+g[a+932>>2];g[b+216>>2]=+g[a+936>>2];g[b+200>>2]=+g[a+684>>2];g[b+184>>2]=+g[a+700>>2];g[b+236>>2]=+g[a+996>>2];g[b+220>>2]=+g[a+1e3>>2];g[b+204>>2]=+g[a+688>>2];g[b+188>>2]=+g[a+704>>2];c[b+244>>2]=d[a+1300>>0];c[b+248>>2]=d[a+1301>>0];i=f;return 2464}function aq(b,d,e,f,h,j,k,l){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;k=k|0;l=l|0;var m=0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0;m=i;c[b+4>>2]=4;c[b+8>>2]=-1;c[b+12>>2]=-1;g[b+16>>2]=3.4028234663852886e+38;a[b+20>>0]=1;a[b+21>>0]=0;c[b+24>>2]=-1;c[b+28>>2]=d;c[b+32>>2]=e;g[b+36>>2]=0.0;g[b+40>>2]=.30000001192092896;c[b+44>>2]=0;c[b>>2]=2504;g[b+688>>2]=0.0;g[b+692>>2]=-1.0;g[b+696>>2]=.8999999761581421;g[b+700>>2]=.30000001192092896;g[b+704>>2]=1.0;g[b+708>>2]=0.0;g[b+712>>2]=0.0;a[b+716>>0]=0;a[b+736>>0]=0;a[b+737>>0]=0;a[b+738>>0]=0;a[b+739>>0]=1;a[b+740>>0]=l&1;c[b+748>>2]=0;c[b+600>>2]=c[f+0>>2];c[b+604>>2]=c[f+4>>2];c[b+608>>2]=c[f+8>>2];c[b+612>>2]=c[f+12>>2];u=+g[d+4>>2];w=+g[d+20>>2];t=+g[d+36>>2];p=+g[j>>2];x=+g[j+4>>2];v=+g[j+8>>2];do if(!(u*p+w*x+t*v>=.9999998807907104))if(!(u*p+w*x+t*v<=-.9999998807907104)){s=u*v-t*p;o=x*(t*x-w*v)-p*(u*v-t*p);r=w*p-u*x;n=v*(u*v-t*p)-x*(w*p-u*x);q=t*x-w*v;p=p*(w*p-u*x)-v*(t*x-w*v);break}else{s=+g[d+24>>2];o=+g[d+44>>2];r=+g[d+40>>2];n=+g[d+12>>2];q=+g[d+8>>2];p=+g[d+28>>2];break}else{s=+g[d+24>>2];o=-+g[d+44>>2];r=+g[d+40>>2];n=-+g[d+12>>2];q=+g[d+8>>2];p=-+g[d+28>>2]}while(0);g[b+552>>2]=n;g[b+556>>2]=q;g[b+560>>2]=+g[j>>2];g[b+564>>2]=0.0;g[b+568>>2]=p;g[b+572>>2]=s;g[b+576>>2]=+g[j+4>>2];g[b+580>>2]=0.0;g[b+584>>2]=o;g[b+588>>2]=r;g[b+592>>2]=+g[j+8>>2];g[b+596>>2]=0.0;t=+g[j+4>>2];s=+g[k+8>>2];u=+g[j+8>>2];q=+g[k+4>>2];r=+g[k>>2];x=+g[j>>2];do if(s*u+(t*q+r*x)<-.9999998807907104)if(+P(+u)>.7071067690849304){x=1.0/+Q(+(t*t+u*u));w=0.0;v=-(u*x);x=t*x;t=0.0;break}else{u=1.0/+Q(+(t*t+x*x));w=0.0;v=x*u;x=0.0;t=-(t*u);break}else{y=+Q(+((s*u+(t*q+r*x)+1.0)*2.0));w=y*.5;v=(u*r-s*x)*(1.0/y);x=(q*x-t*r)*(1.0/y);t=(t*s-u*q)*(1.0/y)}while(0);B=n*w+o*v-p*x;z=p*w+n*x-o*t;A=o*w+p*t-n*v;p=-(n*t)-p*v-o*x;u=-t;t=-v;v=-x;y=z*v+(w*B+p*u)-A*t;x=A*u+(w*z+p*t)-B*v;w=B*t+(w*A+p*v)-z*u;c[b+664>>2]=c[h+0>>2];c[b+668>>2]=c[h+4>>2];c[b+672>>2]=c[h+8>>2];c[b+676>>2]=c[h+12>>2];g[b+616>>2]=y;g[b+620>>2]=q*w-s*x;g[b+624>>2]=+g[k>>2];g[b+628>>2]=0.0;g[b+632>>2]=x;g[b+636>>2]=s*y-r*w;g[b+640>>2]=+g[k+4>>2];g[b+644>>2]=0.0;g[b+648>>2]=w;g[b+652>>2]=r*x-q*y;g[b+656>>2]=+g[k+8>>2];g[b+660>>2]=0.0;g[b+732>>2]=l?-1.0:1.0;i=m;return}function bq(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var h=0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0;h=i;Or(b,4,d);c[b>>2]=2504;c[b+552>>2]=c[e+0>>2];c[b+556>>2]=c[e+4>>2];c[b+560>>2]=c[e+8>>2];c[b+564>>2]=c[e+12>>2];c[b+568>>2]=c[e+16>>2];c[b+572>>2]=c[e+20>>2];c[b+576>>2]=c[e+24>>2];c[b+580>>2]=c[e+28>>2];c[b+584>>2]=c[e+32>>2];c[b+588>>2]=c[e+36>>2];c[b+592>>2]=c[e+40>>2];c[b+596>>2]=c[e+44>>2];c[b+600>>2]=c[e+48>>2];c[b+604>>2]=c[e+52>>2];c[b+608>>2]=c[e+56>>2];c[b+612>>2]=c[e+60>>2];c[b+616>>2]=c[e+0>>2];c[b+620>>2]=c[e+4>>2];c[b+624>>2]=c[e+8>>2];c[b+628>>2]=c[e+12>>2];c[b+632>>2]=c[e+16>>2];c[b+636>>2]=c[e+20>>2];c[b+640>>2]=c[e+24>>2];c[b+644>>2]=c[e+28>>2];c[b+648>>2]=c[e+32>>2];c[b+652>>2]=c[e+36>>2];c[b+656>>2]=c[e+40>>2];c[b+660>>2]=c[e+44>>2];c[b+664>>2]=c[e+48>>2];c[b+668>>2]=c[e+52>>2];c[b+672>>2]=c[e+56>>2];c[b+676>>2]=c[e+60>>2];g[b+688>>2]=0.0;g[b+692>>2]=-1.0;g[b+696>>2]=.8999999761581421;g[b+700>>2]=.30000001192092896;g[b+704>>2]=1.0;g[b+708>>2]=0.0;g[b+712>>2]=0.0;a[b+716>>0]=0;a[b+736>>0]=0;a[b+737>>0]=0;a[b+738>>0]=0;a[b+739>>0]=1;a[b+740>>0]=f&1;c[b+748>>2]=0;d=c[b+28>>2]|0;n=+g[b+600>>2];m=+g[b+604>>2];l=+g[b+608>>2];k=n*+g[d+20>>2]+m*+g[d+24>>2]+l*+g[d+28>>2]+ +g[d+56>>2];j=n*+g[d+36>>2]+m*+g[d+40>>2]+l*+g[d+44>>2]+ +g[d+60>>2];g[b+664>>2]=n*+g[d+4>>2]+m*+g[d+8>>2]+l*+g[d+12>>2]+ +g[d+52>>2];g[b+668>>2]=k;g[b+672>>2]=j;g[b+676>>2]=0.0;g[b+732>>2]=f?-1.0:1.0;i=h;return}function cq(b){b=b|0;var d=0,e=0.0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0,M=0,N=0.0,O=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0.0,X=0.0;d=i;i=i+176|0;if((a[b+738>>0]|0)==0){i=d;return}g[b+36>>2]=0.0;g[b+744>>2]=0.0;a:do if((a[b+736>>0]|0)==0){L=c[b+28>>2]|0;A=+g[b+600>>2];z=+g[b+604>>2];j=+g[b+608>>2];h=A*+g[L+20>>2]+z*+g[L+24>>2]+j*+g[L+28>>2]+ +g[L+56>>2];y=c[b+32>>2]|0;l=+g[b+664>>2];m=+g[y+4>>2];n=+g[b+668>>2];o=+g[y+8>>2];p=+g[b+672>>2];q=+g[y+12>>2];s=+g[y+20>>2];t=+g[y+24>>2];u=+g[y+28>>2];e=+g[y+36>>2];x=+g[y+40>>2];w=+g[y+44>>2];r=+g[y+52>>2];v=+g[y+56>>2];f=+g[y+60>>2];B=l*s+n*t+p*u+v-h;k=A*+g[L+4>>2]+z*+g[L+8>>2]+j*+g[L+12>>2]+ +g[L+52>>2];j=A*+g[L+36>>2]+z*+g[L+40>>2]+j*+g[L+44>>2]+ +g[L+60>>2];z=l*m+n*o+p*q+r-k;A=l*e+n*x+p*w+f-j;if(z*z+B*B+A*A>1.1920928955078125e-7){K=1.0/+Q(+(z*z+B*B+A*A));g[d+128>>2]=z*K;g[d+132>>2]=B*K;g[d+136>>2]=A*K;g[d+140>>2]=0.0;A=A*K;B=B*K;z=z*K}else{g[d+128>>2]=1.0;g[d+132>>2]=0.0;g[d+136>>2]=0.0;g[d+140>>2]=0.0;A=0.0;B=0.0;z=1.0}if(+P(+A)>.7071067690849304){H=A*A+B*B;I=1.0/+Q(+H);g[d+144>>2]=0.0;K=-(I*A);g[d+148>>2]=K;J=I*B;g[d+152>>2]=J;g[d+160>>2]=H*I;g[d+164>>2]=-(z*J);g[d+168>>2]=z*K}else{J=z*z+B*B;K=1.0/+Q(+J);I=-(B*K);g[d+144>>2]=I;H=K*z;g[d+148>>2]=H;g[d+152>>2]=0.0;g[d+160>>2]=-(A*H);g[d+164>>2]=A*I;g[d+168>>2]=J*K}C=m;z=s;A=e;B=o;D=t;E=x;F=q;K=u;G=w;J=r;I=v;H=f;L=0;while(1){M=c[b+28>>2]|0;g[d+80>>2]=+g[M+4>>2];g[d+84>>2]=+g[M+20>>2];g[d+88>>2]=+g[M+36>>2];g[d+92>>2]=0.0;g[d+96>>2]=+g[M+8>>2];g[d+100>>2]=+g[M+24>>2];g[d+104>>2]=+g[M+40>>2];g[d+108>>2]=0.0;g[d+112>>2]=+g[M+12>>2];g[d+116>>2]=+g[M+28>>2];g[d+120>>2]=+g[M+44>>2];g[d+124>>2]=0.0;g[d+32>>2]=C;g[d+36>>2]=z;g[d+40>>2]=A;g[d+44>>2]=0.0;g[d+48>>2]=B;g[d+52>>2]=D;g[d+56>>2]=E;g[d+60>>2]=0.0;g[d+64>>2]=F;g[d+68>>2]=K;g[d+72>>2]=G;g[d+76>>2]=0.0;G=h- +g[M+56>>2];K=j- +g[M+60>>2];g[d+16>>2]=k- +g[M+52>>2];g[d+20>>2]=G;g[d+24>>2]=K;g[d+28>>2]=0.0;g[d>>2]=l*m+n*o+p*q+r-J;g[d+4>>2]=l*s+n*t+p*u+v-I;g[d+8>>2]=l*e+n*x+p*w+f-H;g[d+12>>2]=0.0;Co(b+(L*84|0)+48|0,d+80|0,d+32|0,d+16|0,d,d+128+(L<<4)|0,M+396|0,+g[M+344>>2],y+396|0,+g[y+344>>2]);L=L+1|0;if((L|0)==3)break a;y=c[b+32>>2]|0;C=+g[y+4>>2];z=+g[y+20>>2];A=+g[y+36>>2];B=+g[y+8>>2];D=+g[y+24>>2];E=+g[y+40>>2];F=+g[y+12>>2];K=+g[y+28>>2];G=+g[y+44>>2];J=+g[y+52>>2];I=+g[y+56>>2];H=+g[y+60>>2]}}while(0);h=+g[b+560>>2];f=+g[b+576>>2];e=+g[b+592>>2];if(+P(+e)>.7071067690849304){j=1.0/+Q(+(f*f+e*e));o=0.0;n=-(e*j);m=f*j;l=(f*f+e*e)*j;k=-(h*f*j);j=h*-(e*j)}else{j=1.0/+Q(+(h*h+f*f));o=-(f*j);n=h*j;m=0.0;l=-(e*h*j);k=e*-(f*j);j=(h*h+f*f)*j}L=c[b+28>>2]|0;p=+g[L+4>>2];F=+g[L+8>>2];A=+g[L+12>>2];s=o*p+n*F+m*A;x=+g[L+20>>2];t=+g[L+24>>2];C=+g[L+28>>2];u=o*x+n*t+m*C;I=+g[L+36>>2];G=+g[L+40>>2];E=+g[L+44>>2];v=o*I+n*G+m*E;J=l*p+k*F+j*A;m=l*x+k*t+j*C;k=l*I+k*G+j*E;M=c[b+32>>2]|0;B=+g[M+4>>2];D=+g[M+20>>2];N=+g[M+36>>2];S=+g[M+8>>2];T=+g[M+24>>2];V=+g[M+40>>2];X=+g[M+12>>2];j=+g[M+28>>2];H=+g[M+44>>2];c[b+300>>2]=0;c[b+304>>2]=0;c[b+308>>2]=0;c[b+312>>2]=0;g[b+316>>2]=p*s+x*u+I*v;g[b+320>>2]=F*s+t*u+G*v;g[b+324>>2]=A*s+C*u+E*v;g[b+328>>2]=0.0;g[b+332>>2]=B*-s+D*-u+N*-v;g[b+336>>2]=S*-s+T*-u+V*-v;g[b+340>>2]=X*-s+j*-u+H*-v;g[b+344>>2]=0.0;o=(p*s+x*u+I*v)*+g[L+396>>2];K=(F*s+t*u+G*v)*+g[L+400>>2];q=(A*s+C*u+E*v)*+g[L+404>>2];g[b+348>>2]=o;g[b+352>>2]=K;g[b+356>>2]=q;g[b+360>>2]=0.0;R=(B*-s+D*-u+N*-v)*+g[M+396>>2];W=(S*-s+T*-u+V*-v)*+g[M+400>>2];l=(X*-s+j*-u+H*-v)*+g[M+404>>2];g[b+364>>2]=R;g[b+368>>2]=W;g[b+372>>2]=l;g[b+376>>2]=0.0;g[b+380>>2]=(B*-s+D*-u+N*-v)*R+(S*-s+T*-u+V*-v)*W+(X*-s+j*-u+H*-v)*l+(o*(p*s+x*u+I*v)+K*(F*s+t*u+G*v)+q*(A*s+C*u+E*v));M=c[b+28>>2]|0;v=+g[M+4>>2];u=+g[M+20>>2];s=+g[M+36>>2];q=+g[M+8>>2];K=+g[M+24>>2];o=+g[M+40>>2];l=+g[M+12>>2];H=+g[M+28>>2];j=+g[M+44>>2];L=c[b+32>>2]|0;X=+g[L+4>>2];W=+g[L+20>>2];V=+g[L+36>>2];T=+g[L+8>>2];S=+g[L+24>>2];R=+g[L+40>>2];N=+g[L+12>>2];D=+g[L+28>>2];B=+g[L+44>>2];c[b+384>>2]=0;c[b+388>>2]=0;c[b+392>>2]=0;c[b+396>>2]=0;g[b+400>>2]=J*v+m*u+k*s;g[b+404>>2]=J*q+m*K+k*o;g[b+408>>2]=J*l+m*H+k*j;g[b+412>>2]=0.0;g[b+416>>2]=X*-J+W*-m+V*-k;g[b+420>>2]=T*-J+S*-m+R*-k;g[b+424>>2]=N*-J+D*-m+B*-k;g[b+428>>2]=0.0;w=(J*v+m*u+k*s)*+g[M+396>>2];r=(J*q+m*K+k*o)*+g[M+400>>2];n=(J*l+m*H+k*j)*+g[M+404>>2];g[b+432>>2]=w;g[b+436>>2]=r;g[b+440>>2]=n;g[b+444>>2]=0.0;U=(X*-J+W*-m+V*-k)*+g[L+396>>2];O=(T*-J+S*-m+R*-k)*+g[L+400>>2];z=(N*-J+D*-m+B*-k)*+g[L+404>>2];g[b+448>>2]=U;g[b+452>>2]=O;g[b+456>>2]=z;g[b+460>>2]=0.0;g[b+464>>2]=(X*-J+W*-m+V*-k)*U+(T*-J+S*-m+R*-k)*O+(N*-J+D*-m+B*-k)*z+(w*(J*v+m*u+k*s)+r*(J*q+m*K+k*o)+n*(J*l+m*H+k*j));L=c[b+28>>2]|0;j=+g[L+4>>2];k=+g[L+20>>2];H=+g[L+36>>2];l=+g[L+8>>2];m=+g[L+24>>2];J=+g[L+40>>2];n=+g[L+12>>2];o=+g[L+28>>2];K=+g[L+44>>2];M=c[b+32>>2]|0;q=+g[M+4>>2];r=+g[M+20>>2];s=+g[M+36>>2];u=+g[M+8>>2];v=+g[M+24>>2];w=+g[M+40>>2];z=+g[M+12>>2];B=+g[M+28>>2];D=+g[M+44>>2];c[b+468>>2]=0;c[b+472>>2]=0;c[b+476>>2]=0;c[b+480>>2]=0;H=(p*h+F*f+A*e)*j+(x*h+t*f+C*e)*k+(I*h+G*f+E*e)*H;J=(p*h+F*f+A*e)*l+(x*h+t*f+C*e)*m+(I*h+G*f+E*e)*J;K=(p*h+F*f+A*e)*n+(x*h+t*f+C*e)*o+(I*h+G*f+E*e)*K;g[b+484>>2]=H;g[b+488>>2]=J;g[b+492>>2]=K;g[b+496>>2]=0.0;A=-(p*h+F*f+A*e);C=-(x*h+t*f+C*e);E=-(I*h+G*f+E*e);g[b+500>>2]=q*A+r*C+s*E;g[b+504>>2]=u*A+v*C+w*E;g[b+508>>2]=z*A+B*C+D*E;g[b+512>>2]=0.0;G=H*+g[L+396>>2];I=J*+g[L+400>>2];e=K*+g[L+404>>2];g[b+516>>2]=G;g[b+520>>2]=I;g[b+524>>2]=e;g[b+528>>2]=0.0;t=(q*A+r*C+s*E)*+g[M+396>>2];x=(u*A+v*C+w*E)*+g[M+400>>2];F=(z*A+B*C+D*E)*+g[M+404>>2];g[b+532>>2]=t;g[b+536>>2]=x;g[b+540>>2]=F;g[b+544>>2]=0.0;g[b+548>>2]=(q*A+r*C+s*E)*t+(u*A+v*C+w*E)*x+(z*A+B*C+D*E)*F+(G*H+I*J+e*K);g[b+724>>2]=0.0;e=+fq(b,(c[b+28>>2]|0)+4|0,(c[b+32>>2]|0)+4|0);g[b+728>>2]=e;g[b+708>>2]=0.0;g[b+712>>2]=0.0;a[b+716>>0]=0;do if(+g[b+692>>2]>=0.0){e=+ab(+(e- +g[b+688>>2]),6.2831854820251465);if(!(e<-3.1415927410125732)){if(e>3.1415927410125732)e=e+-6.2831854820251465}else e=e+6.2831854820251465;f=+g[b+692>>2];if(e<-f){a[b+716>>0]=1;g[b+708>>2]=-(e+f);g[b+712>>2]=1.0;break}if(e>f){a[b+716>>0]=1;g[b+708>>2]=f-e;g[b+712>>2]=-1.0}}while(0);L=c[b+28>>2]|0;T=+g[b+560>>2];U=+g[b+576>>2];X=+g[b+592>>2];V=T*+g[L+4>>2]+U*+g[L+8>>2]+X*+g[L+12>>2];W=T*+g[L+20>>2]+U*+g[L+24>>2]+X*+g[L+28>>2];X=T*+g[L+36>>2]+U*+g[L+40>>2]+X*+g[L+44>>2];M=c[b+32>>2]|0;g[b+720>>2]=1.0/(V*(V*+g[L+264>>2]+W*+g[L+280>>2]+X*+g[L+296>>2])+W*(V*+g[L+268>>2]+W*+g[L+284>>2]+X*+g[L+300>>2])+X*(V*+g[L+272>>2]+W*+g[L+288>>2]+X*+g[L+304>>2])+(V*(V*+g[M+264>>2]+W*+g[M+280>>2]+X*+g[M+296>>2])+W*(V*+g[M+268>>2]+W*+g[M+284>>2]+X*+g[M+300>>2])+X*(V*+g[M+272>>2]+W*+g[M+288>>2]+X*+g[M+304>>2])));i=d;return}function dq(b,d){b=b|0;d=d|0;var e=0,f=0,h=0.0,j=0.0;e=i;if((a[b+738>>0]|0)!=0){c[d>>2]=0;c[d+4>>2]=0;i=e;return}c[d>>2]=5;c[d+4>>2]=1;h=+fq(b,(c[b+28>>2]|0)+4|0,(c[b+32>>2]|0)+4|0);g[b+728>>2]=h;g[b+708>>2]=0.0;g[b+712>>2]=0.0;a[b+716>>0]=0;do if(+g[b+692>>2]>=0.0){h=+ab(+(h- +g[b+688>>2]),6.2831854820251465);if(!(h<-3.1415927410125732)){if(h>3.1415927410125732)h=h+-6.2831854820251465}else h=h+6.2831854820251465;j=+g[b+692>>2];if(h<-j){a[b+716>>0]=1;g[b+708>>2]=-(h+j);g[b+712>>2]=1.0;break}if(!(h>j))if((a[b+716>>0]|0)==0){f=13;break}else break;else{a[b+716>>0]=1;g[b+708>>2]=j-h;g[b+712>>2]=-1.0;break}}else f=13;while(0);if((f|0)==13?(a[b+737>>0]|0)==0:0){i=e;return}c[d>>2]=(c[d>>2]|0)+1;c[d+4>>2]=(c[d+4>>2]|0)+ -1;i=e;return}function eq(b,d){b=b|0;d=d|0;var e=0,f=0,h=0,j=0.0,k=0.0,l=0.0,m=0.0,n=0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0,O=0.0,P=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0,X=0,Y=0,Z=0,_=0,$=0,aa=0;e=i;i=i+256|0;f=c[b+28>>2]|0;h=c[b+32>>2]|0;n=c[d+24>>2]|0;if((a[b+739>>0]|0)==0){co(e+192|0,f+4|0,b+552|0);co(e+128|0,h+4|0,b+616|0);q=+g[e+240>>2];o=+g[e+244>>2];j=+g[e+248>>2];k=+g[e+176>>2];p=+g[e+180>>2];l=+g[e+184>>2];Y=(a[b+736>>0]|0)==0;if(Y){N=c[d+8>>2]|0;g[N>>2]=1.0;g[N+(n+1<<2)>>2]=1.0;g[N+((n<<1)+2<<2)>>2]=1.0;N=c[d+16>>2]|0;g[N>>2]=-1.0;g[N+(n+1<<2)>>2]=-1.0;g[N+((n<<1)+2<<2)>>2]=-1.0;N=n<<1;_=n+1|0;Z=(n<<1)+2|0}else{N=n<<1;_=n+1|0;Z=(n<<1)+2|0}m=q- +g[f+52>>2];V=o- +g[f+56>>2];U=j- +g[f+60>>2];X=c[d+12>>2]|0;g[X>>2]=0.0;g[X+4>>2]=U;g[X+8>>2]=-V;g[X+12>>2]=0.0;g[X+(n<<2)>>2]=-U;g[X+(_<<2)>>2]=0.0;g[X+(n+2<<2)>>2]=m;g[X+(n+3<<2)>>2]=0.0;g[X+(N<<2)>>2]=V;aa=N|1;g[X+(aa<<2)>>2]=-m;g[X+(Z<<2)>>2]=0.0;$=N+3|0;g[X+($<<2)>>2]=0.0;m=k- +g[h+52>>2];V=p- +g[h+56>>2];U=l- +g[h+60>>2];W=c[d+20>>2]|0;g[W>>2]=0.0;g[W+4>>2]=-U;g[W+8>>2]=V;g[W+12>>2]=0.0;g[W+(n<<2)>>2]=U;g[W+(_<<2)>>2]=0.0;g[W+(n+2<<2)>>2]=-m;g[W+(n+3<<2)>>2]=0.0;g[W+(N<<2)>>2]=-V;g[W+(aa<<2)>>2]=m;g[W+(Z<<2)>>2]=0.0;g[W+($<<2)>>2]=0.0;m=+g[d>>2]*+g[d+4>>2];N=c[d+28>>2]|0;if(Y){g[N>>2]=m*(k-q);g[N+(n<<2)>>2]=m*(p-o);g[N+(n<<1<<2)>>2]=m*(l-j)}l=+g[e+200>>2];k=+g[e+216>>2];j=+g[e+232>>2];M=+g[e+192>>2];O=+g[e+208>>2];L=+g[e+224>>2];R=+g[e+196>>2];T=+g[e+212>>2];P=+g[e+228>>2];n=c[d+24>>2]|0;g[X+(n*3<<2)>>2]=M;g[X+((n*3|0)+1<<2)>>2]=O;g[X+((n*3|0)+2<<2)>>2]=L;g[X+(n<<2<<2)>>2]=R;g[X+((n<<2|1)<<2)>>2]=T;g[X+((n<<2|2)<<2)>>2]=P;g[W+(n*3<<2)>>2]=-M;g[W+((n*3|0)+1<<2)>>2]=-O;g[W+((n*3|0)+2<<2)>>2]=-L;g[W+(n<<2<<2)>>2]=-R;g[W+((n<<2|1)<<2)>>2]=-T;g[W+((n<<2|2)<<2)>>2]=-P;U=+g[e+136>>2];S=+g[e+152>>2];V=+g[e+168>>2];g[N+(n*3<<2)>>2]=m*(L*(l*S-k*U)+(M*(k*V-j*S)+O*(j*U-l*V)));g[N+(n<<2<<2)>>2]=m*(P*(l*S-k*U)+(R*(k*V-j*S)+T*(j*U-l*V)));if((a[b+716>>0]|0)==0)if((a[b+737>>0]|0)==0){i=e;return}else{Y=0;_=0;N=0;m=0.0}else{m=+g[b+708>>2]*+g[b+732>>2];Y=1;_=(a[b+737>>0]|0)==0;N=m>0.0?1:2}g[X+(n*5<<2)>>2]=l;g[X+((n*5|0)+1<<2)>>2]=k;g[X+((n*5|0)+2<<2)>>2]=j;g[W+(n*5<<2)>>2]=-l;g[W+((n*5|0)+1<<2)>>2]=-k;g[W+((n*5|0)+2<<2)>>2]=-j;p=+ab(+(+g[b+688>>2]- +g[b+692>>2]),6.2831854820251465);if(!(p<-3.1415927410125732)){if(p>3.1415927410125732)p=p+-6.2831854820251465}else p=p+6.2831854820251465;r=+ab(+(+g[b+688>>2]+ +g[b+692>>2]),6.2831854820251465);if(!(r<-3.1415927410125732)){if(r>3.1415927410125732)r=r+-6.2831854820251465}else r=r+6.2831854820251465;X=p==r;W=(c[d+28>>2]|0)+(n*5<<2)|0;g[W>>2]=0.0;Z=c[b+748>>2]|0;o=+g[((Z&2|0)==0?d+4|0:b+760|0)>>2];if(!(Y&X|_)){if((Z&4|0)!=0)g[(c[d+32>>2]|0)+(n*5<<2)>>2]=+g[b+752>>2];s=+g[b+728>>2];q=+g[b+680>>2];_=p>r;do if(!(_|X)){t=q/(o*+g[d>>2]);if(t<0.0){if(s>=p?p-t>s:0){p=(p-s)/t;break}p=s<p?0.0:1.0;break}if(t>0.0){if(s<=r?r-t<s:0){p=(r-s)/t;break}p=s>r?0.0:1.0}else p=0.0}else p=_?1.0:0.0;while(0);g[W>>2]=p*q*+g[b+732>>2]+ +g[W>>2];g[(c[d+36>>2]|0)+(n*5<<2)>>2]=-+g[b+684>>2];g[(c[d+40>>2]|0)+(n*5<<2)>>2]=+g[b+684>>2]}if(!Y){i=e;return}g[W>>2]=+g[W>>2]+m*o*+g[d>>2];if((Z&1|0)!=0)g[(c[d+32>>2]|0)+(n*5<<2)>>2]=+g[b+756>>2];do if(!X){X=(c[d+36>>2]|0)+(n*5<<2)|0;if((N|0)==1){g[X>>2]=0.0;g[(c[d+40>>2]|0)+(n*5<<2)>>2]=3.4028234663852886e+38;break}else{g[X>>2]=-3.4028234663852886e+38;g[(c[d+40>>2]|0)+(n*5<<2)>>2]=0.0;break}}else{g[(c[d+36>>2]|0)+(n*5<<2)>>2]=-3.4028234663852886e+38;g[(c[d+40>>2]|0)+(n*5<<2)>>2]=3.4028234663852886e+38}while(0);m=+g[b+704>>2];do if(m>0.0){j=l*+g[f+328>>2]+k*+g[f+332>>2]+j*+g[f+336>>2]-(l*+g[h+328>>2]+k*+g[h+332>>2]+j*+g[h+336>>2]);if((N|0)==1){if(!(j<0.0))break;if(!(+g[W>>2]<-(m*j)))break;g[W>>2]=-(m*j);break}else{if(!(j>0.0))break;if(!(+g[W>>2]>-(m*j)))break;g[W>>2]=-(m*j);break}}while(0);g[W>>2]=+g[b+700>>2]*+g[W>>2];i=e;return}co(e+64|0,f+4|0,b+552|0);co(e,h+4|0,b+616|0);D=+g[e+48>>2];B=+g[e+112>>2];E=+g[e+52>>2];C=+g[e+116>>2];F=+g[e+56>>2];A=+g[e+120>>2];k=+g[(c[b+28>>2]|0)+344>>2];j=+g[(c[b+32>>2]|0)+344>>2];if(k<1.1920928955078125e-7)N=1;else N=j<1.1920928955078125e-7;if(k+j>0.0)I=j/(k+j);else I=.5;L=1.0-I;q=+g[e+72>>2];p=+g[e+88>>2];t=+g[e+104>>2];r=+g[e+8>>2];s=+g[e+24>>2];o=+g[e+40>>2];m=I*q+L*r;k=I*p+L*s;j=I*t+L*o;l=1.0/+Q(+(m*m+k*k+j*j));x=D- +g[h+52>>2];P=E- +g[h+56>>2];T=F- +g[h+60>>2];y=m*l*(x*m*l+P*k*l+T*j*l);R=k*l*(x*m*l+P*k*l+T*j*l);U=j*l*(x*m*l+P*k*l+T*j*l);z=B- +g[f+52>>2];S=C- +g[f+56>>2];V=A- +g[f+60>>2];u=m*l*(m*l*z+k*l*S+j*l*V);v=k*l*(m*l*z+k*l*S+j*l*V);w=j*l*(m*l*z+k*l*S+j*l*V);H=z-u+I*(u-y);G=S-v+I*(v-R);J=V-w+I*(w-U);M=x-y-L*(u-y);K=P-R-L*(v-R);O=T-U-L*(w-U);u=I*(x-y)+L*(z-u);v=I*(P-R)+L*(S-v);w=I*(T-U)+L*(V-w);if(u*u+v*v+w*w>1.1920928955078125e-7){z=1.0/+Q(+(u*u+v*v+w*w));u=u*z;v=z*v;z=z*w}else{u=+g[e+68>>2];v=+g[e+84>>2];z=+g[e+100>>2]}y=k*l*z-j*l*v;x=j*l*u-z*m*l;w=v*m*l-k*l*u;aa=c[d+12>>2]|0;g[aa>>2]=G*z-J*v;g[aa+4>>2]=J*u-H*z;g[aa+8>>2]=H*v-G*u;aa=c[d+20>>2]|0;g[aa>>2]=-(K*z-O*v);g[aa+4>>2]=-(O*u-M*z);g[aa+8>>2]=-(M*v-K*u);if(N?(a[b+716>>0]|0)!=0:0){S=L*(K*w-O*x);R=L*(O*y-M*w);P=L*(M*x-K*y);T=I*(G*w-J*x);U=I*(J*y-H*w);V=I*(H*x-G*y)}else{S=K*w-O*x;R=O*y-M*w;P=M*x-K*y;T=G*w-J*x;U=J*y-H*w;V=H*x-G*y}aa=c[d+12>>2]|0;g[aa+(n<<2)>>2]=T;g[aa+(n+1<<2)>>2]=U;g[aa+(n+2<<2)>>2]=V;aa=c[d+20>>2]|0;g[aa+(n<<2)>>2]=-S;g[aa+(n+1<<2)>>2]=-R;g[aa+(n+2<<2)>>2]=-P;if(N){P=L*(K*j*l-O*k*l);O=L*(O*m*l-M*j*l);K=L*(M*k*l-K*m*l);L=I*(G*j*l-J*k*l);J=I*(J*m*l-H*j*l);G=I*(H*k*l-G*m*l)}else{P=K*j*l-O*k*l;O=O*m*l-M*j*l;K=M*k*l-K*m*l;L=G*j*l-J*k*l;J=J*m*l-H*j*l;G=H*k*l-G*m*l}N=c[d+12>>2]|0;g[N+(n<<1<<2)>>2]=L;g[N+((n<<1|1)<<2)>>2]=J;g[N+((n<<1)+2<<2)>>2]=G;N=c[d+20>>2]|0;g[N+(n<<1<<2)>>2]=-P;g[N+((n<<1|1)<<2)>>2]=-O;g[N+((n<<1)+2<<2)>>2]=-K;G=+g[d>>2]*+g[d+4>>2];if((a[b+736>>0]|0)==0){X=c[d+8>>2]|0;g[X>>2]=u;g[X+4>>2]=v;g[X+8>>2]=z;X=c[d+8>>2]|0;g[X+(n<<2)>>2]=y;g[X+(n+1<<2)>>2]=x;g[X+(n+2<<2)>>2]=w;X=c[d+8>>2]|0;g[X+(n<<1<<2)>>2]=m*l;g[X+((n<<1|1)<<2)>>2]=k*l;g[X+((n<<1)+2<<2)>>2]=j*l;X=c[d+16>>2]|0;V=-u;g[X>>2]=V;T=-v;g[X+4>>2]=T;U=-z;g[X+8>>2]=U;g[X+(n<<2)>>2]=-y;g[X+(n+1<<2)>>2]=-x;g[X+(n+2<<2)>>2]=-w;g[X+(n<<1<<2)>>2]=-(m*l);g[X+((n<<1|1)<<2)>>2]=-(k*l);g[X+((n<<1)+2<<2)>>2]=-(j*l);X=c[d+28>>2]|0;g[X>>2]=G*((D-B)*u+(E-C)*v+(F-A)*z);g[X+(n<<2)>>2]=G*((D-B)*y+(E-C)*x+(F-A)*w);g[X+(n<<1<<2)>>2]=G*((D-B)*m*l+(E-C)*k*l+(F-A)*j*l);B=-y;C=-x;D=-w;F=T;A=U;E=V;N=c[d+20>>2]|0}else{B=-y;C=-x;D=-w;F=-v;A=-z;E=-u;X=c[d+28>>2]|0}W=c[d+12>>2]|0;g[W+(n*3<<2)>>2]=u;g[W+((n*3|0)+1<<2)>>2]=v;g[W+((n*3|0)+2<<2)>>2]=z;g[W+(n<<2<<2)>>2]=y;g[W+((n<<2|1)<<2)>>2]=x;g[W+((n<<2|2)<<2)>>2]=w;g[N+(n*3<<2)>>2]=E;g[N+((n*3|0)+1<<2)>>2]=F;g[N+((n*3|0)+2<<2)>>2]=A;g[N+(n<<2<<2)>>2]=B;g[N+((n<<2|1)<<2)>>2]=C;g[N+((n<<2|2)<<2)>>2]=D;V=+g[d>>2]*+g[d+4>>2];g[X+(n*3<<2)>>2]=V*((p*o-t*s)*u+(t*r-q*o)*v+(q*s-p*r)*z);g[X+(n<<2<<2)>>2]=V*((p*o-t*s)*y+(t*r-q*o)*x+(q*s-p*r)*w);if((a[b+716>>0]|0)==0)if((a[b+737>>0]|0)==0){i=e;return}else{Y=0;_=0;n=0;o=0.0}else{o=+g[b+708>>2]*+g[b+732>>2];Y=1;_=(a[b+737>>0]|0)==0;n=o>0.0?1:2}X=(c[d+24>>2]|0)*5|0;g[W+(X<<2)>>2]=m*l;g[W+(X+1<<2)>>2]=k*l;g[W+(X+2<<2)>>2]=j*l;g[N+(X<<2)>>2]=-(m*l);g[N+(X+1<<2)>>2]=-(k*l);g[N+(X+2<<2)>>2]=-(j*l);p=+ab(+(+g[b+688>>2]- +g[b+692>>2]),6.2831854820251465);if(!(p<-3.1415927410125732)){if(p>3.1415927410125732)p=p+-6.2831854820251465}else p=p+6.2831854820251465;r=+ab(+(+g[b+688>>2]+ +g[b+692>>2]),6.2831854820251465);if(!(r<-3.1415927410125732)){if(r>3.1415927410125732)r=r+-6.2831854820251465}else r=r+6.2831854820251465;W=p==r;N=(c[d+28>>2]|0)+(X<<2)|0;g[N>>2]=0.0;Z=c[b+748>>2]|0;q=+g[((Z&2|0)==0?d+4|0:b+760|0)>>2];if(!(Y&W|_)){if((Z&4|0)!=0)g[(c[d+32>>2]|0)+(X<<2)>>2]=+g[b+752>>2];t=+g[b+728>>2];s=+g[b+680>>2];_=p>r;do if(!(_|W)){u=s/(q*+g[d>>2]);if(u<0.0){if(t>=p?p-u>t:0){p=(p-t)/u;break}p=t<p?0.0:1.0;break}if(u>0.0){if(t<=r?r-u<t:0){p=(r-t)/u;break}p=t>r?0.0:1.0}else p=0.0}else p=_?1.0:0.0;while(0);g[N>>2]=p*s*+g[b+732>>2]+ +g[N>>2];g[(c[d+36>>2]|0)+(X<<2)>>2]=-+g[b+684>>2];g[(c[d+40>>2]|0)+(X<<2)>>2]=+g[b+684>>2]}if(!Y){i=e;return}g[N>>2]=+g[N>>2]+o*q*+g[d>>2];if((Z&1|0)!=0)g[(c[d+32>>2]|0)+(X<<2)>>2]=+g[b+756>>2];do if(!W){W=(c[d+36>>2]|0)+(X<<2)|0;if((n|0)==1){g[W>>2]=0.0;g[(c[d+40>>2]|0)+(X<<2)>>2]=3.4028234663852886e+38;break}else{g[W>>2]=-3.4028234663852886e+38;g[(c[d+40>>2]|0)+(X<<2)>>2]=0.0;break}}else{g[(c[d+36>>2]|0)+(X<<2)>>2]=-3.4028234663852886e+38;g[(c[d+40>>2]|0)+(X<<2)>>2]=3.4028234663852886e+38}while(0);o=+g[b+704>>2];do if(o>0.0){j=+g[f+328>>2]*m*l+ +g[f+332>>2]*k*l+ +g[f+336>>2]*j*l-(m*l*+g[h+328>>2]+k*l*+g[h+332>>2]+j*l*+g[h+336>>2]);if((n|0)==1){if(!(j<0.0))break;if(!(+g[N>>2]<-(o*j)))break;g[N>>2]=-(o*j);break}else{if(!(j>0.0))break;if(!(+g[N>>2]>-(o*j)))break;g[N>>2]=-(o*j);break}}while(0);g[N>>2]=+g[b+700>>2]*+g[N>>2];i=e;return}function fq(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,h=0.0,i=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0;v=+g[a+552>>2];u=+g[a+568>>2];t=+g[a+584>>2];s=+g[b>>2];r=+g[b+4>>2];q=+g[b+8>>2];o=+g[b+16>>2];n=+g[b+20>>2];m=+g[b+24>>2];k=+g[b+32>>2];i=+g[b+36>>2];f=+g[b+40>>2];j=+g[a+556>>2];h=+g[a+572>>2];e=+g[a+588>>2];x=+g[a+620>>2];w=+g[a+636>>2];d=+g[a+652>>2];p=x*+g[c>>2]+w*+g[c+4>>2]+d*+g[c+8>>2];l=x*+g[c+16>>2]+w*+g[c+20>>2]+d*+g[c+24>>2];d=x*+g[c+32>>2]+w*+g[c+36>>2]+d*+g[c+40>>2];d=+Y(+((v*s+u*r+t*q)*p+(v*o+u*n+t*m)*l+(v*k+u*i+t*f)*d),+((s*j+r*h+q*e)*p+(o*j+n*h+m*e)*l+(k*j+i*h+f*e)*d));return+(d*+g[a+732>>2])}function gq(a,b,d,e){a=a|0;b=b|0;d=+d;e=e|0;var f=0;f=i;do if((e|0)==5|(e|0)==-1)if((b|0)==2){g[a+760>>2]=d;c[a+748>>2]=c[a+748>>2]|2;break}else if((b|0)==3){g[a+752>>2]=d;c[a+748>>2]=c[a+748>>2]|4;break}else if((b|0)==4){g[a+756>>2]=d;c[a+748>>2]=c[a+748>>2]|1;break}else break;while(0);i=f;return}function hq(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0;d=i;do if((c|0)==5|(c|0)==-1)if((b|0)==2){e=+g[a+760>>2];break}else if((b|0)==4){e=+g[a+756>>2];break}else if((b|0)==3){e=+g[a+752>>2];break}else{e=0.0;break}else e=0.0;while(0);i=d;return+e}function iq(a){a=a|0;return}function jq(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function kq(a){a=a|0;return 220}function lq(a,b,e){a=a|0;b=b|0;e=e|0;var f=0,h=0.0;f=i;Pr(a,b,e)|0;g[b+52>>2]=+g[a+552>>2];g[b+56>>2]=+g[a+556>>2];g[b+60>>2]=+g[a+560>>2];g[b+64>>2]=+g[a+564>>2];g[b+68>>2]=+g[a+568>>2];g[b+72>>2]=+g[a+572>>2];g[b+76>>2]=+g[a+576>>2];g[b+80>>2]=+g[a+580>>2];g[b+84>>2]=+g[a+584>>2];g[b+88>>2]=+g[a+588>>2];g[b+92>>2]=+g[a+592>>2];g[b+96>>2]=+g[a+596>>2];g[b+100>>2]=+g[a+600>>2];g[b+104>>2]=+g[a+604>>2];g[b+108>>2]=+g[a+608>>2];g[b+112>>2]=+g[a+612>>2];g[b+116>>2]=+g[a+616>>2];g[b+120>>2]=+g[a+620>>2];g[b+124>>2]=+g[a+624>>2];g[b+128>>2]=+g[a+628>>2];g[b+132>>2]=+g[a+632>>2];g[b+136>>2]=+g[a+636>>2];g[b+140>>2]=+g[a+640>>2];g[b+144>>2]=+g[a+644>>2];g[b+148>>2]=+g[a+648>>2];g[b+152>>2]=+g[a+652>>2];g[b+156>>2]=+g[a+656>>2];g[b+160>>2]=+g[a+660>>2];g[b+164>>2]=+g[a+664>>2];g[b+168>>2]=+g[a+668>>2];g[b+172>>2]=+g[a+672>>2];g[b+176>>2]=+g[a+676>>2];c[b+184>>2]=d[a+736>>0];c[b+188>>2]=d[a+737>>0];g[b+196>>2]=+g[a+684>>2];g[b+192>>2]=+g[a+680>>2];c[b+180>>2]=d[a+740>>0];h=+ab(+(+g[a+688>>2]- +g[a+692>>2]),6.2831854820251465);if(!(h<-3.1415927410125732)){if(h>3.1415927410125732)h=h+-6.2831854820251465}else h=h+6.2831854820251465;g[b+200>>2]=h;h=+ab(+(+g[a+688>>2]+ +g[a+692>>2]),6.2831854820251465);if(h<-3.1415927410125732){h=h+6.2831854820251465;e=b+204|0;g[e>>2]=h;e=a+696|0;h=+g[e>>2];e=b+208|0;g[e>>2]=h;e=a+700|0;h=+g[e>>2];e=b+212|0;g[e>>2]=h;e=a+704|0;h=+g[e>>2];e=b+216|0;g[e>>2]=h;i=f;return 2592}if(!(h>3.1415927410125732)){e=b+204|0;g[e>>2]=h;e=a+696|0;h=+g[e>>2];e=b+208|0;g[e>>2]=h;e=a+700|0;h=+g[e>>2];e=b+212|0;g[e>>2]=h;e=a+704|0;h=+g[e>>2];e=b+216|0;g[e>>2]=h;i=f;return 2592}h=h+-6.2831854820251465;e=b+204|0;g[e>>2]=h;e=a+696|0;h=+g[e>>2];e=b+208|0;g[e>>2]=h;e=a+700|0;h=+g[e>>2];e=b+212|0;g[e>>2]=h;e=a+704|0;h=+g[e>>2];e=b+216|0;g[e>>2]=h;i=f;return 2592}function mq(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=2632;e=c[b+140>>2]|0;if((e|0)!=0){if((a[b+144>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}a[b+144>>0]=1;c[b+140>>2]=0;c[b+132>>2]=0;c[b+136>>2]=0;if((b|0)==0){i=d;return}}else{a[b+144>>0]=1;c[b+140>>2]=0;c[b+132>>2]=0;c[b+136>>2]=0}c[5006]=(c[5006]|0)+1;YE(c[b+ -4>>2]|0);i=d;return}function nq(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=2632;e=c[b+140>>2]|0;if((e|0)!=0){if((a[b+144>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+140>>2]=0}a[b+144>>0]=1;c[b+140>>2]=0;c[b+132>>2]=0;c[b+136>>2]=0;i=d;return}function oq(a){a=a|0;return}function pq(d,e,f,h,j){d=d|0;e=e|0;f=+f;h=+h;j=+j;var k=0,l=0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0;k=i;i=i+240|0;p=+g[d+96>>2]+h;q=+g[d+100>>2]+j;g[d+112>>2]=+g[d+92>>2]+f;g[d+116>>2]=p;g[d+120>>2]=q;g[d+124>>2]=0.0;g[k+168>>2]=1.0;c[k+172>>2]=0;c[k+176>>2]=0;c[k+180>>2]=0;c[k+184>>2]=0;g[k+188>>2]=1.0;c[k+192>>2]=0;c[k+196>>2]=0;c[k+200>>2]=0;c[k+204>>2]=0;g[k+208>>2]=1.0;l=k+212|0;c[l+0>>2]=0;c[l+4>>2]=0;c[l+8>>2]=0;c[l+12>>2]=0;c[l+16>>2]=0;g[k+104>>2]=1.0;c[k+108>>2]=0;c[k+112>>2]=0;c[k+116>>2]=0;c[k+120>>2]=0;g[k+124>>2]=1.0;c[k+128>>2]=0;c[k+132>>2]=0;c[k+136>>2]=0;c[k+140>>2]=0;g[k+144>>2]=1.0;l=k+148|0;c[l+0>>2]=0;c[l+4>>2]=0;c[l+8>>2]=0;c[l+12>>2]=0;c[l+16>>2]=0;f=1.0;l=10;while(1){r=l;l=l+ -1|0;if((r|0)<=0){d=12;break}c[k+216>>2]=c[d+92>>2];c[k+220>>2]=c[d+96>>2];c[k+224>>2]=c[d+100>>2];c[k+228>>2]=c[d+104>>2];c[k+152>>2]=c[d+112>>2];c[k+156>>2]=c[d+116>>2];c[k+160>>2]=c[d+120>>2];c[k+164>>2]=c[d+124>>2];p=+g[d+92>>2]- +g[d+112>>2];q=+g[d+96>>2]- +g[d+116>>2];j=+g[d+100>>2]- +g[d+120>>2];r=c[d+8>>2]|0;g[k+4>>2]=1.0;b[k+8>>1]=1;b[k+10>>1]=-1;c[k+76>>2]=0;c[k+12>>2]=0;c[k+16>>2]=0;c[k+20>>2]=0;c[k+24>>2]=0;c[k+28>>2]=0;c[k+32>>2]=0;c[k+36>>2]=0;c[k+40>>2]=0;c[k>>2]=2896;c[k+80>>2]=r;g[k+84>>2]=p;g[k+88>>2]=q;g[k+92>>2]=j;g[k+96>>2]=0.0;g[k+100>>2]=0.0;r=c[r+188>>2]|0;b[k+8>>1]=b[r+4>>1]|0;b[k+10>>1]=b[r+6>>1]|0;r=c[d+12>>2]|0;j=+$b[c[(c[r>>2]|0)+48>>2]&15](r);r=c[d+12>>2]|0;Kb[c[(c[r>>2]|0)+44>>2]&31](r,j+ +g[d+56>>2]);if((a[d+170>>0]|0)==0)Eu(e,c[d+12>>2]|0,k+168|0,k+104|0,k,+g[e+56>>2]);else lz(c[d+8>>2]|0,c[d+12>>2]|0,k+168|0,k+104|0,k,+g[e+56>>2]);r=c[d+12>>2]|0;Kb[c[(c[r>>2]|0)+44>>2]&31](r,j);q=+g[k+4>>2];f=f-q;if(!(q<1.0)){c[d+92>>2]=c[d+112>>2];c[d+96>>2]=c[d+116>>2];c[d+100>>2]=c[d+120>>2];c[d+104>>2]=c[d+124>>2];if(f>.009999999776482582)continue;else{d=12;break}}p=+g[d+112>>2];m=+g[d+92>>2];o=+g[d+116>>2];h=+g[d+96>>2];n=+g[d+120>>2];j=+g[d+100>>2];q=+Q(+((p-m)*(p-m)+(o-h)*(o-h)+(n-j)*(n-j)));if(q>1.1920928955078125e-7){v=+g[k+44>>2];t=+g[k+48>>2];x=+g[k+52>>2];w=((p-m)*(1.0/q)*v+(o-h)*(1.0/q)*t+(n-j)*(1.0/q)*x)*2.0;u=(p-m)*(1.0/q)-v*w;s=(o-h)*(1.0/q)-t*w;w=(n-j)*(1.0/q)-x*w;n=1.0/+Q(+(w*w+(u*u+s*s)));c[d+112>>2]=c[d+92>>2];c[d+116>>2]=c[d+96>>2];c[d+120>>2]=c[d+100>>2];c[d+124>>2]=c[d+104>>2];p=q*(n*u-v*(x*n*w+(v*n*u+t*n*s)))+ +g[d+112>>2];g[d+112>>2]=p;o=q*(n*s-t*(x*n*w+(v*n*u+t*n*s)))+ +g[d+116>>2];g[d+116>>2]=o;n=q*(n*w-x*(x*n*w+(v*n*u+t*n*s)))+ +g[d+120>>2];g[d+120>>2]=n}m=p-m;h=o-h;j=n-j;if(!(m*m+h*h+j*j>1.1920928955078125e-7)){d=12;break}x=1.0/+Q(+(m*m+h*h+j*j));if(!(f>.009999999776482582?!(m*x*+g[d+76>>2]+h*x*+g[d+80>>2]+j*x*+g[d+84>>2]<=0.0):0)){d=12;break}}if((d|0)==12){i=k;return}}function qq(b,d){b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0;e=i;a[b+171>>0]=1;c[b+60>>2]=c[d+0>>2];c[b+64>>2]=c[d+4>>2];c[b+68>>2]=c[d+8>>2];c[b+72>>2]=c[d+12>>2];f=+g[b+60>>2];k=+g[b+64>>2];h=+g[b+68>>2];j=1.0/+Q(+(f*f+k*k+h*h));if(+Q(+(h*j*h*j+(f*j*f*j+k*j*k*j)))<1.1920928955078125e-7){f=0.0;k=0.0;j=0.0;h=0.0}else{f=f*j;k=k*j;j=h*j;h=+g[b+72>>2]}g[b+76>>2]=f;g[b+80>>2]=k;g[b+84>>2]=j;g[b+88>>2]=h;i=e;return}function rq(b,d,e){b=b|0;d=d|0;e=+e;var f=0,h=0.0,j=0.0,k=0.0,l=0.0;f=i;a[b+171>>0]=0;c[b+60>>2]=c[d+0>>2];c[b+64>>2]=c[d+4>>2];c[b+68>>2]=c[d+8>>2];c[b+72>>2]=c[d+12>>2];h=+g[b+60>>2];l=+g[b+64>>2];j=+g[b+68>>2];k=1.0/+Q(+(h*h+l*l+j*j));if(+Q(+(j*k*j*k+(h*k*h*k+l*k*l*k)))<1.1920928955078125e-7){h=0.0;l=0.0;k=0.0;j=0.0}else{h=h*k;l=l*k;k=j*k;j=+g[b+72>>2]}g[b+76>>2]=h;g[b+80>>2]=l;g[b+84>>2]=k;g[b+88>>2]=j;g[b+172>>2]=+g[b+172>>2]+e;i=f;return}function sq(b,d){b=b|0;d=d|0;var e=0,f=0,h=0,j=0;e=i;g[b+16>>2]=0.0;g[b+20>>2]=0.0;a[b+168>>0]=0;a[b+169>>0]=0;g[b+172>>2]=0.0;c[b+60>>2]=0;c[b+64>>2]=0;c[b+68>>2]=0;c[b+72>>2]=0;b=c[(c[b+8>>2]|0)+284>>2]|0;if((c[(Pb[c[(c[b>>2]|0)+28>>2]&127](b)|0)+4>>2]|0)<=0){i=e;return}do{h=c[b>>2]|0;j=c[h+12>>2]|0;h=c[c[(Pb[c[h+28>>2]&127](b)|0)+12>>2]>>2]|0;f=c[(c[(Pb[c[(c[b>>2]|0)+28>>2]&127](b)|0)+12>>2]|0)+4>>2]|0;Tb[j&31](b,h,f,c[d+24>>2]|0)|0}while((c[(Pb[c[(c[b>>2]|0)+28>>2]&127](b)|0)+4>>2]|0)>0);i=e;return}function tq(a,b){a=a|0;b=b|0;var d=0;d=i;i=i+32|0;c[d+16>>2]=0;c[d+20>>2]=0;c[d+24>>2]=0;c[d+28>>2]=0;c[d+0>>2]=c[b+0>>2];c[d+4>>2]=c[b+4>>2];c[d+8>>2]=c[b+8>>2];c[d+12>>2]=c[b+12>>2];b=c[a+8>>2]|0;c[b+260>>2]=(c[b+260>>2]|0)+1;g[b+4>>2]=1.0;c[b+8>>2]=c[d+16>>2];c[b+12>>2]=c[d+20>>2];c[b+16>>2]=c[d+24>>2];c[b+20>>2]=0;g[b+24>>2]=1.0;c[b+28>>2]=0;c[b+32>>2]=0;c[b+36>>2]=0;c[b+40>>2]=0;g[b+44>>2]=1.0;g[b+48>>2]=0.0;c[b+52>>2]=c[d+0>>2];c[b+56>>2]=c[d+4>>2];c[b+60>>2]=c[d+8>>2];c[b+64>>2]=c[d+12>>2];i=d;return}function uq(b,d){b=b|0;d=d|0;var e=0,f=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0.0,q=0,r=0.0,s=0,t=0.0,u=0,v=0,w=0,x=0.0,y=0.0;h=i;i=i+96|0;a[b+148>>0]=0;e=0;while(1){w=c[b+12>>2]|0;vc[c[(c[w>>2]|0)+8>>2]&127](w,(c[b+8>>2]|0)+4|0,h+80|0,h+64|0);w=c[d+68>>2]|0;Jb[c[(c[w>>2]|0)+16>>2]&31](w,c[(c[b+8>>2]|0)+188>>2]|0,h+80|0,h+64|0,c[d+24>>2]|0);w=c[d+24>>2]|0;vc[c[(c[w>>2]|0)+32>>2]&127](w,c[(c[b+8>>2]|0)+284>>2]|0,d+28|0,w);w=c[b+8>>2]|0;c[b+92>>2]=c[w+52>>2];c[b+96>>2]=c[w+56>>2];c[b+100>>2]=c[w+60>>2];c[b+104>>2]=c[w+64>>2];w=c[w+284>>2]|0;if((Pb[c[(c[w>>2]|0)+36>>2]&127](w)|0)>0){j=0;r=0.0;o=0;do{l=c[b+132>>2]|0;if((l|0)<0){if((c[b+136>>2]|0)<0){k=c[b+140>>2]|0;if((k|0)!=0){if((a[b+144>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[k+ -4>>2]|0)}c[b+140>>2]=0}a[b+144>>0]=1;c[b+140>>2]=0;c[b+136>>2]=0}do{k=(c[b+140>>2]|0)+(l<<2)|0;if((k|0)!=0)c[k>>2]=0;l=l+1|0}while((l|0)!=0)}c[b+132>>2]=0;l=c[(c[b+8>>2]|0)+284>>2]|0;l=c[(Pb[c[(c[l>>2]|0)+28>>2]&127](l)|0)+12>>2]|0;w=c[c[l+(j<<4)>>2]>>2]|0;k=c[c[l+(j<<4)+4>>2]>>2]|0;if(!((w|0)!=0?(c[w+204>>2]&4|0)!=0:0))f=15;do if((f|0)==15){f=0;if((k|0)!=0?(c[k+204>>2]&4|0)!=0:0)break;k=c[l+(j<<4)+8>>2]|0;if((k|0)!=0)Nb[c[(c[k>>2]|0)+16>>2]&127](k,b+128|0);n=c[b+132>>2]|0;if((n|0)>0){m=c[b+140>>2]|0;l=c[b+8>>2]|0;k=0;u=o;while(1){o=c[m+(k<<2)>>2]|0;p=(c[o+740>>2]|0)==(l|0)?-1.0:1.0;s=c[o+748>>2]|0;if((s|0)>0){q=0;do{t=+g[o+(q*184|0)+84>>2];if(t<0.0){v=o+(q*184|0)+68|0;if(t<r){w=o+(q*184|0)+72|0;x=p*+g[w>>2];u=o+(q*184|0)+76|0;r=p*+g[u>>2];g[b+152>>2]=p*+g[v>>2];g[b+156>>2]=x;g[b+160>>2]=r;g[b+164>>2]=0.0;s=c[o+748>>2]|0;r=t}else{w=o+(q*184|0)+72|0;u=o+(q*184|0)+76|0}y=t*p*+g[w>>2]*.20000000298023224;x=t*p*+g[u>>2]*.20000000298023224;g[b+92>>2]=t*p*+g[v>>2]*.20000000298023224+ +g[b+92>>2];g[b+96>>2]=y+ +g[b+96>>2];g[b+100>>2]=x+ +g[b+100>>2];u=1}q=q+1|0}while((q|0)<(s|0));o=u}else o=u;k=k+1|0;if((k|0)>=(n|0))break;else u=o}}}while(0);j=j+1|0;w=c[(c[b+8>>2]|0)+284>>2]|0}while((j|0)<(Pb[c[(c[w>>2]|0)+36>>2]&127](w)|0))}else o=0;w=c[b+8>>2]|0;c[h+0>>2]=c[w+4>>2];c[h+4>>2]=c[w+8>>2];c[h+8>>2]=c[w+12>>2];c[h+12>>2]=c[w+16>>2];c[h+16>>2]=c[w+20>>2];c[h+20>>2]=c[w+24>>2];c[h+24>>2]=c[w+28>>2];c[h+28>>2]=c[w+32>>2];c[h+32>>2]=c[w+36>>2];c[h+36>>2]=c[w+40>>2];c[h+40>>2]=c[w+44>>2];c[h+44>>2]=c[w+48>>2];c[h+48>>2]=c[b+92>>2];c[h+52>>2]=c[b+96>>2];c[h+56>>2]=c[b+100>>2];c[h+60>>2]=c[b+104>>2];c[w+260>>2]=(c[w+260>>2]|0)+1;c[w+4>>2]=c[h+0>>2];c[w+8>>2]=c[h+4>>2];c[w+12>>2]=c[h+8>>2];c[w+16>>2]=c[h+12>>2];c[w+20>>2]=c[h+16>>2];c[w+24>>2]=c[h+20>>2];c[w+28>>2]=c[h+24>>2];c[w+32>>2]=c[h+28>>2];c[w+36>>2]=c[h+32>>2];c[w+40>>2]=c[h+36>>2];c[w+44>>2]=c[h+40>>2];c[w+48>>2]=c[h+44>>2];c[w+52>>2]=c[h+48>>2];c[w+56>>2]=c[h+52>>2];c[w+60>>2]=c[h+56>>2];c[w+64>>2]=c[h+60>>2];if(!o){f=32;break}a[b+148>>0]=1;if((e|0)>3){f=32;break}else e=e+1|0}if((f|0)==32){w=(c[b+8>>2]|0)+52|0;c[b+92>>2]=c[w+0>>2];c[b+96>>2]=c[w+4>>2];c[b+100>>2]=c[w+8>>2];c[b+104>>2]=c[w+12>>2];dF(b+112|0,w|0,16)|0;i=h;return}}function vq(d,e,f){d=d|0;e=e|0;f=+f;var h=0,j=0.0,k=0.0,l=0.0,m=0,n=0,o=0,p=0.0,q=0.0,r=0,s=0.0;h=i;i=i+528|0;if((a[d+171>>0]|0)==0?+g[d+172>>2]<=0.0:0){i=h;return}a[d+168>>0]=(Pb[c[(c[d>>2]|0)+48>>2]&127](d)|0)&1;p=+g[d+16>>2]- +g[d+44>>2]*f;g[d+16>>2]=p;if(p>0.0?(l=+g[d+28>>2],p>l):0)g[d+16>>2]=l;else l=p;if(l<0.0?(s=+P(+l),k=+P(+(+g[d+24>>2])),s>k):0){g[d+16>>2]=-k;l=-k}g[d+20>>2]=l*f;m=c[d+8>>2]|0;c[h+0>>2]=c[m+4>>2];c[h+4>>2]=c[m+8>>2];c[h+8>>2]=c[m+12>>2];c[h+12>>2]=c[m+16>>2];c[h+16>>2]=c[m+20>>2];c[h+20>>2]=c[m+24>>2];c[h+24>>2]=c[m+28>>2];c[h+28>>2]=c[m+32>>2];c[h+32>>2]=c[m+36>>2];c[h+36>>2]=c[m+40>>2];c[h+40>>2]=c[m+44>>2];c[h+44>>2]=c[m+48>>2];c[h+48>>2]=c[m+52>>2];c[h+52>>2]=c[m+56>>2];c[h+56>>2]=c[m+60>>2];c[h+60>>2]=c[m+64>>2];m=c[d+176>>2]|0;if((a[2736]|0)==0?(Ya(2736)|0)!=0:0){g[672]=1.0;c[673]=0;c[674]=0;c[675]=0;c[676]=0;g[677]=1.0;c[678]=0;c[679]=0;c[680]=0;c[681]=0;g[682]=1.0;g[683]=0.0;bb(2736)}p=+g[d+20>>2];p=+g[d+52>>2]+(p>0.0?p:0.0);q=+g[2692+(m<<4)>>2]*p+ +g[d+96>>2];s=p*+g[2696+(m<<4)>>2]+ +g[d+100>>2];g[d+112>>2]=+g[d+92>>2]+ +g[2688+(m<<4)>>2]*p;g[d+116>>2]=q;g[d+120>>2]=s;g[d+124>>2]=0.0;g[h+456>>2]=1.0;c[h+460>>2]=0;c[h+464>>2]=0;c[h+468>>2]=0;c[h+472>>2]=0;g[h+476>>2]=1.0;c[h+480>>2]=0;c[h+484>>2]=0;c[h+488>>2]=0;c[h+492>>2]=0;g[h+496>>2]=1.0;m=h+500|0;c[m+0>>2]=0;c[m+4>>2]=0;c[m+8>>2]=0;c[m+12>>2]=0;c[m+16>>2]=0;g[h+392>>2]=1.0;c[h+396>>2]=0;c[h+400>>2]=0;c[h+404>>2]=0;c[h+408>>2]=0;g[h+412>>2]=1.0;c[h+416>>2]=0;c[h+420>>2]=0;c[h+424>>2]=0;c[h+428>>2]=0;g[h+432>>2]=1.0;m=h+436|0;c[m+0>>2]=0;c[m+4>>2]=0;c[m+8>>2]=0;c[m+12>>2]=0;c[m+16>>2]=0;m=c[d+176>>2]|0;if((a[2736]|0)==0?(Ya(2736)|0)!=0:0){g[672]=1.0;c[673]=0;c[674]=0;c[675]=0;c[676]=0;g[677]=1.0;c[678]=0;c[679]=0;c[680]=0;c[681]=0;g[682]=1.0;g[683]=0.0;bb(2736)}n=c[d+12>>2]|0;p=+$b[c[(c[n>>2]|0)+48>>2]&15](n);p=p+ +g[d+56>>2];q=p*+g[2692+(m<<4)>>2]+ +g[d+96>>2];s=p*+g[2696+(m<<4)>>2]+ +g[d+100>>2];g[h+504>>2]=+g[2688+(m<<4)>>2]*p+ +g[d+92>>2];g[h+508>>2]=q;g[h+512>>2]=s;g[h+516>>2]=0.0;c[h+440>>2]=c[d+112>>2];c[h+444>>2]=c[d+116>>2];c[h+448>>2]=c[d+120>>2];c[h+452>>2]=c[d+124>>2];m=c[d+8>>2]|0;n=c[d+176>>2]|0;if((a[2736]|0)==0?(Ya(2736)|0)!=0:0){g[672]=1.0;c[673]=0;c[674]=0;c[675]=0;c[676]=0;g[677]=1.0;c[678]=0;c[679]=0;c[680]=0;c[681]=0;g[682]=1.0;g[683]=0.0;bb(2736)}p=-+g[2688+(n<<4)>>2];q=-+g[2692+(n<<4)>>2];s=-+g[2696+(n<<4)>>2];g[h+292>>2]=1.0;b[h+296>>1]=1;b[h+298>>1]=-1;r=h+300|0;c[h+364>>2]=0;c[r+0>>2]=0;c[r+4>>2]=0;c[r+8>>2]=0;c[r+12>>2]=0;c[r+16>>2]=0;c[r+20>>2]=0;c[r+24>>2]=0;c[r+28>>2]=0;c[h+288>>2]=2896;c[h+368>>2]=m;g[h+372>>2]=p;g[h+376>>2]=q;g[h+380>>2]=s;g[h+384>>2]=0.0;g[h+388>>2]=.707099974155426;m=c[d+8>>2]|0;r=c[m+188>>2]|0;b[h+296>>1]=b[r+4>>1]|0;b[h+298>>1]=b[r+6>>1]|0;if((a[d+170>>0]|0)==0)Eu(e,c[d+12>>2]|0,h+456|0,h+392|0,h+288|0,0.0);else lz(m,c[d+12>>2]|0,h+456|0,h+392|0,h+288|0,+g[e+56>>2]);if(+g[h+292>>2]<1.0){m=c[d+176>>2]|0;if((a[2736]|0)==0?(Ya(2736)|0)!=0:0){g[672]=1.0;c[673]=0;c[674]=0;c[675]=0;c[676]=0;g[677]=1.0;c[678]=0;c[679]=0;c[680]=0;c[681]=0;g[682]=1.0;g[683]=0.0;bb(2736)}do if(+g[h+332>>2]*+g[2688+(m<<4)>>2]+ +g[h+336>>2]*+g[2692+(m<<4)>>2]+ +g[h+340>>2]*+g[2696+(m<<4)>>2]>0.0){k=+g[h+292>>2];g[d+108>>2]=+g[d+52>>2]*k;if((a[d+180>>0]|0)==0){c[d+92>>2]=c[d+112>>2];c[d+96>>2]=c[d+116>>2];c[d+100>>2]=c[d+120>>2];c[d+104>>2]=c[d+124>>2];break}else{g[d+92>>2]=(1.0-k)*+g[d+92>>2]+k*+g[d+112>>2];g[d+96>>2]=(1.0-k)*+g[d+96>>2]+k*+g[d+116>>2];g[d+100>>2]=(1.0-k)*+g[d+100>>2]+k*+g[d+120>>2];break}}while(0);g[d+16>>2]=0.0;g[d+20>>2]=0.0}else{g[d+108>>2]=+g[d+52>>2];c[d+92>>2]=c[d+112>>2];c[d+96>>2]=c[d+116>>2];c[d+100>>2]=c[d+120>>2];c[d+104>>2]=c[d+124>>2]}if((a[d+171>>0]|0)==0){q=+g[d+172>>2];s=q>f?f:q;g[d+172>>2]=q-f;pq(d,e,+g[d+60>>2]*s,s*+g[d+64>>2],s*+g[d+68>>2])}else pq(d,e,+g[d+60>>2],+g[d+64>>2],+g[d+68>>2]);c[h+272>>2]=c[d+112>>2];c[h+276>>2]=c[d+116>>2];c[h+280>>2]=c[d+120>>2];c[h+284>>2]=c[d+124>>2];k=+g[d+16>>2];if(k<0.0)k=-k;else k=0.0;k=k*f;do if(k>0.0?(j=+g[d+24>>2],k>j):0){if((a[d+168>>0]|0)==0?(a[d+169>>0]|0)!=0:0){j=k;break}}else j=k;while(0);m=c[d+176>>2]|0;if((a[2736]|0)==0?(Ya(2736)|0)!=0:0){g[672]=1.0;c[673]=0;c[674]=0;c[675]=0;c[676]=0;g[677]=1.0;c[678]=0;c[679]=0;c[680]=0;c[681]=0;g[682]=1.0;g[683]=0.0;bb(2736)}l=j+ +g[d+108>>2];k=+g[2688+(m<<4)>>2]*l;j=l*+g[2692+(m<<4)>>2];l=l*+g[2696+(m<<4)>>2];g[d+112>>2]=+g[d+112>>2]-k;g[d+116>>2]=+g[d+116>>2]-j;g[d+120>>2]=+g[d+120>>2]-l;n=c[d+8>>2]|0;o=c[d+176>>2]|0;if((a[2736]|0)==0?(Ya(2736)|0)!=0:0){g[672]=1.0;c[673]=0;c[674]=0;c[675]=0;c[676]=0;g[677]=1.0;c[678]=0;c[679]=0;c[680]=0;c[681]=0;g[682]=1.0;g[683]=0.0;bb(2736)}s=+g[d+40>>2];m=h+172|0;g[m>>2]=1.0;b[h+176>>1]=1;b[h+178>>1]=-1;r=h+180|0;c[h+244>>2]=0;c[r+0>>2]=0;c[r+4>>2]=0;c[r+8>>2]=0;c[r+12>>2]=0;c[r+16>>2]=0;c[r+20>>2]=0;c[r+24>>2]=0;c[r+28>>2]=0;c[h+168>>2]=2896;c[h+248>>2]=n;c[h+252>>2]=c[2688+(o<<4)>>2];c[h+256>>2]=c[2692+(o<<4)>>2];c[h+260>>2]=c[2696+(o<<4)>>2];c[h+264>>2]=c[2700+(o<<4)>>2];g[h+268>>2]=s;o=c[d+8>>2]|0;n=c[o+188>>2]|0;b[h+176>>1]=b[n+4>>1]|0;b[h+178>>1]=b[n+6>>1]|0;n=c[d+176>>2]|0;if((a[2736]|0)==0?(Ya(2736)|0)!=0:0){g[672]=1.0;c[673]=0;c[674]=0;c[675]=0;c[676]=0;g[677]=1.0;c[678]=0;c[679]=0;c[680]=0;c[681]=0;g[682]=1.0;g[683]=0.0;bb(2736)}s=+g[d+40>>2];g[h+68>>2]=1.0;b[h+72>>1]=1;b[h+74>>1]=-1;r=h+76|0;c[h+140>>2]=0;c[r+0>>2]=0;c[r+4>>2]=0;c[r+8>>2]=0;c[r+12>>2]=0;c[r+16>>2]=0;c[r+20>>2]=0;c[r+24>>2]=0;c[r+28>>2]=0;c[h+64>>2]=2896;c[h+144>>2]=o;c[h+148>>2]=c[2688+(n<<4)>>2];c[h+152>>2]=c[2692+(n<<4)>>2];c[h+156>>2]=c[2696+(n<<4)>>2];c[h+160>>2]=c[2700+(n<<4)>>2];g[h+164>>2]=s;n=c[(c[d+8>>2]|0)+188>>2]|0;b[h+72>>1]=b[n+4>>1]|0;b[h+74>>1]=b[n+6>>1]|0;s=+g[d+112>>2];q=+g[d+116>>2];p=+g[d+120>>2];n=0;while(1){g[h+456>>2]=1.0;c[h+460>>2]=0;c[h+464>>2]=0;c[h+468>>2]=0;c[h+472>>2]=0;g[h+476>>2]=1.0;c[h+480>>2]=0;c[h+484>>2]=0;c[h+488>>2]=0;c[h+492>>2]=0;g[h+496>>2]=1.0;c[h+500>>2]=0;g[h+392>>2]=1.0;c[h+396>>2]=0;c[h+400>>2]=0;c[h+404>>2]=0;c[h+408>>2]=0;g[h+412>>2]=1.0;c[h+416>>2]=0;c[h+420>>2]=0;c[h+424>>2]=0;c[h+428>>2]=0;g[h+432>>2]=1.0;c[h+436>>2]=0;g[h+288>>2]=1.0;c[h+292>>2]=0;c[h+296>>2]=0;c[h+300>>2]=0;c[h+304>>2]=0;g[h+308>>2]=1.0;c[h+312>>2]=0;c[h+316>>2]=0;c[h+320>>2]=0;c[h+324>>2]=0;g[h+328>>2]=1.0;c[h+332>>2]=0;c[h+336>>2]=0;c[h+340>>2]=0;c[h+504>>2]=c[d+92>>2];c[h+508>>2]=c[d+96>>2];c[h+512>>2]=c[d+100>>2];c[h+516>>2]=c[d+104>>2];c[h+440>>2]=c[d+112>>2];c[h+444>>2]=c[d+116>>2];c[h+448>>2]=c[d+120>>2];c[h+452>>2]=c[d+124>>2];g[h+336>>2]=s-k;g[h+340>>2]=q-j;g[h+344>>2]=p-l;g[h+348>>2]=0.0;if((a[d+170>>0]|0)==0){Eu(e,c[d+12>>2]|0,h+456|0,h+392|0,h+168|0,+g[e+56>>2]);if(!(+g[m>>2]<1.0))Eu(e,c[d+12>>2]|0,h+456|0,h+288|0,h+64|0,+g[e+56>>2])}else{lz(c[d+8>>2]|0,c[d+12>>2]|0,h+456|0,h+392|0,h+168|0,+g[e+56>>2]);if(!(+g[m>>2]<1.0))lz(c[d+8>>2]|0,c[d+12>>2]|0,h+456|0,h+288|0,h+64|0,+g[e+56>>2])}p=+g[d+16>>2];if(p<0.0)q=-p;else q=0.0;s=q*f;o=(a[d+182>>0]|0)==0;if(!o?+g[m>>2]<1.0:0)r=1;else r=+g[h+68>>2]<1.0;if(!(s>0.0))break;q=+g[d+52>>2];if(!(s<q)|r^1|n)break;if((a[d+168>>0]|0)==0?(a[d+169>>0]|0)!=0:0){n=0;break}c[d+112>>2]=c[h+272>>2];c[d+116>>2]=c[h+276>>2];c[d+120>>2]=c[h+280>>2];c[d+124>>2]=c[h+284>>2];n=c[d+176>>2]|0;do if((a[2736]|0)==0){if((Ya(2736)|0)==0)break;g[672]=1.0;c[673]=0;c[674]=0;c[675]=0;c[676]=0;g[677]=1.0;c[678]=0;c[679]=0;c[680]=0;c[681]=0;g[682]=1.0;g[683]=0.0;bb(2736)}while(0);s=q+ +g[d+108>>2];q=s*+g[2692+(n<<4)>>2];p=s*+g[2696+(n<<4)>>2];s=+g[d+112>>2]- +g[2688+(n<<4)>>2]*s;g[d+112>>2]=s;q=+g[d+116>>2]-q;g[d+116>>2]=q;p=+g[d+120>>2]-p;g[d+120>>2]=p;n=1}q=+g[m>>2];if(q<1.0|n){j=+g[d+96>>2];f=(j- +g[h+232>>2])*.5;do if(!o)if((a[d+181>>0]|0)==0){g[d+92>>2]=(1.0-f)*+g[d+92>>2]+f*+g[d+112>>2];g[d+96>>2]=(1.0-f)*j+f*+g[d+116>>2];g[d+100>>2]=(1.0-f)*+g[d+100>>2]+f*+g[d+120>>2];e=d+181|0;break}else{g[d+92>>2]=(1.0-q)*+g[d+92>>2]+q*+g[d+112>>2];g[d+96>>2]=(1.0-q)*j+q*+g[d+116>>2];g[d+100>>2]=(1.0-q)*+g[d+100>>2]+q*+g[d+120>>2];e=d+181|0;break}else{g[d+92>>2]=(1.0-q)*+g[d+92>>2]+q*+g[d+112>>2];g[d+96>>2]=(1.0-q)*j+q*+g[d+116>>2];g[d+100>>2]=(1.0-q)*+g[d+100>>2]+q*+g[d+120>>2];e=d+181|0}while(0);a[e>>0]=0;g[d+16>>2]=0.0;g[d+20>>2]=0.0;a[d+169>>0]=0}else{a[d+181>>0]=1;do if(!o){if(p<0.0)q=-p;else q=0.0;p=+g[d+24>>2];if(q*f>p){if((a[d+168>>0]|0)==0?(a[d+169>>0]|0)!=0:0)break;g[d+112>>2]=k+ +g[d+112>>2];g[d+116>>2]=j+ +g[d+116>>2];g[d+120>>2]=l+ +g[d+120>>2];e=c[d+176>>2]|0;do if((a[2736]|0)==0){if((Ya(2736)|0)==0)break;g[672]=1.0;c[673]=0;c[674]=0;c[675]=0;c[676]=0;g[677]=1.0;c[678]=0;c[679]=0;c[680]=0;c[681]=0;g[682]=1.0;g[683]=0.0;bb(2736)}while(0);p=p+ +g[d+108>>2];q=p*+g[2692+(e<<4)>>2];s=p*+g[2696+(e<<4)>>2];g[d+112>>2]=+g[d+112>>2]- +g[2688+(e<<4)>>2]*p;g[d+116>>2]=+g[d+116>>2]-q;g[d+120>>2]=+g[d+120>>2]-s}}while(0);c[d+92>>2]=c[d+112>>2];c[d+96>>2]=c[d+116>>2];c[d+100>>2]=c[d+120>>2];c[d+104>>2]=c[d+124>>2]}c[h+48>>2]=c[d+92>>2];c[h+52>>2]=c[d+96>>2];c[h+56>>2]=c[d+100>>2];c[h+60>>2]=c[d+104>>2];r=c[d+8>>2]|0;c[r+260>>2]=(c[r+260>>2]|0)+1;c[r+4>>2]=c[h+0>>2];c[r+8>>2]=c[h+4>>2];c[r+12>>2]=c[h+8>>2];c[r+16>>2]=c[h+12>>2];c[r+20>>2]=c[h+16>>2];c[r+24>>2]=c[h+20>>2];c[r+28>>2]=c[h+24>>2];c[r+32>>2]=c[h+28>>2];c[r+36>>2]=c[h+32>>2];c[r+40>>2]=c[h+36>>2];c[r+44>>2]=c[h+40>>2];c[r+48>>2]=c[h+44>>2];c[r+52>>2]=c[h+48>>2];c[r+56>>2]=c[h+52>>2];c[r+60>>2]=c[h+56>>2];c[r+64>>2]=c[h+60>>2];i=h;return}function wq(a){a=a|0;var b=0;b=i;a=Pb[c[(c[a>>2]|0)+48>>2]&127](a)|0;i=b;return a|0}function xq(b){b=b|0;var d=0;d=i;if(!(Pb[c[(c[b>>2]|0)+40>>2]&127](b)|0)){i=d;return}g[b+16>>2]=+g[b+28>>2];a[b+169>>0]=1;i=d;return}function yq(a){a=a|0;var b=0;b=i;if(!(+g[a+16>>2]==0.0)){a=0;i=b;return a|0}a=+g[a+20>>2]==0.0;i=b;return a|0}function zq(a,b){a=a|0;b=b|0;return}function Aq(b,c){b=b|0;c=c|0;a[b+180>>0]=c&1;return}function Bq(a,b,d){a=a|0;b=b|0;d=+d;var e=0;e=i;Nb[c[(c[a>>2]|0)+32>>2]&127](a,b);tc[c[(c[a>>2]|0)+36>>2]&7](a,b,d);i=e;return}function Cq(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Dq(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0;e=i;f=c[b>>2]|0;if((f|0)==(c[a+80>>2]|0)){k=1.0;i=e;return+k}if((c[f+204>>2]&4|0)!=0){k=1.0;i=e;return+k}if(d){k=+g[b+8>>2];j=+g[b+12>>2];h=+g[b+16>>2]}else{m=+g[b+8>>2];l=+g[b+12>>2];h=+g[b+16>>2];k=+g[f+4>>2]*m+ +g[f+8>>2]*l+ +g[f+12>>2]*h;j=m*+g[f+20>>2]+l*+g[f+24>>2]+h*+g[f+28>>2];h=m*+g[f+36>>2]+l*+g[f+40>>2]+h*+g[f+44>>2]}if(k*+g[a+84>>2]+j*+g[a+88>>2]+h*+g[a+92>>2]<+g[a+100>>2]){m=1.0;i=e;return+m}g[a+4>>2]=+g[b+40>>2];c[a+76>>2]=f;if(d){c[a+44>>2]=c[b+8>>2];c[a+48>>2]=c[b+12>>2];c[a+52>>2]=c[b+16>>2];c[a+56>>2]=c[b+20>>2]}else{h=+g[b+8>>2];j=+g[b+12>>2];k=+g[b+16>>2];l=h*+g[f+20>>2]+j*+g[f+24>>2]+k*+g[f+28>>2];m=h*+g[f+36>>2]+j*+g[f+40>>2]+k*+g[f+44>>2];g[a+44>>2]=+g[f+4>>2]*h+ +g[f+8>>2]*j+ +g[f+12>>2]*k;g[a+48>>2]=l;g[a+52>>2]=m;g[a+56>>2]=0.0}c[a+60>>2]=c[b+24>>2];c[a+64>>2]=c[b+28>>2];c[a+68>>2]=c[b+32>>2];c[a+72>>2]=c[b+36>>2];m=+g[b+40>>2];i=e;return+m}function Eq(a){a=a|0;var b=0,d=0,e=0,f=0,h=0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0;b=i;i=i+144|0;g[a+36>>2]=0.0;c[b+128>>2]=0;c[b+132>>2]=0;c[b+136>>2]=0;c[b+140>>2]=0;d=0;do{e=b+128+(d<<2)|0;g[e>>2]=1.0;h=c[a+28>>2]|0;G=+g[h+4>>2];g[b+80>>2]=G;C=+g[h+20>>2];g[b+84>>2]=C;j=+g[h+36>>2];g[b+88>>2]=j;g[b+92>>2]=0.0;F=+g[h+8>>2];g[b+96>>2]=F;B=+g[h+24>>2];g[b+100>>2]=B;u=+g[h+40>>2];g[b+104>>2]=u;g[b+108>>2]=0.0;E=+g[h+12>>2];g[b+112>>2]=E;A=+g[h+28>>2];g[b+116>>2]=A;n=+g[h+44>>2];g[b+120>>2]=n;g[b+124>>2]=0.0;f=c[a+32>>2]|0;x=+g[f+4>>2];g[b+32>>2]=x;t=+g[f+20>>2];g[b+36>>2]=t;o=+g[f+36>>2];g[b+40>>2]=o;g[b+44>>2]=0.0;w=+g[f+8>>2];g[b+48>>2]=w;s=+g[f+24>>2];g[b+52>>2]=s;m=+g[f+40>>2];g[b+56>>2]=m;g[b+60>>2]=0.0;v=+g[f+12>>2];g[b+64>>2]=v;r=+g[f+28>>2];g[b+68>>2]=r;k=+g[f+44>>2];g[b+72>>2]=k;g[b+76>>2]=0.0;y=+g[a+300>>2];q=+g[a+304>>2];l=+g[a+308>>2];D=+g[h+52>>2];z=+g[h+56>>2];p=+g[h+60>>2];g[b+16>>2]=y*G+q*F+l*E+D-D;g[b+20>>2]=y*C+q*B+l*A+z-z;g[b+24>>2]=y*j+q*u+l*n+p-p;g[b+28>>2]=0.0;p=+g[a+316>>2];n=+g[a+320>>2];l=+g[a+324>>2];u=+g[f+52>>2];q=+g[f+56>>2];j=+g[f+60>>2];g[b>>2]=p*x+n*w+l*v+u-u;g[b+4>>2]=p*t+n*s+l*r+q-q;g[b+8>>2]=p*o+n*m+l*k+j-j;g[b+12>>2]=0.0;h=c[a+28>>2]|0;Co(a+(d*84|0)+48|0,b+80|0,b+32|0,b+16|0,b,b+128|0,h+396|0,+g[h+344>>2],f+396|0,+g[f+344>>2]);g[e>>2]=0.0;d=d+1|0}while((d|0)!=3);i=b;return}function Fq(b,d){b=b|0;d=d|0;var e=0;e=i;if((a[b+344>>0]|0)==0){c[d>>2]=3;c[d+4>>2]=3;i=e;return}else{c[d>>2]=0;c[d+4>>2]=0;i=e;return}}function Gq(a,b){a=a|0;b=b|0;var d=0,e=0,f=0.0,h=0.0,j=0,k=0,l=0,m=0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0;d=i;l=c[a+28>>2]|0;m=c[a+32>>2]|0;e=c[b+8>>2]|0;g[e>>2]=1.0;j=c[b+24>>2]|0;g[e+(j+1<<2)>>2]=1.0;g[e+((j<<1)+2<<2)>>2]=1.0;n=+g[a+300>>2];s=+g[a+304>>2];h=+g[a+308>>2];q=+g[l+4>>2]*n+ +g[l+8>>2]*s+ +g[l+12>>2]*h;o=n*+g[l+20>>2]+s*+g[l+24>>2]+h*+g[l+28>>2];h=n*+g[l+36>>2]+s*+g[l+40>>2]+h*+g[l+44>>2];e=c[b+12>>2]|0;g[e>>2]=0.0;g[e+4>>2]=h;g[e+8>>2]=-o;g[e+12>>2]=0.0;g[e+(j<<2)>>2]=-h;g[e+(j+1<<2)>>2]=0.0;g[e+(j+2<<2)>>2]=q;g[e+(j+3<<2)>>2]=0.0;g[e+(j<<1<<2)>>2]=o;g[e+((j<<1|1)<<2)>>2]=-q;g[e+((j<<1)+2<<2)>>2]=0.0;g[e+((j<<1)+3<<2)>>2]=0.0;e=c[b+16>>2]|0;g[e>>2]=-1.0;g[e+(j+1<<2)>>2]=-1.0;g[e+((j<<1)+2<<2)>>2]=-1.0;s=+g[a+316>>2];n=+g[a+320>>2];f=+g[a+324>>2];r=+g[m+4>>2]*s+ +g[m+8>>2]*n+ +g[m+12>>2]*f;p=s*+g[m+20>>2]+n*+g[m+24>>2]+f*+g[m+28>>2];f=s*+g[m+36>>2]+n*+g[m+40>>2]+f*+g[m+44>>2];e=c[b+20>>2]|0;g[e>>2]=0.0;g[e+4>>2]=-f;g[e+8>>2]=p;g[e+12>>2]=0.0;g[e+(j<<2)>>2]=f;g[e+(j+1<<2)>>2]=0.0;g[e+(j+2<<2)>>2]=-r;g[e+(j+3<<2)>>2]=0.0;g[e+(j<<1<<2)>>2]=-p;g[e+((j<<1|1)<<2)>>2]=r;g[e+((j<<1)+2<<2)>>2]=0.0;g[e+((j<<1)+3<<2)>>2]=0.0;j=c[a+332>>2]|0;n=+g[((j&1|0)==0?b+4|0:a+336|0)>>2]*+g[b>>2];e=c[b+24>>2]|0;k=c[b+28>>2]|0;g[k>>2]=n*(r+ +g[m+52>>2]-q- +g[l+52>>2]);g[k+(e<<2)>>2]=n*(p+ +g[m+56>>2]-o- +g[l+56>>2]);g[k+(e<<1<<2)>>2]=n*(f+ +g[m+60>>2]-h- +g[l+60>>2]);if((j&2|0)!=0){m=c[b+32>>2]|0;g[m>>2]=+g[a+340>>2];g[m+(e<<2)>>2]=+g[a+340>>2];g[m+(e<<1<<2)>>2]=+g[a+340>>2]}f=+g[a+356>>2];if(f>0.0){g[c[b+36>>2]>>2]=-f;g[c[b+40>>2]>>2]=f;h=+g[a+356>>2]}else h=f;if(h>0.0){g[(c[b+36>>2]|0)+(e<<2)>>2]=-f;g[(c[b+40>>2]|0)+(e<<2)>>2]=f;h=+g[a+356>>2]}if(!(h>0.0)){m=a+352|0;s=+g[m>>2];m=b+52|0;g[m>>2]=s;i=d;return}g[(c[b+36>>2]|0)+(e<<1<<2)>>2]=-f;g[(c[b+40>>2]|0)+(e<<1<<2)>>2]=f;m=a+352|0;s=+g[m>>2];m=b+52|0;g[m>>2]=s;i=d;return}function Hq(a,b,d,e){a=a|0;b=b|0;d=+d;e=e|0;var f=0;f=i;do if((e|0)==-1)if((b|0)==2|(b|0)==1){g[a+336>>2]=d;c[a+332>>2]=c[a+332>>2]|1;break}else if((b|0)==4|(b|0)==3){g[a+340>>2]=d;c[a+332>>2]=c[a+332>>2]|2;break}else break;while(0);i=f;return}function Iq(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0;d=i;do if((c|0)==-1)if((b|0)==2|(b|0)==1){e=+g[a+336>>2];break}else if((b|0)==4|(b|0)==3){e=+g[a+340>>2];break}else{e=3.4028234663852886e+38;break}else e=3.4028234663852886e+38;while(0);i=d;return+e}function Jq(a){a=a|0;return}function Kq(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function Lq(a){a=a|0;return 84}function Mq(a,b,c){a=a|0;b=b|0;c=c|0;var d=0;d=i;Pr(a,b,c)|0;g[b+52>>2]=+g[a+300>>2];g[b+56>>2]=+g[a+304>>2];g[b+60>>2]=+g[a+308>>2];g[b+64>>2]=+g[a+312>>2];g[b+68>>2]=+g[a+316>>2];g[b+72>>2]=+g[a+320>>2];g[b+76>>2]=+g[a+324>>2];g[b+80>>2]=+g[a+328>>2];i=d;return 3080}function Nq(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=3912;e=c[b+496>>2]|0;if((e|0)!=0){if((a[b+500>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+496>>2]=0}a[b+500>>0]=1;c[b+496>>2]=0;c[b+488>>2]=0;c[b+492>>2]=0;i=d;return}function Oq(a){a=a|0;var b=0;b=i;Pq(a);YE(a);i=b;return}function Pq(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=3752;e=c[b+144>>2]|0;if((e|0)!=0){if((a[b+148>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+144>>2]=0}a[b+148>>0]=1;c[b+144>>2]=0;c[b+136>>2]=0;c[b+140>>2]=0;e=c[b+76>>2]|0;if((e|0)!=0){if((a[b+80>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+76>>2]=0}a[b+80>>0]=1;c[b+76>>2]=0;c[b+68>>2]=0;c[b+72>>2]=0;e=c[b+56>>2]|0;if((e|0)!=0){if((a[b+60>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+56>>2]=0}a[b+60>>0]=1;c[b+56>>2]=0;c[b+48>>2]=0;c[b+52>>2]=0;e=c[b+36>>2]|0;if((e|0)!=0){if((a[b+40>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+36>>2]=0}a[b+40>>0]=1;c[b+36>>2]=0;c[b+28>>2]=0;c[b+32>>2]=0;e=c[b+16>>2]|0;if((e|0)==0){a[b+20>>0]=1;c[b+16>>2]=0;c[b+8>>2]=0;e=b+12|0;c[e>>2]=0;i=d;return}if((a[b+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+16>>2]=0;a[b+20>>0]=1;c[b+16>>2]=0;c[b+8>>2]=0;e=b+12|0;c[e>>2]=0;i=d;return}function Qq(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,h=0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0;f=i;i=i+64|0;a[d+84>>0]=0;c[f+0>>2]=c[b+4>>2];c[f+4>>2]=c[b+8>>2];c[f+8>>2]=c[b+12>>2];c[f+12>>2]=c[b+16>>2];c[f+16>>2]=c[b+20>>2];c[f+20>>2]=c[b+24>>2];c[f+24>>2]=c[b+28>>2];c[f+28>>2]=c[b+32>>2];c[f+32>>2]=c[b+36>>2];c[f+36>>2]=c[b+40>>2];c[f+40>>2]=c[b+44>>2];c[f+44>>2]=c[b+48>>2];c[f+48>>2]=c[b+52>>2];c[f+52>>2]=c[b+56>>2];c[f+56>>2]=c[b+60>>2];c[f+60>>2]=c[b+64>>2];if(e?(h=c[b+480>>2]|0,(h|0)!=0):0)Nb[c[(c[h>>2]|0)+8>>2]&127](h,f);w=+g[d+156>>2];u=+g[f>>2];v=+g[d+160>>2];t=+g[f+4>>2];o=+g[d+164>>2];s=+g[f+8>>2];r=+g[f+16>>2];q=+g[f+20>>2];p=+g[f+24>>2];n=+g[f+32>>2];l=+g[f+36>>2];j=+g[f+40>>2];m=w*r+v*q+o*p+ +g[f+52>>2];k=w*n+v*l+o*j+ +g[f+56>>2];g[d+36>>2]=w*u+v*t+o*s+ +g[f+48>>2];g[d+40>>2]=m;g[d+44>>2]=k;g[d+48>>2]=0.0;k=+g[d+172>>2];m=+g[d+176>>2];o=+g[d+180>>2];g[d+52>>2]=u*k+t*m+s*o;g[d+56>>2]=k*r+m*q+o*p;g[d+60>>2]=k*n+m*l+o*j;g[d+64>>2]=0.0;o=+g[d+188>>2];m=+g[d+192>>2];k=+g[d+196>>2];g[d+68>>2]=u*o+t*m+s*k;g[d+72>>2]=o*r+m*q+k*p;g[d+76>>2]=o*n+m*l+k*j;g[d+80>>2]=0.0;i=f;return}function Rq(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0;e=i;Qq(a,b+(c*284|0)|0,d);o=+g[b+(c*284|0)+52>>2];j=+g[b+(c*284|0)+56>>2];s=+g[b+(c*284|0)+60>>2];I=+g[b+(c*284|0)+76>>2];B=+g[b+(c*284|0)+72>>2];A=+g[b+(c*284|0)+68>>2];y=1.0/+Q(+((B*-o-A*-j)*(B*-o-A*-j)+((I*-j-B*-s)*(I*-j-B*-s)+(A*-s-I*-o)*(A*-s-I*-o))));x=(I*-j-B*-s)*y;w=y*(A*-s-I*-o);y=y*(B*-o-A*-j);f=+g[b+(c*284|0)+232>>2]*.5;m=+T(+f)/+Q(+(o*o+j*j+s*s));f=+S(+f);n=2.0/(f*f+(m*-s*m*-s+(m*-o*m*-o+m*-j*m*-j)));G=1.0-(m*-j*m*-j*n+m*-s*m*-s*n);F=m*-o*m*-j*n-f*m*-s*n;H=m*-o*m*-s*n+f*m*-j*n;D=m*-o*m*-j*n+f*m*-s*n;C=1.0-(m*-o*m*-o*n+m*-s*m*-s*n);E=m*-j*m*-s*n-f*m*-o*n;l=m*-o*m*-s*n-f*m*-j*n;f=m*-j*m*-s*n+f*m*-o*n;n=1.0-(m*-o*m*-o*n+m*-j*m*-j*n);m=+g[b+(c*284|0)+236>>2]*-.5;z=+T(+m)/+Q(+(I*I+(B*B+A*A)));m=+S(+m);t=2.0/(m*m+(I*z*I*z+(A*z*A*z+B*z*B*z)));p=1.0-(B*z*B*z*t+I*z*I*z*t);k=A*z*B*z*t-m*I*z*t;v=A*z*I*z*t+m*B*z*t;q=A*z*B*z*t+m*I*z*t;h=1.0-(A*z*A*z*t+I*z*I*z*t);u=B*z*I*z*t-m*A*z*t;r=A*z*I*z*t-m*B*z*t;m=B*z*I*z*t+m*A*z*t;t=1.0-(A*z*A*z*t+B*z*B*z*t);z=+g[b+(c*284|0)+72>>2];B=+g[b+(c*284|0)+76>>2];g[b+(c*284|0)+92>>2]=B*(G*v+F*u+H*t)+(A*(H*r+(F*q+G*p))+z*(H*m+(G*k+F*h)));g[b+(c*284|0)+96>>2]=y*(G*v+F*u+H*t)+(x*(H*r+(F*q+G*p))+w*(H*m+(G*k+F*h)));g[b+(c*284|0)+100>>2]=(G*v+F*u+H*t)*-s+((H*r+(F*q+G*p))*-o+(H*m+(G*k+F*h))*-j);g[b+(c*284|0)+104>>2]=0.0;g[b+(c*284|0)+108>>2]=B*(D*v+C*u+E*t)+(A*(E*r+(C*q+D*p))+z*(E*m+(D*k+C*h)));g[b+(c*284|0)+112>>2]=y*(D*v+C*u+E*t)+(x*(E*r+(C*q+D*p))+w*(E*m+(D*k+C*h)));g[b+(c*284|0)+116>>2]=(D*v+C*u+E*t)*-s+((E*r+(C*q+D*p))*-o+(E*m+(D*k+C*h))*-j);g[b+(c*284|0)+120>>2]=0.0;g[b+(c*284|0)+124>>2]=B*(l*v+f*u+n*t)+(A*(n*r+(f*q+l*p))+z*(n*m+(l*k+f*h)));g[b+(c*284|0)+128>>2]=y*(l*v+f*u+n*t)+(x*(n*r+(f*q+l*p))+w*(n*m+(l*k+f*h)));g[b+(c*284|0)+132>>2]=(l*v+f*u+n*t)*-s+((n*r+(f*q+l*p))*-o+(n*m+(l*k+f*h))*-j);g[b+(c*284|0)+136>>2]=0.0;j=+g[b+(c*284|0)+32>>2];h=j*+g[b+(c*284|0)+56>>2]+ +g[b+(c*284|0)+40>>2];f=j*+g[b+(c*284|0)+60>>2]+ +g[b+(c*284|0)+44>>2];g[b+(c*284|0)+140>>2]=+g[b+(c*284|0)+52>>2]*j+ +g[b+(c*284|0)+36>>2];g[b+(c*284|0)+144>>2]=h;g[b+(c*284|0)+148>>2]=f;g[b+(c*284|0)+152>>2]=0.0;i=e;return}function Sq(b,d){b=b|0;d=+d;var e=0,f=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0.0,s=0.0,t=0.0,u=0,v=0.0,w=0.0,x=0,y=0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0,F=0.0,G=0.0;e=i;i=i+112|0;h=c[b+136>>2]|0;if((h|0)>0){f=0;do{Rq(c[b+116>>2]|0,c[b+144>>2]|0,f,0);f=f+1|0;h=c[b+136>>2]|0}while((f|0)<(h|0));f=b+116|0}else f=b+116|0;k=c[f>>2]|0;C=+g[k+312>>2];D=+g[k+316>>2];r=+g[k+320>>2];r=+Q(+(C*C+D*D+r*r))*3.5999999046325684;g[b+112>>2]=r;y=c[b+128>>2]|0;if(+g[k+(y<<2)+4>>2]*+g[k+312>>2]+ +g[k+(y<<2)+20>>2]*+g[k+316>>2]+ +g[k+(y<<2)+36>>2]*+g[k+320>>2]<0.0)g[b+112>>2]=r*-1.0;a:do if((h|0)>0){h=0;do{j=c[b+144>>2]|0;q=j+(h*284|0)|0;Qq(k,q,0);u=j+(h*284|0)+204|0;y=j+(h*284|0)+212|0;r=+g[u>>2]+ +g[y>>2];n=j+(h*284|0)+52|0;o=j+(h*284|0)+56|0;p=j+(h*284|0)+60|0;E=j+(h*284|0)+36|0;m=j+(h*284|0)+16|0;C=r*+g[o>>2]+ +g[j+(h*284|0)+40>>2];D=r*+g[p>>2]+ +g[j+(h*284|0)+44>>2];g[j+(h*284|0)+16>>2]=+g[n>>2]*r+ +g[E>>2];l=j+(h*284|0)+20|0;g[l>>2]=C;k=j+(h*284|0)+24|0;g[k>>2]=D;g[j+(h*284|0)+28>>2]=0.0;g[e+64>>2]=-1.0;x=c[b+100>>2]|0;E=Tb[c[(c[x>>2]|0)+8>>2]&31](x,E,m,e+32|0)|0;x=j+(h*284|0)+88|0;c[x>>2]=0;do if((E|0)!=0){r=r*+g[e+64>>2];c[q+0>>2]=c[e+48>>2];c[q+4>>2]=c[e+52>>2];c[q+8>>2]=c[e+56>>2];c[q+12>>2]=c[e+60>>2];a[j+(h*284|0)+84>>0]=1;if((a[3736]|0)==0?(Ya(3736)|0)!=0:0){c[e+88>>2]=0;c[e+92>>2]=0;c[e+96>>2]=0;c[e+100>>2]=0;br(3120,0.0,0,0,e+88|0);bb(3736)}c[e+72>>2]=0;c[e+76>>2]=0;c[e+80>>2]=0;c[e+84>>2]=0;cr(3120,0.0,e+72|0);c[x>>2]=3120;t=r- +g[y>>2];x=j+(h*284|0)+32|0;g[x>>2]=t;r=+g[u>>2];s=+g[j+(h*284|0)+208>>2]*.009999999776482582;if(t<r-s){g[x>>2]=r-s;t=r-s}if(t>r+s)g[x>>2]=r+s;c[m+0>>2]=c[e+32>>2];c[m+4>>2]=c[e+36>>2];c[m+8>>2]=c[e+40>>2];c[m+12>>2]=c[e+44>>2];s=+g[q>>2];r=+g[j+(h*284|0)+4>>2];t=+g[j+(h*284|0)+8>>2];v=s*+g[n>>2]+r*+g[o>>2]+t*+g[p>>2];n=c[f>>2]|0;w=+g[m>>2]- +g[n+52>>2];z=+g[l>>2]- +g[n+56>>2];C=+g[k>>2]- +g[n+60>>2];D=+g[n+332>>2];A=+g[n+336>>2];B=+g[n+328>>2];if(!(v>=-.10000000149011612)){g[j+(h*284|0)+272>>2]=-1.0/v*(r*(w*A-C*B+ +g[n+316>>2])+s*(D*C-z*A+ +g[n+312>>2])+t*(z*B-w*D+ +g[n+320>>2]));g[j+(h*284|0)+268>>2]=-1.0/v;break}else{g[j+(h*284|0)+272>>2]=0.0;g[j+(h*284|0)+268>>2]=10.0;break}}else{g[j+(h*284|0)+32>>2]=+g[u>>2];g[j+(h*284|0)+272>>2]=0.0;C=-+g[o>>2];D=-+g[p>>2];g[q>>2]=-+g[n>>2];g[j+(h*284|0)+4>>2]=C;g[j+(h*284|0)+8>>2]=D;g[j+(h*284|0)+12>>2]=0.0;g[j+(h*284|0)+268>>2]=1.0}while(0);h=h+1|0;j=c[b+136>>2]|0;k=c[f>>2]|0}while((h|0)<(j|0));r=1.0/+g[k+344>>2];if((j|0)>0){m=c[b+144>>2]|0;l=0;do{if((a[m+(l*284|0)+84>>0]|0)!=0){D=+g[m+(l*284|0)+272>>2];D=r*(+g[m+(l*284|0)+216>>2]*(+g[m+(l*284|0)+204>>2]- +g[m+(l*284|0)+32>>2])*+g[m+(l*284|0)+268>>2]-D*+g[(D<0.0?m+(l*284|0)+220|0:m+(l*284|0)+224|0)>>2]);h=m+(l*284|0)+276|0;g[h>>2]=D;if(D<0.0)g[h>>2]=0.0}else g[m+(l*284|0)+276>>2]=0.0;l=l+1|0}while((l|0)<(j|0));h=0;while(1){B=+g[m+(h*284|0)+276>>2];D=+g[m+(h*284|0)+248>>2];B=B>D?D:B;D=B*+g[m+(h*284|0)+4>>2]*d;C=B*+g[m+(h*284|0)+8>>2]*d;g[e+16>>2]=+g[m+(h*284|0)>>2]*B*d;g[e+20>>2]=D;g[e+24>>2]=C;g[e+28>>2]=0.0;C=+g[m+(h*284|0)+20>>2]- +g[k+56>>2];D=+g[m+(h*284|0)+24>>2]- +g[k+60>>2];g[e>>2]=+g[m+(h*284|0)+16>>2]- +g[k+52>>2];g[e+4>>2]=C;g[e+8>>2]=D;g[e+12>>2]=0.0;qm(k,e+16|0,e);h=h+1|0;if((h|0)>=(c[b+136>>2]|0))break a;m=c[b+144>>2]|0;k=c[f>>2]|0}}}while(0);Kb[c[(c[b>>2]|0)+20>>2]&31](b,d);h=c[b+136>>2]|0;if((h|0)<=0){i=e;return}j=c[b+144>>2]|0;f=c[f>>2]|0;k=0;do{t=+g[j+(k*284|0)+36>>2]- +g[f+52>>2];s=+g[j+(k*284|0)+40>>2]- +g[f+56>>2];w=+g[j+(k*284|0)+44>>2]- +g[f+60>>2];r=+g[f+332>>2];v=+g[f+336>>2];z=+g[f+328>>2];if((a[j+(k*284|0)+84>>0]|0)==0){r=+g[j+(k*284|0)+240>>2];E=j+(k*284|0)+236|0;g[E>>2]=r+ +g[E>>2]}else{E=c[b+128>>2]|0;G=+g[f+(E<<2)+4>>2];A=+g[f+(E<<2)+20>>2];C=+g[f+(E<<2)+36>>2];F=+g[j+(k*284|0)>>2];B=+g[j+(k*284|0)+4>>2];D=+g[j+(k*284|0)+8>>2];r=((s*z-t*r+ +g[f+320>>2])*(C-D*(G*F+A*B+C*D))+((r*w-s*v+ +g[f+312>>2])*(G-F*(G*F+A*B+C*D))+(t*v-w*z+ +g[f+316>>2])*(A-B*(G*F+A*B+C*D))))*d/+g[j+(k*284|0)+212>>2];g[j+(k*284|0)+240>>2]=r;E=j+(k*284|0)+236|0;g[E>>2]=r+ +g[E>>2]}g[j+(k*284|0)+240>>2]=r*.9900000095367432;k=k+1|0}while((k|0)<(h|0));i=e;return}function Tq(b,d){b=b|0;d=+d;var e=0,f=0,h=0.0,j=0,k=0,l=0,m=0,n=0,o=0,p=0.0,q=0,r=0.0,s=0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0,R=0.0;e=i;i=i+384|0;j=c[b+136>>2]|0;if((j|0)==0){i=e;return}k=c[b+8>>2]|0;if((k|0)<(j|0)){if((c[b+12>>2]|0)<(j|0)){c[5004]=(c[5004]|0)+1;l=XE((j<<4|3)+16|0)|0;if((l|0)==0)l=0;else{c[(l+19&-16)+ -4>>2]=l;l=l+19&-16}m=c[b+8>>2]|0;if((m|0)>0){n=0;do{s=l+(n<<4)|0;q=(c[b+16>>2]|0)+(n<<4)|0;c[s+0>>2]=c[q+0>>2];c[s+4>>2]=c[q+4>>2];c[s+8>>2]=c[q+8>>2];c[s+12>>2]=c[q+12>>2];n=n+1|0}while((n|0)!=(m|0))}m=c[b+16>>2]|0;if((m|0)!=0){if((a[b+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[m+ -4>>2]|0)}c[b+16>>2]=0}a[b+20>>0]=1;c[b+16>>2]=l;c[b+12>>2]=j;l=b+16|0}else l=b+16|0;do{s=(c[l>>2]|0)+(k<<4)|0;c[s+0>>2]=c[e+144>>2];c[s+4>>2]=c[e+148>>2];c[s+8>>2]=c[e+152>>2];c[s+12>>2]=c[e+156>>2];k=k+1|0}while((k|0)!=(j|0))}c[b+8>>2]=j;k=c[b+28>>2]|0;if((k|0)<(j|0)){if((c[b+32>>2]|0)<(j|0)){c[5004]=(c[5004]|0)+1;l=XE((j<<4|3)+16|0)|0;if((l|0)==0)l=0;else{c[(l+19&-16)+ -4>>2]=l;l=l+19&-16}n=c[b+28>>2]|0;if((n|0)>0){m=0;do{s=l+(m<<4)|0;q=(c[b+36>>2]|0)+(m<<4)|0;c[s+0>>2]=c[q+0>>2];c[s+4>>2]=c[q+4>>2];c[s+8>>2]=c[q+8>>2];c[s+12>>2]=c[q+12>>2];m=m+1|0}while((m|0)!=(n|0))}m=c[b+36>>2]|0;if((m|0)!=0){if((a[b+40>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[m+ -4>>2]|0)}c[b+36>>2]=0}a[b+40>>0]=1;c[b+36>>2]=l;c[b+32>>2]=j;l=b+36|0}else l=b+36|0;do{s=(c[l>>2]|0)+(k<<4)|0;c[s+0>>2]=c[e+128>>2];c[s+4>>2]=c[e+132>>2];c[s+8>>2]=c[e+136>>2];c[s+12>>2]=c[e+140>>2];k=k+1|0}while((k|0)!=(j|0))}c[b+28>>2]=j;k=c[b+48>>2]|0;if((k|0)<(j|0)){if((c[b+52>>2]|0)<(j|0)){c[5004]=(c[5004]|0)+1;l=XE((j<<2|3)+16|0)|0;if((l|0)==0)l=0;else{c[(l+19&-16)+ -4>>2]=l;l=l+19&-16}m=c[b+48>>2]|0;if((m|0)>0){n=0;do{o=l+(n<<2)|0;if((o|0)!=0)g[o>>2]=+g[(c[b+56>>2]|0)+(n<<2)>>2];n=n+1|0}while((n|0)!=(m|0))}m=c[b+56>>2]|0;if((m|0)!=0){if((a[b+60>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[m+ -4>>2]|0)}c[b+56>>2]=0}a[b+60>>0]=1;c[b+56>>2]=l;c[b+52>>2]=j}else l=c[b+56>>2]|0;do{m=l+(k<<2)|0;if((m|0)!=0)g[m>>2]=0.0;k=k+1|0}while((k|0)!=(j|0))}c[b+48>>2]=j;k=c[b+68>>2]|0;if((k|0)<(j|0)){if((c[b+72>>2]|0)<(j|0)){c[5004]=(c[5004]|0)+1;l=XE((j<<2|3)+16|0)|0;if((l|0)==0)l=0;else{c[(l+19&-16)+ -4>>2]=l;l=l+19&-16}n=c[b+68>>2]|0;if((n|0)>0){m=0;do{o=l+(m<<2)|0;if((o|0)!=0)g[o>>2]=+g[(c[b+76>>2]|0)+(m<<2)>>2];m=m+1|0}while((m|0)!=(n|0))}m=c[b+76>>2]|0;if((m|0)!=0){if((a[b+80>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[m+ -4>>2]|0)}c[b+76>>2]=0}a[b+80>>0]=1;c[b+76>>2]=l;c[b+72>>2]=j}else l=c[b+76>>2]|0;do{m=l+(k<<2)|0;if((m|0)!=0)g[m>>2]=0.0;k=k+1|0}while((k|0)!=(j|0))}c[b+68>>2]=j;m=c[b+136>>2]|0;if((m|0)<=0){i=e;return}k=c[b+76>>2]|0;l=c[b+56>>2]|0;j=0;do{g[k+(j<<2)>>2]=0.0;g[l+(j<<2)>>2]=0.0;j=j+1|0}while((j|0)<(m|0));j=0;do{k=c[b+144>>2]|0;l=c[k+(j*284|0)+88>>2]|0;if((l|0)!=0){m=k+(j*284|0)+92|0;c[e+80>>2]=c[m+0>>2];c[e+84>>2]=c[m+4>>2];c[e+88>>2]=c[m+8>>2];c[e+92>>2]=c[m+12>>2];m=k+(j*284|0)+108|0;c[e+96>>2]=c[m+0>>2];c[e+100>>2]=c[m+4>>2];c[e+104>>2]=c[m+8>>2];c[e+108>>2]=c[m+12>>2];m=k+(j*284|0)+124|0;c[e+112>>2]=c[m+0>>2];c[e+116>>2]=c[m+4>>2];c[e+120>>2]=c[m+8>>2];c[e+124>>2]=c[m+12>>2];m=c[b+36>>2]|0;y=c[b+120>>2]|0;p=+g[e+80+(y<<2)+16>>2];z=+g[e+80+(y<<2)+32>>2];g[m+(j<<4)>>2]=+g[e+80+(y<<2)>>2];g[m+(j<<4)+4>>2]=p;g[m+(j<<4)+8>>2]=z;g[m+(j<<4)+12>>2]=0.0;m=c[b+36>>2]|0;y=m+(j<<4)|0;z=+g[y>>2];n=k+(j*284|0)|0;p=+g[n>>2];o=m+(j<<4)+4|0;x=+g[o>>2];s=k+(j*284|0)+4|0;r=+g[s>>2];m=m+(j<<4)+8|0;u=+g[m>>2];q=k+(j*284|0)+8|0;w=+g[q>>2];t=z-p*(z*p+x*r+u*w);v=x-r*(z*p+x*r+u*w);w=u-w*(z*p+x*r+u*w);u=1.0/+Q(+(t*t+v*v+w*w));g[y>>2]=t*u;g[o>>2]=v*u;g[m>>2]=w*u;m=c[b+16>>2]|0;r=+g[s>>2];x=+g[q>>2];p=+g[n>>2];g[m+(j<<4)>>2]=r*w*u-x*v*u;g[m+(j<<4)+4>>2]=x*t*u-w*u*p;g[m+(j<<4)+8>>2]=v*u*p-r*t*u;g[m+(j<<4)+12>>2]=0.0;m=c[b+16>>2]|0;n=m+(j<<4)|0;u=+g[n>>2];q=m+(j<<4)+4|0;t=+g[q>>2];m=m+(j<<4)+8|0;r=+g[m>>2];p=1.0/+Q(+(u*u+t*t+r*r));g[n>>2]=u*p;g[q>>2]=t*p;g[m>>2]=r*p;m=c[b+116>>2]|0;q=c[b+36>>2]|0;n=q+(j<<4)|0;s=(c[b+76>>2]|0)+(j<<2)|0;p=+g[n>>2];o=q+(j<<4)+4|0;r=+g[o>>2];q=q+(j<<4)+8|0;t=+g[q>>2];if(p*p+r*r+t*t>1.100000023841858)g[s>>2]=0.0;else{z=+g[k+(j*284|0)+16>>2];r=z- +g[m+52>>2];t=+g[k+(j*284|0)+20>>2];B=t- +g[m+56>>2];x=+g[k+(j*284|0)+24>>2];D=x- +g[m+60>>2];g[e+360>>2]=r;g[e+364>>2]=B;g[e+368>>2]=D;g[e+372>>2]=0.0;z=z- +g[l+52>>2];t=t- +g[l+56>>2];x=x- +g[l+60>>2];g[e+344>>2]=z;g[e+348>>2]=t;g[e+352>>2]=x;g[e+356>>2]=0.0;p=+g[m+332>>2];E=+g[m+336>>2];A=+g[m+328>>2];v=+g[l+332>>2];C=+g[l+336>>2];u=+g[l+328>>2];w=p*D-E*B+ +g[m+312>>2]-(v*x-C*t+ +g[l+312>>2]);x=+g[m+316>>2]+(E*r-D*A)-(+g[l+316>>2]+(C*z-x*u));z=B*A-p*r+ +g[m+320>>2]-(t*u-v*z+ +g[l+320>>2]);g[e+208>>2]=+g[m+4>>2];g[e+212>>2]=+g[m+20>>2];g[e+216>>2]=+g[m+36>>2];g[e+220>>2]=0.0;g[e+224>>2]=+g[m+8>>2];g[e+228>>2]=+g[m+24>>2];g[e+232>>2]=+g[m+40>>2];g[e+236>>2]=0.0;g[e+240>>2]=+g[m+12>>2];g[e+244>>2]=+g[m+28>>2];g[e+248>>2]=+g[m+44>>2];g[e+252>>2]=0.0;g[e+160>>2]=+g[l+4>>2];g[e+164>>2]=+g[l+20>>2];g[e+168>>2]=+g[l+36>>2];g[e+172>>2]=0.0;g[e+176>>2]=+g[l+8>>2];g[e+180>>2]=+g[l+24>>2];g[e+184>>2]=+g[l+40>>2];g[e+188>>2]=0.0;g[e+192>>2]=+g[l+12>>2];g[e+196>>2]=+g[l+28>>2];g[e+200>>2]=+g[l+44>>2];g[e+204>>2]=0.0;Co(e+256|0,e+208|0,e+160|0,e+360|0,e+344|0,n,m+396|0,+g[m+344>>2],l+396|0,+g[l+344>>2]);g[s>>2]=1.0/+g[e+336>>2]*(w*+g[n>>2]+x*+g[o>>2]+z*+g[q>>2])*-.20000000298023224}m=c[b+136>>2]|0}j=j+1|0}while((j|0)<(m|0));if((m|0)<=0){i=e;return}o=c[b+144>>2]|0;k=0;j=0;while(1){l=c[o+(j*284|0)+88>>2]|0;if((l|0)!=0){p=+g[o+(j*284|0)+252>>2];if(p!=0.0){l=c[b+56>>2]|0;q=l+(j<<2)|0;g[q>>2]=0.0;n=o+(j*284|0)+280|0;g[n>>2]=1.0;m=o;r=p*d}else{E=+g[o+(j*284|0)+256>>2];E=E!=0.0?E:0.0;m=c[b+116>>2]|0;q=c[b+16>>2]|0;x=+g[o+(j*284|0)+16>>2];v=+g[o+(j*284|0)+20>>2];F=+g[o+(j*284|0)+24>>2];H=+g[q+(j<<4)>>2];u=+g[q+(j<<4)+4>>2];r=+g[q+(j<<4)+8>>2];O=x- +g[m+52>>2];P=v- +g[m+56>>2];M=F- +g[m+60>>2];L=+g[m+264>>2]*(P*r-M*u)+ +g[m+280>>2]*(M*H-O*r)+(O*u-P*H)*+g[m+296>>2];R=(P*r-M*u)*+g[m+268>>2]+(M*H-O*r)*+g[m+284>>2]+(O*u-P*H)*+g[m+300>>2];N=(P*r-M*u)*+g[m+272>>2]+(M*H-O*r)*+g[m+288>>2]+(O*u-P*H)*+g[m+304>>2];C=x- +g[l+52>>2];A=v- +g[l+56>>2];t=F- +g[l+60>>2];I=(u*C-H*A)*+g[l+296>>2]+(+g[l+264>>2]*(r*A-u*t)+ +g[l+280>>2]*(H*t-r*C));K=(r*A-u*t)*+g[l+268>>2]+(H*t-r*C)*+g[l+284>>2]+(u*C-H*A)*+g[l+300>>2];J=(r*A-u*t)*+g[l+272>>2]+(H*t-r*C)*+g[l+288>>2]+(u*C-H*A)*+g[l+304>>2];x=x- +g[m+52>>2];v=v- +g[m+56>>2];F=F- +g[m+60>>2];z=+g[m+332>>2];G=+g[m+336>>2];w=+g[m+328>>2];D=+g[l+332>>2];p=+g[l+336>>2];B=+g[l+328>>2];r=-(1.0/(+g[m+344>>2]+(r*(P*L-O*R)+(H*(M*R-P*N)+u*(O*N-M*L)))+(+g[l+344>>2]+(r*(A*I-C*K)+(H*(t*K-A*J)+u*(C*J-t*I)))))*((F*z-v*G+ +g[m+312>>2]-(t*D-A*p+ +g[l+312>>2]))*H+(+g[m+316>>2]+(x*G-F*w)-(+g[l+316>>2]+(C*p-t*B)))*u+(v*w-x*z+ +g[m+320>>2]-(A*B-C*D+ +g[l+320>>2]))*r));r=E<r?E:r;m=c[b+144>>2]|0;l=c[b+56>>2]|0;q=l+(j<<2)|0;g[q>>2]=0.0;n=m+(j*284|0)+280|0;g[n>>2]=1.0;r=r<-E?-E:r}g[n>>2]=1.0;p=+g[o+(j*284|0)+276>>2]*d*+g[o+(j*284|0)+228>>2];g[q>>2]=r;r=r*.5;t=+g[(c[b+76>>2]|0)+(j<<2)>>2];if(r*r+t*t>p*p){R=p/+Q(+(r*r+t*t));g[n>>2]=R*+g[n>>2];k=1}}else{l=c[b+56>>2]|0;g[l+(j<<2)>>2]=0.0;g[o+(j*284|0)+280>>2]=1.0;m=o}j=j+1|0;n=c[b+136>>2]|0;if((j|0)>=(n|0))break;else o=m}if(k){if((n|0)<=0){i=e;return}j=c[b+76>>2]|0;k=0;do{o=j+(k<<2)|0;if(+g[o>>2]!=0.0?(f=m+(k*284|0)+280|0,h=+g[f>>2],h<1.0):0){y=l+(k<<2)|0;g[y>>2]=h*+g[y>>2];g[o>>2]=+g[f>>2]*+g[o>>2]}k=k+1|0}while((k|0)<(n|0))}if((n|0)<=0){i=e;return}n=0;while(1){o=c[b+116>>2]|0;k=m+(n*284|0)+16|0;f=m+(n*284|0)+20|0;R=+g[f>>2]- +g[o+56>>2];j=m+(n*284|0)+24|0;h=+g[j>>2]- +g[o+60>>2];g[e+64>>2]=+g[k>>2]- +g[o+52>>2];g[e+68>>2]=R;g[e+72>>2]=h;g[e+76>>2]=0.0;h=+g[l+(n<<2)>>2];if(h!=0.0){y=c[b+16>>2]|0;P=h*+g[y+(n<<4)+4>>2];R=h*+g[y+(n<<4)+8>>2];g[e+48>>2]=h*+g[y+(n<<4)>>2];g[e+52>>2]=P;g[e+56>>2]=R;g[e+60>>2]=0.0;qm(o,e+48|0,e+64|0)}h=+g[(c[b+76>>2]|0)+(n<<2)>>2];if(h!=0.0){y=c[(c[b+144>>2]|0)+(n*284|0)+88>>2]|0;L=+g[f>>2]- +g[y+56>>2];N=+g[j>>2]- +g[y+60>>2];g[e+32>>2]=+g[k>>2]- +g[y+52>>2];g[e+36>>2]=L;g[e+40>>2]=N;g[e+44>>2]=0.0;s=c[b+36>>2]|0;N=h*+g[s+(n<<4)+4>>2];L=h*+g[s+(n<<4)+8>>2];g[e+16>>2]=+g[s+(n<<4)>>2]*h;g[e+20>>2]=N;g[e+24>>2]=L;g[e+28>>2]=0.0;s=c[b+116>>2]|0;q=c[b+124>>2]|0;L=+g[s+(q<<2)+4>>2];N=+g[s+(q<<2)+20>>2];R=+g[s+(q<<2)+36>>2];K=+g[e+64>>2];M=+g[e+68>>2];O=+g[e+72>>2];P=(L*K+N*M+R*O)*(1.0- +g[m+(n*284|0)+244>>2]);g[e+64>>2]=K-L*P;g[e+68>>2]=M-N*P;g[e+72>>2]=O-R*P;qm(s,e+16|0,e+64|0);P=-+g[e+20>>2];R=-+g[e+24>>2];g[e>>2]=-+g[e+16>>2];g[e+4>>2]=P;g[e+8>>2]=R;g[e+12>>2]=0.0;qm(y,e,e+32|0)}n=n+1|0;if((n|0)>=(c[b+136>>2]|0))break;m=c[b+144>>2]|0;l=c[b+56>>2]|0}i=e;return}function Uq(b,d){b=b|0;d=d|0;var e=0,f=0,h=0,j=0.0,k=0.0,l=0,m=0;e=i;i=i+48|0;if((c[b+136>>2]|0)<=0){i=e;return}f=0;do{m=c[b+144>>2]|0;g[e+32>>2]=(a[m+(f*284|0)+84>>0]|0)==0?1.0:0.0;g[e+36>>2]=0.0;g[e+40>>2]=1.0;g[e+44>>2]=0.0;l=m+(f*284|0)+140|0;c[e+16>>2]=c[l+0>>2];c[e+20>>2]=c[l+4>>2];c[e+24>>2]=c[l+8>>2];c[e+28>>2]=c[l+12>>2];l=c[b+120>>2]|0;h=c[(c[d>>2]|0)+8>>2]|0;k=+g[m+(f*284|0)+(l<<2)+108>>2]+ +g[e+20>>2];j=+g[m+(f*284|0)+(l<<2)+124>>2]+ +g[e+24>>2];g[e>>2]=+g[m+(f*284|0)+(l<<2)+92>>2]+ +g[e+16>>2];g[e+4>>2]=k;g[e+8>>2]=j;g[e+12>>2]=0.0;vc[h&127](d,e+16|0,e,e+32|0);vc[c[(c[d>>2]|0)+8>>2]&127](d,e+16|0,(c[b+144>>2]|0)+(f*284|0)+16|0,e+32|0);f=f+1|0}while((f|0)<(c[b+136>>2]|0));i=e;return}function Vq(a,d,e,f){a=a|0;d=d|0;e=e|0;f=f|0;var h=0,j=0.0,k=0.0,l=0.0,m=0.0;h=i;i=i+96|0;g[h+4>>2]=1.0;c[h+8>>2]=0;b[h+12>>1]=1;b[h+14>>1]=-1;c[h+16>>2]=0;c[h>>2]=336;c[h+20>>2]=c[d+0>>2];c[h+24>>2]=c[d+4>>2];c[h+28>>2]=c[d+8>>2];c[h+32>>2]=c[d+12>>2];c[h+36>>2]=c[e+0>>2];c[h+40>>2]=c[e+4>>2];c[h+44>>2]=c[e+8>>2];c[h+48>>2]=c[e+12>>2];a=c[a+4>>2]|0;vc[c[(c[a>>2]|0)+32>>2]&127](a,d,e,h);e=c[h+8>>2]|0;if((e|0)==0){a=0;i=h;return a|0}if((c[e+236>>2]&2|0)==0){a=0;i=h;return a|0}if((c[e+204>>2]&4|0)!=0){a=0;i=h;return a|0}c[f+0>>2]=c[h+68>>2];c[f+4>>2]=c[h+72>>2];c[f+8>>2]=c[h+76>>2];c[f+12>>2]=c[h+80>>2];c[f+16>>2]=c[h+52>>2];c[f+20>>2]=c[h+56>>2];c[f+24>>2]=c[h+60>>2];c[f+28>>2]=c[h+64>>2];m=+g[f+16>>2];l=+g[f+20>>2];k=+g[f+24>>2];j=1.0/+Q(+(m*m+l*l+k*k));g[f+16>>2]=m*j;g[f+20>>2]=l*j;g[f+24>>2]=k*j;g[f+32>>2]=+g[h+4>>2];a=e;i=h;return a|0}function Wq(a,b,d){a=a|0;b=b|0;d=+d;b=i;Kb[c[(c[a>>2]|0)+16>>2]&31](a,d);i=b;return}function Xq(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;c[a+120>>2]=b;c[a+124>>2]=d;c[a+128>>2]=e;return}function Yq(a){a=a|0;return}function Zq(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function _q(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=3912;e=c[b+496>>2]|0;if((e|0)==0){a[b+500>>0]=1;c[b+496>>2]=0;c[b+488>>2]=0;c[b+492>>2]=0}else{if((a[b+500>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}a[b+500>>0]=1;c[b+496>>2]=0;c[b+488>>2]=0;c[b+492>>2]=0}c[5006]=(c[5006]|0)+1;YE(c[b+ -4>>2]|0);i=d;return}function $q(a,b){a=a|0;b=b|0;c[a+260>>2]=(c[a+260>>2]|0)+1;c[a+192>>2]=b;c[a+200>>2]=b;return}function ar(b,d){b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0,l=0,m=0,n=0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0;e=i;c[b+236>>2]=2;c[b+312>>2]=0;c[b+316>>2]=0;c[b+320>>2]=0;c[b+324>>2]=0;c[b+328>>2]=0;c[b+332>>2]=0;c[b+336>>2]=0;c[b+340>>2]=0;g[b+544>>2]=1.0;g[b+548>>2]=1.0;g[b+552>>2]=1.0;g[b+556>>2]=0.0;g[b+348>>2]=1.0;g[b+352>>2]=1.0;g[b+356>>2]=1.0;l=b+360|0;k=l+36|0;do{c[l>>2]=0;l=l+4|0}while((l|0)<(k|0));c[b+412>>2]=0;c[b+416>>2]=0;c[b+420>>2]=0;c[b+424>>2]=0;c[b+428>>2]=0;c[b+432>>2]=0;c[b+436>>2]=0;c[b+440>>2]=0;h=+g[d+92>>2];f=+g[d+96>>2];if(h<0.0)h=0.0;else h=h>1.0?1.0:h;g[b+444>>2]=h;if(f<0.0)f=0.0;else f=f>1.0?1.0:f;g[b+448>>2]=f;g[b+472>>2]=+g[d+112>>2];g[b+476>>2]=+g[d+116>>2];k=c[d+4>>2]|0;c[b+480>>2]=k;c[b+608>>2]=0;c[b+612>>2]=0;a[b+452>>0]=a[d+120>>0]|0;g[b+456>>2]=+g[d+124>>2];g[b+460>>2]=+g[d+128>>2];g[b+464>>2]=+g[d+132>>2];g[b+468>>2]=+g[d+136>>2];if((k|0)==0){c[b+4>>2]=c[d+8>>2];c[b+8>>2]=c[d+12>>2];c[b+12>>2]=c[d+16>>2];c[b+16>>2]=c[d+20>>2];c[b+20>>2]=c[d+24>>2];c[b+24>>2]=c[d+28>>2];c[b+28>>2]=c[d+32>>2];c[b+32>>2]=c[d+36>>2];c[b+36>>2]=c[d+40>>2];c[b+40>>2]=c[d+44>>2];c[b+44>>2]=c[d+48>>2];c[b+48>>2]=c[d+52>>2];c[b+52>>2]=c[d+56>>2];c[b+56>>2]=c[d+60>>2];c[b+60>>2]=c[d+64>>2];c[b+64>>2]=c[d+68>>2];n=b+52|0;m=b+20|0;k=b+36|0;l=b+4|0}else{Nb[c[(c[k>>2]|0)+8>>2]&127](k,b+4|0);n=b+52|0;m=b+20|0;k=b+36|0;l=b+4|0}c[b+68>>2]=c[l+0>>2];c[b+72>>2]=c[l+4>>2];c[b+76>>2]=c[l+8>>2];c[b+80>>2]=c[l+12>>2];c[b+84>>2]=c[m+0>>2];c[b+88>>2]=c[m+4>>2];c[b+92>>2]=c[m+8>>2];c[b+96>>2]=c[m+12>>2];c[b+100>>2]=c[k+0>>2];c[b+104>>2]=c[k+4>>2];c[b+108>>2]=c[k+8>>2];c[b+112>>2]=c[k+12>>2];c[b+116>>2]=c[n+0>>2];c[b+120>>2]=c[n+4>>2];c[b+124>>2]=c[n+8>>2];c[b+128>>2]=c[n+12>>2];c[b+132>>2]=0;c[b+136>>2]=0;c[b+140>>2]=0;c[b+144>>2]=0;c[b+148>>2]=0;c[b+152>>2]=0;c[b+156>>2]=0;c[b+160>>2]=0;g[b+224>>2]=+g[d+100>>2];g[b+232>>2]=+g[d+104>>2];g[b+228>>2]=+g[d+108>>2];Nb[c[(c[b>>2]|0)+12>>2]&127](b,c[d+72>>2]|0);k=c[986]|0;c[986]=k+1;c[b+508>>2]=k;h=+g[d>>2];k=c[b+204>>2]|0;if(h==0.0){c[b+204>>2]=k|1;g[b+344>>2]=0.0;f=0.0}else{c[b+204>>2]=k&-2;g[b+344>>2]=1.0/h;f=1.0/h}j=h*+g[b+384>>2];o=h*+g[b+388>>2];g[b+364>>2]=h*+g[b+380>>2];g[b+368>>2]=j;g[b+372>>2]=o;g[b+376>>2]=0.0;h=+g[d+76>>2];if(h!=0.0)h=1.0/h;else h=0.0;j=+g[d+80>>2];if(j!=0.0)j=1.0/j;else j=0.0;o=+g[d+84>>2];if(o!=0.0)o=1.0/o;else o=0.0;g[b+396>>2]=h;g[b+400>>2]=j;g[b+404>>2]=o;g[b+408>>2]=0.0;D=f*+g[b+352>>2];x=f*+g[b+356>>2];g[b+560>>2]=f*+g[b+348>>2];g[b+564>>2]=D;g[b+568>>2]=x;g[b+572>>2]=0.0;x=+g[b+4>>2];D=x*h;w=+g[b+8>>2];C=w*j;v=+g[b+12>>2];B=v*o;u=+g[b+20>>2];A=h*u;t=+g[b+24>>2];z=j*t;s=+g[b+28>>2];y=o*s;r=+g[b+36>>2];q=h*r;p=+g[b+40>>2];f=j*p;j=+g[b+44>>2];h=o*j;g[b+264>>2]=x*D+w*C+v*B;g[b+268>>2]=D*u+C*t+B*s;g[b+272>>2]=D*r+C*p+B*j;g[b+276>>2]=0.0;g[b+280>>2]=x*A+w*z+v*y;g[b+284>>2]=u*A+t*z+s*y;g[b+288>>2]=A*r+z*p+y*j;g[b+292>>2]=0.0;g[b+296>>2]=x*q+w*f+v*h;g[b+300>>2]=u*q+t*f+s*h;g[b+304>>2]=r*q+p*f+j*h;g[b+308>>2]=0.0;c[b+504>>2]=0;c[b+512>>2]=0;c[b+516>>2]=0;c[b+520>>2]=0;c[b+524>>2]=0;c[b+528>>2]=0;c[b+532>>2]=0;c[b+536>>2]=0;c[b+540>>2]=0;h=+g[b+344>>2];j=h*+g[b+352>>2];o=h*+g[b+356>>2];g[b+560>>2]=+g[b+348>>2]*h;g[b+564>>2]=j;g[b+568>>2]=o;l=b+572|0;k=l+36|0;do{c[l>>2]=0;l=l+4|0}while((l|0)<(k|0));i=e;return}function br(b,d,e,f,h){b=b|0;d=+d;e=e|0;f=f|0;h=h|0;var j=0;j=i;i=i+144|0;g[b+164>>2]=1.0;g[b+168>>2]=1.0;g[b+172>>2]=1.0;g[b+176>>2]=0.0;c[b+180>>2]=0;g[b+184>>2]=999999984306749400.0;c[b+188>>2]=0;c[b+192>>2]=0;c[b+196>>2]=0;c[b+200>>2]=0;c[b+204>>2]=1;c[b+208>>2]=-1;c[b+212>>2]=-1;c[b+216>>2]=1;g[b+220>>2]=0.0;g[b+224>>2]=.5;g[b+228>>2]=0.0;g[b+232>>2]=0.0;c[b+236>>2]=1;c[b+240>>2]=0;g[b+244>>2]=1.0;c[b+248>>2]=0;c[b+252>>2]=0;c[b+256>>2]=0;c[b+260>>2]=0;g[b+4>>2]=1.0;c[b+8>>2]=0;c[b+12>>2]=0;c[b+16>>2]=0;c[b+20>>2]=0;g[b+24>>2]=1.0;c[b+28>>2]=0;c[b+32>>2]=0;c[b+36>>2]=0;c[b+40>>2]=0;g[b+44>>2]=1.0;c[b+48>>2]=0;c[b+52>>2]=0;c[b+56>>2]=0;c[b+60>>2]=0;c[b+64>>2]=0;c[b>>2]=3912;a[b+500>>0]=1;c[b+496>>2]=0;c[b+488>>2]=0;c[b+492>>2]=0;g[j>>2]=d;c[j+4>>2]=e;c[j+72>>2]=f;c[j+76>>2]=c[h+0>>2];c[j+80>>2]=c[h+4>>2];c[j+84>>2]=c[h+8>>2];c[j+88>>2]=c[h+12>>2];g[j+92>>2]=0.0;g[j+96>>2]=0.0;g[j+100>>2]=.5;g[j+104>>2]=0.0;g[j+108>>2]=0.0;g[j+112>>2]=.800000011920929;g[j+116>>2]=1.0;a[j+120>>0]=0;g[j+124>>2]=.004999999888241291;g[j+128>>2]=.009999999776482582;g[j+132>>2]=.009999999776482582;g[j+136>>2]=.009999999776482582;g[j+8>>2]=1.0;c[j+12>>2]=0;c[j+16>>2]=0;c[j+20>>2]=0;c[j+24>>2]=0;g[j+28>>2]=1.0;c[j+32>>2]=0;c[j+36>>2]=0;c[j+40>>2]=0;c[j+44>>2]=0;g[j+48>>2]=1.0;c[j+52>>2]=0;c[j+56>>2]=0;c[j+60>>2]=0;c[j+64>>2]=0;c[j+68>>2]=0;ar(b,j);i=j;return}function cr(a,b,d){a=a|0;b=+b;d=d|0;var e=0.0,f=0.0,h=0.0,i=0;i=c[a+204>>2]|0;if(b==0.0){c[a+204>>2]=i|1;g[a+344>>2]=0.0;e=0.0}else{c[a+204>>2]=i&-2;g[a+344>>2]=1.0/b;e=1.0/b}f=+g[a+384>>2]*b;h=+g[a+388>>2]*b;g[a+364>>2]=+g[a+380>>2]*b;g[a+368>>2]=f;g[a+372>>2]=h;g[a+376>>2]=0.0;b=+g[d>>2];if(b!=0.0)b=1.0/b;else b=0.0;f=+g[d+4>>2];if(f!=0.0)f=1.0/f;else f=0.0;h=+g[d+8>>2];if(h!=0.0)h=1.0/h;else h=0.0;g[a+396>>2]=b;g[a+400>>2]=f;g[a+404>>2]=h;g[a+408>>2]=0.0;f=e*+g[a+352>>2];h=e*+g[a+356>>2];g[a+560>>2]=+g[a+348>>2]*e;g[a+564>>2]=f;g[a+568>>2]=h;g[a+572>>2]=0.0;return}function dr(a,b){a=a|0;b=b|0;var d=0,e=0,f=0,h=0,j=0,k=0,l=0,m=0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0;j=i;if((c[a+204>>2]&2|0)==0){c[a+68>>2]=c[b+0>>2];c[a+72>>2]=c[b+4>>2];c[a+76>>2]=c[b+8>>2];c[a+80>>2]=c[b+12>>2];c[a+84>>2]=c[b+16>>2];c[a+88>>2]=c[b+20>>2];c[a+92>>2]=c[b+24>>2];c[a+96>>2]=c[b+28>>2];c[a+100>>2]=c[b+32>>2];c[a+104>>2]=c[b+36>>2];c[a+108>>2]=c[b+40>>2];c[a+112>>2]=c[b+44>>2];c[a+116>>2]=c[b+48>>2];c[a+120>>2]=c[b+52>>2];c[a+124>>2]=c[b+56>>2];c[a+128>>2]=c[b+60>>2];l=a+20|0;m=b+16|0;d=a+36|0;k=b+32|0;f=a+52|0;h=b+48|0;e=a+4|0}else{c[a+68>>2]=c[a+4>>2];c[a+72>>2]=c[a+8>>2];c[a+76>>2]=c[a+12>>2];c[a+80>>2]=c[a+16>>2];c[a+84>>2]=c[a+20>>2];c[a+88>>2]=c[a+24>>2];c[a+92>>2]=c[a+28>>2];c[a+96>>2]=c[a+32>>2];c[a+100>>2]=c[a+36>>2];c[a+104>>2]=c[a+40>>2];c[a+108>>2]=c[a+44>>2];c[a+112>>2]=c[a+48>>2];c[a+116>>2]=c[a+52>>2];c[a+120>>2]=c[a+56>>2];c[a+124>>2]=c[a+60>>2];c[a+128>>2]=c[a+64>>2];l=a+20|0;m=b+16|0;d=a+36|0;k=b+32|0;f=a+52|0;h=b+48|0;e=a+4|0}c[a+132>>2]=c[a+312>>2];c[a+136>>2]=c[a+316>>2];c[a+140>>2]=c[a+320>>2];c[a+144>>2]=c[a+324>>2];c[a+148>>2]=c[a+328>>2];c[a+152>>2]=c[a+332>>2];c[a+156>>2]=c[a+336>>2];c[a+160>>2]=c[a+340>>2];c[e+0>>2]=c[b+0>>2];c[e+4>>2]=c[b+4>>2];c[e+8>>2]=c[b+8>>2];c[e+12>>2]=c[b+12>>2];c[l+0>>2]=c[m+0>>2];c[l+4>>2]=c[m+4>>2];c[l+8>>2]=c[m+8>>2];c[l+12>>2]=c[m+12>>2];c[d+0>>2]=c[k+0>>2];c[d+4>>2]=c[k+4>>2];c[d+8>>2]=c[k+8>>2];c[d+12>>2]=c[k+12>>2];c[f+0>>2]=c[h+0>>2];c[f+4>>2]=c[h+4>>2];c[f+8>>2]=c[h+8>>2];c[f+12>>2]=c[h+12>>2];y=+g[a+4>>2];s=+g[a+396>>2];x=+g[a+8>>2];q=+g[a+400>>2];w=+g[a+12>>2];o=+g[a+404>>2];v=+g[a+20>>2];u=+g[a+24>>2];t=+g[a+28>>2];r=+g[a+36>>2];p=+g[a+40>>2];n=+g[a+44>>2];g[a+264>>2]=y*y*s+x*x*q+w*w*o;g[a+268>>2]=y*s*v+x*q*u+w*o*t;g[a+272>>2]=y*s*r+x*q*p+w*o*n;g[a+276>>2]=0.0;g[a+280>>2]=y*s*v+x*q*u+w*o*t;g[a+284>>2]=v*s*v+u*q*u+t*o*t;g[a+288>>2]=s*v*r+q*u*p+o*t*n;g[a+292>>2]=0.0;g[a+296>>2]=y*s*r+x*q*p+w*o*n;g[a+300>>2]=v*s*r+u*q*p+t*o*n;g[a+304>>2]=r*s*r+p*q*p+n*o*n;g[a+308>>2]=0.0;i=j;return}function er(b,d){b=b|0;d=d|0;var e=0,f=0,g=0,h=0;e=i;a:do if((c[d+236>>2]&2|0)!=0?(f=c[b+488>>2]|0,(f|0)>0):0){b=c[b+496>>2]|0;g=0;while(1){h=c[b+(g<<2)>>2]|0;if((a[h+20>>0]|0)!=0){if((c[h+28>>2]|0)==(d|0)){d=0;break a}if((c[h+32>>2]|0)==(d|0)){d=0;break a}}g=g+1|0;if((g|0)>=(f|0)){d=1;break}}}else d=1;while(0);i=e;return d|0}function fr(b,d){b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0;e=i;h=c[b+488>>2]|0;a:do if((h|0)>0){j=c[b+496>>2]|0;g=0;while(1){k=g+1|0;if((c[j+(g<<2)>>2]|0)==(d|0))break;if((k|0)<(h|0))g=k;else break a}if((g|0)!=(h|0)){k=b+256|0;c[k>>2]=1;i=e;return}}while(0);if((h|0)==(c[b+492>>2]|0)?(f=(h|0)==0?1:h<<1,(h|0)<(f|0)):0){if((f|0)==0)g=0;else{c[5004]=(c[5004]|0)+1;g=XE((f<<2|3)+16|0)|0;if((g|0)==0)g=0;else{c[(g+19&-16)+ -4>>2]=g;g=g+19&-16}h=c[b+488>>2]|0}if((h|0)>0){j=0;do{k=g+(j<<2)|0;if((k|0)!=0)c[k>>2]=c[(c[b+496>>2]|0)+(j<<2)>>2];j=j+1|0}while((j|0)!=(h|0))}j=c[b+496>>2]|0;if((j|0)!=0){if((a[b+500>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0);h=c[b+488>>2]|0}c[b+496>>2]=0}a[b+500>>0]=1;c[b+496>>2]=g;c[b+492>>2]=f}f=(c[b+496>>2]|0)+(h<<2)|0;if((f|0)!=0)c[f>>2]=d;c[b+488>>2]=h+1;k=b+256|0;c[k>>2]=1;i=e;return}function gr(a){a=a|0;return 488}function hr(a,b,e){a=a|0;b=b|0;e=e|0;var f=0;f=i;fu(a,b,e)|0;g[b+256>>2]=+g[a+264>>2];g[b+260>>2]=+g[a+268>>2];g[b+264>>2]=+g[a+272>>2];g[b+268>>2]=+g[a+276>>2];g[b+272>>2]=+g[a+280>>2];g[b+276>>2]=+g[a+284>>2];g[b+280>>2]=+g[a+288>>2];g[b+284>>2]=+g[a+292>>2];g[b+288>>2]=+g[a+296>>2];g[b+292>>2]=+g[a+300>>2];g[b+296>>2]=+g[a+304>>2];g[b+300>>2]=+g[a+308>>2];g[b+304>>2]=+g[a+312>>2];g[b+308>>2]=+g[a+316>>2];g[b+312>>2]=+g[a+320>>2];g[b+316>>2]=+g[a+324>>2];g[b+320>>2]=+g[a+328>>2];g[b+324>>2]=+g[a+332>>2];g[b+328>>2]=+g[a+336>>2];g[b+332>>2]=+g[a+340>>2];g[b+448>>2]=+g[a+344>>2];g[b+336>>2]=+g[a+544>>2];g[b+340>>2]=+g[a+548>>2];g[b+344>>2]=+g[a+552>>2];g[b+348>>2]=+g[a+556>>2];g[b+352>>2]=+g[a+348>>2];g[b+356>>2]=+g[a+352>>2];g[b+360>>2]=+g[a+356>>2];g[b+364>>2]=+g[a+360>>2];g[b+368>>2]=+g[a+364>>2];g[b+372>>2]=+g[a+368>>2];g[b+376>>2]=+g[a+372>>2];g[b+380>>2]=+g[a+376>>2];g[b+384>>2]=+g[a+380>>2];g[b+388>>2]=+g[a+384>>2];g[b+392>>2]=+g[a+388>>2];g[b+396>>2]=+g[a+392>>2];g[b+400>>2]=+g[a+396>>2];g[b+404>>2]=+g[a+400>>2];g[b+408>>2]=+g[a+404>>2];g[b+412>>2]=+g[a+408>>2];g[b+416>>2]=+g[a+412>>2];g[b+420>>2]=+g[a+416>>2];g[b+424>>2]=+g[a+420>>2];g[b+428>>2]=+g[a+424>>2];g[b+432>>2]=+g[a+428>>2];g[b+436>>2]=+g[a+432>>2];g[b+440>>2]=+g[a+436>>2];g[b+444>>2]=+g[a+440>>2];g[b+452>>2]=+g[a+444>>2];g[b+456>>2]=+g[a+448>>2];c[b+484>>2]=d[a+452>>0];g[b+460>>2]=+g[a+456>>2];g[b+464>>2]=+g[a+460>>2];g[b+468>>2]=+g[a+464>>2];g[b+472>>2]=+g[a+468>>2];g[b+476>>2]=+g[a+472>>2];g[b+480>>2]=+g[a+476>>2];i=f;return 3952}function ir(a,b){a=a|0;b=b|0;var d=0,e=0,f=0;d=i;e=c[(c[b>>2]|0)+16>>2]|0;f=Pb[c[(c[a>>2]|0)+16>>2]&127](a)|0;f=Yb[e&31](b,f,1)|0;e=Yb[c[(c[a>>2]|0)+20>>2]&31](a,c[f+8>>2]|0,b)|0;Jb[c[(c[b>>2]|0)+20>>2]&31](b,f,e,1497645650,a);i=d;return}function jr(a){a=a|0;var b=0;b=i;kr(a);if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function kr(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=4024;e=c[b+176>>2]|0;if((e|0)!=0){if((a[b+180>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+176>>2]=0}a[b+180>>0]=1;c[b+176>>2]=0;c[b+168>>2]=0;c[b+172>>2]=0;e=c[b+156>>2]|0;if((e|0)!=0){if((a[b+160>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+156>>2]=0}a[b+160>>0]=1;c[b+156>>2]=0;c[b+148>>2]=0;c[b+152>>2]=0;e=c[b+136>>2]|0;if((e|0)!=0){if((a[b+140>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+136>>2]=0}a[b+140>>0]=1;c[b+136>>2]=0;c[b+128>>2]=0;c[b+132>>2]=0;e=c[b+116>>2]|0;if((e|0)!=0){if((a[b+120>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+116>>2]=0}a[b+120>>0]=1;c[b+116>>2]=0;c[b+108>>2]=0;c[b+112>>2]=0;e=c[b+96>>2]|0;if((e|0)!=0){if((a[b+100>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+96>>2]=0}a[b+100>>0]=1;c[b+96>>2]=0;c[b+88>>2]=0;c[b+92>>2]=0;e=c[b+76>>2]|0;if((e|0)!=0){if((a[b+80>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+76>>2]=0}a[b+80>>0]=1;c[b+76>>2]=0;c[b+68>>2]=0;c[b+72>>2]=0;e=c[b+56>>2]|0;if((e|0)!=0){if((a[b+60>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+56>>2]=0}a[b+60>>0]=1;c[b+56>>2]=0;c[b+48>>2]=0;c[b+52>>2]=0;e=c[b+36>>2]|0;if((e|0)!=0){if((a[b+40>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+36>>2]=0}a[b+40>>0]=1;c[b+36>>2]=0;c[b+28>>2]=0;c[b+32>>2]=0;e=c[b+16>>2]|0;if((e|0)==0){a[b+20>>0]=1;c[b+16>>2]=0;c[b+8>>2]=0;e=b+12|0;c[e>>2]=0;i=d;return}if((a[b+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+16>>2]=0;a[b+20>>0]=1;c[b+16>>2]=0;c[b+8>>2]=0;e=b+12|0;c[e>>2]=0;i=d;return}function lr(a,b,d){a=a|0;b=b|0;d=d|0;var e=0.0,f=0.0,h=0.0,j=0,k=0.0,l=0.0,m=0.0;j=i;k=+g[d+100>>2];h=+g[d+16>>2];e=+g[d+20>>2];f=+g[d+24>>2];l=+g[d+108>>2];l=+g[d+112>>2]-k*+g[d+116>>2]-(h*+g[a+64>>2]+e*+g[a+68>>2]+f*+g[a+72>>2]+(+g[d>>2]*+g[a+80>>2]+ +g[d+4>>2]*+g[a+84>>2]+ +g[d+8>>2]*+g[a+88>>2]))*l-l*(+g[d+48>>2]*+g[b+64>>2]+ +g[d+52>>2]*+g[b+68>>2]+ +g[d+56>>2]*+g[b+72>>2]+(+g[d+32>>2]*+g[b+80>>2]+ +g[d+36>>2]*+g[b+84>>2]+ +g[d+40>>2]*+g[b+88>>2]));m=+g[d+120>>2];do if(!(k+l<m)){m=+g[d+124>>2];if(k+l>m){g[d+100>>2]=m;l=m-k;break}else{g[d+100>>2]=k+l;break}}else{g[d+100>>2]=m;l=m-k}while(0);if((c[a+240>>2]|0)!=0){m=l*+g[a+132>>2]*e*+g[a+116>>2];k=l*+g[a+136>>2]*f*+g[a+120>>2];g[a+64>>2]=+g[a+112>>2]*l*+g[a+128>>2]*h+ +g[a+64>>2];g[a+68>>2]=m+ +g[a+68>>2];g[a+72>>2]=k+ +g[a+72>>2];k=l*+g[a+100>>2]*+g[d+68>>2];m=l*+g[a+104>>2]*+g[d+72>>2];g[a+80>>2]=l*+g[a+96>>2]*+g[d+64>>2]+ +g[a+80>>2];g[a+84>>2]=k+ +g[a+84>>2];g[a+88>>2]=m+ +g[a+88>>2]}if((c[b+240>>2]|0)==0){i=j;return}m=l*+g[b+132>>2]*+g[d+52>>2]*+g[b+116>>2];k=l*+g[b+136>>2]*+g[d+56>>2]*+g[b+120>>2];g[b+64>>2]=+g[b+112>>2]*l*+g[b+128>>2]*+g[d+48>>2]+ +g[b+64>>2];g[b+68>>2]=m+ +g[b+68>>2];g[b+72>>2]=k+ +g[b+72>>2];k=l*+g[b+100>>2]*+g[d+84>>2];m=l*+g[b+104>>2]*+g[d+88>>2];g[b+80>>2]=l*+g[b+96>>2]*+g[d+80>>2]+ +g[b+80>>2];g[b+84>>2]=k+ +g[b+84>>2];g[b+88>>2]=m+ +g[b+88>>2];i=j;return}function mr(a,b,d){a=a|0;b=b|0;d=d|0;var e=0.0,f=0.0,h=0.0,j=0,k=0.0,l=0.0,m=0.0,n=0.0;j=i;m=+g[d+100>>2];h=+g[d+16>>2];e=+g[d+20>>2];f=+g[d+24>>2];n=+g[d+108>>2];n=+g[d+112>>2]-m*+g[d+116>>2]-(h*+g[a+64>>2]+e*+g[a+68>>2]+f*+g[a+72>>2]+(+g[d>>2]*+g[a+80>>2]+ +g[d+4>>2]*+g[a+84>>2]+ +g[d+8>>2]*+g[a+88>>2]))*n-n*(+g[d+48>>2]*+g[b+64>>2]+ +g[d+52>>2]*+g[b+68>>2]+ +g[d+56>>2]*+g[b+72>>2]+(+g[d+32>>2]*+g[b+80>>2]+ +g[d+36>>2]*+g[b+84>>2]+ +g[d+40>>2]*+g[b+88>>2]));l=+g[d+120>>2];if(m+n<l)k=l-m;else{k=n;l=m+n}g[d+100>>2]=l;if((c[a+240>>2]|0)!=0){n=k*+g[a+132>>2]*e*+g[a+116>>2];m=k*+g[a+136>>2]*f*+g[a+120>>2];g[a+64>>2]=+g[a+112>>2]*k*+g[a+128>>2]*h+ +g[a+64>>2];g[a+68>>2]=n+ +g[a+68>>2];g[a+72>>2]=m+ +g[a+72>>2];m=k*+g[a+100>>2]*+g[d+68>>2];n=k*+g[a+104>>2]*+g[d+72>>2];g[a+80>>2]=k*+g[a+96>>2]*+g[d+64>>2]+ +g[a+80>>2];g[a+84>>2]=m+ +g[a+84>>2];g[a+88>>2]=n+ +g[a+88>>2]}if((c[b+240>>2]|0)==0){i=j;return}n=k*+g[b+132>>2]*+g[d+52>>2]*+g[b+116>>2];m=k*+g[b+136>>2]*+g[d+56>>2]*+g[b+120>>2];g[b+64>>2]=+g[b+112>>2]*k*+g[b+128>>2]*+g[d+48>>2]+ +g[b+64>>2];g[b+68>>2]=n+ +g[b+68>>2];g[b+72>>2]=m+ +g[b+72>>2];m=k*+g[b+100>>2]*+g[d+84>>2];n=k*+g[b+104>>2]*+g[d+88>>2];g[b+80>>2]=k*+g[b+96>>2]*+g[d+80>>2]+ +g[b+80>>2];g[b+84>>2]=m+ +g[b+84>>2];g[b+88>>2]=n+ +g[b+88>>2];i=j;return}function nr(a,b,d){a=a|0;b=b|0;d=d|0;var e=0.0,f=0.0,h=0.0,j=0,k=0.0,l=0.0,m=0.0,n=0.0;j=i;l=+g[d+128>>2];if(!(l!=0.0)){i=j;return}c[1002]=(c[1002]|0)+1;k=+g[d+96>>2];f=+g[d+16>>2];h=+g[d+20>>2];e=+g[d+24>>2];n=+g[d+108>>2];n=l-k*+g[d+116>>2]-(f*+g[a+144>>2]+h*+g[a+148>>2]+e*+g[a+152>>2]+(+g[d>>2]*+g[a+160>>2]+ +g[d+4>>2]*+g[a+164>>2]+ +g[d+8>>2]*+g[a+168>>2]))*n-n*(+g[d+48>>2]*+g[b+144>>2]+ +g[d+52>>2]*+g[b+148>>2]+ +g[d+56>>2]*+g[b+152>>2]+(+g[d+32>>2]*+g[b+160>>2]+ +g[d+36>>2]*+g[b+164>>2]+ +g[d+40>>2]*+g[b+168>>2]));m=+g[d+120>>2];if(k+n<m)l=m-k;else{l=n;m=k+n}g[d+96>>2]=m;if((c[a+240>>2]|0)!=0){n=l*+g[a+132>>2]*h*+g[a+116>>2];m=l*+g[a+136>>2]*e*+g[a+120>>2];g[a+144>>2]=+g[a+112>>2]*l*+g[a+128>>2]*f+ +g[a+144>>2];g[a+148>>2]=n+ +g[a+148>>2];g[a+152>>2]=m+ +g[a+152>>2];m=l*+g[a+100>>2]*+g[d+68>>2];n=l*+g[a+104>>2]*+g[d+72>>2];g[a+160>>2]=l*+g[a+96>>2]*+g[d+64>>2]+ +g[a+160>>2];g[a+164>>2]=m+ +g[a+164>>2];g[a+168>>2]=n+ +g[a+168>>2]}if((c[b+240>>2]|0)==0){i=j;return}n=l*+g[b+132>>2]*+g[d+52>>2]*+g[b+116>>2];m=l*+g[b+136>>2]*+g[d+56>>2]*+g[b+120>>2];g[b+144>>2]=+g[b+112>>2]*l*+g[b+128>>2]*+g[d+48>>2]+ +g[b+144>>2];g[b+148>>2]=n+ +g[b+148>>2];g[b+152>>2]=m+ +g[b+152>>2];m=l*+g[b+100>>2]*+g[d+84>>2];n=l*+g[b+104>>2]*+g[d+88>>2];g[b+160>>2]=l*+g[b+96>>2]*+g[d+80>>2]+ +g[b+160>>2];g[b+164>>2]=m+ +g[b+164>>2];g[b+168>>2]=n+ +g[b+168>>2];i=j;return}function or(a,b,d){a=a|0;b=b|0;d=+d;var e=0,f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0,o=0;e=i;if(!((b|0)!=0?(c[b+236>>2]&2|0)!=0:0))b=0;f=(b|0)==0;c[a+64>>2]=0;c[a+68>>2]=0;c[a+72>>2]=0;c[a+76>>2]=0;c[a+80>>2]=0;c[a+84>>2]=0;c[a+88>>2]=0;c[a+92>>2]=0;c[a+144>>2]=0;c[a+148>>2]=0;c[a+152>>2]=0;c[a+156>>2]=0;c[a+160>>2]=0;c[a+164>>2]=0;c[a+168>>2]=0;c[a+172>>2]=0;if(f){g[a>>2]=1.0;c[a+4>>2]=0;c[a+8>>2]=0;c[a+12>>2]=0;c[a+16>>2]=0;g[a+20>>2]=1.0;c[a+24>>2]=0;c[a+28>>2]=0;c[a+32>>2]=0;c[a+36>>2]=0;g[a+40>>2]=1.0;c[a+44>>2]=0;c[a+48>>2]=0;c[a+52>>2]=0;c[a+56>>2]=0;c[a+60>>2]=0;c[a+240>>2]=0;c[a+128>>2]=0;c[a+132>>2]=0;c[a+136>>2]=0;c[a+140>>2]=0;g[a+96>>2]=1.0;g[a+100>>2]=1.0;g[a+104>>2]=1.0;g[a+108>>2]=0.0;g[a+112>>2]=1.0;g[a+116>>2]=1.0;g[a+120>>2]=1.0;g[a+124>>2]=0.0;b=a+176|0;a=b+64|0;do{c[b>>2]=0;b=b+4|0}while((b|0)<(a|0));i=e;return}else{f=b+4|0;c[a+0>>2]=c[f+0>>2];c[a+4>>2]=c[f+4>>2];c[a+8>>2]=c[f+8>>2];c[a+12>>2]=c[f+12>>2];f=b+20|0;c[a+16>>2]=c[f+0>>2];c[a+20>>2]=c[f+4>>2];c[a+24>>2]=c[f+8>>2];c[a+28>>2]=c[f+12>>2];f=b+36|0;c[a+32>>2]=c[f+0>>2];c[a+36>>2]=c[f+4>>2];c[a+40>>2]=c[f+8>>2];c[a+44>>2]=c[f+12>>2];f=b+52|0;c[a+48>>2]=c[f+0>>2];c[a+52>>2]=c[f+4>>2];c[a+56>>2]=c[f+8>>2];c[a+60>>2]=c[f+12>>2];f=b+344|0;m=+g[f>>2];n=b+348|0;l=m*+g[b+352>>2];k=m*+g[b+356>>2];g[a+128>>2]=m*+g[n>>2];g[a+132>>2]=l;g[a+136>>2]=k;g[a+140>>2]=0.0;c[a+240>>2]=b;o=b+544|0;c[a+96>>2]=c[o+0>>2];c[a+100>>2]=c[o+4>>2];c[a+104>>2]=c[o+8>>2];c[a+108>>2]=c[o+12>>2];c[a+112>>2]=c[n+0>>2];c[a+116>>2]=c[n+4>>2];c[a+120>>2]=c[n+8>>2];c[a+124>>2]=c[n+12>>2];n=b+312|0;c[a+176>>2]=c[n+0>>2];c[a+180>>2]=c[n+4>>2];c[a+184>>2]=c[n+8>>2];c[a+188>>2]=c[n+12>>2];n=b+328|0;c[a+192>>2]=c[n+0>>2];c[a+196>>2]=c[n+4>>2];c[a+200>>2]=c[n+8>>2];c[a+204>>2]=c[n+12>>2];k=+g[f>>2];l=k*+g[b+416>>2]*d;m=k*+g[b+420>>2]*d;g[a+208>>2]=k*+g[b+412>>2]*d;g[a+212>>2]=l;g[a+216>>2]=m;g[a+220>>2]=0.0;m=+g[b+428>>2];l=+g[b+432>>2];k=+g[b+436>>2];j=(m*+g[b+268>>2]+l*+g[b+284>>2]+k*+g[b+300>>2])*d;h=(m*+g[b+272>>2]+l*+g[b+288>>2]+k*+g[b+304>>2])*d;g[a+224>>2]=(+g[b+264>>2]*m+ +g[b+280>>2]*l+ +g[b+296>>2]*k)*d;g[a+228>>2]=j;g[a+232>>2]=h;g[a+236>>2]=0.0;i=e;return}}function pr(a,b){a=a|0;b=b|0;var d=0,e=0.0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0;d=i;if((a|0)==0){i=d;return}if((c[a+180>>2]&1|0)==0){i=d;return}r=+g[a+4>>2];t=+g[b>>2];o=+g[a+20>>2];s=+g[b+4>>2];l=+g[a+36>>2];e=+g[b+8>>2];q=+g[a+8>>2];n=+g[a+24>>2];j=+g[a+40>>2];p=+g[a+12>>2];m=+g[a+28>>2];f=+g[a+44>>2];k=(r*t+o*s+l*e)*+g[a+164>>2];h=(t*q+s*n+e*j)*+g[a+168>>2];e=(t*p+s*m+e*f)*+g[a+172>>2];g[b>>2]=r*k+q*h+p*e;g[b+4>>2]=o*k+n*h+m*e;g[b+8>>2]=l*k+j*h+f*e;g[b+12>>2]=0.0;i=d;return}function qr(b,d,e,f,h,j,k,l,m,n,o){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;k=k|0;l=l|0;m=+m;n=+n;o=+o;var p=0,q=0,r=0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0,F=0,G=0.0,H=0.0,I=0.0;q=i;p=c[b+68>>2]|0;if((p|0)==(c[b+72>>2]|0)?(r=(p|0)==0?1:p<<1,(p|0)<(r|0)):0){if((r|0)==0){x=0;F=p}else{c[5004]=(c[5004]|0)+1;x=XE((r*152|3)+16|0)|0;if((x|0)==0)x=0;else{c[(x+19&-16)+ -4>>2]=x;x=x+19&-16}F=c[b+68>>2]|0}if((F|0)>0){E=0;do{cF(x+(E*152|0)|0,(c[b+76>>2]|0)+(E*152|0)|0,152)|0;E=E+1|0}while((E|0)!=(F|0))}E=c[b+76>>2]|0;if((E|0)!=0){if((a[b+80>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[E+ -4>>2]|0)}c[b+76>>2]=0}a[b+80>>0]=1;c[b+76>>2]=x;c[b+72>>2]=r;r=c[b+68>>2]|0}else r=p;c[b+68>>2]=r+1;r=c[b+76>>2]|0;c[r+(p*152|0)+140>>2]=h;h=c[b+16>>2]|0;x=c[h+(e*244|0)+240>>2]|0;b=c[h+(f*244|0)+240>>2]|0;c[r+(p*152|0)+144>>2]=e;c[r+(p*152|0)+148>>2]=f;v=+g[j+84>>2];g[r+(p*152|0)+104>>2]=v;c[r+(p*152|0)+132>>2]=0;g[r+(p*152|0)+100>>2]=0.0;g[r+(p*152|0)+96>>2]=0.0;if((x|0)!=0){c[r+(p*152|0)+16>>2]=c[d+0>>2];c[r+(p*152|0)+20>>2]=c[d+4>>2];c[r+(p*152|0)+24>>2]=c[d+8>>2];c[r+(p*152|0)+28>>2]=c[d+12>>2];B=+g[k+4>>2];C=+g[r+(p*152|0)+24>>2];D=+g[k+8>>2];w=+g[r+(p*152|0)+20>>2];y=+g[r+(p*152|0)+16>>2];u=+g[k>>2];g[r+(p*152|0)>>2]=B*C-D*w;g[r+(p*152|0)+4>>2]=D*y-C*u;g[r+(p*152|0)+8>>2]=w*u-B*y;g[r+(p*152|0)+12>>2]=0.0;z=((B*C-D*w)*+g[x+280>>2]+(D*y-C*u)*+g[x+284>>2]+(w*u-B*y)*+g[x+288>>2])*+g[x+548>>2];A=((B*C-D*w)*+g[x+296>>2]+(D*y-C*u)*+g[x+300>>2]+(w*u-B*y)*+g[x+304>>2])*+g[x+552>>2];g[r+(p*152|0)+64>>2]=((B*C-D*w)*+g[x+264>>2]+ +g[x+268>>2]*(D*y-C*u)+(w*u-B*y)*+g[x+272>>2])*+g[x+544>>2];g[r+(p*152|0)+68>>2]=z;g[r+(p*152|0)+72>>2]=A;g[r+(p*152|0)+76>>2]=0.0;w=B*C-D*w}else{c[r+(p*152|0)+64>>2]=0;c[r+(p*152|0)+68>>2]=0;c[r+(p*152|0)+72>>2]=0;c[r+(p*152|0)+76>>2]=0;c[r+(p*152|0)+0>>2]=0;c[r+(p*152|0)+4>>2]=0;c[r+(p*152|0)+8>>2]=0;c[r+(p*152|0)+12>>2]=0;c[r+(p*152|0)+16>>2]=0;c[r+(p*152|0)+20>>2]=0;c[r+(p*152|0)+24>>2]=0;c[r+(p*152|0)+28>>2]=0;w=0.0}if((b|0)!=0){u=-+g[d>>2];C=-+g[d+4>>2];s=-+g[d+8>>2];g[r+(p*152|0)+48>>2]=u;g[r+(p*152|0)+52>>2]=C;g[r+(p*152|0)+56>>2]=s;g[r+(p*152|0)+60>>2]=0.0;D=+g[l+4>>2];G=+g[l+8>>2];A=+g[l>>2];g[r+(p*152|0)+32>>2]=D*s-G*C;g[r+(p*152|0)+36>>2]=G*u-A*s;g[r+(p*152|0)+40>>2]=A*C-D*u;g[r+(p*152|0)+44>>2]=0.0;B=((D*s-G*C)*+g[b+264>>2]+ +g[b+268>>2]*(G*u-A*s)+(A*C-D*u)*+g[b+272>>2])*+g[b+544>>2];z=((D*s-G*C)*+g[b+280>>2]+(G*u-A*s)*+g[b+284>>2]+(A*C-D*u)*+g[b+288>>2])*+g[b+548>>2];y=((D*s-G*C)*+g[b+296>>2]+(G*u-A*s)*+g[b+300>>2]+(A*C-D*u)*+g[b+304>>2])*+g[b+552>>2];g[r+(p*152|0)+80>>2]=B;g[r+(p*152|0)+84>>2]=z;g[r+(p*152|0)+88>>2]=y;g[r+(p*152|0)+92>>2]=0.0;t=D*s-G*C;s=G*u-A*s;u=A*C-D*u}else{c[r+(p*152|0)+80>>2]=0;c[r+(p*152|0)+84>>2]=0;c[r+(p*152|0)+88>>2]=0;c[r+(p*152|0)+92>>2]=0;c[r+(p*152|0)+32>>2]=0;c[r+(p*152|0)+36>>2]=0;c[r+(p*152|0)+40>>2]=0;c[r+(p*152|0)+44>>2]=0;c[r+(p*152|0)+48>>2]=0;c[r+(p*152|0)+52>>2]=0;c[r+(p*152|0)+56>>2]=0;c[r+(p*152|0)+60>>2]=0;B=0.0;z=0.0;y=0.0;t=0.0;s=0.0;u=0.0}if((x|0)!=0){G=+g[r+(p*152|0)+68>>2];H=+g[k+8>>2];I=+g[r+(p*152|0)+72>>2];C=+g[k+4>>2];A=+g[k>>2];D=+g[r+(p*152|0)+64>>2];A=+g[x+344>>2]+((G*H-I*C)*+g[d>>2]+(I*A-H*D)*+g[d+4>>2]+(C*D-G*A)*+g[d+8>>2])}else A=0.0;if((b|0)!=0){H=-B;I=-z;C=-y;D=+g[l+8>>2];G=+g[l+4>>2];y=+g[l>>2];y=+g[b+344>>2]+((D*I-G*C)*+g[d>>2]+(y*C-D*H)*+g[d+4>>2]+(G*H-y*I)*+g[d+8>>2])}else y=0.0;m=m/(A+y);g[r+(p*152|0)+108>>2]=m;if((x|0)!=0){z=+g[h+(e*244|0)+176>>2]+ +g[h+(e*244|0)+208>>2];y=+g[h+(e*244|0)+180>>2]+ +g[h+(e*244|0)+212>>2];A=+g[h+(e*244|0)+184>>2]+ +g[h+(e*244|0)+216>>2]}else{z=0.0;y=0.0;A=0.0}if((x|0)!=0){B=+g[h+(e*244|0)+192>>2];C=+g[h+(e*244|0)+196>>2];D=+g[h+(e*244|0)+200>>2]}else{B=0.0;C=0.0;D=0.0}w=z*+g[r+(p*152|0)+16>>2]+y*+g[r+(p*152|0)+20>>2]+A*+g[r+(p*152|0)+24>>2]+(B*w+C*+g[r+(p*152|0)+4>>2]+D*+g[r+(p*152|0)+8>>2]);if((b|0)!=0){y=+g[h+(f*244|0)+176>>2]+ +g[h+(f*244|0)+208>>2];A=+g[h+(f*244|0)+180>>2]+ +g[h+(f*244|0)+212>>2];z=+g[h+(f*244|0)+184>>2]+ +g[h+(f*244|0)+216>>2]}else{y=0.0;A=0.0;z=0.0}y=y*+g[r+(p*152|0)+48>>2]+A*+g[r+(p*152|0)+52>>2]+z*+g[r+(p*152|0)+56>>2];if((b|0)==0){G=0.0;H=0.0;I=0.0;G=G*t;H=H*s;H=G+H;I=I*u;I=H+I;I=y+I;I=w+I;I=n-I;I=m*I;F=r+(p*152|0)+112|0;g[F>>2]=I;F=r+(p*152|0)+116|0;g[F>>2]=o;I=-v;F=r+(p*152|0)+120|0;g[F>>2]=I;F=r+(p*152|0)+124|0;g[F>>2]=v;i=q;return}G=+g[h+(f*244|0)+192>>2];H=+g[h+(f*244|0)+196>>2];I=+g[h+(f*244|0)+200>>2];G=G*t;H=H*s;H=G+H;I=I*u;I=H+I;I=y+I;I=w+I;I=n-I;I=m*I;F=r+(p*152|0)+112|0;g[F>>2]=I;F=r+(p*152|0)+116|0;g[F>>2]=o;I=-v;F=r+(p*152|0)+120|0;g[F>>2]=I;F=r+(p*152|0)+124|0;g[F>>2]=v;i=q;return}function rr(b,d,e,f,h,j){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;var k=0,l=0,m=0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0,C=0;l=i;k=c[b+88>>2]|0;if((k|0)==(c[b+92>>2]|0)?(m=(k|0)==0?1:k<<1,(k|0)<(m|0)):0){if((m|0)==0){u=0;B=k}else{c[5004]=(c[5004]|0)+1;u=XE((m*152|3)+16|0)|0;if((u|0)==0)u=0;else{c[(u+19&-16)+ -4>>2]=u;u=u+19&-16}B=c[b+88>>2]|0}if((B|0)>0){C=0;do{cF(u+(C*152|0)|0,(c[b+96>>2]|0)+(C*152|0)|0,152)|0;C=C+1|0}while((C|0)!=(B|0))}B=c[b+96>>2]|0;if((B|0)!=0){if((a[b+100>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[B+ -4>>2]|0)}c[b+96>>2]=0}a[b+100>>0]=1;c[b+96>>2]=u;c[b+92>>2]=m;m=c[b+88>>2]|0}else m=k;c[b+88>>2]=m+1;m=c[b+96>>2]|0;c[m+(k*152|0)+140>>2]=h;c[m+(k*152|0)+16>>2]=0;c[m+(k*152|0)+20>>2]=0;c[m+(k*152|0)+24>>2]=0;c[m+(k*152|0)+28>>2]=0;g[m+(k*152|0)+48>>2]=-0.0;g[m+(k*152|0)+52>>2]=-0.0;g[m+(k*152|0)+56>>2]=-0.0;g[m+(k*152|0)+60>>2]=0.0;b=c[b+16>>2]|0;u=c[b+(e*244|0)+240>>2]|0;h=c[b+(f*244|0)+240>>2]|0;c[m+(k*152|0)+144>>2]=e;c[m+(k*152|0)+148>>2]=f;n=+g[j+88>>2];g[m+(k*152|0)+104>>2]=n;c[m+(k*152|0)+132>>2]=0;g[m+(k*152|0)+100>>2]=0.0;g[m+(k*152|0)+96>>2]=0.0;o=-+g[d>>2];p=-+g[d+4>>2];q=-+g[d+8>>2];g[m+(k*152|0)>>2]=o;g[m+(k*152|0)+4>>2]=p;g[m+(k*152|0)+8>>2]=q;g[m+(k*152|0)+12>>2]=0.0;if((u|0)!=0){s=(+g[u+264>>2]*o+ +g[u+268>>2]*p+ +g[u+272>>2]*q)*+g[u+544>>2];r=(+g[u+280>>2]*o+ +g[u+284>>2]*p+ +g[u+288>>2]*q)*+g[u+548>>2];t=(+g[u+296>>2]*o+ +g[u+300>>2]*p+ +g[u+304>>2]*q)*+g[u+552>>2]}else{s=0.0;r=0.0;t=0.0}g[m+(k*152|0)+64>>2]=s;g[m+(k*152|0)+68>>2]=r;g[m+(k*152|0)+72>>2]=t;g[m+(k*152|0)+76>>2]=0.0;t=+g[d>>2];s=+g[d+4>>2];r=+g[d+8>>2];A=+g[d+12>>2];g[m+(k*152|0)+32>>2]=t;g[m+(k*152|0)+36>>2]=s;g[m+(k*152|0)+40>>2]=r;g[m+(k*152|0)+44>>2]=A;if((h|0)!=0){w=(t*+g[h+264>>2]+s*+g[h+268>>2]+r*+g[h+272>>2])*+g[h+544>>2];v=(t*+g[h+280>>2]+s*+g[h+284>>2]+r*+g[h+288>>2])*+g[h+548>>2];x=(t*+g[h+296>>2]+s*+g[h+300>>2]+r*+g[h+304>>2])*+g[h+552>>2]}else{w=0.0;v=0.0;x=0.0}g[m+(k*152|0)+80>>2]=w;g[m+(k*152|0)+84>>2]=v;g[m+(k*152|0)+88>>2]=x;g[m+(k*152|0)+92>>2]=0.0;if((u|0)!=0){A=+g[u+264>>2]*o+ +g[u+268>>2]*p+ +g[u+272>>2]*q;z=+g[u+280>>2]*o+ +g[u+284>>2]*p+ +g[u+288>>2]*q;w=+g[u+296>>2]*o+ +g[u+300>>2]*p+ +g[u+304>>2]*q}else{A=0.0;z=0.0;w=0.0}if((h|0)!=0){v=+g[h+264>>2]*t+ +g[h+268>>2]*s+ +g[h+272>>2]*r;y=t*+g[h+280>>2]+s*+g[h+284>>2]+r*+g[h+288>>2];x=t*+g[h+296>>2]+s*+g[h+300>>2]+r*+g[h+304>>2]}else{v=0.0;y=0.0;x=0.0}v=1.0/(A*o+z*p+w*q+0.0+(v*t+y*s+x*r));g[m+(k*152|0)+108>>2]=v;if((u|0)!=0){y=+g[b+(e*244|0)+192>>2];x=+g[b+(e*244|0)+196>>2];w=+g[b+(e*244|0)+200>>2];z=(+g[b+(e*244|0)+176>>2]+ +g[b+(e*244|0)+208>>2])*0.0+(+g[b+(e*244|0)+180>>2]+ +g[b+(e*244|0)+212>>2])*0.0+(+g[b+(e*244|0)+184>>2]+ +g[b+(e*244|0)+216>>2])*0.0}else{y=0.0;x=0.0;w=0.0;z=0.0}o=z+(y*o+x*p+w*q);if((h|0)==0){x=0.0;y=0.0;A=0.0;z=-0.0;x=x*t;y=y*s;y=x+y;A=A*r;A=y+A;A=z+A;A=o+A;A=0.0-A;A=v*A;C=m+(k*152|0)+112|0;g[C>>2]=A;C=m+(k*152|0)+116|0;g[C>>2]=0.0;A=-n;C=m+(k*152|0)+120|0;g[C>>2]=A;C=m+(k*152|0)+124|0;g[C>>2]=n;i=l;return}x=+g[b+(f*244|0)+192>>2];y=+g[b+(f*244|0)+196>>2];A=+g[b+(f*244|0)+200>>2];z=(+g[b+(f*244|0)+176>>2]+ +g[b+(f*244|0)+208>>2])*-0.0+(+g[b+(f*244|0)+180>>2]+ +g[b+(f*244|0)+212>>2])*-0.0+(+g[b+(f*244|0)+184>>2]+ +g[b+(f*244|0)+216>>2])*-0.0;x=x*t;y=y*s;y=x+y;A=A*r;A=y+A;A=z+A;A=o+A;A=0.0-A;A=v*A;C=m+(k*152|0)+112|0;g[C>>2]=A;C=m+(k*152|0)+116|0;g[C>>2]=0.0;A=-n;C=m+(k*152|0)+120|0;g[C>>2]=A;C=m+(k*152|0)+124|0;g[C>>2]=n;i=l;return}function sr(a,b,d){a=a|0;b=b|0;d=+d;var e=0,f=0;e=i;i=i+496|0;f=c[b+212>>2]|0;if((f|0)>-1){b=f;i=e;return b|0}do if((c[b+236>>2]&2|0)!=0){if(!(+g[b+344>>2]!=0.0)?(c[b+204>>2]&2|0)==0:0)break;f=c[a+8>>2]|0;$E(e+244|0,0,244)|0;or(tr(a+4|0,e+244|0)|0,b,d);c[b+212>>2]=f;b=f;i=e;return b|0}while(0);f=c[a+188>>2]|0;if((f|0)>=0){b=f;i=e;return b|0}c[a+188>>2]=c[a+8>>2];$E(e|0,0,244)|0;or(tr(a+4|0,e)|0,0,d);b=c[a+188>>2]|0;i=e;return b|0}function tr(b,d){b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0;e=i;f=c[b+4>>2]|0;if((f|0)==(c[b+8>>2]|0)?(g=(f|0)==0?1:f<<1,(f|0)<(g|0)):0){if((g|0)==0){h=0;j=f}else{c[5004]=(c[5004]|0)+1;h=XE((g*244|3)+16|0)|0;if((h|0)==0)h=0;else{c[(h+19&-16)+ -4>>2]=h;h=h+19&-16}j=c[b+4>>2]|0}if((j|0)>0){k=0;do{m=h+(k*244|0)|0;l=c[b+12>>2]|0;n=l+(k*244|0)|0;c[m+0>>2]=c[n+0>>2];c[m+4>>2]=c[n+4>>2];c[m+8>>2]=c[n+8>>2];c[m+12>>2]=c[n+12>>2];m=h+(k*244|0)+16|0;n=l+(k*244|0)+16|0;c[m+0>>2]=c[n+0>>2];c[m+4>>2]=c[n+4>>2];c[m+8>>2]=c[n+8>>2];c[m+12>>2]=c[n+12>>2];m=h+(k*244|0)+32|0;n=l+(k*244|0)+32|0;c[m+0>>2]=c[n+0>>2];c[m+4>>2]=c[n+4>>2];c[m+8>>2]=c[n+8>>2];c[m+12>>2]=c[n+12>>2];m=h+(k*244|0)+48|0;n=l+(k*244|0)+48|0;c[m+0>>2]=c[n+0>>2];c[m+4>>2]=c[n+4>>2];c[m+8>>2]=c[n+8>>2];c[m+12>>2]=c[n+12>>2];cF(h+(k*244|0)+64|0,l+(k*244|0)+64|0,180)|0;k=k+1|0}while((k|0)!=(j|0))}j=c[b+12>>2]|0;if((j|0)!=0){if((a[b+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0)}c[b+12>>2]=0}a[b+16>>0]=1;c[b+12>>2]=h;c[b+8>>2]=g;g=c[b+4>>2]|0}else g=f;c[b+4>>2]=g+1;n=c[b+12>>2]|0;c[n+(f*244|0)+0>>2]=c[d+0>>2];c[n+(f*244|0)+4>>2]=c[d+4>>2];c[n+(f*244|0)+8>>2]=c[d+8>>2];c[n+(f*244|0)+12>>2]=c[d+12>>2];c[n+(f*244|0)+16>>2]=c[d+16>>2];c[n+(f*244|0)+20>>2]=c[d+20>>2];c[n+(f*244|0)+24>>2]=c[d+24>>2];c[n+(f*244|0)+28>>2]=c[d+28>>2];c[n+(f*244|0)+32>>2]=c[d+32>>2];c[n+(f*244|0)+36>>2]=c[d+36>>2];c[n+(f*244|0)+40>>2]=c[d+40>>2];c[n+(f*244|0)+44>>2]=c[d+44>>2];c[n+(f*244|0)+48>>2]=c[d+48>>2];c[n+(f*244|0)+52>>2]=c[d+52>>2];c[n+(f*244|0)+56>>2]=c[d+56>>2];c[n+(f*244|0)+60>>2]=c[d+60>>2];cF(n+(f*244|0)+64|0,d+64|0,180)|0;i=e;return(c[b+12>>2]|0)+(f*244|0)|0}function ur(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0.0,x=0,y=0,z=0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0,G=0,H=0,I=0,J=0.0,K=0,L=0.0,M=0.0,N=0.0,O=0,R=0,S=0.0,T=0.0,U=0.0,V=0.0,W=0.0,X=0.0,Y=0.0,Z=0.0,_=0.0,$=0.0,aa=0.0,ba=0.0,ca=0.0;r=i;i=i+80|0;if((e|0)<=0){i=r;return}k=0;do{l=c[d+(k<<2)>>2]|0;h=c[l+740>>2]|0;q=c[l+744>>2]|0;m=sr(b,h,+g[f+12>>2])|0;n=sr(b,q,+g[f+12>>2])|0;o=c[b+16>>2]|0;do if((o+(m*244|0)|0)!=0){if((+g[o+(m*244|0)+128>>2]==0.0?+g[o+(m*244|0)+132>>2]==0.0:0)?+g[o+(m*244|0)+136>>2]==0.0:0){if((o+(n*244|0)|0)==0)break;if((+g[o+(n*244|0)+128>>2]==0.0?+g[o+(n*244|0)+132>>2]==0.0:0)?+g[o+(n*244|0)+136>>2]==0.0:0)break}t=c[l+748>>2]|0;if((t|0)>0){s=0;F=1;do{u=l+(s*184|0)+4|0;K=l+(s*184|0)+84|0;if(+g[K>>2]<=+g[l+756>>2]){t=c[b+28>>2]|0;if((t|0)==(c[b+32>>2]|0)?(p=(t|0)==0?1:t<<1,(t|0)<(p|0)):0){if((p|0)==0){v=0;y=t}else{c[5004]=(c[5004]|0)+1;v=XE((p*152|3)+16|0)|0;if((v|0)==0)v=0;else{c[(v+19&-16)+ -4>>2]=v;v=v+19&-16}y=c[b+28>>2]|0}if((y|0)>0){x=0;do{cF(v+(x*152|0)|0,(c[b+36>>2]|0)+(x*152|0)|0,152)|0;x=x+1|0}while((x|0)!=(y|0))}x=c[b+36>>2]|0;if((x|0)!=0){if((a[b+40>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[x+ -4>>2]|0)}c[b+36>>2]=0}a[b+40>>0]=1;c[b+36>>2]=v;c[b+32>>2]=p;v=c[b+28>>2]|0}else v=t;c[b+28>>2]=v+1;v=c[b+36>>2]|0;H=(c[h+236>>2]&2|0)==0?0:h;G=(c[q+236>>2]&2|0)==0?0:q;c[v+(t*152|0)+144>>2]=m;c[v+(t*152|0)+148>>2]=n;c[v+(t*152|0)+132>>2]=u;S=+g[l+(s*184|0)+52>>2]- +g[h+52>>2];T=+g[l+(s*184|0)+56>>2]- +g[h+56>>2];U=+g[l+(s*184|0)+60>>2]- +g[h+60>>2];g[r+64>>2]=S;g[r+68>>2]=T;g[r+72>>2]=U;g[r+76>>2]=0.0;L=+g[l+(s*184|0)+36>>2]- +g[q+52>>2];M=+g[l+(s*184|0)+40>>2]- +g[q+56>>2];N=+g[l+(s*184|0)+44>>2]- +g[q+60>>2];g[r+48>>2]=L;g[r+52>>2]=M;g[r+56>>2]=N;g[r+60>>2]=0.0;if((c[o+(m*244|0)+240>>2]|0)==0){w=0.0;D=0.0;C=0.0}else{aa=+g[o+(m*244|0)+192>>2]+ +g[o+(m*244|0)+224>>2];C=+g[o+(m*244|0)+196>>2]+ +g[o+(m*244|0)+228>>2];D=+g[o+(m*244|0)+200>>2]+ +g[o+(m*244|0)+232>>2];w=+g[o+(m*244|0)+176>>2]+ +g[o+(m*244|0)+208>>2]+(C*U-D*T);D=+g[o+(m*244|0)+180>>2]+ +g[o+(m*244|0)+212>>2]+(D*S-aa*U);C=+g[o+(m*244|0)+184>>2]+ +g[o+(m*244|0)+216>>2]+(aa*T-C*S)}if((c[o+(n*244|0)+240>>2]|0)==0){E=0.0;A=0.0;B=0.0}else{aa=+g[o+(n*244|0)+192>>2]+ +g[o+(n*244|0)+224>>2];B=+g[o+(n*244|0)+196>>2]+ +g[o+(n*244|0)+228>>2];A=+g[o+(n*244|0)+200>>2]+ +g[o+(n*244|0)+232>>2];E=+g[o+(n*244|0)+176>>2]+ +g[o+(n*244|0)+208>>2]+(B*N-A*M);A=+g[o+(n*244|0)+180>>2]+ +g[o+(n*244|0)+212>>2]+(A*L-aa*N);B=+g[o+(n*244|0)+184>>2]+ +g[o+(n*244|0)+216>>2]+(aa*M-B*L)}w=w-E;A=D-A;D=C-B;y=l+(s*184|0)+68|0;C=+g[y>>2];z=l+(s*184|0)+72|0;B=+g[z>>2];x=l+(s*184|0)+76|0;E=+g[x>>2];I=c[b+16>>2]|0;R=c[I+(m*244|0)+240>>2]|0;O=c[I+(n*244|0)+240>>2]|0;if((R|0)!=0){_=((T*E-U*B)*+g[R+264>>2]+(U*C-E*S)*+g[R+268>>2]+(B*S-T*C)*+g[R+272>>2])*+g[R+544>>2];aa=((T*E-U*B)*+g[R+280>>2]+(U*C-E*S)*+g[R+284>>2]+(B*S-T*C)*+g[R+288>>2])*+g[R+548>>2];$=((T*E-U*B)*+g[R+296>>2]+(U*C-E*S)*+g[R+300>>2]+(B*S-T*C)*+g[R+304>>2])*+g[R+552>>2]}else{_=0.0;aa=0.0;$=0.0}g[v+(t*152|0)+64>>2]=_;g[v+(t*152|0)+68>>2]=aa;g[v+(t*152|0)+72>>2]=$;g[v+(t*152|0)+76>>2]=0.0;W=+g[x>>2];V=+g[z>>2];J=+g[y>>2];if((O|0)!=0){X=(+g[O+264>>2]*-(M*W-N*V)+ +g[O+268>>2]*-(N*J-W*L)+ +g[O+272>>2]*-(V*L-M*J))*+g[O+544>>2];Y=(+g[O+280>>2]*-(M*W-N*V)+ +g[O+284>>2]*-(N*J-W*L)+ +g[O+288>>2]*-(V*L-M*J))*+g[O+548>>2];Z=(+g[O+296>>2]*-(M*W-N*V)+ +g[O+300>>2]*-(N*J-W*L)+ +g[O+304>>2]*-(V*L-M*J))*+g[O+552>>2]}else{X=0.0;Y=0.0;Z=0.0}g[v+(t*152|0)+80>>2]=X;g[v+(t*152|0)+84>>2]=Y;g[v+(t*152|0)+88>>2]=Z;g[v+(t*152|0)+92>>2]=0.0;if((R|0)!=0)_=+g[R+344>>2]+((aa*U-$*T)*+g[y>>2]+($*S-U*_)*+g[z>>2]+(T*_-aa*S)*+g[x>>2]);else _=0.0;if((O|0)!=0){aa=-X;X=-Y;$=-Z;X=+g[O+344>>2]+((N*X-M*$)*+g[y>>2]+(L*$-N*aa)*+g[z>>2]+(M*aa-L*X)*+g[x>>2])}else X=0.0;g[v+(t*152|0)+108>>2]=1.0/(_+X);if((R|0)!=0){c[v+(t*152|0)+16>>2]=c[y+0>>2];c[v+(t*152|0)+20>>2]=c[y+4>>2];c[v+(t*152|0)+24>>2]=c[y+8>>2];c[v+(t*152|0)+28>>2]=c[y+12>>2];g[v+(t*152|0)>>2]=T*E-U*B;g[v+(t*152|0)+4>>2]=U*C-E*S;g[v+(t*152|0)+8>>2]=B*S-T*C;g[v+(t*152|0)+12>>2]=0.0}else{c[v+(t*152|0)+0>>2]=0;c[v+(t*152|0)+4>>2]=0;c[v+(t*152|0)+8>>2]=0;c[v+(t*152|0)+12>>2]=0;c[v+(t*152|0)+16>>2]=0;c[v+(t*152|0)+20>>2]=0;c[v+(t*152|0)+24>>2]=0;c[v+(t*152|0)+28>>2]=0}if((O|0)!=0){$=-+g[z>>2];aa=-+g[x>>2];g[v+(t*152|0)+48>>2]=-+g[y>>2];g[v+(t*152|0)+52>>2]=$;g[v+(t*152|0)+56>>2]=aa;g[v+(t*152|0)+60>>2]=0.0;g[v+(t*152|0)+32>>2]=-(M*W-N*V);g[v+(t*152|0)+36>>2]=-(N*J-W*L);g[v+(t*152|0)+40>>2]=-(V*L-M*J);g[v+(t*152|0)+44>>2]=0.0}else{c[v+(t*152|0)+32>>2]=0;c[v+(t*152|0)+36>>2]=0;c[v+(t*152|0)+40>>2]=0;c[v+(t*152|0)+44>>2]=0;c[v+(t*152|0)+48>>2]=0;c[v+(t*152|0)+52>>2]=0;c[v+(t*152|0)+56>>2]=0;c[v+(t*152|0)+60>>2]=0}J=+g[K>>2]+ +g[f+56>>2];if((R|0)!=0){aa=+g[R+332>>2];_=+g[R+336>>2];$=+g[R+328>>2];V=aa*U-_*T+ +g[R+312>>2];U=+g[R+316>>2]+(_*S-U*$);T=T*$-aa*S+ +g[R+320>>2]}else{V=0.0;U=0.0;T=0.0}if((O|0)!=0){aa=+g[O+332>>2];_=+g[O+336>>2];$=+g[O+328>>2];S=aa*N-_*M+ +g[O+312>>2];N=+g[O+316>>2]+(_*L-N*$);L=M*$-aa*L+ +g[O+320>>2]}else{S=0.0;N=0.0;L=0.0}L=+g[y>>2]*(V-S)+(U-N)*+g[z>>2]+(T-L)*+g[x>>2];g[v+(t*152|0)+104>>2]=+g[l+(s*184|0)+88>>2];L=L*+g[l+(s*184|0)+96>>2];L=!(L>=-0.0)?-L:0.0;do if((c[f+64>>2]&4|0)==0)g[v+(t*152|0)+100>>2]=0.0;else{M=+g[l+(s*184|0)+124>>2]*+g[f+60>>2];g[v+(t*152|0)+100>>2]=M;do if((R|0)!=0){if((c[I+(m*244|0)+240>>2]|0)==0)break;aa=M*+g[I+(m*244|0)+132>>2]*+g[v+(t*152|0)+20>>2]*+g[R+352>>2]*+g[I+(m*244|0)+116>>2];$=M*+g[I+(m*244|0)+136>>2]*+g[v+(t*152|0)+24>>2]*+g[R+356>>2]*+g[I+(m*244|0)+120>>2];g[I+(m*244|0)+64>>2]=+g[I+(m*244|0)+112>>2]*M*+g[I+(m*244|0)+128>>2]*+g[v+(t*152|0)+16>>2]*+g[R+348>>2]+ +g[I+(m*244|0)+64>>2];g[I+(m*244|0)+68>>2]=aa+ +g[I+(m*244|0)+68>>2];g[I+(m*244|0)+72>>2]=$+ +g[I+(m*244|0)+72>>2];$=M*+g[I+(m*244|0)+100>>2]*+g[v+(t*152|0)+68>>2];aa=M*+g[I+(m*244|0)+104>>2]*+g[v+(t*152|0)+72>>2];g[I+(m*244|0)+80>>2]=M*+g[I+(m*244|0)+96>>2]*+g[v+(t*152|0)+64>>2]+ +g[I+(m*244|0)+80>>2];g[I+(m*244|0)+84>>2]=$+ +g[I+(m*244|0)+84>>2];g[I+(m*244|0)+88>>2]=aa+ +g[I+(m*244|0)+88>>2]}while(0);if((O|0)==0)break;M=+g[v+(t*152|0)+100>>2];if((c[I+(n*244|0)+240>>2]|0)==0)break;aa=+g[v+(t*152|0)+88>>2];$=+g[v+(t*152|0)+84>>2];_=+g[v+(t*152|0)+80>>2];Y=M*+g[I+(n*244|0)+132>>2]*+g[v+(t*152|0)+52>>2]*+g[O+352>>2]*+g[I+(n*244|0)+116>>2];Z=M*+g[I+(n*244|0)+136>>2]*+g[v+(t*152|0)+56>>2]*+g[O+356>>2]*+g[I+(n*244|0)+120>>2];g[I+(n*244|0)+64>>2]=+g[I+(n*244|0)+112>>2]*M*+g[I+(n*244|0)+128>>2]*+g[v+(t*152|0)+48>>2]*+g[O+348>>2]+ +g[I+(n*244|0)+64>>2];g[I+(n*244|0)+68>>2]=Y+ +g[I+(n*244|0)+68>>2];g[I+(n*244|0)+72>>2]=Z+ +g[I+(n*244|0)+72>>2];$=$*+g[I+(n*244|0)+100>>2]*-M;aa=aa*+g[I+(n*244|0)+104>>2]*-M;g[I+(n*244|0)+80>>2]=+g[I+(n*244|0)+80>>2]-_*+g[I+(n*244|0)+96>>2]*-M;g[I+(n*244|0)+84>>2]=+g[I+(n*244|0)+84>>2]-$;g[I+(n*244|0)+88>>2]=+g[I+(n*244|0)+88>>2]-aa}while(0);g[v+(t*152|0)+96>>2]=0.0;if((c[I+(m*244|0)+240>>2]|0)==0){$=0.0;_=0.0;Z=0.0;M=0.0;X=0.0;W=0.0}else{$=+g[I+(m*244|0)+208>>2];_=+g[I+(m*244|0)+212>>2];Z=+g[I+(m*244|0)+216>>2];M=+g[I+(m*244|0)+224>>2];X=+g[I+(m*244|0)+228>>2];W=+g[I+(m*244|0)+232>>2]}if((c[I+(n*244|0)+240>>2]|0)==0){S=0.0;Y=0.0;N=0.0;T=0.0;U=0.0;V=0.0}else{S=+g[I+(n*244|0)+208>>2];Y=+g[I+(n*244|0)+212>>2];N=+g[I+(n*244|0)+216>>2];T=+g[I+(n*244|0)+224>>2];U=+g[I+(n*244|0)+228>>2];V=+g[I+(n*244|0)+232>>2]}L=L-(($+ +g[I+(m*244|0)+176>>2])*+g[v+(t*152|0)+16>>2]+(_+ +g[I+(m*244|0)+180>>2])*+g[v+(t*152|0)+20>>2]+(Z+ +g[I+(m*244|0)+184>>2])*+g[v+(t*152|0)+24>>2]+((M+ +g[I+(m*244|0)+192>>2])*+g[v+(t*152|0)>>2]+(X+ +g[I+(m*244|0)+196>>2])*+g[v+(t*152|0)+4>>2]+(W+ +g[I+(m*244|0)+200>>2])*+g[v+(t*152|0)+8>>2])+((S+ +g[I+(n*244|0)+176>>2])*+g[v+(t*152|0)+48>>2]+(Y+ +g[I+(n*244|0)+180>>2])*+g[v+(t*152|0)+52>>2]+(N+ +g[I+(n*244|0)+184>>2])*+g[v+(t*152|0)+56>>2]+((T+ +g[I+(n*244|0)+192>>2])*+g[v+(t*152|0)+32>>2]+(U+ +g[I+(n*244|0)+196>>2])*+g[v+(t*152|0)+36>>2]+(V+ +g[I+(n*244|0)+200>>2])*+g[v+(t*152|0)+40>>2])));I=(c[f+44>>2]|0)==0;if(!I?!(J>+g[f+48>>2]):0)K=f+36|0;else K=f+32|0;if(J>0.0){M=0.0;L=L-J/+g[f+12>>2]}else M=-(J*+g[K>>2])/+g[f+12>>2];aa=+g[v+(t*152|0)+108>>2];M=M*aa;L=L*aa;do if(I)j=69;else{if(J>+g[f+48>>2]){j=69;break}g[v+(t*152|0)+112>>2]=L;g[v+(t*152|0)+128>>2]=M}while(0);if((j|0)==69){j=0;g[v+(t*152|0)+112>>2]=M+L;g[v+(t*152|0)+128>>2]=0.0}g[v+(t*152|0)+116>>2]=0.0;g[v+(t*152|0)+120>>2]=0.0;g[v+(t*152|0)+124>>2]=1.0e10;c[v+(t*152|0)+140>>2]=c[b+68>>2];if((H|0)==0){J=0.0;M=0.0;L=0.0}else{J=+g[H+328>>2];M=+g[H+332>>2];L=+g[H+336>>2]}if((G|0)==0){T=0.0;S=0.0;N=0.0}else{T=+g[G+328>>2];S=+g[G+332>>2];N=+g[G+336>>2]}J=T-J;M=S-M;L=N-L;g[r+32>>2]=J;g[r+36>>2]=M;g[r+40>>2]=L;g[r+44>>2]=0.0;do if((F|0)>0?+g[l+(s*184|0)+92>>2]>0.0:0){F=F+ -1|0;S=+Q(+(J*J+M*M+L*L));if(S>+g[f+80>>2]){N=J*(1.0/S);g[r+32>>2]=N;J=M*(1.0/S);g[r+36>>2]=J;L=L*(1.0/S);g[r+40>>2]=L;do if((h|0)!=0){if((c[h+180>>2]&2|0)==0)break;S=+g[h+4>>2];V=+g[h+20>>2];Y=+g[h+36>>2];T=+g[h+8>>2];W=+g[h+24>>2];_=+g[h+40>>2];U=+g[h+12>>2];X=+g[h+28>>2];aa=+g[h+44>>2];Z=(S*N+V*J+L*Y)*+g[h+164>>2];$=(N*T+J*W+L*_)*+g[h+168>>2];L=(N*U+J*X+L*aa)*+g[h+172>>2];g[r+32>>2]=S*Z+T*$+U*L;g[r+36>>2]=V*Z+W*$+X*L;g[r+40>>2]=Y*Z+_*$+aa*L;g[r+44>>2]=0.0;N=S*Z+T*$+U*L;J=V*Z+W*$+X*L;L=Y*Z+_*$+aa*L}while(0);do if((q|0)!=0){if((c[q+180>>2]&2|0)==0)break;S=+g[q+4>>2];V=+g[q+20>>2];Y=+g[q+36>>2];T=+g[q+8>>2];W=+g[q+24>>2];_=+g[q+40>>2];U=+g[q+12>>2];X=+g[q+28>>2];aa=+g[q+44>>2];Z=(S*N+V*J+Y*L)*+g[q+164>>2];$=(N*T+J*W+L*_)*+g[q+168>>2];L=(N*U+J*X+L*aa)*+g[q+172>>2];g[r+32>>2]=S*Z+T*$+U*L;g[r+36>>2]=V*Z+W*$+X*L;g[r+40>>2]=Y*Z+_*$+aa*L;g[r+44>>2]=0.0;N=S*Z+T*$+U*L;J=V*Z+W*$+X*L;L=Y*Z+_*$+aa*L}while(0);if(!(+Q(+(N*N+J*J+L*L))>.001))break;rr(b,r+32|0,m,n,t,u);break}rr(b,y,m,n,t,u);L=+g[x>>2];if(+P(+L)>.7071067690849304){M=+g[z>>2];aa=1.0/+Q(+(L*L+M*M));g[r+16>>2]=0.0;g[r+20>>2]=-(aa*L);g[r+24>>2]=aa*M;g[r>>2]=(L*L+M*M)*aa;$=+g[y>>2];g[r+4>>2]=-($*aa*M);J=0.0;S=-(aa*L);T=aa*M;N=(L*L+M*M)*aa;M=-($*aa*M);L=$*-(aa*L)}else{_=+g[y>>2];$=+g[z>>2];aa=1.0/+Q(+(_*_+$*$));g[r+16>>2]=-($*aa);g[r+20>>2]=aa*_;g[r+24>>2]=0.0;g[r>>2]=-(L*aa*_);g[r+4>>2]=L*-($*aa);J=-($*aa);S=aa*_;T=0.0;N=-(L*aa*_);M=L*-($*aa);L=(_*_+$*$)*aa}g[r+8>>2]=L;do if((h|0)!=0){if((c[h+180>>2]&2|0)==0)break;ca=+g[h+4>>2];V=+g[h+20>>2];Y=+g[h+36>>2];ba=+g[h+8>>2];W=+g[h+24>>2];_=+g[h+40>>2];U=+g[h+12>>2];X=+g[h+28>>2];aa=+g[h+44>>2];Z=(ca*J+V*S+Y*T)*+g[h+164>>2];$=(J*ba+S*W+T*_)*+g[h+168>>2];T=(J*U+S*X+T*aa)*+g[h+172>>2];g[r+16>>2]=ca*Z+ba*$+U*T;g[r+20>>2]=V*Z+W*$+X*T;g[r+24>>2]=Y*Z+_*$+aa*T;g[r+28>>2]=0.0;J=ca*Z+ba*$+U*T;S=V*Z+W*$+X*T;T=Y*Z+_*$+aa*T}while(0);do if((q|0)!=0){if((c[q+180>>2]&2|0)==0)break;U=+g[q+4>>2];X=+g[q+20>>2];_=+g[q+36>>2];V=+g[q+8>>2];Y=+g[q+24>>2];aa=+g[q+40>>2];W=+g[q+12>>2];Z=+g[q+28>>2];ca=+g[q+44>>2];$=(U*J+X*S+_*T)*+g[q+164>>2];ba=(J*V+S*Y+T*aa)*+g[q+168>>2];T=(J*W+S*Z+T*ca)*+g[q+172>>2];g[r+16>>2]=U*$+V*ba+W*T;g[r+20>>2]=X*$+Y*ba+Z*T;g[r+24>>2]=_*$+aa*ba+ca*T;g[r+28>>2]=0.0;J=U*$+V*ba+W*T;S=X*$+Y*ba+Z*T;T=_*$+aa*ba+ca*T}while(0);do if((h|0)!=0){if((c[h+180>>2]&2|0)==0)break;U=+g[h+4>>2];X=+g[h+20>>2];_=+g[h+36>>2];V=+g[h+8>>2];Y=+g[h+24>>2];aa=+g[h+40>>2];W=+g[h+12>>2];Z=+g[h+28>>2];ca=+g[h+44>>2];$=(U*N+X*M+_*L)*+g[h+164>>2];ba=(N*V+M*Y+L*aa)*+g[h+168>>2];L=(N*W+M*Z+L*ca)*+g[h+172>>2];g[r>>2]=U*$+V*ba+W*L;g[r+4>>2]=X*$+Y*ba+Z*L;g[r+8>>2]=_*$+aa*ba+ca*L;g[r+12>>2]=0.0;N=U*$+V*ba+W*L;M=X*$+Y*ba+Z*L;L=_*$+aa*ba+ca*L}while(0);do if((q|0)!=0){if((c[q+180>>2]&2|0)==0)break;U=+g[q+4>>2];X=+g[q+20>>2];_=+g[q+36>>2];V=+g[q+8>>2];Y=+g[q+24>>2];aa=+g[q+40>>2];W=+g[q+12>>2];Z=+g[q+28>>2];ca=+g[q+44>>2];$=(U*N+X*M+_*L)*+g[q+164>>2];ba=(N*V+M*Y+L*aa)*+g[q+168>>2];L=(N*W+M*Z+L*ca)*+g[q+172>>2];g[r>>2]=U*$+V*ba+W*L;g[r+4>>2]=X*$+Y*ba+Z*L;g[r+8>>2]=_*$+aa*ba+ca*L;g[r+12>>2]=0.0;N=U*$+V*ba+W*L;M=X*$+Y*ba+Z*L;L=_*$+aa*ba+ca*L}while(0);if(+Q(+(J*J+S*S+T*T))>.001)rr(b,r+16|0,m,n,t,u);if(!(+Q(+(N*N+M*M+L*L))>.001))break;rr(b,r,m,n,t,u)}while(0);do if((c[f+64>>2]&32|0)==0)j=106;else{if((a[l+(s*184|0)+120>>0]|0)==0){j=106;break}qr(b,l+(s*184|0)+156|0,m,n,t,u,r+64|0,r+48|0,1.0,+g[l+(s*184|0)+136>>2],+g[l+(s*184|0)+144>>2]);if((c[f+64>>2]&16|0)==0)break;qr(b,l+(s*184|0)+172|0,m,n,t,u,r+64|0,r+48|0,1.0,+g[l+(s*184|0)+140>>2],+g[l+(s*184|0)+148>>2])}while(0);do if((j|0)==106){j=0;G=l+(s*184|0)+156|0;J=+g[y>>2];L=+g[z>>2];M=+g[x>>2];S=w-(C*w+A*B+D*E)*J;N=A-(C*w+A*B+D*E)*L;w=D-(C*w+A*B+D*E)*M;g[l+(s*184|0)+156>>2]=S;I=l+(s*184|0)+160|0;g[I>>2]=N;H=l+(s*184|0)+164|0;g[H>>2]=w;g[l+(s*184|0)+168>>2]=0.0;if((c[f+64>>2]&64|0)==0?S*S+N*N+w*w>1.1920928955078125e-7:0){ca=1.0/+Q(+(S*S+N*N+w*w));g[G>>2]=S*ca;g[I>>2]=ca*N;g[H>>2]=ca*w;pr(h,G);pr(q,G);qr(b,G,m,n,t,u,r+64|0,r+48|0,1.0,0.0,0.0);if((c[f+64>>2]&16|0)==0)break;R=l+(s*184|0)+172|0;aa=+g[I>>2];Z=+g[x>>2];Y=+g[H>>2];_=+g[z>>2];ba=+g[y>>2];$=+g[G>>2];g[l+(s*184|0)+172>>2]=aa*Z-Y*_;g[l+(s*184|0)+184>>2]=0.0;ca=1.0/+Q(+((aa*Z-Y*_)*(aa*Z-Y*_)+(Y*ba-Z*$)*(Y*ba-Z*$)+(_*$-aa*ba)*(_*$-aa*ba)));g[R>>2]=(aa*Z-Y*_)*ca;g[l+(s*184|0)+176>>2]=(Y*ba-Z*$)*ca;g[l+(s*184|0)+180>>2]=(_*$-aa*ba)*ca;pr(h,R);pr(q,R);qr(b,R,m,n,t,u,r+64|0,r+48|0,1.0,0.0,0.0);break}x=l+(s*184|0)+172|0;if(+P(+M)>.7071067690849304){ca=1.0/+Q(+(M*M+L*L));g[G>>2]=0.0;g[I>>2]=-(ca*M);g[H>>2]=ca*L;g[x>>2]=(M*M+L*L)*ca;g[l+(s*184|0)+176>>2]=-(J*ca*L);g[l+(s*184|0)+180>>2]=J*-(ca*M)}else{ca=1.0/+Q(+(J*J+L*L));g[G>>2]=-(L*ca);g[I>>2]=ca*J;g[H>>2]=0.0;g[x>>2]=-(M*ca*J);g[l+(s*184|0)+176>>2]=M*-(L*ca);g[l+(s*184|0)+180>>2]=(J*J+L*L)*ca}pr(h,G);pr(q,G);qr(b,G,m,n,t,u,r+64|0,r+48|0,1.0,0.0,0.0);y=c[f+64>>2]|0;if((y&16|0)!=0){pr(h,x);pr(q,x);qr(b,x,m,n,t,u,r+64|0,r+48|0,1.0,0.0,0.0);y=c[f+64>>2]|0}if((y&80|0)!=80)break;a[l+(s*184|0)+120>>0]=1}while(0);u=c[b+16>>2]|0;y=c[u+(m*244|0)+240>>2]|0;x=c[u+(n*244|0)+240>>2]|0;v=c[v+(t*152|0)+140>>2]|0;t=c[b+76>>2]|0;z=c[f+64>>2]|0;do if((z&4|0)==0)g[t+(v*152|0)+100>>2]=0.0;else{w=+g[l+(s*184|0)+128>>2]*+g[f+60>>2];g[t+(v*152|0)+100>>2]=w;if((y|0)!=0){aa=+g[y+344>>2];ca=w*aa*+g[t+(v*152|0)+20>>2]*+g[y+352>>2]*+g[u+(m*244|0)+116>>2];ba=w*aa*+g[t+(v*152|0)+24>>2]*+g[y+356>>2]*+g[u+(m*244|0)+120>>2];g[u+(m*244|0)+64>>2]=+g[u+(m*244|0)+112>>2]*w*aa*+g[t+(v*152|0)+16>>2]*+g[y+348>>2]+ +g[u+(m*244|0)+64>>2];g[u+(m*244|0)+68>>2]=ca+ +g[u+(m*244|0)+68>>2];g[u+(m*244|0)+72>>2]=ba+ +g[u+(m*244|0)+72>>2];ba=w*+g[u+(m*244|0)+100>>2]*+g[t+(v*152|0)+68>>2];ca=w*+g[u+(m*244|0)+104>>2]*+g[t+(v*152|0)+72>>2];g[u+(m*244|0)+80>>2]=w*+g[u+(m*244|0)+96>>2]*+g[t+(v*152|0)+64>>2]+ +g[u+(m*244|0)+80>>2];g[u+(m*244|0)+84>>2]=ba+ +g[u+(m*244|0)+84>>2];g[u+(m*244|0)+88>>2]=ca+ +g[u+(m*244|0)+88>>2]}if((x|0)==0)break;A=+g[x+344>>2];w=+g[t+(v*152|0)+100>>2];if((c[u+(n*244|0)+240>>2]|0)==0)break;ca=+g[t+(v*152|0)+88>>2];ba=+g[t+(v*152|0)+84>>2];aa=+g[t+(v*152|0)+80>>2];_=w*A*+g[t+(v*152|0)+52>>2]*+g[x+352>>2]*+g[u+(n*244|0)+116>>2];$=w*A*+g[t+(v*152|0)+56>>2]*+g[x+356>>2]*+g[u+(n*244|0)+120>>2];g[u+(n*244|0)+64>>2]=+g[u+(n*244|0)+112>>2]*w*A*+g[t+(v*152|0)+48>>2]*+g[x+348>>2]+ +g[u+(n*244|0)+64>>2];g[u+(n*244|0)+68>>2]=_+ +g[u+(n*244|0)+68>>2];g[u+(n*244|0)+72>>2]=$+ +g[u+(n*244|0)+72>>2];ba=ba*+g[u+(n*244|0)+100>>2]*-w;ca=ca*+g[u+(n*244|0)+104>>2]*-w;g[u+(n*244|0)+80>>2]=+g[u+(n*244|0)+80>>2]-aa*+g[u+(n*244|0)+96>>2]*-w;g[u+(n*244|0)+84>>2]=+g[u+(n*244|0)+84>>2]-ba;g[u+(n*244|0)+88>>2]=+g[u+(n*244|0)+88>>2]-ca}while(0);do if((z&16|0)!=0){if((z&4|0)==0){g[t+((v+1|0)*152|0)+100>>2]=0.0;break}w=+g[l+(s*184|0)+132>>2]*+g[f+60>>2];g[t+((v+1|0)*152|0)+100>>2]=w;do if((y|0)!=0){A=+g[y+344>>2];if((c[u+(m*244|0)+240>>2]|0)==0)break;ca=w*A*+g[t+((v+1|0)*152|0)+20>>2]*+g[u+(m*244|0)+116>>2];ba=w*A*+g[t+((v+1|0)*152|0)+24>>2]*+g[u+(m*244|0)+120>>2];g[u+(m*244|0)+64>>2]=+g[u+(m*244|0)+112>>2]*w*A*+g[t+((v+1|0)*152|0)+16>>2]+ +g[u+(m*244|0)+64>>2];g[u+(m*244|0)+68>>2]=ca+ +g[u+(m*244|0)+68>>2];g[u+(m*244|0)+72>>2]=ba+ +g[u+(m*244|0)+72>>2];ba=w*+g[u+(m*244|0)+100>>2]*+g[t+((v+1|0)*152|0)+68>>2];ca=w*+g[u+(m*244|0)+104>>2]*+g[t+((v+1|0)*152|0)+72>>2];g[u+(m*244|0)+80>>2]=w*+g[u+(m*244|0)+96>>2]*+g[t+((v+1|0)*152|0)+64>>2]+ +g[u+(m*244|0)+80>>2];g[u+(m*244|0)+84>>2]=ba+ +g[u+(m*244|0)+84>>2];g[u+(m*244|0)+88>>2]=ca+ +g[u+(m*244|0)+88>>2]}while(0);if((x|0)==0)break;A=+g[x+344>>2];w=+g[t+((v+1|0)*152|0)+100>>2];if((c[u+(n*244|0)+240>>2]|0)==0)break;ca=+g[t+((v+1|0)*152|0)+88>>2];ba=+g[t+((v+1|0)*152|0)+84>>2];aa=+g[t+((v+1|0)*152|0)+80>>2];_=w*A*+g[t+((v+1|0)*152|0)+52>>2]*+g[u+(n*244|0)+116>>2];$=w*A*+g[t+((v+1|0)*152|0)+56>>2]*+g[u+(n*244|0)+120>>2];g[u+(n*244|0)+64>>2]=+g[u+(n*244|0)+112>>2]*w*A*+g[t+((v+1|0)*152|0)+48>>2]+ +g[u+(n*244|0)+64>>2];g[u+(n*244|0)+68>>2]=_+ +g[u+(n*244|0)+68>>2];g[u+(n*244|0)+72>>2]=$+ +g[u+(n*244|0)+72>>2];ba=ba*+g[u+(n*244|0)+100>>2]*-w;ca=ca*+g[u+(n*244|0)+104>>2]*-w;g[u+(n*244|0)+80>>2]=+g[u+(n*244|0)+80>>2]-aa*+g[u+(n*244|0)+96>>2]*-w;g[u+(n*244|0)+84>>2]=+g[u+(n*244|0)+84>>2]-ba;g[u+(n*244|0)+88>>2]=+g[u+(n*244|0)+88>>2]-ca}while(0);t=c[l+748>>2]|0}s=s+1|0}while((s|0)<(t|0))}}while(0);k=k+1|0}while((k|0)!=(e|0));i=r;return}



function qA(d,f){d=d|0;f=f|0;var h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0.0,A=0.0,B=0.0,C=0,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0.0,X=0.0,Y=0.0,Z=0.0,_=0,$=0,aa=0,ba=0.0,ca=0.0,da=0,ea=0;h=i;i=i+336|0;m=c[d+52>>2]|0;if((m|0)!=0?(Lb[c[c[m>>2]>>2]&511](m),j=c[d+52>>2]|0,(j|0)!=0):0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0)}c[5004]=(c[5004]|0)+1;j=XE(151)|0;if((j|0)==0)j=0;else{c[(j+19&-16)+ -4>>2]=j;j=j+19&-16}c[j>>2]=19496;a[j+20>>0]=1;c[j+16>>2]=0;c[j+8>>2]=0;c[j+12>>2]=0;a[j+40>>0]=1;c[j+36>>2]=0;c[j+28>>2]=0;c[j+32>>2]=0;a[j+60>>0]=1;c[j+56>>2]=0;c[j+48>>2]=0;c[j+52>>2]=0;c[d+52>>2]=j;s=0;m=0;v=0;j=0;while(1){if((s|0)>=(Pb[c[(c[d>>2]|0)+96>>2]&127](d)|0))break;if((m|0)==(v|0)){w=(v|0)==0?1:v<<1;if((v|0)<(w|0)){if((w|0)!=0?(c[5004]=(c[5004]|0)+1,p=XE((w<<4|3)+16|0)|0,(p|0)!=0):0){c[(p+19&-16)+ -4>>2]=p;u=p+19&-16}else u=0;if((v|0)>0){t=0;do{aa=u+(t<<4)|0;$=j+(t<<4)|0;c[aa+0>>2]=c[$+0>>2];c[aa+4>>2]=c[$+4>>2];c[aa+8>>2]=c[$+8>>2];c[aa+12>>2]=c[$+12>>2];t=t+1|0}while((t|0)!=(v|0))}if((j|0)==0){t=v;v=w;j=u}else{c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0);t=v;v=w;j=u}}else t=v}else t=m;aa=j+(m<<4)|0;c[aa+0>>2]=c[h+256>>2];c[aa+4>>2]=c[h+260>>2];c[aa+8>>2]=c[h+264>>2];c[aa+12>>2]=c[h+268>>2];rc[c[(c[d>>2]|0)+108>>2]&127](d,s,aa);s=s+1|0;m=t+1|0}a[h+212>>0]=1;c[h+208>>2]=0;c[h+200>>2]=0;c[h+204>>2]=0;a[h+232>>0]=1;c[h+228>>2]=0;c[h+220>>2]=0;c[h+224>>2]=0;a[h+252>>0]=1;c[h+248>>2]=0;c[h+240>>2]=0;c[h+244>>2]=0;if((f|0)!=0){if((m|0)>0){f=0;C=0;E=0;F=0;while(1){t=f;f=f+1|0;if((f|0)<(m|0)){s=j+(t<<4)|0;p=j+(t<<4)+4|0;t=j+(t<<4)+8|0;u=f;do{x=u;u=u+1|0;if((u|0)<(m|0)){w=j+(x<<4)|0;v=j+(x<<4)+4|0;x=j+(x<<4)+8|0;y=u;do{A=+g[s>>2];U=+g[w>>2]-A;T=+g[p>>2];R=+g[v>>2]-T;B=+g[t>>2];S=+g[x>>2]-B;A=+g[j+(y<<4)>>2]-A;T=+g[j+(y<<4)+4>>2]-T;B=+g[j+(y<<4)+8>>2]-B;X=1.0;D=0;while(1){V=(R*B-S*T)*X;W=(S*A-U*B)*X;X=(U*T-R*A)*X;a:do if(X*X+(V*V+W*W)>9999999747378752.0e-20){Y=1.0/+Q(+(X*X+(V*V+W*W)));if((C|0)>0){G=0;do{if(V*Y*+g[F+(G<<4)>>2]+W*Y*+g[F+(G<<4)+4>>2]+X*Y*+g[F+(G<<4)+8>>2]>.9990000128746033)break a;G=G+1|0}while((G|0)<(C|0))}Z=V*Y*+g[s>>2]+W*Y*+g[p>>2]+X*Y*+g[t>>2];G=0;do{if(V*Y*+g[j+(G<<4)>>2]+W*Y*+g[j+(G<<4)+4>>2]+X*Y*+g[j+(G<<4)+8>>2]-Z+-.009999999776482582>0.0)break a;G=G+1|0}while((G|0)<(m|0));do if((C|0)==(E|0)){H=(E|0)==0?1:E<<1;if((E|0)<(H|0)){do if((H|0)==0)I=0;else{c[5004]=(c[5004]|0)+1;G=XE((H<<4|3)+16|0)|0;if((G|0)==0){I=0;break}c[(G+19&-16)+ -4>>2]=G;I=G+19&-16}while(0);if((E|0)>0){G=0;do{aa=I+(G<<4)|0;$=F+(G<<4)|0;c[aa+0>>2]=c[$+0>>2];c[aa+4>>2]=c[$+4>>2];c[aa+8>>2]=c[$+8>>2];c[aa+12>>2]=c[$+12>>2];G=G+1|0}while((G|0)!=(E|0))}if((F|0)==0){G=E;E=H;F=I;break}c[5006]=(c[5006]|0)+1;YE(c[F+ -4>>2]|0);G=E;E=H;F=I}else G=E}else G=C;while(0);g[F+(G<<4)>>2]=V*Y;g[F+(G<<4)+4>>2]=W*Y;g[F+(G<<4)+8>>2]=X*Y;g[F+(G<<4)+12>>2]=-Z;C=C+1|0}while(0);D=D+1|0;if((D|0)==2)break;else X=-1.0}y=y+1|0}while((y|0)!=(m|0))}}while((u|0)!=(m|0))}if((f|0)==(m|0)){m=F;break}}if((C|0)>0){p=0;f=0;s=0;v=0;while(1){aa=m+(p<<4)|0;c[h+184>>2]=c[aa+0>>2];c[h+188>>2]=c[aa+4>>2];c[h+192>>2]=c[aa+8>>2];A=+g[m+(p<<4)+12>>2];A=A- +$b[c[(c[d>>2]|0)+48>>2]&15](d);if((f|0)==(s|0)){w=(s|0)==0?1:s<<1;if((s|0)<(w|0)){if((w|0)!=0?(c[5004]=(c[5004]|0)+1,l=XE((w<<4|3)+16|0)|0,(l|0)!=0):0){c[(l+19&-16)+ -4>>2]=l;t=l+19&-16}else t=0;if((s|0)>0){u=0;do{aa=t+(u<<4)|0;$=v+(u<<4)|0;c[aa+0>>2]=c[$+0>>2];c[aa+4>>2]=c[$+4>>2];c[aa+8>>2]=c[$+8>>2];c[aa+12>>2]=c[$+12>>2];u=u+1|0}while((u|0)!=(s|0))}if((v|0)==0){u=s;s=w}else{c[5006]=(c[5006]|0)+1;YE(c[v+ -4>>2]|0);u=s;s=w}}else{u=s;t=v}}else{u=f;t=v}aa=t+(u<<4)|0;c[aa+0>>2]=c[h+184>>2];c[aa+4>>2]=c[h+188>>2];c[aa+8>>2]=c[h+192>>2];g[t+(u<<4)+12>>2]=A;f=f+1|0;p=p+1|0;if((p|0)>=(C|0)){l=t;break}else v=t}if((f|0)>0){p=0;w=0;x=0;y=0;do{t=p;p=p+1|0;if((p|0)<(f|0)){s=p;do{u=s;s=s+1|0;if((s|0)<(f|0)){v=s;do{S=+g[l+(u<<4)+4>>2];Y=+g[l+(v<<4)+8>>2];B=+g[l+(u<<4)+8>>2];T=+g[l+(v<<4)+4>>2];W=+g[l+(v<<4)>>2];U=+g[l+(u<<4)>>2];X=+g[l+(t<<4)+8>>2];R=+g[l+(t<<4)+4>>2];V=+g[l+(t<<4)>>2];b:do if((((T*U-S*W)*(T*U-S*W)+((S*Y-B*T)*(S*Y-B*T)+(B*W-Y*U)*(B*W-Y*U))>9999999747378752.0e-20?(W*R-T*V)*(W*R-T*V)+((T*X-Y*R)*(T*X-Y*R)+(Y*V-W*X)*(Y*V-W*X))>9999999747378752.0e-20:0)?(S*V-U*R)*(S*V-U*R)+((B*R-S*X)*(B*R-S*X)+(U*X-B*V)*(U*X-B*V))>9999999747378752.0e-20:0)?(z=X*(T*U-S*W)+(R*(B*W-Y*U)+(S*Y-B*T)*V),+P(+z)>9.999999974752427e-7):0){ba=+g[l+(t<<4)+12>>2];Z=+g[l+(u<<4)+12>>2];ca=+g[l+(v<<4)+12>>2];A=-1.0/z*((B*R-S*X)*ca+((S*Y-B*T)*ba+(T*X-Y*R)*Z));B=-1.0/z*((U*X-B*V)*ca+((B*W-Y*U)*ba+(Y*V-W*X)*Z));R=-1.0/z*((S*V-U*R)*ca+((T*U-S*W)*ba+(W*R-T*V)*Z));C=0;do{if(+g[l+(C<<4)+12>>2]+(A*+g[l+(C<<4)>>2]+B*+g[l+(C<<4)+4>>2]+R*+g[l+(C<<4)+8>>2])+-.009999999776482582>0.0)break b;C=C+1|0}while((C|0)<(f|0));do if((w|0)==(x|0)){D=(x|0)==0?1:x<<1;if((x|0)>=(D|0)){C=x;break}do if((D|0)==0)E=0;else{c[5004]=(c[5004]|0)+1;C=XE((D<<4|3)+16|0)|0;if((C|0)==0){E=0;break}c[(C+19&-16)+ -4>>2]=C;E=C+19&-16}while(0);if((x|0)>0){C=0;do{aa=E+(C<<4)|0;$=y+(C<<4)|0;c[aa+0>>2]=c[$+0>>2];c[aa+4>>2]=c[$+4>>2];c[aa+8>>2]=c[$+8>>2];c[aa+12>>2]=c[$+12>>2];C=C+1|0}while((C|0)!=(x|0))}if((y|0)==0){C=x;x=D;y=E;break}c[5006]=(c[5006]|0)+1;YE(c[y+ -4>>2]|0);C=x;x=D;y=E}else C=w;while(0);g[y+(C<<4)>>2]=A;g[y+(C<<4)+4>>2]=B;g[y+(C<<4)+8>>2]=R;g[y+(C<<4)+12>>2]=0.0;w=w+1|0}while(0);v=v+1|0}while((v|0)!=(f|0))}}while((s|0)!=(f|0))}}while((p|0)!=(f|0))}else{w=0;y=0}}else{l=0;w=0;y=0}}else{m=0;l=0;w=0;y=0}kE(h+196|0,y,w);if((y|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[y+ -4>>2]|0)}if((l|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[l+ -4>>2]|0)}if((m|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[m+ -4>>2]|0)}}else kE(h+196|0,j,m);s=c[h+240>>2]|0;if((s|0)>0&((s|0)<0^1)){c[5004]=(c[5004]|0)+1;l=XE((s<<4|3)+16|0)|0;if((l|0)==0)m=0;else{c[(l+19&-16)+ -4>>2]=l;m=l+19&-16}l=0;do{aa=m+(l<<4)|0;c[aa+0>>2]=c[h+168>>2];c[aa+4>>2]=c[h+172>>2];c[aa+8>>2]=c[h+176>>2];c[aa+12>>2]=c[h+180>>2];l=l+1|0}while((l|0)!=(s|0))}else m=0;a[h+164>>0]=1;f=h+160|0;c[f>>2]=0;l=h+152|0;c[l>>2]=0;c[h+156>>2]=0;p=h+112|0;t=p+36|0;do{c[p>>2]=0;p=p+4|0}while((p|0)<(t|0));a[h+128>>0]=1;c[h+124>>2]=0;c[h+116>>2]=0;c[h+120>>2]=0;if((s|0)<0)Gb();if((s|0)>0){wA(h+148|0,s);p=c[f>>2]|0;t=0;do{u=p+(t*36|0)|0;if((u|0)!=0){yA(u,h+112|0);c[u+20>>2]=c[h+132>>2];c[u+24>>2]=c[h+136>>2];c[u+28>>2]=c[h+140>>2];c[u+32>>2]=c[h+144>>2]}t=t+1|0}while((t|0)!=(s|0));t=c[h+124>>2]|0;c[l>>2]=s;if((t|0)!=0){if((a[h+128>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[t+ -4>>2]|0)}c[h+124>>2]=0}}else{c[l>>2]=s;p=0}a[h+128>>0]=1;c[h+124>>2]=0;c[h+116>>2]=0;c[h+120>>2]=0;t=c[h+200>>2]|0;u=c[d+52>>2]|0;v=c[u+8>>2]|0;if((v|0)<(t|0)){if((c[u+12>>2]|0)<(t|0)){if((t|0)==0){w=0;y=v}else{c[5004]=(c[5004]|0)+1;w=XE((t<<4|3)+16|0)|0;if((w|0)==0)w=0;else{c[(w+19&-16)+ -4>>2]=w;w=w+19&-16}y=c[u+8>>2]|0}if((y|0)>0){x=0;do{aa=w+(x<<4)|0;$=(c[u+16>>2]|0)+(x<<4)|0;c[aa+0>>2]=c[$+0>>2];c[aa+4>>2]=c[$+4>>2];c[aa+8>>2]=c[$+8>>2];c[aa+12>>2]=c[$+12>>2];x=x+1|0}while((x|0)!=(y|0))}x=c[u+16>>2]|0;if((x|0)!=0){if((a[u+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[x+ -4>>2]|0)}c[u+16>>2]=0}a[u+20>>0]=1;c[u+16>>2]=w;c[u+12>>2]=t;w=u+16|0}else w=u+16|0;do{aa=(c[w>>2]|0)+(v<<4)|0;c[aa+0>>2]=c[h+96>>2];c[aa+4>>2]=c[h+100>>2];c[aa+8>>2]=c[h+104>>2];c[aa+12>>2]=c[h+108>>2];v=v+1|0}while((v|0)!=(t|0))}c[u+8>>2]=t;if((t|0)>0){v=c[h+208>>2]|0;u=0;do{aa=(c[(c[d+52>>2]|0)+16>>2]|0)+(u<<4)|0;$=v+(u<<4)|0;c[aa+0>>2]=c[$+0>>2];c[aa+4>>2]=c[$+4>>2];c[aa+8>>2]=c[$+8>>2];c[aa+12>>2]=c[$+12>>2];u=u+1|0}while((u|0)!=(t|0))}if((s|0)>0){t=0;do{u=(c[h+228>>2]|0)+((c[(c[h+248>>2]|0)+(t<<2)>>2]|0)*12|0)|0;x=p+(t*36|0)+4|0;v=p+(t*36|0)+8|0;w=p+(t*36|0)+12|0;y=p+(t*36|0)+16|0;p=u;D=0;do{C=p+4|0;E=c[p+((c[C>>2]|0)*12|0)+8>>2]|0;H=c[x>>2]|0;if((H|0)==(c[v>>2]|0)?(r=(H|0)==0?1:H<<1,(H|0)<(r|0)):0){if((r|0)==0)F=0;else{c[5004]=(c[5004]|0)+1;F=XE((r<<2|3)+16|0)|0;if((F|0)==0)F=0;else{c[(F+19&-16)+ -4>>2]=F;F=F+19&-16}H=c[x>>2]|0}if((H|0)>0){G=0;do{I=F+(G<<2)|0;if((I|0)!=0)c[I>>2]=c[(c[w>>2]|0)+(G<<2)>>2];G=G+1|0}while((G|0)!=(H|0))}G=c[w>>2]|0;if((G|0)!=0){if((a[y>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[G+ -4>>2]|0)}c[w>>2]=0}a[y>>0]=1;c[w>>2]=F;c[v>>2]=r;H=c[x>>2]|0}F=(c[w>>2]|0)+(H<<2)|0;if((F|0)!=0){c[F>>2]=E;H=c[x>>2]|0}c[x>>2]=H+1;$=c[p+8>>2]|0;aa=c[h+208>>2]|0;z=+g[aa+($<<4)>>2]- +g[aa+(E<<4)>>2];A=+g[aa+($<<4)+4>>2]- +g[aa+(E<<4)+4>>2];R=+g[aa+($<<4)+8>>2]- +g[aa+(E<<4)+8>>2];B=1.0/+Q(+(z*z+A*A+R*R));if((D|0)<2){g[h+288+(D<<4)>>2]=z*B;g[h+288+(D<<4)+4>>2]=A*B;g[h+288+(D<<4)+8>>2]=R*B;g[h+288+(D<<4)+12>>2]=0.0;D=D+1|0}aa=c[C>>2]|0;p=p+(((c[p+(aa*12|0)>>2]|0)+aa|0)*12|0)|0}while((p|0)!=(u|0));w=m+(t<<4)|0;if((D|0)==2){X=+g[h+292>>2];Y=+g[h+312>>2];Z=+g[h+296>>2];ba=+g[h+308>>2];W=+g[h+304>>2];V=+g[h+288>>2];$=m+(t<<4)+4|0;aa=m+(t<<4)+8|0;g[m+(t<<4)+12>>2]=0.0;ca=1.0/+Q(+((X*Y-Z*ba)*(X*Y-Z*ba)+(Z*W-Y*V)*(Z*W-Y*V)+(ba*V-X*W)*(ba*V-X*W)));g[w>>2]=(X*Y-Z*ba)*ca;g[$>>2]=(Z*W-Y*V)*ca;g[aa>>2]=(ba*V-X*W)*ca;p=c[f>>2]|0;g[p+(t*36|0)+20>>2]=(X*Y-Z*ba)*ca;g[p+(t*36|0)+24>>2]=+g[$>>2];g[p+(t*36|0)+28>>2]=+g[aa>>2];g[p+(t*36|0)+32>>2]=1.0000000150474662e+30}else{c[w+0>>2]=0;c[w+4>>2]=0;c[w+8>>2]=0;c[w+12>>2]=0;p=c[f>>2]|0}u=c[p+(t*36|0)+4>>2]|0;if((u|0)>0){v=c[(c[d+52>>2]|0)+16>>2]|0;B=+g[w>>2];z=+g[m+(t<<4)+4>>2];A=+g[m+(t<<4)+8>>2];x=c[p+(t*36|0)+12>>2]|0;R=1.0000000150474662e+30;w=0;do{aa=c[x+(w<<2)>>2]|0;ca=+g[v+(aa<<4)>>2]*B+ +g[v+(aa<<4)+4>>2]*z+ +g[v+(aa<<4)+8>>2]*A;R=R>ca?ca:R;w=w+1|0}while((w|0)<(u|0))}else R=1.0000000150474662e+30;g[p+(t*36|0)+32>>2]=-R;t=t+1|0}while((t|0)<(s|0));s=c[l>>2]|0;if((s|0)>0){t=0;r=0;w=0;do{if((w|0)==(t|0)){t=(w|0)==0?1:w<<1;if((w|0)<(t|0)){if((t|0)!=0?(c[5004]=(c[5004]|0)+1,q=XE((t<<2|3)+16|0)|0,(q|0)!=0):0){c[(q+19&-16)+ -4>>2]=q;u=q+19&-16}else u=0;if((w|0)>0){x=0;do{v=u+(x<<2)|0;if((v|0)!=0)c[v>>2]=c[r+(x<<2)>>2];x=x+1|0}while((x|0)!=(w|0))}if((r|0)==0)r=u;else{c[5006]=(c[5006]|0)+1;YE(c[r+ -4>>2]|0);r=u}}else t=w}u=r+(w<<2)|0;if((u|0)!=0){c[u>>2]=w;s=c[l>>2]|0}w=w+1|0}while((w|0)<(s|0));if((w|0)==0)o=r;else{q=h+88|0;u=h+84|0;t=h+76|0;s=h+32|0;v=h+308|0;B=0.0;A=0.0;z=0.0;while(1){C=w+ -1|0;w=c[r+(C<<2)>>2]|0;c[5004]=(c[5004]|0)+1;y=XE(23)|0;if((y|0)!=0){c[(y+19&-16)+ -4>>2]=y;x=y+19&-16;if((y+19&-16|0)!=0)c[x>>2]=w}else x=0;S=+g[p+(w*36|0)+20>>2];R=+g[p+(w*36|0)+24>>2];T=+g[p+(w*36|0)+28>>2];w=C;F=1;y=1;D=C;c:while(1){C=(w|0)>0;d:while(1){do{aa=D;D=D+ -1|0;if((aa|0)<=0)break c;E=c[r+(D<<2)>>2]|0}while(!(S*+g[p+(E*36|0)+20>>2]+R*+g[p+(E*36|0)+24>>2]+T*+g[p+(E*36|0)+28>>2]>.9990000128746033));do if((y|0)==(F|0)?(o=(F|0)==0?1:F<<1,(F|0)<(o|0)):0){do if((o|0)==0)G=0;else{c[5004]=(c[5004]|0)+1;G=XE((o<<2|3)+16|0)|0;if((G|0)==0){G=0;break}c[(G+19&-16)+ -4>>2]=G;G=G+19&-16}while(0);if((F|0)>0){H=0;do{I=G+(H<<2)|0;if((I|0)!=0)c[I>>2]=c[x+(H<<2)>>2];H=H+1|0}while((H|0)!=(F|0))}if((x|0)==0){F=o;x=G;break}c[5006]=(c[5006]|0)+1;YE(c[x+ -4>>2]|0);F=o;x=G}while(0);G=x+(y<<2)|0;if((G|0)!=0)c[G>>2]=E;y=y+1|0;if(C)I=0;else continue;while(1){H=r+(I<<2)|0;G=I+1|0;if((c[H>>2]|0)==(E|0))break;if((G|0)<(w|0))I=G;else continue d}if((I|0)<(w|0))break}aa=w+ -1|0;$=r+(aa<<2)|0;c[H>>2]=c[$>>2];c[$>>2]=E;w=aa}if((y|0)>1){a[q>>0]=1;c[u>>2]=0;c[t>>2]=0;c[h+80>>2]=0;G=0;B=0.0;A=0.0;z=0.0;C=0;do{E=c[x+(C<<2)>>2]|0;B=+g[p+(E*36|0)+20>>2]+B;A=+g[p+(E*36|0)+24>>2]+A;z=+g[p+(E*36|0)+28>>2]+z;D=p+(E*36|0)+4|0;H=c[D>>2]|0;if((H|0)>0){E=p+(E*36|0)+12|0;J=G;F=0;while(1){G=c[(c[E>>2]|0)+(F<<2)>>2]|0;aa=(c[(c[d+52>>2]|0)+16>>2]|0)+(G<<4)|0;c[h+56>>2]=c[aa+0>>2];c[h+60>>2]=c[aa+4>>2];c[h+64>>2]=c[aa+8>>2];c[h+68>>2]=c[aa+12>>2];e:do if((J|0)>0){I=c[u>>2]|0;K=0;while(1){if((c[I+(K*24|0)+20>>2]|0)==(G|0)){G=J;break e}K=K+1|0;if((K|0)>=(J|0)){n=207;break}}}else n=207;while(0);if((n|0)==207){n=0;c[h+0>>2]=c[h+56>>2];c[h+4>>2]=c[h+60>>2];c[h+8>>2]=c[h+64>>2];c[h+12>>2]=c[h+68>>2];do if((J|0)==(c[h+80>>2]|0)){H=(J|0)==0?1:J<<1;if((J|0)>=(H|0))break;if((H|0)==0)I=0;else{c[5004]=(c[5004]|0)+1;I=XE((H*24|3)+16|0)|0;if((I|0)==0)I=0;else{c[(I+19&-16)+ -4>>2]=I;I=I+19&-16}J=c[t>>2]|0}K=c[u>>2]|0;if((J|0)<=0){if((K|0)!=0)n=216}else{n=0;do{aa=I+(n*24|0)|0;$=K+(n*24|0)|0;c[aa+0>>2]=c[$+0>>2];c[aa+4>>2]=c[$+4>>2];c[aa+8>>2]=c[$+8>>2];c[aa+12>>2]=c[$+12>>2];c[aa+16>>2]=c[$+16>>2];c[aa+20>>2]=c[$+20>>2];n=n+1|0}while((n|0)!=(J|0));n=216}if((n|0)==216){n=0;if(!((a[q>>0]|0)==0|(K|0)==0)){c[5006]=(c[5006]|0)+1;YE(c[K+ -4>>2]|0);J=c[t>>2]|0}c[u>>2]=0}a[q>>0]=1;c[u>>2]=I;c[h+80>>2]=H}while(0);H=c[u>>2]|0;aa=H+(J*24|0)|0;c[aa+0>>2]=c[h+0>>2];c[aa+4>>2]=c[h+4>>2];c[aa+8>>2]=c[h+8>>2];c[aa+12>>2]=c[h+12>>2];c[aa+16>>2]=c[h+16>>2];c[H+(J*24|0)+20>>2]=G;G=(c[t>>2]|0)+1|0;c[t>>2]=G;H=c[D>>2]|0}F=F+1|0;if((F|0)>=(H|0))break;else J=G}}C=C+1|0}while((C|0)<(y|0));a[h+36>>0]=1;c[s>>2]=0;c[h+24>>2]=0;c[h+28>>2]=0;aa=p+((c[x>>2]|0)*9<<2)+20|0;c[h+40>>2]=c[aa+0>>2];c[h+44>>2]=c[aa+4>>2];c[h+48>>2]=c[aa+8>>2];c[h+52>>2]=c[aa+12>>2];ca=1.0/+Q(+(B*B+A*A+z*z));B=B*ca;A=A*ca;z=z*ca;if(+P(+z)>.7071067690849304){S=1.0/+Q(+(z*z+A*A));T=0.0;R=-(z*S);S=A*S}else{R=1.0/+Q(+(B*B+A*A));T=-(A*R);R=B*R;S=0.0}f:do if((G|0)<2)if((G|0)>0){D=0;J=0;C=0;n=1;while(1){E=c[u>>2]|0;do if((D|0)==(J|0)){F=(J|0)==0?1:J<<1;if((J|0)>=(F|0)){I=J;F=J;break}do if((F|0)==0)H=0;else{c[5004]=(c[5004]|0)+1;G=XE((F*24|3)+16|0)|0;if((G|0)==0){H=0;J=D;break}c[(G+19&-16)+ -4>>2]=G;H=G+19&-16;J=D}while(0);if((J|0)>0){G=0;do{aa=H+(G*24|0)|0;$=C+(G*24|0)|0;c[aa+0>>2]=c[$+0>>2];c[aa+4>>2]=c[$+4>>2];c[aa+8>>2]=c[$+8>>2];c[aa+12>>2]=c[$+12>>2];c[aa+16>>2]=c[$+16>>2];c[aa+20>>2]=c[$+20>>2];G=G+1|0}while((G|0)!=(J|0))}if((C|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[C+ -4>>2]|0)}I=D;G=c[t>>2]|0;C=H}else{I=D;F=J}while(0);aa=C+(I*24|0)|0;c[aa+0>>2]=c[E+0>>2];c[aa+4>>2]=c[E+4>>2];c[aa+8>>2]=c[E+8>>2];c[aa+12>>2]=c[E+12>>2];c[aa+16>>2]=c[E+16>>2];c[aa+20>>2]=c[E+20>>2];D=D+1|0;if((n|0)>=(G|0)){n=272;break f}J=F;n=n+1|0}}else{C=0;n=307}else{n=c[u>>2]|0;C=G;D=0;do{if(T*+g[n+(D*24|0)>>2]+R*+g[n+(D*24|0)+4>>2]+S*+g[n+(D*24|0)+8>>2]<T*+g[n>>2]+R*+g[n+4>>2]+S*+g[n+8>>2]){c[h+288>>2]=c[n+0>>2];c[h+292>>2]=c[n+4>>2];c[h+296>>2]=c[n+8>>2];c[h+300>>2]=c[n+12>>2];c[h+304>>2]=c[n+16>>2];c[h+308>>2]=c[n+20>>2];C=n+(D*24|0)|0;c[n+0>>2]=c[C+0>>2];c[n+4>>2]=c[C+4>>2];c[n+8>>2]=c[C+8>>2];c[n+12>>2]=c[C+12>>2];c[n+16>>2]=c[C+16>>2];c[n+20>>2]=c[C+20>>2];C=n+(D*24|0)|0;c[C+0>>2]=c[h+288>>2];c[C+4>>2]=c[h+292>>2];c[C+8>>2]=c[h+296>>2];c[C+12>>2]=c[h+300>>2];c[C+16>>2]=c[h+304>>2];c[C+20>>2]=c[h+308>>2];C=G}D=D+1|0}while((D|0)<(C|0));g[n+16>>2]=-1.0000000150474662e+30;if((C|0)>1){U=+g[n+4>>2];D=1;do{Z=+g[n+(D*24|0)>>2]- +g[n>>2];ba=+g[n+(D*24|0)+4>>2]-U;ca=+g[n+(D*24|0)+8>>2]- +g[n+8>>2];g[n+(D*24|0)+16>>2]=((T*ba-R*Z)*z+(B*(R*ca-S*ba)+A*(S*Z-T*ca)))/+Q(+(Z*Z+ba*ba+ca*ca));D=D+1|0}while((D|0)<(C|0))}c[h+272>>2]=c[n+0>>2];c[h+276>>2]=c[n+4>>2];c[h+280>>2]=c[n+8>>2];c[h+284>>2]=c[n+12>>2];zA(h+72|0,h+272|0,1,C+ -1|0);C=c[u>>2]|0;c[5004]=(c[5004]|0)+1;n=XE(43)|0;if((n|0)==0)n=0;else{c[(n+19&-16)+ -4>>2]=n;n=n+19&-16}D=c[u>>2]|0;c[n+0>>2]=c[C+0>>2];c[n+4>>2]=c[C+4>>2];c[n+8>>2]=c[C+8>>2];c[n+12>>2]=c[C+12>>2];c[n+16>>2]=c[C+16>>2];c[n+20>>2]=c[C+20>>2];c[5004]=(c[5004]|0)+1;C=XE(67)|0;if((C|0)==0)C=0;else{c[(C+19&-16)+ -4>>2]=C;C=C+19&-16}E=0;while(1){aa=C+(E*24|0)|0;$=n+(E*24|0)|0;c[aa+0>>2]=c[$+0>>2];c[aa+4>>2]=c[$+4>>2];c[aa+8>>2]=c[$+8>>2];c[aa+12>>2]=c[$+12>>2];c[aa+16>>2]=c[$+16>>2];c[aa+20>>2]=c[$+20>>2];if((E|0)==0)break;else E=E+1|0}if((n|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[n+ -4>>2]|0)}G=C+24|0;c[G+0>>2]=c[D+24>>2];c[G+4>>2]=c[D+28>>2];c[G+8>>2]=c[D+32>>2];c[G+12>>2]=c[D+36>>2];c[G+16>>2]=c[D+40>>2];c[G+20>>2]=c[D+44>>2];G=c[t>>2]|0;if((G|0)==2){D=2;n=273;break}else{H=2;D=2;F=2;n=2}while(1){g:do if((H|0)>1){aa=c[u>>2]|0;E=aa+(n*24|0)|0;R=+g[E>>2];S=+g[aa+(n*24|0)+4>>2];T=+g[aa+(n*24|0)+8>>2];while(1){aa=H+ -2|0;I=H+ -1|0;Z=+g[C+(aa*24|0)>>2];ba=Z- +g[C+(I*24|0)>>2];X=+g[C+(aa*24|0)+4>>2];W=X- +g[C+(I*24|0)+4>>2];ca=+g[C+(aa*24|0)+8>>2];Y=ca- +g[C+(I*24|0)+8>>2];if((ba*(X-S)-W*(Z-R))*z+(B*(W*(ca-T)-Y*(X-S))+A*(Y*(Z-R)-ba*(ca-T)))>0.0)break;if((I|0)>1){H=I;D=I}else{H=I;D=I;break g}}do if((H|0)==(F|0)){I=(F|0)==0?1:F<<1;if((F|0)>=(I|0)){H=F;break}do if((I|0)==0)J=0;else{c[5004]=(c[5004]|0)+1;F=XE((I*24|3)+16|0)|0;if((F|0)==0){J=0;F=D;break}c[(F+19&-16)+ -4>>2]=F;J=F+19&-16;F=D}while(0);if((F|0)>0){G=0;do{aa=J+(G*24|0)|0;$=C+(G*24|0)|0;c[aa+0>>2]=c[$+0>>2];c[aa+4>>2]=c[$+4>>2];c[aa+8>>2]=c[$+8>>2];c[aa+12>>2]=c[$+12>>2];c[aa+16>>2]=c[$+16>>2];c[aa+20>>2]=c[$+20>>2];G=G+1|0}while((G|0)!=(F|0))}if((C|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[C+ -4>>2]|0)}G=c[t>>2]|0;H=D;F=I;C=J}while(0);H=C+(H*24|0)|0;c[H+0>>2]=c[E+0>>2];c[H+4>>2]=c[E+4>>2];c[H+8>>2]=c[E+8>>2];c[H+12>>2]=c[E+12>>2];c[H+16>>2]=c[E+16>>2];c[H+20>>2]=c[E+20>>2];D=D+1|0;H=D}while(0);n=n+1|0;if((n|0)==(G|0)){n=272;break}}}while(0);if((n|0)==272)if((D|0)>0)n=273;else n=295;if((n|0)==273){H=0;G=0;F=0;n=0;do{E=C+(n*24|0)+20|0;do if((H|0)==(G|0)){I=(G|0)==0?1:G<<1;if((G|0)>=(I|0)){H=G;break}do if((I|0)==0)H=0;else{c[5004]=(c[5004]|0)+1;H=XE((I<<2|3)+16|0)|0;if((H|0)==0){H=0;break}c[(H+19&-16)+ -4>>2]=H;H=H+19&-16}while(0);if((G|0)>0){J=0;do{K=H+(J<<2)|0;if((K|0)!=0)c[K>>2]=c[F+(J<<2)>>2];J=J+1|0}while((J|0)!=(G|0))}if((F|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[F+ -4>>2]|0);c[s>>2]=0}a[h+36>>0]=1;c[s>>2]=H;c[h+28>>2]=I;F=H;H=G;G=I}while(0);I=F+(H<<2)|0;if((I|0)!=0){c[I>>2]=c[E>>2];H=c[h+24>>2]|0}H=H+1|0;c[h+24>>2]=H;J=c[t>>2]|0;h:do if((J|0)>0){I=c[u>>2]|0;E=c[E>>2]|0;K=0;while(1){L=I+(K*24|0)+20|0;K=K+1|0;if((c[L>>2]|0)==(E|0))break;if((K|0)>=(J|0))break h}c[L>>2]=-1}while(0);n=n+1|0}while((n|0)<(D|0));G=c[t>>2]|0;n=295}i:do if((n|0)==295){n=0;if((G|0)>0){H=c[u>>2]|0;I=c[l>>2]|0;F=0;while(1){E=c[H+(F*24|0)+20>>2]|0;if(!((E|0)==-1|(I|0)<1)){D=0;do{J=0;while(1){if((c[x+(J<<2)>>2]|0)==(D|0))break;J=J+1|0;if((J|0)>=(y|0)){n=303;break}}do if((n|0)==303){n=0;J=c[p+(D*36|0)+4>>2]|0;if((J|0)<=0)break;K=c[p+(D*36|0)+12>>2]|0;L=0;do{if((c[K+(L<<2)>>2]|0)==(E|0)){D=1;break i}L=L+1|0}while((L|0)<(J|0))}while(0);D=D+1|0}while((D|0)<(I|0))}F=F+1|0;if((F|0)>=(G|0)){n=307;break}}}else n=307}while(0);if((n|0)==307){n=0;D=c[d+52>>2]|0;E=c[D+28>>2]|0;if((E|0)==(c[D+32>>2]|0)){wA(D+24|0,(E|0)==0?1:E<<1);E=c[D+28>>2]|0}F=(c[D+36>>2]|0)+(E*36|0)|0;if((F|0)!=0){yA(F,h+20|0);c[F+20>>2]=c[h+40>>2];c[F+24>>2]=c[h+44>>2];c[F+28>>2]=c[h+48>>2];c[F+32>>2]=c[h+52>>2];E=c[D+28>>2]|0}c[D+28>>2]=E+1;D=0}if((C|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[C+ -4>>2]|0)}C=c[s>>2]|0;if((C|0)!=0){if((a[h+36>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[C+ -4>>2]|0)}c[s>>2]=0}C=c[u>>2]|0;if((C|0)!=0){if((a[q>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[C+ -4>>2]|0)}c[u>>2]=0}a[q>>0]=1;c[u>>2]=0;c[t>>2]=0;c[h+80>>2]=0;if(D&(y|0)>0)n=324}else if((y|0)>0)n=324;if((n|0)==324){n=0;C=0;do{D=c[x+(C<<2)>>2]|0;yA(h+288|0,p+(D*36|0)|0);D=p+(D*36|0)+20|0;c[v+0>>2]=c[D+0>>2];c[v+4>>2]=c[D+4>>2];c[v+8>>2]=c[D+8>>2];c[v+12>>2]=c[D+12>>2];D=c[d+52>>2]|0;E=c[D+28>>2]|0;if((E|0)==(c[D+32>>2]|0)){wA(D+24|0,(E|0)==0?1:E<<1);E=c[D+28>>2]|0}F=(c[D+36>>2]|0)+(E*36|0)|0;if((F|0)!=0){yA(F,h+288|0);c[F+20>>2]=c[v+0>>2];c[F+24>>2]=c[v+4>>2];c[F+28>>2]=c[v+8>>2];c[F+32>>2]=c[v+12>>2];E=c[D+28>>2]|0}c[D+28>>2]=E+1;D=c[h+300>>2]|0;if((D|0)!=0){if((a[h+304>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[D+ -4>>2]|0)}c[h+300>>2]=0}C=C+1|0}while((C|0)<(y|0))}if((x|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[x+ -4>>2]|0)}if((w|0)==0){o=r;break}}}}else o=0}else o=0;d=c[d+52>>2]|0;c[d+64>>2]=0;c[d+68>>2]=0;c[d+72>>2]=0;c[d+76>>2]=0;r=c[d+28>>2]|0;if((r|0)>0){s=r;w=0;u=0;G=0;L=0;H=0;K=0;J=0;I=0;F=0;y=0;E=0;x=0;q=0;while(1){C=c[d+36>>2]|0;r=c[C+(q*36|0)+4>>2]|0;if((r|0)>0){t=q&65535;s=q|-65536;D=0;while(1){v=D+1|0;M=c[C+(q*36|0)+12>>2]|0;O=c[M+(D<<2)>>2]&65535;M=c[M+(((v|0)==(r|0)?0:v)<<2)>>2]&65535;D=O<<16>>16<M<<16>>16?O:M;C=O<<16>>16<M<<16>>16?M:O;_=O<<16>>16<M<<16>>16?O:M;O=O<<16>>16<M<<16>>16?M:O;M=G+ -1|0;j:do if((((_&65535)<<16)+(O<<16>>16)&M)>>>0<w>>>0?(k=c[F+((((_&65535)<<16)+(O<<16>>16)&M)<<2)>>2]|0,!((k|0)==-1)):0){N=k;while(1){if(O<<16>>16==(b[J+(N<<2)>>1]|0)?_<<16>>16==(b[J+(N<<2)+2>>1]|0):0)break;N=c[x+(N<<2)>>2]|0;if((N|0)==-1){N=0;break j}}if(!((N|0)==-1))N=L+(N<<2)|0;else N=0}else N=0;while(0);aa=c[d+16>>2]|0;A=+g[aa+(_<<16>>16<<4)>>2]- +g[aa+(O<<16>>16<<4)>>2];z=+g[aa+(_<<16>>16<<4)+4>>2]- +g[aa+(O<<16>>16<<4)+4>>2];B=+g[aa+(_<<16>>16<<4)+8>>2]- +g[aa+(O<<16>>16<<4)+8>>2];R=1.0/+Q(+(A*A+z*z+B*B));_=c[d+48>>2]|0;k:do if((_|0)>0){O=c[d+56>>2]|0;$=0;while(1){S=+g[O+($<<4)>>2];T=+g[O+($<<4)+8>>2];do if(!(+P(+(S-A*R))>1.0e-6)){if(+P(+(+g[O+($<<4)+4>>2]-z*R))>1.0e-6)break;if(!(+P(+(T-B*R))>1.0e-6))break k}while(0);do if(!(+P(+(A*R+S))>1.0e-6)){if(+P(+(z*R+ +g[O+($<<4)+4>>2]))>1.0e-6)break;if(!(+P(+(B*R+T))>1.0e-6))break k}while(0);$=$+1|0;if(($|0)>=(_|0)){n=359;break}}}else n=359;while(0);if((n|0)==359){n=0;do if((_|0)==(c[d+52>>2]|0)){O=(_|0)==0?1:_<<1;if((_|0)>=(O|0))break;if((O|0)==0)$=0;else{c[5004]=(c[5004]|0)+1;_=XE((O<<4|3)+16|0)|0;if((_|0)==0)$=0;else{c[(_+19&-16)+ -4>>2]=_;$=_+19&-16}_=c[d+48>>2]|0}if((_|0)>0){aa=0;do{da=$+(aa<<4)|0;ea=(c[d+56>>2]|0)+(aa<<4)|0;c[da+0>>2]=c[ea+0>>2];c[da+4>>2]=c[ea+4>>2];c[da+8>>2]=c[ea+8>>2];c[da+12>>2]=c[ea+12>>2];aa=aa+1|0}while((aa|0)!=(_|0))}_=c[d+56>>2]|0;if((_|0)!=0){if((a[d+60>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[_+ -4>>2]|0)}c[d+56>>2]=0}a[d+60>>0]=1;c[d+56>>2]=$;c[d+52>>2]=O;_=c[d+48>>2]|0}while(0);ea=c[d+56>>2]|0;g[ea+(_<<4)>>2]=A*R;g[ea+(_<<4)+4>>2]=z*R;g[ea+(_<<4)+8>>2]=B*R;g[ea+(_<<4)+12>>2]=0.0;c[d+48>>2]=(c[d+48>>2]|0)+1}l:do if((N|0)==0){O=((D&65535)<<16)+(C<<16>>16)&M;m:do if(O>>>0<w>>>0){M=c[F+(O<<2)>>2]|0;if((M|0)==-1)break;while(1){if(C<<16>>16==(b[J+(M<<2)>>1]|0)?D<<16>>16==(b[J+(M<<2)+2>>1]|0):0)break;M=c[x+(M<<2)>>2]|0;if((M|0)==-1)break m}if((M|0)==-1)break;ea=L+(M<<2)|0;b[ea>>1]=s;b[ea+2>>1]=s>>>16;break l}while(0);do if((u|0)==(G|0)){M=(G|0)==0?1:G<<1;if((G|0)>=(M|0)){_=G;M=G;break}do if((M|0)==0)N=0;else{c[5004]=(c[5004]|0)+1;N=XE((M<<2|3)+16|0)|0;if((N|0)==0){N=0;break}c[(N+19&-16)+ -4>>2]=N;N=N+19&-16}while(0);if((G|0)>0){_=0;do{$=N+(_<<2)|0;if(($|0)!=0){ea=L+(_<<2)|0;ea=e[ea>>1]|e[ea+2>>1]<<16;b[$>>1]=ea;b[$+2>>1]=ea>>>16}_=_+1|0}while((_|0)!=(G|0))}if((L|0)==0){_=G;L=N;break}c[5006]=(c[5006]|0)+1;YE(c[L+ -4>>2]|0);_=G;L=N}else{_=u;M=G}while(0);N=L+(_<<2)|0;if((N|0)!=0){b[N>>1]=s;b[N+2>>1]=s>>>16;_=u}N=_+1|0;do if((H|0)==(K|0)){K=(H|0)==0?1:H<<1;if((H|0)>=(K|0)){K=H;break}do if((K|0)==0)_=0;else{c[5004]=(c[5004]|0)+1;_=XE((K<<2|3)+16|0)|0;if((_|0)==0){_=0;break}c[(_+19&-16)+ -4>>2]=_;_=_+19&-16}while(0);if((H|0)>0){aa=0;do{$=_+(aa<<2)|0;if(($|0)!=0){ea=J+(aa<<2)|0;ea=e[ea>>1]|e[ea+2>>1]<<16;b[$>>1]=ea;b[$+2>>1]=ea>>>16}aa=aa+1|0}while((aa|0)!=(H|0))}if((J|0)==0){J=_;break}c[5006]=(c[5006]|0)+1;YE(c[J+ -4>>2]|0);J=_}while(0);_=J+(H<<2)|0;if((_|0)!=0){b[_>>1]=(D&65535)<<16|C&65535;b[_+2>>1]=((D&65535)<<16|C&65535)>>>16}H=H+1|0;if((G|0)<(M|0)){do if((w|0)<(M|0)){if((w|0)<=(M|0)){do if((I|0)<(M|0)){do if((M|0)==0)G=0;else{c[5004]=(c[5004]|0)+1;G=XE((M<<2|3)+16|0)|0;if((G|0)==0){G=0;break}c[(G+19&-16)+ -4>>2]=G;G=G+19&-16}while(0);if((w|0)>0){I=0;do{O=G+(I<<2)|0;if((O|0)!=0)c[O>>2]=c[F+(I<<2)>>2];I=I+1|0}while((I|0)!=(w|0))}if((F|0)==0){I=M;F=G;break}c[5006]=(c[5006]|0)+1;YE(c[F+ -4>>2]|0);I=M;F=G}while(0);O=w;do{G=F+(O<<2)|0;if((G|0)!=0)c[G>>2]=0;O=O+1|0}while((O|0)!=(M|0))}if((y|0)<(M|0)){do if((E|0)<(M|0)){do if((M|0)==0)G=0;else{c[5004]=(c[5004]|0)+1;E=XE((M<<2|3)+16|0)|0;if((E|0)==0){G=0;break}c[(E+19&-16)+ -4>>2]=E;G=E+19&-16}while(0);if((y|0)>0){E=0;do{O=G+(E<<2)|0;if((O|0)!=0)c[O>>2]=c[x+(E<<2)>>2];E=E+1|0}while((E|0)!=(y|0))}if((x|0)==0){E=M;x=G;break}c[5006]=(c[5006]|0)+1;YE(c[x+ -4>>2]|0);E=M;x=G}while(0);do{G=x+(y<<2)|0;if((G|0)!=0)c[G>>2]=0;y=y+1|0}while((y|0)!=(M|0))}if((M|0)>0){ea=M<<2;$E(F|0,-1,ea|0)|0;$E(x|0,-1,ea|0)|0}if((w|0)<=0){w=M;y=M;break}G=M+ -1|0;y=0;do{ea=F+(((e[J+(y<<2)+2>>1]<<16)+(b[J+(y<<2)>>1]|0)&G)<<2)|0;c[x+(y<<2)>>2]=c[ea>>2];c[ea>>2]=y;y=y+1|0}while((y|0)!=(w|0));w=M;y=M}while(0);O=((D&65535)<<16)+(C<<16>>16)&M+ -1}G=F+(O<<2)|0;c[x+(u<<2)>>2]=c[G>>2];c[G>>2]=u;u=N;G=M}else b[N+2>>1]=t;while(0);if((v|0)>=(r|0))break;C=c[d+36>>2]|0;D=v}r=c[d+28>>2]|0}else r=s;q=q+1|0;if((q|0)>=(r|0))break;else s=r}if((r|0)>0){n=c[d+36>>2]|0;q=c[d+16>>2]|0;R=0.0;k=0;do{u=c[n+(k*36|0)+4>>2]|0;t=c[n+(k*36|0)+12>>2]|0;s=c[t>>2]|0;if((u+ -2|0)>=1){B=+g[d+64>>2];A=+g[d+68>>2];z=+g[d+72>>2];v=1;do{da=c[t+(v<<2)>>2]|0;v=v+1|0;ea=c[t+(((v|0)%(u|0)|0)<<2)>>2]|0;S=+g[q+(s<<4)>>2];T=+g[q+(da<<4)>>2];V=+g[q+(s<<4)+4>>2];W=+g[q+(da<<4)+4>>2];Y=+g[q+(s<<4)+8>>2];Z=+g[q+(da<<4)+8>>2];U=+g[q+(ea<<4)>>2];X=+g[q+(ea<<4)+4>>2];ba=+g[q+(ea<<4)+8>>2];ca=+Q(+(((S-T)*(V-X)-(V-W)*(S-U))*((S-T)*(V-X)-(V-W)*(S-U))+(((V-W)*(Y-ba)-(Y-Z)*(V-X))*((V-W)*(Y-ba)-(Y-Z)*(V-X))+((Y-Z)*(S-U)-(S-T)*(Y-ba))*((Y-Z)*(S-U)-(S-T)*(Y-ba)))))*.5;B=B+(S+T+U)*.3333333432674408*ca;g[d+64>>2]=B;A=(V+W+X)*.3333333432674408*ca+A;g[d+68>>2]=A;z=ca*(Y+Z+ba)*.3333333432674408+z;g[d+72>>2]=z;R=R+ca}while((v|0)!=(u+ -1|0))}k=k+1|0}while((k|0)<(r|0))}else R=0.0}else{R=0.0;L=0;J=0;F=0;x=0}A=1.0/R;R=A*+g[d+64>>2];g[d+64>>2]=R;B=A*+g[d+68>>2];g[d+68>>2]=B;A=A*+g[d+72>>2];g[d+72>>2]=A;g[d+96>>2]=3.4028234663852886e+38;if((r|0)>0){n=c[d+36>>2]|0;S=3.4028234663852886e+38;k=0;while(1){z=+P(+(+g[n+(k*36|0)+32>>2]+(+g[n+(k*36|0)+20>>2]*R+ +g[n+(k*36|0)+24>>2]*B+ +g[n+(k*36|0)+28>>2]*A)));if(z<S)g[d+96>>2]=z;else z=S;k=k+1|0;if((k|0)>=(r|0))break;else S=z}}else z=3.4028234663852886e+38;k=c[d+8>>2]|0;if((k|0)>0){n=c[d+16>>2]|0;S=-3.4028234663852886e+38;T=-3.4028234663852886e+38;U=-3.4028234663852886e+38;R=3.4028234663852886e+38;B=3.4028234663852886e+38;A=3.4028234663852886e+38;q=0;do{ca=+g[n+(q<<4)>>2];R=ca<R?ca:R;S=ca>S?ca:S;ca=+g[n+(q<<4)+4>>2];B=ca<B?ca:B;T=ca>T?ca:T;ca=+g[n+(q<<4)+8>>2];A=ca<A?ca:A;U=ca>U?ca:U;q=q+1|0}while((q|0)<(k|0))}else{S=-3.4028234663852886e+38;T=-3.4028234663852886e+38;U=-3.4028234663852886e+38;R=3.4028234663852886e+38;B=3.4028234663852886e+38;A=3.4028234663852886e+38}g[d+100>>2]=S+R;g[d+104>>2]=T+B;g[d+108>>2]=A+U;g[d+112>>2]=0.0;R=S-R;B=T-B;A=U-A;g[d+116>>2]=R;g[d+120>>2]=B;g[d+124>>2]=A;g[d+128>>2]=0.0;z=z/1.7320507764816284;if(R<B)k=B<A?2:1;else k=R<A?2:0;n=d+(k<<2)+116|0;A=(+g[n>>2]*.5-z)*.0009765625;g[d+88>>2]=z;g[d+84>>2]=z;g[d+80>>2]=z;B=+g[n>>2]*.5;n=d+(k<<2)+80|0;g[n>>2]=B;q=0;while(1){if(CD(d)|0){n=470;break}B=B-A;g[n>>2]=B;q=q+1|0;if((q|0)>=1024){n=469;break}}n:do if((n|0)==469){g[d+88>>2]=z;g[d+84>>2]=z;g[d+80>>2]=z}else if((n|0)==470){z=(+g[d+96>>2]-z)*.0009765625;k=1<<k&3;R=+g[d+((1<<k&3)<<2)+80>>2];n=0;while(1){A=+g[d+(k<<2)+80>>2];g[d+(k<<2)+80>>2]=z+A;B=z+ +g[d+((1<<k&3)<<2)+80>>2];g[d+((1<<k&3)<<2)+80>>2]=B;n=n+1|0;if(!(CD(d)|0))break;if((n|0)>=1024)break n;else R=B}g[d+(k<<2)+80>>2]=A;g[d+((1<<k&3)<<2)+80>>2]=R}while(0);if((J|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[J+ -4>>2]|0)}if((L|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[L+ -4>>2]|0)}if((x|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[x+ -4>>2]|0)}if((F|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[F+ -4>>2]|0)}if((o|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[o+ -4>>2]|0)}o=c[l>>2]|0;if((o|0)>0){q=0;do{k=p+(q*36|0)+4|0;n=p+(q*36|0)+12|0;r=c[n>>2]|0;d=p+(q*36|0)+16|0;if((r|0)!=0){if((a[d>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[r+ -4>>2]|0)}c[n>>2]=0}a[d>>0]=1;c[n>>2]=0;c[k>>2]=0;c[p+(q*36|0)+8>>2]=0;q=q+1|0}while((q|0)!=(o|0));p=c[f>>2]|0}if((p|0)!=0){if((a[h+164>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[p+ -4>>2]|0)}c[f>>2]=0}a[h+164>>0]=1;c[f>>2]=0;c[l>>2]=0;c[h+156>>2]=0;if((m|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[m+ -4>>2]|0)}xA(h+196|0);if((j|0)==0){i=h;return 1}c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0);i=h;return 1}function rA(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0,n=0,o=0,p=0.0,q=0.0,r=0;e=i;i=i+2048|0;c[a+0>>2]=0;c[a+4>>2]=0;c[a+8>>2]=0;c[a+12>>2]=0;h=+g[d>>2];j=+g[d+4>>2];k=+g[d+8>>2];if(h*h+j*j+k*k<9999999747378752.0e-20){h=1.0;j=0.0;k=0.0}else{p=1.0/+Q(+(h*h+j*j+k*k));h=h*p;j=j*p;k=k*p}if((Pb[c[(c[b>>2]|0)+96>>2]&127](b)|0)<=0){i=e;return}d=0;l=-999999984306749400.0;do{if(((Pb[c[(c[b>>2]|0)+96>>2]&127](b)|0)-d|0)<128){m=(Pb[c[(c[b>>2]|0)+96>>2]&127](b)|0)-d|0;if((m|0)>0)f=7;else{p=-3.4028234663852886e+38;o=-1}}else{m=128;f=7}if((f|0)==7){f=0;n=0;do{rc[c[(c[b>>2]|0)+108>>2]&127](b,n,e+(n<<4)|0);n=n+1|0}while((n|0)!=(m|0));n=0;p=-3.4028234663852886e+38;o=-1;do{q=h*+g[e+(n<<4)>>2]+j*+g[e+(n<<4)+4>>2]+k*+g[e+(n<<4)+8>>2];r=q>p;o=r?n:o;p=r?q:p;n=n+1|0}while((n|0)!=(m|0))}if(p>l){r=e+(o<<4)|0;c[a+0>>2]=c[r+0>>2];c[a+4>>2]=c[r+4>>2];c[a+8>>2]=c[r+8>>2];c[a+12>>2]=c[r+12>>2];l=p}d=d+128|0}while((d|0)<(Pb[c[(c[b>>2]|0)+96>>2]&127](b)|0));i=e;return}function sA(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0.0,s=0,t=0.0,u=0,v=0.0,w=0.0,x=0.0,y=0;h=i;i=i+2048|0;if((e|0)>0)j=0;else{i=h;return}do{g[d+(j<<4)+12>>2]=-999999984306749400.0;j=j+1|0}while((j|0)!=(e|0));k=0;do{if((Pb[c[(c[a>>2]|0)+96>>2]&127](a)|0)>0){o=b+(k<<4)|0;p=b+(k<<4)+4|0;j=b+(k<<4)+8|0;m=d+(k<<4)+12|0;l=d+(k<<4)|0;n=0;do{if(((Pb[c[(c[a>>2]|0)+96>>2]&127](a)|0)-n|0)<128){q=(Pb[c[(c[a>>2]|0)+96>>2]&127](a)|0)-n|0;if((q|0)>0)f=8;else{w=-3.4028234663852886e+38;s=-1}}else{q=128;f=8}if((f|0)==8){f=0;s=0;do{rc[c[(c[a>>2]|0)+108>>2]&127](a,s,h+(s<<4)|0);s=s+1|0}while((s|0)!=(q|0));t=+g[o>>2];r=+g[p>>2];v=+g[j>>2];u=0;w=-3.4028234663852886e+38;s=-1;do{x=t*+g[h+(u<<4)>>2]+r*+g[h+(u<<4)+4>>2]+v*+g[h+(u<<4)+8>>2];y=x>w;s=y?u:s;w=y?x:w;u=u+1|0}while((u|0)!=(q|0))}if(w>+g[m>>2]){y=h+(s<<4)|0;c[l+0>>2]=c[y+0>>2];c[l+4>>2]=c[y+4>>2];c[l+8>>2]=c[y+8>>2];c[l+12>>2]=c[y+12>>2];g[m>>2]=w}n=n+128|0}while((n|0)<(Pb[c[(c[a>>2]|0)+96>>2]&127](a)|0))}k=k+1|0}while((k|0)!=(e|0));i=h;return}function tA(a,b,d){a=a|0;b=+b;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0;e=i;i=i+96|0;j=+$b[c[(c[a>>2]|0)+48>>2]&15](a);g[e+32>>2]=1.0;c[e+36>>2]=0;c[e+40>>2]=0;c[e+44>>2]=0;c[e+48>>2]=0;g[e+52>>2]=1.0;c[e+56>>2]=0;c[e+60>>2]=0;c[e+64>>2]=0;c[e+68>>2]=0;g[e+72>>2]=1.0;k=e+76|0;c[k+0>>2]=0;c[k+4>>2]=0;c[k+8>>2]=0;c[k+12>>2]=0;c[k+16>>2]=0;vc[c[(c[a>>2]|0)+8>>2]&127](a,e+32|0,e+16|0,e);h=(j+(+g[e>>2]- +g[e+16>>2])*.5)*2.0;f=(j+(+g[e+4>>2]- +g[e+20>>2])*.5)*2.0;j=(j+(+g[e+8>>2]- +g[e+24>>2])*.5)*2.0;g[d>>2]=b*.0833333283662796*(f*f+j*j);g[d+4>>2]=b*.0833333283662796*(h*h+j*j);g[d+8>>2]=b*.0833333283662796*(h*h+f*f);g[d+12>>2]=0.0;i=e;return}function uA(b){b=b|0;var d=0,e=0,f=0,h=0.0;d=i;i=i+96|0;a[b+88>>0]=1;if((a[15960]|0)==0?(Ya(15960)|0)!=0:0){g[3966]=1.0;c[3967]=0;c[3968]=0;c[3969]=0;c[3970]=0;g[3971]=1.0;c[3972]=0;c[3973]=0;c[3974]=0;c[3975]=0;g[3976]=1.0;g[3977]=0.0;g[3978]=-1.0;c[3979]=0;c[3980]=0;c[3981]=0;c[3982]=0;g[3983]=-1.0;c[3984]=0;c[3985]=0;c[3986]=0;c[3987]=0;g[3988]=-1.0;g[3989]=0.0;bb(15960)}f=d+0|0;e=f+96|0;do{c[f>>2]=0;f=f+4|0}while((f|0)<(e|0));vc[c[(c[b>>2]|0)+76>>2]&127](b,15864,d,6);h=+g[b+44>>2];g[b+72>>2]=+g[d>>2]+h;g[b+56>>2]=+g[d+48>>2]-h;g[b+76>>2]=+g[d+20>>2]+h;g[b+60>>2]=+g[d+68>>2]-h;g[b+80>>2]=+g[d+40>>2]+h;g[b+64>>2]=+g[d+88>>2]-h;i=d;return}function vA(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0;f=i;q=+$b[c[(c[a>>2]|0)+48>>2]&15](a);w=+g[a+72>>2];v=+g[a+56>>2];t=+g[a+76>>2];s=+g[a+60>>2];p=+g[a+80>>2];o=+g[a+64>>2];G=+g[b>>2];A=+P(+G);F=+g[b+4>>2];z=+P(+F);m=+g[b+8>>2];n=+P(+m);E=+g[b+16>>2];y=+P(+E);D=+g[b+20>>2];x=+P(+D);k=+g[b+24>>2];l=+P(+k);C=+g[b+32>>2];u=+P(+C);B=+g[b+36>>2];r=+P(+B);h=+g[b+40>>2];j=+P(+h);m=(w+v)*.5*G+(t+s)*.5*F+(p+o)*.5*m+ +g[b+48>>2];k=(w+v)*.5*E+(t+s)*.5*D+(p+o)*.5*k+ +g[b+52>>2];h=(w+v)*.5*C+(t+s)*.5*B+(p+o)*.5*h+ +g[b+56>>2];n=(q+(w-v)*.5)*A+(q+(t-s)*.5)*z+(q+(p-o)*.5)*n;l=(q+(w-v)*.5)*y+(q+(t-s)*.5)*x+(q+(p-o)*.5)*l;j=(q+(w-v)*.5)*u+(q+(t-s)*.5)*r+(q+(p-o)*.5)*j;g[d>>2]=m-n;g[d+4>>2]=k-l;g[d+8>>2]=h-j;g[d+12>>2]=0.0;g[e>>2]=n+m;g[e+4>>2]=l+k;g[e+8>>2]=j+h;g[e+12>>2]=0.0;i=f;return}function wA(b,d){b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0;e=i;if((c[b+8>>2]|0)>=(d|0)){i=e;return}if((d|0)!=0?(c[5004]=(c[5004]|0)+1,f=XE((d*36|3)+16|0)|0,(f|0)!=0):0){c[(f+19&-16)+ -4>>2]=f;f=f+19&-16}else f=0;j=c[b+4>>2]|0;if((j|0)>0){h=0;do{g=f+(h*36|0)|0;if((g|0)!=0){n=c[b+12>>2]|0;yA(g,n+(h*36|0)|0);n=n+(h*36|0)+20|0;c[g+20>>2]=c[n+0>>2];c[g+24>>2]=c[n+4>>2];c[g+28>>2]=c[n+8>>2];c[g+32>>2]=c[n+12>>2]}h=h+1|0}while((h|0)!=(j|0));n=c[b+4>>2]|0;if((n|0)>0){m=0;do{l=c[b+12>>2]|0;h=l+(m*36|0)+4|0;j=l+(m*36|0)+12|0;g=c[j>>2]|0;k=l+(m*36|0)+16|0;if((g|0)!=0){if((a[k>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[g+ -4>>2]|0)}c[j>>2]=0}a[k>>0]=1;c[j>>2]=0;c[h>>2]=0;c[l+(m*36|0)+8>>2]=0;m=m+1|0}while((m|0)!=(n|0));g=b+12|0}else g=b+12|0}else g=b+12|0;h=c[g>>2]|0;if((h|0)!=0){if((a[b+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[g>>2]=0}a[b+16>>0]=1;c[g>>2]=f;c[b+8>>2]=d;i=e;return}function xA(b){b=b|0;var d=0,e=0;d=i;e=c[b+52>>2]|0;if((e|0)!=0){if((a[b+56>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+52>>2]=0}a[b+56>>0]=1;c[b+52>>2]=0;c[b+44>>2]=0;c[b+48>>2]=0;e=c[b+32>>2]|0;if((e|0)!=0){if((a[b+36>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+32>>2]=0}a[b+36>>0]=1;c[b+32>>2]=0;c[b+24>>2]=0;c[b+28>>2]=0;e=c[b+12>>2]|0;if((e|0)==0){a[b+16>>0]=1;c[b+12>>2]=0;c[b+4>>2]=0;e=b+8|0;c[e>>2]=0;i=d;return}if((a[b+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+12>>2]=0;a[b+16>>0]=1;c[b+12>>2]=0;c[b+4>>2]=0;e=b+8|0;c[e>>2]=0;i=d;return}function yA(b,d){b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0;f=i;a[b+16>>0]=1;c[b+12>>2]=0;c[b+4>>2]=0;c[b+8>>2]=0;e=c[d+4>>2]|0;if((e|0)<=0){c[b+4>>2]=e;i=f;return}c[5004]=(c[5004]|0)+1;g=XE((e<<2|3)+16|0)|0;if((g|0)==0)g=0;else{c[(g+19&-16)+ -4>>2]=g;g=g+19&-16}j=c[b+4>>2]|0;if((j|0)>0){h=0;do{k=g+(h<<2)|0;if((k|0)!=0)c[k>>2]=c[(c[b+12>>2]|0)+(h<<2)>>2];h=h+1|0}while((h|0)!=(j|0))}h=c[b+12>>2]|0;if((h|0)!=0){if((a[b+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[b+12>>2]=0}a[b+16>>0]=1;c[b+12>>2]=g;c[b+8>>2]=e;h=0;do{j=g+(h<<2)|0;if((j|0)!=0)c[j>>2]=0;h=h+1|0}while((h|0)!=(e|0));c[b+4>>2]=e;b=0;do{h=g+(b<<2)|0;if((h|0)!=0)c[h>>2]=c[(c[d+12>>2]|0)+(b<<2)>>2];b=b+1|0}while((b|0)!=(e|0));i=f;return}function zA(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0.0,j=0.0,k=0.0,l=0,m=0.0,n=0,o=0,p=0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0;f=i;i=i+32|0;n=c[a+12>>2]|0;h=+g[n+(((e+d|0)/2|0)*24|0)>>2];j=+g[n+(((e+d|0)/2|0)*24|0)+4>>2];k=+g[n+(((e+d|0)/2|0)*24|0)+8>>2];m=+g[n+(((e+d|0)/2|0)*24|0)+16>>2];l=c[n+(((e+d|0)/2|0)*24|0)+20>>2]|0;o=d;p=e;while(1){a:while(1){q=+g[n+(o*24|0)+16>>2];do if(q!=m){if(!(q<m))break a}else{s=+g[b>>2];v=+g[n+(o*24|0)>>2]-s;r=+g[b+4>>2];u=+g[n+(o*24|0)+4>>2]-r;q=+g[b+8>>2];t=+g[n+(o*24|0)+8>>2]-q;if(v*v+u*u+t*t!=(h-s)*(h-s)+(j-r)*(j-r)+(k-q)*(k-q))if(v*v+u*u+t*t<(h-s)*(h-s)+(j-r)*(j-r)+(k-q)*(k-q))break;else break a;else if((c[n+(o*24|0)+20>>2]|0)<(l|0))break;else break a}while(0);o=o+1|0}b:while(1){q=+g[n+(p*24|0)+16>>2];do if(m!=q){if(!(m<q))break b}else{r=+g[b>>2];t=+g[b+4>>2];q=+g[b+8>>2];s=+g[n+(p*24|0)>>2]-r;u=+g[n+(p*24|0)+4>>2]-t;v=+g[n+(p*24|0)+8>>2]-q;if((h-r)*(h-r)+(j-t)*(j-t)+(k-q)*(k-q)!=s*s+u*u+v*v)if((h-r)*(h-r)+(j-t)*(j-t)+(k-q)*(k-q)<s*s+u*u+v*v)break;else break b;else if((l|0)<(c[n+(p*24|0)+20>>2]|0))break;else break b}while(0);p=p+ -1|0}if((o|0)<=(p|0)){w=n+(o*24|0)|0;c[f+0>>2]=c[w+0>>2];c[f+4>>2]=c[w+4>>2];c[f+8>>2]=c[w+8>>2];c[f+12>>2]=c[w+12>>2];c[f+16>>2]=c[w+16>>2];c[f+20>>2]=c[w+20>>2];n=n+(p*24|0)|0;c[w+0>>2]=c[n+0>>2];c[w+4>>2]=c[n+4>>2];c[w+8>>2]=c[n+8>>2];c[w+12>>2]=c[n+12>>2];c[w+16>>2]=c[n+16>>2];c[w+20>>2]=c[n+20>>2];n=(c[a+12>>2]|0)+(p*24|0)|0;c[n+0>>2]=c[f+0>>2];c[n+4>>2]=c[f+4>>2];c[n+8>>2]=c[f+8>>2];c[n+12>>2]=c[f+12>>2];c[n+16>>2]=c[f+16>>2];c[n+20>>2]=c[f+20>>2];o=o+1|0;p=p+ -1|0}if((o|0)>(p|0))break;n=c[a+12>>2]|0}if((p|0)>(d|0))zA(a,b,d,p);if((o|0)>=(e|0)){i=f;return}zA(a,b,o,e);i=f;return}function AA(d,f,h){d=d|0;f=f|0;h=h|0;var j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0.0,t=0.0,u=0.0,v=0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0,F=0.0,G=0,H=0,I=0,J=0,K=0,L=0,M=0.0,N=0.0,O=0.0;j=i;i=i+128|0;m=c[d+56>>2]|0;if((h-f|0)==1){if((a[d+60>>0]|0)==0){E=(c[d+96>>2]|0)+(m<<6)+0|0;v=(c[d+76>>2]|0)+(f<<6)+0|0;r=E+64|0;do{c[E>>2]=c[v>>2];E=E+4|0;v=v+4|0}while((E|0)<(r|0))}else{L=(c[d+136>>2]|0)+(m<<4)|0;K=(c[d+116>>2]|0)+(f<<4)|0;c[L+0>>2]=c[K+0>>2];c[L+4>>2]=c[K+4>>2];c[L+8>>2]=c[K+8>>2];c[L+12>>2]=c[K+12>>2]}c[d+56>>2]=(c[d+56>>2]|0)+1;i=j;return}if((f|0)<(h|0)){o=(a[d+60>>0]|0)==0;t=0.0;u=0.0;A=0.0;p=f;do{if(o){L=c[d+76>>2]|0;y=+g[L+(p<<6)>>2];z=+g[L+(p<<6)+16>>2];w=+g[L+(p<<6)+4>>2];x=+g[L+(p<<6)+20>>2];B=+g[L+(p<<6)+8>>2];s=+g[L+(p<<6)+24>>2]}else{L=c[d+116>>2]|0;w=+g[d+36>>2];B=+g[d+40>>2];F=+g[d+44>>2];z=+g[d+4>>2];x=+g[d+8>>2];s=+g[d+12>>2];y=+(e[L+(p<<4)>>1]|0)/w+z;z=+(e[L+(p<<4)+6>>1]|0)/w+z;w=+(e[L+(p<<4)+2>>1]|0)/B+x;x=+(e[L+(p<<4)+8>>1]|0)/B+x;B=+(e[L+(p<<4)+4>>1]|0)/F+s;s=+(e[L+(p<<4)+10>>1]|0)/F+s}A=A+(z+y)*.5;t=t+(x+w)*.5;u=u+(s+B)*.5;p=p+1|0}while((p|0)!=(h|0));F=1.0/+(h-f|0);s=A*F;t=t*F;u=u*F;if(o){o=c[d+76>>2]|0;w=0.0;z=0.0;F=0.0;p=f;do{B=(+g[o+(p<<6)+16>>2]+ +g[o+(p<<6)>>2])*.5-s;C=(+g[o+(p<<6)+20>>2]+ +g[o+(p<<6)+4>>2])*.5-t;D=(+g[o+(p<<6)+24>>2]+ +g[o+(p<<6)+8>>2])*.5-u;w=w+B*B;z=z+C*C;F=F+D*D;p=p+1|0}while((p|0)!=(h|0));s=+(h-f|0)}else{p=c[d+116>>2]|0;y=+g[d+36>>2];B=+g[d+40>>2];D=+g[d+44>>2];A=+g[d+4>>2];C=+g[d+8>>2];x=+g[d+12>>2];w=0.0;z=0.0;F=0.0;o=f;do{O=(+(e[p+(o<<4)+6>>1]|0)/y+A+(+(e[p+(o<<4)>>1]|0)/y+A))*.5-s;N=(+(e[p+(o<<4)+8>>1]|0)/B+C+(+(e[p+(o<<4)+2>>1]|0)/B+C))*.5-t;M=(+(e[p+(o<<4)+10>>1]|0)/D+x+(+(e[p+(o<<4)+4>>1]|0)/D+x))*.5-u;w=w+O*O;z=z+N*N;F=F+M*M;o=o+1|0}while((o|0)!=(h|0));s=+(h-f|0)}}else{F=0.0;z=0.0;w=0.0;s=+(h-f|0)}u=1.0/(s+-1.0);s=w*u;t=z*u;u=F*u;if(s<t)o=t<u?2:1;else o=s<u?2:0;c[j+16>>2]=0;c[j+20>>2]=0;c[j+24>>2]=0;c[j+28>>2]=0;if((f|0)<(h|0)){q=(a[d+60>>0]|0)==0;u=0.0;t=0.0;s=0.0;p=f;do{if(q){L=c[d+76>>2]|0;z=+g[L+(p<<6)>>2];y=+g[L+(p<<6)+16>>2];w=+g[L+(p<<6)+4>>2];A=+g[L+(p<<6)+20>>2];x=+g[L+(p<<6)+8>>2];B=+g[L+(p<<6)+24>>2]}else{L=c[d+116>>2]|0;w=+g[d+36>>2];x=+g[d+40>>2];O=+g[d+44>>2];y=+g[d+4>>2];A=+g[d+8>>2];B=+g[d+12>>2];z=+(e[L+(p<<4)>>1]|0)/w+y;y=+(e[L+(p<<4)+6>>1]|0)/w+y;w=+(e[L+(p<<4)+2>>1]|0)/x+A;A=+(e[L+(p<<4)+8>>1]|0)/x+A;x=+(e[L+(p<<4)+4>>1]|0)/O+B;B=+(e[L+(p<<4)+10>>1]|0)/O+B}u=u+(y+z)*.5;t=(A+w)*.5+t;s=(B+x)*.5+s;p=p+1|0}while((p|0)!=(h|0));g[j+16>>2]=u;g[j+20>>2]=t;g[j+24>>2]=s}else{u=0.0;t=0.0;s=0.0}g[j+16>>2]=1.0/+(h-f|0)*u;g[j+20>>2]=1.0/+(h-f|0)*t;g[j+24>>2]=1.0/+(h-f|0)*s;s=+g[j+16+(o<<2)>>2];if((f|0)<(h|0)){o=j+(o<<2)|0;q=f;p=f;do{r=(a[d+60>>0]|0)==0;if(r){L=c[d+76>>2]|0;x=+g[L+(q<<6)>>2];y=+g[L+(q<<6)+16>>2];u=+g[L+(q<<6)+4>>2];w=+g[L+(q<<6)+20>>2];t=+g[L+(q<<6)+8>>2];z=+g[L+(q<<6)+24>>2]}else{L=c[d+116>>2]|0;u=+g[d+36>>2];t=+g[d+40>>2];O=+g[d+44>>2];y=+g[d+4>>2];w=+g[d+8>>2];z=+g[d+12>>2];x=+(e[L+(q<<4)>>1]|0)/u+y;y=+(e[L+(q<<4)+6>>1]|0)/u+y;u=+(e[L+(q<<4)+2>>1]|0)/t+w;w=+(e[L+(q<<4)+8>>1]|0)/t+w;t=+(e[L+(q<<4)+4>>1]|0)/O+z;z=+(e[L+(q<<4)+10>>1]|0)/O+z}g[j>>2]=(y+x)*.5;g[j+4>>2]=(w+u)*.5;g[j+8>>2]=(z+t)*.5;g[j+12>>2]=0.0;if(+g[o>>2]>s){if(r){G=c[d+76>>2]|0;H=G+(q<<6)|0;E=j+32|0;v=H+0|0;r=E+64|0;do{c[E>>2]=c[v>>2];E=E+4|0;v=v+4|0}while((E|0)<(r|0));E=H+0|0;v=G+(p<<6)+0|0;r=E+64|0;do{c[E>>2]=c[v>>2];E=E+4|0;v=v+4|0}while((E|0)<(r|0));E=(c[d+76>>2]|0)+(p<<6)+0|0;v=j+32|0;r=E+64|0;do{c[E>>2]=c[v>>2];E=E+4|0;v=v+4|0}while((E|0)<(r|0))}else{K=c[d+116>>2]|0;L=K+(q<<4)|0;c[j+96>>2]=c[L+0>>2];c[j+100>>2]=c[L+4>>2];c[j+104>>2]=c[L+8>>2];c[j+108>>2]=c[L+12>>2];K=K+(p<<4)|0;c[L+0>>2]=c[K+0>>2];c[L+4>>2]=c[K+4>>2];c[L+8>>2]=c[K+8>>2];c[L+12>>2]=c[K+12>>2];L=(c[d+116>>2]|0)+(p<<4)|0;c[L+0>>2]=c[j+96>>2];c[L+4>>2]=c[j+100>>2];c[L+8>>2]=c[j+104>>2];c[L+12>>2]=c[j+108>>2]}p=p+1|0}q=q+1|0}while((q|0)!=(h|0))}else p=f;if(!((p|0)>(((h-f|0)/3|0)+f|0)?(p|0)<(h+ -1-((h-f|0)/3|0)|0):0))p=(h-f>>1)+f|0;o=c[d+56>>2]|0;do if((a[d+60>>0]|0)==0){q=(c[d+96>>2]|0)+(o<<6)|0;c[q+0>>2]=c[d+20>>2];c[q+4>>2]=c[d+24>>2];c[q+8>>2]=c[d+28>>2];c[q+12>>2]=c[d+32>>2];q=c[d+56>>2]|0;if((a[d+60>>0]|0)==0){q=(c[d+96>>2]|0)+(q<<6)+16|0;c[q+0>>2]=c[d+4>>2];c[q+4>>2]=c[d+8>>2];c[q+8>>2]=c[d+12>>2];c[q+12>>2]=c[d+16>>2];q=c[d+56>>2]|0;break}else{r=c[d+136>>2]|0;v=d+4|0;x=+g[d+8>>2];t=+g[d+12>>2];w=+g[d+36>>2];s=+g[d+40>>2];u=+g[d+44>>2];n=46;break}}else{r=c[d+136>>2]|0;x=+g[d+8>>2];t=+g[d+12>>2];w=+g[d+36>>2];s=+g[d+40>>2];N=(+g[d+24>>2]-x)*s;u=+g[d+44>>2];O=(+g[d+28>>2]-t)*u;b[r+(o<<4)>>1]=~~((+g[d+20>>2]- +g[d+4>>2])*w)&65534;b[r+(o<<4)+2>>1]=~~N&65534;b[r+(o<<4)+4>>1]=~~O&65534;q=o;v=d+4|0;n=46}while(0);if((n|0)==46){O=+g[v>>2];b[r+(q<<4)+6>>1]=~~((O-O)*w+1.0)&65535|1;b[r+(q<<4)+8>>1]=~~((x-x)*s+1.0)&65535|1;b[r+(q<<4)+10>>1]=~~((t-t)*u+1.0)&65535|1}if((f|0)<(h|0)){n=a[d+60>>0]|0;r=f;do{if(n<<24>>24==0){v=c[d+76>>2]|0;A=+g[v+(r<<6)>>2];z=+g[v+(r<<6)+4>>2];y=+g[v+(r<<6)+8>>2];x=+g[v+(r<<6)+12>>2];w=+g[v+(r<<6)+16>>2];u=+g[v+(r<<6)+20>>2];t=+g[v+(r<<6)+24>>2];s=+g[v+(r<<6)+28>>2];v=c[d+96>>2]|0;E=v+(q<<6)|0;if(A<+g[E>>2])g[E>>2]=A;E=v+(q<<6)+4|0;if(z<+g[E>>2])g[E>>2]=z;E=v+(q<<6)+8|0;if(y<+g[E>>2])g[E>>2]=y;E=v+(q<<6)+12|0;if(x<+g[E>>2])g[E>>2]=x;E=v+(q<<6)+16|0;if(+g[E>>2]<w)g[E>>2]=w;E=v+(q<<6)+20|0;if(+g[E>>2]<u)g[E>>2]=u;E=v+(q<<6)+24|0;if(+g[E>>2]<t)g[E>>2]=t;v=v+(q<<6)+28|0;if(+g[v>>2]<s)g[v>>2]=s}else{v=c[d+116>>2]|0;w=+g[d+36>>2];A=+g[d+40>>2];F=+g[d+44>>2];x=+g[d+4>>2];B=+g[d+8>>2];M=+g[d+12>>2];y=+g[d+4>>2];C=+g[d+8>>2];N=+g[d+12>>2];z=+g[d+36>>2];D=+g[d+40>>2];O=+g[d+44>>2];K=~~((+(e[v+(r<<4)>>1]|0)/w+x-y)*z)&65534;I=~~((+(e[v+(r<<4)+2>>1]|0)/A+B-C)*D)&65534;G=~~((+(e[v+(r<<4)+4>>1]|0)/F+M-N)*O)&65534;J=(~~((+(e[v+(r<<4)+6>>1]|0)/w+x-y)*z+1.0)&65535|1)&65535;H=(~~((+(e[v+(r<<4)+8>>1]|0)/A+B-C)*D+1.0)&65535|1)&65535;v=(~~((+(e[v+(r<<4)+10>>1]|0)/F+M-N)*O+1.0)&65535|1)&65535;E=c[d+136>>2]|0;L=E+(q<<4)|0;if((e[L>>1]|0)>(K&65535))b[L>>1]=K;K=E+(q<<4)+6|0;if((e[K>>1]|0)<(J&65535))b[K>>1]=J;J=E+(q<<4)+2|0;if((e[J>>1]|0)>(I&65535))b[J>>1]=I;I=E+(q<<4)+8|0;if((e[I>>1]|0)<(H&65535))b[I>>1]=H;H=E+(q<<4)+4|0;if((e[H>>1]|0)>(G&65535))b[H>>1]=G;E=E+(q<<4)+10|0;if((e[E>>1]|0)<(v&65535))b[E>>1]=v}r=r+1|0}while((r|0)!=(h|0))}q=q+1|0;c[d+56>>2]=q;AA(d,f,p);f=c[d+56>>2]|0;AA(d,p,h);h=(c[d+56>>2]|0)-m|0;do if((a[d+60>>0]|0)!=0){if((h<<4|0)>2048){m=c[d+136>>2]|0;p=c[m+(q<<4)+12>>2]|0;p=(p|0)>-1?1:0-p|0;n=c[m+(f<<4)+12>>2]|0;n=(n|0)>-1?1:0-n|0;if((p<<4|0)<2049){r=c[d+152>>2]|0;if((r|0)==(c[d+156>>2]|0)?(l=(r|0)==0?1:r<<1,(r|0)<(l|0)):0){if((l|0)==0){v=0;G=r}else{c[5004]=(c[5004]|0)+1;v=XE(l<<5|19)|0;if((v|0)==0)v=0;else{c[(v+19&-16)+ -4>>2]=v;v=v+19&-16}G=c[d+152>>2]|0}if((G|0)>0){E=0;do{L=v+(E<<5)|0;K=(c[d+160>>2]|0)+(E<<5)|0;c[L+0>>2]=c[K+0>>2];c[L+4>>2]=c[K+4>>2];c[L+8>>2]=c[K+8>>2];c[L+12>>2]=c[K+12>>2];c[L+16>>2]=c[K+16>>2];c[L+20>>2]=c[K+20>>2];c[L+24>>2]=c[K+24>>2];c[L+28>>2]=c[K+28>>2];E=E+1|0}while((E|0)!=(G|0))}E=c[d+160>>2]|0;if((E|0)!=0){if((a[d+164>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[E+ -4>>2]|0)}c[d+160>>2]=0}a[d+164>>0]=1;c[d+160>>2]=v;c[d+156>>2]=l;l=c[d+152>>2]|0}else l=r;c[d+152>>2]=l+1;l=(c[d+160>>2]|0)+(r<<5)|0;c[l+0>>2]=c[j+96>>2];c[l+4>>2]=c[j+100>>2];c[l+8>>2]=c[j+104>>2];c[l+12>>2]=c[j+108>>2];c[l+16>>2]=c[j+112>>2];c[l+20>>2]=c[j+116>>2];c[l+24>>2]=c[j+120>>2];c[l+28>>2]=c[j+124>>2];l=c[d+160>>2]|0;b[l+(r<<5)>>1]=b[m+(q<<4)>>1]|0;b[l+(r<<5)+2>>1]=b[m+(q<<4)+2>>1]|0;b[l+(r<<5)+4>>1]=b[m+(q<<4)+4>>1]|0;b[l+(r<<5)+6>>1]=b[m+(q<<4)+6>>1]|0;b[l+(r<<5)+8>>1]=b[m+(q<<4)+8>>1]|0;b[l+(r<<5)+10>>1]=b[m+(q<<4)+10>>1]|0;c[l+(r<<5)+12>>2]=q;c[l+(r<<5)+16>>2]=p;l=d+152|0}else l=d+152|0;if((n<<4|0)<2049){p=c[l>>2]|0;if((p|0)==(c[d+156>>2]|0)?(k=(p|0)==0?1:p<<1,(p|0)<(k|0)):0){if((k|0)==0){q=0;v=p}else{c[5004]=(c[5004]|0)+1;q=XE(k<<5|19)|0;if((q|0)==0)q=0;else{c[(q+19&-16)+ -4>>2]=q;q=q+19&-16}v=c[l>>2]|0}if((v|0)>0){r=0;do{L=q+(r<<5)|0;K=(c[d+160>>2]|0)+(r<<5)|0;c[L+0>>2]=c[K+0>>2];c[L+4>>2]=c[K+4>>2];c[L+8>>2]=c[K+8>>2];c[L+12>>2]=c[K+12>>2];c[L+16>>2]=c[K+16>>2];c[L+20>>2]=c[K+20>>2];c[L+24>>2]=c[K+24>>2];c[L+28>>2]=c[K+28>>2];r=r+1|0}while((r|0)!=(v|0))}r=c[d+160>>2]|0;if((r|0)!=0){if((a[d+164>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[r+ -4>>2]|0)}c[d+160>>2]=0}a[d+164>>0]=1;c[d+160>>2]=q;c[d+156>>2]=k;k=c[l>>2]|0}else k=p;c[l>>2]=k+1;L=(c[d+160>>2]|0)+(p<<5)|0;c[L+0>>2]=c[j+32>>2];c[L+4>>2]=c[j+36>>2];c[L+8>>2]=c[j+40>>2];c[L+12>>2]=c[j+44>>2];c[L+16>>2]=c[j+48>>2];c[L+20>>2]=c[j+52>>2];c[L+24>>2]=c[j+56>>2];c[L+28>>2]=c[j+60>>2];L=c[d+160>>2]|0;b[L+(p<<5)>>1]=b[m+(f<<4)>>1]|0;b[L+(p<<5)+2>>1]=b[m+(f<<4)+2>>1]|0;b[L+(p<<5)+4>>1]=b[m+(f<<4)+4>>1]|0;b[L+(p<<5)+6>>1]=b[m+(f<<4)+6>>1]|0;b[L+(p<<5)+8>>1]=b[m+(f<<4)+8>>1]|0;b[L+(p<<5)+10>>1]=b[m+(f<<4)+10>>1]|0;c[L+(p<<5)+12>>2]=f;c[L+(p<<5)+16>>2]=n}c[d+168>>2]=c[l>>2];if((a[d+60>>0]|0)==0)break;else d=d+136|0}else d=d+136|0;c[(c[d>>2]|0)+(o<<4)+12>>2]=0-h;i=j;return}while(0);c[(c[d+96>>2]|0)+(o<<6)+32>>2]=h;i=j;return}function BA(a){a=a|0;var b=0;b=i;CA(a);if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function CA(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=16080;e=c[b+160>>2]|0;if((e|0)!=0){if((a[b+164>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+160>>2]=0}a[b+164>>0]=1;c[b+160>>2]=0;c[b+152>>2]=0;c[b+156>>2]=0;e=c[b+136>>2]|0;if((e|0)!=0){if((a[b+140>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+136>>2]=0}a[b+140>>0]=1;c[b+136>>2]=0;c[b+128>>2]=0;c[b+132>>2]=0;e=c[b+116>>2]|0;if((e|0)!=0){if((a[b+120>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+116>>2]=0}a[b+120>>0]=1;c[b+116>>2]=0;c[b+108>>2]=0;c[b+112>>2]=0;e=c[b+96>>2]|0;if((e|0)!=0){if((a[b+100>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+96>>2]=0}a[b+100>>0]=1;c[b+96>>2]=0;c[b+88>>2]=0;c[b+92>>2]=0;e=c[b+76>>2]|0;if((e|0)==0){a[b+80>>0]=1;c[b+76>>2]=0;c[b+68>>2]=0;e=b+72|0;c[e>>2]=0;i=d;return}if((a[b+80>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+76>>2]=0;a[b+80>>0]=1;c[b+76>>2]=0;c[b+68>>2]=0;e=b+72|0;c[e>>2]=0;i=d;return}function DA(a,b,d,f){a=a|0;b=b|0;d=d|0;f=f|0;var g=0,h=0,j=0;g=i;while(1){j=c[a+12>>2]|0;if(!(((e[f>>1]|0)>=(e[a>>1]|0)?(e[d>>1]|0)<=(e[a+6>>1]|0):0)&(e[d+4>>1]|0)<=(e[a+10>>1]|0)&(e[f+4>>1]|0)>=(e[a+4>>1]|0)&(e[d+2>>1]|0)<=(e[a+8>>1]|0)&(e[f+2>>1]|0)>=(e[a+2>>1]|0))){h=8;break}if((j|0)>-1)break;DA(a+16|0,b,d,f);j=c[a+28>>2]|0;if((j|0)>-1){a=a+32|0;continue}else{a=a+(1-j<<4)|0;continue}}if((h|0)==8){i=g;return}rc[c[(c[b>>2]|0)+8>>2]&127](b,j>>21,j&2097151);i=g;return}function EA(a,b,d,e,f,h,j,k){a=a|0;b=b|0;d=d|0;e=+e;f=+f;h=+h;j=j|0;k=k|0;var l=0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0,x=0,y=0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0,L=0,M=0,N=0,O=0.0,P=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0,W=0,X=0,Y=0;l=i;i=i+32|0;o=+g[d>>2];p=+g[d+4>>2];I=+g[d+8>>2];U=+g[j>>2];u=(o>e?e:o)+U;O=+g[j+4>>2];q=(p>f?f:p)+O;P=+g[j+8>>2];s=(I>h?h:I)+P;R=+g[k>>2];v=(o<e?e:o)+R;S=+g[k+4>>2];r=(p<f?f:p)+S;T=+g[k+8>>2];t=(I<h?h:I)+T;n=1.0/+Q(+((e-o)*(e-o)+(f-p)*(f-p)+(h-I)*(h-I)));if((e-o)*n==0.0)B=999999984306749400.0;else B=1.0/((e-o)*n);if((f-p)*n==0.0)A=999999984306749400.0;else A=1.0/((f-p)*n);if((h-I)*n==0.0)z=999999984306749400.0;else z=1.0/((h-I)*n);x=B<0.0&1;w=A<0.0&1;y=z<0.0&1;K=c[a+56>>2]|0;a:do if((K|0)>0){N=0;M=c[a+96>>2]|0;L=1;while(1){c[l+0>>2]=c[M+0>>2];c[l+4>>2]=c[M+4>>2];c[l+8>>2]=c[M+8>>2];c[l+12>>2]=c[M+12>>2];Y=M+16|0;c[l+16>>2]=c[Y+0>>2];c[l+20>>2]=c[Y+4>>2];c[l+24>>2]=c[Y+8>>2];c[l+28>>2]=c[Y+12>>2];g[l>>2]=+g[l>>2]-R;g[l+4>>2]=+g[l+4>>2]-S;g[l+8>>2]=+g[l+8>>2]-T;g[l+16>>2]=+g[l+16>>2]-U;g[l+20>>2]=+g[l+20>>2]-O;g[l+24>>2]=+g[l+24>>2]-P;if(!(u>+g[Y>>2])?!(v<+g[M>>2]):0)V=1;else V=0;if(!(!(s>+g[M+24>>2])?!(t<+g[M+8>>2]):0))V=0;if((((!(q>+g[M+20>>2])?!(r<+g[M+4>>2]|V^1):0)?(J=+g[d>>2],H=B*(+g[l+(x<<4)>>2]-J),J=B*(+g[l+((x^1)<<4)>>2]-J),m=+g[d+4>>2],G=A*(+g[l+(w<<4)+4>>2]-m),m=A*(+g[l+((w^1)<<4)+4>>2]-m),!(H>m|G>J)):0)?(F=G>H?G:H,D=m<J?m:J,C=+g[d+8>>2],E=z*(+g[l+(y<<4)+8>>2]-C),C=z*(+g[l+((y^1)<<4)+8>>2]-C),!(F>C|E>D)):0)?(E>F?E:F)<(h-I)*(h-I)*n+((e-o)*(e-o)*n+(f-p)*(f-p)*n):0){Y=(C<D?C:D)>0.0;W=c[M+32>>2]|0;if((W|0)==-1&Y){rc[c[(c[b>>2]|0)+8>>2]&127](b,c[M+36>>2]|0,c[M+40>>2]|0);K=c[a+56>>2]|0;V=24}else{X=(W|0)==-1;V=23}}else{W=c[M+32>>2]|0;X=(W|0)==-1;Y=0;V=23}if((V|0)==23){V=0;if(Y|X)V=24;else{N=W+N|0;M=M+(W<<6)|0}}if((V|0)==24){N=N+1|0;M=M+64|0}if((N|0)>=(K|0))break a;O=+g[j+4>>2];P=+g[j+8>>2];R=+g[k>>2];S=+g[k+4>>2];T=+g[k+8>>2];U=+g[j>>2];L=L+1|0}}else L=0;while(0);if((c[4028]|0)>=(L|0)){i=l;return}c[4028]=L;i=l;return}function FA(a,d,f,h,j,k,l,m,n){a=a|0;d=d|0;f=f|0;h=+h;j=+j;k=+k;l=l|0;m=m|0;n=n|0;var o=0,p=0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0,F=0.0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=0,Z=0.0,_=0.0,$=0.0,aa=0.0,ba=0.0,ca=0.0,da=0.0,ea=0.0,fa=0.0,ga=0.0,ha=0.0,ia=0.0,ja=0.0,ka=0.0,la=0.0;o=i;i=i+32|0;r=+g[f>>2];s=+g[f+4>>2];F=+g[f+8>>2];q=1.0/+Q(+((h-r)*(h-r)+(j-s)*(j-s)+(k-F)*(k-F)));if((h-r)*q==0.0)B=999999984306749400.0;else B=1.0/((h-r)*q);if((j-s)*q==0.0)C=999999984306749400.0;else C=1.0/((j-s)*q);if((k-F)*q==0.0)D=999999984306749400.0;else D=1.0/((k-F)*q);p=B<0.0&1;G=C<0.0&1;E=D<0.0&1;la=(r>h?h:r)+ +g[l>>2];ka=(s>j?j:s)+ +g[l+4>>2];ja=(F>k?k:F)+ +g[l+8>>2];ha=(r<h?h:r)+ +g[m>>2];da=(s<j?j:s)+ +g[m+4>>2];$=(F<k?k:F)+ +g[m+8>>2];ga=+g[a+4>>2];la=la<ga?ga:la;ca=+g[a+8>>2];ka=ka<ca?ca:ka;_=+g[a+12>>2];ja=ja<_?_:ja;ia=+g[a+20>>2];ea=+g[a+24>>2];aa=+g[a+28>>2];fa=+g[a+36>>2];ba=+g[a+40>>2];Z=+g[a+44>>2];I=~~(((ia<la?ia:la)-ga)*fa)&65534;L=~~(((ea<ka?ea:ka)-ca)*ba)&65534;J=~~(((aa<ja?aa:ja)-_)*Z)&65534;ha=ha<ga?ga:ha;da=da<ca?ca:da;$=$<_?_:$;H=(~~(((ia<ha?ia:ha)-ga)*fa+1.0)&65535|1)&65535;M=(~~(((ea<da?ea:da)-ca)*ba+1.0)&65535|1)&65535;K=(~~(((aa<$?aa:$)-_)*Z+1.0)&65535|1)&65535;if((n|0)>0){N=0;P=c[a+136>>2]|0;O=0;do{O=O+1|0;T=P+6|0;X=b[P>>1]|0;Y=P+10|0;V=b[P+4>>1]|0;U=P+8|0;W=b[P+2>>1]|0;R=P+12|0;S=(c[R>>2]|0)>-1;if(((((H&65535)>=(X&65535)?(I&65535)<=(e[T>>1]|0):0)&(J&65535)<=(e[Y>>1]|0)&(K&65535)>=(V&65535)&(L&65535)<=(e[U>>1]|0)&(M&65535)>=(W&65535)?(ha=+g[a+36>>2],ja=+g[a+40>>2],la=+g[a+44>>2],ia=+g[a+4>>2],ka=+g[a+8>>2],x=+g[a+12>>2],g[o+12>>2]=0.0,z=+(e[T>>1]|0)/ha+ia,y=+(e[U>>1]|0)/ja+ka,A=+(e[Y>>1]|0)/la+x,g[o+28>>2]=0.0,g[o>>2]=+(X&65535)/ha+ia- +g[m>>2],g[o+4>>2]=+(W&65535)/ja+ka- +g[m+4>>2],g[o+8>>2]=+(V&65535)/la+x- +g[m+8>>2],g[o+16>>2]=z- +g[l>>2],g[o+20>>2]=y- +g[l+4>>2],g[o+24>>2]=A- +g[l+8>>2],A=+g[f>>2],y=B*(+g[o+(p<<4)>>2]-A),A=B*(+g[o+((p^1)<<4)>>2]-A),z=+g[f+4>>2],x=C*(+g[o+(G<<4)+4>>2]-z),z=C*(+g[o+((G^1)<<4)+4>>2]-z),!(y>z|x>A)):0)?(w=x>y?x:y,u=z<A?z:A,t=+g[f+8>>2],v=D*(+g[o+(E<<4)+8>>2]-t),t=D*(+g[o+((E^1)<<4)+8>>2]-t),!(w>t|v>u)):0)?(v>w?v:w)<(k-F)*(k-F)*q+((h-r)*(h-r)*q+(j-s)*(j-s)*q):0){U=!((t<u?t:u)>0.0);if(U|S^1)T=15;else{T=c[R>>2]|0;rc[c[(c[d>>2]|0)+8>>2]&127](d,T>>21,T&2097151);T=16}}else{U=1;T=15}if((T|0)==15){T=0;if(S|U^1)T=16;else{Y=c[R>>2]|0;N=N-Y|0;P=P+(0-Y<<4)|0}}if((T|0)==16){N=N+1|0;P=P+16|0}}while((N|0)<(n|0))}else O=0;if((c[4028]|0)>=(O|0)){i=o;return}c[4028]=O;i=o;return}function GA(d,f,h,j){d=d|0;f=f|0;h=h|0;j=j|0;var k=0,l=0,m=0,n=0,o=0,p=0,q=0;h=i;c[d+168>>2]=c[d+152>>2];c[f>>2]=16080;c[f+52>>2]=282;a[f+60>>0]=0;a[f+80>>0]=1;c[f+76>>2]=0;c[f+68>>2]=0;c[f+72>>2]=0;a[f+100>>0]=1;c[f+96>>2]=0;c[f+88>>2]=0;c[f+92>>2]=0;a[f+120>>0]=1;c[f+116>>2]=0;c[f+108>>2]=0;c[f+112>>2]=0;a[f+140>>0]=1;c[f+136>>2]=0;c[f+128>>2]=0;c[f+132>>2]=0;c[f+144>>2]=0;a[f+164>>0]=1;c[f+160>>2]=0;c[f+152>>2]=0;c[f+156>>2]=0;c[f+168>>2]=0;g[f+4>>2]=-3.4028234663852886e+38;g[f+8>>2]=-3.4028234663852886e+38;g[f+12>>2]=-3.4028234663852886e+38;g[f+16>>2]=0.0;g[f+20>>2]=3.4028234663852886e+38;g[f+24>>2]=3.4028234663852886e+38;g[f+28>>2]=3.4028234663852886e+38;g[f+32>>2]=0.0;k=c[d+56>>2]|0;if(j){c[f+56>>2]=eF(k|0)|0;a[f+4>>0]=a[d+7>>0]|0;a[f+5>>0]=a[d+6>>0]|0;a[f+6>>0]=a[d+5>>0]|0;a[f+7>>0]=a[d+4>>0]|0;a[f+8>>0]=a[d+11>>0]|0;a[f+9>>0]=a[d+10>>0]|0;a[f+10>>0]=a[d+9>>0]|0;a[f+11>>0]=a[d+8>>0]|0;a[f+12>>0]=a[d+15>>0]|0;a[f+13>>0]=a[d+14>>0]|0;a[f+14>>0]=a[d+13>>0]|0;a[f+15>>0]=a[d+12>>0]|0;a[f+16>>0]=a[d+19>>0]|0;a[f+17>>0]=a[d+18>>0]|0;a[f+18>>0]=a[d+17>>0]|0;a[f+19>>0]=a[d+16>>0]|0;a[f+20>>0]=a[d+23>>0]|0;a[f+21>>0]=a[d+22>>0]|0;a[f+22>>0]=a[d+21>>0]|0;a[f+23>>0]=a[d+20>>0]|0;a[f+24>>0]=a[d+27>>0]|0;a[f+25>>0]=a[d+26>>0]|0;a[f+26>>0]=a[d+25>>0]|0;a[f+27>>0]=a[d+24>>0]|0;a[f+28>>0]=a[d+31>>0]|0;a[f+29>>0]=a[d+30>>0]|0;a[f+30>>0]=a[d+29>>0]|0;a[f+31>>0]=a[d+28>>0]|0;a[f+32>>0]=a[d+35>>0]|0;a[f+33>>0]=a[d+34>>0]|0;a[f+34>>0]=a[d+33>>0]|0;a[f+35>>0]=a[d+32>>0]|0;a[f+36>>0]=a[d+39>>0]|0;a[f+37>>0]=a[d+38>>0]|0;a[f+38>>0]=a[d+37>>0]|0;a[f+39>>0]=a[d+36>>0]|0;a[f+40>>0]=a[d+43>>0]|0;a[f+41>>0]=a[d+42>>0]|0;a[f+42>>0]=a[d+41>>0]|0;a[f+43>>0]=a[d+40>>0]|0;a[f+44>>0]=a[d+47>>0]|0;a[f+45>>0]=a[d+46>>0]|0;a[f+46>>0]=a[d+45>>0]|0;a[f+47>>0]=a[d+44>>0]|0;a[f+48>>0]=a[d+51>>0]|0;a[f+49>>0]=a[d+50>>0]|0;a[f+50>>0]=a[d+49>>0]|0;a[f+51>>0]=a[d+48>>0]|0;c[f+144>>2]=eF(c[d+144>>2]|0)|0;k=eF(c[d+168>>2]|0)|0}else{c[f+56>>2]=k;c[f+4>>2]=c[d+4>>2];c[f+8>>2]=c[d+8>>2];c[f+12>>2]=c[d+12>>2];c[f+16>>2]=c[d+16>>2];c[f+20>>2]=c[d+20>>2];c[f+24>>2]=c[d+24>>2];c[f+28>>2]=c[d+28>>2];c[f+32>>2]=c[d+32>>2];c[f+36>>2]=c[d+36>>2];c[f+40>>2]=c[d+40>>2];c[f+44>>2]=c[d+44>>2];c[f+48>>2]=c[d+48>>2];c[f+144>>2]=c[d+144>>2];k=c[d+168>>2]|0}c[f+168>>2]=k;a[f+60>>0]=a[d+60>>0]|0;k=c[d+56>>2]|0;if((a[d+60>>0]|0)==0){l=c[f+96>>2]|0;if((l|0)!=0){if((a[f+100>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[l+ -4>>2]|0)}c[f+96>>2]=0}c[f+88>>2]=0;c[f+92>>2]=0;c[f+96>>2]=0;a[f+100>>0]=0;c[f+96>>2]=f+172;c[f+88>>2]=k;c[f+92>>2]=k;if(j)if((k|0)>0){l=c[d+96>>2]|0;n=f+172|0;m=0;do{o=l+(m<<6)|0;q=n+(m<<6)|0;a[q>>0]=a[o+3>>0]|0;a[q+1>>0]=a[o+2>>0]|0;a[q+2>>0]=a[o+1>>0]|0;a[q+3>>0]=a[o>>0]|0;q=l+(m<<6)+4|0;o=n+(m<<6)+4|0;a[o>>0]=a[q+3>>0]|0;a[o+1>>0]=a[q+2>>0]|0;a[o+2>>0]=a[q+1>>0]|0;a[o+3>>0]=a[q>>0]|0;o=l+(m<<6)+8|0;q=n+(m<<6)+8|0;a[q>>0]=a[o+3>>0]|0;a[q+1>>0]=a[o+2>>0]|0;a[q+2>>0]=a[o+1>>0]|0;a[q+3>>0]=a[o>>0]|0;q=l+(m<<6)+12|0;n=n+(m<<6)+12|0;a[n>>0]=a[q+3>>0]|0;a[n+1>>0]=a[q+2>>0]|0;a[n+2>>0]=a[q+1>>0]|0;a[n+3>>0]=a[q>>0]|0;n=c[d+96>>2]|0;q=n+(m<<6)+16|0;o=c[f+96>>2]|0;p=o+(m<<6)+16|0;a[p>>0]=a[q+3>>0]|0;a[p+1>>0]=a[q+2>>0]|0;a[p+2>>0]=a[q+1>>0]|0;a[p+3>>0]=a[q>>0]|0;p=n+(m<<6)+20|0;q=o+(m<<6)+20|0;a[q>>0]=a[p+3>>0]|0;a[q+1>>0]=a[p+2>>0]|0;a[q+2>>0]=a[p+1>>0]|0;a[q+3>>0]=a[p>>0]|0;q=n+(m<<6)+24|0;p=o+(m<<6)+24|0;a[p>>0]=a[q+3>>0]|0;a[p+1>>0]=a[q+2>>0]|0;a[p+2>>0]=a[q+1>>0]|0;a[p+3>>0]=a[q>>0]|0;n=n+(m<<6)+28|0;o=o+(m<<6)+28|0;a[o>>0]=a[n+3>>0]|0;a[o+1>>0]=a[n+2>>0]|0;a[o+2>>0]=a[n+1>>0]|0;a[o+3>>0]=a[n>>0]|0;l=c[d+96>>2]|0;o=eF(c[l+(m<<6)+32>>2]|0)|0;n=c[f+96>>2]|0;c[n+(m<<6)+32>>2]=o;c[n+(m<<6)+36>>2]=eF(c[l+(m<<6)+36>>2]|0)|0;c[n+(m<<6)+40>>2]=eF(c[l+(m<<6)+40>>2]|0)|0;m=m+1|0}while((m|0)!=(k|0))}else n=f+172|0;else if((k|0)>0){n=f+172|0;l=c[d+96>>2]|0;m=0;do{n=n+(m<<6)|0;q=l+(m<<6)|0;c[n+0>>2]=c[q+0>>2];c[n+4>>2]=c[q+4>>2];c[n+8>>2]=c[q+8>>2];c[n+12>>2]=c[q+12>>2];n=(c[f+96>>2]|0)+(m<<6)+16|0;q=(c[d+96>>2]|0)+(m<<6)+16|0;c[n+0>>2]=c[q+0>>2];c[n+4>>2]=c[q+4>>2];c[n+8>>2]=c[q+8>>2];c[n+12>>2]=c[q+12>>2];l=c[d+96>>2]|0;n=c[f+96>>2]|0;c[n+(m<<6)+32>>2]=c[l+(m<<6)+32>>2];c[n+(m<<6)+36>>2]=c[l+(m<<6)+36>>2];c[n+(m<<6)+40>>2]=c[l+(m<<6)+40>>2];m=m+1|0}while((m|0)!=(k|0))}else n=f+172|0;if((n|0)!=0){if((a[f+100>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[n+ -4>>2]|0)}c[f+96>>2]=0}c[f+88>>2]=0;c[f+92>>2]=0;c[f+96>>2]=0;a[f+100>>0]=0;k=k<<6}else{l=c[f+136>>2]|0;if((l|0)!=0){if((a[f+140>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[l+ -4>>2]|0)}c[f+136>>2]=0}c[f+128>>2]=0;c[f+132>>2]=0;c[f+136>>2]=0;a[f+140>>0]=0;c[f+136>>2]=f+172;c[f+128>>2]=k;c[f+132>>2]=k;if(j){if((k|0)>0){l=c[d+136>>2]|0;m=0;do{q=e[l+(m<<4)>>1]|0;b[f+172+(m<<4)>>1]=q>>>8|q<<8;q=e[l+(m<<4)+2>>1]|0;b[f+172+(m<<4)+2>>1]=q>>>8|q<<8;q=e[l+(m<<4)+4>>1]|0;b[f+172+(m<<4)+4>>1]=q>>>8|q<<8;q=e[l+(m<<4)+6>>1]|0;b[f+172+(m<<4)+6>>1]=q>>>8|q<<8;q=e[l+(m<<4)+8>>1]|0;b[f+172+(m<<4)+8>>1]=q>>>8|q<<8;q=e[l+(m<<4)+10>>1]|0;b[f+172+(m<<4)+10>>1]=q>>>8|q<<8;c[f+172+(m<<4)+12>>2]=eF(c[l+(m<<4)+12>>2]|0)|0;m=m+1|0}while((m|0)!=(k|0))}}else if((k|0)>0){l=c[d+136>>2]|0;m=0;do{b[f+172+(m<<4)>>1]=b[l+(m<<4)>>1]|0;b[f+172+(m<<4)+2>>1]=b[l+(m<<4)+2>>1]|0;b[f+172+(m<<4)+4>>1]=b[l+(m<<4)+4>>1]|0;b[f+172+(m<<4)+6>>1]=b[l+(m<<4)+6>>1]|0;b[f+172+(m<<4)+8>>1]=b[l+(m<<4)+8>>1]|0;b[f+172+(m<<4)+10>>1]=b[l+(m<<4)+10>>1]|0;c[f+172+(m<<4)+12>>2]=c[l+(m<<4)+12>>2];m=m+1|0}while((m|0)!=(k|0))}c[f+128>>2]=0;c[f+132>>2]=0;c[f+136>>2]=0;a[f+140>>0]=0;k=k<<4}k=f+(k+172)|0;m=c[d+168>>2]|0;l=c[f+160>>2]|0;if((l|0)!=0){if((a[f+164>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[l+ -4>>2]|0)}c[f+160>>2]=0}c[f+152>>2]=0;c[f+156>>2]=0;c[f+160>>2]=0;a[f+164>>0]=0;c[f+160>>2]=k;c[f+152>>2]=m;c[f+156>>2]=m;l=(c[d+168>>2]|0)>0;if(j){if(!l){c[f>>2]=0;c[f+152>>2]=0;c[f+156>>2]=0;c[f+160>>2]=0;a[f+164>>0]=0;i=h;return 1}l=c[d+160>>2]|0;j=0;do{q=e[l+(j<<5)>>1]|0;b[k+(j<<5)>>1]=q>>>8|q<<8;q=e[l+(j<<5)+2>>1]|0;b[k+(j<<5)+2>>1]=q>>>8|q<<8;q=e[l+(j<<5)+4>>1]|0;b[k+(j<<5)+4>>1]=q>>>8|q<<8;q=e[l+(j<<5)+6>>1]|0;b[k+(j<<5)+6>>1]=q>>>8|q<<8;q=e[l+(j<<5)+8>>1]|0;b[k+(j<<5)+8>>1]=q>>>8|q<<8;q=e[l+(j<<5)+10>>1]|0;b[k+(j<<5)+10>>1]=q>>>8|q<<8;c[k+(j<<5)+12>>2]=eF(c[l+(j<<5)+12>>2]|0)|0;c[k+(j<<5)+16>>2]=eF(c[l+(j<<5)+16>>2]|0)|0;j=j+1|0}while((j|0)<(c[d+168>>2]|0));c[f>>2]=0;c[f+152>>2]=0;c[f+156>>2]=0;c[f+160>>2]=0;a[f+164>>0]=0;i=h;return 1}else{if(!l){c[f>>2]=0;c[f+152>>2]=0;c[f+156>>2]=0;c[f+160>>2]=0;a[f+164>>0]=0;i=h;return 1}j=c[d+160>>2]|0;l=0;do{b[k+(l<<5)>>1]=b[j+(l<<5)>>1]|0;b[k+(l<<5)+2>>1]=b[j+(l<<5)+2>>1]|0;b[k+(l<<5)+4>>1]=b[j+(l<<5)+4>>1]|0;b[k+(l<<5)+6>>1]=b[j+(l<<5)+6>>1]|0;b[k+(l<<5)+8>>1]=b[j+(l<<5)+8>>1]|0;b[k+(l<<5)+10>>1]=b[j+(l<<5)+10>>1]|0;c[k+(l<<5)+12>>2]=c[j+(l<<5)+12>>2];c[k+(l<<5)+16>>2]=c[j+(l<<5)+16>>2];c[k+(l<<5)+20>>2]=0;c[k+(l<<5)+24>>2]=0;c[k+(l<<5)+28>>2]=0;l=l+1|0}while((l|0)<(c[d+168>>2]|0));c[f>>2]=0;c[f+152>>2]=0;c[f+156>>2]=0;c[f+160>>2]=0;a[f+164>>0]=0;i=h;return 1}return 0}function HA(d,e){d=d|0;e=e|0;var f=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0;f=i;i=i+112|0;g[d+20>>2]=+g[e+16>>2];g[d+24>>2]=+g[e+20>>2];g[d+28>>2]=+g[e+24>>2];g[d+32>>2]=+g[e+28>>2];g[d+4>>2]=+g[e>>2];g[d+8>>2]=+g[e+4>>2];g[d+12>>2]=+g[e+8>>2];g[d+16>>2]=+g[e+12>>2];g[d+36>>2]=+g[e+32>>2];g[d+40>>2]=+g[e+36>>2];g[d+44>>2]=+g[e+40>>2];g[d+48>>2]=+g[e+44>>2];c[d+56>>2]=c[e+48>>2];a[d+60>>0]=(c[e+52>>2]|0)!=0&1;h=c[e+56>>2]|0;l=f+48|0;m=l+64|0;do{c[l>>2]=0;l=l+4|0}while((l|0)<(m|0));j=c[d+88>>2]|0;if((j|0)<(h|0)){if((c[d+92>>2]|0)<(h|0)){if((h|0)==0){n=0;o=j}else{c[5004]=(c[5004]|0)+1;k=XE(h<<6|19)|0;if((k|0)==0)n=0;else{c[(k+19&-16)+ -4>>2]=k;n=k+19&-16}o=c[d+88>>2]|0}if((o|0)>0){p=0;do{l=n+(p<<6)+0|0;k=(c[d+96>>2]|0)+(p<<6)+0|0;m=l+64|0;do{c[l>>2]=c[k>>2];l=l+4|0;k=k+4|0}while((l|0)<(m|0));p=p+1|0}while((p|0)!=(o|0))}k=c[d+96>>2]|0;if((k|0)!=0){if((a[d+100>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[k+ -4>>2]|0)}c[d+96>>2]=0}a[d+100>>0]=1;c[d+96>>2]=n;c[d+92>>2]=h;n=d+96|0}else n=d+96|0;do{l=(c[n>>2]|0)+(j<<6)+0|0;k=f+48|0;m=l+64|0;do{c[l>>2]=c[k>>2];l=l+4|0;k=k+4|0}while((l|0)<(m|0));j=j+1|0}while((j|0)!=(h|0))}c[d+88>>2]=h;if((h|0)>0){l=c[d+96>>2]|0;j=0;k=c[e+64>>2]|0;while(1){g[l+(j<<6)+16>>2]=+g[k+16>>2];g[l+(j<<6)+20>>2]=+g[k+20>>2];g[l+(j<<6)+24>>2]=+g[k+24>>2];g[l+(j<<6)+28>>2]=+g[k+28>>2];g[l+(j<<6)>>2]=+g[k>>2];g[l+(j<<6)+4>>2]=+g[k+4>>2];g[l+(j<<6)+8>>2]=+g[k+8>>2];g[l+(j<<6)+12>>2]=+g[k+12>>2];c[l+(j<<6)+32>>2]=c[k+32>>2];c[l+(j<<6)+36>>2]=c[k+36>>2];c[l+(j<<6)+40>>2]=c[k+40>>2];j=j+1|0;if((j|0)==(h|0))break;else k=k+48|0}}h=c[e+60>>2]|0;c[f+32>>2]=0;c[f+36>>2]=0;c[f+40>>2]=0;c[f+44>>2]=0;j=c[d+128>>2]|0;if((j|0)<(h|0)){if((c[d+132>>2]|0)<(h|0)){if((h|0)==0){k=0;l=j}else{c[5004]=(c[5004]|0)+1;k=XE((h<<4|3)+16|0)|0;if((k|0)==0)k=0;else{c[(k+19&-16)+ -4>>2]=k;k=k+19&-16}l=c[d+128>>2]|0}if((l|0)>0){m=0;do{p=k+(m<<4)|0;o=(c[d+136>>2]|0)+(m<<4)|0;c[p+0>>2]=c[o+0>>2];c[p+4>>2]=c[o+4>>2];c[p+8>>2]=c[o+8>>2];c[p+12>>2]=c[o+12>>2];m=m+1|0}while((m|0)!=(l|0))}l=c[d+136>>2]|0;if((l|0)!=0){if((a[d+140>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[l+ -4>>2]|0)}c[d+136>>2]=0}a[d+140>>0]=1;c[d+136>>2]=k;c[d+132>>2]=h;k=d+136|0}else k=d+136|0;do{p=(c[k>>2]|0)+(j<<4)|0;c[p+0>>2]=c[f+32>>2];c[p+4>>2]=c[f+36>>2];c[p+8>>2]=c[f+40>>2];c[p+12>>2]=c[f+44>>2];j=j+1|0}while((j|0)!=(h|0))}c[d+128>>2]=h;if((h|0)>0){k=c[d+136>>2]|0;j=0;l=c[e+68>>2]|0;while(1){c[k+(j<<4)+12>>2]=c[l+12>>2];b[k+(j<<4)+6>>1]=b[l+6>>1]|0;b[k+(j<<4)+8>>1]=b[l+8>>1]|0;b[k+(j<<4)+10>>1]=b[l+10>>1]|0;b[k+(j<<4)>>1]=b[l>>1]|0;b[k+(j<<4)+2>>1]=b[l+2>>1]|0;b[k+(j<<4)+4>>1]=b[l+4>>1]|0;j=j+1|0;if((j|0)==(h|0))break;else l=l+16|0}}c[d+144>>2]=c[e+76>>2];h=c[e+80>>2]|0;j=c[d+152>>2]|0;if((j|0)<(h|0)){if((c[d+156>>2]|0)<(h|0)){if((h|0)==0){k=0;l=j}else{c[5004]=(c[5004]|0)+1;k=XE(h<<5|19)|0;if((k|0)==0)k=0;else{c[(k+19&-16)+ -4>>2]=k;k=k+19&-16}l=c[d+152>>2]|0}if((l|0)>0){m=0;do{p=k+(m<<5)|0;o=(c[d+160>>2]|0)+(m<<5)|0;c[p+0>>2]=c[o+0>>2];c[p+4>>2]=c[o+4>>2];c[p+8>>2]=c[o+8>>2];c[p+12>>2]=c[o+12>>2];c[p+16>>2]=c[o+16>>2];c[p+20>>2]=c[o+20>>2];c[p+24>>2]=c[o+24>>2];c[p+28>>2]=c[o+28>>2];m=m+1|0}while((m|0)!=(l|0))}l=c[d+160>>2]|0;if((l|0)!=0){if((a[d+164>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[l+ -4>>2]|0)}c[d+160>>2]=0}a[d+164>>0]=1;c[d+160>>2]=k;c[d+156>>2]=h;k=d+160|0}else k=d+160|0;do{p=(c[k>>2]|0)+(j<<5)|0;c[p+0>>2]=c[f+0>>2];c[p+4>>2]=c[f+4>>2];c[p+8>>2]=c[f+8>>2];c[p+12>>2]=c[f+12>>2];c[p+16>>2]=c[f+16>>2];c[p+20>>2]=c[f+20>>2];c[p+24>>2]=c[f+24>>2];c[p+28>>2]=c[f+28>>2];j=j+1|0}while((j|0)!=(h|0))}c[d+152>>2]=h;if((h|0)<=0){i=f;return}j=c[d+160>>2]|0;d=0;e=c[e+72>>2]|0;while(1){b[j+(d<<5)+6>>1]=b[e+14>>1]|0;b[j+(d<<5)+8>>1]=b[e+16>>1]|0;b[j+(d<<5)+10>>1]=b[e+18>>1]|0;b[j+(d<<5)>>1]=b[e+8>>1]|0;b[j+(d<<5)+2>>1]=b[e+10>>1]|0;b[j+(d<<5)+4>>1]=b[e+12>>1]|0;c[j+(d<<5)+12>>2]=c[e>>2];c[j+(d<<5)+16>>2]=c[e+4>>2];d=d+1|0;if((d|0)==(h|0))break;else e=e+20|0}i=f;return}function IA(d,e){d=d|0;e=e|0;var f=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0;f=i;i=i+112|0;g[d+20>>2]=+h[e+32>>3];g[d+24>>2]=+h[e+40>>3];g[d+28>>2]=+h[e+48>>3];g[d+32>>2]=+h[e+56>>3];g[d+4>>2]=+h[e>>3];g[d+8>>2]=+h[e+8>>3];g[d+12>>2]=+h[e+16>>3];g[d+16>>2]=+h[e+24>>3];g[d+36>>2]=+h[e+64>>3];g[d+40>>2]=+h[e+72>>3];g[d+44>>2]=+h[e+80>>3];g[d+48>>2]=+h[e+88>>3];c[d+56>>2]=c[e+96>>2];a[d+60>>0]=(c[e+100>>2]|0)!=0&1;j=c[e+104>>2]|0;m=f+48|0;n=m+64|0;do{c[m>>2]=0;m=m+4|0}while((m|0)<(n|0));k=c[d+88>>2]|0;if((k|0)<(j|0)){if((c[d+92>>2]|0)<(j|0)){if((j|0)==0){o=0;p=k}else{c[5004]=(c[5004]|0)+1;l=XE(j<<6|19)|0;if((l|0)==0)o=0;else{c[(l+19&-16)+ -4>>2]=l;o=l+19&-16}p=c[d+88>>2]|0}if((p|0)>0){q=0;do{m=o+(q<<6)+0|0;l=(c[d+96>>2]|0)+(q<<6)+0|0;n=m+64|0;do{c[m>>2]=c[l>>2];m=m+4|0;l=l+4|0}while((m|0)<(n|0));q=q+1|0}while((q|0)!=(p|0))}l=c[d+96>>2]|0;if((l|0)!=0){if((a[d+100>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[l+ -4>>2]|0)}c[d+96>>2]=0}a[d+100>>0]=1;c[d+96>>2]=o;c[d+92>>2]=j;o=d+96|0}else o=d+96|0;do{m=(c[o>>2]|0)+(k<<6)+0|0;l=f+48|0;n=m+64|0;do{c[m>>2]=c[l>>2];m=m+4|0;l=l+4|0}while((m|0)<(n|0));k=k+1|0}while((k|0)!=(j|0))}c[d+88>>2]=j;if((j|0)>0){m=c[d+96>>2]|0;k=0;l=c[e+112>>2]|0;while(1){g[m+(k<<6)+16>>2]=+h[l+32>>3];g[m+(k<<6)+20>>2]=+h[l+40>>3];g[m+(k<<6)+24>>2]=+h[l+48>>3];g[m+(k<<6)+28>>2]=+h[l+56>>3];g[m+(k<<6)>>2]=+h[l>>3];g[m+(k<<6)+4>>2]=+h[l+8>>3];g[m+(k<<6)+8>>2]=+h[l+16>>3];g[m+(k<<6)+12>>2]=+h[l+24>>3];c[m+(k<<6)+32>>2]=c[l+64>>2];c[m+(k<<6)+36>>2]=c[l+68>>2];c[m+(k<<6)+40>>2]=c[l+72>>2];k=k+1|0;if((k|0)==(j|0))break;else l=l+80|0}}j=c[e+108>>2]|0;c[f+32>>2]=0;c[f+36>>2]=0;c[f+40>>2]=0;c[f+44>>2]=0;k=c[d+128>>2]|0;if((k|0)<(j|0)){if((c[d+132>>2]|0)<(j|0)){if((j|0)==0){l=0;m=k}else{c[5004]=(c[5004]|0)+1;l=XE((j<<4|3)+16|0)|0;if((l|0)==0)l=0;else{c[(l+19&-16)+ -4>>2]=l;l=l+19&-16}m=c[d+128>>2]|0}if((m|0)>0){n=0;do{q=l+(n<<4)|0;p=(c[d+136>>2]|0)+(n<<4)|0;c[q+0>>2]=c[p+0>>2];c[q+4>>2]=c[p+4>>2];c[q+8>>2]=c[p+8>>2];c[q+12>>2]=c[p+12>>2];n=n+1|0}while((n|0)!=(m|0))}m=c[d+136>>2]|0;if((m|0)!=0){if((a[d+140>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[m+ -4>>2]|0)}c[d+136>>2]=0}a[d+140>>0]=1;c[d+136>>2]=l;c[d+132>>2]=j;l=d+136|0}else l=d+136|0;do{q=(c[l>>2]|0)+(k<<4)|0;c[q+0>>2]=c[f+32>>2];c[q+4>>2]=c[f+36>>2];c[q+8>>2]=c[f+40>>2];c[q+12>>2]=c[f+44>>2];k=k+1|0}while((k|0)!=(j|0))}c[d+128>>2]=j;if((j|0)>0){l=c[d+136>>2]|0;k=0;m=c[e+116>>2]|0;while(1){c[l+(k<<4)+12>>2]=c[m+12>>2];b[l+(k<<4)+6>>1]=b[m+6>>1]|0;b[l+(k<<4)+8>>1]=b[m+8>>1]|0;b[l+(k<<4)+10>>1]=b[m+10>>1]|0;b[l+(k<<4)>>1]=b[m>>1]|0;b[l+(k<<4)+2>>1]=b[m+2>>1]|0;b[l+(k<<4)+4>>1]=b[m+4>>1]|0;k=k+1|0;if((k|0)==(j|0))break;else m=m+16|0}}c[d+144>>2]=c[e+120>>2];j=c[e+124>>2]|0;k=c[d+152>>2]|0;if((k|0)<(j|0)){if((c[d+156>>2]|0)<(j|0)){if((j|0)==0){l=0;m=k}else{c[5004]=(c[5004]|0)+1;l=XE(j<<5|19)|0;if((l|0)==0)l=0;else{c[(l+19&-16)+ -4>>2]=l;l=l+19&-16}m=c[d+152>>2]|0}if((m|0)>0){n=0;do{q=l+(n<<5)|0;p=(c[d+160>>2]|0)+(n<<5)|0;c[q+0>>2]=c[p+0>>2];c[q+4>>2]=c[p+4>>2];c[q+8>>2]=c[p+8>>2];c[q+12>>2]=c[p+12>>2];c[q+16>>2]=c[p+16>>2];c[q+20>>2]=c[p+20>>2];c[q+24>>2]=c[p+24>>2];c[q+28>>2]=c[p+28>>2];n=n+1|0}while((n|0)!=(m|0))}m=c[d+160>>2]|0;if((m|0)!=0){if((a[d+164>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[m+ -4>>2]|0)}c[d+160>>2]=0}a[d+164>>0]=1;c[d+160>>2]=l;c[d+156>>2]=j;l=d+160|0}else l=d+160|0;do{q=(c[l>>2]|0)+(k<<5)|0;c[q+0>>2]=c[f+0>>2];c[q+4>>2]=c[f+4>>2];c[q+8>>2]=c[f+8>>2];c[q+12>>2]=c[f+12>>2];c[q+16>>2]=c[f+16>>2];c[q+20>>2]=c[f+20>>2];c[q+24>>2]=c[f+24>>2];c[q+28>>2]=c[f+28>>2];k=k+1|0}while((k|0)!=(j|0))}c[d+152>>2]=j;if((j|0)<=0){i=f;return}k=c[d+160>>2]|0;d=0;e=c[e+128>>2]|0;while(1){b[k+(d<<5)+6>>1]=b[e+14>>1]|0;b[k+(d<<5)+8>>1]=b[e+16>>1]|0;b[k+(d<<5)+10>>1]=b[e+18>>1]|0;b[k+(d<<5)>>1]=b[e+8>>1]|0;b[k+(d<<5)+2>>1]=b[e+10>>1]|0;b[k+(d<<5)+4>>1]=b[e+12>>1]|0;c[k+(d<<5)+12>>2]=c[e>>2];c[k+(d<<5)+16>>2]=c[e+4>>2];d=d+1|0;if((d|0)==(j|0))break;else e=e+20|0}i=f;return}function JA(a,e,f){a=a|0;e=e|0;f=f|0;var h=0,j=0,k=0,l=0,m=0,n=0;h=i;g[e+16>>2]=+g[a+20>>2];g[e+20>>2]=+g[a+24>>2];g[e+24>>2]=+g[a+28>>2];g[e+28>>2]=+g[a+32>>2];g[e>>2]=+g[a+4>>2];g[e+4>>2]=+g[a+8>>2];g[e+8>>2]=+g[a+12>>2];g[e+12>>2]=+g[a+16>>2];g[e+32>>2]=+g[a+36>>2];g[e+36>>2]=+g[a+40>>2];g[e+40>>2]=+g[a+44>>2];g[e+44>>2]=+g[a+48>>2];c[e+48>>2]=c[a+56>>2];c[e+52>>2]=d[a+60>>0];c[e+56>>2]=c[a+88>>2];if((c[a+88>>2]|0)!=0){n=gc[c[(c[f>>2]|0)+28>>2]&31](f,c[a+96>>2]|0)|0;c[e+64>>2]=n;if((n|0)!=0){n=c[a+88>>2]|0;j=Yb[c[(c[f>>2]|0)+16>>2]&31](f,48,n)|0;if((n|0)>0){k=c[a+96>>2]|0;m=0;l=c[j+8>>2]|0;while(1){g[l+16>>2]=+g[k+(m<<6)+16>>2];g[l+20>>2]=+g[k+(m<<6)+20>>2];g[l+24>>2]=+g[k+(m<<6)+24>>2];g[l+28>>2]=+g[k+(m<<6)+28>>2];g[l>>2]=+g[k+(m<<6)>>2];g[l+4>>2]=+g[k+(m<<6)+4>>2];g[l+8>>2]=+g[k+(m<<6)+8>>2];g[l+12>>2]=+g[k+(m<<6)+12>>2];c[l+32>>2]=c[k+(m<<6)+32>>2];c[l+36>>2]=c[k+(m<<6)+36>>2];c[l+40>>2]=c[k+(m<<6)+40>>2];m=m+1|0;if((m|0)==(n|0))break;else l=l+48|0}}else k=c[a+96>>2]|0;Jb[c[(c[f>>2]|0)+20>>2]&31](f,j,16120,1497453121,k)}}else c[e+64>>2]=0;c[e+60>>2]=c[a+128>>2];if((c[a+128>>2]|0)!=0){n=gc[c[(c[f>>2]|0)+28>>2]&31](f,c[a+136>>2]|0)|0;c[e+68>>2]=n;if((n|0)!=0){k=c[a+128>>2]|0;j=Yb[c[(c[f>>2]|0)+16>>2]&31](f,16,k)|0;if((k|0)>0){l=c[a+136>>2]|0;n=0;m=c[j+8>>2]|0;while(1){c[m+12>>2]=c[l+(n<<4)+12>>2];b[m+6>>1]=b[l+(n<<4)+6>>1]|0;b[m+8>>1]=b[l+(n<<4)+8>>1]|0;b[m+10>>1]=b[l+(n<<4)+10>>1]|0;b[m>>1]=b[l+(n<<4)>>1]|0;b[m+2>>1]=b[l+(n<<4)+2>>1]|0;b[m+4>>1]=b[l+(n<<4)+4>>1]|0;n=n+1|0;if((n|0)==(k|0))break;else m=m+16|0}}else l=c[a+136>>2]|0;Jb[c[(c[f>>2]|0)+20>>2]&31](f,j,16144,1497453121,l)}}else c[e+68>>2]=0;c[e+76>>2]=c[a+144>>2];c[e+80>>2]=c[a+152>>2];if((c[a+152>>2]|0)==0){c[e+72>>2]=0;i=h;return 16192}n=gc[c[(c[f>>2]|0)+28>>2]&31](f,c[a+160>>2]|0)|0;c[e+72>>2]=n;if((n|0)==0){i=h;return 16192}j=c[a+152>>2]|0;e=Yb[c[(c[f>>2]|0)+16>>2]&31](f,20,j)|0;if((j|0)>0){a=c[a+160>>2]|0;l=0;k=c[e+8>>2]|0;while(1){b[k+14>>1]=b[a+(l<<5)+6>>1]|0;b[k+16>>1]=b[a+(l<<5)+8>>1]|0;b[k+18>>1]=b[a+(l<<5)+10>>1]|0;b[k+8>>1]=b[a+(l<<5)>>1]|0;b[k+10>>1]=b[a+(l<<5)+2>>1]|0;b[k+12>>1]=b[a+(l<<5)+4>>1]|0;c[k>>2]=c[a+(l<<5)+12>>2];c[k+4>>2]=c[a+(l<<5)+16>>2];l=l+1|0;if((l|0)==(j|0))break;else k=k+20|0}}else a=c[a+160>>2]|0;Jb[c[(c[f>>2]|0)+20>>2]&31](f,e,16168,1497453121,a);i=h;return 16192}function KA(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0;f=i;i=i+32|0;C=+g[b+16>>2];s=+g[b>>2];B=+g[b+20>>2];u=+g[b+4>>2];y=+g[b+24>>2];x=+g[b+8>>2];v=+g[b+32>>2];o=+g[b+36>>2];p=+g[b+40>>2];m=(B-u)*(p-x)-(y-x)*(o-u);k=(y-x)*(v-s)-(C-s)*(p-x);l=(C-s)*(o-u)-(B-u)*(v-s);g[f+16>>2]=m;g[f+20>>2]=k;g[f+24>>2]=l;g[f+28>>2]=0.0;z=+g[a+4>>2];w=+g[a+8>>2];q=+g[a+12>>2];h=m*z+k*w+l*q-(s*m+u*k+x*l);A=+g[a+20>>2];t=+g[a+24>>2];r=+g[a+28>>2];if(h*(m*A+k*t+l*r-(s*m+u*k+x*l))>=0.0){i=f;return}b=c[a+36>>2]|0;if(!((b&1|0)==0|!(h<=0.0))){i=f;return}j=h/(h-(m*A+k*t+l*r-(s*m+u*k+x*l)));if(!(j<+g[a+40>>2])){i=f;return}n=(m*m+k*k+l*l)*-9999999747378752.0e-20;s=s-(A*j+z*(1.0-j));u=u-(t*j+w*(1.0-j));x=x-(r*j+q*(1.0-j));C=C-(A*j+z*(1.0-j));B=B-(t*j+w*(1.0-j));y=y-(r*j+q*(1.0-j));if(!(l*(s*B-u*C)+(m*(u*y-x*B)+k*(x*C-s*y))>=n)){i=f;return}v=v-(A*j+z*(1.0-j));o=o-(t*j+w*(1.0-j));p=p-(r*j+q*(1.0-j));if(!(l*(C*o-B*v)+(m*(B*p-y*o)+k*(y*v-C*p))>=n)){i=f;return}if(!(l*(u*v-s*o)+(m*(x*o-u*p)+k*(s*p-x*v))>=n)){i=f;return}n=1.0/+Q(+(m*m+k*k+l*l));g[f+16>>2]=m*n;g[f+20>>2]=k*n;g[f+24>>2]=l*n;D=c[(c[a>>2]|0)+12>>2]|0;if((b&2|0)!=0|!(h<=0.0)){g[a+40>>2]=+nc[D&3](a,f+16|0,j,d,e);i=f;return}else{g[f>>2]=-(m*n);g[f+4>>2]=-(k*n);g[f+8>>2]=-(l*n);g[f+12>>2]=0.0;g[a+40>>2]=+nc[D&3](a,f,j,d,e);i=f;return}}function LA(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var h=0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0;h=i;i=i+672|0;c[h+576>>2]=0;g[h+580>>2]=1.0;g[h+584>>2]=1.0;g[h+588>>2]=1.0;g[h+592>>2]=0.0;c[h+620>>2]=0;c[h+568>>2]=16376;c[h+572>>2]=1;c[h+624>>2]=c[d+0>>2];c[h+628>>2]=c[d+4>>2];c[h+632>>2]=c[d+8>>2];c[h+636>>2]=c[d+12>>2];c[h+640>>2]=c[d+16>>2];c[h+644>>2]=c[d+20>>2];c[h+648>>2]=c[d+24>>2];c[h+652>>2]=c[d+28>>2];c[h+656>>2]=c[d+32>>2];c[h+660>>2]=c[d+36>>2];c[h+664>>2]=c[d+40>>2];c[h+668>>2]=c[d+44>>2];g[h+612>>2]=+g[b+204>>2];g[h+516>>2]=9999999747378752.0e-20;a[h+540>>0]=0;c[h+200>>2]=13248;d=c[b+4>>2]|0;c[h+176>>2]=10152;c[h+180>>2]=h+208;c[h+184>>2]=h+200;c[h+188>>2]=d;c[h+192>>2]=h+568;c[h+196>>2]=0;c[h>>2]=9440;c[h+168>>2]=0;g[h+164>>2]=1.0;g[h+172>>2]=+g[b+208>>2];if((nw(h+176|0,b+8|0,b+72|0,b+136|0,b+136|0,h)|0?(j=+g[h+132>>2],l=+g[h+136>>2],m=+g[h+140>>2],j*j+l*l+m*m>9999999747378752.0e-20):0)?(k=+g[h+164>>2],k<+g[b+200>>2]):0){n=1.0/+Q(+(j*j+l*l+m*m));g[h+132>>2]=j*n;g[h+136>>2]=l*n;g[h+140>>2]=m*n;+bc[c[(c[b>>2]|0)+12>>2]&3](b,h+132|0,h+148|0,k,e,f)}c[h+568>>2]=15736;e=c[h+620>>2]|0;if((e|0)==0){i=h;return}Lb[c[c[e>>2]>>2]&511](e);e=c[h+620>>2]|0;if((e|0)==0){i=h;return}c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0);i=h;return}function MA(a){a=a|0;var b=0,d=0;b=i;c[a>>2]=15736;d=c[a+52>>2]|0;if((d|0)==0){i=b;return}Lb[c[c[d>>2]>>2]&511](d);a=c[a+52>>2]|0;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function NA(a){a=a|0;return}function OA(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function PA(a){a=a|0;var b=0,d=0;b=i;c[a>>2]=15736;d=c[a+52>>2]|0;if((d|0)!=0){Lb[c[c[d>>2]>>2]&511](d);d=c[a+52>>2]|0;if((d|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[d+ -4>>2]|0)}if((a|0)==0){i=b;return}}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function QA(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;vc[c[(c[a>>2]|0)+80>>2]&127](a,b,d,e);i=f;return}function RA(a,b,d){a=a|0;b=+b;d=d|0;a=i;c[d+0>>2]=0;c[d+4>>2]=0;c[d+8>>2]=0;c[d+12>>2]=0;i=a;return}function SA(a){a=a|0;return 16544}function TA(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0;e=i;l=+g[d>>2];k=+g[d+4>>2];f=+g[d+8>>2];j=l*+g[b+56>>2]+k*+g[b+60>>2]+f*+g[b+64>>2];h=l*+g[b+72>>2]+k*+g[b+76>>2]+f*+g[b+80>>2];f=l*+g[b+88>>2]+k*+g[b+92>>2]+f*+g[b+96>>2];if(j<h)d=h<f?2:1;else d=j<f?2:0;d=b+(d<<4)+56|0;c[a+0>>2]=c[d+0>>2];c[a+4>>2]=c[d+4>>2];c[a+8>>2]=c[d+8>>2];c[a+12>>2]=c[d+12>>2];i=e;return}function UA(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0,j=0,k=0.0,l=0.0,m=0.0,n=0,o=0.0,p=0.0;h=i;if((e|0)<=0){i=h;return}f=0;do{p=+g[b+(f<<4)>>2];o=+g[b+(f<<4)+4>>2];k=+g[b+(f<<4)+8>>2];m=p*+g[a+56>>2]+o*+g[a+60>>2]+k*+g[a+64>>2];l=p*+g[a+72>>2]+o*+g[a+76>>2]+k*+g[a+80>>2];k=p*+g[a+88>>2]+o*+g[a+92>>2]+k*+g[a+96>>2];j=d+(f<<4)|0;if(m<l)n=l<k?2:1;else n=m<k?2:0;n=a+(n<<4)+56|0;c[j+0>>2]=c[n+0>>2];c[j+4>>2]=c[n+4>>2];c[j+8>>2]=c[n+8>>2];c[j+12>>2]=c[n+12>>2];f=f+1|0}while((f|0)!=(e|0));i=h;return}function VA(a){a=a|0;return 2}function WA(a,b,c){a=a|0;b=b|0;c=c|0;var d=0.0,e=0.0,f=0.0,h=0,j=0.0,k=0.0,l=0.0,m=0.0;h=i;k=+g[a+56>>2];f=+g[a+72>>2]-k;j=+g[a+60>>2];e=+g[a+76>>2]-j;l=+g[a+64>>2];d=+g[a+80>>2]-l;k=+g[a+88>>2]-k;j=+g[a+92>>2]-j;l=+g[a+96>>2]-l;g[c+12>>2]=0.0;m=1.0/+Q(+((f*j-e*k)*(f*j-e*k)+((e*l-d*j)*(e*l-d*j)+(d*k-f*l)*(d*k-f*l))));g[c>>2]=m*(e*l-d*j);g[c+4>>2]=m*(d*k-f*l);g[c+8>>2]=(f*j-e*k)*m;if((b|0)==0){i=h;return}g[c>>2]=m*(e*l-d*j)*-1.0;g[c+4>>2]=m*(d*k-f*l)*-1.0;g[c+8>>2]=(f*j-e*k)*m*-1.0;i=h;return}function XA(a){a=a|0;return 3}function YA(a){a=a|0;return 3}function ZA(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;rc[c[(c[a>>2]|0)+108>>2]&127](a,b,d);rc[c[(c[a>>2]|0)+108>>2]&127](a,(b+1|0)%3|0,e);i=f;return}function _A(a,b,d){a=a|0;b=b|0;d=d|0;var e=0;e=i;c[d+0>>2]=c[a+(b<<4)+56>>2];c[d+4>>2]=c[a+(b<<4)+60>>2];c[d+8>>2]=c[a+(b<<4)+64>>2];c[d+12>>2]=c[a+(b<<4)+68>>2];i=e;return}function $A(a){a=a|0;return 1}function aB(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;vc[c[(c[a>>2]|0)+124>>2]&127](a,e,b,d);i=f;return}function bB(a,b,d){a=a|0;b=b|0;d=+d;var e=0,f=0.0,h=0.0,j=0.0,k=0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0;e=i;i=i+32|0;n=+g[a+56>>2];r=+g[a+72>>2]-n;m=+g[a+60>>2];p=+g[a+76>>2]-m;l=+g[a+64>>2];s=+g[a+80>>2]-l;o=+g[a+88>>2]-n;q=+g[a+92>>2]-m;f=+g[a+96>>2]-l;j=1.0/+Q(+((r*q-p*o)*(r*q-p*o)+((p*f-s*q)*(p*f-s*q)+(s*o-r*f)*(s*o-r*f))));h=j*(p*f-s*q);f=j*(s*o-r*f);j=(r*q-p*o)*j;l=+g[b>>2]*h+ +g[b+4>>2]*f+j*+g[b+8>>2]-(h*n+f*m+j*l);if(!(l>=-d)|!(l<=d)){k=0;i=e;return k|0}k=0;while(1){vc[c[(c[a>>2]|0)+104>>2]&127](a,k,e+16|0,e);n=+g[e+16>>2];s=+g[e>>2]-n;p=+g[e+20>>2];o=+g[e+4>>2]-p;m=+g[e+24>>2];r=+g[e+8>>2]-m;q=1.0/+Q(+((f*s-h*o)*(f*s-h*o)+((j*o-f*r)*(j*o-f*r)+(h*r-j*s)*(h*r-j*s))));k=k+1|0;if(+g[b>>2]*q*(j*o-f*r)+ +g[b+4>>2]*q*(h*r-j*s)+(f*s-h*o)*q*+g[b+8>>2]-(m*(f*s-h*o)*q+(n*q*(j*o-f*r)+p*q*(h*r-j*s)))<-d){b=0;a=5;break}if((k|0)>=3){b=1;a=5;break}}if((a|0)==5){i=e;return b|0}return 0}function cB(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0;b=i;h=+g[a+56>>2];l=+g[a+72>>2]-h;k=+g[a+60>>2];j=+g[a+76>>2]-k;m=+g[a+64>>2];n=+g[a+80>>2]-m;h=+g[a+88>>2]-h;k=+g[a+92>>2]-k;m=+g[a+96>>2]-m;g[d+12>>2]=0.0;f=1.0/+Q(+((l*k-j*h)*(l*k-j*h)+((j*m-n*k)*(j*m-n*k)+(n*h-l*m)*(n*h-l*m))));g[d>>2]=f*(j*m-n*k);g[d+4>>2]=f*(n*h-l*m);g[d+8>>2]=(l*k-j*h)*f;c[e+0>>2]=c[a+56>>2];c[e+4>>2]=c[a+60>>2];c[e+8>>2]=c[a+64>>2];c[e+12>>2]=c[a+68>>2];i=b;return}function dB(a){a=a|0;var b=0;b=i;eB(a);YE(a);i=b;return}function eB(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=16568;e=c[b+56>>2]|0;if((e|0)!=0){if((a[b+60>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+56>>2]=0}a[b+60>>0]=1;c[b+56>>2]=0;c[b+48>>2]=0;c[b+52>>2]=0;e=c[b+36>>2]|0;if((e|0)!=0){if((a[b+40>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+36>>2]=0}a[b+40>>0]=1;c[b+36>>2]=0;c[b+28>>2]=0;c[b+32>>2]=0;e=c[b+16>>2]|0;if((e|0)==0){e=b+12|0;a[b+20>>0]=1;c[b+16>>2]=0;c[b+8>>2]=0;c[e>>2]=0;i=d;return}if((a[b+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+16>>2]=0;e=b+12|0;a[b+20>>0]=1;c[b+16>>2]=0;c[b+8>>2]=0;c[e>>2]=0;i=d;return}function fB(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0;e=i;if((c[d+8>>2]|0)>0){h=c[d+16>>2]|0;j=0;f=0;do{k=c[h+(j<<2)>>2]|0;if((c[k+204>>2]&3|0)==0){c[k+208>>2]=f;f=f+1|0}c[k+212>>2]=-1;g[k+244>>2]=1.0;j=j+1|0}while((j|0)<(c[d+8>>2]|0))}else f=0;h=c[b+8>>2]|0;if((h|0)<(f|0)){if((c[b+12>>2]|0)<(f|0)){if((f|0)==0){j=0;m=h}else{c[5004]=(c[5004]|0)+1;j=XE((f<<3|3)+16|0)|0;if((j|0)==0)j=0;else{c[(j+19&-16)+ -4>>2]=j;j=j+19&-16}m=c[b+8>>2]|0}if((m|0)>0){l=0;do{k=j+(l<<3)|0;if((k|0)!=0){o=(c[b+16>>2]|0)+(l<<3)|0;n=c[o+4>>2]|0;c[k>>2]=c[o>>2];c[k+4>>2]=n}l=l+1|0}while((l|0)!=(m|0))}k=c[b+16>>2]|0;if((k|0)!=0){if((a[b+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[k+ -4>>2]|0)}c[b+16>>2]=0}a[b+20>>0]=1;c[b+16>>2]=j;c[b+12>>2]=f;j=b+16|0}else j=b+16|0;do{k=(c[j>>2]|0)+(h<<3)|0;if((k|0)!=0){c[k>>2]=0;c[k+4>>2]=0}h=h+1|0}while((h|0)!=(f|0))}c[b+8>>2]=f;if((f|0)>0){j=c[b+16>>2]|0;h=0;do{c[j+(h<<3)>>2]=h;c[j+(h<<3)+4>>2]=1;h=h+1|0}while((h|0)!=(f|0))}f=c[d+68>>2]|0;f=Pb[c[(c[f>>2]|0)+36>>2]&127](f)|0;d=Pb[c[(c[f>>2]|0)+36>>2]&127](f)|0;if((d|0)==0){i=e;return}h=Pb[c[(c[f>>2]|0)+20>>2]&127](f)|0;if((d|0)<=0){i=e;return}f=0;do{k=c[c[h+(f<<4)>>2]>>2]|0;j=c[c[h+(f<<4)+4>>2]>>2]|0;if(((k|0)!=0?!((j|0)==0?1:(c[k+204>>2]&7|0)!=0):0)?(c[j+204>>2]&7|0)==0:0){l=c[k+208>>2]|0;k=c[j+208>>2]|0;j=c[b+16>>2]|0;m=c[j+(l<<3)>>2]|0;if((m|0)!=(l|0)){n=j+(l<<3)|0;do{l=j+(m<<3)|0;c[n>>2]=c[l>>2];l=c[l>>2]|0;n=j+(l<<3)|0;m=c[n>>2]|0}while((l|0)!=(m|0))}m=c[j+(k<<3)>>2]|0;if((m|0)!=(k|0)){n=j+(k<<3)|0;do{k=j+(m<<3)|0;c[n>>2]=c[k>>2];k=c[k>>2]|0;n=j+(k<<3)|0;m=c[n>>2]|0}while((k|0)!=(m|0))}if((l|0)!=(k|0)){c[j+(l<<3)>>2]=k;o=j+(k<<3)+4|0;c[o>>2]=(c[o>>2]|0)+(c[j+(l<<3)+4>>2]|0)}}f=f+1|0}while((f|0)!=(d|0));i=e;return}function gB(a,b){a=a|0;b=b|0;var d=0,e=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0;f=i;if((c[b+8>>2]|0)<=0){i=f;return}d=c[b+16>>2]|0;e=0;g=0;do{h=c[d+(e<<2)>>2]|0;if((c[h+204>>2]&3|0)==0){j=c[a+16>>2]|0;l=j+(g<<3)|0;k=c[l>>2]|0;if((k|0)==(g|0))m=g;else do{m=j+(k<<3)|0;c[l>>2]=c[m>>2];m=c[m>>2]|0;l=j+(m<<3)|0;k=c[l>>2]|0}while((m|0)!=(k|0));c[h+208>>2]=m;c[j+(g<<3)+4>>2]=e;c[h+212>>2]=-1;g=g+1|0}else{c[h+208>>2]=-1;c[h+212>>2]=-2}e=e+1|0}while((e|0)<(c[b+8>>2]|0));i=f;return}function hB(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0;e=i;while(1){f=c[a+12>>2]|0;g=c[f+(((b+d|0)/2|0)<<2)>>2]|0;l=b;k=d;while(1){h=c[(c[g+740>>2]|0)+208>>2]|0;if((h|0)>-1)while(1){j=c[f+(l<<2)>>2]|0;m=c[(c[j+740>>2]|0)+208>>2]|0;if(!((m|0)>-1))m=c[(c[j+744>>2]|0)+208>>2]|0;if((m|0)<(h|0))l=l+1|0;else break}else{m=c[(c[g+744>>2]|0)+208>>2]|0;while(1){j=c[f+(l<<2)>>2]|0;n=c[(c[j+740>>2]|0)+208>>2]|0;if(!((n|0)>-1))n=c[(c[j+744>>2]|0)+208>>2]|0;if((n|0)<(m|0))l=l+1|0;else break}}if((h|0)>-1)while(1){m=c[f+(k<<2)>>2]|0;n=c[(c[m+740>>2]|0)+208>>2]|0;if(!((n|0)>-1))n=c[(c[m+744>>2]|0)+208>>2]|0;if((h|0)<(n|0))k=k+ -1|0;else break}else{h=c[(c[g+744>>2]|0)+208>>2]|0;while(1){m=c[f+(k<<2)>>2]|0;n=c[(c[m+740>>2]|0)+208>>2]|0;if(!((n|0)>-1))n=c[(c[m+744>>2]|0)+208>>2]|0;if((h|0)<(n|0))k=k+ -1|0;else break}}if((l|0)<=(k|0)){c[f+(l<<2)>>2]=m;c[(c[a+12>>2]|0)+(k<<2)>>2]=j;l=l+1|0;k=k+ -1|0}if((l|0)>(k|0))break;f=c[a+12>>2]|0}if((k|0)>(b|0))hB(a,b,k);if((l|0)<(d|0))b=l;else break}i=e;return}function iB(a,b,d){a=a|0;b=b|0;d=d|0;d=i;c[a+0>>2]=0;c[a+4>>2]=0;c[a+8>>2]=0;c[a+12>>2]=0;i=d;return}function jB(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,g=0;a=i;if((e|0)>0)b=0;else{i=a;return}do{g=d+(b<<4)|0;b=b+1|0;f=(b|0)==(e|0);c[g+0>>2]=0;c[g+4>>2]=0;c[g+8>>2]=0;c[g+12>>2]=0}while(!f);i=a;return}function kB(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0;e=i;rc[c[(c[b>>2]|0)+68>>2]&127](a,b,d);l=+g[d>>2];j=+g[d+4>>2];h=+g[d+8>>2];f=l*l+j*j+h*h<1.4210854715202004e-14?-1.0:h;k=l*l+j*j+h*h<1.4210854715202004e-14?-1.0:j;l=l*l+j*j+h*h<1.4210854715202004e-14?-1.0:l;h=1.0/+Q(+(f*f+(l*l+k*k)));j=+$b[c[(c[b>>2]|0)+48>>2]&15](b);g[a>>2]=h*l*j+ +g[a>>2];g[a+4>>2]=j*h*k+ +g[a+4>>2];g[a+8>>2]=j*h*f+ +g[a+8>>2];i=e;return}function lB(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0;f=i;k=+$b[c[(c[a>>2]|0)+48>>2]&15](a);j=+$b[c[(c[a>>2]|0)+48>>2]&15](a);h=+$b[c[(c[a>>2]|0)+48>>2]&15](a);m=+g[b+52>>2]-j;l=+g[b+56>>2]-h;g[d>>2]=+g[b+48>>2]-k;g[d+4>>2]=m;g[d+8>>2]=l;g[d+12>>2]=0.0;j=j+ +g[b+52>>2];h=h+ +g[b+56>>2];g[e>>2]=k+ +g[b+48>>2];g[e+4>>2]=j;g[e+8>>2]=h;g[e+12>>2]=0.0;i=f;return}function mB(a,b,d){a=a|0;b=+b;d=d|0;var e=0;e=i;b=b*.4000000059604645*+$b[c[(c[a>>2]|0)+48>>2]&15](a);b=b*+$b[c[(c[a>>2]|0)+48>>2]&15](a);g[d>>2]=b;g[d+4>>2]=b;g[d+8>>2]=b;g[d+12>>2]=0.0;i=e;return}function nB(b){b=b|0;var d=0,e=0,f=0;d=i;c[b>>2]=16816;if((a[b+8>>0]|0)!=0?(e=c[b+12>>2]|0,(e|0)!=0):0){f=c[b+4>>2]|0;Nb[c[(c[f>>2]|0)+16>>2]&127](f,e)}YE(b);i=d;return}function oB(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=16816;if((a[b+8>>0]|0)==0){i=d;return}e=c[b+12>>2]|0;if((e|0)==0){i=d;return}b=c[b+4>>2]|0;Nb[c[(c[b>>2]|0)+16>>2]&127](b,e);i=d;return}function pB(a,b,d,e,f){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;var h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0,p=0,q=0.0;e=i;i=i+32|0;a=c[a+12>>2]|0;if((a|0)==0){i=e;return}c[f+4>>2]=a;o=c[b+4>>2]|0;p=c[d+4>>2]|0;b=c[b+12>>2]|0;d=c[d+12>>2]|0;m=+g[b+48>>2]- +g[d+48>>2];n=+g[b+52>>2]- +g[d+52>>2];l=+g[b+56>>2]- +g[d+56>>2];j=+Q(+(m*m+n*n+l*l));h=+g[p+28>>2]*+g[p+12>>2];k=+g[o+28>>2]*+g[o+12>>2]+h;if(j>k){if((c[a+748>>2]|0)==0){i=e;return}d=c[a+740>>2]|0;b=c[(c[f+8>>2]|0)+8>>2]|0;if((d|0)==(b|0)){nA(a,d+4|0,(c[(c[f+12>>2]|0)+8>>2]|0)+4|0);i=e;return}else{nA(a,(c[(c[f+12>>2]|0)+8>>2]|0)+4|0,b+4|0);i=e;return}}g[e+16>>2]=1.0;g[e+20>>2]=0.0;g[e+24>>2]=0.0;g[e+28>>2]=0.0;if(j>1.1920928955078125e-7){g[e+16>>2]=m*(1.0/j);g[e+20>>2]=n*(1.0/j);g[e+24>>2]=l*(1.0/j);g[e+28>>2]=0.0;m=m*(1.0/j);n=n*(1.0/j);l=l*(1.0/j)}else{m=1.0;n=0.0;l=0.0}q=h*n+ +g[d+52>>2];n=h*l+ +g[d+56>>2];g[e>>2]=h*m+ +g[d+48>>2];g[e+4>>2]=q;g[e+8>>2]=n;g[e+12>>2]=0.0;qc[c[(c[f>>2]|0)+16>>2]&15](f,e+16|0,e,j-k);a=c[f+4>>2]|0;if((c[a+748>>2]|0)==0){i=e;return}d=c[a+740>>2]|0;b=c[(c[f+8>>2]|0)+8>>2]|0;if((d|0)==(b|0)){nA(a,d+4|0,(c[(c[f+12>>2]|0)+8>>2]|0)+4|0);i=e;return}else{nA(a,(c[(c[f+12>>2]|0)+8>>2]|0)+4|0,b+4|0);i=e;return}}function qB(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;return 1.0}function rB(b,d){b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0;e=i;if((c[b+12>>2]|0)==0){i=e;return}if((a[b+8>>0]|0)==0){i=e;return}h=c[d+4>>2]|0;if((h|0)==(c[d+8>>2]|0)?(f=(h|0)==0?1:h<<1,(h|0)<(f|0)):0){if((f|0)==0)g=0;else{c[5004]=(c[5004]|0)+1;g=XE((f<<2|3)+16|0)|0;if((g|0)==0)g=0;else{c[(g+19&-16)+ -4>>2]=g;g=g+19&-16}h=c[d+4>>2]|0}if((h|0)>0){j=0;do{k=g+(j<<2)|0;if((k|0)!=0)c[k>>2]=c[(c[d+12>>2]|0)+(j<<2)>>2];j=j+1|0}while((j|0)!=(h|0))}j=c[d+12>>2]|0;if((j|0)!=0){if((a[d+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0);h=c[d+4>>2]|0}c[d+12>>2]=0}a[d+16>>0]=1;c[d+12>>2]=g;c[d+8>>2]=f}f=(c[d+12>>2]|0)+(h<<2)|0;if((f|0)!=0)c[f>>2]=c[b+12>>2];c[d+4>>2]=h+1;i=e;return}function sB(b){b=b|0;var d=0,e=0,f=0;d=i;c[b>>2]=16904;if((a[b+8>>0]|0)!=0?(e=c[b+12>>2]|0,(e|0)!=0):0){f=c[b+4>>2]|0;Nb[c[(c[f>>2]|0)+16>>2]&127](f,e)}YE(b);i=d;return}function tB(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=16904;if((a[b+8>>0]|0)==0){i=d;return}e=c[b+12>>2]|0;if((e|0)==0){i=d;return}b=c[b+4>>2]|0;Nb[c[(c[b>>2]|0)+16>>2]&127](b,e);i=d;return}function uB(b,d,e,f,h){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0,k=0,l=0,m=0,n=0.0,o=0;j=i;i=i+160|0;k=c[b+12>>2]|0;if((k|0)==0){i=j;return}l=(a[b+16>>0]|0)!=0;m=l?e:d;d=l?d:e;o=c[m+4>>2]|0;e=c[d+4>>2]|0;c[h+4>>2]=k;n=+g[(c[b+12>>2]|0)+752>>2];c[j+136>>2]=17768;c[j+140>>2]=o;c[j+144>>2]=e;g[j+148>>2]=n;g[j+128>>2]=999999984306749400.0;e=c[m+12>>2]|0;c[j+0>>2]=c[e+0>>2];c[j+4>>2]=c[e+4>>2];c[j+8>>2]=c[e+8>>2];c[j+12>>2]=c[e+12>>2];c[j+16>>2]=c[e+16>>2];c[j+20>>2]=c[e+20>>2];c[j+24>>2]=c[e+24>>2];c[j+28>>2]=c[e+28>>2];c[j+32>>2]=c[e+32>>2];c[j+36>>2]=c[e+36>>2];c[j+40>>2]=c[e+40>>2];c[j+44>>2]=c[e+44>>2];c[j+48>>2]=c[e+48>>2];c[j+52>>2]=c[e+52>>2];c[j+56>>2]=c[e+56>>2];c[j+60>>2]=c[e+60>>2];d=c[d+12>>2]|0;c[j+64>>2]=c[d+0>>2];c[j+68>>2]=c[d+4>>2];c[j+72>>2]=c[d+8>>2];c[j+76>>2]=c[d+12>>2];c[j+80>>2]=c[d+16>>2];c[j+84>>2]=c[d+20>>2];c[j+88>>2]=c[d+24>>2];c[j+92>>2]=c[d+28>>2];c[j+96>>2]=c[d+32>>2];c[j+100>>2]=c[d+36>>2];c[j+104>>2]=c[d+40>>2];c[j+108>>2]=c[d+44>>2];c[j+112>>2]=c[d+48>>2];c[j+116>>2]=c[d+52>>2];c[j+120>>2]=c[d+56>>2];c[j+124>>2]=c[d+60>>2];nC(j+136|0,j,h,c[f+20>>2]|0,l);if((a[b+8>>0]|0)==0){i=j;return}b=c[h+4>>2]|0;if((c[b+748>>2]|0)==0){i=j;return}k=c[b+740>>2]|0;e=c[(c[h+8>>2]|0)+8>>2]|0;if((k|0)==(e|0)){nA(b,k+4|0,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0);i=j;return}else{nA(b,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0,e+4|0);i=j;return}}function vB(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;return 1.0}function wB(b,d){b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0;e=i;if((c[b+12>>2]|0)==0){i=e;return}if((a[b+8>>0]|0)==0){i=e;return}h=c[d+4>>2]|0;if((h|0)==(c[d+8>>2]|0)?(f=(h|0)==0?1:h<<1,(h|0)<(f|0)):0){if((f|0)==0)g=0;else{c[5004]=(c[5004]|0)+1;g=XE((f<<2|3)+16|0)|0;if((g|0)==0)g=0;else{c[(g+19&-16)+ -4>>2]=g;g=g+19&-16}h=c[d+4>>2]|0}if((h|0)>0){j=0;do{k=g+(j<<2)|0;if((k|0)!=0)c[k>>2]=c[(c[d+12>>2]|0)+(j<<2)>>2];j=j+1|0}while((j|0)!=(h|0))}j=c[d+12>>2]|0;if((j|0)!=0){if((a[d+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0);h=c[d+4>>2]|0}c[d+12>>2]=0}a[d+16>>0]=1;c[d+12>>2]=g;c[d+8>>2]=f}f=(c[d+12>>2]|0)+(h<<2)|0;if((f|0)!=0)c[f>>2]=c[b+12>>2];c[d+4>>2]=h+1;i=e;return}function xB(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function yB(a){a=a|0;return}function zB(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;g[c>>2]=-999999984306749400.0;g[c+4>>2]=-999999984306749400.0;g[c+8>>2]=-999999984306749400.0;g[c+12>>2]=0.0;g[d>>2]=999999984306749400.0;g[d+4>>2]=999999984306749400.0;g[d+8>>2]=999999984306749400.0;g[d+12>>2]=0.0;return}function AB(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0;f=i;i=i+48|0;k=+g[e>>2];l=+g[d>>2];h=+g[e+4>>2];j=+g[d+4>>2];m=+g[e+8>>2];o=+g[d+8>>2];t=+Q(+((k-l)*.5*(k-l)*.5+(h-j)*.5*(h-j)*.5+(m-o)*.5*(m-o)*.5));p=+g[a+56>>2];if(+P(+p)>.7071067690849304){n=+g[a+52>>2];s=1.0/+Q(+(p*p+n*n));y=+g[a+48>>2];q=y;x=n;r=0.0;w=-(p*s);v=n*s;u=(p*p+n*n)*s;n=-(y*n*s);s=y*-(p*s)}else{z=+g[a+48>>2];y=+g[a+52>>2];s=1.0/+Q(+(z*z+y*y));q=z;x=y;r=-(y*s);w=z*s;v=0.0;u=-(p*z*s);n=p*-(y*s);s=(z*z+y*y)*s}z=(k+l)*.5*q+(h+j)*.5*x+(m+o)*.5*p- +g[a+64>>2];j=(h+j)*.5-x*z;q=(k+l)*.5-q*z;r=t*r;w=t*w;y=t*v;u=t*u;v=t*n;x=t*s;g[f>>2]=u+(r+q);g[f+4>>2]=v+(w+j);g[f+8>>2]=x+(y+((m+o)*.5-p*z));g[f+12>>2]=0.0;g[f+16>>2]=r+q-u;g[f+20>>2]=w+j-v;g[f+24>>2]=y+((m+o)*.5-p*z)-x;g[f+28>>2]=0.0;g[f+32>>2]=q-r-u;g[f+36>>2]=j-w-v;g[f+40>>2]=(m+o)*.5-p*z-y-x;g[f+44>>2]=0.0;vc[c[(c[b>>2]|0)+8>>2]&127](b,f,0,0);g[f>>2]=q-r-u;g[f+4>>2]=j-w-v;g[f+8>>2]=(m+o)*.5-p*z-y-x;g[f+12>>2]=0.0;g[f+16>>2]=u+(q-r);g[f+20>>2]=v+(j-w);g[f+24>>2]=x+((m+o)*.5-p*z-y);g[f+28>>2]=0.0;g[f+32>>2]=u+(r+q);g[f+36>>2]=v+(w+j);g[f+40>>2]=x+(y+((m+o)*.5-p*z));g[f+44>>2]=0.0;vc[c[(c[b>>2]|0)+8>>2]&127](b,f,0,1);i=f;return}function BB(a,b,d){a=a|0;b=+b;d=d|0;a=i;c[d+0>>2]=0;c[d+4>>2]=0;c[d+8>>2]=0;c[d+12>>2]=0;i=a;return}function CB(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+68>>2]=c[b+0>>2];c[a+72>>2]=c[b+4>>2];c[a+76>>2]=c[b+8>>2];c[a+80>>2]=c[b+12>>2];i=d;return}function DB(a){a=a|0;return a+68|0}function EB(a){a=a|0;return 17128}function FB(a){a=a|0;return 52}function GB(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,h=0;e=i;f=gc[c[(c[d>>2]|0)+40>>2]&31](d,a)|0;h=gc[c[(c[d>>2]|0)+28>>2]&31](d,f)|0;c[b>>2]=h;if((h|0)!=0)Nb[c[(c[d>>2]|0)+48>>2]&127](d,f);c[b+4>>2]=c[a+4>>2];g[b+12>>2]=+g[a+68>>2];g[b+16>>2]=+g[a+72>>2];g[b+20>>2]=+g[a+76>>2];g[b+24>>2]=+g[a+80>>2];g[b+28>>2]=+g[a+48>>2];g[b+32>>2]=+g[a+52>>2];g[b+36>>2]=+g[a+56>>2];g[b+40>>2]=+g[a+60>>2];g[b+44>>2]=+g[a+64>>2];i=e;return 17104}function HB(b,d,e,f,h,j){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;var k=0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0.0,X=0.0,Y=0.0,Z=0.0,_=0.0,$=0.0,aa=0.0,ba=0,ca=0,da=0,ea=0.0,fa=0,ga=0.0;k=i;i=i+128|0;fa=c[b+4>>2]|0;a[fa+312>>0]=0;c[fa>>2]=0;a[fa+356>>0]=1;g[fa+292>>2]=999999984306749400.0;g[fa+296>>2]=999999984306749400.0;g[fa+300>>2]=999999984306749400.0;g[fa+304>>2]=0.0;c[fa+336>>2]=0;c[fa+340>>2]=0;c[fa+344>>2]=0;c[fa+348>>2]=0;a[fa+352>>0]=0;a[fa+332>>0]=a[fa+332>>0]&-16;O=+g[d+48>>2];V=+g[d+52>>2];R=+g[d+56>>2];Y=+g[f+48>>2];W=+g[f+52>>2];P=+g[f+56>>2];D=+g[d>>2];p=+g[d+4>>2];r=+g[d+8>>2];E=+g[d+16>>2];z=+g[d+20>>2];s=+g[d+24>>2];w=+g[d+32>>2];q=+g[d+36>>2];t=+g[d+40>>2];u=+g[f>>2];x=+g[f+4>>2];A=+g[f+8>>2];v=+g[f+16>>2];y=+g[f+20>>2];B=+g[f+24>>2];F=+g[f+32>>2];o=+g[f+36>>2];C=+g[f+40>>2];m=+g[e+48>>2]-O-(+g[h+48>>2]-Y);l=+g[e+52>>2]-V-(+g[h+52>>2]-W);n=+g[e+56>>2]-R-(+g[h+56>>2]-P);fa=c[b+8>>2]|0;da=c[(c[fa>>2]|0)+64>>2]|0;g[k+96>>2]=D*-m+E*-l+w*-n;g[k+100>>2]=p*-m+z*-l+q*-n;g[k+104>>2]=r*-m+s*-l+t*-n;g[k+108>>2]=0.0;rc[da&127](k+112|0,fa,k+96|0);aa=+g[k+112>>2];ea=+g[k+116>>2];X=+g[k+120>>2];Z=aa*+g[d>>2]+ea*+g[d+4>>2]+X*+g[d+8>>2]+ +g[d+48>>2];_=aa*+g[d+16>>2]+ea*+g[d+20>>2]+X*+g[d+24>>2]+ +g[d+52>>2];X=aa*+g[d+32>>2]+ea*+g[d+36>>2]+X*+g[d+40>>2]+ +g[d+56>>2];fa=c[b+12>>2]|0;da=c[(c[fa>>2]|0)+64>>2]|0;ea=m*+g[f+4>>2]+l*+g[f+20>>2]+n*+g[f+36>>2];aa=m*+g[f+8>>2]+l*+g[f+24>>2]+n*+g[f+40>>2];g[k+64>>2]=m*+g[f>>2]+l*+g[f+16>>2]+n*+g[f+32>>2];g[k+68>>2]=ea;g[k+72>>2]=aa;g[k+76>>2]=0.0;rc[da&127](k+80|0,fa,k+64|0);aa=+g[k+80>>2];ea=+g[k+84>>2];$=+g[k+88>>2];Z=Z-(aa*+g[f>>2]+ea*+g[f+4>>2]+$*+g[f+8>>2]+ +g[f+48>>2]);_=_-(aa*+g[f+16>>2]+ea*+g[f+20>>2]+$*+g[f+24>>2]+ +g[f+52>>2]);$=X-(aa*+g[f+32>>2]+ea*+g[f+36>>2]+$*+g[f+40>>2]+ +g[f+56>>2]);a:do if(Z*Z+_*_+$*$>9999999747378752.0e-20){S=0.0;U=0.0;X=0.0;T=0.0;H=0.0;G=32;aa=0.0;while(1){if((G|0)==0)break a;G=G+ -1|0;fa=c[b+8>>2]|0;da=c[(c[fa>>2]|0)+64>>2]|0;I=-Z;ga=-_;ea=-$;g[k+32>>2]=D*I+E*ga+w*ea;g[k+36>>2]=p*I+z*ga+q*ea;g[k+40>>2]=r*I+s*ga+t*ea;g[k+44>>2]=0.0;rc[da&127](k+48|0,fa,k+32|0);ea=+g[k+48>>2];ga=+g[k+52>>2];I=+g[k+56>>2];J=O+(D*ea+p*ga+r*I);L=V+(E*ea+z*ga+s*I);I=R+(w*ea+q*ga+t*I);fa=c[b+12>>2]|0;da=c[(c[fa>>2]|0)+64>>2]|0;g[k>>2]=u*Z+v*_+F*$;g[k+4>>2]=x*Z+y*_+o*$;g[k+8>>2]=A*Z+B*_+C*$;g[k+12>>2]=0.0;rc[da&127](k+16|0,fa,k);ga=+g[k+16>>2];ea=+g[k+20>>2];M=+g[k+24>>2];K=Y+(u*ga+x*ea+A*M);N=W+(v*ga+y*ea+B*M);M=P+(F*ga+o*ea+C*M);ea=Z*(J-K)+_*(L-N)+$*(I-M);if(H>1.0){j=0;h=24;break}if(ea>0.0){O=m*Z+l*_+n*$;if(O>=-1.4210854715202004e-14){j=0;h=24;break}H=H-ea/O;R=(1.0-H)*+g[d+56>>2]+H*+g[e+56>>2];V=(1.0-H)*+g[d+52>>2]+H*+g[e+52>>2];O=+g[d+48>>2]*(1.0-H)+H*+g[e+48>>2];P=(1.0-H)*+g[f+56>>2]+H*+g[h+56>>2];W=(1.0-H)*+g[f+52>>2]+H*+g[h+52>>2];Y=(1.0-H)*+g[f+48>>2]+H*+g[h+48>>2];T=aa;X=$;U=_;S=Z}ba=c[b+4>>2]|0;ca=c[ba>>2]|0;if((ca|0)>0){Z=+g[ba+308>>2];fa=0;da=0;do{aa=J-K- +g[ba+(da<<4)+4>>2];ea=L-N- +g[ba+(da<<4)+8>>2];ga=I-M- +g[ba+(da<<4)+12>>2];fa=fa|aa*aa+ea*ea+ga*ga<=Z;da=da+1|0}while((da|0)!=(ca|0))}else fa=0;if((+g[ba+304>>2]==0.0?I-M==+g[ba+300>>2]:0)?L-N==+g[ba+296>>2]:0)da=J-K==+g[ba+292>>2];else da=0;if(!(da|fa)){g[ba+292>>2]=J-K;g[ba+296>>2]=L-N;g[ba+300>>2]=I-M;g[ba+304>>2]=0.0;a[ba+356>>0]=1;g[ba+(ca<<4)+4>>2]=J-K;g[ba+(ca<<4)+8>>2]=L-N;g[ba+(ca<<4)+12>>2]=I-M;g[ba+(ca<<4)+16>>2]=0.0;fa=c[ba>>2]|0;g[ba+(fa<<4)+84>>2]=J;g[ba+(fa<<4)+88>>2]=L;g[ba+(fa<<4)+92>>2]=I;g[ba+(fa<<4)+96>>2]=0.0;fa=c[ba>>2]|0;g[ba+(fa<<4)+164>>2]=K;g[ba+(fa<<4)+168>>2]=N;g[ba+(fa<<4)+172>>2]=M;g[ba+(fa<<4)+176>>2]=0.0;c[ba>>2]=(c[ba>>2]|0)+1;ba=c[b+4>>2]|0}fa=lC(ba)|0;Z=+g[ba+276>>2];_=+g[ba+280>>2];$=+g[ba+284>>2];if(!fa)break a;if(!(Z*Z+_*_+$*$>9999999747378752.0e-20))break a;else aa=+g[ba+288>>2]}if((h|0)==24){i=k;return j|0}}else{T=0.0;X=0.0;U=0.0;S=0.0;H=0.0}while(0);g[j+164>>2]=H;o=X*X+(U*U+S*S);if(!(o>=1.4210854715202004e-14)){c[j+132>>2]=0;c[j+136>>2]=0;c[j+140>>2]=0;c[j+144>>2]=0;o=0.0;q=0.0;p=0.0}else{p=1.0/+Q(+o);o=S*p;q=U*p;p=X*p;g[j+132>>2]=o;g[j+136>>2]=q;g[j+140>>2]=p;g[j+144>>2]=T}if(m*o+l*q+n*p>=-+g[j+172>>2]){fa=0;i=k;return fa|0}fa=c[b+4>>2]|0;lC(fa)|0;dF(j+148|0,fa+260|0,16)|0;fa=1;i=k;return fa|0}function IB(a){a=a|0;return}function JB(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function KB(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,h=0,j=0,k=0;f=i;g[b+4>>2]=1.0;g[b+8>>2]=1.0;g[b+12>>2]=1.0;g[b+16>>2]=0.0;a[b+36>>0]=1;c[b+32>>2]=0;c[b+24>>2]=0;c[b+28>>2]=0;c[b+48>>2]=0;c[b>>2]=17304;a[b+100>>0]=1;c[b+96>>2]=0;c[b+88>>2]=0;c[b+92>>2]=0;a[b+120>>0]=1;c[b+116>>2]=0;c[b+108>>2]=0;c[b+112>>2]=0;a[b+140>>0]=1;c[b+136>>2]=0;c[b+128>>2]=0;c[b+132>>2]=0;a[b+160>>0]=1;c[b+156>>2]=0;c[b+148>>2]=0;c[b+152>>2]=0;a[b+164>>0]=d&1;a[b+165>>0]=e&1;g[b+168>>2]=0.0;c[5004]=(c[5004]|0)+1;e=XE(51)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}d=c[b+24>>2]|0;if((d|0)>0){h=0;do{j=e+(h<<5)|0;k=(c[b+32>>2]|0)+(h<<5)|0;c[j+0>>2]=c[k+0>>2];c[j+4>>2]=c[k+4>>2];c[j+8>>2]=c[k+8>>2];c[j+12>>2]=c[k+12>>2];c[j+16>>2]=c[k+16>>2];c[j+20>>2]=c[k+20>>2];c[j+24>>2]=c[k+24>>2];c[j+28>>2]=c[k+28>>2];h=h+1|0}while((h|0)!=(d|0))}d=c[b+32>>2]|0;if((d|0)!=0){if((a[b+36>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[d+ -4>>2]|0)}c[b+32>>2]=0}a[b+36>>0]=1;c[b+32>>2]=e;c[b+28>>2]=1;k=c[b+24>>2]|0;c[e+(k<<5)>>2]=0;c[e+(k<<5)+4>>2]=0;c[e+(k<<5)+8>>2]=12;c[e+(k<<5)+12>>2]=0;c[e+(k<<5)+16>>2]=0;c[e+(k<<5)+20>>2]=16;c[e+(k<<5)+24>>2]=2;c[e+(k<<5)+28>>2]=0;c[b+24>>2]=(c[b+24>>2]|0)+1;if((a[b+164>>0]|0)==0){e=c[b+32>>2]|0;c[e>>2]=(c[b+148>>2]|0)/3|0;c[e+4>>2]=0;e=c[b+32>>2]|0;c[e+24>>2]=3;c[e+8>>2]=6}else{e=c[b+32>>2]|0;c[e>>2]=(c[b+128>>2]|0)/3|0;c[e+4>>2]=0;e=c[b+32>>2]|0;c[e+24>>2]=2;c[e+8>>2]=12}if((a[b+165>>0]|0)==0){c[e+12>>2]=(c[b+108>>2]|0)/3|0;c[e+16>>2]=0;c[(c[b+32>>2]|0)+20>>2]=12;i=f;return}else{c[e+12>>2]=c[b+88>>2];c[e+16>>2]=0;c[(c[b+32>>2]|0)+20>>2]=16;i=f;return}}function LB(d,e){d=d|0;e=e|0;var f=0,g=0,h=0,j=0,k=0,l=0;f=i;if((a[d+164>>0]|0)==0){j=c[d+148>>2]|0;if((j|0)==(c[d+152>>2]|0)?(g=(j|0)==0?1:j<<1,(j|0)<(g|0)):0){if((g|0)==0)h=0;else{c[5004]=(c[5004]|0)+1;h=XE((g<<1)+19|0)|0;if((h|0)==0)h=0;else{c[(h+19&-16)+ -4>>2]=h;h=h+19&-16}j=c[d+148>>2]|0}if((j|0)>0){k=0;do{l=h+(k<<1)|0;if((l|0)!=0)b[l>>1]=b[(c[d+156>>2]|0)+(k<<1)>>1]|0;k=k+1|0}while((k|0)!=(j|0))}k=c[d+156>>2]|0;if((k|0)!=0){if((a[d+160>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[k+ -4>>2]|0);j=c[d+148>>2]|0}c[d+156>>2]=0}a[d+160>>0]=1;c[d+156>>2]=h;c[d+152>>2]=g}g=c[d+156>>2]|0;h=g+(j<<1)|0;if((h|0)!=0)b[h>>1]=e;c[d+148>>2]=j+1;c[(c[d+32>>2]|0)+4>>2]=g;i=f;return}else{l=c[d+128>>2]|0;if((l|0)==(c[d+132>>2]|0)?(h=(l|0)==0?1:l<<1,(l|0)<(h|0)):0){if((h|0)==0)g=0;else{c[5004]=(c[5004]|0)+1;g=XE((h<<2|3)+16|0)|0;if((g|0)==0)g=0;else{c[(g+19&-16)+ -4>>2]=g;g=g+19&-16}l=c[d+128>>2]|0}if((l|0)>0){j=0;do{k=g+(j<<2)|0;if((k|0)!=0)c[k>>2]=c[(c[d+136>>2]|0)+(j<<2)>>2];j=j+1|0}while((j|0)!=(l|0))}j=c[d+136>>2]|0;if((j|0)!=0){if((a[d+140>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0)}c[d+136>>2]=0}a[d+140>>0]=1;c[d+136>>2]=g;c[d+132>>2]=h;l=c[d+128>>2]|0}g=c[d+136>>2]|0;h=g+(l<<2)|0;if((h|0)!=0){c[h>>2]=e;l=c[d+128>>2]|0}c[d+128>>2]=l+1;c[(c[d+32>>2]|0)+4>>2]=g;i=f;return}}function MB(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,h=0,j=0,k=0,l=0,m=0.0,n=0.0,o=0.0,p=0.0,q=0,r=0.0,s=0.0,t=0.0;f=i;if((a[b+165>>0]|0)!=0){a:do if(e?(j=c[b+88>>2]|0,(j|0)>0):0){e=c[b+96>>2]|0;o=+g[d>>2];p=+g[d+4>>2];m=+g[d+8>>2];n=+g[b+168>>2];k=0;while(1){t=+g[e+(k<<4)>>2]-o;s=+g[e+(k<<4)+4>>2]-p;r=+g[e+(k<<4)+8>>2]-m;if(t*t+s*s+r*r<=n)break;k=k+1|0;if((k|0)>=(j|0))break a}i=f;return k|0}while(0);e=(c[b+32>>2]|0)+12|0;c[e>>2]=(c[e>>2]|0)+1;e=c[b+88>>2]|0;if((e|0)==(c[b+92>>2]|0)?(h=(e|0)==0?1:e<<1,(e|0)<(h|0)):0){if((h|0)==0)j=0;else{c[5004]=(c[5004]|0)+1;j=XE((h<<4|3)+16|0)|0;if((j|0)==0)j=0;else{c[(j+19&-16)+ -4>>2]=j;j=j+19&-16}e=c[b+88>>2]|0}if((e|0)>0){k=0;do{q=j+(k<<4)|0;l=(c[b+96>>2]|0)+(k<<4)|0;c[q+0>>2]=c[l+0>>2];c[q+4>>2]=c[l+4>>2];c[q+8>>2]=c[l+8>>2];c[q+12>>2]=c[l+12>>2];k=k+1|0}while((k|0)!=(e|0))}e=c[b+96>>2]|0;if((e|0)!=0){if((a[b+100>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+96>>2]=0}a[b+100>>0]=1;c[b+96>>2]=j;c[b+92>>2]=h;e=c[b+88>>2]|0}q=(c[b+96>>2]|0)+(e<<4)|0;c[q+0>>2]=c[d+0>>2];c[q+4>>2]=c[d+4>>2];c[q+8>>2]=c[d+8>>2];c[q+12>>2]=c[d+12>>2];q=c[b+88>>2]|0;c[b+88>>2]=q+1;c[(c[b+32>>2]|0)+16>>2]=c[b+96>>2];i=f;return q|0}j=c[b+108>>2]|0;b:do if((j|0)>0&e){e=c[b+116>>2]|0;m=+g[d>>2];n=+g[d+4>>2];o=+g[d+8>>2];p=+g[b+168>>2];h=0;while(1){r=+g[e+(h<<2)>>2]-m;s=+g[e+(h+1<<2)>>2]-n;t=+g[e+(h+2<<2)>>2]-o;k=h+3|0;if(r*r+s*s+t*t<=p)break;if((k|0)<(j|0))h=k;else{h=d;break b}}q=(h|0)/3|0;i=f;return q|0}else h=d;while(0);e=c[b+112>>2]|0;if((j|0)==(e|0)){e=(j|0)==0?1:j<<1;if((j|0)<(e|0)){if((e|0)==0)k=0;else{c[5004]=(c[5004]|0)+1;j=XE((e<<2|3)+16|0)|0;if((j|0)==0)k=0;else{c[(j+19&-16)+ -4>>2]=j;k=j+19&-16}j=c[b+108>>2]|0}if((j|0)>0){l=0;do{q=k+(l<<2)|0;if((q|0)!=0)g[q>>2]=+g[(c[b+116>>2]|0)+(l<<2)>>2];l=l+1|0}while((l|0)!=(j|0))}l=c[b+116>>2]|0;if((l|0)!=0){if((a[b+120>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[l+ -4>>2]|0);j=c[b+108>>2]|0}c[b+116>>2]=0}a[b+120>>0]=1;c[b+116>>2]=k;c[b+112>>2]=e;l=j}else{l=j;e=j}}else l=j;k=c[b+116>>2]|0;j=k+(l<<2)|0;if((j|0)!=0)g[j>>2]=+g[h>>2];j=l+1|0;c[b+108>>2]=j;if((j|0)==(e|0)){h=(e|0)==0?1:e<<1;if((e|0)<(h|0)){if((h|0)==0)k=0;else{c[5004]=(c[5004]|0)+1;j=XE((h<<2|3)+16|0)|0;if((j|0)==0)k=0;else{c[(j+19&-16)+ -4>>2]=j;k=j+19&-16}e=c[b+108>>2]|0}if((e|0)>0){j=0;do{l=k+(j<<2)|0;if((l|0)!=0)g[l>>2]=+g[(c[b+116>>2]|0)+(j<<2)>>2];j=j+1|0}while((j|0)!=(e|0))}j=c[b+116>>2]|0;if((j|0)!=0){if((a[b+120>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0);e=c[b+108>>2]|0}c[b+116>>2]=0}a[b+120>>0]=1;c[b+116>>2]=k;c[b+112>>2]=h;j=e}else{j=e;h=e}}else h=e;e=k+(j<<2)|0;if((e|0)!=0)g[e>>2]=+g[d+4>>2];j=j+1|0;c[b+108>>2]=j;if((j|0)==(h|0)){j=(h|0)==0?1:h<<1;if((h|0)<(j|0)){if((j|0)==0)k=0;else{c[5004]=(c[5004]|0)+1;h=XE((j<<2|3)+16|0)|0;if((h|0)==0)k=0;else{c[(h+19&-16)+ -4>>2]=h;k=h+19&-16}h=c[b+108>>2]|0}if((h|0)>0){e=0;do{l=k+(e<<2)|0;if((l|0)!=0)g[l>>2]=+g[(c[b+116>>2]|0)+(e<<2)>>2];e=e+1|0}while((e|0)!=(h|0))}e=c[b+116>>2]|0;if((e|0)!=0){if((a[b+120>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0);h=c[b+108>>2]|0}c[b+116>>2]=0}a[b+120>>0]=1;c[b+116>>2]=k;c[b+112>>2]=j}}else h=j;j=k+(h<<2)|0;if((j|0)!=0)g[j>>2]=+g[d+8>>2];c[b+108>>2]=h+1;q=c[b+32>>2]|0;c[q+12>>2]=(c[q+12>>2]|0)+1;c[q+16>>2]=k;q=((c[b+108>>2]|0)/3|0)+ -1|0;i=f;return q|0}function NB(b,d){b=b|0;d=d|0;var e=0,f=0,h=0,j=0,k=0,l=0;e=i;if((a[b+165>>0]|0)!=0){if((c[b+92>>2]|0)>=(d|0)){i=e;return}if((d|0)!=0?(c[5004]=(c[5004]|0)+1,h=XE((d<<4|3)+16|0)|0,(h|0)!=0):0){c[(h+19&-16)+ -4>>2]=h;f=h+19&-16}else f=0;h=c[b+88>>2]|0;if((h|0)>0){j=0;do{k=f+(j<<4)|0;l=(c[b+96>>2]|0)+(j<<4)|0;c[k+0>>2]=c[l+0>>2];c[k+4>>2]=c[l+4>>2];c[k+8>>2]=c[l+8>>2];c[k+12>>2]=c[l+12>>2];j=j+1|0}while((j|0)!=(h|0))}h=c[b+96>>2]|0;if((h|0)!=0){if((a[b+100>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[b+96>>2]=0}a[b+100>>0]=1;c[b+96>>2]=f;c[b+92>>2]=d;i=e;return}if((c[b+112>>2]|0)>=(d|0)){i=e;return}if((d|0)!=0?(c[5004]=(c[5004]|0)+1,f=XE((d<<2|3)+16|0)|0,(f|0)!=0):0){c[(f+19&-16)+ -4>>2]=f;f=f+19&-16}else f=0;h=c[b+108>>2]|0;if((h|0)>0){k=0;do{j=f+(k<<2)|0;if((j|0)!=0)g[j>>2]=+g[(c[b+116>>2]|0)+(k<<2)>>2];k=k+1|0}while((k|0)!=(h|0))}h=c[b+116>>2]|0;if((h|0)!=0){if((a[b+120>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[b+116>>2]=0}a[b+120>>0]=1;c[b+116>>2]=f;c[b+112>>2]=d;i=e;return}function OB(d,e){d=d|0;e=e|0;var f=0,g=0,h=0,j=0,k=0;f=i;if((a[d+164>>0]|0)==0){if((c[d+152>>2]|0)>=(e|0)){i=f;return}if((e|0)!=0?(c[5004]=(c[5004]|0)+1,h=XE((e<<1)+19|0)|0,(h|0)!=0):0){c[(h+19&-16)+ -4>>2]=h;g=h+19&-16}else g=0;h=c[d+148>>2]|0;if((h|0)>0){k=0;do{j=g+(k<<1)|0;if((j|0)!=0)b[j>>1]=b[(c[d+156>>2]|0)+(k<<1)>>1]|0;k=k+1|0}while((k|0)!=(h|0))}h=c[d+156>>2]|0;if((h|0)!=0){if((a[d+160>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[d+156>>2]=0}a[d+160>>0]=1;c[d+156>>2]=g;c[d+152>>2]=e;i=f;return}else{if((c[d+132>>2]|0)>=(e|0)){i=f;return}if((e|0)!=0?(c[5004]=(c[5004]|0)+1,g=XE((e<<2|3)+16|0)|0,(g|0)!=0):0){c[(g+19&-16)+ -4>>2]=g;g=g+19&-16}else g=0;k=c[d+128>>2]|0;if((k|0)>0){j=0;do{h=g+(j<<2)|0;if((h|0)!=0)c[h>>2]=c[(c[d+136>>2]|0)+(j<<2)>>2];j=j+1|0}while((j|0)!=(k|0))}h=c[d+136>>2]|0;if((h|0)!=0){if((a[d+140>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[d+136>>2]=0}a[d+140>>0]=1;c[d+136>>2]=g;c[d+132>>2]=e;i=f;return}}function PB(a){a=a|0;var b=0;b=i;VB(a);i=b;return}function QB(a){a=a|0;var b=0;b=i;VB(a);if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function RB(a,b){a=a|0;b=b|0;return}function SB(a,b){a=a|0;b=b|0;return}function TB(a){a=a|0;return c[a+24>>2]|0}function UB(a){a=a|0;return 28}function VB(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=17304;e=c[b+156>>2]|0;if((e|0)!=0){if((a[b+160>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+156>>2]=0}a[b+160>>0]=1;c[b+156>>2]=0;c[b+148>>2]=0;c[b+152>>2]=0;e=c[b+136>>2]|0;if((e|0)!=0){if((a[b+140>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+136>>2]=0}a[b+140>>0]=1;c[b+136>>2]=0;c[b+128>>2]=0;c[b+132>>2]=0;e=c[b+116>>2]|0;if((e|0)!=0){if((a[b+120>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+116>>2]=0}a[b+120>>0]=1;c[b+116>>2]=0;c[b+108>>2]=0;c[b+112>>2]=0;e=c[b+96>>2]|0;if((e|0)!=0){if((a[b+100>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+96>>2]=0}a[b+100>>0]=1;c[b+96>>2]=0;c[b+88>>2]=0;c[b+92>>2]=0;c[b>>2]=19904;e=c[b+32>>2]|0;if((e|0)==0){a[b+36>>0]=1;c[b+32>>2]=0;c[b+24>>2]=0;e=b+28|0;c[e>>2]=0;i=d;return}if((a[b+36>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+32>>2]=0;a[b+36>>0]=1;c[b+32>>2]=0;c[b+24>>2]=0;e=b+28|0;c[e>>2]=0;i=d;return}function WB(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function XB(a){a=a|0;return}function YB(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0;f=i;q=(+g[a+32>>2]- +g[a+16>>2])*.5;n=(+g[a+36>>2]- +g[a+20>>2])*.5;k=(+g[a+40>>2]- +g[a+24>>2])*.5;p=+$b[c[(c[a>>2]|0)+48>>2]&15](a);m=+$b[c[(c[a>>2]|0)+48>>2]&15](a);k=k+ +$b[c[(c[a>>2]|0)+48>>2]&15](a);D=(+g[a+32>>2]+ +g[a+16>>2])*.5;B=(+g[a+36>>2]+ +g[a+20>>2])*.5;z=(+g[a+40>>2]+ +g[a+24>>2])*.5;H=+g[b>>2];y=+P(+H);G=+g[b+4>>2];x=+P(+G);v=+g[b+8>>2];w=+P(+v);F=+g[b+16>>2];u=+P(+F);E=+g[b+20>>2];t=+P(+E);r=+g[b+24>>2];s=+P(+r);C=+g[b+32>>2];o=+P(+C);A=+g[b+36>>2];l=+P(+A);h=+g[b+40>>2];j=+P(+h);v=D*H+B*G+z*v+ +g[b+48>>2];r=D*F+B*E+z*r+ +g[b+52>>2];h=D*C+B*A+z*h+ +g[b+56>>2];g[d>>2]=v-((q+p)*y+(n+m)*x+k*w);g[d+4>>2]=r-((q+p)*u+(n+m)*t+k*s);g[d+8>>2]=h-((q+p)*o+(n+m)*l+k*j);g[d+12>>2]=0.0;g[e>>2]=(q+p)*y+(n+m)*x+k*w+v;g[e+4>>2]=(q+p)*u+(n+m)*t+k*s+r;g[e+8>>2]=(q+p)*o+(n+m)*l+k*j+h;g[e+12>>2]=0.0;i=f;return}function ZB(a,b){a=a|0;b=b|0;var d=0,e=0;d=i;i=i+48|0;e=(c[a+48>>2]|0)+4|0;c[e+0>>2]=c[b+0>>2];c[e+4>>2]=c[b+4>>2];c[e+8>>2]=c[b+8>>2];c[e+12>>2]=c[b+12>>2];c[d+32>>2]=0;c[d+36>>2]=0;c[d+40>>2]=0;c[d+44>>2]=0;g[d+32>>2]=1.0;rc[c[(c[a>>2]|0)+68>>2]&127](d+16|0,a,d+32|0);g[a+32>>2]=+g[d+16>>2]+ +g[a+12>>2];g[d+32>>2]=-1.0;rc[c[(c[a>>2]|0)+68>>2]&127](d,a,d+32|0);c[d+16>>2]=c[d+0>>2];c[d+20>>2]=c[d+4>>2];c[d+24>>2]=c[d+8>>2];c[d+28>>2]=c[d+12>>2];g[a+16>>2]=+g[d+16>>2]- +g[a+12>>2];c[d+32>>2]=0;c[d+36>>2]=0;c[d+40>>2]=0;c[d+44>>2]=0;g[d+36>>2]=1.0;rc[c[(c[a>>2]|0)+68>>2]&127](d+16|0,a,d+32|0);g[a+36>>2]=+g[d+20>>2]+ +g[a+12>>2];g[d+36>>2]=-1.0;rc[c[(c[a>>2]|0)+68>>2]&127](d,a,d+32|0);c[d+16>>2]=c[d+0>>2];c[d+20>>2]=c[d+4>>2];c[d+24>>2]=c[d+8>>2];c[d+28>>2]=c[d+12>>2];g[a+20>>2]=+g[d+20>>2]- +g[a+12>>2];c[d+32>>2]=0;c[d+36>>2]=0;c[d+40>>2]=0;c[d+44>>2]=0;g[d+40>>2]=1.0;rc[c[(c[a>>2]|0)+68>>2]&127](d+16|0,a,d+32|0);g[a+40>>2]=+g[d+24>>2]+ +g[a+12>>2];g[d+40>>2]=-1.0;rc[c[(c[a>>2]|0)+68>>2]&127](d,a,d+32|0);c[d+16>>2]=c[d+0>>2];c[d+20>>2]=c[d+4>>2];c[d+24>>2]=c[d+8>>2];c[d+28>>2]=c[d+12>>2];g[a+24>>2]=+g[d+24>>2]- +g[a+12>>2];i=d;return}function _B(a){a=a|0;return(c[a+48>>2]|0)+4|0}function $B(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;i=i+48|0;c[f>>2]=17624;c[f+4>>2]=b;c[f+8>>2]=c[d+0>>2];c[f+12>>2]=c[d+4>>2];c[f+16>>2]=c[d+8>>2];c[f+20>>2]=c[d+12>>2];c[f+24>>2]=c[e+0>>2];c[f+28>>2]=c[e+4>>2];c[f+32>>2]=c[e+8>>2];c[f+36>>2]=c[e+12>>2];b=c[a+48>>2]|0;vc[c[(c[b>>2]|0)+8>>2]&127](b,f,d,e);i=f;return}function aC(a,b,d){a=a|0;b=+b;d=d|0;a=i;c[d+0>>2]=0;c[d+4>>2]=0;c[d+8>>2]=0;c[d+12>>2]=0;i=a;return}function bC(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0;e=i;i=i+176|0;c[e+160>>2]=0;c[e+164>>2]=0;c[e+168>>2]=0;c[e+172>>2]=0;c[e+136>>2]=0;c[e+140>>2]=0;c[e+144>>2]=0;c[e+148>>2]=0;c[e+152>>2]=0;c[e+32>>2]=17560;c[e+36>>2]=0;c[e+40>>2]=0;c[e+44>>2]=0;c[e+48>>2]=0;g[e+52>>2]=1.0;c[e+56>>2]=c[e+160>>2];c[e+60>>2]=c[e+164>>2];c[e+64>>2]=c[e+168>>2];c[e+68>>2]=0;g[e+72>>2]=1.0;c[e+76>>2]=0;c[e+80>>2]=0;c[e+84>>2]=0;c[e+88>>2]=0;g[e+92>>2]=1.0;g[e+96>>2]=0.0;c[e+100>>2]=c[e+140>>2];c[e+104>>2]=c[e+144>>2];c[e+108>>2]=c[e+148>>2];c[e+112>>2]=c[e+152>>2];g[e+116>>2]=-999999984306749400.0;l=+g[d>>2];k=+g[d+4>>2];j=+g[d+8>>2];h=l*+g[e+56>>2]+k+j*0.0;f=l*+g[e+60>>2]+k*0.0+j;g[e+120>>2]=l+k*0.0+j*0.0;g[e+124>>2]=h;g[e+128>>2]=f;g[e+132>>2]=0.0;g[e+16>>2]=999999984306749400.0;g[e+20>>2]=999999984306749400.0;g[e+24>>2]=999999984306749400.0;g[e+28>>2]=0.0;d=c[(c[b>>2]|0)+64>>2]|0;g[e>>2]=-999999984306749400.0;g[e+4>>2]=-999999984306749400.0;g[e+8>>2]=-999999984306749400.0;g[e+12>>2]=0.0;vc[d&127](b,e+32|0,e,e+16|0);c[a+0>>2]=c[e+36>>2];c[a+4>>2]=c[e+40>>2];c[a+8>>2]=c[e+44>>2];c[a+12>>2]=c[e+48>>2];i=e;return}function cC(a){a=a|0;return}function dC(a){a=a|0;return 17536}function eC(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function fC(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0.0,h=0.0,j=0.0,k=0.0,l=0.0;e=i;f=+g[a+88>>2];j=+g[a+92>>2];h=+g[a+96>>2];k=f*+g[b>>2]+j*+g[b+4>>2]+h*+g[b+8>>2];l=+g[a+84>>2];if(k>l){g[a+84>>2]=k;c[a+4>>2]=c[b+0>>2];c[a+8>>2]=c[b+4>>2];c[a+12>>2]=c[b+8>>2];c[a+16>>2]=c[b+12>>2]}else k=l;l=f*+g[b+16>>2]+j*+g[b+20>>2]+h*+g[b+24>>2];if(l>k){g[a+84>>2]=l;c[a+4>>2]=c[b+16>>2];c[a+8>>2]=c[b+20>>2];c[a+12>>2]=c[b+24>>2];c[a+16>>2]=c[b+28>>2];k=l}f=f*+g[b+32>>2]+j*+g[b+36>>2]+h*+g[b+40>>2];if(!(f>k)){i=e;return}g[a+84>>2]=f;c[a+4>>2]=c[b+32>>2];c[a+8>>2]=c[b+36>>2];c[a+12>>2]=c[b+40>>2];c[a+16>>2]=c[b+44>>2];i=e;return}function gC(a){a=a|0;return}function hC(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function iC(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0;f=i;k=+g[b>>2];j=+g[b+16>>2];l=k<j?k:j;h=+g[b+32>>2];if((l<h?l:h)>+g[a+24>>2]){i=f;return}m=k>j?b:b+16|0;if(+g[(+g[m>>2]>h?m:b+32|0)>>2]<+g[a+8>>2]){i=f;return}h=+g[b+8>>2];j=+g[b+24>>2];l=h<j?h:j;k=+g[b+40>>2];if((l<k?l:k)>+g[a+32>>2]){i=f;return}m=h>j?b+8|0:b+24|0;if(+g[(+g[m>>2]>k?m:b+40|0)>>2]<+g[a+16>>2]){i=f;return}h=+g[b+4>>2];j=+g[b+20>>2];l=h<j?h:j;k=+g[b+36>>2];if((l<k?l:k)>+g[a+28>>2]){i=f;return}m=h>j?b+4|0:b+20|0;if(+g[(+g[m>>2]>k?m:b+36|0)>>2]<+g[a+12>>2]){i=f;return}m=c[a+4>>2]|0;vc[c[(c[m>>2]|0)+8>>2]&127](m,b,d,e);i=f;return}function jC(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0;e=i;while(1){f=c[a+12>>2]|0;g=c[f+(((b+d|0)/2|0)<<3)>>2]|0;k=b;h=d;while(1){while(1){l=k+1|0;if((c[f+(k<<3)>>2]|0)<(g|0))k=l;else{j=h;break}}while(1){m=f+(j<<3)|0;h=j+ -1|0;if((g|0)<(c[m>>2]|0))j=h;else break}if((k|0)>(j|0))h=j;else{k=f+(k<<3)|0;n=c[k>>2]|0;f=c[k+4>>2]|0;o=c[m+4>>2]|0;c[k>>2]=c[m>>2];c[k+4>>2]=o;k=(c[a+12>>2]|0)+(j<<3)|0;c[k>>2]=n;c[k+4>>2]=f;k=l}if((k|0)>(h|0))break;f=c[a+12>>2]|0}if((h|0)>(b|0))jC(a,b,h);if((k|0)<(d|0))b=k;else break}i=e;return}function kC(b,d){b=b|0;d=d|0;var e=0,f=0,g=0,h=0;e=i;h=c[b>>2]|0;if((h|0)>3){g=a[d>>0]|0;if((g&8)==0){c[b>>2]=h+ -1;f=b+(h+ -1<<4)+4|0;c[b+52>>2]=c[f+0>>2];c[b+56>>2]=c[f+4>>2];c[b+60>>2]=c[f+8>>2];c[b+64>>2]=c[f+12>>2];f=b+(h+ -1<<4)+84|0;c[b+132>>2]=c[f+0>>2];c[b+136>>2]=c[f+4>>2];c[b+140>>2]=c[f+8>>2];c[b+144>>2]=c[f+12>>2];f=b+(h+ -1<<4)+164|0;c[b+212>>2]=c[f+0>>2];c[b+216>>2]=c[f+4>>2];c[b+220>>2]=c[f+8>>2];c[b+224>>2]=c[f+12>>2];h=h+ -1|0;f=4}else f=6}else f=4;if((f|0)==4)if((h|0)>2){g=a[d>>0]|0;f=6}else g=h;if((f|0)==6)if((g&4)==0){g=h+ -1|0;c[b>>2]=g;c[b+36>>2]=c[b+(g<<4)+4>>2];c[b+40>>2]=c[b+(g<<4)+8>>2];c[b+44>>2]=c[b+(g<<4)+12>>2];c[b+48>>2]=c[b+(g<<4)+16>>2];c[b+116>>2]=c[b+(g<<4)+84>>2];c[b+120>>2]=c[b+(g<<4)+88>>2];c[b+124>>2]=c[b+(g<<4)+92>>2];c[b+128>>2]=c[b+(g<<4)+96>>2];c[b+196>>2]=c[b+(g<<4)+164>>2];c[b+200>>2]=c[b+(g<<4)+168>>2];c[b+204>>2]=c[b+(g<<4)+172>>2];c[b+208>>2]=c[b+(g<<4)+176>>2]}else g=h;if((g|0)>1){h=a[d>>0]|0;if((h&2)==0){g=g+ -1|0;c[b>>2]=g;c[b+20>>2]=c[b+(g<<4)+4>>2];c[b+24>>2]=c[b+(g<<4)+8>>2];c[b+28>>2]=c[b+(g<<4)+12>>2];c[b+32>>2]=c[b+(g<<4)+16>>2];c[b+100>>2]=c[b+(g<<4)+84>>2];c[b+104>>2]=c[b+(g<<4)+88>>2];c[b+108>>2]=c[b+(g<<4)+92>>2];c[b+112>>2]=c[b+(g<<4)+96>>2];c[b+180>>2]=c[b+(g<<4)+164>>2];c[b+184>>2]=c[b+(g<<4)+168>>2];c[b+188>>2]=c[b+(g<<4)+172>>2];c[b+192>>2]=c[b+(g<<4)+176>>2];f=11}else d=h}else f=11;do if((f|0)==11)if((g|0)>0){d=a[d>>0]|0;break}else{i=e;return}while(0);if(!((d&1)==0)){i=e;return}h=g+ -1|0;c[b>>2]=h;c[b+4>>2]=c[b+(h<<4)+4>>2];c[b+8>>2]=c[b+(h<<4)+8>>2];c[b+12>>2]=c[b+(h<<4)+12>>2];c[b+16>>2]=c[b+(h<<4)+16>>2];c[b+84>>2]=c[b+(h<<4)+84>>2];c[b+88>>2]=c[b+(h<<4)+88>>2];c[b+92>>2]=c[b+(h<<4)+92>>2];c[b+96>>2]=c[b+(h<<4)+96>>2];c[b+164>>2]=c[b+(h<<4)+164>>2];c[b+168>>2]=c[b+(h<<4)+168>>2];c[b+172>>2]=c[b+(h<<4)+172>>2];c[b+176>>2]=c[b+(h<<4)+176>>2];i=e;return}function lC(b){b=b|0;var d=0,e=0.0,f=0.0,h=0.0,j=0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0,K=0.0,L=0.0,M=0,N=0,O=0.0,P=0.0,Q=0.0,R=0.0,S=0,T=0;d=i;i=i+80|0;if((a[b+356>>0]|0)==0){T=a[b+312>>0]|0;T=T<<24>>24!=0;i=d;return T|0}c[b+336>>2]=0;c[b+340>>2]=0;c[b+344>>2]=0;c[b+348>>2]=0;a[b+352>>0]=0;J=a[b+332>>0]|0;a[b+332>>0]=J&-16;a[b+356>>0]=0;switch(c[b>>2]|0){case 1:{c[b+244>>2]=c[b+84>>2];c[b+248>>2]=c[b+88>>2];c[b+252>>2]=c[b+92>>2];c[b+256>>2]=c[b+96>>2];c[b+260>>2]=c[b+164>>2];c[b+264>>2]=c[b+168>>2];c[b+268>>2]=c[b+172>>2];c[b+272>>2]=c[b+176>>2];Q=+g[b+248>>2]- +g[b+264>>2];R=+g[b+252>>2]- +g[b+268>>2];g[b+276>>2]=+g[b+244>>2]- +g[b+260>>2];g[b+280>>2]=Q;g[b+284>>2]=R;g[b+288>>2]=0.0;c[b+336>>2]=0;c[b+340>>2]=0;c[b+344>>2]=0;c[b+348>>2]=0;a[b+352>>0]=0;a[b+332>>0]=J&-16;g[b+336>>2]=1.0;g[b+340>>2]=0.0;g[b+344>>2]=0.0;g[b+348>>2]=0.0;a[b+312>>0]=1;T=1;T=T<<24>>24!=0;i=d;return T|0};case 0:{a[b+312>>0]=0;T=0;T=T<<24>>24!=0;i=d;return T|0};case 4:{c[d+0>>2]=0;c[d+4>>2]=0;c[d+8>>2]=0;c[d+12>>2]=0;j=d+48|0;a[j>>0]=0;c[b+316>>2]=c[d+0>>2];c[b+320>>2]=c[d+4>>2];c[b+324>>2]=c[d+8>>2];c[b+328>>2]=c[d+12>>2];a[b+332>>0]=J|15;G=+g[b+20>>2];P=+g[b+4>>2];C=+g[b+24>>2];Q=+g[b+8>>2];E=+g[b+28>>2];O=+g[b+12>>2];F=+g[b+36>>2];L=+g[b+40>>2];I=+g[b+44>>2];H=+g[b+52>>2];K=+g[b+56>>2];D=+g[b+60>>2];R=(H-P)*((C-Q)*(I-O)-(E-O)*(L-Q))+(K-Q)*((E-O)*(F-P)-(G-P)*(I-O))+((G-P)*(L-Q)-(C-Q)*(F-P))*(D-O);if(R*R<9.99999905104687e-9)N=-1;else N=R*(((E-O)*(F-P)-(G-P)*(I-O))*(0.0-Q)+((C-Q)*(I-O)-(E-O)*(L-Q))*(0.0-P)+((G-P)*(L-Q)-(C-Q)*(F-P))*(0.0-O))<0.0&1;R=(G-P)*((L-Q)*(D-O)-(I-O)*(K-Q))+(C-Q)*((I-O)*(H-P)-(F-P)*(D-O))+((F-P)*(K-Q)-(L-Q)*(H-P))*(E-O);if(R*R<9.99999905104687e-9)M=-1;else M=R*(((I-O)*(H-P)-(F-P)*(D-O))*(0.0-Q)+((L-Q)*(D-O)-(I-O)*(K-Q))*(0.0-P)+((F-P)*(K-Q)-(L-Q)*(H-P))*(0.0-O))<0.0&1;R=(F-P)*((K-Q)*(E-O)-(D-O)*(C-Q))+(L-Q)*((D-O)*(G-P)-(H-P)*(E-O))+((H-P)*(C-Q)-(K-Q)*(G-P))*(I-O);if(R*R<9.99999905104687e-9)J=-1;else J=R*(((D-O)*(G-P)-(H-P)*(E-O))*(0.0-Q)+((K-Q)*(E-O)-(D-O)*(C-Q))*(0.0-P)+((H-P)*(C-Q)-(K-Q)*(G-P))*(0.0-O))<0.0&1;O=(P-G)*((K-C)*(I-E)-(D-E)*(L-C))+(Q-C)*((D-E)*(F-G)-(H-G)*(I-E))+((H-G)*(L-C)-(K-C)*(F-G))*(O-E);if(O*O<9.99999905104687e-9)S=-1;else S=O*(((D-E)*(F-G)-(H-G)*(I-E))*(0.0-C)+((K-C)*(I-E)-(D-E)*(L-C))*(0.0-G)+((H-G)*(L-C)-(K-C)*(F-G))*(0.0-E))<0.0&1;if((M|N|J|S|0)<0){a[b+352>>0]=1;a[b+312>>0]=0;T=0;T=T<<24>>24!=0;i=d;return T|0}T=(N|0)!=0;N=(M|0)==0;J=(J|0)==0;M=(S|0)==0;if(N&(T^1)&J&M){a[b+312>>0]=1;c[b+276>>2]=0;c[b+280>>2]=0;c[b+284>>2]=0;c[b+288>>2]=0;T=1;T=T<<24>>24!=0;i=d;return T|0}if(T?(mC(d,b+4|0,b+20|0,b+36|0,d+32|0),B=+g[d+32>>2],w=+g[d+36>>2],x=+g[d+40>>2],y=B- +g[d>>2],z=w- +g[d+4>>2],A=x- +g[d+8>>2],y*y+z*z+A*A<3.4028234663852886e+38):0){R=+g[d+44>>2];g[b+316>>2]=B;g[b+320>>2]=w;g[b+324>>2]=x;g[b+328>>2]=R;T=a[j>>0]|0;a[b+332>>0]=T&1|a[b+332>>0]&-16|T&2|T&4;R=+g[d+56>>2];w=+g[d+60>>2];g[b+336>>2]=+g[d+52>>2];g[b+340>>2]=R;g[b+344>>2]=w;g[b+348>>2]=0.0;w=y*y+z*z+A*A}else w=3.4028234663852886e+38;if(!N?(mC(d,b+4|0,b+36|0,b+52|0,d+32|0),r=+g[d+32>>2],u=+g[d+36>>2],q=+g[d+40>>2],v=r- +g[d>>2],s=u- +g[d+4>>2],t=q- +g[d+8>>2],v*v+s*s+t*t<w):0){R=+g[d+44>>2];g[b+316>>2]=r;g[b+320>>2]=u;g[b+324>>2]=q;g[b+328>>2]=R;T=a[j>>0]|0;a[b+332>>0]=T<<1&4|(T&1|a[b+332>>0]&-16)|T<<1&8;R=+g[d+56>>2];w=+g[d+60>>2];g[b+336>>2]=+g[d+52>>2];g[b+340>>2]=0.0;g[b+344>>2]=R;g[b+348>>2]=w;w=v*v+s*s+t*t}if(!J?(mC(d,b+4|0,b+52|0,b+20|0,d+32|0),k=+g[d+32>>2],l=+g[d+36>>2],m=+g[d+40>>2],n=k- +g[d>>2],o=l- +g[d+4>>2],p=m- +g[d+8>>2],n*n+o*o+p*p<w):0){R=+g[d+44>>2];g[b+316>>2]=k;g[b+320>>2]=l;g[b+324>>2]=m;g[b+328>>2]=R;T=a[j>>0]|0;a[b+332>>0]=(T&255)>>>1&2|(T&1|a[b+332>>0]&-16)|T<<2&8;R=+g[d+60>>2];w=+g[d+56>>2];g[b+336>>2]=+g[d+52>>2];g[b+340>>2]=R;g[b+344>>2]=0.0;g[b+348>>2]=w;w=n*n+o*o+p*p}if(!M?(mC(d,b+20|0,b+52|0,b+36|0,d+32|0),f=+g[d+32>>2],e=+g[d+36>>2],h=+g[d+40>>2],P=f- +g[d>>2],Q=e- +g[d+4>>2],R=h- +g[d+8>>2],P*P+Q*Q+R*R<w):0){P=+g[d+44>>2];g[b+316>>2]=f;g[b+320>>2]=e;g[b+324>>2]=h;g[b+328>>2]=P;T=a[j>>0]|0;a[b+332>>0]=T<<1&2|a[b+332>>0]&-16|T&4|T<<2&8;P=+g[d+52>>2];Q=+g[d+60>>2];R=+g[d+56>>2];g[b+336>>2]=0.0;g[b+340>>2]=P;g[b+344>>2]=Q;g[b+348>>2]=R}G=+g[b+336>>2];H=+g[b+340>>2];I=+g[b+344>>2];R=+g[b+348>>2];K=+g[b+84>>2]*G+ +g[b+100>>2]*H+ +g[b+116>>2]*I+ +g[b+132>>2]*R;O=G*+g[b+88>>2]+H*+g[b+104>>2]+I*+g[b+120>>2]+R*+g[b+136>>2];Q=G*+g[b+92>>2]+H*+g[b+108>>2]+I*+g[b+124>>2]+R*+g[b+140>>2];g[b+244>>2]=K;g[b+248>>2]=O;g[b+252>>2]=Q;g[b+256>>2]=0.0;L=+g[b+164>>2]*G+ +g[b+180>>2]*H+ +g[b+196>>2]*I+ +g[b+212>>2]*R;P=G*+g[b+168>>2]+H*+g[b+184>>2]+I*+g[b+200>>2]+R*+g[b+216>>2];R=G*+g[b+172>>2]+H*+g[b+188>>2]+I*+g[b+204>>2]+R*+g[b+220>>2];g[b+260>>2]=L;g[b+264>>2]=P;g[b+268>>2]=R;g[b+272>>2]=0.0;g[b+276>>2]=K-L;g[b+280>>2]=O-P;g[b+284>>2]=Q-R;g[b+288>>2]=0.0;kC(b,b+332|0);if((+g[b+336>>2]>=0.0?+g[b+340>>2]>=0.0:0)?+g[b+344>>2]>=0.0:0)j=+g[b+348>>2]>=0.0&1;else j=0;a[b+312>>0]=j;T=j;T=T<<24>>24!=0;i=d;return T|0};case 3:{c[d+16>>2]=0;c[d+20>>2]=0;c[d+24>>2]=0;c[d+28>>2]=0;mC(d+16|0,b+4|0,b+20|0,b+36|0,b+316|0);H=+g[b+336>>2];I=+g[b+340>>2];R=+g[b+344>>2];K=+g[b+84>>2]*H+ +g[b+100>>2]*I+ +g[b+116>>2]*R;O=H*+g[b+88>>2]+I*+g[b+104>>2]+R*+g[b+120>>2];Q=H*+g[b+92>>2]+I*+g[b+108>>2]+R*+g[b+124>>2];g[b+244>>2]=K;g[b+248>>2]=O;g[b+252>>2]=Q;g[b+256>>2]=0.0;L=+g[b+164>>2]*H+ +g[b+180>>2]*I+ +g[b+196>>2]*R;P=H*+g[b+168>>2]+I*+g[b+184>>2]+R*+g[b+200>>2];R=H*+g[b+172>>2]+I*+g[b+188>>2]+R*+g[b+204>>2];g[b+260>>2]=L;g[b+264>>2]=P;g[b+268>>2]=R;g[b+272>>2]=0.0;g[b+276>>2]=K-L;g[b+280>>2]=O-P;g[b+284>>2]=Q-R;g[b+288>>2]=0.0;kC(b,b+332|0);if((+g[b+336>>2]>=0.0?+g[b+340>>2]>=0.0:0)?+g[b+344>>2]>=0.0:0)j=+g[b+348>>2]>=0.0&1;else j=0;a[b+312>>0]=j;T=j;T=T<<24>>24!=0;i=d;return T|0};case 2:{k=+g[b+4>>2];f=+g[b+8>>2];m=+g[b+12>>2];e=+g[b+20>>2]-k;h=+g[b+24>>2]-f;l=+g[b+28>>2]-m;do if((0.0-k)*e+(0.0-f)*h+(0.0-m)*l>0.0)if((0.0-k)*e+(0.0-f)*h+(0.0-m)*l<e*e+h*h+l*l){a[b+332>>0]=J&-16|3;e=((0.0-k)*e+(0.0-f)*h+(0.0-m)*l)/(e*e+h*h+l*l);break}else{a[b+332>>0]=J&-16|2;e=1.0;break}else{a[b+332>>0]=J&-16|1;e=0.0}while(0);g[b+336>>2]=1.0-e;g[b+340>>2]=e;g[b+344>>2]=0.0;g[b+348>>2]=0.0;K=+g[b+84>>2];O=+g[b+88>>2];Q=+g[b+92>>2];K=K+e*(+g[b+100>>2]-K);O=O+e*(+g[b+104>>2]-O);Q=Q+e*(+g[b+108>>2]-Q);g[b+244>>2]=K;g[b+248>>2]=O;g[b+252>>2]=Q;g[b+256>>2]=0.0;L=+g[b+164>>2];P=+g[b+168>>2];R=+g[b+172>>2];L=L+e*(+g[b+180>>2]-L);P=P+e*(+g[b+184>>2]-P);R=R+e*(+g[b+188>>2]-R);g[b+260>>2]=L;g[b+264>>2]=P;g[b+268>>2]=R;g[b+272>>2]=0.0;g[b+276>>2]=K-L;g[b+280>>2]=O-P;g[b+284>>2]=Q-R;g[b+288>>2]=0.0;kC(b,b+332|0);if((+g[b+336>>2]>=0.0?+g[b+340>>2]>=0.0:0)?+g[b+344>>2]>=0.0:0)j=+g[b+348>>2]>=0.0&1;else j=0;a[b+312>>0]=j;T=j;T=T<<24>>24!=0;i=d;return T|0};default:{a[b+312>>0]=0;T=0;T=T<<24>>24!=0;i=d;return T|0}}return 0}function mC(b,d,e,f,h){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0,p=0.0,q=0.0,r=0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0;r=i;o=a[h+16>>0]&-16;a[h+16>>0]=o;l=+g[e>>2];k=+g[d>>2];n=+g[e+4>>2];m=+g[d+4>>2];p=+g[e+8>>2];j=+g[d+8>>2];q=+g[f>>2];s=+g[f+4>>2];t=+g[f+8>>2];u=+g[b>>2];v=+g[b+4>>2];y=+g[b+8>>2];w=(l-k)*(u-k)+(n-m)*(v-m)+(p-j)*(y-j);x=(q-k)*(u-k)+(s-m)*(v-m)+(t-j)*(y-j);if(!(!(w<=0.0)|!(x<=0.0))){c[h+0>>2]=c[d+0>>2];c[h+4>>2]=c[d+4>>2];c[h+8>>2]=c[d+8>>2];c[h+12>>2]=c[d+12>>2];a[h+16>>0]=o|1;g[h+20>>2]=1.0;g[h+24>>2]=0.0;g[h+28>>2]=0.0;g[h+32>>2]=0.0;i=r;return}z=(l-k)*(u-l)+(n-m)*(v-n)+(p-j)*(y-p);A=(q-k)*(u-l)+(s-m)*(v-n)+(t-j)*(y-p);if(!(!(z>=0.0)|!(A<=z))){c[h+0>>2]=c[e+0>>2];c[h+4>>2]=c[e+4>>2];c[h+8>>2]=c[e+8>>2];c[h+12>>2]=c[e+12>>2];a[h+16>>0]=o|2;g[h+20>>2]=0.0;g[h+24>>2]=1.0;g[h+28>>2]=0.0;g[h+32>>2]=0.0;i=r;return}if(!((w>=0.0?!(w*A-z*x<=0.0):1)|!(z<=0.0))){g[h>>2]=k+(l-k)*(w/(w-z));g[h+4>>2]=m+(n-m)*(w/(w-z));g[h+8>>2]=j+(p-j)*(w/(w-z));g[h+12>>2]=0.0;a[h+16>>0]=o|3;g[h+20>>2]=1.0-w/(w-z);g[h+24>>2]=w/(w-z);g[h+28>>2]=0.0;g[h+32>>2]=0.0;i=r;return}B=(l-k)*(u-q)+(n-m)*(v-s)+(p-j)*(y-t);u=(q-k)*(u-q)+(s-m)*(v-s)+(t-j)*(y-t);if(!(!(u>=0.0)|!(B<=u))){c[h+0>>2]=c[f+0>>2];c[h+4>>2]=c[f+4>>2];c[h+8>>2]=c[f+8>>2];c[h+12>>2]=c[f+12>>2];a[h+16>>0]=o|4;g[h+20>>2]=0.0;g[h+24>>2]=0.0;g[h+28>>2]=1.0;g[h+32>>2]=0.0;i=r;return}if(!((x>=0.0?!(B*x-w*u<=0.0):1)|!(u<=0.0))){g[h>>2]=k+(q-k)*(x/(x-u));g[h+4>>2]=m+(s-m)*(x/(x-u));g[h+8>>2]=j+(t-j)*(x/(x-u));g[h+12>>2]=0.0;a[h+16>>0]=o|5;g[h+20>>2]=1.0-x/(x-u);g[h+24>>2]=0.0;g[h+28>>2]=x/(x-u);g[h+32>>2]=0.0;i=r;return}if((z*u-B*A<=0.0?A-z>=0.0:0)?B-u>=0.0:0){B=(A-z)/(A-z+(B-u));g[h>>2]=l+(q-l)*B;g[h+4>>2]=n+(s-n)*B;g[h+8>>2]=p+(t-p)*B;g[h+12>>2]=0.0;a[h+16>>0]=o|6;g[h+20>>2]=0.0;g[h+24>>2]=1.0-B;g[h+28>>2]=B;g[h+32>>2]=0.0;i=r;return}v=1.0/(w*A-z*x+(z*u-B*A+(B*x-w*u)));y=(B*x-w*u)*v;B=(w*A-z*x)*v;g[h>>2]=(q-k)*B+(k+(l-k)*y);g[h+4>>2]=(s-m)*B+(m+(n-m)*y);g[h+8>>2]=(t-j)*B+((p-j)*y+j);g[h+12>>2]=0.0;a[h+16>>0]=o|7;g[h+20>>2]=1.0-y-B;g[h+24>>2]=y;g[h+28>>2]=B;g[h+32>>2]=0.0;i=r;return}function nC(a,b,d,e,f){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;var h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0,r=0.0,s=0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0;e=i;i=i+96|0;p=+g[b+48>>2]- +g[b+112>>2];j=+g[b+52>>2]- +g[b+116>>2];k=+g[b+56>>2]- +g[b+120>>2];n=p*+g[b+64>>2]+j*+g[b+80>>2]+k*+g[b+96>>2];m=p*+g[b+68>>2]+j*+g[b+84>>2]+k*+g[b+100>>2];k=p*+g[b+72>>2]+j*+g[b+88>>2]+k*+g[b+104>>2];q=c[a+8>>2]|0;s=c[a+4>>2]|0;j=+g[s+28>>2]*+g[s+12>>2];p=j+ +g[a+12>>2];w=+g[q+72>>2];u=+g[q+56>>2];t=+g[q+76>>2];B=+g[q+60>>2];v=+g[q+80>>2];x=+g[q+64>>2];y=+g[q+88>>2];z=+g[q+92>>2];A=+g[q+96>>2];C=(t-B)*(A-x)-(v-x)*(z-B);l=(v-x)*(y-u)-(w-u)*(A-x);h=(w-u)*(z-B)-(t-B)*(y-u);o=1.0/+Q(+(h*h+(C*C+l*l)));r=(n-u)*o*C+o*l*(m-B)+o*h*(k-x);if(r<0.0){r=r*-1.0;h=o*h*-1.0;l=o*l*-1.0;o=o*C*-1.0}else{h=o*h;l=o*l;o=o*C}if(!(r<p)){i=e;return}C=(k-x)*((w-u)*l-(t-B)*o)+((n-u)*((t-B)*h-(v-x)*l)+(m-B)*((v-x)*o-(w-u)*h));D=(k-v)*((y-w)*l-(z-t)*o)+((n-w)*((z-t)*h-(A-v)*l)+(m-t)*((A-v)*o-(y-w)*h));E=(k-A)*((u-y)*l-(B-z)*o)+((n-y)*((B-z)*h-(x-A)*l)+(m-z)*((x-A)*o-(u-y)*h));if(!(C>0.0&D>0.0&E>0.0)?!(C<=0.0)|!(D<=0.0)|!(E<=0.0):0){if((Pb[c[(c[q>>2]|0)+100>>2]&127](q)|0)<=0){i=e;return}r=0.0;t=0.0;y=0.0;s=0;q=0;do{F=c[a+8>>2]|0;vc[c[(c[F>>2]|0)+104>>2]&127](F,q,e+80|0,e+64|0);w=+g[e+80>>2];z=+g[e+84>>2];D=+g[e+88>>2];v=+g[e+64>>2]-w;x=+g[e+68>>2]-z;E=+g[e+72>>2]-D;do if((n-w)*v+(m-z)*x+(k-D)*E>0.0)if((n-w)*v+(m-z)*x+(k-D)*E<v*v+x*x+E*E){u=((n-w)*v+(m-z)*x+(k-D)*E)/(v*v+x*x+E*E);A=n-w-v*u;B=m-z-x*u;C=k-D-E*u;break}else{A=n-w-v;B=m-z-x;C=k-D-E;u=1.0;break}else{A=n-w;B=m-z;C=k-D;u=0.0}while(0);if(C*C+(B*B+A*A)<p*p){y=D+E*u;t=z+x*u;r=w+v*u;s=1}q=q+1|0;F=c[a+8>>2]|0}while((q|0)<(Pb[c[(c[F>>2]|0)+100>>2]&127](F)|0));if((s&1)==0){i=e;return}else{u=p*p;p=r}}else{u=p*p;p=n-o*r;t=m-l*r;y=k-h*r}n=n-p;m=m-t;k=k-y;if(!(n*n+m*m+k*k<u)){i=e;return}if(n*n+m*m+k*k>1.1920928955078125e-7){h=+Q(+(n*n+m*m+k*k));j=j-h;o=n*(1.0/h);l=m*(1.0/h);h=k*(1.0/h)}j=-j;if(f){z=+g[b+64>>2];A=+g[b+68>>2];B=+g[b+72>>2];C=z*o+A*l+B*h;n=+g[b+80>>2];r=+g[b+84>>2];u=+g[b+88>>2];D=o*n+l*r+h*u;v=+g[b+96>>2];w=+g[b+100>>2];x=+g[b+104>>2];E=o*v+l*w+h*x;g[e+48>>2]=-C;g[e+52>>2]=-D;g[e+56>>2]=-E;g[e+60>>2]=0.0;D=p*n+t*r+y*u+ +g[b+116>>2]+D*j;E=p*v+t*w+y*x+ +g[b+120>>2]+E*j;g[e+32>>2]=p*z+t*A+y*B+ +g[b+112>>2]+C*j;g[e+36>>2]=D;g[e+40>>2]=E;g[e+44>>2]=0.0;qc[c[(c[d>>2]|0)+16>>2]&15](d,e+48|0,e+32|0,j);i=e;return}else{F=c[(c[d>>2]|0)+16>>2]|0;A=+g[b+64>>2];B=+g[b+68>>2];C=+g[b+72>>2];v=+g[b+80>>2];w=+g[b+84>>2];D=+g[b+88>>2];x=+g[b+96>>2];z=+g[b+100>>2];E=+g[b+104>>2];g[e+16>>2]=A*o+B*l+C*h;g[e+20>>2]=o*v+l*w+h*D;g[e+24>>2]=o*x+l*z+h*E;g[e+28>>2]=0.0;D=p*v+t*w+y*D+ +g[b+116>>2];E=p*x+t*z+y*E+ +g[b+120>>2];g[e>>2]=p*A+t*B+y*C+ +g[b+112>>2];g[e+4>>2]=D;g[e+8>>2]=E;g[e+12>>2]=0.0;qc[F&15](d,e+16|0,e,j);i=e;return}}function oC(a){a=a|0;return}function pC(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function qC(b){b=b|0;var d=0,e=0,f=0;d=i;c[b>>2]=17896;if((a[b+8>>0]|0)!=0?(e=c[b+12>>2]|0,(e|0)!=0):0){f=c[b+4>>2]|0;Nb[c[(c[f>>2]|0)+16>>2]&127](f,e)}YE(b);i=d;return}function rC(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=17896;if((a[b+8>>0]|0)==0){i=d;return}e=c[b+12>>2]|0;if((e|0)==0){i=d;return}b=c[b+4>>2]|0;Nb[c[(c[b>>2]|0)+16>>2]&127](b,e);i=d;return}function sC(b,d,e,f,h){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0,k=0,l=0,m=0;j=i;i=i+144|0;k=c[b+12>>2]|0;if((k|0)==0){i=j;return}m=c[d+4>>2]|0;l=c[e+4>>2]|0;c[h+4>>2]=k;g[j+140>>2]=999999984306749400.0;k=c[d+12>>2]|0;c[j+12>>2]=c[k+0>>2];c[j+16>>2]=c[k+4>>2];c[j+20>>2]=c[k+8>>2];c[j+24>>2]=c[k+12>>2];c[j+28>>2]=c[k+16>>2];c[j+32>>2]=c[k+20>>2];c[j+36>>2]=c[k+24>>2];c[j+40>>2]=c[k+28>>2];c[j+44>>2]=c[k+32>>2];c[j+48>>2]=c[k+36>>2];c[j+52>>2]=c[k+40>>2];c[j+56>>2]=c[k+44>>2];c[j+60>>2]=c[k+48>>2];c[j+64>>2]=c[k+52>>2];c[j+68>>2]=c[k+56>>2];c[j+72>>2]=c[k+60>>2];e=c[e+12>>2]|0;c[j+76>>2]=c[e+0>>2];c[j+80>>2]=c[e+4>>2];c[j+84>>2]=c[e+8>>2];c[j+88>>2]=c[e+12>>2];c[j+92>>2]=c[e+16>>2];c[j+96>>2]=c[e+20>>2];c[j+100>>2]=c[e+24>>2];c[j+104>>2]=c[e+28>>2];c[j+108>>2]=c[e+32>>2];c[j+112>>2]=c[e+36>>2];c[j+116>>2]=c[e+40>>2];c[j+120>>2]=c[e+44>>2];c[j+124>>2]=c[e+48>>2];c[j+128>>2]=c[e+52>>2];c[j+132>>2]=c[e+56>>2];c[j+136>>2]=c[e+60>>2];c[j>>2]=17976;c[j+4>>2]=m;c[j+8>>2]=l;vC(j,j+12|0,h,c[f+20>>2]|0,0);if((a[b+8>>0]|0)==0){i=j;return}d=c[h+4>>2]|0;if((c[d+748>>2]|0)==0){i=j;return}k=c[d+740>>2]|0;e=c[(c[h+8>>2]|0)+8>>2]|0;if((k|0)==(e|0)){nA(d,k+4|0,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0);i=j;return}else{nA(d,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0,e+4|0);i=j;return}}function tC(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;return 1.0}function uC(b,d){b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0;e=i;if((c[b+12>>2]|0)==0){i=e;return}if((a[b+8>>0]|0)==0){i=e;return}h=c[d+4>>2]|0;if((h|0)==(c[d+8>>2]|0)?(f=(h|0)==0?1:h<<1,(h|0)<(f|0)):0){if((f|0)==0)g=0;else{c[5004]=(c[5004]|0)+1;g=XE((f<<2|3)+16|0)|0;if((g|0)==0)g=0;else{c[(g+19&-16)+ -4>>2]=g;g=g+19&-16}h=c[d+4>>2]|0}if((h|0)>0){j=0;do{k=g+(j<<2)|0;if((k|0)!=0)c[k>>2]=c[(c[d+12>>2]|0)+(j<<2)>>2];j=j+1|0}while((j|0)!=(h|0))}j=c[d+12>>2]|0;if((j|0)!=0){if((a[d+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0);h=c[d+4>>2]|0}c[d+12>>2]=0}a[d+16>>0]=1;c[d+12>>2]=g;c[d+8>>2]=f}f=(c[d+12>>2]|0)+(h<<2)|0;if((f|0)!=0)c[f>>2]=c[b+12>>2];c[d+4>>2]=h+1;i=e;return}function vC(a,b,d,e,f){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;var h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0,X=0.0,Z=0.0,_=0.0,$=0.0,aa=0.0,ba=0.0,ca=0.0,da=0.0,ea=0.0,fa=0,ga=0,ha=0,ia=0,ja=0,ka=0,la=0,ma=0.0,na=0.0,oa=0.0,pa=0,qa=0.0,ra=0.0,sa=0,ta=0,ua=0,va=0.0,wa=0,xa=0,ya=0,za=0,Aa=0,Ba=0,Ca=0,Da=0;e=i;i=i+656|0;g[e+48>>2]=+g[b>>2];g[e>>2]=+g[b+64>>2];f=e+52|0;g[f>>2]=+g[b+4>>2];g[e+4>>2]=+g[b+68>>2];g[e+56>>2]=+g[b+8>>2];g[e+8>>2]=+g[b+72>>2];g[e+64>>2]=+g[b+16>>2];g[e+16>>2]=+g[b+80>>2];g[e+68>>2]=+g[b+20>>2];g[e+20>>2]=+g[b+84>>2];g[e+72>>2]=+g[b+24>>2];g[e+24>>2]=+g[b+88>>2];g[e+80>>2]=+g[b+32>>2];g[e+32>>2]=+g[b+96>>2];g[e+84>>2]=+g[b+36>>2];g[e+36>>2]=+g[b+100>>2];g[e+88>>2]=+g[b+40>>2];g[e+40>>2]=+g[b+104>>2];Da=c[a+4>>2]|0;A=+g[Da+28>>2];B=+g[Da+32>>2];E=+g[Da+36>>2];C=+$b[c[(c[Da>>2]|0)+48>>2]&15](Da);D=+$b[c[(c[Da>>2]|0)+48>>2]&15](Da);E=(E+ +$b[c[(c[Da>>2]|0)+48>>2]&15](Da))*2.0;Da=c[a+8>>2]|0;w=+g[Da+28>>2];y=+g[Da+32>>2];q=+g[Da+36>>2];v=+$b[c[(c[Da>>2]|0)+48>>2]&15](Da);x=+$b[c[(c[Da>>2]|0)+48>>2]&15](Da);q=(q+ +$b[c[(c[Da>>2]|0)+48>>2]&15](Da))*2.0;R=+g[b+112>>2]- +g[b+48>>2];S=+g[b+116>>2]- +g[b+52>>2];O=+g[b+120>>2]- +g[b+56>>2];k=+g[e+48>>2];j=+g[e+64>>2];h=+g[e+80>>2];I=+g[f>>2];J=+g[e+68>>2];H=+g[e+84>>2];G=+g[e+56>>2];F=+g[e+72>>2];z=+g[e+88>>2];g[e+548>>2]=(A+C)*2.0*.5;g[e+552>>2]=(B+D)*2.0*.5;g[e+556>>2]=E*.5;g[e+536>>2]=(w+v)*2.0*.5;g[e+540>>2]=(y+x)*2.0*.5;g[e+544>>2]=q*.5;p=+g[e>>2];u=+g[e+16>>2];r=+g[e+32>>2];o=+g[e+4>>2];t=+g[e+20>>2];s=+g[e+36>>2];n=+g[e+8>>2];m=+g[e+24>>2];l=+g[e+40>>2];X=+P(+(k*p+j*u+h*r));T=+P(+(k*o+j*t+h*s));K=+P(+(k*n+j*m+h*l));Z=+P(+(p*I+u*J+r*H));V=+P(+(o*I+t*J+s*H));N=+P(+(n*I+m*J+l*H));L=+P(+(p*G+u*F+r*z));M=+P(+(o*G+t*F+s*z));U=+P(+(n*G+m*F+l*z));$=+P(+(R*k+S*j+O*h))-(q*.5*K+((A+C)*2.0*.5+X*(w+v)*2.0*.5+T*(y+x)*2.0*.5));if($>0.0){i=e;return}if($>-3.4028234663852886e+38){ga=1;W=R*k+S*j+O*h<0.0&1;a=e+48|0}else{ga=0;W=0;a=0;$=-3.4028234663852886e+38}_=+P(+(R*I+S*J+O*H))-((B+D)*2.0*.5+Z*(w+v)*2.0*.5+V*(y+x)*2.0*.5+N*q*.5);if(_>0.0){i=e;return}if(_>$){ga=2;W=R*I+S*J+O*H<0.0&1;a=f}else _=$;$=+P(+(R*G+S*F+O*z))-(E*.5+L*(w+v)*2.0*.5+M*(y+x)*2.0*.5+U*q*.5);if($>0.0){i=e;return}if($>_){ga=3;W=R*G+S*F+O*z<0.0&1;a=e+56|0;_=$}$=+P(+(R*p+S*u+O*r))-((w+v)*2.0*.5+(X*(A+C)*2.0*.5+Z*(B+D)*2.0*.5+L*E*.5));if($>0.0){i=e;return}if($>_){ga=4;W=R*p+S*u+O*r<0.0&1;a=e;_=$}$=+P(+(R*o+S*t+O*s))-((y+x)*2.0*.5+(T*(A+C)*2.0*.5+V*(B+D)*2.0*.5+M*E*.5));if($>0.0){i=e;return}if($>_){ga=5;W=R*o+S*t+O*s<0.0&1;a=e+4|0;_=$}qa=+P(+(R*n+S*m+O*l))-(q*.5+(K*(A+C)*2.0*.5+N*(B+D)*2.0*.5+U*E*.5));if(qa>0.0){i=e;return}if(qa>_){ga=6;W=R*n+S*m+O*l<0.0&1;a=e+8|0}else qa=_;ba=(R*G+S*F+O*z)*(p*I+u*J+r*H)-(R*I+S*J+O*H)*(p*G+u*F+r*z);$=+P(+ba)-((L+9999999747378752.0e-21)*(B+D)*2.0*.5+(Z+9999999747378752.0e-21)*E*.5+(K+9999999747378752.0e-21)*(y+x)*2.0*.5+(T+9999999747378752.0e-21)*q*.5);if($>1.1920928955078125e-7){i=e;return}da=(p*G+u*F+r*z)*(p*G+u*F+r*z)+0.0;aa=(p*I+u*J+r*H)*(p*I+u*J+r*H);_=+Q(+(aa+da));if(_>1.1920928955078125e-7?$/_*1.0499999523162842>qa:0){oa=(p*I+u*J+r*H)/_;na=-(p*G+u*F+r*z)/_;ma=0.0/_;ga=7;W=ba<0.0&1;a=0;qa=$/_}else{oa=0.0;na=0.0;ma=0.0}ca=(R*G+S*F+O*z)*(o*I+t*J+s*H)-(R*I+S*J+O*H)*(o*G+t*F+s*z);$=+P(+ca)-((M+9999999747378752.0e-21)*(B+D)*2.0*.5+(V+9999999747378752.0e-21)*E*.5+(K+9999999747378752.0e-21)*(w+v)*2.0*.5+(X+9999999747378752.0e-21)*q*.5);if($>1.1920928955078125e-7){i=e;return}ea=(o*G+t*F+s*z)*(o*G+t*F+s*z)+0.0;_=(o*I+t*J+s*H)*(o*I+t*J+s*H);ba=+Q(+(_+ea));if(ba>1.1920928955078125e-7?$/ba*1.0499999523162842>qa:0){oa=(o*I+t*J+s*H)/ba;na=-(o*G+t*F+s*z)/ba;ma=0.0/ba;ga=8;W=ca<0.0&1;a=0;qa=$/ba}va=(R*G+S*F+O*z)*(n*I+m*J+l*H)-(R*I+S*J+O*H)*(n*G+m*F+l*z);ba=+P(+va)-((U+9999999747378752.0e-21)*(B+D)*2.0*.5+(N+9999999747378752.0e-21)*E*.5+(T+9999999747378752.0e-21)*(w+v)*2.0*.5+(X+9999999747378752.0e-21)*(y+x)*2.0*.5);if(ba>1.1920928955078125e-7){i=e;return}ca=(n*G+m*F+l*z)*(n*G+m*F+l*z)+0.0;$=(n*I+m*J+l*H)*(n*I+m*J+l*H);ra=+Q(+($+ca));if(ra>1.1920928955078125e-7?ba/ra*1.0499999523162842>qa:0){oa=(n*I+m*J+l*H)/ra;na=-(n*G+m*F+l*z)/ra;ma=0.0/ra;ga=9;W=va<0.0&1;a=0;qa=ba/ra}va=(R*k+S*j+O*h)*(p*G+u*F+r*z)-(R*G+S*F+O*z)*(k*p+j*u+h*r);ra=+P(+va)-((L+9999999747378752.0e-21)*(A+C)*2.0*.5+(X+9999999747378752.0e-21)*E*.5+(N+9999999747378752.0e-21)*(y+x)*2.0*.5+(V+9999999747378752.0e-21)*q*.5);if(ra>1.1920928955078125e-7){i=e;return}ba=(k*p+j*u+h*r)*(k*p+j*u+h*r);da=+Q(+(ba+da));do if(da>1.1920928955078125e-7){if(!(ra/da*1.0499999523162842>qa))break;oa=-(k*p+j*u+h*r)/da;na=0.0/da;ma=(p*G+u*F+r*z)/da;ga=10;W=va<0.0&1;a=0;qa=ra/da}while(0);va=(R*k+S*j+O*h)*(o*G+t*F+s*z)-(R*G+S*F+O*z)*(k*o+j*t+h*s);ra=+P(+va)-((M+9999999747378752.0e-21)*(A+C)*2.0*.5+(T+9999999747378752.0e-21)*E*.5+(N+9999999747378752.0e-21)*(w+v)*2.0*.5+(Z+9999999747378752.0e-21)*q*.5);if(ra>1.1920928955078125e-7){i=e;return}da=(k*o+j*t+h*s)*(k*o+j*t+h*s);ea=+Q(+(da+ea));do if(ea>1.1920928955078125e-7){if(!(ra/ea*1.0499999523162842>qa))break;oa=-(k*o+j*t+h*s)/ea;na=0.0/ea;ma=(o*G+t*F+s*z)/ea;ga=11;W=va<0.0&1;a=0;qa=ra/ea}while(0);va=(R*k+S*j+O*h)*(n*G+m*F+l*z)-(R*G+S*F+O*z)*(k*n+j*m+h*l);ra=+P(+va)-((U+9999999747378752.0e-21)*(A+C)*2.0*.5+(K+9999999747378752.0e-21)*E*.5+(V+9999999747378752.0e-21)*(w+v)*2.0*.5+(Z+9999999747378752.0e-21)*(y+x)*2.0*.5);if(ra>1.1920928955078125e-7){i=e;return}ea=(k*n+j*m+h*l)*(k*n+j*m+h*l);ca=+Q(+(ea+ca));do if(ca>1.1920928955078125e-7){if(!(ra/ca*1.0499999523162842>qa))break;oa=-(k*n+j*m+h*l)/ca;na=0.0/ca;ma=(n*G+m*F+l*z)/ca;ga=12;W=va<0.0&1;a=0;qa=ra/ca}while(0);ca=(R*I+S*J+O*H)*(k*p+j*u+h*r)-(R*k+S*j+O*h)*(p*I+u*J+r*H);X=+P(+ca)-((Z+9999999747378752.0e-21)*(A+C)*2.0*.5+(X+9999999747378752.0e-21)*(B+D)*2.0*.5+(U+9999999747378752.0e-21)*(y+x)*2.0*.5+(M+9999999747378752.0e-21)*q*.5);if(X>1.1920928955078125e-7){i=e;return}Z=+Q(+(ba+aa+0.0));do if(Z>1.1920928955078125e-7){if(!(X/Z*1.0499999523162842>qa))break;oa=0.0/Z;na=(k*p+j*u+h*r)/Z;ma=-(p*I+u*J+r*H)/Z;ga=13;W=ca<0.0&1;a=0;qa=X/Z}while(0);X=(R*I+S*J+O*H)*(k*o+j*t+h*s)-(R*k+S*j+O*h)*(o*I+t*J+s*H);T=+P(+X)-((V+9999999747378752.0e-21)*(A+C)*2.0*.5+(T+9999999747378752.0e-21)*(B+D)*2.0*.5+(U+9999999747378752.0e-21)*(w+v)*2.0*.5+(L+9999999747378752.0e-21)*q*.5);if(T>1.1920928955078125e-7){i=e;return}U=+Q(+(da+_+0.0));do if(U>1.1920928955078125e-7){if(!(T/U*1.0499999523162842>qa)){fa=a;break}oa=0.0/U;na=(k*o+j*t+h*s)/U;ma=-(o*I+t*J+s*H)/U;ga=14;W=X<0.0&1;fa=0;qa=T/U}else fa=a;while(0);O=(R*I+S*J+O*H)*(k*n+j*m+h*l)-(R*k+S*j+O*h)*(n*I+m*J+l*H);K=+P(+O)-((N+9999999747378752.0e-21)*(A+C)*2.0*.5+(K+9999999747378752.0e-21)*(B+D)*2.0*.5+(M+9999999747378752.0e-21)*(w+v)*2.0*.5+(L+9999999747378752.0e-21)*(y+x)*2.0*.5);if(K>1.1920928955078125e-7){i=e;return}L=+Q(+(ea+$+0.0));do if(L>1.1920928955078125e-7){if(!(K/L*1.0499999523162842>qa)){a=55;break}ma=-(n*I+m*J+l*H)/L;na=(k*n+j*m+h*l)/L;oa=0.0/L;ga=15;W=O<0.0&1;qa=K/L;a=58}else a=55;while(0);do if((a|0)==55){if((ga|0)==0){i=e;return}if((fa|0)==0){a=58;break}h=+g[fa>>2];j=+g[fa+16>>2];k=+g[fa+32>>2]}while(0);if((a|0)==58){h=ma*+g[e+48>>2]+na*+g[f>>2]+oa*G;j=ma*+g[e+64>>2]+na*+g[e+68>>2]+oa*F;k=ma*+g[e+80>>2]+na*+g[e+84>>2]+oa*z}if((W|0)!=0){h=-h;j=-j;k=-k}if((ga|0)>6){ca=+g[e+48>>2];da=+g[e+64>>2];na=+g[e+80>>2];ma=(h*ca+j*da+k*na>0.0?1.0:-1.0)*(A+C)*2.0*.5;A=+g[f>>2];ea=+g[e+68>>2];ra=+g[e+84>>2];oa=(h*A+j*ea+k*ra>0.0?1.0:-1.0)*(B+D)*2.0*.5;va=(h*G+j*F+k*z>0.0?1.0:-1.0)*E*.5;A=+g[b+48>>2]+ma*ca+oa*A+va*G;B=+g[b+52>>2]+ma*da+oa*ea+va*F;z=+g[b+56>>2]+ma*na+oa*ra+va*z;c[e+520>>2]=c[b+112>>2];c[e+524>>2]=c[b+116>>2];c[e+528>>2]=c[b+120>>2];w=(h*p+j*u+k*r>0.0?-1.0:1.0)*(w+v)*2.0*.5;x=(h*o+j*t+k*s>0.0?-1.0:1.0)*(y+x)*2.0*.5;t=+g[e+524>>2]+w*u+x*t;r=+g[e+528>>2]+w*r+x*s;q=(h*n+j*m+k*l>0.0?-1.0:1.0)*q*.5;n=+g[e+520>>2]+w*p+x*o+q*n;g[e+520>>2]=n;g[e+524>>2]=t+q*m;g[e+528>>2]=r+q*l;Da=ga+ -7|0;u=+g[e+48+(((Da|0)/3|0)<<2)>>2];x=+g[e+48+(((Da|0)/3|0)+4<<2)>>2];w=+g[e+48+(((Da|0)/3|0)+8<<2)>>2];s=+g[e+(((Da|0)%3|0)<<2)>>2];p=+g[e+(((Da|0)%3|0)+4<<2)>>2];o=+g[e+(((Da|0)%3|0)+8<<2)>>2];v=1.0-(u*s+x*p+w*o)*(u*s+x*p+w*o);if(!(v<=9999999747378752.0e-20))u=(((n-A)*u+(t+q*m-B)*x+(r+q*l-z)*w)*(u*s+x*p+w*o)-((n-A)*s+(t+q*m-B)*p+(r+q*l-z)*o))*(1.0/v);else u=0.0;g[e+520>>2]=n+u*s;g[e+524>>2]=t+q*m+u*p;g[e+528>>2]=r+q*l+u*o;Da=c[(c[d>>2]|0)+16>>2]|0;g[e+504>>2]=-h;g[e+508>>2]=-j;g[e+512>>2]=-k;g[e+516>>2]=0.0;qc[Da&15](d,e+504|0,e+520|0,qa);i=e;return}W=(ga|0)<4;if(W){l=h;m=j;n=k;ha=e+48|0;ta=e;fa=e+548|0;pa=e+536|0;f=b+48|0;b=b+112|0}else{l=-h;m=-j;n=-k;ha=e;ta=e+48|0;fa=e+536|0;pa=e+548|0;f=b+112|0;b=b+48|0}o=l*+g[ta>>2]+m*+g[ta+16>>2]+n*+g[ta+32>>2];g[e+488>>2]=o;q=l*+g[ta+4>>2]+m*+g[ta+20>>2]+n*+g[ta+36>>2];g[e+492>>2]=q;p=l*+g[ta+8>>2]+m*+g[ta+24>>2]+n*+g[ta+40>>2];g[e+496>>2]=p;o=+P(+o);q=+P(+q);p=+P(+p);if(q>o){ja=q>p;sa=0;ia=q>p?1:2}else{ja=o>p;sa=o>p&1;ia=o>p?0:2}ua=ja?2:1;q=+g[pa+(ia<<2)>>2];p=+g[b>>2]- +g[f>>2];o=q*+g[ta+(ia<<2)>>2];if(+g[e+488+(ia<<2)>>2]<0.0){o=p+o;p=+g[b+4>>2]- +g[f+4>>2]+q*+g[ta+((ia|4)<<2)>>2];q=+g[b+8>>2]- +g[f+8>>2]+q*+g[ta+((ia|8)<<2)>>2]}else{o=p-o;p=+g[b+4>>2]- +g[f+4>>2]-q*+g[ta+((ia|4)<<2)>>2];q=+g[b+8>>2]- +g[f+8>>2]-q*+g[ta+((ia|8)<<2)>>2]}la=(W?-1:-4)+ga|0;if((la|0)==0){wa=1;xa=2}else if((la|0)==1){wa=0;xa=2}else{wa=0;xa=1}t=+g[ha+(wa<<2)>>2];u=+g[ha+((wa|4)<<2)>>2];v=+g[ha+((wa|8)<<2)>>2];r=o*t+p*u+q*v;w=+g[ha+(xa<<2)>>2];s=+g[ha+((xa|4)<<2)>>2];y=+g[ha+((xa|8)<<2)>>2];A=o*w+p*s+q*y;ka=ta+(sa<<2)|0;x=+g[ka>>2];ia=ta+((sa|4)<<2)|0;C=+g[ia>>2];b=ta+((sa|8)<<2)|0;D=+g[b>>2];ja=ta+(ua<<2)|0;z=+g[ja>>2];ha=ta+((ua|4)<<2)|0;B=+g[ha>>2];ga=ta+((ua|8)<<2)|0;E=+g[ga>>2];ra=+g[pa+(sa<<2)>>2];va=+g[pa+(ua<<2)>>2];qa=(t*z+u*B+v*E)*va;va=(w*z+s*B+y*E)*va;g[e+456>>2]=r-(t*x+u*C+v*D)*ra-qa;g[e+460>>2]=A-(w*x+s*C+y*D)*ra-va;g[e+464>>2]=r-(t*x+u*C+v*D)*ra+qa;g[e+468>>2]=A-(w*x+s*C+y*D)*ra+va;g[e+472>>2]=r+(t*x+u*C+v*D)*ra+qa;g[e+476>>2]=A+(w*x+s*C+y*D)*ra+va;g[e+480>>2]=r+(t*x+u*C+v*D)*ra-qa;g[e+484>>2]=A+(w*x+s*C+y*D)*ra-va;g[e+448>>2]=+g[fa+(wa<<2)>>2];g[e+452>>2]=+g[fa+(xa<<2)>>2];ua=0;za=4;xa=e+456|0;ta=e+384|0;a:while(1){sa=e+448+(ua<<2)|0;pa=1-ua|0;wa=-1;while(1){if((za|0)>0){F=+(wa|0);Ba=0;ya=xa;Aa=ta;while(1){Ca=ya+(ua<<2)|0;G=+g[Ca>>2];H=+g[sa>>2];if(F*G<H){g[Aa>>2]=+g[ya>>2];g[Aa+4>>2]=+g[ya+4>>2];Ba=Ba+1|0;if((Ba&8|0)!=0){za=Ba;break a}G=+g[Ca>>2];H=+g[sa>>2];Aa=Aa+8|0}Ca=ya;ya=ya+8|0;Da=(za|0)>1?ya:xa;I=+g[Da+(ua<<2)>>2];if(F*G<H^F*I<H){va=+g[Ca+(pa<<2)>>2];g[Aa+(pa<<2)>>2]=va+(F*H-G)*((+g[Da+(pa<<2)>>2]-va)/(I-G));g[Aa+(ua<<2)>>2]=F*+g[sa>>2];Ba=Ba+1|0;if((Ba&8|0)==0)Aa=Aa+8|0;else{za=Ba;break a}}za=za+ -1|0;if((za|0)<=0){za=Ba;break}}}else za=0;ya=(ta|0)==(e+384|0)?e+592|0:e+384|0;if((wa|0)<0){xa=ta;ta=ya;wa=wa+2|0}else break}ua=ua+1|0;if((ua|0)<2){xa=ta;ta=ya}else break}if((ta|0)!=(e+384|0))cF(e+384|0,ta|0,za<<3|0)|0;if((za|0)<1){i=e;return}F=1.0/((t*x+u*C+v*D)*(w*z+s*B+y*E)-(w*x+s*C+y*D)*(t*z+u*B+v*E));G=+g[fa+(la<<2)>>2];H=+g[ka>>2];I=+g[ja>>2];J=+g[ia>>2];K=+g[ha>>2];L=+g[b>>2];M=+g[ga>>2];b=0;fa=0;do{Da=fa<<1;O=+g[e+384+(Da<<2)>>2];N=+g[e+384+((Da|1)<<2)>>2];oa=(w*z+s*B+y*E)*F*(O-r)-(t*z+u*B+v*E)*F*(N-A);va=(t*x+u*C+v*D)*F*(N-A)-(w*x+s*C+y*D)*F*(O-r);Da=b*3|0;qa=o+oa*H+va*I;g[e+288+(Da<<2)>>2]=qa;ra=p+oa*J+va*K;g[e+288+(Da+1<<2)>>2]=ra;va=q+oa*L+va*M;g[e+288+(Da+2<<2)>>2]=va;va=G-(l*qa+m*ra+n*va);g[e+256+(b<<2)>>2]=va;if(va>=0.0){Da=b<<1;g[e+384+(Da<<2)>>2]=O;g[e+384+((Da|1)<<2)>>2]=N;b=b+1|0}fa=fa+1|0}while((fa|0)!=(za|0));if((b|0)<1){i=e;return}fa=(b|0)<4?b:4;fa=(fa|0)<1?1:fa;if((b|0)<=(fa|0)){a=(b|0)>0;if(W){if(!a){i=e;return}a=f+4|0;W=f+8|0;h=-h;j=-j;k=-k;fa=0;do{Da=fa*3|0;g[e+240>>2]=+g[e+288+(Da<<2)>>2]+ +g[f>>2];g[e+244>>2]=+g[e+288+(Da+1<<2)>>2]+ +g[a>>2];g[e+248>>2]=+g[e+288+(Da+2<<2)>>2]+ +g[W>>2];Da=c[(c[d>>2]|0)+16>>2]|0;g[e+224>>2]=h;g[e+228>>2]=j;g[e+232>>2]=k;g[e+236>>2]=0.0;qc[Da&15](d,e+224|0,e+240|0,-+g[e+256+(fa<<2)>>2]);fa=fa+1|0}while((fa|0)!=(b|0));i=e;return}else{if(!a){i=e;return}W=f+4|0;fa=f+8|0;l=-h;n=-j;m=-k;a=0;do{Da=a*3|0;va=+g[e+256+(a<<2)>>2];g[e+208>>2]=+g[e+288+(Da<<2)>>2]+ +g[f>>2]-h*va;g[e+212>>2]=+g[e+288+(Da+1<<2)>>2]+ +g[W>>2]-j*va;g[e+216>>2]=+g[e+288+(Da+2<<2)>>2]+ +g[fa>>2]-k*va;Da=c[(c[d>>2]|0)+16>>2]|0;g[e+192>>2]=l;g[e+196>>2]=n;g[e+200>>2]=m;g[e+204>>2]=0.0;qc[Da&15](d,e+192|0,e+208|0,-va);a=a+1|0}while((a|0)!=(b|0));i=e;return}}if((b|0)>1){ha=1;ga=0;l=+g[e+256>>2];while(1){m=+g[e+256+(ha<<2)>>2];ia=m>l;ga=ia?ha:ga;ha=ha+1|0;if((ha|0)==(b|0))break;else l=ia?m:l}}else ga=0;if((b|0)==1){q=+g[e+384>>2];l=+g[e+388>>2];a=115}else if((b|0)!=2){ha=b+ -1|0;if((ha|0)>0){r=0.0;q=0.0;p=0.0;ia=0;do{Da=ia<<1;oa=+g[e+384+(Da<<2)>>2];qa=+g[e+384+(Da+3<<2)>>2];ra=+g[e+384+(Da+2<<2)>>2];va=+g[e+384+((Da|1)<<2)>>2];r=r+(oa*qa-ra*va);q=q+(oa+ra)*(oa*qa-ra*va);p=p+(qa+va)*(oa*qa-ra*va);ia=ia+1|0}while((ia|0)!=(ha|0))}else{r=0.0;q=0.0;p=0.0}Da=b<<1;o=+g[e+384+(Da+ -2<<2)>>2];n=+g[e+388>>2];m=+g[e+384>>2];l=+g[e+384+(Da+ -1<<2)>>2];r=r+(o*n-m*l);if(+P(+r)>1.1920928955078125e-7)r=1.0/(r*3.0);else r=999999984306749400.0;if((b|0)>0){q=r*(q+(o*n-m*l)*(o+m));l=r*(p+(o*n-m*l)*(l+n));a=115}else ha=0}else{q=(+g[e+384>>2]+ +g[e+392>>2])*.5;l=(+g[e+388>>2]+ +g[e+396>>2])*.5;a=115}if((a|0)==115){a=0;do{Da=a<<1;g[e+592+(a<<2)>>2]=+Y(+(+g[e+384+((Da|1)<<2)>>2]-l),+(+g[e+384+(Da<<2)>>2]-q));a=a+1|0}while((a|0)!=(b|0));a=0;do{c[e+560+(a<<2)>>2]=1;a=a+1|0}while((a|0)!=(b|0));ha=1}a=e+560+(ga<<2)|0;c[a>>2]=0;c[e+160>>2]=ga;b:do if((fa|0)>1){l=+g[e+592+(ga<<2)>>2];if(ha){ha=e+164|0;a=1}else{ha=e+164|0;b=1;while(1){c[ha>>2]=ga;c[a>>2]=0;b=b+1|0;if((b|0)==(fa|0))break b;else ha=ha+4|0}}while(1){m=+(a|0)*(6.2831854820251465/+(fa|0))+l;if(m>3.1415927410125732)m=m+-6.2831854820251465;c[ha>>2]=ga;ja=ga;ia=0;n=1.0e9;do{do if((c[e+560+(ia<<2)>>2]|0)!=0){o=+P(+(+g[e+592+(ia<<2)>>2]-m));if(o>3.1415927410125732)o=6.2831854820251465-o;if(!(o<n))break;c[ha>>2]=ia;ja=ia;n=o}while(0);ia=ia+1|0}while((ia|0)!=(b|0));c[e+560+(ja<<2)>>2]=0;a=a+1|0;if((a|0)==(fa|0))break;else ha=ha+4|0}}while(0);if((fa|0)<=0){i=e;return}a=f+4|0;b=f+8|0;m=-k;l=-j;n=-h;if(W){W=0;do{Da=c[e+160+(W<<2)>>2]|0;g[e+144>>2]=+g[e+288+(Da*3<<2)>>2]+ +g[f>>2];g[e+148>>2]=+g[e+288+((Da*3|0)+1<<2)>>2]+ +g[a>>2];g[e+152>>2]=+g[e+288+((Da*3|0)+2<<2)>>2]+ +g[b>>2];Ca=c[(c[d>>2]|0)+16>>2]|0;g[e+128>>2]=n;g[e+132>>2]=l;g[e+136>>2]=m;g[e+140>>2]=0.0;qc[Ca&15](d,e+128|0,e+144|0,-+g[e+256+(Da<<2)>>2]);W=W+1|0}while((W|0)<(fa|0));i=e;return}else{W=0;do{Ca=c[e+160+(W<<2)>>2]|0;oa=+g[e+288+(Ca*3<<2)>>2]+ +g[f>>2];g[e+144>>2]=oa;qa=+g[e+288+((Ca*3|0)+1<<2)>>2]+ +g[a>>2];g[e+148>>2]=qa;ra=+g[e+288+((Ca*3|0)+2<<2)>>2]+ +g[b>>2];g[e+152>>2]=ra;Da=c[(c[d>>2]|0)+16>>2]|0;g[e+112>>2]=n;g[e+116>>2]=l;g[e+120>>2]=m;g[e+124>>2]=0.0;va=+g[e+256+(Ca<<2)>>2];g[e+96>>2]=oa-h*va;g[e+100>>2]=qa-va*j;g[e+104>>2]=ra-va*k;g[e+108>>2]=0.0;qc[Da&15](d,e+112|0,e+96|0,-va);W=W+1|0}while((W|0)<(fa|0));i=e;return}}function wC(a){a=a|0;return}function xC(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function yC(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0;g=i;i=i+32|0;h=(a[b+28>>0]|0)!=0;f=h?e:d;e=h?d:e;d=c[f+4>>2]|0;h=c[d+16>>2]|0;j=c[b+12>>2]|0;if((j|0)<(h|0)){if((c[b+16>>2]|0)<(h|0)){if((h|0)==0){k=0;m=j}else{c[5004]=(c[5004]|0)+1;k=XE((h<<2|3)+16|0)|0;if((k|0)==0)k=0;else{c[(k+19&-16)+ -4>>2]=k;k=k+19&-16}m=c[b+12>>2]|0}if((m|0)>0){l=0;do{n=k+(l<<2)|0;if((n|0)!=0)c[n>>2]=c[(c[b+20>>2]|0)+(l<<2)>>2];l=l+1|0}while((l|0)!=(m|0))}l=c[b+20>>2]|0;if((l|0)!=0){if((a[b+24>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[l+ -4>>2]|0)}c[b+20>>2]=0}a[b+24>>0]=1;c[b+20>>2]=k;c[b+16>>2]=h;k=b+20|0}else k=b+20|0;do{l=(c[k>>2]|0)+(j<<2)|0;if((l|0)!=0)c[l>>2]=0;j=j+1|0}while((j|0)!=(h|0))}c[b+12>>2]=h;if((h|0)<=0){i=g;return}j=0;do{if((c[d+64>>2]|0)==0){l=c[(c[d+24>>2]|0)+(j*80|0)+64>>2]|0;m=c[f+8>>2]|0;n=c[f+12>>2]|0;c[g>>2]=f;c[g+4>>2]=l;c[g+8>>2]=m;c[g+12>>2]=n;c[g+16>>2]=-1;c[g+20>>2]=j;n=c[b+4>>2]|0;n=Tb[c[(c[n>>2]|0)+8>>2]&31](n,g,e,c[b+32>>2]|0)|0;c[(c[b+20>>2]|0)+(j<<2)>>2]=n}else c[(c[b+20>>2]|0)+(j<<2)>>2]=0;j=j+1|0}while((j|0)!=(h|0));i=g;return}function zC(a){a=a|0;var b=0;b=i;AC(a);YE(a);i=b;return}function AC(b){b=b|0;var d=0,e=0,f=0,g=0;d=i;c[b>>2]=18040;e=c[b+12>>2]|0;if((e|0)>0){f=0;do{g=c[(c[b+20>>2]|0)+(f<<2)>>2]|0;if((g|0)!=0){Lb[c[c[g>>2]>>2]&511](g);g=c[b+4>>2]|0;Nb[c[(c[g>>2]|0)+60>>2]&127](g,c[(c[b+20>>2]|0)+(f<<2)>>2]|0)}f=f+1|0}while((f|0)!=(e|0))}e=c[b+20>>2]|0;if((e|0)==0){a[b+24>>0]=1;c[b+20>>2]=0;c[b+12>>2]=0;g=b+16|0;c[g>>2]=0;i=d;return}if((a[b+24>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+20>>2]=0;a[b+24>>0]=1;c[b+20>>2]=0;c[b+12>>2]=0;g=b+16|0;c[g>>2]=0;i=d;return}function BC(b,d,e,f,h){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0,Q=0.0;j=i;i=i+320|0;k=(a[b+28>>0]|0)!=0;m=k?e:d;k=k?d:e;l=c[m+4>>2]|0;if((c[l+68>>2]|0)!=(c[b+40>>2]|0)){p=c[b+12>>2]|0;if((p|0)>0){o=0;do{n=c[(c[b+20>>2]|0)+(o<<2)>>2]|0;if((n|0)!=0){Lb[c[c[n>>2]>>2]&511](n);s=c[b+4>>2]|0;Nb[c[(c[s>>2]|0)+60>>2]&127](s,c[(c[b+20>>2]|0)+(o<<2)>>2]|0)}o=o+1|0}while((o|0)!=(p|0))}yC(b,d,e)}d=c[l+64>>2]|0;n=c[b+4>>2]|0;q=c[b+20>>2]|0;o=c[b+32>>2]|0;c[j+280>>2]=18120;c[j+284>>2]=m;c[j+288>>2]=k;c[j+292>>2]=n;c[j+296>>2]=f;c[j+300>>2]=h;c[j+304>>2]=q;c[j+308>>2]=o;f=j+272|0;a[f>>0]=1;o=j+268|0;c[o>>2]=0;n=j+260|0;c[n>>2]=0;c[j+264>>2]=0;e=c[b+12>>2]|0;if((e|0)>0){p=0;while(1){q=c[q+(p<<2)>>2]|0;if((q|0)!=0){Nb[c[(c[q>>2]|0)+16>>2]&127](q,j+256|0);e=c[n>>2]|0;if((e|0)>0){r=e;e=0;do{q=c[(c[o>>2]|0)+(e<<2)>>2]|0;if((c[q+748>>2]|0)!=0){c[h+4>>2]=q;s=c[q+740>>2]|0;r=c[(c[h+8>>2]|0)+8>>2]|0;if((s|0)==(r|0))nA(q,s+4|0,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0);else nA(q,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0,r+4|0);c[h+4>>2]=0;r=c[n>>2]|0}e=e+1|0}while((e|0)<(r|0));e=r}if((e|0)<0){if((c[j+264>>2]|0)<0){r=c[o>>2]|0;if((e|0)>0){q=0;do{if((q|0)!=0)c[0+(q<<2)>>2]=c[r+(q<<2)>>2];q=q+1|0}while((q|0)!=(e|0))}if((r|0)!=0){if((a[f>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[r+ -4>>2]|0)}c[o>>2]=0}a[f>>0]=1;c[o>>2]=0;c[j+264>>2]=0}do{q=(c[o>>2]|0)+(e<<2)|0;if((q|0)!=0)c[q>>2]=0;e=e+1|0}while((e|0)!=0)}c[n>>2]=0;e=c[b+12>>2]|0}p=p+1|0;if((p|0)>=(e|0))break;q=c[b+20>>2]|0}h=c[o>>2]|0;if((h|0)!=0){if((a[f>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[o>>2]=0}}a[f>>0]=1;c[o>>2]=0;c[n>>2]=0;c[j+264>>2]=0;if((d|0)==0){h=c[b+12>>2]|0;if((h|0)>0){d=0;do{CC(j+280|0,c[(c[l+24>>2]|0)+(d*80|0)+64>>2]|0,d);d=d+1|0}while((d|0)<(h|0))}else{i=j;return}}else{s=c[m+12>>2]|0;H=+g[s>>2];G=+g[s+16>>2];F=+g[s+32>>2];E=+g[s+4>>2];D=+g[s+20>>2];C=+g[s+36>>2];y=+g[s+8>>2];w=+g[s+24>>2];u=+g[s+40>>2];B=-+g[s+48>>2];A=-+g[s+52>>2];z=-+g[s+56>>2];s=c[k+12>>2]|0;Q=+g[s>>2];P=+g[s+16>>2];O=+g[s+32>>2];N=+g[s+4>>2];M=+g[s+20>>2];L=+g[s+36>>2];K=+g[s+8>>2];J=+g[s+24>>2];I=+g[s+40>>2];x=+g[s+48>>2];v=+g[s+52>>2];t=+g[s+56>>2];g[j+160>>2]=H*Q+G*P+F*O;g[j+164>>2]=H*N+G*M+F*L;g[j+168>>2]=H*K+G*J+F*I;g[j+172>>2]=0.0;g[j+176>>2]=E*Q+D*P+C*O;g[j+180>>2]=E*N+D*M+C*L;g[j+184>>2]=E*K+D*J+C*I;g[j+188>>2]=0.0;g[j+192>>2]=y*Q+w*P+u*O;g[j+196>>2]=y*N+w*M+u*L;g[j+200>>2]=y*K+w*J+u*I;g[j+204>>2]=0.0;g[j+208>>2]=H*B+G*A+F*z+(H*x+G*v+F*t);g[j+212>>2]=E*B+D*A+C*z+(E*x+D*v+C*t);g[j+216>>2]=y*B+w*A+u*z+(y*x+w*v+u*t);g[j+220>>2]=0.0;s=c[k+4>>2]|0;vc[c[(c[s>>2]|0)+8>>2]&127](s,j+160|0,j+240|0,j+224|0);c[j+128>>2]=c[j+240>>2];c[j+132>>2]=c[j+244>>2];c[j+136>>2]=c[j+248>>2];c[j+140>>2]=c[j+252>>2];c[j+144>>2]=c[j+224>>2];c[j+148>>2]=c[j+228>>2];c[j+152>>2]=c[j+232>>2];c[j+156>>2]=c[j+236>>2];Tx(c[d>>2]|0,j+128|0,j+280|0)}h=c[b+12>>2]|0;if((h|0)<=0){i=j;return}d=0;do{do if((c[(c[b+20>>2]|0)+(d<<2)>>2]|0)!=0){q=c[l+24>>2]|0;s=c[q+(d*80|0)+64>>2]|0;r=c[m+12>>2]|0;w=+g[r>>2];x=+g[r+4>>2];y=+g[r+8>>2];z=+g[r+16>>2];A=+g[r+20>>2];B=+g[r+24>>2];I=+g[r+32>>2];K=+g[r+36>>2];M=+g[r+40>>2];C=+g[q+(d*80|0)>>2];D=+g[q+(d*80|0)+16>>2];E=+g[q+(d*80|0)+32>>2];F=+g[q+(d*80|0)+4>>2];G=+g[q+(d*80|0)+20>>2];H=+g[q+(d*80|0)+36>>2];J=+g[q+(d*80|0)+8>>2];L=+g[q+(d*80|0)+24>>2];N=+g[q+(d*80|0)+40>>2];u=+g[q+(d*80|0)+48>>2];v=+g[q+(d*80|0)+52>>2];Q=+g[q+(d*80|0)+56>>2];O=+g[r+48>>2]+(w*u+x*v+y*Q);P=+g[r+52>>2]+(z*u+A*v+B*Q);Q=+g[r+56>>2]+(I*u+K*v+M*Q);g[j+64>>2]=w*C+x*D+y*E;g[j+68>>2]=w*F+x*G+y*H;g[j+72>>2]=w*J+x*L+y*N;g[j+76>>2]=0.0;g[j+80>>2]=z*C+A*D+B*E;g[j+84>>2]=z*F+A*G+B*H;g[j+88>>2]=z*J+A*L+B*N;g[j+92>>2]=0.0;g[j+96>>2]=I*C+K*D+M*E;g[j+100>>2]=I*F+K*G+M*H;g[j+104>>2]=I*J+K*L+M*N;g[j+108>>2]=0.0;g[j+112>>2]=O;g[j+116>>2]=P;g[j+120>>2]=Q;g[j+124>>2]=0.0;vc[c[(c[s>>2]|0)+8>>2]&127](s,j+64|0,j+48|0,j+32|0);s=c[k+4>>2]|0;vc[c[(c[s>>2]|0)+8>>2]&127](s,c[k+12>>2]|0,j+16|0,j);if(!(+g[j+48>>2]>+g[j>>2])?!(+g[j+32>>2]<+g[j+16>>2]):0)f=1;else f=0;if(!(!(+g[j+56>>2]>+g[j+8>>2])?!(+g[j+40>>2]<+g[j+24>>2]):0))f=0;if(!(+g[j+52>>2]>+g[j+4>>2])?!(+g[j+36>>2]<+g[j+20>>2]|f^1):0)break;s=c[(c[b+20>>2]|0)+(d<<2)>>2]|0;Lb[c[c[s>>2]>>2]&511](s);s=c[b+4>>2]|0;Nb[c[(c[s>>2]|0)+60>>2]&127](s,c[(c[b+20>>2]|0)+(d<<2)>>2]|0);c[(c[b+20>>2]|0)+(d<<2)>>2]=0}while(0);d=d+1|0}while((d|0)<(h|0));i=j;return}function CC(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,h=0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0;e=i;i=i+160|0;f=c[a+4>>2]|0;h=c[f+12>>2]|0;D=+g[h>>2];C=+g[h+4>>2];B=+g[h+8>>2];A=+g[h+16>>2];z=+g[h+20>>2];y=+g[h+24>>2];r=+g[h+32>>2];p=+g[h+36>>2];n=+g[h+40>>2];f=c[(c[f+4>>2]|0)+24>>2]|0;x=+g[f+(d*80|0)>>2];w=+g[f+(d*80|0)+16>>2];v=+g[f+(d*80|0)+32>>2];u=+g[f+(d*80|0)+4>>2];t=+g[f+(d*80|0)+20>>2];s=+g[f+(d*80|0)+36>>2];q=+g[f+(d*80|0)+8>>2];o=+g[f+(d*80|0)+24>>2];m=+g[f+(d*80|0)+40>>2];F=+g[f+(d*80|0)+48>>2];E=+g[f+(d*80|0)+52>>2];j=+g[f+(d*80|0)+56>>2];l=+g[h+48>>2]+(D*F+C*E+B*j);k=+g[h+52>>2]+(A*F+z*E+y*j);j=+g[h+56>>2]+(r*F+p*E+n*j);g[e+88>>2]=D*x+C*w+B*v;g[e+92>>2]=D*u+C*t+B*s;g[e+96>>2]=D*q+C*o+B*m;g[e+100>>2]=0.0;g[e+104>>2]=A*x+z*w+y*v;g[e+108>>2]=A*u+z*t+y*s;g[e+112>>2]=A*q+z*o+y*m;g[e+116>>2]=0.0;g[e+120>>2]=r*x+p*w+n*v;g[e+124>>2]=r*u+p*t+n*s;g[e+128>>2]=r*q+p*o+n*m;g[e+132>>2]=0.0;g[e+136>>2]=l;g[e+140>>2]=k;g[e+144>>2]=j;g[e+148>>2]=0.0;vc[c[(c[b>>2]|0)+8>>2]&127](b,e+88|0,e+72|0,e+56|0);h=c[a+8>>2]|0;f=c[h+4>>2]|0;vc[c[(c[f>>2]|0)+8>>2]&127](f,c[h+12>>2]|0,e+40|0,e+24|0);if(!(+g[e+72>>2]>+g[e+24>>2])?!(+g[e+56>>2]<+g[e+40>>2]):0)f=1;else f=0;if(!(!(+g[e+80>>2]>+g[e+32>>2])?!(+g[e+64>>2]<+g[e+48>>2]):0))f=0;if(+g[e+76>>2]>+g[e+28>>2]){i=e;return}if(+g[e+60>>2]<+g[e+44>>2]|f^1){i=e;return}f=c[a+4>>2]|0;h=c[f+8>>2]|0;c[e>>2]=f;c[e+4>>2]=b;c[e+8>>2]=h;c[e+12>>2]=e+88;c[e+16>>2]=-1;c[e+20>>2]=d;if((c[(c[a+24>>2]|0)+(d<<2)>>2]|0)==0){b=c[a+12>>2]|0;b=Tb[c[(c[b>>2]|0)+8>>2]&31](b,e,c[a+8>>2]|0,c[a+28>>2]|0)|0;c[(c[a+24>>2]|0)+(d<<2)>>2]=b;b=c[a+4>>2]|0}else b=f;h=c[a+20>>2]|0;f=c[h+8>>2]|0;if((c[f+8>>2]|0)==(c[b+8>>2]|0)){c[h+8>>2]=e;h=c[a+20>>2]|0;rc[c[(c[h>>2]|0)+8>>2]&127](h,-1,d)}else{f=c[h+12>>2]|0;c[h+12>>2]=e;h=c[a+20>>2]|0;rc[c[(c[h>>2]|0)+12>>2]&127](h,-1,d)}d=c[(c[a+24>>2]|0)+(d<<2)>>2]|0;Jb[c[(c[d>>2]|0)+8>>2]&31](d,e,c[a+8>>2]|0,c[a+16>>2]|0,c[a+20>>2]|0);d=c[a+20>>2]|0;if((c[(c[d+8>>2]|0)+8>>2]|0)==(c[(c[a+4>>2]|0)+8>>2]|0)){c[d+8>>2]=f;i=e;return}else{c[d+12>>2]=f;i=e;return}}function DC(a){a=a|0;return}function EC(b,d,e,f,h){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0,k=0,l=0.0,m=0,n=0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0,Q=0.0,R=0.0;j=i;t=(a[b+28>>0]|0)!=0;k=t?e:d;d=t?d:e;t=c[b+12>>2]|0;if((t|0)<=0){E=1.0;i=j;return+E}n=(c[k+192>>2]|0)+24|0;o=+g[k+4>>2];p=+g[k+8>>2];q=+g[k+12>>2];A=+g[k+16>>2];r=+g[k+20>>2];s=+g[k+24>>2];l=+g[k+28>>2];B=+g[k+32>>2];u=+g[k+36>>2];v=+g[k+40>>2];w=+g[k+44>>2];C=+g[k+48>>2];x=+g[k+52>>2];y=+g[k+56>>2];z=+g[k+60>>2];D=+g[k+64>>2];e=c[k+260>>2]|0;E=1.0;m=0;do{G=c[n>>2]|0;R=+g[G+(m*80|0)>>2];Q=+g[G+(m*80|0)+16>>2];P=+g[G+(m*80|0)+32>>2];O=+g[G+(m*80|0)+4>>2];N=+g[G+(m*80|0)+20>>2];M=+g[G+(m*80|0)+36>>2];L=+g[G+(m*80|0)+8>>2];K=+g[G+(m*80|0)+24>>2];J=+g[G+(m*80|0)+40>>2];I=+g[G+(m*80|0)+48>>2];H=+g[G+(m*80|0)+52>>2];F=+g[G+(m*80|0)+56>>2];c[k+260>>2]=e+1;g[k+4>>2]=o*R+p*Q+q*P;g[k+8>>2]=o*O+p*N+q*M;g[k+12>>2]=o*L+p*K+q*J;g[k+16>>2]=0.0;g[k+20>>2]=r*R+s*Q+l*P;g[k+24>>2]=r*O+s*N+l*M;g[k+28>>2]=r*L+s*K+l*J;g[k+32>>2]=0.0;g[k+36>>2]=u*R+v*Q+w*P;g[k+40>>2]=u*O+v*N+w*M;g[k+44>>2]=u*L+v*K+w*J;g[k+48>>2]=0.0;g[k+52>>2]=x+(o*I+p*H+q*F);g[k+56>>2]=y+(r*I+s*H+l*F);g[k+60>>2]=z+(u*I+v*H+w*F);g[k+64>>2]=0.0;G=c[(c[b+20>>2]|0)+(m<<2)>>2]|0;F=+Xb[c[(c[G>>2]|0)+12>>2]&15](G,k,d,f,h);E=F<E?F:E;e=(c[k+260>>2]|0)+1|0;c[k+260>>2]=e;g[k+4>>2]=o;g[k+8>>2]=p;g[k+12>>2]=q;g[k+16>>2]=A;g[k+20>>2]=r;g[k+24>>2]=s;g[k+28>>2]=l;g[k+32>>2]=B;g[k+36>>2]=u;g[k+40>>2]=v;g[k+44>>2]=w;g[k+48>>2]=C;g[k+52>>2]=x;g[k+56>>2]=y;g[k+60>>2]=z;g[k+64>>2]=D;m=m+1|0}while((m|0)!=(t|0));i=j;return+E}function FC(a,b){a=a|0;b=b|0;var d=0,e=0,f=0,g=0;d=i;f=c[a+12>>2]|0;if((f|0)<=0){i=d;return}e=0;do{g=c[(c[a+20>>2]|0)+(e<<2)>>2]|0;if((g|0)!=0){Nb[c[(c[g>>2]|0)+16>>2]&127](g,b);f=c[a+12>>2]|0}e=e+1|0}while((e|0)<(f|0));i=d;return}function GC(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function HC(a,b){a=a|0;b=b|0;var d=0;d=i;b=c[b+36>>2]|0;CC(a,c[(c[(c[(c[a+4>>2]|0)+4>>2]|0)+24>>2]|0)+(b*80|0)+64>>2]|0,b);i=d;return}function IC(a){a=a|0;var b=0;b=i;JC(a);YE(a);i=b;return}function JC(b){b=b|0;var d=0,e=0,f=0,g=0,h=0,j=0;d=i;c[b>>2]=18208;f=c[b+8>>2]|0;e=c[f+8>>2]|0;if((e|0)>0){g=0;do{h=c[(c[f+16>>2]|0)+(g*12|0)+8>>2]|0;if((h|0)!=0){Lb[c[c[h>>2]>>2]&511](h);j=c[b+4>>2]|0;Nb[c[(c[j>>2]|0)+60>>2]&127](j,h)}g=g+1|0}while((g|0)!=(e|0));f=c[b+8>>2]|0}PD(f);e=c[b+8>>2]|0;Lb[c[c[e>>2]>>2]&511](e);e=c[b+8>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+24>>2]|0;if((e|0)==0){a[b+28>>0]=1;c[b+24>>2]=0;c[b+16>>2]=0;j=b+20|0;c[j>>2]=0;i=d;return}if((a[b+28>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+24>>2]=0;a[b+28>>0]=1;c[b+24>>2]=0;c[b+16>>2]=0;j=b+20|0;c[j>>2]=0;i=d;return}function KC(a,b){a=a|0;b=b|0;var d=0,e=0,f=0,g=0;d=i;a=c[a+8>>2]|0;f=c[a+8>>2]|0;if((f|0)<=0){i=d;return}e=0;do{g=c[(c[a+16>>2]|0)+(e*12|0)+8>>2]|0;if((g|0)!=0){Nb[c[(c[g>>2]|0)+16>>2]&127](g,b);f=c[a+8>>2]|0}e=e+1|0}while((e|0)<(f|0));i=d;return}



function LC(b,d,e,f,h){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0,k=0,l=0,m=0,n=0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,Q=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0,X=0,Y=0,Z=0,_=0,$=0,aa=0,ba=0,ca=0,da=0.0,ea=0.0,fa=0.0,ga=0.0,ha=0.0,ia=0.0,ja=0.0,ka=0.0,la=0.0,ma=0.0,na=0.0,oa=0;j=i;i=i+192|0;k=c[d+4>>2]|0;m=c[e+4>>2]|0;if((c[k+68>>2]|0)==(c[b+40>>2]|0)?(c[m+68>>2]|0)==(c[b+44>>2]|0):0)n=b+8|0;else{n=c[b+8>>2]|0;Y=c[n+8>>2]|0;if((Y|0)>0){X=0;do{W=c[(c[n+16>>2]|0)+(X*12|0)+8>>2]|0;if((W|0)!=0){Lb[c[c[W>>2]>>2]&511](W);ca=c[b+4>>2]|0;Nb[c[(c[ca>>2]|0)+60>>2]&127](ca,W)}X=X+1|0}while((X|0)!=(Y|0));n=c[b+8>>2]|0}PD(n);n=b+8|0}W=j+180|0;a[W>>0]=1;X=j+176|0;c[X>>2]=0;Y=j+168|0;c[Y>>2]=0;c[j+172>>2]=0;Z=c[n>>2]|0;$=c[Z+8>>2]|0;if(($|0)>0){_=0;do{aa=c[(c[Z+16>>2]|0)+(_*12|0)+8>>2]|0;if((aa|0)!=0){Nb[c[(c[aa>>2]|0)+16>>2]&127](aa,j+164|0);ba=c[Y>>2]|0;if((ba|0)>0){$=0;do{aa=c[(c[X>>2]|0)+($<<2)>>2]|0;if((c[aa+748>>2]|0)!=0){c[h+4>>2]=aa;ba=c[aa+740>>2]|0;ca=c[(c[h+8>>2]|0)+8>>2]|0;if((ba|0)==(ca|0))nA(aa,ba+4|0,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0);else nA(aa,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0,ca+4|0);c[h+4>>2]=0;ba=c[Y>>2]|0}$=$+1|0}while(($|0)<(ba|0))}if((ba|0)<0){if((c[j+172>>2]|0)<0){$=c[X>>2]|0;if((ba|0)>0){aa=0;do{if((aa|0)!=0)c[0+(aa<<2)>>2]=c[$+(aa<<2)>>2];aa=aa+1|0}while((aa|0)!=(ba|0))}if(($|0)!=0){if((a[W>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[$+ -4>>2]|0)}c[X>>2]=0}a[W>>0]=1;c[X>>2]=0;c[j+172>>2]=0}do{$=(c[X>>2]|0)+(ba<<2)|0;if(($|0)!=0)c[$>>2]=0;ba=ba+1|0}while((ba|0)!=0)}c[Y>>2]=0;$=c[Z+8>>2]|0}_=_+1|0}while((_|0)<($|0));Z=c[X>>2]|0;if((Z|0)!=0){if((a[W>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[Z+ -4>>2]|0)}c[X>>2]=0}}a[W>>0]=1;c[X>>2]=0;c[Y>>2]=0;c[j+172>>2]=0;ba=c[k+64>>2]|0;ca=c[m+64>>2]|0;_=c[b+4>>2]|0;$=c[n>>2]|0;aa=c[b+32>>2]|0;c[j+128>>2]=18296;c[j+132>>2]=0;c[j+136>>2]=d;c[j+140>>2]=e;c[j+144>>2]=_;c[j+148>>2]=f;c[j+152>>2]=h;c[j+156>>2]=$;c[j+160>>2]=aa;f=c[d+12>>2]|0;z=+g[f>>2];B=+g[f+16>>2];D=+g[f+32>>2];t=+g[f+4>>2];s=+g[f+20>>2];r=+g[f+36>>2];q=+g[f+8>>2];p=+g[f+24>>2];o=+g[f+40>>2];A=-+g[f+48>>2];C=-+g[f+52>>2];E=-+g[f+56>>2];f=c[e+12>>2]|0;I=+g[f>>2];J=+g[f+16>>2];K=+g[f+32>>2];L=+g[f+4>>2];y=+g[f+20>>2];x=+g[f+36>>2];w=+g[f+8>>2];v=+g[f+24>>2];u=+g[f+40>>2];F=+g[f+48>>2];G=+g[f+52>>2];H=+g[f+56>>2];f=c[ba>>2]|0;h=c[ca>>2]|0;if(!((f|0)==0|(h|0)==0)){c[5004]=(c[5004]|0)+1;_=XE(1043)|0;c[(_+19&-16)+ -4>>2]=_;c[(_+19&-16)>>2]=f;c[(_+19&-16)+4>>2]=h;V=+P(+(z*I+B*J+D*K));U=+P(+(z*L+B*y+D*x));T=+P(+(z*w+B*v+D*u));M=+P(+(t*I+s*J+r*K));S=+P(+(t*L+s*y+r*x));R=+P(+(t*w+s*v+r*u));Q=+P(+(q*I+p*J+o*K));O=+P(+(q*L+p*y+o*x));N=+P(+(q*w+p*v+o*u));_=_+19&-16;Y=128;$=128;f=1;Z=124;do{h=f+ -1|0;X=c[_+(h<<3)>>2]|0;W=c[_+(h<<3)+4>>2]|0;na=+g[W+16>>2];ma=+g[W>>2];la=+g[W+20>>2];ka=+g[W+4>>2];ja=+g[W+24>>2];da=+g[W+8>>2];ia=z*A+B*C+D*E+(z*F+B*G+D*H)+((z*I+B*J+D*K)*(na+ma)*.5+(z*L+B*y+D*x)*(la+ka)*.5+(z*w+B*v+D*u)*(ja+da)*.5);ga=t*A+s*C+r*E+(t*F+s*G+r*H)+((t*I+s*J+r*K)*(na+ma)*.5+(t*L+s*y+r*x)*(la+ka)*.5+(t*w+s*v+r*u)*(ja+da)*.5);ea=q*A+p*C+o*E+(q*F+p*G+o*H)+((q*I+p*J+o*K)*(na+ma)*.5+(q*L+p*y+o*x)*(la+ka)*.5+(q*w+p*v+o*u)*(ja+da)*.5);ha=((na-ma)*.5+0.0)*V+((la-ka)*.5+0.0)*U+((ja-da)*.5+0.0)*T;fa=((na-ma)*.5+0.0)*M+((la-ka)*.5+0.0)*S+((ja-da)*.5+0.0)*R;da=((na-ma)*.5+0.0)*Q+((la-ka)*.5+0.0)*O+((ja-da)*.5+0.0)*N;do if(((((+g[X>>2]<=ha+ia?+g[X+16>>2]>=ia-ha:0)?+g[X+4>>2]<=ga+fa:0)?+g[X+20>>2]>=ga-fa:0)?+g[X+8>>2]<=ea+da:0)?+g[X+24>>2]>=ea-da:0){if((h|0)>(Z|0)){Z=Y<<1;if((Y|0)<(Z|0)&($|0)<(Z|0)){if((Y|0)!=0){c[5004]=(c[5004]|0)+1;$=XE((Y<<4|3)+16|0)|0;if(($|0)==0)$=0;else{c[($+19&-16)+ -4>>2]=$;$=$+19&-16}if((Y|0)>0){aa=0;do{ba=$+(aa<<3)|0;if((ba|0)!=0){oa=_+(aa<<3)|0;ca=c[oa+4>>2]|0;c[ba>>2]=c[oa>>2];c[ba+4>>2]=ca}aa=aa+1|0}while((aa|0)!=(Y|0))}}else $=0;if((_|0)==0){_=$;$=Z}else{c[5006]=(c[5006]|0)+1;YE(c[_+ -4>>2]|0);_=$;$=Z}}Y=Z;Z=Z+ -4|0}aa=(c[W+40>>2]|0)!=0;if((c[X+40>>2]|0)==0)if(aa){oa=c[W+36>>2]|0;ca=_+(h<<3)|0;c[ca>>2]=X;c[ca+4>>2]=oa;ca=c[W+40>>2]|0;oa=_+(f<<3)|0;c[oa>>2]=X;c[oa+4>>2]=ca;f=f+1|0;break}else{rc[c[(c[j+128>>2]|0)+8>>2]&127](j+128|0,X,W);f=h;break}else{h=_+(h<<3)|0;ba=c[X+36>>2]|0;if(aa){ca=c[W+36>>2]|0;c[h>>2]=ba;c[h+4>>2]=ca;ca=c[W+36>>2]|0;oa=_+(f<<3)|0;c[oa>>2]=c[X+40>>2];c[oa+4>>2]=ca;oa=c[W+40>>2]|0;ca=_+(f+1<<3)|0;c[ca>>2]=c[X+36>>2];c[ca+4>>2]=oa;ca=c[W+40>>2]|0;oa=_+(f+2<<3)|0;c[oa>>2]=c[X+40>>2];c[oa+4>>2]=ca;f=f+3|0;break}else{c[h>>2]=ba;c[h+4>>2]=W;oa=_+(f<<3)|0;c[oa>>2]=c[X+40>>2];c[oa+4>>2]=W;f=f+1|0;break}}}else f=h;while(0)}while((f|0)!=0);if((_|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[_+ -4>>2]|0)}}f=c[n>>2]|0;if((c[f+8>>2]|0)>0){h=0;do{X=c[f+16>>2]|0;W=c[X+(h*12|0)+8>>2]|0;do if((W|0)!=0){oa=c[X+(h*12|0)>>2]|0;ca=c[k+24>>2]|0;ba=c[ca+(oa*80|0)+64>>2]|0;aa=c[d+12>>2]|0;na=+g[aa>>2];K=+g[aa+4>>2];J=+g[aa+8>>2];ka=+g[aa+16>>2];ia=+g[aa+20>>2];ga=+g[aa+24>>2];ja=+g[aa+32>>2];fa=+g[aa+36>>2];Q=+g[aa+40>>2];ea=+g[ca+(oa*80|0)>>2];da=+g[ca+(oa*80|0)+16>>2];V=+g[ca+(oa*80|0)+32>>2];U=+g[ca+(oa*80|0)+4>>2];T=+g[ca+(oa*80|0)+20>>2];S=+g[ca+(oa*80|0)+36>>2];ha=+g[ca+(oa*80|0)+8>>2];R=+g[ca+(oa*80|0)+24>>2];O=+g[ca+(oa*80|0)+40>>2];ma=+g[ca+(oa*80|0)+48>>2];la=+g[ca+(oa*80|0)+52>>2];L=+g[ca+(oa*80|0)+56>>2];N=+g[aa+48>>2]+(na*ma+K*la+J*L);M=+g[aa+52>>2]+(ka*ma+ia*la+ga*L);L=+g[aa+56>>2]+(ja*ma+fa*la+Q*L);g[j>>2]=na*ea+K*da+J*V;g[j+4>>2]=na*U+K*T+J*S;g[j+8>>2]=na*ha+K*R+J*O;g[j+12>>2]=0.0;g[j+16>>2]=ka*ea+ia*da+ga*V;g[j+20>>2]=ka*U+ia*T+ga*S;g[j+24>>2]=ka*ha+ia*R+ga*O;g[j+28>>2]=0.0;g[j+32>>2]=ja*ea+fa*da+Q*V;g[j+36>>2]=ja*U+fa*T+Q*S;g[j+40>>2]=ja*ha+fa*R+Q*O;g[j+44>>2]=0.0;g[j+48>>2]=N;g[j+52>>2]=M;g[j+56>>2]=L;g[j+60>>2]=0.0;vc[c[(c[ba>>2]|0)+8>>2]&127](ba,j,j+112|0,j+96|0);ba=c[(c[f+16>>2]|0)+(h*12|0)+4>>2]|0;aa=c[m+24>>2]|0;oa=c[aa+(ba*80|0)+64>>2]|0;ca=c[e+12>>2]|0;L=+g[ca>>2];M=+g[ca+4>>2];N=+g[ca+8>>2];O=+g[ca+16>>2];Q=+g[ca+20>>2];R=+g[ca+24>>2];fa=+g[ca+32>>2];ha=+g[ca+36>>2];ja=+g[ca+40>>2];S=+g[aa+(ba*80|0)>>2];T=+g[aa+(ba*80|0)+16>>2];U=+g[aa+(ba*80|0)+32>>2];V=+g[aa+(ba*80|0)+4>>2];da=+g[aa+(ba*80|0)+20>>2];ea=+g[aa+(ba*80|0)+36>>2];ga=+g[aa+(ba*80|0)+8>>2];ia=+g[aa+(ba*80|0)+24>>2];ka=+g[aa+(ba*80|0)+40>>2];J=+g[aa+(ba*80|0)+48>>2];K=+g[aa+(ba*80|0)+52>>2];na=+g[aa+(ba*80|0)+56>>2];la=+g[ca+48>>2]+(L*J+M*K+N*na);ma=+g[ca+52>>2]+(O*J+Q*K+R*na);na=+g[ca+56>>2]+(fa*J+ha*K+ja*na);g[j>>2]=L*S+M*T+N*U;g[j+4>>2]=L*V+M*da+N*ea;g[j+8>>2]=L*ga+M*ia+N*ka;g[j+12>>2]=0.0;g[j+16>>2]=O*S+Q*T+R*U;g[j+20>>2]=O*V+Q*da+R*ea;g[j+24>>2]=O*ga+Q*ia+R*ka;g[j+28>>2]=0.0;g[j+32>>2]=fa*S+ha*T+ja*U;g[j+36>>2]=fa*V+ha*da+ja*ea;g[j+40>>2]=fa*ga+ha*ia+ja*ka;g[j+44>>2]=0.0;g[j+48>>2]=la;g[j+52>>2]=ma;g[j+56>>2]=na;g[j+60>>2]=0.0;vc[c[(c[oa>>2]|0)+8>>2]&127](oa,j,j+80|0,j+64|0);if(!(+g[j+112>>2]>+g[j+64>>2])?!(+g[j+96>>2]<+g[j+80>>2]):0)X=1;else X=0;if(!(!(+g[j+120>>2]>+g[j+72>>2])?!(+g[j+104>>2]<+g[j+88>>2]):0))X=0;if(!(+g[j+116>>2]>+g[j+68>>2])?!(+g[j+100>>2]<+g[j+84>>2]|X^1):0)break;Lb[c[c[W>>2]>>2]&511](W);X=c[b+4>>2]|0;Nb[c[(c[X>>2]|0)+60>>2]&127](X,W);X=c[f+16>>2]|0;W=c[X+(h*12|0)>>2]|0;X=c[X+(h*12|0)+4>>2]|0;$=c[b+16>>2]|0;if(($|0)==(c[b+20>>2]|0)?(l=($|0)==0?1:$<<1,($|0)<(l|0)):0){if((l|0)==0)Y=0;else{c[5004]=(c[5004]|0)+1;Y=XE((l*12|3)+16|0)|0;if((Y|0)==0)Y=0;else{c[(Y+19&-16)+ -4>>2]=Y;Y=Y+19&-16}$=c[b+16>>2]|0}if(($|0)>0){_=0;do{Z=Y+(_*12|0)|0;if((Z|0)!=0){oa=(c[b+24>>2]|0)+(_*12|0)|0;c[Z+0>>2]=c[oa+0>>2];c[Z+4>>2]=c[oa+4>>2];c[Z+8>>2]=c[oa+8>>2]}_=_+1|0}while((_|0)!=($|0))}Z=c[b+24>>2]|0;if((Z|0)!=0){if((a[b+28>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[Z+ -4>>2]|0)}c[b+24>>2]=0}a[b+28>>0]=1;c[b+24>>2]=Y;c[b+20>>2]=l;$=c[b+16>>2]|0}Z=c[b+24>>2]|0;Y=Z+($*12|0)|0;if((Y|0)!=0){c[Y>>2]=W;c[Z+($*12|0)+4>>2]=X;c[Z+($*12|0)+8>>2]=0;$=c[b+16>>2]|0}c[b+16>>2]=$+1}while(0);h=h+1|0}while((h|0)<(c[f+8>>2]|0));d=b+24|0;e=b+16|0}else{d=b+24|0;e=b+16|0}if((c[e>>2]|0)>0){k=0;do{ca=c[n>>2]|0;oa=c[d>>2]|0;Yb[c[(c[ca>>2]|0)+8>>2]&31](ca,c[oa+(k*12|0)>>2]|0,c[oa+(k*12|0)+4>>2]|0)|0;k=k+1|0}while((k|0)<(c[e>>2]|0))}k=c[d>>2]|0;if((k|0)==0){a[b+28>>0]=1;c[d>>2]=0;c[e>>2]=0;oa=b+20|0;c[oa>>2]=0;i=j;return}if((a[b+28>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[k+ -4>>2]|0)}c[d>>2]=0;a[b+28>>0]=1;c[d>>2]=0;c[e>>2]=0;oa=b+20|0;c[oa>>2]=0;i=j;return}function MC(a){a=a|0;return}function NC(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;return 0.0}function OC(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function PC(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,h=0,j=0,k=0,l=0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0,K=0;f=i;i=i+240|0;c[a+4>>2]=(c[a+4>>2]|0)+1;b=c[b+36>>2]|0;d=c[d+36>>2]|0;l=c[a+8>>2]|0;K=c[(c[l+4>>2]|0)+24>>2]|0;j=c[K+(b*80|0)+64>>2]|0;J=(c[(c[a+12>>2]|0)+4>>2]|0)+24|0;k=c[(c[J>>2]|0)+(d*80|0)+64>>2]|0;l=c[l+12>>2]|0;m=+g[l>>2];H=+g[l+4>>2];I=+g[l+8>>2];p=+g[l+16>>2];r=+g[l+20>>2];t=+g[l+24>>2];q=+g[l+32>>2];u=+g[l+36>>2];C=+g[l+40>>2];v=+g[K+(b*80|0)>>2];w=+g[K+(b*80|0)+16>>2];x=+g[K+(b*80|0)+32>>2];y=+g[K+(b*80|0)+4>>2];z=+g[K+(b*80|0)+20>>2];A=+g[K+(b*80|0)+36>>2];s=+g[K+(b*80|0)+8>>2];B=+g[K+(b*80|0)+24>>2];D=+g[K+(b*80|0)+40>>2];n=+g[K+(b*80|0)+48>>2];o=+g[K+(b*80|0)+52>>2];G=+g[K+(b*80|0)+56>>2];E=+g[l+48>>2]+(m*n+H*o+I*G);F=+g[l+52>>2]+(p*n+r*o+t*G);G=+g[l+56>>2]+(q*n+u*o+C*G);g[f+176>>2]=m*v+H*w+I*x;g[f+180>>2]=m*y+H*z+I*A;g[f+184>>2]=m*s+H*B+I*D;g[f+188>>2]=0.0;g[f+192>>2]=p*v+r*w+t*x;g[f+196>>2]=p*y+r*z+t*A;g[f+200>>2]=p*s+r*B+t*D;g[f+204>>2]=0.0;g[f+208>>2]=q*v+u*w+C*x;g[f+212>>2]=q*y+u*z+C*A;g[f+216>>2]=q*s+u*B+C*D;g[f+220>>2]=0.0;g[f+224>>2]=E;g[f+228>>2]=F;g[f+232>>2]=G;g[f+236>>2]=0.0;l=c[(c[a+12>>2]|0)+12>>2]|0;G=+g[l>>2];F=+g[l+4>>2];E=+g[l+8>>2];D=+g[l+16>>2];C=+g[l+20>>2];B=+g[l+24>>2];u=+g[l+32>>2];s=+g[l+36>>2];q=+g[l+40>>2];J=c[J>>2]|0;A=+g[J+(d*80|0)>>2];z=+g[J+(d*80|0)+16>>2];y=+g[J+(d*80|0)+32>>2];x=+g[J+(d*80|0)+4>>2];w=+g[J+(d*80|0)+20>>2];v=+g[J+(d*80|0)+36>>2];t=+g[J+(d*80|0)+8>>2];r=+g[J+(d*80|0)+24>>2];p=+g[J+(d*80|0)+40>>2];I=+g[J+(d*80|0)+48>>2];H=+g[J+(d*80|0)+52>>2];m=+g[J+(d*80|0)+56>>2];o=+g[l+48>>2]+(G*I+F*H+E*m);n=+g[l+52>>2]+(D*I+C*H+B*m);m=+g[l+56>>2]+(u*I+s*H+q*m);g[f+112>>2]=G*A+F*z+E*y;g[f+116>>2]=G*x+F*w+E*v;g[f+120>>2]=G*t+F*r+E*p;g[f+124>>2]=0.0;g[f+128>>2]=D*A+C*z+B*y;g[f+132>>2]=D*x+C*w+B*v;g[f+136>>2]=D*t+C*r+B*p;g[f+140>>2]=0.0;g[f+144>>2]=u*A+s*z+q*y;g[f+148>>2]=u*x+s*w+q*v;g[f+152>>2]=u*t+s*r+q*p;g[f+156>>2]=0.0;g[f+160>>2]=o;g[f+164>>2]=n;g[f+168>>2]=m;g[f+172>>2]=0.0;vc[c[(c[j>>2]|0)+8>>2]&127](j,f+176|0,f+96|0,f+80|0);vc[c[(c[k>>2]|0)+8>>2]&127](k,f+112|0,f+64|0,f+48|0);if(!(+g[f+96>>2]>+g[f+48>>2])?!(+g[f+80>>2]<+g[f+64>>2]):0)l=1;else l=0;if(!(!(+g[f+104>>2]>+g[f+56>>2])?!(+g[f+88>>2]<+g[f+72>>2]):0))l=0;if(+g[f+100>>2]>+g[f+52>>2]){i=f;return}if(+g[f+84>>2]<+g[f+68>>2]|l^1){i=f;return}J=c[a+8>>2]|0;K=c[J+8>>2]|0;c[f+24>>2]=J;c[f+28>>2]=j;c[f+32>>2]=K;c[f+36>>2]=f+176;c[f+40>>2]=-1;c[f+44>>2]=b;K=c[a+12>>2]|0;j=c[K+8>>2]|0;c[f>>2]=K;c[f+4>>2]=k;c[f+8>>2]=j;c[f+12>>2]=f+112;c[f+16>>2]=-1;c[f+20>>2]=d;j=c[a+28>>2]|0;c[4896]=(c[4896]|0)+1;k=((d<<16|b)+~((d<<16|b)<<15)>>10^(d<<16|b)+~((d<<16|b)<<15))*9|0;k=(c[j+12>>2]|0)+ -1&((k>>6^k)+~((k>>6^k)<<11)>>16^(k>>6^k)+~((k>>6^k)<<11));a:do if((k|0)<(c[j+32>>2]|0)?(h=c[(c[j+40>>2]|0)+(k<<2)>>2]|0,!((h|0)==-1)):0){k=c[j+16>>2]|0;while(1){if((c[k+(h*12|0)>>2]|0)==(b|0)?(c[k+(h*12|0)+4>>2]|0)==(d|0):0)break;h=c[(c[j+60>>2]|0)+(h<<2)>>2]|0;if((h|0)==-1){e=17;break a}}if((k+(h*12|0)|0)!=0)h=c[k+(h*12|0)+8>>2]|0;else e=17}else e=17;while(0);if((e|0)==17){h=c[a+16>>2]|0;h=Tb[c[(c[h>>2]|0)+8>>2]&31](h,f+24|0,f,c[a+32>>2]|0)|0;K=c[a+28>>2]|0;c[(Yb[c[(c[K>>2]|0)+12>>2]&31](K,b,d)|0)+8>>2]=h}l=c[a+24>>2]|0;J=c[l+8>>2]|0;K=c[l+12>>2]|0;c[l+8>>2]=f+24;c[(c[a+24>>2]|0)+12>>2]=f;l=c[a+24>>2]|0;rc[c[(c[l>>2]|0)+8>>2]&127](l,-1,b);l=c[a+24>>2]|0;rc[c[(c[l>>2]|0)+12>>2]&127](l,-1,d);Jb[c[(c[h>>2]|0)+8>>2]&31](h,f+24|0,f,c[a+20>>2]|0,c[a+24>>2]|0);c[(c[a+24>>2]|0)+8>>2]=J;c[(c[a+24>>2]|0)+12>>2]=K;i=f;return}function QC(a,b){a=a|0;b=b|0;return}function RC(a){a=a|0;var b=0,d=0;b=i;c[a>>2]=18432;c[a+12>>2]=18464;d=c[a+60>>2]|0;Nb[c[(c[d>>2]|0)+20>>2]&127](d,c[a+76>>2]|0);d=c[a+60>>2]|0;Nb[c[(c[d>>2]|0)+16>>2]&127](d,c[a+76>>2]|0);YE(a);i=b;return}function SC(a){a=a|0;var b=0,d=0;b=i;c[a>>2]=18432;c[a+12>>2]=18464;d=c[a+60>>2]|0;Nb[c[(c[d>>2]|0)+20>>2]&127](d,c[a+76>>2]|0);d=c[a+60>>2]|0;Nb[c[(c[d>>2]|0)+16>>2]&127](d,c[a+76>>2]|0);i=b;return}function TC(b,d){b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0;e=i;if((c[b+76>>2]|0)==0){i=e;return}h=c[d+4>>2]|0;if((h|0)==(c[d+8>>2]|0)?(f=(h|0)==0?1:h<<1,(h|0)<(f|0)):0){if((f|0)==0)g=0;else{c[5004]=(c[5004]|0)+1;g=XE((f<<2|3)+16|0)|0;if((g|0)==0)g=0;else{c[(g+19&-16)+ -4>>2]=g;g=g+19&-16}h=c[d+4>>2]|0}if((h|0)>0){j=0;do{k=g+(j<<2)|0;if((k|0)!=0)c[k>>2]=c[(c[d+12>>2]|0)+(j<<2)>>2];j=j+1|0}while((j|0)!=(h|0))}j=c[d+12>>2]|0;if((j|0)!=0){if((a[d+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0);h=c[d+4>>2]|0}c[d+12>>2]=0}a[d+16>>0]=1;c[d+12>>2]=g;c[d+8>>2]=f}f=(c[d+12>>2]|0)+(h<<2)|0;if((f|0)!=0)c[f>>2]=c[b+76>>2];c[d+4>>2]=h+1;i=e;return}function UC(a){a=a|0;var b=0,d=0;b=i;c[a>>2]=18464;d=c[a+48>>2]|0;Nb[c[(c[d>>2]|0)+20>>2]&127](d,c[a+64>>2]|0);d=c[a+48>>2]|0;Nb[c[(c[d>>2]|0)+16>>2]&127](d,c[a+64>>2]|0);YE(a);i=b;return}function VC(a){a=a|0;var b=0,d=0;b=i;c[a>>2]=18464;d=c[a+48>>2]|0;Nb[c[(c[d>>2]|0)+20>>2]&127](d,c[a+64>>2]|0);d=c[a+48>>2]|0;Nb[c[(c[d>>2]|0)+16>>2]&127](d,c[a+64>>2]|0);i=b;return}function WC(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0,j=0.0,k=0.0,l=0.0,m=0,n=0,o=0.0,p=0;f=i;i=i+128|0;l=+g[b>>2];j=+g[b+16>>2];o=l<j?l:j;k=+g[b+32>>2];if((o<k?o:k)>+g[a+28>>2]){i=f;return}n=l>j?b:b+16|0;if(+g[(+g[n>>2]>k?n:b+32|0)>>2]<+g[a+12>>2]){i=f;return}j=+g[b+8>>2];k=+g[b+24>>2];o=j<k?j:k;l=+g[b+40>>2];if((o<l?o:l)>+g[a+36>>2]){i=f;return}n=j>k?b+8|0:b+24|0;if(+g[(+g[n>>2]>l?n:b+40|0)>>2]<+g[a+20>>2]){i=f;return}l=+g[b+4>>2];j=+g[b+20>>2];o=l<j?l:j;k=+g[b+36>>2];if((o<k?o:k)>+g[a+32>>2]){i=f;return}n=l>j?b+4|0:b+20|0;if(+g[(+g[n>>2]>k?n:b+36|0)>>2]<+g[a+16>>2]){i=f;return}h=c[a+48>>2]|0;m=c[a+4>>2]|0;if((c[(c[m+4>>2]|0)+4>>2]|0)>=20){i=f;return}c[f+32>>2]=0;g[f+36>>2]=1.0;g[f+40>>2]=1.0;g[f+44>>2]=1.0;g[f+48>>2]=0.0;c[f+76>>2]=0;c[f+24>>2]=16376;c[f+28>>2]=1;c[f+80>>2]=c[b+0>>2];c[f+84>>2]=c[b+4>>2];c[f+88>>2]=c[b+8>>2];c[f+92>>2]=c[b+12>>2];c[f+96>>2]=c[b+16>>2];c[f+100>>2]=c[b+20>>2];c[f+104>>2]=c[b+24>>2];c[f+108>>2]=c[b+28>>2];c[f+112>>2]=c[b+32>>2];c[f+116>>2]=c[b+36>>2];c[f+120>>2]=c[b+40>>2];c[f+124>>2]=c[b+44>>2];g[f+68>>2]=+g[a+56>>2];p=c[a+8>>2]|0;n=c[p+8>>2]|0;b=c[p+12>>2]|0;c[f>>2]=p;c[f+4>>2]=f+24;c[f+8>>2]=n;c[f+12>>2]=b;c[f+16>>2]=d;c[f+20>>2]=e;b=Tb[c[(c[h>>2]|0)+8>>2]&31](h,m,f,c[a+64>>2]|0)|0;m=c[a+44>>2]|0;n=c[m+8>>2]|0;if((c[n+8>>2]|0)==(c[(c[a+8>>2]|0)+8>>2]|0)){c[m+8>>2]=f;p=c[a+44>>2]|0;rc[c[(c[p>>2]|0)+8>>2]&127](p,d,e)}else{n=c[m+12>>2]|0;c[m+12>>2]=f;p=c[a+44>>2]|0;rc[c[(c[p>>2]|0)+12>>2]&127](p,d,e)}Jb[c[(c[b>>2]|0)+8>>2]&31](b,c[a+4>>2]|0,f,c[a+52>>2]|0,c[a+44>>2]|0);d=c[a+44>>2]|0;if((c[(c[d+8>>2]|0)+8>>2]|0)==(c[(c[a+8>>2]|0)+8>>2]|0))c[d+8>>2]=n;else c[d+12>>2]=n;Lb[c[c[b>>2]>>2]&511](b);Nb[c[(c[h>>2]|0)+60>>2]&127](h,b);c[f+24>>2]=15736;a=c[f+76>>2]|0;if((a|0)==0){i=f;return}Lb[c[c[a>>2]>>2]&511](a);a=c[f+76>>2]|0;if((a|0)==0){i=f;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=f;return}function XC(b,d,e,f,h){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0,k=0,l=0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0;j=i;i=i+64|0;l=(a[b+8>>0]|0)!=0;k=l?e:d;e=l?d:e;d=c[e+4>>2]|0;if(!(((c[d+4>>2]|0)+ -21|0)>>>0<9)){i=j;return}if((c[(c[k+4>>2]|0)+4>>2]|0)>=20){i=j;return}m=+$b[c[(c[d>>2]|0)+48>>2]&15](d);c[h+4>>2]=c[b+76>>2];c[b+16>>2]=k;c[b+20>>2]=e;c[b+64>>2]=f;g[b+68>>2]=m;c[b+56>>2]=h;l=c[e+12>>2]|0;B=+g[l>>2];A=+g[l+16>>2];z=+g[l+32>>2];y=+g[l+4>>2];x=+g[l+20>>2];w=+g[l+36>>2];s=+g[l+8>>2];q=+g[l+24>>2];o=+g[l+40>>2];v=-+g[l+48>>2];u=-+g[l+52>>2];t=-+g[l+56>>2];l=c[k+12>>2]|0;K=+g[l>>2];J=+g[l+16>>2];I=+g[l+32>>2];H=+g[l+4>>2];G=+g[l+20>>2];F=+g[l+36>>2];E=+g[l+8>>2];D=+g[l+24>>2];C=+g[l+40>>2];r=+g[l+48>>2];p=+g[l+52>>2];n=+g[l+56>>2];g[j>>2]=B*K+A*J+z*I;g[j+4>>2]=B*H+A*G+z*F;g[j+8>>2]=B*E+A*D+z*C;g[j+12>>2]=0.0;g[j+16>>2]=y*K+x*J+w*I;g[j+20>>2]=y*H+x*G+w*F;g[j+24>>2]=y*E+x*D+w*C;g[j+28>>2]=0.0;g[j+32>>2]=s*K+q*J+o*I;g[j+36>>2]=s*H+q*G+o*F;g[j+40>>2]=s*E+q*D+o*C;g[j+44>>2]=0.0;g[j+48>>2]=B*v+A*u+z*t+(B*r+A*p+z*n);g[j+52>>2]=y*v+x*u+w*t+(y*r+x*p+w*n);g[j+56>>2]=s*v+q*u+o*t+(s*r+q*p+o*n);g[j+60>>2]=0.0;l=c[(c[b+16>>2]|0)+4>>2]|0;vc[c[(c[l>>2]|0)+8>>2]&127](l,j,b+24|0,b+40|0);g[b+40>>2]=+g[b+40>>2]+m;g[b+44>>2]=+g[b+44>>2]+m;g[b+48>>2]=+g[b+48>>2]+m;g[b+24>>2]=+g[b+24>>2]-m;g[b+28>>2]=+g[b+28>>2]-m;g[b+32>>2]=+g[b+32>>2]-m;l=c[b+76>>2]|0;e=c[e+8>>2]|0;c[l+740>>2]=c[k+8>>2];c[l+744>>2]=e;vc[c[(c[d>>2]|0)+64>>2]&127](d,b+12|0,b+24|0,b+40|0);k=c[h+4>>2]|0;do if((c[k+748>>2]|0)!=0){f=c[k+740>>2]|0;e=c[(c[h+8>>2]|0)+8>>2]|0;if((f|0)==(e|0)){nA(k,f+4|0,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0);break}else{nA(k,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0,e+4|0);break}}while(0);c[b+16>>2]=0;c[b+20>>2]=0;i=j;return}function YC(b,d,e,f,h){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0,Q=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0.0;h=i;i=i+240|0;f=(a[b+8>>0]|0)!=0;b=f?e:d;d=f?d:e;S=+g[b+116>>2]- +g[b+52>>2];T=+g[b+120>>2]- +g[b+56>>2];U=+g[b+124>>2]- +g[b+60>>2];V=+g[b+252>>2];if(S*S+T*T+U*U<V*V){V=1.0;i=h;return+V}n=+g[d+4>>2];p=+g[d+20>>2];r=+g[d+36>>2];z=+g[d+8>>2];A=+g[d+24>>2];B=+g[d+40>>2];j=+g[d+12>>2];C=+g[d+28>>2];E=+g[d+44>>2];R=-+g[d+52>>2];S=-+g[d+56>>2];T=-+g[d+60>>2];o=+g[b+4>>2];q=+g[b+20>>2];s=+g[b+36>>2];t=+g[b+8>>2];u=+g[b+24>>2];v=+g[b+40>>2];w=+g[b+12>>2];x=+g[b+28>>2];y=+g[b+44>>2];J=+g[b+52>>2];I=+g[b+56>>2];H=+g[b+60>>2];F=n*R+p*S+r*T+(n*J+p*I+r*H);G=z*R+A*S+B*T+(z*J+A*I+B*H);H=j*R+C*S+E*T+(j*J+C*I+E*H);I=+g[b+68>>2];J=+g[b+84>>2];K=+g[b+100>>2];L=+g[b+72>>2];M=+g[b+88>>2];N=+g[b+104>>2];O=+g[b+76>>2];P=+g[b+92>>2];m=+g[b+108>>2];U=+g[b+116>>2];V=+g[b+120>>2];D=+g[b+124>>2];l=n*R+p*S+r*T+(n*U+p*V+r*D);k=z*R+A*S+B*T+(z*U+A*V+B*D);D=j*R+C*S+E*T+(j*U+C*V+E*D);d=c[d+192>>2]|0;if(!(((c[d+4>>2]|0)+ -21|0)>>>0<9)){V=1.0;i=h;return+V}g[h+224>>2]=F;g[h+228>>2]=G;g[h+232>>2]=H;g[h+236>>2]=0.0;if(l<F){g[h+224>>2]=l;T=l}else T=F;if(k<G){g[h+228>>2]=k;U=k}else U=G;if(D<H){g[h+232>>2]=D;V=D}else V=H;g[h+208>>2]=F;g[h+212>>2]=G;g[h+216>>2]=H;g[h+220>>2]=0.0;if(F<l){g[h+208>>2]=l;Q=l}else Q=F;if(G<k){g[h+212>>2]=k;R=k}else R=G;if(H<D){g[h+216>>2]=D;S=D}else S=H;W=+g[b+248>>2];g[h+224>>2]=T-W;g[h+228>>2]=U-W;g[h+232>>2]=V-W;g[h+208>>2]=W+Q;g[h+212>>2]=W+R;g[h+216>>2]=W+S;c[h>>2]=18592;g[h+4>>2]=n*o+p*q+r*s;g[h+8>>2]=n*t+p*u+r*v;g[h+12>>2]=n*w+p*x+r*y;g[h+16>>2]=0.0;g[h+20>>2]=z*o+A*q+B*s;g[h+24>>2]=z*t+A*u+B*v;g[h+28>>2]=z*w+A*x+B*y;g[h+32>>2]=0.0;g[h+36>>2]=j*o+C*q+E*s;g[h+40>>2]=j*t+C*u+E*v;g[h+44>>2]=j*w+C*x+E*y;g[h+48>>2]=0.0;g[h+52>>2]=F;g[h+56>>2]=G;g[h+60>>2]=H;g[h+64>>2]=0.0;g[h+68>>2]=n*I+p*J+r*K;g[h+72>>2]=n*L+p*M+r*N;g[h+76>>2]=n*O+p*P+r*m;g[h+80>>2]=0.0;g[h+84>>2]=z*I+A*J+B*K;g[h+88>>2]=z*L+A*M+B*N;g[h+92>>2]=z*O+A*P+B*m;g[h+96>>2]=0.0;g[h+100>>2]=j*I+C*J+E*K;g[h+104>>2]=j*L+C*M+E*N;g[h+108>>2]=j*O+C*P+E*m;g[h+112>>2]=0.0;g[h+116>>2]=l;g[h+120>>2]=k;g[h+124>>2]=D;g[h+128>>2]=0.0;g[h+196>>2]=W;g[h+200>>2]=+g[b+244>>2];if((d|0)==0){W=1.0;i=h;return+W}vc[c[(c[d>>2]|0)+64>>2]&127](d,h,h+224|0,h+208|0);j=+g[h+200>>2];if(!(j<+g[b+244>>2])){W=1.0;i=h;return+W}g[b+244>>2]=j;W=j;i=h;return+W}function ZC(a){a=a|0;return}function _C(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function $C(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var h=0.0,j=0.0;e=i;i=i+784|0;g[e+712>>2]=1.0;c[e+716>>2]=0;c[e+720>>2]=0;c[e+724>>2]=0;c[e+728>>2]=0;g[e+732>>2]=1.0;c[e+736>>2]=0;c[e+740>>2]=0;c[e+744>>2]=0;c[e+748>>2]=0;g[e+752>>2]=1.0;f=e+756|0;c[f+0>>2]=0;c[f+4>>2]=0;c[f+8>>2]=0;c[f+12>>2]=0;c[f+16>>2]=0;c[e+536>>2]=9440;c[e+704>>2]=0;g[e+708>>2]=0.0;g[e+700>>2]=+g[b+200>>2];j=+g[b+196>>2];c[e+488>>2]=0;g[e+492>>2]=1.0;g[e+496>>2]=1.0;g[e+500>>2]=1.0;g[e+504>>2]=0.0;c[e+480>>2]=16680;c[e+484>>2]=8;g[e+508>>2]=j;g[e+524>>2]=j;c[e+384>>2]=0;g[e+388>>2]=1.0;g[e+392>>2]=1.0;g[e+396>>2]=1.0;g[e+400>>2]=0.0;g[e+420>>2]=.03999999910593033;c[e+428>>2]=0;c[e+376>>2]=16376;c[e+380>>2]=1;c[e+432>>2]=c[d+0>>2];c[e+436>>2]=c[d+4>>2];c[e+440>>2]=c[d+8>>2];c[e+444>>2]=c[d+12>>2];c[e+448>>2]=c[d+16>>2];c[e+452>>2]=c[d+20>>2];c[e+456>>2]=c[d+24>>2];c[e+460>>2]=c[d+28>>2];c[e+464>>2]=c[d+32>>2];c[e+468>>2]=c[d+36>>2];c[e+472>>2]=c[d+40>>2];c[e+476>>2]=c[d+44>>2];g[e+324>>2]=9999999747378752.0e-20;a[e+348>>0]=0;c[e>>2]=17152;c[e+4>>2]=e+16;c[e+8>>2]=e+480;c[e+12>>2]=e+376;if(HB(e,b+4|0,b+68|0,e+712|0,e+712|0,e+536|0)|0?(h=+g[e+700>>2],+g[b+200>>2]>h):0)g[b+200>>2]=h;c[e+376>>2]=15736;b=c[e+428>>2]|0;if((b|0)==0){i=e;return}Lb[c[c[b>>2]>>2]&511](b);b=c[e+428>>2]|0;if((b|0)==0){i=e;return}c[5006]=(c[5006]|0)+1;YE(c[b+ -4>>2]|0);i=e;return}function aD(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function bD(a){a=a|0;return}function cD(b){b=b|0;var d=0,e=0,f=0;d=i;c[b>>2]=18816;if((a[b+16>>0]|0)!=0?(e=c[b+20>>2]|0,(e|0)!=0):0){f=c[b+4>>2]|0;Nb[c[(c[f>>2]|0)+16>>2]&127](f,e)}YE(b);i=d;return}function dD(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=18816;if((a[b+16>>0]|0)==0){i=d;return}e=c[b+20>>2]|0;if((e|0)==0){i=d;return}b=c[b+4>>2]|0;Nb[c[(c[b>>2]|0)+16>>2]&127](b,e);i=d;return}function eD(b,d,e,f,h){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0,k=0,l=0,m=0.0,n=0,o=0.0,p=0.0,q=0.0,r=0,s=0,t=0,u=0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0,J=0,K=0.0,L=0.0,M=0.0,N=0.0,O=0,R=0.0,U=0.0,V=0.0,W=0.0,X=0.0,Y=0.0,Z=0.0,_=0.0,$=0.0,aa=0.0,ba=0,ca=0.0,da=0.0,ea=0.0,fa=0.0,ga=0.0,ha=0.0,ia=0.0,ja=0.0,ka=0.0,la=0.0,ma=0,na=0,oa=0,pa=0.0,qa=0.0,ra=0.0,sa=0,ta=0,ua=0,va=0,wa=0,xa=0,ya=0,za=0,Aa=0,Ba=0,Ca=0;j=i;i=i+832|0;r=c[b+20>>2]|0;if((r|0)==0){r=c[b+4>>2]|0;r=Yb[c[(c[r>>2]|0)+12>>2]&31](r,c[d+8>>2]|0,c[e+8>>2]|0)|0;c[b+20>>2]=r;a[b+16>>0]=1}c[h+4>>2]=r;l=c[d+4>>2]|0;k=c[e+4>>2]|0;u=c[l+4>>2]|0;if((u|0)==10?(c[k+4>>2]|0)==10:0){m=+g[(c[b+20>>2]|0)+752>>2];za=c[l+52>>2]|0;B=+g[l+(za<<2)+28>>2];o=+g[l+(((za+2|0)%3|0)<<2)+28>>2];Aa=c[k+52>>2]|0;C=+g[k+(Aa<<2)+28>>2];p=+g[k+(((Aa+2|0)%3|0)<<2)+28>>2];Ba=c[d+12>>2]|0;b=c[e+12>>2]|0;v=+g[Ba+(za<<2)>>2];q=+g[Ba+(za<<2)+16>>2];w=+g[Ba+(za<<2)+32>>2];D=+g[b+(Aa<<2)>>2];E=+g[b+(Aa<<2)+16>>2];A=+g[b+(Aa<<2)+32>>2];z=+g[b+48>>2]- +g[Ba+48>>2];y=+g[b+52>>2]- +g[Ba+52>>2];x=+g[b+56>>2]- +g[Ba+56>>2];F=1.0-(v*D+q*E+w*A)*(v*D+q*E+w*A);if(!(F==0.0)){G=(v*z+q*y+w*x-(v*D+q*E+w*A)*(D*z+E*y+A*x))/F;if(!(G<-B)){if(G>B)G=B}else G=-B}else G=0.0;F=(v*D+q*E+w*A)*G-(D*z+E*y+A*x);if(F<-C){F=(v*D+q*E+w*A)*-C+(v*z+q*y+w*x);if(!(F<-B))if(F>B)C=-C;else{B=F;C=-C}else{B=-B;C=-C}}else if(F>C){F=C*(v*D+q*E+w*A)+(v*z+q*y+w*x);if(!(F<-B)){if(!(F>B))B=F}else B=-B}else{B=G;C=F}D=D*C;E=E*C;A=A*C;z=D+(z-v*B);y=E+(y-q*B);B=A+(x-w*B);x=+Q(+(B*B+(z*z+y*y)));if(!(x-o-p>m)){do if(B*B+(z*z+y*y)<=1.4210854715202004e-14)if(+P(+w)>.7071067690849304){ra=1.0/+Q(+(q*q+w*w));g[j+320>>2]=0.0;g[j+324>>2]=-(w*ra);g[j+328>>2]=q*ra;z=0.0;v=-(w*ra);q=q*ra;break}else{ra=1.0/+Q(+(v*v+q*q));g[j+320>>2]=-(q*ra);g[j+324>>2]=v*ra;g[j+328>>2]=0.0;z=-(q*ra);v=v*ra;q=0.0;break}else{g[j+320>>2]=z*-(1.0/x);g[j+324>>2]=y*-(1.0/x);g[j+328>>2]=B*-(1.0/x);g[j+332>>2]=0.0;z=z*-(1.0/x);v=y*-(1.0/x);q=B*-(1.0/x)}while(0);qa=p*v+(E+ +g[b+52>>2]);ra=p*q+(A+ +g[b+56>>2]);g[j+304>>2]=p*z+(D+ +g[b+48>>2]);g[j+308>>2]=qa;g[j+312>>2]=ra;g[j+316>>2]=0.0}if(x-o-p<m){qc[c[(c[h>>2]|0)+16>>2]&15](h,j+320|0,j+304|0,x-o-p);r=c[h+4>>2]|0}if((c[r+748>>2]|0)==0){i=j;return}d=c[r+740>>2]|0;b=c[(c[h+8>>2]|0)+8>>2]|0;if((d|0)==(b|0)){nA(r,d+4|0,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0);i=j;return}else{nA(r,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0,b+4|0);i=j;return}}else ta=k+4|0;g[j+296>>2]=999999984306749400.0;J=c[b+8>>2]|0;O=c[b+12>>2]|0;c[j+88>>2]=13392;g[j+92>>2]=0.0;g[j+96>>2]=1.0;g[j+100>>2]=0.0;g[j+104>>2]=0.0;c[j+108>>2]=O;c[j+112>>2]=J;c[j+116>>2]=l;c[j+120>>2]=k;c[j+124>>2]=u;c[j+128>>2]=c[ta>>2];g[j+132>>2]=+$b[c[(c[l>>2]|0)+48>>2]&15](l);g[j+136>>2]=+$b[c[(c[k>>2]|0)+48>>2]&15](k);a[j+140>>0]=0;c[j+148>>2]=-1;c[j+160>>2]=1;c[j+164>>2]=1;c[j+116>>2]=l;c[j+120>>2]=k;qa=+$b[c[(c[l>>2]|0)+48>>2]&15](l);ra=+$b[c[(c[k>>2]|0)+48>>2]&15](k);ra=qa+ra+ +g[(c[b+20>>2]|0)+752>>2];g[j+296>>2]=ra*ra;J=c[d+12>>2]|0;c[j+168>>2]=c[J+0>>2];c[j+172>>2]=c[J+4>>2];c[j+176>>2]=c[J+8>>2];c[j+180>>2]=c[J+12>>2];O=j+184|0;c[O+0>>2]=c[J+16>>2];c[O+4>>2]=c[J+20>>2];c[O+8>>2]=c[J+24>>2];c[O+12>>2]=c[J+28>>2];I=j+200|0;c[I+0>>2]=c[J+32>>2];c[I+4>>2]=c[J+36>>2];c[I+8>>2]=c[J+40>>2];c[I+12>>2]=c[J+44>>2];na=j+216|0;c[na+0>>2]=c[J+48>>2];c[na+4>>2]=c[J+52>>2];c[na+8>>2]=c[J+56>>2];c[na+12>>2]=c[J+60>>2];J=j+232|0;r=c[e+12>>2]|0;c[J+0>>2]=c[r+0>>2];c[J+4>>2]=c[r+4>>2];c[J+8>>2]=c[r+8>>2];c[J+12>>2]=c[r+12>>2];ba=j+248|0;c[ba+0>>2]=c[r+16>>2];c[ba+4>>2]=c[r+20>>2];c[ba+8>>2]=c[r+24>>2];c[ba+12>>2]=c[r+28>>2];ma=j+264|0;c[ma+0>>2]=c[r+32>>2];c[ma+4>>2]=c[r+36>>2];c[ma+8>>2]=c[r+40>>2];c[ma+12>>2]=c[r+44>>2];u=j+280|0;c[u+0>>2]=c[r+48>>2];c[u+4>>2]=c[r+52>>2];c[u+8>>2]=c[r+56>>2];c[u+12>>2]=c[r+60>>2];r=c[l+4>>2]|0;do if((r|0)<7?(s=c[ta>>2]|0,(s|0)<7):0){c[j+80>>2]=19224;if((r|0)==0)q=0.0;else{q=+$b[c[(c[l>>2]|0)+48>>2]&15](l);s=c[ta>>2]|0}if((s|0)==0)x=0.0;else x=+$b[c[(c[k>>2]|0)+48>>2]&15](k);c[j+40>>2]=19032;c[j+44>>2]=h;g[j+64>>2]=q;g[j+68>>2]=x;a[j+76>>0]=0;s=c[l+52>>2]|0;if((s|0)!=0){r=c[k+52>>2]|0;if((r|0)==0){if((c[ta>>2]|0)!=1)break;u=j+32|0;a[u>>0]=1;r=j+28|0;c[r>>2]=0;s=j+20|0;c[s>>2]=0;n=j+24|0;c[n>>2]=0;I=c[e+12>>2]|0;qa=+g[k+56>>2];ra=+g[k+60>>2];p=+g[k+64>>2];m=qa*+g[I>>2]+ra*+g[I+4>>2]+p*+g[I+8>>2]+ +g[I+48>>2];o=qa*+g[I+16>>2]+ra*+g[I+20>>2]+p*+g[I+24>>2]+ +g[I+52>>2];p=qa*+g[I+32>>2]+ra*+g[I+36>>2]+p*+g[I+40>>2]+ +g[I+56>>2];c[5004]=(c[5004]|0)+1;I=XE(35)|0;if((I|0)==0)I=0;else{c[(I+19&-16)+ -4>>2]=I;I=I+19&-16}J=c[r>>2]|0;if((J|0)!=0){if((a[u>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[J+ -4>>2]|0)}c[r>>2]=0}a[u>>0]=1;c[r>>2]=I;c[n>>2]=1;J=c[s>>2]|0;g[I+(J<<4)>>2]=m;g[I+(J<<4)+4>>2]=o;g[I+(J<<4)+8>>2]=p;g[I+(J<<4)+12>>2]=0.0;J=c[s>>2]|0;c[s>>2]=J+1;I=c[e+12>>2]|0;qa=+g[k+72>>2];ra=+g[k+76>>2];o=+g[k+80>>2];m=qa*+g[I>>2]+ra*+g[I+4>>2]+o*+g[I+8>>2]+ +g[I+48>>2];p=qa*+g[I+16>>2]+ra*+g[I+20>>2]+o*+g[I+24>>2]+ +g[I+52>>2];o=qa*+g[I+32>>2]+ra*+g[I+36>>2]+o*+g[I+40>>2]+ +g[I+56>>2];I=c[n>>2]|0;if((J+1|0)==(I|0)){I=(J+1|0)==0?1:J+1<<1;if((J+1|0)<(I|0)){if((I|0)!=0?(c[5004]=(c[5004]|0)+1,sa=XE((I<<4|3)+16|0)|0,(sa|0)!=0):0){c[(sa+19&-16)+ -4>>2]=sa;O=sa+19&-16}else O=0;if((J|0)>-1){ba=0;do{Ba=O+(ba<<4)|0;Aa=(c[r>>2]|0)+(ba<<4)|0;c[Ba+0>>2]=c[Aa+0>>2];c[Ba+4>>2]=c[Aa+4>>2];c[Ba+8>>2]=c[Aa+8>>2];c[Ba+12>>2]=c[Aa+12>>2];ba=ba+1|0}while((ba|0)!=(J+1|0))}J=c[r>>2]|0;if((J|0)!=0){if((a[u>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[J+ -4>>2]|0)}c[r>>2]=0}a[u>>0]=1;c[r>>2]=O;c[n>>2]=I;O=c[s>>2]|0}else{O=J+1|0;I=J+1|0}}else O=J+1|0;J=c[r>>2]|0;g[J+(O<<4)>>2]=m;g[J+(O<<4)+4>>2]=p;g[J+(O<<4)+8>>2]=o;g[J+(O<<4)+12>>2]=0.0;O=O+1|0;c[s>>2]=O;Ba=c[e+12>>2]|0;qa=+g[k+88>>2];ra=+g[k+92>>2];o=+g[k+96>>2];p=qa*+g[Ba>>2]+ra*+g[Ba+4>>2]+o*+g[Ba+8>>2]+ +g[Ba+48>>2];m=qa*+g[Ba+16>>2]+ra*+g[Ba+20>>2]+o*+g[Ba+24>>2]+ +g[Ba+52>>2];o=qa*+g[Ba+32>>2]+ra*+g[Ba+36>>2]+o*+g[Ba+40>>2]+ +g[Ba+56>>2];if((O|0)==(I|0)){e=(I|0)==0?1:I<<1;if((I|0)<(e|0)){if((e|0)!=0?(c[5004]=(c[5004]|0)+1,oa=XE((e<<4|3)+16|0)|0,(oa|0)!=0):0){c[(oa+19&-16)+ -4>>2]=oa;J=oa+19&-16}else J=0;if((I|0)>0){O=0;do{Ba=J+(O<<4)|0;Aa=(c[r>>2]|0)+(O<<4)|0;c[Ba+0>>2]=c[Aa+0>>2];c[Ba+4>>2]=c[Aa+4>>2];c[Ba+8>>2]=c[Aa+8>>2];c[Ba+12>>2]=c[Aa+12>>2];O=O+1|0}while((O|0)!=(I|0))}I=c[r>>2]|0;if((I|0)!=0){if((a[u>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[I+ -4>>2]|0)}c[r>>2]=0}a[u>>0]=1;c[r>>2]=J;c[n>>2]=e;I=c[s>>2]|0}}else I=O;g[J+(I<<4)>>2]=p;g[J+(I<<4)+4>>2]=m;g[J+(I<<4)+8>>2]=o;g[J+(I<<4)+12>>2]=0.0;c[s>>2]=(c[s>>2]|0)+1;m=+g[(c[b+20>>2]|0)+752>>2];qz(j+88|0,j+168|0,j+80|0,c[f+20>>2]|0,0);o=+g[j+92>>2];q=+g[j+96>>2];p=+g[j+100>>2];if(o*o+q*q+p*p>1.1920928955078125e-7){qa=1.0/(o*o+q*q+p*p);g[j>>2]=o*qa;g[j+4>>2]=q*qa;g[j+8>>2]=p*qa;g[j+12>>2]=0.0;qa=+g[j+144>>2];ra=+$b[c[(c[l>>2]|0)+48>>2]&15](l);ra=qa-ra- +$b[c[(c[k>>2]|0)+48>>2]&15](k);UD(j,c[l+52>>2]|0,c[d+12>>2]|0,j+16|0,ra-m,m,h)}do if((a[b+16>>0]|0)!=0?(t=c[h+4>>2]|0,(c[t+748>>2]|0)!=0):0){d=c[t+740>>2]|0;b=c[(c[h+8>>2]|0)+8>>2]|0;if((d|0)==(b|0)){nA(t,d+4|0,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0);break}else{nA(t,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0,b+4|0);break}}while(0);h=c[r>>2]|0;if((h|0)!=0){if((a[u>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[r>>2]=0}a[u>>0]=1;c[r>>2]=0;c[s>>2]=0;c[n>>2]=0;i=j;return}m=+g[(c[b+20>>2]|0)+752>>2];if((a[f+24>>0]|0)==0){qz(j+88|0,j+168|0,j+40|0,c[f+20>>2]|0,0);o=+g[j+72>>2];if((a[j+76>>0]|0)!=0&o<0.0){L=+g[j+48>>2];M=+g[j+52>>2];H=+g[j+56>>2];K=+g[j+60>>2];n=105}}else{f=c[d+12>>2]|0;t=c[e+12>>2]|0;c[4920]=(c[4920]|0)+1;ka=+g[s+64>>2];la=+g[s+68>>2];y=+g[f+4>>2];pa=+g[s+72>>2];z=+g[f+8>>2];A=+g[f+16>>2];B=+g[f+20>>2];D=+g[f+24>>2];C=+g[f+32>>2];E=+g[f+36>>2];F=+g[f+40>>2];qa=+g[r+64>>2];ra=+g[r+68>>2];o=+g[r+72>>2];q=ka*+g[f>>2]+la*y+pa*z+ +g[f+48>>2]-(qa*+g[t>>2]+ra*+g[t+4>>2]+o*+g[t+8>>2]+ +g[t+48>>2]);p=ka*A+la*B+pa*D+ +g[f+52>>2]-(qa*+g[t+16>>2]+ra*+g[t+20>>2]+o*+g[t+24>>2]+ +g[t+52>>2]);o=ka*C+la*E+pa*F+ +g[f+56>>2]-(qa*+g[t+32>>2]+ra*+g[t+36>>2]+o*+g[t+40>>2]+ +g[t+56>>2]);u=c[s+28>>2]|0;a:do if((u|0)>0){x=0.0;R=3.4028234663852886e+38;I=0;L=0.0;M=0.0;H=0.0;K=0.0;while(1){Ba=c[s+36>>2]|0;pa=+g[Ba+(I*36|0)+20>>2];qa=+g[Ba+(I*36|0)+24>>2];ra=+g[Ba+(I*36|0)+28>>2];y=pa*+g[f>>2]+qa*y+ra*z;z=pa*A+qa*B+ra*D;A=pa*C+qa*E+ra*F;g[j+400>>2]=y;g[j+404>>2]=z;g[j+408>>2]=A;g[j+412>>2]=0.0;if(q*y+p*z+o*A<0.0){g[j+400>>2]=y*-1.0;g[j+404>>2]=z*-1.0;g[j+408>>2]=A*-1.0;y=y*-1.0;z=z*-1.0;A=A*-1.0}c[4916]=(c[4916]|0)+1;if(TD(f,t,q,p,o,y,z,A,s,r,R)|0){c[4918]=(c[4918]|0)+1;DD(s,f,j+400|0,j+808|0,j+784|0,j+464|0,j+448|0);DD(r,t,j+400|0,j+720|0,j+480|0,j+432|0,j+416|0);z=+g[j+784>>2];y=+g[j+720>>2];if(!(z<y)?(w=+g[j+480>>2],v=+g[j+808>>2],!(w<v)):0){J=1;y=z-y<w-v?z-y:w-v}else{J=0;y=x}if(!J){r=0;break a}if(y<R){x=y;R=y;L=+g[j+400>>2];M=+g[j+404>>2];H=+g[j+408>>2];K=+g[j+412>>2]}else x=y}I=I+1|0;if((I|0)>=(u|0)){n=52;break a}y=+g[f+4>>2];z=+g[f+8>>2];A=+g[f+16>>2];B=+g[f+20>>2];D=+g[f+24>>2];C=+g[f+32>>2];E=+g[f+36>>2];F=+g[f+40>>2]}}else{R=3.4028234663852886e+38;L=0.0;M=0.0;H=0.0;K=0.0;n=52}while(0);b:do if((n|0)==52){u=c[r+28>>2]|0;if((u|0)>0){v=0.0;I=0;do{Ba=c[r+36>>2]|0;qa=+g[Ba+(I*36|0)+20>>2];ra=+g[Ba+(I*36|0)+24>>2];x=+g[Ba+(I*36|0)+28>>2];w=qa*+g[t>>2]+ra*+g[t+4>>2]+x*+g[t+8>>2];y=qa*+g[t+16>>2]+ra*+g[t+20>>2]+x*+g[t+24>>2];x=qa*+g[t+32>>2]+ra*+g[t+36>>2]+x*+g[t+40>>2];g[j+384>>2]=w;g[j+388>>2]=y;g[j+392>>2]=x;g[j+396>>2]=0.0;if(q*w+p*y+o*x<0.0){g[j+384>>2]=w*-1.0;g[j+388>>2]=y*-1.0;g[j+392>>2]=x*-1.0;w=w*-1.0;y=y*-1.0;x=x*-1.0}c[4916]=(c[4916]|0)+1;do if(TD(f,t,q,p,o,w,y,x,s,r,R)|0){c[4918]=(c[4918]|0)+1;DD(s,f,j+384|0,j+808|0,j+784|0,j+464|0,j+448|0);DD(r,t,j+384|0,j+720|0,j+480|0,j+432|0,j+416|0);y=+g[j+784>>2];x=+g[j+720>>2];do if(y<x){J=0;w=v}else{w=+g[j+480>>2];z=+g[j+808>>2];if(w<z){J=0;w=v;break}J=1;w=y-x<w-z?y-x:w-z}while(0);if(!J){r=0;break b}if(!(w<R)){v=w;break}v=w;R=w;L=+g[j+384>>2];M=+g[j+388>>2];H=+g[j+392>>2];K=+g[j+396>>2]}while(0);I=I+1|0}while((I|0)<(u|0))}J=c[s+48>>2]|0;if((J|0)>0){y=0.0;z=0.0;A=0.0;B=0.0;C=0.0;D=0.0;F=0.0;E=0.0;G=0.0;N=0.0;W=0.0;Y=0.0;Z=0.0;X=0.0;V=0.0;U=0.0;_=0.0;$=0.0;aa=0.0;ba=c[r+48>>2]|0;u=0;O=-1;I=-1;while(1){Ba=c[s+56>>2]|0;qa=+g[Ba+(u<<4)>>2];ra=+g[Ba+(u<<4)+4>>2];w=+g[Ba+(u<<4)+8>>2];x=qa*+g[f>>2]+ra*+g[f+4>>2]+w*+g[f+8>>2];v=qa*+g[f+16>>2]+ra*+g[f+20>>2]+w*+g[f+24>>2];w=qa*+g[f+32>>2]+ra*+g[f+36>>2]+w*+g[f+40>>2];if((ba|0)>0){J=0;do{Ba=c[r+56>>2]|0;qa=+g[Ba+(J<<4)>>2];ra=+g[Ba+(J<<4)+4>>2];ha=+g[Ba+(J<<4)+8>>2];ea=qa*+g[t>>2]+ra*+g[t+4>>2]+ha*+g[t+8>>2];ga=qa*+g[t+16>>2]+ra*+g[t+20>>2]+ha*+g[t+24>>2];ha=qa*+g[t+32>>2]+ra*+g[t+36>>2]+ha*+g[t+40>>2];g[j+368>>2]=v*ha-w*ga;g[j+372>>2]=w*ea-x*ha;g[j+376>>2]=x*ga-v*ea;g[j+380>>2]=0.0;do if(!(+P(+(v*ha-w*ga))>1.0e-6)){if(+P(+(w*ea-x*ha))>1.0e-6){n=70;break}if(+P(+(x*ga-v*ea))>1.0e-6)n=70}else n=70;while(0);do if((n|0)==70){n=0;ca=1.0/+Q(+((v*ha-w*ga)*(v*ha-w*ga)+(w*ea-x*ha)*(w*ea-x*ha)+(x*ga-v*ea)*(x*ga-v*ea)));da=(v*ha-w*ga)*ca;g[j+368>>2]=da;fa=(w*ea-x*ha)*ca;g[j+372>>2]=fa;ca=(x*ga-v*ea)*ca;g[j+376>>2]=ca;if(q*da+p*fa+o*ca<0.0){g[j+368>>2]=da*-1.0;g[j+372>>2]=fa*-1.0;g[j+376>>2]=ca*-1.0;da=da*-1.0;fa=fa*-1.0;ca=ca*-1.0}c[4916]=(c[4916]|0)+1;if(!(TD(f,t,q,p,o,da,fa,ca,s,r,R)|0))break;c[4918]=(c[4918]|0)+1;DD(s,f,j+368|0,j+808|0,j+784|0,j+464|0,j+448|0);DD(r,t,j+368|0,j+720|0,j+480|0,j+432|0,j+416|0);ka=+g[j+784>>2];qa=+g[j+720>>2];do if(!(ka<qa)){pa=+g[j+480>>2];ra=+g[j+808>>2];if(pa<ra){ba=0;la=Z;ja=Y;ia=W;fa=F;ca=D;da=C;ka=y;break}if(ka-qa<pa-ra){ba=1;la=+g[j+456>>2];ja=+g[j+452>>2];ia=+g[j+448>>2];fa=+g[j+440>>2];ca=+g[j+436>>2];da=+g[j+432>>2];ka=ka-qa;break}else{ba=1;la=+g[j+472>>2];ja=+g[j+468>>2];ia=+g[j+464>>2];fa=+g[j+424>>2];ca=+g[j+420>>2];da=+g[j+416>>2];ka=pa-ra;break}}else{ba=0;la=Z;ja=Y;ia=W;fa=F;ca=D;da=C;ka=y}while(0);if(!ba){r=0;break b}if(!(ka<R)){Z=la;Y=ja;W=ia;F=fa;D=ca;C=da;y=ka;break}aa=w;$=v;_=x;U=ha;V=ga;X=ea;Z=la;Y=ja;W=ia;N=la;G=ja;E=ia;F=fa;D=ca;C=da;B=fa;A=ca;z=da;y=ka;R=ka;O=u;I=J;L=+g[j+368>>2];M=+g[j+372>>2];H=+g[j+376>>2];K=+g[j+380>>2]}while(0);J=J+1|0;ba=c[r+48>>2]|0}while((J|0)<(ba|0));v=aa;w=$;x=_;J=c[s+48>>2]|0}else{v=aa;w=$;x=_}u=u+1|0;if((u|0)>=(J|0))break;else{_=x;$=w;aa=v}}}else{v=0.0;w=0.0;x=0.0;U=0.0;V=0.0;X=0.0;N=0.0;G=0.0;E=0.0;B=0.0;A=0.0;z=0.0;O=-1;I=-1}if((I|O|0)>-1){C=z-E;D=A-G;y=B-N;N=x*X+w*V+v*U;F=x*C+w*D+v*y;G=X*C+V*D+U*y;do if(!(1.0-N*N==0.0))if((F-N*G)/(1.0-N*N)<-1.0000000150474662e+30)E=-1.0000000150474662e+30;else{if(!((F-N*G)/(1.0-N*N)>1.0000000150474662e+30)){E=(F-N*G)/(1.0-N*N);break}E=1.0000000150474662e+30}else E=0.0;while(0);G=N*E-G;do if(G<-1.0000000150474662e+30){if(N*-1.0000000150474662e+30+F<-1.0000000150474662e+30){E=-1.0000000150474662e+30;N=-1.0000000150474662e+30;break}if(!(N*-1.0000000150474662e+30+F>1.0000000150474662e+30)){E=N*-1.0000000150474662e+30+F;N=-1.0000000150474662e+30;break}E=1.0000000150474662e+30;N=-1.0000000150474662e+30}else{if(!(G>1.0000000150474662e+30)){N=G;break}if(N*1.0000000150474662e+30+F<-1.0000000150474662e+30){E=-1.0000000150474662e+30;N=1.0000000150474662e+30;break}if(!(N*1.0000000150474662e+30+F>1.0000000150474662e+30)){E=N*1.0000000150474662e+30+F;N=1.0000000150474662e+30;break}E=1.0000000150474662e+30;N=1.0000000150474662e+30}while(0);F=X*N;G=N*V;N=N*U;x=C-x*E+F;w=D-E*w+G;y=y-E*v+N;g[j+352>>2]=x;g[j+356>>2]=w;g[j+360>>2]=y;g[j+364>>2]=0.0;if(x*x+w*w+y*y>1.1920928955078125e-7){v=+Q(+(x*x+w*w+y*y));g[j+352>>2]=x*(1.0/v);g[j+356>>2]=1.0/v*w;g[j+360>>2]=1.0/v*y;if(x*(1.0/v)*q+1.0/v*w*p+1.0/v*y*o<0.0){g[j+352>>2]=x*(1.0/v)*-1.0;g[j+356>>2]=1.0/v*w*-1.0;g[j+360>>2]=1.0/v*y*-1.0}g[j+336>>2]=z+F;g[j+340>>2]=A+G;g[j+344>>2]=B+N;g[j+348>>2]=0.0;qc[c[(c[h>>2]|0)+16>>2]&15](h,j+352|0,j+336|0,-v)}}if(q*L+p*M+o*H<0.0){r=1;L=-L;M=-M;H=-H;K=0.0}else r=1}while(0);if(r){o=-1.0000000150474662e+30;n=105}}if((n|0)==105){l=c[l+52>>2]|0;k=c[k+52>>2]|0;d=c[d+12>>2]|0;e=c[e+12>>2]|0;o=o-m;v=1.0/+Q(+(L*L+M*M+H*H));p=L*v;q=M*v;v=H*v;g[j+808>>2]=p;g[j+812>>2]=q;g[j+816>>2]=v;g[j+820>>2]=K;f=c[k+28>>2]|0;n=c[k+36>>2]|0;if((f|0)>0){w=+g[e>>2];x=+g[e+4>>2];A=+g[e+8>>2];D=+g[e+16>>2];E=+g[e+20>>2];H=+g[e+24>>2];G=+g[e+32>>2];C=+g[e+36>>2];B=+g[e+40>>2];t=-1;K=-3.4028234663852886e+38;r=0;while(1){y=+g[n+(r*36|0)+20>>2];z=+g[n+(r*36|0)+24>>2];F=+g[n+(r*36|0)+28>>2];s=(y*w+z*x+F*A)*p+(y*D+z*E+F*H)*q+(y*G+z*C+F*B)*v>K;t=s?r:t;r=r+1|0;if((r|0)>=(f|0)){s=t;break}else K=s?(y*w+z*x+F*A)*p+(y*D+z*E+F*H)*q+(y*G+z*C+F*B)*v:K}}else s=-1;a[j+800>>0]=1;r=j+796|0;c[r>>2]=0;c[j+788>>2]=0;c[j+792>>2]=0;f=c[n+(s*36|0)+4>>2]|0;c:do if((f|0)>0){n=n+(s*36|0)+12|0;O=0;J=0;u=0;t=0;while(1){Ba=c[(c[n>>2]|0)+(t<<2)>>2]|0;Aa=c[k+16>>2]|0;qa=+g[Aa+(Ba<<4)>>2];ra=+g[Aa+(Ba<<4)+4>>2];v=+g[Aa+(Ba<<4)+8>>2];p=qa*+g[e>>2]+ra*+g[e+4>>2]+v*+g[e+8>>2]+ +g[e+48>>2];q=qa*+g[e+16>>2]+ra*+g[e+20>>2]+v*+g[e+24>>2]+ +g[e+52>>2];v=qa*+g[e+32>>2]+ra*+g[e+36>>2]+v*+g[e+40>>2]+ +g[e+56>>2];if((O|0)==(u|0)){I=(u|0)==0?1:u<<1;if((u|0)<(I|0)){do if((I|0)==0)J=0;else{c[5004]=(c[5004]|0)+1;J=XE((I<<4|3)+16|0)|0;if((J|0)==0){J=0;break}c[(J+19&-16)+ -4>>2]=J;J=J+19&-16}while(0);if((u|0)>0){O=0;do{Ba=J+(O<<4)|0;Aa=(c[r>>2]|0)+(O<<4)|0;c[Ba+0>>2]=c[Aa+0>>2];c[Ba+4>>2]=c[Aa+4>>2];c[Ba+8>>2]=c[Aa+8>>2];c[Ba+12>>2]=c[Aa+12>>2];O=O+1|0}while((O|0)!=(u|0))}u=c[r>>2]|0;if((u|0)!=0){if((a[j+800>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[u+ -4>>2]|0)}c[r>>2]=0}a[j+800>>0]=1;c[r>>2]=J;c[j+792>>2]=I;I=J;u=c[j+788>>2]|0}else I=J}else{I=J;u=O}g[I+(u<<4)>>2]=p;g[I+(u<<4)+4>>2]=q;g[I+(u<<4)+8>>2]=v;g[I+(u<<4)+12>>2]=0.0;O=(c[j+788>>2]|0)+1|0;c[j+788>>2]=O;t=t+1|0;if((t|0)>=(f|0))break c;J=I;u=c[j+792>>2]|0}}else I=0;while(0);if((s|0)>-1){UD(j+808|0,l,d,j+784|0,o,m,h);I=c[r>>2]|0}if((I|0)!=0){if((a[j+800>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[I+ -4>>2]|0)}c[r>>2]=0}}if((a[b+16>>0]|0)==0){i=j;return}e=c[h+4>>2]|0;if((c[e+748>>2]|0)==0){i=j;return}d=c[e+740>>2]|0;b=c[(c[h+8>>2]|0)+8>>2]|0;if((d|0)==(b|0)){nA(e,d+4|0,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0);i=j;return}else{nA(e,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0,b+4|0);i=j;return}}}while(0);qz(j+88|0,j+168|0,h,c[f+20>>2]|0,0);if(((c[b+28>>2]|0)!=0?(c[(c[h+4>>2]|0)+748>>2]|0)<(c[b+32>>2]|0):0)?(p=+g[j+92>>2],m=+g[j+96>>2],o=+g[j+100>>2],p*p+m*m+o*o>1.1920928955078125e-7):0){q=1.0/(p*p+m*m+o*o);if(+P(+(o*q))>.7071067690849304){z=1.0/+Q(+(o*q*o*q+m*q*m*q));x=0.0;y=-(o*q*z);z=m*q*z}else{y=1.0/+Q(+(p*q*p*q+m*q*m*q));x=-(m*q*y);y=p*q*y;z=0.0}v=+$b[c[(c[l>>2]|0)+16>>2]&15](l);w=+$b[c[(c[k>>2]|0)+16>>2]&15](k);A=.019999999552965164/(v<w?v:w);if(v<w){c[j+720>>2]=c[j+168>>2];c[j+724>>2]=c[j+172>>2];c[j+728>>2]=c[j+176>>2];c[j+732>>2]=c[j+180>>2];c[j+736>>2]=c[O+0>>2];c[j+740>>2]=c[O+4>>2];c[j+744>>2]=c[O+8>>2];c[j+748>>2]=c[O+12>>2];c[j+752>>2]=c[I+0>>2];c[j+756>>2]=c[I+4>>2];c[j+760>>2]=c[I+8>>2];c[j+764>>2]=c[I+12>>2];c[j+768>>2]=c[na+0>>2];c[j+772>>2]=c[na+4>>2];c[j+776>>2]=c[na+8>>2];c[j+780>>2]=c[na+12>>2]}else{c[j+720>>2]=c[J+0>>2];c[j+724>>2]=c[J+4>>2];c[j+728>>2]=c[J+8>>2];c[j+732>>2]=c[J+12>>2];c[j+736>>2]=c[ba+0>>2];c[j+740>>2]=c[ba+4>>2];c[j+744>>2]=c[ba+8>>2];c[j+748>>2]=c[ba+12>>2];c[j+752>>2]=c[ma+0>>2];c[j+756>>2]=c[ma+4>>2];c[j+760>>2]=c[ma+8>>2];c[j+764>>2]=c[ma+12>>2];c[j+768>>2]=c[u+0>>2];c[j+772>>2]=c[u+4>>2];c[j+776>>2]=c[u+8>>2];c[j+780>>2]=c[u+12>>2]}Aa=c[b+28>>2]|0;if((Aa|0)>0){B=z*z+(y*y+x*x);A=A>.39269909262657166?.19634954631328583:A*.5;ya=j+516|0;va=j+532|0;xa=j+548|0;oa=j+564|0;wa=j+580|0;k=j+596|0;n=j+612|0;r=j+628|0;t=j+644|0;ta=j+660|0;l=j+736|0;s=j+676|0;ua=j+752|0;sa=j+692|0;za=j+768|0;if(B>1.1920928955078125e-7){B=+T(+A)/+Q(+B);x=x*B;y=y*B;z=z*B;B=+S(+A);A=+Q(+(o*q*o*q+(p*q*p*q+m*q*m*q)));if(v<w){Ba=0;do{aa=+(Ba|0)*(6.2831854820251465/+(Aa|0))*.5;la=+T(+aa)/A;aa=+S(+aa);ha=z*-(m*q*la)+(x*aa+B*-(p*q*la))-y*-(o*q*la);qa=x*-(o*q*la)+(y*aa+B*-(m*q*la))-z*-(p*q*la);ia=y*-(p*q*la)+(z*aa+B*-(o*q*la))-x*-(m*q*la);$=B*aa-x*-(p*q*la)-y*-(m*q*la)-z*-(o*q*la);ka=o*q*la*qa+(p*q*la*$+aa*ha)-m*q*la*ia;pa=p*q*la*ia+(aa*qa+m*q*la*$)-o*q*la*ha;_=m*q*la*ha+(o*q*la*$+aa*ia)-p*q*la*qa;ia=aa*$-p*q*la*ha-m*q*la*qa-o*q*la*ia;la=ka*(2.0/(ia*ia+(_*_+(ka*ka+pa*pa))));qa=pa*(2.0/(ia*ia+(_*_+(ka*ka+pa*pa))));ha=_*(2.0/(ia*ia+(_*_+(ka*ka+pa*pa))));Ca=c[d+12>>2]|0;$=+g[Ca>>2];aa=+g[Ca+16>>2];ca=+g[Ca+32>>2];da=+g[Ca+4>>2];ea=+g[Ca+20>>2];fa=+g[Ca+36>>2];ga=+g[Ca+8>>2];ja=+g[Ca+24>>2];ra=+g[Ca+40>>2];g[j+168>>2]=(ka*ha+ia*qa)*ca+(aa*(ka*qa-ia*ha)+$*(1.0-(pa*qa+_*ha)));g[j+172>>2]=(1.0-(pa*qa+_*ha))*da+(ka*qa-ia*ha)*ea+(ka*ha+ia*qa)*fa;g[j+176>>2]=(1.0-(pa*qa+_*ha))*ga+(ka*qa-ia*ha)*ja+(ka*ha+ia*qa)*ra;g[j+180>>2]=0.0;g[j+184>>2]=(pa*ha-ia*la)*ca+($*(ka*qa+ia*ha)+aa*(1.0-(ka*la+_*ha)));g[j+188>>2]=(ka*qa+ia*ha)*da+(1.0-(ka*la+_*ha))*ea+(pa*ha-ia*la)*fa;g[j+192>>2]=(ka*qa+ia*ha)*ga+(1.0-(ka*la+_*ha))*ja+(pa*ha-ia*la)*ra;g[j+196>>2]=0.0;g[j+200>>2]=$*(ka*ha-ia*qa)+aa*(pa*ha+ia*la)+ca*(1.0-(ka*la+pa*qa));g[j+204>>2]=(ka*ha-ia*qa)*da+(pa*ha+ia*la)*ea+(1.0-(ka*la+pa*qa))*fa;g[j+208>>2]=(ka*ha-ia*qa)*ga+(pa*ha+ia*la)*ja+(1.0-(ka*la+pa*qa))*ra;g[j+212>>2]=0.0;Ca=c[e+12>>2]|0;c[J+0>>2]=c[Ca+0>>2];c[J+4>>2]=c[Ca+4>>2];c[J+8>>2]=c[Ca+8>>2];c[J+12>>2]=c[Ca+12>>2];c[ba+0>>2]=c[Ca+16>>2];c[ba+4>>2]=c[Ca+20>>2];c[ba+8>>2]=c[Ca+24>>2];c[ba+12>>2]=c[Ca+28>>2];c[ma+0>>2]=c[Ca+32>>2];c[ma+4>>2]=c[Ca+36>>2];c[ma+8>>2]=c[Ca+40>>2];c[ma+12>>2]=c[Ca+44>>2];c[u+0>>2]=c[Ca+48>>2];c[u+4>>2]=c[Ca+52>>2];c[u+8>>2]=c[Ca+56>>2];c[u+12>>2]=c[Ca+60>>2];Ca=c[f+20>>2]|0;c[j+480>>2]=18952;c[j+512>>2]=h;c[ya+0>>2]=c[j+168>>2];c[ya+4>>2]=c[j+172>>2];c[ya+8>>2]=c[j+176>>2];c[ya+12>>2]=c[j+180>>2];c[va+0>>2]=c[O+0>>2];c[va+4>>2]=c[O+4>>2];c[va+8>>2]=c[O+8>>2];c[va+12>>2]=c[O+12>>2];c[xa+0>>2]=c[I+0>>2];c[xa+4>>2]=c[I+4>>2];c[xa+8>>2]=c[I+8>>2];c[xa+12>>2]=c[I+12>>2];c[oa+0>>2]=c[na+0>>2];c[oa+4>>2]=c[na+4>>2];c[oa+8>>2]=c[na+8>>2];c[oa+12>>2]=c[na+12>>2];c[wa+0>>2]=c[J+0>>2];c[wa+4>>2]=c[J+4>>2];c[wa+8>>2]=c[J+8>>2];c[wa+12>>2]=c[J+12>>2];c[k+0>>2]=c[ba+0>>2];c[k+4>>2]=c[ba+4>>2];c[k+8>>2]=c[ba+8>>2];c[k+12>>2]=c[ba+12>>2];c[n+0>>2]=c[ma+0>>2];c[n+4>>2]=c[ma+4>>2];c[n+8>>2]=c[ma+8>>2];c[n+12>>2]=c[ma+12>>2];c[r+0>>2]=c[u+0>>2];c[r+4>>2]=c[u+4>>2];c[r+8>>2]=c[u+8>>2];c[r+12>>2]=c[u+12>>2];c[t+0>>2]=c[j+720>>2];c[t+4>>2]=c[j+724>>2];c[t+8>>2]=c[j+728>>2];c[t+12>>2]=c[j+732>>2];c[ta+0>>2]=c[l+0>>2];c[ta+4>>2]=c[l+4>>2];c[ta+8>>2]=c[l+8>>2];c[ta+12>>2]=c[l+12>>2];c[s+0>>2]=c[ua+0>>2];c[s+4>>2]=c[ua+4>>2];c[s+8>>2]=c[ua+8>>2];c[s+12>>2]=c[ua+12>>2];c[sa+0>>2]=c[za+0>>2];c[sa+4>>2]=c[za+4>>2];c[sa+8>>2]=c[za+8>>2];c[sa+12>>2]=c[za+12>>2];a[j+708>>0]=v<w&1;c[j+712>>2]=Ca;qz(j+88|0,j+168|0,j+480|0,Ca,0);Aa=c[b+28>>2]|0;Ba=Ba+1|0}while((Ba|0)<(Aa|0))}else{Ba=0;do{aa=+(Ba|0)*(6.2831854820251465/+(Aa|0))*.5;la=+T(+aa)/A;aa=+S(+aa);Ca=c[d+12>>2]|0;c[j+168>>2]=c[Ca+0>>2];c[j+172>>2]=c[Ca+4>>2];c[j+176>>2]=c[Ca+8>>2];c[j+180>>2]=c[Ca+12>>2];c[O+0>>2]=c[Ca+16>>2];c[O+4>>2]=c[Ca+20>>2];c[O+8>>2]=c[Ca+24>>2];c[O+12>>2]=c[Ca+28>>2];c[I+0>>2]=c[Ca+32>>2];c[I+4>>2]=c[Ca+36>>2];c[I+8>>2]=c[Ca+40>>2];c[I+12>>2]=c[Ca+44>>2];c[na+0>>2]=c[Ca+48>>2];c[na+4>>2]=c[Ca+52>>2];c[na+8>>2]=c[Ca+56>>2];c[na+12>>2]=c[Ca+60>>2];ha=z*-(m*q*la)+(x*aa+B*-(p*q*la))-y*-(o*q*la);qa=x*-(o*q*la)+(y*aa+B*-(m*q*la))-z*-(p*q*la);ia=y*-(p*q*la)+(z*aa+B*-(o*q*la))-x*-(m*q*la);$=B*aa-x*-(p*q*la)-y*-(m*q*la)-z*-(o*q*la);ka=o*q*la*qa+(p*q*la*$+aa*ha)-m*q*la*ia;pa=p*q*la*ia+(aa*qa+m*q*la*$)-o*q*la*ha;_=m*q*la*ha+(o*q*la*$+aa*ia)-p*q*la*qa;ia=aa*$-p*q*la*ha-m*q*la*qa-o*q*la*ia;la=ka*(2.0/(ia*ia+(_*_+(ka*ka+pa*pa))));qa=pa*(2.0/(ia*ia+(_*_+(ka*ka+pa*pa))));ha=_*(2.0/(ia*ia+(_*_+(ka*ka+pa*pa))));Ca=c[e+12>>2]|0;$=+g[Ca>>2];aa=+g[Ca+16>>2];ca=+g[Ca+32>>2];da=+g[Ca+4>>2];ea=+g[Ca+20>>2];fa=+g[Ca+36>>2];ga=+g[Ca+8>>2];ja=+g[Ca+24>>2];ra=+g[Ca+40>>2];g[j+232>>2]=(ka*ha+ia*qa)*ca+(aa*(ka*qa-ia*ha)+$*(1.0-(pa*qa+_*ha)));g[j+236>>2]=(1.0-(pa*qa+_*ha))*da+(ka*qa-ia*ha)*ea+(ka*ha+ia*qa)*fa;g[j+240>>2]=(1.0-(pa*qa+_*ha))*ga+(ka*qa-ia*ha)*ja+(ka*ha+ia*qa)*ra;g[j+244>>2]=0.0;g[j+248>>2]=(pa*ha-ia*la)*ca+($*(ka*qa+ia*ha)+aa*(1.0-(ka*la+_*ha)));g[j+252>>2]=(ka*qa+ia*ha)*da+(1.0-(ka*la+_*ha))*ea+(pa*ha-ia*la)*fa;g[j+256>>2]=(ka*qa+ia*ha)*ga+(1.0-(ka*la+_*ha))*ja+(pa*ha-ia*la)*ra;g[j+260>>2]=0.0;g[j+264>>2]=$*(ka*ha-ia*qa)+aa*(pa*ha+ia*la)+ca*(1.0-(ka*la+pa*qa));g[j+268>>2]=(ka*ha-ia*qa)*da+(pa*ha+ia*la)*ea+(1.0-(ka*la+pa*qa))*fa;g[j+272>>2]=(ka*ha-ia*qa)*ga+(pa*ha+ia*la)*ja+(1.0-(ka*la+pa*qa))*ra;g[j+276>>2]=0.0;Ca=c[f+20>>2]|0;c[j+480>>2]=18952;c[j+512>>2]=h;c[ya+0>>2]=c[j+168>>2];c[ya+4>>2]=c[j+172>>2];c[ya+8>>2]=c[j+176>>2];c[ya+12>>2]=c[j+180>>2];c[va+0>>2]=c[O+0>>2];c[va+4>>2]=c[O+4>>2];c[va+8>>2]=c[O+8>>2];c[va+12>>2]=c[O+12>>2];c[xa+0>>2]=c[I+0>>2];c[xa+4>>2]=c[I+4>>2];c[xa+8>>2]=c[I+8>>2];c[xa+12>>2]=c[I+12>>2];c[oa+0>>2]=c[na+0>>2];c[oa+4>>2]=c[na+4>>2];c[oa+8>>2]=c[na+8>>2];c[oa+12>>2]=c[na+12>>2];c[wa+0>>2]=c[J+0>>2];c[wa+4>>2]=c[J+4>>2];c[wa+8>>2]=c[J+8>>2];c[wa+12>>2]=c[J+12>>2];c[k+0>>2]=c[ba+0>>2];c[k+4>>2]=c[ba+4>>2];c[k+8>>2]=c[ba+8>>2];c[k+12>>2]=c[ba+12>>2];c[n+0>>2]=c[ma+0>>2];c[n+4>>2]=c[ma+4>>2];c[n+8>>2]=c[ma+8>>2];c[n+12>>2]=c[ma+12>>2];c[r+0>>2]=c[u+0>>2];c[r+4>>2]=c[u+4>>2];c[r+8>>2]=c[u+8>>2];c[r+12>>2]=c[u+12>>2];c[t+0>>2]=c[j+720>>2];c[t+4>>2]=c[j+724>>2];c[t+8>>2]=c[j+728>>2];c[t+12>>2]=c[j+732>>2];c[ta+0>>2]=c[l+0>>2];c[ta+4>>2]=c[l+4>>2];c[ta+8>>2]=c[l+8>>2];c[ta+12>>2]=c[l+12>>2];c[s+0>>2]=c[ua+0>>2];c[s+4>>2]=c[ua+4>>2];c[s+8>>2]=c[ua+8>>2];c[s+12>>2]=c[ua+12>>2];c[sa+0>>2]=c[za+0>>2];c[sa+4>>2]=c[za+4>>2];c[sa+8>>2]=c[za+8>>2];c[sa+12>>2]=c[za+12>>2];a[j+708>>0]=v<w&1;c[j+712>>2]=Ca;qz(j+88|0,j+168|0,j+480|0,Ca,0);Aa=c[b+28>>2]|0;Ba=Ba+1|0}while((Ba|0)<(Aa|0))}}else if(v<w){d=0;do d=d+1|0;while((d|0)<(Aa|0))}else{d=0;do d=d+1|0;while((d|0)<(Aa|0))}}}if((a[b+16>>0]|0)==0){i=j;return}b=c[h+4>>2]|0;if((c[b+748>>2]|0)==0){i=j;return}d=c[b+740>>2]|0;e=c[(c[h+8>>2]|0)+8>>2]|0;if((d|0)==(e|0)){nA(b,d+4|0,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0);i=j;return}else{nA(b,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0,e+4|0);i=j;return}}function fD(a){a=a|0;return}function gD(b,d,e,f,h){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0;f=i;i=i+624|0;p=+g[d+116>>2]- +g[d+52>>2];o=+g[d+120>>2]- +g[d+56>>2];n=+g[d+124>>2]- +g[d+60>>2];l=+g[e+116>>2]- +g[e+52>>2];k=+g[e+120>>2]- +g[e+56>>2];j=+g[e+124>>2]- +g[e+60>>2];m=+g[d+252>>2];if(p*p+o*o+n*n<m*m?(p=+g[e+252>>2],l*l+k*k+j*j<p*p):0){p=1.0;i=f;return+p}b=c[d+192>>2]|0;p=+g[e+248>>2];c[f+576>>2]=0;g[f+580>>2]=1.0;g[f+584>>2]=1.0;g[f+588>>2]=1.0;g[f+592>>2]=0.0;c[f+568>>2]=16680;c[f+572>>2]=8;g[f+596>>2]=p;g[f+612>>2]=p;c[f+392>>2]=9440;g[f+556>>2]=999999984306749400.0;c[f+560>>2]=0;g[f+564>>2]=0.0;g[f+340>>2]=9999999747378752.0e-20;a[f+364>>0]=0;c[f+16>>2]=13184;c[f+20>>2]=f+32;c[f+24>>2]=b;c[f+28>>2]=f+568;if(mz(f+16|0,d+4|0,d+68|0,e+4|0,e+68|0,f+392|0)|0){k=+g[f+556>>2];if(+g[d+244>>2]>k)g[d+244>>2]=k;if(+g[e+244>>2]>k)g[e+244>>2]=k;if(!(k<1.0))k=1.0}else k=1.0;b=c[e+192>>2]|0;p=+g[d+248>>2];c[f+576>>2]=0;g[f+580>>2]=1.0;g[f+584>>2]=1.0;g[f+588>>2]=1.0;g[f+592>>2]=0.0;c[f+568>>2]=16680;c[f+572>>2]=8;g[f+596>>2]=p;g[f+612>>2]=p;c[f+392>>2]=9440;g[f+556>>2]=999999984306749400.0;c[f+560>>2]=0;g[f+564>>2]=0.0;g[f+340>>2]=9999999747378752.0e-20;a[f+364>>0]=a[f+364>>0]&-16;c[f>>2]=13184;c[f+4>>2]=f+32;c[f+8>>2]=f+568;c[f+12>>2]=b;if(!(mz(f,d+4|0,d+68|0,e+4|0,e+68|0,f+392|0)|0)){p=k;i=f;return+p}j=+g[f+556>>2];if(+g[d+244>>2]>j)g[d+244>>2]=j;if(+g[e+244>>2]>j)g[e+244>>2]=j;if(!(k>j)){p=k;i=f;return+p}p=j;i=f;return+p}function hD(b,d){b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0;e=i;if((c[b+20>>2]|0)==0){i=e;return}if((a[b+16>>0]|0)==0){i=e;return}h=c[d+4>>2]|0;if((h|0)==(c[d+8>>2]|0)?(f=(h|0)==0?1:h<<1,(h|0)<(f|0)):0){if((f|0)==0)g=0;else{c[5004]=(c[5004]|0)+1;g=XE((f<<2|3)+16|0)|0;if((g|0)==0)g=0;else{c[(g+19&-16)+ -4>>2]=g;g=g+19&-16}h=c[d+4>>2]|0}if((h|0)>0){j=0;do{k=g+(j<<2)|0;if((k|0)!=0)c[k>>2]=c[(c[d+12>>2]|0)+(j<<2)>>2];j=j+1|0}while((j|0)!=(h|0))}j=c[d+12>>2]|0;if((j|0)!=0){if((a[d+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0);h=c[d+4>>2]|0}c[d+12>>2]=0}a[d+16>>0]=1;c[d+12>>2]=g;c[d+8>>2]=f}f=(c[d+12>>2]|0)+(h<<2)|0;if((f|0)!=0)c[f>>2]=c[b+20>>2];c[d+4>>2]=h+1;i=e;return}function iD(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var g=0,h=0,j=0,k=0;e=i;f=c[d>>2]|0;f=gc[c[(c[f>>2]|0)+56>>2]&31](f,36)|0;if((f|0)==0){f=0;i=e;return f|0}h=c[d+4>>2]|0;k=c[b+12>>2]|0;j=c[b+8>>2]|0;g=c[b+16>>2]|0;b=c[b+20>>2]|0;c[f+4>>2]=c[d>>2];c[f>>2]=18816;c[f+8>>2]=k;c[f+12>>2]=j;a[f+16>>0]=0;c[f+20>>2]=h;a[f+24>>0]=0;c[f+28>>2]=g;c[f+32>>2]=b;i=e;return f|0}function jD(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function kD(b,d,e,f){b=b|0;d=d|0;e=e|0;f=+f;var h=0.0,j=0.0,k=0.0,l=0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0;l=i;i=i+16|0;n=+g[d>>2];h=+g[d+4>>2];j=+g[d+8>>2];m=+g[e>>2];k=+g[e+4>>2];o=+g[e+8>>2];if((a[b+228>>0]|0)==0){z=+g[b+100>>2];w=+g[b+116>>2];C=+g[b+132>>2];y=+g[b+104>>2];u=+g[b+120>>2];B=+g[b+136>>2];x=+g[b+108>>2];s=+g[b+124>>2];A=+g[b+140>>2];F=-+g[b+148>>2];E=-+g[b+152>>2];D=-+g[b+156>>2];I=+g[b+164>>2];r=+g[b+168>>2];J=+g[b+172>>2];H=+g[b+180>>2];G=+g[b+184>>2];q=+g[b+188>>2];v=+g[b+196>>2];t=+g[b+200>>2];p=+g[b+204>>2];r=o*(C*I+B*r+A*J)+(m*(z*I+y*r+x*J)+k*(w*I+u*r+s*J))+((x*F+s*E+A*D)*J+(I*(z*F+w*E+C*D)+r*(y*F+u*E+B*D))+ +g[b+212>>2]);q=o*(C*H+B*G+A*q)+(m*(z*H+y*G+x*q)+k*(w*H+u*G+s*q))+((z*F+w*E+C*D)*H+(y*F+u*E+B*D)*G+(x*F+s*E+A*D)*q+ +g[b+216>>2]);p=(z*F+w*E+C*D)*v+(y*F+u*E+B*D)*t+(x*F+s*E+A*D)*p+ +g[b+220>>2]+(o*(C*v+B*t+A*p)+(m*(z*v+y*t+x*p)+k*(w*v+u*t+s*p)));g[l>>2]=r;g[l+4>>2]=q;g[l+8>>2]=p;g[l+12>>2]=0.0;o=(n*f+m-r)*+g[d>>2]+(h*f+k-q)*+g[d+4>>2]+(j*f+o-p)*+g[d+8>>2];e=b+32|0;e=c[e>>2]|0;b=c[e>>2]|0;b=b+16|0;b=c[b>>2]|0;qc[b&15](e,d,l,o);i=l;return}else{z=+g[b+36>>2];C=+g[b+52>>2];w=+g[b+68>>2];A=+g[b+40>>2];E=+g[b+56>>2];x=+g[b+72>>2];B=+g[b+44>>2];G=+g[b+60>>2];y=+g[b+76>>2];t=-+g[b+84>>2];u=-+g[b+88>>2];v=-+g[b+92>>2];q=+g[b+164>>2];H=+g[b+168>>2];p=+g[b+172>>2];r=+g[b+180>>2];s=+g[b+184>>2];I=+g[b+188>>2];D=+g[b+196>>2];F=+g[b+200>>2];J=+g[b+204>>2];H=(j*f+o)*(w*q+x*H+y*p)+((n*f+m)*(z*q+A*H+B*p)+(h*f+k)*(C*q+E*H+G*p))+((B*t+G*u+y*v)*p+(q*(z*t+C*u+w*v)+H*(A*t+E*u+x*v))+ +g[b+212>>2]);I=(j*f+o)*(w*r+x*s+y*I)+((n*f+m)*(z*r+A*s+B*I)+(h*f+k)*(C*r+E*s+G*I))+((z*t+C*u+w*v)*r+(A*t+E*u+x*v)*s+(B*t+G*u+y*v)*I+ +g[b+216>>2]);J=(z*t+C*u+w*v)*D+(A*t+E*u+x*v)*F+(B*t+G*u+y*v)*J+ +g[b+220>>2]+((j*f+o)*(w*D+x*F+y*J)+((n*f+m)*(z*D+A*F+B*J)+(h*f+k)*(C*D+E*F+G*J)));g[l>>2]=H+n*(n*(H-m)+h*(I-k)+j*(J-o));g[l+4>>2]=I+h*(n*(H-m)+h*(I-k)+j*(J-o));g[l+8>>2]=J+j*(n*(H-m)+h*(I-k)+j*(J-o));g[l+12>>2]=0.0;J=n*(H-m)+h*(I-k)+j*(J-o);e=b+32|0;e=c[e>>2]|0;b=c[e>>2]|0;b=b+16|0;b=c[b>>2]|0;qc[b&15](e,d,l,J);i=l;return}}function lD(a){a=a|0;return}function mD(a){a=a|0;return}function nD(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function oD(a,b,c){a=a|0;b=b|0;c=c|0;return}function pD(a,b,c){a=a|0;b=b|0;c=c|0;return}function qD(b,d,e,f){b=b|0;d=d|0;e=e|0;f=+f;var h=0,j=0.0,k=0.0,l=0.0;h=i;i=i+16|0;g[b+32>>2]=f;c[b+8>>2]=c[d+0>>2];c[b+12>>2]=c[d+4>>2];c[b+16>>2]=c[d+8>>2];c[b+20>>2]=c[d+12>>2];j=+g[b+28>>2];l=+g[e+4>>2]-j*+g[d+4>>2];k=+g[e+8>>2]-j*+g[d+8>>2];g[h>>2]=+g[e>>2]- +g[d>>2]*j;g[h+4>>2]=l;g[h+8>>2]=k;g[h+12>>2]=0.0;f=+g[b+24>>2]+j+f;g[b+32>>2]=f;if(!(f<0.0)){e=b+4|0;e=c[e>>2]|0;b=c[e>>2]|0;b=b+16|0;b=c[b>>2]|0;qc[b&15](e,d,h,f);i=h;return}a[b+36>>0]=1;e=b+4|0;e=c[e>>2]|0;b=c[e>>2]|0;b=b+16|0;b=c[b>>2]|0;qc[b&15](e,d,h,f);i=h;return}function rD(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function sD(a,b,c){a=a|0;b=b|0;c=c|0;return}function tD(a,b,c){a=a|0;b=b|0;c=c|0;return}function uD(a,b,c,d){a=a|0;b=b|0;c=c|0;d=+d;return}function vD(b){b=b|0;var d=0,e=0,f=0;d=i;c[b>>2]=19408;if((a[b+8>>0]|0)!=0?(e=c[b+12>>2]|0,(e|0)!=0):0){f=c[b+4>>2]|0;Nb[c[(c[f>>2]|0)+16>>2]&127](f,e)}YE(b);i=d;return}function wD(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=19408;if((a[b+8>>0]|0)==0){i=d;return}e=c[b+12>>2]|0;if((e|0)==0){i=d;return}b=c[b+4>>2]|0;Nb[c[(c[b>>2]|0)+16>>2]&127](b,e);i=d;return}function xD(b,d,e,f,h){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0,k=0.0,l=0.0,m=0.0,n=0.0,o=0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0,K=0,L=0.0,M=0.0,N=0.0,O=0.0,R=0.0,U=0.0,V=0.0,W=0.0,X=0.0,Y=0.0,Z=0.0,_=0.0,$=0,aa=0.0,ba=0.0,ca=0.0,da=0.0,ea=0.0,fa=0.0,ga=0.0;f=i;i=i+128|0;if((c[b+12>>2]|0)==0){i=f;return}C=(a[b+16>>0]|0)!=0;K=C?e:d;C=C?d:e;o=c[K+4>>2]|0;j=c[C+4>>2]|0;K=c[K+12>>2]|0;q=+g[K>>2];D=+g[K+16>>2];z=+g[K+32>>2];t=+g[K+4>>2];s=+g[K+20>>2];r=+g[K+36>>2];p=+g[K+8>>2];n=+g[K+24>>2];y=+g[K+40>>2];F=+g[K+48>>2];G=+g[K+52>>2];H=+g[K+56>>2];K=c[C+12>>2]|0;O=+g[K>>2];N=+g[K+16>>2];k=+g[K+32>>2];M=+g[K+4>>2];L=+g[K+20>>2];x=+g[K+36>>2];m=+g[K+8>>2];B=+g[K+24>>2];v=+g[K+40>>2];I=-+g[K+48>>2];E=-+g[K+52>>2];u=-+g[K+56>>2];K=c[(c[o>>2]|0)+64>>2]|0;A=-+g[j+48>>2];l=-+g[j+52>>2];w=-+g[j+56>>2];g[f+32>>2]=(q*O+D*N+z*k)*A+(q*M+D*L+z*x)*l+(q*m+D*B+z*v)*w;g[f+36>>2]=(t*O+s*N+r*k)*A+(t*M+s*L+r*x)*l+(t*m+s*B+r*v)*w;g[f+40>>2]=(p*O+n*N+y*k)*A+(p*M+n*L+y*x)*l+(p*m+n*B+y*v)*w;g[f+44>>2]=0.0;rc[K&127](f+48|0,o,f+32|0);w=+g[f+48>>2];l=+g[f+52>>2];A=+g[f+56>>2];k=F*O+G*N+H*k+(O*I+N*E+k*u)+((q*O+D*N+z*k)*w+(t*O+s*N+r*k)*l+(p*O+n*N+y*k)*A);x=F*M+G*L+H*x+(M*I+L*E+x*u)+((q*M+D*L+z*x)*w+(t*M+s*L+r*x)*l+(p*M+n*L+y*x)*A);A=F*m+G*B+H*v+(m*I+B*E+v*u)+((q*m+D*B+z*v)*w+(t*m+s*B+r*v)*l+(p*m+n*B+y*v)*A);v=+g[j+48>>2];y=+g[j+52>>2];B=+g[j+56>>2];n=B*A+(v*k+y*x)- +g[j+64>>2];K=c[C+12>>2]|0;m=+g[K>>2];p=+g[K+4>>2];l=+g[K+8>>2];r=+g[K+16>>2];s=+g[K+20>>2];t=+g[K+24>>2];w=+g[K+32>>2];z=+g[K+36>>2];D=+g[K+40>>2];q=+g[K+48>>2];u=+g[K+52>>2];E=+g[K+56>>2];K=c[b+12>>2]|0;J=n<+g[K+752>>2];c[h+4>>2]=K;if(J){K=c[C+12>>2]|0;N=v*+g[K+16>>2]+y*+g[K+20>>2]+B*+g[K+24>>2];O=v*+g[K+32>>2]+y*+g[K+36>>2]+B*+g[K+40>>2];g[f+16>>2]=+g[K>>2]*v+ +g[K+4>>2]*y+ +g[K+8>>2]*B;g[f+20>>2]=N;g[f+24>>2]=O;g[f+28>>2]=0.0;g[f>>2]=l*(A-B*n)+(m*(k-v*n)+p*(x-y*n))+q;g[f+4>>2]=(k-v*n)*r+(x-y*n)*s+(A-B*n)*t+u;g[f+8>>2]=(k-v*n)*w+(x-y*n)*z+(A-B*n)*D+E;g[f+12>>2]=0.0;qc[c[(c[h>>2]|0)+16>>2]&15](h,f+16|0,f,n)}if((c[o+4>>2]|0)<7?(c[(c[h+4>>2]|0)+748>>2]|0)<(c[b+24>>2]|0):0){l=+g[j+56>>2];if(+P(+l)>.7071067690849304){O=+g[j+52>>2];m=1.0/+Q(+(l*l+O*O));k=0.0;l=-(l*m);m=O*m}else{m=+g[j+48>>2];k=+g[j+52>>2];l=1.0/+Q(+(m*m+k*k));k=-(k*l);l=m*l;m=0.0}O=.019999999552965164/+$b[c[(c[o>>2]|0)+16>>2]&15](o);n=+Q(+(m*m+(l*l+k*k)));O=O>.39269909262657166?.19634954631328583:O*.5;n=+T(+O)/n;k=k*n;l=l*n;n=m*n;m=+S(+O);C=c[b+20>>2]|0;if((C|0)>0){o=0;do{q=+g[j+48>>2];O=+g[j+52>>2];p=+g[j+56>>2];x=+(o|0)*(6.2831854820251465/+(C|0))*.5;N=+T(+x)/+Q(+(q*q+O*O+p*p));x=+S(+x);z=n*-(O*N)+(k*x+m*-(q*N))-l*-(p*N);s=k*-(p*N)+(l*x+m*-(O*N))-n*-(q*N);fa=l*-(q*N)+(n*x+m*-(p*N))-k*-(O*N);A=m*x-k*-(q*N)-l*-(O*N)-n*-(p*N);E=p*N*s+(q*N*A+x*z)-O*N*fa;D=q*N*fa+(x*s+O*N*A)-p*N*z;ba=O*N*z+(p*N*A+x*fa)-q*N*s;fa=x*A-q*N*z-O*N*s-p*N*fa;C=(a[b+16>>0]|0)!=0;$=C?e:d;C=C?d:e;K=c[$+4>>2]|0;J=c[C+4>>2]|0;$=c[$+12>>2]|0;N=+g[$>>2];p=+g[$+4>>2];s=+g[$+8>>2];O=+g[$+16>>2];z=+g[$+20>>2];q=+g[$+24>>2];A=+g[$+32>>2];x=+g[$+36>>2];H=+g[$+40>>2];W=+g[$+48>>2];V=+g[$+52>>2];U=+g[$+56>>2];$=c[C+12>>2]|0;_=+g[$>>2];Z=+g[$+16>>2];u=+g[$+32>>2];Y=+g[$+4>>2];X=+g[$+20>>2];w=+g[$+36>>2];r=+g[$+8>>2];F=+g[$+24>>2];G=+g[$+40>>2];R=-+g[$+48>>2];L=-+g[$+52>>2];M=-+g[$+56>>2];t=E*(2.0/(E*E+D*D+ba*ba+fa*fa));I=D*(2.0/(E*E+D*D+ba*ba+fa*fa));ga=ba*(2.0/(E*E+D*D+ba*ba+fa*fa));da=s*(E*ga-fa*I)+(p*(E*I+fa*ga)+N*(1.0-(D*I+ba*ga)));aa=s*(D*ga+fa*t)+(N*(E*I-fa*ga)+p*(1.0-(E*t+ba*ga)));y=N*(E*ga+fa*I)+p*(D*ga-fa*t)+s*(1.0-(E*t+D*I));ca=q*(E*ga-fa*I)+(z*(E*I+fa*ga)+O*(1.0-(D*I+ba*ga)));B=q*(D*ga+fa*t)+(O*(E*I-fa*ga)+z*(1.0-(E*t+ba*ga)));v=O*(E*ga+fa*I)+z*(D*ga-fa*t)+q*(1.0-(E*t+D*I));ea=H*(E*ga-fa*I)+(x*(E*I+fa*ga)+A*(1.0-(D*I+ba*ga)));ba=H*(D*ga+fa*t)+(A*(E*I-fa*ga)+x*(1.0-(E*t+ba*ga)));I=A*(E*ga+fa*I)+x*(D*ga-fa*t)+H*(1.0-(E*t+D*I));$=c[(c[K>>2]|0)+64>>2]|0;D=-+g[J+48>>2];t=-+g[J+52>>2];E=-+g[J+56>>2];g[f+96>>2]=(G*ea+(r*da+F*ca))*E+((u*ea+(_*da+Z*ca))*D+(w*ea+(Y*da+X*ca))*t);g[f+100>>2]=(G*ba+(r*aa+F*B))*E+((u*ba+(_*aa+Z*B))*D+(w*ba+(Y*aa+X*B))*t);g[f+104>>2]=(G*I+(r*y+F*v))*E+((u*I+(_*y+Z*v))*D+(w*I+(Y*y+X*v))*t);g[f+108>>2]=0.0;rc[$&127](f+112|0,K,f+96|0);t=+g[f+112>>2];v=+g[f+116>>2];y=+g[f+120>>2];I=+g[J+48>>2];D=+g[J+52>>2];E=+g[J+56>>2];B=E*(W*r+V*F+U*G+(r*R+F*L+G*M)+((N*r+O*F+A*G)*t+(p*r+z*F+x*G)*v+(s*r+q*F+H*G)*y))+(I*(W*_+V*Z+U*u+(_*R+Z*L+u*M)+((N*_+O*Z+A*u)*t+(p*_+z*Z+x*u)*v+(s*_+q*Z+H*u)*y))+D*(W*Y+V*X+U*w+(Y*R+X*L+w*M)+((N*Y+O*X+A*w)*t+(p*Y+z*X+x*w)*v+(s*Y+q*X+H*w)*y)))- +g[J+64>>2];u=W*_+V*Z+U*u+(_*R+Z*L+u*M)+((N*_+O*Z+A*u)*t+(p*_+z*Z+x*u)*v+(s*_+q*Z+H*u)*y)-I*B;w=W*Y+V*X+U*w+(Y*R+X*L+w*M)+((N*Y+O*X+A*w)*t+(p*Y+z*X+x*w)*v+(s*Y+q*X+H*w)*y)-D*B;y=W*r+V*F+U*G+(r*R+F*L+G*M)+((N*r+O*F+A*G)*t+(p*r+z*F+x*G)*v+(s*r+q*F+H*G)*y)-E*B;J=c[C+12>>2]|0;G=+g[J>>2];H=+g[J+4>>2];F=+g[J+8>>2];q=+g[J+16>>2];r=+g[J+20>>2];s=+g[J+24>>2];v=+g[J+32>>2];x=+g[J+36>>2];z=+g[J+40>>2];p=+g[J+48>>2];t=+g[J+52>>2];A=+g[J+56>>2];J=c[b+12>>2]|0;K=B<+g[J+752>>2];c[h+4>>2]=J;if(K){$=c[C+12>>2]|0;fa=I*+g[$+16>>2]+D*+g[$+20>>2]+E*+g[$+24>>2];ga=I*+g[$+32>>2]+D*+g[$+36>>2]+E*+g[$+40>>2];g[f+80>>2]=+g[$>>2]*I+ +g[$+4>>2]*D+ +g[$+8>>2]*E;g[f+84>>2]=fa;g[f+88>>2]=ga;g[f+92>>2]=0.0;g[f+64>>2]=F*y+(G*u+H*w)+p;g[f+68>>2]=u*q+w*r+y*s+t;g[f+72>>2]=u*v+w*x+y*z+A;g[f+76>>2]=0.0;qc[c[(c[h>>2]|0)+16>>2]&15](h,f+80|0,f+64|0,B)}o=o+1|0;C=c[b+20>>2]|0}while((o|0)<(C|0))}}if((a[b+8>>0]|0)==0){i=f;return}if((c[(c[b+12>>2]|0)+748>>2]|0)==0){i=f;return}b=c[h+4>>2]|0;if((c[b+748>>2]|0)==0){i=f;return}d=c[b+740>>2]|0;e=c[(c[h+8>>2]|0)+8>>2]|0;if((d|0)==(e|0)){nA(b,d+4|0,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0);i=f;return}else{nA(b,(c[(c[h+12>>2]|0)+8>>2]|0)+4|0,e+4|0);i=f;return}}function yD(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;return 1.0}function zD(b,d){b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0;e=i;if((c[b+12>>2]|0)==0){i=e;return}if((a[b+8>>0]|0)==0){i=e;return}h=c[d+4>>2]|0;if((h|0)==(c[d+8>>2]|0)?(f=(h|0)==0?1:h<<1,(h|0)<(f|0)):0){if((f|0)==0)g=0;else{c[5004]=(c[5004]|0)+1;g=XE((f<<2|3)+16|0)|0;if((g|0)==0)g=0;else{c[(g+19&-16)+ -4>>2]=g;g=g+19&-16}h=c[d+4>>2]|0}if((h|0)>0){j=0;do{k=g+(j<<2)|0;if((k|0)!=0)c[k>>2]=c[(c[d+12>>2]|0)+(j<<2)>>2];j=j+1|0}while((j|0)!=(h|0))}j=c[d+12>>2]|0;if((j|0)!=0){if((a[d+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0);h=c[d+4>>2]|0}c[d+12>>2]=0}a[d+16>>0]=1;c[d+12>>2]=g;c[d+8>>2]=f}f=(c[d+12>>2]|0)+(h<<2)|0;if((f|0)!=0)c[f>>2]=c[b+12>>2];c[d+4>>2]=h+1;i=e;return}function AD(a){a=a|0;var b=0;b=i;BD(a);if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function BD(b){b=b|0;var d=0,e=0,f=0,g=0,h=0,j=0,k=0,l=0;d=i;c[b>>2]=19496;e=c[b+56>>2]|0;if((e|0)!=0){if((a[b+60>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+56>>2]=0}a[b+60>>0]=1;c[b+56>>2]=0;c[b+48>>2]=0;c[b+52>>2]=0;f=c[b+28>>2]|0;if((f|0)>0){g=0;do{h=c[b+36>>2]|0;l=h+(g*36|0)+4|0;k=h+(g*36|0)+12|0;e=c[k>>2]|0;j=h+(g*36|0)+16|0;if((e|0)!=0){if((a[j>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[k>>2]=0}a[j>>0]=1;c[k>>2]=0;c[l>>2]=0;c[h+(g*36|0)+8>>2]=0;g=g+1|0}while((g|0)!=(f|0))}e=c[b+36>>2]|0;if((e|0)!=0){if((a[b+40>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+36>>2]=0}a[b+40>>0]=1;c[b+36>>2]=0;c[b+28>>2]=0;c[b+32>>2]=0;e=c[b+16>>2]|0;if((e|0)==0){a[b+20>>0]=1;c[b+16>>2]=0;c[b+8>>2]=0;l=b+12|0;c[l>>2]=0;i=d;return}if((a[b+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+16>>2]=0;a[b+20>>0]=1;c[b+16>>2]=0;c[b+8>>2]=0;l=b+12|0;c[l>>2]=0;i=d;return}function CD(a){a=a|0;var b=0,d=0,e=0,f=0,h=0.0,j=0.0,k=0.0,l=0;b=i;d=c[a+28>>2]|0;if((d|0)<=0){a=0;do a=a+1|0;while((a|0)<8);d=1;i=b;return d|0}e=c[a+36>>2]|0;k=0.0;j=0.0;h=0.0;f=0;a:while(1){switch(f|0){case 2:{h=+g[a+88>>2]+ +g[a+72>>2];j=+g[a+68>>2]- +g[a+84>>2];k=+g[a+80>>2]+ +g[a+64>>2];break};case 6:{h=+g[a+88>>2]+ +g[a+72>>2];j=+g[a+68>>2]- +g[a+84>>2];k=+g[a+64>>2]- +g[a+80>>2];break};case 1:{h=+g[a+72>>2]- +g[a+88>>2];j=+g[a+84>>2]+ +g[a+68>>2];k=+g[a+80>>2]+ +g[a+64>>2];break};case 5:{h=+g[a+72>>2]- +g[a+88>>2];j=+g[a+84>>2]+ +g[a+68>>2];k=+g[a+64>>2]- +g[a+80>>2];break};case 4:{h=+g[a+88>>2]+ +g[a+72>>2];j=+g[a+84>>2]+ +g[a+68>>2];k=+g[a+64>>2]- +g[a+80>>2];break};case 0:{h=+g[a+88>>2]+ +g[a+72>>2];j=+g[a+84>>2]+ +g[a+68>>2];k=+g[a+80>>2]+ +g[a+64>>2];break};case 3:{h=+g[a+72>>2]- +g[a+88>>2];j=+g[a+68>>2]- +g[a+84>>2];k=+g[a+80>>2]+ +g[a+64>>2];break};case 7:{h=+g[a+72>>2]- +g[a+88>>2];j=+g[a+68>>2]- +g[a+84>>2];k=+g[a+64>>2]- +g[a+80>>2];break};default:{}}l=0;do{if(+g[e+(l*36|0)+32>>2]+(k*+g[e+(l*36|0)+20>>2]+j*+g[e+(l*36|0)+24>>2]+h*+g[e+(l*36|0)+28>>2])>0.0){d=0;a=17;break a}l=l+1|0}while((l|0)<(d|0));f=f+1|0;if((f|0)>=8){d=1;a=17;break}}if((a|0)==17){i=b;return d|0}return 0}function DD(a,b,d,e,f,h,j){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;var k=0,l=0.0,m=0,n=0,o=0.0,p=0.0,q=0.0,r=0.0,s=0;k=i;i=i+16|0;g[e>>2]=3.4028234663852886e+38;g[f>>2]=-3.4028234663852886e+38;m=c[a+8>>2]|0;if((m|0)>0){n=0;do{s=c[a+16>>2]|0;r=+g[s+(n<<4)>>2];q=+g[s+(n<<4)+4>>2];l=+g[s+(n<<4)+8>>2];p=r*+g[b>>2]+q*+g[b+4>>2]+l*+g[b+8>>2]+ +g[b+48>>2];o=r*+g[b+16>>2]+q*+g[b+20>>2]+l*+g[b+24>>2]+ +g[b+52>>2];l=r*+g[b+32>>2]+q*+g[b+36>>2]+l*+g[b+40>>2]+ +g[b+56>>2];q=p*+g[d>>2]+o*+g[d+4>>2]+l*+g[d+8>>2];if(q<+g[e>>2]){g[e>>2]=q;g[h>>2]=p;g[h+4>>2]=o;g[h+8>>2]=l;g[h+12>>2]=0.0}if(q>+g[f>>2]){g[f>>2]=q;g[j>>2]=p;g[j+4>>2]=o;g[j+8>>2]=l;g[j+12>>2]=0.0}n=n+1|0}while((n|0)!=(m|0));o=+g[f>>2]}else o=-3.4028234663852886e+38;l=+g[e>>2];if(!(l>o)){i=k;return}g[e>>2]=o;g[f>>2]=l;c[k+0>>2]=c[h+0>>2];c[k+4>>2]=c[h+4>>2];c[k+8>>2]=c[h+8>>2];c[k+12>>2]=c[h+12>>2];c[h+0>>2]=c[j+0>>2];c[h+4>>2]=c[j+4>>2];c[h+8>>2]=c[j+8>>2];c[h+12>>2]=c[j+12>>2];c[j+0>>2]=c[k+0>>2];c[j+4>>2]=c[k+4>>2];c[j+8>>2]=c[k+8>>2];c[j+12>>2]=c[k+12>>2];i=k;return}function ED(b,e,f){b=b|0;e=e|0;f=f|0;var h=0,j=0.0,k=0,l=0,m=0.0,n=0.0,o=0,p=0,q=0,r=0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0,z=0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0;h=i;i=i+176|0;c[b+348>>2]=b+220;c[b+352>>2]=b+252;c[b+356>>2]=b+284;c[b+360>>2]=b+316;c[b+364>>2]=4;c[b+368>>2]=0;c[b+376>>2]=0;y=c[e+4>>2]|0;c[b>>2]=c[e>>2];c[b+4>>2]=y;c[b+8>>2]=c[e+8>>2];c[b+12>>2]=c[e+12>>2];c[b+16>>2]=c[e+16>>2];c[b+20>>2]=c[e+20>>2];c[b+24>>2]=c[e+24>>2];c[b+28>>2]=c[e+28>>2];c[b+32>>2]=c[e+32>>2];c[b+36>>2]=c[e+36>>2];c[b+40>>2]=c[e+40>>2];c[b+44>>2]=c[e+44>>2];c[b+48>>2]=c[e+48>>2];c[b+52>>2]=c[e+52>>2];c[b+56>>2]=c[e+56>>2];c[b+60>>2]=c[e+60>>2];c[b+64>>2]=c[e+64>>2];c[b+68>>2]=c[e+68>>2];c[b+72>>2]=c[e+72>>2];c[b+76>>2]=c[e+76>>2];c[b+80>>2]=c[e+80>>2];c[b+84>>2]=c[e+84>>2];c[b+88>>2]=c[e+88>>2];c[b+92>>2]=c[e+92>>2];c[b+96>>2]=c[e+96>>2];c[b+100>>2]=c[e+100>>2];c[b+104>>2]=c[e+104>>2];c[b+108>>2]=c[e+108>>2];c[b+112>>2]=c[e+112>>2];c[b+116>>2]=c[e+116>>2];y=d[e+120>>0]|d[e+121>>0]<<8|d[e+122>>0]<<16|d[e+123>>0]<<24;z=d[e+124>>0]|d[e+125>>0]<<8|d[e+126>>0]<<16|d[e+127>>0]<<24;a[b+120>>0]=y;a[b+121>>0]=y>>8;a[b+122>>0]=y>>16;a[b+123>>0]=y>>24;a[b+124>>0]=z;a[b+125>>0]=z>>8;a[b+126>>0]=z>>16;a[b+127>>0]=z>>24;g[b+144>>2]=0.0;c[b+180>>2]=0;c[b+128>>2]=c[f+0>>2];c[b+132>>2]=c[f+4>>2];c[b+136>>2]=c[f+8>>2];c[b+140>>2]=c[f+12>>2];s=+g[b+128>>2];t=+g[b+132>>2];n=+g[b+136>>2];if(s*s+t*t+n*n>0.0){v=-s;m=-t;u=-n}else{v=1.0;m=0.0;u=0.0}g[b+164>>2]=0.0;c[b+364>>2]=3;c[b+148>>2]=b+316;c[b+180>>2]=1;HD(b,v,m,u,b+316|0);g[b+164>>2]=1.0;e=(c[b+148>>2]|0)+16|0;c[b+128>>2]=c[e+0>>2];c[b+132>>2]=c[e+4>>2];c[b+136>>2]=c[e+8>>2];c[b+140>>2]=c[e+12>>2];c[h+72>>2]=c[e+0>>2];c[h+76>>2]=c[e+4>>2];c[h+80>>2]=c[e+8>>2];c[h+84>>2]=c[e+12>>2];c[h+56>>2]=c[e+0>>2];c[h+60>>2]=c[e+4>>2];c[h+64>>2]=c[e+8>>2];c[h+68>>2]=c[e+12>>2];c[h+40>>2]=c[e+0>>2];c[h+44>>2]=c[e+4>>2];c[h+48>>2]=c[e+8>>2];c[h+52>>2]=c[e+12>>2];c[h+24>>2]=c[e+0>>2];c[h+28>>2]=c[e+4>>2];c[h+32>>2]=c[e+8>>2];c[h+36>>2]=c[e+12>>2];m=0.0;e=1;f=1;A=s*s+t*t+n*n;a:while(1){l=c[b+368>>2]|0;u=+g[b+128>>2];t=+g[b+132>>2];s=+g[b+136>>2];n=+Q(+(u*u+t*t+s*s));if(n<9999999747378752.0e-20){k=5;break}g[b+(l*36|0)+(c[b+(l*36|0)+180>>2]<<2)+164>>2]=0.0;o=(c[b+364>>2]|0)+ -1|0;c[b+364>>2]=o;c[b+(l*36|0)+(c[b+(l*36|0)+180>>2]<<2)+148>>2]=c[b+(o<<2)+348>>2];o=c[b+(l*36|0)+180>>2]|0;c[b+(l*36|0)+180>>2]=o+1;HD(b,-u,-t,-s,c[b+(l*36|0)+(o<<2)+148>>2]|0);o=c[b+(l*36|0)+180>>2]|0;q=c[b+(l*36|0)+(o+ -1<<2)+148>>2]|0;s=+g[q+16>>2];u=+g[q+20>>2];t=+g[q+24>>2];p=0;do{v=s- +g[h+24+(p<<4)>>2];w=u- +g[h+24+(p<<4)+4>>2];x=t- +g[h+24+(p<<4)+8>>2];p=p+1|0;if(v*v+w*w+x*x<9999999747378752.0e-20){k=9;break a}}while(p>>>0<4);z=h+24+(e<<4)|0;c[z+0>>2]=c[q+16>>2];c[z+4>>2]=c[q+20>>2];c[z+8>>2]=c[q+24>>2];c[z+12>>2]=c[q+28>>2];x=(+g[b+128>>2]*s+ +g[b+132>>2]*u+ +g[b+136>>2]*t)/n;m=x>m?x:m;if(n-m-n*9999999747378752.0e-20<=0.0){k=11;break}c[h>>2]=0;if((o|0)==4){q=c[b+(l*36|0)+148>>2]|0;r=c[b+(l*36|0)+152>>2]|0;p=c[b+(l*36|0)+156>>2]|0;o=c[b+(l*36|0)+160>>2]|0;c[h+152>>2]=q+16;c[h+156>>2]=r+16;c[h+160>>2]=p+16;c[h+164>>2]=o+16;u=+g[q+16>>2];v=+g[o+16>>2];s=+g[q+20>>2];w=+g[o+20>>2];t=+g[q+24>>2];x=+g[o+24>>2];g[h+104>>2]=u-v;g[h+108>>2]=s-w;g[h+112>>2]=t-x;g[h+116>>2]=0.0;C=+g[r+16>>2];E=+g[r+20>>2];A=+g[r+24>>2];g[h+120>>2]=C-v;g[h+124>>2]=E-w;g[h+128>>2]=A-x;g[h+132>>2]=0.0;B=+g[p+16>>2];F=+g[p+20>>2];D=+g[p+24>>2];g[h+136>>2]=B-v;g[h+140>>2]=F-w;g[h+144>>2]=D-x;g[h+148>>2]=0.0;n=(s-w)*(A-x)*(B-v)+(t-x)*(C-v)*(F-w)-(F-w)*(A-x)*(u-v)-(s-w)*(C-v)*(D-x)+(D-x)*(u-v)*(E-w)-(B-v)*(t-x)*(E-w);if(!(!(n*(t*((C-B)*(s-E)-(E-F)*(u-C))+(u*((E-F)*(t-A)-(A-D)*(s-E))+s*((A-D)*(u-C)-(C-B)*(t-A))))<=0.0)|(n!=n|0.0!=0.0|n==0.0))){c[h+92>>2]=0;c[h+96>>2]=0;c[h+100>>2]=0;c[h+88>>2]=0;s=s-w;t=t-x;u=u-v;y=0;A=-1.0;while(1){z=c[19552+(y<<2)>>2]|0;D=+g[h+104+(z<<4)+8>>2];E=+g[h+104+(z<<4)+4>>2];F=+g[h+104+(z<<4)>>2];if(n*((s*D-t*E)*v+w*(t*F-D*u)+(E*u-s*F)*x)>0.0?(j=+LD(c[h+152+(y<<2)>>2]|0,c[h+152+(z<<2)>>2]|0,o+16|0,h+92|0,h+88|0),A<0.0|j<A):0){G=c[h+88>>2]|0;c[h>>2]=((G&2|0)==0?0:1<<z)+(G<<1&8)+((G&1|0)==0?0:1<<y);g[h+8+(y<<2)>>2]=+g[h+92>>2];g[h+8+(z<<2)>>2]=+g[h+96>>2];g[h+8+(c[19552+(z<<2)>>2]<<2)>>2]=0.0;g[h+20>>2]=+g[h+100>>2];A=j}y=y+1|0;if((y|0)==3)break;s=+g[h+104+(y<<4)+4>>2];t=+g[h+104+(y<<4)+8>>2];u=+g[h+104+(y<<4)>>2];v=+g[o+16>>2];w=+g[o+20>>2];x=+g[o+24>>2]}if(A<0.0){c[h>>2]=15;A=+g[p+20>>2];s=+g[r+24>>2];E=+g[o+16>>2];w=+g[p+24>>2];t=+g[r+16>>2];v=+g[o+20>>2];B=+g[p+16>>2];C=+g[o+24>>2];u=+g[r+20>>2];g[h+8>>2]=(A*s*E+w*t*v-v*s*B-A*t*C+C*B*u-E*w*u)/n;x=+g[q+20>>2];F=+g[q+24>>2];D=+g[q+16>>2];g[h+12>>2]=(x*w*E+F*B*v-v*w*D-x*B*C+C*D*A-E*F*A)/n;g[h+16>>2]=(u*F*E+s*D*v-v*F*t-u*D*C+C*t*x-E*s*x)/n;g[h+20>>2]=1.0-((u*F*E+s*D*v-v*F*t-u*D*C+C*t*x-E*s*x)/n+((A*s*E+w*t*v-v*s*B-A*t*C+C*B*u-E*w*u)/n+(x*w*E+F*B*v-v*w*D-x*B*C+C*D*A-E*F*A)/n));A=0.0}}else A=-1.0}else if((o|0)==3)A=+LD((c[b+(l*36|0)+148>>2]|0)+16|0,(c[b+(l*36|0)+152>>2]|0)+16|0,(c[b+(l*36|0)+156>>2]|0)+16|0,h+8|0,h);else if((o|0)==2)A=+KD((c[b+(l*36|0)+148>>2]|0)+16|0,(c[b+(l*36|0)+152>>2]|0)+16|0,h+8|0,h);if(!(A>=0.0)){k=32;break}c[b+((1-l|0)*36|0)+180>>2]=0;c[b+128>>2]=0;c[b+132>>2]=0;c[b+136>>2]=0;c[b+140>>2]=0;c[b+368>>2]=1-l;y=c[b+(l*36|0)+180>>2]|0;o=c[h>>2]|0;if((y|0)!=0){r=0;do{q=b+(l*36|0)+(r<<2)+148|0;p=c[q>>2]|0;if((o&1<<r|0)==0){G=c[b+364>>2]|0;c[b+364>>2]=G+1;c[b+(G<<2)+348>>2]=p}else{c[b+((1-l|0)*36|0)+(c[b+((1-l|0)*36|0)+180>>2]<<2)+148>>2]=p;D=+g[h+8+(r<<2)>>2];G=c[b+((1-l|0)*36|0)+180>>2]|0;c[b+((1-l|0)*36|0)+180>>2]=G+1;g[b+((1-l|0)*36|0)+(G<<2)+164>>2]=D;G=c[q>>2]|0;E=D*+g[G+20>>2];F=D*+g[G+24>>2];g[b+128>>2]=+g[G+16>>2]*D+ +g[b+128>>2];g[b+132>>2]=E+ +g[b+132>>2];g[b+136>>2]=F+ +g[b+136>>2]}r=r+1|0}while((r|0)!=(y|0))}if((o|0)==15)c[b+376>>2]=1;if(!(f>>>0<128)){k=34;break}if((c[b+376>>2]|0)!=0)break;e=e+1&3;f=f+1|0}if((k|0)==5)c[b+376>>2]=1;else if((k|0)==9){G=c[b+368>>2]|0;z=(c[b+(G*36|0)+180>>2]|0)+ -1|0;c[b+(G*36|0)+180>>2]=z;z=c[b+(G*36|0)+(z<<2)+148>>2]|0;G=c[b+364>>2]|0;c[b+364>>2]=G+1;c[b+(G<<2)+348>>2]=z}else if((k|0)==11){G=c[b+368>>2]|0;z=(c[b+(G*36|0)+180>>2]|0)+ -1|0;c[b+(G*36|0)+180>>2]=z;z=c[b+(G*36|0)+(z<<2)+148>>2]|0;G=c[b+364>>2]|0;c[b+364>>2]=G+1;c[b+(G<<2)+348>>2]=z}else if((k|0)==32){G=c[b+368>>2]|0;z=(c[b+(G*36|0)+180>>2]|0)+ -1|0;c[b+(G*36|0)+180>>2]=z;z=c[b+(G*36|0)+(z<<2)+148>>2]|0;G=c[b+364>>2]|0;c[b+364>>2]=G+1;c[b+(G<<2)+348>>2]=z}else if((k|0)==34)c[b+376>>2]=2;c[b+372>>2]=b+((c[b+368>>2]|0)*36|0)+148;k=c[b+376>>2]|0;if((k|0)==1){g[b+144>>2]=0.0;i=h;return k|0}else if((k|0)==0){D=+g[b+128>>2];E=+g[b+132>>2];F=+g[b+136>>2];g[b+144>>2]=+Q(+(D*D+E*E+F*F));i=h;return k|0}else{i=h;return k|0}return 0}function FD(a){a=a|0;var b=0,d=0,e=0.0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0,n=0,o=0.0,p=0.0,q=0.0,r=0;b=i;i=i+32|0;d=c[a+372>>2]|0;m=c[d+32>>2]|0;a:do if((m|0)==2){n=c[d+4>>2]|0;d=c[d>>2]|0;h=+g[n+16>>2]- +g[d+16>>2];e=+g[n+20>>2]- +g[d+20>>2];f=+g[n+24>>2]- +g[d+24>>2];d=0;while(1){n=b+(d<<2)|0;c[b+0>>2]=0;c[b+4>>2]=0;c[b+8>>2]=0;c[b+12>>2]=0;g[n>>2]=1.0;j=+g[b+8>>2];k=+g[b+4>>2];l=+g[b>>2];if((e*j-f*k)*(e*j-f*k)+(f*l-h*j)*(f*l-h*j)+(h*k-e*l)*(h*k-e*l)>0.0){m=c[a+372>>2]|0;g[m+(c[m+32>>2]<<2)+16>>2]=0.0;n=(c[a+364>>2]|0)+ -1|0;c[a+364>>2]=n;c[m+(c[m+32>>2]<<2)>>2]=c[a+(n<<2)+348>>2];n=c[m+32>>2]|0;c[m+32>>2]=n+1;HD(a,e*j-f*k,f*l-h*j,h*k-e*l,c[m+(n<<2)>>2]|0);if(FD(a)|0){d=1;a=19;break}m=c[a+372>>2]|0;n=(c[m+32>>2]|0)+ -1|0;c[m+32>>2]=n;n=c[m+(n<<2)>>2]|0;m=c[a+364>>2]|0;c[a+364>>2]=m+1;c[a+(m<<2)+348>>2]=n;m=c[a+372>>2]|0;g[m+(c[m+32>>2]<<2)+16>>2]=0.0;n=(c[a+364>>2]|0)+ -1|0;c[a+364>>2]=n;c[m+(c[m+32>>2]<<2)>>2]=c[a+(n<<2)+348>>2];n=c[m+32>>2]|0;c[m+32>>2]=n+1;HD(a,-(e*j-f*k),-(f*l-h*j),-(h*k-e*l),c[m+(n<<2)>>2]|0);if(FD(a)|0){d=1;a=19;break}n=c[a+372>>2]|0;m=(c[n+32>>2]|0)+ -1|0;c[n+32>>2]=m;m=c[n+(m<<2)>>2]|0;n=c[a+364>>2]|0;c[a+364>>2]=n+1;c[a+(n<<2)+348>>2]=m}d=d+1|0;if(!(d>>>0<3))break a}if((a|0)==19){i=b;return d|0}}else if((m|0)==4){n=c[d>>2]|0;m=c[d+12>>2]|0;l=+g[m+16>>2];q=+g[n+16>>2]-l;o=+g[m+20>>2];e=+g[n+20>>2]-o;h=+g[m+24>>2];j=+g[n+24>>2]-h;n=c[d+4>>2]|0;f=+g[n+16>>2]-l;k=+g[n+20>>2]-o;p=+g[n+24>>2]-h;n=c[d+8>>2]|0;l=+g[n+16>>2]-l;o=+g[n+20>>2]-o;h=+g[n+24>>2]-h;if(!((0.0!=0.0?1:q*k*h+(e*p*l+j*f*o-q*p*o-e*f*h)-j*k*l!=q*k*h+(e*p*l+j*f*o-q*p*o-e*f*h)-j*k*l)|q*k*h+(e*p*l+j*f*o-q*p*o-e*f*h)-j*k*l==0.0)){n=1;i=b;return n|0}}else if((m|0)==3){n=c[d+4>>2]|0;m=c[d>>2]|0;f=+g[m+16>>2];e=+g[n+16>>2]-f;l=+g[m+20>>2];h=+g[n+20>>2]-l;j=+g[m+24>>2];k=+g[n+24>>2]-j;n=c[d+8>>2]|0;f=+g[n+16>>2]-f;l=+g[n+20>>2]-l;j=+g[n+24>>2]-j;if((h*j-k*l)*(h*j-k*l)+(k*f-e*j)*(k*f-e*j)+(e*l-h*f)*(e*l-h*f)>0.0){g[d+28>>2]=0.0;n=(c[a+364>>2]|0)+ -1|0;c[a+364>>2]=n;c[d+(c[d+32>>2]<<2)>>2]=c[a+(n<<2)+348>>2];n=c[d+32>>2]|0;c[d+32>>2]=n+1;HD(a,h*j-k*l,k*f-e*j,e*l-h*f,c[d+(n<<2)>>2]|0);if(FD(a)|0){n=1;i=b;return n|0}m=c[a+372>>2]|0;n=(c[m+32>>2]|0)+ -1|0;c[m+32>>2]=n;n=c[m+(n<<2)>>2]|0;m=c[a+364>>2]|0;c[a+364>>2]=m+1;c[a+(m<<2)+348>>2]=n;m=c[a+372>>2]|0;g[m+(c[m+32>>2]<<2)+16>>2]=0.0;n=(c[a+364>>2]|0)+ -1|0;c[a+364>>2]=n;c[m+(c[m+32>>2]<<2)>>2]=c[a+(n<<2)+348>>2];n=c[m+32>>2]|0;c[m+32>>2]=n+1;HD(a,-(h*j-k*l),-(k*f-e*j),-(e*l-h*f),c[m+(n<<2)>>2]|0);if(FD(a)|0){n=1;i=b;return n|0}else{n=c[a+372>>2]|0;m=(c[n+32>>2]|0)+ -1|0;c[n+32>>2]=m;m=c[n+(m<<2)>>2]|0;n=c[a+364>>2]|0;c[a+364>>2]=n+1;c[a+(n<<2)+348>>2]=m;break}}}else if((m|0)==1){n=1;m=0;while(1){r=b+16+(m<<2)|0;c[b+16>>2]=0;c[b+20>>2]=0;c[b+24>>2]=0;c[b+28>>2]=0;g[r>>2]=1.0;r=d+32|0;g[d+(n<<2)+16>>2]=0.0;n=(c[a+364>>2]|0)+ -1|0;c[a+364>>2]=n;c[d+(c[r>>2]<<2)>>2]=c[a+(n<<2)+348>>2];n=c[r>>2]|0;c[r>>2]=n+1;e=+g[b+16>>2];f=+g[b+20>>2];h=+g[b+24>>2];HD(a,e,f,h,c[d+(n<<2)>>2]|0);if(FD(a)|0){d=1;a=19;break}n=c[a+372>>2]|0;r=(c[n+32>>2]|0)+ -1|0;c[n+32>>2]=r;r=c[n+(r<<2)>>2]|0;n=c[a+364>>2]|0;c[a+364>>2]=n+1;c[a+(n<<2)+348>>2]=r;n=c[a+372>>2]|0;g[n+(c[n+32>>2]<<2)+16>>2]=0.0;r=(c[a+364>>2]|0)+ -1|0;c[a+364>>2]=r;c[n+(c[n+32>>2]<<2)>>2]=c[a+(r<<2)+348>>2];r=c[n+32>>2]|0;c[n+32>>2]=r+1;HD(a,-e,-f,-h,c[n+(r<<2)>>2]|0);if(FD(a)|0){d=1;a=19;break}r=c[a+372>>2]|0;n=(c[r+32>>2]|0)+ -1|0;c[r+32>>2]=n;n=c[r+(n<<2)>>2]|0;r=c[a+364>>2]|0;c[a+364>>2]=r+1;c[a+(r<<2)+348>>2]=n;m=m+1|0;if(!(m>>>0<3))break a;d=c[a+372>>2]|0;n=c[d+32>>2]|0}if((a|0)==19){i=b;return d|0}}while(0);r=0;i=b;return r|0}function GD(b,d,e,f,h){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0,k=0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0;k=i;j=c[b+9288>>2]|0;if((j|0)==0){c[b>>2]=5;s=0;i=k;return s|0}s=c[j+48>>2]|0;if((s|0)!=0)c[s+44>>2]=c[j+44>>2];s=c[j+44>>2]|0;if((s|0)!=0)c[s+48>>2]=c[j+48>>2];if((c[b+9288>>2]|0)==(j|0))c[b+9288>>2]=c[j+48>>2];c[b+9292>>2]=(c[b+9292>>2]|0)+ -1;c[j+44>>2]=0;c[j+48>>2]=c[b+9280>>2];s=c[b+9280>>2]|0;if((s|0)!=0)c[s+44>>2]=j;c[b+9280>>2]=j;c[b+9284>>2]=(c[b+9284>>2]|0)+1;a[j+55>>0]=0;c[j+20>>2]=d;c[j+24>>2]=e;c[j+28>>2]=f;p=+g[d+16>>2];n=+g[e+16>>2]-p;r=+g[d+20>>2];q=+g[e+20>>2]-r;m=+g[d+24>>2];l=+g[e+24>>2]-m;p=+g[f+16>>2]-p;r=+g[f+20>>2]-r;m=+g[f+24>>2]-m;g[j>>2]=q*m-l*r;g[j+4>>2]=l*p-n*m;g[j+8>>2]=n*r-q*p;g[j+12>>2]=0.0;o=+Q(+((q*m-l*r)*(q*m-l*r)+(l*p-n*m)*(l*p-n*m)+(n*r-q*p)*(n*r-q*p)));do if(o>9999999747378752.0e-20){if((!(JD(q*m-l*r,l*p-n*m,n*r-q*p,+g[d+16>>2],+g[d+20>>2],+g[d+24>>2],+g[e+16>>2],+g[e+20>>2],+g[e+24>>2],j+16|0)|0)?!(JD(+g[j>>2],+g[j+4>>2],+g[j+8>>2],+g[e+16>>2],+g[e+20>>2],+g[e+24>>2],+g[f+16>>2],+g[f+20>>2],+g[f+24>>2],j+16|0)|0):0)?!(JD(+g[j>>2],+g[j+4>>2],+g[j+8>>2],+g[f+16>>2],+g[f+20>>2],+g[f+24>>2],+g[d+16>>2],+g[d+20>>2],+g[d+24>>2],j+16|0)|0):0)g[j+16>>2]=(+g[d+16>>2]*+g[j>>2]+ +g[d+20>>2]*+g[j+4>>2]+ +g[d+24>>2]*+g[j+8>>2])/o;g[j>>2]=1.0/o*+g[j>>2];g[j+4>>2]=1.0/o*+g[j+4>>2];g[j+8>>2]=1.0/o*+g[j+8>>2];if(h){s=j;i=k;return s|0}if(!(+g[j+16>>2]>=-9999999747378752.0e-21)){c[b>>2]=3;break}else{s=j;i=k;return s|0}}else c[b>>2]=2;while(0);h=c[j+48>>2]|0;if((h|0)!=0)c[h+44>>2]=c[j+44>>2];h=c[j+44>>2]|0;if((h|0)!=0)c[h+48>>2]=c[j+48>>2];if((c[b+9280>>2]|0)==(j|0))c[b+9280>>2]=c[j+48>>2];c[b+9284>>2]=(c[b+9284>>2]|0)+ -1;c[j+44>>2]=0;c[j+48>>2]=c[b+9288>>2];h=c[b+9288>>2]|0;if((h|0)!=0)c[h+44>>2]=j;c[b+9288>>2]=j;c[b+9292>>2]=(c[b+9292>>2]|0)+1;s=0;i=k;return s|0}function HD(a,b,e,f,h){a=a|0;b=+b;e=+e;f=+f;h=h|0;var j=0,k=0,l=0,m=0,n=0.0,o=0.0;j=i;i=i+48|0;n=1.0/+Q(+(b*b+e*e+f*f));g[h>>2]=n*b;g[h+4>>2]=n*e;g[h+8>>2]=n*f;g[h+12>>2]=0.0;l=d[a+120>>0]|d[a+121>>0]<<8|d[a+122>>0]<<16|d[a+123>>0]<<24;m=d[a+124>>0]|d[a+125>>0]<<8|d[a+126>>0]<<16|d[a+127>>0]<<24;k=(c[a>>2]|0)+(m>>1)|0;if((m&1|0)!=0)l=c[(c[k>>2]|0)+l>>2]|0;rc[l&127](j,k,h);e=-+g[h>>2];f=-+g[h+4>>2];b=-+g[h+8>>2];l=d[a+120>>0]|d[a+121>>0]<<8|d[a+122>>0]<<16|d[a+123>>0]<<24;m=d[a+124>>0]|d[a+125>>0]<<8|d[a+126>>0]<<16|d[a+127>>0]<<24;k=(c[a+4>>2]|0)+(m>>1)|0;if((m&1|0)!=0)l=c[(c[k>>2]|0)+l>>2]|0;n=+g[a+24>>2]*e+ +g[a+28>>2]*f+ +g[a+32>>2]*b;o=+g[a+40>>2]*e+ +g[a+44>>2]*f+ +g[a+48>>2]*b;g[j+16>>2]=+g[a+8>>2]*e+ +g[a+12>>2]*f+ +g[a+16>>2]*b;g[j+20>>2]=n;g[j+24>>2]=o;g[j+28>>2]=0.0;rc[l&127](j+32|0,k,j+16|0);o=+g[j+32>>2];e=+g[j+36>>2];f=+g[j+40>>2];b=+g[j+4>>2]-(o*+g[a+72>>2]+e*+g[a+76>>2]+f*+g[a+80>>2]+ +g[a+108>>2]);n=+g[j+8>>2]-(o*+g[a+88>>2]+e*+g[a+92>>2]+f*+g[a+96>>2]+ +g[a+112>>2]);g[h+16>>2]=+g[j>>2]-(o*+g[a+56>>2]+e*+g[a+60>>2]+f*+g[a+64>>2]+ +g[a+104>>2]);g[h+20>>2]=b;g[h+24>>2]=n;g[h+28>>2]=0.0;i=j;return}function ID(b,e,f,h,j,k){b=b|0;e=e|0;f=f|0;h=h|0;j=j|0;k=k|0;var l=0,m=0;l=i;if((d[h+55>>0]|0|0)==(e|0)){j=0;i=l;return j|0}m=c[19552+(j<<2)>>2]|0;if(+g[h>>2]*+g[f+16>>2]+ +g[h+4>>2]*+g[f+20>>2]+ +g[h+8>>2]*+g[f+24>>2]- +g[h+16>>2]<-9999999747378752.0e-21){b=GD(b,c[h+(m<<2)+20>>2]|0,c[h+(j<<2)+20>>2]|0,f,0)|0;if((b|0)==0){j=0;i=l;return j|0}a[b+52>>0]=j;c[b+32>>2]=h;a[h+j+52>>0]=0;c[h+(j<<2)+32>>2]=b;h=c[k>>2]|0;if((h|0)==0)c[k+4>>2]=b;else{a[h+53>>0]=2;c[h+36>>2]=b;a[b+54>>0]=1;c[b+40>>2]=h}c[k>>2]=b;c[k+8>>2]=(c[k+8>>2]|0)+1;j=1;i=l;return j|0}j=c[19536+(j<<2)>>2]|0;a[h+55>>0]=e;if(!(ID(b,e,f,c[h+(m<<2)+32>>2]|0,d[h+m+52>>0]|0,k)|0)){j=0;i=l;return j|0}if(!(ID(b,e,f,c[h+(j<<2)+32>>2]|0,d[h+j+52>>0]|0,k)|0)){j=0;i=l;return j|0}k=c[h+48>>2]|0;if((k|0)!=0)c[k+44>>2]=c[h+44>>2];k=c[h+44>>2]|0;if((k|0)!=0)c[k+48>>2]=c[h+48>>2];if((c[b+9280>>2]|0)==(h|0))c[b+9280>>2]=c[h+48>>2];c[b+9284>>2]=(c[b+9284>>2]|0)+ -1;c[h+44>>2]=0;c[h+48>>2]=c[b+9288>>2];k=c[b+9288>>2]|0;if((k|0)!=0)c[k+44>>2]=h;c[b+9288>>2]=h;c[b+9292>>2]=(c[b+9292>>2]|0)+1;j=1;i=l;return j|0}function JD(a,b,c,d,e,f,h,j,k,l){a=+a;b=+b;c=+c;d=+d;e=+e;f=+f;h=+h;j=+j;k=+k;l=l|0;var m=0;m=i;if(!(((h-d)*b-(j-e)*a)*f+(((j-e)*c-(k-f)*b)*d+((k-f)*a-(h-d)*c)*e)<0.0)){l=0;i=m;return l|0}if((h-d)*d+(j-e)*e+(k-f)*f>0.0){g[l>>2]=+Q(+(d*d+e*e+f*f));l=1;i=m;return l|0}if((h-d)*h+(j-e)*j+(k-f)*k<0.0){g[l>>2]=+Q(+(h*h+j*j+k*k));l=1;i=m;return l|0}else{b=((h*h+j*j+k*k)*(d*d+e*e+f*f)-(h*d+j*e+k*f)*(h*d+j*e+k*f))/((h-d)*(h-d)+(j-e)*(j-e)+(k-f)*(k-f));g[l>>2]=+Q(+(b>0.0?b:0.0));l=1;i=m;return l|0}return 0}function KD(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0.0,h=0.0,j=0.0,k=0,l=0.0,m=0.0,n=0.0;k=i;l=+g[a>>2];f=+g[b>>2]-l;m=+g[a+4>>2];h=+g[b+4>>2]-m;n=+g[a+8>>2];j=+g[b+8>>2]-n;if(!(f*f+h*h+j*j>0.0)){n=-1.0;i=k;return+n}l=-(l*f+m*h+n*j)/(f*f+h*h+j*j);if(l>=1.0){g[d>>2]=0.0;g[d+4>>2]=1.0;c[e>>2]=2;l=+g[b>>2];m=+g[b+4>>2];n=+g[b+8>>2];n=l*l+m*m+n*n;i=k;return+n}if(!(l<=0.0)){g[d+4>>2]=l;g[d>>2]=1.0-l;c[e>>2]=3;f=f*l+ +g[a>>2];m=h*l+ +g[a+4>>2];n=j*l+ +g[a+8>>2];n=f*f+m*m+n*n;i=k;return+n}else{g[d>>2]=1.0;g[d+4>>2]=0.0;c[e>>2]=1;l=+g[a>>2];m=+g[a+4>>2];n=+g[a+8>>2];n=l*l+m*m+n*n;i=k;return+n}return 0.0}function LD(a,b,d,e,f){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;var h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0,v=0,w=0.0,x=0.0,y=0.0,z=0,A=0.0,B=0.0,C=0.0,D=0.0,E=0,F=0.0;u=i;i=i+80|0;c[u+64>>2]=a;c[u+68>>2]=b;c[u+72>>2]=d;r=+g[a>>2];l=+g[b>>2];s=+g[a+4>>2];n=+g[b+4>>2];t=+g[a+8>>2];p=+g[b+8>>2];g[u+16>>2]=r-l;g[u+20>>2]=s-n;g[u+24>>2]=t-p;g[u+28>>2]=0.0;m=+g[d>>2];o=+g[d+4>>2];q=+g[d+8>>2];g[u+32>>2]=l-m;g[u+36>>2]=n-o;g[u+40>>2]=p-q;g[u+44>>2]=0.0;g[u+48>>2]=m-r;g[u+52>>2]=o-s;g[u+56>>2]=q-t;g[u+60>>2]=0.0;j=(s-n)*(p-q)-(t-p)*(n-o);k=(t-p)*(l-m)-(p-q)*(r-l);h=(n-o)*(r-l)-(s-n)*(l-m);if(!(h*h+(j*j+k*k)>0.0)){F=-1.0;i=u;return+F}c[u>>2]=0;c[u+4>>2]=0;c[u+8>>2]=0;B=s-n;D=t-p;C=r-l;x=r;y=s;A=t;z=a;E=0;F=-1.0;while(1){if(x*(h*B-k*D)+y*(j*D-h*C)+(k*C-j*B)*A>0.0?(v=c[19552+(E<<2)>>2]|0,w=+KD(z,c[u+64+(v<<2)>>2]|0,u,u+8|0),F<0.0|w<F):0){z=c[u+8>>2]|0;c[f>>2]=((z&1|0)==0?0:1<<E)+((z&2|0)==0?0:1<<v);g[e+(E<<2)>>2]=+g[u>>2];g[e+(v<<2)>>2]=+g[u+4>>2];g[e+(c[19552+(v<<2)>>2]<<2)>>2]=0.0;F=w}E=E+1|0;if((E|0)==3)break;z=c[u+64+(E<<2)>>2]|0;B=+g[u+16+(E<<4)+4>>2];D=+g[u+16+(E<<4)+8>>2];C=+g[u+16+(E<<4)>>2];x=+g[z>>2];y=+g[z+4>>2];A=+g[z+8>>2]}if(!(F<0.0)){i=u;return+F}C=+Q(+(h*h+(j*j+k*k)));F=(j*+g[a>>2]+k*+g[a+4>>2]+h*+g[a+8>>2])/(h*h+(j*j+k*k));c[f>>2]=7;A=+g[b>>2]-j*F;y=+g[b+4>>2]-k*F;D=+g[b+8>>2]-h*F;D=+Q(+((y*(l-m)-A*(n-o))*(y*(l-m)-A*(n-o))+(((n-o)*D-y*(p-q))*((n-o)*D-y*(p-q))+(A*(p-q)-D*(l-m))*(A*(p-q)-D*(l-m)))))/C;g[e>>2]=D;A=+g[d>>2]-j*F;y=+g[d+4>>2]-k*F;B=+g[d+8>>2]-h*F;C=+Q(+((y*(m-r)-A*(o-s))*(y*(m-r)-A*(o-s))+(((o-s)*B-y*(q-t))*((o-s)*B-y*(q-t))+(A*(q-t)-B*(m-r))*(A*(q-t)-B*(m-r)))))/C;g[e+4>>2]=C;g[e+8>>2]=1.0-(C+D);F=h*F*h*F+(j*F*j*F+k*F*k*F);i=u;return+F}function MD(b){b=b|0;var d=0,e=0,f=0,g=0,h=0,j=0,k=0,l=0;e=i;f=c[b+12>>2]|0;d=c[b+32>>2]|0;if((d|0)>=(f|0)){i=e;return}if((d|0)<=(f|0)){if((c[b+36>>2]|0)<(f|0)){if((f|0)==0){g=0;j=d}else{c[5004]=(c[5004]|0)+1;g=XE((f<<2|3)+16|0)|0;if((g|0)==0)g=0;else{c[(g+19&-16)+ -4>>2]=g;g=g+19&-16}j=c[b+32>>2]|0}if((j|0)>0){h=0;do{k=g+(h<<2)|0;if((k|0)!=0)c[k>>2]=c[(c[b+40>>2]|0)+(h<<2)>>2];h=h+1|0}while((h|0)!=(j|0))}h=c[b+40>>2]|0;if((h|0)!=0){if((a[b+44>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[b+40>>2]=0}a[b+44>>0]=1;c[b+40>>2]=g;c[b+36>>2]=f}else g=c[b+40>>2]|0;h=d;do{j=g+(h<<2)|0;if((j|0)!=0)c[j>>2]=0;h=h+1|0}while((h|0)!=(f|0))}c[b+32>>2]=f;g=c[b+52>>2]|0;if((g|0)<(f|0)){if((c[b+56>>2]|0)<(f|0)){if((f|0)==0){h=0;j=g}else{c[5004]=(c[5004]|0)+1;h=XE((f<<2|3)+16|0)|0;if((h|0)==0)h=0;else{c[(h+19&-16)+ -4>>2]=h;h=h+19&-16}j=c[b+52>>2]|0}if((j|0)>0){k=0;do{l=h+(k<<2)|0;if((l|0)!=0)c[l>>2]=c[(c[b+60>>2]|0)+(k<<2)>>2];k=k+1|0}while((k|0)!=(j|0))}j=c[b+60>>2]|0;if((j|0)!=0){if((a[b+64>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0)}c[b+60>>2]=0}a[b+64>>0]=1;c[b+60>>2]=h;c[b+56>>2]=f}else h=c[b+60>>2]|0;do{j=h+(g<<2)|0;if((j|0)!=0)c[j>>2]=0;g=g+1|0}while((g|0)!=(f|0))}c[b+52>>2]=f;if((f|0)>0){$E(c[b+40>>2]|0,-1,f<<2|0)|0;$E(c[b+60>>2]|0,-1,f<<2|0)|0}if((d|0)<=0){i=e;return}h=c[b+16>>2]|0;g=c[b+40>>2]|0;f=c[b+60>>2]|0;j=0;do{l=c[h+(j*12|0)+4>>2]<<16|c[h+(j*12|0)>>2];l=(l+~(l<<15)>>10^l+~(l<<15))*9|0;l=g+((((l>>6^l)+~((l>>6^l)<<11)>>16^(l>>6^l)+~((l>>6^l)<<11))&(c[b+12>>2]|0)+ -1)<<2)|0;c[f+(j<<2)>>2]=c[l>>2];c[l>>2]=j;j=j+1|0}while((j|0)!=(d|0));i=e;return}function ND(a){a=a|0;var b=0;b=i;OD(a);YE(a);i=b;return}function OD(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=19600;e=c[b+60>>2]|0;if((e|0)!=0){if((a[b+64>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+60>>2]=0}a[b+64>>0]=1;c[b+60>>2]=0;c[b+52>>2]=0;c[b+56>>2]=0;e=c[b+40>>2]|0;if((e|0)!=0){if((a[b+44>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+40>>2]=0}a[b+44>>0]=1;c[b+40>>2]=0;c[b+32>>2]=0;c[b+36>>2]=0;e=c[b+16>>2]|0;if((e|0)==0){a[b+20>>0]=1;c[b+16>>2]=0;c[b+8>>2]=0;e=b+12|0;c[e>>2]=0;i=d;return}if((a[b+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+16>>2]=0;a[b+20>>0]=1;c[b+16>>2]=0;c[b+8>>2]=0;e=b+12|0;c[e>>2]=0;i=d;return}function PD(b){b=b|0;var d=0,e=0,f=0,g=0,h=0,j=0;d=i;e=c[b+16>>2]|0;if((e|0)!=0){if((a[b+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+16>>2]=0}a[b+20>>0]=1;c[b+16>>2]=0;c[b+8>>2]=0;c[b+12>>2]=0;e=c[b+40>>2]|0;if((e|0)!=0){if((a[b+44>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+40>>2]=0}a[b+44>>0]=1;c[b+40>>2]=0;c[b+32>>2]=0;c[b+36>>2]=0;e=c[b+60>>2]|0;if((e|0)!=0){if((a[b+64>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+60>>2]=0}a[b+64>>0]=1;c[b+60>>2]=0;c[b+52>>2]=0;c[b+56>>2]=0;if((c[b+12>>2]|0)>=2){MD(b);i=d;return}c[5004]=(c[5004]|0)+1;e=XE(43)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}f=c[b+8>>2]|0;if((f|0)>0){h=0;do{g=e+(h*12|0)|0;if((g|0)!=0){j=(c[b+16>>2]|0)+(h*12|0)|0;c[g+0>>2]=c[j+0>>2];c[g+4>>2]=c[j+4>>2];c[g+8>>2]=c[j+8>>2]}h=h+1|0}while((h|0)!=(f|0))}f=c[b+16>>2]|0;if((f|0)!=0){if((a[b+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}c[b+16>>2]=0}a[b+20>>0]=1;c[b+16>>2]=e;c[b+12>>2]=2;MD(b);i=d;return}function QD(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0;e=i;c[4892]=(c[4892]|0)+1;k=((d<<16|b)+~((d<<16|b)<<15)>>10^(d<<16|b)+~((d<<16|b)<<15))*9|0;g=c[a+40>>2]|0;k=g+(((c[a+12>>2]|0)+ -1&((k>>6^k)+~((k>>6^k)<<11)>>16^(k>>6^k)+~((k>>6^k)<<11)))<<2)|0;l=c[k>>2]|0;if((l|0)==-1){o=0;i=e;return o|0}h=c[a+16>>2]|0;j=l;while(1){if((c[h+(j*12|0)>>2]|0)==(b|0)?(c[h+(j*12|0)+4>>2]|0)==(d|0):0)break;j=c[(c[a+60>>2]|0)+(j<<2)>>2]|0;if((j|0)==-1){a=0;f=22;break}}if((f|0)==22){i=e;return a|0}if((h+(j*12|0)|0)==0){o=0;i=e;return o|0}b=c[h+(j*12|0)+8>>2]|0;j=(j*12|0)/12|0;d=c[a+60>>2]|0;if((l|0)!=(j|0)){while(1){m=d+(l<<2)|0;n=c[m>>2]|0;if((n|0)==(j|0))break;else l=n}n=c[d+(j<<2)>>2]|0;if((l|0)==-1)f=12;else c[m>>2]=n}else{n=c[d+(l<<2)>>2]|0;f=12}if((f|0)==12)c[k>>2]=n;l=(c[a+8>>2]|0)+ -1|0;if((l|0)==(j|0)){c[a+8>>2]=j;o=b;i=e;return o|0}k=c[h+(l*12|0)+4>>2]<<16|c[h+(l*12|0)>>2];k=(k+~(k<<15)>>10^k+~(k<<15))*9|0;k=((k>>6^k)+~((k>>6^k)<<11)>>16^(k>>6^k)+~((k>>6^k)<<11))&(c[a+12>>2]|0)+ -1;n=c[g+(k<<2)>>2]|0;if((n|0)!=(l|0)){while(1){m=d+(n<<2)|0;o=c[m>>2]|0;if((o|0)==(l|0))break;else n=o}d=c[d+(l<<2)>>2]|0;if((n|0)==-1)f=20;else c[m>>2]=d}else{d=c[d+(l<<2)>>2]|0;f=20}if((f|0)==20)c[g+(k<<2)>>2]=d;c[h+(j*12|0)+0>>2]=c[h+(l*12|0)+0>>2];c[h+(j*12|0)+4>>2]=c[h+(l*12|0)+4>>2];c[h+(j*12|0)+8>>2]=c[h+(l*12|0)+8>>2];o=(c[a+40>>2]|0)+(k<<2)|0;c[(c[a+60>>2]|0)+(j<<2)>>2]=c[o>>2];c[o>>2]=j;c[a+8>>2]=(c[a+8>>2]|0)+ -1;o=b;i=e;return o|0}function RD(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0;f=i;c[4894]=(c[4894]|0)+1;h=((e<<16|d)+~((e<<16|d)<<15)>>10^(e<<16|d)+~((e<<16|d)<<15))*9|0;h=(h>>6^h)+~((h>>6^h)<<11)>>16^(h>>6^h)+~((h>>6^h)<<11);g=c[b+12>>2]|0;k=c[(c[b+40>>2]|0)+((g+ -1&h)<<2)>>2]|0;a:do if(!((k|0)==-1)){j=c[b+16>>2]|0;while(1){if((c[j+(k*12|0)>>2]|0)==(d|0)?(c[j+(k*12|0)+4>>2]|0)==(e|0):0)break;k=c[(c[b+60>>2]|0)+(k<<2)>>2]|0;if((k|0)==-1)break a}j=j+(k*12|0)|0;if((j|0)!=0){o=j;i=f;return o|0}}while(0);j=c[b+8>>2]|0;if((j|0)==(g|0)){k=(g|0)==0?1:g<<1;if((g|0)<(k|0)){if((k|0)==0){l=0;o=g}else{c[5004]=(c[5004]|0)+1;l=XE((k*12|3)+16|0)|0;if((l|0)==0)l=0;else{c[(l+19&-16)+ -4>>2]=l;l=l+19&-16}o=c[b+8>>2]|0}if((o|0)>0){n=0;do{m=l+(n*12|0)|0;if((m|0)!=0){p=(c[b+16>>2]|0)+(n*12|0)|0;c[m+0>>2]=c[p+0>>2];c[m+4>>2]=c[p+4>>2];c[m+8>>2]=c[p+8>>2]}n=n+1|0}while((n|0)!=(o|0))}m=c[b+16>>2]|0;if((m|0)!=0){if((a[b+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[m+ -4>>2]|0)}c[b+16>>2]=0}a[b+20>>0]=1;c[b+16>>2]=l;c[b+12>>2]=k;l=c[b+8>>2]|0}else{l=g;k=g}}else{l=j;k=g}c[b+8>>2]=l+1;l=c[b+16>>2]|0;if((g|0)<(k|0)){MD(b);g=(c[b+12>>2]|0)+ -1&h}else g=g+ -1&h;if((l+(j*12|0)|0)==0)d=0;else{c[l+(j*12|0)>>2]=d;c[l+(j*12|0)+4>>2]=e;c[l+(j*12|0)+8>>2]=0;d=l+(j*12|0)|0}c[d+8>>2]=0;p=(c[b+40>>2]|0)+(g<<2)|0;c[(c[b+60>>2]|0)+(j<<2)>>2]=c[p>>2];c[p>>2]=j;p=d;i=f;return p|0}function SD(a){a=a|0;return c[a+16>>2]|0}function TD(a,b,c,d,e,f,h,j,k,l,m){a=a|0;b=b|0;c=+c;d=+d;e=+e;f=+f;h=+h;j=+j;k=k|0;l=l|0;m=+m;var n=0.0,o=0.0,p=0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0;p=i;o=+g[a>>2]*f+ +g[a+16>>2]*h+ +g[a+32>>2]*j;n=+g[a+4>>2]*f+ +g[a+20>>2]*h+ +g[a+36>>2]*j;r=+g[a+8>>2]*f+ +g[a+24>>2]*h+ +g[a+40>>2]*j;q=+g[b>>2]*f+ +g[b+16>>2]*h+ +g[b+32>>2]*j;s=+g[b+4>>2]*f+ +g[b+20>>2]*h+ +g[b+36>>2]*j;t=+g[b+8>>2]*f+ +g[b+24>>2]*h+ +g[b+40>>2]*j;u=+g[k+80>>2];if(o<0.0)u=-u;v=+g[k+84>>2];if(n<0.0)v=-v;w=+g[k+88>>2];if(r<0.0)w=-w;x=+g[l+80>>2];if(q<0.0)x=-x;y=+g[l+84>>2];if(s<0.0)y=-y;z=+g[l+88>>2];if(!(t<0.0)){A=z;z=o*u;v=n*v;v=z+v;z=r*w;z=v+z;x=q*x;y=s*y;y=x+y;x=t*A;x=y+x;a=k+96|0;y=+g[a>>2];a=z>y;y=a?z:y;a=l+96|0;z=+g[a>>2];a=x>z;z=a?x:z;z=y+z;y=c*f+d*h+e*j+z;z=z-(c*f+d*h+e*j);a=y<z;z=a?y:z;a=!(z>m);i=p;return a|0}B=-z;A=o*u;z=n*v;z=A+z;A=r*w;A=z+A;x=q*x;z=s*y;z=x+z;y=t*B;y=z+y;a=k+96|0;z=+g[a>>2];a=A>z;z=a?A:z;a=l+96|0;A=+g[a>>2];a=y>A;A=a?y:A;A=z+A;z=c*f+d*h+e*j+A;A=A-(c*f+d*h+e*j);a=z<A;A=a?z:A;a=!(A>m);i=p;return a|0}function UD(b,d,e,f,h,j,k){b=b|0;d=d|0;e=e|0;f=f|0;h=+h;j=+j;k=k|0;var l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0,G=0.0,H=0,I=0,J=0,K=0,L=0,M=0,N=0.0,O=0.0,P=0.0,Q=0.0,R=0,S=0.0,T=0.0,U=0.0,V=0.0,W=0,X=0,Y=0,Z=0.0,_=0.0,$=0.0,aa=0.0,ba=0.0,ca=0,da=0;l=i;i=i+64|0;a[l+48>>0]=1;c[l+44>>2]=0;c[l+36>>2]=0;c[l+40>>2]=0;m=c[f+4>>2]|0;if((m|0)>0){c[5004]=(c[5004]|0)+1;n=XE((m<<4|3)+16|0)|0;if((n|0)==0)u=0;else{c[(n+19&-16)+ -4>>2]=n;u=n+19&-16}a[l+48>>0]=1;c[l+44>>2]=u;c[l+40>>2]=m}else u=0;t=c[d+28>>2]|0;if((t|0)>0){n=c[d+36>>2]|0;G=+g[e>>2];N=+g[e+4>>2];O=+g[e+8>>2];E=+g[e+16>>2];D=+g[e+20>>2];C=+g[e+24>>2];B=+g[e+32>>2];A=+g[e+36>>2];z=+g[e+40>>2];V=+g[b>>2];U=+g[b+4>>2];Z=+g[b+8>>2];m=-1;T=3.4028234663852886e+38;v=0;while(1){S=+g[n+(v*36|0)+20>>2];Q=+g[n+(v*36|0)+24>>2];P=+g[n+(v*36|0)+28>>2];s=(S*G+Q*N+P*O)*V+(S*E+Q*D+P*C)*U+(S*B+Q*A+P*z)*Z<T;m=s?v:m;v=v+1|0;if((v|0)>=(t|0))break;else T=s?(S*G+Q*N+P*O)*V+(S*E+Q*D+P*C)*U+(S*B+Q*A+P*z)*Z:T}if((m|0)>=0){v=c[n+(m*36|0)+4>>2]|0;if((v|0)>0){w=n+(m*36|0)+12|0;s=n+(m*36|0)+20|0;u=n+(m*36|0)+24|0;t=n+(m*36|0)+28|0;P=E;Q=D;S=C;T=B;U=A;V=z;y=l+32|0;x=0;while(1){F=c[w>>2]|0;Y=c[F+(x<<2)>>2]|0;M=c[d+16>>2]|0;x=x+1|0;F=c[F+(((x|0)==(v|0)?0:x)<<2)>>2]|0;$=+g[M+(Y<<4)>>2];aa=$- +g[M+(F<<4)>>2];_=+g[M+(Y<<4)+4>>2];ba=_- +g[M+(F<<4)+4>>2];Z=+g[M+(Y<<4)+8>>2];C=Z- +g[M+(F<<4)+8>>2];B=aa*G+ba*N+C*O;A=aa*P+ba*Q+C*S;C=aa*T+ba*U+C*V;ba=+g[s>>2];aa=+g[u>>2];z=+g[t>>2];E=G*ba+N*aa+O*z;D=P*ba+Q*aa+S*z;z=T*ba+U*aa+V*z;G=($*G+_*N+Z*O+ +g[e+48>>2])*-(A*z-C*D)+($*P+_*Q+Z*S+ +g[e+52>>2])*-(C*E-B*z)+($*T+_*U+Z*V+ +g[e+56>>2])*-(B*D-A*E);F=f+4|0;M=c[F>>2]|0;if((M|0)>=2){L=f+12|0;W=c[L>>2]|0;aa=+g[W+(M+ -1<<4)>>2];ba=+g[W+(M+ -1<<4)+4>>2];Z=+g[W+(M+ -1<<4)+8>>2];J=y+4|0;H=y+8|0;K=y+12|0;I=y+16|0;T=aa;U=ba;V=Z;Z=aa*-(A*z-C*D)+ba*-(C*E-B*z)+Z*-(B*D-A*E)-G;R=0;while(1){O=+g[W+(R<<4)>>2];P=+g[W+(R<<4)+4>>2];Q=+g[W+(R<<4)+8>>2];S=+g[W+(R<<4)+12>>2];N=O*-(A*z-C*D)+P*-(C*E-B*z)+Q*-(B*D-A*E)-G;do if(Z<0.0)if(N<0.0){X=c[J>>2]|0;if((X|0)==(c[H>>2]|0)?(r=(X|0)==0?1:X<<1,(X|0)<(r|0)):0){if((r|0)==0)W=0;else{c[5004]=(c[5004]|0)+1;W=XE((r<<4|3)+16|0)|0;if((W|0)==0)W=0;else{c[(W+19&-16)+ -4>>2]=W;W=W+19&-16}X=c[J>>2]|0}if((X|0)>0){Y=0;do{ca=W+(Y<<4)|0;da=(c[K>>2]|0)+(Y<<4)|0;c[ca+0>>2]=c[da+0>>2];c[ca+4>>2]=c[da+4>>2];c[ca+8>>2]=c[da+8>>2];c[ca+12>>2]=c[da+12>>2];Y=Y+1|0}while((Y|0)!=(X|0))}X=c[K>>2]|0;if((X|0)!=0){if((a[I>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[X+ -4>>2]|0)}c[K>>2]=0}a[I>>0]=1;c[K>>2]=W;c[H>>2]=r;X=c[J>>2]|0}da=c[K>>2]|0;g[da+(X<<4)>>2]=O;g[da+(X<<4)+4>>2]=P;g[da+(X<<4)+8>>2]=Q;g[da+(X<<4)+12>>2]=S;c[J>>2]=(c[J>>2]|0)+1;break}else{ba=Z/(Z-N);S=T+(O-T)*ba;T=U+(P-U)*ba;U=V+(Q-V)*ba;Y=c[J>>2]|0;if((Y|0)==(c[H>>2]|0)?(p=(Y|0)==0?1:Y<<1,(Y|0)<(p|0)):0){if((p|0)==0)W=0;else{c[5004]=(c[5004]|0)+1;W=XE((p<<4|3)+16|0)|0;if((W|0)==0)W=0;else{c[(W+19&-16)+ -4>>2]=W;W=W+19&-16}Y=c[J>>2]|0}if((Y|0)>0){X=0;do{da=W+(X<<4)|0;ca=(c[K>>2]|0)+(X<<4)|0;c[da+0>>2]=c[ca+0>>2];c[da+4>>2]=c[ca+4>>2];c[da+8>>2]=c[ca+8>>2];c[da+12>>2]=c[ca+12>>2];X=X+1|0}while((X|0)!=(Y|0))}X=c[K>>2]|0;if((X|0)!=0){if((a[I>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[X+ -4>>2]|0)}c[K>>2]=0}a[I>>0]=1;c[K>>2]=W;c[H>>2]=p;Y=c[J>>2]|0}da=c[K>>2]|0;g[da+(Y<<4)>>2]=S;g[da+(Y<<4)+4>>2]=T;g[da+(Y<<4)+8>>2]=U;g[da+(Y<<4)+12>>2]=0.0;c[J>>2]=(c[J>>2]|0)+1;break}else if(N<0.0){ba=Z/(Z-N);T=T+(O-T)*ba;U=U+(P-U)*ba;V=V+(Q-V)*ba;X=c[J>>2]|0;if((X|0)==(c[H>>2]|0)?(o=(X|0)==0?1:X<<1,(X|0)<(o|0)):0){if((o|0)==0)W=0;else{c[5004]=(c[5004]|0)+1;W=XE((o<<4|3)+16|0)|0;if((W|0)==0)W=0;else{c[(W+19&-16)+ -4>>2]=W;W=W+19&-16}X=c[J>>2]|0}if((X|0)>0){Y=0;do{da=W+(Y<<4)|0;ca=(c[K>>2]|0)+(Y<<4)|0;c[da+0>>2]=c[ca+0>>2];c[da+4>>2]=c[ca+4>>2];c[da+8>>2]=c[ca+8>>2];c[da+12>>2]=c[ca+12>>2];Y=Y+1|0}while((Y|0)!=(X|0))}X=c[K>>2]|0;if((X|0)!=0){if((a[I>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[X+ -4>>2]|0)}c[K>>2]=0}a[I>>0]=1;c[K>>2]=W;c[H>>2]=o;X=c[J>>2]|0}da=c[K>>2]|0;g[da+(X<<4)>>2]=T;g[da+(X<<4)+4>>2]=U;g[da+(X<<4)+8>>2]=V;g[da+(X<<4)+12>>2]=0.0;X=(c[J>>2]|0)+1|0;c[J>>2]=X;if((X|0)==(c[H>>2]|0)?(q=(X|0)==0?1:X<<1,(X|0)<(q|0)):0){if((q|0)==0)W=0;else{c[5004]=(c[5004]|0)+1;W=XE((q<<4|3)+16|0)|0;if((W|0)==0)W=0;else{c[(W+19&-16)+ -4>>2]=W;W=W+19&-16}X=c[J>>2]|0}if((X|0)>0){Y=0;do{da=W+(Y<<4)|0;ca=(c[K>>2]|0)+(Y<<4)|0;c[da+0>>2]=c[ca+0>>2];c[da+4>>2]=c[ca+4>>2];c[da+8>>2]=c[ca+8>>2];c[da+12>>2]=c[ca+12>>2];Y=Y+1|0}while((Y|0)!=(X|0))}X=c[K>>2]|0;if((X|0)!=0){if((a[I>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[X+ -4>>2]|0)}c[K>>2]=0}a[I>>0]=1;c[K>>2]=W;c[H>>2]=q;X=c[J>>2]|0}da=c[K>>2]|0;g[da+(X<<4)>>2]=O;g[da+(X<<4)+4>>2]=P;g[da+(X<<4)+8>>2]=Q;g[da+(X<<4)+12>>2]=S;c[J>>2]=(c[J>>2]|0)+1}while(0);R=R+1|0;if((R|0)==(M|0))break;W=c[L>>2]|0;T=O;U=P;V=Q;Z=N}M=c[F>>2]|0}if((M|0)<0){K=f+8|0;H=f+12|0;if((c[K>>2]|0)<0){I=c[H>>2]|0;J=f+16|0;if((I|0)!=0){if((a[J>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[I+ -4>>2]|0)}c[H>>2]=0}a[J>>0]=1;c[H>>2]=0;c[K>>2]=0}do{da=(c[H>>2]|0)+(M<<4)|0;c[da+0>>2]=c[l+16>>2];c[da+4>>2]=c[l+20>>2];c[da+8>>2]=c[l+24>>2];c[da+12>>2]=c[l+28>>2];M=M+1|0}while((M|0)!=0)}c[F>>2]=0;G=+g[e>>2];N=+g[e+4>>2];O=+g[e+8>>2];E=+g[e+16>>2];D=+g[e+20>>2];C=+g[e+24>>2];B=+g[e+32>>2];A=+g[e+36>>2];z=+g[e+40>>2];if((x|0)>=(v|0)){f=y;o=e+48|0;d=e+52|0;e=e+56|0;break}else{da=y;P=E;Q=D;S=C;T=B;U=A;V=z;y=f;f=da}}}else{u=n+(m*36|0)+24|0;t=n+(m*36|0)+28|0;o=e+48|0;d=e+52|0;e=e+56|0;s=n+(m*36|0)+20|0}$=+g[s>>2];aa=+g[u>>2];ba=+g[t>>2];G=$*G+aa*N+ba*O;C=$*E+aa*D+ba*C;z=$*B+aa*A+ba*z;A=+g[n+(m*36|0)+32>>2]-(G*+g[o>>2]+C*+g[d>>2]+z*+g[e>>2]);m=f+4|0;d=c[m>>2]|0;if((d|0)>0){n=f+12|0;e=0;do{da=c[n>>2]|0;o=da+(e<<4)|0;B=A+(G*+g[o>>2]+C*+g[da+(e<<4)+4>>2]+z*+g[da+(e<<4)+8>>2]);B=!(B<=h)?B:h;if(B<=j){c[l+0>>2]=c[o+0>>2];c[l+4>>2]=c[o+4>>2];c[l+8>>2]=c[o+8>>2];c[l+12>>2]=c[o+12>>2];qc[c[(c[k>>2]|0)+16>>2]&15](k,b,l,B);d=c[m>>2]|0}e=e+1|0}while((e|0)<(d|0))}u=c[l+44>>2]|0}}if((u|0)==0){i=l;return}if((a[l+48>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[u+ -4>>2]|0)}c[l+44>>2]=0;i=l;return}function VD(a,b,f,j){a=a|0;b=b|0;f=f|0;j=j|0;var k=0.0,l=0.0,m=0.0,n=0,o=0,p=0.0,q=0.0,r=0,s=0,t=0,u=0,v=0;n=i;i=i+80|0;f=Pb[c[(c[a>>2]|0)+28>>2]&127](a)|0;m=+g[a+4>>2];k=+g[a+8>>2];l=+g[a+12>>2];if((f|0)<=0){i=n;return}j=0;do{fc[c[(c[a>>2]|0)+16>>2]&3](a,n+76|0,n+52|0,n+64|0,n+56|0,n+72|0,n+68|0,n+48|0,n+60|0,j);o=c[n+64>>2]|0;do if((o|0)==1){o=c[n+60>>2]|0;if((o|0)==3){if((c[n+48>>2]|0)>0)o=0;else break;do{u=c[n+72>>2]|0;t=aa(c[n+68>>2]|0,o)|0;s=c[n+76>>2]|0;r=c[n+56>>2]|0;v=aa(e[u+t>>1]|0,r)|0;q=k*+h[s+(v+8)>>3];p=l*+h[s+(v+16)>>3];g[n>>2]=m*+h[s+v>>3];g[n+4>>2]=q;g[n+8>>2]=p;g[n+12>>2]=0.0;v=aa(e[u+(t+2)>>1]|0,r)|0;p=k*+h[s+(v+8)>>3];q=l*+h[s+(v+16)>>3];g[n+16>>2]=m*+h[s+v>>3];g[n+20>>2]=p;g[n+24>>2]=q;g[n+28>>2]=0.0;r=aa(e[u+(t+4)>>1]|0,r)|0;q=k*+h[s+(r+8)>>3];p=l*+h[s+(r+16)>>3];g[n+32>>2]=m*+h[s+r>>3];g[n+36>>2]=q;g[n+40>>2]=p;g[n+44>>2]=0.0;vc[c[(c[b>>2]|0)+8>>2]&127](b,n,j,o);o=o+1|0}while((o|0)<(c[n+48>>2]|0))}else if((o|0)==5){if((c[n+48>>2]|0)>0)o=0;else break;do{s=c[n+72>>2]|0;t=aa(c[n+68>>2]|0,o)|0;u=c[n+76>>2]|0;v=c[n+56>>2]|0;r=aa(d[s+t>>0]|0,v)|0;p=k*+h[u+(r+8)>>3];q=l*+h[u+(r+16)>>3];g[n>>2]=m*+h[u+r>>3];g[n+4>>2]=p;g[n+8>>2]=q;g[n+12>>2]=0.0;r=aa(d[s+(t+1)>>0]|0,v)|0;q=k*+h[u+(r+8)>>3];p=l*+h[u+(r+16)>>3];g[n+16>>2]=m*+h[u+r>>3];g[n+20>>2]=q;g[n+24>>2]=p;g[n+28>>2]=0.0;v=aa(d[s+(t+2)>>0]|0,v)|0;p=k*+h[u+(v+8)>>3];q=l*+h[u+(v+16)>>3];g[n+32>>2]=m*+h[u+v>>3];g[n+36>>2]=p;g[n+40>>2]=q;g[n+44>>2]=0.0;vc[c[(c[b>>2]|0)+8>>2]&127](b,n,j,o);o=o+1|0}while((o|0)<(c[n+48>>2]|0))}else if((o|0)==2){if((c[n+48>>2]|0)>0)o=0;else break;do{t=c[n+72>>2]|0;v=aa(c[n+68>>2]|0,o)|0;u=c[n+76>>2]|0;s=c[n+56>>2]|0;r=aa(s,c[t+v>>2]|0)|0;p=k*+h[u+(r+8)>>3];q=l*+h[u+(r+16)>>3];g[n>>2]=m*+h[u+r>>3];g[n+4>>2]=p;g[n+8>>2]=q;g[n+12>>2]=0.0;r=aa(s,c[t+(v+4)>>2]|0)|0;q=k*+h[u+(r+8)>>3];p=l*+h[u+(r+16)>>3];g[n+16>>2]=m*+h[u+r>>3];g[n+20>>2]=q;g[n+24>>2]=p;g[n+28>>2]=0.0;v=aa(s,c[t+(v+8)>>2]|0)|0;p=k*+h[u+(v+8)>>3];q=l*+h[u+(v+16)>>3];g[n+32>>2]=m*+h[u+v>>3];g[n+36>>2]=p;g[n+40>>2]=q;g[n+44>>2]=0.0;vc[c[(c[b>>2]|0)+8>>2]&127](b,n,j,o);o=o+1|0}while((o|0)<(c[n+48>>2]|0))}else break}else if((o|0)==0){o=c[n+60>>2]|0;if((o|0)==5){if((c[n+48>>2]|0)>0)o=0;else break;do{s=c[n+72>>2]|0;t=aa(c[n+68>>2]|0,o)|0;u=c[n+76>>2]|0;v=c[n+56>>2]|0;r=aa(d[s+t>>0]|0,v)|0;p=k*+g[u+(r+4)>>2];q=l*+g[u+(r+8)>>2];g[n>>2]=m*+g[u+r>>2];g[n+4>>2]=p;g[n+8>>2]=q;g[n+12>>2]=0.0;r=aa(d[s+(t+1)>>0]|0,v)|0;q=k*+g[u+(r+4)>>2];p=l*+g[u+(r+8)>>2];g[n+16>>2]=m*+g[u+r>>2];g[n+20>>2]=q;g[n+24>>2]=p;g[n+28>>2]=0.0;v=aa(d[s+(t+2)>>0]|0,v)|0;p=k*+g[u+(v+4)>>2];q=l*+g[u+(v+8)>>2];g[n+32>>2]=m*+g[u+v>>2];g[n+36>>2]=p;g[n+40>>2]=q;g[n+44>>2]=0.0;vc[c[(c[b>>2]|0)+8>>2]&127](b,n,j,o);o=o+1|0}while((o|0)<(c[n+48>>2]|0))}else if((o|0)==3){if((c[n+48>>2]|0)>0)o=0;else break;do{s=c[n+72>>2]|0;t=aa(c[n+68>>2]|0,o)|0;u=c[n+76>>2]|0;v=c[n+56>>2]|0;r=aa(e[s+t>>1]|0,v)|0;p=k*+g[u+(r+4)>>2];q=l*+g[u+(r+8)>>2];g[n>>2]=m*+g[u+r>>2];g[n+4>>2]=p;g[n+8>>2]=q;g[n+12>>2]=0.0;r=aa(e[s+(t+2)>>1]|0,v)|0;q=k*+g[u+(r+4)>>2];p=l*+g[u+(r+8)>>2];g[n+16>>2]=m*+g[u+r>>2];g[n+20>>2]=q;g[n+24>>2]=p;g[n+28>>2]=0.0;v=aa(e[s+(t+4)>>1]|0,v)|0;p=k*+g[u+(v+4)>>2];q=l*+g[u+(v+8)>>2];g[n+32>>2]=m*+g[u+v>>2];g[n+36>>2]=p;g[n+40>>2]=q;g[n+44>>2]=0.0;vc[c[(c[b>>2]|0)+8>>2]&127](b,n,j,o);o=o+1|0}while((o|0)<(c[n+48>>2]|0))}else if((o|0)==2){if((c[n+48>>2]|0)>0)o=0;else break;do{t=c[n+72>>2]|0;v=aa(c[n+68>>2]|0,o)|0;u=c[n+76>>2]|0;s=c[n+56>>2]|0;r=aa(s,c[t+v>>2]|0)|0;p=k*+g[u+(r+4)>>2];q=l*+g[u+(r+8)>>2];g[n>>2]=m*+g[u+r>>2];g[n+4>>2]=p;g[n+8>>2]=q;g[n+12>>2]=0.0;r=aa(s,c[t+(v+4)>>2]|0)|0;q=k*+g[u+(r+4)>>2];p=l*+g[u+(r+8)>>2];g[n+16>>2]=m*+g[u+r>>2];g[n+20>>2]=q;g[n+24>>2]=p;g[n+28>>2]=0.0;v=aa(s,c[t+(v+8)>>2]|0)|0;p=k*+g[u+(v+4)>>2];q=l*+g[u+(v+8)>>2];g[n+32>>2]=m*+g[u+v>>2];g[n+36>>2]=p;g[n+40>>2]=q;g[n+44>>2]=0.0;vc[c[(c[b>>2]|0)+8>>2]&127](b,n,j,o);o=o+1|0}while((o|0)<(c[n+48>>2]|0))}else break}while(0);Nb[c[(c[a>>2]|0)+24>>2]&127](a,j);j=j+1|0}while((j|0)!=(f|0));i=n;return}function WD(d,e,f){d=d|0;e=e|0;f=f|0;var j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0.0,y=0;j=i;i=i+32|0;m=Pb[c[(c[d>>2]|0)+28>>2]&127](d)|0;c[e+20>>2]=m;c[e>>2]=0;if((m|0)==0){w=e+4|0;v=d+4|0;x=+g[v>>2];g[w>>2]=x;w=d+8|0;x=+g[w>>2];w=e+8|0;g[w>>2]=x;w=d+12|0;x=+g[w>>2];w=e+12|0;g[w>>2]=x;w=d+16|0;x=+g[w>>2];w=e+16|0;g[w>>2]=x;i=j;return 19824}m=Yb[c[(c[f>>2]|0)+16>>2]&31](f,32,m)|0;p=c[m+8>>2]|0;c[e>>2]=gc[c[(c[f>>2]|0)+28>>2]&31](f,p)|0;n=Pb[c[(c[d>>2]|0)+28>>2]&127](d)|0;if((n|0)>0){o=0;while(1){fc[c[(c[d>>2]|0)+16>>2]&3](d,j+28|0,j+4|0,j+16|0,j+8|0,j+24|0,j+20|0,j,j+12|0,o);c[p+24>>2]=c[j>>2];c[p+28>>2]=c[j+4>>2];r=p+8|0;t=p+12|0;s=p+16|0;q=p+4|0;c[p+0>>2]=0;c[p+4>>2]=0;c[p+8>>2]=0;c[p+12>>2]=0;c[p+16>>2]=0;c[p+20>>2]=0;u=c[j+12>>2]|0;if((u|0)==5){r=c[j>>2]|0;if((r|0)!=0){t=Yb[c[(c[f>>2]|0)+16>>2]&31](f,4,r)|0;r=c[t+8>>2]|0;c[s>>2]=gc[c[(c[f>>2]|0)+28>>2]&31](f,r)|0;if((c[j>>2]|0)>0){s=0;do{v=c[j+24>>2]|0;w=aa(c[j+20>>2]|0,s)|0;a[r+(s<<2)>>0]=a[v+w>>0]|0;a[r+(s<<2)+1>>0]=a[v+(w+1)>>0]|0;a[r+(s<<2)+2>>0]=a[v+(w+2)>>0]|0;s=s+1|0}while((s|0)<(c[j>>2]|0))}Jb[c[(c[f>>2]|0)+20>>2]&31](f,t,19736,1497453121,c[t+8>>2]|0)}}else if((u|0)==2){s=c[j>>2]|0;if((s|0)!=0){s=Yb[c[(c[f>>2]|0)+16>>2]&31](f,4,s*3|0)|0;t=c[s+8>>2]|0;c[r>>2]=gc[c[(c[f>>2]|0)+28>>2]&31](f,t)|0;if((c[j>>2]|0)>0){r=c[j+24>>2]|0;u=0;do{v=aa(c[j+20>>2]|0,u)|0;w=u*3|0;c[t+(w<<2)>>2]=c[r+v>>2];c[t+(w+1<<2)>>2]=c[r+(v+4)>>2];c[t+(w+2<<2)>>2]=c[r+(v+8)>>2];u=u+1|0}while((u|0)<(c[j>>2]|0))}Jb[c[(c[f>>2]|0)+20>>2]&31](f,s,19688,1497453121,c[s+8>>2]|0)}}else if((u|0)==3?(k=c[j>>2]|0,(k|0)!=0):0){s=Yb[c[(c[f>>2]|0)+16>>2]&31](f,8,k)|0;r=c[s+8>>2]|0;c[t>>2]=gc[c[(c[f>>2]|0)+28>>2]&31](f,r)|0;t=c[j>>2]|0;if((t|0)>0){v=c[j+24>>2]|0;u=c[j+20>>2]|0;w=0;do{y=aa(u,w)|0;b[r+(w<<3)>>1]=b[v+y>>1]|0;b[r+(w<<3)+2>>1]=b[v+(y+2)>>1]|0;b[r+(w<<3)+4>>1]=b[v+(y+4)>>1]|0;w=w+1|0}while((w|0)<(t|0))}Jb[c[(c[f>>2]|0)+20>>2]&31](f,s,19704,1497453121,c[s+8>>2]|0)}r=c[j+16>>2]|0;if((r|0)==1){r=c[j+4>>2]|0;if((r|0)!=0){r=Yb[c[(c[f>>2]|0)+16>>2]&31](f,32,r)|0;s=c[r+8>>2]|0;c[q>>2]=gc[c[(c[f>>2]|0)+28>>2]&31](f,s)|0;q=c[j+4>>2]|0;if((q|0)>0){u=c[j+28>>2]|0;v=c[j+8>>2]|0;t=0;do{y=aa(v,t)|0;h[s+(t<<5)>>3]=+h[u+y>>3];h[s+(t<<5)+8>>3]=+h[u+(y+8)>>3];h[s+(t<<5)+16>>3]=+h[u+(y+16)>>3];t=t+1|0}while((t|0)<(q|0))}Jb[c[(c[f>>2]|0)+20>>2]&31](f,r,19784,1497453121,c[r+8>>2]|0)}}else if((r|0)==0?(l=c[j+4>>2]|0,(l|0)!=0):0){v=Yb[c[(c[f>>2]|0)+16>>2]&31](f,16,l)|0;u=c[v+8>>2]|0;c[p>>2]=gc[c[(c[f>>2]|0)+28>>2]&31](f,u)|0;t=c[j+4>>2]|0;if((t|0)>0){s=c[j+28>>2]|0;q=c[j+8>>2]|0;r=0;do{y=aa(q,r)|0;g[u+(r<<4)>>2]=+g[s+y>>2];g[u+(r<<4)+4>>2]=+g[s+(y+4)>>2];g[u+(r<<4)+8>>2]=+g[s+(y+8)>>2];r=r+1|0}while((r|0)<(t|0))}Jb[c[(c[f>>2]|0)+20>>2]&31](f,v,19760,1497453121,c[v+8>>2]|0)}Nb[c[(c[d>>2]|0)+24>>2]&127](d,o);o=o+1|0;if((o|0)==(n|0)){k=f;break}else p=p+32|0}}else k=f;Jb[c[(c[k>>2]|0)+20>>2]&31](f,m,19808,1497453121,c[m+8>>2]|0);y=e+4|0;w=d+4|0;x=+g[w>>2];g[y>>2]=x;y=d+8|0;x=+g[y>>2];y=e+8|0;g[y>>2]=x;y=d+12|0;x=+g[y>>2];y=e+12|0;g[y>>2]=x;y=d+16|0;x=+g[y>>2];y=e+16|0;g[y>>2]=x;i=j;return 19824}function XD(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=19904;e=c[b+32>>2]|0;if((e|0)==0){a[b+36>>0]=1;c[b+32>>2]=0;c[b+24>>2]=0;c[b+28>>2]=0}else{if((a[b+36>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}a[b+36>>0]=1;c[b+32>>2]=0;c[b+24>>2]=0;c[b+28>>2]=0}c[5006]=(c[5006]|0)+1;YE(c[b+ -4>>2]|0);i=d;return}function YD(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=19904;e=c[b+32>>2]|0;if((e|0)!=0){if((a[b+36>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+32>>2]=0}a[b+36>>0]=1;c[b+32>>2]=0;c[b+24>>2]=0;c[b+28>>2]=0;i=d;return}function ZD(a,b,d,e,f,g,h,i,j,k){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;k=k|0;a=c[a+32>>2]|0;c[d>>2]=c[a+(k<<5)+12>>2];c[b>>2]=c[a+(k<<5)+16>>2];c[e>>2]=c[a+(k<<5)+28>>2];c[f>>2]=c[a+(k<<5)+20>>2];c[i>>2]=c[a+(k<<5)>>2];c[g>>2]=c[a+(k<<5)+4>>2];c[h>>2]=c[a+(k<<5)+8>>2];c[j>>2]=c[a+(k<<5)+24>>2];return}function _D(a,b,d,e,f,g,h,i,j,k){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;k=k|0;a=c[a+32>>2]|0;c[d>>2]=c[a+(k<<5)+12>>2];c[b>>2]=c[a+(k<<5)+16>>2];c[e>>2]=c[a+(k<<5)+28>>2];c[f>>2]=c[a+(k<<5)+20>>2];c[i>>2]=c[a+(k<<5)>>2];c[g>>2]=c[a+(k<<5)+4>>2];c[h>>2]=c[a+(k<<5)+8>>2];c[j>>2]=c[a+(k<<5)+24>>2];return}function $D(a){a=a|0;return(c[a+48>>2]|0)==1|0}function aE(a,b,d){a=a|0;b=b|0;d=d|0;var e=0;e=i;c[a+52>>2]=c[b+0>>2];c[a+56>>2]=c[b+4>>2];c[a+60>>2]=c[b+8>>2];c[a+64>>2]=c[b+12>>2];c[a+68>>2]=c[d+0>>2];c[a+72>>2]=c[d+4>>2];c[a+76>>2]=c[d+8>>2];c[a+80>>2]=c[d+12>>2];c[a+48>>2]=1;i=e;return}function bE(a,b,d){a=a|0;b=b|0;d=d|0;var e=0;e=i;c[b+0>>2]=c[a+52>>2];c[b+4>>2]=c[a+56>>2];c[b+8>>2]=c[a+60>>2];c[b+12>>2]=c[a+64>>2];c[d+0>>2]=c[a+68>>2];c[d+4>>2]=c[a+72>>2];c[d+8>>2]=c[a+76>>2];c[d+12>>2]=c[a+80>>2];i=e;return}function cE(a,b){a=a|0;b=b|0;return}function dE(a,b){a=a|0;b=b|0;return}function eE(a,b,d,e,f,g){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;g=g|0;var h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0;h=i;j=c[g+16>>2]|0;if((j|0)!=(f|0)){l=f-j|0;i=h;return l|0}if((f|0)==0){l=0;i=h;return l|0}l=c[g+8>>2]|0;n=c[g+12>>2]|0;k=nF(l|0,0,a|0,0)|0;j=E;p=nF(n|0,0,a|0,0)|0;m=E;l=nF(l|0,0,b|0,0)|0;a=E;n=nF(n|0,0,b|0,0)|0;o=E;b=bF(p|0,0,l|0,0)|0;l=E;o=bF(m|0,0,n|0,o|0)|0;a=bF(o|0,E|0,a|0,0)|0;l=bF(a|0,E|0,l|0,0)|0;a=E;j=bF(0,b|0,k|0,j|0)|0;k=E;b=bF(l|0,a|0,(k>>>0<b>>>0|(k|0)==(b|0)&j>>>0<0)&1|0,0)|0;a=E;l=c[g>>2]|0;o=c[g+4>>2]|0;n=nF(l|0,0,d|0,0)|0;g=E;m=nF(o|0,0,d|0,0)|0;p=E;l=nF(l|0,0,e|0,0)|0;d=E;o=nF(o|0,0,e|0,0)|0;e=E;l=bF(m|0,0,l|0,0)|0;m=E;e=bF(p|0,0,o|0,e|0)|0;e=bF(e|0,E|0,d|0,0)|0;m=bF(e|0,E|0,m|0,0)|0;e=E;g=bF(0,l|0,n|0,g|0)|0;d=E;l=bF(m|0,e|0,(d>>>0<l>>>0|(d|0)==(l|0)&g>>>0<0)&1|0,0)|0;e=E;if(!(a>>>0<e>>>0|(a|0)==(e|0)&b>>>0<l>>>0))if(!(a>>>0>e>>>0|(a|0)==(e|0)&b>>>0>l>>>0))if(k>>>0<d>>>0|(k|0)==(d|0)&j>>>0<g>>>0)a=-1;else a=(k>>>0>d>>>0|(k|0)==(d|0)&j>>>0>g>>>0)&1;else a=1;else a=-1;p=aa(a,f)|0;i=h;return p|0}function fE(a){a=a|0;var b=0,d=0,e=0,f=0,g=0,h=0;b=i;e=c[a+8>>2]|0;if((e|0)==0){g=c[a+4>>2]|0;if((g|0)==0){c[5004]=(c[5004]|0)+1;e=XE(31)|0;if((e|0)!=0?(d=e+19&-16,c[d+ -4>>2]=e,(e+19&-16|0)!=0):0){g=c[a+12>>2]|0;c[d+4>>2]=g;c[d+8>>2]=0;c[5004]=(c[5004]|0)+1;d=XE((g*24|3)+16|0)|0;if((d|0)==0)d=0;else{c[(d+19&-16)+ -4>>2]=d;d=d+19&-16}c[(e+19&-16)>>2]=d;g=e+19&-16}else g=0;c[g+8>>2]=c[a>>2];c[a>>2]=g}else c[a+4>>2]=c[g+8>>2];f=c[g+4>>2]|0;if((f|0)>0){d=0;e=c[g>>2]|0;do{d=d+1|0;h=e;e=e+24|0;c[h>>2]=(d|0)<(f|0)?e:0}while((d|0)!=(f|0))}e=c[g>>2]|0;c[a+8>>2]=c[e>>2];if((e|0)==0){h=0;i=b;return h|0}}else c[a+8>>2]=c[e>>2];c[e+0>>2]=0;c[e+4>>2]=0;c[e+8>>2]=0;c[e+12>>2]=0;c[e+16>>2]=0;c[e+20>>2]=0;h=e;i=b;return h|0}function gE(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,F=0,G=0,H=0,I=0,J=0;f=i;i=i+144|0;do if((d-b|0)==2){g=c[(c[a+92>>2]|0)+(b<<2)>>2]|0;h=c[g+88>>2]|0;d=c[g+200>>2]|0;b=c[g+92>>2]|0;k=c[g+204>>2]|0;if((h|0)==(d|0)){if((b|0)==(k|0))if((c[g+96>>2]|0)==(c[g+208>>2]|0))break;else j=b;else j=k;if((b|0)==(j|0)){J=(c[g+96>>2]|0)>(c[g+208>>2]|0);h=J?g+112|0:g;c[h>>2]=h;c[h+4>>2]=h;c[e>>2]=h;c[e+4>>2]=h;c[e+8>>2]=h;c[e+12>>2]=h;g=J?g:g+112|0}else{k=0;s=9}}else{j=k;k=(b|0)==(k|0);s=9}do if((s|0)==9){b=b-j|0;c[g>>2]=g+112;c[g+4>>2]=g+112;c[g+112>>2]=g;c[g+116>>2]=g;if((h-d|0)>=0?!((h|0)==(d|0)&(b|0)<0):0){c[e>>2]=g+112;c[e+4>>2]=g}else{c[e>>2]=g;c[e+4>>2]=g+112}if((b|0)<0|k&(h-d|0)<0){c[e+8>>2]=g;c[e+12>>2]=g+112;h=g;g=g+112|0;break}else{c[e+8>>2]=g+112;c[e+12>>2]=g;h=g;g=g+112|0;break}}while(0);b=fE(a+48|0)|0;d=fE(a+48|0)|0;c[b+8>>2]=d;c[d+8>>2]=b;c[b+20>>2]=c[a+100>>2];c[d+20>>2]=c[a+100>>2];c[b+12>>2]=g;c[d+12>>2]=h;c[b+16>>2]=0;c[d+16>>2]=0;d=c[a+116>>2]|0;c[a+116>>2]=d+1;if((d|0)>=(c[a+120>>2]|0))c[a+120>>2]=d+1;c[b>>2]=b;c[b+4>>2]=b;c[h+8>>2]=b;J=c[b+8>>2]|0;c[J>>2]=J;c[J+4>>2]=J;c[g+8>>2]=J;i=f;return}else if((d-b|0)==0){c[e+0>>2]=0;c[e+4>>2]=0;c[e+8>>2]=0;c[e+12>>2]=0;i=f;return}else if((d-b|0)==1)g=c[(c[a+92>>2]|0)+(b<<2)>>2]|0;else{r=((d-b|0)/2|0)+b|0;u=c[a+92>>2]|0;v=c[u+(r+ -1<<2)>>2]|0;y=c[v+88>>2]|0;x=c[v+92>>2]|0;v=c[v+96>>2]|0;a:do if((r|0)<(d|0)){w=r;while(1){z=c[u+(w<<2)>>2]|0;if((c[z+88>>2]|0)!=(y|0)){t=w;break a}if((c[z+92>>2]|0)!=(x|0)){t=w;break a}t=w+1|0;if((c[z+96>>2]|0)!=(v|0)){t=w;break a}if((t|0)<(d|0))w=t;else break}}else t=r;while(0);gE(a,b,r,e);c[f+96>>2]=0;c[f+100>>2]=0;c[f+104>>2]=0;c[f+108>>2]=0;gE(a,t,d,f+96|0);r=f+100|0;v=c[r>>2]|0;if((v|0)==0){i=f;return}if((c[e+4>>2]|0)==0){c[e+0>>2]=c[f+96>>2];c[e+4>>2]=c[f+100>>2];c[e+8>>2]=c[f+104>>2];c[e+12>>2]=c[f+108>>2];i=f;return}c[a+100>>2]=(c[a+100>>2]|0)+ -1;b=c[e+12>>2]|0;d=c[f+104>>2]|0;u=c[b+88>>2]|0;b:do if((u|0)==(c[d+88>>2]|0)?(c[b+92>>2]|0)==(c[d+92>>2]|0):0){t=c[d+4>>2]|0;if((t|0)==(d|0)){e=c[d+8>>2]|0;if((e|0)!=0){d=c[e+12>>2]|0;u=c[d+88>>2]|0}w=c[d+96>>2]|0;t=u+1|0;break}b=c[d>>2]|0;c[t>>2]=b;c[b+4>>2]=t;c:do if((d|0)==(c[f+96>>2]|0)){s=c[b+88>>2]|0;u=c[t+88>>2]|0;do if((s|0)>=(u|0)){if((s|0)==(u|0)?(c[b+92>>2]|0)<(c[t+92>>2]|0):0)break;c[f+96>>2]=t;break c}while(0);c[f+96>>2]=b}while(0);v=c[r>>2]|0;if((d|0)==(v|0)){d=c[b+88>>2]|0;s=c[t+88>>2]|0;do if((d|0)<=(s|0)){if((d|0)==(s|0)?(c[b+92>>2]|0)>(c[t+92>>2]|0):0)break;c[r>>2]=t;v=t;s=45;break b}while(0);c[r>>2]=b;v=b;s=45}else s=45}else s=45;while(0);if((s|0)==45){s=c[f+96>>2]|0;u=0;t=1;w=e+4|0;b=0;d=0;d:while(1){z=c[w>>2]|0;while(1){w=c[z+88>>2]|0;y=aa((c[v+88>>2]|0)-w|0,t)|0;e:do if((y|0)<=0){if((y|0)>=0){A=c[z+92>>2]|0;x=(u|0)!=0;f:do if(x){y=z;while(1){B=c[y>>2]|0;if((B|0)==(z|0)){z=y;break f}if((c[B+88>>2]|0)!=(w|0)){z=y;break f}J=A;A=c[B+92>>2]|0;if((A|0)>(J|0)){z=y;break}else y=B}}else{y=z;while(1){B=c[y+4>>2]|0;if((B|0)==(z|0)){z=y;break f}if((c[B+88>>2]|0)!=(w|0)){z=y;break f}J=A;A=c[B+92>>2]|0;if((A|0)>(J|0)){z=y;break}else y=B}}while(0);y=c[v+92>>2]|0;if(x){x=v;while(1){A=c[x+4>>2]|0;if((A|0)==(v|0))break e;if((c[A+88>>2]|0)!=(w|0))break e;J=y;y=c[A+92>>2]|0;if((y|0)<(J|0))break e;else x=A}}else{x=v;while(1){A=c[x>>2]|0;if((A|0)==(v|0))break e;if((c[A+88>>2]|0)!=(w|0))break e;J=y;y=c[A+92>>2]|0;if((y|0)<(J|0))break e;else x=A}}}w=c[v+92>>2]|0;C=c[z+92>>2]|0;if((u|0)==0)while(1){B=c[v>>2]|0;x=(B|0)==(v|0);A=v+88|0;while(1){G=z+88|0;D=w-C|0;if(!x?(p=c[B+88>>2]|0,n=aa(p-(c[A>>2]|0)|0,t)|0,o=c[B+92>>2]|0,j=o-w|0,(j|0)>-1):0){if((n|0)==0)break;if((n|0)<0?(aa(j,y)|0)<=(aa(n,D)|0):0)break}F=c[z>>2]|0;if((F|0)==(z|0)){x=v;break e}J=c[F+88>>2]|0;H=aa(J-(c[G>>2]|0)|0,t)|0;G=c[F+92>>2]|0;I=G-C|0;C=y;y=aa((c[A>>2]|0)-J|0,t)|0;if(!((y|0)<0&(I|0)>0)){x=v;break e}if((H|0)==0){C=G;z=F;continue}if((H|0)>=0){x=v;break e}if((aa(I,C)|0)>=(aa(H,D)|0)){x=v;break e}else{C=G;z=F}}w=o;y=aa(p-(c[G>>2]|0)|0,t)|0;v=B}else while(1){x=c[v+4>>2]|0;B=(x|0)==(v|0);A=v+88|0;while(1){G=z+88|0;D=w-C|0;if(!B?(m=c[x+88>>2]|0,q=aa(m-(c[A>>2]|0)|0,t)|0,l=c[x+92>>2]|0,k=l-w|0,(k|0)>-1):0){if((q|0)==0)break;if((q|0)<0?(aa(k,y)|0)<=(aa(q,D)|0):0)break}F=c[z+4>>2]|0;if((F|0)==(z|0)){x=v;break e}J=c[F+88>>2]|0;G=aa(J-(c[G>>2]|0)|0,t)|0;H=c[F+92>>2]|0;C=H-C|0;I=y;y=aa((c[A>>2]|0)-J|0,t)|0;if(!((y|0)<0&(C|0)>0)){x=v;break e}if((G|0)==0){C=H;z=F;continue}if((G|0)>=0){x=v;break e}if((aa(C,I)|0)>=(aa(G,D)|0)){x=v;break e}else{C=H;z=F}}w=l;y=aa(m-(c[G>>2]|0)|0,t)|0;v=x}}else{w=(u|0)!=0;x=c[v+92>>2]|0;C=z;while(1){z=v+88|0;D=C+88|0;B=c[C+92>>2]|0;G=x-B|0;A=c[(w?C:C+4|0)>>2]|0;g:do if((A|0)==(C|0)){B=D;D=G;F=y;A=C}else{F=y;while(1){J=c[A+88>>2]|0;I=aa(J-(c[D>>2]|0)|0,t)|0;H=B;B=c[A+92>>2]|0;H=B-H|0;if((H|0)>=1){B=D;D=G;A=C;break g}if((I|0)!=0){if((I|0)>=0){B=D;D=G;A=C;break g}if((aa(H,F)|0)>(aa(I,G)|0)){B=D;D=G;A=C;break g}}F=aa((c[z>>2]|0)-J|0,t)|0;D=A+88|0;G=x-B|0;C=c[(w?A:A+4|0)>>2]|0;if((C|0)==(A|0)){B=D;D=G;break}else{J=A;A=C;C=J}}}while(0);G=c[(w?v:v+4|0)>>2]|0;if((G|0)==(v|0)){z=A;x=v;break e}y=c[G+88>>2]|0;C=aa(y-(c[z>>2]|0)|0,t)|0;z=x;x=c[G+92>>2]|0;z=x-z|0;y=aa(y-(c[B>>2]|0)|0,t)|0;if(!((y|0)>0&(z|0)<0)){z=A;x=v;break e}if((C|0)==0){C=A;v=G;continue}if((C|0)>=0){z=A;x=v;break e}if((aa(z,F)|0)>=(aa(C,D)|0)){z=A;x=v;break}else{C=A;v=G}}}while(0);if((u|0)==0){u=1;t=-1;w=e;b=z;v=s;d=x;continue d}u=u+1|0;if((u|0)==2)break d;else v=x}}c[z+4>>2]=x;c[x>>2]=z;c[b>>2]=d;c[d+4>>2]=b;j=c[f+96>>2]|0;if((c[j+88>>2]|0)<(c[(c[e>>2]|0)+88>>2]|0))c[e>>2]=j;j=c[r>>2]|0;if((c[j+88>>2]|0)>=(c[(c[e+4>>2]|0)+88>>2]|0))c[e+4>>2]=j;c[e+12>>2]=c[f+108>>2];k=c[d+88>>2]|0;y=c[b+88>>2]|0;l=c[d+92>>2]|0;e=c[b+92>>2]|0;o=c[d+96>>2]|0;z=c[b+96>>2]|0;t=((l-e|0)<0)<<31>>31;j=0-(k-y)|0;s=_E(0,0,j|0,((j|0)<0)<<31>>31|0)|0;s=nF(o-z|0,((o-z|0)<0)<<31>>31|0,s|0,E|0)|0;r=E;q=nF(o-z|0,((o-z|0)<0)<<31>>31|0,l-e|0,t|0)|0;p=E;x=nF(k-y|0,((k-y|0)<0)<<31>>31|0,j|0,((j|0)<0)<<31>>31|0)|0;m=E;n=nF(l-e|0,t|0,l-e|0,t|0)|0;n=_E(x|0,m|0,n|0,E|0)|0;m=E;x=c[b+8>>2]|0;c[f+140>>2]=0;if((x|0)==0)A=0;else{u=_E(0,0,l-e|0,t|0)|0;w=E;A=0;v=x;do{C=c[v+12>>2]|0;F=c[C+88>>2]|0;B=c[C+92>>2]|0;C=c[C+96>>2]|0;H=nF(B-e|0,((B-e|0)<0)<<31>>31|0,j|0,((j|0)<0)<<31>>31|0)|0;J=E;I=nF(F-y|0,((F-y|0)<0)<<31>>31|0,u|0,w|0)|0;do if((H|0)==(I|0)&(J|0)==(E|0)?(I=nF(F-y|0,((F-y|0)<0)<<31>>31|0,s|0,r|0)|0,H=E,J=nF(B-e|0,((B-e|0)<0)<<31>>31|0,q|0,p|0)|0,H=bF(J|0,E|0,I|0,H|0)|0,I=E,J=nF(C-z|0,((C-z|0)<0)<<31>>31|0,n|0,m|0)|0,J=bF(H|0,I|0,J|0,E|0)|0,I=E,(I|0)>0|(I|0)==0&J>>>0>0):0){if((A|0)!=0){D=(c[A+4>>2]|0)==(v|0);if((c[A>>2]|0)==(v|0)){if(!D)break;H=c[A+12>>2]|0;G=c[(c[v+8>>2]|0)+12>>2]|0;J=c[G+88>>2]|0;I=c[G+92>>2]|0;G=c[G+96>>2]|0;D=(c[H+96>>2]|0)-G|0;I=(aa(C-G|0,(c[H+92>>2]|0)-I|0)|0)-(aa(D,B-I|0)|0)|0;B=(aa(D,F-J|0)|0)-(aa(C-G|0,(c[H+88>>2]|0)-J|0)|0)|0;I=nF(I|0,((I|0)<0)<<31>>31|0,l-e|0,t|0)|0;J=E;B=nF(B|0,((B|0)<0)<<31>>31|0,j|0,((j|0)<0)<<31>>31|0)|0;B=bF(I|0,J|0,B|0,E|0)|0;J=E;B=(J|0)>0|(J|0)==0&B>>>0>0?2:1}else B=D&1;if((B|0)!=1)break}c[f+140>>2]=v;A=v}while(0);v=c[v>>2]|0}while((v|0)!=(x|0))}w=c[d+8>>2]|0;c[f+136>>2]=0;if((w|0)==0)z=0;else{u=_E(0,0,l-e|0,t|0)|0;v=E;z=0;x=w;do{y=c[x+12>>2]|0;B=c[y+88>>2]|0;C=c[y+92>>2]|0;y=c[y+96>>2]|0;H=nF(C-l|0,((C-l|0)<0)<<31>>31|0,j|0,((j|0)<0)<<31>>31|0)|0;J=E;I=nF(B-k|0,((B-k|0)<0)<<31>>31|0,u|0,v|0)|0;do if((H|0)==(I|0)&(J|0)==(E|0)?(I=nF(B-k|0,((B-k|0)<0)<<31>>31|0,s|0,r|0)|0,H=E,J=nF(C-l|0,((C-l|0)<0)<<31>>31|0,q|0,p|0)|0,H=bF(J|0,E|0,I|0,H|0)|0,I=E,J=nF(y-o|0,((y-o|0)<0)<<31>>31|0,n|0,m|0)|0,J=bF(H|0,I|0,J|0,E|0)|0,I=E,(I|0)>0|(I|0)==0&J>>>0>0):0){if((z|0)!=0){if((c[z>>2]|0)!=(x|0))break;if((c[z+4>>2]|0)==(x|0)?(I=c[z+12>>2]|0,G=c[(c[x+8>>2]|0)+12>>2]|0,J=c[G+88>>2]|0,H=c[G+92>>2]|0,G=c[G+96>>2]|0,F=(c[I+96>>2]|0)-G|0,H=(aa(y-G|0,(c[I+92>>2]|0)-H|0)|0)-(aa(F,C-H|0)|0)|0,J=(aa(F,B-J|0)|0)-(aa(y-G|0,(c[I+88>>2]|0)-J|0)|0)|0,H=nF(H|0,((H|0)<0)<<31>>31|0,l-e|0,t|0)|0,I=E,J=nF(J|0,((J|0)<0)<<31>>31|0,j|0,((j|0)<0)<<31>>31|0)|0,J=bF(H|0,I|0,J|0,E|0)|0,I=E,!((I|0)>0|(I|0)==0&J>>>0>0)):0)break}c[f+136>>2]=x;z=x}while(0);x=c[x>>2]|0}while((x|0)!=(w|0))}if(!((A|0)==0&(z|0)==0)){iE(a,b,d,f+140|0,f+136|0);e=c[f+140>>2]|0;if((e|0)!=0)b=c[e+12>>2]|0;e=c[f+136>>2]|0;if((e|0)!=0)d=c[e+12>>2]|0}w=(c[d+96>>2]|0)+1|0;t=c[d+88>>2]|0}u=c[d+92>>2]|0;s=u;e=b;m=d;j=0;q=0;z=1;n=0;v=0;o=0;x=0;k=0;p=0;while(1){y=e+88|0;G=(c[m+88>>2]|0)-(c[y>>2]|0)|0;J=e+92|0;l=s-(c[J>>2]|0)|0;F=e+96|0;C=(c[m+96>>2]|0)-(c[F>>2]|0)|0;c[f+120>>2]=G;c[f+124>>2]=l;c[f+128>>2]=C;c[f+132>>2]=-1;y=t-(c[y>>2]|0)|0;J=u-(c[J>>2]|0)|0;F=w-(c[F>>2]|0)|0;D=(aa(C,J)|0)-(aa(l,F)|0)|0;F=(aa(G,F)|0)-(aa(C,y)|0)|0;J=(aa(l,y)|0)-(aa(G,J)|0)|0;c[f+72>>2]=D;c[f+76>>2]=((D|0)<0)<<31>>31;c[f+80>>2]=F;c[f+84>>2]=((F|0)<0)<<31>>31;c[f+88>>2]=J;c[f+92>>2]=((J|0)<0)<<31>>31;y=nF(J|0,((J|0)<0)<<31>>31|0,l|0,((l|0)<0)<<31>>31|0)|0;I=E;H=nF(C|0,((C|0)<0)<<31>>31|0,F|0,((F|0)<0)<<31>>31|0)|0;H=_E(y|0,I|0,H|0,E|0)|0;I=E;C=nF(D|0,((D|0)<0)<<31>>31|0,C|0,((C|0)<0)<<31>>31|0)|0;y=E;J=nF(G|0,((G|0)<0)<<31>>31|0,J|0,((J|0)<0)<<31>>31|0)|0;J=_E(C|0,y|0,J|0,E|0)|0;y=E;F=nF(G|0,((G|0)<0)<<31>>31|0,F|0,((F|0)<0)<<31>>31|0)|0;G=E;l=nF(D|0,((D|0)<0)<<31>>31|0,l|0,((l|0)<0)<<31>>31|0)|0;l=_E(F|0,G|0,l|0,E|0)|0;c[f+48>>2]=H;c[f+52>>2]=I;c[f+56>>2]=J;c[f+60>>2]=y;c[f+64>>2]=l;c[f+68>>2]=E;c[f+24>>2]=0;c[f+28>>2]=0;c[f+32>>2]=0;c[f+36>>2]=0;c[f+40>>2]=0;l=hE(a,0,e,f+120|0,f+72|0,f+48|0,f+24|0)|0;c[f+0>>2]=0;c[f+4>>2]=0;c[f+8>>2]=0;c[f+12>>2]=0;c[f+16>>2]=0;y=hE(a,1,m,f+120|0,f+72|0,f+48|0,f)|0;if((y|0)==0&((l|0)!=0^1)){s=138;break}if((y|0)==0|(l|0)!=0^1)r=(l|0)!=0?-1:1;else r=eE(c[f+24>>2]|0,c[f+28>>2]|0,c[f+32>>2]|0,c[f+36>>2]|0,c[f+40>>2]|0,f)|0;do if(!z){if((r|0)>-1){if((c[f+16>>2]|0)>=0){s=150;break}if((c[f+8>>2]|0)==0&(c[f+12>>2]|0)==0){s=157;break}else{s=150;break}}if((c[f+40>>2]|0)<0?(c[f+32>>2]|0)==0&(c[f+36>>2]|0)==0:0){c[f+116>>2]=l;c[f+112>>2]=y;y=l;r=v;v=x;s=179}else s=150}else s=150;while(0);if((s|0)==150){s=fE(a+48|0)|0;z=fE(a+48|0)|0;c[s+8>>2]=z;c[z+8>>2]=s;c[s+20>>2]=c[a+100>>2];c[z+20>>2]=c[a+100>>2];c[s+12>>2]=m;c[z+12>>2]=e;c[s+16>>2]=0;c[z+16>>2]=0;z=c[a+116>>2]|0;c[a+116>>2]=z+1;if((z|0)>=(c[a+120>>2]|0))c[a+120>>2]=z+1;if((o|0)==0)n=s;else c[o+4>>2]=s;c[s>>2]=o;z=c[s+8>>2]|0;if((x|0)==0)v=z;else c[x>>2]=z;c[z+4>>2]=x;o=s;x=z;s=157}do if((s|0)==157){s=0;c[f+116>>2]=l;c[f+112>>2]=y;if((r|0)!=0)if((r|0)>-1)z=y;else{y=l;r=v;v=x;s=179;break}else{iE(a,e,m,f+116|0,f+112|0);z=c[f+112>>2]|0}if((z|0)!=0){t=(p|0)!=0;if(t?(g=c[p>>2]|0,(g|0)!=(y|0)):0){B=g;do{A=B;B=c[B>>2]|0;w=c[A+8>>2]|0;if((B|0)==(A|0))c[(c[w+12>>2]|0)+8>>2]=0;else{c[B+4>>2]=c[A+4>>2];c[c[A+4>>2]>>2]=B;c[(c[w+12>>2]|0)+8>>2]=B}u=c[w>>2]|0;if((u|0)==(w|0))c[(c[A+12>>2]|0)+8>>2]=0;else{c[u+4>>2]=c[w+4>>2];c[c[w+4>>2]>>2]=u;c[(c[A+12>>2]|0)+8>>2]=u}c[A+0>>2]=0;c[A+4>>2]=0;c[A+8>>2]=0;c[A+12>>2]=0;c[A+16>>2]=0;c[A>>2]=c[a+56>>2];c[a+56>>2]=A;c[w+0>>2]=0;c[w+4>>2]=0;c[w+8>>2]=0;c[w+12>>2]=0;c[w+16>>2]=0;c[w>>2]=c[a+56>>2];c[a+56>>2]=w;c[a+116>>2]=(c[a+116>>2]|0)+ -1}while((B|0)!=(y|0))}if((x|0)==0){p=z;q=t?q:y}else{if(t){c[p>>2]=v;c[v+4>>2]=p;p=y+4|0}else{p=c[y+4>>2]|0;c[p>>2]=v;c[v+4>>2]=p;p=y+4|0;q=v}c[x>>2]=y;c[p>>2]=x;p=c[f+112>>2]|0;v=0}w=c[m+96>>2]|0;u=c[m+92>>2]|0;t=c[m+88>>2]|0;m=c[p+12>>2]|0;x=0;p=c[p+8>>2]|0}if((r|0)<1){y=c[f+116>>2]|0;r=v;v=x;s=179}else{l=v;r=x}}while(0);if((s|0)==179){s=0;if((y|0)==0){l=r;r=v}else{t=(k|0)!=0;if(t?(h=c[k+4>>2]|0,(h|0)!=(l|0)):0){x=h;do{A=x+4|0;u=x;x=c[A>>2]|0;z=c[u>>2]|0;w=c[u+8>>2]|0;if((z|0)==(u|0))c[(c[w+12>>2]|0)+8>>2]=0;else{c[z+4>>2]=x;c[c[A>>2]>>2]=z;c[(c[w+12>>2]|0)+8>>2]=z}z=c[w>>2]|0;if((z|0)==(w|0))c[(c[u+12>>2]|0)+8>>2]=0;else{c[z+4>>2]=c[w+4>>2];c[c[w+4>>2]>>2]=z;c[(c[u+12>>2]|0)+8>>2]=z}c[u+0>>2]=0;c[u+4>>2]=0;c[u+8>>2]=0;c[u+12>>2]=0;c[u+16>>2]=0;c[u>>2]=c[a+56>>2];c[a+56>>2]=u;c[w+0>>2]=0;c[w+4>>2]=0;c[w+8>>2]=0;c[w+12>>2]=0;c[w+16>>2]=0;c[w>>2]=c[a+56>>2];c[a+56>>2]=w;c[a+116>>2]=(c[a+116>>2]|0)+ -1}while((x|0)!=(l|0))}if((o|0)==0)j=t?j:l;else{if(t){c[n>>2]=k;c[k+4>>2]=n;k=l}else{k=c[l>>2]|0;c[n>>2]=k;c[k+4>>2]=n;k=l;j=n}c[k>>2]=o;c[o+4>>2]=l;y=c[f+116>>2]|0;n=0}w=c[e+96>>2]|0;u=c[e+92>>2]|0;t=c[e+88>>2]|0;e=c[y+12>>2]|0;l=r;o=0;r=v;k=c[y+8>>2]|0}}if((e|0)==(b|0)&(m|0)==(d|0))break;s=c[m+92>>2]|0;z=0;v=l;x=r}if((s|0)==138){h=fE(a+48|0)|0;g=fE(a+48|0)|0;c[h+8>>2]=g;c[g+8>>2]=h;c[h+20>>2]=c[a+100>>2];c[g+20>>2]=c[a+100>>2];c[h+12>>2]=m;c[g+12>>2]=e;c[h+16>>2]=0;c[g+16>>2]=0;g=c[a+116>>2]|0;c[a+116>>2]=g+1;if((g|0)>=(c[a+120>>2]|0))c[a+120>>2]=g+1;c[h>>2]=h;c[h+4>>2]=h;c[e+8>>2]=h;J=c[h+8>>2]|0;c[J>>2]=J;c[J+4>>2]=J;c[m+8>>2]=J;i=f;return}if((k|0)!=0){g=k+4|0;e=c[g>>2]|0;if((e|0)!=(j|0))do{s=e+4|0;h=e;e=c[s>>2]|0;m=c[h>>2]|0;b=c[h+8>>2]|0;if((m|0)==(h|0))c[(c[b+12>>2]|0)+8>>2]=0;else{c[m+4>>2]=e;c[c[s>>2]>>2]=m;c[(c[b+12>>2]|0)+8>>2]=m}m=c[b>>2]|0;if((m|0)==(b|0))c[(c[h+12>>2]|0)+8>>2]=0;else{c[m+4>>2]=c[b+4>>2];c[c[b+4>>2]>>2]=m;c[(c[h+12>>2]|0)+8>>2]=m}c[h+0>>2]=0;c[h+4>>2]=0;c[h+8>>2]=0;c[h+12>>2]=0;c[h+16>>2]=0;c[h>>2]=c[a+56>>2];c[a+56>>2]=h;c[b+0>>2]=0;c[b+4>>2]=0;c[b+8>>2]=0;c[b+12>>2]=0;c[b+16>>2]=0;c[b>>2]=c[a+56>>2];c[a+56>>2]=b;c[a+116>>2]=(c[a+116>>2]|0)+ -1}while((e|0)!=(j|0));if((o|0)!=0){c[n>>2]=k;c[g>>2]=n;c[j>>2]=o;c[o+4>>2]=j}}else{c[n>>2]=o;c[o+4>>2]=n;c[b+8>>2]=o}if((p|0)==0){c[r>>2]=l;c[l+4>>2]=r;c[d+8>>2]=r;i=f;return}g=c[p>>2]|0;if((g|0)!=(q|0))do{d=g;g=c[g>>2]|0;h=c[d+8>>2]|0;if((g|0)==(d|0))c[(c[h+12>>2]|0)+8>>2]=0;else{c[g+4>>2]=c[d+4>>2];c[c[d+4>>2]>>2]=g;c[(c[h+12>>2]|0)+8>>2]=g}b=c[h>>2]|0;if((b|0)==(h|0))c[(c[d+12>>2]|0)+8>>2]=0;else{c[b+4>>2]=c[h+4>>2];c[c[h+4>>2]>>2]=b;c[(c[d+12>>2]|0)+8>>2]=b}c[d+0>>2]=0;c[d+4>>2]=0;c[d+8>>2]=0;c[d+12>>2]=0;c[d+16>>2]=0;c[d>>2]=c[a+56>>2];c[a+56>>2]=d;c[h+0>>2]=0;c[h+4>>2]=0;c[h+8>>2]=0;c[h+12>>2]=0;c[h+16>>2]=0;c[h>>2]=c[a+56>>2];c[a+56>>2]=h;c[a+116>>2]=(c[a+116>>2]|0)+ -1}while((g|0)!=(q|0));if((r|0)==0){i=f;return}c[p>>2]=l;c[l+4>>2]=p;c[r>>2]=q;c[q+4>>2]=r;i=f;return}while(0);c[g+8>>2]=0;c[g>>2]=g;c[g+4>>2]=g;c[e>>2]=g;c[e+4>>2]=g;c[e+8>>2]=g;c[e+12>>2]=g;i=f;return}function hE(a,b,d,e,f,g,h){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;var j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0;j=i;k=c[d+8>>2]|0;if((k|0)==0){y=0;i=j;return y|0}l=0;do{do if((c[k+20>>2]|0)>(c[a+100>>2]|0)){p=c[k+12>>2]|0;r=c[p+88>>2]|0;o=r-(c[d+88>>2]|0)|0;q=c[p+92>>2]|0;m=q-(c[d+92>>2]|0)|0;p=c[p+96>>2]|0;n=p-(c[d+96>>2]|0)|0;u=nF(o|0,((o|0)<0)<<31>>31|0,c[g>>2]|0,c[g+4>>2]|0)|0;w=E;s=nF(m|0,((m|0)<0)<<31>>31|0,c[g+8>>2]|0,c[g+12>>2]|0)|0;w=bF(s|0,E|0,u|0,w|0)|0;u=E;s=nF(n|0,((n|0)<0)<<31>>31|0,c[g+16>>2]|0,c[g+20>>2]|0)|0;s=bF(w|0,u|0,s|0,E|0)|0;u=E;w=nF(c[f>>2]|0,c[f+4>>2]|0,o|0,((o|0)<0)<<31>>31|0)|0;y=E;x=nF(c[f+8>>2]|0,c[f+12>>2]|0,m|0,((m|0)<0)<<31>>31|0)|0;y=bF(x|0,E|0,w|0,y|0)|0;w=E;x=nF(c[f+16>>2]|0,c[f+20>>2]|0,n|0,((n|0)<0)<<31>>31|0)|0;x=bF(y|0,w|0,x|0,E|0)|0;w=E;if((u|0)>0|(u|0)==0&s>>>0>0){v=1;t=u;u=1}else{s=_E(0,0,s|0,u|0)|0;v=(u|0)<0?-1:0;s=(u|0)<0?s:0;t=(u|0)<0?E:0;u=(u|0)<0?-1:0}if(!((w|0)>0|(w|0)==0&x>>>0>0)){if((w|0)<0){u=0-v|0;z=_E(0,0,x|0,w|0)|0;v=u;y=(x|0)==0&(w|0)==0;x=z;w=E}else{y=1;x=0;w=0}if((v|0)==0&y)break;else v=x}else v=x;if((l|0)==0){c[h>>2]=s;c[h+4>>2]=t;c[h+8>>2]=v;c[h+12>>2]=w;c[h+16>>2]=u;l=k;break}x=eE(s,t,v,w,u,h)|0;if((x|0)<0){c[h>>2]=s;c[h+4>>2]=t;c[h+8>>2]=v;c[h+12>>2]=w;c[h+16>>2]=u;l=k;break}if((x|0)==0){s=(c[l+4>>2]|0)==(k|0);if((c[l>>2]|0)==(k|0))if(s){z=c[e+8>>2]|0;w=aa(z,m)|0;u=c[e+4>>2]|0;w=w-(aa(u,n)|0)|0;y=c[e>>2]|0;z=(aa(y,n)|0)-(aa(o,z)|0)|0;y=(aa(o,u)|0)-(aa(y,m)|0)|0;o=c[l+12>>2]|0;m=c[(c[k+8>>2]|0)+12>>2]|0;u=c[m+88>>2]|0;t=(c[o+88>>2]|0)-u|0;s=c[m+92>>2]|0;v=(c[o+92>>2]|0)-s|0;m=c[m+96>>2]|0;o=(c[o+96>>2]|0)-m|0;x=(aa(p-m|0,v)|0)-(aa(q-s|0,o)|0)|0;m=(aa(r-u|0,o)|0)-(aa(p-m|0,t)|0)|0;v=(aa(q-s|0,t)|0)-(aa(r-u|0,v)|0)|0;w=nF(x|0,((x|0)<0)<<31>>31|0,w|0,((w|0)<0)<<31>>31|0)|0;x=E;z=nF(m|0,((m|0)<0)<<31>>31|0,z|0,((z|0)<0)<<31>>31|0)|0;m=E;y=nF(v|0,((v|0)<0)<<31>>31|0,y|0,((y|0)<0)<<31>>31|0)|0;y=bF(w|0,x|0,y|0,E|0)|0;m=bF(y|0,E|0,z|0,m|0)|0;z=E;m=(z|0)>0|(z|0)==0&m>>>0>0?2:1}else m=2;else m=s&1;l=(m|0)==2^b?l:k}}while(0);k=c[k>>2]|0}while((k|0)!=(c[d+8>>2]|0));i=j;return l|0}function iE(a,b,d,e,f){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;var g=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0,Q=0,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=0,Z=0;g=i;i=i+96|0;s=c[e>>2]|0;h=c[f>>2]|0;if((s|0)!=0)j=c[s+12>>2]|0;else j=b;x=c[j+88>>2]|0;w=c[j+92>>2]|0;v=c[j+96>>2]|0;if((h|0)==0)j=d;else j=c[h+12>>2]|0;B=c[j+88>>2]|0;A=c[j+92>>2]|0;z=c[j+96>>2]|0;r=c[b+88>>2]|0;j=(c[d+88>>2]|0)-r|0;C=c[b+92>>2]|0;k=(c[d+92>>2]|0)-C|0;G=c[b+96>>2]|0;p=(c[d+96>>2]|0)-G|0;d=c[((s|0)!=0?s:h)+12>>2]|0;o=(c[d+88>>2]|0)-r|0;u=(c[d+92>>2]|0)-C|0;d=(c[d+96>>2]|0)-G|0;q=(aa(u,p)|0)-(aa(d,k)|0)|0;d=(aa(d,j)|0)-(aa(o,p)|0)|0;u=(aa(o,k)|0)-(aa(u,j)|0)|0;r=nF(q|0,((q|0)<0)<<31>>31|0,r|0,((r|0)<0)<<31>>31|0)|0;o=E;C=nF(d|0,((d|0)<0)<<31>>31|0,C|0,((C|0)<0)<<31>>31|0)|0;D=E;G=nF(u|0,((u|0)<0)<<31>>31|0,G|0,((G|0)<0)<<31>>31|0)|0;G=bF(r|0,o|0,G|0,E|0)|0;D=bF(G|0,E|0,C|0,D|0)|0;C=E;G=nF(u|0,((u|0)<0)<<31>>31|0,k|0,((k|0)<0)<<31>>31|0)|0;o=E;r=nF(d|0,((d|0)<0)<<31>>31|0,p|0,((p|0)<0)<<31>>31|0)|0;r=_E(G|0,o|0,r|0,E|0)|0;o=E;G=nF(q|0,((q|0)<0)<<31>>31|0,p|0,((p|0)<0)<<31>>31|0)|0;l=E;b=nF(u|0,((u|0)<0)<<31>>31|0,j|0,((j|0)<0)<<31>>31|0)|0;b=_E(G|0,l|0,b|0,E|0)|0;l=E;G=nF(d|0,((d|0)<0)<<31>>31|0,j|0,((j|0)<0)<<31>>31|0)|0;n=E;m=nF(q|0,((q|0)<0)<<31>>31|0,k|0,((k|0)<0)<<31>>31|0)|0;m=_E(G|0,n|0,m|0,E|0)|0;n=E;G=nF(r|0,o|0,x|0,((x|0)<0)<<31>>31|0)|0;Z=E;F=nF(b|0,l|0,w|0,((w|0)<0)<<31>>31|0)|0;Z=bF(F|0,E|0,G|0,Z|0)|0;G=E;F=nF(m|0,n|0,v|0,((v|0)<0)<<31>>31|0)|0;F=bF(Z|0,G|0,F|0,E|0)|0;G=E;if((s|0)!=0?(c[s+12>>2]|0)!=0:0){y=s;while(1){y=c[(c[y+8>>2]|0)+4>>2]|0;J=y+12|0;I=c[J>>2]|0;K=c[I+88>>2]|0;Y=nF(K|0,((K|0)<0)<<31>>31|0,q|0,((q|0)<0)<<31>>31|0)|0;X=E;H=c[I+92>>2]|0;Z=nF(H|0,((H|0)<0)<<31>>31|0,d|0,((d|0)<0)<<31>>31|0)|0;X=bF(Z|0,E|0,Y|0,X|0)|0;Y=E;I=c[I+96>>2]|0;Z=nF(I|0,((I|0)<0)<<31>>31|0,u|0,((u|0)<0)<<31>>31|0)|0;Z=bF(X|0,Y|0,Z|0,E|0)|0;Y=E;if((Y|0)<(C|0)|(Y|0)==(C|0)&Z>>>0<D>>>0)break;if((c[y+20>>2]|0)==(c[a+100>>2]|0))break;Y=nF(K|0,((K|0)<0)<<31>>31|0,r|0,o|0)|0;Z=E;H=nF(H|0,((H|0)<0)<<31>>31|0,b|0,l|0)|0;Z=bF(H|0,E|0,Y|0,Z|0)|0;H=E;I=nF(I|0,((I|0)<0)<<31>>31|0,m|0,n|0)|0;I=bF(Z|0,H|0,I|0,E|0)|0;H=E;if(!((H|0)>(G|0)|(H|0)==(G|0)&I>>>0>F>>>0))break;c[e>>2]=y;Z=c[J>>2]|0;x=c[Z+88>>2]|0;w=c[Z+92>>2]|0;v=c[Z+96>>2]|0;if((Z|0)==0){F=I;G=H;break}else{G=H;F=I}}y=c[f>>2]|0}else y=h;H=nF(r|0,o|0,B|0,((B|0)<0)<<31>>31|0)|0;Z=E;I=nF(b|0,l|0,A|0,((A|0)<0)<<31>>31|0)|0;Z=bF(I|0,E|0,H|0,Z|0)|0;H=E;I=nF(m|0,n|0,z|0,((z|0)<0)<<31>>31|0)|0;I=bF(Z|0,H|0,I|0,E|0)|0;H=E;a:do if((y|0)!=0)if((c[y+12>>2]|0)==0)C=I;else while(1){J=c[c[y+8>>2]>>2]|0;M=c[J+12>>2]|0;K=c[M+88>>2]|0;Y=nF(K|0,((K|0)<0)<<31>>31|0,q|0,((q|0)<0)<<31>>31|0)|0;X=E;L=c[M+92>>2]|0;Z=nF(L|0,((L|0)<0)<<31>>31|0,d|0,((d|0)<0)<<31>>31|0)|0;X=bF(Z|0,E|0,Y|0,X|0)|0;Y=E;M=c[M+96>>2]|0;Z=nF(M|0,((M|0)<0)<<31>>31|0,u|0,((u|0)<0)<<31>>31|0)|0;Z=bF(X|0,Y|0,Z|0,E|0)|0;Y=E;if((Y|0)<(C|0)|(Y|0)==(C|0)&Z>>>0<D>>>0){C=I;break a}if((c[J+20>>2]|0)==(c[a+100>>2]|0)){C=I;break a}K=nF(K|0,((K|0)<0)<<31>>31|0,r|0,o|0)|0;Z=E;L=nF(L|0,((L|0)<0)<<31>>31|0,b|0,l|0)|0;Z=bF(L|0,E|0,K|0,Z|0)|0;K=E;L=nF(M|0,((M|0)<0)<<31>>31|0,m|0,n|0)|0;L=bF(Z|0,K|0,L|0,E|0)|0;K=E;if(!((K|0)>(H|0)|(K|0)==(H|0)&L>>>0>I>>>0)){C=I;break a}c[f>>2]=J;Z=c[J+12>>2]|0;B=c[Z+88>>2]|0;A=c[Z+92>>2]|0;z=c[Z+96>>2]|0;if((Z|0)==0){C=L;H=K;y=J;break}else{y=J;H=K;I=L}}else{C=I;y=0}while(0);D=_E(C|0,H|0,F|0,G|0)|0;C=E;if((C|0)>0|(C|0)==0&D>>>0>0){I=_E(0,0,u|0,((u|0)<0)<<31>>31|0)|0;J=E;H=v;G=w;F=x;N=z;O=A;P=B;L=D;K=C;b:while(1){c:while(1){M=(aa(O-G|0,k)|0)+(aa(N-H|0,p)|0)+(aa(P-F|0,j)|0)|0;Q=c[e>>2]|0;do if(((Q|0)!=0?(c[Q+12>>2]|0)!=0:0)?(t=c[(c[Q>>2]|0)+8>>2]|0,(c[t+20>>2]|0)>(c[a+100>>2]|0)):0){T=c[t+12>>2]|0;R=c[T+88>>2]|0;Z=R-F|0;U=c[T+92>>2]|0;X=U-G|0;T=c[T+96>>2]|0;V=T-H|0;W=nF(Z|0,((Z|0)<0)<<31>>31|0,r|0,o|0)|0;S=E;Y=nF(X|0,((X|0)<0)<<31>>31|0,b|0,l|0)|0;S=bF(Y|0,E|0,W|0,S|0)|0;W=E;Y=nF(V|0,((V|0)<0)<<31>>31|0,m|0,n|0)|0;Y=bF(S|0,W|0,Y|0,E|0)|0;W=E;V=(aa(X,k)|0)+(aa(Z,j)|0)+(aa(V,p)|0)|0;if((Y|0)==0&(W|0)==0)if((V|0)<0)break c;else break;if((W|0)<0){if((V|0)>0){X=1;Z=1;S=V;V=((V|0)<0)<<31>>31}else{S=_E(0,0,V|0,((V|0)<0)<<31>>31|0)|0;X=(V|0)<0?-1:0;Z=(V|0)<0?-1:0;S=(V|0)<0?S:0;V=(V|0)<0?E:0}if(!((W|0)>0|(W|0)==0&Y>>>0>0)){Y=_E(0,0,Y|0,W|0)|0;X=0-Z|0;W=E}do if((M|0)<=0)if((M|0)<0){c[g+88>>2]=-1;Z=_E(0,0,M|0,((M|0)<0)<<31>>31|0)|0;c[g+72>>2]=Z;c[g+76>>2]=E;Z=-1;break}else{c[g+88>>2]=0;c[g+72>>2]=0;c[g+76>>2]=0;Z=0;break}else{c[g+88>>2]=1;c[g+72>>2]=M;c[g+76>>2]=((M|0)<0)<<31>>31;Z=1}while(0);do if(!((K|0)>0|(K|0)==0&L>>>0>0))if((K|0)<0){c[g+88>>2]=0-Z;Z=_E(0,0,L|0,K|0)|0;c[g+80>>2]=Z;c[g+84>>2]=E;break}else{c[g+80>>2]=0;c[g+84>>2]=0;break}else{c[g+80>>2]=L;c[g+84>>2]=K}while(0);if((eE(S,V,Y,W,X,g+72|0)|0)>-1)break c}}while(0);Q=c[f>>2]|0;if((Q|0)==0){s=117;break b}if((c[Q+12>>2]|0)==0){s=117;break b}Q=c[c[Q+8>>2]>>2]|0;if((c[Q+20>>2]|0)<=(c[a+100>>2]|0)){s=117;break b}U=c[Q+12>>2]|0;R=c[U+88>>2]|0;S=R-P|0;P=c[U+92>>2]|0;T=P-O|0;U=c[U+96>>2]|0;V=U-N|0;Z=nF(S|0,((S|0)<0)<<31>>31|0,q|0,((q|0)<0)<<31>>31|0)|0;X=E;Y=nF(T|0,((T|0)<0)<<31>>31|0,d|0,((d|0)<0)<<31>>31|0)|0;X=bF(Y|0,E|0,Z|0,X|0)|0;Z=E;Y=nF(V|0,((V|0)<0)<<31>>31|0,I|0,J|0)|0;if(!((X|0)==(Y|0)&(Z|0)==(E|0))){s=117;break b}N=nF(S|0,((S|0)<0)<<31>>31|0,r|0,o|0)|0;Y=E;O=nF(T|0,((T|0)<0)<<31>>31|0,b|0,l|0)|0;Y=bF(O|0,E|0,N|0,Y|0)|0;N=E;O=nF(V|0,((V|0)<0)<<31>>31|0,m|0,n|0)|0;O=bF(Y|0,N|0,O|0,E|0)|0;N=E;T=(aa(T,k)|0)+(aa(S,j)|0)+(aa(V,p)|0)|0;R=R-F|0;Y=P-G|0;S=U-H|0;R=nF(R|0,((R|0)<0)<<31>>31|0,r|0,o|0)|0;Z=E;Y=nF(Y|0,((Y|0)<0)<<31>>31|0,b|0,l|0)|0;Z=bF(Y|0,E|0,R|0,Z|0)|0;R=E;S=nF(S|0,((S|0)<0)<<31>>31|0,m|0,n|0)|0;S=bF(Z|0,R|0,S|0,E|0)|0;R=E;if(!((R|0)>0|(R|0)==0&S>>>0>0)){s=117;break b}if((O|0)==0&(N|0)==0){if((T|0)>=0){s=117;break b}}else{if((N|0)>=0){s=117;break b}if((T|0)>0){U=1;V=1;P=T;T=((T|0)<0)<<31>>31}else{P=_E(0,0,T|0,((T|0)<0)<<31>>31|0)|0;U=(T|0)<0?-1:0;V=(T|0)<0?-1:0;P=(T|0)<0?P:0;T=(T|0)<0?E:0}if(!((N|0)>0|(N|0)==0&O>>>0>0)){O=_E(0,0,O|0,N|0)|0;U=0-V|0;N=E}do if((M|0)<=0)if((M|0)<0){c[g+64>>2]=-1;M=_E(0,0,M|0,((M|0)<0)<<31>>31|0)|0;c[g+48>>2]=M;c[g+52>>2]=E;M=-1;break}else{c[g+64>>2]=0;c[g+48>>2]=0;c[g+52>>2]=0;M=0;break}else{c[g+64>>2]=1;c[g+48>>2]=M;c[g+52>>2]=((M|0)<0)<<31>>31;M=1}while(0);do if(!((K|0)>0|(K|0)==0&L>>>0>0))if((K|0)<0){c[g+64>>2]=0-M;Z=_E(0,0,L|0,K|0)|0;c[g+56>>2]=Z;c[g+60>>2]=E;break}else{c[g+56>>2]=0;c[g+60>>2]=0;break}else{c[g+56>>2]=L;c[g+60>>2]=K}while(0);if((eE(P,T,O,N,U,g+48|0)|0)<=0){s=117;break b}}c[f>>2]=Q;N=c[Q+12>>2]|0;P=c[N+88>>2]|0;O=c[N+92>>2]|0;N=c[N+96>>2]|0;K=R;L=S}H=P-R|0;F=O-U|0;L=N-T|0;H=nF(H|0,((H|0)<0)<<31>>31|0,r|0,o|0)|0;G=E;F=nF(F|0,((F|0)<0)<<31>>31|0,b|0,l|0)|0;G=bF(F|0,E|0,H|0,G|0)|0;H=E;L=nF(L|0,((L|0)<0)<<31>>31|0,m|0,n|0)|0;L=bF(G|0,H|0,L|0,E|0)|0;c[e>>2]=(Q|0)==(s|0)?0:t;H=T;G=U;F=R;K=E}if((s|0)==117){i=g;return}}if((C|0)>=0){i=g;return}s=_E(0,0,u|0,((u|0)<0)<<31>>31|0)|0;t=E;while(1){F=(aa(A-w|0,k)|0)+(aa(z-v|0,p)|0)+(aa(B-x|0,j)|0)|0;d:do if((y|0)==0){u=F;y=F;F=((F|0)<0)<<31>>31}else{u=F;G=F;F=((F|0)<0)<<31>>31;while(1){if((c[y+12>>2]|0)==0){y=G;break d}K=c[(c[y+4>>2]|0)+8>>2]|0;if((c[K+20>>2]|0)<=(c[a+100>>2]|0)){y=G;break d}J=c[K+12>>2]|0;H=c[J+88>>2]|0;Z=H-B|0;I=c[J+92>>2]|0;Y=I-A|0;J=c[J+96>>2]|0;M=J-z|0;N=nF(Z|0,((Z|0)<0)<<31>>31|0,r|0,o|0)|0;X=E;P=nF(Y|0,((Y|0)<0)<<31>>31|0,b|0,l|0)|0;X=bF(P|0,E|0,N|0,X|0)|0;N=E;P=nF(M|0,((M|0)<0)<<31>>31|0,m|0,n|0)|0;P=bF(X|0,N|0,P|0,E|0)|0;N=E;M=(aa(Y,k)|0)+(aa(Z,j)|0)+(aa(M,p)|0)|0;if((P|0)==0&(N|0)==0){if((M|0)<=0){y=G;break d}}else{if((N|0)>=0){y=G;break d}if((M|0)>0){O=1;Q=1;L=M;M=((M|0)<0)<<31>>31}else{L=_E(0,0,M|0,((M|0)<0)<<31>>31|0)|0;O=(M|0)<0?-1:0;Q=(M|0)<0?-1:0;L=(M|0)<0?L:0;M=(M|0)<0?E:0}if(!((N|0)>0|(N|0)==0&P>>>0>0)){P=_E(0,0,P|0,N|0)|0;O=0-Q|0;N=E}do if((u|0)<=0)if((u|0)<0){c[g+40>>2]=-1;Q=_E(0,0,G|0,F|0)|0;c[g+24>>2]=Q;c[g+28>>2]=E;Q=-1;break}else{c[g+40>>2]=0;c[g+24>>2]=0;c[g+28>>2]=0;Q=0;break}else{c[g+40>>2]=1;c[g+24>>2]=G;c[g+28>>2]=F;Q=1}while(0);do if(!((C|0)>0|(C|0)==0&D>>>0>0))if((C|0)<0){c[g+40>>2]=0-Q;Z=_E(0,0,D|0,C|0)|0;c[g+32>>2]=Z;c[g+36>>2]=E;break}else{c[g+32>>2]=0;c[g+36>>2]=0;break}else{c[g+32>>2]=D;c[g+36>>2]=C}while(0);if((eE(L,M,P,N,O,g+24|0)|0)>=1){y=G;break d}}F=H-x|0;Y=I-w|0;Z=J-v|0;C=nF(F|0,((F|0)<0)<<31>>31|0,r|0,o|0)|0;X=E;D=nF(Y|0,((Y|0)<0)<<31>>31|0,b|0,l|0)|0;X=bF(D|0,E|0,C|0,X|0)|0;C=E;D=nF(Z|0,((Z|0)<0)<<31>>31|0,m|0,n|0)|0;D=bF(X|0,C|0,D|0,E|0)|0;C=E;y=(y|0)==(h|0)?0:K;c[f>>2]=y;F=(aa(Y,k)|0)+(aa(Z,p)|0)+(aa(F,j)|0)|0;if((y|0)==0){z=J;A=I;B=H;u=F;y=F;F=((F|0)<0)<<31>>31;break}else{B=H;A=I;z=J;u=F;G=F;F=((F|0)<0)<<31>>31}}}while(0);G=c[e>>2]|0;if((G|0)==0){s=117;break}if((c[G+12>>2]|0)==0){s=117;break}G=c[(c[G+8>>2]|0)+4>>2]|0;if((c[G+20>>2]|0)<=(c[a+100>>2]|0)){s=117;break}K=c[G+12>>2]|0;H=c[K+88>>2]|0;I=H-x|0;x=c[K+92>>2]|0;J=x-w|0;K=c[K+96>>2]|0;L=K-v|0;Z=nF(I|0,((I|0)<0)<<31>>31|0,q|0,((q|0)<0)<<31>>31|0)|0;X=E;Y=nF(J|0,((J|0)<0)<<31>>31|0,d|0,((d|0)<0)<<31>>31|0)|0;X=bF(Y|0,E|0,Z|0,X|0)|0;Z=E;Y=nF(L|0,((L|0)<0)<<31>>31|0,s|0,t|0)|0;if(!((X|0)==(Y|0)&(Z|0)==(E|0))){s=117;break}v=nF(I|0,((I|0)<0)<<31>>31|0,r|0,o|0)|0;Y=E;w=nF(J|0,((J|0)<0)<<31>>31|0,b|0,l|0)|0;Y=bF(w|0,E|0,v|0,Y|0)|0;v=E;w=nF(L|0,((L|0)<0)<<31>>31|0,m|0,n|0)|0;w=bF(Y|0,v|0,w|0,E|0)|0;v=E;J=(aa(J,k)|0)+(aa(I,j)|0)+(aa(L,p)|0)|0;H=B-H|0;Y=A-x|0;I=z-K|0;H=nF(H|0,((H|0)<0)<<31>>31|0,r|0,o|0)|0;Z=E;Y=nF(Y|0,((Y|0)<0)<<31>>31|0,b|0,l|0)|0;Z=bF(Y|0,E|0,H|0,Z|0)|0;H=E;I=nF(I|0,((I|0)<0)<<31>>31|0,m|0,n|0)|0;I=bF(Z|0,H|0,I|0,E|0)|0;H=E;if((H|0)>=0){s=117;break}if((w|0)==0&(v|0)==0){if((J|0)<=0){s=117;break}}else{if((v|0)>=0){s=117;break}if((J|0)>0){K=1;L=1;x=J;J=((J|0)<0)<<31>>31}else{x=_E(0,0,J|0,((J|0)<0)<<31>>31|0)|0;K=(J|0)<0?-1:0;L=(J|0)<0?-1:0;x=(J|0)<0?x:0;J=(J|0)<0?E:0}if(!((v|0)>0|(v|0)==0&w>>>0>0)){w=_E(0,0,w|0,v|0)|0;K=0-L|0;v=E}do if((u|0)<=0)if((u|0)<0){c[g+16>>2]=-1;u=_E(0,0,y|0,F|0)|0;c[g>>2]=u;c[g+4>>2]=E;u=-1;break}else{c[g+16>>2]=0;c[g>>2]=0;c[g+4>>2]=0;u=0;break}else{c[g+16>>2]=1;c[g>>2]=y;c[g+4>>2]=F;u=1}while(0);do if(!((C|0)>0|(C|0)==0&D>>>0>0))if((C|0)<0){c[g+16>>2]=0-u;Z=_E(0,0,D|0,C|0)|0;c[g+8>>2]=Z;c[g+12>>2]=E;break}else{c[g+8>>2]=0;c[g+12>>2]=0;break}else{c[g+8>>2]=D;c[g+12>>2]=C}while(0);if((eE(x,J,w,v,K,g)|0)>=0){s=117;break}}c[e>>2]=G;x=c[G+12>>2]|0;v=c[x+96>>2]|0;w=c[x+92>>2]|0;x=c[x+88>>2]|0;y=c[f>>2]|0;D=I;C=H}if((s|0)==117){i=g;return}}function jE(a){a=a|0;var b=0,d=0,e=0,f=0.0,g=0,h=0,j=0;b=i;i=i+16|0;e=c[a+8>>2]|0;d=c[a+12>>2]|0;if((d|0)>-1|(d|0)==-1&e>>>0>4294967295){f=(+(e>>>0)+4294967296.0*+(d>>>0))*18446744073709552000.0+(+((c[a>>2]|0)>>>0)+4294967296.0*+((c[a+4>>2]|0)>>>0));i=b;return+f}else{j=c[a>>2]|0;h=c[a+4>>2]|0;g=_E(0,0,j|0,h|0)|0;a=E;e=bF((j|0)==0&(h|0)==0&1|0,0,~e|0,~d|0)|0;c[b>>2]=g;c[b+4>>2]=a;c[b+8>>2]=e;c[b+12>>2]=E;f=-+jE(b);i=b;return+f}return 0.0}function kE(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0,A=0,B=0,C=0,D=0,E=0;f=i;i=i+256|0;if((e|0)<1){e=c[b+12>>2]|0;if((e|0)!=0){if((a[b+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+12>>2]=0}a[b+16>>0]=1;c[b+12>>2]=0;c[b+4>>2]=0;c[b+8>>2]=0;e=c[b+32>>2]|0;if((e|0)!=0){if((a[b+36>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+32>>2]=0}a[b+36>>0]=1;c[b+32>>2]=0;c[b+24>>2]=0;c[b+28>>2]=0;e=c[b+52>>2]|0;if((e|0)!=0){if((a[b+56>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+52>>2]=0}a[b+56>>0]=1;c[b+52>>2]=0;c[b+44>>2]=0;c[b+48>>2]=0;i=f;return}c[f+88>>2]=0;c[f+92>>2]=0;h=f+96|0;c[h>>2]=0;c[f+100>>2]=256;c[f+104>>2]=0;c[f+108>>2]=0;c[f+112>>2]=0;c[f+116>>2]=256;c[f+120>>2]=0;c[f+124>>2]=0;c[f+128>>2]=0;c[f+132>>2]=256;a[f+152>>0]=1;j=f+148|0;c[j>>2]=0;c[f+140>>2]=0;c[f+144>>2]=0;t=1.0000000150474662e+30;x=1.0000000150474662e+30;u=1.0000000150474662e+30;y=-1.0000000150474662e+30;w=-1.0000000150474662e+30;v=-1.0000000150474662e+30;n=0;m=d;while(1){q=+g[m>>2];r=+g[m+4>>2];s=+g[m+8>>2];t=q<t?q:t;x=r<x?r:x;u=s<u?s:u;y=y<q?q:y;w=w<r?r:w;v=v<s?s:v;n=n+1|0;if((n|0)==(e|0))break;else m=m+16|0}q=y-t;r=w-x;s=v-u;if(q<r){c[f+168>>2]=r<s?2:1;m=q<s?0:2;p=f+168|0}else{c[f+168>>2]=q<s?2:0;m=r<s?1:2;p=f+168|0}c[f+160>>2]=m;n=c[p>>2]|0;if((m|0)==(n|0)){m=((m+1|0)>>>0)%3|0;c[f+160>>2]=m;n=c[p>>2]|0}E=3-n-m|0;c[f+164>>2]=E;if(((E+1|0)%3|0|0)==(c[p>>2]|0)){q=q*9788566967472434.0e-20;r=r*9788566967472434.0e-20;s=s*9788566967472434.0e-20}else{q=q*9788566967472434.0e-20*-1.0;r=r*9788566967472434.0e-20*-1.0;s=s*9788566967472434.0e-20*-1.0}g[f+56>>2]=q;g[f+60>>2]=r;g[f+64>>2]=s;g[f+68>>2]=0.0;if(q!=0.0)q=1.0/q;if(r!=0.0)r=1.0/r;if(s!=0.0)s=1.0/s;g[f+72>>2]=(t+y)*.5;g[f+76>>2]=(x+w)*.5;g[f+80>>2]=(u+v)*.5;g[f+84>>2]=0.0;m=f+248|0;a[m>>0]=1;n=f+244|0;c[n>>2]=0;o=f+236|0;c[o>>2]=0;c[f+240>>2]=0;if((e|0)>0){c[5004]=(c[5004]|0)+1;z=XE((e<<4|3)+16|0)|0;if((z|0)==0)z=0;else{c[(z+19&-16)+ -4>>2]=z;z=z+19&-16}C=c[o>>2]|0;if((C|0)>0){A=0;do{B=z+(A<<4)|0;if((B|0)!=0){E=(c[n>>2]|0)+(A<<4)|0;c[B+0>>2]=c[E+0>>2];c[B+4>>2]=c[E+4>>2];c[B+8>>2]=c[E+8>>2];c[B+12>>2]=c[E+12>>2]}A=A+1|0}while((A|0)!=(C|0))}A=c[n>>2]|0;if((A|0)!=0){if((a[m>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[A+ -4>>2]|0)}c[n>>2]=0}a[m>>0]=1;c[n>>2]=z;c[f+240>>2]=e;A=0;while(1){z=z+(A<<4)|0;if((z|0)!=0){c[z+0>>2]=c[f+216>>2];c[z+4>>2]=c[f+220>>2];c[z+8>>2]=c[f+224>>2];c[z+12>>2]=c[f+228>>2]}A=A+1|0;if((A|0)==(e|0))break;z=c[n>>2]|0}c[o>>2]=e;z=c[n>>2]|0;u=+g[f+72>>2];v=+g[f+76>>2];t=+g[f+80>>2];A=0;while(1){w=+g[d>>2];g[f+200>>2]=w;x=+g[d+4>>2];g[f+204>>2]=x;y=s*(+g[d+8>>2]-t);g[f+200>>2]=q*(w-u);g[f+204>>2]=r*(x-v);g[f+208>>2]=y;g[f+212>>2]=0.0;c[z+(A<<4)>>2]=~~+g[f+200+(c[f+164>>2]<<2)>>2];c[z+(A<<4)+4>>2]=~~+g[f+200+(c[p>>2]<<2)>>2];c[z+(A<<4)+8>>2]=~~+g[f+200+(c[f+160>>2]<<2)>>2];c[z+(A<<4)+12>>2]=A;A=A+1|0;if((A|0)==(e|0))break;d=d+16|0}d=c[o>>2]|0;if((d|0)>1)lE(f+232|0,0,d+ -1|0)}else c[o>>2]=e;c[f+92>>2]=c[f+88>>2];c[h>>2]=0;c[f+100>>2]=e;d=c[f+140>>2]|0;if((d|0)<(e|0)){if((c[f+144>>2]|0)<(e|0)){if((e|0)==0){p=0;z=d}else{c[5004]=(c[5004]|0)+1;p=XE((e<<2|3)+16|0)|0;if((p|0)==0)p=0;else{c[(p+19&-16)+ -4>>2]=p;p=p+19&-16}z=c[f+140>>2]|0}if((z|0)>0){B=0;do{A=p+(B<<2)|0;if((A|0)!=0)c[A>>2]=c[(c[j>>2]|0)+(B<<2)>>2];B=B+1|0}while((B|0)!=(z|0))}z=c[j>>2]|0;if((z|0)!=0){if((a[f+152>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[z+ -4>>2]|0)}c[j>>2]=0}a[f+152>>0]=1;c[j>>2]=p;c[f+144>>2]=e}do{p=(c[j>>2]|0)+(d<<2)|0;if((p|0)!=0)c[p>>2]=0;d=d+1|0}while((d|0)!=(e|0))}c[f+140>>2]=e;if((e|0)>0){d=0;do{p=c[h>>2]|0;if((p|0)==0){p=c[f+92>>2]|0;if((p|0)==0){c[5004]=(c[5004]|0)+1;p=XE(31)|0;if((p|0)!=0?(l=p+19&-16,c[l+ -4>>2]=p,(p+19&-16|0)!=0):0){z=c[f+100>>2]|0;c[l+4>>2]=z;c[l+8>>2]=0;c[5004]=(c[5004]|0)+1;z=XE((z*112|3)+16|0)|0;if((z|0)==0)z=0;else{c[(z+19&-16)+ -4>>2]=z;z=z+19&-16}c[(p+19&-16)>>2]=z;p=p+19&-16}else p=0;c[p+8>>2]=c[f+88>>2];c[f+88>>2]=p}else c[f+92>>2]=c[p+8>>2];z=c[p+4>>2]|0;if((z|0)>0){A=0;B=c[p>>2]|0;do{A=A+1|0;E=B;B=B+112|0;c[E>>2]=(A|0)<(z|0)?B:0}while((A|0)!=(z|0))}p=c[p>>2]|0;c[h>>2]=c[p>>2];if((p|0)==0)p=0;else k=85}else{c[h>>2]=c[p>>2];k=85}if((k|0)==85){k=0;E=p+104|0;c[p+0>>2]=0;c[p+4>>2]=0;c[p+8>>2]=0;c[p+12>>2]=0;c[p+16>>2]=0;c[E>>2]=-1}c[p+8>>2]=0;E=p+88|0;D=(c[n>>2]|0)+(d<<4)|0;c[E+0>>2]=c[D+0>>2];c[E+4>>2]=c[D+4>>2];c[E+8>>2]=c[D+8>>2];c[E+12>>2]=c[D+12>>2];c[p+104>>2]=-1;c[(c[j>>2]|0)+(d<<2)>>2]=p;d=d+1|0}while((d|0)<(e|0))}h=c[n>>2]|0;if((h|0)!=0){if((a[m>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[n>>2]=0}a[m>>0]=1;c[n>>2]=0;c[o>>2]=0;c[f+240>>2]=0;c[f+108>>2]=c[f+104>>2];c[f+112>>2]=0;c[f+116>>2]=e*6;c[f+172>>2]=0;c[f+176>>2]=0;c[f+156>>2]=-3;c[f+184>>2]=0;c[f+188>>2]=0;c[f+192>>2]=0;c[f+196>>2]=0;gE(f+56|0,0,e,f+184|0);c[f+180>>2]=c[f+184>>2];e=c[n>>2]|0;if((e|0)!=0){if((a[m>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[n>>2]=0}e=c[b+4>>2]|0;if((e|0)<0){if((c[b+8>>2]|0)<0){h=c[b+12>>2]|0;if((h|0)!=0){if((a[b+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[b+12>>2]=0}a[b+16>>0]=1;c[b+12>>2]=0;c[b+8>>2]=0}do{E=(c[b+12>>2]|0)+(e<<4)|0;c[E+0>>2]=c[f+40>>2];c[E+4>>2]=c[f+44>>2];c[E+8>>2]=c[f+48>>2];c[E+12>>2]=c[f+52>>2];e=e+1|0}while((e|0)!=0)}c[b+4>>2]=0;c[f+24>>2]=0;c[f+28>>2]=0;c[f+32>>2]=0;h=c[b+24>>2]|0;if((h|0)<0){if((c[b+28>>2]|0)<0){e=c[b+32>>2]|0;if((e|0)!=0){if((a[b+36>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+32>>2]=0}a[b+36>>0]=1;c[b+32>>2]=0;c[b+28>>2]=0}do{e=(c[b+32>>2]|0)+(h*12|0)|0;if((e|0)!=0){c[e+0>>2]=c[f+24>>2];c[e+4>>2]=c[f+28>>2];c[e+8>>2]=c[f+32>>2]}h=h+1|0}while((h|0)!=0)}c[b+24>>2]=0;h=c[b+44>>2]|0;if((h|0)<0){e=c[b+52>>2]|0;if((c[b+48>>2]|0)<0){if((e|0)!=0){if((a[b+56>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+52>>2]=0}a[b+56>>0]=1;c[b+52>>2]=0;c[b+48>>2]=0;e=0}j=h;do{h=e+(j<<2)|0;if((h|0)!=0)c[h>>2]=0;j=j+1|0}while((j|0)!=0)}c[b+44>>2]=0;e=c[f+180>>2]|0;if((c[e+104>>2]|0)<0){c[e+104>>2]=0;c[5004]=(c[5004]|0)+1;h=XE(23)|0;if((h|0)!=0){c[(h+19&-16)+ -4>>2]=h;p=h+19&-16;if((h+19&-16|0)!=0)c[p>>2]=e}else p=0;j=1;o=1;e=0;while(1){h=c[p+(e<<2)>>2]|0;if((c[h+100>>2]|0)>-1){g[f+232+(c[f+164>>2]<<2)>>2]=+(c[h+88>>2]|0);g[f+232+(c[f+168>>2]<<2)>>2]=+(c[h+92>>2]|0);q=+(c[h+96>>2]|0)}else{q=+jE(h+24|0);q=q/+jE(h+72|0);g[f+232+(c[f+164>>2]<<2)>>2]=q;q=+jE(h+40|0);q=q/+jE(h+72|0);g[f+232+(c[f+168>>2]<<2)>>2]=q;q=+jE(h+56|0);q=q/+jE(h+72|0)}g[f+232+(c[f+160>>2]<<2)>>2]=q;s=+g[f+232>>2]*+g[f+56>>2]+ +g[f+72>>2];q=+g[f+236>>2]*+g[f+60>>2]+ +g[f+76>>2];r=+g[f+240>>2]*+g[f+64>>2]+ +g[f+80>>2];m=c[b+4>>2]|0;do if((m|0)==(c[b+8>>2]|0)){k=(m|0)==0?1:m<<1;if((m|0)>=(k|0))break;if((k|0)==0)l=0;else{c[5004]=(c[5004]|0)+1;l=XE((k<<4|3)+16|0)|0;if((l|0)==0)l=0;else{c[(l+19&-16)+ -4>>2]=l;l=l+19&-16}m=c[b+4>>2]|0}if((m|0)>0){n=0;do{E=l+(n<<4)|0;D=(c[b+12>>2]|0)+(n<<4)|0;c[E+0>>2]=c[D+0>>2];c[E+4>>2]=c[D+4>>2];c[E+8>>2]=c[D+8>>2];c[E+12>>2]=c[D+12>>2];n=n+1|0}while((n|0)!=(m|0))}m=c[b+12>>2]|0;if((m|0)!=0){if((a[b+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[m+ -4>>2]|0)}c[b+12>>2]=0}a[b+16>>0]=1;c[b+12>>2]=l;c[b+8>>2]=k;m=c[b+4>>2]|0}while(0);E=c[b+12>>2]|0;g[E+(m<<4)>>2]=s;g[E+(m<<4)+4>>2]=q;g[E+(m<<4)+8>>2]=r;g[E+(m<<4)+12>>2]=0.0;c[b+4>>2]=(c[b+4>>2]|0)+1;h=c[h+8>>2]|0;if((h|0)!=0){k=h;l=-1;m=-1;do{n=k+20|0;d=c[n>>2]|0;if((d|0)<0){d=c[b+24>>2]|0;c[f+12>>2]=0;c[f+16>>2]=0;c[f+20>>2]=0;z=c[b+28>>2]|0;do if((d|0)==(z|0)){z=(d|0)==0?1:d<<1;if((d|0)>=(z|0)){A=d;z=d;break}if((z|0)==0){A=0;D=d}else{c[5004]=(c[5004]|0)+1;A=XE((z*12|3)+16|0)|0;if((A|0)==0)A=0;else{c[(A+19&-16)+ -4>>2]=A;A=A+19&-16}D=c[b+24>>2]|0}if((D|0)>0){C=0;do{B=A+(C*12|0)|0;if((B|0)!=0){E=(c[b+32>>2]|0)+(C*12|0)|0;c[B+0>>2]=c[E+0>>2];c[B+4>>2]=c[E+4>>2];c[B+8>>2]=c[E+8>>2]}C=C+1|0}while((C|0)!=(D|0))}B=c[b+32>>2]|0;if((B|0)!=0){if((a[b+36>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[B+ -4>>2]|0)}c[b+32>>2]=0}a[b+36>>0]=1;c[b+32>>2]=A;c[b+28>>2]=z;A=c[b+24>>2]|0}else A=d;while(0);B=(c[b+32>>2]|0)+(A*12|0)|0;if((B|0)==0)D=z;else{c[B+0>>2]=c[f+12>>2];c[B+4>>2]=c[f+16>>2];c[B+8>>2]=c[f+20>>2];A=c[b+24>>2]|0;D=c[b+28>>2]|0}z=A+1|0;c[b+24>>2]=z;c[f+0>>2]=0;c[f+4>>2]=0;c[f+8>>2]=0;do if((z|0)==(D|0)){z=(D|0)==0?1:D<<1;if((D|0)>=(z|0))break;if((z|0)==0)A=0;else{c[5004]=(c[5004]|0)+1;A=XE((z*12|3)+16|0)|0;if((A|0)==0)A=0;else{c[(A+19&-16)+ -4>>2]=A;A=A+19&-16}D=c[b+24>>2]|0}if((D|0)>0){C=0;do{B=A+(C*12|0)|0;if((B|0)!=0){E=(c[b+32>>2]|0)+(C*12|0)|0;c[B+0>>2]=c[E+0>>2];c[B+4>>2]=c[E+4>>2];c[B+8>>2]=c[E+8>>2]}C=C+1|0}while((C|0)!=(D|0))}B=c[b+32>>2]|0;if((B|0)!=0){if((a[b+36>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[B+ -4>>2]|0)}c[b+32>>2]=0}a[b+36>>0]=1;c[b+32>>2]=A;c[b+28>>2]=z;D=c[b+24>>2]|0}else D=z;while(0);z=c[b+32>>2]|0;A=z+(D*12|0)|0;if((A|0)!=0){c[A+0>>2]=c[f+0>>2];c[A+4>>2]=c[f+4>>2];c[A+8>>2]=c[f+8>>2];D=c[b+24>>2]|0;z=c[b+32>>2]|0}c[b+24>>2]=D+1;c[n>>2]=d;c[(c[k+8>>2]|0)+20>>2]=d+1;c[z+(d*12|0)+4>>2]=1;c[z+((d+1|0)*12|0)+4>>2]=-1;A=c[k+12>>2]|0;B=c[A+104>>2]|0;if((B|0)<0){c[A+104>>2]=j;do if((j|0)==(o|0)){B=(o|0)==0?1:o<<1;if((o|0)>=(B|0))break;do if((B|0)==0)C=0;else{c[5004]=(c[5004]|0)+1;C=XE((B<<2|3)+16|0)|0;if((C|0)==0){C=0;break}c[(C+19&-16)+ -4>>2]=C;C=C+19&-16}while(0);if((o|0)>0){E=0;do{D=C+(E<<2)|0;if((D|0)!=0)c[D>>2]=c[p+(E<<2)>>2];E=E+1|0}while((E|0)!=(o|0))}if((p|0)==0){p=C;o=B;break}c[5006]=(c[5006]|0)+1;YE(c[p+ -4>>2]|0);p=C;o=B}while(0);B=p+(j<<2)|0;if((B|0)!=0)c[B>>2]=A;A=j+1|0}else{A=j;j=B}c[z+(d*12|0)+8>>2]=j;c[z+((d+1|0)*12|0)+8>>2]=e;d=c[n>>2]|0;j=A}if((m|0)>-1){c[(c[b+32>>2]|0)+(d*12|0)>>2]=m-d;m=c[n>>2]|0}else{m=d;l=d}k=c[k>>2]|0}while((k|0)!=(h|0));c[(c[b+32>>2]|0)+(l*12|0)>>2]=m-l}h=e+1|0;if((h|0)<(j|0))e=h;else break}if((e|0)>-1){k=0;do{e=c[(c[p+(k<<2)>>2]|0)+8>>2]|0;if((e|0)!=0){j=e;do{l=j+20|0;if((c[l>>2]|0)>-1){d=c[b+44>>2]|0;do if((d|0)==(c[b+48>>2]|0)){m=(d|0)==0?1:d<<1;if((d|0)>=(m|0))break;if((m|0)==0)n=0;else{c[5004]=(c[5004]|0)+1;n=XE((m<<2|3)+16|0)|0;if((n|0)==0)n=0;else{c[(n+19&-16)+ -4>>2]=n;n=n+19&-16}d=c[b+44>>2]|0}if((d|0)>0){o=0;do{z=n+(o<<2)|0;if((z|0)!=0)c[z>>2]=c[(c[b+52>>2]|0)+(o<<2)>>2];o=o+1|0}while((o|0)!=(d|0))}o=c[b+52>>2]|0;if((o|0)!=0){if((a[b+56>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[o+ -4>>2]|0)}c[b+52>>2]=0}a[b+56>>0]=1;c[b+52>>2]=n;c[b+48>>2]=m;d=c[b+44>>2]|0}while(0);m=(c[b+52>>2]|0)+(d<<2)|0;if((m|0)!=0){c[m>>2]=c[l>>2];d=c[b+44>>2]|0}c[b+44>>2]=d+1;l=j;do{c[l+20>>2]=-1;l=c[(c[l+8>>2]|0)+4>>2]|0}while((l|0)!=(j|0))}j=c[j>>2]|0}while((j|0)!=(e|0))}k=k+1|0}while((k|0)<(h|0))}if((p|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[p+ -4>>2]|0)}}mE(f+56|0);i=f;return}function lE(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0;j=i;i=i+16|0;h=c[a+12>>2]|0;f=c[h+(((d+b|0)/2|0)<<4)>>2]|0;g=c[h+(((d+b|0)/2|0)<<4)+4>>2]|0;e=c[h+(((d+b|0)/2|0)<<4)+8>>2]|0;k=b;l=d;while(1){while(1){m=c[h+(k<<4)+4>>2]|0;if((m|0)>=(g|0)){if((m|0)!=(g|0))break;m=c[h+(k<<4)>>2]|0;if((m|0)>=(f|0)){if((m|0)!=(f|0))break;if((c[h+(k<<4)+8>>2]|0)>=(e|0))break}}k=k+1|0}while(1){m=c[h+(l<<4)+4>>2]|0;if((g|0)>=(m|0)){if((g|0)!=(m|0))break;m=c[h+(l<<4)>>2]|0;if((f|0)>=(m|0)){if((f|0)!=(m|0))break;if((e|0)>=(c[h+(l<<4)+8>>2]|0))break}}l=l+ -1|0}if((k|0)<=(l|0)){m=h+(k<<4)|0;c[j+0>>2]=c[m+0>>2];c[j+4>>2]=c[m+4>>2];c[j+8>>2]=c[m+8>>2];c[j+12>>2]=c[m+12>>2];h=h+(l<<4)|0;c[m+0>>2]=c[h+0>>2];c[m+4>>2]=c[h+4>>2];c[m+8>>2]=c[h+8>>2];c[m+12>>2]=c[h+12>>2];m=(c[a+12>>2]|0)+(l<<4)|0;c[m+0>>2]=c[j+0>>2];c[m+4>>2]=c[j+4>>2];c[m+8>>2]=c[j+8>>2];c[m+12>>2]=c[j+12>>2];k=k+1|0;l=l+ -1|0}if((k|0)>(l|0))break;h=c[a+12>>2]|0}if((l|0)>(b|0))lE(a,b,l);if((k|0)>=(d|0)){i=j;return}lE(a,k,d);i=j;return}function mE(b){b=b|0;var d=0,e=0,f=0;d=i;e=c[b+92>>2]|0;if((e|0)!=0){if((a[b+96>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+92>>2]=0}a[b+96>>0]=1;c[b+92>>2]=0;c[b+84>>2]=0;c[b+88>>2]=0;e=c[b+64>>2]|0;if((e|0)!=0)do{c[b+64>>2]=c[e+8>>2];f=c[e>>2]|0;if((f|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0);e=c[b+64>>2]|0}while((e|0)!=0);f=c[b+48>>2]|0;if((f|0)!=0)do{c[b+48>>2]=c[f+8>>2];e=c[f>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0);f=c[b+48>>2]|0}while((f|0)!=0);e=c[b+32>>2]|0;if((e|0)==0){i=d;return}do{c[b+32>>2]=c[e+8>>2];f=c[e>>2]|0;if((f|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0);e=c[b+32>>2]|0}while((e|0)!=0);i=d;return}function nE(a){a=a|0;var b=0,d=0;b=i;do{c[a+4>>2]=0;g[a+8>>2]=0.0;d=c[a+24>>2]|0;if((d|0)!=0)nE(d);a=c[a+28>>2]|0}while((a|0)!=0);i=b;return}function oE(a){a=a|0;var b=0,d=0,e=0,f=0;b=i;i=i+16|0;d=c[5022]|0;if((c[d>>2]|0)!=(a|0)){f=c[d+24>>2]|0;a:do if((f|0)==0)e=5;else while(1){if((c[f>>2]|0)==(a|0)){d=f;break a}f=c[f+28>>2]|0;if((f|0)==0){e=5;break}}while(0);if((e|0)==5){e=XE(36)|0;b:do if((e|0)==0){while(1){e=c[5158]|0;c[5158]=e+0;if((e|0)==0)break;sc[e&3]();e=XE(36)|0;if((e|0)!=0)break b}f=Ab(4)|0;c[f>>2]=20472;yb(f|0,20520,265)}while(0);c[e>>2]=a;a=e+4|0;f=e+20|0;c[a+0>>2]=0;c[a+4>>2]=0;c[a+8>>2]=0;c[a+12>>2]=0;c[f>>2]=d;c[e+24>>2]=0;f=e+28|0;c[f>>2]=0;c[e+32>>2]=0;nE(e);c[f>>2]=c[d+24>>2];c[d+24>>2]=e;d=e}c[5022]=d}e=d+4|0;c[e>>2]=(c[e>>2]|0)+1;e=d+16|0;f=c[e>>2]|0;c[e>>2]=f+1;if((f|0)!=0){i=b;return}Eb(b|0,0)|0;f=c[5008]|0;c[d+12>>2]=(c[b+4>>2]|0)-(c[f+4>>2]|0)+(((c[b>>2]|0)-(c[f>>2]|0)|0)*1e6|0);i=b;return}function pE(){var a=0,b=0;a=i;b=XE(8)|0;a:do if((b|0)==0){while(1){b=c[5158]|0;c[5158]=b+0;if((b|0)==0)break;sc[b&3]();b=XE(8)|0;if((b|0)!=0)break a}b=Ab(4)|0;c[b>>2]=20472;yb(b|0,20520,265)}while(0);c[5008]=b;Eb(b|0,0)|0;c[5010]=20080;c[5011]=0;c[5012]=0;c[5013]=0;c[5014]=0;c[5015]=0;c[5016]=0;c[5017]=0;c[5018]=0;nE(20040);i=a;return}function qE(a,b){a=a|0;b=b|0;var d=0;d=i;i=i+16|0;c[d>>2]=b;b=c[o>>2]|0;_a(b|0,a|0,d|0)|0;xb(10,b|0)|0;zb()}function rE(){var a=0,b=0,d=0,e=0;a=i;i=i+16|0;if((sb(20288,3)|0)!=0)qE(20296,a);b=pb(c[5070]|0)|0;if((b|0)==0)qE(20264,a);b=c[b>>2]|0;if((b|0)==0)qE(20264,a);d=c[b+48>>2]|0;e=c[b+52>>2]|0;if(!((d&-256|0)==1126902528&(e|0)==1129074247)){c[a>>2]=20112;qE(20224,a)}if((d|0)==1126902529&(e|0)==1129074247)d=c[b+44>>2]|0;else d=b+80|0;c[a+12>>2]=d;e=c[b>>2]|0;b=c[e+4>>2]|0;if(FE(20656,e,a+12|0)|0){e=c[a+12>>2]|0;e=Pb[c[(c[e>>2]|0)+8>>2]&127](e)|0;c[a>>2]=20112;c[a+4>>2]=b;c[a+8>>2]=e;qE(20128,a)}else{c[a>>2]=20112;c[a+4>>2]=b;qE(20176,a)}}function sE(){var a=0;a=i;i=i+16|0;if((tb(20280,273)|0)==0){i=a;return}else qE(20352,a)}function tE(a){a=a|0;var b=0;b=i;i=i+16|0;YE(a);if((wb(c[5070]|0,0)|0)==0){i=b;return}else qE(20408,b)}function uE(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function vE(a){a=a|0;return}function wE(a){a=a|0;return 20488}function xE(a){a=a|0;var b=0;b=i;i=i+16|0;sc[a&3]();qE(20536,b)}function yE(){var a=0,b=0;b=i;i=i+16|0;if((sb(20288,3)|0)!=0)qE(20296,b);b=pb(c[5070]|0)|0;if(((b|0)!=0?(a=c[b>>2]|0,(a|0)!=0):0)?(c[a+52>>2]|0)==1129074247?(c[a+48>>2]&-256|0)==1126902528:0:0)xE(c[a+12>>2]|0);b=c[5026]|0;c[5026]=b+0;xE(b)}function zE(a){a=a|0;return}function AE(a){a=a|0;return}function BE(a){a=a|0;return}function CE(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function DE(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function EE(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function FE(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,g=0;e=i;i=i+64|0;if((a|0)==(b|0)){g=1;i=e;return g|0}if((b|0)==0){g=0;i=e;return g|0}b=LE(b,20784)|0;if((b|0)==0){g=0;i=e;return g|0}g=e+0|0;f=g+56|0;do{c[g>>2]=0;g=g+4|0}while((g|0)<(f|0));c[e>>2]=b;c[e+8>>2]=a;c[e+12>>2]=-1;c[e+48>>2]=1;vc[c[(c[b>>2]|0)+28>>2]&127](b,e,c[d>>2]|0,1);if((c[e+24>>2]|0)!=1){g=0;i=e;return g|0}c[d>>2]=c[e+16>>2];g=1;i=e;return g|0}function GE(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,g=0;f=i;g=c[b+16>>2]|0;if((g|0)==0){c[b+16>>2]=d;c[b+24>>2]=e;c[b+36>>2]=1;i=f;return}if((g|0)!=(d|0)){c[b+36>>2]=(c[b+36>>2]|0)+1;c[b+24>>2]=2;a[b+54>>0]=1;i=f;return}if((c[b+24>>2]|0)!=2){i=f;return}c[b+24>>2]=e;i=f;return}function HE(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;if((c[b+8>>2]|0)!=(a|0)){i=f;return}GE(b,d,e);i=f;return}function IE(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;if((a|0)==(c[b+8>>2]|0)){GE(b,d,e);i=f;return}else{a=c[a+8>>2]|0;vc[c[(c[a>>2]|0)+28>>2]&127](a,b,d,e);i=f;return}}function JE(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,g=0,h=0;f=i;g=c[a+4>>2]|0;if((g&1|0)==0)h=g>>8;else h=c[(c[d>>2]|0)+(g>>8)>>2]|0;a=c[a>>2]|0;vc[c[(c[a>>2]|0)+28>>2]&127](a,b,d+h|0,(g&2|0)!=0?e:2);i=f;return}function KE(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var g=0,h=0,j=0;g=i;if((b|0)==(c[d+8>>2]|0)){GE(d,e,f);i=g;return}h=c[b+12>>2]|0;JE(b+16|0,d,e,f);if((h|0)<=1){i=g;return}j=b+24|0;while(1){JE(j,d,e,f);if((a[d+54>>0]|0)!=0){f=7;break}j=j+8|0;if(!(j>>>0<(b+(h<<3)+16|0)>>>0)){f=7;break}}if((f|0)==7){i=g;return}}function LE(d,e){d=d|0;e=e|0;var f=0,g=0,h=0,j=0;f=i;i=i+64|0;g=c[d>>2]|0;h=d+(c[g+ -8>>2]|0)|0;g=c[g+ -4>>2]|0;c[f>>2]=e;c[f+4>>2]=d;c[f+8>>2]=20728;j=f+12|0;d=j+40|0;do{c[j>>2]=0;j=j+4|0}while((j|0)<(d|0));b[f+52>>1]=0;a[f+54>>0]=0;do if((g|0)==(e|0)){c[f+48>>2]=1;Zb[c[(c[g>>2]|0)+20>>2]&7](g,f,h,h,1,0);e=(c[f+24>>2]|0)==1?h:0}else{Jb[c[(c[g>>2]|0)+24>>2]&31](g,f,h,1,0);e=c[f+36>>2]|0;if((e|0)==0){if((c[f+40>>2]|0)!=1){e=0;break}if((c[f+28>>2]|0)!=1){e=0;break}e=(c[f+32>>2]|0)==1?c[f+20>>2]|0:0;break}else if((e|0)!=1){e=0;break}if((c[f+24>>2]|0)!=1){if((c[f+40>>2]|0)!=0){e=0;break}if((c[f+28>>2]|0)!=1){e=0;break}if((c[f+32>>2]|0)!=1){e=0;break}}e=c[f+16>>2]|0}while(0);i=f;return e|0}function ME(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var g=0;g=i;a[b+53>>0]=1;if((c[b+4>>2]|0)!=(e|0)){i=g;return}a[b+52>>0]=1;e=c[b+16>>2]|0;if((e|0)==0){c[b+16>>2]=d;c[b+24>>2]=f;c[b+36>>2]=1;if(!((f|0)==1?(c[b+48>>2]|0)==1:0)){i=g;return}a[b+54>>0]=1;i=g;return}if((e|0)!=(d|0)){c[b+36>>2]=(c[b+36>>2]|0)+1;a[b+54>>0]=1;i=g;return}d=c[b+24>>2]|0;if((d|0)==2)c[b+24>>2]=f;else f=d;if(!((f|0)==1?(c[b+48>>2]|0)==1:0)){i=g;return}a[b+54>>0]=1;i=g;return}function NE(b,d,e,f,g){b=b|0;d=d|0;e=e|0;f=f|0;g=g|0;var h=0,j=0,k=0,l=0,m=0,n=0,o=0;k=i;if((b|0)==(c[d+8>>2]|0)){if((c[d+4>>2]|0)!=(e|0)){i=k;return}if((c[d+28>>2]|0)==1){i=k;return}c[d+28>>2]=f;i=k;return}if((b|0)!=(c[d>>2]|0)){l=c[b+12>>2]|0;PE(b+16|0,d,e,f,g);if((l|0)<=1){i=k;return}m=c[b+8>>2]|0;if((m&2|0)==0?(c[d+36>>2]|0)!=1:0){if((m&1|0)==0){m=b+24|0;while(1){if((a[d+54>>0]|0)!=0){m=43;break}if((c[d+36>>2]|0)==1){m=43;break}PE(m,d,e,f,g);m=m+8|0;if(!(m>>>0<(b+(l<<3)+16|0)>>>0)){m=43;break}}if((m|0)==43){i=k;return}}m=b+24|0;while(1){if((a[d+54>>0]|0)!=0){m=43;break}if((c[d+36>>2]|0)==1?(c[d+24>>2]|0)==1:0){m=43;break}PE(m,d,e,f,g);m=m+8|0;if(!(m>>>0<(b+(l<<3)+16|0)>>>0)){m=43;break}}if((m|0)==43){i=k;return}}m=b+24|0;while(1){if((a[d+54>>0]|0)!=0){m=43;break}PE(m,d,e,f,g);m=m+8|0;if(!(m>>>0<(b+(l<<3)+16|0)>>>0)){m=43;break}}if((m|0)==43){i=k;return}}if((c[d+16>>2]|0)!=(e|0)?(c[d+20>>2]|0)!=(e|0):0){c[d+32>>2]=f;if((c[d+44>>2]|0)==4){i=k;return}n=c[b+12>>2]|0;a:do if((n|0)>0){o=0;m=0;l=b+16|0;b:do{a[d+52>>0]=0;a[d+53>>0]=0;OE(l,d,e,e,1,g);if((a[d+54>>0]|0)!=0)break;do if((a[d+53>>0]|0)!=0){if((a[d+52>>0]|0)==0)if((c[b+8>>2]&1|0)==0){m=1;break b}else{m=1;break}if((c[d+24>>2]|0)==1){m=25;break a}if((c[b+8>>2]&2|0)==0){m=25;break a}else{o=1;m=1}}while(0);l=l+8|0}while(l>>>0<(b+(n<<3)+16|0)>>>0);if(o){j=m;m=24}else{h=m;m=21}}else{h=0;m=21}while(0);if((m|0)==21){c[d+20>>2]=e;c[d+40>>2]=(c[d+40>>2]|0)+1;if((c[d+36>>2]|0)==1?(c[d+24>>2]|0)==2:0){a[d+54>>0]=1;if(h)m=25;else m=26}else{j=h;m=24}}if((m|0)==24)if(j)m=25;else m=26;if((m|0)==25){c[d+44>>2]=3;i=k;return}else if((m|0)==26){c[d+44>>2]=4;i=k;return}}if((f|0)!=1){i=k;return}c[d+32>>2]=1;i=k;return}function OE(a,b,d,e,f,g){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;g=g|0;var h=0,j=0,k=0;h=i;j=c[a+4>>2]|0;if((j&1|0)==0)k=j>>8;else k=c[(c[e>>2]|0)+(j>>8)>>2]|0;a=c[a>>2]|0;Zb[c[(c[a>>2]|0)+20>>2]&7](a,b,d,e+k|0,(j&2|0)!=0?f:2,g);i=h;return}



function mw(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var h=0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0,L=0,M=0,N=0,O=0;h=i;i=i+288|0;if((c[b+16>>2]|0)==0){K=c[b+12>>2]|0;b=c[b+20>>2]|0;n=+g[d>>2];q=+g[d+4>>2];u=+g[d+8>>2];k=+g[d+16>>2];r=+g[d+20>>2];j=+g[d+24>>2];m=+g[d+32>>2];s=+g[d+36>>2];l=+g[d+40>>2];F=+g[d+48>>2];E=+g[d+52>>2];D=+g[d+56>>2];J=+g[e>>2];I=+g[e+16>>2];y=+g[e+32>>2];H=+g[e+4>>2];G=+g[e+20>>2];w=+g[e+36>>2];v=+g[e+8>>2];z=+g[e+24>>2];x=+g[e+40>>2];C=-+g[e+48>>2];B=-+g[e+52>>2];p=-+g[e+56>>2];d=c[(c[K>>2]|0)+64>>2]|0;A=-+g[b+48>>2];t=-+g[b+52>>2];o=-+g[b+56>>2];g[h+32>>2]=(n*J+k*I+m*y)*A+(n*H+k*G+m*w)*t+(n*v+k*z+m*x)*o;g[h+36>>2]=(q*J+r*I+s*y)*A+(q*H+r*G+s*w)*t+(q*v+r*z+s*x)*o;g[h+40>>2]=(u*J+j*I+l*y)*A+(u*H+j*G+l*w)*t+(u*v+j*z+l*x)*o;g[h+44>>2]=0.0;rc[d&127](h+48|0,K,h+32|0);o=+g[h+48>>2];t=+g[h+52>>2];A=+g[h+56>>2];y=F*J+E*I+D*y+(J*C+I*B+y*p)+((n*J+k*I+m*y)*o+(q*J+r*I+s*y)*t+(u*J+j*I+l*y)*A);w=F*H+E*G+D*w+(H*C+G*B+w*p)+((n*H+k*G+m*w)*o+(q*H+r*G+s*w)*t+(u*H+j*G+l*w)*A);A=F*v+E*z+D*x+(v*C+z*B+x*p)+((n*v+k*z+m*x)*o+(q*v+r*z+s*x)*t+(u*v+j*z+l*x)*A);x=+g[b+48>>2];l=+g[b+52>>2];z=+g[b+56>>2];j=z*A+(x*y+l*w)- +g[b+64>>2];v=+g[e>>2];u=+g[e+4>>2];t=+g[e+8>>2];s=+g[e+16>>2];r=+g[e+20>>2];q=+g[e+24>>2];o=+g[e+32>>2];m=+g[e+36>>2];k=+g[e+40>>2];n=s*(y-x*j)+(w-l*j)*r+(A-z*j)*q+ +g[e+52>>2];p=(y-x*j)*o+(w-l*j)*m+(A-z*j)*k+ +g[e+56>>2];g[h+16>>2]=t*(A-z*j)+(v*(y-x*j)+u*(w-l*j))+ +g[e+48>>2];g[h+20>>2]=n;g[h+24>>2]=p;g[h+28>>2]=0.0;p=+g[b+48>>2];n=+g[b+52>>2];l=+g[b+56>>2];g[h>>2]=v*p+u*n+t*l;g[h+4>>2]=p*s+n*r+l*q;g[h+8>>2]=p*o+n*m+l*k;g[h+12>>2]=0.0;qc[c[(c[f>>2]|0)+16>>2]&15](f,h,h+16|0,j);i=h;return}else{N=c[b+4>>2]|0;a[N+312>>0]=0;c[N>>2]=0;a[N+356>>0]=1;g[N+292>>2]=999999984306749400.0;g[N+296>>2]=999999984306749400.0;g[N+300>>2]=999999984306749400.0;g[N+304>>2]=0.0;c[N+336>>2]=0;c[N+340>>2]=0;c[N+344>>2]=0;c[N+348>>2]=0;a[N+352>>0]=0;a[N+332>>0]=a[N+332>>0]&-16;N=c[b+12>>2]|0;M=c[b+16>>2]|0;L=c[N+4>>2]|0;K=c[M+4>>2]|0;I=+$b[c[(c[N>>2]|0)+48>>2]&15](N);O=c[b+16>>2]|0;J=+$b[c[(c[O>>2]|0)+48>>2]&15](O);O=c[b+4>>2]|0;b=c[b+8>>2]|0;c[h+200>>2]=13392;g[h+204>>2]=0.0;g[h+208>>2]=1.0;g[h+212>>2]=0.0;g[h+216>>2]=0.0;c[h+220>>2]=b;c[h+224>>2]=O;c[h+228>>2]=N;c[h+232>>2]=M;c[h+236>>2]=L;c[h+240>>2]=K;g[h+244>>2]=I;g[h+248>>2]=J;a[h+252>>0]=0;c[h+260>>2]=-1;c[h+272>>2]=1;c[h+276>>2]=1;g[h+192>>2]=999999984306749400.0;c[h+64>>2]=c[d+0>>2];c[h+68>>2]=c[d+4>>2];c[h+72>>2]=c[d+8>>2];c[h+76>>2]=c[d+12>>2];c[h+80>>2]=c[d+16>>2];c[h+84>>2]=c[d+20>>2];c[h+88>>2]=c[d+24>>2];c[h+92>>2]=c[d+28>>2];c[h+96>>2]=c[d+32>>2];c[h+100>>2]=c[d+36>>2];c[h+104>>2]=c[d+40>>2];c[h+108>>2]=c[d+44>>2];c[h+112>>2]=c[d+48>>2];c[h+116>>2]=c[d+52>>2];c[h+120>>2]=c[d+56>>2];c[h+124>>2]=c[d+60>>2];c[h+128>>2]=c[e+0>>2];c[h+132>>2]=c[e+4>>2];c[h+136>>2]=c[e+8>>2];c[h+140>>2]=c[e+12>>2];c[h+144>>2]=c[e+16>>2];c[h+148>>2]=c[e+20>>2];c[h+152>>2]=c[e+24>>2];c[h+156>>2]=c[e+28>>2];c[h+160>>2]=c[e+32>>2];c[h+164>>2]=c[e+36>>2];c[h+168>>2]=c[e+40>>2];c[h+172>>2]=c[e+44>>2];c[h+176>>2]=c[e+48>>2];c[h+180>>2]=c[e+52>>2];c[h+184>>2]=c[e+56>>2];c[h+188>>2]=c[e+60>>2];qz(h+200|0,h+64|0,f,0,0);i=h;return}}function nw(b,d,e,f,h,j){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;var k=0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0;k=i;i=i+304|0;l=+g[e+48>>2]- +g[d+48>>2];n=+g[e+52>>2]- +g[d+52>>2];m=+g[e+56>>2]- +g[d+56>>2];Bo(d,e,k+256|0,k+192|0);r=+g[k+192>>2];s=+g[k+256>>2]*r;t=r*+g[k+260>>2];r=r*+g[k+264>>2];g[k+176>>2]=s;g[k+180>>2]=t;g[k+184>>2]=r;g[k+188>>2]=0.0;q=+g[h+48>>2]- +g[f+48>>2];o=+g[h+52>>2]- +g[f+52>>2];p=+g[h+56>>2]- +g[f+56>>2];Bo(f,h,k+256|0,k+192|0);v=+g[k+192>>2];x=+g[k+256>>2]*v;w=v*+g[k+260>>2];v=v*+g[k+264>>2];g[k+160>>2]=x;g[k+164>>2]=w;g[k+168>>2]=v;g[k+172>>2]=0.0;h=c[b+12>>2]|0;u=+$b[c[(c[h>>2]|0)+16>>2]&15](h);h=c[b+16>>2]|0;if((h|0)==0)y=0.0;else y=+$b[c[(c[h>>2]|0)+16>>2]&15](h);r=u*+Q(+(s*s+t*t+r*r))+y*+Q(+(x*x+w*w+v*v));if(r+ +Q(+((q-l)*(q-l)+(o-n)*(o-n)+(p-m)*(p-m)))==0.0){e=0;i=k;return e|0}c[k+256>>2]=10224;g[k+292>>2]=999999984306749400.0;a[k+296>>0]=0;mw(b,d,f,k+256|0);e=(a[k+296>>0]|0)==0;c[k+144>>2]=c[k+276>>2];c[k+148>>2]=c[k+280>>2];c[k+152>>2]=c[k+284>>2];c[k+156>>2]=c[k+288>>2];if(e){e=0;i=k;return e|0}s=+g[k+260>>2];u=+g[k+264>>2];w=+g[k+268>>2];if(r+((q-l)*s+(o-n)*u+(p-m)*w)<=1.1920928955078125e-7){e=0;i=k;return e|0}y=+g[k+272>>2];v=+g[k+292>>2]+ +g[j+172>>2];t=0.0;h=0;while(1){if(!(v>.0010000000474974513)){f=18;break}e=c[j+168>>2]|0;if((e|0)!=0){z=c[(c[e>>2]|0)+20>>2]|0;g[k+128>>2]=1.0;g[k+132>>2]=1.0;g[k+136>>2]=1.0;g[k+140>>2]=0.0;Qb[z&7](e,k+144|0,.20000000298023224,k+128|0)}s=r+((p-m)*w+((o-n)*u+(q-l)*s));if(s<=1.1920928955078125e-7){j=0;f=19;break}x=t+v/s;if(!(!(x<0.0)&!(x>1.0)&!(x<=t))){j=0;f=19;break}ro(d,l,n,m,k+176|0,x,k+192|0);ro(f,q,o,p,k+160|0,x,k+64|0);e=c[j+168>>2]|0;if((e|0)!=0){z=c[(c[e>>2]|0)+20>>2]|0;g[k+48>>2]=1.0;g[k+52>>2]=0.0;g[k+56>>2]=0.0;g[k+60>>2]=0.0;Qb[z&7](e,k+240|0,.20000000298023224,k+48|0)}Kb[c[c[j>>2]>>2]&31](j,x);c[k>>2]=10224;g[k+36>>2]=999999984306749400.0;a[k+40>>0]=0;mw(b,k+192|0,k+64|0,k);if((a[k+40>>0]|0)==0){f=16;break}v=+g[k+36>>2]+ +g[j+172>>2];c[k+144>>2]=c[k+20>>2];c[k+148>>2]=c[k+24>>2];c[k+152>>2]=c[k+28>>2];c[k+156>>2]=c[k+32>>2];e=h+1|0;if((h|0)>63){f=17;break}else{s=+g[k+4>>2];u=+g[k+8>>2];w=+g[k+12>>2];y=+g[k+16>>2];t=x;h=e}}if((f|0)==16){rc[c[(c[j>>2]|0)+8>>2]&127](j,-1,h);z=0;i=k;return z|0}else if((f|0)==17){rc[c[(c[j>>2]|0)+8>>2]&127](j,-2,e);z=0;i=k;return z|0}else if((f|0)==18){g[j+164>>2]=t;g[j+132>>2]=s;g[j+136>>2]=u;g[j+140>>2]=w;g[j+144>>2]=y;c[j+148>>2]=c[k+144>>2];c[j+152>>2]=c[k+148>>2];c[j+156>>2]=c[k+152>>2];c[j+160>>2]=c[k+156>>2];z=1;i=k;return z|0}else if((f|0)==19){i=k;return j|0}return 0}function ow(a){a=a|0;return}function pw(a){a=a|0;return}function qw(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function rw(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function sw(a,b,c){a=a|0;b=b|0;c=c|0;return}function tw(a,b,c){a=a|0;b=b|0;c=c|0;return}function uw(b,d,e,f){b=b|0;d=d|0;e=e|0;f=+f;var h=0;h=i;if(!(+g[b+36>>2]>f)){i=h;return}a[b+40>>0]=1;c[b+4>>2]=c[d+0>>2];c[b+8>>2]=c[d+4>>2];c[b+12>>2]=c[d+8>>2];c[b+16>>2]=c[d+12>>2];c[b+20>>2]=c[e+0>>2];c[b+24>>2]=c[e+4>>2];c[b+28>>2]=c[e+8>>2];c[b+32>>2]=c[e+12>>2];g[b+36>>2]=f;i=h;return}function vw(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+12>>2]=c[b+0>>2];c[a+16>>2]=c[b+4>>2];c[a+20>>2]=c[b+8>>2];c[a+24>>2]=c[b+12>>2];uA(a);i=d;return}function ww(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,k=0,l=0,m=0;f=i;j=c[b+96>>2]|0;if((j|0)==(c[b+100>>2]|0)?(g=(j|0)==0?1:j<<1,(j|0)<(g|0)):0){if((g|0)==0)h=0;else{c[5004]=(c[5004]|0)+1;h=XE((g<<4|3)+16|0)|0;if((h|0)==0)h=0;else{c[(h+19&-16)+ -4>>2]=h;h=h+19&-16}j=c[b+96>>2]|0}if((j|0)>0){k=0;do{l=h+(k<<4)|0;m=(c[b+104>>2]|0)+(k<<4)|0;c[l+0>>2]=c[m+0>>2];c[l+4>>2]=c[m+4>>2];c[l+8>>2]=c[m+8>>2];c[l+12>>2]=c[m+12>>2];k=k+1|0}while((k|0)!=(j|0))}j=c[b+104>>2]|0;if((j|0)!=0){if((a[b+108>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0)}c[b+104>>2]=0}a[b+108>>0]=1;c[b+104>>2]=h;c[b+100>>2]=g;j=c[b+96>>2]|0}m=(c[b+104>>2]|0)+(j<<4)|0;c[m+0>>2]=c[d+0>>2];c[m+4>>2]=c[d+4>>2];c[m+8>>2]=c[d+8>>2];c[m+12>>2]=c[d+12>>2];c[b+96>>2]=(c[b+96>>2]|0)+1;if(!e){i=f;return}uA(b);i=f;return}function xw(a,b,d){a=a|0;b=b|0;d=d|0;var e=0.0,f=0,h=0.0,j=0.0,k=0,l=0.0,m=0.0,n=0.0,o=0.0,p=0,q=0.0,r=0;k=i;f=c[b+96>>2]|0;if((f|0)<=0){c[a+0>>2]=0;c[a+4>>2]=0;c[a+8>>2]=0;c[a+12>>2]=0;i=k;return}e=+g[b+12>>2];j=+g[d>>2]*e;l=+g[b+16>>2];h=+g[d+4>>2]*l;m=+g[b+20>>2];n=+g[d+8>>2]*m;b=c[b+104>>2]|0;d=0;o=-3.4028234663852886e+38;p=-1;while(1){q=j*+g[b+(d<<4)>>2]+h*+g[b+(d<<4)+4>>2]+n*+g[b+(d<<4)+8>>2];r=q>o;p=r?d:p;d=d+1|0;if((d|0)==(f|0))break;else o=r?q:o}o=+g[b+(p<<4)+4>>2]*l;q=+g[b+(p<<4)+8>>2]*m;g[a>>2]=+g[b+(p<<4)>>2]*e;g[a+4>>2]=o;g[a+8>>2]=q;g[a+12>>2]=0.0;i=k;return}function yw(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0.0,j=0,k=0.0,l=0.0,m=0,n=0.0,o=0.0,p=0.0,q=0,r=0,s=0,t=0.0,u=0.0,v=0;f=i;if((e|0)>0)j=0;else{i=f;return}do{g[d+(j<<4)+12>>2]=-999999984306749400.0;j=j+1|0}while((j|0)!=(e|0));j=0;do{t=+g[a+12>>2];n=+g[b+(j<<4)>>2]*t;k=+g[a+16>>2];o=+g[b+(j<<4)+4>>2]*k;l=+g[a+20>>2];p=+g[b+(j<<4)+8>>2]*l;q=c[a+96>>2]|0;if((q|0)>0){r=c[a+104>>2]|0;s=0;h=-3.4028234663852886e+38;m=-1;do{u=n*+g[r+(s<<4)>>2]+o*+g[r+(s<<4)+4>>2]+p*+g[r+(s<<4)+8>>2];v=u>h;m=v?s:m;h=v?u:h;s=s+1|0}while((s|0)!=(q|0));p=+g[r+(m<<4)+4>>2]*k;u=+g[r+(m<<4)+8>>2]*l;g[d+(j<<4)>>2]=+g[r+(m<<4)>>2]*t;g[d+(j<<4)+4>>2]=p;g[d+(j<<4)+8>>2]=u;g[d+(j<<4)+12>>2]=h}else g[d+(j<<4)+12>>2]=-999999984306749400.0;j=j+1|0}while((j|0)!=(e|0));i=f;return}function zw(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0;e=i;rc[c[(c[b>>2]|0)+68>>2]&127](a,b,d);if(!(+$b[c[(c[b>>2]|0)+48>>2]&15](b)!=0.0)){i=e;return}l=+g[d>>2];j=+g[d+4>>2];h=+g[d+8>>2];f=l*l+j*j+h*h<1.4210854715202004e-14?-1.0:h;k=l*l+j*j+h*h<1.4210854715202004e-14?-1.0:j;l=l*l+j*j+h*h<1.4210854715202004e-14?-1.0:l;h=1.0/+Q(+(f*f+(l*l+k*k)));j=+$b[c[(c[b>>2]|0)+48>>2]&15](b);g[a>>2]=h*l*j+ +g[a>>2];g[a+4>>2]=j*h*k+ +g[a+4>>2];g[a+8>>2]=j*h*f+ +g[a+8>>2];i=e;return}function Aw(a){a=a|0;return c[a+96>>2]|0}function Bw(a){a=a|0;return c[a+96>>2]|0}function Cw(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0.0,h=0.0,i=0,j=0;i=c[a+96>>2]|0;j=c[a+104>>2]|0;f=+g[j+(((b|0)%(i|0)|0)<<4)+4>>2]*+g[a+16>>2];h=+g[j+(((b|0)%(i|0)|0)<<4)+8>>2]*+g[a+20>>2];g[d>>2]=+g[j+(((b|0)%(i|0)|0)<<4)>>2]*+g[a+12>>2];g[d+4>>2]=f;g[d+8>>2]=h;g[d+12>>2]=0.0;d=c[a+104>>2]|0;h=+g[d+(((b+1|0)%(i|0)|0)<<4)+4>>2]*+g[a+16>>2];f=+g[d+(((b+1|0)%(i|0)|0)<<4)+8>>2]*+g[a+20>>2];g[e>>2]=+g[d+(((b+1|0)%(i|0)|0)<<4)>>2]*+g[a+12>>2];g[e+4>>2]=h;g[e+8>>2]=f;g[e+12>>2]=0.0;return}function Dw(a,b,d){a=a|0;b=b|0;d=d|0;var e=0.0,f=0.0,h=0;h=c[a+104>>2]|0;f=+g[h+(b<<4)+4>>2]*+g[a+16>>2];e=+g[h+(b<<4)+8>>2]*+g[a+20>>2];g[d>>2]=+g[h+(b<<4)>>2]*+g[a+12>>2];g[d+4>>2]=f;g[d+8>>2]=e;g[d+12>>2]=0.0;return}function Ew(a){a=a|0;return 0}function Fw(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;return}function Gw(a,b,c){a=a|0;b=b|0;c=+c;return 0}function Hw(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,h=0,j=0;e=i;f=gc[c[(c[d>>2]|0)+40>>2]&31](d,a)|0;j=gc[c[(c[d>>2]|0)+28>>2]&31](d,f)|0;c[b>>2]=j;if((j|0)!=0)Nb[c[(c[d>>2]|0)+48>>2]&127](d,f);c[b+4>>2]=c[a+4>>2];g[b+28>>2]=+g[a+28>>2];g[b+32>>2]=+g[a+32>>2];g[b+36>>2]=+g[a+36>>2];g[b+40>>2]=+g[a+40>>2];g[b+12>>2]=+g[a+12>>2];g[b+16>>2]=+g[a+16>>2];g[b+20>>2]=+g[a+20>>2];g[b+24>>2]=+g[a+24>>2];g[b+44>>2]=+g[a+44>>2];f=c[a+96>>2]|0;c[b+60>>2]=f;if((f|0)==0){c[b+52>>2]=0;c[b+56>>2]=0;i=e;return 10504}c[b+52>>2]=gc[c[(c[d>>2]|0)+28>>2]&31](d,c[a+104>>2]|0)|0;c[b+56>>2]=0;b=Yb[c[(c[d>>2]|0)+16>>2]&31](d,16,f)|0;if((f|0)>0){h=c[a+104>>2]|0;a=0;j=c[b+8>>2]|0;while(1){g[j>>2]=+g[h+(a<<4)>>2];g[j+4>>2]=+g[h+(a<<4)+4>>2];g[j+8>>2]=+g[h+(a<<4)+8>>2];g[j+12>>2]=+g[h+(a<<4)+12>>2];a=a+1|0;if((a|0)==(f|0))break;else j=j+16|0}}else h=c[a+104>>2]|0;Jb[c[(c[d>>2]|0)+20>>2]&31](d,b,19760,1497453121,h);i=e;return 10504}function Iw(a,b,d,e,f,h,j){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;var k=0,l=0.0,m=0,n=0,o=0.0,p=0.0,q=0.0,r=0.0,s=0;k=i;i=i+16|0;g[e>>2]=3.4028234663852886e+38;g[f>>2]=-3.4028234663852886e+38;m=c[a+96>>2]|0;if((m|0)>0){n=0;do{s=c[a+104>>2]|0;r=+g[s+(n<<4)>>2]*+g[a+12>>2];q=+g[s+(n<<4)+4>>2]*+g[a+16>>2];l=+g[s+(n<<4)+8>>2]*+g[a+20>>2];p=r*+g[b>>2]+q*+g[b+4>>2]+l*+g[b+8>>2]+ +g[b+48>>2];o=r*+g[b+16>>2]+q*+g[b+20>>2]+l*+g[b+24>>2]+ +g[b+52>>2];l=r*+g[b+32>>2]+q*+g[b+36>>2]+l*+g[b+40>>2]+ +g[b+56>>2];q=p*+g[d>>2]+o*+g[d+4>>2]+l*+g[d+8>>2];if(q<+g[e>>2]){g[e>>2]=q;g[h>>2]=p;g[h+4>>2]=o;g[h+8>>2]=l;g[h+12>>2]=0.0}if(q>+g[f>>2]){g[f>>2]=q;g[j>>2]=p;g[j+4>>2]=o;g[j+8>>2]=l;g[j+12>>2]=0.0}n=n+1|0}while((n|0)!=(m|0));o=+g[f>>2]}else o=-3.4028234663852886e+38;l=+g[e>>2];if(!(l>o)){i=k;return}g[e>>2]=o;g[f>>2]=l;c[k+0>>2]=c[h+0>>2];c[k+4>>2]=c[h+4>>2];c[k+8>>2]=c[h+8>>2];c[k+12>>2]=c[h+12>>2];c[h+0>>2]=c[j+0>>2];c[h+4>>2]=c[j+4>>2];c[h+8>>2]=c[j+8>>2];c[h+12>>2]=c[j+12>>2];c[j+0>>2]=c[k+0>>2];c[j+4>>2]=c[k+4>>2];c[j+8>>2]=c[k+8>>2];c[j+12>>2]=c[k+12>>2];i=k;return}function Jw(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=10376;e=c[b+104>>2]|0;if((e|0)!=0){if((a[b+108>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+104>>2]=0}a[b+108>>0]=1;c[b+104>>2]=0;c[b+96>>2]=0;c[b+100>>2]=0;c[b>>2]=15736;e=c[b+52>>2]|0;if((e|0)==0){i=d;return}Lb[c[c[e>>2]>>2]&511](e);b=c[b+52>>2]|0;if((b|0)==0){i=d;return}c[5006]=(c[5006]|0)+1;YE(c[b+ -4>>2]|0);i=d;return}function Kw(b){b=b|0;var d=0,e=0,f=0;d=i;c[b>>2]=10376;f=c[b+104>>2]|0;if((f|0)!=0){if((a[b+108>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}c[b+104>>2]=0}a[b+108>>0]=1;c[b+104>>2]=0;c[b+96>>2]=0;c[b+100>>2]=0;c[b>>2]=15736;f=c[b+52>>2]|0;if((f|0)!=0?(Lb[c[c[f>>2]>>2]&511](f),e=c[b+52>>2]|0,(e|0)!=0):0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}if((b|0)==0){i=d;return}c[5006]=(c[5006]|0)+1;YE(c[b+ -4>>2]|0);i=d;return}function Lw(a){a=a|0;return 10568}function Mw(a){a=a|0;return 68}function Nw(a,b){a=a|0;b=b|0;var c=0.0,d=0.0,e=0.0;e=+P(+(+g[b>>2]));d=+P(+(+g[b+4>>2]));c=+P(+(+g[b+8>>2]));g[a+12>>2]=e;g[a+16>>2]=d;g[a+20>>2]=c;g[a+24>>2]=0.0;return}function Ow(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0.0,j=0,k=0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0;f=i;i=i+96|0;h=+$b[c[(c[a>>2]|0)+48>>2]&15](a);j=0;do{q=f+80+(j<<2)|0;c[f+80>>2]=0;c[f+84>>2]=0;c[f+88>>2]=0;c[f+92>>2]=0;g[q>>2]=1.0;k=c[(c[a>>2]|0)+64>>2]|0;l=+g[f+80>>2];m=+g[f+84>>2];n=+g[f+88>>2];o=l*+g[b+4>>2]+m*+g[b+20>>2]+n*+g[b+36>>2];p=l*+g[b+8>>2]+m*+g[b+24>>2]+n*+g[b+40>>2];g[f+48>>2]=+g[b>>2]*l+ +g[b+16>>2]*m+ +g[b+32>>2]*n;g[f+52>>2]=o;g[f+56>>2]=p;g[f+60>>2]=0.0;rc[k&127](f+64|0,a,f+48|0);p=+g[f+64>>2];o=+g[f+68>>2];n=+g[f+72>>2];m=p*+g[b+16>>2]+o*+g[b+20>>2]+n*+g[b+24>>2]+ +g[b+52>>2];l=p*+g[b+32>>2]+o*+g[b+36>>2]+n*+g[b+40>>2]+ +g[b+56>>2];g[f+32>>2]=p*+g[b>>2]+o*+g[b+4>>2]+n*+g[b+8>>2]+ +g[b+48>>2];g[f+36>>2]=m;g[f+40>>2]=l;g[f+44>>2]=0.0;k=f+32+(j<<2)|0;g[e+(j<<2)>>2]=h+ +g[k>>2];g[q>>2]=-1.0;q=c[(c[a>>2]|0)+64>>2]|0;l=+g[f+80>>2];m=+g[f+84>>2];n=+g[f+88>>2];o=l*+g[b+4>>2]+m*+g[b+20>>2]+n*+g[b+36>>2];p=l*+g[b+8>>2]+m*+g[b+24>>2]+n*+g[b+40>>2];g[f>>2]=+g[b>>2]*l+ +g[b+16>>2]*m+ +g[b+32>>2]*n;g[f+4>>2]=o;g[f+8>>2]=p;g[f+12>>2]=0.0;rc[q&127](f+16|0,a,f);p=+g[f+16>>2];o=+g[f+20>>2];n=+g[f+24>>2];m=p*+g[b+16>>2]+o*+g[b+20>>2]+n*+g[b+24>>2]+ +g[b+52>>2];l=p*+g[b+32>>2]+o*+g[b+36>>2]+n*+g[b+40>>2]+ +g[b+56>>2];g[f+32>>2]=p*+g[b>>2]+o*+g[b+4>>2]+n*+g[b+8>>2]+ +g[b+48>>2];g[f+36>>2]=m;g[f+40>>2]=l;g[f+44>>2]=0.0;g[d+(j<<2)>>2]=+g[k>>2]-h;j=j+1|0}while((j|0)!=3);i=f;return}function Pw(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0;e=i;rc[c[(c[b>>2]|0)+68>>2]&127](a,b,d);if(!(+$b[c[(c[b>>2]|0)+48>>2]&15](b)!=0.0)){i=e;return}l=+g[d>>2];j=+g[d+4>>2];h=+g[d+8>>2];f=l*l+j*j+h*h<1.4210854715202004e-14?-1.0:h;k=l*l+j*j+h*h<1.4210854715202004e-14?-1.0:j;l=l*l+j*j+h*h<1.4210854715202004e-14?-1.0:l;h=1.0/+Q(+(f*f+(l*l+k*k)));j=+$b[c[(c[b>>2]|0)+48>>2]&15](b);g[a>>2]=h*l*j+ +g[a>>2];g[a+4>>2]=j*h*k+ +g[a+4>>2];g[a+8>>2]=j*h*f+ +g[a+8>>2];i=e;return}function Qw(a,b,d,e,f){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;var h=0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0;h=i;i=i+64|0;n=+g[d>>2];o=+g[d+4>>2];m=+g[d+8>>2];p=n*+g[b+4>>2]+o*+g[b+20>>2]+m*+g[b+36>>2];q=n*+g[b+8>>2]+o*+g[b+24>>2]+m*+g[b+40>>2];g[h+48>>2]=+g[b>>2]*n+ +g[b+16>>2]*o+ +g[b+32>>2]*m;g[h+52>>2]=p;g[h+56>>2]=q;g[h+60>>2]=0.0;rc[c[(c[a>>2]|0)+64>>2]&127](h+32|0,a,h+48|0);q=+g[h+32>>2];p=+g[h+36>>2];m=+g[h+40>>2];o=q*+g[b>>2]+p*+g[b+4>>2]+m*+g[b+8>>2]+ +g[b+48>>2];n=q*+g[b+16>>2]+p*+g[b+20>>2]+m*+g[b+24>>2]+ +g[b+52>>2];m=q*+g[b+32>>2]+p*+g[b+36>>2]+m*+g[b+40>>2]+ +g[b+56>>2];r=c[(c[a>>2]|0)+64>>2]|0;p=-+g[h+52>>2];q=-+g[h+56>>2];g[h>>2]=-+g[h+48>>2];g[h+4>>2]=p;g[h+8>>2]=q;g[h+12>>2]=0.0;rc[r&127](h+16|0,a,h);q=+g[h+16>>2];p=+g[h+20>>2];j=+g[h+24>>2];l=q*+g[b>>2]+p*+g[b+4>>2]+j*+g[b+8>>2]+ +g[b+48>>2];k=q*+g[b+16>>2]+p*+g[b+20>>2]+j*+g[b+24>>2]+ +g[b+52>>2];j=q*+g[b+32>>2]+p*+g[b+36>>2]+j*+g[b+40>>2]+ +g[b+56>>2];g[e>>2]=o*+g[d>>2]+n*+g[d+4>>2]+m*+g[d+8>>2];j=l*+g[d>>2]+k*+g[d+4>>2]+j*+g[d+8>>2];g[f>>2]=j;k=+g[e>>2];if(!(k>j)){i=h;return}g[e>>2]=j;g[f>>2]=k;i=h;return}function Rw(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0,v=0.0,w=0,x=0;e=i;i=i+80|0;switch(c[b+4>>2]|0){case 8:{c[a+0>>2]=0;c[a+4>>2]=0;c[a+8>>2]=0;c[a+12>>2]=0;i=e;return};case 0:{s=+g[b+28>>2];t=+g[b+32>>2];t=+g[d+4>>2]>=0.0?t:-t;v=+g[b+36>>2];v=+g[d+8>>2]>=0.0?v:-v;g[a>>2]=+g[d>>2]>=0.0?s:-s;g[a+4>>2]=t;g[a+8>>2]=v;g[a+12>>2]=0.0;i=e;return};case 10:{h=+g[d>>2];j=+g[d+4>>2];k=+g[d+8>>2];d=c[b+52>>2]|0;f=+g[b+(d<<2)+28>>2];n=+g[b+(((d+2|0)%3|0)<<2)+28>>2];if(h*h+j*j+k*k<9999999747378752.0e-20){h=1.0;j=0.0;k=0.0}else{v=1.0/+Q(+(h*h+j*j+k*k));h=h*v;j=j*v;k=k*v}c[e+16>>2]=0;c[e+20>>2]=0;c[e+24>>2]=0;c[e+28>>2]=0;g[e+16+(d<<2)>>2]=f;l=n*h;m=n*j;n=n*k;o=+g[b+44>>2];q=h*o;p=j*o;o=k*o;v=+g[e+16>>2]+l-q;t=m+ +g[e+20>>2]-p;s=n+ +g[e+24>>2]-o;r=k*s+(h*v+j*t);if(!(r>-999999984306749400.0)){s=0.0;t=0.0;v=0.0;r=-999999984306749400.0}c[e+0>>2]=0;c[e+4>>2]=0;c[e+8>>2]=0;c[e+12>>2]=0;g[e+(d<<2)>>2]=-f;l=l+ +g[e>>2]-q;p=m+ +g[e+4>>2]-p;q=n+ +g[e+8>>2]-o;x=k*q+(h*l+j*p)>r;g[a>>2]=x?l:v;g[a+4>>2]=x?p:t;g[a+8>>2]=x?q:s;g[a+12>>2]=0.0;i=e;return};case 4:{u=c[b+104>>2]|0;w=c[b+96>>2]|0;f=+g[b+12>>2];h=+g[b+16>>2];j=+g[b+20>>2];k=+g[d>>2]*f;l=+g[d+4>>2]*h;n=+g[d+8>>2]*j;if((w|0)>0){d=0;m=-3.4028234663852886e+38;x=-1;while(1){o=k*+g[u+(d<<4)>>2]+l*+g[u+(d<<4)+4>>2]+n*+g[u+(d<<4)+8>>2];b=o>m;x=b?d:x;d=d+1|0;if((d|0)==(w|0))break;else m=b?o:m}}else x=-1;t=h*+g[u+(x<<4)+4>>2];v=j*+g[u+(x<<4)+8>>2];g[a>>2]=f*+g[u+(x<<4)>>2];g[a+4>>2]=t;g[a+8>>2]=v;g[a+12>>2]=0.0;i=e;return};case 5:{u=c[b+92>>2]|0;w=c[b+96>>2]|0;f=+g[b+12>>2];h=+g[b+16>>2];j=+g[b+20>>2];k=+g[d>>2]*f;l=+g[d+4>>2]*h;n=+g[d+8>>2]*j;if((w|0)>0){d=0;o=-3.4028234663852886e+38;x=-1;while(1){m=k*+g[u+(d<<4)>>2]+l*+g[u+(d<<4)+4>>2]+n*+g[u+(d<<4)+8>>2];b=m>o;x=b?d:x;d=d+1|0;if((d|0)==(w|0))break;else o=b?m:o}}else x=-1;t=h*+g[u+(x<<4)+4>>2];v=j*+g[u+(x<<4)+8>>2];g[a>>2]=f*+g[u+(x<<4)>>2];g[a+4>>2]=t;g[a+8>>2]=v;g[a+12>>2]=0.0;i=e;return};case 13:{c[e+64>>2]=c[b+28>>2];c[e+68>>2]=c[b+32>>2];c[e+72>>2]=c[b+36>>2];c[e+76>>2]=c[b+40>>2];g[e+48>>2]=+g[d>>2];h=+g[d+4>>2];g[e+52>>2]=h;f=+g[d+8>>2];g[e+56>>2]=f;g[e+60>>2]=0.0;w=c[b+52>>2]|0;if((w|0)==1){u=0;b=w;d=2}else if((w|0)==2){f=h;u=0;b=w;d=1}else{u=1;b=0;d=2}h=+g[e+64+(u<<2)>>2];l=+g[e+64+(w<<2)>>2];k=+g[e+48+(u<<2)>>2];j=+Q(+(k*k+f*f));if(j!=0.0){g[e+32+(u<<2)>>2]=k*(h/j);if(+g[e+48+(b<<2)>>2]<0.0)l=-l;g[e+32+(b<<2)>>2]=l;g[e+32+(d<<2)>>2]=h/j*f;g[a>>2]=+g[e+32>>2];g[a+4>>2]=+g[e+36>>2];g[a+8>>2]=+g[e+40>>2];g[a+12>>2]=0.0;i=e;return}else{g[e+32+(u<<2)>>2]=h;if(+g[e+48+(b<<2)>>2]<0.0)l=-l;g[e+32+(b<<2)>>2]=l;g[e+32+(d<<2)>>2]=0.0;g[a>>2]=+g[e+32>>2];g[a+4>>2]=+g[e+36>>2];g[a+8>>2]=+g[e+40>>2];g[a+12>>2]=0.0;i=e;return}};case 1:{t=+g[d>>2];v=+g[d+4>>2];f=+g[d+8>>2];j=t*+g[b+56>>2]+v*+g[b+60>>2]+f*+g[b+64>>2];h=t*+g[b+72>>2]+v*+g[b+76>>2]+f*+g[b+80>>2];f=t*+g[b+88>>2]+v*+g[b+92>>2]+f*+g[b+96>>2];if(j<h)d=h<f?2:1;else d=j<f?2:0;t=+g[b+56+(d<<4)+4>>2];v=+g[b+56+(d<<4)+8>>2];g[a>>2]=+g[b+56+(d<<4)>>2];g[a+4>>2]=t;g[a+8>>2]=v;g[a+12>>2]=0.0;i=e;return};default:{rc[c[(c[b>>2]|0)+68>>2]&127](a,b,d);i=e;return}}}function Sw(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0;e=i;i=i+32|0;c[e+16>>2]=c[d+0>>2];c[e+20>>2]=c[d+4>>2];c[e+24>>2]=c[d+8>>2];c[e+28>>2]=c[d+12>>2];h=+g[e+16>>2];j=+g[e+20>>2];f=+g[e+24>>2];if(h*h+j*j+f*f<1.4210854715202004e-14){g[e+16>>2]=-1.0;g[e+20>>2]=-1.0;g[e+24>>2]=-1.0;g[e+28>>2]=0.0;h=-1.0;j=-1.0;f=-1.0}k=1.0/+Q(+(h*h+j*j+f*f));g[e+16>>2]=h*k;g[e+20>>2]=j*k;g[e+24>>2]=f*k;Rw(e,b,e+16|0);switch(c[b+4>>2]|0){case 0:{f=+g[b+44>>2];break};case 1:{f=+g[b+44>>2];break};case 8:{f=+g[b+28>>2]*+g[b+12>>2];break};case 10:{f=+g[b+44>>2];break};case 11:{f=+g[b+44>>2];break};case 13:{f=+g[b+44>>2];break};case 4:case 5:{f=+g[b+44>>2];break};default:f=+$b[c[(c[b>>2]|0)+48>>2]&15](b)}j=f*+g[e+20>>2]+ +g[e+4>>2];k=f*+g[e+24>>2]+ +g[e+8>>2];g[a>>2]=f*+g[e+16>>2]+ +g[e>>2];g[a+4>>2]=j;g[a+8>>2]=k;g[a+12>>2]=0.0;i=e;return}function Tw(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0;e=i;i=i+80|0;c[a+0>>2]=0;c[a+4>>2]=0;c[a+8>>2]=0;c[a+12>>2]=0;f=+g[d>>2];j=+g[d+4>>2];h=+g[d+8>>2];if(f*f+j*j+h*h<9999999747378752.0e-20){f=1.0;j=0.0;h=0.0;k=0.0}else{k=1.0/+Q(+(f*f+j*j+h*h));f=f*k;j=j*k;h=h*k;k=+g[d+12>>2]}c[e+32>>2]=10856;c[e+36>>2]=0;c[e+40>>2]=0;c[e+44>>2]=0;c[e+48>>2]=0;g[e+52>>2]=-999999984306749400.0;g[e+56>>2]=f;g[e+60>>2]=j;g[e+64>>2]=h;g[e+68>>2]=k;g[e+16>>2]=999999984306749400.0;g[e+20>>2]=999999984306749400.0;g[e+24>>2]=999999984306749400.0;g[e+28>>2]=0.0;d=c[b+92>>2]|0;b=c[(c[d>>2]|0)+8>>2]|0;g[e>>2]=-999999984306749400.0;g[e+4>>2]=-999999984306749400.0;g[e+8>>2]=-999999984306749400.0;g[e+12>>2]=0.0;vc[b&127](d,e+32|0,e,e+16|0);c[a+0>>2]=c[e+36>>2];c[a+4>>2]=c[e+40>>2];c[a+8>>2]=c[e+44>>2];c[a+12>>2]=c[e+48>>2];i=e;return}function Uw(a){a=a|0;return}function Vw(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0,j=0,k=0;f=i;i=i+80|0;if((e|0)>0)h=0;else{i=f;return}do{g[d+(h<<4)+12>>2]=-999999984306749400.0;h=h+1|0}while((h|0)!=(e|0));h=0;do{j=b+(h<<4)|0;c[f+32>>2]=10856;c[f+36>>2]=0;c[f+40>>2]=0;c[f+44>>2]=0;c[f+48>>2]=0;g[f+52>>2]=-999999984306749400.0;c[f+56>>2]=c[j+0>>2];c[f+60>>2]=c[j+4>>2];c[f+64>>2]=c[j+8>>2];c[f+68>>2]=c[j+12>>2];g[f+16>>2]=999999984306749400.0;g[f+20>>2]=999999984306749400.0;g[f+24>>2]=999999984306749400.0;g[f+28>>2]=0.0;j=c[a+92>>2]|0;k=c[(c[j>>2]|0)+8>>2]|0;g[f>>2]=-999999984306749400.0;g[f+4>>2]=-999999984306749400.0;g[f+8>>2]=-999999984306749400.0;g[f+12>>2]=0.0;vc[k&127](j,f+32|0,f,f+16|0);j=d+(h<<4)|0;c[j+0>>2]=c[f+36>>2];c[j+4>>2]=c[f+40>>2];c[j+8>>2]=c[f+44>>2];c[j+12>>2]=c[f+48>>2];h=h+1|0}while((h|0)<(e|0));i=f;return}function Ww(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0;e=i;rc[c[(c[b>>2]|0)+68>>2]&127](a,b,d);if(!(+$b[c[(c[b>>2]|0)+48>>2]&15](b)!=0.0)){i=e;return}l=+g[d>>2];j=+g[d+4>>2];h=+g[d+8>>2];f=l*l+j*j+h*h<1.4210854715202004e-14?-1.0:h;k=l*l+j*j+h*h<1.4210854715202004e-14?-1.0:j;l=l*l+j*j+h*h<1.4210854715202004e-14?-1.0:l;h=1.0/+Q(+(f*f+(l*l+k*k)));j=+$b[c[(c[b>>2]|0)+48>>2]&15](b);g[a>>2]=h*l*j+ +g[a>>2];g[a+4>>2]=j*h*k+ +g[a+4>>2];g[a+8>>2]=j*h*f+ +g[a+8>>2];i=e;return}function Xw(a){a=a|0;return 0}function Yw(a){a=a|0;return 0}function Zw(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;return}function _w(a,b,c){a=a|0;b=b|0;c=c|0;return}function $w(a){a=a|0;return 0}function ax(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;return}function bx(a,b,c){a=a|0;b=b|0;c=+c;return 0}function cx(a,b){a=a|0;b=b|0;var d=0,e=0;d=i;e=(c[a+92>>2]|0)+4|0;c[e+0>>2]=c[b+0>>2];c[e+4>>2]=c[b+4>>2];c[e+8>>2]=c[b+8>>2];c[e+12>>2]=c[b+12>>2];uA(a);i=d;return}function dx(a){a=a|0;return(c[a+92>>2]|0)+4|0}function ex(a){a=a|0;var b=0,d=0;b=i;c[a>>2]=15736;d=c[a+52>>2]|0;if((d|0)==0){i=b;return}Lb[c[c[d>>2]>>2]&511](d);a=c[a+52>>2]|0;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function fx(a){a=a|0;var b=0,d=0;b=i;c[a>>2]=15736;d=c[a+52>>2]|0;if((d|0)!=0){Lb[c[c[d>>2]>>2]&511](d);d=c[a+52>>2]|0;if((d|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[d+ -4>>2]|0)}if((a|0)==0){i=b;return}}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function gx(a){a=a|0;return 10832}function hx(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function ix(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0.0,h=0.0,j=0.0,k=0.0,l=0.0;e=i;f=+g[a+24>>2];j=+g[a+28>>2];h=+g[a+32>>2];k=f*+g[b>>2]+j*+g[b+4>>2]+h*+g[b+8>>2];l=+g[a+20>>2];if(k>l){g[a+20>>2]=k;c[a+4>>2]=c[b+0>>2];c[a+8>>2]=c[b+4>>2];c[a+12>>2]=c[b+8>>2];c[a+16>>2]=c[b+12>>2]}else k=l;l=f*+g[b+16>>2]+j*+g[b+20>>2]+h*+g[b+24>>2];if(l>k){g[a+20>>2]=l;c[a+4>>2]=c[b+16>>2];c[a+8>>2]=c[b+20>>2];c[a+12>>2]=c[b+24>>2];c[a+16>>2]=c[b+28>>2];k=l}f=f*+g[b+32>>2]+j*+g[b+36>>2]+h*+g[b+40>>2];if(!(f>k)){i=e;return}g[a+20>>2]=f;c[a+4>>2]=c[b+32>>2];c[a+8>>2]=c[b+36>>2];c[a+12>>2]=c[b+40>>2];c[a+16>>2]=c[b+44>>2];i=e;return}function jx(a,b){a=a|0;b=b|0;var d=0,e=0.0,f=0.0,h=0.0,j=0,k=0.0,l=0.0;d=i;c[a+4>>2]=35;c[a+8>>2]=0;g[a+12>>2]=1.0;g[a+16>>2]=1.0;g[a+20>>2]=1.0;g[a+24>>2]=0.0;g[a+44>>2]=.03999999910593033;c[a>>2]=10928;c[a+52>>2]=1;f=+g[b>>2];h=+g[b+4>>2];e=+g[b+8>>2];if(f<h)j=f<e?0:2;else j=h<e?1:2;e=+g[b+(j<<2)>>2]*.10000000149011612;if(e<.03999999910593033){l=+Js(a);k=+$b[c[(c[a>>2]|0)+48>>2]&15](a);h=+$b[c[(c[a>>2]|0)+48>>2]&15](a);l=l+ +g[a+28>>2];k=k+ +g[a+32>>2];h=h+ +g[a+36>>2];g[a+44>>2]=e;e=+$b[c[(c[a>>2]|0)+48>>2]&15](a);f=+$b[c[(c[a>>2]|0)+48>>2]&15](a);h=h- +$b[c[(c[a>>2]|0)+48>>2]&15](a);g[a+28>>2]=l-e;g[a+32>>2]=k-f;g[a+36>>2]=h;g[a+40>>2]=0.0;j=c[a>>2]|0}else j=10928|0;h=+$b[c[j+48>>2]&15](a);k=+$b[c[(c[a>>2]|0)+48>>2]&15](a);l=+$b[c[(c[a>>2]|0)+48>>2]&15](a);k=+g[b+4>>2]*+g[a+16>>2]-k;l=+g[b+8>>2]*+g[a+20>>2]-l;g[a+28>>2]=+g[b>>2]*+g[a+12>>2]-h;g[a+32>>2]=k;g[a+36>>2]=l;g[a+40>>2]=0.0;c[a+4>>2]=13;i=d;return}function kx(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0;f=i;k=+$b[c[(c[a>>2]|0)+48>>2]&15](a);o=k+ +g[a+28>>2];m=k+ +g[a+32>>2];k=k+ +g[a+36>>2];w=+P(+(+g[b>>2]));v=+P(+(+g[b+4>>2]));u=+P(+(+g[b+8>>2]));s=+P(+(+g[b+16>>2]));r=+P(+(+g[b+20>>2]));q=+P(+(+g[b+24>>2]));n=+P(+(+g[b+32>>2]));l=+P(+(+g[b+36>>2]));j=+P(+(+g[b+40>>2]));t=+g[b+48>>2];p=+g[b+52>>2];h=+g[b+56>>2];g[d>>2]=t-(o*w+m*v+k*u);g[d+4>>2]=p-(o*s+m*r+k*q);g[d+8>>2]=h-(o*n+m*l+k*j);g[d+12>>2]=0.0;g[e>>2]=o*w+m*v+k*u+t;g[e+4>>2]=o*s+m*r+k*q+p;g[e+8>>2]=o*n+m*l+k*j+h;g[e+12>>2]=0.0;i=f;return}function lx(a,b,d){a=a|0;b=+b;d=d|0;var e=0,f=0,h=0.0,j=0,k=0.0,l=0.0;e=i;i=i+16|0;c[e+0>>2]=c[a+28>>2];c[e+4>>2]=c[a+32>>2];c[e+8>>2]=c[a+36>>2];c[e+12>>2]=c[a+40>>2];l=+$b[c[(c[a>>2]|0)+48>>2]&15](a);h=+$b[c[(c[a>>2]|0)+48>>2]&15](a);k=+$b[c[(c[a>>2]|0)+48>>2]&15](a);g[e>>2]=l+ +g[e>>2];g[e+4>>2]=h+ +g[e+4>>2];g[e+8>>2]=k+ +g[e+8>>2];a=c[a+52>>2]|0;if((a|0)==2){f=2;j=0}else if((a|0)==0){f=0;j=1}else{f=1;j=0}h=+g[e+(j<<2)>>2];k=+g[e+(f<<2)>>2];k=b*.25*h*h+b/12.0*k*k*4.0;if((a|0)==2){g[d>>2]=k;g[d+4>>2]=k;g[d+8>>2]=b*.5*h*h;g[d+12>>2]=0.0;i=e;return}else if((a|0)==0){g[d>>2]=b*.5*h*h;g[d+4>>2]=k;g[d+8>>2]=k;g[d+12>>2]=0.0;i=e;return}else{g[d>>2]=k;g[d+4>>2]=b*.5*h*h;g[d+8>>2]=k;g[d+12>>2]=0.0;i=e;return}}function mx(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0.0,h=0.0,j=0.0,k=0.0;d=i;e=+g[b+32>>2];k=+g[b+28>>2];j=+g[c+4>>2];h=+g[c+8>>2];f=+Q(+(j*j+h*h));if(f!=0.0){g[a+4>>2]=j*(e/f);if(+g[c>>2]<0.0)k=-k;g[a>>2]=k;g[a+8>>2]=h*(e/f);i=d;return}else{g[a+4>>2]=e;if(+g[c>>2]<0.0)k=-k;g[a>>2]=k;g[a+8>>2]=0.0;i=d;return}}function nx(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0.0,h=0.0,j=0.0,k=0.0;d=i;e=+g[b+28>>2];k=+g[b+36>>2];j=+g[c>>2];h=+g[c+4>>2];f=+Q(+(j*j+h*h));if(f!=0.0){g[a>>2]=j*(e/f);if(+g[c+8>>2]<0.0)k=-k;g[a+8>>2]=k;g[a+4>>2]=h*(e/f);i=d;return}else{g[a>>2]=e;if(+g[c+8>>2]<0.0)k=-k;g[a+8>>2]=k;g[a+4>>2]=0.0;i=d;return}}function ox(a,b,c){a=a|0;b=b|0;c=c|0;var d=0,e=0.0,f=0.0,h=0.0,j=0.0,k=0.0;d=i;e=+g[b+28>>2];k=+g[b+32>>2];j=+g[c>>2];h=+g[c+8>>2];f=+Q(+(j*j+h*h));if(f!=0.0){g[a>>2]=j*(e/f);if(+g[c+4>>2]<0.0)k=-k;g[a+4>>2]=k;g[a+8>>2]=h*(e/f);i=d;return}else{g[a>>2]=e;if(+g[c+4>>2]<0.0)k=-k;g[a+4>>2]=k;g[a+8>>2]=0.0;i=d;return}}function px(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0;f=i;if((d|0)<=0){i=f;return}e=0;do{j=+g[a+28>>2];m=+g[a+32>>2];h=+g[b+(e<<4)>>2];k=+g[b+(e<<4)+8>>2];l=+Q(+(h*h+k*k));if(!(l!=0.0))if(+g[b+(e<<4)+4>>2]<0.0){h=j;m=-m;j=0.0}else{h=j;j=0.0}else{if(+g[b+(e<<4)+4>>2]<0.0)m=-m;h=h*(j/l);j=k*(j/l)}g[c+(e<<4)>>2]=h;g[c+(e<<4)+4>>2]=m;g[c+(e<<4)+8>>2]=j;e=e+1|0}while((e|0)!=(d|0));i=f;return}function qx(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0;f=i;if((d|0)<=0){i=f;return}e=0;do{m=+g[a+28>>2];j=+g[a+36>>2];h=+g[b+(e<<4)>>2];l=+g[b+(e<<4)+4>>2];k=+Q(+(h*h+l*l));if(!(k!=0.0))if(+g[b+(e<<4)+8>>2]<0.0){h=m;k=0.0;j=-j}else{h=m;k=0.0}else{if(+g[b+(e<<4)+8>>2]<0.0)j=-j;h=h*(m/k);k=l*(m/k)}g[c+(e<<4)>>2]=h;g[c+(e<<4)+4>>2]=k;g[c+(e<<4)+8>>2]=j;e=e+1|0}while((e|0)!=(d|0));i=f;return}function rx(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0;f=i;if((d|0)<=0){i=f;return}e=0;do{h=+g[a+32>>2];m=+g[a+28>>2];n=b+(e<<4)|0;l=+g[b+(e<<4)+4>>2];j=+g[b+(e<<4)+8>>2];k=+Q(+(l*l+j*j));if(!(k!=0.0))if(+g[n>>2]<0.0){m=-m;l=h;h=0.0}else{l=h;h=0.0}else{if(+g[n>>2]<0.0)m=-m;l=l*(h/k);h=j*(h/k)}g[c+(e<<4)>>2]=m;g[c+(e<<4)+4>>2]=l;g[c+(e<<4)+8>>2]=h;e=e+1|0}while((e|0)!=(d|0));i=f;return}function sx(a){a=a|0;return}function tx(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function ux(a,b){a=a|0;b=b|0;var d=0,e=0.0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0;d=i;m=+$b[c[(c[a>>2]|0)+48>>2]&15](a);j=+$b[c[(c[a>>2]|0)+48>>2]&15](a);e=+$b[c[(c[a>>2]|0)+48>>2]&15](a);o=(m+ +g[a+28>>2])/+g[a+12>>2];l=(j+ +g[a+32>>2])/+g[a+16>>2];h=(e+ +g[a+36>>2])/+g[a+20>>2];n=+P(+(+g[b>>2]));k=+P(+(+g[b+4>>2]));f=+P(+(+g[b+8>>2]));g[a+12>>2]=n;g[a+16>>2]=k;g[a+20>>2]=f;g[a+24>>2]=0.0;g[a+28>>2]=o*n-m;g[a+32>>2]=l*k-j;g[a+36>>2]=h*f-e;g[a+40>>2]=0.0;i=d;return}function vx(a){a=a|0;return 11408}function wx(a,b){a=a|0;b=b|0;var d=0;d=i;c[a+0>>2]=0;c[a+4>>2]=0;c[a+8>>2]=0;c[a+12>>2]=0;g[a+(c[b+52>>2]<<2)>>2]=1.0;i=d;return}function xx(a,b){a=a|0;b=+b;var d=0,e=0.0,f=0.0,h=0.0,j=0.0,k=0.0;d=i;j=+$b[c[(c[a>>2]|0)+48>>2]&15](a);f=+$b[c[(c[a>>2]|0)+48>>2]&15](a);k=+$b[c[(c[a>>2]|0)+48>>2]&15](a);j=j+ +g[a+28>>2];f=f+ +g[a+32>>2];k=k+ +g[a+36>>2];g[a+44>>2]=b;h=+$b[c[(c[a>>2]|0)+48>>2]&15](a);e=+$b[c[(c[a>>2]|0)+48>>2]&15](a);b=k- +$b[c[(c[a>>2]|0)+48>>2]&15](a);g[a+28>>2]=j-h;g[a+32>>2]=f-e;g[a+36>>2]=b;g[a+40>>2]=0.0;i=d;return}function yx(a){a=a|0;return 60}function zx(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,h=0;e=i;f=gc[c[(c[d>>2]|0)+40>>2]&31](d,a)|0;h=gc[c[(c[d>>2]|0)+28>>2]&31](d,f)|0;c[b>>2]=h;if((h|0)!=0)Nb[c[(c[d>>2]|0)+48>>2]&127](d,f);c[b+4>>2]=c[a+4>>2];g[b+28>>2]=+g[a+28>>2];g[b+32>>2]=+g[a+32>>2];g[b+36>>2]=+g[a+36>>2];g[b+40>>2]=+g[a+40>>2];g[b+12>>2]=+g[a+12>>2];g[b+16>>2]=+g[a+16>>2];g[b+20>>2]=+g[a+20>>2];g[b+24>>2]=+g[a+24>>2];g[b+44>>2]=+g[a+44>>2];c[b+52>>2]=c[a+52>>2];i=e;return 11384}function Ax(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0.0,h=0.0,j=0.0,k=0.0,l=0.0;e=i;rc[c[(c[b>>2]|0)+68>>2]&127](a,b,d);if(!(+$b[c[(c[b>>2]|0)+48>>2]&15](b)!=0.0)){i=e;return}l=+g[d>>2];j=+g[d+4>>2];h=+g[d+8>>2];f=l*l+j*j+h*h<1.4210854715202004e-14?-1.0:h;k=l*l+j*j+h*h<1.4210854715202004e-14?-1.0:j;l=l*l+j*j+h*h<1.4210854715202004e-14?-1.0:l;h=1.0/+Q(+(f*f+(l*l+k*k)));j=+$b[c[(c[b>>2]|0)+48>>2]&15](b);g[a>>2]=h*l*j+ +g[a>>2];g[a+4>>2]=j*h*k+ +g[a+4>>2];g[a+8>>2]=j*h*f+ +g[a+8>>2];i=e;return}function Bx(a){a=a|0;var b=0.0,d=0.0,e=0;e=i;d=+g[a+28>>2];b=+$b[c[(c[a>>2]|0)+48>>2]&15](a);+$b[c[(c[a>>2]|0)+48>>2]&15](a);+$b[c[(c[a>>2]|0)+48>>2]&15](a);i=e;return+(d+b)}function Cx(a){a=a|0;return}function Dx(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function Ex(a){a=a|0;return 11368}function Fx(a){a=a|0;var b=0.0,d=0.0,e=0;e=i;d=+g[a+32>>2];+$b[c[(c[a>>2]|0)+48>>2]&15](a);b=+$b[c[(c[a>>2]|0)+48>>2]&15](a);+$b[c[(c[a>>2]|0)+48>>2]&15](a);i=e;return+(d+b)}function Gx(a){a=a|0;return}function Hx(a){a=a|0;var b=0;b=i;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function Ix(a){a=a|0;return 11352}function Jx(a){a=a|0;var b=0.0,d=0.0,e=0;e=i;d=+g[a+28>>2];b=+$b[c[(c[a>>2]|0)+48>>2]&15](a);+$b[c[(c[a>>2]|0)+48>>2]&15](a);+$b[c[(c[a>>2]|0)+48>>2]&15](a);i=e;return+(d+b)}function Kx(b){b=b|0;var d=0,e=0;d=i;e=c[b>>2]|0;if((e|0)!=0)Lx(b,e);e=c[b+4>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+4>>2]=0;c[b+8>>2]=-1;e=c[b+32>>2]|0;if((e|0)!=0){if((a[b+36>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+32>>2]=0}a[b+36>>0]=1;c[b+32>>2]=0;c[b+24>>2]=0;c[b+28>>2]=0;c[b+16>>2]=0;e=c[b+52>>2]|0;if((e|0)==0){a[b+56>>0]=1;c[b+52>>2]=0;c[b+44>>2]=0;c[b+48>>2]=0;a[b+36>>0]=1;c[b+32>>2]=0;c[b+24>>2]=0;c[b+28>>2]=0;i=d;return}if((a[b+56>>0]|0)==0){a[b+56>>0]=1;c[b+52>>2]=0;c[b+44>>2]=0;c[b+48>>2]=0;a[b+36>>0]=1;c[b+32>>2]=0;c[b+24>>2]=0;c[b+28>>2]=0;i=d;return}c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0);e=c[b+32>>2]|0;a[b+56>>0]=1;c[b+52>>2]=0;c[b+44>>2]=0;c[b+48>>2]=0;if((e|0)==0){a[b+36>>0]=1;c[b+32>>2]=0;c[b+24>>2]=0;c[b+28>>2]=0;i=d;return}if((a[b+36>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+32>>2]=0;a[b+36>>0]=1;c[b+32>>2]=0;c[b+24>>2]=0;c[b+28>>2]=0;i=d;return}function Lx(a,b){a=a|0;b=b|0;var d=0,e=0;d=i;if((c[b+40>>2]|0)!=0){Lx(a,c[b+36>>2]|0);Lx(a,c[b+40>>2]|0)}if((c[a>>2]|0)==(b|0))c[a>>2]=0;e=c[a+4>>2]|0;if((e|0)==0){c[a+4>>2]=b;i=d;return}c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0);c[a+4>>2]=b;i=d;return}function Mx(a,b){a=a|0;b=b|0;var d=0,e=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0;d=i;i=i+32|0;if((b|0)<0)b=c[a+12>>2]|0;j=c[a>>2]|0;if(!((j|0)!=0&(b|0)>0)){i=d;return}while(1){f=j+40|0;a:do if((c[f>>2]|0)!=0){e=0;while(1){g=(c[a+16>>2]|0)>>>e&1;k=j+32|0;h=c[k>>2]|0;if(h>>>0>j>>>0){l=(c[h+40>>2]|0)==(j|0)&1;m=c[h+((l^1)<<2)+36>>2]|0;n=c[h+32>>2]|0;if((n|0)==0)c[a>>2]=j;else c[n+(((c[n+40>>2]|0)==(h|0)&1)<<2)+36>>2]=j;c[m+32>>2]=j;c[h+32>>2]=j;c[k>>2]=n;n=j+36|0;c[h+36>>2]=c[n>>2];c[h+40>>2]=c[f>>2];c[(c[n>>2]|0)+32>>2]=h;c[(c[f>>2]|0)+32>>2]=h;c[j+(l<<2)+36>>2]=h;c[j+((l^1)<<2)+36>>2]=m;c[d+0>>2]=c[h+0>>2];c[d+4>>2]=c[h+4>>2];c[d+8>>2]=c[h+8>>2];c[d+12>>2]=c[h+12>>2];c[d+16>>2]=c[h+16>>2];c[d+20>>2]=c[h+20>>2];c[d+24>>2]=c[h+24>>2];c[d+28>>2]=c[h+28>>2];c[h+0>>2]=c[j+0>>2];c[h+4>>2]=c[j+4>>2];c[h+8>>2]=c[j+8>>2];c[h+12>>2]=c[j+12>>2];c[h+16>>2]=c[j+16>>2];c[h+20>>2]=c[j+20>>2];c[h+24>>2]=c[j+24>>2];c[h+28>>2]=c[j+28>>2];c[j+0>>2]=c[d+0>>2];c[j+4>>2]=c[d+4>>2];c[j+8>>2]=c[d+8>>2];c[j+12>>2]=c[d+12>>2];c[j+16>>2]=c[d+16>>2];c[j+20>>2]=c[d+20>>2];c[j+24>>2]=c[d+24>>2];c[j+28>>2]=c[d+28>>2]}else h=j;j=c[h+(g<<2)+36>>2]|0;if((c[j+40>>2]|0)==0)break a;f=j+40|0;e=e+1&31}}while(0);if((Ox(a,j)|0)==0)e=0;else e=c[a>>2]|0;Nx(a,e,j);c[a+16>>2]=(c[a+16>>2]|0)+1;b=b+ -1|0;if((b|0)==0)break;j=c[a>>2]|0}i=d;return}function Nx(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,h=0.0,j=0.0,k=0,l=0.0,m=0.0,n=0.0,o=0,p=0.0,q=0,r=0,s=0.0;e=i;if((c[a>>2]|0)==0){c[a>>2]=d;c[d+32>>2]=0;i=e;return}f=c[b+40>>2]|0;if((f|0)!=0){l=+g[d>>2]+ +g[d+16>>2];j=+g[d+4>>2]+ +g[d+20>>2];h=+g[d+8>>2]+ +g[d+24>>2];do{r=c[b+36>>2]|0;p=+P(+(l-(+g[r>>2]+ +g[r+16>>2])))+ +P(+(j-(+g[r+4>>2]+ +g[r+20>>2])))+ +P(+(h-(+g[r+8>>2]+ +g[r+24>>2])));b=c[b+((!(p<+P(+(l-(+g[f>>2]+ +g[f+16>>2])))+ +P(+(j-(+g[f+4>>2]+ +g[f+20>>2])))+ +P(+(h-(+g[f+8>>2]+ +g[f+24>>2]))))&1)<<2)+36>>2]|0;f=c[b+40>>2]|0}while((f|0)!=0)}k=b+32|0;f=c[k>>2]|0;r=c[a+4>>2]|0;if((r|0)==0){c[5004]=(c[5004]|0)+1;r=XE(63)|0;if((r|0)!=0?(c[(r+19&-16)+ -4>>2]=r,(r+19&-16|0)!=0):0){o=(r+19&-16)+0|0;q=o+44|0;do{c[o>>2]=0;o=o+4|0}while((o|0)<(q|0));r=r+19&-16}else r=0}else c[a+4>>2]=0;c[r+32>>2]=f;o=r+36|0;c[o>>2]=0;q=r+40|0;c[q>>2]=0;s=+g[d>>2];p=+g[b>>2];p=s<p?s:p;g[r>>2]=p;s=+g[d+16>>2];l=+g[b+16>>2];l=s>l?s:l;g[r+16>>2]=l;s=+g[d+4>>2];n=+g[b+4>>2];n=s<n?s:n;g[r+4>>2]=n;s=+g[d+20>>2];j=+g[b+20>>2];j=s>j?s:j;g[r+20>>2]=j;s=+g[d+8>>2];m=+g[b+8>>2];m=s<m?s:m;g[r+8>>2]=m;s=+g[d+24>>2];h=+g[b+24>>2];h=s>h?s:h;g[r+24>>2]=h;if((f|0)==0){c[o>>2]=b;c[k>>2]=r;c[q>>2]=d;c[d+32>>2]=r;c[a>>2]=r;i=e;return}c[f+(((c[(c[k>>2]|0)+40>>2]|0)==(b|0)&1)<<2)+36>>2]=r;c[o>>2]=b;c[k>>2]=r;c[q>>2]=d;c[d+32>>2]=r;while(1){d=f+4|0;if(((((+g[f>>2]<=p?+g[d>>2]<=n:0)?+g[f+8>>2]<=m:0)?+g[f+16>>2]>=l:0)?+g[f+20>>2]>=j:0)?+g[f+24>>2]>=h:0){d=21;break}q=c[f+36>>2]|0;r=c[f+40>>2]|0;s=+g[q>>2];p=+g[r>>2];p=s<p?s:p;g[f>>2]=p;s=+g[q+16>>2];l=+g[r+16>>2];l=s>l?s:l;g[f+16>>2]=l;s=+g[q+4>>2];n=+g[r+4>>2];n=s<n?s:n;g[d>>2]=n;s=+g[q+20>>2];j=+g[r+20>>2];j=s>j?s:j;g[f+20>>2]=j;s=+g[q+8>>2];m=+g[r+8>>2];m=s<m?s:m;g[f+8>>2]=m;s=+g[q+24>>2];h=+g[r+24>>2];h=s>h?s:h;g[f+24>>2]=h;f=c[f+32>>2]|0;if((f|0)==0){d=21;break}}if((d|0)==21){i=e;return}}function Ox(a,b){a=a|0;b=b|0;var d=0,e=0,f=0,h=0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0,x=0,y=0,z=0,A=0;d=i;if((c[a>>2]|0)==(b|0)){c[a>>2]=0;b=0;i=d;return b|0}f=c[b+32>>2]|0;h=c[f+32>>2]|0;b=c[f+(((c[f+40>>2]|0)!=(b|0)&1)<<2)+36>>2]|0;if((h|0)==0){c[a>>2]=b;c[b+32>>2]=0;e=c[a+4>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[a+4>>2]=f;b=c[a>>2]|0;i=d;return b|0}c[h+(((c[h+40>>2]|0)==(f|0)&1)<<2)+36>>2]=b;c[b+32>>2]=h;b=c[a+4>>2]|0;if((b|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[b+ -4>>2]|0)}c[a+4>>2]=f;do{u=+g[h>>2];z=h+4|0;s=+g[z>>2];x=h+8|0;q=+g[x>>2];A=h+16|0;o=+g[A>>2];y=h+20|0;m=+g[y>>2];b=h+24|0;k=+g[b>>2];w=c[h+36>>2]|0;f=c[h+40>>2]|0;v=+g[w>>2];t=+g[f>>2];t=v<t?v:t;g[h>>2]=t;v=+g[w+16>>2];n=+g[f+16>>2];n=v>n?v:n;g[A>>2]=n;v=+g[w+4>>2];r=+g[f+4>>2];r=v<r?v:r;g[z>>2]=r;v=+g[w+20>>2];l=+g[f+20>>2];l=v>l?v:l;g[y>>2]=l;v=+g[w+8>>2];p=+g[f+8>>2];p=v<p?v:p;g[x>>2]=p;v=+g[w+24>>2];j=+g[f+24>>2];j=v>j?v:j;g[b>>2]=j;if(!(u!=t|s!=r|q!=p|o!=n)?!(m!=l|k!=j):0){e=14;break}h=c[h+32>>2]|0}while((h|0)!=0);if((e|0)==14){i=d;return h|0}A=c[a>>2]|0;i=d;return A|0}function Px(b,d){b=b|0;d=d|0;var e=0,f=0;e=i;c[b>>2]=11432;f=b+4|0;do{a[f+36>>0]=1;c[f+32>>2]=0;c[f+24>>2]=0;c[f+28>>2]=0;a[f+56>>0]=1;c[f+52>>2]=0;c[f+44>>2]=0;c[f+48>>2]=0;c[f>>2]=0;c[f+4>>2]=0;c[f+8>>2]=-1;c[f+12>>2]=0;c[f+16>>2]=0;f=f+60|0}while((f|0)!=(b+124|0));a[b+193>>0]=0;a[b+194>>0]=1;a[b+192>>0]=(d|0)!=0^1;g[b+140>>2]=0.0;c[b+144>>2]=0;c[b+164>>2]=0;c[b+148>>2]=1;c[b+152>>2]=0;c[b+156>>2]=10;c[b+160>>2]=1;c[b+168>>2]=0;c[b+172>>2]=0;g[b+176>>2]=0.0;if((d|0)!=0){f=b+136|0;c[f>>2]=d;f=b+188|0;c[f>>2]=0;f=b+180|0;c[f>>2]=0;f=b+184|0;c[f>>2]=0;f=b+124|0;c[f+0>>2]=0;c[f+4>>2]=0;c[f+8>>2]=0;i=e;return}c[5004]=(c[5004]|0)+1;d=XE(95)|0;if((d|0)!=0?(c[(d+19&-16)+ -4>>2]=d,(d+19&-16|0)!=0):0){Oz(d+19&-16);d=d+19&-16}else d=0;f=b+136|0;c[f>>2]=d;f=b+188|0;c[f>>2]=0;f=b+180|0;c[f>>2]=0;f=b+184|0;c[f>>2]=0;f=b+124|0;c[f+0>>2]=0;c[f+4>>2]=0;c[f+8>>2]=0;i=e;return}function Qx(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=11432;if((a[b+192>>0]|0)!=0?(e=c[b+136>>2]|0,Lb[c[c[e>>2]>>2]&511](e),e=c[b+136>>2]|0,(e|0)!=0):0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=b+124|0;do{e=e+ -60|0;Kx(e)}while((e|0)!=(b+4|0));YE(b);i=d;return}function Rx(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=11432;if((a[b+192>>0]|0)!=0?(e=c[b+136>>2]|0,Lb[c[c[e>>2]>>2]&511](e),e=c[b+136>>2]|0,(e|0)!=0):0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=b+124|0;do{e=e+ -60|0;Kx(e)}while((e|0)!=(b+4|0));i=d;return}function Sx(d,e,f,g,h,j,k,l,m){d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;j=j|0;k=k|0;l=l|0;m=m|0;m=i;i=i+48|0;c[5004]=(c[5004]|0)+1;g=XE(83)|0;if((g|0)==0)g=0;else{c[(g+19&-16)+ -4>>2]=g;g=g+19&-16}c[g>>2]=h;b[g+4>>1]=j;b[g+6>>1]=k;h=g+16|0;c[h+0>>2]=c[e+0>>2];c[h+4>>2]=c[e+4>>2];c[h+8>>2]=c[e+8>>2];c[h+12>>2]=c[e+12>>2];h=g+32|0;c[h+0>>2]=c[f+0>>2];c[h+4>>2]=c[f+4>>2];c[h+8>>2]=c[f+8>>2];c[h+12>>2]=c[f+12>>2];c[g+8>>2]=0;h=g+56|0;c[h>>2]=0;j=g+52|0;c[j>>2]=0;c[m+16>>2]=c[e+0>>2];c[m+20>>2]=c[e+4>>2];c[m+24>>2]=c[e+8>>2];c[m+28>>2]=c[e+12>>2];c[m+32>>2]=c[f+0>>2];c[m+36>>2]=c[f+4>>2];c[m+40>>2]=c[f+8>>2];c[m+44>>2]=c[f+12>>2];c[g+60>>2]=c[d+144>>2];e=(c[d+188>>2]|0)+1|0;c[d+188>>2]=e;c[g+12>>2]=e;e=c[d+8>>2]|0;if((e|0)==0){c[5004]=(c[5004]|0)+1;e=XE(63)|0;if((e|0)!=0?(c[(e+19&-16)+ -4>>2]=e,(e+19&-16|0)!=0):0){k=(e+19&-16)+0|0;f=k+44|0;do{c[k>>2]=0;k=k+4|0}while((k|0)<(f|0));e=e+19&-16}else e=0}else c[d+8>>2]=0;c[e+32>>2]=0;c[e+36>>2]=g;c[e+40>>2]=0;c[e+0>>2]=c[m+16>>2];c[e+4>>2]=c[m+20>>2];c[e+8>>2]=c[m+24>>2];c[e+12>>2]=c[m+28>>2];c[e+16>>2]=c[m+32>>2];c[e+20>>2]=c[m+36>>2];c[e+24>>2]=c[m+40>>2];c[e+28>>2]=c[m+44>>2];Nx(d+4|0,c[d+4>>2]|0,e);c[d+16>>2]=(c[d+16>>2]|0)+1;c[g+48>>2]=e;e=d+(c[d+144>>2]<<2)+124|0;c[j>>2]=0;c[h>>2]=c[e>>2];f=c[e>>2]|0;if((f|0)!=0)c[f+52>>2]=g;c[e>>2]=g;if((a[d+193>>0]|0)!=0){i=m;return g|0}c[m>>2]=11696;c[m+4>>2]=d;c[m+8>>2]=g;Tx(c[d+4>>2]|0,m+16|0,m);Tx(c[d+64>>2]|0,m+16|0,m);i=m;return g|0}function Tx(a,b,d){a=a|0;b=b|0;d=d|0;var e=0.0,f=0,h=0,j=0,k=0.0,l=0,m=0.0,n=0.0,o=0.0,p=0.0,q=0,r=0,s=0,t=0,u=0,v=0,w=0;h=i;if((a|0)==0){i=h;return}e=+g[b>>2];n=+g[b+4>>2];o=+g[b+8>>2];k=+g[b+16>>2];m=+g[b+20>>2];p=+g[b+24>>2];c[5004]=(c[5004]|0)+1;q=XE(275)|0;if((q|0)!=0){c[(q+19&-16)+ -4>>2]=q;b=q+19&-16;if((q+19&-16|0)!=0)c[b>>2]=a}else b=0;t=64;a=1;do{r=a+ -1|0;q=c[b+(r<<2)>>2]|0;do if(((((+g[q>>2]<=k?+g[q+16>>2]>=e:0)?+g[q+4>>2]<=m:0)?+g[q+20>>2]>=n:0)?+g[q+8>>2]<=p:0)?+g[q+24>>2]>=o:0){if((c[q+40>>2]|0)==0){Nb[c[(c[d>>2]|0)+12>>2]&127](d,q);a=r;break}s=c[q+36>>2]|0;if((r|0)==(t|0)?(f=(t|0)==0?1:t<<1,(a|0)<=(f|0)):0){if((f|0)!=0?(c[5004]=(c[5004]|0)+1,l=XE((f<<2|3)+16|0)|0,(l|0)!=0):0){c[(l+19&-16)+ -4>>2]=l;u=l+19&-16}else u=0;if((t|0)>0){w=0;do{v=u+(w<<2)|0;if((v|0)!=0)c[v>>2]=c[b+(w<<2)>>2];w=w+1|0}while((w|0)!=(t|0))}if((b|0)==0){t=f;b=u}else{c[5006]=(c[5006]|0)+1;YE(c[b+ -4>>2]|0);t=f;b=u}}r=b+(r<<2)|0;if((r|0)!=0)c[r>>2]=s;q=c[q+40>>2]|0;if((a|0)==(t|0)){t=(a|0)==0?1:a<<1;if((a|0)<(t|0)){if((t|0)!=0?(c[5004]=(c[5004]|0)+1,j=XE((t<<2|3)+16|0)|0,(j|0)!=0):0){c[(j+19&-16)+ -4>>2]=j;r=j+19&-16}else r=0;if((a|0)>0){s=0;do{u=r+(s<<2)|0;if((u|0)!=0)c[u>>2]=c[b+(s<<2)>>2];s=s+1|0}while((s|0)!=(a|0))}if((b|0)==0)b=r;else{c[5006]=(c[5006]|0)+1;YE(c[b+ -4>>2]|0);b=r}}else t=a}r=b+(a<<2)|0;if((r|0)!=0)c[r>>2]=q;a=a+1|0}else a=r;while(0)}while((a|0)>0);if((b|0)==0){i=h;return}c[5006]=(c[5006]|0)+1;YE(c[b+ -4>>2]|0);i=h;return}function Ux(a){a=a|0;return}function Vx(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,g=0,h=0;f=i;if((c[d+60>>2]|0)==2){g=c[d+48>>2]|0;Ox(b+64|0,g)|0;h=c[b+68>>2]|0;if((h|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[b+68>>2]=g;c[b+76>>2]=(c[b+76>>2]|0)+ -1}else{g=c[d+48>>2]|0;Ox(b+4|0,g)|0;h=c[b+8>>2]|0;if((h|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[b+8>>2]=g;c[b+16>>2]=(c[b+16>>2]|0)+ -1}h=c[d+52>>2]|0;g=c[d+56>>2]|0;if((h|0)==0)c[b+(c[d+60>>2]<<2)+124>>2]=g;else c[h+56>>2]=g;g=c[d+56>>2]|0;if((g|0)!=0)c[g+52>>2]=c[d+52>>2];h=c[b+136>>2]|0;rc[c[(c[h>>2]|0)+16>>2]&127](h,d,e);if((d|0)==0){h=b+194|0;a[h>>0]=1;i=f;return}c[5006]=(c[5006]|0)+1;YE(c[d+ -4>>2]|0);h=b+194|0;a[h>>0]=1;i=f;return}function Wx(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;a=i;c[d+0>>2]=c[b+16>>2];c[d+4>>2]=c[b+20>>2];c[d+8>>2]=c[b+24>>2];c[d+12>>2]=c[b+28>>2];c[e+0>>2]=c[b+32>>2];c[e+4>>2]=c[b+36>>2];c[e+8>>2]=c[b+40>>2];c[e+12>>2]=c[b+44>>2];i=a;return}function Xx(a,b,d,e,f,h){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;d=i;i=i+16|0;c[d>>2]=11616;c[d+4>>2]=e;Yx(a+4|0,c[a+4>>2]|0,b,e+4|0,e+20|0,+g[e+32>>2],f,h,d);Yx(a+64|0,c[a+64>>2]|0,b,e+4|0,e+20|0,+g[e+32>>2],f,h,d);i=d;return}function Yx(b,d,e,f,h,j,k,l,m){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;j=+j;k=k|0;l=l|0;m=m|0;var n=0.0,o=0,p=0.0,q=0.0,r=0.0,s=0,t=0,u=0,v=0,w=0,x=0.0,y=0.0,z=0.0,A=0.0,B=0,C=0,D=0,E=0.0;o=i;i=i+32|0;if((d|0)==0){i=o;return}s=c[b+44>>2]|0;if((s|0)<128){if((c[b+48>>2]|0)<128){c[5004]=(c[5004]|0)+1;t=XE(531)|0;if((t|0)==0)t=0;else{c[(t+19&-16)+ -4>>2]=t;t=t+19&-16}v=c[b+44>>2]|0;if((v|0)>0){u=0;do{w=t+(u<<2)|0;if((w|0)!=0)c[w>>2]=c[(c[b+52>>2]|0)+(u<<2)>>2];u=u+1|0}while((u|0)!=(v|0))}u=c[b+52>>2]|0;if((u|0)!=0){if((a[b+56>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[u+ -4>>2]|0)}c[b+52>>2]=0}a[b+56>>0]=1;c[b+52>>2]=t;c[b+48>>2]=128;t=b+52|0}else t=b+52|0;do{u=(c[t>>2]|0)+(s<<2)|0;if((u|0)!=0)c[u>>2]=0;s=s+1|0}while((s|0)!=128);s=b+48|0}else s=b+48|0;c[b+44>>2]=128;c[c[b+52>>2]>>2]=d;d=1;v=126;do{t=d+ -1|0;w=c[b+52>>2]|0;u=c[w+(t<<2)>>2]|0;y=+g[u+4>>2]- +g[l+4>>2];x=+g[u+8>>2]- +g[l+8>>2];g[o>>2]=+g[u>>2]- +g[l>>2];g[o+4>>2]=y;g[o+8>>2]=x;g[o+12>>2]=0.0;x=+g[u+20>>2]- +g[k+4>>2];y=+g[u+24>>2]- +g[k+8>>2];g[o+16>>2]=+g[u+16>>2]- +g[k>>2];g[o+20>>2]=x;g[o+24>>2]=y;g[o+28>>2]=0.0;D=c[h>>2]|0;y=+g[e>>2];x=+g[f>>2];z=(+g[o+(D<<4)>>2]-y)*x;y=x*(+g[o+(1-D<<4)>>2]-y);D=c[h+4>>2]|0;x=+g[e+4>>2];E=+g[f+4>>2];A=(+g[o+(D<<4)+4>>2]-x)*E;x=E*(+g[o+(1-D<<4)+4>>2]-x);do if(((!(z>x|A>y)?(p=A>z?A:z,r=x<y?x:y,D=c[h+8>>2]|0,q=+g[e+8>>2],E=+g[f+8>>2],n=(+g[o+(D<<4)+8>>2]-q)*E,q=E*(+g[o+(1-D<<4)+8>>2]-q),!(p>q|n>r)):0)?(n>p?n:p)<j:0)?(q<r?q:r)>0.0:0){if((c[u+40>>2]|0)==0){Nb[c[(c[m>>2]|0)+12>>2]&127](m,u);d=t;break}if((t|0)>(v|0)){v=c[b+44>>2]|0;if((v|0)<(v<<1|0)){if((c[s>>2]|0)<(v<<1|0)){if((v|0)!=0){c[5004]=(c[5004]|0)+1;w=XE((v<<3|3)+16|0)|0;if((w|0)==0)w=0;else{c[(w+19&-16)+ -4>>2]=w;w=w+19&-16}C=c[b+44>>2]|0;if((C|0)>0){B=0;do{D=w+(B<<2)|0;if((D|0)!=0)c[D>>2]=c[(c[b+52>>2]|0)+(B<<2)>>2];B=B+1|0}while((B|0)!=(C|0))}}else w=0;B=c[b+52>>2]|0;if((B|0)!=0){if((a[b+56>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[B+ -4>>2]|0)}c[b+52>>2]=0}a[b+56>>0]=1;c[b+52>>2]=w;c[s>>2]=v<<1;B=v}else B=v;do{w=w+(B<<2)|0;if((w|0)!=0)c[w>>2]=0;B=B+1|0;w=c[b+52>>2]|0}while((B|0)!=(v<<1|0))}c[b+44>>2]=v<<1;v=(v<<1)+ -2|0}c[w+(t<<2)>>2]=c[u+36>>2];c[(c[b+52>>2]|0)+(d<<2)>>2]=c[u+40>>2];d=d+1|0}else d=t;while(0)}while((d|0)!=0);i=o;return}function Zx(a){a=a|0;return}function _x(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;i=i+48|0;c[f+32>>2]=11536;c[f+36>>2]=e;c[f+0>>2]=c[b+0>>2];c[f+4>>2]=c[b+4>>2];c[f+8>>2]=c[b+8>>2];c[f+12>>2]=c[b+12>>2];c[f+16>>2]=c[d+0>>2];c[f+20>>2]=c[d+4>>2];c[f+24>>2]=c[d+8>>2];c[f+28>>2]=c[d+12>>2];Tx(c[a+4>>2]|0,f,f+32|0);Tx(c[a+64>>2]|0,f,f+32|0);i=f;return}function $x(a){a=a|0;return}function ay(b,d,e,f,h){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0.0,k=0.0,l=0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0.0,B=0.0,C=0.0,D=0,E=0,F=0,G=0,H=0.0;h=i;i=i+16|0;r=+g[e>>2];p=+g[e+4>>2];n=+g[e+8>>2];k=+g[e+12>>2];q=+g[f>>2];o=+g[f+4>>2];m=+g[f+8>>2];j=+g[f+12>>2];do if((c[d+60>>2]|0)==2){D=c[d+48>>2]|0;Ox(b+64|0,D)|0;l=c[b+68>>2]|0;if((l|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[l+ -4>>2]|0)}c[b+68>>2]=D;c[b+76>>2]=(c[b+76>>2]|0)+ -1;l=c[b+8>>2]|0;if((l|0)==0){c[5004]=(c[5004]|0)+1;D=XE(63)|0;if((D|0)!=0?(c[(D+19&-16)+ -4>>2]=D,(D+19&-16|0)!=0):0){E=(D+19&-16)+0|0;l=E+44|0;do{c[E>>2]=0;E=E+4|0}while((E|0)<(l|0));l=D+19&-16}else l=0}else c[b+8>>2]=0;c[l+32>>2]=0;c[l+36>>2]=d;c[l+40>>2]=0;g[l>>2]=r;g[l+4>>2]=p;g[l+8>>2]=n;g[l+12>>2]=k;g[l+16>>2]=q;g[l+20>>2]=o;g[l+24>>2]=m;g[l+28>>2]=j;Nx(b+4|0,c[b+4>>2]|0,l);c[b+16>>2]=(c[b+16>>2]|0)+1;c[d+48>>2]=l;l=1}else{c[b+168>>2]=(c[b+168>>2]|0)+1;l=c[d+48>>2]|0;y=+g[l>>2];if(((((y<=q?(s=+g[l+16>>2],s>=r):0)?(t=+g[l+4>>2],t<=o):0)?(w=+g[l+20>>2],w>=p):0)?(u=+g[l+8>>2],u<=m):0)?(v=+g[l+24>>2],v>=n):0){H=+g[d+16>>2];C=+g[d+20>>2];B=+g[d+24>>2];x=+g[b+140>>2];z=(+g[d+32>>2]-H)*.5*x;A=x*(+g[d+36>>2]-C)*.5;x=x*(+g[d+40>>2]-B)*.5;if(r-H<0.0)z=-z;if(p-C<0.0)A=-A;if(n-B<0.0)x=-x;if(!(!(y<=r)|!(t<=p)|!(u<=n)|!(s>=q)|!(w>=o)|!(v>=m))){l=0;break}if(z>0.0){r=r+-.05000000074505806;q=z+(q+.05000000074505806)}else{r=z+(r+-.05000000074505806);q=q+.05000000074505806}if(A>0.0){p=p+-.05000000074505806;o=A+(o+.05000000074505806)}else{p=A+(p+-.05000000074505806);o=o+.05000000074505806}if(x>0.0){n=n+-.05000000074505806;m=x+(m+.05000000074505806)}else{n=x+(n+-.05000000074505806);m=m+.05000000074505806}F=Ox(b+4|0,l)|0;a:do if((F|0)!=0){D=c[b+12>>2]|0;if(!((D|0)>-1)){F=c[b+4>>2]|0;break}if((D|0)>0){E=0;while(1){G=c[F+32>>2]|0;E=E+1|0;if((G|0)==0)break a;if((E|0)>=(D|0)){F=G;break}else F=G}}}else F=0;while(0);g[l>>2]=r;g[l+4>>2]=p;g[l+8>>2]=n;g[l+12>>2]=k;g[l+16>>2]=q;g[l+20>>2]=o;g[l+24>>2]=m;g[l+28>>2]=j;Nx(b+4|0,F,l);c[b+172>>2]=(c[b+172>>2]|0)+1;l=1;break}F=Ox(b+4|0,l)|0;b:do if((F|0)!=0){D=c[b+12>>2]|0;if(!((D|0)>-1)){F=c[b+4>>2]|0;break}if((D|0)>0){E=0;while(1){G=c[F+32>>2]|0;E=E+1|0;if((G|0)==0)break b;if((E|0)>=(D|0)){F=G;break}else F=G}}}else F=0;while(0);g[l>>2]=r;g[l+4>>2]=p;g[l+8>>2]=n;g[l+12>>2]=k;g[l+16>>2]=q;g[l+20>>2]=o;g[l+24>>2]=m;g[l+28>>2]=j;Nx(b+4|0,F,l);c[b+172>>2]=(c[b+172>>2]|0)+1;l=1}while(0);D=c[d+52>>2]|0;E=c[d+56>>2]|0;if((D|0)==0)c[b+(c[d+60>>2]<<2)+124>>2]=E;else c[D+56>>2]=E;D=c[d+56>>2]|0;if((D|0)!=0)c[D+52>>2]=c[d+52>>2];c[d+16>>2]=c[e+0>>2];c[d+20>>2]=c[e+4>>2];c[d+24>>2]=c[e+8>>2];c[d+28>>2]=c[e+12>>2];c[d+32>>2]=c[f+0>>2];c[d+36>>2]=c[f+4>>2];c[d+40>>2]=c[f+8>>2];c[d+44>>2]=c[f+12>>2];c[d+60>>2]=c[b+144>>2];f=b+(c[b+144>>2]<<2)+124|0;c[d+52>>2]=0;c[d+56>>2]=c[f>>2];e=c[f>>2]|0;if((e|0)!=0)c[e+52>>2]=d;c[f>>2]=d;if(!l){i=h;return}a[b+194>>0]=1;if((a[b+193>>0]|0)!=0){i=h;return}c[h>>2]=11696;c[h+4>>2]=b;by(b+64|0,c[b+64>>2]|0,c[d+48>>2]|0,h);by(b+4|0,c[b+4>>2]|0,c[d+48>>2]|0,h);i=h;return}function by(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0;h=i;if((d|0)==0|(e|0)==0){i=h;return}if((c[b+24>>2]|0)<128?(c[b+28>>2]|0)<128:0){c[5004]=(c[5004]|0)+1;j=XE(1043)|0;if((j|0)==0)j=0;else{c[(j+19&-16)+ -4>>2]=j;j=j+19&-16}m=c[b+24>>2]|0;if((m|0)>0){l=0;do{k=j+(l<<3)|0;if((k|0)!=0){p=(c[b+32>>2]|0)+(l<<3)|0;q=c[p+4>>2]|0;c[k>>2]=c[p>>2];c[k+4>>2]=q}l=l+1|0}while((l|0)!=(m|0))}k=c[b+32>>2]|0;if((k|0)!=0){if((a[b+36>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[k+ -4>>2]|0)}c[b+32>>2]=0}a[b+36>>0]=1;c[b+32>>2]=j;c[b+28>>2]=128;j=b+28|0}else j=b+28|0;c[b+24>>2]=128;m=c[b+32>>2]|0;c[m>>2]=d;c[m+4>>2]=e;e=1;m=124;do{l=e+ -1|0;o=c[b+32>>2]|0;k=c[o+(l<<3)>>2]|0;d=c[o+(l<<3)+4>>2]|0;if((l|0)>(m|0)){m=c[b+24>>2]|0;if((m|0)<(m<<1|0)?(c[j>>2]|0)<(m<<1|0):0){if((m|0)!=0){c[5004]=(c[5004]|0)+1;n=XE((m<<4|3)+16|0)|0;if((n|0)==0)q=0;else{c[(n+19&-16)+ -4>>2]=n;q=n+19&-16}o=c[b+24>>2]|0;if((o|0)>0){n=0;do{p=q+(n<<3)|0;if((p|0)!=0){s=(c[b+32>>2]|0)+(n<<3)|0;r=c[s+4>>2]|0;c[p>>2]=c[s>>2];c[p+4>>2]=r}n=n+1|0}while((n|0)!=(o|0));o=q}else o=q}else o=0;n=c[b+32>>2]|0;if((n|0)!=0){if((a[b+36>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[n+ -4>>2]|0)}c[b+32>>2]=0}a[b+36>>0]=1;c[b+32>>2]=o;c[j>>2]=m<<1}c[b+24>>2]=m<<1;m=(m<<1)+ -4|0}do if((k|0)==(d|0))if((c[k+40>>2]|0)==0)e=l;else{r=c[k+36>>2]|0;s=o+(l<<3)|0;c[s>>2]=r;c[s+4>>2]=r;s=c[k+40>>2]|0;r=(c[b+32>>2]|0)+(e<<3)|0;c[r>>2]=s;c[r+4>>2]=s;r=c[k+40>>2]|0;s=(c[b+32>>2]|0)+(e+1<<3)|0;c[s>>2]=c[k+36>>2];c[s+4>>2]=r;e=e+2|0}else if(((((+g[k>>2]<=+g[d+16>>2]?+g[k+16>>2]>=+g[d>>2]:0)?+g[k+4>>2]<=+g[d+20>>2]:0)?+g[k+20>>2]>=+g[d+4>>2]:0)?+g[k+8>>2]<=+g[d+24>>2]:0)?+g[k+24>>2]>=+g[d+8>>2]:0){n=(c[d+40>>2]|0)!=0;if((c[k+40>>2]|0)==0)if(n){s=c[d+36>>2]|0;r=o+(l<<3)|0;c[r>>2]=k;c[r+4>>2]=s;r=c[d+40>>2]|0;s=(c[b+32>>2]|0)+(e<<3)|0;c[s>>2]=k;c[s+4>>2]=r;e=e+1|0;break}else{rc[c[(c[f>>2]|0)+8>>2]&127](f,k,d);e=l;break}else{l=o+(l<<3)|0;o=c[k+36>>2]|0;if(n){r=c[d+36>>2]|0;c[l>>2]=o;c[l+4>>2]=r;r=c[d+36>>2]|0;s=(c[b+32>>2]|0)+(e<<3)|0;c[s>>2]=c[k+40>>2];c[s+4>>2]=r;s=c[d+40>>2]|0;r=(c[b+32>>2]|0)+(e+1<<3)|0;c[r>>2]=c[k+36>>2];c[r+4>>2]=s;r=c[d+40>>2]|0;s=(c[b+32>>2]|0)+(e+2<<3)|0;c[s>>2]=c[k+40>>2];c[s+4>>2]=r;e=e+3|0;break}else{c[l>>2]=o;c[l+4>>2]=d;s=(c[b+32>>2]|0)+(e<<3)|0;c[s>>2]=c[k+40>>2];c[s+4>>2]=d;e=e+1|0;break}}}else e=l;while(0)}while((e|0)!=0);i=h;return}function cy(b,d){b=b|0;d=d|0;var e=0,f=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0;e=i;i=i+48|0;Mx(b+4|0,((aa(c[b+152>>2]|0,c[b+16>>2]|0)|0)/100|0)+1|0);if((c[b+164>>2]|0)!=0){p=((aa(c[b+148>>2]|0,c[b+76>>2]|0)|0)/100|0)+1|0;Mx(b+64|0,p);p=(c[b+164>>2]|0)-p|0;c[b+164>>2]=(p|0)<0?0:p}l=((c[b+144>>2]|0)+1|0)%2|0;c[b+144>>2]=l;l=c[b+(l<<2)+124>>2]|0;if((l|0)!=0){do{m=l+56|0;k=l;l=c[m>>2]|0;n=c[k+52>>2]|0;if((n|0)==0)c[b+(c[k+60>>2]<<2)+124>>2]=l;else c[n+56>>2]=l;n=c[m>>2]|0;if((n|0)!=0)c[n+52>>2]=c[k+52>>2];c[k+52>>2]=0;c[m>>2]=c[b+132>>2];m=c[b+132>>2]|0;if((m|0)!=0)c[m+52>>2]=k;c[b+132>>2]=k;n=c[k+48>>2]|0;Ox(b+4|0,n)|0;m=c[b+8>>2]|0;if((m|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[m+ -4>>2]|0)}c[b+8>>2]=n;c[b+16>>2]=(c[b+16>>2]|0)+ -1;c[e+16>>2]=c[k+16>>2];c[e+20>>2]=c[k+20>>2];c[e+24>>2]=c[k+24>>2];c[e+28>>2]=c[k+28>>2];c[e+32>>2]=c[k+32>>2];c[e+36>>2]=c[k+36>>2];c[e+40>>2]=c[k+40>>2];c[e+44>>2]=c[k+44>>2];m=c[b+68>>2]|0;if((m|0)==0){c[5004]=(c[5004]|0)+1;m=XE(63)|0;if((m|0)!=0?(c[(m+19&-16)+ -4>>2]=m,(m+19&-16|0)!=0):0){o=(m+19&-16)+0|0;n=o+44|0;do{c[o>>2]=0;o=o+4|0}while((o|0)<(n|0));m=m+19&-16}else m=0}else c[b+68>>2]=0;c[m+32>>2]=0;c[m+36>>2]=k;c[m+40>>2]=0;c[m+0>>2]=c[e+16>>2];c[m+4>>2]=c[e+20>>2];c[m+8>>2]=c[e+24>>2];c[m+12>>2]=c[e+28>>2];c[m+16>>2]=c[e+32>>2];c[m+20>>2]=c[e+36>>2];c[m+24>>2]=c[e+40>>2];c[m+28>>2]=c[e+44>>2];Nx(b+64|0,c[b+64>>2]|0,m);c[b+76>>2]=(c[b+76>>2]|0)+1;c[k+48>>2]=m;c[k+60>>2]=2}while((l|0)!=0);c[b+164>>2]=c[b+76>>2];a[b+194>>0]=1}c[e>>2]=11696;c[e+4>>2]=b;if((a[b+193>>0]|0)!=0?(by(b+4|0,c[b+4>>2]|0,c[b+64>>2]|0,e),(a[b+193>>0]|0)!=0):0){p=c[b+4>>2]|0;by(b+4|0,p,p,e)}do if((a[b+194>>0]|0)!=0?(h=c[b+136>>2]|0,h=Pb[c[(c[h>>2]|0)+28>>2]&127](h)|0,j=c[h+4>>2]|0,(j|0)>0):0){l=(aa(c[b+156>>2]|0,j)|0)/100|0;p=c[b+160>>2]|0;l=(p|0)>(l|0)?p:l;l=(j|0)<(l|0)?j:l;if((l|0)>0){k=0;do{n=((c[b+184>>2]|0)+k|0)%(j|0)|0;o=c[h+12>>2]|0;m=c[o+(n<<4)>>2]|0;n=c[o+(n<<4)+4>>2]|0;o=c[m+48>>2]|0;p=c[n+48>>2]|0;if(!(((((+g[o>>2]<=+g[p+16>>2]?+g[o+16>>2]>=+g[p>>2]:0)?+g[o+4>>2]<=+g[p+20>>2]:0)?+g[o+20>>2]>=+g[p+4>>2]:0)?+g[o+8>>2]<=+g[p+24>>2]:0)?+g[o+24>>2]>=+g[p+8>>2]:0)){j=c[b+136>>2]|0;Tb[c[(c[j>>2]|0)+12>>2]&31](j,m,n,d)|0;j=c[h+4>>2]|0;k=k+ -1|0;l=l+ -1|0}k=k+1|0}while((k|0)<(l|0));if((j|0)<=0){c[b+184>>2]=0;break}}c[b+184>>2]=((c[b+184>>2]|0)+l|0)%(j|0)|0}while(0);c[b+180>>2]=(c[b+180>>2]|0)+1;c[b+160>>2]=1;a[b+194>>0]=0;h=c[b+168>>2]|0;if((h|0)==0){g[b+176>>2]=0.0;j=c[b+172>>2]|0}else{j=c[b+172>>2]|0;g[b+176>>2]=+(j>>>0)/+(h>>>0)}c[b+172>>2]=j>>>1;c[b+168>>2]=h>>>1;p=c[b+136>>2]|0;if(!(Pb[c[(c[p>>2]|0)+56>>2]&127](p)|0)){i=e;return}h=c[b+136>>2]|0;h=Pb[c[(c[h>>2]|0)+28>>2]&127](h)|0;m=c[h+4>>2]|0;if((m|0)>1){es(h,0,m+ -1|0);o=0;l=0;j=0;k=0;f=45}else{l=0;o=0;j=0;k=0}while(1){if((f|0)==45)m=c[h+4>>2]|0;if((j|0)>=(m|0))break;n=c[h+12>>2]|0;m=n+(j<<4)|0;f=c[m>>2]|0;n=n+(j<<4)+4|0;p=c[n>>2]|0;if((f|0)==(l|0))if((p|0)==(o|0))f=55;else f=49;else{l=f;f=49}if((f|0)==49){f=0;q=c[l+48>>2]|0;o=c[p+48>>2]|0;if(((((+g[q>>2]<=+g[o+16>>2]?+g[q+16>>2]>=+g[o>>2]:0)?+g[q+4>>2]<=+g[o+20>>2]:0)?+g[q+20>>2]>=+g[o+4>>2]:0)?+g[q+8>>2]<=+g[o+24>>2]:0)?+g[q+24>>2]>=+g[o+8>>2]:0)o=p;else{o=p;f=55}}if((f|0)==55){q=c[b+136>>2]|0;rc[c[(c[q>>2]|0)+32>>2]&127](q,m,d);c[m>>2]=0;c[n>>2]=0;k=k+1|0}j=j+1|0;f=45}if((m|0)>1){es(h,0,m+ -1|0);m=c[h+4>>2]|0}b=m-k|0;if((k|0)<0){if((c[h+8>>2]|0)<(b|0)){if((m|0)==(k|0))d=0;else{c[5004]=(c[5004]|0)+1;d=XE((b<<4|3)+16|0)|0;if((d|0)==0)d=0;else{c[(d+19&-16)+ -4>>2]=d;d=d+19&-16}k=c[h+4>>2]|0}if((k|0)>0){f=0;do{q=c[h+12>>2]|0;c[d+(f<<4)>>2]=c[q+(f<<4)>>2];c[d+(f<<4)+4>>2]=c[q+(f<<4)+4>>2];c[d+(f<<4)+8>>2]=c[q+(f<<4)+8>>2];c[d+(f<<4)+12>>2]=c[q+(f<<4)+12>>2];f=f+1|0}while((f|0)!=(k|0))}f=c[h+12>>2]|0;if((f|0)!=0){if((a[h+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}c[h+12>>2]=0}a[h+16>>0]=1;c[h+12>>2]=d;c[h+8>>2]=b;d=h+12|0}else d=h+12|0;do{p=(c[d>>2]|0)+(m<<4)|0;m=m+1|0;q=(m|0)==(b|0);c[p+0>>2]=0;c[p+4>>2]=0;c[p+8>>2]=0;c[p+12>>2]=0}while(!q)}c[h+4>>2]=b;i=e;return}function dy(a){a=a|0;return c[a+136>>2]|0}function ey(a){a=a|0;return c[a+136>>2]|0}function fy(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,h=0.0,j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0;e=i;f=c[a+4>>2]|0;a=c[a+64>>2]|0;do if((f|0)==0)if((a|0)==0){h=0.0;j=0.0;o=0.0;n=0.0;m=0.0;l=0.0;k=0.0;p=0.0}else{h=+g[a>>2];j=+g[a+4>>2];o=+g[a+8>>2];n=+g[a+12>>2];m=+g[a+16>>2];l=+g[a+20>>2];k=+g[a+24>>2];p=+g[a+28>>2]}else{h=+g[f>>2];if((a|0)==0){j=+g[f+4>>2];o=+g[f+8>>2];n=+g[f+12>>2];m=+g[f+16>>2];l=+g[f+20>>2];k=+g[f+24>>2];p=+g[f+28>>2];break}else{t=+g[a>>2];r=+g[f+16>>2];m=+g[a+16>>2];s=+g[f+4>>2];j=+g[a+4>>2];q=+g[f+20>>2];l=+g[a+20>>2];n=+g[f+8>>2];o=+g[a+8>>2];p=+g[f+24>>2];k=+g[a+24>>2];h=h<t?h:t;j=s<j?s:j;o=n<o?n:o;n=0.0;m=r>m?r:m;l=q>l?q:l;k=p>k?p:k;p=0.0;break}}while(0);g[b>>2]=h;g[b+4>>2]=j;g[b+8>>2]=o;g[b+12>>2]=n;g[d>>2]=m;g[d+4>>2]=l;g[d+8>>2]=k;g[d+12>>2]=p;i=e;return}function gy(b,d){b=b|0;d=d|0;var e=0;d=i;if((c[b+16>>2]|0)!=(0-(c[b+76>>2]|0)|0)){i=d;return}e=c[b+4>>2]|0;if((e|0)!=0)Lx(b+4|0,e);e=c[b+8>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+8>>2]=0;c[b+12>>2]=-1;e=c[b+36>>2]|0;if((e|0)!=0){if((a[b+40>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+36>>2]=0}a[b+40>>0]=1;c[b+36>>2]=0;c[b+28>>2]=0;c[b+32>>2]=0;c[b+20>>2]=0;e=c[b+64>>2]|0;if((e|0)!=0)Lx(b+64|0,e);e=c[b+68>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+68>>2]=0;c[b+72>>2]=-1;e=c[b+96>>2]|0;if((e|0)!=0){if((a[b+100>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+96>>2]=0}a[b+100>>0]=1;c[b+96>>2]=0;c[b+88>>2]=0;c[b+92>>2]=0;c[b+80>>2]=0;a[b+193>>0]=0;a[b+194>>0]=1;c[b+144>>2]=0;c[b+164>>2]=0;c[b+148>>2]=1;c[b+152>>2]=0;c[b+156>>2]=10;c[b+160>>2]=1;c[b+124>>2]=0;c[b+128>>2]=0;c[b+132>>2]=0;c[b+168>>2]=0;c[b+172>>2]=0;c[b+176>>2]=0;c[b+180>>2]=0;c[b+184>>2]=0;c[b+188>>2]=0;i=d;return}function hy(a){a=a|0;return}function iy(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function jy(a,b){a=a|0;b=b|0;var d=0;d=i;a=c[a+4>>2]|0;gc[c[(c[a>>2]|0)+8>>2]&31](a,c[b+36>>2]|0)|0;i=d;return}function ky(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function ly(a,b){a=a|0;b=b|0;var d=0;d=i;a=c[a+4>>2]|0;gc[c[(c[a>>2]|0)+8>>2]&31](a,c[b+36>>2]|0)|0;i=d;return}function my(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function ny(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0;e=i;if((b|0)==(d|0)){i=e;return}f=c[(c[a+4>>2]|0)+136>>2]|0;Yb[c[(c[f>>2]|0)+8>>2]&31](f,c[b+36>>2]|0,c[d+36>>2]|0)|0;d=(c[a+4>>2]|0)+160|0;c[d>>2]=(c[d>>2]|0)+1;i=e;return}function oy(a,b){a=a|0;b=b|0;var d=0;d=i;rc[c[(c[a>>2]|0)+8>>2]&127](a,b,c[(c[a+8>>2]|0)+48>>2]|0);i=d;return}function py(b,d){b=b|0;d=d|0;var e=0,f=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0;e=i;c[b>>2]=11776;c[5004]=(c[5004]|0)+1;k=XE(379)|0;if((k|0)==0)k=0;else{c[(k+19&-16)+ -4>>2]=k;k=k+19&-16}g[k+308>>2]=9999999747378752.0e-20;l=k+332|0;a[l>>0]=a[l>>0]&-16;c[b+24>>2]=k;k=(c[d+20>>2]|0)==0;c[5004]=(c[5004]|0)+1;l=XE(23)|0;if((l|0)==0)m=0;else{c[(l+19&-16)+ -4>>2]=l;m=l+19&-16}l=(m|0)==0;if(k){if(l)m=0;else c[m>>2]=14576;c[b+28>>2]=m}else{if(l)m=0;else c[m>>2]=13248;c[b+28>>2]=m}c[5004]=(c[5004]|0)+1;k=XE(43)|0;if((k|0)!=0?(j=k+19&-16,c[j+ -4>>2]=k,(k+19&-16|0)!=0):0){m=c[b+24>>2]|0;n=c[b+28>>2]|0;a[j+4>>0]=0;c[(k+19&-16)>>2]=18792;c[j+16>>2]=0;c[j+20>>2]=3;c[j+12>>2]=m;c[j+8>>2]=n;j=k+19&-16}else j=0;c[b+32>>2]=j;c[5004]=(c[5004]|0)+1;j=XE(27)|0;if((j|0)!=0?(c[(j+19&-16)+ -4>>2]=j,(j+19&-16|0)!=0):0){a[(j+19&-16)+4>>0]=0;c[(j+19&-16)>>2]=12784;j=j+19&-16}else j=0;c[b+36>>2]=j;c[5004]=(c[5004]|0)+1;j=XE(27)|0;if((j|0)!=0?(c[(j+19&-16)+ -4>>2]=j,(j+19&-16|0)!=0):0){a[(j+19&-16)+4>>0]=0;c[(j+19&-16)>>2]=12680;j=j+19&-16}else j=0;c[b+40>>2]=j;c[5004]=(c[5004]|0)+1;j=XE(27)|0;if((j|0)!=0?(c[(j+19&-16)+ -4>>2]=j,(j+19&-16|0)!=0):0){a[(j+19&-16)+4>>0]=0;c[(j+19&-16)>>2]=12592;j=j+19&-16}else j=0;c[b+44>>2]=j;c[5004]=(c[5004]|0)+1;j=XE(27)|0;if((j|0)!=0?(c[(j+19&-16)+ -4>>2]=j,(j+19&-16|0)!=0):0){a[(j+19&-16)+4>>0]=0;c[(j+19&-16)>>2]=12496;j=j+19&-16}else j=0;c[b+48>>2]=j;c[5004]=(c[5004]|0)+1;j=XE(27)|0;if((j|0)!=0?(c[(j+19&-16)+ -4>>2]=j,(j+19&-16|0)!=0):0){a[(j+19&-16)+4>>0]=0;c[(j+19&-16)>>2]=12400;j=j+19&-16}else j=0;c[b+52>>2]=j;c[5004]=(c[5004]|0)+1;j=XE(27)|0;if((j|0)!=0?(c[(j+19&-16)+ -4>>2]=j,(j+19&-16|0)!=0):0){a[(j+19&-16)+4>>0]=0;c[(j+19&-16)>>2]=12320;j=j+19&-16}else j=0;c[b+56>>2]=j;c[5004]=(c[5004]|0)+1;j=XE(27)|0;if((j|0)!=0?(c[(j+19&-16)+ -4>>2]=j,(j+19&-16|0)!=0):0){a[(j+19&-16)+4>>0]=0;c[(j+19&-16)>>2]=12224;j=j+19&-16}else j=0;c[b+60>>2]=j;c[5004]=(c[5004]|0)+1;j=XE(27)|0;if((j|0)!=0?(c[(j+19&-16)+ -4>>2]=j,(j+19&-16|0)!=0):0){a[(j+19&-16)+4>>0]=0;c[(j+19&-16)>>2]=12128;j=j+19&-16}else j=0;c[b+76>>2]=j;c[5004]=(c[5004]|0)+1;j=XE(27)|0;if((j|0)!=0?(c[(j+19&-16)+ -4>>2]=j,(j+19&-16|0)!=0):0){a[(j+19&-16)+4>>0]=0;c[(j+19&-16)>>2]=12128;j=j+19&-16}else j=0;c[b+80>>2]=j;a[j+4>>0]=1;c[5004]=(c[5004]|0)+1;j=XE(27)|0;if((j|0)!=0?(c[(j+19&-16)+ -4>>2]=j,(j+19&-16|0)!=0):0){a[(j+19&-16)+4>>0]=0;c[(j+19&-16)>>2]=12040;j=j+19&-16}else j=0;c[b+72>>2]=j;c[5004]=(c[5004]|0)+1;j=XE(35)|0;if((j|0)!=0?(h=j+19&-16,c[h+ -4>>2]=j,(j+19&-16|0)!=0):0){a[h+4>>0]=0;c[(j+19&-16)>>2]=11904;c[h+8>>2]=1;c[h+12>>2]=0;h=j+19&-16}else h=0;c[b+88>>2]=h;c[5004]=(c[5004]|0)+1;h=XE(35)|0;if((h|0)!=0?(f=h+19&-16,c[f+ -4>>2]=h,(h+19&-16|0)!=0):0){a[f+4>>0]=0;c[(h+19&-16)>>2]=11904;c[f+8>>2]=1;c[f+12>>2]=0;f=h+19&-16}else f=0;c[b+84>>2]=f;a[f+4>>0]=1;f=c[d+16>>2]|0;f=(f|0)<36?36:f;f=(f|0)>80?f:80;f=(f|0)>44?f:44;h=c[d>>2]|0;if((h|0)==0){a[b+12>>0]=1;c[5004]=(c[5004]|0)+1;h=XE(39)|0;do if((h|0)==0)h=0;else{l=h+19&-16;c[l+ -4>>2]=h;if((h+19&-16|0)==0){h=0;break}j=c[d+8>>2]|0;c[(h+19&-16)>>2]=772;c[l+4>>2]=j;c[5004]=(c[5004]|0)+1;j=XE((j*772|3)+16|0)|0;if((j|0)==0)k=0;else{c[(j+19&-16)+ -4>>2]=j;k=j+19&-16}c[l+16>>2]=k;c[l+12>>2]=k;j=c[l+4>>2]|0;c[l+8>>2]=j;if((j+ -1|0)!=0){n=c[(h+19&-16)>>2]|0;m=j+ -1|0;l=k;do{o=l;l=l+n|0;c[o>>2]=l;m=m+ -1|0}while((m|0)!=0);k=k+(aa(n,j+ -1|0)|0)|0}c[k>>2]=0;h=h+19&-16}while(0);c[b+8>>2]=h}else{a[b+12>>0]=0;c[b+8>>2]=h}h=c[d+4>>2]|0;if((h|0)!=0){a[b+20>>0]=0;c[b+16>>2]=h;i=e;return}a[b+20>>0]=1;c[5004]=(c[5004]|0)+1;h=XE(39)|0;do if((h|0)==0)d=0;else{j=h+19&-16;c[j+ -4>>2]=h;if((h+19&-16|0)==0){d=0;break}d=c[d+12>>2]|0;c[(h+19&-16)>>2]=f;c[j+4>>2]=d;d=aa(d,f)|0;c[5004]=(c[5004]|0)+1;d=XE(d+19|0)|0;if((d|0)==0)f=0;else{c[(d+19&-16)+ -4>>2]=d;f=d+19&-16}c[j+16>>2]=f;c[j+12>>2]=f;d=c[j+4>>2]|0;c[j+8>>2]=d;if((d+ -1|0)!=0){k=c[(h+19&-16)>>2]|0;j=d+ -1|0;l=f;do{o=l;l=l+k|0;c[o>>2]=l;j=j+ -1|0}while((j|0)!=0);f=f+(aa(k,d+ -1|0)|0)|0}c[f>>2]=0;d=h+19&-16}while(0);c[b+16>>2]=d;i=e;return}function qy(a){a=a|0;var b=0;b=i;ry(a);YE(a);i=b;return}function ry(b){b=b|0;var d=0,e=0,f=0;d=i;c[b>>2]=11776;if((a[b+20>>0]|0)!=0){e=c[b+16>>2]|0;f=c[e+16>>2]|0;if((f|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0);e=c[b+16>>2]|0}if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}}if((a[b+12>>0]|0)!=0){e=c[b+8>>2]|0;f=c[e+16>>2]|0;if((f|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0);e=c[b+8>>2]|0}if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}}e=c[b+32>>2]|0;Lb[c[c[e>>2]>>2]&511](e);e=c[b+32>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+36>>2]|0;Lb[c[c[e>>2]>>2]&511](e);e=c[b+36>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+40>>2]|0;Lb[c[c[e>>2]>>2]&511](e);e=c[b+40>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+44>>2]|0;Lb[c[c[e>>2]>>2]&511](e);e=c[b+44>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+48>>2]|0;Lb[c[c[e>>2]>>2]&511](e);e=c[b+48>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+52>>2]|0;Lb[c[c[e>>2]>>2]&511](e);e=c[b+52>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+56>>2]|0;Lb[c[c[e>>2]>>2]&511](e);e=c[b+56>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+60>>2]|0;Lb[c[c[e>>2]>>2]&511](e);e=c[b+60>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+76>>2]|0;Lb[c[c[e>>2]>>2]&511](e);e=c[b+76>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+80>>2]|0;Lb[c[c[e>>2]>>2]&511](e);e=c[b+80>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+72>>2]|0;Lb[c[c[e>>2]>>2]&511](e);e=c[b+72>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+88>>2]|0;Lb[c[c[e>>2]>>2]&511](e);e=c[b+88>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+84>>2]|0;Lb[c[c[e>>2]>>2]&511](e);e=c[b+84>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}e=c[b+24>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}f=c[b+28>>2]|0;Lb[c[c[f>>2]>>2]&511](f);b=c[b+28>>2]|0;if((b|0)==0){i=d;return}c[5006]=(c[5006]|0)+1;YE(c[b+ -4>>2]|0);i=d;return}function sy(a,b,d){a=a|0;b=b|0;d=d|0;var e=0;e=i;do if(!((b|0)==8&(d|0)==8)){if((b|0)==8&(d|0)==1){a=a+76|0;break}if((b|0)==1&(d|0)==8){a=a+80|0;break}if((d|b|0)==0){a=a+72|0;break}if((b|0)<20&(d|0)==28){a=a+88|0;break}if((d|0)<20&(b|0)==28){a=a+84|0;break}if((b|0)<20){if((d|0)<20){a=a+32|0;break}if((d+ -21|0)>>>0<9){a=a+36|0;break}}else if((d|0)<20?(b+ -21|0)>>>0<9:0){a=a+40|0;break}if((b|0)==31)if((d|0)==31){a=a+48|0;break}else{a=a+44|0;break}else if((d|0)==31){a=a+52|0;break}else{a=a+56|0;break}}else a=a+60|0;while(0);i=e;return c[a>>2]|0}function ty(a){a=a|0;return c[a+8>>2]|0}function uy(a){a=a|0;return c[a+16>>2]|0}function vy(a){a=a|0;return c[a+24>>2]|0}function wy(a){a=a|0;return}function xy(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function yy(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var g=0,h=0,j=0,k=0;g=i;h=c[d>>2]|0;h=gc[c[(c[h>>2]|0)+56>>2]&31](h,28)|0;if((a[b+4>>0]|0)==0){if((h|0)==0){f=0;i=g;return f|0}j=c[b+8>>2]|0;b=c[b+12>>2]|0;d=c[d>>2]|0;c[h+4>>2]=d;c[h>>2]=19408;a[h+8>>0]=0;c[h+12>>2]=0;a[h+16>>0]=0;c[h+20>>2]=j;c[h+24>>2]=b;if(!(Yb[c[(c[d>>2]|0)+24>>2]&31](d,c[e+8>>2]|0,c[f+8>>2]|0)|0)){j=h;i=g;return j|0}j=c[h+4>>2]|0;c[h+12>>2]=Yb[c[(c[j>>2]|0)+12>>2]&31](j,c[e+8>>2]|0,c[f+8>>2]|0)|0;a[h+8>>0]=1;j=h;i=g;return j|0}else{if((h|0)==0){j=0;i=g;return j|0}k=c[b+8>>2]|0;b=c[b+12>>2]|0;j=c[d>>2]|0;c[h+4>>2]=j;c[h>>2]=19408;a[h+8>>0]=0;c[h+12>>2]=0;a[h+16>>0]=1;c[h+20>>2]=k;c[h+24>>2]=b;if(!(Yb[c[(c[j>>2]|0)+24>>2]&31](j,c[f+8>>2]|0,c[e+8>>2]|0)|0)){k=h;i=g;return k|0}k=c[h+4>>2]|0;c[h+12>>2]=Yb[c[(c[k>>2]|0)+12>>2]&31](k,c[f+8>>2]|0,c[e+8>>2]|0)|0;a[h+8>>0]=1;k=h;i=g;return k|0}return 0}function zy(a){a=a|0;return}function Ay(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function By(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var g=0;b=i;g=c[d>>2]|0;g=gc[c[(c[g>>2]|0)+56>>2]&31](g,16)|0;if((g|0)==0){g=0;i=b;return g|0}d=c[d>>2]|0;c[g+4>>2]=d;c[g>>2]=17896;a[g+8>>0]=0;c[g+12>>2]=0;if(!(Yb[c[(c[d>>2]|0)+24>>2]&31](d,c[e+8>>2]|0,c[f+8>>2]|0)|0)){i=b;return g|0}d=c[g+4>>2]|0;c[g+12>>2]=Yb[c[(c[d>>2]|0)+12>>2]&31](d,c[e+8>>2]|0,c[f+8>>2]|0)|0;a[g+8>>0]=1;i=b;return g|0}function Cy(a){a=a|0;return}function Dy(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Ey(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var g=0,h=0,j=0;g=i;h=c[d>>2]|0;h=gc[c[(c[h>>2]|0)+56>>2]&31](h,20)|0;if((h|0)==0){b=0;i=g;return b|0}j=c[d+4>>2]|0;b=a[b+4>>0]|0;d=c[d>>2]|0;c[h+4>>2]=d;c[h>>2]=16904;a[h+8>>0]=0;c[h+12>>2]=j;a[h+16>>0]=b;if((j|0)!=0){j=h;i=g;return j|0}c[h+12>>2]=Yb[c[(c[d>>2]|0)+12>>2]&31](d,c[e+8>>2]|0,c[f+8>>2]|0)|0;a[h+8>>0]=1;j=h;i=g;return j|0}function Fy(a){a=a|0;return}function Gy(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Hy(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var g=0;b=i;g=c[d>>2]|0;g=gc[c[(c[g>>2]|0)+56>>2]&31](g,16)|0;if((g|0)==0){g=0;i=b;return g|0}d=c[d>>2]|0;c[g+4>>2]=d;c[g>>2]=16816;a[g+8>>0]=0;c[g+12>>2]=0;c[g+12>>2]=Yb[c[(c[d>>2]|0)+12>>2]&31](d,c[e+8>>2]|0,c[f+8>>2]|0)|0;a[g+8>>0]=1;i=b;return g|0}function Iy(a){a=a|0;return}function Jy(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Ky(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;a=i;d=c[b>>2]|0;d=gc[c[(c[d>>2]|0)+56>>2]&31](d,8)|0;if((d|0)==0){e=0;i=a;return e|0}c[d+4>>2]=c[b>>2];c[d>>2]=12904;e=d;i=a;return e|0}function Ly(a){a=a|0;return}function My(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Ny(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var g=0;b=i;g=c[d>>2]|0;g=gc[c[(c[g>>2]|0)+56>>2]&31](g,44)|0;if((g|0)==0){g=0;i=b;return g|0}c[g+4>>2]=c[d>>2];c[g>>2]=18040;a[g+24>>0]=1;c[g+20>>2]=0;c[g+12>>2]=0;c[g+16>>2]=0;a[g+28>>0]=1;c[g+32>>2]=c[d+4>>2];a[g+36>>0]=0;c[g+40>>2]=c[(c[f+4>>2]|0)+68>>2];yC(g,e,f);i=b;return g|0}function Oy(a){a=a|0;return}function Py(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Qy(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var g=0,h=0,j=0,k=0,l=0,m=0,n=0;h=i;b=c[d>>2]|0;b=gc[c[(c[b>>2]|0)+56>>2]&31](b,48)|0;if((b|0)==0){m=0;i=h;return m|0}c[b+4>>2]=c[d>>2];c[b>>2]=18208;a[b+28>>0]=1;c[b+24>>2]=0;c[b+16>>2]=0;c[b+20>>2]=0;c[b+32>>2]=c[d+4>>2];a[b+36>>0]=0;c[5004]=(c[5004]|0)+1;d=XE(87)|0;if((d|0)!=0?(g=d+19&-16,c[g+ -4>>2]=d,(d+19&-16|0)!=0):0){c[(d+19&-16)>>2]=19600;a[g+20>>0]=1;c[g+16>>2]=0;c[g+8>>2]=0;c[g+12>>2]=0;a[g+24>>0]=0;a[g+44>>0]=1;c[g+40>>2]=0;c[g+32>>2]=0;c[g+36>>2]=0;a[g+64>>0]=1;c[g+60>>2]=0;c[g+52>>2]=0;c[g+56>>2]=0;c[5004]=(c[5004]|0)+1;j=XE(43)|0;if((j|0)==0)j=0;else{c[(j+19&-16)+ -4>>2]=j;j=j+19&-16}k=c[g+8>>2]|0;if((k|0)>0){l=0;do{m=j+(l*12|0)|0;if((m|0)!=0){n=(c[g+16>>2]|0)+(l*12|0)|0;c[m+0>>2]=c[n+0>>2];c[m+4>>2]=c[n+4>>2];c[m+8>>2]=c[n+8>>2]}l=l+1|0}while((l|0)!=(k|0))}k=c[g+16>>2]|0;if((k|0)!=0){if((a[g+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[k+ -4>>2]|0)}c[g+16>>2]=0}a[g+20>>0]=1;c[g+16>>2]=j;c[g+12>>2]=2;MD(d+19&-16);g=d+19&-16}else g=0;c[b+8>>2]=g;c[b+40>>2]=c[(c[e+4>>2]|0)+68>>2];c[b+44>>2]=c[(c[f+4>>2]|0)+68>>2];n=b;i=h;return n|0}function Ry(a){a=a|0;return}function Sy(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Ty(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var g=0;b=i;g=c[d>>2]|0;g=gc[c[(c[g>>2]|0)+56>>2]&31](g,44)|0;if((g|0)==0){g=0;i=b;return g|0}c[g+4>>2]=c[d>>2];c[g>>2]=18040;a[g+24>>0]=1;c[g+20>>2]=0;c[g+12>>2]=0;c[g+16>>2]=0;a[g+28>>0]=0;c[g+32>>2]=c[d+4>>2];a[g+36>>0]=0;c[g+40>>2]=c[(c[e+4>>2]|0)+68>>2];yC(g,e,f);i=b;return g|0}function Uy(a){a=a|0;return}function Vy(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Wy(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var g=0;b=i;g=c[d>>2]|0;g=gc[c[(c[g>>2]|0)+56>>2]&31](g,80)|0;if((g|0)==0){g=0;i=b;return g|0}c[g+4>>2]=c[d>>2];c[g>>2]=18432;a[g+8>>0]=1;d=c[d>>2]|0;c[g+12>>2]=18464;c[g+60>>2]=d;c[g+64>>2]=0;c[g+16>>2]=f;c[g+20>>2]=e;e=Yb[c[(c[d>>2]|0)+12>>2]&31](d,c[f+8>>2]|0,c[e+8>>2]|0)|0;c[g+76>>2]=e;f=c[g+60>>2]|0;Nb[c[(c[f>>2]|0)+20>>2]&127](f,e);i=b;return g|0}function Xy(a){a=a|0;return}function Yy(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Zy(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var g=0;b=i;g=c[d>>2]|0;g=gc[c[(c[g>>2]|0)+56>>2]&31](g,80)|0;if((g|0)==0){g=0;i=b;return g|0}c[g+4>>2]=c[d>>2];c[g>>2]=18432;a[g+8>>0]=0;d=c[d>>2]|0;c[g+12>>2]=18464;c[g+60>>2]=d;c[g+64>>2]=0;c[g+16>>2]=e;c[g+20>>2]=f;f=Yb[c[(c[d>>2]|0)+12>>2]&31](d,c[e+8>>2]|0,c[f+8>>2]|0)|0;c[g+76>>2]=f;e=c[g+60>>2]|0;Nb[c[(c[e>>2]|0)+20>>2]&127](e,f);i=b;return g|0}function _y(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;return}function $y(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;return 1.0}function az(a){a=a|0;return}function bz(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function cz(a,b){a=a|0;b=b|0;return}function dz(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=13008;e=c[b+276>>2]|0;if((e|0)==0){a[b+280>>0]=1;c[b+276>>2]=0;c[b+268>>2]=0;c[b+272>>2]=0}else{if((a[b+280>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}a[b+280>>0]=1;c[b+276>>2]=0;c[b+268>>2]=0;c[b+272>>2]=0}c[5006]=(c[5006]|0)+1;YE(c[b+ -4>>2]|0);i=d;return}function ez(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=13008;e=c[b+276>>2]|0;if((e|0)!=0){if((a[b+280>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+276>>2]=0}a[b+280>>0]=1;c[b+276>>2]=0;c[b+268>>2]=0;c[b+272>>2]=0;i=d;return}function fz(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,k=0;e=i;d=c[d>>2]|0;h=c[b+268>>2]|0;a:do if((h|0)>0){k=c[b+276>>2]|0;j=0;while(1){g=j+1|0;if((c[k+(j<<2)>>2]|0)==(d|0))break;if((g|0)<(h|0))j=g;else break a}if((j|0)!=(h|0)){i=e;return}}while(0);if((h|0)==(c[b+272>>2]|0)?(f=(h|0)==0?1:h<<1,(h|0)<(f|0)):0){if((f|0)==0)g=0;else{c[5004]=(c[5004]|0)+1;g=XE((f<<2|3)+16|0)|0;if((g|0)==0)g=0;else{c[(g+19&-16)+ -4>>2]=g;g=g+19&-16}h=c[b+268>>2]|0}if((h|0)>0){k=0;do{j=g+(k<<2)|0;if((j|0)!=0)c[j>>2]=c[(c[b+276>>2]|0)+(k<<2)>>2];k=k+1|0}while((k|0)!=(h|0))}j=c[b+276>>2]|0;if((j|0)!=0){if((a[b+280>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0);h=c[b+268>>2]|0}c[b+276>>2]=0}a[b+280>>0]=1;c[b+276>>2]=g;c[b+272>>2]=f}f=(c[b+276>>2]|0)+(h<<2)|0;if((f|0)!=0)c[f>>2]=d;c[b+268>>2]=h+1;i=e;return}function gz(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,k=0;e=i;b=c[b>>2]|0;h=c[a+268>>2]|0;if((h|0)<=0){i=e;return}k=c[a+276>>2]|0;j=0;while(1){g=k+(j<<2)|0;d=j+1|0;if((c[g>>2]|0)==(b|0))break;if((d|0)<(h|0))j=d;else{f=7;break}}if((f|0)==7){i=e;return}if((j|0)>=(h|0)){i=e;return}c[g>>2]=c[k+(h+ -1<<2)>>2];c[a+268>>2]=h+ -1;i=e;return}function hz(a){a=a|0;var b=0;b=i;iz(a);if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function iz(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=13056;e=c[b+284>>2]|0;Lb[c[c[e>>2]>>2]&511](e);e=c[b+284>>2]|0;if((e|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b>>2]=13008;e=c[b+276>>2]|0;if((e|0)==0){a[b+280>>0]=1;c[b+276>>2]=0;c[b+268>>2]=0;e=b+272|0;c[e>>2]=0;i=d;return}if((a[b+280>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+276>>2]=0;a[b+280>>0]=1;c[b+276>>2]=0;c[b+268>>2]=0;e=b+272|0;c[e>>2]=0;i=d;return}function jz(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,k=0,l=0,m=0;f=i;if((e|0)==0)e=c[b+188>>2]|0;g=c[d>>2]|0;k=c[b+268>>2]|0;a:do if((k|0)>0){m=c[b+276>>2]|0;j=0;while(1){l=j+1|0;if((c[m+(j<<2)>>2]|0)==(g|0))break;if((l|0)<(k|0))j=l;else break a}if((j|0)!=(k|0)){i=f;return}}while(0);if((k|0)==(c[b+272>>2]|0)?(h=(k|0)==0?1:k<<1,(k|0)<(h|0)):0){if((h|0)==0)j=0;else{c[5004]=(c[5004]|0)+1;j=XE((h<<2|3)+16|0)|0;if((j|0)==0)j=0;else{c[(j+19&-16)+ -4>>2]=j;j=j+19&-16}k=c[b+268>>2]|0}if((k|0)>0){m=0;do{l=j+(m<<2)|0;if((l|0)!=0)c[l>>2]=c[(c[b+276>>2]|0)+(m<<2)>>2];m=m+1|0}while((m|0)!=(k|0))}l=c[b+276>>2]|0;if((l|0)!=0){if((a[b+280>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[l+ -4>>2]|0);k=c[b+268>>2]|0}c[b+276>>2]=0}a[b+280>>0]=1;c[b+276>>2]=j;c[b+272>>2]=h}h=(c[b+276>>2]|0)+(k<<2)|0;if((h|0)!=0)c[h>>2]=g;c[b+268>>2]=k+1;m=c[b+284>>2]|0;Yb[c[(c[m>>2]|0)+8>>2]&31](m,e,d)|0;i=f;return}function kz(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0;h=i;f=c[b>>2]|0;if((e|0)==0)e=c[a+188>>2]|0;k=c[a+268>>2]|0;if((k|0)<=0){i=h;return}l=c[a+276>>2]|0;m=0;while(1){n=l+(m<<2)|0;j=m+1|0;if((c[n>>2]|0)==(f|0))break;if((j|0)<(k|0))m=j;else{g=9;break}}if((g|0)==9){i=h;return}if((m|0)>=(k|0)){i=h;return}c[n>>2]=c[l+(k+ -1<<2)>>2];c[a+268>>2]=k+ -1;n=c[a+284>>2]|0;Tb[c[(c[n>>2]|0)+12>>2]&31](n,e,b,d)|0;i=h;return}function lz(a,b,d,e,f,h){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;h=+h;var j=0.0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0,s=0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0,z=0.0,A=0.0,B=0,C=0,D=0,E=0,F=0.0,G=0.0,H=0.0,I=0.0,J=0,K=0.0,L=0.0,M=0.0;y=i;i=i+320|0;c[y+176>>2]=c[d+0>>2];c[y+180>>2]=c[d+4>>2];c[y+184>>2]=c[d+8>>2];c[y+188>>2]=c[d+12>>2];c[y+192>>2]=c[d+16>>2];c[y+196>>2]=c[d+20>>2];c[y+200>>2]=c[d+24>>2];c[y+204>>2]=c[d+28>>2];c[y+208>>2]=c[d+32>>2];c[y+212>>2]=c[d+36>>2];c[y+216>>2]=c[d+40>>2];c[y+220>>2]=c[d+44>>2];c[y+224>>2]=c[d+48>>2];c[y+228>>2]=c[d+52>>2];c[y+232>>2]=c[d+56>>2];c[y+236>>2]=c[d+60>>2];c[y+112>>2]=c[e+0>>2];c[y+116>>2]=c[e+4>>2];c[y+120>>2]=c[e+8>>2];c[y+124>>2]=c[e+12>>2];c[y+128>>2]=c[e+16>>2];c[y+132>>2]=c[e+20>>2];c[y+136>>2]=c[e+24>>2];c[y+140>>2]=c[e+28>>2];c[y+144>>2]=c[e+32>>2];c[y+148>>2]=c[e+36>>2];c[y+152>>2]=c[e+40>>2];c[y+156>>2]=c[e+44>>2];c[y+160>>2]=c[e+48>>2];c[y+164>>2]=c[e+52>>2];c[y+168>>2]=c[e+56>>2];c[y+172>>2]=c[e+60>>2];H=+g[y+164>>2]- +g[y+228>>2];M=+g[y+168>>2]- +g[y+232>>2];g[y+64>>2]=+g[y+160>>2]- +g[y+224>>2];g[y+68>>2]=H;g[y+72>>2]=M;g[y+76>>2]=0.0;Bo(y+176|0,y+112|0,y+248|0,y+240|0);M=+g[y+240>>2];H=M*+g[y+252>>2];F=M*+g[y+256>>2];g[y+48>>2]=+g[y+248>>2]*M;g[y+52>>2]=H;g[y+56>>2]=F;g[y+60>>2]=0.0;g[y+248>>2]=1.0;D=y+252|0;c[D+0>>2]=0;c[D+4>>2]=0;c[D+8>>2]=0;c[D+12>>2]=0;g[y+268>>2]=1.0;E=y+272|0;c[E+0>>2]=0;c[E+4>>2]=0;c[E+8>>2]=0;c[E+12>>2]=0;g[y+288>>2]=1.0;J=y+292|0;c[J+0>>2]=0;c[J+4>>2]=0;c[J+8>>2]=0;c[J+12>>2]=0;c[J+16>>2]=0;Hc(y+176|0,y+32|0);F=+g[y+32>>2];H=+g[y+36>>2];M=+g[y+40>>2];K=+g[y+44>>2];G=F*(2.0/(F*F+H*H+M*M+K*K));I=H*(2.0/(F*F+H*H+M*M+K*K));L=M*(2.0/(F*F+H*H+M*M+K*K));g[y+248>>2]=1.0-(H*I+M*L);g[D>>2]=F*I-K*L;g[y+256>>2]=F*L+K*I;g[y+260>>2]=0.0;g[y+264>>2]=F*I+K*L;g[y+268>>2]=1.0-(F*G+M*L);g[E>>2]=H*L-K*G;g[y+276>>2]=0.0;g[y+280>>2]=F*L-K*I;g[y+284>>2]=H*L+K*G;g[y+288>>2]=1.0-(F*G+H*I);g[J>>2]=0.0;mu(b,y+248|0,y+64|0,y+48|0,y+96|0,y+80|0);if((c[a+268>>2]|0)<=0){i=y;return}B=0;do{C=c[(c[a+276>>2]|0)+(B<<2)>>2]|0;if(gc[c[(c[f>>2]|0)+8>>2]&31](f,c[C+188>>2]|0)|0?(s=c[C+192>>2]|0,vc[c[(c[s>>2]|0)+8>>2]&127](s,C+4|0,y+16|0,y),z=+g[y+16>>2]+ +g[y+96>>2],v=+g[y+20>>2]+ +g[y+100>>2],p=+g[y+24>>2]+ +g[y+104>>2],g[y+16>>2]=z,g[y+20>>2]=v,g[y+24>>2]=p,g[y+28>>2]=0.0,j=+g[y>>2]+ +g[y+80>>2],u=+g[y+4>>2]+ +g[y+84>>2],o=+g[y+8>>2]+ +g[y+88>>2],g[y>>2]=j,g[y+4>>2]=u,g[y+8>>2]=o,g[y+12>>2]=0.0,x=+g[d+48>>2]-(j+z)*.5,t=+g[d+52>>2]-(u+v)*.5,n=+g[d+56>>2]-(o+p)*.5,A=+g[e+48>>2]-(j+z)*.5,w=+g[e+52>>2]-(u+v)*.5,q=+g[e+56>>2]-(o+p)*.5,s=x<-((j-z)*.5)|(x>(j-z)*.5?8:0)|(t>(u-v)*.5?16:0)|(t<-((u-v)*.5)?2:0)|(n>(o-p)*.5?32:0)|(n<-((o-p)*.5)?4:0),r=A<-((j-z)*.5)|(A>(j-z)*.5?8:0)|(w>(u-v)*.5?16:0)|(w<-((u-v)*.5)?2:0)|(q>(o-p)*.5?32:0)|(q<-((o-p)*.5)?4:0),(s&r|0)==0):0){G=1.0;D=1;E=0;H=0.0;F=1.0;while(1){if((D&s|0)==0){if((D&r|0)!=0?(m=(-x-F*(j-z)*.5)/(A-x),m<G):0)G=m}else{I=(-x-F*(j-z)*.5)/(A-x);if(H<=I)H=I}J=D<<1;if((J&s|0)==0){if((J&r|0)!=0?(l=(-t-F*(u-v)*.5)/(w-t),l<G):0)G=l}else{I=(-t-F*(u-v)*.5)/(w-t);if(H<=I)H=I}J=D<<2;if((J&s|0)==0){if((J&r|0)!=0?(k=(-n-F*(o-p)*.5)/(q-n),k<G):0)G=k}else{F=(-n-F*(o-p)*.5)/(q-n);if(H<=F)H=F}E=E+1|0;if((E|0)==2)break;else{D=D<<3;F=-1.0}}if(H<=G){J=c[C+192>>2]|0;c[y+248>>2]=0;c[y+252>>2]=J;c[y+256>>2]=C;c[y+260>>2]=C+4;c[y+264>>2]=-1;c[y+268>>2]=-1;Au(b,y+176|0,y+112|0,y+248|0,f,h)}}B=B+1|0}while((B|0)<(c[a+268>>2]|0));i=y;return}function mz(b,d,e,f,h,j){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;var k=0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0,u=0,v=0.0;k=i;i=i+288|0;u=c[b+4>>2]|0;a[u+312>>0]=0;c[u>>2]=0;a[u+356>>0]=1;g[u+292>>2]=999999984306749400.0;g[u+296>>2]=999999984306749400.0;g[u+300>>2]=999999984306749400.0;g[u+304>>2]=0.0;c[u+336>>2]=0;c[u+340>>2]=0;c[u+344>>2]=0;c[u+348>>2]=0;a[u+352>>0]=0;a[u+332>>0]=a[u+332>>0]&-16;n=+g[e+48>>2]- +g[d+48>>2]-(+g[h+48>>2]- +g[f+48>>2]);m=+g[e+52>>2]- +g[d+52>>2]-(+g[h+52>>2]- +g[f+52>>2]);l=+g[e+56>>2]- +g[d+56>>2]-(+g[h+56>>2]- +g[f+56>>2]);c[k+216>>2]=10224;g[k+252>>2]=999999984306749400.0;a[k+256>>0]=0;u=c[b+8>>2]|0;t=c[b+12>>2]|0;b=c[b+4>>2]|0;c[k+136>>2]=13392;g[k+140>>2]=0.0;g[k+144>>2]=1.0;g[k+148>>2]=0.0;g[k+152>>2]=0.0;c[k+156>>2]=0;c[k+160>>2]=b;c[k+164>>2]=u;c[k+168>>2]=t;c[k+172>>2]=c[u+4>>2];c[k+176>>2]=c[t+4>>2];g[k+180>>2]=+$b[c[(c[u>>2]|0)+48>>2]&15](u);g[k+184>>2]=+$b[c[(c[t>>2]|0)+48>>2]&15](t);a[k+188>>0]=0;c[k+196>>2]=-1;c[k+208>>2]=1;c[k+212>>2]=1;g[k+128>>2]=999999984306749400.0;c[k+0>>2]=c[d+0>>2];c[k+4>>2]=c[d+4>>2];c[k+8>>2]=c[d+8>>2];c[k+12>>2]=c[d+12>>2];c[k+16>>2]=c[d+16>>2];c[k+20>>2]=c[d+20>>2];c[k+24>>2]=c[d+24>>2];c[k+28>>2]=c[d+28>>2];c[k+32>>2]=c[d+32>>2];c[k+36>>2]=c[d+36>>2];c[k+40>>2]=c[d+40>>2];c[k+44>>2]=c[d+44>>2];c[k+48>>2]=c[d+48>>2];c[k+52>>2]=c[d+52>>2];c[k+56>>2]=c[d+56>>2];c[k+60>>2]=c[d+60>>2];c[k+64>>2]=c[f+0>>2];c[k+68>>2]=c[f+4>>2];c[k+72>>2]=c[f+8>>2];c[k+76>>2]=c[f+12>>2];c[k+80>>2]=c[f+16>>2];c[k+84>>2]=c[f+20>>2];c[k+88>>2]=c[f+24>>2];c[k+92>>2]=c[f+28>>2];c[k+96>>2]=c[f+32>>2];c[k+100>>2]=c[f+36>>2];c[k+104>>2]=c[f+40>>2];c[k+108>>2]=c[f+44>>2];c[k+112>>2]=c[f+48>>2];c[k+116>>2]=c[f+52>>2];c[k+120>>2]=c[f+56>>2];c[k+124>>2]=c[f+60>>2];qz(k+136|0,k,k+216|0,0,0);t=(a[k+256>>0]|0)==0;b=k+236|0;c[k+264>>2]=c[b+0>>2];c[k+268>>2]=c[b+4>>2];c[k+272>>2]=c[b+8>>2];c[k+276>>2]=c[b+12>>2];if(t){u=0;i=k;return u|0}q=+g[k+252>>2];o=+g[k+220>>2];p=+g[k+224>>2];r=+g[k+228>>2];s=+g[k+232>>2];do if(q>.0010000000474974513){s=q;q=0.0;t=1;while(1){if((t|0)>32){j=0;e=13;break}v=q;q=q-s/(l*r+(m*p+n*o));if(!(!(q<0.0)&!(q>1.0)&!(q<=v))){j=0;e=13;break}Kb[c[c[j>>2]>>2]&31](j,q);v=1.0-q;g[k+48>>2]=v*+g[d+48>>2]+q*+g[e+48>>2];g[k+52>>2]=v*+g[d+52>>2]+q*+g[e+52>>2];g[k+56>>2]=v*+g[d+56>>2]+q*+g[e+56>>2];g[k+112>>2]=v*+g[f+48>>2]+q*+g[h+48>>2];g[k+116>>2]=v*+g[f+52>>2]+q*+g[h+52>>2];g[k+120>>2]=v*+g[f+56>>2]+q*+g[h+56>>2];qz(k+136|0,k,k+216|0,0,0);if((a[k+256>>0]|0)==0){j=0;e=13;break}s=+g[k+252>>2];if(s<0.0){e=8;break}c[k+264>>2]=c[b+0>>2];c[k+268>>2]=c[b+4>>2];c[k+272>>2]=c[b+8>>2];c[k+276>>2]=c[b+12>>2];o=+g[k+220>>2];p=+g[k+224>>2];r=+g[k+228>>2];if(!(s>.0010000000474974513)){e=10;break}else t=t+1|0}if((e|0)==8){g[j+164>>2]=q;r=+g[k+224>>2];s=+g[k+228>>2];v=+g[k+232>>2];g[j+132>>2]=+g[k+220>>2];g[j+136>>2]=r;g[j+140>>2]=s;g[j+144>>2]=v;c[j+148>>2]=c[b+0>>2];c[j+152>>2]=c[b+4>>2];c[j+156>>2]=c[b+8>>2];c[j+160>>2]=c[b+12>>2];u=1;i=k;return u|0}else if((e|0)==10){s=+g[k+232>>2];break}else if((e|0)==13){i=k;return j|0}}else q=0.0;while(0);if(l*r+(m*p+n*o)>=-+g[j+172>>2]){u=0;i=k;return u|0}g[j+164>>2]=q;g[j+132>>2]=o;g[j+136>>2]=p;g[j+140>>2]=r;g[j+144>>2]=s;c[j+148>>2]=c[k+264>>2];c[j+152>>2]=c[k+268>>2];c[j+156>>2]=c[k+272>>2];c[j+160>>2]=c[k+276>>2];u=1;i=k;return u|0}function nz(a){a=a|0;return}function oz(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function pz(b,e,f,h,j,k,l,m,n,o){b=b|0;e=e|0;f=f|0;h=h|0;j=j|0;k=k|0;l=l|0;m=m|0;n=n|0;o=o|0;var p=0,q=0,r=0,s=0,t=0,u=0.0,v=0.0,w=0.0,x=0,y=0.0,z=0,A=0,B=0.0,C=0,D=0,E=0,F=0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0.0,O=0.0,P=0.0,R=0.0,S=0.0,T=0.0,U=0.0,V=0.0,W=0.0,X=0.0,Y=0.0;b=i;i=i+10240|0;U=+g[k+52>>2]- +g[j+52>>2];H=+g[k+56>>2]- +g[j+56>>2];g[b>>2]=+g[k+48>>2]- +g[j+48>>2];g[b+4>>2]=U;g[b+8>>2]=H;g[b+12>>2]=0.0;c[b+10088>>2]=f;c[b+10092>>2]=h;H=+g[k>>2];U=+g[j>>2];G=+g[k+16>>2];y=+g[j+16>>2];B=+g[k+32>>2];V=+g[j+32>>2];L=+g[j+4>>2];W=+g[j+20>>2];M=+g[j+36>>2];v=+g[j+8>>2];K=+g[j+24>>2];I=+g[j+40>>2];T=+g[k+4>>2];S=+g[k+20>>2];R=+g[k+36>>2];P=+g[k+8>>2];O=+g[k+24>>2];N=+g[k+40>>2];g[b+10096>>2]=H*U+G*y+B*V;g[b+10100>>2]=H*L+G*W+B*M;g[b+10104>>2]=H*v+G*K+B*I;g[b+10108>>2]=0.0;g[b+10112>>2]=U*T+y*S+V*R;g[b+10116>>2]=L*T+W*S+M*R;g[b+10120>>2]=v*T+K*S+I*R;g[b+10124>>2]=0.0;g[b+10128>>2]=U*P+y*O+V*N;g[b+10132>>2]=L*P+W*O+M*N;g[b+10136>>2]=v*P+K*O+I*N;g[b+10140>>2]=0.0;I=+g[k+48>>2]- +g[j+48>>2];K=+g[k+52>>2]- +g[j+52>>2];v=+g[k+56>>2]- +g[j+56>>2];M=+g[j>>2];W=+g[k>>2];L=+g[j+16>>2];V=+g[k+16>>2];y=+g[j+32>>2];U=+g[k+32>>2];B=+g[j+4>>2];G=+g[j+20>>2];H=+g[j+36>>2];J=+g[j+8>>2];w=+g[j+24>>2];u=+g[j+40>>2];g[b+10144>>2]=M*W+L*V+y*U;g[b+10148>>2]=M*T+L*S+y*R;g[b+10152>>2]=M*P+L*O+y*N;g[b+10156>>2]=0.0;g[b+10160>>2]=W*B+V*G+U*H;g[b+10164>>2]=T*B+S*G+R*H;g[b+10168>>2]=P*B+O*G+N*H;g[b+10172>>2]=0.0;g[b+10176>>2]=W*J+V*w+U*u;g[b+10180>>2]=T*J+S*w+R*u;g[b+10184>>2]=P*J+O*w+N*u;g[b+10188>>2]=0.0;g[b+10192>>2]=I*M+K*L+v*y;g[b+10196>>2]=I*B+K*G+v*H;g[b+10200>>2]=I*J+K*w+v*u;g[b+10204>>2]=0.0;c[b+10208>>2]=70;c[b+10212>>2]=0;c[b+10072>>2]=0;c[b+9836>>2]=0;c[b+9840>>2]=0;c[b+9844>>2]=0;c[b+9848>>2]=0;c[b+10084>>2]=2;c[b+10076>>2]=0;g[b+9852>>2]=0.0;u=+g[b>>2];v=+g[b+4>>2];w=+g[b+8>>2];g[b+9328>>2]=-u;g[b+9332>>2]=-v;g[b+9336>>2]=-w;g[b+9340>>2]=0.0;do if((ED(b+9708|0,b+10088|0,b+9328|0)|0)==1){e=b+9296|0;r=b+9304|0;q=b+9308|0;c[e+0>>2]=0;c[e+4>>2]=0;c[e+8>>2]=0;c[e+12>>2]=0;c[b+16>>2]=9;o=b+56|0;c[b+9292>>2]=0;c[o+0>>2]=0;c[o+4>>2]=0;c[o+8>>2]=0;c[o+12>>2]=0;c[o+16>>2]=0;s=0;do{t=128-s+ -1|0;c[b+16+(t*56|0)+2152>>2]=0;x=c[r>>2]|0;c[b+16+(t*56|0)+2156>>2]=x;if((x|0)!=0)c[x+44>>2]=b+16+(t*56|0)+2108;c[r>>2]=b+16+(t*56|0)+2108;c[q>>2]=(c[q>>2]|0)+1;s=s+1|0}while((s|0)!=128);s=c[b+10080>>2]|0;if((c[s+32>>2]|0)>>>0>1?FD(b+9708|0)|0:0){t=c[e>>2]|0;if((t|0)!=0){z=c[b+9300>>2]|0;x=c[q>>2]|0;do{C=t+48|0;D=c[C>>2]|0;A=t+44|0;if((D|0)!=0)c[D+44>>2]=c[A>>2];D=c[A>>2]|0;if((D|0)!=0)c[D+48>>2]=c[C>>2];if((c[e>>2]|0)==(t|0))c[e>>2]=c[C>>2];z=z+ -1|0;c[A>>2]=0;c[C>>2]=c[r>>2];A=c[r>>2]|0;if((A|0)!=0)c[A+44>>2]=t;c[r>>2]=t;x=x+1|0;t=c[e>>2]|0}while((t|0)!=0);c[b+9300>>2]=z;c[q>>2]=x}c[b+16>>2]=0;c[b+9292>>2]=0;z=c[s>>2]|0;A=c[s+12>>2]|0;W=+g[A+16>>2];N=+g[z+16>>2]-W;P=+g[A+20>>2];R=+g[z+20>>2]-P;T=+g[A+24>>2];U=+g[z+24>>2]-T;A=c[s+4>>2]|0;S=+g[A+16>>2]-W;V=+g[A+20>>2]-P;O=+g[A+24>>2]-T;x=c[s+8>>2]|0;W=+g[x+16>>2]-W;P=+g[x+20>>2]-P;T=+g[x+24>>2]-T;if(N*V*T+(R*O*W+U*S*P-N*O*P-R*S*T)-U*V*W<0.0){c[s>>2]=A;c[s+4>>2]=z;W=+g[s+16>>2];g[s+16>>2]=+g[s+20>>2];g[s+20>>2]=W;t=A}else{t=z;z=A}t=GD(b+16|0,t,z,x,1)|0;x=GD(b+16|0,c[s+4>>2]|0,c[s>>2]|0,c[s+12>>2]|0,1)|0;z=GD(b+16|0,c[s+8>>2]|0,c[s+4>>2]|0,c[s+12>>2]|0,1)|0;A=GD(b+16|0,c[s>>2]|0,c[s+8>>2]|0,c[s+12>>2]|0,1)|0;if((c[b+9300>>2]|0)==4){C=c[e>>2]|0;B=+g[C+16>>2];s=c[C+48>>2]|0;if((s|0)!=0){u=B*B;while(1){v=+g[s+16>>2];D=v*v<u;C=D?s:C;s=c[s+48>>2]|0;if((s|0)==0)break;else u=D?v*v:u}B=+g[C+16>>2]}y=+g[C>>2];w=+g[C+4>>2];u=+g[C+8>>2];v=+g[C+12>>2];E=c[C+20>>2]|0;F=c[C+24>>2]|0;s=c[C+28>>2]|0;a[t+52>>0]=0;c[t+32>>2]=x;a[x+52>>0]=0;c[x+32>>2]=t;a[t+53>>0]=0;c[t+36>>2]=z;a[z+52>>0]=1;c[z+32>>2]=t;a[t+54>>0]=0;c[t+40>>2]=A;a[A+52>>0]=2;c[A+32>>2]=t;a[x+53>>0]=2;c[x+36>>2]=A;a[A+54>>0]=1;c[A+40>>2]=x;a[x+54>>0]=1;c[x+40>>2]=z;a[z+53>>0]=2;c[z+36>>2]=x;a[z+54>>0]=1;c[z+40>>2]=A;a[A+53>>0]=2;c[A+36>>2]=z;c[b+16>>2]=0;A=E;z=F;x=s;t=0;s=1;while(1){D=c[b+9292>>2]|0;if(!(D>>>0<64)){p=48;break}c[b+10216>>2]=0;c[b+10220>>2]=0;c[b+10224>>2]=0;c[b+9292>>2]=D+1;a[C+55>>0]=s;E=C+4|0;F=C+8|0;HD(b+9708|0,+g[C>>2],+g[E>>2],+g[F>>2],b+16+(D<<5)+60|0);if(+g[C>>2]*+g[b+16+(D<<5)+76>>2]+ +g[E>>2]*+g[b+16+(D<<5)+80>>2]+ +g[F>>2]*+g[b+16+(D<<5)+84>>2]- +g[C+16>>2]>9999999747378752.0e-20){E=0;F=1}else{p=47;break}do{F=F&(ID(b+16|0,s,b+16+(D<<5)+60|0,c[C+(E<<2)+32>>2]|0,d[C+E+52>>0]|0,b+10216|0)|0);E=E+1|0}while(!(E>>>0>2|F^1));if(!F){p=46;break}if(!((c[b+10224>>2]|0)>>>0>2)){p=46;break}A=c[b+10216>>2]|0;z=c[b+10220>>2]|0;a[A+53>>0]=2;c[A+36>>2]=z;a[z+54>>0]=1;c[z+40>>2]=A;z=C+48|0;A=c[z>>2]|0;x=C+44|0;if((A|0)!=0)c[A+44>>2]=c[x>>2];A=c[x>>2]|0;if((A|0)!=0)c[A+48>>2]=c[z>>2];if((c[e>>2]|0)==(C|0))c[e>>2]=c[z>>2];c[b+9300>>2]=(c[b+9300>>2]|0)+ -1;c[x>>2]=0;c[z>>2]=c[r>>2];x=c[r>>2]|0;if((x|0)!=0)c[x+44>>2]=C;c[r>>2]=C;c[q>>2]=(c[q>>2]|0)+1;C=c[e>>2]|0;B=+g[C+16>>2];x=c[C+48>>2]|0;if((x|0)!=0){u=B*B;while(1){v=+g[x+16>>2];z=v*v<u;C=z?x:C;x=c[x+48>>2]|0;if((x|0)==0)break;else u=z?v*v:u}B=+g[C+16>>2]}y=+g[C>>2];w=+g[C+4>>2];u=+g[C+8>>2];v=+g[C+12>>2];A=c[C+20>>2]|0;z=c[C+24>>2]|0;x=c[C+28>>2]|0;t=t+1|0;if(!(t>>>0<255))break;else s=s+1|0}if((p|0)==46)c[b+16>>2]=4;else if((p|0)==47)c[b+16>>2]=7;else if((p|0)==48)c[b+16>>2]=6;S=B*y;P=B*w;U=B*u;g[o>>2]=y;g[b+60>>2]=w;g[b+64>>2]=u;g[b+68>>2]=v;g[b+72>>2]=B;c[b+52>>2]=3;c[b+20>>2]=A;c[b+24>>2]=z;c[b+28>>2]=x;D=z+16|0;T=+g[D>>2]-S;E=z+20|0;N=+g[E>>2]-P;F=z+24|0;R=+g[F>>2]-U;C=x+16|0;M=+g[C>>2]-S;z=x+20|0;O=+g[z>>2]-P;x=x+24|0;V=+g[x>>2]-U;V=+Q(+((T*O-N*M)*(T*O-N*M)+((N*V-R*O)*(N*V-R*O)+(R*M-T*V)*(R*M-T*V))));g[b+36>>2]=V;T=+g[C>>2]-S;M=+g[z>>2]-P;R=+g[x>>2]-U;x=A+16|0;O=+g[x>>2]-S;z=A+20|0;N=+g[z>>2]-P;C=A+24|0;W=+g[C>>2]-U;W=+Q(+((T*N-M*O)*(T*N-M*O)+((M*W-R*N)*(M*W-R*N)+(R*O-T*W)*(R*O-T*W))));g[b+40>>2]=W;T=+g[x>>2]-S;O=+g[z>>2]-P;R=+g[C>>2]-U;S=+g[D>>2]-S;P=+g[E>>2]-P;U=+g[F>>2]-U;U=+Q(+((T*P-O*S)*(T*P-O*S)+((O*U-R*P)*(O*U-R*P)+(R*S-T*U)*(R*S-T*U))));g[b+36>>2]=V/(U+(V+W));g[b+40>>2]=W/(U+(V+W));g[b+44>>2]=U/(U+(V+W));if((c[b+16>>2]|0)==9){o=0;u=0.0;v=0.0;w=0.0;B=0.0;H=0.0;I=0.0;J=0.0;G=0.0;y=0.0;break}if((c[b+52>>2]|0)==0){y=0.0;B=0.0;w=0.0}else{e=b+52|0;p=54}}else p=49}else p=49;if((p|0)==49){c[b+16>>2]=8;g[o>>2]=u;g[b+60>>2]=v;g[b+64>>2]=w;g[b+68>>2]=0.0;y=+Q(+(u*u+v*v+w*w));if(y>0.0){w=1.0/y*w;v=1.0/y*v;u=1.0/y*u}else{w=0.0;v=0.0;u=1.0}g[o>>2]=u;g[b+60>>2]=v;g[b+64>>2]=w;g[b+68>>2]=0.0;g[b+72>>2]=0.0;c[b+52>>2]=1;c[b+20>>2]=c[s>>2];g[b+36>>2]=1.0;e=b+52|0;p=54}if((p|0)==54){w=0.0;u=0.0;v=0.0;p=0;do{r=c[b+10208>>2]|0;F=c[b+10212>>2]|0;q=(c[b+10088>>2]|0)+(F>>1)|0;if((F&1|0)!=0)r=c[(c[q>>2]|0)+r>>2]|0;rc[r&127](b+9312|0,q,c[b+16+(p<<2)+4>>2]|0);W=+g[b+16+(p<<2)+20>>2];w=w+ +g[b+9312>>2]*W;u=u+W*+g[b+9316>>2];v=v+W*+g[b+9320>>2];p=p+1|0}while(p>>>0<(c[e>>2]|0)>>>0);y=v;B=u}Y=+g[j>>2];X=+g[j+4>>2];K=+g[j+8>>2];M=+g[j+16>>2];N=+g[j+20>>2];O=+g[j+24>>2];R=+g[j+32>>2];T=+g[j+36>>2];V=+g[j+40>>2];L=+g[j+48>>2];H=+g[j+52>>2];I=+g[j+56>>2];J=+g[o>>2];U=+g[b+72>>2];G=+g[b+60>>2];W=+g[b+64>>2];P=w-J*U;S=B-U*G;U=y-U*W;o=1;u=w*Y+B*X+y*K+L;v=w*M+B*N+y*O+H;w=w*R+B*T+y*V+I;B=P*Y+S*X+U*K+L;H=P*M+S*N+U*O+H;I=P*R+S*T+U*V+I;J=-J;G=-G;y=-W}else{o=0;u=0.0;v=0.0;w=0.0;B=0.0;H=0.0;I=0.0;J=0.0;G=0.0;y=0.0}while(0);if(o){g[m>>2]=u;g[m+4>>2]=v;g[m+8>>2]=w;g[m+12>>2]=0.0;g[n>>2]=B;g[n+4>>2]=H;g[n+8>>2]=I;g[n+12>>2]=0.0;g[l>>2]=J;g[l+4>>2]=G;g[l+8>>2]=y;g[l+12>>2]=0.0;F=1;i=b;return F|0}c[b+9708>>2]=f;c[b+9712>>2]=h;w=+g[k>>2];M=+g[j>>2];y=+g[k+16>>2];N=+g[j+16>>2];B=+g[k+32>>2];O=+g[j+32>>2];P=+g[j+4>>2];R=+g[j+20>>2];S=+g[j+36>>2];U=+g[j+8>>2];W=+g[j+24>>2];Y=+g[j+40>>2];G=+g[k+4>>2];H=+g[k+20>>2];I=+g[k+36>>2];J=+g[k+8>>2];K=+g[k+24>>2];L=+g[k+40>>2];g[b+9716>>2]=w*M+y*N+B*O;g[b+9720>>2]=w*P+y*R+B*S;g[b+9724>>2]=w*U+y*W+B*Y;g[b+9728>>2]=0.0;g[b+9732>>2]=M*G+N*H+O*I;g[b+9736>>2]=P*G+R*H+S*I;g[b+9740>>2]=U*G+W*H+Y*I;g[b+9744>>2]=0.0;g[b+9748>>2]=M*J+N*K+O*L;g[b+9752>>2]=P*J+R*K+S*L;g[b+9756>>2]=U*J+W*K+Y*L;g[b+9760>>2]=0.0;T=+g[k+48>>2]- +g[j+48>>2];V=+g[k+52>>2]- +g[j+52>>2];X=+g[k+56>>2]- +g[j+56>>2];g[b+9764>>2]=w*M+y*N+B*O;g[b+9768>>2]=M*G+N*H+O*I;g[b+9772>>2]=M*J+N*K+O*L;g[b+9776>>2]=0.0;g[b+9780>>2]=w*P+y*R+B*S;g[b+9784>>2]=P*G+R*H+S*I;g[b+9788>>2]=P*J+R*K+S*L;g[b+9792>>2]=0.0;g[b+9796>>2]=w*U+y*W+B*Y;g[b+9800>>2]=U*G+W*H+Y*I;g[b+9804>>2]=U*J+W*K+Y*L;g[b+9808>>2]=0.0;g[b+9812>>2]=T*M+V*N+X*O;g[b+9816>>2]=T*P+V*R+X*S;g[b+9820>>2]=T*U+V*W+X*Y;g[b+9824>>2]=0.0;c[b+9828>>2]=71;c[b+9832>>2]=0;c[b+9692>>2]=0;c[b+9456>>2]=0;c[b+9460>>2]=0;c[b+9464>>2]=0;c[b+9468>>2]=0;c[b+9704>>2]=2;c[b+9696>>2]=0;g[b+9472>>2]=0.0;if((ED(b+9328|0,b+9708|0,b)|0)!=0){F=0;i=b;return F|0}k=c[b+9700>>2]|0;if((c[k+32>>2]|0)==0){H=0.0;G=0.0;B=0.0;u=0.0;v=0.0;y=0.0}else{B=0.0;G=0.0;H=0.0;y=0.0;v=0.0;u=0.0;f=0;do{w=+g[k+(f<<2)+16>>2];o=c[b+9828>>2]|0;F=c[b+9832>>2]|0;h=(c[b+9708>>2]|0)+(F>>1)|0;if((F&1|0)!=0)o=c[(c[h>>2]|0)+o>>2]|0;rc[o&127](b+9312|0,h,c[k+(f<<2)>>2]|0);B=B+w*+g[b+9312>>2];G=G+w*+g[b+9316>>2];H=H+w*+g[b+9320>>2];h=c[(c[b+9700>>2]|0)+(f<<2)>>2]|0;I=-+g[h>>2];J=-+g[h+4>>2];K=-+g[h+8>>2];h=c[b+9828>>2]|0;F=c[b+9832>>2]|0;k=(c[b+9712>>2]|0)+(F>>1)|0;if((F&1|0)!=0)h=c[(c[k>>2]|0)+h>>2]|0;X=+g[b+9732>>2]*I+ +g[b+9736>>2]*J+ +g[b+9740>>2]*K;W=+g[b+9748>>2]*I+ +g[b+9752>>2]*J+ +g[b+9756>>2]*K;g[b+10088>>2]=+g[b+9716>>2]*I+ +g[b+9720>>2]*J+ +g[b+9724>>2]*K;g[b+10092>>2]=X;g[b+10096>>2]=W;g[b+10100>>2]=0.0;rc[h&127](b+10216|0,k,b+10088|0);W=+g[b+10216>>2];X=+g[b+10220>>2];Y=+g[b+10224>>2];y=y+w*(W*+g[b+9764>>2]+X*+g[b+9768>>2]+Y*+g[b+9772>>2]+ +g[b+9812>>2]);v=v+w*(W*+g[b+9780>>2]+X*+g[b+9784>>2]+Y*+g[b+9788>>2]+ +g[b+9816>>2]);u=u+w*(W*+g[b+9796>>2]+X*+g[b+9800>>2]+Y*+g[b+9804>>2]+ +g[b+9820>>2]);f=f+1|0;k=c[b+9700>>2]|0}while(f>>>0<(c[k+32>>2]|0)>>>0)}I=+g[j>>2];J=+g[j+4>>2];K=+g[j+8>>2];M=+g[j+16>>2];N=+g[j+20>>2];O=+g[j+24>>2];R=+g[j+32>>2];S=+g[j+36>>2];T=+g[j+40>>2];L=+g[j+48>>2];P=+g[j+52>>2];U=+g[j+56>>2];V=B-y;W=G-v;Y=H-u;X=+Q(+(V*V+W*W+Y*Y));X=1.0/(X>9999999747378752.0e-20?X:1.0);g[m>>2]=B*I+G*J+H*K+L;g[m+4>>2]=B*M+G*N+H*O+P;g[m+8>>2]=B*R+G*S+H*T+U;g[m+12>>2]=0.0;g[n>>2]=y*I+v*J+u*K+L;g[n+4>>2]=y*M+v*N+u*O+P;g[n+8>>2]=y*R+v*S+u*T+U;g[n+12>>2]=0.0;g[l>>2]=X*V;g[l+4>>2]=X*W;g[l+8>>2]=X*Y;g[l+12>>2]=0.0;F=0;i=b;return F|0}function qz(b,d,e,f,h){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;var j=0,k=0.0,l=0.0,m=0.0,n=0.0,o=0.0,p=0,q=0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0,y=0,z=0.0,A=0.0,B=0.0,C=0.0,D=0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0,J=0.0,K=0.0,L=0.0,M=0.0,N=0,O=0,P=0.0,R=0.0;h=i;i=i+288|0;g[b+56>>2]=0.0;p=h+276|0;q=h+280|0;c[h+272>>2]=0;c[h+276>>2]=0;c[h+280>>2]=0;c[h+284>>2]=0;c[h+208>>2]=c[d+0>>2];c[h+212>>2]=c[d+4>>2];c[h+216>>2]=c[d+8>>2];c[h+220>>2]=c[d+12>>2];c[h+224>>2]=c[d+16>>2];c[h+228>>2]=c[d+20>>2];c[h+232>>2]=c[d+24>>2];c[h+236>>2]=c[d+28>>2];c[h+240>>2]=c[d+32>>2];c[h+244>>2]=c[d+36>>2];c[h+248>>2]=c[d+40>>2];c[h+252>>2]=c[d+44>>2];N=h+256|0;c[N+0>>2]=c[d+48>>2];c[N+4>>2]=c[d+52>>2];c[N+8>>2]=c[d+56>>2];c[N+12>>2]=c[d+60>>2];c[h+144>>2]=c[d+64>>2];c[h+148>>2]=c[d+68>>2];c[h+152>>2]=c[d+72>>2];c[h+156>>2]=c[d+76>>2];c[h+160>>2]=c[d+80>>2];c[h+164>>2]=c[d+84>>2];c[h+168>>2]=c[d+88>>2];c[h+172>>2]=c[d+92>>2];c[h+176>>2]=c[d+96>>2];c[h+180>>2]=c[d+100>>2];c[h+184>>2]=c[d+104>>2];c[h+188>>2]=c[d+108>>2];O=h+192|0;c[O+0>>2]=c[d+112>>2];c[O+4>>2]=c[d+116>>2];c[O+8>>2]=c[d+120>>2];c[O+12>>2]=c[d+124>>2];r=+g[N>>2];s=+g[O>>2];t=+g[h+260>>2];u=+g[h+196>>2];n=+g[h+264>>2];o=+g[h+200>>2];g[N>>2]=r-(r+s)*.5;g[h+260>>2]=t-(t+u)*.5;g[h+264>>2]=n-(n+o)*.5;g[O>>2]=s-(r+s)*.5;g[h+196>>2]=u-(t+u)*.5;g[h+200>>2]=o-(n+o)*.5;if(((c[(c[b+28>>2]|0)+4>>2]|0)+ -17|0)>>>0<2)y=((c[(c[b+32>>2]|0)+4>>2]|0)+ -17|0)>>>0<2;else y=0;w=+g[b+44>>2];v=+g[b+48>>2];c[3344]=(c[3344]|0)+1;O=(a[b+52>>0]|0)==0;v=O?v:0.0;c[b+64>>2]=0;g[b+4>>2]=0.0;g[b+8>>2]=1.0;g[b+12>>2]=0.0;g[b+16>>2]=0.0;c[b+68>>2]=0;c[b+60>>2]=-1;w=(O?w:0.0)+v;O=c[b+24>>2]|0;a[O+312>>0]=0;c[O>>2]=0;a[O+356>>0]=1;g[O+292>>2]=999999984306749400.0;g[O+296>>2]=999999984306749400.0;g[O+300>>2]=999999984306749400.0;g[O+304>>2]=0.0;c[O+336>>2]=0;c[O+340>>2]=0;c[O+344>>2]=0;c[O+348>>2]=0;a[O+352>>0]=0;a[O+332>>0]=a[O+332>>0]&-16;A=+g[b+4>>2];B=+g[b+8>>2];F=+g[b+12>>2];a:do if(y){z=999999984306749400.0;while(1){K=-A;L=-B;C=-F;M=+g[d+4>>2]*K+ +g[d+20>>2]*L+ +g[d+36>>2]*C;E=+g[d+8>>2]*K+ +g[d+24>>2]*L+ +g[d+40>>2]*C;g[h+128>>2]=+g[d>>2]*K+ +g[d+16>>2]*L+ +g[d+32>>2]*C;g[h+132>>2]=M;g[h+136>>2]=E;g[h+140>>2]=0.0;E=A*+g[d+68>>2]+B*+g[d+84>>2]+F*+g[d+100>>2];M=A*+g[d+72>>2]+B*+g[d+88>>2]+F*+g[d+104>>2];g[h+112>>2]=+g[d+64>>2]*A+ +g[d+80>>2]*B+ +g[d+96>>2]*F;g[h+116>>2]=E;g[h+120>>2]=M;g[h+124>>2]=0.0;Rw(h+96|0,c[b+28>>2]|0,h+128|0);Rw(h+80|0,c[b+32>>2]|0,h+112|0);F=+g[h+96>>2];M=+g[h+100>>2];B=+g[h+104>>2];E=F*+g[h+208>>2]+M*+g[h+212>>2]+B*+g[h+216>>2]+ +g[h+256>>2];B=F*+g[h+224>>2]+M*+g[h+228>>2]+B*+g[h+232>>2]+ +g[h+260>>2];M=+g[h+80>>2];F=+g[h+84>>2];C=+g[h+88>>2];A=M*+g[h+144>>2]+F*+g[h+148>>2]+C*+g[h+152>>2]+ +g[h+192>>2];C=M*+g[h+160>>2]+F*+g[h+164>>2]+C*+g[h+168>>2]+ +g[h+196>>2];F=+g[b+4>>2]*(E-A)+ +g[b+8>>2]*(B-C)+ +g[b+12>>2]*0.0;if(F>0.0?F*F>z*+g[d+128>>2]:0){j=22;break a}y=c[b+24>>2]|0;D=c[y>>2]|0;if((D|0)>0){G=+g[y+308>>2];O=0;N=0;do{K=E-A- +g[y+(N<<4)+4>>2];L=B-C- +g[y+(N<<4)+8>>2];M=0.0- +g[y+(N<<4)+12>>2];O=O|K*K+L*L+M*M<=G;N=N+1|0}while((N|0)!=(D|0))}else O=0;if((+g[y+304>>2]==0.0?+g[y+300>>2]==0.0:0)?B-C==+g[y+296>>2]:0)N=E-A==+g[y+292>>2];else N=0;if(N|O){j=31;break a}H=z-F;if(H<=z*9.999999974752427e-7){j=33;break a}g[y+292>>2]=E-A;g[y+296>>2]=B-C;g[y+300>>2]=0.0;g[y+304>>2]=0.0;a[y+356>>0]=1;g[y+(D<<4)+4>>2]=E-A;g[y+(D<<4)+8>>2]=B-C;g[y+(D<<4)+12>>2]=0.0;g[y+(D<<4)+16>>2]=0.0;N=c[y>>2]|0;g[y+(N<<4)+84>>2]=E;g[y+(N<<4)+88>>2]=B;g[y+(N<<4)+92>>2]=0.0;g[y+(N<<4)+96>>2]=0.0;N=c[y>>2]|0;g[y+(N<<4)+164>>2]=A;g[y+(N<<4)+168>>2]=C;g[y+(N<<4)+172>>2]=0.0;g[y+(N<<4)+176>>2]=0.0;c[y>>2]=(c[y>>2]|0)+1;N=c[b+24>>2]|0;O=lC(N)|0;A=+g[N+276>>2];B=+g[N+280>>2];F=+g[N+284>>2];E=+g[N+288>>2];if(!O){j=35;break a}C=z;z=A*A+B*B+F*F;if(z<9.999999974752427e-7){z=C;j=37;break a}if(C-z<=C*1.1920928955078125e-7){j=39;break a}g[b+4>>2]=A;g[b+8>>2]=B;g[b+12>>2]=F;g[b+16>>2]=E;O=c[b+64>>2]|0;c[b+64>>2]=O+1;if((O|0)>1e3){z=0.0;y=0;A=0.0;B=0.0;C=0.0;break a}if((c[c[b+24>>2]>>2]|0)==4){j=42;break}}}else{z=999999984306749400.0;while(1){G=-A;E=-B;C=-F;H=+g[d+4>>2]*G+ +g[d+20>>2]*E+ +g[d+36>>2]*C;M=+g[d+8>>2]*G+ +g[d+24>>2]*E+ +g[d+40>>2]*C;g[h+128>>2]=+g[d>>2]*G+ +g[d+16>>2]*E+ +g[d+32>>2]*C;g[h+132>>2]=H;g[h+136>>2]=M;g[h+140>>2]=0.0;M=A*+g[d+68>>2]+B*+g[d+84>>2]+F*+g[d+100>>2];H=A*+g[d+72>>2]+B*+g[d+88>>2]+F*+g[d+104>>2];g[h+112>>2]=+g[d+64>>2]*A+ +g[d+80>>2]*B+ +g[d+96>>2]*F;g[h+116>>2]=M;g[h+120>>2]=H;g[h+124>>2]=0.0;Rw(h+96|0,c[b+28>>2]|0,h+128|0);Rw(h+80|0,c[b+32>>2]|0,h+112|0);H=+g[h+96>>2];M=+g[h+100>>2];F=+g[h+104>>2];B=H*+g[h+208>>2]+M*+g[h+212>>2]+F*+g[h+216>>2]+ +g[h+256>>2];C=H*+g[h+224>>2]+M*+g[h+228>>2]+F*+g[h+232>>2]+ +g[h+260>>2];F=H*+g[h+240>>2]+M*+g[h+244>>2]+F*+g[h+248>>2]+ +g[h+264>>2];M=+g[h+80>>2];H=+g[h+84>>2];E=+g[h+88>>2];A=M*+g[h+144>>2]+H*+g[h+148>>2]+E*+g[h+152>>2]+ +g[h+192>>2];G=M*+g[h+160>>2]+H*+g[h+164>>2]+E*+g[h+168>>2]+ +g[h+196>>2];E=M*+g[h+176>>2]+H*+g[h+180>>2]+E*+g[h+184>>2]+ +g[h+200>>2];H=+g[b+4>>2]*(B-A)+ +g[b+8>>2]*(C-G)+ +g[b+12>>2]*(F-E);if(H>0.0?H*H>z*+g[d+128>>2]:0){j=22;break a}D=c[b+24>>2]|0;y=c[D>>2]|0;if((y|0)>0){I=+g[D+308>>2];O=0;N=0;do{K=B-A- +g[D+(N<<4)+4>>2];L=C-G- +g[D+(N<<4)+8>>2];M=F-E- +g[D+(N<<4)+12>>2];O=O|K*K+L*L+M*M<=I;N=N+1|0}while((N|0)!=(y|0))}else O=0;if((+g[D+304>>2]==0.0?F-E==+g[D+300>>2]:0)?C-G==+g[D+296>>2]:0)N=B-A==+g[D+292>>2];else N=0;if(N|O){j=31;break a}H=z-H;if(H<=z*9.999999974752427e-7){j=33;break a}g[D+292>>2]=B-A;g[D+296>>2]=C-G;g[D+300>>2]=F-E;g[D+304>>2]=0.0;a[D+356>>0]=1;g[D+(y<<4)+4>>2]=B-A;g[D+(y<<4)+8>>2]=C-G;g[D+(y<<4)+12>>2]=F-E;g[D+(y<<4)+16>>2]=0.0;N=c[D>>2]|0;g[D+(N<<4)+84>>2]=B;g[D+(N<<4)+88>>2]=C;g[D+(N<<4)+92>>2]=F;g[D+(N<<4)+96>>2]=0.0;N=c[D>>2]|0;g[D+(N<<4)+164>>2]=A;g[D+(N<<4)+168>>2]=G;g[D+(N<<4)+172>>2]=E;g[D+(N<<4)+176>>2]=0.0;c[D>>2]=(c[D>>2]|0)+1;N=c[b+24>>2]|0;O=lC(N)|0;A=+g[N+276>>2];B=+g[N+280>>2];F=+g[N+284>>2];E=+g[N+288>>2];if(!O){j=35;break a}C=z;z=A*A+B*B+F*F;if(z<9.999999974752427e-7){z=C;j=37;break a}if(C-z<=C*1.1920928955078125e-7){j=39;break a}g[b+4>>2]=A;g[b+8>>2]=B;g[b+12>>2]=F;g[b+16>>2]=E;O=c[b+64>>2]|0;c[b+64>>2]=O+1;if((O|0)>1e3){z=0.0;y=0;A=0.0;B=0.0;C=0.0;break a}if((c[c[b+24>>2]>>2]|0)==4){j=42;break}}}while(0);if((j|0)==22){c[b+68>>2]=10;j=43}else if((j|0)==31){c[b+68>>2]=1;j=43}else if((j|0)==33){c[b+68>>2]=!(H<=0.0)?11:2;j=43}else if((j|0)==35){c[b+68>>2]=3;j=43}else if((j|0)==37){g[b+4>>2]=A;g[b+8>>2]=B;g[b+12>>2]=F;g[b+16>>2]=E;c[b+68>>2]=6;j=43}else if((j|0)==39){c[b+68>>2]=12;j=43}else if((j|0)==42){c[b+68>>2]=13;z=0.0;y=0;A=0.0;B=0.0;C=0.0}do if((j|0)==43){O=c[b+24>>2]|0;lC(O)|0;A=+g[O+260>>2];B=+g[O+264>>2];C=+g[O+268>>2];c[h+272>>2]=c[b+4>>2];c[h+276>>2]=c[b+8>>2];c[h+280>>2]=c[b+12>>2];c[h+284>>2]=c[b+16>>2];G=+g[b+4>>2];F=+g[b+8>>2];E=+g[b+12>>2];if(G*G+F*F+E*E<1.0e-4)c[b+68>>2]=5;if(G*G+F*F+E*E>1.4210854715202004e-14){L=1.0/+Q(+(G*G+F*F+E*E));g[h+272>>2]=L*+g[h+272>>2];g[p>>2]=L*+g[p>>2];g[q>>2]=L*+g[q>>2];M=v/+Q(+z);c[b+60>>2]=1;z=1.0/L-w;y=1;A=M*G+A;B=M*F+B;C=M*E+C;break}else{c[b+60>>2]=2;z=0.0;y=0;break}}while(0);if(((c[b+72>>2]|0)!=0?(c[b+20>>2]|0)!=0:0)?(c[b+68>>2]|0)!=0:0)N=w+z<.01;else N=0;D=y^1;do if(N|D?(x=c[b+20>>2]|0,(x|0)!=0):0){c[3342]=(c[3342]|0)+1;c[b+4>>2]=0;c[b+8>>2]=0;c[b+12>>2]=0;c[b+16>>2]=0;if(!(Ob[c[(c[x>>2]|0)+8>>2]&3](x,c[b+24>>2]|0,c[b+28>>2]|0,c[b+32>>2]|0,h+208|0,h+144|0,b+4|0,h+64|0,h+48|0,f)|0)){I=+g[b+4>>2];H=+g[b+8>>2];E=+g[b+12>>2];if(!(I*I+H*H+E*E>0.0)){j=66;break}J=+g[h+48>>2];K=+g[h+64>>2]-J;G=+g[h+52>>2];L=+g[h+68>>2]-G;F=+g[h+56>>2];M=+g[h+72>>2]-F;w=+Q(+(K*K+L*L+M*M))-w;if(w<z|D){c[h+272>>2]=c[b+4>>2];c[h+276>>2]=c[b+8>>2];c[h+280>>2]=c[b+12>>2];c[h+284>>2]=c[b+16>>2];C=+g[h+272>>2];B=+g[p>>2];A=+g[q>>2];z=1.0/+Q(+(C*C+B*B+A*A));g[h+272>>2]=C*z;g[p>>2]=B*z;g[q>>2]=A*z;c[b+60>>2]=6;z=w;A=v*I+J;B=v*H+G;C=v*E+F;break}c[b+60>>2]=5;if(y)break;i=h;return}E=+g[h+48>>2];L=+g[h+64>>2];w=+g[h+52>>2];K=+g[h+68>>2];v=+g[h+56>>2];J=+g[h+72>>2];if(!((E-L)*(E-L)+(w-K)*(w-K)+(v-J)*(v-J)<=1.4210854715202004e-14)){H=v-J;G=w-K;I=E-L;F=0.0;M=(E-L)*(E-L)+(w-K)*(w-K)+(v-J)*(v-J)}else{R=+g[b+4>>2];P=+g[b+8>>2];M=+g[b+12>>2];H=M;G=P;I=R;F=+g[b+16>>2];M=R*R+P*P+M*M}if(!(M>1.4210854715202004e-14)){c[b+60>>2]=9;if(y)break;i=h;return}M=1.0/+Q(+M);J=-+Q(+((L-E)*(L-E)+(K-w)*(K-w)+(J-v)*(J-v)));if(z>J|D){g[h+272>>2]=I*M;g[p>>2]=G*M;g[q>>2]=H*M;g[h+284>>2]=F;c[b+60>>2]=3;z=J;A=E;B=w;C=v;break}c[b+60>>2]=8;if(!y){i=h;return}}else j=66;while(0);if((j|0)==66)if(!y){i=h;return}if(!(z<0.0)?!(z*z<+g[d+128>>2]):0){i=h;return}if((c[b+76>>2]|0)!=0?(O=c[b+28>>2]|0,vc[c[(c[O>>2]|0)+8>>2]&127](O,h+208|0,h+32|0,h+16|0),M=(+g[h+16>>2]+ +g[h+32>>2])*.5,P=(+g[h+20>>2]+ +g[h+36>>2])*.5,R=(+g[h+24>>2]+ +g[h+40>>2])*.5,O=c[b+32>>2]|0,vc[c[(c[O>>2]|0)+8>>2]&127](O,h+144|0,h+32|0,h+16|0),k=+g[h+272>>2],l=+g[p>>2],m=+g[q>>2],(M-(+g[h+32>>2]+ +g[h+16>>2])*.5)*k+(P-(+g[h+36>>2]+ +g[h+20>>2])*.5)*l+(R-(+g[h+40>>2]+ +g[h+24>>2])*.5)*m<0.0):0){g[h+272>>2]=k*-1.0;g[p>>2]=l*-1.0;g[q>>2]=m*-1.0}c[b+4>>2]=c[h+272>>2];c[b+8>>2]=c[h+276>>2];c[b+12>>2]=c[h+280>>2];c[b+16>>2]=c[h+284>>2];g[b+56>>2]=z;O=c[(c[e>>2]|0)+16>>2]|0;g[h>>2]=(r+s)*.5+A;g[h+4>>2]=(t+u)*.5+B;g[h+8>>2]=(n+o)*.5+C;g[h+12>>2]=0.0;qc[O&15](e,h+272|0,h,z);i=h;return}function rz(a){a=a|0;return}function sz(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function tz(b,d,e,f){b=b|0;d=d|0;e=e|0;f=+f;var h=0,j=0,k=0,l=0,m=0,n=0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0,y=0,z=0.0,A=0.0,B=0.0;l=i;i=i+192|0;h=c[b+4>>2]|0;if(+g[h+752>>2]<f){i=l;return}j=c[h+740>>2]|0;m=(c[b+8>>2]|0)+8|0;k=c[m>>2]|0;q=+g[e>>2];t=+g[d>>2]*f+q;o=+g[e+4>>2];r=+g[d+4>>2]*f+o;p=+g[e+8>>2];s=+g[d+8>>2]*f+p;if((j|0)!=(k|0)){n=c[b+12>>2]|0;y=c[n+8>>2]|0;B=t- +g[y+52>>2];v=r- +g[y+56>>2];w=s- +g[y+60>>2];A=q- +g[k+52>>2];z=o- +g[k+56>>2];u=p- +g[k+60>>2];q=B*+g[y+4>>2]+v*+g[y+20>>2]+w*+g[y+36>>2];o=B*+g[y+8>>2]+v*+g[y+24>>2]+w*+g[y+40>>2];p=B*+g[y+12>>2]+v*+g[y+28>>2]+w*+g[y+44>>2];w=A*+g[k+4>>2]+z*+g[k+20>>2]+u*+g[k+36>>2];v=A*+g[k+8>>2]+z*+g[k+24>>2]+u*+g[k+40>>2];u=A*+g[k+12>>2]+z*+g[k+28>>2]+u*+g[k+44>>2]}else{z=t- +g[j+52>>2];v=r- +g[j+56>>2];w=s- +g[j+60>>2];n=c[b+12>>2]|0;y=c[n+8>>2]|0;A=q- +g[y+52>>2];B=o- +g[y+56>>2];u=p- +g[y+60>>2];q=z*+g[j+4>>2]+v*+g[j+20>>2]+w*+g[j+36>>2];o=z*+g[j+8>>2]+v*+g[j+24>>2]+w*+g[j+40>>2];p=z*+g[j+12>>2]+v*+g[j+28>>2]+w*+g[j+44>>2];w=A*+g[y+4>>2]+B*+g[y+20>>2]+u*+g[y+36>>2];v=A*+g[y+8>>2]+B*+g[y+24>>2]+u*+g[y+40>>2];u=A*+g[y+12>>2]+B*+g[y+28>>2]+u*+g[y+44>>2]}g[l>>2]=q;g[l+4>>2]=o;g[l+8>>2]=p;g[l+12>>2]=0.0;g[l+16>>2]=w;g[l+20>>2]=v;g[l+24>>2]=u;g[l+28>>2]=0.0;c[l+64>>2]=c[d+0>>2];c[l+68>>2]=c[d+4>>2];c[l+72>>2]=c[d+8>>2];c[l+76>>2]=c[d+12>>2];g[l+80>>2]=f;g[l+84>>2]=0.0;g[l+88>>2]=0.0;g[l+92>>2]=0.0;c[l+112>>2]=0;a[l+116>>0]=0;c[l+120>>2]=0;c[l+124>>2]=0;c[l+128>>2]=0;c[l+132>>2]=0;c[l+136>>2]=0;c[l+140>>2]=0;c[l+144>>2]=0;c[l+148>>2]=0;g[l+48>>2]=t;g[l+52>>2]=r;g[l+56>>2]=s;g[l+60>>2]=0.0;c[l+32>>2]=c[e+0>>2];c[l+36>>2]=c[e+4>>2];c[l+40>>2]=c[e+8>>2];c[l+44>>2]=c[e+12>>2];r=+g[h+752>>2];d=c[h+748>>2]|0;if((d|0)>0){e=0;y=-1;f=r*r;while(1){r=+g[h+(e*184|0)+4>>2]-q;s=+g[h+(e*184|0)+8>>2]-o;t=+g[h+(e*184|0)+12>>2]-p;x=r*r+s*s+t*t<f;y=x?e:y;e=e+1|0;if((e|0)==(d|0))break;else f=x?r*r+s*s+t*t:f}}else y=-1;d=c[m>>2]|0;x=c[n+8>>2]|0;o=+g[d+224>>2]*+g[x+224>>2];o=o<-10.0?-10.0:o;g[l+84>>2]=o>10.0?10.0:o;g[l+92>>2]=+g[d+228>>2]*+g[x+228>>2];o=+g[d+232>>2]*+g[x+232>>2];o=o<-10.0?-10.0:o;g[l+88>>2]=o>10.0?10.0:o;o=+g[l+72>>2];if(+P(+o)>.7071067690849304){z=+g[l+68>>2];B=1.0/+Q(+(o*o+z*z));g[l+152>>2]=0.0;g[l+156>>2]=-(B*o);g[l+160>>2]=B*z;g[l+168>>2]=(o*o+z*z)*B;A=+g[l+64>>2];g[l+172>>2]=-(A*B*z);g[l+176>>2]=A*-(B*o)}else{z=+g[l+64>>2];A=+g[l+68>>2];B=1.0/+Q(+(z*z+A*A));g[l+152>>2]=-(A*B);g[l+156>>2]=B*z;g[l+160>>2]=0.0;g[l+168>>2]=-(o*B*z);g[l+172>>2]=o*-(A*B);g[l+176>>2]=(z*z+A*A)*B}if((j|0)!=(k|0)){c[l+96>>2]=c[b+20>>2];c[l+100>>2]=c[b+16>>2];c[l+104>>2]=c[b+28>>2];c[l+108>>2]=c[b+24>>2]}else{c[l+96>>2]=c[b+16>>2];c[l+100>>2]=c[b+20>>2];c[l+104>>2]=c[b+24>>2];c[l+108>>2]=c[b+28>>2]}if((y|0)>-1){x=h+(y*184|0)+152|0;d=c[x>>2]|0;m=h+(y*184|0)+124|0;z=+g[m>>2];n=h+(y*184|0)+128|0;A=+g[n>>2];e=h+(y*184|0)+132|0;B=+g[e>>2];k=h+(y*184|0)+116|0;j=c[k>>2]|0;cF(h+(y*184|0)+4|0,l|0,184)|0;c[k>>2]=j;g[m>>2]=z;g[n>>2]=A;g[e>>2]=B;c[x>>2]=d;i=l;return}else{mA(h,l)|0;i=l;return}}function uz(b,d,e,f,h,j,k,l,m,n){b=b|0;d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;k=k|0;l=l|0;m=m|0;n=n|0;var o=0,p=0.0,q=0.0,r=0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0.0,A=0,B=0,C=0,D=0,E=0.0,F=0.0,G=0.0,H=0.0,I=0.0;b=i;i=i+4256|0;if(((c[e+4>>2]|0)+ -17|0)>>>0<2)r=((c[f+4>>2]|0)+ -17|0)>>>0<2;else r=0;o=0;do{vz();v=+g[13568+(o<<4)>>2];w=+g[13572+(o<<4)>>2];x=+g[13576+(o<<4)>>2];z=+g[h+4>>2]*-v+ +g[h+20>>2]*-w+ +g[h+36>>2]*-x;y=+g[h+8>>2]*-v+ +g[h+24>>2]*-w+ +g[h+40>>2]*-x;g[b+1280+(o<<4)>>2]=+g[h>>2]*-v+ +g[h+16>>2]*-w+ +g[h+32>>2]*-x;g[b+1280+(o<<4)+4>>2]=z;g[b+1280+(o<<4)+8>>2]=y;g[b+1280+(o<<4)+12>>2]=0.0;y=v*+g[j+4>>2]+w*+g[j+20>>2]+x*+g[j+36>>2];z=v*+g[j+8>>2]+w*+g[j+24>>2]+x*+g[j+40>>2];g[b+288+(o<<4)>>2]=v*+g[j>>2]+w*+g[j+16>>2]+x*+g[j+32>>2];g[b+288+(o<<4)+4>>2]=y;g[b+288+(o<<4)+8>>2]=z;g[b+288+(o<<4)+12>>2]=0.0;o=o+1|0}while((o|0)!=42);A=Pb[c[(c[e>>2]|0)+84>>2]&127](e)|0;if((A|0)>0){B=0;o=42;while(1){rc[c[(c[e>>2]|0)+88>>2]&127](e,B,b+272|0);y=+g[b+272>>2];z=+g[b+276>>2];x=+g[b+280>>2];w=y*+g[h+16>>2]+z*+g[h+20>>2]+x*+g[h+24>>2];v=y*+g[h+32>>2]+z*+g[h+36>>2]+x*+g[h+40>>2];g[b+272>>2]=+g[h>>2]*y+ +g[h+4>>2]*z+ +g[h+8>>2]*x;g[b+276>>2]=w;g[b+280>>2]=v;g[b+284>>2]=0.0;vz();C=13568+(o<<4)|0;c[C+0>>2]=c[b+272>>2];c[C+4>>2]=c[b+276>>2];c[C+8>>2]=c[b+280>>2];c[C+12>>2]=c[b+284>>2];v=+g[b+272>>2];w=+g[b+276>>2];x=+g[b+280>>2];z=+g[h+4>>2]*-v+ +g[h+20>>2]*-w+ +g[h+36>>2]*-x;y=+g[h+8>>2]*-v+ +g[h+24>>2]*-w+ +g[h+40>>2]*-x;g[b+1280+(o<<4)>>2]=+g[h>>2]*-v+ +g[h+16>>2]*-w+ +g[h+32>>2]*-x;g[b+1280+(o<<4)+4>>2]=z;g[b+1280+(o<<4)+8>>2]=y;g[b+1280+(o<<4)+12>>2]=0.0;y=v*+g[j+4>>2]+w*+g[j+20>>2]+x*+g[j+36>>2];z=v*+g[j+8>>2]+w*+g[j+24>>2]+x*+g[j+40>>2];g[b+288+(o<<4)>>2]=+g[j>>2]*v+ +g[j+16>>2]*w+ +g[j+32>>2]*x;g[b+288+(o<<4)+4>>2]=y;g[b+288+(o<<4)+8>>2]=z;g[b+288+(o<<4)+12>>2]=0.0;B=B+1|0;if((B|0)==(A|0))break;else o=o+1|0}o=A+42|0}else o=42;C=Pb[c[(c[f>>2]|0)+84>>2]&127](f)|0;if((C|0)>0){B=0;A=o;while(1){rc[c[(c[f>>2]|0)+88>>2]&127](f,B,b+256|0);y=+g[b+256>>2];z=+g[b+260>>2];x=+g[b+264>>2];w=y*+g[j+16>>2]+z*+g[j+20>>2]+x*+g[j+24>>2];v=y*+g[j+32>>2]+z*+g[j+36>>2]+x*+g[j+40>>2];g[b+256>>2]=+g[j>>2]*y+ +g[j+4>>2]*z+ +g[j+8>>2]*x;g[b+260>>2]=w;g[b+264>>2]=v;g[b+268>>2]=0.0;vz();D=13568+(A<<4)|0;c[D+0>>2]=c[b+256>>2];c[D+4>>2]=c[b+260>>2];c[D+8>>2]=c[b+264>>2];c[D+12>>2]=c[b+268>>2];v=+g[b+256>>2];w=+g[b+260>>2];x=+g[b+264>>2];z=+g[h+4>>2]*-v+ +g[h+20>>2]*-w+ +g[h+36>>2]*-x;y=+g[h+8>>2]*-v+ +g[h+24>>2]*-w+ +g[h+40>>2]*-x;g[b+1280+(A<<4)>>2]=+g[h>>2]*-v+ +g[h+16>>2]*-w+ +g[h+32>>2]*-x;g[b+1280+(A<<4)+4>>2]=z;g[b+1280+(A<<4)+8>>2]=y;g[b+1280+(A<<4)+12>>2]=0.0;y=v*+g[j+4>>2]+w*+g[j+20>>2]+x*+g[j+36>>2];z=v*+g[j+8>>2]+w*+g[j+24>>2]+x*+g[j+40>>2];g[b+288+(A<<4)>>2]=+g[j>>2]*v+ +g[j+16>>2]*w+ +g[j+32>>2]*x;g[b+288+(A<<4)+4>>2]=y;g[b+288+(A<<4)+8>>2]=z;g[b+288+(A<<4)+12>>2]=0.0;B=B+1|0;if((B|0)==(C|0))break;else A=A+1|0}o=C+o|0}vc[c[(c[e>>2]|0)+76>>2]&127](e,b+1280|0,b+3264|0,o);vc[c[(c[f>>2]|0)+76>>2]&127](f,b+288|0,b+2272|0,o);if((o|0)>0)if(r){v=0.0;w=0.0;x=0.0;r=0;s=999999984306749400.0;while(1){vz();t=+g[13568+(r<<4)>>2];u=+g[13572+(r<<4)>>2];p=+g[13580+(r<<4)>>2];if(t*t+u*u+0.0>.01?(y=+g[b+3264+(r<<4)>>2],z=+g[b+3264+(r<<4)+4>>2],q=+g[b+3264+(r<<4)+8>>2],G=+g[b+2272+(r<<4)>>2],F=+g[b+2272+(r<<4)+4>>2],E=+g[b+2272+(r<<4)+8>>2],q=t*(G*+g[j>>2]+F*+g[j+4>>2]+E*+g[j+8>>2]+ +g[j+48>>2]-(y*+g[h>>2]+z*+g[h+4>>2]+q*+g[h+8>>2]+ +g[h+48>>2]))+u*(G*+g[j+16>>2]+F*+g[j+20>>2]+E*+g[j+24>>2]+ +g[j+52>>2]-(y*+g[h+16>>2]+z*+g[h+20>>2]+q*+g[h+24>>2]+ +g[h+52>>2]))+0.0,q<s):0)s=q;else{p=x;u=w;t=v}r=r+1|0;if((r|0)==(o|0)){q=0.0;break}else{v=t;w=u;x=p}}}else{t=0.0;x=0.0;y=0.0;z=0.0;r=0;s=999999984306749400.0;while(1){vz();v=+g[13568+(r<<4)>>2];u=+g[13572+(r<<4)>>2];q=+g[13576+(r<<4)>>2];w=+g[13580+(r<<4)>>2];if(v*v+u*u+q*q>.01?(F=+g[b+3264+(r<<4)>>2],G=+g[b+3264+(r<<4)+4>>2],p=+g[b+3264+(r<<4)+8>>2],I=+g[b+2272+(r<<4)>>2],H=+g[b+2272+(r<<4)+4>>2],E=+g[b+2272+(r<<4)+8>>2],p=v*(I*+g[j>>2]+H*+g[j+4>>2]+E*+g[j+8>>2]+ +g[j+48>>2]-(F*+g[h>>2]+G*+g[h+4>>2]+p*+g[h+8>>2]+ +g[h+48>>2]))+u*(I*+g[j+16>>2]+H*+g[j+20>>2]+E*+g[j+24>>2]+ +g[j+52>>2]-(F*+g[h+16>>2]+G*+g[h+20>>2]+p*+g[h+24>>2]+ +g[h+52>>2]))+q*(I*+g[j+32>>2]+H*+g[j+36>>2]+E*+g[j+40>>2]+ +g[j+56>>2]-(F*+g[h+32>>2]+G*+g[h+36>>2]+p*+g[h+40>>2]+ +g[h+56>>2])),p<s):0){t=v;s=p}else{w=z;q=y;u=x}r=r+1|0;if((r|0)==(o|0)){p=w;break}else{x=u;y=q;z=w}}}else{p=0.0;q=0.0;u=0.0;t=0.0;s=999999984306749400.0}switch(c[e+4>>2]|0){case 4:case 5:case 10:case 11:case 13:case 1:case 0:case 8:break;default:+$b[c[(c[e>>2]|0)+48>>2]&15](e)}switch(c[f+4>>2]|0){case 4:case 5:case 10:case 11:case 13:case 1:case 0:case 8:break;default:+$b[c[(c[f>>2]|0)+48>>2]&15](f)}if(s<0.0){D=0;i=b;return D|0}switch(c[e+4>>2]|0){case 8:{v=+g[e+28>>2]*+g[e+12>>2];break};case 0:{v=+g[e+44>>2];break};case 1:{v=+g[e+44>>2];break};case 13:{v=+g[e+44>>2];break};case 11:{v=+g[e+44>>2];break};case 10:{v=+g[e+44>>2];break};case 4:case 5:{v=+g[e+44>>2];break};default:v=+$b[c[(c[e>>2]|0)+48>>2]&15](e)}o=c[f+4>>2]|0;switch(o|0){case 8:{w=+g[f+28>>2]*+g[f+12>>2];o=8;break};case 0:{w=+g[f+44>>2];o=0;break};case 1:{w=+g[f+44>>2];o=1;break};case 13:{w=+g[f+44>>2];o=13;break};case 11:{w=+g[f+44>>2];o=11;break};case 10:{w=+g[f+44>>2];o=10;break};case 4:case 5:{w=+g[f+44>>2];break};default:{w=+$b[c[(c[f>>2]|0)+48>>2]&15](f);o=c[f+4>>2]|0}}s=s+(v+w+.5);c[b+176>>2]=13392;g[b+180>>2]=0.0;g[b+184>>2]=1.0;g[b+188>>2]=0.0;g[b+192>>2]=0.0;c[b+196>>2]=0;c[b+200>>2]=d;c[b+204>>2]=e;c[b+208>>2]=f;c[b+212>>2]=c[e+4>>2];c[b+216>>2]=o;g[b+220>>2]=+$b[c[(c[e>>2]|0)+48>>2]&15](e);g[b+224>>2]=+$b[c[(c[f>>2]|0)+48>>2]&15](f);a[b+228>>0]=0;c[b+236>>2]=-1;c[b+248>>2]=1;c[b+252>>2]=1;G=+g[h+48>>2]+t*s;H=u*s+ +g[h+52>>2];I=q*s+ +g[h+56>>2];c[b+44>>2]=c[h+0>>2];c[b+48>>2]=c[h+4>>2];c[b+52>>2]=c[h+8>>2];c[b+56>>2]=c[h+12>>2];c[b+60>>2]=c[h+16>>2];c[b+64>>2]=c[h+20>>2];c[b+68>>2]=c[h+24>>2];c[b+72>>2]=c[h+28>>2];c[b+76>>2]=c[h+32>>2];c[b+80>>2]=c[h+36>>2];c[b+84>>2]=c[h+40>>2];c[b+88>>2]=c[h+44>>2];g[b+92>>2]=G;g[b+96>>2]=H;g[b+100>>2]=I;g[b+104>>2]=0.0;c[b+108>>2]=c[j+0>>2];c[b+112>>2]=c[j+4>>2];c[b+116>>2]=c[j+8>>2];c[b+120>>2]=c[j+12>>2];c[b+124>>2]=c[j+16>>2];c[b+128>>2]=c[j+20>>2];c[b+132>>2]=c[j+24>>2];c[b+136>>2]=c[j+28>>2];c[b+140>>2]=c[j+32>>2];c[b+144>>2]=c[j+36>>2];c[b+148>>2]=c[j+40>>2];c[b+152>>2]=c[j+44>>2];c[b+156>>2]=c[j+48>>2];c[b+160>>2]=c[j+52>>2];c[b+164>>2]=c[j+56>>2];c[b+168>>2]=c[j+60>>2];g[b+172>>2]=999999984306749400.0;c[b>>2]=14656;a[b+40>>0]=0;g[b+180>>2]=-t;g[b+184>>2]=-u;g[b+188>>2]=-q;g[b+192>>2]=0.0;qz(b+176|0,b+44|0,b,n,0);s=s- +g[b+36>>2];f=a[b+40>>0]|0;if(!(f<<24>>24==0)){H=+g[b+24>>2]-u*s;I=+g[b+28>>2]-q*s;g[l>>2]=+g[b+20>>2]-t*s;g[l+4>>2]=H;g[l+8>>2]=I;g[l+12>>2]=0.0;c[m+0>>2]=c[b+20>>2];c[m+4>>2]=c[b+24>>2];c[m+8>>2]=c[b+28>>2];c[m+12>>2]=c[b+32>>2];g[k>>2]=t;g[k+4>>2]=u;g[k+8>>2]=q;g[k+12>>2]=p}D=f<<24>>24!=0;i=b;return D|0}function vz(){var b=0;b=i;if((a[14560]|0)!=0){i=b;return}if((Ya(14560)|0)==0){i=b;return}g[3392]=0.0;g[3393]=-0.0;g[3394]=-1.0;g[3395]=0.0;g[3396]=.7236080169677734;g[3397]=-.5257250070571899;g[3398]=-.44721901416778564;g[3399]=0.0;g[3400]=-.2763879895210266;g[3401]=-.8506489992141724;g[3402]=-.44721901416778564;g[3403]=0.0;g[3404]=-.8944259881973267;g[3405]=-0.0;g[3406]=-.4472160041332245;g[3407]=0.0;g[3408]=-.2763879895210266;g[3409]=.8506489992141724;g[3410]=-.44721999764442444;g[3411]=0.0;g[3412]=.7236080169677734;g[3413]=.5257250070571899;g[3414]=-.44721901416778564;g[3415]=0.0;g[3416]=.2763879895210266;g[3417]=-.8506489992141724;g[3418]=.44721999764442444;g[3419]=0.0;g[3420]=-.7236080169677734;g[3421]=-.5257250070571899;g[3422]=.44721901416778564;g[3423]=0.0;g[3424]=-.7236080169677734;g[3425]=.5257250070571899;g[3426]=.44721901416778564;g[3427]=0.0;g[3428]=.2763879895210266;g[3429]=.8506489992141724;g[3430]=.44721901416778564;g[3431]=0.0;g[3432]=.8944259881973267;g[3433]=0.0;g[3434]=.4472160041332245;g[3435]=0.0;g[3436]=-0.0;g[3437]=0.0;g[3438]=1.0;g[3439]=0.0;g[3440]=.4253230094909668;g[3441]=-.3090110123157501;g[3442]=-.8506540060043335;g[3443]=0.0;g[3444]=-.16245600581169128;g[3445]=-.49999499320983887;g[3446]=-.8506540060043335;g[3447]=0.0;g[3448]=.2628690004348755;g[3449]=-.8090119957923889;g[3450]=-.525738000869751;g[3451]=0.0;g[3452]=.4253230094909668;g[3453]=.3090110123157501;g[3454]=-.8506540060043335;g[3455]=0.0;g[3456]=.8506479859352112;g[3457]=-0.0;g[3458]=-.5257359743118286;g[3459]=0.0;g[3460]=-.5257300138473511;g[3461]=-0.0;g[3462]=-.8506519794464111;g[3463]=0.0;g[3464]=-.6881899833679199;g[3465]=-.49999698996543884;g[3466]=-.5257359743118286;g[3467]=0.0;g[3468]=-.16245600581169128;g[3469]=.49999499320983887;g[3470]=-.8506540060043335;g[3471]=0.0;g[3472]=-.6881899833679199;g[3473]=.49999698996543884;g[3474]=-.5257359743118286;g[3475]=0.0;g[3476]=.2628690004348755;g[3477]=.8090119957923889;g[3478]=-.525738000869751;g[3479]=0.0;g[3480]=.9510579705238342;g[3481]=.3090130090713501;g[3482]=0.0;g[3483]=0.0;g[3484]=.9510579705238342;g[3485]=-.3090130090713501;g[3486]=0.0;g[3487]=0.0;g[3488]=.5877860188484192;g[3489]=-.80901700258255;g[3490]=0.0;g[3491]=0.0;g[3492]=0.0;g[3493]=-1.0;g[3494]=0.0;g[3495]=0.0;g[3496]=-.5877860188484192;g[3497]=-.80901700258255;g[3498]=0.0;g[3499]=0.0;g[3500]=-.9510579705238342;g[3501]=-.3090130090713501;g[3502]=-0.0;g[3503]=0.0;g[3504]=-.9510579705238342;g[3505]=.3090130090713501;g[3506]=-0.0;g[3507]=0.0;g[3508]=-.5877860188484192;g[3509]=.80901700258255;g[3510]=-0.0;g[3511]=0.0;g[3512]=-0.0;g[3513]=1.0;g[3514]=-0.0;g[3515]=0.0;g[3516]=.5877860188484192;g[3517]=.80901700258255;g[3518]=-0.0;g[3519]=0.0;g[3520]=.6881899833679199;g[3521]=-.49999698996543884;g[3522]=.5257359743118286;g[3523]=0.0;g[3524]=-.2628690004348755;g[3525]=-.8090119957923889;g[3526]=.525738000869751;g[3527]=0.0;g[3528]=-.8506479859352112;g[3529]=0.0;g[3530]=.5257359743118286;g[3531]=0.0;g[3532]=-.2628690004348755;g[3533]=.8090119957923889;g[3534]=.525738000869751;g[3535]=0.0;g[3536]=.6881899833679199;g[3537]=.49999698996543884;g[3538]=.5257359743118286;g[3539]=0.0;g[3540]=.5257300138473511;g[3541]=0.0;g[3542]=.8506519794464111;g[3543]=0.0;g[3544]=.16245600581169128;g[3545]=-.49999499320983887;g[3546]=.8506540060043335;g[3547]=0.0;g[3548]=-.4253230094909668;g[3549]=-.3090110123157501;g[3550]=.8506540060043335;g[3551]=0.0;g[3552]=-.4253230094909668;g[3553]=.3090110123157501;g[3554]=.8506540060043335;g[3555]=0.0;g[3556]=.16245600581169128;g[3557]=.49999499320983887;g[3558]=.8506540060043335;g[3559]=0.0;bb(14560);i=b;return}function wz(a){a=a|0;return}function xz(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function yz(a){a=a|0;return}function zz(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Az(a,b,c){a=a|0;b=b|0;c=c|0;return}function Bz(a,b,c){a=a|0;b=b|0;c=c|0;return}function Cz(b,d,e,f){b=b|0;d=d|0;e=e|0;f=+f;var h=0;h=i;c[b+4>>2]=c[d+0>>2];c[b+8>>2]=c[d+4>>2];c[b+12>>2]=c[d+8>>2];c[b+16>>2]=c[d+12>>2];c[b+20>>2]=c[e+0>>2];c[b+24>>2]=c[e+4>>2];c[b+28>>2]=c[e+8>>2];c[b+32>>2]=c[e+12>>2];g[b+36>>2]=f;a[b+40>>0]=1;i=h;return}function Dz(a){a=a|0;var b=0;b=i;CA(a);if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function Ez(a){a=a|0;var b=0;b=i;CA(a);i=b;return}function Fz(d,e,f,h,j){d=d|0;e=e|0;f=f|0;h=h|0;j=j|0;var k=0,l=0.0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0,w=0,x=0,y=0;k=i;i=i+176|0;a[d+60>>0]=f&1;if(f){t=+g[h>>2]+-1.0;q=+g[h+4>>2]+-1.0;r=+g[h+8>>2]+-1.0;g[d+4>>2]=t;g[d+8>>2]=q;g[d+12>>2]=r;g[d+16>>2]=0.0;o=+g[j>>2]+1.0;m=+g[j+4>>2]+1.0;l=+g[j+8>>2]+1.0;g[d+20>>2]=o;g[d+24>>2]=m;g[d+28>>2]=l;g[d+32>>2]=0.0;g[d+36>>2]=65533.0/(o-t);g[d+40>>2]=65533.0/(m-q);g[d+44>>2]=65533.0/(l-r);g[d+48>>2]=0.0;a[d+60>>0]=1;n=t+ +(~~((t-t)*(65533.0/(o-t)))&65534)/(65533.0/(o-t))+-1.0;p=q+ +(~~((q-q)*(65533.0/(m-q)))&65534)/(65533.0/(m-q))+-1.0;s=r+ +(~~((r-r)*(65533.0/(l-r)))&65534)/(65533.0/(l-r))+-1.0;if(n<t)g[d+4>>2]=n;else n=t;if(p<q)g[d+8>>2]=p;else p=q;if(s<r)g[d+12>>2]=s;else s=r;u=n+ +((~~((o-n)*(65533.0/(o-t))+1.0)&65535|1)&65535)/(65533.0/(o-t))+1.0;t=p+ +((~~((m-p)*(65533.0/(m-q))+1.0)&65535|1)&65535)/(65533.0/(m-q))+1.0;q=s+ +((~~((l-s)*(65533.0/(l-r))+1.0)&65535|1)&65535)/(65533.0/(l-r))+1.0;if(o<u){g[d+20>>2]=u;o=u}if(m<t){g[d+24>>2]=t;m=t}if(l<q){g[d+28>>2]=q;l=q}g[d+36>>2]=65533.0/(o-n);g[d+40>>2]=65533.0/(m-p);g[d+44>>2]=65533.0/(l-s);g[d+48>>2]=0.0;c[k+152>>2]=15096;c[k+156>>2]=d+104;c[k+160>>2]=d;vc[c[(c[e>>2]|0)+8>>2]&127](e,k+152|0,d+4|0,d+20|0);e=c[d+108>>2]|0;c[k+136>>2]=0;c[k+140>>2]=0;c[k+144>>2]=0;c[k+148>>2]=0;j=c[d+128>>2]|0;if((j|0)<(e<<1|0)){if((c[d+132>>2]|0)<(e<<1|0)){if((e|0)==0){h=0;v=j}else{c[5004]=(c[5004]|0)+1;h=XE(e<<5|19)|0;if((h|0)==0)h=0;else{c[(h+19&-16)+ -4>>2]=h;h=h+19&-16}v=c[d+128>>2]|0}if((v|0)>0){f=0;do{y=h+(f<<4)|0;x=(c[d+136>>2]|0)+(f<<4)|0;c[y+0>>2]=c[x+0>>2];c[y+4>>2]=c[x+4>>2];c[y+8>>2]=c[x+8>>2];c[y+12>>2]=c[x+12>>2];f=f+1|0}while((f|0)!=(v|0))}f=c[d+136>>2]|0;if((f|0)!=0){if((a[d+140>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}c[d+136>>2]=0}a[d+140>>0]=1;c[d+136>>2]=h;c[d+132>>2]=e<<1;h=d+136|0}else h=d+136|0;do{y=(c[h>>2]|0)+(j<<4)|0;c[y+0>>2]=c[k+136>>2];c[y+4>>2]=c[k+140>>2];c[y+8>>2]=c[k+144>>2];c[y+12>>2]=c[k+148>>2];j=j+1|0}while((j|0)!=(e<<1|0))}c[d+128>>2]=e<<1}else{c[k+128>>2]=14960;c[k+132>>2]=d+64;g[k+112>>2]=-999999984306749400.0;g[k+116>>2]=-999999984306749400.0;g[k+120>>2]=-999999984306749400.0;g[k+124>>2]=0.0;g[k+96>>2]=999999984306749400.0;g[k+100>>2]=999999984306749400.0;g[k+104>>2]=999999984306749400.0;g[k+108>>2]=0.0;vc[c[(c[e>>2]|0)+8>>2]&127](e,k+128|0,k+112|0,k+96|0);e=c[d+68>>2]|0;h=k+32|0;v=h+64|0;do{c[h>>2]=0;h=h+4|0}while((h|0)<(v|0));j=c[d+88>>2]|0;if((j|0)<(e<<1|0)){if((c[d+92>>2]|0)<(e<<1|0)){if((e|0)==0){w=0;x=j}else{c[5004]=(c[5004]|0)+1;h=XE(e<<7|19)|0;if((h|0)==0)w=0;else{c[(h+19&-16)+ -4>>2]=h;w=h+19&-16}x=c[d+88>>2]|0}if((x|0)>0){y=0;do{h=w+(y<<6)+0|0;f=(c[d+96>>2]|0)+(y<<6)+0|0;v=h+64|0;do{c[h>>2]=c[f>>2];h=h+4|0;f=f+4|0}while((h|0)<(v|0));y=y+1|0}while((y|0)!=(x|0))}h=c[d+96>>2]|0;if((h|0)!=0){if((a[d+100>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[d+96>>2]=0}a[d+100>>0]=1;c[d+96>>2]=w;c[d+92>>2]=e<<1;w=d+96|0}else w=d+96|0;do{h=(c[w>>2]|0)+(j<<6)+0|0;f=k+32|0;v=h+64|0;do{c[h>>2]=c[f>>2];h=h+4|0;f=f+4|0}while((h|0)<(v|0));j=j+1|0}while((j|0)!=(e<<1|0))}c[d+88>>2]=e<<1}c[d+56>>2]=0;AA(d,0,e);if((a[d+60>>0]|0)!=0?(c[d+152>>2]|0)==0:0){if((c[d+156>>2]|0)==0){c[5004]=(c[5004]|0)+1;e=XE(51)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}h=c[d+152>>2]|0;if((h|0)>0){j=0;do{y=e+(j<<5)|0;x=(c[d+160>>2]|0)+(j<<5)|0;c[y+0>>2]=c[x+0>>2];c[y+4>>2]=c[x+4>>2];c[y+8>>2]=c[x+8>>2];c[y+12>>2]=c[x+12>>2];c[y+16>>2]=c[x+16>>2];c[y+20>>2]=c[x+20>>2];c[y+24>>2]=c[x+24>>2];c[y+28>>2]=c[x+28>>2];j=j+1|0}while((j|0)!=(h|0))}j=c[d+160>>2]|0;if((j|0)!=0){if((a[d+164>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0)}c[d+160>>2]=0}a[d+164>>0]=1;c[d+160>>2]=e;c[d+156>>2]=1;j=(c[d+152>>2]|0)+1|0}else{j=1;e=c[d+160>>2]|0}c[d+152>>2]=j;c[e+0>>2]=c[k+0>>2];c[e+4>>2]=c[k+4>>2];c[e+8>>2]=c[k+8>>2];c[e+12>>2]=c[k+12>>2];c[e+16>>2]=c[k+16>>2];c[e+20>>2]=c[k+20>>2];c[e+24>>2]=c[k+24>>2];c[e+28>>2]=c[k+28>>2];y=c[d+160>>2]|0;x=c[d+136>>2]|0;b[y>>1]=b[x>>1]|0;b[y+2>>1]=b[x+2>>1]|0;b[y+4>>1]=b[x+4>>1]|0;b[y+6>>1]=b[x+6>>1]|0;b[y+8>>1]=b[x+8>>1]|0;b[y+10>>1]=b[x+10>>1]|0;c[y+12>>2]=0;x=c[x+12>>2]|0;c[y+16>>2]=(x|0)>-1?1:0-x|0}c[d+168>>2]=c[d+152>>2];e=c[d+116>>2]|0;if((e|0)!=0){if((a[d+120>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[d+116>>2]=0}a[d+120>>0]=1;c[d+116>>2]=0;c[d+108>>2]=0;c[d+112>>2]=0;e=c[d+76>>2]|0;if((e|0)==0){a[d+80>>0]=1;c[d+76>>2]=0;c[d+68>>2]=0;y=d+72|0;c[y>>2]=0;i=k;return}if((a[d+80>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[d+76>>2]=0;a[d+80>>0]=1;c[d+76>>2]=0;c[d+68>>2]=0;y=d+72|0;c[y>>2]=0;i=k;return}function Gz(a){a=a|0;return 84}function Hz(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;e=i;GA(a,b,c,d)|0;i=e;return 1}function Iz(a){a=a|0;return}function Jz(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Kz(b,d,e,f){b=b|0;d=d|0;e=e|0;f=f|0;var h=0.0,j=0.0,k=0.0,l=0,m=0.0,n=0.0,o=0.0,p=0.0,q=0,r=0.0,s=0,t=0,u=0,v=0,w=0,x=0.0,y=0.0,z=0.0,A=0.0;l=i;i=i+32|0;m=+g[d>>2];h=m<999999984306749400.0?m:999999984306749400.0;n=+g[d+4>>2];j=n<999999984306749400.0?n:999999984306749400.0;o=+g[d+8>>2];k=o<999999984306749400.0?o:999999984306749400.0;p=+g[d+12>>2];r=p<0.0?p:0.0;m=m>-999999984306749400.0?m:-999999984306749400.0;n=n>-999999984306749400.0?n:-999999984306749400.0;o=o>-999999984306749400.0?o:-999999984306749400.0;p=p>0.0?p:0.0;x=+g[d+16>>2];h=x<h?x:h;y=+g[d+20>>2];j=y<j?y:j;z=+g[d+24>>2];k=z<k?z:k;A=+g[d+28>>2];r=A<r?A:r;m=m<x?x:m;n=n<y?y:n;o=o<z?z:o;p=p<A?A:p;A=+g[d+32>>2];h=A<h?A:h;z=+g[d+36>>2];j=z<j?z:j;y=+g[d+40>>2];k=y<k?y:k;x=+g[d+44>>2];r=x<r?x:r;m=m<A?A:m;n=n<z?z:n;o=o<y?y:o;p=p<x?x:p;b=c[b+4>>2]|0;v=c[b+4>>2]|0;if((v|0)==(c[b+8>>2]|0)?(q=(v|0)==0?1:v<<1,(v|0)<(q|0)):0){if((q|0)==0)d=0;else{c[5004]=(c[5004]|0)+1;d=XE(q<<6|19)|0;if((d|0)==0)d=0;else{c[(d+19&-16)+ -4>>2]=d;d=d+19&-16}v=c[b+4>>2]|0}if((v|0)>0){w=0;do{s=d+(w<<6)+0|0;t=(c[b+12>>2]|0)+(w<<6)+0|0;u=s+64|0;do{c[s>>2]=c[t>>2];s=s+4|0;t=t+4|0}while((s|0)<(u|0));w=w+1|0}while((w|0)!=(v|0))}s=c[b+12>>2]|0;if((s|0)!=0){if((a[b+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[s+ -4>>2]|0)}c[b+12>>2]=0}a[b+16>>0]=1;c[b+12>>2]=d;c[b+8>>2]=q;v=c[b+4>>2]|0}w=c[b+12>>2]|0;g[w+(v<<6)>>2]=h;g[w+(v<<6)+4>>2]=j;g[w+(v<<6)+8>>2]=k;g[w+(v<<6)+12>>2]=r;g[w+(v<<6)+16>>2]=m;g[w+(v<<6)+20>>2]=n;g[w+(v<<6)+24>>2]=o;g[w+(v<<6)+28>>2]=p;c[w+(v<<6)+32>>2]=-1;c[w+(v<<6)+36>>2]=e;c[w+(v<<6)+40>>2]=f;w=w+(v<<6)+44|0;c[w+0>>2]=c[l+0>>2];c[w+4>>2]=c[l+4>>2];c[w+8>>2]=c[l+8>>2];c[w+12>>2]=c[l+12>>2];c[w+16>>2]=c[l+16>>2];c[b+4>>2]=(c[b+4>>2]|0)+1;i=l;return}function Lz(a){a=a|0;return}function Mz(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function Nz(d,e,f,h){d=d|0;e=e|0;f=f|0;h=h|0;var j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0.0,r=0.0,s=0.0,t=0,u=0.0,v=0.0,w=0.0,x=0,y=0,z=0.0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0,F=0,G=0;j=i;q=+g[e>>2];v=q<999999984306749400.0?q:999999984306749400.0;r=+g[e+4>>2];w=r<999999984306749400.0?r:999999984306749400.0;s=+g[e+8>>2];u=s<999999984306749400.0?s:999999984306749400.0;q=q>-999999984306749400.0?q:-999999984306749400.0;r=r>-999999984306749400.0?r:-999999984306749400.0;s=s>-999999984306749400.0?s:-999999984306749400.0;z=+g[e+16>>2];v=z<v?z:v;A=+g[e+20>>2];w=A<w?A:w;B=+g[e+24>>2];u=B<u?B:u;q=q<z?z:q;r=r<A?A:r;s=s<B?B:s;B=+g[e+32>>2];v=B<v?B:v;A=+g[e+36>>2];w=A<w?A:w;z=+g[e+40>>2];u=z<u?z:u;q=q<B?B:q;r=r<A?A:r;s=s<z?z:s;if(q-v<.0020000000949949026){q=q+.0010000000474974513;v=v+-.0010000000474974513}if(r-w<.0020000000949949026){r=r+.0010000000474974513;w=w+-.0010000000474974513}if(s-u<.0020000000949949026){s=s+.0010000000474974513;u=u+-.0010000000474974513}e=c[d+8>>2]|0;E=+g[e+4>>2];C=+g[e+8>>2];A=+g[e+12>>2];D=+g[e+36>>2];z=+g[e+40>>2];B=+g[e+44>>2];e=~~((v-E)*D)&65534;l=~~((w-C)*z)&65534;m=~~((u-A)*B)&65534;n=(~~((q-E)*D+1.0)&65535|1)&65535;o=(~~((r-C)*z+1.0)&65535|1)&65535;p=(~~((s-A)*B+1.0)&65535|1)&65535;d=c[d+4>>2]|0;y=c[d+4>>2]|0;if((y|0)==(c[d+8>>2]|0)?(k=(y|0)==0?1:y<<1,(y|0)<(k|0)):0){if((k|0)==0)t=0;else{c[5004]=(c[5004]|0)+1;t=XE((k<<4|3)+16|0)|0;if((t|0)==0)t=0;else{c[(t+19&-16)+ -4>>2]=t;t=t+19&-16}y=c[d+4>>2]|0}if((y|0)>0){x=0;do{F=t+(x<<4)|0;G=(c[d+12>>2]|0)+(x<<4)|0;c[F+0>>2]=c[G+0>>2];c[F+4>>2]=c[G+4>>2];c[F+8>>2]=c[G+8>>2];c[F+12>>2]=c[G+12>>2];x=x+1|0}while((x|0)!=(y|0))}x=c[d+12>>2]|0;if((x|0)!=0){if((a[d+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[x+ -4>>2]|0)}c[d+12>>2]=0}a[d+16>>0]=1;c[d+12>>2]=t;c[d+8>>2]=k;y=c[d+4>>2]|0}G=c[d+12>>2]|0;b[G+(y<<4)>>1]=e;b[G+(y<<4)+2>>1]=l;b[G+(y<<4)+4>>1]=m;b[G+(y<<4)+6>>1]=n;b[G+(y<<4)+8>>1]=o;b[G+(y<<4)+10>>1]=p;c[G+(y<<4)+12>>2]=f<<21|h;c[d+4>>2]=(c[d+4>>2]|0)+1;i=j;return}function Oz(b){b=b|0;var d=0,e=0,f=0,g=0,h=0;d=i;c[b>>2]=15272;a[b+20>>0]=1;c[b+16>>2]=0;c[b+8>>2]=0;c[b+12>>2]=0;c[b+24>>2]=0;a[b+28>>0]=0;a[b+48>>0]=1;c[b+44>>2]=0;c[b+36>>2]=0;c[b+40>>2]=0;a[b+68>>0]=1;c[b+64>>2]=0;c[b+56>>2]=0;c[b+60>>2]=0;c[b+72>>2]=0;c[5004]=(c[5004]|0)+1;e=XE(51)|0;if((e|0)==0)e=0;else{c[(e+19&-16)+ -4>>2]=e;e=e+19&-16}f=c[b+8>>2]|0;if((f|0)>0){g=0;do{h=c[b+16>>2]|0;c[e+(g<<4)>>2]=c[h+(g<<4)>>2];c[e+(g<<4)+4>>2]=c[h+(g<<4)+4>>2];c[e+(g<<4)+8>>2]=c[h+(g<<4)+8>>2];c[e+(g<<4)+12>>2]=c[h+(g<<4)+12>>2];g=g+1|0}while((g|0)!=(f|0))}f=c[b+16>>2]|0;if((f|0)==0){a[b+20>>0]=1;c[b+16>>2]=e;c[b+12>>2]=2;Pz(b);i=d;return}if((a[b+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[f+ -4>>2]|0)}c[b+16>>2]=0;a[b+20>>0]=1;c[b+16>>2]=e;c[b+12>>2]=2;Pz(b);i=d;return}function Pz(b){b=b|0;var d=0,e=0,f=0,g=0,h=0,j=0,k=0,l=0;e=i;f=c[b+12>>2]|0;d=c[b+36>>2]|0;if((d|0)>=(f|0)){i=e;return}if((d|0)<=(f|0)){if((c[b+40>>2]|0)<(f|0)){if((f|0)==0){g=0;j=d}else{c[5004]=(c[5004]|0)+1;g=XE((f<<2|3)+16|0)|0;if((g|0)==0)g=0;else{c[(g+19&-16)+ -4>>2]=g;g=g+19&-16}j=c[b+36>>2]|0}if((j|0)>0){h=0;do{k=g+(h<<2)|0;if((k|0)!=0)c[k>>2]=c[(c[b+44>>2]|0)+(h<<2)>>2];h=h+1|0}while((h|0)!=(j|0))}h=c[b+44>>2]|0;if((h|0)!=0){if((a[b+48>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[h+ -4>>2]|0)}c[b+44>>2]=0}a[b+48>>0]=1;c[b+44>>2]=g;c[b+40>>2]=f}else g=c[b+44>>2]|0;h=d;do{j=g+(h<<2)|0;if((j|0)!=0)c[j>>2]=0;h=h+1|0}while((h|0)!=(f|0))}c[b+36>>2]=f;g=c[b+56>>2]|0;if((g|0)<(f|0)){if((c[b+60>>2]|0)<(f|0)){if((f|0)==0){h=0;j=g}else{c[5004]=(c[5004]|0)+1;h=XE((f<<2|3)+16|0)|0;if((h|0)==0)h=0;else{c[(h+19&-16)+ -4>>2]=h;h=h+19&-16}j=c[b+56>>2]|0}if((j|0)>0){k=0;do{l=h+(k<<2)|0;if((l|0)!=0)c[l>>2]=c[(c[b+64>>2]|0)+(k<<2)>>2];k=k+1|0}while((k|0)!=(j|0))}j=c[b+64>>2]|0;if((j|0)!=0){if((a[b+68>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0)}c[b+64>>2]=0}a[b+68>>0]=1;c[b+64>>2]=h;c[b+60>>2]=f}else h=c[b+64>>2]|0;do{j=h+(g<<2)|0;if((j|0)!=0)c[j>>2]=0;g=g+1|0}while((g|0)!=(f|0))}c[b+56>>2]=f;if((f|0)>0){$E(c[b+44>>2]|0,-1,f<<2|0)|0;$E(c[b+64>>2]|0,-1,f<<2|0)|0}if((d|0)<=0){i=e;return}h=c[b+16>>2]|0;g=c[b+44>>2]|0;f=c[b+64>>2]|0;j=0;do{l=c[(c[h+(j<<4)+4>>2]|0)+12>>2]<<16|c[(c[h+(j<<4)>>2]|0)+12>>2];l=(l+~(l<<15)>>10^l+~(l<<15))*9|0;l=g+((((l>>6^l)+~((l>>6^l)<<11)>>16^(l>>6^l)+~((l>>6^l)<<11))&(c[b+12>>2]|0)+ -1)<<2)|0;c[f+(j<<2)>>2]=c[l>>2];c[l>>2]=j;j=j+1|0}while((j|0)!=(d|0));i=e;return}function Qz(a){a=a|0;var b=0;b=i;Rz(a);YE(a);i=b;return}function Rz(b){b=b|0;var d=0,e=0;d=i;c[b>>2]=15272;e=c[b+64>>2]|0;if((e|0)!=0){if((a[b+68>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+64>>2]=0}a[b+68>>0]=1;c[b+64>>2]=0;c[b+56>>2]=0;c[b+60>>2]=0;e=c[b+44>>2]|0;if((e|0)!=0){if((a[b+48>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+44>>2]=0}a[b+48>>0]=1;c[b+44>>2]=0;c[b+36>>2]=0;c[b+40>>2]=0;e=c[b+16>>2]|0;if((e|0)==0){a[b+20>>0]=1;c[b+16>>2]=0;c[b+8>>2]=0;e=b+12|0;c[e>>2]=0;i=d;return}if((a[b+20>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[e+ -4>>2]|0)}c[b+16>>2]=0;a[b+20>>0]=1;c[b+16>>2]=0;c[b+8>>2]=0;e=b+12|0;c[e>>2]=0;i=d;return}function Sz(a,b,d){a=a|0;b=b|0;d=d|0;var e=0;a=i;e=c[b+8>>2]|0;if((e|0)==0|(d|0)==0){i=a;return}Lb[c[c[e>>2]>>2]&511](e);Nb[c[(c[d>>2]|0)+60>>2]&127](d,c[b+8>>2]|0);c[b+8>>2]=0;i=a;return}function Tz(a,b,d){a=a|0;b=b|0;d=d|0;var e=0;e=i;i=i+16|0;c[e>>2]=15576;c[e+4>>2]=b;c[e+8>>2]=a;c[e+12>>2]=d;rc[c[(c[a>>2]|0)+48>>2]&127](a,e,d);i=e;return}function Uz(a,b,d){a=a|0;b=b|0;d=d|0;var e=0;e=i;i=i+16|0;c[e>>2]=15400;c[e+4>>2]=b;rc[c[(c[a>>2]|0)+48>>2]&127](a,e,d);i=e;return}function Vz(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,g=0,h=0;f=i;c[3814]=(c[3814]|0)+1;h=(c[b+12>>2]|0)>(c[d+12>>2]|0);g=c[(h?d:b)+12>>2]|0;b=c[(h?b:d)+12>>2]|0;d=((b<<16|g)+~((b<<16|g)<<15)>>10^(b<<16|g)+~((b<<16|g)<<15))*9|0;d=((d>>6^d)+~((d>>6^d)<<11)>>16^(d>>6^d)+~((d>>6^d)<<11))&(c[a+12>>2]|0)+ -1;if((d|0)>=(c[a+36>>2]|0)){h=0;i=f;return h|0}h=c[(c[a+44>>2]|0)+(d<<2)>>2]|0;if((h|0)==-1){h=0;i=f;return h|0}d=c[a+16>>2]|0;while(1){if((c[(c[d+(h<<4)>>2]|0)+12>>2]|0)==(g|0)?(c[(c[d+(h<<4)+4>>2]|0)+12>>2]|0)==(b|0):0)break;h=c[(c[a+64>>2]|0)+(h<<2)>>2]|0;if((h|0)==-1){g=0;e=8;break}}if((e|0)==8){i=f;return g|0}h=d+(h<<4)|0;i=f;return h|0}function Wz(b){b=b|0;var d=0,e=0,f=0,g=0,h=0,j=0,k=0;f=i;d=c[b+4>>2]|0;if((d|0)!=(c[b+8>>2]|0)){j=d;j=j+1|0;c[b+4>>2]=j;j=b+12|0;j=c[j>>2]|0;j=j+(d<<4)|0;i=f;return j|0}e=(d|0)==0?1:d<<1;if((d|0)>=(e|0)){j=d;j=j+1|0;c[b+4>>2]=j;j=b+12|0;j=c[j>>2]|0;j=j+(d<<4)|0;i=f;return j|0}if((e|0)==0){g=0;h=d}else{c[5004]=(c[5004]|0)+1;g=XE((e<<4|3)+16|0)|0;if((g|0)==0)g=0;else{c[(g+19&-16)+ -4>>2]=g;g=g+19&-16}h=c[b+4>>2]|0}if((h|0)>0){j=0;do{k=c[b+12>>2]|0;c[g+(j<<4)>>2]=c[k+(j<<4)>>2];c[g+(j<<4)+4>>2]=c[k+(j<<4)+4>>2];c[g+(j<<4)+8>>2]=c[k+(j<<4)+8>>2];c[g+(j<<4)+12>>2]=c[k+(j<<4)+12>>2];j=j+1|0}while((j|0)!=(h|0))}j=c[b+12>>2]|0;if((j|0)!=0){if((a[b+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[j+ -4>>2]|0);h=c[b+4>>2]|0}c[b+12>>2]=0}a[b+16>>0]=1;c[b+12>>2]=g;c[b+8>>2]=e;k=h;k=k+1|0;c[b+4>>2]=k;k=b+12|0;k=c[k>>2]|0;k=k+(d<<4)|0;i=f;return k|0}function Xz(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0;g=i;c[3810]=(c[3810]|0)+1;j=(c[b+12>>2]|0)>(c[d+12>>2]|0);h=j?d:b;j=j?b:d;l=c[h+12>>2]|0;d=c[j+12>>2]|0;k=((d<<16|l)+~((d<<16|l)<<15)>>10^(d<<16|l)+~((d<<16|l)<<15))*9|0;k=((k>>6^k)+~((k>>6^k)<<11)>>16^(k>>6^k)+~((k>>6^k)<<11))&(c[a+12>>2]|0)+ -1;m=c[(c[a+44>>2]|0)+(k<<2)>>2]|0;if((m|0)==-1){o=0;i=g;return o|0}b=c[a+16>>2]|0;while(1){if((c[(c[b+(m<<4)>>2]|0)+12>>2]|0)==(l|0)?(c[(c[b+(m<<4)+4>>2]|0)+12>>2]|0)==(d|0):0)break;m=c[(c[a+64>>2]|0)+(m<<2)>>2]|0;if((m|0)==-1){a=0;f=24;break}}if((f|0)==24){i=g;return a|0}d=b+(m<<4)|0;if((d|0)==0){o=0;i=g;return o|0}rc[c[(c[a>>2]|0)+32>>2]&127](a,d,e);b=c[b+(m<<4)+12>>2]|0;d=d-(c[a+16>>2]|0)>>4;k=(c[a+44>>2]|0)+(k<<2)|0;l=c[k>>2]|0;m=c[a+64>>2]|0;if((l|0)!=(d|0)){while(1){n=m+(l<<2)|0;o=c[n>>2]|0;if((o|0)==(d|0))break;else l=o}m=c[m+(d<<2)>>2]|0;if((l|0)==-1)f=12;else c[n>>2]=m}else{m=c[m+(d<<2)>>2]|0;f=12}if((f|0)==12)c[k>>2]=m;k=(c[a+8>>2]|0)+ -1|0;l=c[a+72>>2]|0;if((l|0)!=0)Tb[c[(c[l>>2]|0)+12>>2]&31](l,h,j,e)|0;if((k|0)==(d|0)){c[a+8>>2]=(c[a+8>>2]|0)+ -1;o=b;i=g;return o|0}j=c[a+16>>2]|0;h=c[(c[j+(k<<4)+4>>2]|0)+12>>2]<<16|c[(c[j+(k<<4)>>2]|0)+12>>2];h=(h+~(h<<15)>>10^h+~(h<<15))*9|0;h=((h>>6^h)+~((h>>6^h)<<11)>>16^(h>>6^h)+~((h>>6^h)<<11))&(c[a+12>>2]|0)+ -1;e=(c[a+44>>2]|0)+(h<<2)|0;m=c[e>>2]|0;n=c[a+64>>2]|0;if((m|0)!=(k|0)){while(1){l=n+(m<<2)|0;o=c[l>>2]|0;if((o|0)==(k|0))break;else m=o}n=c[n+(k<<2)>>2]|0;if((m|0)==-1)f=22;else c[l>>2]=n}else{n=c[n+(k<<2)>>2]|0;f=22}if((f|0)==22)c[e>>2]=n;c[j+(d<<4)+0>>2]=c[j+(k<<4)+0>>2];c[j+(d<<4)+4>>2]=c[j+(k<<4)+4>>2];c[j+(d<<4)+8>>2]=c[j+(k<<4)+8>>2];c[j+(d<<4)+12>>2]=c[j+(k<<4)+12>>2];o=(c[a+44>>2]|0)+(h<<2)|0;c[(c[a+64>>2]|0)+(d<<2)>>2]=c[o>>2];c[o>>2]=d;c[a+8>>2]=(c[a+8>>2]|0)+ -1;o=b;i=g;return o|0}function Yz(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,g=0,h=0;e=i;if((c[a+8>>2]|0)<=0){i=e;return}f=0;a:while(1){while(1){h=c[a+16>>2]|0;g=h+(f<<4)|0;if(!(gc[c[(c[b>>2]|0)+8>>2]&31](b,g)|0))break;Tb[c[(c[a>>2]|0)+12>>2]&31](a,c[g>>2]|0,c[h+(f<<4)+4>>2]|0,d)|0;c[3808]=(c[3808]|0)+ -1;if((f|0)>=(c[a+8>>2]|0)){a=7;break a}}f=f+1|0;if((f|0)>=(c[a+8>>2]|0)){a=7;break}}if((a|0)==7){i=e;return}}function Zz(b,d){b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0;e=i;i=i+32|0;a[e+16>>0]=1;c[e+12>>2]=0;c[e+4>>2]=0;c[e+8>>2]=0;m=c[b+8>>2]|0;if((m|0)>0){k=0;f=0;l=0;g=0;while(1){h=c[b+16>>2]|0;if((f|0)==(l|0)){j=(l|0)==0?1:l<<1;if((l|0)<(j|0)){if((j|0)!=0){c[5004]=(c[5004]|0)+1;k=XE((j<<4|3)+16|0)|0;if((k|0)==0){k=0;l=f}else{c[(k+19&-16)+ -4>>2]=k;k=k+19&-16;l=f}}else k=0;if((l|0)>0){m=0;do{n=c[e+12>>2]|0;c[k+(m<<4)>>2]=c[n+(m<<4)>>2];c[k+(m<<4)+4>>2]=c[n+(m<<4)+4>>2];c[k+(m<<4)+8>>2]=c[n+(m<<4)+8>>2];c[k+(m<<4)+12>>2]=c[n+(m<<4)+12>>2];m=m+1|0}while((m|0)!=(l|0))}m=c[e+12>>2]|0;if((m|0)==0)f=l;else{c[5006]=(c[5006]|0)+1;YE(c[m+ -4>>2]|0);c[e+12>>2]=0}a[e+16>>0]=1;c[e+12>>2]=k;c[e+8>>2]=j;m=c[b+8>>2]|0;l=f}else j=l}else{j=l;l=f}c[k+(l<<4)>>2]=c[h+(g<<4)>>2];c[k+(l<<4)+4>>2]=c[h+(g<<4)+4>>2];c[k+(l<<4)+8>>2]=c[h+(g<<4)+8>>2];c[k+(l<<4)+12>>2]=c[h+(g<<4)+12>>2];f=l+1|0;g=g+1|0;if((g|0)>=(m|0))break;else l=j}c[e+4>>2]=f;if((l|0)>-1){g=0;do{Tb[c[(c[b>>2]|0)+12>>2]&31](b,c[k+(g<<4)>>2]|0,c[k+(g<<4)+4>>2]|0,d)|0;g=g+1|0}while((g|0)<(f|0))}}else f=0;if((c[b+56>>2]|0)>0){d=c[b+64>>2]|0;g=0;do{c[d+(g<<2)>>2]=-1;g=g+1|0}while((g|0)<(c[b+56>>2]|0))}if((f|0)>1){es(e,0,f+ -1|0);f=c[e+4>>2]|0}if((f|0)>0){d=c[e+12>>2]|0;g=0;do{Yb[c[(c[b>>2]|0)+8>>2]&31](b,c[d+(g<<4)>>2]|0,c[d+(g<<4)+4>>2]|0)|0;g=g+1|0}while((g|0)<(f|0))}else d=c[e+12>>2]|0;if((d|0)==0){i=e;return}if((a[e+16>>0]|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[d+ -4>>2]|0)}c[e+12>>2]=0;i=e;return}function _z(a,d,e){a=a|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,k=0,l=0,m=0;f=i;c[3812]=(c[3812]|0)+1;g=c[a+24>>2]|0;if((g|0)==0){if((b[e+6>>1]&b[d+4>>1])<<16>>16==0){m=0;i=f;return m|0}if((b[d+6>>1]&b[e+4>>1])<<16>>16==0){m=0;i=f;return m|0}}else if(!(Yb[c[(c[g>>2]|0)+8>>2]&31](g,d,e)|0)){m=0;i=f;return m|0}j=(c[d+12>>2]|0)>(c[e+12>>2]|0);g=j?e:d;e=j?d:e;j=c[g+12>>2]|0;l=c[e+12>>2]|0;d=((l<<16|j)+~((l<<16|j)<<15)>>10^(l<<16|j)+~((l<<16|j)<<15))*9|0;d=(d>>6^d)+~((d>>6^d)<<11)>>16^(d>>6^d)+~((d>>6^d)<<11);h=c[a+12>>2]|0;m=c[(c[a+44>>2]|0)+((d&h+ -1)<<2)>>2]|0;a:do if(!((m|0)==-1)){k=c[a+16>>2]|0;while(1){if((c[(c[k+(m<<4)>>2]|0)+12>>2]|0)==(j|0)?(c[(c[k+(m<<4)+4>>2]|0)+12>>2]|0)==(l|0):0)break;m=c[(c[a+64>>2]|0)+(m<<2)>>2]|0;if((m|0)==-1)break a}j=k+(m<<4)|0;if((j|0)!=0){m=j;i=f;return m|0}}while(0);k=c[a+8>>2]|0;j=Wz(a+4|0)|0;l=c[a+72>>2]|0;if((l|0)!=0)Yb[c[(c[l>>2]|0)+8>>2]&31](l,g,e)|0;if((h|0)<(c[a+12>>2]|0)){Pz(a);d=(c[a+12>>2]|0)+ -1&d}else d=d&h+ -1;if((c[g+12>>2]|0)<(c[e+12>>2]|0)){c[j>>2]=g;c[j+4>>2]=e}else{c[j>>2]=e;c[j+4>>2]=g}c[j+8>>2]=0;c[j+12>>2]=0;m=(c[a+44>>2]|0)+(d<<2)|0;c[(c[a+64>>2]|0)+(k<<2)>>2]=c[m>>2];c[m>>2]=k;m=j;i=f;return m|0}function $z(a){a=a|0;return c[a+16>>2]|0}function aA(a){a=a|0;return c[a+16>>2]|0}function bA(a){a=a|0;return a+4|0}function cA(a){a=a|0;return c[a+8>>2]|0}function dA(a,b){a=a|0;b=b|0;c[a+24>>2]=b;return}function eA(a){a=a|0;return 0}function fA(a,b){a=a|0;b=b|0;c[a+72>>2]=b;return}function gA(a){a=a|0;return}function hA(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function iA(a,b){a=a|0;b=b|0;var d=0;d=i;a=c[a+4>>2]|0;if((c[b>>2]|0)==(a|0)){a=1;i=d;return a|0}a=(c[b+4>>2]|0)==(a|0);i=d;return a|0}function jA(a){a=a|0;return}function kA(a){a=a|0;var b=0;b=i;YE(a);i=b;return}function lA(a,b){a=a|0;b=b|0;var d=0,e=0;d=i;e=c[a+4>>2]|0;if((c[b>>2]|0)!=(e|0)?(c[b+4>>2]|0)!=(e|0):0){i=d;return 0}e=c[a+8>>2]|0;rc[c[(c[e>>2]|0)+32>>2]&127](e,b,c[a+12>>2]|0);i=d;return 0}function mA(a,b){a=a|0;b=b|0;var d=0,e=0.0,f=0,h=0.0,j=0.0,k=0.0,l=0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0,s=0.0,t=0.0,u=0.0,v=0.0,w=0.0,x=0.0,y=0.0,z=0,A=0.0,B=0.0,C=0.0,D=0.0,E=0.0;d=i;f=c[a+748>>2]|0;if((f|0)!=4){c[a+748>>2]=f+1;z=f;l=(z|0)<0;z=l?0:z;l=a+(z*184|0)+4|0;cF(l|0,b|0,184)|0;i=d;return z|0}e=+g[b+80>>2];y=+g[a+84>>2];x=y<e?y:e;w=+g[a+268>>2];v=w<x?w:x;u=+g[a+452>>2];l=+g[a+636>>2]<(u<v?u:v);z=l?3:u<v?2:w<x?1:(y<e^1)<<31>>31;e=+g[b>>2];if((z|0)!=0){m=+g[a+188>>2];p=+g[b+4>>2];n=+g[a+192>>2];k=+g[b+8>>2];o=+g[a+196>>2];u=+g[a+556>>2];t=+g[a+372>>2];w=+g[a+560>>2];v=+g[a+376>>2];q=+g[a+564>>2];s=+g[a+380>>2];h=((e-m)*(w-v)-(p-n)*(u-t))*((e-m)*(w-v)-(p-n)*(u-t))+(((p-n)*(q-s)-(k-o)*(w-v))*((p-n)*(q-s)-(k-o)*(w-v))+((k-o)*(u-t)-(e-m)*(q-s))*((k-o)*(u-t)-(e-m)*(q-s)));if((z|0)==1){j=+g[a+12>>2];y=q;q=0.0;r=+g[a+4>>2];x=+g[a+8>>2];f=7}else{y=q;f=6}}else{m=+g[a+188>>2];n=+g[a+192>>2];o=+g[a+196>>2];h=0.0;p=+g[b+4>>2];k=+g[b+8>>2];t=+g[a+372>>2];u=+g[a+556>>2];v=+g[a+376>>2];w=+g[a+560>>2];s=+g[a+380>>2];y=+g[a+564>>2];f=6}if((f|0)==6){r=+g[a+4>>2];x=+g[a+8>>2];D=p-x;j=+g[a+12>>2];B=k-j;A=u-t;C=w-v;q=y-s;q=((e-r)*C-D*A)*((e-r)*C-D*A)+((D*q-B*C)*(D*q-B*C)+(B*A-(e-r)*q)*(B*A-(e-r)*q));if((z|0)==2){u=x;w=0.0;f=8}else f=7}if((f|0)==7){D=e-r;E=p-x;B=k-j;C=u-m;A=w-n;w=y-o;w=(D*A-E*C)*(D*A-E*C)+((E*w-B*A)*(E*w-B*A)+(B*C-D*w)*(B*C-D*w));if(l)e=0.0;else{u=x;f=8}}if((f|0)==8){E=e-r;A=p-u;C=k-j;D=t-m;B=v-n;e=s-o;e=(E*B-A*D)*(E*B-A*D)+((A*e-C*B)*(A*e-C*B)+(C*D-E*e)*(C*D-E*e))}E=+P(+h);C=+P(+q);A=+P(+w);y=+P(+e);D=E>-999999984306749400.0?E:-999999984306749400.0;B=C>D?C:D;z=y>(A>B?A:B)?3:A>B?2:C>D?1:(E>-999999984306749400.0^1)<<31>>31;l=(z|0)<0;z=l?0:z;l=a+(z*184|0)+4|0;cF(l|0,b|0,184)|0;i=d;return z|0}function nA(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,h=0,j=0.0,k=0.0,l=0,m=0.0,n=0.0,o=0.0,p=0.0,q=0.0,r=0.0;f=i;h=c[b+748>>2]|0;if((h|0)<=0){i=f;return}do{h=h+ -1|0;q=+g[b+(h*184|0)+4>>2];r=+g[b+(h*184|0)+8>>2];j=+g[b+(h*184|0)+12>>2];p=q*+g[d>>2]+r*+g[d+4>>2]+j*+g[d+8>>2]+ +g[d+48>>2];n=q*+g[d+16>>2]+r*+g[d+20>>2]+j*+g[d+24>>2]+ +g[d+52>>2];j=q*+g[d+32>>2]+r*+g[d+36>>2]+j*+g[d+40>>2]+ +g[d+56>>2];g[b+(h*184|0)+52>>2]=p;g[b+(h*184|0)+56>>2]=n;g[b+(h*184|0)+60>>2]=j;g[b+(h*184|0)+64>>2]=0.0;r=+g[b+(h*184|0)+20>>2];q=+g[b+(h*184|0)+24>>2];k=+g[b+(h*184|0)+28>>2];o=r*+g[e>>2]+q*+g[e+4>>2]+k*+g[e+8>>2]+ +g[e+48>>2];m=r*+g[e+16>>2]+q*+g[e+20>>2]+k*+g[e+24>>2]+ +g[e+52>>2];k=r*+g[e+32>>2]+q*+g[e+36>>2]+k*+g[e+40>>2]+ +g[e+56>>2];g[b+(h*184|0)+36>>2]=o;g[b+(h*184|0)+40>>2]=m;g[b+(h*184|0)+44>>2]=k;g[b+(h*184|0)+48>>2]=0.0;g[b+(h*184|0)+84>>2]=(p-o)*+g[b+(h*184|0)+68>>2]+(n-m)*+g[b+(h*184|0)+72>>2]+(j-k)*+g[b+(h*184|0)+76>>2];l=b+(h*184|0)+152|0;c[l>>2]=(c[l>>2]|0)+1}while((h|0)>0);d=c[b+748>>2]|0;if((d|0)<=0){i=f;return}e=d;do{d=d+ -1|0;h=b+(d*184|0)+4|0;k=+g[b+(d*184|0)+84>>2];j=+g[b+752>>2];if(k<=j){p=+g[b+(d*184|0)+36>>2]-(+g[b+(d*184|0)+52>>2]- +g[b+(d*184|0)+68>>2]*k);q=+g[b+(d*184|0)+40>>2]-(+g[b+(d*184|0)+56>>2]-k*+g[b+(d*184|0)+72>>2]);r=+g[b+(d*184|0)+44>>2]-(+g[b+(d*184|0)+60>>2]-k*+g[b+(d*184|0)+76>>2]);if(p*p+q*q+r*r>j*j){l=e+ -1|0;if((l|0)!=(d|0)){cF(h|0,b+(l*184|0)+4|0,184)|0;c[b+(l*184|0)+116>>2]=0;g[b+(l*184|0)+124>>2]=0.0;a[b+(l*184|0)+120>>0]=0;g[b+(l*184|0)+128>>2]=0.0;g[b+(l*184|0)+132>>2]=0.0;c[b+(l*184|0)+152>>2]=0;e=c[b+748>>2]|0}e=e+ -1|0;c[b+748>>2]=e}}else{l=e+ -1|0;if((l|0)!=(d|0)){cF(h|0,b+(l*184|0)+4|0,184)|0;c[b+(l*184|0)+116>>2]=0;g[b+(l*184|0)+124>>2]=0.0;a[b+(l*184|0)+120>>0]=0;g[b+(l*184|0)+128>>2]=0.0;g[b+(l*184|0)+132>>2]=0.0;c[b+(l*184|0)+152>>2]=0;e=c[b+748>>2]|0}e=e+ -1|0;c[b+748>>2]=e}}while((d|0)>0);i=f;return}function oA(a){a=a|0;var b=0,d=0;b=i;c[a>>2]=15736;d=c[a+52>>2]|0;if((d|0)!=0){Lb[c[c[d>>2]>>2]&511](d);d=c[a+52>>2]|0;if((d|0)!=0){c[5006]=(c[5006]|0)+1;YE(c[d+ -4>>2]|0)}if((a|0)==0){i=b;return}}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}function pA(a){a=a|0;var b=0,d=0;b=i;c[a>>2]=15736;d=c[a+52>>2]|0;if((d|0)==0){i=b;return}Lb[c[c[d>>2]>>2]&511](d);a=c[a+52>>2]|0;if((a|0)==0){i=b;return}c[5006]=(c[5006]|0)+1;YE(c[a+ -4>>2]|0);i=b;return}



function PE(a,b,d,e,f){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;var g=0,h=0,j=0;g=i;h=c[a+4>>2]|0;if((h&1|0)==0)j=h>>8;else j=c[(c[d>>2]|0)+(h>>8)>>2]|0;a=c[a>>2]|0;Jb[c[(c[a>>2]|0)+24>>2]&31](a,b,d+j|0,(h&2|0)!=0?e:2,f);i=g;return}function QE(b,d,e,f,g){b=b|0;d=d|0;e=e|0;f=f|0;g=g|0;var h=0,j=0;h=i;if((b|0)==(c[d+8>>2]|0)){if((c[d+4>>2]|0)!=(e|0)){i=h;return}if((c[d+28>>2]|0)==1){i=h;return}c[d+28>>2]=f;i=h;return}if((b|0)!=(c[d>>2]|0)){b=c[b+8>>2]|0;Jb[c[(c[b>>2]|0)+24>>2]&31](b,d,e,f,g);i=h;return}if((c[d+16>>2]|0)!=(e|0)?(c[d+20>>2]|0)!=(e|0):0){c[d+32>>2]=f;if((c[d+44>>2]|0)==4){i=h;return}a[d+52>>0]=0;a[d+53>>0]=0;b=c[b+8>>2]|0;Zb[c[(c[b>>2]|0)+20>>2]&7](b,d,e,e,1,g);if((a[d+53>>0]|0)!=0){if((a[d+52>>0]|0)==0){f=1;j=13}}else{f=0;j=13}do if((j|0)==13){c[d+20>>2]=e;c[d+40>>2]=(c[d+40>>2]|0)+1;if((c[d+36>>2]|0)==1?(c[d+24>>2]|0)==2:0){a[d+54>>0]=1;if(f)break}else j=16;if((j|0)==16?f:0)break;c[d+44>>2]=4;i=h;return}while(0);c[d+44>>2]=3;i=h;return}if((f|0)!=1){i=h;return}c[d+32>>2]=1;i=h;return}function RE(b,d,e,f,g){b=b|0;d=d|0;e=e|0;f=f|0;g=g|0;g=i;if((c[d+8>>2]|0)==(b|0)){if((c[d+4>>2]|0)!=(e|0)){i=g;return}if((c[d+28>>2]|0)==1){i=g;return}c[d+28>>2]=f;i=g;return}if((c[d>>2]|0)!=(b|0)){i=g;return}if((c[d+16>>2]|0)!=(e|0)?(c[d+20>>2]|0)!=(e|0):0){c[d+32>>2]=f;c[d+20>>2]=e;c[d+40>>2]=(c[d+40>>2]|0)+1;if((c[d+36>>2]|0)==1?(c[d+24>>2]|0)==2:0)a[d+54>>0]=1;c[d+44>>2]=4;i=g;return}if((f|0)!=1){i=g;return}c[d+32>>2]=1;i=g;return}function SE(b,d,e,f,g,h){b=b|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;var j=0,k=0,l=0,m=0,n=0;j=i;if((b|0)==(c[d+8>>2]|0)){ME(d,e,f,g);i=j;return}k=a[d+52>>0]|0;l=a[d+53>>0]|0;m=c[b+12>>2]|0;a[d+52>>0]=0;a[d+53>>0]=0;OE(b+16|0,d,e,f,g,h);a:do if((m|0)>1){n=b+24|0;do{if((a[d+54>>0]|0)!=0)break a;if((a[d+52>>0]|0)==0){if((a[d+53>>0]|0)!=0?(c[b+8>>2]&1|0)==0:0)break a}else{if((c[d+24>>2]|0)==1)break a;if((c[b+8>>2]&2|0)==0)break a}a[d+52>>0]=0;a[d+53>>0]=0;OE(n,d,e,f,g,h);n=n+8|0}while(n>>>0<(b+(m<<3)+16|0)>>>0)}while(0);a[d+52>>0]=k;a[d+53>>0]=l;i=j;return}function TE(a,b,d,e,f,g){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;g=g|0;var h=0;h=i;if((a|0)==(c[b+8>>2]|0)){ME(b,d,e,f);i=h;return}else{a=c[a+8>>2]|0;Zb[c[(c[a>>2]|0)+20>>2]&7](a,b,d,e,f,g);i=h;return}}function UE(a,b,d,e,f,g){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;g=g|0;g=i;if((c[b+8>>2]|0)!=(a|0)){i=g;return}ME(b,d,e,f);i=g;return}function VE(a,b,d){a=a|0;b=b|0;d=d|0;var e=0;e=i;i=i+16|0;c[e>>2]=c[d>>2];b=Yb[c[(c[a>>2]|0)+16>>2]&31](a,b,e)|0;if(!b){i=e;return b&1|0}c[d>>2]=c[e>>2];i=e;return b&1|0}function WE(a){a=a|0;var b=0;b=i;if((a|0)==0)a=0;else a=(LE(a,20896)|0)!=0;i=b;return a&1|0}function XE(a){a=a|0;var b=0,d=0,e=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0;b=i;do if(a>>>0<245){if(a>>>0<11)o=16;else o=a+11&-8;u=o>>>3;p=c[5286]|0;if((p>>>u&3|0)!=0){e=c[21184+(((p>>>u&1^1)+u<<1)+2<<2)>>2]|0;d=c[e+8>>2]|0;do if((21184+((p>>>u&1^1)+u<<1<<2)|0)!=(d|0)){if(d>>>0<(c[5290]|0)>>>0)zb();if((c[d+12>>2]|0)==(e|0)){c[d+12>>2]=21184+((p>>>u&1^1)+u<<1<<2);c[21184+(((p>>>u&1^1)+u<<1)+2<<2)>>2]=d;break}else zb()}else c[5286]=p&~(1<<(p>>>u&1^1)+u);while(0);c[e+4>>2]=(p>>>u&1^1)+u<<3|3;c[e+((p>>>u&1^1)+u<<3|4)>>2]=c[e+((p>>>u&1^1)+u<<3|4)>>2]|1;E=e+8|0;i=b;return E|0}if(o>>>0>(c[5288]|0)>>>0){if((p>>>u|0)!=0){e=(p>>>u<<u&(2<<u|0-(2<<u))&0-(p>>>u<<u&(2<<u|0-(2<<u))))+ -1|0;d=e>>>(e>>>12&16)>>>(e>>>(e>>>12&16)>>>5&8);g=d>>>(d>>>2&4)>>>(d>>>(d>>>2&4)>>>1&2);g=(e>>>(e>>>12&16)>>>5&8|e>>>12&16|d>>>2&4|d>>>(d>>>2&4)>>>1&2|g>>>1&1)+(g>>>(g>>>1&1))|0;d=c[21184+((g<<1)+2<<2)>>2]|0;e=c[d+8>>2]|0;do if((21184+(g<<1<<2)|0)!=(e|0)){if(e>>>0<(c[5290]|0)>>>0)zb();if((c[e+12>>2]|0)==(d|0)){c[e+12>>2]=21184+(g<<1<<2);c[21184+((g<<1)+2<<2)>>2]=e;break}else zb()}else c[5286]=p&~(1<<g);while(0);f=(g<<3)-o|0;c[d+4>>2]=o|3;e=d+o|0;c[d+(o|4)>>2]=f|1;c[d+(g<<3)>>2]=f;h=c[5288]|0;if((h|0)!=0){g=c[5291]|0;j=c[5286]|0;if((j&1<<(h>>>3)|0)!=0){j=c[21184+((h>>>3<<1)+2<<2)>>2]|0;if(j>>>0<(c[5290]|0)>>>0)zb();else{C=21184+((h>>>3<<1)+2<<2)|0;B=j}}else{c[5286]=j|1<<(h>>>3);C=21184+((h>>>3<<1)+2<<2)|0;B=21184+(h>>>3<<1<<2)|0}c[C>>2]=g;c[B+12>>2]=g;c[g+8>>2]=B;c[g+12>>2]=21184+(h>>>3<<1<<2)}c[5288]=f;c[5291]=e;E=d+8|0;i=b;return E|0}p=c[5287]|0;if((p|0)!=0){e=((p&0-p)+ -1|0)>>>(((p&0-p)+ -1|0)>>>12&16);d=e>>>(e>>>5&8)>>>(e>>>(e>>>5&8)>>>2&4);d=c[21448+((e>>>5&8|((p&0-p)+ -1|0)>>>12&16|e>>>(e>>>5&8)>>>2&4|d>>>1&2|d>>>(d>>>1&2)>>>1&1)+(d>>>(d>>>1&2)>>>(d>>>(d>>>1&2)>>>1&1))<<2)>>2]|0;e=(c[d+4>>2]&-8)-o|0;f=d;while(1){g=c[f+16>>2]|0;if((g|0)==0){g=c[f+20>>2]|0;if((g|0)==0)break}f=(c[g+4>>2]&-8)-o|0;E=f>>>0<e>>>0;e=E?f:e;f=g;d=E?g:d}h=c[5290]|0;if(d>>>0<h>>>0)zb();f=d+o|0;if(!(d>>>0<f>>>0))zb();g=c[d+24>>2]|0;j=c[d+12>>2]|0;do if((j|0)==(d|0)){k=d+20|0;j=c[k>>2]|0;if((j|0)==0){k=d+16|0;j=c[k>>2]|0;if((j|0)==0){A=0;break}}while(1){l=j+20|0;m=c[l>>2]|0;if((m|0)!=0){j=m;k=l;continue}m=j+16|0;l=c[m>>2]|0;if((l|0)==0)break;else{j=l;k=m}}if(k>>>0<h>>>0)zb();else{c[k>>2]=0;A=j;break}}else{k=c[d+8>>2]|0;if(k>>>0<h>>>0)zb();if((c[k+12>>2]|0)!=(d|0))zb();if((c[j+8>>2]|0)==(d|0)){c[k+12>>2]=j;c[j+8>>2]=k;A=j;break}else zb()}while(0);do if((g|0)!=0){h=c[d+28>>2]|0;if((d|0)==(c[21448+(h<<2)>>2]|0)){c[21448+(h<<2)>>2]=A;if((A|0)==0){c[5287]=c[5287]&~(1<<h);break}}else{if(g>>>0<(c[5290]|0)>>>0)zb();if((c[g+16>>2]|0)==(d|0))c[g+16>>2]=A;else c[g+20>>2]=A;if((A|0)==0)break}if(A>>>0<(c[5290]|0)>>>0)zb();c[A+24>>2]=g;g=c[d+16>>2]|0;do if((g|0)!=0)if(g>>>0<(c[5290]|0)>>>0)zb();else{c[A+16>>2]=g;c[g+24>>2]=A;break}while(0);g=c[d+20>>2]|0;if((g|0)!=0)if(g>>>0<(c[5290]|0)>>>0)zb();else{c[A+20>>2]=g;c[g+24>>2]=A;break}}while(0);if(e>>>0<16){E=e+o|0;c[d+4>>2]=E|3;E=d+(E+4)|0;c[E>>2]=c[E>>2]|1}else{c[d+4>>2]=o|3;c[d+(o|4)>>2]=e|1;c[d+(e+o)>>2]=e;g=c[5288]|0;if((g|0)!=0){h=c[5291]|0;j=c[5286]|0;if((j&1<<(g>>>3)|0)!=0){j=c[21184+((g>>>3<<1)+2<<2)>>2]|0;if(j>>>0<(c[5290]|0)>>>0)zb();else{z=21184+((g>>>3<<1)+2<<2)|0;y=j}}else{c[5286]=j|1<<(g>>>3);z=21184+((g>>>3<<1)+2<<2)|0;y=21184+(g>>>3<<1<<2)|0}c[z>>2]=h;c[y+12>>2]=h;c[h+8>>2]=y;c[h+12>>2]=21184+(g>>>3<<1<<2)}c[5288]=e;c[5291]=f}E=d+8|0;i=b;return E|0}}}else if(!(a>>>0>4294967231)){o=a+11&-8;A=c[5287]|0;if((A|0)!=0){if(((a+11|0)>>>8|0)!=0)if(o>>>0>16777215)B=31;else{B=(a+11|0)>>>8<<((((a+11|0)>>>8)+1048320|0)>>>16&8);B=14-((B+520192|0)>>>16&4|(((a+11|0)>>>8)+1048320|0)>>>16&8|((B<<((B+520192|0)>>>16&4))+245760|0)>>>16&2)+(B<<((B+520192|0)>>>16&4)<<(((B<<((B+520192|0)>>>16&4))+245760|0)>>>16&2)>>>15)|0;B=o>>>(B+7|0)&1|B<<1}else B=0;C=c[21448+(B<<2)>>2]|0;a:do if((C|0)==0){z=0-o|0;a=0;y=0}else{if((B|0)==31)y=0;else y=25-(B>>>1)|0;z=0-o|0;a=0;D=o<<y;y=0;while(1){E=c[C+4>>2]&-8;if((E-o|0)>>>0<z>>>0)if((E|0)==(o|0)){z=E-o|0;a=C;y=C;break a}else{z=E-o|0;y=C}E=c[C+20>>2]|0;C=c[C+(D>>>31<<2)+16>>2]|0;a=(E|0)==0|(E|0)==(C|0)?a:E;if((C|0)==0)break;else D=D<<1}}while(0);if((a|0)==0&(y|0)==0){B=2<<B;if((A&(B|0-B)|0)==0)break;D=(A&(B|0-B)&0-(A&(B|0-B)))+ -1|0;E=D>>>(D>>>12&16)>>>(D>>>(D>>>12&16)>>>5&8);a=E>>>(E>>>2&4)>>>(E>>>(E>>>2&4)>>>1&2);a=c[21448+((D>>>(D>>>12&16)>>>5&8|D>>>12&16|E>>>2&4|E>>>(E>>>2&4)>>>1&2|a>>>1&1)+(a>>>(a>>>1&1))<<2)>>2]|0}if((a|0)!=0)while(1){E=(c[a+4>>2]&-8)-o|0;A=E>>>0<z>>>0;z=A?E:z;y=A?a:y;A=c[a+16>>2]|0;if((A|0)!=0){a=A;continue}a=c[a+20>>2]|0;if((a|0)==0)break}if((y|0)!=0?z>>>0<((c[5288]|0)-o|0)>>>0:0){f=c[5290]|0;if(y>>>0<f>>>0)zb();d=y+o|0;if(!(y>>>0<d>>>0))zb();e=c[y+24>>2]|0;g=c[y+12>>2]|0;do if((g|0)==(y|0)){h=y+20|0;g=c[h>>2]|0;if((g|0)==0){h=y+16|0;g=c[h>>2]|0;if((g|0)==0){x=0;break}}while(1){k=g+20|0;j=c[k>>2]|0;if((j|0)!=0){g=j;h=k;continue}k=g+16|0;j=c[k>>2]|0;if((j|0)==0)break;else{g=j;h=k}}if(h>>>0<f>>>0)zb();else{c[h>>2]=0;x=g;break}}else{h=c[y+8>>2]|0;if(h>>>0<f>>>0)zb();if((c[h+12>>2]|0)!=(y|0))zb();if((c[g+8>>2]|0)==(y|0)){c[h+12>>2]=g;c[g+8>>2]=h;x=g;break}else zb()}while(0);do if((e|0)!=0){f=c[y+28>>2]|0;if((y|0)==(c[21448+(f<<2)>>2]|0)){c[21448+(f<<2)>>2]=x;if((x|0)==0){c[5287]=c[5287]&~(1<<f);break}}else{if(e>>>0<(c[5290]|0)>>>0)zb();if((c[e+16>>2]|0)==(y|0))c[e+16>>2]=x;else c[e+20>>2]=x;if((x|0)==0)break}if(x>>>0<(c[5290]|0)>>>0)zb();c[x+24>>2]=e;e=c[y+16>>2]|0;do if((e|0)!=0)if(e>>>0<(c[5290]|0)>>>0)zb();else{c[x+16>>2]=e;c[e+24>>2]=x;break}while(0);e=c[y+20>>2]|0;if((e|0)!=0)if(e>>>0<(c[5290]|0)>>>0)zb();else{c[x+20>>2]=e;c[e+24>>2]=x;break}}while(0);b:do if(!(z>>>0<16)){c[y+4>>2]=o|3;c[y+(o|4)>>2]=z|1;c[y+(z+o)>>2]=z;e=z>>>3;if(z>>>0<256){f=c[5286]|0;do if((f&1<<e|0)==0){c[5286]=f|1<<e;v=21184+((e<<1)+2<<2)|0;u=21184+(e<<1<<2)|0}else{f=c[21184+((e<<1)+2<<2)>>2]|0;if(!(f>>>0<(c[5290]|0)>>>0)){v=21184+((e<<1)+2<<2)|0;u=f;break}zb()}while(0);c[v>>2]=d;c[u+12>>2]=d;c[y+(o+8)>>2]=u;c[y+(o+12)>>2]=21184+(e<<1<<2);break}e=z>>>8;if((e|0)!=0)if(z>>>0>16777215)e=31;else{E=e<<((e+1048320|0)>>>16&8)<<(((e<<((e+1048320|0)>>>16&8))+520192|0)>>>16&4);e=14-(((e<<((e+1048320|0)>>>16&8))+520192|0)>>>16&4|(e+1048320|0)>>>16&8|(E+245760|0)>>>16&2)+(E<<((E+245760|0)>>>16&2)>>>15)|0;e=z>>>(e+7|0)&1|e<<1}else e=0;f=21448+(e<<2)|0;c[y+(o+28)>>2]=e;c[y+(o+20)>>2]=0;c[y+(o+16)>>2]=0;h=c[5287]|0;g=1<<e;if((h&g|0)==0){c[5287]=h|g;c[f>>2]=d;c[y+(o+24)>>2]=f;c[y+(o+12)>>2]=d;c[y+(o+8)>>2]=d;break}f=c[f>>2]|0;if((e|0)==31)e=0;else e=25-(e>>>1)|0;c:do if((c[f+4>>2]&-8|0)!=(z|0)){e=z<<e;while(1){g=f+(e>>>31<<2)+16|0;h=c[g>>2]|0;if((h|0)==0)break;if((c[h+4>>2]&-8|0)==(z|0)){p=h;break c}else{e=e<<1;f=h}}if(g>>>0<(c[5290]|0)>>>0)zb();else{c[g>>2]=d;c[y+(o+24)>>2]=f;c[y+(o+12)>>2]=d;c[y+(o+8)>>2]=d;break b}}else p=f;while(0);e=p+8|0;f=c[e>>2]|0;g=c[5290]|0;if(p>>>0<g>>>0)zb();if(f>>>0<g>>>0)zb();else{c[f+12>>2]=d;c[e>>2]=d;c[y+(o+8)>>2]=f;c[y+(o+12)>>2]=p;c[y+(o+24)>>2]=0;break}}else{E=z+o|0;c[y+4>>2]=E|3;E=y+(E+4)|0;c[E>>2]=c[E>>2]|1}while(0);E=y+8|0;i=b;return E|0}}}else o=-1;while(0);p=c[5288]|0;if(!(o>>>0>p>>>0)){d=p-o|0;e=c[5291]|0;if(d>>>0>15){c[5291]=e+o;c[5288]=d;c[e+(o+4)>>2]=d|1;c[e+p>>2]=d;c[e+4>>2]=o|3}else{c[5288]=0;c[5291]=0;c[e+4>>2]=p|3;c[e+(p+4)>>2]=c[e+(p+4)>>2]|1}E=e+8|0;i=b;return E|0}p=c[5289]|0;if(o>>>0<p>>>0){D=p-o|0;c[5289]=D;E=c[5292]|0;c[5292]=E+o;c[E+(o+4)>>2]=D|1;c[E+4>>2]=o|3;E=E+8|0;i=b;return E|0}do if((c[5404]|0)==0){p=nb(30)|0;if((p+ -1&p|0)==0){c[5406]=p;c[5405]=p;c[5407]=-1;c[5408]=-1;c[5409]=0;c[5397]=0;c[5404]=(Cb(0)|0)&-16^1431655768;break}else zb()}while(0);v=o+48|0;p=c[5406]|0;x=o+47|0;u=p+x&0-p;if(!(u>>>0>o>>>0)){E=0;i=b;return E|0}y=c[5396]|0;if((y|0)!=0?(E=c[5394]|0,(E+u|0)>>>0<=E>>>0|(E+u|0)>>>0>y>>>0):0){E=0;i=b;return E|0}d:do if((c[5397]&4|0)==0){y=c[5292]|0;e:do if((y|0)!=0){z=21592|0;while(1){A=c[z>>2]|0;if(!(A>>>0>y>>>0)?(w=z+4|0,(A+(c[w>>2]|0)|0)>>>0>y>>>0):0)break;z=c[z+8>>2]|0;if((z|0)==0){n=182;break e}}if((z|0)!=0){A=p+x-(c[5289]|0)&0-p;if(A>>>0<2147483647){p=gb(A|0)|0;z=(p|0)==((c[z>>2]|0)+(c[w>>2]|0)|0);w=p;y=A;p=z?p:-1;z=z?A:0;n=191}else z=0}else n=182}else n=182;while(0);do if((n|0)==182){z=gb(0)|0;if((z|0)!=(-1|0)){p=c[5405]|0;if((p+ -1&z|0)==0)A=u;else A=u-z+(p+ -1+z&0-p)|0;w=c[5394]|0;p=w+A|0;if(A>>>0>o>>>0&A>>>0<2147483647){E=c[5396]|0;if((E|0)!=0?p>>>0<=w>>>0|p>>>0>E>>>0:0){z=0;break}n=gb(A|0)|0;w=n;y=A;p=(n|0)==(z|0)?z:-1;z=(n|0)==(z|0)?A:0;n=191}else z=0}else z=0}while(0);f:do if((n|0)==191){n=0-y|0;if((p|0)!=(-1|0)){q=z;n=202;break d}do if((w|0)!=(-1|0)&y>>>0<2147483647&y>>>0<v>>>0?(t=c[5406]|0,t=x-y+t&0-t,t>>>0<2147483647):0)if((gb(t|0)|0)==(-1|0)){gb(n|0)|0;break f}else{y=t+y|0;break}while(0);if((w|0)!=(-1|0)){p=w;q=y;n=202;break d}}while(0);c[5397]=c[5397]|4;n=199}else{z=0;n=199}while(0);if((((n|0)==199?u>>>0<2147483647:0)?(s=gb(u|0)|0,r=gb(0)|0,(r|0)!=(-1|0)&(s|0)!=(-1|0)&s>>>0<r>>>0):0)?(q=(r-s|0)>>>0>(o+40|0)>>>0,q):0){p=s;q=q?r-s|0:z;n=202}if((n|0)==202){r=(c[5394]|0)+q|0;c[5394]=r;if(r>>>0>(c[5395]|0)>>>0)c[5395]=r;r=c[5292]|0;g:do if((r|0)!=0){w=21592|0;while(1){t=c[w>>2]|0;u=w+4|0;v=c[u>>2]|0;if((p|0)==(t+v|0)){n=214;break}s=c[w+8>>2]|0;if((s|0)==0)break;else w=s}if(((n|0)==214?(c[w+12>>2]&8|0)==0:0)?r>>>0>=t>>>0&r>>>0<p>>>0:0){c[u>>2]=v+q;e=(c[5289]|0)+q|0;if((r+8&7|0)==0)d=0;else d=0-(r+8)&7;E=e-d|0;c[5292]=r+d;c[5289]=E;c[r+(d+4)>>2]=E|1;c[r+(e+4)>>2]=40;c[5293]=c[5408];break}if(p>>>0<(c[5290]|0)>>>0)c[5290]=p;t=p+q|0;s=21592|0;while(1){if((c[s>>2]|0)==(t|0)){n=224;break}u=c[s+8>>2]|0;if((u|0)==0)break;else s=u}if((n|0)==224?(c[s+12>>2]&8|0)==0:0){c[s>>2]=p;h=s+4|0;c[h>>2]=(c[h>>2]|0)+q;h=p+8|0;if((h&7|0)==0)h=0;else h=0-h&7;k=p+(q+8)|0;if((k&7|0)==0)r=0;else r=0-k&7;s=p+(r+q)|0;k=h+o|0;l=p+k|0;m=s-(p+h)-o|0;c[p+(h+4)>>2]=o|3;h:do if((s|0)!=(c[5292]|0)){if((s|0)==(c[5291]|0)){E=(c[5288]|0)+m|0;c[5288]=E;c[5291]=l;c[p+(k+4)>>2]=E|1;c[p+(E+k)>>2]=E;break}o=q+4|0;n=c[p+(o+r)>>2]|0;if((n&3|0)==1){i:do if(!(n>>>0<256)){j=c[p+((r|24)+q)>>2]|0;u=c[p+(q+12+r)>>2]|0;do if((u|0)==(s|0)){v=r|16;u=p+(o+v)|0;t=c[u>>2]|0;if((t|0)==0){u=p+(v+q)|0;t=c[u>>2]|0;if((t|0)==0){g=0;break}}while(1){v=t+20|0;w=c[v>>2]|0;if((w|0)!=0){t=w;u=v;continue}v=t+16|0;w=c[v>>2]|0;if((w|0)==0)break;else{t=w;u=v}}if(u>>>0<(c[5290]|0)>>>0)zb();else{c[u>>2]=0;g=t;break}}else{t=c[p+((r|8)+q)>>2]|0;if(t>>>0<(c[5290]|0)>>>0)zb();if((c[t+12>>2]|0)!=(s|0))zb();if((c[u+8>>2]|0)==(s|0)){c[t+12>>2]=u;c[u+8>>2]=t;g=u;break}else zb()}while(0);if((j|0)==0)break;t=c[p+(q+28+r)>>2]|0;do if((s|0)!=(c[21448+(t<<2)>>2]|0)){if(j>>>0<(c[5290]|0)>>>0)zb();if((c[j+16>>2]|0)==(s|0))c[j+16>>2]=g;else c[j+20>>2]=g;if((g|0)==0)break i}else{c[21448+(t<<2)>>2]=g;if((g|0)!=0)break;c[5287]=c[5287]&~(1<<t);break i}while(0);if(g>>>0<(c[5290]|0)>>>0)zb();c[g+24>>2]=j;j=r|16;s=c[p+(j+q)>>2]|0;do if((s|0)!=0)if(s>>>0<(c[5290]|0)>>>0)zb();else{c[g+16>>2]=s;c[s+24>>2]=g;break}while(0);j=c[p+(o+j)>>2]|0;if((j|0)==0)break;if(j>>>0<(c[5290]|0)>>>0)zb();else{c[g+20>>2]=j;c[j+24>>2]=g;break}}else{g=c[p+((r|8)+q)>>2]|0;o=c[p+(q+12+r)>>2]|0;do if((g|0)!=(21184+(n>>>3<<1<<2)|0)){if(g>>>0<(c[5290]|0)>>>0)zb();if((c[g+12>>2]|0)==(s|0))break;zb()}while(0);if((o|0)==(g|0)){c[5286]=c[5286]&~(1<<(n>>>3));break}do if((o|0)==(21184+(n>>>3<<1<<2)|0))j=o+8|0;else{if(o>>>0<(c[5290]|0)>>>0)zb();if((c[o+8>>2]|0)==(s|0)){j=o+8|0;break}zb()}while(0);c[g+12>>2]=o;c[j>>2]=g}while(0);s=p+((n&-8|r)+q)|0;m=(n&-8)+m|0}g=s+4|0;c[g>>2]=c[g>>2]&-2;c[p+(k+4)>>2]=m|1;c[p+(m+k)>>2]=m;g=m>>>3;if(m>>>0<256){d=c[5286]|0;do if((d&1<<g|0)==0){c[5286]=d|1<<g;f=21184+((g<<1)+2<<2)|0;e=21184+(g<<1<<2)|0}else{d=c[21184+((g<<1)+2<<2)>>2]|0;if(!(d>>>0<(c[5290]|0)>>>0)){f=21184+((g<<1)+2<<2)|0;e=d;break}zb()}while(0);c[f>>2]=l;c[e+12>>2]=l;c[p+(k+8)>>2]=e;c[p+(k+12)>>2]=21184+(g<<1<<2);break}e=m>>>8;do if((e|0)==0)e=0;else{if(m>>>0>16777215){e=31;break}E=e<<((e+1048320|0)>>>16&8)<<(((e<<((e+1048320|0)>>>16&8))+520192|0)>>>16&4);e=14-(((e<<((e+1048320|0)>>>16&8))+520192|0)>>>16&4|(e+1048320|0)>>>16&8|(E+245760|0)>>>16&2)+(E<<((E+245760|0)>>>16&2)>>>15)|0;e=m>>>(e+7|0)&1|e<<1}while(0);j=21448+(e<<2)|0;c[p+(k+28)>>2]=e;c[p+(k+20)>>2]=0;c[p+(k+16)>>2]=0;f=c[5287]|0;g=1<<e;if((f&g|0)==0){c[5287]=f|g;c[j>>2]=l;c[p+(k+24)>>2]=j;c[p+(k+12)>>2]=l;c[p+(k+8)>>2]=l;break}f=c[j>>2]|0;if((e|0)==31)e=0;else e=25-(e>>>1)|0;j:do if((c[f+4>>2]&-8|0)!=(m|0)){e=m<<e;while(1){g=f+(e>>>31<<2)+16|0;j=c[g>>2]|0;if((j|0)==0)break;if((c[j+4>>2]&-8|0)==(m|0)){d=j;break j}else{e=e<<1;f=j}}if(g>>>0<(c[5290]|0)>>>0)zb();else{c[g>>2]=l;c[p+(k+24)>>2]=f;c[p+(k+12)>>2]=l;c[p+(k+8)>>2]=l;break h}}else d=f;while(0);f=d+8|0;e=c[f>>2]|0;g=c[5290]|0;if(d>>>0<g>>>0)zb();if(e>>>0<g>>>0)zb();else{c[e+12>>2]=l;c[f>>2]=l;c[p+(k+8)>>2]=e;c[p+(k+12)>>2]=d;c[p+(k+24)>>2]=0;break}}else{E=(c[5289]|0)+m|0;c[5289]=E;c[5292]=l;c[p+(k+4)>>2]=E|1}while(0);E=p+(h|8)|0;i=b;return E|0}d=21592|0;while(1){e=c[d>>2]|0;if(!(e>>>0>r>>>0)?(m=c[d+4>>2]|0,(e+m|0)>>>0>r>>>0):0)break;d=c[d+8>>2]|0}if((e+(m+ -39)&7|0)==0)d=0;else d=0-(e+(m+ -39))&7;d=e+(m+ -47+d)|0;d=d>>>0<(r+16|0)>>>0?r:d;f=p+8|0;if((f&7|0)==0)f=0;else f=0-f&7;E=q+ -40-f|0;c[5292]=p+f;c[5289]=E;c[p+(f+4)>>2]=E|1;c[p+(q+ -36)>>2]=40;c[5293]=c[5408];c[d+4>>2]=27;c[d+8>>2]=c[5398];c[d+12>>2]=c[5399];c[d+16>>2]=c[5400];c[d+20>>2]=c[5401];c[5398]=p;c[5399]=q;c[5401]=0;c[5400]=d+8;c[d+28>>2]=7;if((d+32|0)>>>0<(e+m|0)>>>0){f=d+28|0;do{E=f;f=f+4|0;c[f>>2]=7}while((E+8|0)>>>0<(e+m|0)>>>0)}if((d|0)!=(r|0)){c[r+(d-r+4)>>2]=c[r+(d-r+4)>>2]&-2;c[r+4>>2]=d-r|1;c[r+(d-r)>>2]=d-r;if((d-r|0)>>>0<256){e=c[5286]|0;do if((e&1<<((d-r|0)>>>3)|0)==0){c[5286]=e|1<<((d-r|0)>>>3);l=21184+(((d-r|0)>>>3<<1)+2<<2)|0;k=21184+((d-r|0)>>>3<<1<<2)|0}else{e=c[21184+(((d-r|0)>>>3<<1)+2<<2)>>2]|0;if(!(e>>>0<(c[5290]|0)>>>0)){l=21184+(((d-r|0)>>>3<<1)+2<<2)|0;k=e;break}zb()}while(0);c[l>>2]=r;c[k+12>>2]=r;c[r+8>>2]=k;c[r+12>>2]=21184+((d-r|0)>>>3<<1<<2);break}if(((d-r|0)>>>8|0)!=0)if((d-r|0)>>>0>16777215)e=31;else{e=(d-r|0)>>>8<<((((d-r|0)>>>8)+1048320|0)>>>16&8);e=14-((e+520192|0)>>>16&4|(((d-r|0)>>>8)+1048320|0)>>>16&8|((e<<((e+520192|0)>>>16&4))+245760|0)>>>16&2)+(e<<((e+520192|0)>>>16&4)<<(((e<<((e+520192|0)>>>16&4))+245760|0)>>>16&2)>>>15)|0;e=(d-r|0)>>>(e+7|0)&1|e<<1}else e=0;j=21448+(e<<2)|0;c[r+28>>2]=e;c[r+20>>2]=0;c[r+16>>2]=0;f=c[5287]|0;g=1<<e;if((f&g|0)==0){c[5287]=f|g;c[j>>2]=r;c[r+24>>2]=j;c[r+12>>2]=r;c[r+8>>2]=r;break}g=c[j>>2]|0;if((e|0)==31)e=0;else e=25-(e>>>1)|0;k:do if((c[g+4>>2]&-8|0)!=(d-r|0)){e=d-r<<e;while(1){f=g+(e>>>31<<2)+16|0;j=c[f>>2]|0;if((j|0)==0)break;if((c[j+4>>2]&-8|0)==(d-r|0)){h=j;break k}else{e=e<<1;g=j}}if(f>>>0<(c[5290]|0)>>>0)zb();else{c[f>>2]=r;c[r+24>>2]=g;c[r+12>>2]=r;c[r+8>>2]=r;break g}}else h=g;while(0);e=h+8|0;d=c[e>>2]|0;f=c[5290]|0;if(h>>>0<f>>>0)zb();if(d>>>0<f>>>0)zb();else{c[d+12>>2]=r;c[e>>2]=r;c[r+8>>2]=d;c[r+12>>2]=h;c[r+24>>2]=0;break}}}else{E=c[5290]|0;if((E|0)==0|p>>>0<E>>>0)c[5290]=p;c[5398]=p;c[5399]=q;c[5401]=0;c[5295]=c[5404];c[5294]=-1;d=0;do{E=d<<1;c[21184+(E+3<<2)>>2]=21184+(E<<2);c[21184+(E+2<<2)>>2]=21184+(E<<2);d=d+1|0}while((d|0)!=32);d=p+8|0;if((d&7|0)==0)d=0;else d=0-d&7;E=q+ -40-d|0;c[5292]=p+d;c[5289]=E;c[p+(d+4)>>2]=E|1;c[p+(q+ -36)>>2]=40;c[5293]=c[5408]}while(0);d=c[5289]|0;if(d>>>0>o>>>0){D=d-o|0;c[5289]=D;E=c[5292]|0;c[5292]=E+o;c[E+(o+4)>>2]=D|1;c[E+4>>2]=o|3;E=E+8|0;i=b;return E|0}}c[(vb()|0)>>2]=12;E=0;i=b;return E|0}function YE(a){a=a|0;var b=0,d=0,e=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0;b=i;if((a|0)==0){i=b;return}r=c[5290]|0;if((a+ -8|0)>>>0<r>>>0)zb();h=c[a+ -4>>2]|0;if((h&3|0)==1)zb();k=a+((h&-8)+ -8)|0;do if((h&1|0)==0){o=c[a+ -8>>2]|0;if((h&3|0)==0){i=b;return}m=a+(-8-o)|0;n=o+(h&-8)|0;if(m>>>0<r>>>0)zb();if((m|0)==(c[5291]|0)){if((c[a+((h&-8)+ -4)>>2]&3|0)!=3){d=m;p=n;break}c[5288]=n;c[a+((h&-8)+ -4)>>2]=c[a+((h&-8)+ -4)>>2]&-2;c[a+(-8-o+4)>>2]=n|1;c[k>>2]=n;i=b;return}if(o>>>0<256){p=c[a+(-8-o+8)>>2]|0;d=c[a+(-8-o+12)>>2]|0;if((p|0)!=(21184+(o>>>3<<1<<2)|0)){if(p>>>0<r>>>0)zb();if((c[p+12>>2]|0)!=(m|0))zb()}if((d|0)==(p|0)){c[5286]=c[5286]&~(1<<(o>>>3));d=m;p=n;break}if((d|0)!=(21184+(o>>>3<<1<<2)|0)){if(d>>>0<r>>>0)zb();if((c[d+8>>2]|0)!=(m|0))zb();else s=d+8|0}else s=d+8|0;c[p+12>>2]=d;c[s>>2]=p;d=m;p=n;break}s=c[a+(-8-o+24)>>2]|0;u=c[a+(-8-o+12)>>2]|0;do if((u|0)==(m|0)){u=c[a+(-8-o+20)>>2]|0;if((u|0)==0){u=c[a+(-8-o+16)>>2]|0;if((u|0)==0){q=0;break}else t=a+(-8-o+16)|0}else t=a+(-8-o+20)|0;while(1){w=u+20|0;v=c[w>>2]|0;if((v|0)!=0){u=v;t=w;continue}w=u+16|0;v=c[w>>2]|0;if((v|0)==0)break;else{u=v;t=w}}if(t>>>0<r>>>0)zb();else{c[t>>2]=0;q=u;break}}else{t=c[a+(-8-o+8)>>2]|0;if(t>>>0<r>>>0)zb();if((c[t+12>>2]|0)!=(m|0))zb();if((c[u+8>>2]|0)==(m|0)){c[t+12>>2]=u;c[u+8>>2]=t;q=u;break}else zb()}while(0);if((s|0)!=0){r=c[a+(-8-o+28)>>2]|0;if((m|0)==(c[21448+(r<<2)>>2]|0)){c[21448+(r<<2)>>2]=q;if((q|0)==0){c[5287]=c[5287]&~(1<<r);d=m;p=n;break}}else{if(s>>>0<(c[5290]|0)>>>0)zb();if((c[s+16>>2]|0)==(m|0))c[s+16>>2]=q;else c[s+20>>2]=q;if((q|0)==0){d=m;p=n;break}}if(q>>>0<(c[5290]|0)>>>0)zb();c[q+24>>2]=s;r=c[a+(-8-o+16)>>2]|0;do if((r|0)!=0)if(r>>>0<(c[5290]|0)>>>0)zb();else{c[q+16>>2]=r;c[r+24>>2]=q;break}while(0);o=c[a+(-8-o+20)>>2]|0;if((o|0)!=0)if(o>>>0<(c[5290]|0)>>>0)zb();else{c[q+20>>2]=o;c[o+24>>2]=q;d=m;p=n;break}else{d=m;p=n}}else{d=m;p=n}}else{d=a+ -8|0;p=h&-8}while(0);if(!(d>>>0<k>>>0))zb();m=c[a+((h&-8)+ -4)>>2]|0;if((m&1|0)==0)zb();if((m&2|0)==0){if((k|0)==(c[5292]|0)){w=(c[5289]|0)+p|0;c[5289]=w;c[5292]=d;c[d+4>>2]=w|1;if((d|0)!=(c[5291]|0)){i=b;return}c[5291]=0;c[5288]=0;i=b;return}if((k|0)==(c[5291]|0)){w=(c[5288]|0)+p|0;c[5288]=w;c[5291]=d;c[d+4>>2]=w|1;c[d+w>>2]=w;i=b;return}p=(m&-8)+p|0;do if(!(m>>>0<256)){l=c[a+((h&-8)+16)>>2]|0;n=c[a+(h&-8|4)>>2]|0;do if((n|0)==(k|0)){n=c[a+((h&-8)+12)>>2]|0;if((n|0)==0){n=c[a+((h&-8)+8)>>2]|0;if((n|0)==0){j=0;break}else m=a+((h&-8)+8)|0}else m=a+((h&-8)+12)|0;while(1){o=n+20|0;q=c[o>>2]|0;if((q|0)!=0){n=q;m=o;continue}o=n+16|0;q=c[o>>2]|0;if((q|0)==0)break;else{n=q;m=o}}if(m>>>0<(c[5290]|0)>>>0)zb();else{c[m>>2]=0;j=n;break}}else{m=c[a+(h&-8)>>2]|0;if(m>>>0<(c[5290]|0)>>>0)zb();if((c[m+12>>2]|0)!=(k|0))zb();if((c[n+8>>2]|0)==(k|0)){c[m+12>>2]=n;c[n+8>>2]=m;j=n;break}else zb()}while(0);if((l|0)!=0){m=c[a+((h&-8)+20)>>2]|0;if((k|0)==(c[21448+(m<<2)>>2]|0)){c[21448+(m<<2)>>2]=j;if((j|0)==0){c[5287]=c[5287]&~(1<<m);break}}else{if(l>>>0<(c[5290]|0)>>>0)zb();if((c[l+16>>2]|0)==(k|0))c[l+16>>2]=j;else c[l+20>>2]=j;if((j|0)==0)break}if(j>>>0<(c[5290]|0)>>>0)zb();c[j+24>>2]=l;k=c[a+((h&-8)+8)>>2]|0;do if((k|0)!=0)if(k>>>0<(c[5290]|0)>>>0)zb();else{c[j+16>>2]=k;c[k+24>>2]=j;break}while(0);h=c[a+((h&-8)+12)>>2]|0;if((h|0)!=0)if(h>>>0<(c[5290]|0)>>>0)zb();else{c[j+20>>2]=h;c[h+24>>2]=j;break}}}else{j=c[a+(h&-8)>>2]|0;h=c[a+(h&-8|4)>>2]|0;if((j|0)!=(21184+(m>>>3<<1<<2)|0)){if(j>>>0<(c[5290]|0)>>>0)zb();if((c[j+12>>2]|0)!=(k|0))zb()}if((h|0)==(j|0)){c[5286]=c[5286]&~(1<<(m>>>3));break}if((h|0)!=(21184+(m>>>3<<1<<2)|0)){if(h>>>0<(c[5290]|0)>>>0)zb();if((c[h+8>>2]|0)!=(k|0))zb();else l=h+8|0}else l=h+8|0;c[j+12>>2]=h;c[l>>2]=j}while(0);c[d+4>>2]=p|1;c[d+p>>2]=p;if((d|0)==(c[5291]|0)){c[5288]=p;i=b;return}}else{c[a+((h&-8)+ -4)>>2]=m&-2;c[d+4>>2]=p|1;c[d+p>>2]=p}h=p>>>3;if(p>>>0<256){e=c[5286]|0;if((e&1<<h|0)!=0){e=c[21184+((h<<1)+2<<2)>>2]|0;if(e>>>0<(c[5290]|0)>>>0)zb();else{f=21184+((h<<1)+2<<2)|0;g=e}}else{c[5286]=e|1<<h;f=21184+((h<<1)+2<<2)|0;g=21184+(h<<1<<2)|0}c[f>>2]=d;c[g+12>>2]=d;c[d+8>>2]=g;c[d+12>>2]=21184+(h<<1<<2);i=b;return}f=p>>>8;if((f|0)!=0)if(p>>>0>16777215)f=31;else{w=f<<((f+1048320|0)>>>16&8)<<(((f<<((f+1048320|0)>>>16&8))+520192|0)>>>16&4);f=14-(((f<<((f+1048320|0)>>>16&8))+520192|0)>>>16&4|(f+1048320|0)>>>16&8|(w+245760|0)>>>16&2)+(w<<((w+245760|0)>>>16&2)>>>15)|0;f=p>>>(f+7|0)&1|f<<1}else f=0;g=21448+(f<<2)|0;c[d+28>>2]=f;c[d+20>>2]=0;c[d+16>>2]=0;a=c[5287]|0;h=1<<f;a:do if((a&h|0)!=0){g=c[g>>2]|0;if((f|0)==31)f=0;else f=25-(f>>>1)|0;b:do if((c[g+4>>2]&-8|0)!=(p|0)){f=p<<f;h=g;while(1){a=h+(f>>>31<<2)+16|0;g=c[a>>2]|0;if((g|0)==0)break;if((c[g+4>>2]&-8|0)==(p|0)){e=g;break b}else{f=f<<1;h=g}}if(a>>>0<(c[5290]|0)>>>0)zb();else{c[a>>2]=d;c[d+24>>2]=h;c[d+12>>2]=d;c[d+8>>2]=d;break a}}else e=g;while(0);f=e+8|0;h=c[f>>2]|0;g=c[5290]|0;if(e>>>0<g>>>0)zb();if(h>>>0<g>>>0)zb();else{c[h+12>>2]=d;c[f>>2]=d;c[d+8>>2]=h;c[d+12>>2]=e;c[d+24>>2]=0;break}}else{c[5287]=a|h;c[g>>2]=d;c[d+24>>2]=g;c[d+12>>2]=d;c[d+8>>2]=d}while(0);w=(c[5294]|0)+ -1|0;c[5294]=w;if((w|0)==0)d=21600|0;else{i=b;return}while(1){d=c[d>>2]|0;if((d|0)==0)break;else d=d+8|0}c[5294]=-1;i=b;return}function ZE(){}function _E(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;b=b-d-(c>>>0>a>>>0|0)>>>0;return(E=b,a-c>>>0|0)|0}function $E(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,g=0,h=0;f=b+e|0;if((e|0)>=20){d=d&255;h=b&3;g=d|d<<8|d<<16|d<<24;if(h){h=b+4-h|0;while((b|0)<(h|0)){a[b>>0]=d;b=b+1|0}}while((b|0)<(f&~3|0)){c[b>>2]=g;b=b+4|0}}while((b|0)<(f|0)){a[b>>0]=d;b=b+1|0}return b-e|0}function aF(b){b=b|0;var c=0;c=b;while(a[c>>0]|0)c=c+1|0;return c-b|0}function bF(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;return(E=b+d+(a+c>>>0>>>0<a>>>0|0)>>>0,a+c>>>0|0)|0}function cF(b,d,e){b=b|0;d=d|0;e=e|0;var f=0;if((e|0)>=4096)return rb(b|0,d|0,e|0)|0;f=b|0;if((b&3)==(d&3)){while(b&3){if((e|0)==0)return f|0;a[b>>0]=a[d>>0]|0;b=b+1|0;d=d+1|0;e=e-1|0}while((e|0)>=4){c[b>>2]=c[d>>2];b=b+4|0;d=d+4|0;e=e-4|0}}while((e|0)>0){a[b>>0]=a[d>>0]|0;b=b+1|0;d=d+1|0;e=e-1|0}return f|0}function dF(b,c,d){b=b|0;c=c|0;d=d|0;var e=0;if((c|0)<(b|0)&(b|0)<(c+d|0)){e=b;c=c+d|0;b=b+d|0;while((d|0)>0){b=b-1|0;c=c-1|0;d=d-1|0;a[b>>0]=a[c>>0]|0}b=e}else cF(b,c,d)|0;return b|0}function eF(a){a=a|0;return(a&255)<<24|(a>>8&255)<<16|(a>>16&255)<<8|a>>>24|0}function fF(a,b,c){a=a|0;b=b|0;c=c|0;if((c|0)<32){E=b<<c|(a&(1<<c)-1<<32-c)>>>32-c;return a<<c}E=a<<c-32;return 0}function gF(a,b,c){a=a|0;b=b|0;c=c|0;if((c|0)<32){E=b>>>c;return a>>>c|(b&(1<<c)-1)<<32-c}E=0;return b>>>c-32|0}function hF(a,b,c){a=a|0;b=b|0;c=c|0;if((c|0)<32){E=b>>c;return a>>>c|(b&(1<<c)-1)<<32-c}E=(b|0)<0?-1:0;return b>>c-32|0}function iF(b){b=b|0;var c=0;c=a[n+(b>>>24)>>0]|0;if((c|0)<8)return c|0;c=a[n+(b>>16&255)>>0]|0;if((c|0)<8)return c+8|0;c=a[n+(b>>8&255)>>0]|0;if((c|0)<8)return c+16|0;return(a[n+(b&255)>>0]|0)+24|0}function jF(b){b=b|0;var c=0;c=a[m+(b&255)>>0]|0;if((c|0)<8)return c|0;c=a[m+(b>>8&255)>>0]|0;if((c|0)<8)return c+8|0;c=a[m+(b>>16&255)>>0]|0;if((c|0)<8)return c+16|0;return(a[m+(b>>>24)>>0]|0)+24|0}function kF(a,b){a=a|0;b=b|0;var c=0,d=0,e=0;c=aa(b&65535,a&65535)|0;e=(c>>>16)+(aa(b&65535,a>>>16)|0)|0;d=aa(b>>>16,a&65535)|0;return(E=(e>>>16)+(aa(b>>>16,a>>>16)|0)+(((e&65535)+d|0)>>>16)|0,e+d<<16|c&65535|0)|0}function lF(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0;g=b>>31|((b|0)<0?-1:0)<<1;e=((b|0)<0?-1:0)>>31|((b|0)<0?-1:0)<<1;h=d>>31|((d|0)<0?-1:0)<<1;f=((d|0)<0?-1:0)>>31|((d|0)<0?-1:0)<<1;b=_E(g^a,e^b,g,e)|0;a=E;a=_E((qF(b,a,_E(h^c,f^d,h,f)|0,E,0)|0)^(h^g),E^(f^e),h^g,f^e)|0;return a|0}function mF(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,k=0;f=i;i=i+8|0;h=b>>31|((b|0)<0?-1:0)<<1;g=((b|0)<0?-1:0)>>31|((b|0)<0?-1:0)<<1;k=e>>31|((e|0)<0?-1:0)<<1;j=((e|0)<0?-1:0)>>31|((e|0)<0?-1:0)<<1;b=_E(h^a,g^b,h,g)|0;a=E;qF(b,a,_E(k^d,j^e,k,j)|0,E,f|0)|0;a=_E(c[f>>2]^h,c[f+4>>2]^g,h,g)|0;b=E;i=f;return(E=b,a)|0}function nF(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0;e=kF(a,c)|0;f=E;return(E=(aa(b,c)|0)+(aa(d,a)|0)+f|f&0,e|0|0)|0}function oF(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;a=qF(a,b,c,d,0)|0;return a|0}function pF(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0;f=i;i=i+8|0;qF(a,b,d,e,f|0)|0;i=f;return(E=c[f+4>>2]|0,c[f>>2]|0)|0}function qF(a,b,d,e,f){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;var g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0;if((b|0)==0)if((e|0)==0){if((f|0)!=0){c[f>>2]=(a>>>0)%(d>>>0);c[f+4>>2]=0}k=0;l=(a>>>0)/(d>>>0)>>>0;return(E=k,l)|0}else{if((f|0)==0){k=0;l=0;return(E=k,l)|0}c[f>>2]=a|0;c[f+4>>2]=b&0;k=0;l=0;return(E=k,l)|0}do if((d|0)!=0){if((e|0)!=0){k=(iF(e|0)|0)-(iF(b|0)|0)|0;if(k>>>0<=31){i=k+1|0;g=a>>>((k+1|0)>>>0)&k-31>>31|b<<31-k;h=b>>>((k+1|0)>>>0)&k-31>>31;j=0;l=a<<31-k;break}if((f|0)==0){k=0;l=0;return(E=k,l)|0}c[f>>2]=a|0;c[f+4>>2]=b|b&0;k=0;l=0;return(E=k,l)|0}if((d-1&d|0)!=0){l=(iF(d|0)|0)+33-(iF(b|0)|0)|0;i=l;g=32-l-1>>31&b>>>((l-32|0)>>>0)|(b<<32-l|a>>>(l>>>0))&l-32>>31;h=l-32>>31&b>>>(l>>>0);j=a<<64-l&32-l>>31;l=(b<<64-l|a>>>((l-32|0)>>>0))&32-l>>31|a<<32-l&l-33>>31;break}if((f|0)!=0){c[f>>2]=d-1&a;c[f+4>>2]=0}if((d|0)==1){k=b|b&0;l=a|0|0;return(E=k,l)|0}else{l=jF(d|0)|0;k=b>>>(l>>>0)|0;l=b<<32-l|a>>>(l>>>0)|0;return(E=k,l)|0}}else{if((e|0)==0){if((f|0)!=0){c[f>>2]=(b>>>0)%(d>>>0);c[f+4>>2]=0}k=0;l=(b>>>0)/(d>>>0)>>>0;return(E=k,l)|0}if((a|0)==0){if((f|0)!=0){c[f>>2]=0;c[f+4>>2]=(b>>>0)%(e>>>0)}k=0;l=(b>>>0)/(e>>>0)>>>0;return(E=k,l)|0}if((e-1&e|0)==0){if((f|0)!=0){c[f>>2]=a|0;c[f+4>>2]=e-1&b|b&0}k=0;l=b>>>((jF(e|0)|0)>>>0);return(E=k,l)|0}k=(iF(e|0)|0)-(iF(b|0)|0)|0;if(k>>>0<=30){i=k+1|0;g=b<<31-k|a>>>((k+1|0)>>>0);h=b>>>((k+1|0)>>>0);j=0;l=a<<31-k;break}if((f|0)==0){k=0;l=0;return(E=k,l)|0}c[f>>2]=a|0;c[f+4>>2]=b|b&0;k=0;l=0;return(E=k,l)|0}while(0);if((i|0)==0){e=l;k=j;d=0;j=0}else{a=bF(d|0|0,e|e&0,-1,-1)|0;b=E;k=j;j=0;do{p=l;l=k>>>31|l<<1;k=j|k<<1;p=g<<1|p>>>31|0;o=g>>>31|h<<1|0;_E(a,b,p,o)|0;m=E;n=m>>31|((m|0)<0?-1:0)<<1;j=n&1;g=_E(p,o,n&(d|0),(((m|0)<0?-1:0)>>31|((m|0)<0?-1:0)<<1)&(e|e&0))|0;h=E;i=i-1|0}while((i|0)!=0);e=l;d=0}if((f|0)!=0){c[f>>2]=g;c[f+4>>2]=h}o=(k|0)>>>31|e<<1|(0<<1|k>>>31)&0|d;p=(k<<1|0>>>31)&-2|j;return(E=o,p)|0}function rF(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;Jb[a&31](b|0,c|0,d|0,e|0,f|0)}function sF(a,b,c){a=a|0;b=b|0;c=+c;Kb[a&31](b|0,+c)}function tF(a,b){a=a|0;b=b|0;Lb[a&511](b|0)}function uF(a,b,c,d,e,f,g){a=a|0;b=b|0;c=c|0;d=d|0;e=+e;f=f|0;g=g|0;Mb[a&0](b|0,c|0,d|0,+e,f|0,g|0)}function vF(a,b,c){a=a|0;b=b|0;c=c|0;Nb[a&127](b|0,c|0)}function wF(a,b,c,d,e,f,g,h,i,j,k){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;k=k|0;return Ob[a&3](b|0,c|0,d|0,e|0,f|0,g|0,h|0,i|0,j|0,k|0)|0}function xF(a,b){a=a|0;b=b|0;return Pb[a&127](b|0)|0}function yF(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=+d;e=e|0;Qb[a&7](b|0,c|0,+d,e|0)}function zF(a,b,c,d,e,f,g){a=a|0;b=b|0;c=+c;d=+d;e=e|0;f=f|0;g=g|0;Rb[a&0](b|0,+c,+d,e|0,f|0,g|0)}function AF(a,b,c,d,e){a=a|0;b=b|0;c=+c;d=d|0;e=e|0;Sb[a&0](b|0,+c,d|0,e|0)}function BF(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;return Tb[a&31](b|0,c|0,d|0,e|0)|0}function CF(a,b,c,d){a=a|0;b=b|0;c=+c;d=d|0;Ub[a&15](b|0,+c,d|0)}function DF(a,b,c,d,e,f,g,h,i){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;return+Vb[a&1](b|0,c|0,d|0,e|0,f|0,g|0,h|0,i|0)}function EF(a,b,c,d,e,f,g,h,i,j,k,l){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=+f;g=+g;h=+h;i=+i;j=j|0;k=k|0;l=+l;Wb[a&0](b|0,c|0,d|0,e|0,+f,+g,+h,+i,j|0,k|0,+l)}function FF(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;return+Xb[a&15](b|0,c|0,d|0,e|0,f|0)}function GF(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;return Yb[a&31](b|0,c|0,d|0)|0}function HF(a,b,c,d,e,f,g){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;Zb[a&7](b|0,c|0,d|0,e|0,f|0,g|0)}function IF(a,b,c,d){a=a|0;b=b|0;c=c|0;d=+d;return _b[a&7](b|0,c|0,+d)|0}function JF(a,b){a=a|0;b=b|0;return+$b[a&15](b|0)}function KF(a,b,c,d,e,f,g){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;return ac[a&3](b|0,c|0,d|0,e|0,f|0,g|0)|0}function LF(a,b,c,d,e,f,g){a=a|0;b=b|0;c=c|0;d=d|0;e=+e;f=f|0;g=g|0;return+bc[a&3](b|0,c|0,d|0,+e,f|0,g|0)}function MF(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=+d;e=e|0;f=f|0;cc[a&0](b|0,c|0,+d,e|0,f|0)}function NF(a,b,c,d,e,f,g,h){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;dc[a&1](b|0,c|0,d|0,e|0,f|0,g|0,h|0)}function OF(a,b,c,d,e,f,g,h,i,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;ec[a&1](b|0,c|0,d|0,e|0,f|0,g|0,h|0,i|0,j|0)}function PF(a,b,c,d,e,f,g,h,i,j,k){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;k=k|0;fc[a&3](b|0,c|0,d|0,e|0,f|0,g|0,h|0,i|0,j|0,k|0)}function QF(a,b,c){a=a|0;b=b|0;c=c|0;return gc[a&31](b|0,c|0)|0}function RF(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;return+hc[a&15](b|0,c|0,d|0)}function SF(a,b,c,d,e,f,g,h,i,j,k){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;k=k|0;return+ic[a&3](b|0,c|0,d|0,e|0,f|0,g|0,h|0,i|0,j|0,k|0)}function TF(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=+f;jc[a&1](b|0,c|0,d|0,e|0,+f)}function UF(a,b,c,d,e,f,g,h,i,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;return+kc[a&3](b|0,c|0,d|0,e|0,f|0,g|0,h|0,i|0,j|0)}function VF(a,b,c){a=a|0;b=b|0;c=+c;return+lc[a&1](b|0,+c)}function WF(a,b,c,d,e,f,g,h,i,j,k,l,m){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=+f;g=+g;h=+h;i=+i;j=+j;k=k|0;l=+l;m=m|0;mc[a&0](b|0,c|0,d|0,e|0,+f,+g,+h,+i,+j,k|0,+l,m|0)}function XF(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=+d;e=e|0;f=f|0;return+nc[a&3](b|0,c|0,+d,e|0,f|0)}function YF(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;return+oc[a&1](b|0,c|0,d|0,e|0)}function ZF(a,b,c,d,e,f,g,h,i,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;return pc[a&3](b|0,c|0,d|0,e|0,f|0,g|0,h|0,i|0,j|0)|0}function _F(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=+e;qc[a&15](b|0,c|0,d|0,+e)}function $F(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;rc[a&127](b|0,c|0,d|0)}function aG(a){a=a|0;sc[a&3]()}function bG(a,b,c,d){a=a|0;b=b|0;c=c|0;d=+d;tc[a&7](b|0,c|0,+d)}function cG(a,b,c,d,e){a=a|0;b=b|0;c=+c;d=d|0;e=+e;return uc[a&1](b|0,+c,d|0,+e)|0}function dG(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;vc[a&127](b|0,c|0,d|0,e|0)}function eG(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;ba(0)}function fG(a,b){a=a|0;b=+b;ba(1)}function gG(a){a=a|0;ba(2)}function hG(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=+d;e=e|0;f=f|0;ba(3)}function iG(a,b){a=a|0;b=b|0;ba(4)}function jG(a,b,c,d,e,f,g,h,i,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;ba(5);return 0}function kG(a){a=a|0;ba(6);return 0}function lG(a,b,c,d){a=a|0;b=b|0;c=+c;d=d|0;ba(7)}function mG(a,b,c,d,e,f){a=a|0;b=+b;c=+c;d=d|0;e=e|0;f=f|0;ba(8)}function nG(a,b,c,d){a=a|0;b=+b;c=c|0;d=d|0;ba(9)}function oG(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;ba(10);return 0}function pG(a,b,c){a=a|0;b=+b;c=c|0;ba(11)}function qG(a,b,c,d,e,f,g,h){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;ba(12);return 0.0}function rG(a,b,c,d,e,f,g,h,i,j,k){a=a|0;b=b|0;c=c|0;d=d|0;e=+e;f=+f;g=+g;h=+h;i=i|0;j=j|0;k=+k;ba(13)}function sG(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;ba(14);return 0.0}function tG(a,b,c){a=a|0;b=b|0;c=c|0;ba(15);return 0}function uG(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;ba(16)}function vG(a,b,c){a=a|0;b=b|0;c=+c;ba(17);return 0}function wG(a){a=a|0;ba(18);return 0.0}function xG(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;ba(19);return 0}function yG(a,b,c,d,e,f){a=a|0;b=b|0;c=c|0;d=+d;e=e|0;f=f|0;ba(20);return 0.0}function zG(a,b,c,d,e){a=a|0;b=b|0;c=+c;d=d|0;e=e|0;ba(21)}function AG(a,b,c,d,e,f,g){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;ba(22)}function BG(a,b,c,d,e,f,g,h,i){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;ba(23)}function CG(a,b,c,d,e,f,g,h,i,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;ba(24)}function DG(a,b){a=a|0;b=b|0;ba(25);return 0}function EG(a,b,c){a=a|0;b=b|0;c=c|0;ba(26);return 0.0}function FG(a,b,c,d,e,f,g,h,i,j){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;j=j|0;ba(27);return 0.0}function GG(a,b,c,d,e){a=a|0;b=b|0;c=c|0;d=d|0;e=+e;ba(28)}function HG(a,b,c,d,e,f,g,h,i){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;ba(29);return 0.0}function IG(a,b){a=a|0;b=+b;ba(30);return 0.0}function JG(a,b,c,d,e,f,g,h,i,j,k,l){a=a|0;b=b|0;c=c|0;d=d|0;e=+e;f=+f;g=+g;h=+h;i=+i;j=j|0;k=+k;l=l|0;ba(31)}function KG(a,b,c,d,e){a=a|0;b=b|0;c=+c;d=d|0;e=e|0;ba(32);return 0.0}function LG(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;ba(33);return 0.0}function MG(a,b,c,d,e,f,g,h,i){a=a|0;b=b|0;c=c|0;d=d|0;e=e|0;f=f|0;g=g|0;h=h|0;i=i|0;ba(34);return 0}function NG(a,b,c,d){a=a|0;b=b|0;c=c|0;d=+d;ba(35)}function OG(a,b,c){a=a|0;b=b|0;c=c|0;ba(36)}function PG(){ba(37)}function QG(){Hb()}function RG(a,b,c){a=a|0;b=b|0;c=+c;ba(38)}function SG(a,b,c,d){a=a|0;b=+b;c=c|0;d=+d;ba(39);return 0}function TG(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;ba(40)}




// EMSCRIPTEN_END_FUNCS
var Jb=[eG,Vr,Qw,ay,_y,qz,pB,uB,nC,sC,vC,BC,LC,XC,eD,xD,RE,QE,NE,eG,eG,eG,eG,eG,eG,eG,eG,eG,eG,eG,eG,eG];var Kb=[fG,gp,fp,To,Lo,Fo,rp,Sq,Tq,Is,et,At,Av,Pv,bw,xx,xp,fG,fG,fG,fG,fG,fG,fG,fG,fG,fG,fG,fG,fG,fG,fG];var Lb=[gG,Kn,Ln,Mn,Pn,Qn,Vn,Wn,_n,$n,eo,fo,io,jo,xo,yo,po,Eo,Do,tu,uu,Go,vu,Jo,Ho,cp,Io,ep,Dp,Gp,Hp,Yp,Zp,Pp,Vp,iq,jq,cq,nq,mq,xq,oq,Cq,Jq,Kq,Eq,Pq,Oq,Yq,Zq,Nq,_q,kr,jr,Br,Kr,Lr,Rr,Sr,cs,js,ks,ls,ms,Es,Fs,Zs,Ys,it,jt,lt,mt,ot,pt,ut,vt,Dt,Et,Gt,Ht,Mt,Lt,Ut,au,ru,qu,Ku,Ju,Pu,Ou,Su,Hu,Uu,Fu,Wu,Du,Yu,_u,$u,cv,dv,fv,gv,kv,lv,jv,ov,uv,vv,xv,yv,yu,Dv,Gv,Fv,Iv,Xv,Yv,ew,fw,iw,jw,pw,qw,ow,rw,Jw,Kw,ex,fx,Uw,hx,sx,tx,Cx,Dx,Gx,Hx,Rx,Qx,hy,$x,iy,Zx,ky,Ux,my,ry,qy,wy,xy,zy,Ay,Cy,Dy,Fy,Gy,Iy,Jy,Ly,My,Oy,Py,Ry,Sy,Uy,Vy,Xy,Yy,az,bz,ez,dz,iz,hz,nz,oz,Bu,iv,rz,sz,Kt,cu,wz,xz,yz,zz,Ez,Dz,Iz,Jz,Lz,Mz,Rz,Qz,gA,hA,jA,kA,pA,oA,CA,BA,NA,OA,MA,PA,eB,dB,dp,tp,oB,nB,tB,sB,yB,xB,IB,JB,PB,QB,XB,WB,cC,eC,gC,hC,oC,pC,rC,qC,wC,xC,AC,zC,DC,GC,JC,IC,MC,OC,SC,RC,VC,UC,ZC,_C,bD,aD,dD,cD,fD,jD,mD,nD,lD,rD,wD,vD,BD,AD,OD,ND,YD,XD,vE,uE,zE,CE,AE,BE,DE,EE,tE,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG,gG];var Mb=[hG];var Nb=[iG,ao,bo,mo,oo,np,Po,mp,Vo,Wo,Xo,Mo,No,Ro,Qo,hp,Yo,Zo,_o,$o,ap,qp,Qp,Rp,dq,eq,zq,qq,sq,tq,uq,Aq,Fq,Gq,Uq,$q,ir,Gr,Hr,Zr,bs,ws,As,Bs,Gs,wp,ou,$s,bt,ct,xt,zt,Pt,Ot,Wt,wu,Mu,qv,Bv,Lv,Hv,Wv,aw,hw,lw,vw,cx,ux,wx,cy,gy,jy,ly,oy,cz,gu,HA,IA,dA,fA,Zz,Nw,gB,rB,wB,CB,RB,SB,NB,OB,ZB,uC,FC,HC,KC,QC,TC,hD,zD,cE,dE,iG,iG,iG,iG,iG,iG,iG,iG,iG,iG,iG,iG,iG,iG,iG,iG,iG,iG,iG,iG,iG,iG,iG,iG,iG,iG,iG];var Ob=[jG,pz,uz,jG];var Pb=[kG,Ec,zo,op,ip,jp,pp,_p,kq,wq,yq,Lq,gr,Er,Mr,_r,$r,qs,rs,ss,us,zs,up,Hs,zp,Ns,Ps,Qs,Ts,_B,dt,gt,yt,Bt,Bp,Ft,It,Xt,Zt,_t,$t,Nv,Ov,Rv,$v,cw,gw,kw,Lw,Mw,Aw,Bw,Ew,dx,gx,Xw,Yw,$w,vx,yx,Ex,Ix,dy,ey,ty,uy,vy,iu,Gz,$z,aA,bA,cA,eA,SA,VA,XA,YA,$A,vp,DB,EB,FB,TB,$D,UB,dC,pu,SD,wE,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG,kG];var Qb=[lG,uo,Wp,gq,Hq,Ir,lG,lG];var Rb=[mG];var Sb=[nG];var Tb=[oG,Sn,Vq,os,Qt,yy,By,Ey,Hy,Ky,Ny,Qy,Ty,Wy,Zy,GA,Hz,Xz,iD,oG,oG,oG,oG,oG,oG,oG,oG,oG,oG,oG,oG,oG];var Ub=[pG,Ds,aC,tt,Kv,_v,tA,lx,RA,mB,BB,pG,pG,pG,pG,pG];var Vb=[qG,lo];var Wb=[rG];var Xb=[sG,$y,qB,vB,tC,EC,NC,YC,gD,yD,sG,sG,sG,sG,sG,sG];var Yb=[tG,Pr,Rn,Ao,$p,lq,Mq,hr,Nr,ns,ys,Ap,at,Ct,Nt,St,Rt,Mv,dw,Hw,zx,sy,fu,JA,_z,Vz,GB,WD,nu,QD,RD,FE];var Zb=[uG,Ip,Xr,Xx,UE,TE,SE,uG];var _b=[vG,Vs,Gw,bx,bB,vG,vG,vG];var $b=[wG,lu,Js,ft,Qv,Bx,Fx,Jx,yp,wG,wG,wG,wG,wG,wG,wG];var ac=[xG,nw,mz,HB];var bc=[yG,ev,hv,yG];var cc=[zG];var dc=[AG,Iw];var ec=[BG,xr];var fc=[CG,ZD,_D,CG];var gc=[DG,Xn,go,ko,kp,lp,Ep,er,qA,Yt,Vt,bu,Xu,Zu,av,mv,sv,tv,hu,iA,lA,DG,DG,DG,DG,DG,DG,DG,DG,DG,DG,DG];var hc=[EG,Yn,ho,vo,Fp,Xp,hq,Dq,Iq,Jr,bv,nv,EG,EG,EG,EG];var ic=[FG,Ar,wr,FG];var jc=[GG,Nn];var kc=[HG,vr,yr,HG];var lc=[IG,ku];var mc=[JG];var nc=[KG,wv,zv,KG];var oc=[LG,zr];var pc=[MG,Tr,Sx,MG];var qc=[NG,On,qo,Vu,uw,tz,Cz,kD,qD,uD,NG,NG,NG,NG,NG,NG];var rc=[OG,Tn,wo,Uo,Cr,Dr,Ur,as,ps,ts,vs,xs,ju,Ks,Ls,Os,Ss,Ws,bC,ht,kt,nt,qt,Pw,rt,Cp,du,eu,pv,Cv,Vv,Tv,sw,tw,zw,xw,Dw,Ww,Tw,_w,Ax,ox,mx,nx,Vx,fy,ny,fz,jz,Az,Bz,Uz,Sz,Tz,Yz,rA,TA,WA,_A,fB,kB,iB,aE,bE,PC,oD,pD,sD,tD,Jt,Sw,Rw,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG,OG];var sc=[PG,QG,rE,sE];var tc=[RG,Bq,rq,vq,Wq,rv,RG,RG];var uc=[SG,Ko];var vc=[TG,Iu,Cu,Oo,So,Xq,ur,Wr,Yr,Cs,Ms,Ow,Rs,Us,YB,_s,wt,st,Tt,su,Qu,Ru,Tu,LA,KA,Jv,Zv,Uv,vA,yw,Cw,Fw,Vw,Zw,ax,ix,kx,px,rx,qx,Wx,_x,gz,kz,Kz,Nz,sA,QA,UA,ZA,aB,cB,lB,jB,zB,AB,VD,$B,fC,iC,WC,$C,HE,IE,KE,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG,TG];return{_emscripten_bind_btCylinderShape___destroy___0:Fn,_strlen:aF,_emscripten_bind_btDispatcherInfo_set_m_useContinuous_1:ed,_emscripten_bind_btCollisionObject_isActive_0:Se,_emscripten_bind_btVehicleTuning_set_m_frictionSlip_1:th,_emscripten_bind_btDiscreteDynamicsWorld_btDiscreteDynamicsWorld_4:af,_emscripten_bind_ClosestRayResultCallback_get_m_hitPointWorld_0:pi,_emscripten_bind_btQuaternion_setX_1:Ui,_emscripten_bind_btDispatcherInfo_get_m_timeOfImpact_0:bd,_emscripten_bind_btQuaternion_setZ_1:Wi,_emscripten_bind_LocalConvexResult_get_m_hitNormalLocal_0:Yl,_emscripten_bind_btKinematicCharacterController_setMaxSlope_1:jk,_emscripten_bind_btQuadWord_z_0:vn,_emscripten_bind_btTransform_setIdentity_0:$m,_emscripten_bind_btWheelInfo_get_m_suspensionRestLength1_0:rj,_emscripten_bind_btWheelInfo_get_m_suspensionStiffness_0:lj,_emscripten_bind_btRigidBodyConstructionInfo_get_m_angularDamping_0:Zd,_emscripten_bind_btCollisionDispatcher___destroy___0:ih,_emscripten_bind_btRigidBody_applyCentralImpulse_1:rm,_emscripten_bind_btDefaultMotionState_getWorldTransform_1:Yh,_emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_1:kf,_emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_3:mf,_emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_2:lf,_emscripten_bind_btVector3_op_mul_1:Gk,_emscripten_bind_btDynamicsWorld_rayTest_3:Ai,_emscripten_bind_btRaycastVehicle_updateWheelTransform_2:Ll,_emscripten_bind_btQuadWord_x_0:tn,_emscripten_bind_LocalConvexResult_get_m_hitPointLocal_0:_l,_emscripten_bind_btCollisionObject_isKinematicObject_0:Te,_emscripten_bind_ConvexResultCallback___destroy___0:Lf,_emscripten_bind_ClosestConvexResultCallback_set_m_hitNormalWorld_1:Jh,_emscripten_bind_btRigidBody_getCenterOfMassTransform_0:fm,_emscripten_bind_btGhostObject_isKinematicObject_0:sl,_emscripten_bind_btCapsuleShape___destroy___0:vd,_emscripten_bind_btCollisionObject_activate_1:Re,_emscripten_bind_btCollisionObject_activate_0:Qe,_emscripten_bind_btKinematicCharacterController_setUpAxis_1:Yj,_emscripten_bind_btDispatcherInfo_set_m_timeOfImpact_1:cd,_emscripten_bind_btCollisionDispatcher_btCollisionDispatcher_1:fh,_emscripten_bind_btVector3_setX_1:Ck,_emscripten_bind_btCollisionConfiguration___destroy___0:wd,_emscripten_bind_btQuaternion_btQuaternion_4:Oi,_emscripten_bind_btManifoldPoint_set_m_positionWorldOnB_1:Be,_emscripten_bind_btManifoldPoint_set_m_localPointB_1:ze,_emscripten_bind_btVector3_setZ_1:Ek,_emscripten_bind_btWheelInfo_get_m_maxSuspensionTravelCm_0:Dj,_emscripten_bind_btQuaternion_setValue_4:Pi,_emscripten_bind_btDispatcherInfo_set_m_dispatchFunc_1:ad,_emscripten_bind_LocalShapeInfo___destroy___0:Fl,_emscripten_bind_btQuadWord_setY_1:yn,_emscripten_bind_btRigidBody_isKinematicObject_0:Im,_emscripten_bind_btRigidBodyConstructionInfo_set_m_restitution_1:ee,_emscripten_bind_btDefaultMotionState_get_m_graphicsWorldTrans_0:_h,_emscripten_bind_btConeTwistConstraint_setDamping_1:jg,_emscripten_bind_btPairCachingGhostObject_btPairCachingGhostObject_0:Cd,_emscripten_bind_btCollisionWorld___destroy___0:sn,_emscripten_bind_RayResultCallback_get_m_collisionFilterGroup_0:ej,_emscripten_bind_btBoxShape_btBoxShape_1:bh,_emscripten_bind_btPersistentManifold_getBody1_0:Zg,_emscripten_bind_ClosestRayResultCallback_set_m_collisionObject_1:wi,_emscripten_bind_btKinematicCharacterController_setGravity_1:hk,_emscripten_bind_btConstraintSetting_set_m_impulseClamp_1:gl,_emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_5:Ie,_emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_3:He,_emscripten_bind_LocalShapeInfo_get_m_shapePart_0:Bl,_emscripten_bind_btWheelInfo_get_m_rollInfluence_0:pj,_emscripten_bind_btVector4_setValue_4:Mj,_emscripten_bind_btBvhTriangleMeshShape_setLocalScaling_1:Pc,_emscripten_bind_btDynamicsWorld_getDispatchInfo_0:Ci,_emscripten_bind_btVector3_length_0:yk,_emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_2:Af,_emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_1:zf,_emscripten_bind_ClosestConvexResultCallback_set_m_hitPointWorld_1:Lh,_emscripten_bind_RayResultCallback_set_m_collisionFilterMask_1:hj,_emscripten_bind_btPairCachingGhostObject___destroy___0:Ud,_emscripten_bind_btPairCachingGhostObject_activate_0:Hd,_emscripten_bind_btPairCachingGhostObject_activate_1:Id,_emscripten_bind_btPairCachingGhostObject_forceActivationState_1:Gd,_emscripten_bind_btDefaultMotionState___destroy___0:ai,_emscripten_bind_btDispatcherInfo_get_m_stepCount_0:Zc,_emscripten_bind_btRigidBodyConstructionInfo_set_m_angularDamping_1:_d,_emscripten_bind_btQuadWord_setW_1:An,_emscripten_bind_btRigidBodyConstructionInfo_get_m_friction_0:$d,_emscripten_bind_btCapsuleShapeX_btCapsuleShapeX_2:Ki,_emscripten_bind_btWheelInfo_get_m_maxSuspensionForce_0:Bj,_emscripten_bind_btRigidBody_setLinearFactor_1:km,_emscripten_bind_btDispatcherInfo_set_m_useConvexConservativeDistanceUtil_1:od,_emscripten_bind_btRaycastVehicle_setSteeringValue_2:Jl,_emscripten_bind_btPoint2PointConstraint___destroy___0:Vf,_emscripten_bind_btDiscreteDynamicsWorld_addConstraint_2:hf,_emscripten_bind_btDiscreteDynamicsWorld_addConstraint_1:gf,_emscripten_bind_btRigidBodyConstructionInfo_set_m_angularSleepingThreshold_1:ie,_malloc:XE,_emscripten_bind_btDispatcherInfo_get_m_useEpa_0:jd,_emscripten_bind_btTransform_btTransform_2:_m,_emscripten_bind_btTransform_btTransform_0:Zm,_emscripten_bind_btWheelInfo_set_m_wheelsRadius_1:uj,_emscripten_bind_btDispatcherInfo_set_m_enableSPU_1:id,_emscripten_bind_btRaycastVehicle_setCoordinateSystem_3:Rl,_emscripten_bind_btCollisionObject_setActivationState_1:Oe,_emscripten_bind_btPersistentManifold___destroy___0:ah,_emscripten_bind_btConstraintSetting_get_m_impulseClamp_0:fl,_emscripten_bind_btCylinderShapeZ___destroy___0:Ym,_emscripten_bind_btMatrix3x3___destroy___0:Ic,_emscripten_bind_ConvexResultCallback_hasHit_0:Ef,_emscripten_bind_btCollisionShape_calculateLocalInertia_2:_k,_emscripten_bind_btCollisionWorld_convexSweepTest_5:qn,_emscripten_bind_ClosestRayResultCallback_set_m_hitPointWorld_1:qi,_emscripten_bind_btCapsuleShapeX_calculateLocalInertia_2:Mi,_emscripten_bind_btConstraintSetting_set_m_damping_1:el,_emscripten_bind_btVehicleRaycaster___destroy___0:Ik,_emscripten_bind_btRigidBody_applyForce_2:mm,_emscripten_bind_btConeShapeZ_calculateLocalInertia_2:Fg,_emscripten_bind_btConstraintSetting_set_m_tau_1:cl,_emscripten_bind_btConvexHullShape_calculateLocalInertia_2:Vg,_emscripten_bind_btSphereShape_calculateLocalInertia_2:Lk,_emscripten_bind_btPoint2PointConstraint_get_m_setting_0:Tf,_emscripten_bind_LocalConvexResult_LocalConvexResult_5:Tl,_emscripten_bind_btGhostObject_setFriction_1:ul,_emscripten_bind_btPairCachingGhostObject_getWorldTransform_0:Nd,_emscripten_bind_btRigidBody_setFriction_1:Km,_emscripten_bind_LocalConvexResult_set_m_hitPointLocal_1:$l,_emscripten_bind_btGhostObject_setWorldTransform_1:yl,_emscripten_bind_btDiscreteDynamicsWorld_removeRigidBody_1:ff,_emscripten_bind_btConvexHullShape___destroy___0:Wg,_emscripten_bind_btDiscreteDynamicsWorld_getBroadphase_0:uf,_emscripten_bind_btVector4_setX_1:Rj,_emscripten_bind_btKinematicCharacterController_jump_0:gk,_emscripten_bind_btConeTwistConstraint_setMaxMotorImpulseNormalized_1:mg,_emscripten_bind_btConvexTriangleMeshShape_setLocalScaling_1:Bf,_emscripten_bind_btRigidBody_upcast_1:Am,_emscripten_bind_btCollisionObject_getWorldTransform_0:We,_emscripten_bind_btVector4_setZ_1:Tj,_emscripten_bind_btQuadWord_y_0:un,___cxa_can_catch:VE,_emscripten_bind_btTransform_getBasis_0:fn,_emscripten_bind_btPairCachingGhostObject_setFriction_1:Md,_emscripten_bind_btDispatcherInfo_set_m_useEpa_1:kd,_emscripten_bind_btCollisionDispatcher_getNumManifolds_0:gh,_emscripten_bind_ClosestRayResultCallback___destroy___0:xi,_emscripten_bind_btQuadWord_w_0:wn,_emscripten_bind_btCompoundShape___destroy___0:Bh,_emscripten_bind_btBvhTriangleMeshShape_calculateLocalInertia_2:Qc,_emscripten_bind_btGhostObject_btGhostObject_0:il,_emscripten_bind_btConeShape_btConeShape_2:rg,_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingFactor_1:se,_emscripten_bind_btManifoldPoint_set_m_localPointA_1:xe,_emscripten_bind_btCollisionObject_setCollisionShape_1:_e,_emscripten_bind_btWheelInfo___destroy___0:Fj,_emscripten_bind_btTransform_setRotation_1:cn,_emscripten_bind_btPairCachingGhostObject_getNumOverlappingObjects_0:Sd,_emscripten_bind_btPoint2PointConstraint_enableFeedback_1:Sf,_emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterGroup_1:si,_emscripten_bind_btAxisSweep3_btAxisSweep3_2:xd,_emscripten_bind_btAxisSweep3_btAxisSweep3_3:yd,_emscripten_bind_btBoxShape_calculateLocalInertia_2:dh,_emscripten_bind_btVector3_setY_1:Dk,_emscripten_bind_btAxisSweep3_btAxisSweep3_4:zd,_emscripten_bind_btAxisSweep3_btAxisSweep3_5:Ad,_emscripten_bind_btQuadWord_setX_1:xn,_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalLinearDampingThresholdSqr_0:ne,_emscripten_bind_btVehicleTuning_set_m_suspensionStiffness_1:lh,_emscripten_bind_btOverlappingPairCache___destroy___0:vk,_emscripten_bind_btConstraintSetting___destroy___0:hl,_emscripten_bind_RayResultCallback___destroy___0:kj,_emscripten_bind_btPersistentManifold_getBody0_0:Yg,_emscripten_bind_btConeShapeX_btConeShapeX_2:Hg,_emscripten_bind_btConeTwistConstraint_enableFeedback_1:pg,_emscripten_bind_btCapsuleShapeZ_setLocalScaling_1:_i,_emscripten_bind_btRigidBody_applyTorque_1:lm,_emscripten_bind_btSliderConstraint_setUpperLinLimit_1:ag,_emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_2:fg,_emscripten_bind_btConcaveShape___destroy___0:Ij,_emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_4:gg,_emscripten_bind_btQuaternion_x_0:Qi,_emscripten_bind_LocalConvexResult_set_m_hitNormalLocal_1:Zl,_emscripten_bind_btConcaveShape_setLocalScaling_1:Gj,_emscripten_bind_btDiscreteDynamicsWorld_getDispatchInfo_0:qf,_emscripten_bind_btConeShapeX_setLocalScaling_1:Ig,_emscripten_bind_btQuaternion_z_0:Si,_emscripten_bind_btConvexHullShape_btConvexHullShape_0:Rg,_emscripten_bind_btWheelInfo_set_m_maxSuspensionForce_1:Cj,_emscripten_bind_btConstraintSetting_get_m_damping_0:dl,_emscripten_bind_btGhostObject___destroy___0:Al,_emscripten_bind_btGhostObject_setContactProcessingThreshold_1:ml,_emscripten_bind_btRigidBody_applyCentralForce_1:nm,_emscripten_bind_btQuaternion___destroy___0:Yi,_emscripten_bind_btCollisionDispatcher_getManifoldByIndexInternal_1:hh,_emscripten_bind_btDefaultMotionState_btDefaultMotionState_2:Xh,_emscripten_bind_btDefaultMotionState_btDefaultMotionState_0:Th,_emscripten_bind_btDefaultMotionState_btDefaultMotionState_1:Wh,_emscripten_bind_btKinematicCharacterController_canJump_0:fk,_emscripten_bind_btRigidBody_isActive_0:Hm,_emscripten_bind_btRaycastVehicle_btRaycastVehicle_3:Hl,_emscripten_bind_btMotionState_setWorldTransform_1:Xf,_emscripten_bind_btCylinderShape_setLocalScaling_1:Dn,_emscripten_bind_btCollisionWorld_rayTest_3:jn,_emscripten_bind_btCompoundShape_calculateLocalInertia_2:Ah,_emscripten_bind_btCollisionWorld_getDispatchInfo_0:ln,_emscripten_bind_btRigidBody_setCollisionShape_1:Pm,_emscripten_bind_btConeShapeX___destroy___0:Kg,_emscripten_bind_btCollisionObject_getCollisionFlags_0:Xe,_emscripten_bind_btDispatcherInfo_set_m_enableSatConvex_1:gd,_emscripten_bind_btConeTwistConstraint_enableMotor_1:kg,_emscripten_bind_btWheelInfo_set_m_wheelsDampingCompression_1:wj,_emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_4:Xj,_emscripten_bind_btPairCachingGhostObject_setRestitution_1:Ld,_emscripten_bind_btBroadphaseInterface___destroy___0:Le,_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDampingFactor_1:me,_emscripten_bind_btCollisionObject_setContactProcessingThreshold_1:Ne,_emscripten_bind_btPersistentManifold_getNumContacts_0:_g,_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingFactor_0:re,_emscripten_bind_LocalConvexResult___destroy___0:cm,_emscripten_bind_btSequentialImpulseConstraintSolver___destroy___0:Wc,_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalLinearDampingThresholdSqr_1:oe,_emscripten_bind_btCollisionWorld_addCollisionObject_3:on,_emscripten_bind_btRigidBody_getCollisionFlags_0:Mm,_emscripten_bind_btCollisionShape_setLocalScaling_1:Zk,_emscripten_bind_ClosestConvexResultCallback_get_m_closestHitFraction_0:Qh,_emscripten_bind_LocalConvexResult_get_m_hitCollisionObject_0:Ul,_emscripten_bind_btMatrix3x3_setEulerZYX_3:Fc,_emscripten_bind_btDispatcherInfo_get_m_convexConservativeDistanceThreshold_0:pd,_emscripten_bind_btConvexHullShape_setLocalScaling_1:Ug,_emscripten_bind_RayResultCallback_get_m_collisionFilterMask_0:gj,_emscripten_bind_btCollisionWorld_getDispatcher_0:hn,_emscripten_bind_RayResultCallback_set_m_collisionFilterGroup_1:fj,_emscripten_bind_btTriangleMesh_btTriangleMesh_1:Mg,_i64Subtract:_E,_emscripten_bind_btRaycastVehicle_getWheelTransformWS_1:Kl,_emscripten_bind_btRigidBody_setDamping_2:im,_emscripten_bind_btDynamicsWorld_getDispatcher_0:zi,_emscripten_bind_btGhostObject_setCollisionFlags_1:xl,_emscripten_bind_btMatrix3x3_getRotation_1:Gc,_emscripten_bind_btConeTwistConstraint_setMaxMotorImpulse_1:lg,_emscripten_bind_btCylinderShapeX_setLocalScaling_1:Sm,_emscripten_bind_btDbvtBroadphase_btDbvtBroadphase_0:Sc,_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDamping_0:je,_emscripten_bind_btCompoundShape_setLocalScaling_1:zh,_emscripten_bind_btOverlappingPairCallback___destroy___0:dm,_emscripten_bind_btManifoldPoint_get_m_positionWorldOnB_0:Ae,_emscripten_bind_btVector4_setY_1:Sj,_emscripten_bind_btRigidBody_setContactProcessingThreshold_1:Cm,_emscripten_bind_btRigidBody_getLinearVelocity_0:um,_emscripten_bind_btRigidBody_applyImpulse_2:pm,_emscripten_bind_btConcaveShape_calculateLocalInertia_2:Hj,_emscripten_bind_btRigidBody_setWorldTransform_1:Om,_emscripten_bind_btRigidBody_setAngularVelocity_1:xm,_emscripten_bind_btConvexShape_setLocalScaling_1:vg,_emscripten_bind_btTriangleMeshShape_calculateLocalInertia_2:ci,_free:YE,_emscripten_bind_btPairCachingGhostObject_setContactProcessingThreshold_1:Ed,_emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterMask_0:ti,_emscripten_bind_RayResultCallback_hasHit_0:dj,_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingThresholdSqr_0:pe,_emscripten_bind_ClosestConvexResultCallback_get_m_convexToWorld_0:Gh,_emscripten_bind_btWheelInfo_get_m_frictionSlip_0:nj,_emscripten_bind_btConeShapeZ_setLocalScaling_1:Eg,_emscripten_bind_btPairCachingGhostObject_setActivationState_1:Fd,_emscripten_bind_btConvexTriangleMeshShape___destroy___0:Df,_emscripten_bind_btVehicleTuning_set_m_maxSuspensionTravelCm_1:rh,_emscripten_bind_btCylinderShapeZ_btCylinderShapeZ_1:Vm,_emscripten_bind_btRigidBody_getAngularVelocity_0:vm,_emscripten_bind_btCompoundShape_btCompoundShape_0:wh,_emscripten_bind_btCompoundShape_btCompoundShape_1:xh,_emscripten_bind_btOverlappingPairCache_setInternalGhostPairCallback_1:uk,_emscripten_bind_btStaticPlaneShape_btStaticPlaneShape_2:pk,_emscripten_bind_btDispatcherInfo_get_m_useContinuous_0:dd,_emscripten_bind_btRigidBody_updateInertiaTensor_0:tm,_emscripten_bind_btTransform_setOrigin_1:bn,_emscripten_bind_ClosestRayResultCallback_hasHit_0:ii,_emscripten_bind_btCompoundShape_addChildShape_2:yh,_emscripten_bind_btDispatcher___destroy___0:gi,_emscripten_bind_btVehicleTuning_get_m_suspensionCompression_0:mh,_emscripten_bind_btDiscreteDynamicsWorld___destroy___0:yf,_emscripten_bind_btConvexShape___destroy___0:xg,_memmove:dF,_emscripten_bind_btCapsuleShapeX_setLocalScaling_1:Li,_emscripten_bind_btCollisionObject_setRestitution_1:Ue,_emscripten_bind_btWheelInfo_get_m_wheelsDampingCompression_0:vj,_emscripten_bind_LocalConvexResult_get_m_hitFraction_0:am,_emscripten_bind_btDispatcherInfo_get_m_enableSPU_0:hd,_emscripten_bind_btQuaternion_w_0:Ti,_emscripten_bind_ConvexResultCallback_get_m_collisionFilterGroup_0:Ff,_emscripten_bind_btTransform_getRotation_0:en,_emscripten_bind_btHingeConstraint_btHingeConstraint_6:Tk,_emscripten_bind_btHingeConstraint_btHingeConstraint_7:Uk,_emscripten_bind_btHingeConstraint_btHingeConstraint_4:Rk,_emscripten_bind_btHingeConstraint_btHingeConstraint_5:Sk,_emscripten_bind_btHingeConstraint_btHingeConstraint_2:Pk,_emscripten_bind_btHingeConstraint_btHingeConstraint_3:Qk,_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingThresholdSqr_1:qe,_emscripten_bind_ClosestConvexResultCallback_get_m_hitNormalWorld_0:Ih,_emscripten_bind_btTypedConstraint___destroy___0:Jn,_emscripten_bind_btCylinderShapeX_btCylinderShapeX_1:Rm,_emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_3:ef,_emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_1:df,_emscripten_bind_btVector3_z_0:Bk,_emscripten_bind_btSphereShape_btSphereShape_1:Jk,_emscripten_bind_btQuaternion_y_0:Ri,_emscripten_bind_btCollisionWorld_addCollisionObject_1:mn,_emscripten_bind_btCollisionWorld_addCollisionObject_2:nn,_emscripten_bind_btRigidBody_setRestitution_1:Jm,_emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterGroup_1:Nh,_emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterGroup_0:Mh,_emscripten_bind_btRigidBody_getMotionState_0:ym,_emscripten_bind_btDefaultVehicleRaycaster_btDefaultVehicleRaycaster_1:bj,_emscripten_bind_ConcreteContactResultCallback_addSingleResult_7:Kc,_emscripten_bind_btSequentialImpulseConstraintSolver_btSequentialImpulseConstraintSolver_0:Vc,_emscripten_bind_btActionInterface___destroy___0:tk,_emscripten_bind_btDefaultMotionState_setWorldTransform_1:Zh,_emscripten_bind_btDefaultVehicleRaycaster___destroy___0:cj,_emscripten_bind_RayResultCallback_get_m_collisionObject_0:ij,_emscripten_bind_btPoint2PointConstraint_getPivotInA_0:Qf,_emscripten_bind_ClosestConvexResultCallback_get_m_convexFromWorld_0:Eh,_emscripten_bind_btCylinderShape_calculateLocalInertia_2:En,_emscripten_bind_btGhostObject_setRestitution_1:tl,_emscripten_bind_btDynamicsWorld_addCollisionObject_1:Di,_emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterMask_0:Oh,_emscripten_bind_btDynamicsWorld_addCollisionObject_3:Fi,_emscripten_bind_btDynamicsWorld_addCollisionObject_2:Ei,_emscripten_bind_btDiscreteDynamicsWorld_getDispatcher_0:nf,_emscripten_bind_btKinematicCharacterController_setUseGhostSweepTest_1:mk,_emscripten_bind_btVector4_op_mul_1:Uj,_emscripten_bind_btCylinderShape_btCylinderShape_1:Cn,_emscripten_bind_btVector3___destroy___0:Hk,_emscripten_bind_btRigidBody_setAngularFactor_1:zm,_emscripten_bind_btCylinderShapeZ_calculateLocalInertia_2:Xm,_emscripten_bind_LocalShapeInfo_set_m_triangleIndex_1:El,_emscripten_bind_btMotionState_getWorldTransform_1:Wf,_emscripten_bind_btDynamicsWorld_getBroadphase_0:Gi,_emscripten_bind_btDispatcherInfo_set_m_convexConservativeDistanceThreshold_1:qd,_emscripten_bind_btVector3_x_0:zk,___cxa_is_pointer_type:WE,_emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_3:Vd,_emscripten_bind_btCollisionObject_getCollisionShape_0:Me,_emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_4:Wd,_emscripten_bind_btManifoldPoint___destroy___0:Ge,_emscripten_bind_btRigidBodyConstructionInfo_set_m_rollingFriction_1:ce,_emscripten_bind_btVector4_length_0:Nj,_emscripten_bind_btDefaultMotionState_set_m_graphicsWorldTrans_1:$h,_emscripten_bind_btCylinderShapeZ_setLocalScaling_1:Wm,_emscripten_bind_ClosestConvexResultCallback___destroy___0:Sh,_emscripten_bind_btDefaultCollisionConstructionInfo___destroy___0:Ok,_emscripten_bind_btCollisionObject_setFriction_1:Ve,_emscripten_bind_btDefaultCollisionConfiguration___destroy___0:Ag,_emscripten_bind_btRigidBody_setMassProps_2:jm,_emscripten_bind_btVector3_setValue_3:Fk,_emscripten_bind_btGhostObject_getCollisionFlags_0:wl,_emscripten_bind_btCapsuleShapeX___destroy___0:Ni,_emscripten_bind_btHingeConstraint_setLimit_4:Vk,_emscripten_bind_btHingeConstraint_setLimit_5:Wk,_emscripten_bind_btWheelInfo_set_m_maxSuspensionTravelCm_1:Ej,_emscripten_bind_btConeShape_setLocalScaling_1:sg,_emscripten_bind_btGhostObject_getNumOverlappingObjects_0:jl,_emscripten_bind_btGhostObject_getCollisionShape_0:ll,_emscripten_bind_btRigidBodyConstructionInfo_set_m_friction_1:ae,_emscripten_bind_btPersistentManifold_getContactPoint_1:$g,_emscripten_bind_btConeShapeX_calculateLocalInertia_2:Jg,_emscripten_bind_btGhostObject_activate_0:pl,_emscripten_bind_btGhostObject_activate_1:ql,_emscripten_bind_btManifoldPoint_getPositionWorldOnB_0:ve,_emscripten_bind_btManifoldPoint_get_m_positionWorldOnA_0:Ce,_emscripten_bind_btConeShapeZ_btConeShapeZ_2:Dg,_emscripten_bind_btSphereShape___destroy___0:Mk,_emscripten_bind_btSliderConstraint_setUpperAngLimit_1:cg,_emscripten_bind_btDynamicsWorld_contactPairTest_3:Ii,_emscripten_bind_btCollisionWorld_getPairCache_0:kn,_emscripten_bind_btConeTwistConstraint_setMotorTarget_1:ng,_emscripten_bind_ClosestConvexResultCallback_set_m_convexFromWorld_1:Fh,_emscripten_bind_btWheelInfo_set_m_rollInfluence_1:qj,_emscripten_bind_btDefaultCollisionConstructionInfo_btDefaultCollisionConstructionInfo_0:Nk,_emscripten_bind_btGhostObject_forceActivationState_1:ol,_emscripten_bind_ConcreteContactResultCallback_ConcreteContactResultCallback_0:Jc,_emscripten_bind_VoidPtr___destroy___0:Uc,_emscripten_bind_btSliderConstraint_setLowerAngLimit_1:bg,_emscripten_bind_ClosestConvexResultCallback_ClosestConvexResultCallback_2:Ch,_emscripten_bind_ClosestRayResultCallback_get_m_rayFromWorld_0:ji,_emscripten_bind_btRaycastVehicle_getRigidBody_0:Ol,_emscripten_bind_btWheelInfo_get_m_steering_0:zj,_emscripten_bind_btConstraintSetting_get_m_tau_0:bl,_emscripten_bind_btSliderConstraint___destroy___0:eg,_emscripten_bind_btCollisionShape___destroy___0:$k,_emscripten_bind_ConvexResultCallback_get_m_closestHitFraction_0:Jf,_emscripten_bind_btDispatcherInfo_get_m_dispatchFunc_0:$c,_emscripten_bind_btRigidBodyConstructionInfo_get_m_rollingFriction_0:be,_emscripten_bind_btPairCachingGhostObject_setCollisionShape_1:Rd,_emscripten_bind_btKinematicCharacterController_warp_1:$j,_emscripten_bind_btAxisSweep3___destroy___0:Bd,_emscripten_bind_btTriangleMesh___destroy___0:Qg,_emscripten_bind_btKinematicCharacterController_preStep_1:ak,_emscripten_bind_btRaycastVehicle_applyEngineForce_2:Il,_emscripten_bind_btRaycastVehicle_setBrake_2:Ql,_emscripten_bind_ConcreteContactResultCallback___destroy___0:Lc,_emscripten_bind_btCollisionObject___destroy___0:$e,_emscripten_bind_btVehicleTuning_set_m_suspensionDamping_1:ph,_emscripten_bind_btRigidBodyConstructionInfo_set_m_linearSleepingThreshold_1:ge,_emscripten_bind_btConeTwistConstraint_setMotorTargetInConstraintSpace_1:og,_emscripten_bind_btDispatcherInfo_set_m_timeStep_1:Yc,_emscripten_bind_btVector3_btVector3_3:xk,_emscripten_bind_btVector3_btVector3_0:wk,_emscripten_bind_btBoxShape___destroy___0:eh,_emscripten_bind_btDiscreteDynamicsWorld_getGravity_0:cf,_emscripten_bind_ClosestConvexResultCallback_get_m_hitPointWorld_0:Kh,_emscripten_bind_btVehicleTuning_get_m_suspensionDamping_0:oh,_emscripten_bind_btConeTwistConstraint___destroy___0:qg,_emscripten_bind_btQuadWord___destroy___0:Bn,_emscripten_bind_ClosestRayResultCallback_set_m_rayFromWorld_1:ki,_emscripten_bind_btRigidBody_setCenterOfMassTransform_1:gm,_emscripten_bind_btConstraintSolver___destroy___0:Gl,_emscripten_bind_btDbvtBroadphase___destroy___0:Tc,_emscripten_bind_btCapsuleShape_btCapsuleShape_2:sd,_emscripten_bind_btTypedConstraint_enableFeedback_1:In,_emscripten_bind_btQuadWord_setZ_1:zn,_emscripten_bind_btCapsuleShape_setLocalScaling_1:td,_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDampingFactor_0:le,_emscripten_bind_btTriangleMeshShape_setLocalScaling_1:bi,_emscripten_bind_ConvexResultCallback_set_m_closestHitFraction_1:Kf,_emscripten_bind_btPersistentManifold_btPersistentManifold_0:Xg,_emscripten_bind_ConvexResultCallback_get_m_collisionFilterMask_0:Hf,_emscripten_bind_ClosestRayResultCallback_ClosestRayResultCallback_2:hi,_emscripten_bind_btVector4___destroy___0:Vj,_emscripten_bind_btPairCachingGhostObject_isKinematicObject_0:Kd,_emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterMask_1:ui,_i64Add:bF,_emscripten_bind_btStaticPlaneShape_calculateLocalInertia_2:rk,_emscripten_bind_btVehicleTuning_set_m_maxSuspensionForce_1:vh,_emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_0:yg,_emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_1:zg,_emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_3:Wj,_emscripten_bind_btRigidBodyConstructionInfo_get_m_angularSleepingThreshold_0:he,_emscripten_bind_btPoint2PointConstraint_getPivotInB_0:Rf,_emscripten_bind_btKinematicCharacterController_playerStep_2:bk,_emscripten_bind_btDispatcherInfo___destroy___0:rd,_emscripten_bind_btStaticPlaneShape_setLocalScaling_1:qk,_emscripten_bind_btConvexTriangleMeshShape_calculateLocalInertia_2:Cf,_emscripten_bind_ContactResultCallback_addSingleResult_7:Bg,_emscripten_bind_btGhostObject_getWorldTransform_0:vl,_emscripten_bind_btDiscreteDynamicsWorld_getPairCache_0:pf,_emscripten_bind_LocalConvexResult_set_m_hitFraction_1:bm,_emscripten_bind_btCapsuleShapeZ_calculateLocalInertia_2:$i,_emscripten_bind_btDispatcherInfo_get_m_timeStep_0:Xc,_emscripten_bind_btVehicleTuning_set_m_suspensionCompression_1:nh,_emscripten_bind_btDynamicsWorld___destroy___0:Ji,_emscripten_bind_btMotionState___destroy___0:Yf,_emscripten_bind_btCollisionObject_setCollisionFlags_1:Ye,_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_1:rf,_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_2:sf,_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_3:tf,_emscripten_bind_btWheelInfo_set_m_suspensionStiffness_1:mj,_emscripten_bind_btRaycastVehicle_getNumWheels_0:Nl,_emscripten_bind_btDispatcher_getManifoldByIndexInternal_1:fi,_emscripten_bind_btWheelInfo_set_m_steering_1:Aj,_emscripten_bind_btPairCachingGhostObject_setWorldTransform_1:Qd,_emscripten_bind_btConeTwistConstraint_setAngularOnly_1:ig,_emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_4:Nf,_emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_2:Mf,_emscripten_bind_btKinematicCharacterController_setJumpSpeed_1:dk,_emscripten_bind_ConvexResultCallback_set_m_collisionFilterGroup_1:Gf,_emscripten_bind_btPairCachingGhostObject_getOverlappingObject_1:Td,_emscripten_bind_btRigidBodyConstructionInfo___destroy___0:te,_emscripten_bind_btRigidBody_getWorldTransform_0:Lm,_emscripten_bind_btPoint2PointConstraint_setPivotA_1:Of,_emscripten_bind_ClosestConvexResultCallback_set_m_convexToWorld_1:Hh,_memcpy:cF,_emscripten_bind_btCapsuleShape_calculateLocalInertia_2:ud,_emscripten_bind_btVector3_y_0:Ak,_emscripten_bind_btVehicleTuning_get_m_maxSuspensionForce_0:uh,_emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_2:Mc,_emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_3:Oc,_emscripten_bind_LocalShapeInfo_get_m_triangleIndex_0:Dl,_emscripten_bind_btGhostObject_setCollisionShape_1:zl,_emscripten_bind_btDispatcherInfo_set_m_allowedCcdPenetration_1:md,_emscripten_bind_btQuaternion_setW_1:Xi,_emscripten_bind_btDiscreteDynamicsWorld_setGravity_1:bf,_emscripten_bind_btGhostObject_isActive_0:rl,_emscripten_bind_btVector4_z_0:Qj,_emscripten_bind_btCollisionObject_forceActivationState_1:Pe,_emscripten_bind_btKinematicCharacterController_onGround_0:nk,_emscripten_bind_btRaycastVehicle_getWheelInfo_1:Pl,_emscripten_bind_btConeTwistConstraint_setLimit_2:hg,_emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterMask_1:Ph,_emscripten_bind_btRigidBody___destroy___0:Qm,_emscripten_bind_btStridingMeshInterface___destroy___0:Ke,_emscripten_bind_btRigidBody_setSleepingThresholds_2:hm,_emscripten_bind_btCollisionObject_setWorldTransform_1:Ze,_emscripten_bind_LocalConvexResult_get_m_localShapeInfo_0:Wl,_emscripten_bind_btManifoldPoint_get_m_localPointA_0:we,_emscripten_bind_btRigidBodyConstructionInfo_get_m_linearDamping_0:Xd,_emscripten_bind_btCollisionWorld_getBroadphase_0:pn,_emscripten_bind_btDispatcher_getNumManifolds_0:ei,_emscripten_bind_btRigidBodyConstructionInfo_get_m_linearSleepingThreshold_0:fe,_emscripten_bind_btRigidBody_activate_1:Gm,_emscripten_bind_btRigidBody_activate_0:Fm,_emscripten_bind_btRaycastVehicle___destroy___0:Sl,_emscripten_bind_btGhostObject_setActivationState_1:nl,_emscripten_bind_btCollisionWorld_contactPairTest_3:rn,_emscripten_bind_btCylinderShapeX___destroy___0:Um,_emscripten_bind_btManifoldPoint_getPositionWorldOnA_0:ue,_emscripten_bind_ContactResultCallback___destroy___0:Cg,_emscripten_bind_btDispatcherInfo_set_m_stepCount_1:_c,_emscripten_bind_btVector4_x_0:Oj,_emscripten_bind_btPairCachingGhostObject_setCollisionFlags_1:Pd,_emscripten_bind_btKinematicCharacterController_getGhostObject_0:lk,_emscripten_bind_btRigidBody_btRigidBody_1:em,_emscripten_bind_btTriangleMeshShape___destroy___0:di,_emscripten_bind_btKinematicCharacterController_setWalkDirection_1:Zj,_emscripten_bind_btRigidBodyConstructionInfo_get_m_restitution_0:de,_emscripten_bind_btVehicleTuning_get_m_suspensionStiffness_0:kh,_emscripten_bind_btManifoldPoint_set_m_normalWorldOnB_1:Fe,_emscripten_bind_btKinematicCharacterController_getGravity_0:ik,_emscripten_bind_btDiscreteDynamicsWorld_addAction_1:xf,_emscripten_bind_btQuaternion_setY_1:Vi,_emscripten_bind_btConeShape_calculateLocalInertia_2:tg,_emscripten_bind_btCylinderShapeX_calculateLocalInertia_2:Tm,_emscripten_bind_ConvexResultCallback_set_m_collisionFilterMask_1:If,_llvm_bswap_i32:eF,_emscripten_bind_btSphereShape_setLocalScaling_1:Kk,_emscripten_bind_btVector4_w_0:Lj,_emscripten_bind_btManifoldPoint_get_m_normalWorldOnB_0:Ee,_emscripten_bind_btBvhTriangleMeshShape___destroy___0:Rc,_emscripten_bind_ClosestRayResultCallback_get_m_rayToWorld_0:li,_emscripten_bind_ClosestConvexResultCallback_set_m_closestHitFraction_1:Rh,_emscripten_bind_btDiscreteDynamicsWorld_removeConstraint_1:jf,_emscripten_bind_btVector4_y_0:Pj,_emscripten_bind_btGeneric6DofConstraint___destroy___0:Je,_emscripten_bind_btVehicleTuning_get_m_maxSuspensionTravelCm_0:qh,_emscripten_bind_btConvexHullShape_addPoint_1:Sg,_emscripten_bind_btConvexHullShape_addPoint_2:Tg,_emscripten_bind_btTransform_getOrigin_0:dn,_emscripten_bind_btHingeConstraint___destroy___0:Yk,_emscripten_bind_btHingeConstraint_enableFeedback_1:Xk,_emscripten_bind_btConvexShape_calculateLocalInertia_2:wg,_memset:$E,_emscripten_bind_ClosestRayResultCallback_get_m_hitNormalWorld_0:ni,_emscripten_bind_btTriangleMesh_btTriangleMesh_0:Lg,_emscripten_bind_btPairCachingGhostObject_getCollisionShape_0:Dd,_emscripten_bind_btTriangleMesh_btTriangleMesh_2:Ng,_emscripten_bind_btTransform___destroy___0:gn,_emscripten_bind_btWheelInfo_set_m_frictionSlip_1:oj,_emscripten_bind_btRigidBody_getCollisionShape_0:Bm,_emscripten_bind_btManifoldPoint_set_m_positionWorldOnA_1:De,_emscripten_bind_btWheelInfo_get_m_wheelsDampingRelaxation_0:xj,_emscripten_bind_btManifoldPoint_get_m_localPointB_0:ye,_emscripten_bind_btDiscreteDynamicsWorld_contactPairTest_3:wf,_emscripten_bind_btSliderConstraint_setLowerLinLimit_1:$f,_emscripten_bind_btPoint2PointConstraint_set_m_setting_1:Uf,_emscripten_bind_btWheelInfo_get_m_wheelsRadius_0:tj,_emscripten_bind_btRigidBody_setLinearVelocity_1:wm,_emscripten_bind_btVehicleTuning_btVehicleTuning_0:jh,_emscripten_bind_RayResultCallback_set_m_collisionObject_1:jj,_emscripten_bind_ClosestRayResultCallback_set_m_rayToWorld_1:mi,_emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterGroup_0:ri,_emscripten_bind_btWheelInfo_set_m_wheelsDampingRelaxation_1:yj,_emscripten_bind_btDynamicsWorld_addAction_1:yi,_emscripten_bind_btPairCachingGhostObject_getCollisionFlags_0:Od,_emscripten_bind_btRigidBodyConstructionInfo_set_m_linearDamping_1:Yd,_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDamping_1:ke,_emscripten_bind_btKinematicCharacterController_setFallSpeed_1:ck,_emscripten_bind_btRigidBody_setActivationState_1:Dm,_emscripten_bind_ClosestConvexResultCallback_hasHit_0:Dh,_emscripten_bind_btCapsuleShapeZ___destroy___0:aj,_emscripten_bind_LocalShapeInfo_set_m_shapePart_1:Cl,_emscripten_bind_ClosestRayResultCallback_get_m_collisionObject_0:vi,_emscripten_bind_btTriangleMesh_addTriangle_3:Og,_emscripten_bind_btGhostObject_getOverlappingObject_1:kl,_emscripten_bind_btTriangleMesh_addTriangle_4:Pg,_emscripten_bind_btRigidBody_applyTorqueImpulse_1:om,_emscripten_bind_btRigidBody_setCollisionFlags_1:Nm,_emscripten_bind_btWheelInfo_set_m_suspensionRestLength1_1:sj,_emscripten_bind_btConeShape___destroy___0:ug,_emscripten_bind_btCapsuleShapeZ_btCapsuleShapeZ_2:Zi,_emscripten_bind_btSliderConstraint_btSliderConstraint_5:_f,_emscripten_bind_btSliderConstraint_btSliderConstraint_3:Zf,_emscripten_bind_btDispatcherInfo_get_m_allowedCcdPenetration_0:ld,_emscripten_bind_btDynamicsWorld_convexSweepTest_5:Hi,_emscripten_bind_btRigidBody_forceActivationState_1:Em,_emscripten_bind_btPoint2PointConstraint_setPivotB_1:Pf,_emscripten_bind_btGhostPairCallback___destroy___0:Hn,_emscripten_bind_btKinematicCharacterController_getMaxSlope_0:kk,_emscripten_bind_btSliderConstraint_enableFeedback_1:dg,_emscripten_bind_btRaycastVehicle_addWheel_7:Ml,_emscripten_bind_btPairCachingGhostObject_isActive_0:Jd,_emscripten_bind_LocalConvexResult_set_m_localShapeInfo_1:Xl,_emscripten_bind_btStaticPlaneShape___destroy___0:sk,_emscripten_bind_btDispatcherInfo_get_m_useConvexConservativeDistanceUtil_0:nd,_emscripten_bind_btBoxShape_setLocalScaling_1:ch,_emscripten_bind_btConeShapeZ___destroy___0:Gg,_emscripten_bind_btDynamicsWorld_getPairCache_0:Bi,_emscripten_bind_btDiscreteDynamicsWorld_convexSweepTest_5:vf,_emscripten_bind_btKinematicCharacterController_setVelocityForTimeInterval_2:_j,_emscripten_bind_btVector4_btVector4_0:Jj,_emscripten_bind_btDispatcherInfo_get_m_enableSatConvex_0:fd,_emscripten_bind_btVector4_btVector4_4:Kj,_emscripten_bind_btKinematicCharacterController___destroy___0:ok,_emscripten_bind_LocalConvexResult_set_m_hitCollisionObject_1:Vl,_emscripten_bind_btConstraintSetting_btConstraintSetting_0:al,_emscripten_bind_btDiscreteDynamicsWorld_rayTest_3:of,_emscripten_bind_btGhostPairCallback_btGhostPairCallback_0:Gn,_emscripten_bind_btKinematicCharacterController_setMaxJumpHeight_1:ek,_emscripten_bind_ClosestRayResultCallback_set_m_hitNormalWorld_1:oi,_emscripten_bind_btVehicleTuning_get_m_frictionSlip_0:sh,__GLOBAL__I_a:pE,runPostSets:ZE,stackAlloc:wc,stackSave:xc,stackRestore:yc,setThrew:zc,setTempRet0:Cc,getTempRet0:Dc,dynCall_viiiii:rF,dynCall_vid:sF,dynCall_vi:tF,dynCall_viiidii:uF,dynCall_vii:vF,dynCall_iiiiiiiiiii:wF,dynCall_ii:xF,dynCall_viidi:yF,dynCall_viddiii:zF,dynCall_vidii:AF,dynCall_iiiii:BF,dynCall_vidi:CF,dynCall_diiiiiiii:DF,dynCall_viiiiddddiid:EF,dynCall_diiiii:FF,dynCall_iiii:GF,dynCall_viiiiii:HF,dynCall_iiid:IF,dynCall_di:JF,dynCall_iiiiiii:KF,dynCall_diiidii:LF,dynCall_viidii:MF,dynCall_viiiiiii:NF,dynCall_viiiiiiiii:OF,dynCall_viiiiiiiiii:PF,dynCall_iii:QF,dynCall_diii:RF,dynCall_diiiiiiiiii:SF,dynCall_viiiid:TF,dynCall_diiiiiiiii:UF,dynCall_did:VF,dynCall_viiiidddddidi:WF,dynCall_diidii:XF,dynCall_diiii:YF,dynCall_iiiiiiiiii:ZF,dynCall_viiid:_F,dynCall_viii:$F,dynCall_v:aG,dynCall_viid:bG,dynCall_iidid:cG,dynCall_viiii:dG}
// EMSCRIPTEN_END_ASM

})({"Math":Math,"Int8Array":Int8Array,"Int16Array":Int16Array,"Int32Array":Int32Array,"Uint8Array":Uint8Array,"Uint16Array":Uint16Array,"Uint32Array":Uint32Array,"Float32Array":Float32Array,"Float64Array":Float64Array},{"abort":abort,"assert":assert,"min":Math_min,"invoke_viiiii":invoke_viiiii,"invoke_vid":invoke_vid,"invoke_vi":invoke_vi,"invoke_viiidii":invoke_viiidii,"invoke_vii":invoke_vii,"invoke_iiiiiiiiiii":invoke_iiiiiiiiiii,"invoke_ii":invoke_ii,"invoke_viidi":invoke_viidi,"invoke_viddiii":invoke_viddiii,"invoke_vidii":invoke_vidii,"invoke_iiiii":invoke_iiiii,"invoke_vidi":invoke_vidi,"invoke_diiiiiiii":invoke_diiiiiiii,"invoke_viiiiddddiid":invoke_viiiiddddiid,"invoke_diiiii":invoke_diiiii,"invoke_iiii":invoke_iiii,"invoke_viiiiii":invoke_viiiiii,"invoke_iiid":invoke_iiid,"invoke_di":invoke_di,"invoke_iiiiiii":invoke_iiiiiii,"invoke_diiidii":invoke_diiidii,"invoke_viidii":invoke_viidii,"invoke_viiiiiii":invoke_viiiiiii,"invoke_viiiiiiiii":invoke_viiiiiiiii,"invoke_viiiiiiiiii":invoke_viiiiiiiiii,"invoke_iii":invoke_iii,"invoke_diii":invoke_diii,"invoke_diiiiiiiiii":invoke_diiiiiiiiii,"invoke_viiiid":invoke_viiiid,"invoke_diiiiiiiii":invoke_diiiiiiiii,"invoke_did":invoke_did,"invoke_viiiidddddidi":invoke_viiiidddddidi,"invoke_diidii":invoke_diidii,"invoke_diiii":invoke_diiii,"invoke_iiiiiiiiii":invoke_iiiiiiiiii,"invoke_viiid":invoke_viiid,"invoke_viii":invoke_viii,"invoke_v":invoke_v,"invoke_viid":invoke_viid,"invoke_iidid":invoke_iidid,"invoke_viiii":invoke_viiii,"_emscripten_asm_const_double":_emscripten_asm_const_double,"_cosf":_cosf,"_send":_send,"_sqrtf":_sqrtf,"_fmod":_fmod,"___cxa_guard_acquire":___cxa_guard_acquire,"___setErrNo":___setErrNo,"_vfprintf":_vfprintf,"_atan2f":_atan2f,"_fmodf":_fmodf,"___cxa_guard_release":___cxa_guard_release,"_pwrite":_pwrite,"_acosf":_acosf,"_asinf":_asinf,"_fabsf":_fabsf,"_sbrk":_sbrk,"_llvm_pow_f32":_llvm_pow_f32,"___cxa_begin_catch":___cxa_begin_catch,"_sinf":_sinf,"_fileno":_fileno,"___resumeException":___resumeException,"___cxa_find_matching_catch":___cxa_find_matching_catch,"_sysconf":_sysconf,"__reallyNegative":__reallyNegative,"_pthread_getspecific":_pthread_getspecific,"__ZSt18uncaught_exceptionv":__ZSt18uncaught_exceptionv,"_emscripten_memcpy_big":_emscripten_memcpy_big,"_pthread_once":_pthread_once,"_pthread_key_create":_pthread_key_create,"_write":_write,"___errno_location":___errno_location,"_pthread_setspecific":_pthread_setspecific,"_fputc":_fputc,"___cxa_throw":___cxa_throw,"_abort":_abort,"___cxa_allocate_exception":___cxa_allocate_exception,"_fwrite":_fwrite,"_time":_time,"_fprintf":_fprintf,"_gettimeofday":_gettimeofday,"__formatString":__formatString,"_llvm_trap":_llvm_trap,"___cxa_pure_virtual":___cxa_pure_virtual,"STACKTOP":STACKTOP,"STACK_MAX":STACK_MAX,"tempDoublePtr":tempDoublePtr,"ABORT":ABORT,"cttz_i8":cttz_i8,"ctlz_i8":ctlz_i8,"NaN":NaN,"Infinity":Infinity,"_stderr":_stderr},buffer);var _emscripten_bind_btCylinderShape___destroy___0=Module["_emscripten_bind_btCylinderShape___destroy___0"]=asm["_emscripten_bind_btCylinderShape___destroy___0"];var _strlen=Module["_strlen"]=asm["_strlen"];var _emscripten_bind_btDispatcherInfo_set_m_useContinuous_1=Module["_emscripten_bind_btDispatcherInfo_set_m_useContinuous_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_useContinuous_1"];var _emscripten_bind_btCollisionObject_isActive_0=Module["_emscripten_bind_btCollisionObject_isActive_0"]=asm["_emscripten_bind_btCollisionObject_isActive_0"];var _emscripten_bind_btVehicleTuning_set_m_frictionSlip_1=Module["_emscripten_bind_btVehicleTuning_set_m_frictionSlip_1"]=asm["_emscripten_bind_btVehicleTuning_set_m_frictionSlip_1"];var _emscripten_bind_btDiscreteDynamicsWorld_btDiscreteDynamicsWorld_4=Module["_emscripten_bind_btDiscreteDynamicsWorld_btDiscreteDynamicsWorld_4"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_btDiscreteDynamicsWorld_4"];var _emscripten_bind_ClosestRayResultCallback_get_m_hitPointWorld_0=Module["_emscripten_bind_ClosestRayResultCallback_get_m_hitPointWorld_0"]=asm["_emscripten_bind_ClosestRayResultCallback_get_m_hitPointWorld_0"];var _emscripten_bind_btQuaternion_setX_1=Module["_emscripten_bind_btQuaternion_setX_1"]=asm["_emscripten_bind_btQuaternion_setX_1"];var _emscripten_bind_btDispatcherInfo_get_m_timeOfImpact_0=Module["_emscripten_bind_btDispatcherInfo_get_m_timeOfImpact_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_timeOfImpact_0"];var _emscripten_bind_btQuaternion_setZ_1=Module["_emscripten_bind_btQuaternion_setZ_1"]=asm["_emscripten_bind_btQuaternion_setZ_1"];var _emscripten_bind_LocalConvexResult_get_m_hitNormalLocal_0=Module["_emscripten_bind_LocalConvexResult_get_m_hitNormalLocal_0"]=asm["_emscripten_bind_LocalConvexResult_get_m_hitNormalLocal_0"];var _emscripten_bind_btKinematicCharacterController_setMaxSlope_1=Module["_emscripten_bind_btKinematicCharacterController_setMaxSlope_1"]=asm["_emscripten_bind_btKinematicCharacterController_setMaxSlope_1"];var _emscripten_bind_btQuadWord_z_0=Module["_emscripten_bind_btQuadWord_z_0"]=asm["_emscripten_bind_btQuadWord_z_0"];var _emscripten_bind_btTransform_setIdentity_0=Module["_emscripten_bind_btTransform_setIdentity_0"]=asm["_emscripten_bind_btTransform_setIdentity_0"];var _emscripten_bind_btWheelInfo_get_m_suspensionRestLength1_0=Module["_emscripten_bind_btWheelInfo_get_m_suspensionRestLength1_0"]=asm["_emscripten_bind_btWheelInfo_get_m_suspensionRestLength1_0"];var _emscripten_bind_btWheelInfo_get_m_suspensionStiffness_0=Module["_emscripten_bind_btWheelInfo_get_m_suspensionStiffness_0"]=asm["_emscripten_bind_btWheelInfo_get_m_suspensionStiffness_0"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_angularDamping_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_angularDamping_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_angularDamping_0"];var _emscripten_bind_btCollisionDispatcher___destroy___0=Module["_emscripten_bind_btCollisionDispatcher___destroy___0"]=asm["_emscripten_bind_btCollisionDispatcher___destroy___0"];var _emscripten_bind_btRigidBody_applyCentralImpulse_1=Module["_emscripten_bind_btRigidBody_applyCentralImpulse_1"]=asm["_emscripten_bind_btRigidBody_applyCentralImpulse_1"];var _emscripten_bind_btDefaultMotionState_getWorldTransform_1=Module["_emscripten_bind_btDefaultMotionState_getWorldTransform_1"]=asm["_emscripten_bind_btDefaultMotionState_getWorldTransform_1"];var _emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_1=Module["_emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_1"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_1"];var _emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_3=Module["_emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_3"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_3"];var _emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_2=Module["_emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_2"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_2"];var _emscripten_bind_btVector3_op_mul_1=Module["_emscripten_bind_btVector3_op_mul_1"]=asm["_emscripten_bind_btVector3_op_mul_1"];var _emscripten_bind_btDynamicsWorld_rayTest_3=Module["_emscripten_bind_btDynamicsWorld_rayTest_3"]=asm["_emscripten_bind_btDynamicsWorld_rayTest_3"];var _emscripten_bind_btRaycastVehicle_updateWheelTransform_2=Module["_emscripten_bind_btRaycastVehicle_updateWheelTransform_2"]=asm["_emscripten_bind_btRaycastVehicle_updateWheelTransform_2"];var _emscripten_bind_btQuadWord_x_0=Module["_emscripten_bind_btQuadWord_x_0"]=asm["_emscripten_bind_btQuadWord_x_0"];var _emscripten_bind_LocalConvexResult_get_m_hitPointLocal_0=Module["_emscripten_bind_LocalConvexResult_get_m_hitPointLocal_0"]=asm["_emscripten_bind_LocalConvexResult_get_m_hitPointLocal_0"];var _emscripten_bind_btCollisionObject_isKinematicObject_0=Module["_emscripten_bind_btCollisionObject_isKinematicObject_0"]=asm["_emscripten_bind_btCollisionObject_isKinematicObject_0"];var _emscripten_bind_ConvexResultCallback___destroy___0=Module["_emscripten_bind_ConvexResultCallback___destroy___0"]=asm["_emscripten_bind_ConvexResultCallback___destroy___0"];var _emscripten_bind_ClosestConvexResultCallback_set_m_hitNormalWorld_1=Module["_emscripten_bind_ClosestConvexResultCallback_set_m_hitNormalWorld_1"]=asm["_emscripten_bind_ClosestConvexResultCallback_set_m_hitNormalWorld_1"];var _emscripten_bind_btRigidBody_getCenterOfMassTransform_0=Module["_emscripten_bind_btRigidBody_getCenterOfMassTransform_0"]=asm["_emscripten_bind_btRigidBody_getCenterOfMassTransform_0"];var _emscripten_bind_btGhostObject_isKinematicObject_0=Module["_emscripten_bind_btGhostObject_isKinematicObject_0"]=asm["_emscripten_bind_btGhostObject_isKinematicObject_0"];var _emscripten_bind_btCapsuleShape___destroy___0=Module["_emscripten_bind_btCapsuleShape___destroy___0"]=asm["_emscripten_bind_btCapsuleShape___destroy___0"];var _emscripten_bind_btCollisionObject_activate_1=Module["_emscripten_bind_btCollisionObject_activate_1"]=asm["_emscripten_bind_btCollisionObject_activate_1"];var _emscripten_bind_btCollisionObject_activate_0=Module["_emscripten_bind_btCollisionObject_activate_0"]=asm["_emscripten_bind_btCollisionObject_activate_0"];var _emscripten_bind_btKinematicCharacterController_setUpAxis_1=Module["_emscripten_bind_btKinematicCharacterController_setUpAxis_1"]=asm["_emscripten_bind_btKinematicCharacterController_setUpAxis_1"];var _emscripten_bind_btDispatcherInfo_set_m_timeOfImpact_1=Module["_emscripten_bind_btDispatcherInfo_set_m_timeOfImpact_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_timeOfImpact_1"];var _emscripten_bind_btCollisionDispatcher_btCollisionDispatcher_1=Module["_emscripten_bind_btCollisionDispatcher_btCollisionDispatcher_1"]=asm["_emscripten_bind_btCollisionDispatcher_btCollisionDispatcher_1"];var _emscripten_bind_btVector3_setX_1=Module["_emscripten_bind_btVector3_setX_1"]=asm["_emscripten_bind_btVector3_setX_1"];var _emscripten_bind_btCollisionConfiguration___destroy___0=Module["_emscripten_bind_btCollisionConfiguration___destroy___0"]=asm["_emscripten_bind_btCollisionConfiguration___destroy___0"];var _emscripten_bind_btQuaternion_btQuaternion_4=Module["_emscripten_bind_btQuaternion_btQuaternion_4"]=asm["_emscripten_bind_btQuaternion_btQuaternion_4"];var _emscripten_bind_btManifoldPoint_set_m_positionWorldOnB_1=Module["_emscripten_bind_btManifoldPoint_set_m_positionWorldOnB_1"]=asm["_emscripten_bind_btManifoldPoint_set_m_positionWorldOnB_1"];var _emscripten_bind_btManifoldPoint_set_m_localPointB_1=Module["_emscripten_bind_btManifoldPoint_set_m_localPointB_1"]=asm["_emscripten_bind_btManifoldPoint_set_m_localPointB_1"];var _emscripten_bind_btVector3_setZ_1=Module["_emscripten_bind_btVector3_setZ_1"]=asm["_emscripten_bind_btVector3_setZ_1"];var _emscripten_bind_btWheelInfo_get_m_maxSuspensionTravelCm_0=Module["_emscripten_bind_btWheelInfo_get_m_maxSuspensionTravelCm_0"]=asm["_emscripten_bind_btWheelInfo_get_m_maxSuspensionTravelCm_0"];var _emscripten_bind_btQuaternion_setValue_4=Module["_emscripten_bind_btQuaternion_setValue_4"]=asm["_emscripten_bind_btQuaternion_setValue_4"];var _emscripten_bind_btDispatcherInfo_set_m_dispatchFunc_1=Module["_emscripten_bind_btDispatcherInfo_set_m_dispatchFunc_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_dispatchFunc_1"];var _emscripten_bind_LocalShapeInfo___destroy___0=Module["_emscripten_bind_LocalShapeInfo___destroy___0"]=asm["_emscripten_bind_LocalShapeInfo___destroy___0"];var _emscripten_bind_btQuadWord_setY_1=Module["_emscripten_bind_btQuadWord_setY_1"]=asm["_emscripten_bind_btQuadWord_setY_1"];var _emscripten_bind_btRigidBody_isKinematicObject_0=Module["_emscripten_bind_btRigidBody_isKinematicObject_0"]=asm["_emscripten_bind_btRigidBody_isKinematicObject_0"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_restitution_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_restitution_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_restitution_1"];var _emscripten_bind_btDefaultMotionState_get_m_graphicsWorldTrans_0=Module["_emscripten_bind_btDefaultMotionState_get_m_graphicsWorldTrans_0"]=asm["_emscripten_bind_btDefaultMotionState_get_m_graphicsWorldTrans_0"];var _emscripten_bind_btConeTwistConstraint_setDamping_1=Module["_emscripten_bind_btConeTwistConstraint_setDamping_1"]=asm["_emscripten_bind_btConeTwistConstraint_setDamping_1"];var _emscripten_bind_btPairCachingGhostObject_btPairCachingGhostObject_0=Module["_emscripten_bind_btPairCachingGhostObject_btPairCachingGhostObject_0"]=asm["_emscripten_bind_btPairCachingGhostObject_btPairCachingGhostObject_0"];var _emscripten_bind_btCollisionWorld___destroy___0=Module["_emscripten_bind_btCollisionWorld___destroy___0"]=asm["_emscripten_bind_btCollisionWorld___destroy___0"];var _emscripten_bind_RayResultCallback_get_m_collisionFilterGroup_0=Module["_emscripten_bind_RayResultCallback_get_m_collisionFilterGroup_0"]=asm["_emscripten_bind_RayResultCallback_get_m_collisionFilterGroup_0"];var _emscripten_bind_btBoxShape_btBoxShape_1=Module["_emscripten_bind_btBoxShape_btBoxShape_1"]=asm["_emscripten_bind_btBoxShape_btBoxShape_1"];var _emscripten_bind_btPersistentManifold_getBody1_0=Module["_emscripten_bind_btPersistentManifold_getBody1_0"]=asm["_emscripten_bind_btPersistentManifold_getBody1_0"];var _emscripten_bind_ClosestRayResultCallback_set_m_collisionObject_1=Module["_emscripten_bind_ClosestRayResultCallback_set_m_collisionObject_1"]=asm["_emscripten_bind_ClosestRayResultCallback_set_m_collisionObject_1"];var _emscripten_bind_btKinematicCharacterController_setGravity_1=Module["_emscripten_bind_btKinematicCharacterController_setGravity_1"]=asm["_emscripten_bind_btKinematicCharacterController_setGravity_1"];var _emscripten_bind_btConstraintSetting_set_m_impulseClamp_1=Module["_emscripten_bind_btConstraintSetting_set_m_impulseClamp_1"]=asm["_emscripten_bind_btConstraintSetting_set_m_impulseClamp_1"];var _emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_5=Module["_emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_5"]=asm["_emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_5"];var _emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_3=Module["_emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_3"]=asm["_emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_3"];var _emscripten_bind_LocalShapeInfo_get_m_shapePart_0=Module["_emscripten_bind_LocalShapeInfo_get_m_shapePart_0"]=asm["_emscripten_bind_LocalShapeInfo_get_m_shapePart_0"];var _emscripten_bind_btWheelInfo_get_m_rollInfluence_0=Module["_emscripten_bind_btWheelInfo_get_m_rollInfluence_0"]=asm["_emscripten_bind_btWheelInfo_get_m_rollInfluence_0"];var _emscripten_bind_btVector4_setValue_4=Module["_emscripten_bind_btVector4_setValue_4"]=asm["_emscripten_bind_btVector4_setValue_4"];var _emscripten_bind_btBvhTriangleMeshShape_setLocalScaling_1=Module["_emscripten_bind_btBvhTriangleMeshShape_setLocalScaling_1"]=asm["_emscripten_bind_btBvhTriangleMeshShape_setLocalScaling_1"];var _emscripten_bind_btDynamicsWorld_getDispatchInfo_0=Module["_emscripten_bind_btDynamicsWorld_getDispatchInfo_0"]=asm["_emscripten_bind_btDynamicsWorld_getDispatchInfo_0"];var _emscripten_bind_btVector3_length_0=Module["_emscripten_bind_btVector3_length_0"]=asm["_emscripten_bind_btVector3_length_0"];var _emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_2=Module["_emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_2"]=asm["_emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_2"];var _emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_1=Module["_emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_1"]=asm["_emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_1"];var _emscripten_bind_ClosestConvexResultCallback_set_m_hitPointWorld_1=Module["_emscripten_bind_ClosestConvexResultCallback_set_m_hitPointWorld_1"]=asm["_emscripten_bind_ClosestConvexResultCallback_set_m_hitPointWorld_1"];var _emscripten_bind_RayResultCallback_set_m_collisionFilterMask_1=Module["_emscripten_bind_RayResultCallback_set_m_collisionFilterMask_1"]=asm["_emscripten_bind_RayResultCallback_set_m_collisionFilterMask_1"];var _emscripten_bind_btPairCachingGhostObject___destroy___0=Module["_emscripten_bind_btPairCachingGhostObject___destroy___0"]=asm["_emscripten_bind_btPairCachingGhostObject___destroy___0"];var _emscripten_bind_btPairCachingGhostObject_activate_0=Module["_emscripten_bind_btPairCachingGhostObject_activate_0"]=asm["_emscripten_bind_btPairCachingGhostObject_activate_0"];var _emscripten_bind_btPairCachingGhostObject_activate_1=Module["_emscripten_bind_btPairCachingGhostObject_activate_1"]=asm["_emscripten_bind_btPairCachingGhostObject_activate_1"];var _emscripten_bind_btPairCachingGhostObject_forceActivationState_1=Module["_emscripten_bind_btPairCachingGhostObject_forceActivationState_1"]=asm["_emscripten_bind_btPairCachingGhostObject_forceActivationState_1"];var _emscripten_bind_btDefaultMotionState___destroy___0=Module["_emscripten_bind_btDefaultMotionState___destroy___0"]=asm["_emscripten_bind_btDefaultMotionState___destroy___0"];var _emscripten_bind_btDispatcherInfo_get_m_stepCount_0=Module["_emscripten_bind_btDispatcherInfo_get_m_stepCount_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_stepCount_0"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_angularDamping_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_angularDamping_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_angularDamping_1"];var _emscripten_bind_btQuadWord_setW_1=Module["_emscripten_bind_btQuadWord_setW_1"]=asm["_emscripten_bind_btQuadWord_setW_1"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_friction_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_friction_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_friction_0"];var _emscripten_bind_btCapsuleShapeX_btCapsuleShapeX_2=Module["_emscripten_bind_btCapsuleShapeX_btCapsuleShapeX_2"]=asm["_emscripten_bind_btCapsuleShapeX_btCapsuleShapeX_2"];var _emscripten_bind_btWheelInfo_get_m_maxSuspensionForce_0=Module["_emscripten_bind_btWheelInfo_get_m_maxSuspensionForce_0"]=asm["_emscripten_bind_btWheelInfo_get_m_maxSuspensionForce_0"];var _emscripten_bind_btRigidBody_setLinearFactor_1=Module["_emscripten_bind_btRigidBody_setLinearFactor_1"]=asm["_emscripten_bind_btRigidBody_setLinearFactor_1"];var _emscripten_bind_btDispatcherInfo_set_m_useConvexConservativeDistanceUtil_1=Module["_emscripten_bind_btDispatcherInfo_set_m_useConvexConservativeDistanceUtil_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_useConvexConservativeDistanceUtil_1"];var _emscripten_bind_btRaycastVehicle_setSteeringValue_2=Module["_emscripten_bind_btRaycastVehicle_setSteeringValue_2"]=asm["_emscripten_bind_btRaycastVehicle_setSteeringValue_2"];var _emscripten_bind_btPoint2PointConstraint___destroy___0=Module["_emscripten_bind_btPoint2PointConstraint___destroy___0"]=asm["_emscripten_bind_btPoint2PointConstraint___destroy___0"];var _emscripten_bind_btDiscreteDynamicsWorld_addConstraint_2=Module["_emscripten_bind_btDiscreteDynamicsWorld_addConstraint_2"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_addConstraint_2"];var _emscripten_bind_btDiscreteDynamicsWorld_addConstraint_1=Module["_emscripten_bind_btDiscreteDynamicsWorld_addConstraint_1"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_addConstraint_1"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_angularSleepingThreshold_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_angularSleepingThreshold_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_angularSleepingThreshold_1"];var _malloc=Module["_malloc"]=asm["_malloc"];var _emscripten_bind_btDispatcherInfo_get_m_useEpa_0=Module["_emscripten_bind_btDispatcherInfo_get_m_useEpa_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_useEpa_0"];var _emscripten_bind_btTransform_btTransform_2=Module["_emscripten_bind_btTransform_btTransform_2"]=asm["_emscripten_bind_btTransform_btTransform_2"];var _emscripten_bind_btTransform_btTransform_0=Module["_emscripten_bind_btTransform_btTransform_0"]=asm["_emscripten_bind_btTransform_btTransform_0"];var _emscripten_bind_btWheelInfo_set_m_wheelsRadius_1=Module["_emscripten_bind_btWheelInfo_set_m_wheelsRadius_1"]=asm["_emscripten_bind_btWheelInfo_set_m_wheelsRadius_1"];var _emscripten_bind_btDispatcherInfo_set_m_enableSPU_1=Module["_emscripten_bind_btDispatcherInfo_set_m_enableSPU_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_enableSPU_1"];var _emscripten_bind_btRaycastVehicle_setCoordinateSystem_3=Module["_emscripten_bind_btRaycastVehicle_setCoordinateSystem_3"]=asm["_emscripten_bind_btRaycastVehicle_setCoordinateSystem_3"];var _emscripten_bind_btCollisionObject_setActivationState_1=Module["_emscripten_bind_btCollisionObject_setActivationState_1"]=asm["_emscripten_bind_btCollisionObject_setActivationState_1"];var _emscripten_bind_btPersistentManifold___destroy___0=Module["_emscripten_bind_btPersistentManifold___destroy___0"]=asm["_emscripten_bind_btPersistentManifold___destroy___0"];var _emscripten_bind_btConstraintSetting_get_m_impulseClamp_0=Module["_emscripten_bind_btConstraintSetting_get_m_impulseClamp_0"]=asm["_emscripten_bind_btConstraintSetting_get_m_impulseClamp_0"];var _emscripten_bind_btCylinderShapeZ___destroy___0=Module["_emscripten_bind_btCylinderShapeZ___destroy___0"]=asm["_emscripten_bind_btCylinderShapeZ___destroy___0"];var _emscripten_bind_btMatrix3x3___destroy___0=Module["_emscripten_bind_btMatrix3x3___destroy___0"]=asm["_emscripten_bind_btMatrix3x3___destroy___0"];var _emscripten_bind_ConvexResultCallback_hasHit_0=Module["_emscripten_bind_ConvexResultCallback_hasHit_0"]=asm["_emscripten_bind_ConvexResultCallback_hasHit_0"];var _emscripten_bind_btCollisionShape_calculateLocalInertia_2=Module["_emscripten_bind_btCollisionShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btCollisionShape_calculateLocalInertia_2"];var _emscripten_bind_btCollisionWorld_convexSweepTest_5=Module["_emscripten_bind_btCollisionWorld_convexSweepTest_5"]=asm["_emscripten_bind_btCollisionWorld_convexSweepTest_5"];var _emscripten_bind_ClosestRayResultCallback_set_m_hitPointWorld_1=Module["_emscripten_bind_ClosestRayResultCallback_set_m_hitPointWorld_1"]=asm["_emscripten_bind_ClosestRayResultCallback_set_m_hitPointWorld_1"];var _emscripten_bind_btCapsuleShapeX_calculateLocalInertia_2=Module["_emscripten_bind_btCapsuleShapeX_calculateLocalInertia_2"]=asm["_emscripten_bind_btCapsuleShapeX_calculateLocalInertia_2"];var _emscripten_bind_btConstraintSetting_set_m_damping_1=Module["_emscripten_bind_btConstraintSetting_set_m_damping_1"]=asm["_emscripten_bind_btConstraintSetting_set_m_damping_1"];var _emscripten_bind_btVehicleRaycaster___destroy___0=Module["_emscripten_bind_btVehicleRaycaster___destroy___0"]=asm["_emscripten_bind_btVehicleRaycaster___destroy___0"];var _emscripten_bind_btRigidBody_applyForce_2=Module["_emscripten_bind_btRigidBody_applyForce_2"]=asm["_emscripten_bind_btRigidBody_applyForce_2"];var _emscripten_bind_btConeShapeZ_calculateLocalInertia_2=Module["_emscripten_bind_btConeShapeZ_calculateLocalInertia_2"]=asm["_emscripten_bind_btConeShapeZ_calculateLocalInertia_2"];var _emscripten_bind_btConstraintSetting_set_m_tau_1=Module["_emscripten_bind_btConstraintSetting_set_m_tau_1"]=asm["_emscripten_bind_btConstraintSetting_set_m_tau_1"];var _emscripten_bind_btConvexHullShape_calculateLocalInertia_2=Module["_emscripten_bind_btConvexHullShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btConvexHullShape_calculateLocalInertia_2"];var _emscripten_bind_btSphereShape_calculateLocalInertia_2=Module["_emscripten_bind_btSphereShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btSphereShape_calculateLocalInertia_2"];var _emscripten_bind_btPoint2PointConstraint_get_m_setting_0=Module["_emscripten_bind_btPoint2PointConstraint_get_m_setting_0"]=asm["_emscripten_bind_btPoint2PointConstraint_get_m_setting_0"];var _emscripten_bind_LocalConvexResult_LocalConvexResult_5=Module["_emscripten_bind_LocalConvexResult_LocalConvexResult_5"]=asm["_emscripten_bind_LocalConvexResult_LocalConvexResult_5"];var _emscripten_bind_btGhostObject_setFriction_1=Module["_emscripten_bind_btGhostObject_setFriction_1"]=asm["_emscripten_bind_btGhostObject_setFriction_1"];var _emscripten_bind_btPairCachingGhostObject_getWorldTransform_0=Module["_emscripten_bind_btPairCachingGhostObject_getWorldTransform_0"]=asm["_emscripten_bind_btPairCachingGhostObject_getWorldTransform_0"];var _emscripten_bind_btRigidBody_setFriction_1=Module["_emscripten_bind_btRigidBody_setFriction_1"]=asm["_emscripten_bind_btRigidBody_setFriction_1"];var _emscripten_bind_LocalConvexResult_set_m_hitPointLocal_1=Module["_emscripten_bind_LocalConvexResult_set_m_hitPointLocal_1"]=asm["_emscripten_bind_LocalConvexResult_set_m_hitPointLocal_1"];var _emscripten_bind_btGhostObject_setWorldTransform_1=Module["_emscripten_bind_btGhostObject_setWorldTransform_1"]=asm["_emscripten_bind_btGhostObject_setWorldTransform_1"];var _emscripten_bind_btDiscreteDynamicsWorld_removeRigidBody_1=Module["_emscripten_bind_btDiscreteDynamicsWorld_removeRigidBody_1"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_removeRigidBody_1"];var _emscripten_bind_btConvexHullShape___destroy___0=Module["_emscripten_bind_btConvexHullShape___destroy___0"]=asm["_emscripten_bind_btConvexHullShape___destroy___0"];var _emscripten_bind_btDiscreteDynamicsWorld_getBroadphase_0=Module["_emscripten_bind_btDiscreteDynamicsWorld_getBroadphase_0"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_getBroadphase_0"];var _emscripten_bind_btVector4_setX_1=Module["_emscripten_bind_btVector4_setX_1"]=asm["_emscripten_bind_btVector4_setX_1"];var _emscripten_bind_btKinematicCharacterController_jump_0=Module["_emscripten_bind_btKinematicCharacterController_jump_0"]=asm["_emscripten_bind_btKinematicCharacterController_jump_0"];var _emscripten_bind_btConeTwistConstraint_setMaxMotorImpulseNormalized_1=Module["_emscripten_bind_btConeTwistConstraint_setMaxMotorImpulseNormalized_1"]=asm["_emscripten_bind_btConeTwistConstraint_setMaxMotorImpulseNormalized_1"];var _emscripten_bind_btConvexTriangleMeshShape_setLocalScaling_1=Module["_emscripten_bind_btConvexTriangleMeshShape_setLocalScaling_1"]=asm["_emscripten_bind_btConvexTriangleMeshShape_setLocalScaling_1"];var _emscripten_bind_btRigidBody_upcast_1=Module["_emscripten_bind_btRigidBody_upcast_1"]=asm["_emscripten_bind_btRigidBody_upcast_1"];var _emscripten_bind_btCollisionObject_getWorldTransform_0=Module["_emscripten_bind_btCollisionObject_getWorldTransform_0"]=asm["_emscripten_bind_btCollisionObject_getWorldTransform_0"];var _emscripten_bind_btVector4_setZ_1=Module["_emscripten_bind_btVector4_setZ_1"]=asm["_emscripten_bind_btVector4_setZ_1"];var _emscripten_bind_btQuadWord_y_0=Module["_emscripten_bind_btQuadWord_y_0"]=asm["_emscripten_bind_btQuadWord_y_0"];var ___cxa_can_catch=Module["___cxa_can_catch"]=asm["___cxa_can_catch"];var _emscripten_bind_btTransform_getBasis_0=Module["_emscripten_bind_btTransform_getBasis_0"]=asm["_emscripten_bind_btTransform_getBasis_0"];var _emscripten_bind_btPairCachingGhostObject_setFriction_1=Module["_emscripten_bind_btPairCachingGhostObject_setFriction_1"]=asm["_emscripten_bind_btPairCachingGhostObject_setFriction_1"];var _emscripten_bind_btDispatcherInfo_set_m_useEpa_1=Module["_emscripten_bind_btDispatcherInfo_set_m_useEpa_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_useEpa_1"];var _emscripten_bind_btCollisionDispatcher_getNumManifolds_0=Module["_emscripten_bind_btCollisionDispatcher_getNumManifolds_0"]=asm["_emscripten_bind_btCollisionDispatcher_getNumManifolds_0"];var _emscripten_bind_ClosestRayResultCallback___destroy___0=Module["_emscripten_bind_ClosestRayResultCallback___destroy___0"]=asm["_emscripten_bind_ClosestRayResultCallback___destroy___0"];var _emscripten_bind_btQuadWord_w_0=Module["_emscripten_bind_btQuadWord_w_0"]=asm["_emscripten_bind_btQuadWord_w_0"];var _emscripten_bind_btCompoundShape___destroy___0=Module["_emscripten_bind_btCompoundShape___destroy___0"]=asm["_emscripten_bind_btCompoundShape___destroy___0"];var _emscripten_bind_btBvhTriangleMeshShape_calculateLocalInertia_2=Module["_emscripten_bind_btBvhTriangleMeshShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btBvhTriangleMeshShape_calculateLocalInertia_2"];var _emscripten_bind_btGhostObject_btGhostObject_0=Module["_emscripten_bind_btGhostObject_btGhostObject_0"]=asm["_emscripten_bind_btGhostObject_btGhostObject_0"];var _emscripten_bind_btConeShape_btConeShape_2=Module["_emscripten_bind_btConeShape_btConeShape_2"]=asm["_emscripten_bind_btConeShape_btConeShape_2"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingFactor_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingFactor_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingFactor_1"];var _emscripten_bind_btManifoldPoint_set_m_localPointA_1=Module["_emscripten_bind_btManifoldPoint_set_m_localPointA_1"]=asm["_emscripten_bind_btManifoldPoint_set_m_localPointA_1"];var _emscripten_bind_btCollisionObject_setCollisionShape_1=Module["_emscripten_bind_btCollisionObject_setCollisionShape_1"]=asm["_emscripten_bind_btCollisionObject_setCollisionShape_1"];var _emscripten_bind_btWheelInfo___destroy___0=Module["_emscripten_bind_btWheelInfo___destroy___0"]=asm["_emscripten_bind_btWheelInfo___destroy___0"];var _emscripten_bind_btTransform_setRotation_1=Module["_emscripten_bind_btTransform_setRotation_1"]=asm["_emscripten_bind_btTransform_setRotation_1"];var _emscripten_bind_btPairCachingGhostObject_getNumOverlappingObjects_0=Module["_emscripten_bind_btPairCachingGhostObject_getNumOverlappingObjects_0"]=asm["_emscripten_bind_btPairCachingGhostObject_getNumOverlappingObjects_0"];var _emscripten_bind_btPoint2PointConstraint_enableFeedback_1=Module["_emscripten_bind_btPoint2PointConstraint_enableFeedback_1"]=asm["_emscripten_bind_btPoint2PointConstraint_enableFeedback_1"];var _emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterGroup_1=Module["_emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterGroup_1"]=asm["_emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterGroup_1"];var _emscripten_bind_btAxisSweep3_btAxisSweep3_2=Module["_emscripten_bind_btAxisSweep3_btAxisSweep3_2"]=asm["_emscripten_bind_btAxisSweep3_btAxisSweep3_2"];var _emscripten_bind_btAxisSweep3_btAxisSweep3_3=Module["_emscripten_bind_btAxisSweep3_btAxisSweep3_3"]=asm["_emscripten_bind_btAxisSweep3_btAxisSweep3_3"];var _emscripten_bind_btBoxShape_calculateLocalInertia_2=Module["_emscripten_bind_btBoxShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btBoxShape_calculateLocalInertia_2"];var _emscripten_bind_btVector3_setY_1=Module["_emscripten_bind_btVector3_setY_1"]=asm["_emscripten_bind_btVector3_setY_1"];var _emscripten_bind_btAxisSweep3_btAxisSweep3_4=Module["_emscripten_bind_btAxisSweep3_btAxisSweep3_4"]=asm["_emscripten_bind_btAxisSweep3_btAxisSweep3_4"];var _emscripten_bind_btAxisSweep3_btAxisSweep3_5=Module["_emscripten_bind_btAxisSweep3_btAxisSweep3_5"]=asm["_emscripten_bind_btAxisSweep3_btAxisSweep3_5"];var _emscripten_bind_btQuadWord_setX_1=Module["_emscripten_bind_btQuadWord_setX_1"]=asm["_emscripten_bind_btQuadWord_setX_1"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalLinearDampingThresholdSqr_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalLinearDampingThresholdSqr_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalLinearDampingThresholdSqr_0"];var _emscripten_bind_btVehicleTuning_set_m_suspensionStiffness_1=Module["_emscripten_bind_btVehicleTuning_set_m_suspensionStiffness_1"]=asm["_emscripten_bind_btVehicleTuning_set_m_suspensionStiffness_1"];var _emscripten_bind_btOverlappingPairCache___destroy___0=Module["_emscripten_bind_btOverlappingPairCache___destroy___0"]=asm["_emscripten_bind_btOverlappingPairCache___destroy___0"];var _emscripten_bind_btConstraintSetting___destroy___0=Module["_emscripten_bind_btConstraintSetting___destroy___0"]=asm["_emscripten_bind_btConstraintSetting___destroy___0"];var _emscripten_bind_RayResultCallback___destroy___0=Module["_emscripten_bind_RayResultCallback___destroy___0"]=asm["_emscripten_bind_RayResultCallback___destroy___0"];var _emscripten_bind_btPersistentManifold_getBody0_0=Module["_emscripten_bind_btPersistentManifold_getBody0_0"]=asm["_emscripten_bind_btPersistentManifold_getBody0_0"];var _emscripten_bind_btConeShapeX_btConeShapeX_2=Module["_emscripten_bind_btConeShapeX_btConeShapeX_2"]=asm["_emscripten_bind_btConeShapeX_btConeShapeX_2"];var _emscripten_bind_btConeTwistConstraint_enableFeedback_1=Module["_emscripten_bind_btConeTwistConstraint_enableFeedback_1"]=asm["_emscripten_bind_btConeTwistConstraint_enableFeedback_1"];var _emscripten_bind_btCapsuleShapeZ_setLocalScaling_1=Module["_emscripten_bind_btCapsuleShapeZ_setLocalScaling_1"]=asm["_emscripten_bind_btCapsuleShapeZ_setLocalScaling_1"];var _emscripten_bind_btRigidBody_applyTorque_1=Module["_emscripten_bind_btRigidBody_applyTorque_1"]=asm["_emscripten_bind_btRigidBody_applyTorque_1"];var _emscripten_bind_btSliderConstraint_setUpperLinLimit_1=Module["_emscripten_bind_btSliderConstraint_setUpperLinLimit_1"]=asm["_emscripten_bind_btSliderConstraint_setUpperLinLimit_1"];var _emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_2=Module["_emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_2"]=asm["_emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_2"];var _emscripten_bind_btConcaveShape___destroy___0=Module["_emscripten_bind_btConcaveShape___destroy___0"]=asm["_emscripten_bind_btConcaveShape___destroy___0"];var _emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_4=Module["_emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_4"]=asm["_emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_4"];var _emscripten_bind_btQuaternion_x_0=Module["_emscripten_bind_btQuaternion_x_0"]=asm["_emscripten_bind_btQuaternion_x_0"];var _emscripten_bind_LocalConvexResult_set_m_hitNormalLocal_1=Module["_emscripten_bind_LocalConvexResult_set_m_hitNormalLocal_1"]=asm["_emscripten_bind_LocalConvexResult_set_m_hitNormalLocal_1"];var _emscripten_bind_btConcaveShape_setLocalScaling_1=Module["_emscripten_bind_btConcaveShape_setLocalScaling_1"]=asm["_emscripten_bind_btConcaveShape_setLocalScaling_1"];var _emscripten_bind_btDiscreteDynamicsWorld_getDispatchInfo_0=Module["_emscripten_bind_btDiscreteDynamicsWorld_getDispatchInfo_0"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_getDispatchInfo_0"];var _emscripten_bind_btConeShapeX_setLocalScaling_1=Module["_emscripten_bind_btConeShapeX_setLocalScaling_1"]=asm["_emscripten_bind_btConeShapeX_setLocalScaling_1"];var _emscripten_bind_btQuaternion_z_0=Module["_emscripten_bind_btQuaternion_z_0"]=asm["_emscripten_bind_btQuaternion_z_0"];var _emscripten_bind_btConvexHullShape_btConvexHullShape_0=Module["_emscripten_bind_btConvexHullShape_btConvexHullShape_0"]=asm["_emscripten_bind_btConvexHullShape_btConvexHullShape_0"];var _emscripten_bind_btWheelInfo_set_m_maxSuspensionForce_1=Module["_emscripten_bind_btWheelInfo_set_m_maxSuspensionForce_1"]=asm["_emscripten_bind_btWheelInfo_set_m_maxSuspensionForce_1"];var _emscripten_bind_btConstraintSetting_get_m_damping_0=Module["_emscripten_bind_btConstraintSetting_get_m_damping_0"]=asm["_emscripten_bind_btConstraintSetting_get_m_damping_0"];var _emscripten_bind_btGhostObject___destroy___0=Module["_emscripten_bind_btGhostObject___destroy___0"]=asm["_emscripten_bind_btGhostObject___destroy___0"];var _emscripten_bind_btGhostObject_setContactProcessingThreshold_1=Module["_emscripten_bind_btGhostObject_setContactProcessingThreshold_1"]=asm["_emscripten_bind_btGhostObject_setContactProcessingThreshold_1"];var _emscripten_bind_btRigidBody_applyCentralForce_1=Module["_emscripten_bind_btRigidBody_applyCentralForce_1"]=asm["_emscripten_bind_btRigidBody_applyCentralForce_1"];var _emscripten_bind_btQuaternion___destroy___0=Module["_emscripten_bind_btQuaternion___destroy___0"]=asm["_emscripten_bind_btQuaternion___destroy___0"];var _emscripten_bind_btCollisionDispatcher_getManifoldByIndexInternal_1=Module["_emscripten_bind_btCollisionDispatcher_getManifoldByIndexInternal_1"]=asm["_emscripten_bind_btCollisionDispatcher_getManifoldByIndexInternal_1"];var _emscripten_bind_btDefaultMotionState_btDefaultMotionState_2=Module["_emscripten_bind_btDefaultMotionState_btDefaultMotionState_2"]=asm["_emscripten_bind_btDefaultMotionState_btDefaultMotionState_2"];var _emscripten_bind_btDefaultMotionState_btDefaultMotionState_0=Module["_emscripten_bind_btDefaultMotionState_btDefaultMotionState_0"]=asm["_emscripten_bind_btDefaultMotionState_btDefaultMotionState_0"];var _emscripten_bind_btDefaultMotionState_btDefaultMotionState_1=Module["_emscripten_bind_btDefaultMotionState_btDefaultMotionState_1"]=asm["_emscripten_bind_btDefaultMotionState_btDefaultMotionState_1"];var _emscripten_bind_btKinematicCharacterController_canJump_0=Module["_emscripten_bind_btKinematicCharacterController_canJump_0"]=asm["_emscripten_bind_btKinematicCharacterController_canJump_0"];var _emscripten_bind_btRigidBody_isActive_0=Module["_emscripten_bind_btRigidBody_isActive_0"]=asm["_emscripten_bind_btRigidBody_isActive_0"];var _emscripten_bind_btRaycastVehicle_btRaycastVehicle_3=Module["_emscripten_bind_btRaycastVehicle_btRaycastVehicle_3"]=asm["_emscripten_bind_btRaycastVehicle_btRaycastVehicle_3"];var _emscripten_bind_btMotionState_setWorldTransform_1=Module["_emscripten_bind_btMotionState_setWorldTransform_1"]=asm["_emscripten_bind_btMotionState_setWorldTransform_1"];var _emscripten_bind_btCylinderShape_setLocalScaling_1=Module["_emscripten_bind_btCylinderShape_setLocalScaling_1"]=asm["_emscripten_bind_btCylinderShape_setLocalScaling_1"];var _emscripten_bind_btCollisionWorld_rayTest_3=Module["_emscripten_bind_btCollisionWorld_rayTest_3"]=asm["_emscripten_bind_btCollisionWorld_rayTest_3"];var _emscripten_bind_btCompoundShape_calculateLocalInertia_2=Module["_emscripten_bind_btCompoundShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btCompoundShape_calculateLocalInertia_2"];var _emscripten_bind_btCollisionWorld_getDispatchInfo_0=Module["_emscripten_bind_btCollisionWorld_getDispatchInfo_0"]=asm["_emscripten_bind_btCollisionWorld_getDispatchInfo_0"];var _emscripten_bind_btRigidBody_setCollisionShape_1=Module["_emscripten_bind_btRigidBody_setCollisionShape_1"]=asm["_emscripten_bind_btRigidBody_setCollisionShape_1"];var _emscripten_bind_btConeShapeX___destroy___0=Module["_emscripten_bind_btConeShapeX___destroy___0"]=asm["_emscripten_bind_btConeShapeX___destroy___0"];var _emscripten_bind_btCollisionObject_getCollisionFlags_0=Module["_emscripten_bind_btCollisionObject_getCollisionFlags_0"]=asm["_emscripten_bind_btCollisionObject_getCollisionFlags_0"];var _emscripten_bind_btDispatcherInfo_set_m_enableSatConvex_1=Module["_emscripten_bind_btDispatcherInfo_set_m_enableSatConvex_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_enableSatConvex_1"];var _emscripten_bind_btConeTwistConstraint_enableMotor_1=Module["_emscripten_bind_btConeTwistConstraint_enableMotor_1"]=asm["_emscripten_bind_btConeTwistConstraint_enableMotor_1"];var _emscripten_bind_btWheelInfo_set_m_wheelsDampingCompression_1=Module["_emscripten_bind_btWheelInfo_set_m_wheelsDampingCompression_1"]=asm["_emscripten_bind_btWheelInfo_set_m_wheelsDampingCompression_1"];var _emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_4=Module["_emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_4"]=asm["_emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_4"];var _emscripten_bind_btPairCachingGhostObject_setRestitution_1=Module["_emscripten_bind_btPairCachingGhostObject_setRestitution_1"]=asm["_emscripten_bind_btPairCachingGhostObject_setRestitution_1"];var _emscripten_bind_btBroadphaseInterface___destroy___0=Module["_emscripten_bind_btBroadphaseInterface___destroy___0"]=asm["_emscripten_bind_btBroadphaseInterface___destroy___0"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDampingFactor_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDampingFactor_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDampingFactor_1"];var _emscripten_bind_btCollisionObject_setContactProcessingThreshold_1=Module["_emscripten_bind_btCollisionObject_setContactProcessingThreshold_1"]=asm["_emscripten_bind_btCollisionObject_setContactProcessingThreshold_1"];var _emscripten_bind_btPersistentManifold_getNumContacts_0=Module["_emscripten_bind_btPersistentManifold_getNumContacts_0"]=asm["_emscripten_bind_btPersistentManifold_getNumContacts_0"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingFactor_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingFactor_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingFactor_0"];var _emscripten_bind_LocalConvexResult___destroy___0=Module["_emscripten_bind_LocalConvexResult___destroy___0"]=asm["_emscripten_bind_LocalConvexResult___destroy___0"];var _emscripten_bind_btSequentialImpulseConstraintSolver___destroy___0=Module["_emscripten_bind_btSequentialImpulseConstraintSolver___destroy___0"]=asm["_emscripten_bind_btSequentialImpulseConstraintSolver___destroy___0"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalLinearDampingThresholdSqr_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalLinearDampingThresholdSqr_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalLinearDampingThresholdSqr_1"];var _emscripten_bind_btCollisionWorld_addCollisionObject_3=Module["_emscripten_bind_btCollisionWorld_addCollisionObject_3"]=asm["_emscripten_bind_btCollisionWorld_addCollisionObject_3"];var _emscripten_bind_btRigidBody_getCollisionFlags_0=Module["_emscripten_bind_btRigidBody_getCollisionFlags_0"]=asm["_emscripten_bind_btRigidBody_getCollisionFlags_0"];var _emscripten_bind_btCollisionShape_setLocalScaling_1=Module["_emscripten_bind_btCollisionShape_setLocalScaling_1"]=asm["_emscripten_bind_btCollisionShape_setLocalScaling_1"];var _emscripten_bind_ClosestConvexResultCallback_get_m_closestHitFraction_0=Module["_emscripten_bind_ClosestConvexResultCallback_get_m_closestHitFraction_0"]=asm["_emscripten_bind_ClosestConvexResultCallback_get_m_closestHitFraction_0"];var _emscripten_bind_LocalConvexResult_get_m_hitCollisionObject_0=Module["_emscripten_bind_LocalConvexResult_get_m_hitCollisionObject_0"]=asm["_emscripten_bind_LocalConvexResult_get_m_hitCollisionObject_0"];var _emscripten_bind_btMatrix3x3_setEulerZYX_3=Module["_emscripten_bind_btMatrix3x3_setEulerZYX_3"]=asm["_emscripten_bind_btMatrix3x3_setEulerZYX_3"];var _emscripten_bind_btDispatcherInfo_get_m_convexConservativeDistanceThreshold_0=Module["_emscripten_bind_btDispatcherInfo_get_m_convexConservativeDistanceThreshold_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_convexConservativeDistanceThreshold_0"];var _emscripten_bind_btConvexHullShape_setLocalScaling_1=Module["_emscripten_bind_btConvexHullShape_setLocalScaling_1"]=asm["_emscripten_bind_btConvexHullShape_setLocalScaling_1"];var _emscripten_bind_RayResultCallback_get_m_collisionFilterMask_0=Module["_emscripten_bind_RayResultCallback_get_m_collisionFilterMask_0"]=asm["_emscripten_bind_RayResultCallback_get_m_collisionFilterMask_0"];var _emscripten_bind_btCollisionWorld_getDispatcher_0=Module["_emscripten_bind_btCollisionWorld_getDispatcher_0"]=asm["_emscripten_bind_btCollisionWorld_getDispatcher_0"];var _emscripten_bind_RayResultCallback_set_m_collisionFilterGroup_1=Module["_emscripten_bind_RayResultCallback_set_m_collisionFilterGroup_1"]=asm["_emscripten_bind_RayResultCallback_set_m_collisionFilterGroup_1"];var _emscripten_bind_btTriangleMesh_btTriangleMesh_1=Module["_emscripten_bind_btTriangleMesh_btTriangleMesh_1"]=asm["_emscripten_bind_btTriangleMesh_btTriangleMesh_1"];var _i64Subtract=Module["_i64Subtract"]=asm["_i64Subtract"];var _emscripten_bind_btRaycastVehicle_getWheelTransformWS_1=Module["_emscripten_bind_btRaycastVehicle_getWheelTransformWS_1"]=asm["_emscripten_bind_btRaycastVehicle_getWheelTransformWS_1"];var _emscripten_bind_btRigidBody_setDamping_2=Module["_emscripten_bind_btRigidBody_setDamping_2"]=asm["_emscripten_bind_btRigidBody_setDamping_2"];var _emscripten_bind_btDynamicsWorld_getDispatcher_0=Module["_emscripten_bind_btDynamicsWorld_getDispatcher_0"]=asm["_emscripten_bind_btDynamicsWorld_getDispatcher_0"];var _emscripten_bind_btGhostObject_setCollisionFlags_1=Module["_emscripten_bind_btGhostObject_setCollisionFlags_1"]=asm["_emscripten_bind_btGhostObject_setCollisionFlags_1"];var _emscripten_bind_btMatrix3x3_getRotation_1=Module["_emscripten_bind_btMatrix3x3_getRotation_1"]=asm["_emscripten_bind_btMatrix3x3_getRotation_1"];var _emscripten_bind_btConeTwistConstraint_setMaxMotorImpulse_1=Module["_emscripten_bind_btConeTwistConstraint_setMaxMotorImpulse_1"]=asm["_emscripten_bind_btConeTwistConstraint_setMaxMotorImpulse_1"];var _emscripten_bind_btCylinderShapeX_setLocalScaling_1=Module["_emscripten_bind_btCylinderShapeX_setLocalScaling_1"]=asm["_emscripten_bind_btCylinderShapeX_setLocalScaling_1"];var _emscripten_bind_btDbvtBroadphase_btDbvtBroadphase_0=Module["_emscripten_bind_btDbvtBroadphase_btDbvtBroadphase_0"]=asm["_emscripten_bind_btDbvtBroadphase_btDbvtBroadphase_0"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDamping_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDamping_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDamping_0"];var _emscripten_bind_btCompoundShape_setLocalScaling_1=Module["_emscripten_bind_btCompoundShape_setLocalScaling_1"]=asm["_emscripten_bind_btCompoundShape_setLocalScaling_1"];var _emscripten_bind_btOverlappingPairCallback___destroy___0=Module["_emscripten_bind_btOverlappingPairCallback___destroy___0"]=asm["_emscripten_bind_btOverlappingPairCallback___destroy___0"];var _emscripten_bind_btManifoldPoint_get_m_positionWorldOnB_0=Module["_emscripten_bind_btManifoldPoint_get_m_positionWorldOnB_0"]=asm["_emscripten_bind_btManifoldPoint_get_m_positionWorldOnB_0"];var _emscripten_bind_btVector4_setY_1=Module["_emscripten_bind_btVector4_setY_1"]=asm["_emscripten_bind_btVector4_setY_1"];var _emscripten_bind_btRigidBody_setContactProcessingThreshold_1=Module["_emscripten_bind_btRigidBody_setContactProcessingThreshold_1"]=asm["_emscripten_bind_btRigidBody_setContactProcessingThreshold_1"];var _emscripten_bind_btRigidBody_getLinearVelocity_0=Module["_emscripten_bind_btRigidBody_getLinearVelocity_0"]=asm["_emscripten_bind_btRigidBody_getLinearVelocity_0"];var _emscripten_bind_btRigidBody_applyImpulse_2=Module["_emscripten_bind_btRigidBody_applyImpulse_2"]=asm["_emscripten_bind_btRigidBody_applyImpulse_2"];var _emscripten_bind_btConcaveShape_calculateLocalInertia_2=Module["_emscripten_bind_btConcaveShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btConcaveShape_calculateLocalInertia_2"];var _emscripten_bind_btRigidBody_setWorldTransform_1=Module["_emscripten_bind_btRigidBody_setWorldTransform_1"]=asm["_emscripten_bind_btRigidBody_setWorldTransform_1"];var _emscripten_bind_btRigidBody_setAngularVelocity_1=Module["_emscripten_bind_btRigidBody_setAngularVelocity_1"]=asm["_emscripten_bind_btRigidBody_setAngularVelocity_1"];var _emscripten_bind_btConvexShape_setLocalScaling_1=Module["_emscripten_bind_btConvexShape_setLocalScaling_1"]=asm["_emscripten_bind_btConvexShape_setLocalScaling_1"];var _emscripten_bind_btTriangleMeshShape_calculateLocalInertia_2=Module["_emscripten_bind_btTriangleMeshShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btTriangleMeshShape_calculateLocalInertia_2"];var _free=Module["_free"]=asm["_free"];var _emscripten_bind_btPairCachingGhostObject_setContactProcessingThreshold_1=Module["_emscripten_bind_btPairCachingGhostObject_setContactProcessingThreshold_1"]=asm["_emscripten_bind_btPairCachingGhostObject_setContactProcessingThreshold_1"];var _emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterMask_0=Module["_emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterMask_0"]=asm["_emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterMask_0"];var _emscripten_bind_RayResultCallback_hasHit_0=Module["_emscripten_bind_RayResultCallback_hasHit_0"]=asm["_emscripten_bind_RayResultCallback_hasHit_0"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingThresholdSqr_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingThresholdSqr_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingThresholdSqr_0"];var _emscripten_bind_ClosestConvexResultCallback_get_m_convexToWorld_0=Module["_emscripten_bind_ClosestConvexResultCallback_get_m_convexToWorld_0"]=asm["_emscripten_bind_ClosestConvexResultCallback_get_m_convexToWorld_0"];var _emscripten_bind_btWheelInfo_get_m_frictionSlip_0=Module["_emscripten_bind_btWheelInfo_get_m_frictionSlip_0"]=asm["_emscripten_bind_btWheelInfo_get_m_frictionSlip_0"];var _emscripten_bind_btConeShapeZ_setLocalScaling_1=Module["_emscripten_bind_btConeShapeZ_setLocalScaling_1"]=asm["_emscripten_bind_btConeShapeZ_setLocalScaling_1"];var _emscripten_bind_btPairCachingGhostObject_setActivationState_1=Module["_emscripten_bind_btPairCachingGhostObject_setActivationState_1"]=asm["_emscripten_bind_btPairCachingGhostObject_setActivationState_1"];var _emscripten_bind_btConvexTriangleMeshShape___destroy___0=Module["_emscripten_bind_btConvexTriangleMeshShape___destroy___0"]=asm["_emscripten_bind_btConvexTriangleMeshShape___destroy___0"];var _emscripten_bind_btVehicleTuning_set_m_maxSuspensionTravelCm_1=Module["_emscripten_bind_btVehicleTuning_set_m_maxSuspensionTravelCm_1"]=asm["_emscripten_bind_btVehicleTuning_set_m_maxSuspensionTravelCm_1"];var _emscripten_bind_btCylinderShapeZ_btCylinderShapeZ_1=Module["_emscripten_bind_btCylinderShapeZ_btCylinderShapeZ_1"]=asm["_emscripten_bind_btCylinderShapeZ_btCylinderShapeZ_1"];var _emscripten_bind_btRigidBody_getAngularVelocity_0=Module["_emscripten_bind_btRigidBody_getAngularVelocity_0"]=asm["_emscripten_bind_btRigidBody_getAngularVelocity_0"];var _emscripten_bind_btCompoundShape_btCompoundShape_0=Module["_emscripten_bind_btCompoundShape_btCompoundShape_0"]=asm["_emscripten_bind_btCompoundShape_btCompoundShape_0"];var _emscripten_bind_btCompoundShape_btCompoundShape_1=Module["_emscripten_bind_btCompoundShape_btCompoundShape_1"]=asm["_emscripten_bind_btCompoundShape_btCompoundShape_1"];var _emscripten_bind_btOverlappingPairCache_setInternalGhostPairCallback_1=Module["_emscripten_bind_btOverlappingPairCache_setInternalGhostPairCallback_1"]=asm["_emscripten_bind_btOverlappingPairCache_setInternalGhostPairCallback_1"];var _emscripten_bind_btStaticPlaneShape_btStaticPlaneShape_2=Module["_emscripten_bind_btStaticPlaneShape_btStaticPlaneShape_2"]=asm["_emscripten_bind_btStaticPlaneShape_btStaticPlaneShape_2"];var _emscripten_bind_btDispatcherInfo_get_m_useContinuous_0=Module["_emscripten_bind_btDispatcherInfo_get_m_useContinuous_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_useContinuous_0"];var _emscripten_bind_btRigidBody_updateInertiaTensor_0=Module["_emscripten_bind_btRigidBody_updateInertiaTensor_0"]=asm["_emscripten_bind_btRigidBody_updateInertiaTensor_0"];var _emscripten_bind_btTransform_setOrigin_1=Module["_emscripten_bind_btTransform_setOrigin_1"]=asm["_emscripten_bind_btTransform_setOrigin_1"];var _emscripten_bind_ClosestRayResultCallback_hasHit_0=Module["_emscripten_bind_ClosestRayResultCallback_hasHit_0"]=asm["_emscripten_bind_ClosestRayResultCallback_hasHit_0"];var _emscripten_bind_btCompoundShape_addChildShape_2=Module["_emscripten_bind_btCompoundShape_addChildShape_2"]=asm["_emscripten_bind_btCompoundShape_addChildShape_2"];var _emscripten_bind_btDispatcher___destroy___0=Module["_emscripten_bind_btDispatcher___destroy___0"]=asm["_emscripten_bind_btDispatcher___destroy___0"];var _emscripten_bind_btVehicleTuning_get_m_suspensionCompression_0=Module["_emscripten_bind_btVehicleTuning_get_m_suspensionCompression_0"]=asm["_emscripten_bind_btVehicleTuning_get_m_suspensionCompression_0"];var _emscripten_bind_btDiscreteDynamicsWorld___destroy___0=Module["_emscripten_bind_btDiscreteDynamicsWorld___destroy___0"]=asm["_emscripten_bind_btDiscreteDynamicsWorld___destroy___0"];var _emscripten_bind_btConvexShape___destroy___0=Module["_emscripten_bind_btConvexShape___destroy___0"]=asm["_emscripten_bind_btConvexShape___destroy___0"];var _memmove=Module["_memmove"]=asm["_memmove"];var _emscripten_bind_btCapsuleShapeX_setLocalScaling_1=Module["_emscripten_bind_btCapsuleShapeX_setLocalScaling_1"]=asm["_emscripten_bind_btCapsuleShapeX_setLocalScaling_1"];var _emscripten_bind_btCollisionObject_setRestitution_1=Module["_emscripten_bind_btCollisionObject_setRestitution_1"]=asm["_emscripten_bind_btCollisionObject_setRestitution_1"];var _emscripten_bind_btWheelInfo_get_m_wheelsDampingCompression_0=Module["_emscripten_bind_btWheelInfo_get_m_wheelsDampingCompression_0"]=asm["_emscripten_bind_btWheelInfo_get_m_wheelsDampingCompression_0"];var _emscripten_bind_LocalConvexResult_get_m_hitFraction_0=Module["_emscripten_bind_LocalConvexResult_get_m_hitFraction_0"]=asm["_emscripten_bind_LocalConvexResult_get_m_hitFraction_0"];var _emscripten_bind_btDispatcherInfo_get_m_enableSPU_0=Module["_emscripten_bind_btDispatcherInfo_get_m_enableSPU_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_enableSPU_0"];var _emscripten_bind_btQuaternion_w_0=Module["_emscripten_bind_btQuaternion_w_0"]=asm["_emscripten_bind_btQuaternion_w_0"];var _emscripten_bind_ConvexResultCallback_get_m_collisionFilterGroup_0=Module["_emscripten_bind_ConvexResultCallback_get_m_collisionFilterGroup_0"]=asm["_emscripten_bind_ConvexResultCallback_get_m_collisionFilterGroup_0"];var _emscripten_bind_btTransform_getRotation_0=Module["_emscripten_bind_btTransform_getRotation_0"]=asm["_emscripten_bind_btTransform_getRotation_0"];var _emscripten_bind_btHingeConstraint_btHingeConstraint_6=Module["_emscripten_bind_btHingeConstraint_btHingeConstraint_6"]=asm["_emscripten_bind_btHingeConstraint_btHingeConstraint_6"];var _emscripten_bind_btHingeConstraint_btHingeConstraint_7=Module["_emscripten_bind_btHingeConstraint_btHingeConstraint_7"]=asm["_emscripten_bind_btHingeConstraint_btHingeConstraint_7"];var _emscripten_bind_btHingeConstraint_btHingeConstraint_4=Module["_emscripten_bind_btHingeConstraint_btHingeConstraint_4"]=asm["_emscripten_bind_btHingeConstraint_btHingeConstraint_4"];var _emscripten_bind_btHingeConstraint_btHingeConstraint_5=Module["_emscripten_bind_btHingeConstraint_btHingeConstraint_5"]=asm["_emscripten_bind_btHingeConstraint_btHingeConstraint_5"];var _emscripten_bind_btHingeConstraint_btHingeConstraint_2=Module["_emscripten_bind_btHingeConstraint_btHingeConstraint_2"]=asm["_emscripten_bind_btHingeConstraint_btHingeConstraint_2"];var _emscripten_bind_btHingeConstraint_btHingeConstraint_3=Module["_emscripten_bind_btHingeConstraint_btHingeConstraint_3"]=asm["_emscripten_bind_btHingeConstraint_btHingeConstraint_3"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingThresholdSqr_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingThresholdSqr_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingThresholdSqr_1"];var _emscripten_bind_ClosestConvexResultCallback_get_m_hitNormalWorld_0=Module["_emscripten_bind_ClosestConvexResultCallback_get_m_hitNormalWorld_0"]=asm["_emscripten_bind_ClosestConvexResultCallback_get_m_hitNormalWorld_0"];var _emscripten_bind_btTypedConstraint___destroy___0=Module["_emscripten_bind_btTypedConstraint___destroy___0"]=asm["_emscripten_bind_btTypedConstraint___destroy___0"];var _emscripten_bind_btCylinderShapeX_btCylinderShapeX_1=Module["_emscripten_bind_btCylinderShapeX_btCylinderShapeX_1"]=asm["_emscripten_bind_btCylinderShapeX_btCylinderShapeX_1"];var _emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_3=Module["_emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_3"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_3"];var _emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_1=Module["_emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_1"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_1"];var _emscripten_bind_btVector3_z_0=Module["_emscripten_bind_btVector3_z_0"]=asm["_emscripten_bind_btVector3_z_0"];var _emscripten_bind_btSphereShape_btSphereShape_1=Module["_emscripten_bind_btSphereShape_btSphereShape_1"]=asm["_emscripten_bind_btSphereShape_btSphereShape_1"];var _emscripten_bind_btQuaternion_y_0=Module["_emscripten_bind_btQuaternion_y_0"]=asm["_emscripten_bind_btQuaternion_y_0"];var _emscripten_bind_btCollisionWorld_addCollisionObject_1=Module["_emscripten_bind_btCollisionWorld_addCollisionObject_1"]=asm["_emscripten_bind_btCollisionWorld_addCollisionObject_1"];var _emscripten_bind_btCollisionWorld_addCollisionObject_2=Module["_emscripten_bind_btCollisionWorld_addCollisionObject_2"]=asm["_emscripten_bind_btCollisionWorld_addCollisionObject_2"];var _emscripten_bind_btRigidBody_setRestitution_1=Module["_emscripten_bind_btRigidBody_setRestitution_1"]=asm["_emscripten_bind_btRigidBody_setRestitution_1"];var _emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterGroup_1=Module["_emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterGroup_1"]=asm["_emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterGroup_1"];var _emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterGroup_0=Module["_emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterGroup_0"]=asm["_emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterGroup_0"];var _emscripten_bind_btRigidBody_getMotionState_0=Module["_emscripten_bind_btRigidBody_getMotionState_0"]=asm["_emscripten_bind_btRigidBody_getMotionState_0"];var _emscripten_bind_btDefaultVehicleRaycaster_btDefaultVehicleRaycaster_1=Module["_emscripten_bind_btDefaultVehicleRaycaster_btDefaultVehicleRaycaster_1"]=asm["_emscripten_bind_btDefaultVehicleRaycaster_btDefaultVehicleRaycaster_1"];var _emscripten_bind_ConcreteContactResultCallback_addSingleResult_7=Module["_emscripten_bind_ConcreteContactResultCallback_addSingleResult_7"]=asm["_emscripten_bind_ConcreteContactResultCallback_addSingleResult_7"];var _emscripten_bind_btSequentialImpulseConstraintSolver_btSequentialImpulseConstraintSolver_0=Module["_emscripten_bind_btSequentialImpulseConstraintSolver_btSequentialImpulseConstraintSolver_0"]=asm["_emscripten_bind_btSequentialImpulseConstraintSolver_btSequentialImpulseConstraintSolver_0"];var _emscripten_bind_btActionInterface___destroy___0=Module["_emscripten_bind_btActionInterface___destroy___0"]=asm["_emscripten_bind_btActionInterface___destroy___0"];var _emscripten_bind_btDefaultMotionState_setWorldTransform_1=Module["_emscripten_bind_btDefaultMotionState_setWorldTransform_1"]=asm["_emscripten_bind_btDefaultMotionState_setWorldTransform_1"];var _emscripten_bind_btDefaultVehicleRaycaster___destroy___0=Module["_emscripten_bind_btDefaultVehicleRaycaster___destroy___0"]=asm["_emscripten_bind_btDefaultVehicleRaycaster___destroy___0"];var _emscripten_bind_RayResultCallback_get_m_collisionObject_0=Module["_emscripten_bind_RayResultCallback_get_m_collisionObject_0"]=asm["_emscripten_bind_RayResultCallback_get_m_collisionObject_0"];var _emscripten_bind_btPoint2PointConstraint_getPivotInA_0=Module["_emscripten_bind_btPoint2PointConstraint_getPivotInA_0"]=asm["_emscripten_bind_btPoint2PointConstraint_getPivotInA_0"];var _emscripten_bind_ClosestConvexResultCallback_get_m_convexFromWorld_0=Module["_emscripten_bind_ClosestConvexResultCallback_get_m_convexFromWorld_0"]=asm["_emscripten_bind_ClosestConvexResultCallback_get_m_convexFromWorld_0"];var _emscripten_bind_btCylinderShape_calculateLocalInertia_2=Module["_emscripten_bind_btCylinderShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btCylinderShape_calculateLocalInertia_2"];var _emscripten_bind_btGhostObject_setRestitution_1=Module["_emscripten_bind_btGhostObject_setRestitution_1"]=asm["_emscripten_bind_btGhostObject_setRestitution_1"];var _emscripten_bind_btDynamicsWorld_addCollisionObject_1=Module["_emscripten_bind_btDynamicsWorld_addCollisionObject_1"]=asm["_emscripten_bind_btDynamicsWorld_addCollisionObject_1"];var _emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterMask_0=Module["_emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterMask_0"]=asm["_emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterMask_0"];var _emscripten_bind_btDynamicsWorld_addCollisionObject_3=Module["_emscripten_bind_btDynamicsWorld_addCollisionObject_3"]=asm["_emscripten_bind_btDynamicsWorld_addCollisionObject_3"];var _emscripten_bind_btDynamicsWorld_addCollisionObject_2=Module["_emscripten_bind_btDynamicsWorld_addCollisionObject_2"]=asm["_emscripten_bind_btDynamicsWorld_addCollisionObject_2"];var _emscripten_bind_btDiscreteDynamicsWorld_getDispatcher_0=Module["_emscripten_bind_btDiscreteDynamicsWorld_getDispatcher_0"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_getDispatcher_0"];var _emscripten_bind_btKinematicCharacterController_setUseGhostSweepTest_1=Module["_emscripten_bind_btKinematicCharacterController_setUseGhostSweepTest_1"]=asm["_emscripten_bind_btKinematicCharacterController_setUseGhostSweepTest_1"];var _emscripten_bind_btVector4_op_mul_1=Module["_emscripten_bind_btVector4_op_mul_1"]=asm["_emscripten_bind_btVector4_op_mul_1"];var _emscripten_bind_btCylinderShape_btCylinderShape_1=Module["_emscripten_bind_btCylinderShape_btCylinderShape_1"]=asm["_emscripten_bind_btCylinderShape_btCylinderShape_1"];var _emscripten_bind_btVector3___destroy___0=Module["_emscripten_bind_btVector3___destroy___0"]=asm["_emscripten_bind_btVector3___destroy___0"];var _emscripten_bind_btRigidBody_setAngularFactor_1=Module["_emscripten_bind_btRigidBody_setAngularFactor_1"]=asm["_emscripten_bind_btRigidBody_setAngularFactor_1"];var _emscripten_bind_btCylinderShapeZ_calculateLocalInertia_2=Module["_emscripten_bind_btCylinderShapeZ_calculateLocalInertia_2"]=asm["_emscripten_bind_btCylinderShapeZ_calculateLocalInertia_2"];var _emscripten_bind_LocalShapeInfo_set_m_triangleIndex_1=Module["_emscripten_bind_LocalShapeInfo_set_m_triangleIndex_1"]=asm["_emscripten_bind_LocalShapeInfo_set_m_triangleIndex_1"];var _emscripten_bind_btMotionState_getWorldTransform_1=Module["_emscripten_bind_btMotionState_getWorldTransform_1"]=asm["_emscripten_bind_btMotionState_getWorldTransform_1"];var _emscripten_bind_btDynamicsWorld_getBroadphase_0=Module["_emscripten_bind_btDynamicsWorld_getBroadphase_0"]=asm["_emscripten_bind_btDynamicsWorld_getBroadphase_0"];var _emscripten_bind_btDispatcherInfo_set_m_convexConservativeDistanceThreshold_1=Module["_emscripten_bind_btDispatcherInfo_set_m_convexConservativeDistanceThreshold_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_convexConservativeDistanceThreshold_1"];var _emscripten_bind_btVector3_x_0=Module["_emscripten_bind_btVector3_x_0"]=asm["_emscripten_bind_btVector3_x_0"];var ___cxa_is_pointer_type=Module["___cxa_is_pointer_type"]=asm["___cxa_is_pointer_type"];var _emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_3=Module["_emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_3"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_3"];var _emscripten_bind_btCollisionObject_getCollisionShape_0=Module["_emscripten_bind_btCollisionObject_getCollisionShape_0"]=asm["_emscripten_bind_btCollisionObject_getCollisionShape_0"];var _emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_4=Module["_emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_4"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_4"];var _emscripten_bind_btManifoldPoint___destroy___0=Module["_emscripten_bind_btManifoldPoint___destroy___0"]=asm["_emscripten_bind_btManifoldPoint___destroy___0"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_rollingFriction_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_rollingFriction_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_rollingFriction_1"];var _emscripten_bind_btVector4_length_0=Module["_emscripten_bind_btVector4_length_0"]=asm["_emscripten_bind_btVector4_length_0"];var _emscripten_bind_btDefaultMotionState_set_m_graphicsWorldTrans_1=Module["_emscripten_bind_btDefaultMotionState_set_m_graphicsWorldTrans_1"]=asm["_emscripten_bind_btDefaultMotionState_set_m_graphicsWorldTrans_1"];var _emscripten_bind_btCylinderShapeZ_setLocalScaling_1=Module["_emscripten_bind_btCylinderShapeZ_setLocalScaling_1"]=asm["_emscripten_bind_btCylinderShapeZ_setLocalScaling_1"];var _emscripten_bind_ClosestConvexResultCallback___destroy___0=Module["_emscripten_bind_ClosestConvexResultCallback___destroy___0"]=asm["_emscripten_bind_ClosestConvexResultCallback___destroy___0"];var _emscripten_bind_btDefaultCollisionConstructionInfo___destroy___0=Module["_emscripten_bind_btDefaultCollisionConstructionInfo___destroy___0"]=asm["_emscripten_bind_btDefaultCollisionConstructionInfo___destroy___0"];var _emscripten_bind_btCollisionObject_setFriction_1=Module["_emscripten_bind_btCollisionObject_setFriction_1"]=asm["_emscripten_bind_btCollisionObject_setFriction_1"];var _emscripten_bind_btDefaultCollisionConfiguration___destroy___0=Module["_emscripten_bind_btDefaultCollisionConfiguration___destroy___0"]=asm["_emscripten_bind_btDefaultCollisionConfiguration___destroy___0"];var _emscripten_bind_btRigidBody_setMassProps_2=Module["_emscripten_bind_btRigidBody_setMassProps_2"]=asm["_emscripten_bind_btRigidBody_setMassProps_2"];var _emscripten_bind_btVector3_setValue_3=Module["_emscripten_bind_btVector3_setValue_3"]=asm["_emscripten_bind_btVector3_setValue_3"];var _emscripten_bind_btGhostObject_getCollisionFlags_0=Module["_emscripten_bind_btGhostObject_getCollisionFlags_0"]=asm["_emscripten_bind_btGhostObject_getCollisionFlags_0"];var _emscripten_bind_btCapsuleShapeX___destroy___0=Module["_emscripten_bind_btCapsuleShapeX___destroy___0"]=asm["_emscripten_bind_btCapsuleShapeX___destroy___0"];var _emscripten_bind_btHingeConstraint_setLimit_4=Module["_emscripten_bind_btHingeConstraint_setLimit_4"]=asm["_emscripten_bind_btHingeConstraint_setLimit_4"];var _emscripten_bind_btHingeConstraint_setLimit_5=Module["_emscripten_bind_btHingeConstraint_setLimit_5"]=asm["_emscripten_bind_btHingeConstraint_setLimit_5"];var _emscripten_bind_btWheelInfo_set_m_maxSuspensionTravelCm_1=Module["_emscripten_bind_btWheelInfo_set_m_maxSuspensionTravelCm_1"]=asm["_emscripten_bind_btWheelInfo_set_m_maxSuspensionTravelCm_1"];var _emscripten_bind_btConeShape_setLocalScaling_1=Module["_emscripten_bind_btConeShape_setLocalScaling_1"]=asm["_emscripten_bind_btConeShape_setLocalScaling_1"];var _emscripten_bind_btGhostObject_getNumOverlappingObjects_0=Module["_emscripten_bind_btGhostObject_getNumOverlappingObjects_0"]=asm["_emscripten_bind_btGhostObject_getNumOverlappingObjects_0"];var _emscripten_bind_btGhostObject_getCollisionShape_0=Module["_emscripten_bind_btGhostObject_getCollisionShape_0"]=asm["_emscripten_bind_btGhostObject_getCollisionShape_0"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_friction_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_friction_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_friction_1"];var _emscripten_bind_btPersistentManifold_getContactPoint_1=Module["_emscripten_bind_btPersistentManifold_getContactPoint_1"]=asm["_emscripten_bind_btPersistentManifold_getContactPoint_1"];var _emscripten_bind_btConeShapeX_calculateLocalInertia_2=Module["_emscripten_bind_btConeShapeX_calculateLocalInertia_2"]=asm["_emscripten_bind_btConeShapeX_calculateLocalInertia_2"];var _emscripten_bind_btGhostObject_activate_0=Module["_emscripten_bind_btGhostObject_activate_0"]=asm["_emscripten_bind_btGhostObject_activate_0"];var _emscripten_bind_btGhostObject_activate_1=Module["_emscripten_bind_btGhostObject_activate_1"]=asm["_emscripten_bind_btGhostObject_activate_1"];var _emscripten_bind_btManifoldPoint_getPositionWorldOnB_0=Module["_emscripten_bind_btManifoldPoint_getPositionWorldOnB_0"]=asm["_emscripten_bind_btManifoldPoint_getPositionWorldOnB_0"];var _emscripten_bind_btManifoldPoint_get_m_positionWorldOnA_0=Module["_emscripten_bind_btManifoldPoint_get_m_positionWorldOnA_0"]=asm["_emscripten_bind_btManifoldPoint_get_m_positionWorldOnA_0"];var _emscripten_bind_btConeShapeZ_btConeShapeZ_2=Module["_emscripten_bind_btConeShapeZ_btConeShapeZ_2"]=asm["_emscripten_bind_btConeShapeZ_btConeShapeZ_2"];var _emscripten_bind_btSphereShape___destroy___0=Module["_emscripten_bind_btSphereShape___destroy___0"]=asm["_emscripten_bind_btSphereShape___destroy___0"];var _emscripten_bind_btSliderConstraint_setUpperAngLimit_1=Module["_emscripten_bind_btSliderConstraint_setUpperAngLimit_1"]=asm["_emscripten_bind_btSliderConstraint_setUpperAngLimit_1"];var _emscripten_bind_btDynamicsWorld_contactPairTest_3=Module["_emscripten_bind_btDynamicsWorld_contactPairTest_3"]=asm["_emscripten_bind_btDynamicsWorld_contactPairTest_3"];var _emscripten_bind_btCollisionWorld_getPairCache_0=Module["_emscripten_bind_btCollisionWorld_getPairCache_0"]=asm["_emscripten_bind_btCollisionWorld_getPairCache_0"];var _emscripten_bind_btConeTwistConstraint_setMotorTarget_1=Module["_emscripten_bind_btConeTwistConstraint_setMotorTarget_1"]=asm["_emscripten_bind_btConeTwistConstraint_setMotorTarget_1"];var _emscripten_bind_ClosestConvexResultCallback_set_m_convexFromWorld_1=Module["_emscripten_bind_ClosestConvexResultCallback_set_m_convexFromWorld_1"]=asm["_emscripten_bind_ClosestConvexResultCallback_set_m_convexFromWorld_1"];var _emscripten_bind_btWheelInfo_set_m_rollInfluence_1=Module["_emscripten_bind_btWheelInfo_set_m_rollInfluence_1"]=asm["_emscripten_bind_btWheelInfo_set_m_rollInfluence_1"];var _emscripten_bind_btDefaultCollisionConstructionInfo_btDefaultCollisionConstructionInfo_0=Module["_emscripten_bind_btDefaultCollisionConstructionInfo_btDefaultCollisionConstructionInfo_0"]=asm["_emscripten_bind_btDefaultCollisionConstructionInfo_btDefaultCollisionConstructionInfo_0"];var _emscripten_bind_btGhostObject_forceActivationState_1=Module["_emscripten_bind_btGhostObject_forceActivationState_1"]=asm["_emscripten_bind_btGhostObject_forceActivationState_1"];var _emscripten_bind_ConcreteContactResultCallback_ConcreteContactResultCallback_0=Module["_emscripten_bind_ConcreteContactResultCallback_ConcreteContactResultCallback_0"]=asm["_emscripten_bind_ConcreteContactResultCallback_ConcreteContactResultCallback_0"];var _emscripten_bind_VoidPtr___destroy___0=Module["_emscripten_bind_VoidPtr___destroy___0"]=asm["_emscripten_bind_VoidPtr___destroy___0"];var _emscripten_bind_btSliderConstraint_setLowerAngLimit_1=Module["_emscripten_bind_btSliderConstraint_setLowerAngLimit_1"]=asm["_emscripten_bind_btSliderConstraint_setLowerAngLimit_1"];var _emscripten_bind_ClosestConvexResultCallback_ClosestConvexResultCallback_2=Module["_emscripten_bind_ClosestConvexResultCallback_ClosestConvexResultCallback_2"]=asm["_emscripten_bind_ClosestConvexResultCallback_ClosestConvexResultCallback_2"];var _emscripten_bind_ClosestRayResultCallback_get_m_rayFromWorld_0=Module["_emscripten_bind_ClosestRayResultCallback_get_m_rayFromWorld_0"]=asm["_emscripten_bind_ClosestRayResultCallback_get_m_rayFromWorld_0"];var _emscripten_bind_btRaycastVehicle_getRigidBody_0=Module["_emscripten_bind_btRaycastVehicle_getRigidBody_0"]=asm["_emscripten_bind_btRaycastVehicle_getRigidBody_0"];var _emscripten_bind_btWheelInfo_get_m_steering_0=Module["_emscripten_bind_btWheelInfo_get_m_steering_0"]=asm["_emscripten_bind_btWheelInfo_get_m_steering_0"];var _emscripten_bind_btConstraintSetting_get_m_tau_0=Module["_emscripten_bind_btConstraintSetting_get_m_tau_0"]=asm["_emscripten_bind_btConstraintSetting_get_m_tau_0"];var _emscripten_bind_btSliderConstraint___destroy___0=Module["_emscripten_bind_btSliderConstraint___destroy___0"]=asm["_emscripten_bind_btSliderConstraint___destroy___0"];var _emscripten_bind_btCollisionShape___destroy___0=Module["_emscripten_bind_btCollisionShape___destroy___0"]=asm["_emscripten_bind_btCollisionShape___destroy___0"];var _emscripten_bind_ConvexResultCallback_get_m_closestHitFraction_0=Module["_emscripten_bind_ConvexResultCallback_get_m_closestHitFraction_0"]=asm["_emscripten_bind_ConvexResultCallback_get_m_closestHitFraction_0"];var _emscripten_bind_btDispatcherInfo_get_m_dispatchFunc_0=Module["_emscripten_bind_btDispatcherInfo_get_m_dispatchFunc_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_dispatchFunc_0"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_rollingFriction_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_rollingFriction_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_rollingFriction_0"];var _emscripten_bind_btPairCachingGhostObject_setCollisionShape_1=Module["_emscripten_bind_btPairCachingGhostObject_setCollisionShape_1"]=asm["_emscripten_bind_btPairCachingGhostObject_setCollisionShape_1"];var _emscripten_bind_btKinematicCharacterController_warp_1=Module["_emscripten_bind_btKinematicCharacterController_warp_1"]=asm["_emscripten_bind_btKinematicCharacterController_warp_1"];var _emscripten_bind_btAxisSweep3___destroy___0=Module["_emscripten_bind_btAxisSweep3___destroy___0"]=asm["_emscripten_bind_btAxisSweep3___destroy___0"];var _emscripten_bind_btTriangleMesh___destroy___0=Module["_emscripten_bind_btTriangleMesh___destroy___0"]=asm["_emscripten_bind_btTriangleMesh___destroy___0"];var _emscripten_bind_btKinematicCharacterController_preStep_1=Module["_emscripten_bind_btKinematicCharacterController_preStep_1"]=asm["_emscripten_bind_btKinematicCharacterController_preStep_1"];var _emscripten_bind_btRaycastVehicle_applyEngineForce_2=Module["_emscripten_bind_btRaycastVehicle_applyEngineForce_2"]=asm["_emscripten_bind_btRaycastVehicle_applyEngineForce_2"];var _emscripten_bind_btRaycastVehicle_setBrake_2=Module["_emscripten_bind_btRaycastVehicle_setBrake_2"]=asm["_emscripten_bind_btRaycastVehicle_setBrake_2"];var _emscripten_bind_ConcreteContactResultCallback___destroy___0=Module["_emscripten_bind_ConcreteContactResultCallback___destroy___0"]=asm["_emscripten_bind_ConcreteContactResultCallback___destroy___0"];var _emscripten_bind_btCollisionObject___destroy___0=Module["_emscripten_bind_btCollisionObject___destroy___0"]=asm["_emscripten_bind_btCollisionObject___destroy___0"];var _emscripten_bind_btVehicleTuning_set_m_suspensionDamping_1=Module["_emscripten_bind_btVehicleTuning_set_m_suspensionDamping_1"]=asm["_emscripten_bind_btVehicleTuning_set_m_suspensionDamping_1"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_linearSleepingThreshold_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_linearSleepingThreshold_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_linearSleepingThreshold_1"];var _emscripten_bind_btConeTwistConstraint_setMotorTargetInConstraintSpace_1=Module["_emscripten_bind_btConeTwistConstraint_setMotorTargetInConstraintSpace_1"]=asm["_emscripten_bind_btConeTwistConstraint_setMotorTargetInConstraintSpace_1"];var _emscripten_bind_btDispatcherInfo_set_m_timeStep_1=Module["_emscripten_bind_btDispatcherInfo_set_m_timeStep_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_timeStep_1"];var _emscripten_bind_btVector3_btVector3_3=Module["_emscripten_bind_btVector3_btVector3_3"]=asm["_emscripten_bind_btVector3_btVector3_3"];var _emscripten_bind_btVector3_btVector3_0=Module["_emscripten_bind_btVector3_btVector3_0"]=asm["_emscripten_bind_btVector3_btVector3_0"];var _emscripten_bind_btBoxShape___destroy___0=Module["_emscripten_bind_btBoxShape___destroy___0"]=asm["_emscripten_bind_btBoxShape___destroy___0"];var _emscripten_bind_btDiscreteDynamicsWorld_getGravity_0=Module["_emscripten_bind_btDiscreteDynamicsWorld_getGravity_0"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_getGravity_0"];var _emscripten_bind_ClosestConvexResultCallback_get_m_hitPointWorld_0=Module["_emscripten_bind_ClosestConvexResultCallback_get_m_hitPointWorld_0"]=asm["_emscripten_bind_ClosestConvexResultCallback_get_m_hitPointWorld_0"];var _emscripten_bind_btVehicleTuning_get_m_suspensionDamping_0=Module["_emscripten_bind_btVehicleTuning_get_m_suspensionDamping_0"]=asm["_emscripten_bind_btVehicleTuning_get_m_suspensionDamping_0"];var _emscripten_bind_btConeTwistConstraint___destroy___0=Module["_emscripten_bind_btConeTwistConstraint___destroy___0"]=asm["_emscripten_bind_btConeTwistConstraint___destroy___0"];var _emscripten_bind_btQuadWord___destroy___0=Module["_emscripten_bind_btQuadWord___destroy___0"]=asm["_emscripten_bind_btQuadWord___destroy___0"];var _emscripten_bind_ClosestRayResultCallback_set_m_rayFromWorld_1=Module["_emscripten_bind_ClosestRayResultCallback_set_m_rayFromWorld_1"]=asm["_emscripten_bind_ClosestRayResultCallback_set_m_rayFromWorld_1"];var _emscripten_bind_btRigidBody_setCenterOfMassTransform_1=Module["_emscripten_bind_btRigidBody_setCenterOfMassTransform_1"]=asm["_emscripten_bind_btRigidBody_setCenterOfMassTransform_1"];var _emscripten_bind_btConstraintSolver___destroy___0=Module["_emscripten_bind_btConstraintSolver___destroy___0"]=asm["_emscripten_bind_btConstraintSolver___destroy___0"];var _emscripten_bind_btDbvtBroadphase___destroy___0=Module["_emscripten_bind_btDbvtBroadphase___destroy___0"]=asm["_emscripten_bind_btDbvtBroadphase___destroy___0"];var _emscripten_bind_btCapsuleShape_btCapsuleShape_2=Module["_emscripten_bind_btCapsuleShape_btCapsuleShape_2"]=asm["_emscripten_bind_btCapsuleShape_btCapsuleShape_2"];var _emscripten_bind_btTypedConstraint_enableFeedback_1=Module["_emscripten_bind_btTypedConstraint_enableFeedback_1"]=asm["_emscripten_bind_btTypedConstraint_enableFeedback_1"];var _emscripten_bind_btQuadWord_setZ_1=Module["_emscripten_bind_btQuadWord_setZ_1"]=asm["_emscripten_bind_btQuadWord_setZ_1"];var _emscripten_bind_btCapsuleShape_setLocalScaling_1=Module["_emscripten_bind_btCapsuleShape_setLocalScaling_1"]=asm["_emscripten_bind_btCapsuleShape_setLocalScaling_1"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDampingFactor_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDampingFactor_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDampingFactor_0"];var _emscripten_bind_btTriangleMeshShape_setLocalScaling_1=Module["_emscripten_bind_btTriangleMeshShape_setLocalScaling_1"]=asm["_emscripten_bind_btTriangleMeshShape_setLocalScaling_1"];var _emscripten_bind_ConvexResultCallback_set_m_closestHitFraction_1=Module["_emscripten_bind_ConvexResultCallback_set_m_closestHitFraction_1"]=asm["_emscripten_bind_ConvexResultCallback_set_m_closestHitFraction_1"];var _emscripten_bind_btPersistentManifold_btPersistentManifold_0=Module["_emscripten_bind_btPersistentManifold_btPersistentManifold_0"]=asm["_emscripten_bind_btPersistentManifold_btPersistentManifold_0"];var _emscripten_bind_ConvexResultCallback_get_m_collisionFilterMask_0=Module["_emscripten_bind_ConvexResultCallback_get_m_collisionFilterMask_0"]=asm["_emscripten_bind_ConvexResultCallback_get_m_collisionFilterMask_0"];var _emscripten_bind_ClosestRayResultCallback_ClosestRayResultCallback_2=Module["_emscripten_bind_ClosestRayResultCallback_ClosestRayResultCallback_2"]=asm["_emscripten_bind_ClosestRayResultCallback_ClosestRayResultCallback_2"];var _emscripten_bind_btVector4___destroy___0=Module["_emscripten_bind_btVector4___destroy___0"]=asm["_emscripten_bind_btVector4___destroy___0"];var _emscripten_bind_btPairCachingGhostObject_isKinematicObject_0=Module["_emscripten_bind_btPairCachingGhostObject_isKinematicObject_0"]=asm["_emscripten_bind_btPairCachingGhostObject_isKinematicObject_0"];var _emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterMask_1=Module["_emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterMask_1"]=asm["_emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterMask_1"];var _i64Add=Module["_i64Add"]=asm["_i64Add"];var _emscripten_bind_btStaticPlaneShape_calculateLocalInertia_2=Module["_emscripten_bind_btStaticPlaneShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btStaticPlaneShape_calculateLocalInertia_2"];var _emscripten_bind_btVehicleTuning_set_m_maxSuspensionForce_1=Module["_emscripten_bind_btVehicleTuning_set_m_maxSuspensionForce_1"]=asm["_emscripten_bind_btVehicleTuning_set_m_maxSuspensionForce_1"];var _emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_0=Module["_emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_0"]=asm["_emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_0"];var _emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_1=Module["_emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_1"]=asm["_emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_1"];var _emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_3=Module["_emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_3"]=asm["_emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_3"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_angularSleepingThreshold_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_angularSleepingThreshold_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_angularSleepingThreshold_0"];var _emscripten_bind_btPoint2PointConstraint_getPivotInB_0=Module["_emscripten_bind_btPoint2PointConstraint_getPivotInB_0"]=asm["_emscripten_bind_btPoint2PointConstraint_getPivotInB_0"];var _emscripten_bind_btKinematicCharacterController_playerStep_2=Module["_emscripten_bind_btKinematicCharacterController_playerStep_2"]=asm["_emscripten_bind_btKinematicCharacterController_playerStep_2"];var _emscripten_bind_btDispatcherInfo___destroy___0=Module["_emscripten_bind_btDispatcherInfo___destroy___0"]=asm["_emscripten_bind_btDispatcherInfo___destroy___0"];var _emscripten_bind_btStaticPlaneShape_setLocalScaling_1=Module["_emscripten_bind_btStaticPlaneShape_setLocalScaling_1"]=asm["_emscripten_bind_btStaticPlaneShape_setLocalScaling_1"];var _emscripten_bind_btConvexTriangleMeshShape_calculateLocalInertia_2=Module["_emscripten_bind_btConvexTriangleMeshShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btConvexTriangleMeshShape_calculateLocalInertia_2"];var _emscripten_bind_ContactResultCallback_addSingleResult_7=Module["_emscripten_bind_ContactResultCallback_addSingleResult_7"]=asm["_emscripten_bind_ContactResultCallback_addSingleResult_7"];var _emscripten_bind_btGhostObject_getWorldTransform_0=Module["_emscripten_bind_btGhostObject_getWorldTransform_0"]=asm["_emscripten_bind_btGhostObject_getWorldTransform_0"];var _emscripten_bind_btDiscreteDynamicsWorld_getPairCache_0=Module["_emscripten_bind_btDiscreteDynamicsWorld_getPairCache_0"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_getPairCache_0"];var _emscripten_bind_LocalConvexResult_set_m_hitFraction_1=Module["_emscripten_bind_LocalConvexResult_set_m_hitFraction_1"]=asm["_emscripten_bind_LocalConvexResult_set_m_hitFraction_1"];var _emscripten_bind_btCapsuleShapeZ_calculateLocalInertia_2=Module["_emscripten_bind_btCapsuleShapeZ_calculateLocalInertia_2"]=asm["_emscripten_bind_btCapsuleShapeZ_calculateLocalInertia_2"];var _emscripten_bind_btDispatcherInfo_get_m_timeStep_0=Module["_emscripten_bind_btDispatcherInfo_get_m_timeStep_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_timeStep_0"];var _emscripten_bind_btVehicleTuning_set_m_suspensionCompression_1=Module["_emscripten_bind_btVehicleTuning_set_m_suspensionCompression_1"]=asm["_emscripten_bind_btVehicleTuning_set_m_suspensionCompression_1"];var _emscripten_bind_btDynamicsWorld___destroy___0=Module["_emscripten_bind_btDynamicsWorld___destroy___0"]=asm["_emscripten_bind_btDynamicsWorld___destroy___0"];var _emscripten_bind_btMotionState___destroy___0=Module["_emscripten_bind_btMotionState___destroy___0"]=asm["_emscripten_bind_btMotionState___destroy___0"];var _emscripten_bind_btCollisionObject_setCollisionFlags_1=Module["_emscripten_bind_btCollisionObject_setCollisionFlags_1"]=asm["_emscripten_bind_btCollisionObject_setCollisionFlags_1"];var _emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_1=Module["_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_1"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_1"];var _emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_2=Module["_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_2"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_2"];var _emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_3=Module["_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_3"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_3"];var _emscripten_bind_btWheelInfo_set_m_suspensionStiffness_1=Module["_emscripten_bind_btWheelInfo_set_m_suspensionStiffness_1"]=asm["_emscripten_bind_btWheelInfo_set_m_suspensionStiffness_1"];var _emscripten_bind_btRaycastVehicle_getNumWheels_0=Module["_emscripten_bind_btRaycastVehicle_getNumWheels_0"]=asm["_emscripten_bind_btRaycastVehicle_getNumWheels_0"];var _emscripten_bind_btDispatcher_getManifoldByIndexInternal_1=Module["_emscripten_bind_btDispatcher_getManifoldByIndexInternal_1"]=asm["_emscripten_bind_btDispatcher_getManifoldByIndexInternal_1"];var _emscripten_bind_btWheelInfo_set_m_steering_1=Module["_emscripten_bind_btWheelInfo_set_m_steering_1"]=asm["_emscripten_bind_btWheelInfo_set_m_steering_1"];var _emscripten_bind_btPairCachingGhostObject_setWorldTransform_1=Module["_emscripten_bind_btPairCachingGhostObject_setWorldTransform_1"]=asm["_emscripten_bind_btPairCachingGhostObject_setWorldTransform_1"];var _emscripten_bind_btConeTwistConstraint_setAngularOnly_1=Module["_emscripten_bind_btConeTwistConstraint_setAngularOnly_1"]=asm["_emscripten_bind_btConeTwistConstraint_setAngularOnly_1"];var _emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_4=Module["_emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_4"]=asm["_emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_4"];var _emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_2=Module["_emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_2"]=asm["_emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_2"];var _emscripten_bind_btKinematicCharacterController_setJumpSpeed_1=Module["_emscripten_bind_btKinematicCharacterController_setJumpSpeed_1"]=asm["_emscripten_bind_btKinematicCharacterController_setJumpSpeed_1"];var _emscripten_bind_ConvexResultCallback_set_m_collisionFilterGroup_1=Module["_emscripten_bind_ConvexResultCallback_set_m_collisionFilterGroup_1"]=asm["_emscripten_bind_ConvexResultCallback_set_m_collisionFilterGroup_1"];var _emscripten_bind_btPairCachingGhostObject_getOverlappingObject_1=Module["_emscripten_bind_btPairCachingGhostObject_getOverlappingObject_1"]=asm["_emscripten_bind_btPairCachingGhostObject_getOverlappingObject_1"];var _emscripten_bind_btRigidBodyConstructionInfo___destroy___0=Module["_emscripten_bind_btRigidBodyConstructionInfo___destroy___0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo___destroy___0"];var _emscripten_bind_btRigidBody_getWorldTransform_0=Module["_emscripten_bind_btRigidBody_getWorldTransform_0"]=asm["_emscripten_bind_btRigidBody_getWorldTransform_0"];var _emscripten_bind_btPoint2PointConstraint_setPivotA_1=Module["_emscripten_bind_btPoint2PointConstraint_setPivotA_1"]=asm["_emscripten_bind_btPoint2PointConstraint_setPivotA_1"];var _emscripten_bind_ClosestConvexResultCallback_set_m_convexToWorld_1=Module["_emscripten_bind_ClosestConvexResultCallback_set_m_convexToWorld_1"]=asm["_emscripten_bind_ClosestConvexResultCallback_set_m_convexToWorld_1"];var _memcpy=Module["_memcpy"]=asm["_memcpy"];var _emscripten_bind_btCapsuleShape_calculateLocalInertia_2=Module["_emscripten_bind_btCapsuleShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btCapsuleShape_calculateLocalInertia_2"];var _emscripten_bind_btVector3_y_0=Module["_emscripten_bind_btVector3_y_0"]=asm["_emscripten_bind_btVector3_y_0"];var _emscripten_bind_btVehicleTuning_get_m_maxSuspensionForce_0=Module["_emscripten_bind_btVehicleTuning_get_m_maxSuspensionForce_0"]=asm["_emscripten_bind_btVehicleTuning_get_m_maxSuspensionForce_0"];var _emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_2=Module["_emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_2"]=asm["_emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_2"];var _emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_3=Module["_emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_3"]=asm["_emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_3"];var _emscripten_bind_LocalShapeInfo_get_m_triangleIndex_0=Module["_emscripten_bind_LocalShapeInfo_get_m_triangleIndex_0"]=asm["_emscripten_bind_LocalShapeInfo_get_m_triangleIndex_0"];var _emscripten_bind_btGhostObject_setCollisionShape_1=Module["_emscripten_bind_btGhostObject_setCollisionShape_1"]=asm["_emscripten_bind_btGhostObject_setCollisionShape_1"];var _emscripten_bind_btDispatcherInfo_set_m_allowedCcdPenetration_1=Module["_emscripten_bind_btDispatcherInfo_set_m_allowedCcdPenetration_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_allowedCcdPenetration_1"];var _emscripten_bind_btQuaternion_setW_1=Module["_emscripten_bind_btQuaternion_setW_1"]=asm["_emscripten_bind_btQuaternion_setW_1"];var _emscripten_bind_btDiscreteDynamicsWorld_setGravity_1=Module["_emscripten_bind_btDiscreteDynamicsWorld_setGravity_1"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_setGravity_1"];var _emscripten_bind_btGhostObject_isActive_0=Module["_emscripten_bind_btGhostObject_isActive_0"]=asm["_emscripten_bind_btGhostObject_isActive_0"];var _emscripten_bind_btVector4_z_0=Module["_emscripten_bind_btVector4_z_0"]=asm["_emscripten_bind_btVector4_z_0"];var _emscripten_bind_btCollisionObject_forceActivationState_1=Module["_emscripten_bind_btCollisionObject_forceActivationState_1"]=asm["_emscripten_bind_btCollisionObject_forceActivationState_1"];var _emscripten_bind_btKinematicCharacterController_onGround_0=Module["_emscripten_bind_btKinematicCharacterController_onGround_0"]=asm["_emscripten_bind_btKinematicCharacterController_onGround_0"];var _emscripten_bind_btRaycastVehicle_getWheelInfo_1=Module["_emscripten_bind_btRaycastVehicle_getWheelInfo_1"]=asm["_emscripten_bind_btRaycastVehicle_getWheelInfo_1"];var _emscripten_bind_btConeTwistConstraint_setLimit_2=Module["_emscripten_bind_btConeTwistConstraint_setLimit_2"]=asm["_emscripten_bind_btConeTwistConstraint_setLimit_2"];var _emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterMask_1=Module["_emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterMask_1"]=asm["_emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterMask_1"];var _emscripten_bind_btRigidBody___destroy___0=Module["_emscripten_bind_btRigidBody___destroy___0"]=asm["_emscripten_bind_btRigidBody___destroy___0"];var _emscripten_bind_btStridingMeshInterface___destroy___0=Module["_emscripten_bind_btStridingMeshInterface___destroy___0"]=asm["_emscripten_bind_btStridingMeshInterface___destroy___0"];var _emscripten_bind_btRigidBody_setSleepingThresholds_2=Module["_emscripten_bind_btRigidBody_setSleepingThresholds_2"]=asm["_emscripten_bind_btRigidBody_setSleepingThresholds_2"];var _emscripten_bind_btCollisionObject_setWorldTransform_1=Module["_emscripten_bind_btCollisionObject_setWorldTransform_1"]=asm["_emscripten_bind_btCollisionObject_setWorldTransform_1"];var _emscripten_bind_LocalConvexResult_get_m_localShapeInfo_0=Module["_emscripten_bind_LocalConvexResult_get_m_localShapeInfo_0"]=asm["_emscripten_bind_LocalConvexResult_get_m_localShapeInfo_0"];var _emscripten_bind_btManifoldPoint_get_m_localPointA_0=Module["_emscripten_bind_btManifoldPoint_get_m_localPointA_0"]=asm["_emscripten_bind_btManifoldPoint_get_m_localPointA_0"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_linearDamping_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_linearDamping_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_linearDamping_0"];var _emscripten_bind_btCollisionWorld_getBroadphase_0=Module["_emscripten_bind_btCollisionWorld_getBroadphase_0"]=asm["_emscripten_bind_btCollisionWorld_getBroadphase_0"];var _emscripten_bind_btDispatcher_getNumManifolds_0=Module["_emscripten_bind_btDispatcher_getNumManifolds_0"]=asm["_emscripten_bind_btDispatcher_getNumManifolds_0"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_linearSleepingThreshold_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_linearSleepingThreshold_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_linearSleepingThreshold_0"];var _emscripten_bind_btRigidBody_activate_1=Module["_emscripten_bind_btRigidBody_activate_1"]=asm["_emscripten_bind_btRigidBody_activate_1"];var _emscripten_bind_btRigidBody_activate_0=Module["_emscripten_bind_btRigidBody_activate_0"]=asm["_emscripten_bind_btRigidBody_activate_0"];var _emscripten_bind_btRaycastVehicle___destroy___0=Module["_emscripten_bind_btRaycastVehicle___destroy___0"]=asm["_emscripten_bind_btRaycastVehicle___destroy___0"];var _emscripten_bind_btGhostObject_setActivationState_1=Module["_emscripten_bind_btGhostObject_setActivationState_1"]=asm["_emscripten_bind_btGhostObject_setActivationState_1"];var _emscripten_bind_btCollisionWorld_contactPairTest_3=Module["_emscripten_bind_btCollisionWorld_contactPairTest_3"]=asm["_emscripten_bind_btCollisionWorld_contactPairTest_3"];var _emscripten_bind_btCylinderShapeX___destroy___0=Module["_emscripten_bind_btCylinderShapeX___destroy___0"]=asm["_emscripten_bind_btCylinderShapeX___destroy___0"];var _emscripten_bind_btManifoldPoint_getPositionWorldOnA_0=Module["_emscripten_bind_btManifoldPoint_getPositionWorldOnA_0"]=asm["_emscripten_bind_btManifoldPoint_getPositionWorldOnA_0"];var _emscripten_bind_ContactResultCallback___destroy___0=Module["_emscripten_bind_ContactResultCallback___destroy___0"]=asm["_emscripten_bind_ContactResultCallback___destroy___0"];var _emscripten_bind_btDispatcherInfo_set_m_stepCount_1=Module["_emscripten_bind_btDispatcherInfo_set_m_stepCount_1"]=asm["_emscripten_bind_btDispatcherInfo_set_m_stepCount_1"];var _emscripten_bind_btVector4_x_0=Module["_emscripten_bind_btVector4_x_0"]=asm["_emscripten_bind_btVector4_x_0"];var _emscripten_bind_btPairCachingGhostObject_setCollisionFlags_1=Module["_emscripten_bind_btPairCachingGhostObject_setCollisionFlags_1"]=asm["_emscripten_bind_btPairCachingGhostObject_setCollisionFlags_1"];var _emscripten_bind_btKinematicCharacterController_getGhostObject_0=Module["_emscripten_bind_btKinematicCharacterController_getGhostObject_0"]=asm["_emscripten_bind_btKinematicCharacterController_getGhostObject_0"];var _emscripten_bind_btRigidBody_btRigidBody_1=Module["_emscripten_bind_btRigidBody_btRigidBody_1"]=asm["_emscripten_bind_btRigidBody_btRigidBody_1"];var _emscripten_bind_btTriangleMeshShape___destroy___0=Module["_emscripten_bind_btTriangleMeshShape___destroy___0"]=asm["_emscripten_bind_btTriangleMeshShape___destroy___0"];var _emscripten_bind_btKinematicCharacterController_setWalkDirection_1=Module["_emscripten_bind_btKinematicCharacterController_setWalkDirection_1"]=asm["_emscripten_bind_btKinematicCharacterController_setWalkDirection_1"];var _emscripten_bind_btRigidBodyConstructionInfo_get_m_restitution_0=Module["_emscripten_bind_btRigidBodyConstructionInfo_get_m_restitution_0"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_get_m_restitution_0"];var _emscripten_bind_btVehicleTuning_get_m_suspensionStiffness_0=Module["_emscripten_bind_btVehicleTuning_get_m_suspensionStiffness_0"]=asm["_emscripten_bind_btVehicleTuning_get_m_suspensionStiffness_0"];var _emscripten_bind_btManifoldPoint_set_m_normalWorldOnB_1=Module["_emscripten_bind_btManifoldPoint_set_m_normalWorldOnB_1"]=asm["_emscripten_bind_btManifoldPoint_set_m_normalWorldOnB_1"];var _emscripten_bind_btKinematicCharacterController_getGravity_0=Module["_emscripten_bind_btKinematicCharacterController_getGravity_0"]=asm["_emscripten_bind_btKinematicCharacterController_getGravity_0"];var _emscripten_bind_btDiscreteDynamicsWorld_addAction_1=Module["_emscripten_bind_btDiscreteDynamicsWorld_addAction_1"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_addAction_1"];var _emscripten_bind_btQuaternion_setY_1=Module["_emscripten_bind_btQuaternion_setY_1"]=asm["_emscripten_bind_btQuaternion_setY_1"];var _emscripten_bind_btConeShape_calculateLocalInertia_2=Module["_emscripten_bind_btConeShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btConeShape_calculateLocalInertia_2"];var _emscripten_bind_btCylinderShapeX_calculateLocalInertia_2=Module["_emscripten_bind_btCylinderShapeX_calculateLocalInertia_2"]=asm["_emscripten_bind_btCylinderShapeX_calculateLocalInertia_2"];var _emscripten_bind_ConvexResultCallback_set_m_collisionFilterMask_1=Module["_emscripten_bind_ConvexResultCallback_set_m_collisionFilterMask_1"]=asm["_emscripten_bind_ConvexResultCallback_set_m_collisionFilterMask_1"];var _llvm_bswap_i32=Module["_llvm_bswap_i32"]=asm["_llvm_bswap_i32"];var _emscripten_bind_btSphereShape_setLocalScaling_1=Module["_emscripten_bind_btSphereShape_setLocalScaling_1"]=asm["_emscripten_bind_btSphereShape_setLocalScaling_1"];var _emscripten_bind_btVector4_w_0=Module["_emscripten_bind_btVector4_w_0"]=asm["_emscripten_bind_btVector4_w_0"];var _emscripten_bind_btManifoldPoint_get_m_normalWorldOnB_0=Module["_emscripten_bind_btManifoldPoint_get_m_normalWorldOnB_0"]=asm["_emscripten_bind_btManifoldPoint_get_m_normalWorldOnB_0"];var _emscripten_bind_btBvhTriangleMeshShape___destroy___0=Module["_emscripten_bind_btBvhTriangleMeshShape___destroy___0"]=asm["_emscripten_bind_btBvhTriangleMeshShape___destroy___0"];var _emscripten_bind_ClosestRayResultCallback_get_m_rayToWorld_0=Module["_emscripten_bind_ClosestRayResultCallback_get_m_rayToWorld_0"]=asm["_emscripten_bind_ClosestRayResultCallback_get_m_rayToWorld_0"];var _emscripten_bind_ClosestConvexResultCallback_set_m_closestHitFraction_1=Module["_emscripten_bind_ClosestConvexResultCallback_set_m_closestHitFraction_1"]=asm["_emscripten_bind_ClosestConvexResultCallback_set_m_closestHitFraction_1"];var _emscripten_bind_btDiscreteDynamicsWorld_removeConstraint_1=Module["_emscripten_bind_btDiscreteDynamicsWorld_removeConstraint_1"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_removeConstraint_1"];var _emscripten_bind_btVector4_y_0=Module["_emscripten_bind_btVector4_y_0"]=asm["_emscripten_bind_btVector4_y_0"];var _emscripten_bind_btGeneric6DofConstraint___destroy___0=Module["_emscripten_bind_btGeneric6DofConstraint___destroy___0"]=asm["_emscripten_bind_btGeneric6DofConstraint___destroy___0"];var _emscripten_bind_btVehicleTuning_get_m_maxSuspensionTravelCm_0=Module["_emscripten_bind_btVehicleTuning_get_m_maxSuspensionTravelCm_0"]=asm["_emscripten_bind_btVehicleTuning_get_m_maxSuspensionTravelCm_0"];var _emscripten_bind_btConvexHullShape_addPoint_1=Module["_emscripten_bind_btConvexHullShape_addPoint_1"]=asm["_emscripten_bind_btConvexHullShape_addPoint_1"];var _emscripten_bind_btConvexHullShape_addPoint_2=Module["_emscripten_bind_btConvexHullShape_addPoint_2"]=asm["_emscripten_bind_btConvexHullShape_addPoint_2"];var _emscripten_bind_btTransform_getOrigin_0=Module["_emscripten_bind_btTransform_getOrigin_0"]=asm["_emscripten_bind_btTransform_getOrigin_0"];var _emscripten_bind_btHingeConstraint___destroy___0=Module["_emscripten_bind_btHingeConstraint___destroy___0"]=asm["_emscripten_bind_btHingeConstraint___destroy___0"];var _emscripten_bind_btHingeConstraint_enableFeedback_1=Module["_emscripten_bind_btHingeConstraint_enableFeedback_1"]=asm["_emscripten_bind_btHingeConstraint_enableFeedback_1"];var _emscripten_bind_btConvexShape_calculateLocalInertia_2=Module["_emscripten_bind_btConvexShape_calculateLocalInertia_2"]=asm["_emscripten_bind_btConvexShape_calculateLocalInertia_2"];var _memset=Module["_memset"]=asm["_memset"];var _emscripten_bind_ClosestRayResultCallback_get_m_hitNormalWorld_0=Module["_emscripten_bind_ClosestRayResultCallback_get_m_hitNormalWorld_0"]=asm["_emscripten_bind_ClosestRayResultCallback_get_m_hitNormalWorld_0"];var _emscripten_bind_btTriangleMesh_btTriangleMesh_0=Module["_emscripten_bind_btTriangleMesh_btTriangleMesh_0"]=asm["_emscripten_bind_btTriangleMesh_btTriangleMesh_0"];var _emscripten_bind_btPairCachingGhostObject_getCollisionShape_0=Module["_emscripten_bind_btPairCachingGhostObject_getCollisionShape_0"]=asm["_emscripten_bind_btPairCachingGhostObject_getCollisionShape_0"];var _emscripten_bind_btTriangleMesh_btTriangleMesh_2=Module["_emscripten_bind_btTriangleMesh_btTriangleMesh_2"]=asm["_emscripten_bind_btTriangleMesh_btTriangleMesh_2"];var _emscripten_bind_btTransform___destroy___0=Module["_emscripten_bind_btTransform___destroy___0"]=asm["_emscripten_bind_btTransform___destroy___0"];var _emscripten_bind_btWheelInfo_set_m_frictionSlip_1=Module["_emscripten_bind_btWheelInfo_set_m_frictionSlip_1"]=asm["_emscripten_bind_btWheelInfo_set_m_frictionSlip_1"];var _emscripten_bind_btRigidBody_getCollisionShape_0=Module["_emscripten_bind_btRigidBody_getCollisionShape_0"]=asm["_emscripten_bind_btRigidBody_getCollisionShape_0"];var _emscripten_bind_btManifoldPoint_set_m_positionWorldOnA_1=Module["_emscripten_bind_btManifoldPoint_set_m_positionWorldOnA_1"]=asm["_emscripten_bind_btManifoldPoint_set_m_positionWorldOnA_1"];var _emscripten_bind_btWheelInfo_get_m_wheelsDampingRelaxation_0=Module["_emscripten_bind_btWheelInfo_get_m_wheelsDampingRelaxation_0"]=asm["_emscripten_bind_btWheelInfo_get_m_wheelsDampingRelaxation_0"];var _emscripten_bind_btManifoldPoint_get_m_localPointB_0=Module["_emscripten_bind_btManifoldPoint_get_m_localPointB_0"]=asm["_emscripten_bind_btManifoldPoint_get_m_localPointB_0"];var _emscripten_bind_btDiscreteDynamicsWorld_contactPairTest_3=Module["_emscripten_bind_btDiscreteDynamicsWorld_contactPairTest_3"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_contactPairTest_3"];var _emscripten_bind_btSliderConstraint_setLowerLinLimit_1=Module["_emscripten_bind_btSliderConstraint_setLowerLinLimit_1"]=asm["_emscripten_bind_btSliderConstraint_setLowerLinLimit_1"];var _emscripten_bind_btPoint2PointConstraint_set_m_setting_1=Module["_emscripten_bind_btPoint2PointConstraint_set_m_setting_1"]=asm["_emscripten_bind_btPoint2PointConstraint_set_m_setting_1"];var _emscripten_bind_btWheelInfo_get_m_wheelsRadius_0=Module["_emscripten_bind_btWheelInfo_get_m_wheelsRadius_0"]=asm["_emscripten_bind_btWheelInfo_get_m_wheelsRadius_0"];var _emscripten_bind_btRigidBody_setLinearVelocity_1=Module["_emscripten_bind_btRigidBody_setLinearVelocity_1"]=asm["_emscripten_bind_btRigidBody_setLinearVelocity_1"];var _emscripten_bind_btVehicleTuning_btVehicleTuning_0=Module["_emscripten_bind_btVehicleTuning_btVehicleTuning_0"]=asm["_emscripten_bind_btVehicleTuning_btVehicleTuning_0"];var _emscripten_bind_RayResultCallback_set_m_collisionObject_1=Module["_emscripten_bind_RayResultCallback_set_m_collisionObject_1"]=asm["_emscripten_bind_RayResultCallback_set_m_collisionObject_1"];var _emscripten_bind_ClosestRayResultCallback_set_m_rayToWorld_1=Module["_emscripten_bind_ClosestRayResultCallback_set_m_rayToWorld_1"]=asm["_emscripten_bind_ClosestRayResultCallback_set_m_rayToWorld_1"];var _emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterGroup_0=Module["_emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterGroup_0"]=asm["_emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterGroup_0"];var _emscripten_bind_btWheelInfo_set_m_wheelsDampingRelaxation_1=Module["_emscripten_bind_btWheelInfo_set_m_wheelsDampingRelaxation_1"]=asm["_emscripten_bind_btWheelInfo_set_m_wheelsDampingRelaxation_1"];var _emscripten_bind_btDynamicsWorld_addAction_1=Module["_emscripten_bind_btDynamicsWorld_addAction_1"]=asm["_emscripten_bind_btDynamicsWorld_addAction_1"];var _emscripten_bind_btPairCachingGhostObject_getCollisionFlags_0=Module["_emscripten_bind_btPairCachingGhostObject_getCollisionFlags_0"]=asm["_emscripten_bind_btPairCachingGhostObject_getCollisionFlags_0"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_linearDamping_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_linearDamping_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_linearDamping_1"];var _emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDamping_1=Module["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDamping_1"]=asm["_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDamping_1"];var _emscripten_bind_btKinematicCharacterController_setFallSpeed_1=Module["_emscripten_bind_btKinematicCharacterController_setFallSpeed_1"]=asm["_emscripten_bind_btKinematicCharacterController_setFallSpeed_1"];var _emscripten_bind_btRigidBody_setActivationState_1=Module["_emscripten_bind_btRigidBody_setActivationState_1"]=asm["_emscripten_bind_btRigidBody_setActivationState_1"];var _emscripten_bind_ClosestConvexResultCallback_hasHit_0=Module["_emscripten_bind_ClosestConvexResultCallback_hasHit_0"]=asm["_emscripten_bind_ClosestConvexResultCallback_hasHit_0"];var _emscripten_bind_btCapsuleShapeZ___destroy___0=Module["_emscripten_bind_btCapsuleShapeZ___destroy___0"]=asm["_emscripten_bind_btCapsuleShapeZ___destroy___0"];var _emscripten_bind_LocalShapeInfo_set_m_shapePart_1=Module["_emscripten_bind_LocalShapeInfo_set_m_shapePart_1"]=asm["_emscripten_bind_LocalShapeInfo_set_m_shapePart_1"];var _emscripten_bind_ClosestRayResultCallback_get_m_collisionObject_0=Module["_emscripten_bind_ClosestRayResultCallback_get_m_collisionObject_0"]=asm["_emscripten_bind_ClosestRayResultCallback_get_m_collisionObject_0"];var _emscripten_bind_btTriangleMesh_addTriangle_3=Module["_emscripten_bind_btTriangleMesh_addTriangle_3"]=asm["_emscripten_bind_btTriangleMesh_addTriangle_3"];var _emscripten_bind_btGhostObject_getOverlappingObject_1=Module["_emscripten_bind_btGhostObject_getOverlappingObject_1"]=asm["_emscripten_bind_btGhostObject_getOverlappingObject_1"];var _emscripten_bind_btTriangleMesh_addTriangle_4=Module["_emscripten_bind_btTriangleMesh_addTriangle_4"]=asm["_emscripten_bind_btTriangleMesh_addTriangle_4"];var _emscripten_bind_btRigidBody_applyTorqueImpulse_1=Module["_emscripten_bind_btRigidBody_applyTorqueImpulse_1"]=asm["_emscripten_bind_btRigidBody_applyTorqueImpulse_1"];var _emscripten_bind_btRigidBody_setCollisionFlags_1=Module["_emscripten_bind_btRigidBody_setCollisionFlags_1"]=asm["_emscripten_bind_btRigidBody_setCollisionFlags_1"];var _emscripten_bind_btWheelInfo_set_m_suspensionRestLength1_1=Module["_emscripten_bind_btWheelInfo_set_m_suspensionRestLength1_1"]=asm["_emscripten_bind_btWheelInfo_set_m_suspensionRestLength1_1"];var _emscripten_bind_btConeShape___destroy___0=Module["_emscripten_bind_btConeShape___destroy___0"]=asm["_emscripten_bind_btConeShape___destroy___0"];var _emscripten_bind_btCapsuleShapeZ_btCapsuleShapeZ_2=Module["_emscripten_bind_btCapsuleShapeZ_btCapsuleShapeZ_2"]=asm["_emscripten_bind_btCapsuleShapeZ_btCapsuleShapeZ_2"];var _emscripten_bind_btSliderConstraint_btSliderConstraint_5=Module["_emscripten_bind_btSliderConstraint_btSliderConstraint_5"]=asm["_emscripten_bind_btSliderConstraint_btSliderConstraint_5"];var _emscripten_bind_btSliderConstraint_btSliderConstraint_3=Module["_emscripten_bind_btSliderConstraint_btSliderConstraint_3"]=asm["_emscripten_bind_btSliderConstraint_btSliderConstraint_3"];var _emscripten_bind_btDispatcherInfo_get_m_allowedCcdPenetration_0=Module["_emscripten_bind_btDispatcherInfo_get_m_allowedCcdPenetration_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_allowedCcdPenetration_0"];var _emscripten_bind_btDynamicsWorld_convexSweepTest_5=Module["_emscripten_bind_btDynamicsWorld_convexSweepTest_5"]=asm["_emscripten_bind_btDynamicsWorld_convexSweepTest_5"];var _emscripten_bind_btRigidBody_forceActivationState_1=Module["_emscripten_bind_btRigidBody_forceActivationState_1"]=asm["_emscripten_bind_btRigidBody_forceActivationState_1"];var _emscripten_bind_btPoint2PointConstraint_setPivotB_1=Module["_emscripten_bind_btPoint2PointConstraint_setPivotB_1"]=asm["_emscripten_bind_btPoint2PointConstraint_setPivotB_1"];var _emscripten_bind_btGhostPairCallback___destroy___0=Module["_emscripten_bind_btGhostPairCallback___destroy___0"]=asm["_emscripten_bind_btGhostPairCallback___destroy___0"];var _emscripten_bind_btKinematicCharacterController_getMaxSlope_0=Module["_emscripten_bind_btKinematicCharacterController_getMaxSlope_0"]=asm["_emscripten_bind_btKinematicCharacterController_getMaxSlope_0"];var _emscripten_bind_btSliderConstraint_enableFeedback_1=Module["_emscripten_bind_btSliderConstraint_enableFeedback_1"]=asm["_emscripten_bind_btSliderConstraint_enableFeedback_1"];var _emscripten_bind_btRaycastVehicle_addWheel_7=Module["_emscripten_bind_btRaycastVehicle_addWheel_7"]=asm["_emscripten_bind_btRaycastVehicle_addWheel_7"];var _emscripten_bind_btPairCachingGhostObject_isActive_0=Module["_emscripten_bind_btPairCachingGhostObject_isActive_0"]=asm["_emscripten_bind_btPairCachingGhostObject_isActive_0"];var _emscripten_bind_LocalConvexResult_set_m_localShapeInfo_1=Module["_emscripten_bind_LocalConvexResult_set_m_localShapeInfo_1"]=asm["_emscripten_bind_LocalConvexResult_set_m_localShapeInfo_1"];var _emscripten_bind_btStaticPlaneShape___destroy___0=Module["_emscripten_bind_btStaticPlaneShape___destroy___0"]=asm["_emscripten_bind_btStaticPlaneShape___destroy___0"];var _emscripten_bind_btDispatcherInfo_get_m_useConvexConservativeDistanceUtil_0=Module["_emscripten_bind_btDispatcherInfo_get_m_useConvexConservativeDistanceUtil_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_useConvexConservativeDistanceUtil_0"];var _emscripten_bind_btBoxShape_setLocalScaling_1=Module["_emscripten_bind_btBoxShape_setLocalScaling_1"]=asm["_emscripten_bind_btBoxShape_setLocalScaling_1"];var _emscripten_bind_btConeShapeZ___destroy___0=Module["_emscripten_bind_btConeShapeZ___destroy___0"]=asm["_emscripten_bind_btConeShapeZ___destroy___0"];var _emscripten_bind_btDynamicsWorld_getPairCache_0=Module["_emscripten_bind_btDynamicsWorld_getPairCache_0"]=asm["_emscripten_bind_btDynamicsWorld_getPairCache_0"];var _emscripten_bind_btDiscreteDynamicsWorld_convexSweepTest_5=Module["_emscripten_bind_btDiscreteDynamicsWorld_convexSweepTest_5"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_convexSweepTest_5"];var _emscripten_bind_btKinematicCharacterController_setVelocityForTimeInterval_2=Module["_emscripten_bind_btKinematicCharacterController_setVelocityForTimeInterval_2"]=asm["_emscripten_bind_btKinematicCharacterController_setVelocityForTimeInterval_2"];var _emscripten_bind_btVector4_btVector4_0=Module["_emscripten_bind_btVector4_btVector4_0"]=asm["_emscripten_bind_btVector4_btVector4_0"];var _emscripten_bind_btDispatcherInfo_get_m_enableSatConvex_0=Module["_emscripten_bind_btDispatcherInfo_get_m_enableSatConvex_0"]=asm["_emscripten_bind_btDispatcherInfo_get_m_enableSatConvex_0"];var _emscripten_bind_btVector4_btVector4_4=Module["_emscripten_bind_btVector4_btVector4_4"]=asm["_emscripten_bind_btVector4_btVector4_4"];var _emscripten_bind_btKinematicCharacterController___destroy___0=Module["_emscripten_bind_btKinematicCharacterController___destroy___0"]=asm["_emscripten_bind_btKinematicCharacterController___destroy___0"];var _emscripten_bind_LocalConvexResult_set_m_hitCollisionObject_1=Module["_emscripten_bind_LocalConvexResult_set_m_hitCollisionObject_1"]=asm["_emscripten_bind_LocalConvexResult_set_m_hitCollisionObject_1"];var _emscripten_bind_btConstraintSetting_btConstraintSetting_0=Module["_emscripten_bind_btConstraintSetting_btConstraintSetting_0"]=asm["_emscripten_bind_btConstraintSetting_btConstraintSetting_0"];var _emscripten_bind_btDiscreteDynamicsWorld_rayTest_3=Module["_emscripten_bind_btDiscreteDynamicsWorld_rayTest_3"]=asm["_emscripten_bind_btDiscreteDynamicsWorld_rayTest_3"];var _emscripten_bind_btGhostPairCallback_btGhostPairCallback_0=Module["_emscripten_bind_btGhostPairCallback_btGhostPairCallback_0"]=asm["_emscripten_bind_btGhostPairCallback_btGhostPairCallback_0"];var _emscripten_bind_btKinematicCharacterController_setMaxJumpHeight_1=Module["_emscripten_bind_btKinematicCharacterController_setMaxJumpHeight_1"]=asm["_emscripten_bind_btKinematicCharacterController_setMaxJumpHeight_1"];var _emscripten_bind_ClosestRayResultCallback_set_m_hitNormalWorld_1=Module["_emscripten_bind_ClosestRayResultCallback_set_m_hitNormalWorld_1"]=asm["_emscripten_bind_ClosestRayResultCallback_set_m_hitNormalWorld_1"];var _emscripten_bind_btVehicleTuning_get_m_frictionSlip_0=Module["_emscripten_bind_btVehicleTuning_get_m_frictionSlip_0"]=asm["_emscripten_bind_btVehicleTuning_get_m_frictionSlip_0"];var __GLOBAL__I_a=Module["__GLOBAL__I_a"]=asm["__GLOBAL__I_a"];var runPostSets=Module["runPostSets"]=asm["runPostSets"];var dynCall_viiiii=Module["dynCall_viiiii"]=asm["dynCall_viiiii"];var dynCall_vid=Module["dynCall_vid"]=asm["dynCall_vid"];var dynCall_vi=Module["dynCall_vi"]=asm["dynCall_vi"];var dynCall_viiidii=Module["dynCall_viiidii"]=asm["dynCall_viiidii"];var dynCall_vii=Module["dynCall_vii"]=asm["dynCall_vii"];var dynCall_iiiiiiiiiii=Module["dynCall_iiiiiiiiiii"]=asm["dynCall_iiiiiiiiiii"];var dynCall_ii=Module["dynCall_ii"]=asm["dynCall_ii"];var dynCall_viidi=Module["dynCall_viidi"]=asm["dynCall_viidi"];var dynCall_viddiii=Module["dynCall_viddiii"]=asm["dynCall_viddiii"];var dynCall_vidii=Module["dynCall_vidii"]=asm["dynCall_vidii"];var dynCall_iiiii=Module["dynCall_iiiii"]=asm["dynCall_iiiii"];var dynCall_vidi=Module["dynCall_vidi"]=asm["dynCall_vidi"];var dynCall_diiiiiiii=Module["dynCall_diiiiiiii"]=asm["dynCall_diiiiiiii"];var dynCall_viiiiddddiid=Module["dynCall_viiiiddddiid"]=asm["dynCall_viiiiddddiid"];var dynCall_diiiii=Module["dynCall_diiiii"]=asm["dynCall_diiiii"];var dynCall_iiii=Module["dynCall_iiii"]=asm["dynCall_iiii"];var dynCall_viiiiii=Module["dynCall_viiiiii"]=asm["dynCall_viiiiii"];var dynCall_iiid=Module["dynCall_iiid"]=asm["dynCall_iiid"];var dynCall_di=Module["dynCall_di"]=asm["dynCall_di"];var dynCall_iiiiiii=Module["dynCall_iiiiiii"]=asm["dynCall_iiiiiii"];var dynCall_diiidii=Module["dynCall_diiidii"]=asm["dynCall_diiidii"];var dynCall_viidii=Module["dynCall_viidii"]=asm["dynCall_viidii"];var dynCall_viiiiiii=Module["dynCall_viiiiiii"]=asm["dynCall_viiiiiii"];var dynCall_viiiiiiiii=Module["dynCall_viiiiiiiii"]=asm["dynCall_viiiiiiiii"];var dynCall_viiiiiiiiii=Module["dynCall_viiiiiiiiii"]=asm["dynCall_viiiiiiiiii"];var dynCall_iii=Module["dynCall_iii"]=asm["dynCall_iii"];var dynCall_diii=Module["dynCall_diii"]=asm["dynCall_diii"];var dynCall_diiiiiiiiii=Module["dynCall_diiiiiiiiii"]=asm["dynCall_diiiiiiiiii"];var dynCall_viiiid=Module["dynCall_viiiid"]=asm["dynCall_viiiid"];var dynCall_diiiiiiiii=Module["dynCall_diiiiiiiii"]=asm["dynCall_diiiiiiiii"];var dynCall_did=Module["dynCall_did"]=asm["dynCall_did"];var dynCall_viiiidddddidi=Module["dynCall_viiiidddddidi"]=asm["dynCall_viiiidddddidi"];var dynCall_diidii=Module["dynCall_diidii"]=asm["dynCall_diidii"];var dynCall_diiii=Module["dynCall_diiii"]=asm["dynCall_diiii"];var dynCall_iiiiiiiiii=Module["dynCall_iiiiiiiiii"]=asm["dynCall_iiiiiiiiii"];var dynCall_viiid=Module["dynCall_viiid"]=asm["dynCall_viiid"];var dynCall_viii=Module["dynCall_viii"]=asm["dynCall_viii"];var dynCall_v=Module["dynCall_v"]=asm["dynCall_v"];var dynCall_viid=Module["dynCall_viid"]=asm["dynCall_viid"];var dynCall_iidid=Module["dynCall_iidid"]=asm["dynCall_iidid"];var dynCall_viiii=Module["dynCall_viiii"]=asm["dynCall_viiii"];Runtime.stackAlloc=asm["stackAlloc"];Runtime.stackSave=asm["stackSave"];Runtime.stackRestore=asm["stackRestore"];Runtime.setTempRet0=asm["setTempRet0"];Runtime.getTempRet0=asm["getTempRet0"];var i64Math=(function(){var goog={math:{}};goog.math.Long=(function(low,high){this.low_=low|0;this.high_=high|0});goog.math.Long.IntCache_={};goog.math.Long.fromInt=(function(value){if(-128<=value&&value<128){var cachedObj=goog.math.Long.IntCache_[value];if(cachedObj){return cachedObj}}var obj=new goog.math.Long(value|0,value<0?-1:0);if(-128<=value&&value<128){goog.math.Long.IntCache_[value]=obj}return obj});goog.math.Long.fromNumber=(function(value){if(isNaN(value)||!isFinite(value)){return goog.math.Long.ZERO}else if(value<=-goog.math.Long.TWO_PWR_63_DBL_){return goog.math.Long.MIN_VALUE}else if(value+1>=goog.math.Long.TWO_PWR_63_DBL_){return goog.math.Long.MAX_VALUE}else if(value<0){return goog.math.Long.fromNumber(-value).negate()}else{return new goog.math.Long(value%goog.math.Long.TWO_PWR_32_DBL_|0,value/goog.math.Long.TWO_PWR_32_DBL_|0)}});goog.math.Long.fromBits=(function(lowBits,highBits){return new goog.math.Long(lowBits,highBits)});goog.math.Long.fromString=(function(str,opt_radix){if(str.length==0){throw Error("number format error: empty string")}var radix=opt_radix||10;if(radix<2||36<radix){throw Error("radix out of range: "+radix)}if(str.charAt(0)=="-"){return goog.math.Long.fromString(str.substring(1),radix).negate()}else if(str.indexOf("-")>=0){throw Error('number format error: interior "-" character: '+str)}var radixToPower=goog.math.Long.fromNumber(Math.pow(radix,8));var result=goog.math.Long.ZERO;for(var i=0;i<str.length;i+=8){var size=Math.min(8,str.length-i);var value=parseInt(str.substring(i,i+size),radix);if(size<8){var power=goog.math.Long.fromNumber(Math.pow(radix,size));result=result.multiply(power).add(goog.math.Long.fromNumber(value))}else{result=result.multiply(radixToPower);result=result.add(goog.math.Long.fromNumber(value))}}return result});goog.math.Long.TWO_PWR_16_DBL_=1<<16;goog.math.Long.TWO_PWR_24_DBL_=1<<24;goog.math.Long.TWO_PWR_32_DBL_=goog.math.Long.TWO_PWR_16_DBL_*goog.math.Long.TWO_PWR_16_DBL_;goog.math.Long.TWO_PWR_31_DBL_=goog.math.Long.TWO_PWR_32_DBL_/2;goog.math.Long.TWO_PWR_48_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_16_DBL_;goog.math.Long.TWO_PWR_64_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_32_DBL_;goog.math.Long.TWO_PWR_63_DBL_=goog.math.Long.TWO_PWR_64_DBL_/2;goog.math.Long.ZERO=goog.math.Long.fromInt(0);goog.math.Long.ONE=goog.math.Long.fromInt(1);goog.math.Long.NEG_ONE=goog.math.Long.fromInt(-1);goog.math.Long.MAX_VALUE=goog.math.Long.fromBits(4294967295|0,2147483647|0);goog.math.Long.MIN_VALUE=goog.math.Long.fromBits(0,2147483648|0);goog.math.Long.TWO_PWR_24_=goog.math.Long.fromInt(1<<24);goog.math.Long.prototype.toInt=(function(){return this.low_});goog.math.Long.prototype.toNumber=(function(){return this.high_*goog.math.Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()});goog.math.Long.prototype.toString=(function(opt_radix){var radix=opt_radix||10;if(radix<2||36<radix){throw Error("radix out of range: "+radix)}if(this.isZero()){return"0"}if(this.isNegative()){if(this.equals(goog.math.Long.MIN_VALUE)){var radixLong=goog.math.Long.fromNumber(radix);var div=this.div(radixLong);var rem=div.multiply(radixLong).subtract(this);return div.toString(radix)+rem.toInt().toString(radix)}else{return"-"+this.negate().toString(radix)}}var radixToPower=goog.math.Long.fromNumber(Math.pow(radix,6));var rem=this;var result="";while(true){var remDiv=rem.div(radixToPower);var intval=rem.subtract(remDiv.multiply(radixToPower)).toInt();var digits=intval.toString(radix);rem=remDiv;if(rem.isZero()){return digits+result}else{while(digits.length<6){digits="0"+digits}result=""+digits+result}}});goog.math.Long.prototype.getHighBits=(function(){return this.high_});goog.math.Long.prototype.getLowBits=(function(){return this.low_});goog.math.Long.prototype.getLowBitsUnsigned=(function(){return this.low_>=0?this.low_:goog.math.Long.TWO_PWR_32_DBL_+this.low_});goog.math.Long.prototype.getNumBitsAbs=(function(){if(this.isNegative()){if(this.equals(goog.math.Long.MIN_VALUE)){return 64}else{return this.negate().getNumBitsAbs()}}else{var val=this.high_!=0?this.high_:this.low_;for(var bit=31;bit>0;bit--){if((val&1<<bit)!=0){break}}return this.high_!=0?bit+33:bit+1}});goog.math.Long.prototype.isZero=(function(){return this.high_==0&&this.low_==0});goog.math.Long.prototype.isNegative=(function(){return this.high_<0});goog.math.Long.prototype.isOdd=(function(){return(this.low_&1)==1});goog.math.Long.prototype.equals=(function(other){return this.high_==other.high_&&this.low_==other.low_});goog.math.Long.prototype.notEquals=(function(other){return this.high_!=other.high_||this.low_!=other.low_});goog.math.Long.prototype.lessThan=(function(other){return this.compare(other)<0});goog.math.Long.prototype.lessThanOrEqual=(function(other){return this.compare(other)<=0});goog.math.Long.prototype.greaterThan=(function(other){return this.compare(other)>0});goog.math.Long.prototype.greaterThanOrEqual=(function(other){return this.compare(other)>=0});goog.math.Long.prototype.compare=(function(other){if(this.equals(other)){return 0}var thisNeg=this.isNegative();var otherNeg=other.isNegative();if(thisNeg&&!otherNeg){return-1}if(!thisNeg&&otherNeg){return 1}if(this.subtract(other).isNegative()){return-1}else{return 1}});goog.math.Long.prototype.negate=(function(){if(this.equals(goog.math.Long.MIN_VALUE)){return goog.math.Long.MIN_VALUE}else{return this.not().add(goog.math.Long.ONE)}});goog.math.Long.prototype.add=(function(other){var a48=this.high_>>>16;var a32=this.high_&65535;var a16=this.low_>>>16;var a00=this.low_&65535;var b48=other.high_>>>16;var b32=other.high_&65535;var b16=other.low_>>>16;var b00=other.low_&65535;var c48=0,c32=0,c16=0,c00=0;c00+=a00+b00;c16+=c00>>>16;c00&=65535;c16+=a16+b16;c32+=c16>>>16;c16&=65535;c32+=a32+b32;c48+=c32>>>16;c32&=65535;c48+=a48+b48;c48&=65535;return goog.math.Long.fromBits(c16<<16|c00,c48<<16|c32)});goog.math.Long.prototype.subtract=(function(other){return this.add(other.negate())});goog.math.Long.prototype.multiply=(function(other){if(this.isZero()){return goog.math.Long.ZERO}else if(other.isZero()){return goog.math.Long.ZERO}if(this.equals(goog.math.Long.MIN_VALUE)){return other.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO}else if(other.equals(goog.math.Long.MIN_VALUE)){return this.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO}if(this.isNegative()){if(other.isNegative()){return this.negate().multiply(other.negate())}else{return this.negate().multiply(other).negate()}}else if(other.isNegative()){return this.multiply(other.negate()).negate()}if(this.lessThan(goog.math.Long.TWO_PWR_24_)&&other.lessThan(goog.math.Long.TWO_PWR_24_)){return goog.math.Long.fromNumber(this.toNumber()*other.toNumber())}var a48=this.high_>>>16;var a32=this.high_&65535;var a16=this.low_>>>16;var a00=this.low_&65535;var b48=other.high_>>>16;var b32=other.high_&65535;var b16=other.low_>>>16;var b00=other.low_&65535;var c48=0,c32=0,c16=0,c00=0;c00+=a00*b00;c16+=c00>>>16;c00&=65535;c16+=a16*b00;c32+=c16>>>16;c16&=65535;c16+=a00*b16;c32+=c16>>>16;c16&=65535;c32+=a32*b00;c48+=c32>>>16;c32&=65535;c32+=a16*b16;c48+=c32>>>16;c32&=65535;c32+=a00*b32;c48+=c32>>>16;c32&=65535;c48+=a48*b00+a32*b16+a16*b32+a00*b48;c48&=65535;return goog.math.Long.fromBits(c16<<16|c00,c48<<16|c32)});goog.math.Long.prototype.div=(function(other){if(other.isZero()){throw Error("division by zero")}else if(this.isZero()){return goog.math.Long.ZERO}if(this.equals(goog.math.Long.MIN_VALUE)){if(other.equals(goog.math.Long.ONE)||other.equals(goog.math.Long.NEG_ONE)){return goog.math.Long.MIN_VALUE}else if(other.equals(goog.math.Long.MIN_VALUE)){return goog.math.Long.ONE}else{var halfThis=this.shiftRight(1);var approx=halfThis.div(other).shiftLeft(1);if(approx.equals(goog.math.Long.ZERO)){return other.isNegative()?goog.math.Long.ONE:goog.math.Long.NEG_ONE}else{var rem=this.subtract(other.multiply(approx));var result=approx.add(rem.div(other));return result}}}else if(other.equals(goog.math.Long.MIN_VALUE)){return goog.math.Long.ZERO}if(this.isNegative()){if(other.isNegative()){return this.negate().div(other.negate())}else{return this.negate().div(other).negate()}}else if(other.isNegative()){return this.div(other.negate()).negate()}var res=goog.math.Long.ZERO;var rem=this;while(rem.greaterThanOrEqual(other)){var approx=Math.max(1,Math.floor(rem.toNumber()/other.toNumber()));var log2=Math.ceil(Math.log(approx)/Math.LN2);var delta=log2<=48?1:Math.pow(2,log2-48);var approxRes=goog.math.Long.fromNumber(approx);var approxRem=approxRes.multiply(other);while(approxRem.isNegative()||approxRem.greaterThan(rem)){approx-=delta;approxRes=goog.math.Long.fromNumber(approx);approxRem=approxRes.multiply(other)}if(approxRes.isZero()){approxRes=goog.math.Long.ONE}res=res.add(approxRes);rem=rem.subtract(approxRem)}return res});goog.math.Long.prototype.modulo=(function(other){return this.subtract(this.div(other).multiply(other))});goog.math.Long.prototype.not=(function(){return goog.math.Long.fromBits(~this.low_,~this.high_)});goog.math.Long.prototype.and=(function(other){return goog.math.Long.fromBits(this.low_&other.low_,this.high_&other.high_)});goog.math.Long.prototype.or=(function(other){return goog.math.Long.fromBits(this.low_|other.low_,this.high_|other.high_)});goog.math.Long.prototype.xor=(function(other){return goog.math.Long.fromBits(this.low_^other.low_,this.high_^other.high_)});goog.math.Long.prototype.shiftLeft=(function(numBits){numBits&=63;if(numBits==0){return this}else{var low=this.low_;if(numBits<32){var high=this.high_;return goog.math.Long.fromBits(low<<numBits,high<<numBits|low>>>32-numBits)}else{return goog.math.Long.fromBits(0,low<<numBits-32)}}});goog.math.Long.prototype.shiftRight=(function(numBits){numBits&=63;if(numBits==0){return this}else{var high=this.high_;if(numBits<32){var low=this.low_;return goog.math.Long.fromBits(low>>>numBits|high<<32-numBits,high>>numBits)}else{return goog.math.Long.fromBits(high>>numBits-32,high>=0?0:-1)}}});goog.math.Long.prototype.shiftRightUnsigned=(function(numBits){numBits&=63;if(numBits==0){return this}else{var high=this.high_;if(numBits<32){var low=this.low_;return goog.math.Long.fromBits(low>>>numBits|high<<32-numBits,high>>>numBits)}else if(numBits==32){return goog.math.Long.fromBits(high,0)}else{return goog.math.Long.fromBits(high>>>numBits-32,0)}}});var navigator={appName:"Modern Browser"};var dbits;var canary=0xdeadbeefcafe;var j_lm=(canary&16777215)==15715070;function BigInteger(a,b,c){if(a!=null)if("number"==typeof a)this.fromNumber(a,b,c);else if(b==null&&"string"!=typeof a)this.fromString(a,256);else this.fromString(a,b)}function nbi(){return new BigInteger(null)}function am1(i,x,w,j,c,n){while(--n>=0){var v=x*this[i++]+w[j]+c;c=Math.floor(v/67108864);w[j++]=v&67108863}return c}function am2(i,x,w,j,c,n){var xl=x&32767,xh=x>>15;while(--n>=0){var l=this[i]&32767;var h=this[i++]>>15;var m=xh*l+h*xl;l=xl*l+((m&32767)<<15)+w[j]+(c&1073741823);c=(l>>>30)+(m>>>15)+xh*h+(c>>>30);w[j++]=l&1073741823}return c}function am3(i,x,w,j,c,n){var xl=x&16383,xh=x>>14;while(--n>=0){var l=this[i]&16383;var h=this[i++]>>14;var m=xh*l+h*xl;l=xl*l+((m&16383)<<14)+w[j]+c;c=(l>>28)+(m>>14)+xh*h;w[j++]=l&268435455}return c}if(j_lm&&navigator.appName=="Microsoft Internet Explorer"){BigInteger.prototype.am=am2;dbits=30}else if(j_lm&&navigator.appName!="Netscape"){BigInteger.prototype.am=am1;dbits=26}else{BigInteger.prototype.am=am3;dbits=28}BigInteger.prototype.DB=dbits;BigInteger.prototype.DM=(1<<dbits)-1;BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP);BigInteger.prototype.F1=BI_FP-dbits;BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz";var BI_RC=new Array;var rr,vv;rr="0".charCodeAt(0);for(vv=0;vv<=9;++vv)BI_RC[rr++]=vv;rr="a".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;rr="A".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;function int2char(n){return BI_RM.charAt(n)}function intAt(s,i){var c=BI_RC[s.charCodeAt(i)];return c==null?-1:c}function bnpCopyTo(r){for(var i=this.t-1;i>=0;--i)r[i]=this[i];r.t=this.t;r.s=this.s}function bnpFromInt(x){this.t=1;this.s=x<0?-1:0;if(x>0)this[0]=x;else if(x<-1)this[0]=x+DV;else this.t=0}function nbv(i){var r=nbi();r.fromInt(i);return r}function bnpFromString(s,b){var k;if(b==16)k=4;else if(b==8)k=3;else if(b==256)k=8;else if(b==2)k=1;else if(b==32)k=5;else if(b==4)k=2;else{this.fromRadix(s,b);return}this.t=0;this.s=0;var i=s.length,mi=false,sh=0;while(--i>=0){var x=k==8?s[i]&255:intAt(s,i);if(x<0){if(s.charAt(i)=="-")mi=true;continue}mi=false;if(sh==0)this[this.t++]=x;else if(sh+k>this.DB){this[this.t-1]|=(x&(1<<this.DB-sh)-1)<<sh;this[this.t++]=x>>this.DB-sh}else this[this.t-1]|=x<<sh;sh+=k;if(sh>=this.DB)sh-=this.DB}if(k==8&&(s[0]&128)!=0){this.s=-1;if(sh>0)this[this.t-1]|=(1<<this.DB-sh)-1<<sh}this.clamp();if(mi)BigInteger.ZERO.subTo(this,this)}function bnpClamp(){var c=this.s&this.DM;while(this.t>0&&this[this.t-1]==c)--this.t}function bnToString(b){if(this.s<0)return"-"+this.negate().toString(b);var k;if(b==16)k=4;else if(b==8)k=3;else if(b==2)k=1;else if(b==32)k=5;else if(b==4)k=2;else return this.toRadix(b);var km=(1<<k)-1,d,m=false,r="",i=this.t;var p=this.DB-i*this.DB%k;if(i-->0){if(p<this.DB&&(d=this[i]>>p)>0){m=true;r=int2char(d)}while(i>=0){if(p<k){d=(this[i]&(1<<p)-1)<<k-p;d|=this[--i]>>(p+=this.DB-k)}else{d=this[i]>>(p-=k)&km;if(p<=0){p+=this.DB;--i}}if(d>0)m=true;if(m)r+=int2char(d)}}return m?r:"0"}function bnNegate(){var r=nbi();BigInteger.ZERO.subTo(this,r);return r}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(a){var r=this.s-a.s;if(r!=0)return r;var i=this.t;r=i-a.t;if(r!=0)return this.s<0?-r:r;while(--i>=0)if((r=this[i]-a[i])!=0)return r;return 0}function nbits(x){var r=1,t;if((t=x>>>16)!=0){x=t;r+=16}if((t=x>>8)!=0){x=t;r+=8}if((t=x>>4)!=0){x=t;r+=4}if((t=x>>2)!=0){x=t;r+=2}if((t=x>>1)!=0){x=t;r+=1}return r}function bnBitLength(){if(this.t<=0)return 0;return this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(n,r){var i;for(i=this.t-1;i>=0;--i)r[i+n]=this[i];for(i=n-1;i>=0;--i)r[i]=0;r.t=this.t+n;r.s=this.s}function bnpDRShiftTo(n,r){for(var i=n;i<this.t;++i)r[i-n]=this[i];r.t=Math.max(this.t-n,0);r.s=this.s}function bnpLShiftTo(n,r){var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<cbs)-1;var ds=Math.floor(n/this.DB),c=this.s<<bs&this.DM,i;for(i=this.t-1;i>=0;--i){r[i+ds+1]=this[i]>>cbs|c;c=(this[i]&bm)<<bs}for(i=ds-1;i>=0;--i)r[i]=0;r[ds]=c;r.t=this.t+ds+1;r.s=this.s;r.clamp()}function bnpRShiftTo(n,r){r.s=this.s;var ds=Math.floor(n/this.DB);if(ds>=this.t){r.t=0;return}var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<bs)-1;r[0]=this[ds]>>bs;for(var i=ds+1;i<this.t;++i){r[i-ds-1]|=(this[i]&bm)<<cbs;r[i-ds]=this[i]>>bs}if(bs>0)r[this.t-ds-1]|=(this.s&bm)<<cbs;r.t=this.t-ds;r.clamp()}function bnpSubTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]-a[i];r[i++]=c&this.DM;c>>=this.DB}if(a.t<this.t){c-=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB}c+=this.s}else{c+=this.s;while(i<a.t){c-=a[i];r[i++]=c&this.DM;c>>=this.DB}c-=a.s}r.s=c<0?-1:0;if(c<-1)r[i++]=this.DV+c;else if(c>0)r[i++]=c;r.t=i;r.clamp()}function bnpMultiplyTo(a,r){var x=this.abs(),y=a.abs();var i=x.t;r.t=i+y.t;while(--i>=0)r[i]=0;for(i=0;i<y.t;++i)r[i+x.t]=x.am(0,y[i],r,i,0,x.t);r.s=0;r.clamp();if(this.s!=a.s)BigInteger.ZERO.subTo(r,r)}function bnpSquareTo(r){var x=this.abs();var i=r.t=2*x.t;while(--i>=0)r[i]=0;for(i=0;i<x.t-1;++i){var c=x.am(i,x[i],r,2*i,0,1);if((r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1))>=x.DV){r[i+x.t]-=x.DV;r[i+x.t+1]=1}}if(r.t>0)r[r.t-1]+=x.am(i,x[i],r,2*i,0,1);r.s=0;r.clamp()}function bnpDivRemTo(m,q,r){var pm=m.abs();if(pm.t<=0)return;var pt=this.abs();if(pt.t<pm.t){if(q!=null)q.fromInt(0);if(r!=null)this.copyTo(r);return}if(r==null)r=nbi();var y=nbi(),ts=this.s,ms=m.s;var nsh=this.DB-nbits(pm[pm.t-1]);if(nsh>0){pm.lShiftTo(nsh,y);pt.lShiftTo(nsh,r)}else{pm.copyTo(y);pt.copyTo(r)}var ys=y.t;var y0=y[ys-1];if(y0==0)return;var yt=y0*(1<<this.F1)+(ys>1?y[ys-2]>>this.F2:0);var d1=this.FV/yt,d2=(1<<this.F1)/yt,e=1<<this.F2;var i=r.t,j=i-ys,t=q==null?nbi():q;y.dlShiftTo(j,t);if(r.compareTo(t)>=0){r[r.t++]=1;r.subTo(t,r)}BigInteger.ONE.dlShiftTo(ys,t);t.subTo(y,y);while(y.t<ys)y[y.t++]=0;while(--j>=0){var qd=r[--i]==y0?this.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);if((r[i]+=y.am(0,qd,r,j,0,ys))<qd){y.dlShiftTo(j,t);r.subTo(t,r);while(r[i]<--qd)r.subTo(t,r)}}if(q!=null){r.drShiftTo(ys,q);if(ts!=ms)BigInteger.ZERO.subTo(q,q)}r.t=ys;r.clamp();if(nsh>0)r.rShiftTo(nsh,r);if(ts<0)BigInteger.ZERO.subTo(r,r)}function bnMod(a){var r=nbi();this.abs().divRemTo(a,null,r);if(this.s<0&&r.compareTo(BigInteger.ZERO)>0)a.subTo(r,r);return r}function Classic(m){this.m=m}function cConvert(x){if(x.s<0||x.compareTo(this.m)>=0)return x.mod(this.m);else return x}function cRevert(x){return x}function cReduce(x){x.divRemTo(this.m,null,x)}function cMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}function cSqrTo(x,r){x.squareTo(r);this.reduce(r)}Classic.prototype.convert=cConvert;Classic.prototype.revert=cRevert;Classic.prototype.reduce=cReduce;Classic.prototype.mulTo=cMulTo;Classic.prototype.sqrTo=cSqrTo;function bnpInvDigit(){if(this.t<1)return 0;var x=this[0];if((x&1)==0)return 0;var y=x&3;y=y*(2-(x&15)*y)&15;y=y*(2-(x&255)*y)&255;y=y*(2-((x&65535)*y&65535))&65535;y=y*(2-x*y%this.DV)%this.DV;return y>0?this.DV-y:-y}function Montgomery(m){this.m=m;this.mp=m.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<m.DB-15)-1;this.mt2=2*m.t}function montConvert(x){var r=nbi();x.abs().dlShiftTo(this.m.t,r);r.divRemTo(this.m,null,r);if(x.s<0&&r.compareTo(BigInteger.ZERO)>0)this.m.subTo(r,r);return r}function montRevert(x){var r=nbi();x.copyTo(r);this.reduce(r);return r}function montReduce(x){while(x.t<=this.mt2)x[x.t++]=0;for(var i=0;i<this.m.t;++i){var j=x[i]&32767;var u0=j*this.mpl+((j*this.mph+(x[i]>>15)*this.mpl&this.um)<<15)&x.DM;j=i+this.m.t;x[j]+=this.m.am(0,u0,x,i,0,this.m.t);while(x[j]>=x.DV){x[j]-=x.DV;x[++j]++}}x.clamp();x.drShiftTo(this.m.t,x);if(x.compareTo(this.m)>=0)x.subTo(this.m,x)}function montSqrTo(x,r){x.squareTo(r);this.reduce(r)}function montMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}Montgomery.prototype.convert=montConvert;Montgomery.prototype.revert=montRevert;Montgomery.prototype.reduce=montReduce;Montgomery.prototype.mulTo=montMulTo;Montgomery.prototype.sqrTo=montSqrTo;function bnpIsEven(){return(this.t>0?this[0]&1:this.s)==0}function bnpExp(e,z){if(e>4294967295||e<1)return BigInteger.ONE;var r=nbi(),r2=nbi(),g=z.convert(this),i=nbits(e)-1;g.copyTo(r);while(--i>=0){z.sqrTo(r,r2);if((e&1<<i)>0)z.mulTo(r2,g,r);else{var t=r;r=r2;r2=t}}return z.revert(r)}function bnModPowInt(e,m){var z;if(e<256||m.isEven())z=new Classic(m);else z=new Montgomery(m);return this.exp(e,z)}BigInteger.prototype.copyTo=bnpCopyTo;BigInteger.prototype.fromInt=bnpFromInt;BigInteger.prototype.fromString=bnpFromString;BigInteger.prototype.clamp=bnpClamp;BigInteger.prototype.dlShiftTo=bnpDLShiftTo;BigInteger.prototype.drShiftTo=bnpDRShiftTo;BigInteger.prototype.lShiftTo=bnpLShiftTo;BigInteger.prototype.rShiftTo=bnpRShiftTo;BigInteger.prototype.subTo=bnpSubTo;BigInteger.prototype.multiplyTo=bnpMultiplyTo;BigInteger.prototype.squareTo=bnpSquareTo;BigInteger.prototype.divRemTo=bnpDivRemTo;BigInteger.prototype.invDigit=bnpInvDigit;BigInteger.prototype.isEven=bnpIsEven;BigInteger.prototype.exp=bnpExp;BigInteger.prototype.toString=bnToString;BigInteger.prototype.negate=bnNegate;BigInteger.prototype.abs=bnAbs;BigInteger.prototype.compareTo=bnCompareTo;BigInteger.prototype.bitLength=bnBitLength;BigInteger.prototype.mod=bnMod;BigInteger.prototype.modPowInt=bnModPowInt;BigInteger.ZERO=nbv(0);BigInteger.ONE=nbv(1);function bnpFromRadix(s,b){this.fromInt(0);if(b==null)b=10;var cs=this.chunkSize(b);var d=Math.pow(b,cs),mi=false,j=0,w=0;for(var i=0;i<s.length;++i){var x=intAt(s,i);if(x<0){if(s.charAt(i)=="-"&&this.signum()==0)mi=true;continue}w=b*w+x;if(++j>=cs){this.dMultiply(d);this.dAddOffset(w,0);j=0;w=0}}if(j>0){this.dMultiply(Math.pow(b,j));this.dAddOffset(w,0)}if(mi)BigInteger.ZERO.subTo(this,this)}function bnpChunkSize(r){return Math.floor(Math.LN2*this.DB/Math.log(r))}function bnSigNum(){if(this.s<0)return-1;else if(this.t<=0||this.t==1&&this[0]<=0)return 0;else return 1}function bnpDMultiply(n){this[this.t]=this.am(0,n-1,this,0,0,this.t);++this.t;this.clamp()}function bnpDAddOffset(n,w){if(n==0)return;while(this.t<=w)this[this.t++]=0;this[w]+=n;while(this[w]>=this.DV){this[w]-=this.DV;if(++w>=this.t)this[this.t++]=0;++this[w]}}function bnpToRadix(b){if(b==null)b=10;if(this.signum()==0||b<2||b>36)return"0";var cs=this.chunkSize(b);var a=Math.pow(b,cs);var d=nbv(a),y=nbi(),z=nbi(),r="";this.divRemTo(d,y,z);while(y.signum()>0){r=(a+z.intValue()).toString(b).substr(1)+r;y.divRemTo(d,y,z)}return z.intValue().toString(b)+r}function bnIntValue(){if(this.s<0){if(this.t==1)return this[0]-this.DV;else if(this.t==0)return-1}else if(this.t==1)return this[0];else if(this.t==0)return 0;return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnpAddTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]+a[i];r[i++]=c&this.DM;c>>=this.DB}if(a.t<this.t){c+=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB}c+=this.s}else{c+=this.s;while(i<a.t){c+=a[i];r[i++]=c&this.DM;c>>=this.DB}c+=a.s}r.s=c<0?-1:0;if(c>0)r[i++]=c;else if(c<-1)r[i++]=this.DV+c;r.t=i;r.clamp()}BigInteger.prototype.fromRadix=bnpFromRadix;BigInteger.prototype.chunkSize=bnpChunkSize;BigInteger.prototype.signum=bnSigNum;BigInteger.prototype.dMultiply=bnpDMultiply;BigInteger.prototype.dAddOffset=bnpDAddOffset;BigInteger.prototype.toRadix=bnpToRadix;BigInteger.prototype.intValue=bnIntValue;BigInteger.prototype.addTo=bnpAddTo;var Wrapper={abs:(function(l,h){var x=new goog.math.Long(l,h);var ret;if(x.isNegative()){ret=x.negate()}else{ret=x}HEAP32[tempDoublePtr>>2]=ret.low_;HEAP32[tempDoublePtr+4>>2]=ret.high_}),ensureTemps:(function(){if(Wrapper.ensuredTemps)return;Wrapper.ensuredTemps=true;Wrapper.two32=new BigInteger;Wrapper.two32.fromString("4294967296",10);Wrapper.two64=new BigInteger;Wrapper.two64.fromString("18446744073709551616",10);Wrapper.temp1=new BigInteger;Wrapper.temp2=new BigInteger}),lh2bignum:(function(l,h){var a=new BigInteger;a.fromString(h.toString(),10);var b=new BigInteger;a.multiplyTo(Wrapper.two32,b);var c=new BigInteger;c.fromString(l.toString(),10);var d=new BigInteger;c.addTo(b,d);return d}),stringify:(function(l,h,unsigned){var ret=(new goog.math.Long(l,h)).toString();if(unsigned&&ret[0]=="-"){Wrapper.ensureTemps();var bignum=new BigInteger;bignum.fromString(ret,10);ret=new BigInteger;Wrapper.two64.addTo(bignum,ret);ret=ret.toString(10)}return ret}),fromString:(function(str,base,min,max,unsigned){Wrapper.ensureTemps();var bignum=new BigInteger;bignum.fromString(str,base);var bigmin=new BigInteger;bigmin.fromString(min,10);var bigmax=new BigInteger;bigmax.fromString(max,10);if(unsigned&&bignum.compareTo(BigInteger.ZERO)<0){var temp=new BigInteger;bignum.addTo(Wrapper.two64,temp);bignum=temp}var error=false;if(bignum.compareTo(bigmin)<0){bignum=bigmin;error=true}else if(bignum.compareTo(bigmax)>0){bignum=bigmax;error=true}var ret=goog.math.Long.fromString(bignum.toString());HEAP32[tempDoublePtr>>2]=ret.low_;HEAP32[tempDoublePtr+4>>2]=ret.high_;if(error)throw"range error"})};return Wrapper})();if(memoryInitializer){if(typeof Module["locateFile"]==="function"){memoryInitializer=Module["locateFile"](memoryInitializer)}else if(Module["memoryInitializerPrefixURL"]){memoryInitializer=Module["memoryInitializerPrefixURL"]+memoryInitializer}if(ENVIRONMENT_IS_NODE||ENVIRONMENT_IS_SHELL){var data=Module["readBinary"](memoryInitializer);HEAPU8.set(data,STATIC_BASE)}else{addRunDependency("memory initializer");Browser.asyncLoad(memoryInitializer,(function(data){HEAPU8.set(data,STATIC_BASE);removeRunDependency("memory initializer")}),(function(data){throw"could not load memory initializer "+memoryInitializer}))}}function ExitStatus(status){this.name="ExitStatus";this.message="Program terminated with exit("+status+")";this.status=status}ExitStatus.prototype=new Error;ExitStatus.prototype.constructor=ExitStatus;var initialStackTop;var preloadStartTime=null;var calledMain=false;dependenciesFulfilled=function runCaller(){if(!Module["calledRun"]&&shouldRunNow)run();if(!Module["calledRun"])dependenciesFulfilled=runCaller};Module["callMain"]=Module.callMain=function callMain(args){assert(runDependencies==0,"cannot call main when async dependencies remain! (listen on __ATMAIN__)");assert(__ATPRERUN__.length==0,"cannot call main when preRun functions remain to be called");args=args||[];ensureInitRuntime();var argc=args.length+1;function pad(){for(var i=0;i<4-1;i++){argv.push(0)}}var argv=[allocate(intArrayFromString(Module["thisProgram"]),"i8",ALLOC_NORMAL)];pad();for(var i=0;i<argc-1;i=i+1){argv.push(allocate(intArrayFromString(args[i]),"i8",ALLOC_NORMAL));pad()}argv.push(0);argv=allocate(argv,"i32",ALLOC_NORMAL);initialStackTop=STACKTOP;try{var ret=Module["_main"](argc,argv,0);exit(ret)}catch(e){if(e instanceof ExitStatus){return}else if(e=="SimulateInfiniteLoop"){Module["noExitRuntime"]=true;return}else{if(e&&typeof e==="object"&&e.stack)Module.printErr("exception thrown: "+[e,e.stack]);throw e}}finally{calledMain=true}};function run(args){args=args||Module["arguments"];if(preloadStartTime===null)preloadStartTime=Date.now();if(runDependencies>0){Module.printErr("run() called, but dependencies remain, so not running");return}preRun();if(runDependencies>0)return;if(Module["calledRun"])return;function doRun(){if(Module["calledRun"])return;Module["calledRun"]=true;if(ABORT)return;ensureInitRuntime();preMain();if(ENVIRONMENT_IS_WEB&&preloadStartTime!==null){Module.printErr("pre-main prep time: "+(Date.now()-preloadStartTime)+" ms")}if(Module["_main"]&&shouldRunNow){Module["callMain"](args)}postRun()}if(Module["setStatus"]){Module["setStatus"]("Running...");setTimeout((function(){setTimeout((function(){Module["setStatus"]("")}),1);doRun()}),1)}else{doRun()}}Module["run"]=Module.run=run;function exit(status){if(Module["noExitRuntime"]){return}ABORT=true;EXITSTATUS=status;STACKTOP=initialStackTop;exitRuntime();if(ENVIRONMENT_IS_NODE){process["stdout"]["once"]("drain",(function(){process["exit"](status)}));console.log(" ");setTimeout((function(){process["exit"](status)}),500)}else if(ENVIRONMENT_IS_SHELL&&typeof quit==="function"){quit(status)}throw new ExitStatus(status)}Module["exit"]=Module.exit=exit;function abort(text){if(text){Module.print(text);Module.printErr(text)}ABORT=true;EXITSTATUS=1;var extra="\nIf this abort() is unexpected, build with -s ASSERTIONS=1 which can give more information.";throw"abort() at "+stackTrace()+extra}Module["abort"]=Module.abort=abort;if(Module["preInit"]){if(typeof Module["preInit"]=="function")Module["preInit"]=[Module["preInit"]];while(Module["preInit"].length>0){Module["preInit"].pop()()}}var shouldRunNow=true;if(Module["noInitialRun"]){shouldRunNow=false}Module["noExitRuntime"]=true;run();function WrapperObject(){}WrapperObject.prototype=Object.create(WrapperObject.prototype);WrapperObject.prototype.constructor=WrapperObject;WrapperObject.prototype.__class__=WrapperObject;WrapperObject.__cache__={};Module["WrapperObject"]=WrapperObject;function getCache(__class__){return(__class__||WrapperObject).__cache__}Module["getCache"]=getCache;function wrapPointer(ptr,__class__){var cache=getCache(__class__);var ret=cache[ptr];if(ret)return ret;ret=Object.create((__class__||WrapperObject).prototype);ret.ptr=ptr;return cache[ptr]=ret}Module["wrapPointer"]=wrapPointer;function castObject(obj,__class__){return wrapPointer(obj.ptr,__class__)}Module["castObject"]=castObject;Module["NULL"]=wrapPointer(0);function destroy(obj){if(!obj["__destroy__"])throw"Error: Cannot destroy object. (Did you create it yourself?)";obj["__destroy__"]();delete getCache(obj.__class__)[obj.ptr]}Module["destroy"]=destroy;function compare(obj1,obj2){return obj1.ptr===obj2.ptr}Module["compare"]=compare;function getPointer(obj){return obj.ptr}Module["getPointer"]=getPointer;function getClass(obj){return obj.__class__}Module["getClass"]=getClass;function ensureString(value){if(typeof value=="string")return allocate(intArrayFromString(value),"i8",ALLOC_STACK);return value}function btMatrix3x3(){throw"cannot construct a btMatrix3x3, no constructor in IDL"}btMatrix3x3.prototype=Object.create(WrapperObject.prototype);btMatrix3x3.prototype.constructor=btMatrix3x3;btMatrix3x3.prototype.__class__=btMatrix3x3;btMatrix3x3.__cache__={};Module["btMatrix3x3"]=btMatrix3x3;btMatrix3x3.prototype["setEulerZYX"]=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btMatrix3x3_setEulerZYX_3(self,arg0,arg1,arg2)});btMatrix3x3.prototype["getRotation"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btMatrix3x3_getRotation_1(self,arg0)});btMatrix3x3.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btMatrix3x3___destroy___0(self)});function ConcreteContactResultCallback(){this.ptr=_emscripten_bind_ConcreteContactResultCallback_ConcreteContactResultCallback_0();getCache(ConcreteContactResultCallback)[this.ptr]=this}ConcreteContactResultCallback.prototype=Object.create(ContactResultCallback.prototype);ConcreteContactResultCallback.prototype.constructor=ConcreteContactResultCallback;ConcreteContactResultCallback.prototype.__class__=ConcreteContactResultCallback;ConcreteContactResultCallback.__cache__={};Module["ConcreteContactResultCallback"]=ConcreteContactResultCallback;ConcreteContactResultCallback.prototype["addSingleResult"]=(function(arg0,arg1,arg2,arg3,arg4,arg5,arg6){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);if(arg5&&typeof arg5==="object")arg5=arg5.ptr;else arg5=ensureString(arg5);if(arg6&&typeof arg6==="object")arg6=arg6.ptr;else arg6=ensureString(arg6);return _emscripten_bind_ConcreteContactResultCallback_addSingleResult_7(self,arg0,arg1,arg2,arg3,arg4,arg5,arg6)});ConcreteContactResultCallback.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_ConcreteContactResultCallback___destroy___0(self)});function btBvhTriangleMeshShape(arg0,arg1,arg2){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg2===undefined){this.ptr=_emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_2(arg0,arg1);getCache(btBvhTriangleMeshShape)[this.ptr]=this;return}this.ptr=_emscripten_bind_btBvhTriangleMeshShape_btBvhTriangleMeshShape_3(arg0,arg1,arg2);getCache(btBvhTriangleMeshShape)[this.ptr]=this}btBvhTriangleMeshShape.prototype=Object.create(btTriangleMeshShape.prototype);btBvhTriangleMeshShape.prototype.constructor=btBvhTriangleMeshShape;btBvhTriangleMeshShape.prototype.__class__=btBvhTriangleMeshShape;btBvhTriangleMeshShape.__cache__={};Module["btBvhTriangleMeshShape"]=btBvhTriangleMeshShape;btBvhTriangleMeshShape.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btBvhTriangleMeshShape_setLocalScaling_1(self,arg0)});btBvhTriangleMeshShape.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btBvhTriangleMeshShape_calculateLocalInertia_2(self,arg0,arg1)});btBvhTriangleMeshShape.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btBvhTriangleMeshShape___destroy___0(self)});function btDbvtBroadphase(){this.ptr=_emscripten_bind_btDbvtBroadphase_btDbvtBroadphase_0();getCache(btDbvtBroadphase)[this.ptr]=this}btDbvtBroadphase.prototype=Object.create(WrapperObject.prototype);btDbvtBroadphase.prototype.constructor=btDbvtBroadphase;btDbvtBroadphase.prototype.__class__=btDbvtBroadphase;btDbvtBroadphase.__cache__={};Module["btDbvtBroadphase"]=btDbvtBroadphase;btDbvtBroadphase.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btDbvtBroadphase___destroy___0(self)});function VoidPtr(){throw"cannot construct a VoidPtr, no constructor in IDL"}VoidPtr.prototype=Object.create(WrapperObject.prototype);VoidPtr.prototype.constructor=VoidPtr;VoidPtr.prototype.__class__=VoidPtr;VoidPtr.__cache__={};Module["VoidPtr"]=VoidPtr;VoidPtr.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_VoidPtr___destroy___0(self)});function btSequentialImpulseConstraintSolver(){this.ptr=_emscripten_bind_btSequentialImpulseConstraintSolver_btSequentialImpulseConstraintSolver_0();getCache(btSequentialImpulseConstraintSolver)[this.ptr]=this}btSequentialImpulseConstraintSolver.prototype=Object.create(WrapperObject.prototype);btSequentialImpulseConstraintSolver.prototype.constructor=btSequentialImpulseConstraintSolver;btSequentialImpulseConstraintSolver.prototype.__class__=btSequentialImpulseConstraintSolver;btSequentialImpulseConstraintSolver.__cache__={};Module["btSequentialImpulseConstraintSolver"]=btSequentialImpulseConstraintSolver;btSequentialImpulseConstraintSolver.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btSequentialImpulseConstraintSolver___destroy___0(self)});function btDispatcherInfo(){throw"cannot construct a btDispatcherInfo, no constructor in IDL"}btDispatcherInfo.prototype=Object.create(WrapperObject.prototype);btDispatcherInfo.prototype.constructor=btDispatcherInfo;btDispatcherInfo.prototype.__class__=btDispatcherInfo;btDispatcherInfo.__cache__={};Module["btDispatcherInfo"]=btDispatcherInfo;btDispatcherInfo.prototype["get_m_timeStep"]=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_timeStep_0(self)});btDispatcherInfo.prototype["set_m_timeStep"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_timeStep_1(self,arg0)});btDispatcherInfo.prototype["get_m_stepCount"]=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_stepCount_0(self)});btDispatcherInfo.prototype["set_m_stepCount"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_stepCount_1(self,arg0)});btDispatcherInfo.prototype["get_m_dispatchFunc"]=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_dispatchFunc_0(self)});btDispatcherInfo.prototype["set_m_dispatchFunc"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_dispatchFunc_1(self,arg0)});btDispatcherInfo.prototype["get_m_timeOfImpact"]=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_timeOfImpact_0(self)});btDispatcherInfo.prototype["set_m_timeOfImpact"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_timeOfImpact_1(self,arg0)});btDispatcherInfo.prototype["get_m_useContinuous"]=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_useContinuous_0(self)});btDispatcherInfo.prototype["set_m_useContinuous"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_useContinuous_1(self,arg0)});btDispatcherInfo.prototype["get_m_enableSatConvex"]=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_enableSatConvex_0(self)});btDispatcherInfo.prototype["set_m_enableSatConvex"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_enableSatConvex_1(self,arg0)});btDispatcherInfo.prototype["get_m_enableSPU"]=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_enableSPU_0(self)});btDispatcherInfo.prototype["set_m_enableSPU"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_enableSPU_1(self,arg0)});btDispatcherInfo.prototype["get_m_useEpa"]=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_useEpa_0(self)});btDispatcherInfo.prototype["set_m_useEpa"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_useEpa_1(self,arg0)});btDispatcherInfo.prototype["get_m_allowedCcdPenetration"]=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_allowedCcdPenetration_0(self)});btDispatcherInfo.prototype["set_m_allowedCcdPenetration"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_allowedCcdPenetration_1(self,arg0)});btDispatcherInfo.prototype["get_m_useConvexConservativeDistanceUtil"]=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_useConvexConservativeDistanceUtil_0(self)});btDispatcherInfo.prototype["set_m_useConvexConservativeDistanceUtil"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_useConvexConservativeDistanceUtil_1(self,arg0)});btDispatcherInfo.prototype["get_m_convexConservativeDistanceThreshold"]=(function(){var self=this.ptr;return _emscripten_bind_btDispatcherInfo_get_m_convexConservativeDistanceThreshold_0(self)});btDispatcherInfo.prototype["set_m_convexConservativeDistanceThreshold"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDispatcherInfo_set_m_convexConservativeDistanceThreshold_1(self,arg0)});btDispatcherInfo.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btDispatcherInfo___destroy___0(self)});function btCapsuleShape(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);this.ptr=_emscripten_bind_btCapsuleShape_btCapsuleShape_2(arg0,arg1);getCache(btCapsuleShape)[this.ptr]=this}btCapsuleShape.prototype=Object.create(btCollisionShape.prototype);btCapsuleShape.prototype.constructor=btCapsuleShape;btCapsuleShape.prototype.__class__=btCapsuleShape;btCapsuleShape.__cache__={};Module["btCapsuleShape"]=btCapsuleShape;btCapsuleShape.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCapsuleShape_setLocalScaling_1(self,arg0)});btCapsuleShape.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCapsuleShape_calculateLocalInertia_2(self,arg0,arg1)});btCapsuleShape.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btCapsuleShape___destroy___0(self)});function btCollisionConfiguration(){throw"cannot construct a btCollisionConfiguration, no constructor in IDL"}btCollisionConfiguration.prototype=Object.create(WrapperObject.prototype);btCollisionConfiguration.prototype.constructor=btCollisionConfiguration;btCollisionConfiguration.prototype.__class__=btCollisionConfiguration;btCollisionConfiguration.__cache__={};Module["btCollisionConfiguration"]=btCollisionConfiguration;btCollisionConfiguration.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btCollisionConfiguration___destroy___0(self)});function btAxisSweep3(arg0,arg1,arg2,arg3,arg4){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);if(arg2===undefined){this.ptr=_emscripten_bind_btAxisSweep3_btAxisSweep3_2(arg0,arg1);getCache(btAxisSweep3)[this.ptr]=this;return}if(arg3===undefined){this.ptr=_emscripten_bind_btAxisSweep3_btAxisSweep3_3(arg0,arg1,arg2);getCache(btAxisSweep3)[this.ptr]=this;return}if(arg4===undefined){this.ptr=_emscripten_bind_btAxisSweep3_btAxisSweep3_4(arg0,arg1,arg2,arg3);getCache(btAxisSweep3)[this.ptr]=this;return}this.ptr=_emscripten_bind_btAxisSweep3_btAxisSweep3_5(arg0,arg1,arg2,arg3,arg4);getCache(btAxisSweep3)[this.ptr]=this}btAxisSweep3.prototype=Object.create(WrapperObject.prototype);btAxisSweep3.prototype.constructor=btAxisSweep3;btAxisSweep3.prototype.__class__=btAxisSweep3;btAxisSweep3.__cache__={};Module["btAxisSweep3"]=btAxisSweep3;btAxisSweep3.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btAxisSweep3___destroy___0(self)});function btPairCachingGhostObject(){this.ptr=_emscripten_bind_btPairCachingGhostObject_btPairCachingGhostObject_0();getCache(btPairCachingGhostObject)[this.ptr]=this}btPairCachingGhostObject.prototype=Object.create(btGhostObject.prototype);btPairCachingGhostObject.prototype.constructor=btPairCachingGhostObject;btPairCachingGhostObject.prototype.__class__=btPairCachingGhostObject;btPairCachingGhostObject.__cache__={};Module["btPairCachingGhostObject"]=btPairCachingGhostObject;btPairCachingGhostObject.prototype["getCollisionShape"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btPairCachingGhostObject_getCollisionShape_0(self),btCollisionShape)});btPairCachingGhostObject.prototype["setContactProcessingThreshold"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_setContactProcessingThreshold_1(self,arg0)});btPairCachingGhostObject.prototype["setActivationState"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_setActivationState_1(self,arg0)});btPairCachingGhostObject.prototype["forceActivationState"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_forceActivationState_1(self,arg0)});btPairCachingGhostObject.prototype["activate"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg0===undefined){_emscripten_bind_btPairCachingGhostObject_activate_0(self);return}_emscripten_bind_btPairCachingGhostObject_activate_1(self,arg0)});btPairCachingGhostObject.prototype["isActive"]=(function(){var self=this.ptr;return _emscripten_bind_btPairCachingGhostObject_isActive_0(self)});btPairCachingGhostObject.prototype["isKinematicObject"]=(function(){var self=this.ptr;return _emscripten_bind_btPairCachingGhostObject_isKinematicObject_0(self)});btPairCachingGhostObject.prototype["setRestitution"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_setRestitution_1(self,arg0)});btPairCachingGhostObject.prototype["setFriction"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_setFriction_1(self,arg0)});btPairCachingGhostObject.prototype["getWorldTransform"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btPairCachingGhostObject_getWorldTransform_0(self),btTransform)});btPairCachingGhostObject.prototype["getCollisionFlags"]=(function(){var self=this.ptr;return _emscripten_bind_btPairCachingGhostObject_getCollisionFlags_0(self)});btPairCachingGhostObject.prototype["setCollisionFlags"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_setCollisionFlags_1(self,arg0)});btPairCachingGhostObject.prototype["setWorldTransform"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_setWorldTransform_1(self,arg0)});btPairCachingGhostObject.prototype["setCollisionShape"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPairCachingGhostObject_setCollisionShape_1(self,arg0)});btPairCachingGhostObject.prototype["getNumOverlappingObjects"]=(function(){var self=this.ptr;return _emscripten_bind_btPairCachingGhostObject_getNumOverlappingObjects_0(self)});btPairCachingGhostObject.prototype["getOverlappingObject"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btPairCachingGhostObject_getOverlappingObject_1(self,arg0),btCollisionObject)});btPairCachingGhostObject.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btPairCachingGhostObject___destroy___0(self)});function btRigidBodyConstructionInfo(arg0,arg1,arg2,arg3){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg3===undefined){this.ptr=_emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_3(arg0,arg1,arg2);getCache(btRigidBodyConstructionInfo)[this.ptr]=this;return}this.ptr=_emscripten_bind_btRigidBodyConstructionInfo_btRigidBodyConstructionInfo_4(arg0,arg1,arg2,arg3);getCache(btRigidBodyConstructionInfo)[this.ptr]=this}btRigidBodyConstructionInfo.prototype=Object.create(WrapperObject.prototype);btRigidBodyConstructionInfo.prototype.constructor=btRigidBodyConstructionInfo;btRigidBodyConstructionInfo.prototype.__class__=btRigidBodyConstructionInfo;btRigidBodyConstructionInfo.__cache__={};Module["btRigidBodyConstructionInfo"]=btRigidBodyConstructionInfo;btRigidBodyConstructionInfo.prototype["get_m_linearDamping"]=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_linearDamping_0(self)});btRigidBodyConstructionInfo.prototype["set_m_linearDamping"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_linearDamping_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_angularDamping"]=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_angularDamping_0(self)});btRigidBodyConstructionInfo.prototype["set_m_angularDamping"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_angularDamping_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_friction"]=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_friction_0(self)});btRigidBodyConstructionInfo.prototype["set_m_friction"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_friction_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_rollingFriction"]=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_rollingFriction_0(self)});btRigidBodyConstructionInfo.prototype["set_m_rollingFriction"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_rollingFriction_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_restitution"]=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_restitution_0(self)});btRigidBodyConstructionInfo.prototype["set_m_restitution"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_restitution_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_linearSleepingThreshold"]=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_linearSleepingThreshold_0(self)});btRigidBodyConstructionInfo.prototype["set_m_linearSleepingThreshold"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_linearSleepingThreshold_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_angularSleepingThreshold"]=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_angularSleepingThreshold_0(self)});btRigidBodyConstructionInfo.prototype["set_m_angularSleepingThreshold"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_angularSleepingThreshold_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_additionalDamping"]=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDamping_0(self)});btRigidBodyConstructionInfo.prototype["set_m_additionalDamping"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDamping_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_additionalDampingFactor"]=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalDampingFactor_0(self)});btRigidBodyConstructionInfo.prototype["set_m_additionalDampingFactor"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalDampingFactor_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_additionalLinearDampingThresholdSqr"]=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalLinearDampingThresholdSqr_0(self)});btRigidBodyConstructionInfo.prototype["set_m_additionalLinearDampingThresholdSqr"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalLinearDampingThresholdSqr_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_additionalAngularDampingThresholdSqr"]=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingThresholdSqr_0(self)});btRigidBodyConstructionInfo.prototype["set_m_additionalAngularDampingThresholdSqr"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingThresholdSqr_1(self,arg0)});btRigidBodyConstructionInfo.prototype["get_m_additionalAngularDampingFactor"]=(function(){var self=this.ptr;return _emscripten_bind_btRigidBodyConstructionInfo_get_m_additionalAngularDampingFactor_0(self)});btRigidBodyConstructionInfo.prototype["set_m_additionalAngularDampingFactor"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBodyConstructionInfo_set_m_additionalAngularDampingFactor_1(self,arg0)});btRigidBodyConstructionInfo.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btRigidBodyConstructionInfo___destroy___0(self)});function btManifoldPoint(){throw"cannot construct a btManifoldPoint, no constructor in IDL"}btManifoldPoint.prototype=Object.create(WrapperObject.prototype);btManifoldPoint.prototype.constructor=btManifoldPoint;btManifoldPoint.prototype.__class__=btManifoldPoint;btManifoldPoint.__cache__={};Module["btManifoldPoint"]=btManifoldPoint;btManifoldPoint.prototype["getPositionWorldOnA"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btManifoldPoint_getPositionWorldOnA_0(self),btVector3)});btManifoldPoint.prototype["getPositionWorldOnB"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btManifoldPoint_getPositionWorldOnB_0(self),btVector3)});btManifoldPoint.prototype["get_m_localPointA"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btManifoldPoint_get_m_localPointA_0(self),btVector3)});btManifoldPoint.prototype["set_m_localPointA"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btManifoldPoint_set_m_localPointA_1(self,arg0)});btManifoldPoint.prototype["get_m_localPointB"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btManifoldPoint_get_m_localPointB_0(self),btVector3)});btManifoldPoint.prototype["set_m_localPointB"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btManifoldPoint_set_m_localPointB_1(self,arg0)});btManifoldPoint.prototype["get_m_positionWorldOnB"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btManifoldPoint_get_m_positionWorldOnB_0(self),btVector3)});btManifoldPoint.prototype["set_m_positionWorldOnB"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btManifoldPoint_set_m_positionWorldOnB_1(self,arg0)});btManifoldPoint.prototype["get_m_positionWorldOnA"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btManifoldPoint_get_m_positionWorldOnA_0(self),btVector3)});btManifoldPoint.prototype["set_m_positionWorldOnA"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btManifoldPoint_set_m_positionWorldOnA_1(self,arg0)});btManifoldPoint.prototype["get_m_normalWorldOnB"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btManifoldPoint_get_m_normalWorldOnB_0(self),btVector3)});btManifoldPoint.prototype["set_m_normalWorldOnB"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btManifoldPoint_set_m_normalWorldOnB_1(self,arg0)});btManifoldPoint.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btManifoldPoint___destroy___0(self)});function btGeneric6DofConstraint(arg0,arg1,arg2,arg3,arg4){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);if(arg3===undefined){this.ptr=_emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_3(arg0,arg1,arg2);getCache(btGeneric6DofConstraint)[this.ptr]=this;return}if(arg4===undefined){this.ptr=_emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_4(arg0,arg1,arg2,arg3);getCache(btGeneric6DofConstraint)[this.ptr]=this;return}this.ptr=_emscripten_bind_btGeneric6DofConstraint_btGeneric6DofConstraint_5(arg0,arg1,arg2,arg3,arg4);getCache(btGeneric6DofConstraint)[this.ptr]=this}btGeneric6DofConstraint.prototype=Object.create(WrapperObject.prototype);btGeneric6DofConstraint.prototype.constructor=btGeneric6DofConstraint;btGeneric6DofConstraint.prototype.__class__=btGeneric6DofConstraint;btGeneric6DofConstraint.__cache__={};Module["btGeneric6DofConstraint"]=btGeneric6DofConstraint;btGeneric6DofConstraint.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btGeneric6DofConstraint___destroy___0(self)});function btStridingMeshInterface(){throw"cannot construct a btStridingMeshInterface, no constructor in IDL"}btStridingMeshInterface.prototype=Object.create(WrapperObject.prototype);btStridingMeshInterface.prototype.constructor=btStridingMeshInterface;btStridingMeshInterface.prototype.__class__=btStridingMeshInterface;btStridingMeshInterface.__cache__={};Module["btStridingMeshInterface"]=btStridingMeshInterface;btStridingMeshInterface.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btStridingMeshInterface___destroy___0(self)});function btBroadphaseInterface(){throw"cannot construct a btBroadphaseInterface, no constructor in IDL"}btBroadphaseInterface.prototype=Object.create(WrapperObject.prototype);btBroadphaseInterface.prototype.constructor=btBroadphaseInterface;btBroadphaseInterface.prototype.__class__=btBroadphaseInterface;btBroadphaseInterface.__cache__={};Module["btBroadphaseInterface"]=btBroadphaseInterface;btBroadphaseInterface.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btBroadphaseInterface___destroy___0(self)});function btCollisionObject(){throw"cannot construct a btCollisionObject, no constructor in IDL"}btCollisionObject.prototype=Object.create(WrapperObject.prototype);btCollisionObject.prototype.constructor=btCollisionObject;btCollisionObject.prototype.__class__=btCollisionObject;btCollisionObject.__cache__={};Module["btCollisionObject"]=btCollisionObject;btCollisionObject.prototype["getCollisionShape"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btCollisionObject_getCollisionShape_0(self),btCollisionShape)});btCollisionObject.prototype["setContactProcessingThreshold"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_setContactProcessingThreshold_1(self,arg0)});btCollisionObject.prototype["setActivationState"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_setActivationState_1(self,arg0)});btCollisionObject.prototype["forceActivationState"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_forceActivationState_1(self,arg0)});btCollisionObject.prototype["activate"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg0===undefined){_emscripten_bind_btCollisionObject_activate_0(self);return}_emscripten_bind_btCollisionObject_activate_1(self,arg0)});btCollisionObject.prototype["isActive"]=(function(){var self=this.ptr;return _emscripten_bind_btCollisionObject_isActive_0(self)});btCollisionObject.prototype["isKinematicObject"]=(function(){var self=this.ptr;return _emscripten_bind_btCollisionObject_isKinematicObject_0(self)});btCollisionObject.prototype["setRestitution"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_setRestitution_1(self,arg0)});btCollisionObject.prototype["setFriction"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_setFriction_1(self,arg0)});btCollisionObject.prototype["getWorldTransform"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btCollisionObject_getWorldTransform_0(self),btTransform)});btCollisionObject.prototype["getCollisionFlags"]=(function(){var self=this.ptr;return _emscripten_bind_btCollisionObject_getCollisionFlags_0(self)});btCollisionObject.prototype["setCollisionFlags"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_setCollisionFlags_1(self,arg0)});btCollisionObject.prototype["setWorldTransform"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_setWorldTransform_1(self,arg0)});btCollisionObject.prototype["setCollisionShape"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionObject_setCollisionShape_1(self,arg0)});btCollisionObject.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btCollisionObject___destroy___0(self)});function btDiscreteDynamicsWorld(arg0,arg1,arg2,arg3){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);this.ptr=_emscripten_bind_btDiscreteDynamicsWorld_btDiscreteDynamicsWorld_4(arg0,arg1,arg2,arg3);getCache(btDiscreteDynamicsWorld)[this.ptr]=this}btDiscreteDynamicsWorld.prototype=Object.create(btDynamicsWorld.prototype);btDiscreteDynamicsWorld.prototype.constructor=btDiscreteDynamicsWorld;btDiscreteDynamicsWorld.prototype.__class__=btDiscreteDynamicsWorld;btDiscreteDynamicsWorld.__cache__={};Module["btDiscreteDynamicsWorld"]=btDiscreteDynamicsWorld;btDiscreteDynamicsWorld.prototype["setGravity"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDiscreteDynamicsWorld_setGravity_1(self,arg0)});btDiscreteDynamicsWorld.prototype["getGravity"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDiscreteDynamicsWorld_getGravity_0(self),btVector3)});btDiscreteDynamicsWorld.prototype["addRigidBody"]=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg1===undefined){_emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_1(self,arg0);return}if(arg2===undefined){_emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_2(self,arg0,arg1);return}_emscripten_bind_btDiscreteDynamicsWorld_addRigidBody_3(self,arg0,arg1,arg2)});btDiscreteDynamicsWorld.prototype["removeRigidBody"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDiscreteDynamicsWorld_removeRigidBody_1(self,arg0)});btDiscreteDynamicsWorld.prototype["addConstraint"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg1===undefined){_emscripten_bind_btDiscreteDynamicsWorld_addConstraint_1(self,arg0);return}_emscripten_bind_btDiscreteDynamicsWorld_addConstraint_2(self,arg0,arg1)});btDiscreteDynamicsWorld.prototype["removeConstraint"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDiscreteDynamicsWorld_removeConstraint_1(self,arg0)});btDiscreteDynamicsWorld.prototype["stepSimulation"]=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg1===undefined){return _emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_1(self,arg0)}if(arg2===undefined){return _emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_2(self,arg0,arg1)}return _emscripten_bind_btDiscreteDynamicsWorld_stepSimulation_3(self,arg0,arg1,arg2)});btDiscreteDynamicsWorld.prototype["getDispatcher"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDiscreteDynamicsWorld_getDispatcher_0(self),btDispatcher)});btDiscreteDynamicsWorld.prototype["rayTest"]=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btDiscreteDynamicsWorld_rayTest_3(self,arg0,arg1,arg2)});btDiscreteDynamicsWorld.prototype["getPairCache"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDiscreteDynamicsWorld_getPairCache_0(self),btOverlappingPairCache)});btDiscreteDynamicsWorld.prototype["getDispatchInfo"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDiscreteDynamicsWorld_getDispatchInfo_0(self),btDispatcherInfo)});btDiscreteDynamicsWorld.prototype["addCollisionObject"]=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg1===undefined){_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_1(self,arg0);return}if(arg2===undefined){_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_2(self,arg0,arg1);return}_emscripten_bind_btDiscreteDynamicsWorld_addCollisionObject_3(self,arg0,arg1,arg2)});btDiscreteDynamicsWorld.prototype["getBroadphase"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDiscreteDynamicsWorld_getBroadphase_0(self),btBroadphaseInterface)});btDiscreteDynamicsWorld.prototype["convexSweepTest"]=(function(arg0,arg1,arg2,arg3,arg4){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);_emscripten_bind_btDiscreteDynamicsWorld_convexSweepTest_5(self,arg0,arg1,arg2,arg3,arg4)});btDiscreteDynamicsWorld.prototype["contactPairTest"]=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btDiscreteDynamicsWorld_contactPairTest_3(self,arg0,arg1,arg2)});btDiscreteDynamicsWorld.prototype["addAction"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDiscreteDynamicsWorld_addAction_1(self,arg0)});btDiscreteDynamicsWorld.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btDiscreteDynamicsWorld___destroy___0(self)});function btConvexTriangleMeshShape(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg1===undefined){this.ptr=_emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_1(arg0);getCache(btConvexTriangleMeshShape)[this.ptr]=this;return}this.ptr=_emscripten_bind_btConvexTriangleMeshShape_btConvexTriangleMeshShape_2(arg0,arg1);getCache(btConvexTriangleMeshShape)[this.ptr]=this}btConvexTriangleMeshShape.prototype=Object.create(btConvexShape.prototype);btConvexTriangleMeshShape.prototype.constructor=btConvexTriangleMeshShape;btConvexTriangleMeshShape.prototype.__class__=btConvexTriangleMeshShape;btConvexTriangleMeshShape.__cache__={};Module["btConvexTriangleMeshShape"]=btConvexTriangleMeshShape;btConvexTriangleMeshShape.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConvexTriangleMeshShape_setLocalScaling_1(self,arg0)});btConvexTriangleMeshShape.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btConvexTriangleMeshShape_calculateLocalInertia_2(self,arg0,arg1)});btConvexTriangleMeshShape.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btConvexTriangleMeshShape___destroy___0(self)});function ConvexResultCallback(){throw"cannot construct a ConvexResultCallback, no constructor in IDL"}ConvexResultCallback.prototype=Object.create(WrapperObject.prototype);ConvexResultCallback.prototype.constructor=ConvexResultCallback;ConvexResultCallback.prototype.__class__=ConvexResultCallback;ConvexResultCallback.__cache__={};Module["ConvexResultCallback"]=ConvexResultCallback;ConvexResultCallback.prototype["hasHit"]=(function(){var self=this.ptr;return _emscripten_bind_ConvexResultCallback_hasHit_0(self)});ConvexResultCallback.prototype["get_m_collisionFilterGroup"]=(function(){var self=this.ptr;return _emscripten_bind_ConvexResultCallback_get_m_collisionFilterGroup_0(self)});ConvexResultCallback.prototype["set_m_collisionFilterGroup"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ConvexResultCallback_set_m_collisionFilterGroup_1(self,arg0)});ConvexResultCallback.prototype["get_m_collisionFilterMask"]=(function(){var self=this.ptr;return _emscripten_bind_ConvexResultCallback_get_m_collisionFilterMask_0(self)});ConvexResultCallback.prototype["set_m_collisionFilterMask"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ConvexResultCallback_set_m_collisionFilterMask_1(self,arg0)});ConvexResultCallback.prototype["get_m_closestHitFraction"]=(function(){var self=this.ptr;return _emscripten_bind_ConvexResultCallback_get_m_closestHitFraction_0(self)});ConvexResultCallback.prototype["set_m_closestHitFraction"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ConvexResultCallback_set_m_closestHitFraction_1(self,arg0)});ConvexResultCallback.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_ConvexResultCallback___destroy___0(self)});function btPoint2PointConstraint(arg0,arg1,arg2,arg3){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg2===undefined){this.ptr=_emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_2(arg0,arg1);getCache(btPoint2PointConstraint)[this.ptr]=this;return}if(arg3===undefined){this.ptr=_emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_3(arg0,arg1,arg2);getCache(btPoint2PointConstraint)[this.ptr]=this;return}this.ptr=_emscripten_bind_btPoint2PointConstraint_btPoint2PointConstraint_4(arg0,arg1,arg2,arg3);getCache(btPoint2PointConstraint)[this.ptr]=this}btPoint2PointConstraint.prototype=Object.create(btTypedConstraint.prototype);btPoint2PointConstraint.prototype.constructor=btPoint2PointConstraint;btPoint2PointConstraint.prototype.__class__=btPoint2PointConstraint;btPoint2PointConstraint.__cache__={};Module["btPoint2PointConstraint"]=btPoint2PointConstraint;btPoint2PointConstraint.prototype["setPivotA"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPoint2PointConstraint_setPivotA_1(self,arg0)});btPoint2PointConstraint.prototype["setPivotB"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPoint2PointConstraint_setPivotB_1(self,arg0)});btPoint2PointConstraint.prototype["getPivotInA"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btPoint2PointConstraint_getPivotInA_0(self),btVector3)});btPoint2PointConstraint.prototype["getPivotInB"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btPoint2PointConstraint_getPivotInB_0(self),btVector3)});btPoint2PointConstraint.prototype["enableFeedback"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPoint2PointConstraint_enableFeedback_1(self,arg0)});btPoint2PointConstraint.prototype["get_m_setting"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btPoint2PointConstraint_get_m_setting_0(self),btConstraintSetting)});btPoint2PointConstraint.prototype["set_m_setting"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btPoint2PointConstraint_set_m_setting_1(self,arg0)});btPoint2PointConstraint.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btPoint2PointConstraint___destroy___0(self)});function btMotionState(){throw"cannot construct a btMotionState, no constructor in IDL"}btMotionState.prototype=Object.create(WrapperObject.prototype);btMotionState.prototype.constructor=btMotionState;btMotionState.prototype.__class__=btMotionState;btMotionState.__cache__={};Module["btMotionState"]=btMotionState;btMotionState.prototype["getWorldTransform"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btMotionState_getWorldTransform_1(self,arg0)});btMotionState.prototype["setWorldTransform"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btMotionState_setWorldTransform_1(self,arg0)});btMotionState.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btMotionState___destroy___0(self)});function btSliderConstraint(arg0,arg1,arg2,arg3,arg4){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);if(arg3===undefined){this.ptr=_emscripten_bind_btSliderConstraint_btSliderConstraint_3(arg0,arg1,arg2);getCache(btSliderConstraint)[this.ptr]=this;return}if(arg4===undefined){this.ptr=_emscripten_bind_btSliderConstraint_btSliderConstraint_4(arg0,arg1,arg2,arg3);getCache(btSliderConstraint)[this.ptr]=this;return}this.ptr=_emscripten_bind_btSliderConstraint_btSliderConstraint_5(arg0,arg1,arg2,arg3,arg4);getCache(btSliderConstraint)[this.ptr]=this}btSliderConstraint.prototype=Object.create(btTypedConstraint.prototype);btSliderConstraint.prototype.constructor=btSliderConstraint;btSliderConstraint.prototype.__class__=btSliderConstraint;btSliderConstraint.__cache__={};Module["btSliderConstraint"]=btSliderConstraint;btSliderConstraint.prototype["setLowerLinLimit"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btSliderConstraint_setLowerLinLimit_1(self,arg0)});btSliderConstraint.prototype["setUpperLinLimit"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btSliderConstraint_setUpperLinLimit_1(self,arg0)});btSliderConstraint.prototype["setLowerAngLimit"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btSliderConstraint_setLowerAngLimit_1(self,arg0)});btSliderConstraint.prototype["setUpperAngLimit"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btSliderConstraint_setUpperAngLimit_1(self,arg0)});btSliderConstraint.prototype["enableFeedback"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btSliderConstraint_enableFeedback_1(self,arg0)});btSliderConstraint.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btSliderConstraint___destroy___0(self)});function btConeTwistConstraint(arg0,arg1,arg2,arg3){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg2===undefined){this.ptr=_emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_2(arg0,arg1);getCache(btConeTwistConstraint)[this.ptr]=this;return}if(arg3===undefined){this.ptr=_emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_3(arg0,arg1,arg2);getCache(btConeTwistConstraint)[this.ptr]=this;return}this.ptr=_emscripten_bind_btConeTwistConstraint_btConeTwistConstraint_4(arg0,arg1,arg2,arg3);getCache(btConeTwistConstraint)[this.ptr]=this}btConeTwistConstraint.prototype=Object.create(btTypedConstraint.prototype);btConeTwistConstraint.prototype.constructor=btConeTwistConstraint;btConeTwistConstraint.prototype.__class__=btConeTwistConstraint;btConeTwistConstraint.__cache__={};Module["btConeTwistConstraint"]=btConeTwistConstraint;btConeTwistConstraint.prototype["setLimit"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btConeTwistConstraint_setLimit_2(self,arg0,arg1)});btConeTwistConstraint.prototype["setAngularOnly"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeTwistConstraint_setAngularOnly_1(self,arg0)});btConeTwistConstraint.prototype["setDamping"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeTwistConstraint_setDamping_1(self,arg0)});btConeTwistConstraint.prototype["enableMotor"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeTwistConstraint_enableMotor_1(self,arg0)});btConeTwistConstraint.prototype["setMaxMotorImpulse"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeTwistConstraint_setMaxMotorImpulse_1(self,arg0)});btConeTwistConstraint.prototype["setMaxMotorImpulseNormalized"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeTwistConstraint_setMaxMotorImpulseNormalized_1(self,arg0)});btConeTwistConstraint.prototype["setMotorTarget"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeTwistConstraint_setMotorTarget_1(self,arg0)});btConeTwistConstraint.prototype["setMotorTargetInConstraintSpace"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeTwistConstraint_setMotorTargetInConstraintSpace_1(self,arg0)});btConeTwistConstraint.prototype["enableFeedback"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeTwistConstraint_enableFeedback_1(self,arg0)});btConeTwistConstraint.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btConeTwistConstraint___destroy___0(self)});function btConeShape(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);this.ptr=_emscripten_bind_btConeShape_btConeShape_2(arg0,arg1);getCache(btConeShape)[this.ptr]=this}btConeShape.prototype=Object.create(btCollisionShape.prototype);btConeShape.prototype.constructor=btConeShape;btConeShape.prototype.__class__=btConeShape;btConeShape.__cache__={};Module["btConeShape"]=btConeShape;btConeShape.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeShape_setLocalScaling_1(self,arg0)});btConeShape.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btConeShape_calculateLocalInertia_2(self,arg0,arg1)});btConeShape.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btConeShape___destroy___0(self)});function btConvexShape(){throw"cannot construct a btConvexShape, no constructor in IDL"}btConvexShape.prototype=Object.create(btCollisionShape.prototype);btConvexShape.prototype.constructor=btConvexShape;btConvexShape.prototype.__class__=btConvexShape;btConvexShape.__cache__={};Module["btConvexShape"]=btConvexShape;btConvexShape.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConvexShape_setLocalScaling_1(self,arg0)});btConvexShape.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btConvexShape_calculateLocalInertia_2(self,arg0,arg1)});btConvexShape.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btConvexShape___destroy___0(self)});function btDefaultCollisionConfiguration(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg0===undefined){this.ptr=_emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_0();getCache(btDefaultCollisionConfiguration)[this.ptr]=this;return}this.ptr=_emscripten_bind_btDefaultCollisionConfiguration_btDefaultCollisionConfiguration_1(arg0);getCache(btDefaultCollisionConfiguration)[this.ptr]=this}btDefaultCollisionConfiguration.prototype=Object.create(WrapperObject.prototype);btDefaultCollisionConfiguration.prototype.constructor=btDefaultCollisionConfiguration;btDefaultCollisionConfiguration.prototype.__class__=btDefaultCollisionConfiguration;btDefaultCollisionConfiguration.__cache__={};Module["btDefaultCollisionConfiguration"]=btDefaultCollisionConfiguration;btDefaultCollisionConfiguration.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btDefaultCollisionConfiguration___destroy___0(self)});function ContactResultCallback(){throw"cannot construct a ContactResultCallback, no constructor in IDL"}ContactResultCallback.prototype=Object.create(WrapperObject.prototype);ContactResultCallback.prototype.constructor=ContactResultCallback;ContactResultCallback.prototype.__class__=ContactResultCallback;ContactResultCallback.__cache__={};Module["ContactResultCallback"]=ContactResultCallback;ContactResultCallback.prototype["addSingleResult"]=(function(arg0,arg1,arg2,arg3,arg4,arg5,arg6){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);if(arg5&&typeof arg5==="object")arg5=arg5.ptr;else arg5=ensureString(arg5);if(arg6&&typeof arg6==="object")arg6=arg6.ptr;else arg6=ensureString(arg6);return _emscripten_bind_ContactResultCallback_addSingleResult_7(self,arg0,arg1,arg2,arg3,arg4,arg5,arg6)});ContactResultCallback.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_ContactResultCallback___destroy___0(self)});function btConeShapeZ(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);this.ptr=_emscripten_bind_btConeShapeZ_btConeShapeZ_2(arg0,arg1);getCache(btConeShapeZ)[this.ptr]=this}btConeShapeZ.prototype=Object.create(btConeShape.prototype);btConeShapeZ.prototype.constructor=btConeShapeZ;btConeShapeZ.prototype.__class__=btConeShapeZ;btConeShapeZ.__cache__={};Module["btConeShapeZ"]=btConeShapeZ;btConeShapeZ.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeShapeZ_setLocalScaling_1(self,arg0)});btConeShapeZ.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btConeShapeZ_calculateLocalInertia_2(self,arg0,arg1)});btConeShapeZ.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btConeShapeZ___destroy___0(self)});function btConeShapeX(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);this.ptr=_emscripten_bind_btConeShapeX_btConeShapeX_2(arg0,arg1);getCache(btConeShapeX)[this.ptr]=this}btConeShapeX.prototype=Object.create(btConeShape.prototype);btConeShapeX.prototype.constructor=btConeShapeX;btConeShapeX.prototype.__class__=btConeShapeX;btConeShapeX.__cache__={};Module["btConeShapeX"]=btConeShapeX;btConeShapeX.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConeShapeX_setLocalScaling_1(self,arg0)});btConeShapeX.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btConeShapeX_calculateLocalInertia_2(self,arg0,arg1)});btConeShapeX.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btConeShapeX___destroy___0(self)});function btTriangleMesh(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg0===undefined){this.ptr=_emscripten_bind_btTriangleMesh_btTriangleMesh_0();getCache(btTriangleMesh)[this.ptr]=this;return}if(arg1===undefined){this.ptr=_emscripten_bind_btTriangleMesh_btTriangleMesh_1(arg0);getCache(btTriangleMesh)[this.ptr]=this;return}this.ptr=_emscripten_bind_btTriangleMesh_btTriangleMesh_2(arg0,arg1);getCache(btTriangleMesh)[this.ptr]=this}btTriangleMesh.prototype=Object.create(btStridingMeshInterface.prototype);btTriangleMesh.prototype.constructor=btTriangleMesh;btTriangleMesh.prototype.__class__=btTriangleMesh;btTriangleMesh.__cache__={};Module["btTriangleMesh"]=btTriangleMesh;btTriangleMesh.prototype["addTriangle"]=(function(arg0,arg1,arg2,arg3){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg3===undefined){_emscripten_bind_btTriangleMesh_addTriangle_3(self,arg0,arg1,arg2);return}_emscripten_bind_btTriangleMesh_addTriangle_4(self,arg0,arg1,arg2,arg3)});btTriangleMesh.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btTriangleMesh___destroy___0(self)});function btConvexHullShape(){this.ptr=_emscripten_bind_btConvexHullShape_btConvexHullShape_0();getCache(btConvexHullShape)[this.ptr]=this}btConvexHullShape.prototype=Object.create(btCollisionShape.prototype);btConvexHullShape.prototype.constructor=btConvexHullShape;btConvexHullShape.prototype.__class__=btConvexHullShape;btConvexHullShape.__cache__={};Module["btConvexHullShape"]=btConvexHullShape;btConvexHullShape.prototype["addPoint"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg1===undefined){_emscripten_bind_btConvexHullShape_addPoint_1(self,arg0);return}_emscripten_bind_btConvexHullShape_addPoint_2(self,arg0,arg1)});btConvexHullShape.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConvexHullShape_setLocalScaling_1(self,arg0)});btConvexHullShape.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btConvexHullShape_calculateLocalInertia_2(self,arg0,arg1)});btConvexHullShape.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btConvexHullShape___destroy___0(self)});function btPersistentManifold(){this.ptr=_emscripten_bind_btPersistentManifold_btPersistentManifold_0();getCache(btPersistentManifold)[this.ptr]=this}btPersistentManifold.prototype=Object.create(WrapperObject.prototype);btPersistentManifold.prototype.constructor=btPersistentManifold;btPersistentManifold.prototype.__class__=btPersistentManifold;btPersistentManifold.__cache__={};Module["btPersistentManifold"]=btPersistentManifold;btPersistentManifold.prototype["getBody0"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btPersistentManifold_getBody0_0(self),btCollisionObject)});btPersistentManifold.prototype["getBody1"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btPersistentManifold_getBody1_0(self),btCollisionObject)});btPersistentManifold.prototype["getNumContacts"]=(function(){var self=this.ptr;return _emscripten_bind_btPersistentManifold_getNumContacts_0(self)});btPersistentManifold.prototype["getContactPoint"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btPersistentManifold_getContactPoint_1(self,arg0),btManifoldPoint)});btPersistentManifold.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btPersistentManifold___destroy___0(self)});function btBoxShape(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);this.ptr=_emscripten_bind_btBoxShape_btBoxShape_1(arg0);getCache(btBoxShape)[this.ptr]=this}btBoxShape.prototype=Object.create(btCollisionShape.prototype);btBoxShape.prototype.constructor=btBoxShape;btBoxShape.prototype.__class__=btBoxShape;btBoxShape.__cache__={};Module["btBoxShape"]=btBoxShape;btBoxShape.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btBoxShape_setLocalScaling_1(self,arg0)});btBoxShape.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btBoxShape_calculateLocalInertia_2(self,arg0,arg1)});btBoxShape.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btBoxShape___destroy___0(self)});function btCollisionDispatcher(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);this.ptr=_emscripten_bind_btCollisionDispatcher_btCollisionDispatcher_1(arg0);getCache(btCollisionDispatcher)[this.ptr]=this}btCollisionDispatcher.prototype=Object.create(btDispatcher.prototype);btCollisionDispatcher.prototype.constructor=btCollisionDispatcher;btCollisionDispatcher.prototype.__class__=btCollisionDispatcher;btCollisionDispatcher.__cache__={};Module["btCollisionDispatcher"]=btCollisionDispatcher;btCollisionDispatcher.prototype["getNumManifolds"]=(function(){var self=this.ptr;return _emscripten_bind_btCollisionDispatcher_getNumManifolds_0(self)});btCollisionDispatcher.prototype["getManifoldByIndexInternal"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btCollisionDispatcher_getManifoldByIndexInternal_1(self,arg0),btPersistentManifold)});btCollisionDispatcher.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btCollisionDispatcher___destroy___0(self)});function btVehicleTuning(){this.ptr=_emscripten_bind_btVehicleTuning_btVehicleTuning_0();getCache(btVehicleTuning)[this.ptr]=this}btVehicleTuning.prototype=Object.create(WrapperObject.prototype);btVehicleTuning.prototype.constructor=btVehicleTuning;btVehicleTuning.prototype.__class__=btVehicleTuning;btVehicleTuning.__cache__={};Module["btVehicleTuning"]=btVehicleTuning;btVehicleTuning.prototype["get_m_suspensionStiffness"]=(function(){var self=this.ptr;return _emscripten_bind_btVehicleTuning_get_m_suspensionStiffness_0(self)});btVehicleTuning.prototype["set_m_suspensionStiffness"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVehicleTuning_set_m_suspensionStiffness_1(self,arg0)});btVehicleTuning.prototype["get_m_suspensionCompression"]=(function(){var self=this.ptr;return _emscripten_bind_btVehicleTuning_get_m_suspensionCompression_0(self)});btVehicleTuning.prototype["set_m_suspensionCompression"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVehicleTuning_set_m_suspensionCompression_1(self,arg0)});btVehicleTuning.prototype["get_m_suspensionDamping"]=(function(){var self=this.ptr;return _emscripten_bind_btVehicleTuning_get_m_suspensionDamping_0(self)});btVehicleTuning.prototype["set_m_suspensionDamping"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVehicleTuning_set_m_suspensionDamping_1(self,arg0)});btVehicleTuning.prototype["get_m_maxSuspensionTravelCm"]=(function(){var self=this.ptr;return _emscripten_bind_btVehicleTuning_get_m_maxSuspensionTravelCm_0(self)});btVehicleTuning.prototype["set_m_maxSuspensionTravelCm"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVehicleTuning_set_m_maxSuspensionTravelCm_1(self,arg0)});btVehicleTuning.prototype["get_m_frictionSlip"]=(function(){var self=this.ptr;return _emscripten_bind_btVehicleTuning_get_m_frictionSlip_0(self)});btVehicleTuning.prototype["set_m_frictionSlip"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVehicleTuning_set_m_frictionSlip_1(self,arg0)});btVehicleTuning.prototype["get_m_maxSuspensionForce"]=(function(){var self=this.ptr;return _emscripten_bind_btVehicleTuning_get_m_maxSuspensionForce_0(self)});btVehicleTuning.prototype["set_m_maxSuspensionForce"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVehicleTuning_set_m_maxSuspensionForce_1(self,arg0)});function btCompoundShape(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg0===undefined){this.ptr=_emscripten_bind_btCompoundShape_btCompoundShape_0();getCache(btCompoundShape)[this.ptr]=this;return}this.ptr=_emscripten_bind_btCompoundShape_btCompoundShape_1(arg0);getCache(btCompoundShape)[this.ptr]=this}btCompoundShape.prototype=Object.create(btCollisionShape.prototype);btCompoundShape.prototype.constructor=btCompoundShape;btCompoundShape.prototype.__class__=btCompoundShape;btCompoundShape.__cache__={};Module["btCompoundShape"]=btCompoundShape;btCompoundShape.prototype["addChildShape"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCompoundShape_addChildShape_2(self,arg0,arg1)});btCompoundShape.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCompoundShape_setLocalScaling_1(self,arg0)});btCompoundShape.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCompoundShape_calculateLocalInertia_2(self,arg0,arg1)});btCompoundShape.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btCompoundShape___destroy___0(self)});function btCollisionObjectWrapper(){throw"cannot construct a btCollisionObjectWrapper, no constructor in IDL"}btCollisionObjectWrapper.prototype=Object.create(WrapperObject.prototype);btCollisionObjectWrapper.prototype.constructor=btCollisionObjectWrapper;btCollisionObjectWrapper.prototype.__class__=btCollisionObjectWrapper;btCollisionObjectWrapper.__cache__={};Module["btCollisionObjectWrapper"]=btCollisionObjectWrapper;function ClosestConvexResultCallback(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);this.ptr=_emscripten_bind_ClosestConvexResultCallback_ClosestConvexResultCallback_2(arg0,arg1);getCache(ClosestConvexResultCallback)[this.ptr]=this}ClosestConvexResultCallback.prototype=Object.create(ConvexResultCallback.prototype);ClosestConvexResultCallback.prototype.constructor=ClosestConvexResultCallback;ClosestConvexResultCallback.prototype.__class__=ClosestConvexResultCallback;ClosestConvexResultCallback.__cache__={};Module["ClosestConvexResultCallback"]=ClosestConvexResultCallback;ClosestConvexResultCallback.prototype["hasHit"]=(function(){var self=this.ptr;return _emscripten_bind_ClosestConvexResultCallback_hasHit_0(self)});ClosestConvexResultCallback.prototype["get_m_convexFromWorld"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_ClosestConvexResultCallback_get_m_convexFromWorld_0(self),btVector3)});ClosestConvexResultCallback.prototype["set_m_convexFromWorld"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestConvexResultCallback_set_m_convexFromWorld_1(self,arg0)});ClosestConvexResultCallback.prototype["get_m_convexToWorld"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_ClosestConvexResultCallback_get_m_convexToWorld_0(self),btVector3)});ClosestConvexResultCallback.prototype["set_m_convexToWorld"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestConvexResultCallback_set_m_convexToWorld_1(self,arg0)});ClosestConvexResultCallback.prototype["get_m_hitNormalWorld"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_ClosestConvexResultCallback_get_m_hitNormalWorld_0(self),btVector3)});ClosestConvexResultCallback.prototype["set_m_hitNormalWorld"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestConvexResultCallback_set_m_hitNormalWorld_1(self,arg0)});ClosestConvexResultCallback.prototype["get_m_hitPointWorld"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_ClosestConvexResultCallback_get_m_hitPointWorld_0(self),btVector3)});ClosestConvexResultCallback.prototype["set_m_hitPointWorld"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestConvexResultCallback_set_m_hitPointWorld_1(self,arg0)});ClosestConvexResultCallback.prototype["get_m_collisionFilterGroup"]=(function(){var self=this.ptr;return _emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterGroup_0(self)});ClosestConvexResultCallback.prototype["set_m_collisionFilterGroup"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterGroup_1(self,arg0)});ClosestConvexResultCallback.prototype["get_m_collisionFilterMask"]=(function(){var self=this.ptr;return _emscripten_bind_ClosestConvexResultCallback_get_m_collisionFilterMask_0(self)});ClosestConvexResultCallback.prototype["set_m_collisionFilterMask"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestConvexResultCallback_set_m_collisionFilterMask_1(self,arg0)});ClosestConvexResultCallback.prototype["get_m_closestHitFraction"]=(function(){var self=this.ptr;return _emscripten_bind_ClosestConvexResultCallback_get_m_closestHitFraction_0(self)});ClosestConvexResultCallback.prototype["set_m_closestHitFraction"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestConvexResultCallback_set_m_closestHitFraction_1(self,arg0)});ClosestConvexResultCallback.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_ClosestConvexResultCallback___destroy___0(self)});function btDefaultMotionState(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg0===undefined){this.ptr=_emscripten_bind_btDefaultMotionState_btDefaultMotionState_0();getCache(btDefaultMotionState)[this.ptr]=this;return}if(arg1===undefined){this.ptr=_emscripten_bind_btDefaultMotionState_btDefaultMotionState_1(arg0);getCache(btDefaultMotionState)[this.ptr]=this;return}this.ptr=_emscripten_bind_btDefaultMotionState_btDefaultMotionState_2(arg0,arg1);getCache(btDefaultMotionState)[this.ptr]=this}btDefaultMotionState.prototype=Object.create(btMotionState.prototype);btDefaultMotionState.prototype.constructor=btDefaultMotionState;btDefaultMotionState.prototype.__class__=btDefaultMotionState;btDefaultMotionState.__cache__={};Module["btDefaultMotionState"]=btDefaultMotionState;btDefaultMotionState.prototype["getWorldTransform"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDefaultMotionState_getWorldTransform_1(self,arg0)});btDefaultMotionState.prototype["setWorldTransform"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDefaultMotionState_setWorldTransform_1(self,arg0)});btDefaultMotionState.prototype["get_m_graphicsWorldTrans"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDefaultMotionState_get_m_graphicsWorldTrans_0(self),btTransform)});btDefaultMotionState.prototype["set_m_graphicsWorldTrans"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDefaultMotionState_set_m_graphicsWorldTrans_1(self,arg0)});btDefaultMotionState.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btDefaultMotionState___destroy___0(self)});function btTriangleMeshShape(){throw"cannot construct a btTriangleMeshShape, no constructor in IDL"}btTriangleMeshShape.prototype=Object.create(btConcaveShape.prototype);btTriangleMeshShape.prototype.constructor=btTriangleMeshShape;btTriangleMeshShape.prototype.__class__=btTriangleMeshShape;btTriangleMeshShape.__cache__={};Module["btTriangleMeshShape"]=btTriangleMeshShape;btTriangleMeshShape.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btTriangleMeshShape_setLocalScaling_1(self,arg0)});btTriangleMeshShape.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btTriangleMeshShape_calculateLocalInertia_2(self,arg0,arg1)});btTriangleMeshShape.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btTriangleMeshShape___destroy___0(self)});function btDispatcher(){throw"cannot construct a btDispatcher, no constructor in IDL"}btDispatcher.prototype=Object.create(WrapperObject.prototype);btDispatcher.prototype.constructor=btDispatcher;btDispatcher.prototype.__class__=btDispatcher;btDispatcher.__cache__={};Module["btDispatcher"]=btDispatcher;btDispatcher.prototype["getNumManifolds"]=(function(){var self=this.ptr;return _emscripten_bind_btDispatcher_getNumManifolds_0(self)});btDispatcher.prototype["getManifoldByIndexInternal"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btDispatcher_getManifoldByIndexInternal_1(self,arg0),btPersistentManifold)});btDispatcher.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btDispatcher___destroy___0(self)});function ClosestRayResultCallback(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);this.ptr=_emscripten_bind_ClosestRayResultCallback_ClosestRayResultCallback_2(arg0,arg1);getCache(ClosestRayResultCallback)[this.ptr]=this}ClosestRayResultCallback.prototype=Object.create(RayResultCallback.prototype);ClosestRayResultCallback.prototype.constructor=ClosestRayResultCallback;ClosestRayResultCallback.prototype.__class__=ClosestRayResultCallback;ClosestRayResultCallback.__cache__={};Module["ClosestRayResultCallback"]=ClosestRayResultCallback;ClosestRayResultCallback.prototype["hasHit"]=(function(){var self=this.ptr;return _emscripten_bind_ClosestRayResultCallback_hasHit_0(self)});ClosestRayResultCallback.prototype["get_m_rayFromWorld"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_ClosestRayResultCallback_get_m_rayFromWorld_0(self),btVector3)});ClosestRayResultCallback.prototype["set_m_rayFromWorld"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestRayResultCallback_set_m_rayFromWorld_1(self,arg0)});ClosestRayResultCallback.prototype["get_m_rayToWorld"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_ClosestRayResultCallback_get_m_rayToWorld_0(self),btVector3)});ClosestRayResultCallback.prototype["set_m_rayToWorld"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestRayResultCallback_set_m_rayToWorld_1(self,arg0)});ClosestRayResultCallback.prototype["get_m_hitNormalWorld"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_ClosestRayResultCallback_get_m_hitNormalWorld_0(self),btVector3)});ClosestRayResultCallback.prototype["set_m_hitNormalWorld"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestRayResultCallback_set_m_hitNormalWorld_1(self,arg0)});ClosestRayResultCallback.prototype["get_m_hitPointWorld"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_ClosestRayResultCallback_get_m_hitPointWorld_0(self),btVector3)});ClosestRayResultCallback.prototype["set_m_hitPointWorld"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestRayResultCallback_set_m_hitPointWorld_1(self,arg0)});ClosestRayResultCallback.prototype["get_m_collisionFilterGroup"]=(function(){var self=this.ptr;return _emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterGroup_0(self)});ClosestRayResultCallback.prototype["set_m_collisionFilterGroup"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterGroup_1(self,arg0)});ClosestRayResultCallback.prototype["get_m_collisionFilterMask"]=(function(){var self=this.ptr;return _emscripten_bind_ClosestRayResultCallback_get_m_collisionFilterMask_0(self)});ClosestRayResultCallback.prototype["set_m_collisionFilterMask"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestRayResultCallback_set_m_collisionFilterMask_1(self,arg0)});ClosestRayResultCallback.prototype["get_m_collisionObject"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_ClosestRayResultCallback_get_m_collisionObject_0(self),btCollisionObject)});ClosestRayResultCallback.prototype["set_m_collisionObject"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_ClosestRayResultCallback_set_m_collisionObject_1(self,arg0)});ClosestRayResultCallback.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_ClosestRayResultCallback___destroy___0(self)});function btDynamicsWorld(){throw"cannot construct a btDynamicsWorld, no constructor in IDL"}btDynamicsWorld.prototype=Object.create(btCollisionWorld.prototype);btDynamicsWorld.prototype.constructor=btDynamicsWorld;btDynamicsWorld.prototype.__class__=btDynamicsWorld;btDynamicsWorld.__cache__={};Module["btDynamicsWorld"]=btDynamicsWorld;btDynamicsWorld.prototype["addAction"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btDynamicsWorld_addAction_1(self,arg0)});btDynamicsWorld.prototype["getDispatcher"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDynamicsWorld_getDispatcher_0(self),btDispatcher)});btDynamicsWorld.prototype["rayTest"]=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btDynamicsWorld_rayTest_3(self,arg0,arg1,arg2)});btDynamicsWorld.prototype["getPairCache"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDynamicsWorld_getPairCache_0(self),btOverlappingPairCache)});btDynamicsWorld.prototype["getDispatchInfo"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDynamicsWorld_getDispatchInfo_0(self),btDispatcherInfo)});btDynamicsWorld.prototype["addCollisionObject"]=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg1===undefined){_emscripten_bind_btDynamicsWorld_addCollisionObject_1(self,arg0);return}if(arg2===undefined){_emscripten_bind_btDynamicsWorld_addCollisionObject_2(self,arg0,arg1);return}_emscripten_bind_btDynamicsWorld_addCollisionObject_3(self,arg0,arg1,arg2)});btDynamicsWorld.prototype["getBroadphase"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btDynamicsWorld_getBroadphase_0(self),btBroadphaseInterface)});btDynamicsWorld.prototype["convexSweepTest"]=(function(arg0,arg1,arg2,arg3,arg4){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);_emscripten_bind_btDynamicsWorld_convexSweepTest_5(self,arg0,arg1,arg2,arg3,arg4)});btDynamicsWorld.prototype["contactPairTest"]=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btDynamicsWorld_contactPairTest_3(self,arg0,arg1,arg2)});btDynamicsWorld.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btDynamicsWorld___destroy___0(self)});function btCapsuleShapeX(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);this.ptr=_emscripten_bind_btCapsuleShapeX_btCapsuleShapeX_2(arg0,arg1);getCache(btCapsuleShapeX)[this.ptr]=this}btCapsuleShapeX.prototype=Object.create(btCapsuleShape.prototype);btCapsuleShapeX.prototype.constructor=btCapsuleShapeX;btCapsuleShapeX.prototype.__class__=btCapsuleShapeX;btCapsuleShapeX.__cache__={};Module["btCapsuleShapeX"]=btCapsuleShapeX;btCapsuleShapeX.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCapsuleShapeX_setLocalScaling_1(self,arg0)});btCapsuleShapeX.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCapsuleShapeX_calculateLocalInertia_2(self,arg0,arg1)});btCapsuleShapeX.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btCapsuleShapeX___destroy___0(self)});function btQuaternion(arg0,arg1,arg2,arg3){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);this.ptr=_emscripten_bind_btQuaternion_btQuaternion_4(arg0,arg1,arg2,arg3);getCache(btQuaternion)[this.ptr]=this}btQuaternion.prototype=Object.create(btQuadWord.prototype);btQuaternion.prototype.constructor=btQuaternion;btQuaternion.prototype.__class__=btQuaternion;btQuaternion.__cache__={};Module["btQuaternion"]=btQuaternion;btQuaternion.prototype["setValue"]=(function(arg0,arg1,arg2,arg3){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);_emscripten_bind_btQuaternion_setValue_4(self,arg0,arg1,arg2,arg3)});btQuaternion.prototype["x"]=(function(){var self=this.ptr;return _emscripten_bind_btQuaternion_x_0(self)});btQuaternion.prototype["y"]=(function(){var self=this.ptr;return _emscripten_bind_btQuaternion_y_0(self)});btQuaternion.prototype["z"]=(function(){var self=this.ptr;return _emscripten_bind_btQuaternion_z_0(self)});btQuaternion.prototype["w"]=(function(){var self=this.ptr;return _emscripten_bind_btQuaternion_w_0(self)});btQuaternion.prototype["setX"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btQuaternion_setX_1(self,arg0)});btQuaternion.prototype["setY"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btQuaternion_setY_1(self,arg0)});btQuaternion.prototype["setZ"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btQuaternion_setZ_1(self,arg0)});btQuaternion.prototype["setW"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btQuaternion_setW_1(self,arg0)});btQuaternion.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btQuaternion___destroy___0(self)});function btCapsuleShapeZ(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);this.ptr=_emscripten_bind_btCapsuleShapeZ_btCapsuleShapeZ_2(arg0,arg1);getCache(btCapsuleShapeZ)[this.ptr]=this}btCapsuleShapeZ.prototype=Object.create(btCapsuleShape.prototype);btCapsuleShapeZ.prototype.constructor=btCapsuleShapeZ;btCapsuleShapeZ.prototype.__class__=btCapsuleShapeZ;btCapsuleShapeZ.__cache__={};Module["btCapsuleShapeZ"]=btCapsuleShapeZ;btCapsuleShapeZ.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCapsuleShapeZ_setLocalScaling_1(self,arg0)});btCapsuleShapeZ.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCapsuleShapeZ_calculateLocalInertia_2(self,arg0,arg1)});btCapsuleShapeZ.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btCapsuleShapeZ___destroy___0(self)});function btDefaultVehicleRaycaster(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);this.ptr=_emscripten_bind_btDefaultVehicleRaycaster_btDefaultVehicleRaycaster_1(arg0);getCache(btDefaultVehicleRaycaster)[this.ptr]=this}btDefaultVehicleRaycaster.prototype=Object.create(btVehicleRaycaster.prototype);btDefaultVehicleRaycaster.prototype.constructor=btDefaultVehicleRaycaster;btDefaultVehicleRaycaster.prototype.__class__=btDefaultVehicleRaycaster;btDefaultVehicleRaycaster.__cache__={};Module["btDefaultVehicleRaycaster"]=btDefaultVehicleRaycaster;btDefaultVehicleRaycaster.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btDefaultVehicleRaycaster___destroy___0(self)});function RayResultCallback(){throw"cannot construct a RayResultCallback, no constructor in IDL"}RayResultCallback.prototype=Object.create(WrapperObject.prototype);RayResultCallback.prototype.constructor=RayResultCallback;RayResultCallback.prototype.__class__=RayResultCallback;RayResultCallback.__cache__={};Module["RayResultCallback"]=RayResultCallback;RayResultCallback.prototype["hasHit"]=(function(){var self=this.ptr;return _emscripten_bind_RayResultCallback_hasHit_0(self)});RayResultCallback.prototype["get_m_collisionFilterGroup"]=(function(){var self=this.ptr;return _emscripten_bind_RayResultCallback_get_m_collisionFilterGroup_0(self)});RayResultCallback.prototype["set_m_collisionFilterGroup"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_RayResultCallback_set_m_collisionFilterGroup_1(self,arg0)});RayResultCallback.prototype["get_m_collisionFilterMask"]=(function(){var self=this.ptr;return _emscripten_bind_RayResultCallback_get_m_collisionFilterMask_0(self)});RayResultCallback.prototype["set_m_collisionFilterMask"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_RayResultCallback_set_m_collisionFilterMask_1(self,arg0)});RayResultCallback.prototype["get_m_collisionObject"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_RayResultCallback_get_m_collisionObject_0(self),btCollisionObject)});RayResultCallback.prototype["set_m_collisionObject"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_RayResultCallback_set_m_collisionObject_1(self,arg0)});RayResultCallback.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_RayResultCallback___destroy___0(self)});function btWheelInfo(){throw"cannot construct a btWheelInfo, no constructor in IDL"}btWheelInfo.prototype=Object.create(WrapperObject.prototype);btWheelInfo.prototype.constructor=btWheelInfo;btWheelInfo.prototype.__class__=btWheelInfo;btWheelInfo.__cache__={};Module["btWheelInfo"]=btWheelInfo;btWheelInfo.prototype["get_m_suspensionStiffness"]=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_suspensionStiffness_0(self)});btWheelInfo.prototype["set_m_suspensionStiffness"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_suspensionStiffness_1(self,arg0)});btWheelInfo.prototype["get_m_frictionSlip"]=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_frictionSlip_0(self)});btWheelInfo.prototype["set_m_frictionSlip"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_frictionSlip_1(self,arg0)});btWheelInfo.prototype["get_m_rollInfluence"]=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_rollInfluence_0(self)});btWheelInfo.prototype["set_m_rollInfluence"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_rollInfluence_1(self,arg0)});btWheelInfo.prototype["get_m_suspensionRestLength1"]=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_suspensionRestLength1_0(self)});btWheelInfo.prototype["set_m_suspensionRestLength1"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_suspensionRestLength1_1(self,arg0)});btWheelInfo.prototype["get_m_wheelsRadius"]=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_wheelsRadius_0(self)});btWheelInfo.prototype["set_m_wheelsRadius"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_wheelsRadius_1(self,arg0)});btWheelInfo.prototype["get_m_wheelsDampingCompression"]=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_wheelsDampingCompression_0(self)});btWheelInfo.prototype["set_m_wheelsDampingCompression"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_wheelsDampingCompression_1(self,arg0)});btWheelInfo.prototype["get_m_wheelsDampingRelaxation"]=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_wheelsDampingRelaxation_0(self)});btWheelInfo.prototype["set_m_wheelsDampingRelaxation"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_wheelsDampingRelaxation_1(self,arg0)});btWheelInfo.prototype["get_m_steering"]=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_steering_0(self)});btWheelInfo.prototype["set_m_steering"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_steering_1(self,arg0)});btWheelInfo.prototype["get_m_maxSuspensionForce"]=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_maxSuspensionForce_0(self)});btWheelInfo.prototype["set_m_maxSuspensionForce"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_maxSuspensionForce_1(self,arg0)});btWheelInfo.prototype["get_m_maxSuspensionTravelCm"]=(function(){var self=this.ptr;return _emscripten_bind_btWheelInfo_get_m_maxSuspensionTravelCm_0(self)});btWheelInfo.prototype["set_m_maxSuspensionTravelCm"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btWheelInfo_set_m_maxSuspensionTravelCm_1(self,arg0)});btWheelInfo.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btWheelInfo___destroy___0(self)});function btConcaveShape(){throw"cannot construct a btConcaveShape, no constructor in IDL"}btConcaveShape.prototype=Object.create(btCollisionShape.prototype);btConcaveShape.prototype.constructor=btConcaveShape;btConcaveShape.prototype.__class__=btConcaveShape;btConcaveShape.__cache__={};Module["btConcaveShape"]=btConcaveShape;btConcaveShape.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConcaveShape_setLocalScaling_1(self,arg0)});btConcaveShape.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btConcaveShape_calculateLocalInertia_2(self,arg0,arg1)});btConcaveShape.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btConcaveShape___destroy___0(self)});function btVector4(arg0,arg1,arg2,arg3){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg0===undefined){this.ptr=_emscripten_bind_btVector4_btVector4_0();getCache(btVector4)[this.ptr]=this;return}if(arg1===undefined){this.ptr=_emscripten_bind_btVector4_btVector4_1(arg0);getCache(btVector4)[this.ptr]=this;return}if(arg2===undefined){this.ptr=_emscripten_bind_btVector4_btVector4_2(arg0,arg1);getCache(btVector4)[this.ptr]=this;return}if(arg3===undefined){this.ptr=_emscripten_bind_btVector4_btVector4_3(arg0,arg1,arg2);getCache(btVector4)[this.ptr]=this;return}this.ptr=_emscripten_bind_btVector4_btVector4_4(arg0,arg1,arg2,arg3);getCache(btVector4)[this.ptr]=this}btVector4.prototype=Object.create(btVector3.prototype);btVector4.prototype.constructor=btVector4;btVector4.prototype.__class__=btVector4;btVector4.__cache__={};Module["btVector4"]=btVector4;btVector4.prototype["w"]=(function(){var self=this.ptr;return _emscripten_bind_btVector4_w_0(self)});btVector4.prototype["setValue"]=(function(arg0,arg1,arg2,arg3){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);_emscripten_bind_btVector4_setValue_4(self,arg0,arg1,arg2,arg3)});btVector4.prototype["length"]=(function(){var self=this.ptr;return _emscripten_bind_btVector4_length_0(self)});btVector4.prototype["x"]=(function(){var self=this.ptr;return _emscripten_bind_btVector4_x_0(self)});btVector4.prototype["y"]=(function(){var self=this.ptr;return _emscripten_bind_btVector4_y_0(self)});btVector4.prototype["z"]=(function(){var self=this.ptr;return _emscripten_bind_btVector4_z_0(self)});btVector4.prototype["setX"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVector4_setX_1(self,arg0)});btVector4.prototype["setY"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVector4_setY_1(self,arg0)});btVector4.prototype["setZ"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVector4_setZ_1(self,arg0)});btVector4.prototype["op_mul"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btVector4_op_mul_1(self,arg0),btVector3)});btVector4.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btVector4___destroy___0(self)});function btKinematicCharacterController(arg0,arg1,arg2,arg3){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg3===undefined){this.ptr=_emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_3(arg0,arg1,arg2);getCache(btKinematicCharacterController)[this.ptr]=this;return}this.ptr=_emscripten_bind_btKinematicCharacterController_btKinematicCharacterController_4(arg0,arg1,arg2,arg3);getCache(btKinematicCharacterController)[this.ptr]=this}btKinematicCharacterController.prototype=Object.create(btActionInterface.prototype);btKinematicCharacterController.prototype.constructor=btKinematicCharacterController;btKinematicCharacterController.prototype.__class__=btKinematicCharacterController;btKinematicCharacterController.__cache__={};Module["btKinematicCharacterController"]=btKinematicCharacterController;btKinematicCharacterController.prototype["setUpAxis"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_setUpAxis_1(self,arg0)});btKinematicCharacterController.prototype["setWalkDirection"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_setWalkDirection_1(self,arg0)});btKinematicCharacterController.prototype["setVelocityForTimeInterval"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btKinematicCharacterController_setVelocityForTimeInterval_2(self,arg0,arg1)});btKinematicCharacterController.prototype["warp"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_warp_1(self,arg0)});btKinematicCharacterController.prototype["preStep"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_preStep_1(self,arg0)});btKinematicCharacterController.prototype["playerStep"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btKinematicCharacterController_playerStep_2(self,arg0,arg1)});btKinematicCharacterController.prototype["setFallSpeed"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_setFallSpeed_1(self,arg0)});btKinematicCharacterController.prototype["setJumpSpeed"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_setJumpSpeed_1(self,arg0)});btKinematicCharacterController.prototype["setMaxJumpHeight"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_setMaxJumpHeight_1(self,arg0)});btKinematicCharacterController.prototype["canJump"]=(function(){var self=this.ptr;return _emscripten_bind_btKinematicCharacterController_canJump_0(self)});btKinematicCharacterController.prototype["jump"]=(function(){var self=this.ptr;_emscripten_bind_btKinematicCharacterController_jump_0(self)});btKinematicCharacterController.prototype["setGravity"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_setGravity_1(self,arg0)});btKinematicCharacterController.prototype["getGravity"]=(function(){var self=this.ptr;return _emscripten_bind_btKinematicCharacterController_getGravity_0(self)});btKinematicCharacterController.prototype["setMaxSlope"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_setMaxSlope_1(self,arg0)});btKinematicCharacterController.prototype["getMaxSlope"]=(function(){var self=this.ptr;return _emscripten_bind_btKinematicCharacterController_getMaxSlope_0(self)});btKinematicCharacterController.prototype["getGhostObject"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btKinematicCharacterController_getGhostObject_0(self),btPairCachingGhostObject)});btKinematicCharacterController.prototype["setUseGhostSweepTest"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btKinematicCharacterController_setUseGhostSweepTest_1(self,arg0)});btKinematicCharacterController.prototype["onGround"]=(function(){var self=this.ptr;return _emscripten_bind_btKinematicCharacterController_onGround_0(self)});btKinematicCharacterController.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btKinematicCharacterController___destroy___0(self)});function btStaticPlaneShape(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);this.ptr=_emscripten_bind_btStaticPlaneShape_btStaticPlaneShape_2(arg0,arg1);getCache(btStaticPlaneShape)[this.ptr]=this}btStaticPlaneShape.prototype=Object.create(btConcaveShape.prototype);btStaticPlaneShape.prototype.constructor=btStaticPlaneShape;btStaticPlaneShape.prototype.__class__=btStaticPlaneShape;btStaticPlaneShape.__cache__={};Module["btStaticPlaneShape"]=btStaticPlaneShape;btStaticPlaneShape.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btStaticPlaneShape_setLocalScaling_1(self,arg0)});btStaticPlaneShape.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btStaticPlaneShape_calculateLocalInertia_2(self,arg0,arg1)});btStaticPlaneShape.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btStaticPlaneShape___destroy___0(self)});function btActionInterface(){throw"cannot construct a btActionInterface, no constructor in IDL"}btActionInterface.prototype=Object.create(WrapperObject.prototype);btActionInterface.prototype.constructor=btActionInterface;btActionInterface.prototype.__class__=btActionInterface;btActionInterface.__cache__={};Module["btActionInterface"]=btActionInterface;btActionInterface.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btActionInterface___destroy___0(self)});function btOverlappingPairCache(){throw"cannot construct a btOverlappingPairCache, no constructor in IDL"}btOverlappingPairCache.prototype=Object.create(WrapperObject.prototype);btOverlappingPairCache.prototype.constructor=btOverlappingPairCache;btOverlappingPairCache.prototype.__class__=btOverlappingPairCache;btOverlappingPairCache.__cache__={};Module["btOverlappingPairCache"]=btOverlappingPairCache;btOverlappingPairCache.prototype["setInternalGhostPairCallback"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btOverlappingPairCache_setInternalGhostPairCallback_1(self,arg0)});btOverlappingPairCache.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btOverlappingPairCache___destroy___0(self)});function btVector3(arg0,arg1,arg2){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg0===undefined){this.ptr=_emscripten_bind_btVector3_btVector3_0();getCache(btVector3)[this.ptr]=this;return}if(arg1===undefined){this.ptr=_emscripten_bind_btVector3_btVector3_1(arg0);getCache(btVector3)[this.ptr]=this;return}if(arg2===undefined){this.ptr=_emscripten_bind_btVector3_btVector3_2(arg0,arg1);getCache(btVector3)[this.ptr]=this;return}this.ptr=_emscripten_bind_btVector3_btVector3_3(arg0,arg1,arg2);getCache(btVector3)[this.ptr]=this}btVector3.prototype=Object.create(WrapperObject.prototype);btVector3.prototype.constructor=btVector3;btVector3.prototype.__class__=btVector3;btVector3.__cache__={};Module["btVector3"]=btVector3;btVector3.prototype["length"]=(function(){var self=this.ptr;return _emscripten_bind_btVector3_length_0(self)});btVector3.prototype["x"]=(function(){var self=this.ptr;return _emscripten_bind_btVector3_x_0(self)});btVector3.prototype["y"]=(function(){var self=this.ptr;return _emscripten_bind_btVector3_y_0(self)});btVector3.prototype["z"]=(function(){var self=this.ptr;return _emscripten_bind_btVector3_z_0(self)});btVector3.prototype["setX"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVector3_setX_1(self,arg0)});btVector3.prototype["setY"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVector3_setY_1(self,arg0)});btVector3.prototype["setZ"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btVector3_setZ_1(self,arg0)});btVector3.prototype["setValue"]=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btVector3_setValue_3(self,arg0,arg1,arg2)});btVector3.prototype["op_mul"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btVector3_op_mul_1(self,arg0),btVector3)});btVector3.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btVector3___destroy___0(self)});function btVehicleRaycaster(){throw"cannot construct a btVehicleRaycaster, no constructor in IDL"}btVehicleRaycaster.prototype=Object.create(WrapperObject.prototype);btVehicleRaycaster.prototype.constructor=btVehicleRaycaster;btVehicleRaycaster.prototype.__class__=btVehicleRaycaster;btVehicleRaycaster.__cache__={};Module["btVehicleRaycaster"]=btVehicleRaycaster;btVehicleRaycaster.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btVehicleRaycaster___destroy___0(self)});function btSphereShape(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);this.ptr=_emscripten_bind_btSphereShape_btSphereShape_1(arg0);getCache(btSphereShape)[this.ptr]=this}btSphereShape.prototype=Object.create(btCollisionShape.prototype);btSphereShape.prototype.constructor=btSphereShape;btSphereShape.prototype.__class__=btSphereShape;btSphereShape.__cache__={};Module["btSphereShape"]=btSphereShape;btSphereShape.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btSphereShape_setLocalScaling_1(self,arg0)});btSphereShape.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btSphereShape_calculateLocalInertia_2(self,arg0,arg1)});btSphereShape.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btSphereShape___destroy___0(self)});function btDefaultCollisionConstructionInfo(){this.ptr=_emscripten_bind_btDefaultCollisionConstructionInfo_btDefaultCollisionConstructionInfo_0();getCache(btDefaultCollisionConstructionInfo)[this.ptr]=this}btDefaultCollisionConstructionInfo.prototype=Object.create(WrapperObject.prototype);btDefaultCollisionConstructionInfo.prototype.constructor=btDefaultCollisionConstructionInfo;btDefaultCollisionConstructionInfo.prototype.__class__=btDefaultCollisionConstructionInfo;btDefaultCollisionConstructionInfo.__cache__={};Module["btDefaultCollisionConstructionInfo"]=btDefaultCollisionConstructionInfo;btDefaultCollisionConstructionInfo.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btDefaultCollisionConstructionInfo___destroy___0(self)});function btHingeConstraint(arg0,arg1,arg2,arg3,arg4,arg5,arg6){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);if(arg5&&typeof arg5==="object")arg5=arg5.ptr;else arg5=ensureString(arg5);if(arg6&&typeof arg6==="object")arg6=arg6.ptr;else arg6=ensureString(arg6);if(arg2===undefined){this.ptr=_emscripten_bind_btHingeConstraint_btHingeConstraint_2(arg0,arg1);getCache(btHingeConstraint)[this.ptr]=this;return}if(arg3===undefined){this.ptr=_emscripten_bind_btHingeConstraint_btHingeConstraint_3(arg0,arg1,arg2);getCache(btHingeConstraint)[this.ptr]=this;return}if(arg4===undefined){this.ptr=_emscripten_bind_btHingeConstraint_btHingeConstraint_4(arg0,arg1,arg2,arg3);getCache(btHingeConstraint)[this.ptr]=this;return}if(arg5===undefined){this.ptr=_emscripten_bind_btHingeConstraint_btHingeConstraint_5(arg0,arg1,arg2,arg3,arg4);getCache(btHingeConstraint)[this.ptr]=this;return}if(arg6===undefined){this.ptr=_emscripten_bind_btHingeConstraint_btHingeConstraint_6(arg0,arg1,arg2,arg3,arg4,arg5);getCache(btHingeConstraint)[this.ptr]=this;return}this.ptr=_emscripten_bind_btHingeConstraint_btHingeConstraint_7(arg0,arg1,arg2,arg3,arg4,arg5,arg6);getCache(btHingeConstraint)[this.ptr]=this}btHingeConstraint.prototype=Object.create(btTypedConstraint.prototype);btHingeConstraint.prototype.constructor=btHingeConstraint;btHingeConstraint.prototype.__class__=btHingeConstraint;btHingeConstraint.__cache__={};Module["btHingeConstraint"]=btHingeConstraint;btHingeConstraint.prototype["setLimit"]=(function(arg0,arg1,arg2,arg3,arg4){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);if(arg4===undefined){_emscripten_bind_btHingeConstraint_setLimit_4(self,arg0,arg1,arg2,arg3);return}_emscripten_bind_btHingeConstraint_setLimit_5(self,arg0,arg1,arg2,arg3,arg4)});btHingeConstraint.prototype["enableFeedback"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btHingeConstraint_enableFeedback_1(self,arg0)});btHingeConstraint.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btHingeConstraint___destroy___0(self)});function btCollisionShape(){throw"cannot construct a btCollisionShape, no constructor in IDL"}btCollisionShape.prototype=Object.create(WrapperObject.prototype);btCollisionShape.prototype.constructor=btCollisionShape;btCollisionShape.prototype.__class__=btCollisionShape;btCollisionShape.__cache__={};Module["btCollisionShape"]=btCollisionShape;btCollisionShape.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCollisionShape_setLocalScaling_1(self,arg0)});btCollisionShape.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCollisionShape_calculateLocalInertia_2(self,arg0,arg1)});btCollisionShape.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btCollisionShape___destroy___0(self)});function btConstraintSetting(){this.ptr=_emscripten_bind_btConstraintSetting_btConstraintSetting_0();getCache(btConstraintSetting)[this.ptr]=this}btConstraintSetting.prototype=Object.create(WrapperObject.prototype);btConstraintSetting.prototype.constructor=btConstraintSetting;btConstraintSetting.prototype.__class__=btConstraintSetting;btConstraintSetting.__cache__={};Module["btConstraintSetting"]=btConstraintSetting;btConstraintSetting.prototype["get_m_tau"]=(function(){var self=this.ptr;return _emscripten_bind_btConstraintSetting_get_m_tau_0(self)});btConstraintSetting.prototype["set_m_tau"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConstraintSetting_set_m_tau_1(self,arg0)});btConstraintSetting.prototype["get_m_damping"]=(function(){var self=this.ptr;return _emscripten_bind_btConstraintSetting_get_m_damping_0(self)});btConstraintSetting.prototype["set_m_damping"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConstraintSetting_set_m_damping_1(self,arg0)});btConstraintSetting.prototype["get_m_impulseClamp"]=(function(){var self=this.ptr;return _emscripten_bind_btConstraintSetting_get_m_impulseClamp_0(self)});btConstraintSetting.prototype["set_m_impulseClamp"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btConstraintSetting_set_m_impulseClamp_1(self,arg0)});btConstraintSetting.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btConstraintSetting___destroy___0(self)});function btGhostObject(){this.ptr=_emscripten_bind_btGhostObject_btGhostObject_0();getCache(btGhostObject)[this.ptr]=this}btGhostObject.prototype=Object.create(btCollisionObject.prototype);btGhostObject.prototype.constructor=btGhostObject;btGhostObject.prototype.__class__=btGhostObject;btGhostObject.__cache__={};Module["btGhostObject"]=btGhostObject;btGhostObject.prototype["getNumOverlappingObjects"]=(function(){var self=this.ptr;return _emscripten_bind_btGhostObject_getNumOverlappingObjects_0(self)});btGhostObject.prototype["getOverlappingObject"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btGhostObject_getOverlappingObject_1(self,arg0),btCollisionObject)});btGhostObject.prototype["getCollisionShape"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btGhostObject_getCollisionShape_0(self),btCollisionShape)});btGhostObject.prototype["setContactProcessingThreshold"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_setContactProcessingThreshold_1(self,arg0)});btGhostObject.prototype["setActivationState"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_setActivationState_1(self,arg0)});btGhostObject.prototype["forceActivationState"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_forceActivationState_1(self,arg0)});btGhostObject.prototype["activate"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg0===undefined){_emscripten_bind_btGhostObject_activate_0(self);return}_emscripten_bind_btGhostObject_activate_1(self,arg0)});btGhostObject.prototype["isActive"]=(function(){var self=this.ptr;return _emscripten_bind_btGhostObject_isActive_0(self)});btGhostObject.prototype["isKinematicObject"]=(function(){var self=this.ptr;return _emscripten_bind_btGhostObject_isKinematicObject_0(self)});btGhostObject.prototype["setRestitution"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_setRestitution_1(self,arg0)});btGhostObject.prototype["setFriction"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_setFriction_1(self,arg0)});btGhostObject.prototype["getWorldTransform"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btGhostObject_getWorldTransform_0(self),btTransform)});btGhostObject.prototype["getCollisionFlags"]=(function(){var self=this.ptr;return _emscripten_bind_btGhostObject_getCollisionFlags_0(self)});btGhostObject.prototype["setCollisionFlags"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_setCollisionFlags_1(self,arg0)});btGhostObject.prototype["setWorldTransform"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_setWorldTransform_1(self,arg0)});btGhostObject.prototype["setCollisionShape"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btGhostObject_setCollisionShape_1(self,arg0)});btGhostObject.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btGhostObject___destroy___0(self)});function LocalShapeInfo(){throw"cannot construct a LocalShapeInfo, no constructor in IDL"}LocalShapeInfo.prototype=Object.create(WrapperObject.prototype);LocalShapeInfo.prototype.constructor=LocalShapeInfo;LocalShapeInfo.prototype.__class__=LocalShapeInfo;LocalShapeInfo.__cache__={};Module["LocalShapeInfo"]=LocalShapeInfo;LocalShapeInfo.prototype["get_m_shapePart"]=(function(){var self=this.ptr;return _emscripten_bind_LocalShapeInfo_get_m_shapePart_0(self)});LocalShapeInfo.prototype["set_m_shapePart"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_LocalShapeInfo_set_m_shapePart_1(self,arg0)});LocalShapeInfo.prototype["get_m_triangleIndex"]=(function(){var self=this.ptr;return _emscripten_bind_LocalShapeInfo_get_m_triangleIndex_0(self)});LocalShapeInfo.prototype["set_m_triangleIndex"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_LocalShapeInfo_set_m_triangleIndex_1(self,arg0)});LocalShapeInfo.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_LocalShapeInfo___destroy___0(self)});function btConstraintSolver(){throw"cannot construct a btConstraintSolver, no constructor in IDL"}btConstraintSolver.prototype=Object.create(WrapperObject.prototype);btConstraintSolver.prototype.constructor=btConstraintSolver;btConstraintSolver.prototype.__class__=btConstraintSolver;btConstraintSolver.__cache__={};Module["btConstraintSolver"]=btConstraintSolver;btConstraintSolver.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btConstraintSolver___destroy___0(self)});function btRaycastVehicle(arg0,arg1,arg2){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);this.ptr=_emscripten_bind_btRaycastVehicle_btRaycastVehicle_3(arg0,arg1,arg2);getCache(btRaycastVehicle)[this.ptr]=this}btRaycastVehicle.prototype=Object.create(btActionInterface.prototype);btRaycastVehicle.prototype.constructor=btRaycastVehicle;btRaycastVehicle.prototype.__class__=btRaycastVehicle;btRaycastVehicle.__cache__={};Module["btRaycastVehicle"]=btRaycastVehicle;btRaycastVehicle.prototype["applyEngineForce"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRaycastVehicle_applyEngineForce_2(self,arg0,arg1)});btRaycastVehicle.prototype["setSteeringValue"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRaycastVehicle_setSteeringValue_2(self,arg0,arg1)});btRaycastVehicle.prototype["getWheelTransformWS"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btRaycastVehicle_getWheelTransformWS_1(self,arg0),btTransform)});btRaycastVehicle.prototype["updateWheelTransform"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRaycastVehicle_updateWheelTransform_2(self,arg0,arg1)});btRaycastVehicle.prototype["addWheel"]=(function(arg0,arg1,arg2,arg3,arg4,arg5,arg6){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);if(arg5&&typeof arg5==="object")arg5=arg5.ptr;else arg5=ensureString(arg5);if(arg6&&typeof arg6==="object")arg6=arg6.ptr;else arg6=ensureString(arg6);return wrapPointer(_emscripten_bind_btRaycastVehicle_addWheel_7(self,arg0,arg1,arg2,arg3,arg4,arg5,arg6),btWheelInfo)});btRaycastVehicle.prototype["getNumWheels"]=(function(){var self=this.ptr;return _emscripten_bind_btRaycastVehicle_getNumWheels_0(self)});btRaycastVehicle.prototype["getRigidBody"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btRaycastVehicle_getRigidBody_0(self),btRigidBody)});btRaycastVehicle.prototype["getWheelInfo"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btRaycastVehicle_getWheelInfo_1(self,arg0),btWheelInfo)});btRaycastVehicle.prototype["setBrake"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRaycastVehicle_setBrake_2(self,arg0,arg1)});btRaycastVehicle.prototype["setCoordinateSystem"]=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btRaycastVehicle_setCoordinateSystem_3(self,arg0,arg1,arg2)});btRaycastVehicle.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btRaycastVehicle___destroy___0(self)});function LocalConvexResult(arg0,arg1,arg2,arg3,arg4){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);this.ptr=_emscripten_bind_LocalConvexResult_LocalConvexResult_5(arg0,arg1,arg2,arg3,arg4);getCache(LocalConvexResult)[this.ptr]=this}LocalConvexResult.prototype=Object.create(WrapperObject.prototype);LocalConvexResult.prototype.constructor=LocalConvexResult;LocalConvexResult.prototype.__class__=LocalConvexResult;LocalConvexResult.__cache__={};Module["LocalConvexResult"]=LocalConvexResult;LocalConvexResult.prototype["get_m_hitCollisionObject"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_LocalConvexResult_get_m_hitCollisionObject_0(self),btCollisionObject)});LocalConvexResult.prototype["set_m_hitCollisionObject"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_LocalConvexResult_set_m_hitCollisionObject_1(self,arg0)});LocalConvexResult.prototype["get_m_localShapeInfo"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_LocalConvexResult_get_m_localShapeInfo_0(self),LocalShapeInfo)});LocalConvexResult.prototype["set_m_localShapeInfo"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_LocalConvexResult_set_m_localShapeInfo_1(self,arg0)});LocalConvexResult.prototype["get_m_hitNormalLocal"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_LocalConvexResult_get_m_hitNormalLocal_0(self),btVector3)});LocalConvexResult.prototype["set_m_hitNormalLocal"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_LocalConvexResult_set_m_hitNormalLocal_1(self,arg0)});LocalConvexResult.prototype["get_m_hitPointLocal"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_LocalConvexResult_get_m_hitPointLocal_0(self),btVector3)});LocalConvexResult.prototype["set_m_hitPointLocal"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_LocalConvexResult_set_m_hitPointLocal_1(self,arg0)});LocalConvexResult.prototype["get_m_hitFraction"]=(function(){var self=this.ptr;return _emscripten_bind_LocalConvexResult_get_m_hitFraction_0(self)});LocalConvexResult.prototype["set_m_hitFraction"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_LocalConvexResult_set_m_hitFraction_1(self,arg0)});LocalConvexResult.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_LocalConvexResult___destroy___0(self)});function btOverlappingPairCallback(){throw"cannot construct a btOverlappingPairCallback, no constructor in IDL"}btOverlappingPairCallback.prototype=Object.create(WrapperObject.prototype);btOverlappingPairCallback.prototype.constructor=btOverlappingPairCallback;btOverlappingPairCallback.prototype.__class__=btOverlappingPairCallback;btOverlappingPairCallback.__cache__={};Module["btOverlappingPairCallback"]=btOverlappingPairCallback;btOverlappingPairCallback.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btOverlappingPairCallback___destroy___0(self)});function btRigidBody(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);this.ptr=_emscripten_bind_btRigidBody_btRigidBody_1(arg0);getCache(btRigidBody)[this.ptr]=this}btRigidBody.prototype=Object.create(btCollisionObject.prototype);btRigidBody.prototype.constructor=btRigidBody;btRigidBody.prototype.__class__=btRigidBody;btRigidBody.__cache__={};Module["btRigidBody"]=btRigidBody;btRigidBody.prototype["getCenterOfMassTransform"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btRigidBody_getCenterOfMassTransform_0(self),btTransform)});btRigidBody.prototype["setCenterOfMassTransform"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setCenterOfMassTransform_1(self,arg0)});btRigidBody.prototype["setSleepingThresholds"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRigidBody_setSleepingThresholds_2(self,arg0,arg1)});btRigidBody.prototype["setDamping"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRigidBody_setDamping_2(self,arg0,arg1)});btRigidBody.prototype["setMassProps"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRigidBody_setMassProps_2(self,arg0,arg1)});btRigidBody.prototype["setLinearFactor"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setLinearFactor_1(self,arg0)});btRigidBody.prototype["applyTorque"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_applyTorque_1(self,arg0)});btRigidBody.prototype["applyForce"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRigidBody_applyForce_2(self,arg0,arg1)});btRigidBody.prototype["applyCentralForce"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_applyCentralForce_1(self,arg0)});btRigidBody.prototype["applyTorqueImpulse"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_applyTorqueImpulse_1(self,arg0)});btRigidBody.prototype["applyImpulse"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btRigidBody_applyImpulse_2(self,arg0,arg1)});btRigidBody.prototype["applyCentralImpulse"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_applyCentralImpulse_1(self,arg0)});btRigidBody.prototype["updateInertiaTensor"]=(function(){var self=this.ptr;_emscripten_bind_btRigidBody_updateInertiaTensor_0(self)});btRigidBody.prototype["getLinearVelocity"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btRigidBody_getLinearVelocity_0(self),btVector3)});btRigidBody.prototype["getAngularVelocity"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btRigidBody_getAngularVelocity_0(self),btVector3)});btRigidBody.prototype["setLinearVelocity"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setLinearVelocity_1(self,arg0)});btRigidBody.prototype["setAngularVelocity"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setAngularVelocity_1(self,arg0)});btRigidBody.prototype["getMotionState"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btRigidBody_getMotionState_0(self),btMotionState)});btRigidBody.prototype["setAngularFactor"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setAngularFactor_1(self,arg0)});btRigidBody.prototype["upcast"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);return wrapPointer(_emscripten_bind_btRigidBody_upcast_1(self,arg0),btRigidBody)});btRigidBody.prototype["getCollisionShape"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btRigidBody_getCollisionShape_0(self),btCollisionShape)});btRigidBody.prototype["setContactProcessingThreshold"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setContactProcessingThreshold_1(self,arg0)});btRigidBody.prototype["setActivationState"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setActivationState_1(self,arg0)});btRigidBody.prototype["forceActivationState"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_forceActivationState_1(self,arg0)});btRigidBody.prototype["activate"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg0===undefined){_emscripten_bind_btRigidBody_activate_0(self);return}_emscripten_bind_btRigidBody_activate_1(self,arg0)});btRigidBody.prototype["isActive"]=(function(){var self=this.ptr;return _emscripten_bind_btRigidBody_isActive_0(self)});btRigidBody.prototype["isKinematicObject"]=(function(){var self=this.ptr;return _emscripten_bind_btRigidBody_isKinematicObject_0(self)});btRigidBody.prototype["setRestitution"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setRestitution_1(self,arg0)});btRigidBody.prototype["setFriction"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setFriction_1(self,arg0)});btRigidBody.prototype["getWorldTransform"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btRigidBody_getWorldTransform_0(self),btTransform)});btRigidBody.prototype["getCollisionFlags"]=(function(){var self=this.ptr;return _emscripten_bind_btRigidBody_getCollisionFlags_0(self)});btRigidBody.prototype["setCollisionFlags"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setCollisionFlags_1(self,arg0)});btRigidBody.prototype["setWorldTransform"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setWorldTransform_1(self,arg0)});btRigidBody.prototype["setCollisionShape"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btRigidBody_setCollisionShape_1(self,arg0)});btRigidBody.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btRigidBody___destroy___0(self)});function btCylinderShapeX(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);this.ptr=_emscripten_bind_btCylinderShapeX_btCylinderShapeX_1(arg0);getCache(btCylinderShapeX)[this.ptr]=this}btCylinderShapeX.prototype=Object.create(btCylinderShape.prototype);btCylinderShapeX.prototype.constructor=btCylinderShapeX;btCylinderShapeX.prototype.__class__=btCylinderShapeX;btCylinderShapeX.__cache__={};Module["btCylinderShapeX"]=btCylinderShapeX;btCylinderShapeX.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCylinderShapeX_setLocalScaling_1(self,arg0)});btCylinderShapeX.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCylinderShapeX_calculateLocalInertia_2(self,arg0,arg1)});btCylinderShapeX.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btCylinderShapeX___destroy___0(self)});function btCylinderShapeZ(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);this.ptr=_emscripten_bind_btCylinderShapeZ_btCylinderShapeZ_1(arg0);getCache(btCylinderShapeZ)[this.ptr]=this}btCylinderShapeZ.prototype=Object.create(btCylinderShape.prototype);btCylinderShapeZ.prototype.constructor=btCylinderShapeZ;btCylinderShapeZ.prototype.__class__=btCylinderShapeZ;btCylinderShapeZ.__cache__={};Module["btCylinderShapeZ"]=btCylinderShapeZ;btCylinderShapeZ.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCylinderShapeZ_setLocalScaling_1(self,arg0)});btCylinderShapeZ.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCylinderShapeZ_calculateLocalInertia_2(self,arg0,arg1)});btCylinderShapeZ.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btCylinderShapeZ___destroy___0(self)});function btTransform(arg0,arg1){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg0===undefined){this.ptr=_emscripten_bind_btTransform_btTransform_0();getCache(btTransform)[this.ptr]=this;return}if(arg1===undefined){this.ptr=_emscripten_bind_btTransform_btTransform_1(arg0);getCache(btTransform)[this.ptr]=this;return}this.ptr=_emscripten_bind_btTransform_btTransform_2(arg0,arg1);getCache(btTransform)[this.ptr]=this}btTransform.prototype=Object.create(WrapperObject.prototype);btTransform.prototype.constructor=btTransform;btTransform.prototype.__class__=btTransform;btTransform.__cache__={};Module["btTransform"]=btTransform;btTransform.prototype["setIdentity"]=(function(){var self=this.ptr;_emscripten_bind_btTransform_setIdentity_0(self)});btTransform.prototype["setOrigin"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btTransform_setOrigin_1(self,arg0)});btTransform.prototype["setRotation"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btTransform_setRotation_1(self,arg0)});btTransform.prototype["getOrigin"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btTransform_getOrigin_0(self),btVector3)});btTransform.prototype["getRotation"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btTransform_getRotation_0(self),btQuaternion)});btTransform.prototype["getBasis"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btTransform_getBasis_0(self),btMatrix3x3)});btTransform.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btTransform___destroy___0(self)});function btCollisionWorld(){throw"cannot construct a btCollisionWorld, no constructor in IDL"}btCollisionWorld.prototype=Object.create(WrapperObject.prototype);btCollisionWorld.prototype.constructor=btCollisionWorld;btCollisionWorld.prototype.__class__=btCollisionWorld;btCollisionWorld.__cache__={};Module["btCollisionWorld"]=btCollisionWorld;btCollisionWorld.prototype["getDispatcher"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btCollisionWorld_getDispatcher_0(self),btDispatcher)});btCollisionWorld.prototype["rayTest"]=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btCollisionWorld_rayTest_3(self,arg0,arg1,arg2)});btCollisionWorld.prototype["getPairCache"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btCollisionWorld_getPairCache_0(self),btOverlappingPairCache)});btCollisionWorld.prototype["getDispatchInfo"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btCollisionWorld_getDispatchInfo_0(self),btDispatcherInfo)});btCollisionWorld.prototype["addCollisionObject"]=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg1===undefined){_emscripten_bind_btCollisionWorld_addCollisionObject_1(self,arg0);return}if(arg2===undefined){_emscripten_bind_btCollisionWorld_addCollisionObject_2(self,arg0,arg1);return}_emscripten_bind_btCollisionWorld_addCollisionObject_3(self,arg0,arg1,arg2)});btCollisionWorld.prototype["getBroadphase"]=(function(){var self=this.ptr;return wrapPointer(_emscripten_bind_btCollisionWorld_getBroadphase_0(self),btBroadphaseInterface)});btCollisionWorld.prototype["convexSweepTest"]=(function(arg0,arg1,arg2,arg3,arg4){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);if(arg3&&typeof arg3==="object")arg3=arg3.ptr;else arg3=ensureString(arg3);if(arg4&&typeof arg4==="object")arg4=arg4.ptr;else arg4=ensureString(arg4);_emscripten_bind_btCollisionWorld_convexSweepTest_5(self,arg0,arg1,arg2,arg3,arg4)});btCollisionWorld.prototype["contactPairTest"]=(function(arg0,arg1,arg2){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);if(arg2&&typeof arg2==="object")arg2=arg2.ptr;else arg2=ensureString(arg2);_emscripten_bind_btCollisionWorld_contactPairTest_3(self,arg0,arg1,arg2)});btCollisionWorld.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btCollisionWorld___destroy___0(self)});function btQuadWord(){throw"cannot construct a btQuadWord, no constructor in IDL"}btQuadWord.prototype=Object.create(WrapperObject.prototype);btQuadWord.prototype.constructor=btQuadWord;btQuadWord.prototype.__class__=btQuadWord;btQuadWord.__cache__={};Module["btQuadWord"]=btQuadWord;btQuadWord.prototype["x"]=(function(){var self=this.ptr;return _emscripten_bind_btQuadWord_x_0(self)});btQuadWord.prototype["y"]=(function(){var self=this.ptr;return _emscripten_bind_btQuadWord_y_0(self)});btQuadWord.prototype["z"]=(function(){var self=this.ptr;return _emscripten_bind_btQuadWord_z_0(self)});btQuadWord.prototype["w"]=(function(){var self=this.ptr;return _emscripten_bind_btQuadWord_w_0(self)});btQuadWord.prototype["setX"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btQuadWord_setX_1(self,arg0)});btQuadWord.prototype["setY"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btQuadWord_setY_1(self,arg0)});btQuadWord.prototype["setZ"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btQuadWord_setZ_1(self,arg0)});btQuadWord.prototype["setW"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btQuadWord_setW_1(self,arg0)});btQuadWord.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btQuadWord___destroy___0(self)});function btCylinderShape(arg0){if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);this.ptr=_emscripten_bind_btCylinderShape_btCylinderShape_1(arg0);getCache(btCylinderShape)[this.ptr]=this}btCylinderShape.prototype=Object.create(btCollisionShape.prototype);btCylinderShape.prototype.constructor=btCylinderShape;btCylinderShape.prototype.__class__=btCylinderShape;btCylinderShape.__cache__={};Module["btCylinderShape"]=btCylinderShape;btCylinderShape.prototype["setLocalScaling"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btCylinderShape_setLocalScaling_1(self,arg0)});btCylinderShape.prototype["calculateLocalInertia"]=(function(arg0,arg1){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);if(arg1&&typeof arg1==="object")arg1=arg1.ptr;else arg1=ensureString(arg1);_emscripten_bind_btCylinderShape_calculateLocalInertia_2(self,arg0,arg1)});btCylinderShape.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btCylinderShape___destroy___0(self)});function btGhostPairCallback(){this.ptr=_emscripten_bind_btGhostPairCallback_btGhostPairCallback_0();getCache(btGhostPairCallback)[this.ptr]=this}btGhostPairCallback.prototype=Object.create(WrapperObject.prototype);btGhostPairCallback.prototype.constructor=btGhostPairCallback;btGhostPairCallback.prototype.__class__=btGhostPairCallback;btGhostPairCallback.__cache__={};Module["btGhostPairCallback"]=btGhostPairCallback;btGhostPairCallback.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btGhostPairCallback___destroy___0(self)});function btTypedConstraint(){throw"cannot construct a btTypedConstraint, no constructor in IDL"}btTypedConstraint.prototype=Object.create(WrapperObject.prototype);btTypedConstraint.prototype.constructor=btTypedConstraint;btTypedConstraint.prototype.__class__=btTypedConstraint;btTypedConstraint.__cache__={};Module["btTypedConstraint"]=btTypedConstraint;btTypedConstraint.prototype["enableFeedback"]=(function(arg0){var self=this.ptr;if(arg0&&typeof arg0==="object")arg0=arg0.ptr;else arg0=ensureString(arg0);_emscripten_bind_btTypedConstraint_enableFeedback_1(self,arg0)});btTypedConstraint.prototype["__destroy__"]=(function(){var self=this.ptr;_emscripten_bind_btTypedConstraint___destroy___0(self)});this["Ammo"]=Module






  return this;
}).call({});


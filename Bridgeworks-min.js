/*                   Bridgeworks(tm) Runtime Engine
                       Trial License Agreement


NOTICE
This is a contract between End User ("You") and Bridgeborn, Inc. ("Bridgeborn, Inc").
Please read the following terms and conditions carefully before installing or
using the Bridgeworks(tm) Runtime Engine ("software").  By installing the software,
You acknowledge that You have read and understood this license agreement and
agree to be bound by its terms and conditions.

I.  Use of the Software
Subject to the terms and conditions set forth in this Agreement,
Bridgeborn, Inc grants to You, and You accept, a limited, non-exclusive
license to use the accompanying computer program in object code form and any
documentation related to the Software, for use in the bundled sample
application.

II.  Intellectual Property
Except as stated elsewhere, this Agreement does not confer upon You any
intellectual property rights in the Software. Use of this product shall be
conducted in accordance with accepted trademark, patent, and copyright
practice. Bridgeworks is covered by U.S. Patent No. 7,681,114.

III.  Copyright
This Software, its code, and all documentation are owned by Bridgeborn, Inc.
Its organization, structure, and code are valuable trade secrets of
Bridgeborn, Inc.  This Software, its code, and all supporting documentation
are protected by U.S. Copyright law and International Treaty provisions.
You may not, in whole or in part, copy, photocopy, reproduce, translate,
adapt, modify, or create derivative works, or reduce to any electronic
medium or machine readable format, this Software, its code, or its
documentation, except as set forth elsewhere in this Agreement, without the
prior written consent of Bridgeborn, Inc.  You also may not reverse engineer,
decompose, disassemble, or otherwise attempt to discover or alter the source
code of the Software.

IV.  Transfer
This Software and its documentation may not be rented, leased, or
sublicensed by You to a third party.  You may, however, transfer all rights
to use the Software to another person or legal entity, subject to the
acceptance by such person or legal entity of all of the terms of this
Agreement.  Except as provided by this Agreement, any attempt to lease,
sublicense, assign, or transfer any of the rights, duties, or obligations
under this Agreement shall be void.


V.  Governing Law and General Provision
This Agreement shall be governed by the laws of the Commonwealth of Virginia.
This Agreement shall not be governed by the United Nations Convention on
Contracts for the International Sale of Goods, the application of which is
expressly excluded.  Should any portion of this Agreement be found void and
unenforceable, it shall not affect the validity of the other portions of
this Agreement, which shall remain valid and enforceable according to its
terms.  You agree that the Software will not be shipped, transported,
transferred, or exported in violation of the United States Export
Administration Act or any other export laws, restrictions, or regulations.
This Agreement may only be modified in writing, signed by an authorized
officer of Bridgeborn, Inc.
*/
function Base(){this.userData="";this.className=""}Base.prototype.destroy=function(){delete this};function Allocator(){}Allocator.prototype.allocate=function(){return null};function loadBinaryResource(a){var b=new XMLHttpRequest();b.open("GET",a,false);b.overrideMimeType("text/plain; charset=x-user-defined");b.send();if(b.status!=200){return null}return b.responseText}function loadXMLResource(a){var b=new XMLHttpRequest();b.open("GET",a,false);b.overrideMimeType("text/plain; charset=x-user-defined");b.send();if(b.status!=200){return null}return b.responseText}function loadTextResource(a){var b=new XMLHttpRequest();b.open("GET",a,false);b.overrideMimeType("text/plain; charset=x-user-defined");b.send();if(b.status!=200){return null}return b.responseText}function isLower(b){var a=b.charCodeAt(0);return(a>96&&a<123)}function isUpper(b){var a=b.charCodeAt(0);return(a>64&&a<91)}function isSpace(a){if(a==" "||a=="\f"||a=="\n"||a=="\r"||a=="\t"||a=="\v"){return true}return false}function getObjectClassName(b){if(b&&b.constructor&&b.constructor.toString){var a=b.constructor.toString().match(/function\s*(\w+)/);if(a&&a.length==2){return a[1]}}return undefined}function formatPath(c){var a=[];var f="";var b="";try{$.ajax({url:c,type:"HEAD",async:false,error:function(){console.debug(c+" does not exist.");var g=document.location.href;f=g.substring(0,g.lastIndexOf("/"))+"/"+bridgeworks.contentDir+"/"+c;console.debug("Trying: "+f);var e=f.lastIndexOf("objects/");if(e==-1){e=f.lastIndexOf("motions/")}if(e==-1){e=f.lastIndexOf("envelopes/")}if(e==-1){e=f.lastIndexOf("scenes/")}b=f.substring(0,e);console.debug("With contentDir: "+b)},success:function(){f=c;var e=f.lastIndexOf("objects/");if(e==-1){e=f.lastIndexOf("motions/")}if(e==-1){e=f.lastIndexOf("envelopes/")}if(e==-1){e=f.lastIndexOf("scenes/")}b=f.substring(0,e);console.debug("File found: "+f)}});a[0]=f;a[1]=b}catch(d){}return a}function isFullPath(b){var a=false;var c=b.length;if(c>=2){if((b[0]=="\\"||b[0]=="/")&&(b[1]=="\\"||b[1]=="/")){a=true}}if(a||b.indexOf(":")>=0){return true}return false}function formFullPath(b,d){var a=new String();if(!b||!d){return null}if(isFullPath(b)){a=b}else{a=d;if(a.length>0){var c=a.charAt(a.length-1);if(c!="/"&&c!="\\"){a+="/"}}if(b[0]=="/"||b[0]=="\\"){a+=b.slice(1)}else{a+=b}}return a}function getFileExtension(a){var b=null;var c=a.lastIndexOf(".");if(c!=-1){var b="";b=a.substr(c+1);return b}return b}function getBrowserName(){var a=new String(navigator.userAgent);if(a.indexOf("Chrome")>=0){return"Chrome"}if(a.indexOf("Firefox")>=0){return"Firefox"}return undefined}function OutputDebugMsg(a){var b=document.getElementById("DebugOutput").innerHTML;b+="&gt; "+a+"<br>";document.getElementById("DebugOutput").innerHTML=b}function Color(){this.r=0;this.g=0;this.b=0;this.a=0}Color.prototype.v=function(){var a=[this.r,this.g,this.b,this.a];return a};Color.prototype.load=function(f,e,c,d){this.r=f;this.g=e;this.b=c;this.a=d};Color.prototype.copy=function(a){if(a){this.r=a.r;this.g=a.g;this.b=a.b;this.a=a.a}};function Pair(b,a){this.first=b;this.second=a}function Rect(d,c,b,a){this.left=d||0;this.top=c||0;this.right=b||0;this.bottom=a||0}Rect.prototype.load=function(d,c,b,a){this.left=d;this.top=c;this.right=b;this.bottom=a};Rect.prototype.loadRect=function(a){this.left=a.left;this.top=a.top;this.right=a.right;this.bottom=a.bottom};function Viewport(){this.x=0;this.y=0;this.width=0;this.height=0;this.equals=function(a){return(this.x==a.x&&this.y==a.y&&this.width==a.width&&this.height==a.height)}}Viewport.prototype.load=function(b,d,c,a){this.x=b;this.y=d;this.width=c;this.height=a};Viewport.prototype.loadViewport=function(a){this.x=a.x;this.y=a.y;this.width=a.width;this.height=a.height};Viewport.prototype.containsPoint=function(a,b){if(a>=this.x&&b>=this.y&&a<=(this.x+this.width)&&b<=(this.y+this.height)){return true}return false};function Stack(a){this.stack=new Array();if(a){this.stack.push(a)}}Stack.prototype.push=function(a){this.stack.push(a)};Stack.prototype.pop=function(){if(this.stack.length>0){this.stack.pop()}};Stack.prototype.load=function(a){this.pop();this.push(a)};Stack.prototype.top=function(){if(this.stack.length>0){return this.stack[this.stack.length-1]}return null};Stack.prototype.getAt=function(a){if(this.stack.length>a){return this.stack[a]}return null};Stack.prototype.length=function(){return this.stack.length};Stack.prototype.empty=function(){return this.stack.length==0};Stack.prototype.clear=function(){this.stack.length=0};Stack.prototype.copy=function(){return this.stack.slice()};var gAttributeBin=null;var gAttributePairs=null;function setAttributeBin(a){gAttributeBin=a}function setAttributePairs(a){gAttributePairs=a}function deserializeAttributeContainer(a,d){for(var b=0;b<d.length;b++){var c=a.getAttribute(d[b][0]);if(c){deserializeAttribute(c,d[b][1])}}}function deserializeComplexAttribute(c,d){var a=[];for(var b=0;b<d.length;b++){a.push(d[b][1])}if(a.length>0){if(!gAttributeBin){setAttributeValue(c,a)}else{gAttributeBin.push(new Pair(c,a))}}}function deserializeAttribute(a,b){if(!gAttributeBin){setAttributeValue(a,b)}else{gAttributeBin.push(new Pair(a,b))}}function resolveAttributeContainerReference(a,d,b){if(d.length>0){if(d[0][0]=="ref"){var c=b.find(d[0][1]);if(c){a.synchronize(c,true);return true}}}return false}function resolveComplexAttributeReference(a,b){if(b.length>0){if(b[0][0]=="ref"){return resolvePrimitiveAttributeReference(a,b[0][1])}}return false}function resolvePrimitiveAttributeReference(a,b){return false}function resolveAttributeReference(a,b){if(!gAttributePairs){b.copyValue(a)}else{gAttributePairs.push(new Pair(a,b))}}var whitespace="\n\r\t ";XMLP=function(a){a=SAXStrings.replace(a,null,null,"\r\n","\n");a=SAXStrings.replace(a,null,null,"\r","\n");this.m_xml=a;this.m_iP=0;this.m_iState=XMLP._STATE_PROLOG;this.m_stack=new saxStack();this._clearAttributes()};XMLP._NONE=0;XMLP._ELM_B=1;XMLP._ELM_E=2;XMLP._ELM_EMP=3;XMLP._ATT=4;XMLP._TEXT=5;XMLP._ENTITY=6;XMLP._PI=7;XMLP._CDATA=8;XMLP._COMMENT=9;XMLP._DTD=10;XMLP._ERROR=11;XMLP._CONT_XML=0;XMLP._CONT_ALT=1;XMLP._ATT_NAME=0;XMLP._ATT_VAL=1;XMLP._STATE_PROLOG=1;XMLP._STATE_DOCUMENT=2;XMLP._STATE_MISC=3;XMLP._errs=new Array();XMLP._errs[XMLP.ERR_CLOSE_PI=0]="PI: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_DTD=1]="DTD: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_COMMENT=2]="Comment: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_CDATA=3]="CDATA: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_ELM=4]="Element: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_ENTITY=5]="Entity: missing closing sequence";XMLP._errs[XMLP.ERR_PI_TARGET=6]="PI: target is required";XMLP._errs[XMLP.ERR_ELM_EMPTY=7]="Element: cannot be both empty and closing";XMLP._errs[XMLP.ERR_ELM_NAME=8]='Element: name must immediatly follow "<"';XMLP._errs[XMLP.ERR_ELM_LT_NAME=9]='Element: "<" not allowed in element names';XMLP._errs[XMLP.ERR_ATT_VALUES=10]="Attribute: values are required and must be in quotes";XMLP._errs[XMLP.ERR_ATT_LT_NAME=11]='Element: "<" not allowed in attribute names';XMLP._errs[XMLP.ERR_ATT_LT_VALUE=12]='Attribute: "<" not allowed in attribute values';XMLP._errs[XMLP.ERR_ATT_DUP=13]="Attribute: duplicate attributes not allowed";XMLP._errs[XMLP.ERR_ENTITY_UNKNOWN=14]="Entity: unknown entity";XMLP._errs[XMLP.ERR_INFINITELOOP=15]="Infininte loop";XMLP._errs[XMLP.ERR_DOC_STRUCTURE=16]="Document: only comments, processing instructions, or whitespace allowed outside of document element";XMLP._errs[XMLP.ERR_ELM_NESTING=17]="Element: must be nested correctly";XMLP.prototype._addAttribute=function(a,b){this.m_atts[this.m_atts.length]=new Array(a,b)};XMLP.prototype._checkStructure=function(b){if(XMLP._STATE_PROLOG==this.m_iState){if((XMLP._TEXT==b)||(XMLP._ENTITY==b)){if(SAXStrings.indexOfNonWhitespace(this.getContent(),this.getContentBegin(),this.getContentEnd())!=-1){return this._setErr(XMLP.ERR_DOC_STRUCTURE)}}if((XMLP._ELM_B==b)||(XMLP._ELM_EMP==b)){this.m_iState=XMLP._STATE_DOCUMENT}}if(XMLP._STATE_DOCUMENT==this.m_iState){if((XMLP._ELM_B==b)||(XMLP._ELM_EMP==b)){this.m_stack.push(this.getName())}if((XMLP._ELM_E==b)||(XMLP._ELM_EMP==b)){var a=this.m_stack.pop();if((a==null)||(a!=this.getName())){return this._setErr(XMLP.ERR_ELM_NESTING)}}if(this.m_stack.count()==0){this.m_iState=XMLP._STATE_MISC;return b}}if(XMLP._STATE_MISC==this.m_iState){if((XMLP._ELM_B==b)||(XMLP._ELM_E==b)||(XMLP._ELM_EMP==b)||(XMLP.EVT_DTD==b)){return this._setErr(XMLP.ERR_DOC_STRUCTURE)}if((XMLP._TEXT==b)||(XMLP._ENTITY==b)){if(SAXStrings.indexOfNonWhitespace(this.getContent(),this.getContentBegin(),this.getContentEnd())!=-1){return this._setErr(XMLP.ERR_DOC_STRUCTURE)}}}return b};XMLP.prototype._clearAttributes=function(){this.m_atts=new Array()};XMLP.prototype._findAttributeIndex=function(a){for(var b=0;b<this.m_atts.length;b++){if(this.m_atts[b][XMLP._ATT_NAME]==a){return b}}return -1};XMLP.prototype.getAttributeCount=function(){return this.m_atts?this.m_atts.length:0};XMLP.prototype.getAttributeName=function(a){return((a<0)||(a>=this.m_atts.length))?null:this.m_atts[a][XMLP._ATT_NAME]};XMLP.prototype.getAttributeValue=function(a){return((a<0)||(a>=this.m_atts.length))?null:__unescapeString(this.m_atts[a][XMLP._ATT_VAL])};XMLP.prototype.getAttributeValueByName=function(a){return this.getAttributeValue(this._findAttributeIndex(a))};XMLP.prototype.getColumnNumber=function(){return SAXStrings.getColumnNumber(this.m_xml,this.m_iP)};XMLP.prototype.getContent=function(){return(this.m_cSrc==XMLP._CONT_XML)?this.m_xml:this.m_cAlt};XMLP.prototype.getContentBegin=function(){return this.m_cB};XMLP.prototype.getContentEnd=function(){return this.m_cE};XMLP.prototype.getLineNumber=function(){return SAXStrings.getLineNumber(this.m_xml,this.m_iP)};XMLP.prototype.getName=function(){return this.m_name};XMLP.prototype.next=function(){return this._checkStructure(this._parse())};XMLP.prototype._parse=function(){if(this.m_iP==this.m_xml.length){return XMLP._NONE}if(this.m_iP==this.m_xml.indexOf("<?",this.m_iP)){return this._parsePI(this.m_iP+2)}else{if(this.m_iP==this.m_xml.indexOf("<!DOCTYPE",this.m_iP)){return this._parseDTD(this.m_iP+9)}else{if(this.m_iP==this.m_xml.indexOf("<!--",this.m_iP)){return this._parseComment(this.m_iP+4)}else{if(this.m_iP==this.m_xml.indexOf("<![CDATA[",this.m_iP)){return this._parseCDATA(this.m_iP+9)}else{if(this.m_iP==this.m_xml.indexOf("<",this.m_iP)){return this._parseElement(this.m_iP+1)}else{if(this.m_iP==this.m_xml.indexOf("&",this.m_iP)){return this._parseEntity(this.m_iP+1)}else{return this._parseText(this.m_iP)}}}}}}};XMLP.prototype._parseAttribute=function(e,d){var h,f,k,a,j;var c,b,g;this.m_cAlt="";h=SAXStrings.indexOfNonWhitespace(this.m_xml,e,d);if((h==-1)||(h>=d)){return h}k=this.m_xml.indexOf("=",h);if((k==-1)||(k>d)){return this._setErr(XMLP.ERR_ATT_VALUES)}f=SAXStrings.lastIndexOfNonWhitespace(this.m_xml,h,k);a=SAXStrings.indexOfNonWhitespace(this.m_xml,k+1,d);if((a==-1)||(a>d)){return this._setErr(XMLP.ERR_ATT_VALUES)}c=this.m_xml.charAt(a);if(SAXStrings.QUOTES.indexOf(c)==-1){return this._setErr(XMLP.ERR_ATT_VALUES)}j=this.m_xml.indexOf(c,a+1);if((j==-1)||(j>d)){return this._setErr(XMLP.ERR_ATT_VALUES)}b=this.m_xml.substring(h,f+1);g=this.m_xml.substring(a+1,j);if(b.indexOf("<")!=-1){return this._setErr(XMLP.ERR_ATT_LT_NAME)}if(g.indexOf("<")!=-1){return this._setErr(XMLP.ERR_ATT_LT_VALUE)}g=SAXStrings.replace(g,null,null,"\n"," ");g=SAXStrings.replace(g,null,null,"\t"," ");iRet=this._replaceEntities(g);if(iRet==XMLP._ERROR){return iRet}g=this.m_cAlt;if(this._findAttributeIndex(b)==-1){this._addAttribute(b,g)}else{return this._setErr(XMLP.ERR_ATT_DUP)}this.m_iP=j+2;return XMLP._ATT};XMLP.prototype._parseCDATA=function(a){var b=this.m_xml.indexOf("]]>",a);if(b==-1){return this._setErr(XMLP.ERR_CLOSE_CDATA)}this._setContent(XMLP._CONT_XML,a,b);this.m_iP=b+3;return XMLP._CDATA};XMLP.prototype._parseComment=function(a){var b=this.m_xml.indexOf("-->",a);if(b==-1){return this._setErr(XMLP.ERR_CLOSE_COMMENT)}this._setContent(XMLP._CONT_XML,a,b);this.m_iP=b+3;return XMLP._COMMENT};XMLP.prototype._parseDTD=function(b){var e,a,c,d;e=this.m_xml.indexOf(">",b);if(e==-1){return this._setErr(XMLP.ERR_CLOSE_DTD)}c=this.m_xml.indexOf("[",b);a=((c!=-1)&&(c<e))?"]>":">";while(true){if(e==d){return this._setErr(XMLP.ERR_INFINITELOOP)}d=e;e=this.m_xml.indexOf(a,b);if(e==-1){return this._setErr(XMLP.ERR_CLOSE_DTD)}if(this.m_xml.substring(e-1,e+2)!="]]>"){break}}this.m_iP=e+a.length;return XMLP._DTD};XMLP.prototype._parseElement=function(b){var g,h,f,c;var d,a,e;h=g=this.m_xml.indexOf(">",b);if(g==-1){return this._setErr(XMLP.ERR_CLOSE_ELM)}if(this.m_xml.charAt(b)=="/"){d=XMLP._ELM_E;b++}else{d=XMLP._ELM_B}if(this.m_xml.charAt(g-1)=="/"){if(d==XMLP._ELM_E){return this._setErr(XMLP.ERR_ELM_EMPTY)}d=XMLP._ELM_EMP;h--}h=SAXStrings.lastIndexOfNonWhitespace(this.m_xml,b,h);if(g-b!=1){if(SAXStrings.indexOfNonWhitespace(this.m_xml,b,h)!=b){return this._setErr(XMLP.ERR_ELM_NAME)}}this._clearAttributes();f=SAXStrings.indexOfWhitespace(this.m_xml,b,h);if(f==-1){f=h+1}else{this.m_iP=f;while(this.m_iP<h){if(this.m_iP==e){return this._setErr(XMLP.ERR_INFINITELOOP)}e=this.m_iP;c=this._parseAttribute(this.m_iP,h);if(c==XMLP._ERROR){return c}}}a=this.m_xml.substring(b,f);if(a.indexOf("<")!=-1){return this._setErr(XMLP.ERR_ELM_LT_NAME)}this.m_name=a;this.m_iP=g+1;return d};XMLP.prototype._parseEntity=function(a){var b=this.m_xml.indexOf(";",a);if(b==-1){return this._setErr(XMLP.ERR_CLOSE_ENTITY)}this.m_iP=b+1;return this._replaceEntity(this.m_xml,a,b)};XMLP.prototype._parsePI=function(b){var e,a,d,f,c;e=this.m_xml.indexOf("?>",b);if(e==-1){return this._setErr(XMLP.ERR_CLOSE_PI)}a=SAXStrings.indexOfNonWhitespace(this.m_xml,b,e);if(a==-1){return this._setErr(XMLP.ERR_PI_TARGET)}d=SAXStrings.indexOfWhitespace(this.m_xml,a,e);if(d==-1){d=e}f=SAXStrings.indexOfNonWhitespace(this.m_xml,d,e);if(f==-1){f=e}c=SAXStrings.lastIndexOfNonWhitespace(this.m_xml,f,e);if(c==-1){c=e-1}this.m_name=this.m_xml.substring(a,d);this._setContent(XMLP._CONT_XML,f,c+1);this.m_iP=e+2;return XMLP._PI};XMLP.prototype._parseText=function(b){var c,a;c=this.m_xml.indexOf("<",b);if(c==-1){c=this.m_xml.length}a=this.m_xml.indexOf("&",b);if((a!=-1)&&(a<=c)){c=a}this._setContent(XMLP._CONT_XML,b,c);this.m_iP=c;return XMLP._TEXT};XMLP.prototype._replaceEntities=function(f,b,d){if(SAXStrings.isEmpty(f)){return""}b=b||0;d=d||f.length;var c,a,e="";c=f.indexOf("&",b);a=b;while((c>0)&&(c<d)){e+=f.substring(a,c);a=f.indexOf(";",c)+1;if((a==0)||(a>d)){return this._setErr(XMLP.ERR_CLOSE_ENTITY)}iRet=this._replaceEntity(f,c+1,a-1);if(iRet==XMLP._ERROR){return iRet}e+=this.m_cAlt;c=f.indexOf("&",a)}if(a!=d){e+=f.substring(a,d)}this._setContent(XMLP._CONT_ALT,e);return XMLP._ENTITY};XMLP.prototype._replaceEntity=function(c,a,b){if(SAXStrings.isEmpty(c)){return -1}a=a||0;b=b||c.length;switch(c.substring(a,b)){case"amp":strEnt="&";break;case"lt":strEnt="<";break;case"gt":strEnt=">";break;case"apos":strEnt="'";break;case"quot":strEnt='"';break;default:if(c.charAt(a)=="#"){strEnt=String.fromCharCode(parseInt(c.substring(a+1,b)))}else{return this._setErr(XMLP.ERR_ENTITY_UNKNOWN)}break}this._setContent(XMLP._CONT_ALT,strEnt);return XMLP._ENTITY};XMLP.prototype._setContent=function(b){var a=arguments;if(XMLP._CONT_XML==b){this.m_cAlt=null;this.m_cB=a[1];this.m_cE=a[2]}else{this.m_cAlt=a[1];this.m_cB=0;this.m_cE=a[1].length}this.m_cSrc=b};XMLP.prototype._setErr=function(b){var a=XMLP._errs[b];this.m_cAlt=a;this.m_cB=0;this.m_cE=a.length;this.m_cSrc=XMLP._CONT_ALT;return XMLP._ERROR};SAXDriver=function(){this.m_hndDoc=null;this.m_hndErr=null;this.m_hndLex=null};SAXDriver.DOC_B=1;SAXDriver.DOC_E=2;SAXDriver.ELM_B=3;SAXDriver.ELM_E=4;SAXDriver.CHARS=5;SAXDriver.PI=6;SAXDriver.CD_B=7;SAXDriver.CD_E=8;SAXDriver.CMNT=9;SAXDriver.DTD_B=10;SAXDriver.DTD_E=11;SAXDriver.prototype.parse=function(b){var a=new XMLP(b);if(this.m_hndDoc&&this.m_hndDoc.setDocumentLocator){this.m_hndDoc.setDocumentLocator(this)}this.m_parser=a;this.m_bErr=false;if(!this.m_bErr){this._fireEvent(SAXDriver.DOC_B)}this._parseLoop();if(!this.m_bErr){this._fireEvent(SAXDriver.DOC_E)}this.m_xml=null;this.m_iP=0};SAXDriver.prototype.setDocumentHandler=function(a){this.m_hndDoc=a};SAXDriver.prototype.setErrorHandler=function(a){this.m_hndErr=a};SAXDriver.prototype.setLexicalHandler=function(a){this.m_hndLex=a};SAXDriver.prototype.getColumnNumber=function(){return this.m_parser.getColumnNumber()};SAXDriver.prototype.getLineNumber=function(){return this.m_parser.getLineNumber()};SAXDriver.prototype.getMessage=function(){return this.m_strErrMsg};SAXDriver.prototype.getPublicId=function(){return null};SAXDriver.prototype.getSystemId=function(){return null};SAXDriver.prototype.getLength=function(){return this.m_parser.getAttributeCount()};SAXDriver.prototype.getName=function(a){return this.m_parser.getAttributeName(a)};SAXDriver.prototype.getValue=function(a){return this.m_parser.getAttributeValue(a)};SAXDriver.prototype.getValueByName=function(a){return this.m_parser.getAttributeValueByName(a)};SAXDriver.prototype._fireError=function(a){this.m_strErrMsg=a;this.m_bErr=true;if(this.m_hndErr&&this.m_hndErr.fatalError){this.m_hndErr.fatalError(this)}};SAXDriver.prototype._fireEvent=function(c){var b,e,d=arguments,a=d.length-1;if(this.m_bErr){return}if(SAXDriver.DOC_B==c){e="startDocument";b=this.m_hndDoc}else{if(SAXDriver.DOC_E==c){e="endDocument";b=this.m_hndDoc}else{if(SAXDriver.ELM_B==c){e="startElement";b=this.m_hndDoc}else{if(SAXDriver.ELM_E==c){e="endElement";b=this.m_hndDoc}else{if(SAXDriver.CHARS==c){e="characters";b=this.m_hndDoc}else{if(SAXDriver.PI==c){e="processingInstruction";b=this.m_hndDoc}else{if(SAXDriver.CD_B==c){e="startCDATA";b=this.m_hndLex}else{if(SAXDriver.CD_E==c){e="endCDATA";b=this.m_hndLex}else{if(SAXDriver.CMNT==c){e="comment";b=this.m_hndLex}}}}}}}}}if(b&&b[e]){if(0==a){b[e]()}else{if(1==a){b[e](d[1])}else{if(2==a){b[e](d[1],d[2])}else{if(3==a){b[e](d[1],d[2],d[3])}}}}}};SAXDriver.prototype._parseLoop=function(b){var a,b;b=this.m_parser;while(!this.m_bErr){a=b.next();if(a==XMLP._ELM_B){this._fireEvent(SAXDriver.ELM_B,b.getName(),this)}else{if(a==XMLP._ELM_E){this._fireEvent(SAXDriver.ELM_E,b.getName())}else{if(a==XMLP._ELM_EMP){this._fireEvent(SAXDriver.ELM_B,b.getName(),this);this._fireEvent(SAXDriver.ELM_E,b.getName())}else{if(a==XMLP._TEXT){this._fireEvent(SAXDriver.CHARS,b.getContent(),b.getContentBegin(),b.getContentEnd()-b.getContentBegin())}else{if(a==XMLP._ENTITY){this._fireEvent(SAXDriver.CHARS,b.getContent(),b.getContentBegin(),b.getContentEnd()-b.getContentBegin())}else{if(a==XMLP._PI){this._fireEvent(SAXDriver.PI,b.getName(),b.getContent().substring(b.getContentBegin(),b.getContentEnd()))}else{if(a==XMLP._CDATA){this._fireEvent(SAXDriver.CD_B);this._fireEvent(SAXDriver.CHARS,b.getContent(),b.getContentBegin(),b.getContentEnd()-b.getContentBegin());this._fireEvent(SAXDriver.CD_E)}else{if(a==XMLP._COMMENT){this._fireEvent(SAXDriver.CMNT,b.getContent(),b.getContentBegin(),b.getContentEnd()-b.getContentBegin())}else{if(a==XMLP._DTD){}else{if(a==XMLP._ERROR){this._fireError(b.getContent())}else{if(a==XMLP._NONE){return}}}}}}}}}}}}};SAXStrings=function(){};SAXStrings.WHITESPACE=" \t\n\r";SAXStrings.QUOTES="\"'";SAXStrings.getColumnNumber=function(e,d){if(SAXStrings.isEmpty(e)){return -1}d=d||e.length;var b=e.substring(0,d).split("\n");var a=b[b.length-1];b.length--;var c=b.join("\n").length;return d-c};SAXStrings.getLineNumber=function(b,a){if(SAXStrings.isEmpty(b)){return -1}a=a||b.length;return b.substring(0,a).split("\n").length};SAXStrings.indexOfNonWhitespace=function(d,a,c){if(SAXStrings.isEmpty(d)){return -1}a=a||0;c=c||d.length;for(var b=a;b<c;b++){if(SAXStrings.WHITESPACE.indexOf(d.charAt(b))==-1){return b}}return -1};SAXStrings.indexOfWhitespace=function(d,a,c){if(SAXStrings.isEmpty(d)){return -1}a=a||0;c=c||d.length;for(var b=a;b<c;b++){if(SAXStrings.WHITESPACE.indexOf(d.charAt(b))!=-1){return b}}return -1};SAXStrings.isEmpty=function(a){return(a==null)||(a.length==0)};SAXStrings.lastIndexOfNonWhitespace=function(d,a,c){if(SAXStrings.isEmpty(d)){return -1}a=a||0;c=c||d.length;for(var b=c-1;b>=a;b--){if(SAXStrings.WHITESPACE.indexOf(d.charAt(b))==-1){return b}}return -1};SAXStrings.replace=function(e,a,d,c,b){if(SAXStrings.isEmpty(e)){return""}a=a||0;d=d||e.length;return e.substring(a,d).split(c).join(b)};saxStack=function(){this.m_arr=new Array()};saxStack.prototype.clear=function(){this.m_arr=new Array()};saxStack.prototype.count=function(){return this.m_arr.length};saxStack.prototype.destroy=function(){this.m_arr=null};saxStack.prototype.peek=function(){if(this.m_arr.length==0){return null}return this.m_arr[this.m_arr.length-1]};saxStack.prototype.pop=function(){if(this.m_arr.length==0){return null}var a=this.m_arr[this.m_arr.length-1];this.m_arr.length--;return a};saxStack.prototype.push=function(a){this.m_arr[this.m_arr.length]=a};function isEmpty(a){return(a==null)||(a.length==0)}function trim(a,b,f){if(isEmpty(a)){return""}if(b==null){b=true}if(f==null){f=true}var g=0;var e=0;var d=0;var c=0;if(b==true){while((d<a.length)&&(whitespace.indexOf(a.charAt(d++))!=-1)){g++}}if(f==true){c=a.length-1;while((c>=g)&&(whitespace.indexOf(a.charAt(c--))!=-1)){e++}}return a.substring(g,a.length-e)}function __escapeString(e){var f=/&/g;var c=/</g;var a=/>/g;var b=/"/g;var d=/'/g;e=e.replace(f,"&amp;");e=e.replace(c,"&lt;");e=e.replace(a,"&gt;");e=e.replace(b,"&quot;");e=e.replace(d,"&apos;");return e}function __unescapeString(e){var f=/&amp;/g;var c=/&lt;/g;var a=/&gt;/g;var b=/&quot;/g;var d=/&apos;/g;e=e.replace(f,"&");e=e.replace(c,"<");e=e.replace(a,">");e=e.replace(b,'"');e=e.replace(d,"'");return e}var xmlTextArray;var xmlCDataArray;var xmlAttrArray;function showTagInfo(d){var b;var c;b=trim(xmlTextArray[d]);if(b==""||b==null){b="No text value for this node"}c=trim(xmlCDataArray[d]);if(c==""||c==null){c="No CDATA value for this node"}var e="Text:\n "+b+"\n\nCDATA:\n "+c+"\n\n";if(xmlAttrArray[d]){var a=xmlAttrArray[d];var f="";for(i in a){f+=i+"="+a[i]+"\n"}e+="Attributes:\n "+f}alert(d+"\n\n"+e)}function startParser(){var d=document.getElementById("xmldata").value;var a,e="",f=new SAXDriver();var b=new xmlHandler();f.setDocumentHandler(b);f.setErrorHandler(b);f.setLexicalHandler(b);f.parse(d);var c="\n"+b.getError();xmlTextArray=b.getText_Array();xmlCDataArray=b.getCDATA_Array();xmlAttrArray=b.getAttr_Array();a=b.getPath_Array();for(i=0;i<a.length;i++){e+='<a href="javascript:void(null)" onclick="showTagInfo(\''+a[i]+"')\">"+a[i]+"</a>\n"}if(document.all){document.all.divout.innerHTML="Parsing completed  | Click on the links below for more info:<br><pre>"+e+"</pre>"}else{if(document.getElementById){document.getElementById("divout").innerHTML="Parsing completed | Click on the links below for more info:<br><pre>"+e+"</pre>"}else{alert("Requires a DOM compatible browser for this test")}}}xmlHandler=function(){this.m_strError="";this.m_treePath=[];this.m_xPath=[""];this.m_text=[""];this.m_cdata=[""];this.m_attr=[""];this.m_pi=[""];this.cdata=false};xmlHandler.prototype.characters=function(b,d,a){var c=b.substr(d,a);if(c=="\n"){return null}if(this.m_treePath.length>0){if(this.cdata==false){if(!this.m_text[this.m_xPath.join("/")]){this.m_text[this.m_xPath.join("/")]=""}this.m_text[this.m_xPath.join("/")]+=c}else{if(!this.m_cdata[this.m_xPath.join("/")]){this.m_cdata[this.m_xPath.join("/")]=""}this.m_cdata[this.m_xPath.join("/")]+=c}}};xmlHandler.prototype.comment=function(b,d,a){var c=b.substr(d,a)};xmlHandler.prototype.endCDATA=function(){this.cdata=false};xmlHandler.prototype.endDocument=function(){};xmlHandler.prototype.endElement=function(a){this.m_xPath=this.m_xPath.slice(0,-1)};xmlHandler.prototype.error=function(a){this.m_strError+="Error:"+a.getMessage()+"\n"};xmlHandler.prototype.fatalError=function(a){this.m_strError+="fatal error:"+a.getMessage()+"\n"};xmlHandler.prototype.getAttr_Array=function(){return this.m_attr};xmlHandler.prototype.getCDATA_Array=function(){return this.m_cdata};xmlHandler.prototype.getError=function(){return this.m_strError};xmlHandler.prototype.getPath_Array=function(){return this.m_treePath};xmlHandler.prototype.getText_Array=function(){return this.m_text};xmlHandler.prototype.processingInstruction=function(b,a){};xmlHandler.prototype.setDocumentLocator=function(a){this.m_locator=a};xmlHandler.prototype.startCDATA=function(){this.cdata=true};xmlHandler.prototype.startDocument=function(){};xmlHandler.prototype.startElement=function(b,e){alert(b);var c,d=e.getLength();this.m_xPath[this.m_xPath.length]=b;c=this.m_xPath.join("/");this.m_treePath[this.m_treePath.length]=c;if(d){var a=[];for(i=0;i<d;i++){a[e.getName(i)]=e.getValue(i)}this.m_attr[this.m_xPath.join("/")]=a}};xmlHandler.prototype.warning=function(a){this.m_strError+="Warning:"+a.getMessage()+"\n"};function Timer(){this.startTime=null;this.stopTime=null}Timer.prototype.start=function(){var a=new Date();this.startTime=a.getTime()};Timer.prototype.stop=function(){var a=new Date();this.stopTime=a.getTime()};Timer.prototype.getTime=function(){if(this.startTime&&this.stopTime){return(this.stopTime-this.startTime)/1000}return 0};function __getIEVersion(){var c=-1;if(navigator.appName=="Microsoft Internet Explorer"){var a=navigator.userAgent;var b=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(b.exec(a)!=null){c=parseFloat(RegExp.$1)}}return c}function __getOperaVersion(){var b=0;if(window.opera){var a=window.opera.version();b=parseFloat(a)}return b}var __userAgent=navigator.userAgent;var __isIE=navigator.appVersion.match(/MSIE/)!=null;var __IEVersion=__getIEVersion();var __isIENew=__isIE&&__IEVersion>=8;var __isIEOld=__isIE&&!__isIENew;var __isFireFox=__userAgent.match(/firefox/i)!=null;var __isFireFoxOld=__isFireFox&&((__userAgent.match(/firefox\/2./i)!=null)||(__userAgent.match(/firefox\/1./i)!=null));var __isFireFoxNew=__isFireFox&&!__isFireFoxOld;var __isWebKit=navigator.appVersion.match(/WebKit/)!=null;var __isChrome=navigator.appVersion.match(/Chrome/)!=null;var __isOpera=window.opera!=null;var __operaVersion=__getOperaVersion();var __isOperaOld=__isOpera&&(__operaVersion<10);function __parseBorderWidth(b){var a=0;if(typeof(b)=="string"&&b!=null&&b!=""){var c=b.indexOf("px");if(c>=0){a=parseInt(b.substring(0,c))}else{a=1}}return a}function __getBorderWidth(c){var b=new Object();b.left=0;b.top=0;b.right=0;b.bottom=0;if(window.getComputedStyle){var a=window.getComputedStyle(c,null);b.left=parseInt(a.borderLeftWidth.slice(0,-2));b.top=parseInt(a.borderTopWidth.slice(0,-2));b.right=parseInt(a.borderRightWidth.slice(0,-2));b.bottom=parseInt(a.borderBottomWidth.slice(0,-2))}else{b.left=__parseBorderWidth(c.style.borderLeftWidth);b.top=__parseBorderWidth(c.style.borderTopWidth);b.right=__parseBorderWidth(c.style.borderRightWidth);b.bottom=__parseBorderWidth(c.style.borderBottomWidth)}return b}function getElementAbsolutePos(d){var j=new Object();j.x=0;j.y=0;if(d!==null){if(d.getBoundingClientRect){var g=document.documentElement;var e=d.getBoundingClientRect();var c=g.scrollLeft;var b=g.scrollTop;j.x=e.left+c;j.y=e.top+b}else{j.x=d.offsetLeft;j.y=d.offsetTop;var f=d.parentNode;var a=null;while(offsetParent!=null){j.x+=offsetParent.offsetLeft;j.y+=offsetParent.offsetTop;var h=offsetParent.tagName.toLowerCase();if((__isIEOld&&h!="table")||((__isFireFoxNew||__isChrome)&&h=="td")){a=kGetBorderWidth(offsetParent);j.x+=a.left;j.y+=a.top}if(offsetParent!=document.body&&offsetParent!=document.documentElement){j.x-=offsetParent.scrollLeft;j.y-=offsetParent.scrollTop}if(!__isIE&&!__isOperaOld||__isIENew){while(offsetParent!=f&&f!==null){j.x-=f.scrollLeft;j.y-=f.scrollTop;if(__isFireFoxOld||__isWebKit){a=kGetBorderWidth(f);j.x+=a.left;j.y+=a.top}f=f.parentNode}}f=offsetParent.parentNode;offsetParent=offsetParent.offsetParent}}}return j}var eEndBehavior={Reset:0,Constant:1,Repeat:2,Oscillate:3,OffsetRepeat:4,Linear:5};var eImageAntialiasOp={None:0,TwoPass:1,FourPass:2,EightPass:3,EnumCount:4};var eKeyframeShape={Linear:0,Stepped:1,TCB:2,Bezier1D:3,Bezier2D:4};var eTextureType={Color:0,Diffuse:1,Luminosity:2,Reflection:3,Specularity:4,Transparency:5,Clip:6,Bump:7,EnumCount:8};var eTextureWrap={None:0,Clamp:1,Repeat:2,Mirror:3,EnumCount:4};var FLT_EPSILON=1.192092896e-7;var FLT_MAX=3.402823466e+38;var TWOPI=Math.PI*2;var HALFPI=Math.PI/2;var QUARTERPI=Math.PI/4;function min3(a,c,b){return Math.min(a,Math.min(c,b))}function max3(a,c,b){return Math.max(a,Math.max(c,b))}function toRadians(a){return a*Math.PI/180}function toDegrees(a){return a*180/Math.PI}function magnitude(a,c,b){return Math.sqrt(((a)*(a))+((c)*(c))+((b)*(b)))}function clamp(c,b,a){if(c<b){return b}if(c>a){return a}return c}function degreeNormalize(a){while(a<0){a+=360}while(a>=360){a-=360}return a}function epsilonEqual(b,a,c){if(Math.abs(b-a)<c){return true}return false}function determinant2x2(d,b,a,c){return(d*c)-(b*a)}function determinant3x3(j,h,g,f,e,d,p,n,l){var o=determinant2x2(e,d,n,l);var m=determinant2x2(f,d,p,l);var k=determinant2x2(f,e,p,n);return(j*o)-(h*m)+(g*k)}function determinant4x4(k,h,f,e,q,p,o,n,w,t,s,r,m,l,j,g){var z=determinant3x3(p,o,n,t,s,r,l,j,g);var y=determinant3x3(q,o,n,w,s,r,m,j,g);var x=determinant3x3(q,p,n,w,t,r,m,l,g);var u=determinant3x3(q,p,o,w,t,s,m,l,j);return(k*z)-(h*y)+(f*x)-(e*u)}function modf(a){var c=(a<0?Math.ceil(a):Math.floor(a));var b=a-c;return{integerPart:c,fractionalPart:b}}function XYZtoH(a,d,c){var b=0;if(a==0){if(c>=0){b=0}else{b=Math.PI}}else{if(c==0){if(a>=0){b=3*HALFPI}else{b=HALFPI}}else{if(a>0&&c>0){b=TWOPI-Math.atan(a/c)}else{if(a<0&&c>0){b=-Math.atan(a/c)}else{if(a<0&&c<0){b=HALFPI+Math.atan(c/a)}else{b=3*HALFPI+Math.atan(c/a)}}}}}return b}function XYZtoHP(a,e,d){var c=0;var b=0;if(a==0&&d==0){c=0;if(e!=0){b=(e<0?-HALFPI:HALFPI)}else{b=0}}else{if(d==0){c=(a>0?HALFPI:-HALFPI)}else{if(d<0){c=-Math.atan(a/d)+Math.PI}else{c=-Math.atan(a/d)}}a=Math.sqrt(a*a+d*d);if(a==0){b=(e<0?-HALFPI:HALFPI)}else{b=Math.atan(e/a)}}return{heading:c,pitch:b}}function rectContainsPoint(a,c,b){if(a>=b.left&&c>=b.top&&a<=b.right&&c<=b.bottom){return true}return false}function Vector2D(a,b){this.x=a||0;this.y=b||0}Vector2D.prototype.v=function(){var a=[this.x,this.y];return a};Vector2D.prototype.load=function(a,b){this.x=a;this.y=b};Vector2D.prototype.copy=function(a){if(a){this.x=a.x;this.y=a.y}};function Vector3D(a,c,b){this.x=a||0;this.y=c||0;this.z=b||0;this.equals=function(d){return(this.x==d.x&&this.y==d.y&&this.z==d.z)}}Vector3D.prototype.alert=function(){var a="x: "+this.x+"\n";a+="y: "+this.y+"\n";a+="z: "+this.z+"\n";alert(a)};Vector3D.prototype.v=function(){var a=[this.x,this.y,this.z];return a};Vector3D.prototype.load=function(a,c,b){this.x=a;this.y=c;this.z=b};Vector3D.prototype.copy=function(a){if(a){this.x=a.x;this.y=a.y;this.z=a.z}};Vector3D.prototype.multiplyScalar=function(a){this.x*=a;this.y*=a;this.z*=a};Vector3D.prototype.multiplyVector=function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z};Vector3D.prototype.addVector=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z};Vector3D.prototype.subtractVector=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z};Vector3D.prototype.normalize=function(){var a=magnitude(this.x,this.y,this.z);if(a!=0){this.x/=a;this.y/=a;this.z/=a}};function dotProduct(b,a){return((b.x*a.x)+(b.y*a.y)+(b.z*a.z))}function crossProduct(c,b){var a=new Vector3D();a.x=(c.y*b.z)-(c.z*b.y);a.y=(c.z*b.x)-(c.x*b.z);a.z=(c.x*b.y)-(c.y*b.x);return a}function cosineAngleBetween(d,c){var b=magnitude(d.x,d.y,d.z)*magnitude(c.x,c.y,c.z);if(b!=0){var a=dotProduct(d,c)/b;if(a>1){a=1}else{if(a<-1){a=-1}}return a}return 1}function midpoint(c,b){var a=new Vector3D();a.x=(c.x+b.x)/2;a.y=(c.y+b.y)/2;a.z=(c.z+b.z)/2;return a}function distanceBetween(b,a){return Math.sqrt((b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y)+(b.z-a.z)*(b.z-a.z))}function subtract3D(c,b){var a=new Vector3D(c.x,c.y,c.z);a.subtractVector(b);return a}function Vector4D(a,d,c,b){this.x=a||0;this.y=d||0;this.z=c||0;this.w=b||0}Vector4D.prototype.v=function(){var a=[this.x,this.y,this.z,this.w];return a};Vector4D.prototype.load=function(a,d,c,b){if(Vector4D){this.x=a;this.y=d;this.z=c;this.w=b}};Vector4D.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w};function Matrix4x4(l,k,h,f,c,b,a,q,p,o,n,m,j,g,e,d){this._11=l||1;this._12=k||0;this._13=h||0;this._14=f||0;this._21=c||0;this._22=b||1;this._23=a||0;this._24=q||0;this._31=p||0;this._32=o||0;this._33=n||1;this._34=m||0;this._41=j||0;this._42=g||0;this._43=e||0;this._44=d||1}Matrix4x4.prototype.alert=function(){alert([[this._11,this._12,this._13,this._14].join(" "),[this._21,this._22,this._23,this._24].join(" "),[this._31,this._32,this._33,this._34].join(" "),[this._41,this._42,this._43,this._44].join(" ")].join("\n"))};Matrix4x4.prototype.flatten=function(){var a=[this._11,this._12,this._13,this._14,this._21,this._22,this._23,this._24,this._31,this._32,this._33,this._34,this._41,this._42,this._43,this._44];return a};Matrix4x4.prototype.getAt=function(b,a){switch(b){case 0:switch(a){case 0:return this._11;case 1:return this._12;case 2:return this._13;case 3:return this._14}break;case 1:switch(a){case 0:return this._21;case 1:return this._22;case 2:return this._23;case 3:return this._24}break;case 2:switch(a){case 0:return this._31;case 1:return this._32;case 2:return this._33;case 3:return this._34}break;case 3:switch(a){case 0:return this._41;case 1:return this._42;case 2:return this._43;case 3:return this._44}break}};Matrix4x4.prototype.setAt=function(c,a,b){switch(c){case 0:switch(a){case 0:this._11=b;break;case 1:this._12=b;break;case 2:this._13=b;break;case 3:this._14=b;break}break;case 1:switch(a){case 0:this._21=b;break;case 1:this._22=b;break;case 2:this._23=b;break;case 3:this._24=b;break}break;case 2:switch(a){case 0:this._31=b;break;case 1:this._32=b;break;case 2:this._33=b;break;case 3:this._34=b;break}break;case 3:switch(a){case 0:this._41=b;break;case 1:this._42=b;break;case 2:this._43=b;break;case 3:this._44=b;break}break}};Matrix4x4.prototype.load=function(l,k,h,f,c,b,a,q,p,o,n,m,j,g,e,d){this._11=l;this._12=k;this._13=h;this._14=f;this._21=c;this._22=b;this._23=a;this._24=q;this._31=p;this._32=o;this._33=n;this._34=m;this._41=j;this._42=g;this._43=e;this._44=d};Matrix4x4.prototype.loadMatrix=function(a){this._11=a._11;this._12=a._12;this._13=a._13;this._14=a._14;this._21=a._21;this._22=a._22;this._23=a._23;this._24=a._24;this._31=a._31;this._32=a._32;this._33=a._33;this._34=a._34;this._41=a._41;this._42=a._42;this._43=a._43;this._44=a._44};Matrix4x4.prototype.loadArray=function(a){this._11=a[0];this._12=a[1];this._13=a[2];this._14=a[3];this._21=a[4];this._22=a[5];this._23=a[6];this._24=a[7];this._31=a[8];this._32=a[9];this._33=a[10];this._34=a[11];this._41=a[12];this._42=a[13];this._43=a[14];this._44=a[15]};Matrix4x4.prototype.loadIdentity=function(){this._11=1;this._12=0;this._13=0;this._14=0;this._21=0;this._22=1;this._23=0;this._24=0;this._31=0;this._32=0;this._33=1;this._34=0;this._41=0;this._42=0;this._43=0;this._44=1};Matrix4x4.prototype.loadTranslation=function(a,c,b){this.loadIdentity();this._41=a;this._42=c;this._43=b};Matrix4x4.prototype.loadRotation=function(l,k,j,q){var f=new Matrix4x4();var h=new Matrix4x4();var n=Math.sqrt(k*k+j*j);if(n!=0){var r=k/n;var g=j/n;f._22=g;f._23=r;f._32=-r;f._33=g;h._22=g;h._23=-r;h._32=r;h._33=g}var c=new Matrix4x4();var o=new Matrix4x4();var a=magnitude(l,k,j);if(a!=0){var e=n/a;var p=l/a;c._11=e;c._13=p;c._31=-p;c._33=e;o._11=e;o._13=-p;o._31=p;o._33=e}var b=new Matrix4x4();var s=Math.cos(toRadians(q));var d=Math.sin(toRadians(q));b._11=s;b._12=d;b._21=-d;b._22=s;var m=f.multiply(c.multiply(b.multiply(o.multiply(h))));this.loadMatrix(m)};Matrix4x4.prototype.loadXAxisRotation=function(c){this.loadIdentity();var a=Math.cos(toRadians(c));var b=Math.sin(toRadians(c));this._22=a;this._23=b;this._32=-b;this._33=a};Matrix4x4.prototype.loadYAxisRotation=function(c){this.loadIdentity();var a=Math.cos(toRadians(c));var b=Math.sin(toRadians(c));this._11=a;this._13=-b;this._31=b;this._33=a};Matrix4x4.prototype.loadZAxisRotation=function(c){this.loadIdentity();var a=Math.cos(toRadians(c));var b=Math.sin(toRadians(c));this._11=a;this._12=b;this._21=-b;this._22=a};Matrix4x4.prototype.loadXYZAxisRotation=function(c,b,g){var f=new Matrix4x4();var e=new Matrix4x4();var d=new Matrix4x4();f.loadXAxisRotation(c);e.loadYAxisRotation(b);d.loadZAxisRotation(g);var a=e.multiply(f.multiply(d));this.loadMatrix(a)};Matrix4x4.prototype.getRotationAngles=function(){var a,e,d;a=Math.asin(clamp(this._23,-1,1));var c=Math.cos(a);if(!epsilonEqual(c,0,FLT_EPSILON)){e=Math.atan2(-(this._13)/c,this._33/c);d=Math.atan2(-(this._21)/c,this._22/c)}else{var b=new Matrix4x4();b.loadXAxisRotation(toDegrees(a));b.transpose();b.loadMatrix(b.multiply(this));e=0;d=Math.atan2(-(b._21),b._22)}return{x:toDegrees(a),y:toDegrees(e),z:toDegrees(d)}};Matrix4x4.prototype.loadScale=function(a,c,b){this.loadIdentity();this._11=a;this._22=c;this._33=b};Matrix4x4.prototype.getScalingFactors=function(){var d,c;d=this.transform(1,0,0,0);c=this.transform(2,0,0,0);var g=magnitude(c.x,c.y,c.z)-magnitude(d.x,d.y,d.z);d=this.transform(0,1,0,0);c=this.transform(0,2,0,0);var f=magnitude(c.x,c.y,c.z)-magnitude(d.x,d.y,d.z);d=this.transform(0,0,1,0);c=this.transform(0,0,2,0);var e=magnitude(c.x,c.y,c.z)-magnitude(d.x,d.y,d.z);return{x:g,y:f,z:e}};Matrix4x4.prototype.multiply=function(b){var a=new Matrix4x4();a.load(this._11*b._11+this._12*b._21+this._13*b._31+this._14*b._41,this._11*b._12+this._12*b._22+this._13*b._32+this._14*b._42,this._11*b._13+this._12*b._23+this._13*b._33+this._14*b._43,this._11*b._14+this._12*b._24+this._13*b._34+this._14*b._44,this._21*b._11+this._22*b._21+this._23*b._31+this._24*b._41,this._21*b._12+this._22*b._22+this._23*b._32+this._24*b._42,this._21*b._13+this._22*b._23+this._23*b._33+this._24*b._43,this._21*b._14+this._22*b._24+this._23*b._34+this._24*b._44,this._31*b._11+this._32*b._21+this._33*b._31+this._34*b._41,this._31*b._12+this._32*b._22+this._33*b._32+this._34*b._42,this._31*b._13+this._32*b._23+this._33*b._33+this._34*b._43,this._31*b._14+this._32*b._24+this._33*b._34+this._34*b._44,this._41*b._11+this._42*b._21+this._43*b._31+this._44*b._41,this._41*b._12+this._42*b._22+this._43*b._32+this._44*b._42,this._41*b._13+this._42*b._23+this._43*b._33+this._44*b._43,this._41*b._14+this._42*b._24+this._43*b._34+this._44*b._44);return a};Matrix4x4.prototype.leftMultiply=function(b){var a=b.multiply(this);return a};Matrix4x4.prototype.transpose=function(){var a=new Matrix4x4();a.loadMatrix(this);this._11=a._11;this._12=a._21;this._13=a._31;this._14=a._41;this._21=a._12;this._22=a._22;this._23=a._32;this._24=a._42;this._31=a._13;this._32=a._23;this._33=a._33;this._34=a._43;this._41=a._14;this._42=a._24;this._43=a._34;this._44=a._44};Matrix4x4.prototype.invert=function(){var e=determinant4x4(this._11,this._12,this._13,this._14,this._21,this._22,this._23,this._24,this._31,this._32,this._33,this._34,this._41,this._42,this._43,this._44);if(e==0){return}var a=new Matrix4x4();var d,c,g,h,b;for(d=0;d<4;d++){for(c=0;c<4;c++){var f=[];for(g=0,b=0;g<4;g++){if(g==d){continue}for(h=0;h<4;h++){if(h==c){continue}f[b++]=this.getAt(g,h)}}a.setAt(d,c,determinant3x3(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8])/e*(d+c&1?-1:1))}}a.transpose();this.loadMatrix(a)};Matrix4x4.prototype.transform=function(b,g,e,d){var c,a,f;if(d==0){c=this._11*b+this._21*g+this._31*e;a=this._12*b+this._22*g+this._32*e;f=this._13*b+this._23*g+this._33*e}else{if(d==1){c=this._11*b+this._21*g+this._31*e+this._41;a=this._12*b+this._22*g+this._32*e+this._42;f=this._13*b+this._23*g+this._33*e+this._43}else{c=this._11*b+this._21*g+this._31*e+this._41*d;a=this._12*b+this._22*g+this._32*e+this._42*d;f=this._13*b+this._23*g+this._33*e+this._43*d}}return{x:c,y:a,z:f}};Matrix4x4.prototype.transformw=function(b,h,f,d){var c,a,g,e;if(d==0){c=this._11*b+this._21*h+this._31*f;a=this._12*b+this._22*h+this._32*f;g=this._13*b+this._23*h+this._33*f;e=this._14*b+this._24*h+this._34*f}else{if(d==1){c=this._11*b+this._21*h+this._31*f+this._41;a=this._12*b+this._22*h+this._32*f+this._42;g=this._13*b+this._23*h+this._33*f+this._43;e=this._14*b+this._24*h+this._34*f+this._44}else{c=this._11*b+this._21*h+this._31*f+this._41*d;a=this._12*b+this._22*h+this._32*f+this._42*d;g=this._13*b+this._23*h+this._33*f+this._43*d;e=this._14*b+this._24*h+this._34*f+this._44*d}}return{x:c,y:a,z:g,w:e}};Matrix4x4.prototype.transformVector3D=function(b,a){return this.transform(b.x,b.y,b.z,a)};MatrixStack.prototype=new Stack();MatrixStack.prototype.constructor=MatrixStack;function MatrixStack(a){Stack.call(this,a)}MatrixStack.prototype.push=function(a){if(a){this.stack.push(a)}else{this.stack.push(this.top())}};MatrixStack.prototype.loadMatrix=function(a){this.load(a)};MatrixStack.prototype.leftMultiply=function(b){var a=b.multiply(this.top());this.pop();Stack.prototype.push.call(this,a)};MatrixStack.prototype.rightMultiply=function(b){var a=this.top().multiply(b);this.pop();Stack.prototype.push.call(this,a)};function Quaternion(){this.w=1;this.x=0;this.y=0;this.z=0}Quaternion.prototype.load=function(b,a,d,c){this.w=b;this.x=a;this.y=d;this.z=c};Quaternion.prototype.loadQuaternion=function(a){this.w=a.w;this.x=a.x;this.y=a.y;this.z=a.z};Quaternion.prototype.loadArray=function(a){this.w=a[0];this.x=a[1];this.y=a[2];this.z=a[3]};Quaternion.prototype.loadIdentity=function(){this.w=1;this.x=0;this.y=0;this.z=0};Quaternion.prototype.magnitude=function(){return Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z)};Quaternion.prototype.normalize=function(){var a=this.magnitude();this.w/=a;this.x/=a;this.y/=a;this.z/=a};Quaternion.prototype.loadRotation=function(a,g,f,e){var d=toRadians(e)/2;var c=Math.sin(d);var b=Math.cos(d);this.w=b;this.x=a*c;this.y=g*c;this.z=f*c;this.normalize()};Quaternion.prototype.loadXAxisRotation=function(b){var a=toRadians(b)/2;this.w=Math.cos(a);this.x=Math.sin(a);this.y=0;this.z=0};Quaternion.prototype.loadYAxisRotation=function(b){var a=toRadians(b)/2;this.w=Math.cos(a);this.x=0;this.y=Math.sin(a);this.z=0};Quaternion.prototype.loadZAxisRotation=function(b){var a=toRadians(b)/2;this.w=Math.cos(a);this.x=0;this.y=0;this.z=Math.sin(a)};Quaternion.prototype.loadXYZAxisRotation=function(f,d,a){var e=toRadians(f)/2;var c=toRadians(d)/2;var b=toRadians(a)/2;var j=new Quaternion();j.load(Math.cos(e),Math.sin(e),0,0);var h=new Quaternion();h.load(Math.cos(c),0,Math.sin(c),0);var g=new Quaternion();g.load(Math.cos(b),0,0,Math.sin(b));var k=h.multiply(j.multiply(g));this.loadQuaternion(k)};Quaternion.prototype.multiply=function(b){var a=new Quaternion();a.load(this.w*b.w-this.x*b.x-this.y*b.y-this.z*b.z,this.w*b.x+this.x*b.w+this.y*b.z-this.z*b.y,this.w*b.y+this.y*b.w+this.z*b.x-this.x*b.z,this.w*b.z+this.z*b.w+this.x*b.y-this.y*b.x);return a};Quaternion.prototype.getMatrix=function(){var l=new Matrix4x4();var b=this.x+this.x;var k=this.y+this.y;var g=this.z+this.z;var a=this.x*b;var n=this.x*k;var m=this.x*g;var j=this.y*k;var h=this.y*g;var c=this.z*g;var f=this.w*b;var e=this.w*k;var d=this.w*g;l._11=1-(j+c);l._21=n-d;l._31=m+e;l._41=0;l._12=n+d;l._22=1-(a+c);l._32=h-f;l._42=0;l._13=m-e;l._23=h+f;l._33=1-(a+j);l._43=0;l._14=0;l._24=0;l._34=0;l._44=1;return l};function Line(a,b){this.point=new Vector3D(a.x,a.y,a.z);this.dir=new Vector3D(b.x,b.y,b.z)}function Plane(a,b){this.point=new Vector3D();this.normal=new Vector3D();this.dot=0;if(a&&b){this.point.copy(a);this.normal.copy(b);this.dot=dotProduct(this.point,this.normal)}}Plane2.prototype=new Plane();Plane2.prototype.constructor=Plane2;function Plane2(b,f,d){var c;if(b&&f&&d){var a=new Vector3D(d.x-f.x,d.y-f.y,d.z-f.z);var e=new Vector3D(b.x-f.x,b.y-f.y,b.z-f.z);c=crossProduct(a,e);c.normalize()}Plane.call(this,b,c)}function pointOnPlane(a,b,c){return(Math.abs(dotProduct(a,b.normal)-b.dot)<c?true:false)}function pointOnPositiveSideOfPlane(a,b){return(dotProduct(a,b.normal)-b.dot>0?true:false)}function pointOnNegativeSideOfPlane(a,b){return(dotProduct(a,b.normal)-b.dot<0?true:false)}function lineIntersectsPlane(e,d){var b=new Vector3D();var a;var c=d.normal.x*e.dir.x+d.normal.y*e.dir.y+d.normal.z*e.dir.z;if(c==0){if(pointOnPlane(e.point,d,FLT_EPSILON)){b.copy(e.point);a=2}a=0}else{var g=d.dot-(d.normal.x*e.point.x+d.normal.y*e.point.y+d.normal.z*e.point.z);var f=g/c;b.x=f*e.dir.x+e.point.x;b.y=f*e.dir.y+e.point.y;b.z=f*e.dir.z+e.point.z;a=1}return{result:a,point:b}}function lineSegmentPlaneIntersection(l,j,f){var q=new Vector3D(j.x-l.x,j.y-l.y,j.z-l.z);var c=l.x;var n=l.y;var e=l.z;var o=q.x;var k=q.y;var h=q.z;var d=f.normal.x*o+f.normal.y*k+f.normal.z*h;if(d==0){if(pointOnPlane(l,f,FLT_EPSILON)){var m=new Vector3D(l);return{count:2,point:m}}return{count:0}}var g=f.dot-(f.normal.x*c+f.normal.y*n+f.normal.z*e);var p=g/d;if(p<0||p>1){return{count:0}}var m=new Vector3D();m.x=p*o+c;m.y=p*k+n;m.z=p*h+e;return{count:1,point:m}}function coplanar(b,a){return(((b.normal==a.normal||b.normal==-a.normal)&&pointOnPlane(b.point,a))?true:false)}function planesIntersect(b,a){var c=new Vector3D(0,0,0);if(crossProduct(b.normal,a.normal).equals(c)){return false}return true}function distanceBetweenPlanes(b,a){if(coplanar(b,a)){return 0}if(!planesIntersect(b,a)){var c=lineIntersectsPlane(new Line(b.point,b.normal),a);if(c.result){return distanceBetween(b.point,point)}else{return 0}}return 0}function ViewVolume(){this.left=null;this.right=null;this.top=null;this.bottom=null;this.near=null;this.far=null}ViewVolume.prototype.setPerspective=function(d,n,l,j){var o=l*Math.tan(0.5*d);var c=o*n;var g=new Vector3D(-c,o,l);var h=new Vector3D(c,o,l);var b=new Vector3D(-c,-o,l);var a=new Vector3D(c,-o,l);o=j*Math.tan(0.5*d);c=o*n;var f=new Vector3D(-c,o,j);var k=new Vector3D(c,o,j);var e=new Vector3D(-c,-o,j);var m=new Vector3D(c,-o,j);this.left=new Plane2(g,b,e);this.right=new Plane2(a,h,k);this.top=new Plane2(g,f,k);this.bottom=new Plane2(b,a,m);this.near=new Plane2(b,g,h);this.far=new Plane2(m,k,f)};ViewVolume.prototype.setOrthographic=function(f,n,m,b,l,j){var g=new Vector3D(f,m,l);var h=new Vector3D(n,m,l);var c=new Vector3D(f,b,l);var a=new Vector3D(n,b,l);var e=new Vector3D(f,m,j);var k=new Vector3D(n,m,j);var d=new Vector3D(f,b,j);var o=new Vector3D(n,b,j);this.left=new Plane2(d,e,g);this.right=new Plane2(a,h,k);this.top=new Plane2(g,e,k);this.bottom=new Plane2(o,d,c);this.near=new Plane2(c,g,h);this.far=new Plane2(o,k,e)};var EPSILON=1e-8;function SIGN3(a){(((a).x<0)?4:0|((a).y<0)?2:0|((a).z<0)?1:0)}function solveQuadraticEquation(h,e,j){if(h==0){return{count:0}}var g=e*e-4*h*j;if(g<0){return{count:0}}if(g==0){var f=-e/(2*h);return{count:1,root1:f}}g=Math.sqrt(g);var f=(-e+g)/(2*h);var d=(-e-g)/(2*h);return{count:2,root1:f,root2:d}}function rayTriangleIntersection(a,r,e,d,c,b,q){var p=new Vector3D(r.x,r.y,r.z);p.normalize();var o=new Vector3D(d.x-e.x,d.y-e.y,d.z-e.z);var m=new Vector3D(c.x-e.x,c.y-e.y,c.z-e.z);var f=crossProduct(p,m);var g=dotProduct(o,f);if(-EPSILON<g&&g<EPSILON){return{result:false}}if(b&&g>0){return{result:false}}if(q&&g<0){return{result:false}}var j=1/g;var s=new Vector3D(a.x-e.x,a.y-e.y,a.z-e.z);var l=dotProduct(s,f)*j;if(l<0||l>1){return{result:false}}var h=crossProduct(s,o);var k=dotProduct(p,h)*j;if(k<0||l+k>1){return{result:false}}var n=dotProduct(m,h)*j;return{result:true,t:n,u:l,v:k}}function raySphereIntersection(f,d,a,h){var g=new Vector3D(d.x,d.y,d.z);g.normalize();var e=new Vector3D(f.x+g.x,f.y+g.y,f.z+g.z);var n=e.x-f.x;var m=e.y-f.y;var l=e.z-f.z;var k=2*(n*(f.x-a.x)+m*(f.y-a.y)+l*(f.z-a.z));var j=(f.x-a.x)*(f.x-a.x)+(f.y-a.y)*(f.x-a.y)+(f.z-a.z)*(f.z-a.z)-h*h;return solveQuadraticEquation(1,k,j)}function triangleContainsPoint(b,g,f,a){var c=SIGN3(crossProduct(subtract3D(b,g),subtract3D(b,a)));var d=SIGN3(crossProduct(subtract3D(g,f),subtract3D(g,a)));var e=SIGN3(crossProduct(subtract3D(f,b),subtract3D(f,a)));if((c==d)&&(d==e)){return true}return false}function triangleOnPositiveSideOfPlane(a,d,c,b){return pointOnPositiveSideOfPlane(a,b)&&pointOnPositiveSideOfPlane(d,b)&&pointOnPositiveSideOfPlane(c,b)}function lineSegmentTriangleIntersection(f,e,d,h,g){var c=lineSegmentPlaneIntersection(f,e,new Plane2(d,h,g));if(c.count==0){return{result:false}}if(c.point.x<min3(d.x,h.x,g.x)||c.point.y<min3(d.y,h.y,g.y)||c.point.z<min3(d.z,h.z,g.z)||c.point.x>max3(d.x,h.x,g.x)||c.point.y>max3(d.y,h.y,g.y)||c.point.z>max3(d.z,h.z,g.z)){return{result:false}}if(triangleContainsPoint(d,h,g,c.point)){return{result:true,point:c.point}}return{result:false}}var eAttrType={Unknown:-1,Attribute:0,AttributeContainer:1,AttributeVector:2,AttributeFactory:3,AttributeRegistry:4,BalloonTipLabelStyleAttr:5,BBoxAttr:6,BooleanAttr:7,ColorAttr:8,FontStyleAttr:9,IconStyleAttr:10,ImageAttr:11,KeyframeAttr:12,KeyframesAttr:13,LabelStyleAttr:14,HTMLLabelStyleAttr:15,NumberArrayAttr:16,NumberAttr:17,Matrix4x4Attr:18,PlaneAttr:19,PulseAttr:20,RectAttr:21,ReferenceAttr:22,StringAttr:23,StyleAttr:24,StylesAttr:25,StyleMapAttr:26,StylesMapAttr:27,Vector3DAttr:28,ViewportAttr:29,ViewVolumeAttr:30,Node:31,ParentableMotionElement:32,Camera:33,PerspectiveCamera:34,OrthographicCamera:35,Light:36,DirectionalLight:37,PointLight:38,SpotLight:39,GlobalIllumination:40,Material:41,Texture:42,RenderableElement:43,Geometry:44,VertexGeoemtry:45,TriList:46,Group:47,Isolator:48,Dissolve:49,Transform:50,QuaternionRotate:51,Scale:52,Rotate:53,Translate:54,Model:55,Surface:56,MediaTexture:57,NullObject:58,Label:59,HTMLLabel:60,BalloonTipLabel:61,PathTrace:62,Directive:63,UpdateDirective:64,RenderDirective:65,RayPickDirective:66,BBoxDirective:67,SerializeDirective:68,Evaluator:1000,SceneInspector:1001,KeyframeInterpolator:1002,BBoxLocator:1003,ArcballInspector:1004,MapProjectionCalculator:1005,ObjectInspector:1006,Evaluator_End:1999,UserDefined:2000};var eAttrElemType={eAttrElemType_Unknown:0,eAttrElemType_Int:1,eAttrElemType_UnsignedInt:2,eAttrElemType_Char:3,eAttrElemType_UnsignedChar:4,eAttrElemType_Float:5,eAttrElemType_Double:6,eAttrElemType_Attribute:7,eAttrElemType_UserDefined:255,eAttrElemType_FORCE_DWORD:2147483647};function enumerateAttributeTypes(){var b=0;for(var a in eAttrType){if(eAttrType[a]==0){eAttrType[a]=b++}}}function enumerateAttributeElementTypes(){var b=0;for(var a in eAttrElemType){if(eAttrElemType[a]==0){eAttrElemType[a]=b++}}}var eAttrSetOp={Replace:0,Add:1,Subtract:2,Multiply:3,Divide:4,Append:5,AND:6,OR:7,XOR:8,NAND:9,NOR:10};function AttributeTargetDesc(d,c,a,e,b){this.target=d||null;this.sourceElementIndex=c||-1;this.targetElementIndex=a||-1;this.op=e||eAttrSetOp.Replace;this.converter=b||null}function AttributeSourceDesc(c,d,a,e,b){this.source=c||null;this.sourceElementIndex=d||-1;this.targetElementIndex=a||-1;this.op=e||eAttrSetOp.Replace;this.converter=b||null}function AttributeGetParams(b,a){this.elementIndex=b;this.valueElementIndex=a}function AttributeSetParams(d,c,e,b,a){this.elementIndex=d||-1;this.valueElementIndex=c||-1;this.op=e||eAttrSetOp.Replace;this.updateTargets=b!=undefined?b:true;this.alertModifiedCBs=a!=undefined?a:true}Attribute.prototype=new Base();Attribute.prototype.constructor=Attribute;function Attribute(){Base.call(this);this.className="Attribute";this.attrType=eAttrType.Attribute;this.attrElemType=eAttrElemType.eAttrElemType_Attribute;this.values=[];this.modifiedCBs=[];this.modifiedCBsData=[];this.targets=[];this.sources=[];this.container=null;this.registry=null}Attribute.prototype.destroy=function(){this.removeAllSources();this.removeAllTargets();Base.prototype.destroy.call(this)};Attribute.prototype.clone=function(){return null};Attribute.prototype.getValue=function(a,e){var d=(e?e.elementIndex:-1);if(d<0){if(this.values==null){a[0]=null}else{if(this.values.length==undefined){a[0]=this.values}else{for(var c=0;c<this.values.length;c++){a[c]=this.values[c]}}}}else{var b=Math.max(0,e?e.valueElementIndex:0);a[b]=this.values[d]}};Attribute.prototype.setValue=function(h,b){var a=(b?b.elementIndex:-1);var f=(b?b.op:eAttrSetOp.Replace);if(a<0){if(h==null){this.values[0]=null}else{if(h.length==undefined){switch(f){case eAttrSetOp.Add:this.values[0]+=h;break;case eAttrSetOp.Replace:this.values[0]=h;break;default:alert("unsupported operation passed to Attribute::setValue");break}}else{for(var d=0;d<h.length;d++){switch(f){case eAttrSetOp.Add:this.values[d]+=h[d];break;case eAttrSetOp.Replace:this.values[d]=h[d];break;default:alert("unsupported operation passed to Attribute::setValue");break}}}}}else{if(h==null){this.values[a]=null}else{if(h.length==undefined){this.values[a]=h}else{var e=Math.max(0,b?b.valueElementIndex:0);this.values[a]=h[e]}}}var c=(b?b.alertModifiedCBs:true);if(c){for(var d=0;d<this.modifiedCBs.length;d++){this.modifiedCBs[d](this,this.modifiedCBsData[d])}}var g=(b?b.updateTargets:true);if(g){for(var d=0;d<this.targets.length;d++){var j=this.targets[d];var b=new AttributeSetParams(j.targetElementIndex,j.sourceElementIndex,j.op,true,true);j.target.setValue(this.values,b)}}};Attribute.prototype.getElement=function(a){if(this.values.length>a){return this.values[a]}return undefined};Attribute.prototype.setElement=function(b,c,d,a){console.debug("TODO: "+arguments.callee.name)};Attribute.prototype.getLength=function(){if(this.values.length==undefined){return(this.values==undefined?0:1)}return this.values.length};Attribute.prototype.setLength=function(a){this.values.length=a};Attribute.prototype.addModifiedCB=function(b,a){this.modifiedCBs.push(b);this.modifiedCBsData.push(a)};Attribute.prototype.removeModifiedCB=function(b,a){this.modifiedCBs.splice(this.modifiedCBs.indexOf(b),1);this.modifiedCBsData.splice(this.modifiedCBsData.indexOf(a),1)};Attribute.prototype.addTarget=function(c,d,a,b){if(d==undefined){d=eAttrSetOp.Replace}if(a==undefined){a=null}if(b==undefined){b=true}this.addElementTarget(c,-1,-1,d,a,b)};Attribute.prototype.addSource=function(c,d,a,b){c.addTarget(this,d,a,b)};Attribute.prototype.removeTarget=function(a){this.removeElementTarget(a,-1,-1)};Attribute.prototype.removeSource=function(a){a.removeTarget(this)};Attribute.prototype.removeAllTargets=function(){while(this.targets.length>0){this.removeElementTarget(this.targets[0].target,this.targets[0].sourceElementIndex,this.targets[0].targetElementIndex)}};Attribute.prototype.removeAllSources=function(){while(this.sources.length>0){this.sources[0].source.removeElementTarget(this,this.sources[0].sourceElementIndex,this.sources[0].targetElementIndex)}};Attribute.prototype.addElementTarget=function(e,d,a,g,b,c){if(e){if(d==undefined){d=-1}if(a==undefined){a=-1}if(g==undefined){g=eAttrSetOp.Replace}if(b==undefined){b=null}if(c==undefined){c=true}this.createTarget(new AttributeTargetDesc(e,d,a,g,b));e.createSource(new AttributeSourceDesc(this,d,a,g,b));if(c){var f=new AttributeSetParams(a,d,g,true,true);e.setValue(this.values,f)}}};Attribute.prototype.addElementSource=function(d,e,a,f,b,c){d.addElementTarget(this,e,a,f,b,c)};Attribute.prototype.removeElementTarget=function(c,b,a){if(c){this.deleteTarget(new AttributeTargetDesc(c,b,a));c.deleteSource(new AttributeSourceDesc(this,b,a))}};Attribute.prototype.removeElementSource=function(b,c,a){b.removeElementTarget(this,c,a)};Attribute.prototype.createTarget=function(a){this.targets.push(a)};Attribute.prototype.createSource=function(a){this.sources.push(a)};Attribute.prototype.deleteTarget=function(a){for(var b=0;b<this.targets.length;b++){var c=this.targets[b];if(c.target==a.target&&c.sourceElementIndex==a.sourceElementIndex&&c.targetElementIndex==a.targetElementIndex){this.targets.splice(b,1);break}}};Attribute.prototype.deleteSource=function(b){for(var a=0;a<this.sources.length;a++){var c=this.sources[a];if(c.source==b.source&&c.sourceElementIndex==b.sourceElementIndex&&c.targetElementIndex==b.targetElementIndex){this.sources.splice(a,1);break}}};Attribute.prototype.copyValue=function(a,b){a.addTarget(this,b);a.removeTarget(this)};Attribute.prototype.isContainer=function(){return false};Attribute.prototype.isCollection=function(){return false};Attribute.prototype.isNode=function(){return false};Attribute.prototype.getContainer=function(){return this.container};Attribute.prototype.setContainer=function(a){this.container=a};Attribute.prototype.getRegistry=function(){return this.registry};Attribute.prototype.setRegistry=function(a){this.registry=a};Attribute.prototype.flagDeserializedFromXML=function(){this.deserialized=true;if(this.attrContainer){this.attrContainer.flagDeserializedFromXML()}};Attribute.prototype.isFlagDeserializedFromXML=function(){return this.deserialized};AttributeContainer.prototype=new Attribute();AttributeContainer.prototype.constructor=AttributeContainer;function AttributeContainer(){Attribute.call(this);this.className="AttributeContainer";this.attrType=eAttrType.AttributeContainer;this.attrNameMap=[];this.attrModifiedCountMap=[]}AttributeContainer.prototype.destroy=function(){for(var b in this.attrNameMap){var a=this.getAttribute(b);if(a.getContainer()==this){a.destroy()}}Attribute.prototype.destroy.call(this)};AttributeContainer.prototype.isContainer=function(){return true};AttributeContainer.prototype.registerAttribute=function(b,a){this.attrNameMap[a]=b;this.attrModifiedCountMap.push(new Pair(b,0));if(!b.getContainer()){b.setContainer(this)}b.addModifiedCB(AttributeContainer_AttributeModifiedCB,this);b.addModifiedCB(AttributeContainer_AttributeModifiedCounterCB,this)};AttributeContainer.prototype.unregisterAttribute=function(b){for(var a in this.attrNameMap){if(this.attrNameMap[a]==b){b.removeModifiedCB(AttributeContainer_AttributeModifiedCB,this);b.removeModifiedCB(AttributeContainer_AttributeModifiedCounterCB,this);delete this.attrNameMap[a];break}}};AttributeContainer.prototype.getAttribute=function(a){return this.attrNameMap[a]};AttributeContainer.prototype.getAttributeAt=function(a){var c=0;for(var b in this.attrNameMap){if(c==a){return this.attrNameMap[b]}c++}return null};AttributeContainer.prototype.getAttributeName=function(c){var b=0;for(var a in this.attrNameMap){if(this.attrNameMap[a]==c){return this.getAttributeNameAt(b)}b++}return null};AttributeContainer.prototype.getAttributeNameAt=function(a){var c=0;for(var b in this.attrNameMap){if(c==a){return b}c++}return null};AttributeContainer.prototype.getAttributeCount=function(){var b=0;for(var a in this.attrNameMap){b++}return b};AttributeContainer.prototype.getAttributeModificationCount=function(b){for(var a in this.attrModifiedCountMap){if(this.attrModifiedCountMap[a].first==b){return this.attrModifiedCountMap[a].second}}return undefined};AttributeContainer.prototype.incrementAttributeModificationCount=function(b){for(var a in this.attrModifiedCountMap){if(this.attrModifiedCountMap[a].first==b){this.attrModifiedCountMap[a].second++;break}}};AttributeContainer.prototype.addTarget=function(f,h,c,e){if(f){if(h==undefined){h=null}if(c==undefined){c=null}if(e==undefined){e=true}var d=Math.max(this.getAttributeCount(),f.getAttributeCount());if(d==0){return}var g=null;var a=null;for(var b=0;b<d;b++){g=this.getAttributeAt(b);a=f.getAttribute(this.getAttributeNameAt(b));if(!g||!a){continue}g.addTarget(a,h,c,e)}}};AttributeContainer.prototype.removeTarget=function(d){if(d){var c=Math.max(this.getAttributeCount(),d.getAttributeCount());if(c==0){return}var e=null;var a=null;for(var b=0;b<c;b++){e=this.getAttributeAt(b);a=d.getAttribute(this.getAttributeNameAt(b));if(!e||!a){continue}e.removeTarget(a)}}};AttributeContainer.prototype.synchronize=function(d,c){if(c==undefined){c=true}for(var b in d.attrNameMap){var a=this.getAttribute(b);if(!a){a=d.attrNameMap[b].clone();if(!a){continue}a.setContainer(this);this.registerAttribute(a,b)}if(a&&c){a.copyValue(d.attrNameMap[b])}}};function AttributeContainer_AttributeModifiedCB(c,a){for(var b=0;b<a.modifiedCBs.length;b++){a.modifiedCBs[b](a,a.modifiedCBsData[b])}}function AttributeContainer_AttributeModifiedCounterCB(b,a){a.incrementAttributeModificationCount(b)}AttributeRegistry.prototype=new AttributeContainer();AttributeRegistry.prototype.constructor=AttributeRegistry;function AttributeRegistry(){AttributeContainer.call(this);this.className="AttributeRegistry";this.attrType=eAttrType.AttributeRegistry;this.objectCount=0;this.typeRegistry=[];this.nameRegistry=[]}AttributeRegistry.prototype.registerByType=function(b,a){if(this.typeRegistry[a]==undefined){this.typeRegistry[a]=new Array()}this.typeRegistry[a].push(b);this.objectCount+=1};AttributeRegistry.prototype.registerByName=function(b,a){if(a.length==0){a="unnamed"}if(this.nameRegistry[a]==undefined){this.nameRegistry[a]=new Array()}this.nameRegistry[a].push(b);this.objectCount+=1};AttributeRegistry.prototype.register=function(b){this.registerByType(b,b.attrType);this.objectCount+=1;if(b.isContainer()){var a=b.getAttribute("name")||b.getAttribute("id");if(a){this.registerByName(b,a.getValueDirect().join(""));a.addModifiedCB(AttributeRegistry_AttributeContainerNameModifiedCB,this)}}};AttributeRegistry.prototype.unregisterByType=function(b,a){if(this.typeRegistry[a]){this.typeRegistry[a].splice(this.typeRegistry[a].indexOf(b),1)}this.objectCount-=1};AttributeRegistry.prototype.unregisterByName=function(b,a){this.objectCount-=1;if(a.length==0){a="unnamed"}if(this.nameRegistry[a]){this.nameRegistry[a].splice(this.nameRegistry[a].indexOf(b),1)}};AttributeRegistry.prototype.unregister=function(b){this.unregisterByType(b,b.attrType);this.objectCount-=1;if(b.isContainer()){var a=b.getAttribute("name")||b.getAttribute("id");if(a){this.unregisterByName(b,a.getValueDirect().join(""));a.removeModifiedCB(AttributeRegistry_AttributeContainerNameModifiedCB,this)}}};AttributeRegistry.prototype.getByType=function(e){switch(e){case eAttrType.Camera:var a=[];var g=this.getByType(eAttrType.PerspectiveCamera);if(g){for(var c=0;c<g.length;c++){a.push(g[c])}}var f=this.getByType(eAttrType.OrthographicCamera);if(f){for(var c=0;c<f.length;c++){a.push(f[c])}}return a;break;case eAttrType.Evaluator:var a=[];for(var d=eAttrType.Evaluator+1;d!=eAttrType.Evaluator_End;d++){var b=this.getByType(d);if(b){for(var c=0;c<b.length;c++){a.push(b[c])}}}return a;break;default:return this.typeRegistry[e];break}};AttributeRegistry.prototype.getByName=function(a){return this.nameRegistry[a]};AttributeRegistry.prototype.updateName=function(a,c){for(var d in this.nameRegistry){for(var b=0;b<this.nameRegistry[d].length;b++){if(this.nameRegistry[d][b]==a){this.nameRegistry[d].splice(b,1);this.registerByName(a,c);return}}}};AttributeRegistry.prototype.clear=function(){for(var a in this.typeRegistry){this.typeRegistry[a]=[]}this.typeRegistry=[];for(var a in this.nameRegistry){this.nameRegistry[a]=[]}this.nameRegistry=[];this.objectCount=0};AttributeRegistry.prototype.getObjectCount=function(){return this.typeRegistry.length};AttributeRegistry.prototype.getObject=function(b){var d=0;for(var c in this.typeRegistry){for(var a=0;a<this.typeRegistry[c].length;a++,d++){if(d==b){return this.typeRegistry[c][a]}}}return null};function AttributeRegistry_AttributeContainerNameModifiedCB(b,a){a.updateName(b.getContainer(),b.getValueDirect().join(""))}BooleanAttr.prototype=new Attribute();BooleanAttr.prototype.constructor=BooleanAttr;function BooleanAttr(a){Attribute.call(this);this.className="BooleanAttr";this.attrType=eAttrType.BooleanAttr;this.setValue(a||false)}BooleanAttr.prototype.clone=function(){var a=new BooleanAttr();a.setValue(this.values);return a};BooleanAttr.prototype.getValueDirect=function(){var a=[];this.getValue(a);return a[0]};BooleanAttr.prototype.setValueDirect=function(b,c){var a=[b];this.setValue(b,c)};ColorAttr.prototype=new Attribute();ColorAttr.prototype.constructor=ColorAttr;function ColorAttr(h,f,c,d){Attribute.call(this);this.className="ColorAttr";this.attrType=eAttrType.ColorAttr;var e=[h||0,f||0,c||0,d||0];this.setValue(e)}ColorAttr.prototype.clone=function(){var a=new ColorAttr();a.setValue(this.values);return a};ColorAttr.prototype.getValueDirect=function(){var a=[];this.getValue(a);return{r:a[0],g:a[1],b:a[2],a:a[3]}};ColorAttr.prototype.setValueDirect=function(h,f,c,d,j){var e=[h,f,c,d];this.setValue(e,j)};Matrix4x4Attr.prototype=new Attribute();Matrix4x4Attr.prototype.constructor=Matrix4x4Attr;function Matrix4x4Attr(l,k,h,f,c,b,a,r,p,o,n,m,j,g,e,d){Attribute.call(this);this.className="Matrix4x4Attr";this.attrType=eAttrType.Matrix4x4Attr;var q=[l||1,k||0,h||0,f||0,c||0,b||1,a||0,r||0,p||0,o||0,n||1,m||0,j||0,g||0,e||0,d||1];this.setValue(q)}Matrix4x4Attr.prototype.clone=function(){var a=new Matrix4x4Attr();a.setValue(this.values);return a};Matrix4x4Attr.prototype.getValueDirect=function(){var b=[];this.getValue(b);var a=new Matrix4x4();a.loadArray(b);return a};Matrix4x4Attr.prototype.setValueDirect=function(b,c){var a=[b._11,b._12,b._13,b._14,b._21,b._22,b._23,b._24,b._31,b._32,b._33,b._34,b._41,b._42,b._43,b._44];this.setValue(a,c)};NumberArrayAttr.prototype=new Attribute();NumberArrayAttr.prototype.constructor=NumberArrayAttr;function NumberArrayAttr(){Attribute.call(this);this.className="NumberArrayAttr";this.attrType=eAttrType.NumberArrayAttr}NumberArrayAttr.prototype.clone=function(){var a=new NumberArrayAttr();a.setValue(this.values);return a};NumberArrayAttr.prototype.getValueDirect=function(){var a=[];this.getValue(a);return a};NumberArrayAttr.prototype.setValueDirect=function(a,b){this.setValue(a,b)};NumberAttr.prototype=new Attribute();NumberAttr.prototype.constructor=NumberAttr;function NumberAttr(a){Attribute.call(this);this.className="NumberAttr";this.attrType=eAttrType.NumberAttr;this.setValue(a||0)}NumberAttr.prototype.clone=function(){var a=new NumberAttr();a.setValue(this.values);return a};NumberAttr.prototype.getValueDirect=function(){var a=[];this.getValue(a);return a[0]};NumberAttr.prototype.setValueDirect=function(b,c){var a=[b];this.setValue(a,c)};PulseAttr.prototype=new BooleanAttr();PulseAttr.prototype.constructor=PulseAttr;function PulseAttr(){BooleanAttr.call(this);this.className="PulseAttr";this.attrType=eAttrType.PulseAttr}PulseAttr.prototype.clone=function(){var a=new PulseAttr();a.setValue(this.values);return a};PulseAttr.prototype.pulse=function(){this.setValueDirect(true);this.setValueDirect(false)};QuaternionAttr.prototype=new Attribute();QuaternionAttr.prototype.constructor=QuaternionAttr;function QuaternionAttr(b,a,e,d){Attribute.call(this);this.className="QuaternionAttr";this.attrType=eAttrType.QuaternionAttr;var c=[b||1,a||0,e||0,d||0];this.setValue(c)}QuaternionAttr.prototype.clone=function(){var a=new QuaternionAttr();a.setValue(this.values);return a};QuaternionAttr.prototype.getValueDirect=function(){var b=[];this.getValue(b);var a=new Quaternion();a.loadArray(b);return a};QuaternionAttr.prototype.setValueDirect=function(b,c){var a=[b.w,b.x,b.y,b.z];this.setValue(a,c)};ReferenceAttr.prototype=new Attribute();ReferenceAttr.prototype.constructor=ReferenceAttr;function ReferenceAttr(a){Attribute.call(this);this.className="ReferenceAttr";this.attrType=eAttrType.ReferenceAttr;this.setValue(a||null)}ReferenceAttr.prototype.clone=function(){var a=new ReferenceAttr();a.setValue(this.values);return a};ReferenceAttr.prototype.getValueDirect=function(){var a=[];this.getValue(a);return a[0]};ReferenceAttr.prototype.setValueDirect=function(b,c){var a=[b];this.setValue(b,c)};StringAttr.prototype=new Attribute();StringAttr.prototype.constructor=StringAttr;function StringAttr(a){Attribute.call(this);this.className="StringAttr";this.attrType=eAttrType.StringAttr;this.setValue(a||"")}StringAttr.prototype.clone=function(){var a=new StringAttr();a.setValue(this.values);return a};StringAttr.prototype.getValueDirect=function(){var a=[];this.getValue(a);return a};StringAttr.prototype.setValueDirect=function(a,b){this.setValue(a,b)};StringAttr.prototype.setValue=function(a,b){this.values=[];Attribute.prototype.setValue.call(this,a,b)};TernaryAttr.prototype=new NumberAttr();TernaryAttr.prototype.constructor=TernaryAttr;function TernaryAttr(a){NumberAttr.call(this,a);this.className="TernaryAttr";this.attrType=eAttrType.TernaryAttr}TernaryAttr.prototype.clone=function(){var a=new TernaryAttr();a.setValue(this.values);return a};Vector2DAttr.prototype=new Attribute();Vector2DAttr.prototype.constructor=Vector2DAttr;function Vector2DAttr(a,c){Attribute.call(this);this.className="Vector2DAttr";this.attrType=eAttrType.Vector2DAttr;var b=[a||0,c||0];this.setValue(b)}Vector2DAttr.prototype.clone=function(){var a=new Vector2DAttr();a.setValue(this.values);return a};Vector2DAttr.prototype.getValueDirect=function(){var a=[];this.getValue(a);return{x:a[0],y:a[1]}};Vector2DAttr.prototype.setValueDirect=function(a,d,c){var b=[a,d];this.setValue(b,c)};Vector3DAttr.prototype=new Attribute();Vector3DAttr.prototype.constructor=Vector3DAttr;function Vector3DAttr(a,d,c){Attribute.call(this);this.className="Vector3DAttr";this.attrType=eAttrType.Vector3DAttr;var b=[a||0,d||0,c||0];this.setValue(b)}Vector3DAttr.prototype.clone=function(){var a=new Vector3DAttr();a.setValue(this.values);return a};Vector3DAttr.prototype.getValueDirect=function(){var a=[];this.getValue(a);return{x:a[0],y:a[1],z:a[2]}};Vector3DAttr.prototype.setValueDirect=function(a,e,d,c){var b=[a,e,d];this.setValue(b,c)};ViewportAttr.prototype=new Attribute();ViewportAttr.prototype.constructor=ViewportAttr;function ViewportAttr(b,e,d,a){Attribute.call(this);this.className="ViewportAttr";this.attrType=eAttrType.ViewportAttr;var c=[b||0,e||0,d||0,a||0];this.setValue(c)}ViewportAttr.prototype.clone=function(){var a=new ViewportAttr();a.setValue(this.values);return a};ViewportAttr.prototype.getValueDirect=function(){var a=[];this.getValue(a);return{x:a[0],y:a[1],width:a[2],height:a[3]}};ViewportAttr.prototype.setValueDirect=function(b,f,d,a,e){var c=[b,f,d,a];this.setValue(c,e)};AttributeVector.prototype=new AttributeContainer();AttributeVector.prototype.constructor=AttributeVector;function AttributeVector(a){AttributeContainer.call(this);this.className="AttributeVector";this.attrType=eAttrType.AttributeVector;this.vector=[];this.allocator=a;this.size=new NumberAttr(0);this.baseName=new StringAttr("item");this.appendParsedElements=new BooleanAttr(false);this.elementModified=new PulseAttr();this.size.addModifiedCB(AttributeVector_SizeModifiedCB,this);this.baseName.addModifiedCB(AttributeVector_BaseNameModifiedCB,this);this.registerAttribute(this.size,"size");this.registerAttribute(this.baseName,"baseName");this.registerAttribute(this.appendParsedElements,"appendParsedElements");this.registerAttribute(this.elementModified,"elementModified")}AttributeVector.prototype.allocatesElements=function(){return(this.allocator?true:false)};AttributeVector.prototype.push_back=function(a){this.addElement(this.vector.length,a);this.size.setValueDirect(this.vector.length)};AttributeVector.prototype.resize=function(a){this.size.setValueDirect(a)};AttributeVector.prototype.clear=function(){this.resize(0)};AttributeVector.prototype.getAt=function(a){if(this.vector.length>a){return this.vector[a]}return null};AttributeVector.prototype.setAt=function(a,b){if(this.vector.length>a){this.vector[a]=b}};AttributeVector.prototype.prev=function(b){for(var a=0;a<this.vector.length;a++){if(this.vector[a]==b){if(a>0){return this.vector[a-1]}break}}return null};AttributeVector.prototype.next=function(b){for(var a=0;a<this.vector.length;a++){if(this.vector[a]==b){if(a<(this.vector.length-1)){return this.vector[a+1]}break}}return null};AttributeVector.prototype.addElement=function(a,b){this.vector.splice(a,0,b)};AttributeVector.prototype.removeElement=function(a){this.vector.splice(a,1)};AttributeVector.prototype.Size=function(){return this.size.getValueDirect()};AttributeVector.prototype.AppendParsedElements=function(){return this.appendParsedElements.getValueDirect()};AttributeVector.prototype.setElementName=function(b,a){this.unregisterAttribute(b);this.registerAttribute(b,a);console.debug("TODO: add to element name map")};AttributeVector.prototype.synchronize=function(c,b){AttributeContainer.prototype.synchronize.call(this,c,b);this.clear();for(var a=0;a<c.vector.length;a++){this.push_back(c.vector[a])}};AttributeVector.prototype.isCollection=function(){return true};AttributeVector.prototype.sizeModified=function(){var c=this.vector.length;var d=this.size.getValueDirect();var e,a;if(d>c){e=c;a=e+(d-c);for(var b=e;b<a;b++){this.addElement(b,this.allocator?this.allocator.allocate():null)}}else{if(d<c){e=c;a=e-(c-d);for(var b=e-1;b>=a;b--){this.removeElement(b)}}}};function AttributeVector_SizeModifiedCB(b,a){a.sizeModified()}function AttributeVector_BaseNameModifiedCB(b,a){}StyleAttr.prototype=new AttributeContainer();StyleAttr.prototype.constructor=StyleAttr;function StyleAttr(){AttributeContainer.call(this);this.className="StyleAttr";this.attrType=eAttrType.StyleAttr;this.setOp=new NumberAttr(eAttrSetOp.Replace);this.styleUrl=new StringAttr();this.styleUrl.addModifiedCB(StyleAttr_StyleUrlModifiedCB,this);this.registerAttribute(this.setOp,"setOp");this.registerAttribute(this.styleUrl,"styleUrl")}StyleAttr.prototype.updateStyle=function(a){};StyleAttr.prototype.styleUrlModified=function(){var a=this.styleUrl.getValueDirect().join("");if(this.registry){this.updateStyle(this.registry.find(a))}};function StyleAttr_StyleUrlModifiedCB(b,a){a.styleUrlModified()}StylesAttr.prototype=new AttributeVector();StylesAttr.prototype.constructor=StylesAttr;function StylesAttr(){AttributeVector.call(this);this.className="StylesAttr";this.attrType=eAttrType.StylesAttr;this.registeredCBs=[];this.registeredCBsData=[];this.enabled=new BooleanAttr(true);this.registerAttribute(this.enabled,"enabled")}StylesAttr.prototype.updateStyle=function(d){var b=this.enabled.getValueDirect();if(!b){return}for(var c=0;c<d.Size();c++){for(var a=0;a<this.Size();a++){if(this.vector[a].attrType==d.vector[c].attrType){this.vector[a].updateStyle(d.vector[c]);break}}}};StylesAttr.prototype.registerStyle=function(b,a){this.push_back(b);this.setElementName(b,a);this.alertRegisteredCBs(b,true)};StylesAttr.prototype.unregisterStyle=function(b){for(var a in this.vector){if(this.vector[a]==b){this.alertRegisteredCBs(b,false);delete this.vector[a];break}}};StylesAttr.prototype.addRegisteredCB=function(b,a){this.registeredCBs.push(b);this.registeredCBsData.push(a)};StylesAttr.prototype.alertRegisteredCBs=function(b,c){for(var a=0;a<this.registeredCBs.length;a++){this.registeredCBs[a](b,this.registeredCBs[a])}};StylesAttr.prototype.push_back=function(a){AttributeVector.prototype.push_back.call(this,a);this.alertRegisteredCBs(a,true)};StylesAttr.prototype.getStyle=function(b){for(var a=0;a<this.Size();a++){if(this.vector[a].attrType==b){return this.vector[a]}}return undefined};StyleMapAttr.prototype=new AttributeContainer();StyleMapAttr.prototype.constructor=StyleMapAttr;function StyleMapAttr(){AttributeContainer.call(this);this.className="StyleMapAttr";this.attrType=eAttrType.StyleMapAttr;this.eventType=eEventType.Unknown;this.targetContainer=null;this.event=new StringAttr();this.styles=new StylesAttr();this.styleUrl=new StringAttr();this.target=new StringAttr();this.event.addModifiedCB(StyleMapAttr_EventModifiedCB,this);this.styleUrl.addModifiedCB(StyleMapAttr_styleUrlModifiedCB,this);this.target.addModifiedCB(StyleMapAttr_TargetModifiedCB,this);this.registerAttribute(this.event,"event");this.registerAttribute(this.styleUrl,"styleUrl");this.registerAttribute(this.target,"target")}StyleMapAttr.prototype.getStyles=function(a){var b=null;var c=null;if(this.eventType==a){b=this.styles;c=this.targetContainer}return{styles:b,target:c}};StyleMapAttr.prototype.setStyles=function(a){this.styles=a};StyleMapAttr.prototype.setTargetContainer=function(a){this.targetContainer=a};StyleMapAttr.prototype.eventModified=function(){var a=this.event.getValueDirect().join("");this.eventType=eEventNameMap[a]};StyleMapAttr.prototype.styleUrlModified=function(){var a=this.styleUrl.getValueDirect();if(a[0]=="#"){a.splice(0,1)}a=a.join("");var b=this.registry.find(a);if(b){this.styles=b}};StyleMapAttr.prototype.targetModified=function(){var a=this.target.getValueDirect().join("");this.targetContainer=this.registry.find(a)};function StyleMapAttr_EventModifiedCB(b,a){a.eventModified()}function StyleMapAttr_styleUrlModifiedCB(b,a){a.styleUrlModified()}function StyleMapAttr_TargetModifiedCB(b,a){a.targetModified()}StyleMapAttrAllocator.prototype=new Allocator();StyleMapAttrAllocator.prototype.constructor=StyleMapAttrAllocator;function StyleMapAttrAllocator(){}StyleMapAttrAllocator.prototype.allocate=function(){return new StyleMapAttr()};StylesMapAttr.prototype=new AttributeVector();StylesMapAttr.prototype.constructor=StylesMapAttr;function StylesMapAttr(){AttributeVector.call(this,new StyleMapAttrAllocator());this.className="StylesMapAttr";this.attrType=eAttrType.StylesMapAttr;this.stylesEnabledMap=[];this.size.addModifiedCB(StylesMapAttr_SizeModifiedCB,this);this.appendParsedElements.setValueDirect(true)}StylesMapAttr.prototype.getStyles=function(d){var e=null;var b=false;var f=null;for(var c=0;c<this.Size();c++){var a=this.vector[c].getStyles(d);if(a.styles){e=a.styles;f=a.target;if(this.stylesEnabledMap[a.styles]){b=this.stylesEnabledMap[a.styles]}}}return{styles:e,target:f,enabled:b}};StylesMapAttr.prototype.StylesMapAttr_SizeModified=function(){for(var a=0;a<this.Size();a++){if(!(this.vector[a].registry)){this.vector[a].setRegistry(this.registry)}if(!(this.stylesEnabledMap[this.vector[a].styles])){this.stylesEnabledMap[this.vector[a].styles]=new BooleanAttr(true)}}};function StylesMapAttr_SizeModifiedCB(b,a){a.StylesMapAttr_SizeModified()}KeyframeAttr.prototype=new AttributeContainer();KeyframeAttr.prototype.constructor=KeyframeAttr;function KeyframeAttr(){AttributeContainer.call(this);this.className="KeyframeAttr";this.attrType=eAttrType.KeyframeAttr;this.time=new NumberAttr();this.value=new NumberAttr();this.shape=new NumberAttr();this.params=new AttributeVector();for(var a=0;a<6;a++){this.params.push_back(new NumberAttr(0))}this.registerAttribute(this.time,"time");this.registerAttribute(this.value,"value");this.registerAttribute(this.shape,"shape");this.registerAttribute(this.params,"params");this.getTime=function(){return this.time.getValueDirect()};this.getValue=function(){return this.value.getValueDirect()};this.getShape=function(){return this.shape.getValueDirect()};this.getParams=function(b){return this.params.getAt(b).getValueDirect()}}KeyframesAttr.prototype=new AttributeVector();KeyframesAttr.prototype.constructor=KeyframesAttr;function KeyframesAttr(){AttributeVector.call(this);this.className="KeyframesAttr";this.attrType=eAttrType.KeyframesAttr}BBoxAttr.prototype=new AttributeContainer();BBoxAttr.prototype.constructor=BBoxAttr;function BBoxAttr(){AttributeContainer.call(this);this.className="BBoxAttr";this.attrType=eAttrType.BBoxAttr;this.min=new Vector3DAttr();this.max=new Vector3DAttr();this.registerAttribute(this.min,"min");this.registerAttribute(this.max,"max")}BBoxAttr.prototype.setValueDirect=function(b,a){this.min.setValueDirect(b.x,b.y,b.z);this.max.setValueDirect(a.x,a.y,a.z)};ImageAttr.prototype=new AttributeContainer();ImageAttr.prototype.constructor=ImageAttr;function ImageAttr(){AttributeContainer.call(this);this.className="ImageAttr";this.attrType=eAttrType.ImageAttr;this.width=new NumberAttr(0);this.height=new NumberAttr(0);this.byteAlignment=new NumberAttr(0);this.pixelFormat=new NumberAttr(ePixelFormat.Unknown);this.pixels=new NumberArrayAttr();this.registerAttribute(this.width,"width");this.registerAttribute(this.height,"height");this.registerAttribute(this.byteAlignment,"byteAlignment");this.registerAttribute(this.pixelFormat,"pixelFormat");this.registerAttribute(this.pixels,"pixels")}RectAttr.prototype=new AttributeContainer();RectAttr.prototype.constructor=RectAttr;function RectAttr(){AttributeContainer.call(this);this.className="RectAttr";this.attrType=eAttrType.RectAttr;this.left=new NumberAttr(0);this.top=new NumberAttr(0);this.right=new NumberAttr(0);this.bottom=new NumberAttr(0);this.registerAttribute(this.left,"left");this.registerAttribute(this.top,"top");this.registerAttribute(this.right,"right");this.registerAttribute(this.bottom,"bottom")}RectAttr.prototype.getValueDirect=function(){var a=new Rect();a.left=this.left.getValueDirect();a.top=this.top.getValueDirect();a.right=this.right.getValueDirect();a.bottom=this.bottom.getValueDirect();return a};RectAttr.prototype.setValueDirect=function(a){this.left.setValueDirect(a.left);this.top.setValueDirect(a.top);this.right.setValueDirect(a.right);this.bottom.setValueDirect(a.bottom)};RectAttr.prototype.containsPoint=function(a,b){if(a>=this.left.getValueDirect()&&b>=this.top.getValueDirect()&&a<=this.right.getValueDirect()&&b<=this.bottom.getValueDirect()){return true}return false};FontStyleAttr.prototype=new StyleAttr();FontStyleAttr.prototype.constructor=FontStyleAttr;function FontStyleAttr(){StyleAttr.call(this);this.className="FontStyleAttr";this.attrType=eAttrType.FontStyleAttr;this.antialiasType=new NumberAttr(eImageAntialiasOp.EightPass);this.borderColor=new ColorAttr(0,0,0,1);this.borderWidth=new NumberAttr(2);this.color=new ColorAttr(1,1,1,1);this.effects=new StringAttr();this.font=new StringAttr("Arial");this.opacity=new NumberAttr(1);this.size=new NumberAttr(18);this.style=new StringAttr("Bold");this.registerAttribute(this.antialiasType,"antialiasType");this.registerAttribute(this.borderColor,"borderColor");this.registerAttribute(this.borderWidth,"borderWidth");this.registerAttribute(this.color,"color");this.registerAttribute(this.effects,"effects");this.registerAttribute(this.font,"font");this.registerAttribute(this.opacity,"opacity");this.registerAttribute(this.size,"size");this.registerAttribute(this.style,"style")}FontStyleAttr.prototype.updateStyle=function(b){var a=b.setOp.getValueDirect();if(b.getAttributeModificationCount(b.antialiasType)){this.antialiasType.copyValue(b.antialiasType,a)}if(b.getAttributeModificationCount(b.borderColor)){this.borderColor.copyValue(b.borderColor,a)}if(b.getAttributeModificationCount(b.borderWidth)){this.borderWidth.copyValue(b.borderWidth,a)}if(b.getAttributeModificationCount(b.color)){this.color.copyValue(b.color,a)}if(b.getAttributeModificationCount(b.effects)){this.effects.copyValue(b.effects,a)}if(b.getAttributeModificationCount(b.font)){this.font.copyValue(b.font,a)}if(b.getAttributeModificationCount(b.opacity)){this.opacity.copyValue(b.opacity,a)}if(b.getAttributeModificationCount(b.size)){this.size.copyValue(b.size,a)}if(b.getAttributeModificationCount(b.style)){this.style.copyValue(b.style,a)}};LabelStyleAttr.prototype=new StyleAttr();LabelStyleAttr.prototype.constructor=LabelStyleAttr;function LabelStyleAttr(){StyleAttr.call(this);this.className="LabelStyleAttr";this.attrType=eAttrType.LabelStyleAttr;this.angle=new NumberAttr(0);this.backgroundColor=new ColorAttr(0,0,0,1);this.backgroundOpacity=new NumberAttr(0);this.fontStyle=new FontStyleAttr();this.format=new StringAttr("left");this.height=new NumberAttr(0);this.offset=new Vector2DAttr(0,0);this.padding=new NumberAttr(0);this.scale=new Vector3DAttr(1,1,1);this.textAlign=new StringAttr("middleRight");this.width=new NumberAttr(0);this.registerAttribute(this.angle,"angle");this.registerAttribute(this.backgroundColor,"backgroundColor");this.registerAttribute(this.backgroundOpacity,"backgroundOpacity");this.registerAttribute(this.fontStyle,"fontStyle");this.registerAttribute(this.format,"format");this.registerAttribute(this.height,"height");this.registerAttribute(this.offset,"offset");this.registerAttribute(this.padding,"padding");this.registerAttribute(this.scale,"scale");this.registerAttribute(this.textAlign,"textAlign");this.registerAttribute(this.width,"width")}LabelStyleAttr.prototype.updateStyle=function(b){var a=b.setOp.getValueDirect();if(b.getAttributeModificationCount(b.angle)){this.angle.copyValue(b.angle,a)}if(b.getAttributeModificationCount(b.backgroundColor)){this.backgroundColor.copyValue(b.backgroundColor,a)}if(b.getAttributeModificationCount(b.backgroundOpacity)){this.backgroundOpacity.copyValue(b.backgroundOpacity,a)}this.fontStyle.updateStyle(b.fontStyle);if(b.getAttributeModificationCount(b.format)){this.format.copyValue(b.format,a)}if(b.getAttributeModificationCount(b.height)){this.height.copyValue(b.height,a)}if(b.getAttributeModificationCount(b.offset)){this.offset.copyValue(b.offset,a)}if(b.getAttributeModificationCount(b.padding)){this.padding.copyValue(b.padding,a)}if(b.getAttributeModificationCount(b.scale)){this.scale.copyValue(b.scale,a)}if(b.getAttributeModificationCount(b.textAlign)){this.textAlign.copyValue(b.textAlign,a)}if(b.getAttributeModificationCount(b.width)){this.width.copyValue(b.width,a)}};IconStyleAttr.prototype=new StyleAttr();IconStyleAttr.prototype.constructor=IconStyleAttr;function IconStyleAttr(){StyleAttr.call(this);this.className="IconStyleAttr";this.attrType=eAttrType.IconStyleAttr;this.alphaUrl=new StringAttr("");this.color=new ColorAttr(1,1,1,1);this.opacity=new NumberAttr(1);this.scale=new Vector3DAttr(1,1,1);this.url=new StringAttr("");this.registerAttribute(this.alphaUrl,"alphaUrl");this.registerAttribute(this.color,"color");this.registerAttribute(this.opacity,"opacity");this.registerAttribute(this.scale,"scale");this.registerAttribute(this.url,"url")}IconStyleAttr.prototype.updateStyle=function(b){var a=b.setOp.getValueDirect();if(b.getAttributeModificationCount(b.alphaUrl)){this.alphaUrl.copyValue(b.alphaUrl,a)}if(b.getAttributeModificationCount(b.color)){this.color.copyValue(b.color,a)}if(b.getAttributeModificationCount(b.opacity)){this.opacity.copyValue(b.opacity,a)}if(b.getAttributeModificationCount(b.scale)){this.scale.copyValue(b.scale,a)}if(b.getAttributeModificationCount(b.url)){this.url.copyValue(b.url,a)}};HTMLLabelStyleAttr.prototype=new StyleAttr();HTMLLabelStyleAttr.prototype.constructor=HTMLLabelStyleAttr;function HTMLLabelStyleAttr(){StyleAttr.call(this);this.className="HTMLLabelStyleAttr";this.attrType=eAttrType.HTMLLabelStyleAttr;this.height=new NumberAttr(0);this.width=new NumberAttr(0);this.registerAttribute(this.height,"height");this.registerAttribute(this.width,"width")}BalloonTipLabelStyleAttr.prototype=new StyleAttr();BalloonTipLabelStyleAttr.prototype.constructor=BalloonTipLabelStyleAttr;function BalloonTipLabelStyleAttr(){StyleAttr.call(this);this.className="BalloonTipLabelStyleAttr";this.attrType=eAttrType.BalloonTipLabelStyleAttr;this.balloonOffset=new NumberAttr(100);this.bgColor=new ColorAttr(1,1,1,1);this.displayMode=new StringAttr("default");this.htmlLabelStyle=new HTMLLabelStyleAttr();this.text=new StringAttr();this.textColor=new ColorAttr(0,0,0,1);this.registerAttribute(this.balloonOffset,"balloonOffset");this.registerAttribute(this.bgColor,"bgColor");this.registerAttribute(this.displayMode,"displayMode");this.registerAttribute(this.htmlLabelStyle,"htmlLabelStyle");this.registerAttribute(this.text,"text");this.registerAttribute(this.textColor,"textColor")}BalloonTipLabelStyleAttr.prototype.updateStyle=function(b){var a=b.setOp.getValueDirect();if(b.getAttributeModificationCount(b.balloonOffset)){this.balloonOffset.copyValue(b.balloonOffset,a)}if(b.getAttributeModificationCount(b.bgColor)){this.bgColor.copyValue(b.bgColor,a)}if(b.getAttributeModificationCount(b.displayMode)){this.displayMode.copyValue(b.displayMode,a)}this.htmlLabelStyle.updateStyle(b.htmlLabelStyle);if(b.getAttributeModificationCount(b.text)){this.text.copyValue(b.text,a)}if(b.getAttributeModificationCount(b.textColor)){this.textColor.copyValue(b.textColor,a)}};RenderableElementStyleAttr.prototype=new StyleAttr();RenderableElementStyleAttr.prototype.constructor=RenderableElementStyleAttr;function RenderableElementStyleAttr(){StyleAttr.call(this);this.className="RenderableElementStyleAttr";this.attrType=eAttrType.RenderableElementStyleAttr;this.hasFocus=new TernaryAttr(0);this.selected=new TernaryAttr(0);this.registerAttribute(this.hasFocus,"hasFocus");this.registerAttribute(this.selected,"selected")}RenderableElementStyleAttr.prototype.updateStyle=function(b){var a=b.setOp.getValueDirect();if(b.getAttributeModificationCount(b.hasFocus)){this.hasFocus.copyValue(b.hasFocus,a)}if(b.getAttributeModificationCount(b.selected)){this.selected.copyValue(b.selected,a)}};PlaneAttr.prototype=new AttributeContainer();PlaneAttr.prototype.constructor=PlaneAttr;function PlaneAttr(){AttributeContainer.call(this);this.className="PlaneAttr";this.attrType=eAttrType.PlaneAttr;this.point=new Vector3DAttr(0,0,0);this.normal=new Vector3DAttr(0,0,1);this.dot=new NumberAttr(0);this.registerAttribute(this.point,"point");this.registerAttribute(this.normal,"normal");this.registerAttribute(this.dot,"dot")}PlaneAttr.prototype.getValueDirect=function(){var a=this.point.getValueDirect();var c=this.normal.getValueDirect();var b=new Plane(new Vector3D(a.x,a.y,a.z),new Vector3D(c.x,c.y,c.z));return b};PlaneAttr.prototype.setValueDirect=function(a){this.point.setValueDirect(a.point.x,a.point.y,a.point.z);this.normal.setValueDirect(a.normal.x,a.normal.y,a.normal.z);this.dot.setValueDirect(a.dot)};ViewVolumeAttr.prototype=new AttributeContainer();ViewVolumeAttr.prototype.constructor=ViewVolumeAttr;function ViewVolumeAttr(){AttributeContainer.call(this);this.className="ViewVolumeAttr";this.attrType=eAttrType.ViewVolumeAttr;this.left=new PlaneAttr();this.right=new PlaneAttr();this.top=new PlaneAttr();this.bottom=new PlaneAttr();this.near=new PlaneAttr();this.far=new PlaneAttr();this.registerAttribute(this.left,"left");this.registerAttribute(this.right,"right");this.registerAttribute(this.top,"top");this.registerAttribute(this.bottom,"bottom");this.registerAttribute(this.near,"near");this.registerAttribute(this.far,"far")}ViewVolumeAttr.prototype.setValueDirect=function(f,c,e,b,d,a){this.left.setValueDirect(f);this.right.setValueDirect(c);this.top.setValueDirect(e);this.bottom.setValueDirect(b);this.near.setValueDirect(d);this.far.setValueDirect(a)};function setAttributeValue(b,c){switch(b.attrType){case eAttrType.BooleanAttr:if(c=="false"||c=="0"){b.setValueDirect(false)}else{b.setValueDirect(true)}break;case eAttrType.ColorAttr:case eAttrType.Matrix4x4Attr:case eAttrType.NumberArrayAttr:case eAttrType.Vector2DAttr:case eAttrType.Vector3DAttr:case eAttrType.ViewportAttr:for(var a=0;a<c.length;a++){c[a]=parseFloat(c[a])}b.setValue(c);break;case eAttrType.NumberAttr:b.setValueDirect(parseFloat(c));break;default:b.setValue(c);break}}Agent.prototype=new AttributeContainer();Agent.prototype.constructor=Agent;function Agent(){AttributeContainer.call(this);this.className="Agent";this.running=false;this.name=new StringAttr("");this.enabled=new BooleanAttr(true);this.registerAttribute(this.name,"name");this.registerAttribute(this.enabled,"enabled")}Agent.prototype.start=function(){this.running=true};Agent.prototype.stop=function(){this.running=false};Agent.prototype.pause=function(){this.running=false};function RayIntersectRecord(){this.distance=Infinity;this.pointModel=new Vector3D();this.pointWorld=new Vector3D();this.pointView=new Vector3D();this.triIndex=0}function RayIntersectParams(e,b,j,a,f,d,c,g,h){this.rayOrigin=e||new Vector3D();this.rayDir=b||new Vector3D();this.nearDistance=j||0;this.farDistance=a||0;this.worldMatrix=f||new Matrix4x4();this.viewMatrix=d||new Matrix4x4();this.worldViewMatrix=this.worldMatrix.multiply(this.viewMatrix);this.scale=c||0;this.doubleSided=g||false;this.clipPlanes=h||new Array();this.intersects=false;this.intersectRecord=new RayIntersectRecord()}function Triangle(c,j,f,b,h,e,a,g,d){this.v0=new Vector3D(c,j,f);this.v1=new Vector3D(b,h,e);this.v2=new Vector3D(a,g,d)}function Sphere(){this.center=new Vector3D();this.radius=0;this.xcenter=new Vector3D()}function Region(a,f,e,d,c,b){this.min=new Vector3D(a,f,e);this.max=new Vector3D(d,c,b);this.xpos=new Plane();this.xneg=new Plane();this.ypos=new Plane();this.yneg=new Plane();this.zpos=new Plane();this.zneg=new Plane();this.xpos_ypos_zpos=new Plane();this.xpos_ypos_zneg=new Plane();this.xpos_yneg_zpos=new Plane();this.xpos_yneg_zneg=new Plane();this.xneg_ypos_zpos=new Plane();this.xneg_ypos_zneg=new Plane();this.xneg_yneg_zpos=new Plane();this.xneg_yneg_zneg=new Plane();this.setPlanes()}Region.prototype.setPlanes=function(){this.xpos=new Plane(this.max,new Vector3D(1,0,0));this.xneg=new Plane(this.min,new Vector3D(-1,0,0));this.ypos=new Plane(this.max,new Vector3D(0,1,0));this.yneg=new Plane(this.min,new Vector3D(0,-1,0));this.zpos=new Plane(this.max,new Vector3D(0,0,1));this.zneg=new Plane(this.min,new Vector3D(0,0,-1));var h=new Vector3D(this.max.x,this.max.y,this.max.z);var b=new Vector3D(this.max.x,this.max.y,this.min.z);var d=new Vector3D(this.max.x,this.min.y,this.max.z);var f=new Vector3D(this.max.x,this.min.y,this.min.z);var e=new Vector3D(this.min.x,this.max.y,this.max.z);var g=new Vector3D(this.min.x,this.max.y,this.min.z);var a=new Vector3D(this.min.x,this.min.y,this.max.z);var c=new Vector3D(this.min.x,this.min.y,this.min.z);this.xpos_ypos_zpos=new Plane(h,h-c);this.xpos_ypos_zneg=new Plane(b,b-a);this.xpos_yneg_zpos=new Plane(d,d-g);this.xpos_yneg_zneg=new Plane(f,f-e);this.xneg_ypos_zpos=new Plane(e,e-f);this.xneg_ypos_zneg=new Plane(g,g-d);this.xneg_yneg_zpos=new Plane(a,a-b);this.xneg_yneg_zneg=new Plane(c,c-h)};Region.prototype.containsGeometry=function(c,d){var a=[];for(var b=0;b<d.length;b++){if(this.containsTriangle(c[d[b]])){a.push(d[b])}}return a};Region.prototype.containsTriangle=function(h){var g=new Array(3);g[0]=h.v0;g[1]=h.v1;g[2]=h.v2;for(var f=0;f<3;f++){if(g[f].x>=this.min.x&&g[f].y>=this.min.y&&g[f].z>=this.min.z&&g[f].x<=this.max.x&&g[f].y<=this.max.y&&g[f].z<=this.max.z){return true}}if(triangleOnPositiveSideOfPlane(g[0],g[1],g[2],this.xpos)||triangleOnPositiveSideOfPlane(g[0],g[1],g[2],this.xneg)||triangleOnPositiveSideOfPlane(g[0],g[1],g[2],this.ypos)||triangleOnPositiveSideOfPlane(g[0],g[1],g[2],this.yneg)||triangleOnPositiveSideOfPlane(g[0],g[1],g[2],this.zpos)||triangleOnPositiveSideOfPlane(g[0],g[1],g[2],this.zneg)||triangleOnPositiveSideOfPlane(g[0],g[1],g[2],this.xpos_ypos_zpos)||triangleOnPositiveSideOfPlane(g[0],g[1],g[2],this.xpos_ypos_zneg)||triangleOnPositiveSideOfPlane(g[0],g[1],g[2],this.xpos_yneg_zpos)||triangleOnPositiveSideOfPlane(g[0],g[1],g[2],this.xpos_yneg_zneg)||triangleOnPositiveSideOfPlane(g[0],g[1],g[2],this.xneg_ypos_zpos)||triangleOnPositiveSideOfPlane(g[0],g[1],g[2],this.xneg_ypos_zneg)||triangleOnPositiveSideOfPlane(g[0],g[1],g[2],this.xneg_yneg_zpos)||triangleOnPositiveSideOfPlane(g[0],g[1],g[2],this.xneg_yneg_zneg)){return false}var d;for(var f=0;f<3;f++){var e=g[f];var c=g[(f+1)%3];d=lineSegmentPlaneIntersection(e,c,this.xpos);if(d.count>0){if(d.point.y>=this.min.y&&d.point.y<=this.max.y&&d.point.z>=this.min.z&&d.point.z<=this.max.z){return true}}d=lineSegmentPlaneIntersection(e,c,this.xneg);if(d.count>0){if(d.point.y>=this.min.y&&d.point.y<=this.max.y&&d.point.z>=this.min.z&&d.point.z<=this.max.z){return true}}d=lineSegmentPlaneIntersection(e,c,this.ypos);if(d.count>0){if(d.point.x>=this.min.x&&d.point.x<=this.max.x&&d.point.z>=this.min.z&&d.point.z<=this.max.z){return true}}d=lineSegmentPlaneIntersection(e,c,this.yneg);if(d.count>0){if(d.point.x>=this.min.x&&d.point.x<=this.max.x&&d.point.z>=this.min.z&&d.point.z<=this.max.z){return true}}d=lineSegmentPlaneIntersection(e,c,this.zpos);if(d.count>0){if(d.point.x>=this.min.x&&d.point.x<=this.max.x&&d.point.y>=this.min.y&&d.point.y<=this.max.y){return true}}d=lineSegmentPlaneIntersection(e,c,this.zneg);if(d.count>0){if(d.point.x>=this.min.x&&d.point.x<=this.max.x&&d.point.y>=this.min.y&&d.point.y<=this.max.y){return true}}}d=lineSegmentTriangleIntersection(this.min,this.max,g[0],g[1],g[2]);if(d.count>0){return true}d=lineSegmentTriangleIntersection(new Vector3D(this.min.x,this.max.y,this.min.z),new Vector3D(this.max.x,this.min.y,this.max.z),g[0],g[1],g[2]);if(d.count>0){return true}d=lineSegmentTriangleIntersection(new Vector3D(this.max.x,this.min.y,this.min.z),new Vector3D(this.min.x,this.max.y,this.max.z),g[0],g[1],g[2]);if(d.count>0){return true}d=lineSegmentTriangleIntersection(new Vector3D(this.min.x,this.min.y,this.max.z),new Vector3D(this.max.x,this.max.y,this.min.z),g[0],g[1],g[2]);if(d.count>0){return true}return false};function SphereTreeNode(){this.sphere=new Sphere();this.level=0;this.parent=null;this.children=[];this.triIndices=[]}SphereTreeNode.prototype.addChild=function(a){this.children.push(a);a.parent=this};function BoundingTree(){this.min=new Vector3D();this.max=new Vector3D();this.tris=[];this.visited=[]}BoundingTree.prototype.setTriangles=function(c,b,a){this.tris=c.slice();this.min.copy(b);this.max.copy(a)};SphereTree.prototype=new BoundingTree();SphereTree.prototype.constructor=SphereTree;function SphereTree(){BoundingTree.call(this);this.root=null}SphereTree.prototype.rayIntersectsTree=function(b){if(this.root){this.visited.length=this.tris.length;for(var a=0;a<this.visited.length;a++){this.visited[a]=false}return this.rayIntersectsTreeNode(this.root,b)}return false};SphereTree.prototype.rayIntersectsTreeNode=function(a,d){if(a.children.length>0){if(this.rayIntersectsSphere(a,d)==false){return false}var b=false;for(var c=0;c<a.children.length;c++){if(this.rayIntersectsTreeNode(a.children[c],d)==true){b=true}}if(b){return true}else{return false}}else{return this.rayIntersectsTriangleList(a.triIndices,d)}};SphereTree.prototype.rayIntersectsSphere=function(d,e){var b=e.worldViewMatrix.transform(d.sphere.center.x,d.sphere.center.y,d.sphere.center.z,1);var a=d.sphere.radius*e.scale;var c=raySphereIntersection(e.rayOrigin,e.rayDir,b,a);switch(c.count){case 2:if(c.root1<=0&&c.root2<=0){return false}break;case 1:if(c.root1<=0){return false}break;case 0:default:return false}return true};SphereTree.prototype.rayIntersectsTriangleList=function(m,d){var a,p,o;for(var e=0;e<m.length;e++){var f=m[e];if(this.visited[f]==true){continue}var r=this.tris[f];var n=d.worldViewMatrix.transform(r.v0.x,r.v0.y,r.v0.z,1);var l=d.worldViewMatrix.transform(r.v1.x,r.v1.y,r.v1.z,1);var k=d.worldViewMatrix.transform(r.v2.x,r.v2.y,r.v2.z,1);var q=rayTriangleIntersection(d.rayOrigin,d.rayDir,n,l,k,false,(d.doubleSided?false:true));if(q.result){if(q.t>=d.nearDistance&&q.t<=d.farDistance&&q.t<d.intersectRecord.distance){var h=new Vector3D(r.v0.x*(1-q.u-q.v)+r.v1.x*q.u+r.v2.x*q.v,r.v0.y*(1-q.u-q.v)+r.v1.y*q.u+r.v2.y*q.v,r.v0.z*(1-q.u-q.v)+r.v1.z*q.u+r.v2.z*q.v);var j=d.worldMatrix.transform(h.x,h.y,h.z,1);var b=d.worldViewMatrix.transform(h.x,h.y,h.z,1);for(var g=0;g<d.clipPlanes.length;g++){if(pointOnNegativeSideOfPlane(j,d.clipPlanes[g])){this.visited[f]=true;break}}if(this.visited[f]){continue}d.intersectRecord.distance=q.t;d.intersectRecord.pointModel.copy(h);d.intersectRecord.pointWorld.copy(j);d.intersectRecord.pointView.copy(b);d.intersectRecord.triIndex=f;d.intersects=true}}this.visited[f]=true}return d.intersects};Octree.prototype=new SphereTree();Octree.prototype.constructor=Octree;function Octree(){SphereTree.call(this)}Octree.prototype.buildTree=function(c){if(c<0){return}var a=new SphereTreeNode();a.sphere.center.copy(midpoint(this.min,this.max));a.sphere.radius=distanceBetween(a.sphere.center,this.max);a.triIndices.length=this.tris.length;for(var b=0;b<this.tris.length;b++){a.triIndices[b]=b}if(c>0){this.buildTreeLevels(c,this.min,this.max,a,a.triIndices)}this.root=a};Octree.prototype.buildTreeLevels=function(k,c,g,f,h){if(f.level==k){return}var j=new Vector3D(c.x+((g.x-c.x)/2),c.y+((g.y-c.y)/2),c.z+((g.z-c.z)/2));var b=new Array(8);b[0]=new Region(c.x,c.y,c.z,j.x,j.y,j.z);b[1]=new Region(j.x,c.y,c.z,g.x,j.y,j.z);b[2]=new Region(c.x,c.y,j.z,j.x,j.y,g.z);b[3]=new Region(j.x,c.y,j.z,g.x,j.y,g.z);b[4]=new Region(c.x,j.y,c.z,j.x,g.y,j.z);b[5]=new Region(j.x,j.y,c.z,g.x,g.y,j.z);b[6]=new Region(c.x,j.y,j.z,j.x,g.y,g.z);b[7]=new Region(j.x,j.y,j.z,g.x,g.y,g.z);for(var e=0;e<8;e++){var d=b[e].containsGeometry(this.tris,h);if(d.length>0){var a=new SphereTreeNode();a.level=f.level+1;a.sphere.center.copy(midpoint(b[e].min,b[e].max));a.sphere.radius=distanceBetween(a.sphere.center,b[e].max);a.triIndices=d.slice();f.addChild(a);this.buildTreeLevels(k,b[e].min,b[e].max,a,a.triIndices)}}};function rayPick(l,f,b,k,a,g,e,c,h,j){var d=new RayIntersectParams(f,b,k,a,g,e,c,h,j);l.rayIntersectsTree(d);if(d.intersects==true){return d.intersectRecord}return null}var eRenderMode={AlphaBlend:1,CullBackFace:2,DepthTest:3,DepthBufferWrite:4,Lighting:5,NormalizeNormals:6,Fog:7,StencilTest:8,PolygonOffset_Fill:9,PolygonOffset_Line:10,PolygonOffset_Point:11};var RC_BLEND=1;var RC_CULL_FACE=2884;var LIGHTDESC_POSITION_BIT=1;var LIGHTDESC_DIRECTION_BIT=2;var LIGHTDESC_AMBIENT_BIT=4;var LIGHTDESC_DIFFUSE_BIT=8;var LIGHTDESC_SPECULAR_BIT=16;var LIGHTDESC_CONSTANT_ATT_BIT=32;var LIGHTDESC_LINEAR_ATT_BIT=64;var LIGHTDESC_QUADRATIC_ATT_BIT=128;var LIGHTDESC_RANGE_BIT=256;var LIGHTDESC_OUTER_CONE_DEG_BIT=512;var LIGHTDESC_INNER_CONE_DEG_BIT=1024;var LIGHTDESC_CONE_FALLOFF_BIT=2048;function LightDesc(){this.type="";this.validMembersMask=0;this.position=new Vector3D();this.direction=new Vector3D();this.ambient=new Color();this.diffuse=new Color();this.specular=new Color();this.constantAttenuation=0;this.linearAttenuation=0;this.quadraticAttenuation=0;this.range=0;this.outerConeDegrees=0;this.innerConeDegrees=0;this.coneFalloff=0}var MATERIALDESC_AMBIENT_BIT=1;var MATERIALDESC_DIFFUSE_BIT=2;var MATERIALDESC_SPECULAR_BIT=4;var MATERIALDESC_EMISSIVE_BIT=8;var MATERIALDESC_GLOSSINESS_BIT=16;var MATERIALDESC_ALL_BITS=31;function MaterialDesc(){this.validMembersMask=0;this.ambient=new Color();this.diffuse=new Color();this.specular=new Color();this.emissive=new Color();this.glossiness=0;this.copy=function(a){if(a){this.validMembersMask=a.validMembersMask;this.ambient.copy(a.ambient);this.diffuse.copy(a.diffuse);this.specular.copy(a.specular);this.emissive.copy(a.emissive);this.glossiness=a.glossiness}}}var RC_ZERO=1;var RC_ONE=2;var RC_SRC_COLOR=4;var RC_SRC_ALPHA=8;var RC_ONE_MINUS_SRC_COLOR=16;var RC_ONE_MINUS_SRC_ALPHA=32;var RC_DEST_COLOR=64;var RC_DEST_ALPHA=128;var RC_ONE_MINUS_DEST_COLOR=256;var RC_ONE_MINUS_DEST_ALPHA=512;var RC_MODULATE=1;var RC_REPLACE=2;var RC_BLEND=4;var RC_DECAL=8;var eTextureCoordSrc={VertexUVs:1,ViewSpaceVertexPosition:2,ViewSpaceReflectionVector:3};var RC_REPEAT=10497;var RC_CLAMP_TO_EDGE=33071;var RC_MIRRORED_REPEAT=33648;function RenderContext(a,b){this.valid=false;this.canvas=a;this.background=b;this.projectionMatrixStack=new MatrixStack(new Matrix4x4());this.modelViewMatrixStack=new MatrixStack(new Matrix4x4());this.frontMaterial=new MaterialDesc();this.getFrontMaterial=function(){var c=new MaterialDesc();c.copy(this.frontMaterial);return c};this.setBackgroundImage=function(d,e,c){if(this.background){this.background.src=d;this.background.width=e;this.background.height=c}}}function newRenderContext(c,a,b){var d=null;switch(c){case"webgl":d=new webglRC(a,b);break}return d.valid?d:null}var RENDERSTATE_TRANSFORM_BIT=1;var RENDERSTATE_LIGHTING_BIT=2;var RENDERSTATE_MATERIAL_BIT=4;var RENDERSTATE_FOG_BIT=8;var RENDERSTATE_CLIP_PLANE_BIT=16;var RENDERSTATE_ZBUFFER_BIT=32;var RENDERSTATE_ALL_BITS=63;function RenderStateRec(){this.projMatrix=new Matrix4x4();this.worldViewMatrix=new Matrix4x4();this.lightIndices=[];this.lightStates=[];this.lightMatrices=[];this.lightingEnabled=false;this.materialDesc=new MaterialDesc();this.fogEnabled=false;this.clipPlaneIndices=[];this.clipPlanes=[];this.clipPlaneMatrices=[];this.zBufferEnabled=false;this.zBufferWriteEnabled=false}function RenderState(a){this.renderContext=a;this.stateStack=new Stack();this.push=function(b){var c=this.getState(b);this.stateStack.push(c)};this.pop=function(b){if(this.stateStack.empty()){return}var c=this.stateStack.top();this.setState(b,c);this.stateStack.pop()};this.getState=function(c){var e=new RenderStateRec();if(c&RENDERSTATE_TRANSFORM_BIT){e.projMatrix=this.renderContext.projectionMatrixStack.top();e.worldViewMatrix=this.renderContext.modelViewMatrixStack.top()}if(c&RENDERSTATE_LIGHTING_BIT){e.lightIndices=this.renderContext.getEnabledLights();for(var d=0;d<e.lightIndices.length;d++){var b=this.renderContext.getLight(e.lightIndices[d]);e.lightStates[d]=b.desc;e.lightMatrices[d]=b.matrix}e.lightingEnabled=this.renderContext.enabled(eRenderMode.Lighting)}if(c&RENDERSTATE_MATERIAL_BIT){e.materialDesc=this.renderContext.getFrontMaterial()}if(c&RENDERSTATE_FOG_BIT){}if(c&RENDERSTATE_CLIP_PLANE_BIT){}if(c&RENDERSTATE_ZBUFFER_BIT){e.zBufferEnabled=this.renderContext.enabled(eRenderMode.depthTest);e.zBufferWriteEnabled=this.renderContext.enabled(eRenderMode.depthBufferWrite)}return e};this.setState=function(b,d){if(b&RENDERSTATE_TRANSFORM_BIT){this.renderContext.projectionMatrixStack.loadMatrix(d.projMatrix);this.renderContext.applyProjectionTransform();this.renderContext.modelViewMatrixStack.loadMatrix(d.worldViewMatrix);this.renderContext.applyModelViewTransform()}if(b&RENDERSTATE_LIGHTING_BIT){for(var c=0;c<d.lightIndices.length;c++){this.renderContext.modelViewMatrixStack.push(d.lightMatrices[c]);this.renderContext.setLight(d.lightIndices[c],d.lightStates[c]);this.renderContext.modelViewMatrixStack.pop()}this.renderContext.setEnabledLights(d.lightIndices);if(d.lightingEnabled){this.renderContext.enable(eRenderMode.Lighting)}else{this.renderContext.disable(eRenderMode.Lighting)}}if(b&RENDERSTATE_MATERIAL_BIT){this.renderContext.setFrontMaterial(d.materialDesc)}if(b&RENDERSTATE_FOG_BIT){}if(b&RENDERSTATE_CLIP_PLANE_BIT){}if(b&RENDERSTATE_ZBUFFER_BIT){if(d.zBufferEnabled){this.renderContext.enable(eRenderMode.depthTest)}else{this.renderContext.disable(eRenderMode.depthTest)}if(d.zBufferWriteEnabled){this.renderContext.enable(eRenderMode.depthBufferWrite)}else{this.renderContext.disable(eRenderMode.depthBufferWrite)}}}}var RC_POINTS=0;var RC_LINES=1;var RC_LINE_LOOP=2;var RC_LINE_STRIP=3;var RC_TRIANGLES=4;var RC_TRIANGLE_STRIP=5;var RC_TRIANGLE_FAN=6;function VertexBuffer(){this.vertices=new Array();this.normals=new Array();this.vertexCount=0;this.numVerticesPerPrimitive=0}function TextureObject(){}WebGLDebugUtils=function(){var d=function(k){if(window.console&&window.console.log){window.console.log(k)}};var j={enable:{0:true},disable:{0:true},getParameter:{0:true},drawArrays:{0:true},drawElements:{0:true,2:true},createShader:{0:true},getShaderParameter:{1:true},getProgramParameter:{1:true},getVertexAttrib:{1:true},vertexAttribPointer:{2:true},bindTexture:{0:true},activeTexture:{0:true},getTexParameter:{0:true,1:true},texParameterf:{0:true,1:true},texParameteri:{0:true,1:true,2:true},texImage2D:{0:true,2:true,6:true,7:true},texSubImage2D:{0:true,6:true,7:true},copyTexImage2D:{0:true,2:true},copyTexSubImage2D:{0:true},generateMipmap:{0:true},bindBuffer:{0:true},bufferData:{0:true,2:true},bufferSubData:{0:true},getBufferParameter:{0:true,1:true},pixelStorei:{0:true,1:true},readPixels:{4:true,5:true},bindRenderbuffer:{0:true},bindFramebuffer:{0:true},checkFramebufferStatus:{0:true},framebufferRenderbuffer:{0:true,1:true,2:true},framebufferTexture2D:{0:true,1:true,2:true},getFramebufferAttachmentParameter:{0:true,1:true,2:true},getRenderbufferParameter:{0:true,1:true},renderbufferStorage:{0:true,1:true},clear:{0:true},depthFunc:{0:true},blendFunc:{0:true,1:true},blendFuncSeparate:{0:true,1:true,2:true,3:true},blendEquation:{0:true},blendEquationSeparate:{0:true,1:true},stencilFunc:{0:true},stencilFuncSeparate:{0:true,1:true},stencilMaskSeparate:{0:true},stencilOp:{0:true,1:true,2:true},stencilOpSeparate:{0:true,1:true,2:true,3:true},cullFace:{0:true},frontFace:{0:true},};var h=null;function g(k){if(h==null){h={};for(var l in k){if(typeof k[l]=="number"){h[k[l]]=l}}}}function e(){if(h==null){throw"WebGLDebugUtils.init(ctx) not called"}}function a(k){e();return(h[k]!==undefined)}function b(l){e();var k=h[l];return(k!==undefined)?k:("*UNKNOWN WebGL ENUM")}function c(n,l,m){var k=j[n];if(k!==undefined){if(k[l]){return b(m)}}return m.toString()}function f(k,n){g(k);n=n||function(s,t,q){var u="";for(var r=0;r<q.length;++r){u+=((r==0)?"":", ")+c(t,r,q[r])}d("WebGL error "+b(s)+" in "+t+"("+u+")")};var p={};function m(q,r){return function(){var s=q[r].apply(q,arguments);var t=q.getError();if(t!=0){p[t]=true;n(t,r,arguments)}return s}}var o={};for(var l in k){if(typeof k[l]=="function"){o[l]=m(k,l)}else{o[l]=k[l]}}o.getError=function(){for(var q in p){if(p[q]){p[q]=false;return q}}return k.NO_ERROR};return o}return{init:g,mightBeEnum:a,glEnumToString:b,glFunctionArgToString:c,makeDebugContext:f}}();function gl_LightSourceParameters(){var e;var h;var k;var j;var d;var g;var f;var a;var l;var b;var c}var gl_MaxLights=8;function gl_MaterialParameters(){var d;var a;var e;var c;var b}var gl_MaxTextureStages=2;webglRC.prototype=new RenderContext();webglRC.prototype.constructor=webglRC;function webglRC(c,d){RenderContext.call(this,c,d);var f=getWebGLContext(c,false);if(!f){return}f.clearColor(0,0,0,d?0:1);f.clearDepth(1);f.enable(f.DEPTH_TEST);f.depthFunc(f.LEQUAL);f.frontFace(f.CW);f.viewport(0,0,c.width,c.height);f.enable(f.CULL_FACE);f.cullFace(f.BACK);var b=getShaders(f,eShaderType.VertexLighting);if(!b.vertex||!b.fragment){return}var a=getProgram(f,b.vertex,b.fragment);if(!a){return}this.valid=true;var h=[];var e=[];var g=[];this.applyModelViewTransform=function(){f.uniformMatrix4fv(a.modelViewMatrix,false,new Float32Array(this.modelViewMatrixStack.top().flatten()));var j=new Matrix4x4();j.loadMatrix(this.modelViewMatrixStack.top());j.invert();j.transpose();f.uniformMatrix4fv(a.normalMatrix,false,new Float32Array(j.flatten()))};this.applyProjectionTransform=function(){f.uniformMatrix4fv(a.projectionMatrix,false,new Float32Array(this.projectionMatrixStack.top().flatten()))};this.clear=function(){f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT)};this.clearColor=function(m,l,j,k){f.clearColor(m,l,j,k)};this.createVertexBuffer=function(j){return new webglVB(f,a,j)};this.createTextureObject=function(){return new webglTO(f,a)};this.disable=function(j){switch(j){case eRenderMode.AlphaBlend:f.disable(f.BLEND);break;case eRenderMode.CullBackFace:f.disable(f.CULL_FACE);break;case eRenderMode.DepthBufferWrite:f.depthMask(false);break;case eRenderMode.DepthTest:f.disable(f.DEPTH_TEST);break;case eRenderMode.Lighting:f.uniform1i(a.lightingEnabled,false);break}};this.enable=function(j){switch(j){case eRenderMode.AlphaBlend:f.enable(f.BLEND);break;case eRenderMode.CullBackFace:f.enable(f.CULL_FACE);break;case eRenderMode.DepthBufferWrite:f.depthMask(true);break;case eRenderMode.DepthTest:f.enable(f.DEPTH_TEST);break;case eRenderMode.Lighting:f.uniform1i(a.lightingEnabled,true);break}};this.enabled=function(j){var k=false;switch(j){case eRenderMode.AlphaBlend:k=f.getParameter(f.BLEND);break;case eRenderMode.CullBackFace:k=f.getParameter(f.CULL_FACE);break;case eRenderMode.DepthBufferWrite:k=f.getParameter(f.DEPTH_WRITEMASK);break;case eRenderMode.DepthTest:k=f.getParameter(f.DEPTH_TEST);break;case eRenderMode.Lighting:k=f.getUniform(a,a.lightingEnabled);break}return k};this.enableLight=function(k,j){f.uniform1i(a.lightSource[k].enabled,j);g[k]=j};this.enableTextureStage=function(k,j){f.uniform1i(a.textureStageEnabled[k],j)};this.finish=function(){f.finish()};this.getEnabledLights=function(){var k=[];for(var j=0;j<g.length;j++){if(g[j]){k.push(j)}}return k};this.getGlobalIllumination=function(){var j=f.getUniform(a,a.globalAmbientLight);return{r:j[0],g:j[1],b:j[2],a:j[3]}};this.getLight=function(j){return{desc:h[j],matrix:e[j]}};this.getMaxLightCount=function(){return gl_MaxLights};this.getMaxTextureStages=function(){return gl_MaxTextureStages};this.perspectiveMatrixLH=function(l,u,s,j,n,m){var k=new Matrix4x4();var t=(u+l)/(u-l);var r=(s+j)/(s-j);var q=(m+n)/(m-n);var o=(2*m*n)/(m-n);k._11=(2*n)/(u-l);k._13=t;k._22=(2*n)/(s-j);k._23=r;k._33=q;k._34=1;k._43=-o;k._44=0;return k};this.orthographicMatrixLH=function(q,l,o,k,m,j){var n=new Matrix4x4();n._11=2/(l-q);n._22=2/(o-k);n._33=-2/(j-m);n._41=-((l+q)/(l-q));n._42=-((o+k)/(o-k));n._43=-((j+m)/(j-m))/2;return n};this.setBlendFactor=function(l,j){var k;switch(l){case RC_ZERO:k=f.ZERO;break;case RC_ONE:k=f.ONE;break;case RC_SRC_COLOR:k=f.SRC_COLOR;break;case RC_SRC_ALPHA:k=f.SRC_ALPHA;break;case RC_ONE_MINUS_SRC_COLOR:k=f.ONE_MINUS_SRC_COLOR;break;case RC_ONE_MINUS_SRC_ALPHA:k=f.ONE_MINUS_SRC_ALPHA;break;case RC_DEST_COLOR:k=f.DEST_COLOR;break;case RC_DEST_ALPHA:k=f.DEST_ALPHA;break;case RC_ONE_MINUS_DEST_COLOR:k=f.ONE_MINUS_DEST_COLOR;break;case RC_ONE_MINUS_DEST_ALPHA:k=f.ONE_MINUS_DEST_ALPHA;break}var m;switch(j){case RC_ZERO:m=f.ZERO;break;case RC_ONE:m=f.ONE;break;case RC_SRC_COLOR:m=f.SRC_COLOR;break;case RC_SRC_ALPHA:m=f.SRC_ALPHA;break;case RC_ONE_MINUS_SRC_COLOR:m=f.ONE_MINUS_SRC_COLOR;break;case RC_ONE_MINUS_SRC_ALPHA:m=f.ONE_MINUS_SRC_ALPHA;break;case RC_DEST_COLOR:m=f.DEST_COLOR;break;case RC_DEST_ALPHA:m=f.DEST_ALPHA;break;case RC_ONE_MINUS_DEST_COLOR:m=f.ONE_MINUS_DEST_COLOR;break;case RC_ONE_MINUS_DEST_ALPHA:m=f.ONE_MINUS_DEST_ALPHA;break}f.blendFunc(k,m)};this.setEnabledLights=function(k){for(var j=0;j<g.length;j++){if(g[j]){this.enableLight(j,false)}}for(var j=0;j<k.length;j++){this.enableLight(k[j],true)}};this.setFrontMaterial=function(j){if(j.validMembersMask&MATERIALDESC_AMBIENT_BIT){f.uniform4fv(a.frontMaterial.ambient,new Float32Array(j.ambient.v()));this.frontMaterial.ambient=j.ambient}if(j.validMembersMask&MATERIALDESC_DIFFUSE_BIT){f.uniform4fv(a.frontMaterial.diffuse,new Float32Array(j.diffuse.v()));this.frontMaterial.diffuse=j.diffuse}if(j.validMembersMask&MATERIALDESC_SPECULAR_BIT){f.uniform4fv(a.frontMaterial.specular,new Float32Array(j.specular.v()));this.frontMaterial.specular=j.specular}if(j.validMembersMask&MATERIALDESC_EMISSIVE_BIT){this.frontMaterial.emissive=j.emissive}if(j.validMembersMask&MATERIALDESC_GLOSSINESS_BIT){f.uniform1f(a.frontMaterial.shininess,clamp(j.glossiness*128,5,128));this.frontMaterial.glossiness=j.glossiness}this.frontMaterial.validMembersMask|=j.validMembersMask};this.setGlobalIllumination=function(k){var j=[k.r,k.g,k.g,k.a];f.uniform4fv(a.globalAmbientLight,new Float32Array(j))};this.setLight=function(n,p){var m=this.modelViewMatrixStack.top();if(p.validMembersMask&LIGHTDESC_POSITION_BIT){var j=m.transformw(p.position.x,p.position.y,p.position.z,1);var k=[j.x,j.y,j.z,j.w];f.uniform4fv(a.lightSource[n].position,new Float32Array(k))}if(p.validMembersMask&LIGHTDESC_DIRECTION_BIT){var o=m.transform(p.direction.x,p.direction.y,p.direction.z,0);var k=[o.x,o.y,o.z,0];switch(p.type){case"directional":k[0]*=-1;k[1]*=-1;k[2]*=-1;f.uniform4fv(a.lightSource[n].position,new Float32Array(k));break;case"spot":f.uniform4fv(a.lightSource[n].spotDirection,new Float32Array(k));break}}if(p.validMembersMask&LIGHTDESC_AMBIENT_BIT){f.uniform4fv(a.lightSource[n].ambient,new Float32Array(p.ambient.v()))}if(p.validMembersMask&LIGHTDESC_DIFFUSE_BIT){f.uniform4fv(a.lightSource[n].diffuse,new Float32Array(p.diffuse.v()))}if(p.validMembersMask&LIGHTDESC_SPECULAR_BIT){f.uniform4fv(a.lightSource[n].specular,new Float32Array(p.specular.v()))}if(p.validMembersMask&LIGHTDESC_CONSTANT_ATT_BIT){f.uniform1f(a.lightSource[n].constantAttenuation,p.constantAttenuation)}if(p.validMembersMask&LIGHTDESC_LINEAR_ATT_BIT){f.uniform1f(a.lightSource[n].linearAttenuation,p.linearAttenuation)}if(p.validMembersMask&LIGHTDESC_QUADRATIC_ATT_BIT){f.uniform1f(a.lightSource[n].quadraticAttenuation,p.quadraticAttenuation)}if(p.validMembersMask&LIGHTDESC_RANGE_BIT){}if(p.validMembersMask&LIGHTDESC_OUTER_CONE_DEG_BIT){var l=p.outerConeDegrees;if(l>90){l=180}f.uniform1f(a.lightSource[n].spotCutoff,l);f.uniform1f(a.lightSource[n].spotExponent,0)}if(p.validMembersMask&LIGHTDESC_INNER_CONE_DEG_BIT){}if(p.validMembersMask&LIGHTDESC_CONE_FALLOFF_BIT){}h[n]=p;e[n]=m};this.setTextureBlendFactor=function(k){var j=[this.frontMaterial.diffuse.r,this.frontMaterial.diffuse.g,this.frontMaterial.diffuse.b,k];f.uniform4fv(a.frontMaterial.diffuse,new Float32Array(j))};this.setTextureBlendOp=function(j){f.uniform1i(a.textureBlendOp,j)};this.setViewport=function(k,m,l,j){f.viewport(k,m,l,j)}}function getWebGLContext(b,a){var f=null;try{if(a){f=WebGLDebugUtils.makeDebugContext(b.getContext("experimental-webgl",{antialias:false}))}else{f=b.getContext("experimental-webgl",{antialias:true})}}catch(d){}if(!f){var g=document.createElement("div");g.innerHTML="This demo requires a WebGL-enabled browser.";var c=b.parentNode;c.replaceChild(g,b)}return f}function getProgram(e,d,c){var a=e.createProgram();if(!a){return null}e.attachShader(a,d);e.attachShader(a,c);e.linkProgram(a);if(!e.getProgramParameter(a,e.LINK_STATUS)){alert(e.getProgramInfoLog(a));return null}e.useProgram(a);a.vertexPositionAttribute=e.getAttribLocation(a,"aVertexPosition");e.enableVertexAttribArray(a.vertexPositionAttribute);a.vertexNormalAttribute=e.getAttribLocation(a,"aVertexNormal");e.enableVertexAttribArray(a.vertexNormalAttribute);a.textureCoordAttribute=new Array(gl_MaxTextureStages);for(var b=0;b<gl_MaxTextureStages;b++){a.textureCoordAttribute[b]=e.getAttribLocation(a,"aTextureCoord"+b);e.enableVertexAttribArray(a.textureCoordAttribute[b])}a.projectionMatrix=e.getUniformLocation(a,"uProjectionMatrix");a.modelViewMatrix=e.getUniformLocation(a,"uModelViewMatrix");a.normalMatrix=e.getUniformLocation(a,"uNormalMatrix");a.globalAmbientLight=e.getUniformLocation(a,"uGlobalAmbientLight");a.lightSource=new Array(gl_MaxLights);for(var b=0;b<gl_MaxLights;b++){a.lightSource[b]=new gl_LightSourceParameters();a.lightSource[b].enabled=e.getUniformLocation(a,"uLightSource_enabled["+b+"]");a.lightSource[b].ambient=e.getUniformLocation(a,"uLightSource_ambient["+b+"]");a.lightSource[b].diffuse=e.getUniformLocation(a,"uLightSource_diffuse["+b+"]");a.lightSource[b].specular=e.getUniformLocation(a,"uLightSource_specular["+b+"]");a.lightSource[b].position=e.getUniformLocation(a,"uLightSource_position["+b+"]");a.lightSource[b].spotDirection=e.getUniformLocation(a,"uLightSource_spotDirection["+b+"]");a.lightSource[b].spotExponent=e.getUniformLocation(a,"uLightSource_spotExponent["+b+"]");a.lightSource[b].spotCutoff=e.getUniformLocation(a,"uLightSource_spotCutoff["+b+"]");a.lightSource[b].constantAttenuation=e.getUniformLocation(a,"uLightSource_constantAttenuation["+b+"]");a.lightSource[b].linearAttenuation=e.getUniformLocation(a,"uLightSource_linearAttenuation["+b+"]");a.lightSource[b].quadraticAttenuation=e.getUniformLocation(a,"uLightSource_quadraticAttenuation["+b+"]");e.uniform1i(a.lightSource[b].enabled,0)}a.frontMaterial=new gl_MaterialParameters();a.frontMaterial.ambient=e.getUniformLocation(a,"uFrontMaterial_ambient");a.frontMaterial.diffuse=e.getUniformLocation(a,"uFrontMaterial_diffuse");a.frontMaterial.specular=e.getUniformLocation(a,"uFrontMaterial_specular");a.frontMaterial.emission=e.getUniformLocation(a,"uFrontMaterial_emission");a.frontMaterial.shininess=e.getUniformLocation(a,"uFrontMaterial_shininess");a.textureSamplerColor=new Array(gl_MaxTextureStages);a.textureSamplerAlpha=new Array(gl_MaxTextureStages);a.textureStageEnabled=new Array(gl_MaxTextureStages);for(var b=0;b<gl_MaxTextureStages;b++){a.textureSamplerColor[b]=e.getUniformLocation(a,"uTextureSamplerColor["+b+"]");a.textureSamplerAlpha[b]=e.getUniformLocation(a,"uTextureSamplerAlpha["+b+"]");a.textureStageEnabled[b]=e.getUniformLocation(a,"uTextureStageEnabled["+b+"]")}a.textureBlendOp=e.getUniformLocation(a,"uTextureBlendOp");a.lightingEnabled=e.getUniformLocation(a,"uLightingEnabled");a.texturesEnabled=e.getUniformLocation(a,"uTexturesEnabled");e.uniform1i(a.lightingEnabled,1);e.uniform1i(a.texturesEnabled,1);e.uniform1i(a.textureStageEnabled[0],0);e.uniform1i(a.textureStageEnabled[1],0);return a}function webglVB_uvb(a,b){this.buffer=a;this.coords=b}webglVB.prototype=new VertexBuffer();webglVB.prototype.constructor=webglVB;function webglVB(d,c,a){VertexBuffer.call(this);this.numVerticesPerPrimitive=a;var d=d;var c=c;var f=d.createBuffer();var e=null;var b=new Array(gl_MaxTextureStages);var j=d.createBuffer();var h=[];var g=0;this.setPrimitiveType=function(k){switch(k){case RC_POINTS:g=d.POINTS;break;case RC_LINES:g=d.LINES;break;case RC_LINE_LOOP:g=d.LINE_LOOP;break;case RC_LINE_STRIP:g=d.LINE_STRIP;break;case RC_TRIANGLES:g=d.TRIANGLES;break;case RC_TRIANGLE_STRIP:g=d.TRIANGLE_STRIP;break;case RC_TRIANGLE_FAN:g=d.TRIANGLE_FAN;break}};this.setVertices=function(k){if(k.length){d.bindBuffer(d.ARRAY_BUFFER,f);d.bufferData(d.ARRAY_BUFFER,new Float32Array(k),d.STATIC_DRAW);this.vertexCount=k.length/this.numVerticesPerPrimitive;d.bindBuffer(d.ARRAY_BUFFER,j);d.bufferData(d.ARRAY_BUFFER,new Float32Array(new Array(this.vertexCount*2)),d.STATIC_DRAW)}this.vertices=k};this.setNormals=function(k){if(k.length){if(e==null){e=d.createBuffer()}d.bindBuffer(d.ARRAY_BUFFER,e);d.bufferData(d.ARRAY_BUFFER,new Float32Array(k),d.STATIC_DRAW)}this.normals=k};this.setUVCoords=function(l,m){h[l]=new webglVB_uvb(d.createBuffer(),m.slice());for(var k=1;k<h[l].coords.length;k+=2){h[l].coords[k]=1-h[l].coords[k]}};this.setTextureStage=function(l,n,k,m,p,o){switch(l){case 0:d.activeTexture(d.TEXTURE0);break;case 1:d.activeTexture(d.TEXTURE1);break}d.bindTexture(d.TEXTURE_2D,n.texture);d.uniform1i(c.textureSamplerColor[l],l);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,k);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,m);if(h[n]){d.bindBuffer(d.ARRAY_BUFFER,h[n].buffer);d.bufferData(d.ARRAY_BUFFER,new Float32Array(h[n].coords),d.STATIC_DRAW);b[l]=h[n].buffer}};this.draw=function(){if(this.vertices.length){d.bindBuffer(d.ARRAY_BUFFER,f);d.vertexAttribPointer(c.vertexPositionAttribute,this.numVerticesPerPrimitive,d.FLOAT,false,0,0);if(e!=null){d.bindBuffer(d.ARRAY_BUFFER,e);d.vertexAttribPointer(c.vertexNormalAttribute,3,d.FLOAT,false,0,0)}for(var k=0;k<gl_MaxTextureStages;k++){if(b[k]){d.bindBuffer(d.ARRAY_BUFFER,b[k])}else{d.bindBuffer(d.ARRAY_BUFFER,j)}d.vertexAttribPointer(c.textureCoordAttribute[k],2,d.FLOAT,false,0,0)}d.drawArrays(g,0,this.vertexCount)}}}webglTO.prototype=new TextureObject();webglTO.prototype.constructor=webglTO;function webglTO(b,a){TextureObject.call(this);var b=b;var a=a;this.texture=b.createTexture();this.setImage=function(j,e,h){var c;switch(e){case ePixelFormat.R8G8B8:case ePixelFormat.B8G8R8:case ePixelFormat.X8G8R8:c=b.RGB;break;case ePixelFormat.R8G8B8A8:case ePixelFormat.B8G8R8A8:case ePixelFormat.A8R8G8B8:case ePixelFormat.A8B8G8R8:case ePixelFormat.X8X8X8X8:c=b.RGBA;break;case ePixelFormat.A8:c=b.ALPHA;break;default:return;break}var g;switch(h){case eImageFormat.RGB:g=b.RGB;break;case eImageFormat.RGBA:g=b.RGBA;break;case eImageFormat.Alpha:g=b.ALPHA;break;case eImageFormat.Luminance:g=b.LUMINANCE;break;case eImageFormat.Luminance_Alpha:g=b.LUMINANCE_ALPHA;break;default:return;break}if(!isPowerOfTwo(j.width)||!isPowerOfTwo(j.height)){var f=document.createElement("canvas");f.width=nextHighestPowerOfTwo(j.width);f.height=nextHighestPowerOfTwo(j.height);var d=f.getContext("2d");d.drawImage(j,0,0,j.width,j.height,0,0,f.width,f.height);j=f}b.bindTexture(b.TEXTURE_2D,this.texture);b.texImage2D(b.TEXTURE_2D,0,c,g,b.UNSIGNED_BYTE,j);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR_MIPMAP_LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.generateMipmap(b.TEXTURE_2D);b.bindTexture(b.TEXTURE_2D,null)};this.setImageData=function(f,d,e,h,j){var c;switch(e){case ePixelFormat.R8G8B8:case ePixelFormat.B8G8R8:case ePixelFormat.X8G8R8:c=b.RGB;break;case ePixelFormat.R8G8B8A8:case ePixelFormat.B8G8R8A8:case ePixelFormat.A8R8G8B8:case ePixelFormat.A8B8G8R8:case ePixelFormat.X8X8X8X8:c=b.RGBA;break;case ePixelFormat.A8:c=b.ALPHA;break;default:return;break}var g;switch(h){case eImageFormat.RGB:g=b.RGB;break;case eImageFormat.RGBA:g=b.RGBA;break;case eImageFormat.Alpha:g=b.ALPHA;break;case eImageFormat.Luminance:g=b.LUMINANCE;break;case eImageFormat.Luminance_Alpha:g=b.LUMINANCE_ALPHA;break;default:return;break}b.bindTexture(b.TEXTURE_2D,this.texture);b.texImage2D(b.TEXTURE_2D,0,c,f,d,0,g,b.UNSIGNED_BYTE,new Uint8Array(j));b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR_MIPMAP_LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.generateMipmap(b.TEXTURE_2D);b.bindTexture(b.TEXTURE_2D,null)};this.setVideo=function(c){b.bindTexture(b.TEXTURE_2D,this.texture);switch(getBrowserName()){case"Chrome":case"Firefox":b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c);break;default:b.texImage2D(b.TEXTURE_2D,0,c,false);break}b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.bindTexture(b.TEXTURE_2D,null)}}function isPowerOfTwo(a){return(a&(a-1))==0}function nextHighestPowerOfTwo(a){--a;for(var b=1;b<32;b<<=1){a=a|a>>b}return a+1}var eShaderType={VertexLighting:0,FragmentLighting:1};function getShaders(d,b){var c=null;var f=null;switch(b){case eShaderType.VertexLighting:c=["#ifdef GL_ES","precision highp float;","#endif","","vec4 gAmbient;","vec4 gDiffuse;","vec4 gSpecular;","","attribute vec3 aVertexPosition;","attribute vec3 aVertexNormal;","attribute vec2 aTextureCoord0;","attribute vec2 aTextureCoord1;","","uniform mat4 uProjectionMatrix;","uniform mat4 uModelViewMatrix;","uniform mat4 uNormalMatrix;","","uniform vec4 uGlobalAmbientLight;","","uniform int uLightSource_enabled["+gl_MaxLights+"];","uniform vec4 uLightSource_ambient["+gl_MaxLights+"];","uniform vec4 uLightSource_diffuse["+gl_MaxLights+"];","uniform vec4 uLightSource_specular["+gl_MaxLights+"];","uniform vec4 uLightSource_position["+gl_MaxLights+"];","uniform vec4 uLightSource_halfVector["+gl_MaxLights+"];","uniform vec4 uLightSource_spotDirection["+gl_MaxLights+"];","uniform float uLightSource_spotExponent["+gl_MaxLights+"];","uniform float uLightSource_spotCutoff["+gl_MaxLights+"];","uniform float uLightSource_spotCosCutoff["+gl_MaxLights+"];","uniform float uLightSource_constantAttenuation["+gl_MaxLights+"];","uniform float uLightSource_linearAttenuation["+gl_MaxLights+"];","uniform float uLightSource_quadraticAttenuation["+gl_MaxLights+"];","","uniform vec4 uFrontMaterial_ambient;","uniform vec4 uFrontMaterial_diffuse;","uniform vec4 uFrontMaterial_specular;","uniform vec4 uFrontMaterial_emission;","uniform float uFrontMaterial_shininess;","","uniform int uLightingEnabled;","","varying vec4 vLightingFactor;","varying vec2 vTextureCoord["+gl_MaxTextureStages+"];","","void directionalLight(vec4 position, vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 halfVector)","{","   vec3 lightDir;","   float nDotL;","   float nDotHV;","   float pf;","","   lightDir = normalize(vec3(position));","","   nDotL = max(dot(normal, lightDir), 0.0);","   if (nDotL == 0.0)","   {","       pf = 0.0;","   }","   else","   {","       nDotHV = max(0.0, dot(normal, halfVector));","       pf = pow(nDotHV, uFrontMaterial_shininess);","   }","","   gAmbient  += ambient * uFrontMaterial_ambient;","   gDiffuse  += diffuse * uFrontMaterial_diffuse * nDotL;","   gSpecular += specular * uFrontMaterial_specular * pf;","}","","void pointLight(vec4 position, float constantAttenuation, float linearAttenuation, float quadraticAttenuation,","                vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 eye, vec3 vPosition)","{","   float nDotL;","   float nDotHV;","   float pf;","   float attenuation;","   float d;","   vec3  L;","   vec3  halfVector;","","","   L = vec3(position) - vPosition;","","","   d = length(L);","","","   L = normalize(L);","","","   attenuation = 1.0 / (constantAttenuation +","      linearAttenuation * d +","      quadraticAttenuation * d * d);","","   nDotL = max(0.0, dot(normal, L));","   nDotHV = max(0.0, dot(normal, normalize(L + eye)));","","   if (nDotL == 0.0)","   {","       pf = 0.0;","   }","   else","   {","       pf = pow(nDotHV, uFrontMaterial_shininess);","   }","","   gAmbient  += ambient * uFrontMaterial_ambient * attenuation;","   gDiffuse  += diffuse * uFrontMaterial_diffuse * nDotL * attenuation;","   gSpecular += specular * uFrontMaterial_specular * pf * attenuation;","}","","void main()","{","   vec4 vertexPosition;","   vec4 transformedNormal;","   vec4 viewPosition;","   vec4 viewDirection;","","   if (uLightingEnabled != 0)","   {","       vertexPosition = uModelViewMatrix * vec4(aVertexPosition, 1);","       transformedNormal = normalize(uNormalMatrix * vec4(aVertexNormal, 0));","       viewPosition = uModelViewMatrix * vec4(0, 0, 0, 1);","       viewDirection = normalize(-viewPosition);","       gAmbient = vec4(0, 0, 0, 0);","       gDiffuse = vec4(0, 0, 0, 0);","       gSpecular = vec4(0, 0, 0, 0);","","       for (int i=0; i < "+gl_MaxLights+"; i++)","       {","           if (uLightSource_enabled[i] != 0)","           {","               if (uLightSource_position[i][3] == 0.0)","               {","                   directionalLight(uLightSource_position[i], uLightSource_ambient[i],","                       uLightSource_diffuse[i], uLightSource_specular[i],","                       normalize(vec3(transformedNormal)),","                       normalize(vec3(viewDirection) + vec3(uLightSource_position[i])));","               }","               else if (uLightSource_spotCutoff[i] > 90.0)","               {","                   pointLight(uLightSource_position[i], uLightSource_constantAttenuation[i],","                       uLightSource_linearAttenuation[i], uLightSource_quadraticAttenuation[i],","                       uLightSource_ambient[i], uLightSource_diffuse[i], uLightSource_specular[i],","                       normalize(vec3(transformedNormal)),","                       vec3(viewDirection), vec3(vertexPosition));","               }","               else","               {","               }","           }","       }","","       vLightingFactor  = uGlobalAmbientLight * uFrontMaterial_ambient;","       vLightingFactor += gAmbient + gDiffuse + gSpecular;","       vLightingFactor.a = uFrontMaterial_ambient.a / 3.0 + ","                           uFrontMaterial_diffuse.a / 3.0 + ","                           uFrontMaterial_specular.a / 3.0;","   }","   else","   {","","       vLightingFactor = vec4(1, 1, 1, 1);","   }","","   vTextureCoord[0] = aTextureCoord0;","   vTextureCoord[1] = aTextureCoord1;","   gl_Position = uProjectionMatrix * vertexPosition;","}"].join("\n");f=["#ifdef GL_ES","precision highp float;","#endif","","uniform int uTexturesEnabled;","uniform int uTextureStageEnabled["+gl_MaxTextureStages+"];","uniform sampler2D uTextureSamplerColor["+gl_MaxTextureStages+"];","uniform sampler2D uTextureSamplerAlpha["+gl_MaxTextureStages+"];","uniform int uTextureBlendOp;","","varying vec4 vLightingFactor;","varying vec2 vTextureCoord["+gl_MaxTextureStages+"];","","void main()","{","   vec4 fragmentColor;","   vec4 fragmentColor1;","   vec4 fragmentColor2;","   if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 0)","   {","       fragmentColor = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));","       if (uTextureBlendOp == "+RC_MODULATE+")","       {","           if (fragmentColor.a == 0.0) discard;","           else gl_FragColor = fragmentColor * vLightingFactor;","       }","       else if (uTextureBlendOp == "+RC_REPLACE+")","       {","           gl_FragColor = fragmentColor;","       }","       else","       {","           fragmentColor = vec4(1, 1, 1, 1);","           gl_FragColor = fragmentColor * vLightingFactor;","       }","   }","   else if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 1)","   {","       fragmentColor1 = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));","       fragmentColor2 = texture2D(uTextureSamplerColor[1], vec2(vTextureCoord[1].s, vTextureCoord[1].t));","       if (uTextureBlendOp == "+RC_MODULATE+")","       {","           fragmentColor1.a = fragmentColor2.a;","           if (fragmentColor1.a == 0.0) discard;","           else gl_FragColor = fragmentColor1 * vLightingFactor;","       }","       else if (uTextureBlendOp == "+RC_REPLACE+")","       {","           gl_FragColor = fragmentColor1 * fragmentColor2;","       }","       else","       {","           fragmentColor = vec4(1, 1, 1, 1);","           gl_FragColor = fragmentColor * vLightingFactor;","       }","   }","   else","   {","       fragmentColor = vec4(1, 1, 1, 1);","       gl_FragColor = fragmentColor * vLightingFactor;","   }","}"].join("\n");break;case eShaderType.FragmentLighting:c=["attribute vec3 aVertexPosition;","attribute vec3 aVertexNormal;","attribute vec2 aTextureCoord0;","attribute vec2 aTextureCoord1;","","uniform mat4 uProjectionMatrix;","uniform mat4 uModelViewMatrix;","uniform mat4 uNormalMatrix;","","varying vec4 vVertexPosition;","varying vec4 vTransformedNormal;","varying vec4 vViewPosition;","varying vec4 vViewDirection;","varying vec2 vTextureCoord["+gl_MaxTextureStages+"];","","void main()","{","   vVertexPosition = uModelViewMatrix * vec4(aVertexPosition, 1);","   vTransformedNormal = normalize(uNormalMatrix * vec4(aVertexNormal, 0));","   vViewPosition = uModelViewMatrix * vec4(0, 0, 0, 1);","   vViewDirection = normalize(-vViewPosition);","   vTextureCoord[0] = aTextureCoord0;","   vTextureCoord[1] = aTextureCoord1;","   gl_Position = uProjectionMatrix * vVertexPosition;","}"].join("\n");f=["#ifdef GL_ES","precision highp float;","#endif","","vec4 gAmbient;","vec4 gDiffuse;","vec4 gSpecular;","","uniform vec4 uGlobalAmbientLight;","","","uniform int uLightSource_enabled["+gl_MaxLights+"];","uniform vec4 uLightSource_ambient["+gl_MaxLights+"];","uniform vec4 uLightSource_diffuse["+gl_MaxLights+"];","uniform vec4 uLightSource_specular["+gl_MaxLights+"];","uniform vec4 uLightSource_position["+gl_MaxLights+"];","uniform vec4 uLightSource_halfVector["+gl_MaxLights+"];","uniform vec4 uLightSource_spotDirection["+gl_MaxLights+"];","uniform float uLightSource_spotExponent["+gl_MaxLights+"];","uniform float uLightSource_spotCutoff["+gl_MaxLights+"];","uniform float uLightSource_spotCosCutoff["+gl_MaxLights+"];","uniform float uLightSource_constantAttenuation["+gl_MaxLights+"];","uniform float uLightSource_linearAttenuation["+gl_MaxLights+"];","uniform float uLightSource_quadraticAttenuation["+gl_MaxLights+"];","","uniform vec4 uFrontMaterial_ambient;","uniform vec4 uFrontMaterial_diffuse;","uniform vec4 uFrontMaterial_specular;","uniform vec4 uFrontMaterial_emission;","uniform float uFrontMaterial_shininess;","","uniform int uLightingEnabled;","uniform int uTexturesEnabled;","uniform int uTextureStageEnabled["+gl_MaxTextureStages+"];","uniform sampler2D uTextureSamplerColor["+gl_MaxTextureStages+"];","uniform sampler2D uTextureSamplerAlpha["+gl_MaxTextureStages+"];","uniform int uTextureBlendOp;","","varying vec4 vVertexPosition;","varying vec4 vTransformedNormal;","varying vec4 vViewPosition;","varying vec4 vViewDirection;","varying vec2 vTextureCoord["+gl_MaxTextureStages+"];","","void directionalLight(vec4 position, vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 halfVector)","{","   vec3 lightDir;","   float nDotL;","   float nDotHV;","   float pf;","","   lightDir = normalize(vec3(position));","","   nDotL = max(dot(normal, lightDir), 0.0);","   if (nDotL == 0.0)","   {","       pf = 0.0;","   }","   else","   {","       nDotHV = max(0.0, dot(normal, halfVector));","       pf = pow(nDotHV, uFrontMaterial_shininess);","   }","","   gAmbient  += ambient * uFrontMaterial_ambient;","   gDiffuse  += diffuse * uFrontMaterial_diffuse * nDotL;","   gSpecular += specular * uFrontMaterial_specular * pf;","}","","void pointLight(vec4 position, float constantAttenuation, float linearAttenuation, float quadraticAttenuation,","                vec4 ambient, vec4 diffuse, vec4 specular, vec3 normal, vec3 eye, vec3 vPosition)","{","   float nDotL;","   float nDotHV;","   float pf;","   float attenuation;","   float d;","   vec3  L;","   vec3  halfVector;","","","   L = vec3(position) - vPosition;","","","   d = length(L);","","","   L = normalize(L);","","","   attenuation = 1.0 / (constantAttenuation +","      linearAttenuation * d +","      quadraticAttenuation * d * d);","","   nDotL = max(0.0, dot(normal, L));","   nDotHV = max(0.0, dot(normal, normalize(L + eye)));","","   if (nDotL == 0.0)","   {","       pf = 0.0;","   }","   else","   {","       pf = pow(nDotHV, uFrontMaterial_shininess);","   }","","   gAmbient  += ambient * uFrontMaterial_ambient * attenuation;","   gDiffuse  += diffuse * uFrontMaterial_diffuse * nDotL * attenuation;","   gSpecular += specular * uFrontMaterial_specular * pf * attenuation;","}","","void main()","{","   vec4 lightingFactor;","   if (uLightingEnabled != 0)","   {","       gAmbient = vec4(0, 0, 0, 0);","       gDiffuse = vec4(0, 0, 0, 0);","       gSpecular = vec4(0, 0, 0, 0);","","       for (int i=0; i < "+gl_MaxLights+"; i++)","       {","           if (uLightSource_enabled[i] != 0)","           {","               if (uLightSource_position[i][3] == 0.0)","               {","                   directionalLight(uLightSource_position[i], uLightSource_ambient[i],","                       uLightSource_diffuse[i], uLightSource_specular[i],","                       normalize(vec3(vTransformedNormal)),","                       normalize(vec3(vViewDirection) + vec3(uLightSource_position[i])));","               }","               else if (uLightSource_spotCutoff[i] > 90.0)","               {","                   pointLight(uLightSource_position[i], uLightSource_constantAttenuation[i],","                       uLightSource_linearAttenuation[i], uLightSource_quadraticAttenuation[i],","                       uLightSource_ambient[i], uLightSource_diffuse[i], uLightSource_specular[i],","                       normalize(vec3(vTransformedNormal)),","                       vec3(vViewDirection), vec3(vVertexPosition));","               }","               else","               {","               }","           }","       }","","       lightingFactor  = uGlobalAmbientLight * uFrontMaterial_ambient;","       lightingFactor += gAmbient + gDiffuse + gSpecular;","       lightingFactor.a  = uFrontMaterial_ambient.a / 3.0 + ","                           uFrontMaterial_diffuse.a / 3.0 + ","                           uFrontMaterial_specular.a / 3.0;","   }","   else","   {","","       lightingFactor = vec4(1, 1, 1, 1);","   }","","   vec4 fragmentColor;","   vec4 fragmentColor1;","   vec4 fragmentColor2;","   if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 0)","   {","       fragmentColor = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));","       if (uTextureBlendOp == "+RC_MODULATE+")","       {","           if (fragmentColor.a == 0.0) discard;","           else gl_FragColor = fragmentColor * lightingFactor;","       }","       else if (uTextureBlendOp == "+RC_REPLACE+")","       {","           gl_FragColor = fragmentColor;","       }","       else","       {","           fragmentColor = vec4(1, 1, 1, 1);","           gl_FragColor = fragmentColor * lightingFactor;","       }","   }","   else if (uTexturesEnabled == 1 && uTextureStageEnabled[0] == 1 && uTextureStageEnabled[1] == 1)","   {","       fragmentColor1 = texture2D(uTextureSamplerColor[0], vec2(vTextureCoord[0].s, vTextureCoord[0].t));","       fragmentColor2 = texture2D(uTextureSamplerColor[1], vec2(vTextureCoord[1].s, vTextureCoord[1].t));","       if (uTextureBlendOp == "+RC_MODULATE+")","       {","           fragmentColor1.a = fragmentColor2.a;","           if (fragmentColor1.a == 0.0) discard;","           else gl_FragColor = fragmentColor1 * lightingFactor;","       }","       else if (uTextureBlendOp == "+RC_REPLACE+")","       {","           gl_FragColor = fragmentColor1 * fragmentColor2;","       }","       else","       {","           fragmentColor = vec4(1, 1, 1, 1);","           gl_FragColor = fragmentColor * lightingFactor;","       }","   }","   else","   {","       fragmentColor = vec4(1, 1, 1, 1);","       gl_FragColor = fragmentColor * lightingFactor;","   }","}"].join("\n");break;default:return{vertex:null,fragment:null};break}var e=d.createShader(d.VERTEX_SHADER);if(e){d.shaderSource(e,c);d.compileShader(e);if(!d.getShaderParameter(e,d.COMPILE_STATUS)){alert(d.getShaderInfoLog(e))}}var a=d.createShader(d.FRAGMENT_SHADER);if(a){d.shaderSource(a,f);d.compileShader(a);if(!d.getShaderParameter(a,d.COMPILE_STATUS)){alert(d.getShaderInfoLog(a))}}return{vertex:e,fragment:a}}ContentHandler.prototype=new AttributeContainer();ContentHandler.prototype.constructor=ContentHandler;function ContentHandler(){AttributeContainer.call(this);this.className="ContentHandler";this.contentDirectory=new StringAttr("");this.url=new StringAttr("");this.registerAttribute(this.contentDirectory,"contentDirectory");this.registerAttribute(this.url,"url")}ContentHandler.prototype.parseFileStream=function(a){};ContentHandler.prototype.matchesType=function(a){};ContentBuilder.prototype=new AttributeContainer();ContentBuilder.prototype.constructor=ContentBuilder;function ContentBuilder(){AttributeContainer.call(this);this.className="ContentBuilder";this.models=[];this.evaluators=[];this.layer=0;this.invertAlpha=new BooleanAttr(false);this.registerAttribute(this.invertAlpha,"invertAlpha")}ContentBuilder.prototype.visitHandler=function(a){};ContentBuilder.prototype.finalize=function(){};ContentBuilder.prototype.matchesType=function(a){};function BinaryParser(b,a){this.stream=b;this.bigEndian=a;this.readUInt8=function(){return this.decodeInt(8,false)};this.readUInt16=function(){return this.decodeInt(16,false)};this.readUInt32=function(){return this.decodeInt(32,false)};this.readInt8=function(){return this.decodeInt(8,true)};this.readInt16=function(){return this.decodeInt(16,true)};this.readInt32=function(){return this.decodeInt(32,true)};this.readFloat32=function(){return this.decodeFloat32()};var c=0;this.decodeInt=function(h,f){var g=0;var e=h/8;var j=0;for(var k=0;k<e;k++){j=this.bigEndian?this.stream.charCodeAt(c+k):this.stream.charCodeAt(c+(e-k-1));for(var d=7;d>=0;d--){g=g*2+((1<<d)&j?1:0)}}if(f){max=Math.pow(2,h);g=g>=max/2?g-max:g}c+=e;return g};this.decodeFloat32=function(){var j=0;var q=4;var f=new Array(q);for(var d=0;d<q;d++){this.bigEndian?f[d]=this.stream.charCodeAt(c+d):f[d]=this.stream.charCodeAt(c+(q-d-1))}var g=f[0]&128;var m=0;for(var k=6;k>=0;k--){m=m*2+((1<<k)&f[0]?1:0)}m=m*2+(128&f[1]?1:0);var l=0;for(var p=6;p>=0;p--){l=l*2+((1<<p)&f[1]?1:0)}for(var d=2;d<=3;d++){for(var p=7;p>=0;p--){l=l*2+((1<<p)&f[d]?1:0)}}var h=m-127;var o=1;var n=1;for(var p=23;p>=0;p--){o=o+((1<<p)&l?n:0);n/=2}j=o*Math.pow(2,h)*(g?-1:1);c+=q;return j}}function TextParser(a){this.stream=a;var b=0;this.readCharacter=function(){if(b>=this.stream.length){return null}return this.stream[b++]};this.readToken=function(){var e;var d="";if(b>=this.stream.length){return null}do{e=this.stream[b++]}while(b<this.stream.length&&isSpace(e));do{d+=e;e=this.stream[b++]}while(b<this.stream.length&&!isSpace(e));return(d.length>0?d:null)};this.readLine=function(){var c="";if(b>=this.stream.length){return null}while(b<this.stream.length&&this.stream[b]!="\n"){c+=this.stream[b++]}b++;return c};this.readLineTokens=function(){var h;var g=0;var e="";var f=[];var d=this.readLine();if(d==null){return null}while(g<d.length){do{h=d[g++]}while(g<d.length&&isSpace(h));do{e+=h;h=d[g++]}while(g<d.length&&!isSpace(h));f.push(e);e=""}return f}}function XMLParser(b,a,c){this.factory=b;this.registry=a;this.contentDir=c;this.attributeStack=new Stack();this.collectionCountStack=new Stack()}XMLParser.prototype.parse=function(a){parser=new SAXDriver();parser.setDocumentHandler(this);parser.setErrorHandler(this);parser.setLexicalHandler(this);parser.parse(a)};XMLParser.prototype.processingInstruction=function(h,d){switch(h){case"bw":console.debug("TODO: "+h.toString());break;case"bwinclude":var f=new String(d);var a=this.parseTokenValue(f,'url="','"');if(a){console.debug("Processing Instruction for: "+a);var b=getFileExtension(a);switch(b){case"xml":var e=loadXMLResource(this.contentDir+"/"+a);this.parse(e);break;case"lws":var g=formatPath(a);console.debug("Include instruction for path: "+g[0]);console.debug("Include content dir: "+g[1]);var c=new LWSceneHandler();c.getAttribute("contentDirectory").setValueDirect(g[1]);var j=new LWSceneBuilder();j.setRegistry(this.factory.registry);j.visitHandler(c);c.parseFileStream(g[0]);break}}break}};XMLParser.prototype.startElement=function(a,b){if(isUpper(a[0])){this.parseAttributeContainer(a,b)}else{this.parseComplexAttribute(a,b)}};XMLParser.prototype.endElement=function(a){if(isUpper(a[0])){this.parseAttributeContainer(a)}else{this.parseComplexAttribute(a)}};XMLParser.prototype.startCDATA=function(){};XMLParser.prototype.endCDATA=function(){};XMLParser.prototype.characters=function(e,f,c){var d="";for(var a=0;a<c;a++){d+=e[f+a]}if(d.length&&!isSpace(d[0])){var b=this.attributeStack.top();if(b){deserializeAttribute(b,d)}}};XMLParser.prototype.error=function(a){alert("Error: "+a.getMessage())};XMLParser.prototype.fatalError=function(a){alert("Fatal Error: "+a.getMessage())};XMLParser.prototype.parseAttributeContainer=function(b,e){if(e){var d=this.factory.create(b);if(!d){this.attributeStack.push(null);return}if(!resolveAttributeContainerReference(d,e.m_parser.m_atts,this.registry)){deserializeAttributeContainer(d,e.m_parser.m_atts)}this.registry.registerResource(d);var a=this.attributeStack.top();if(a&&a.isCollection()){if(!a.allocatesElements()){a.push_back(d);a.setElementName(d,b);var c=this.collectionCountStack.top();c++;this.collectionCountStack.pop();this.collectionCountStack.push(c)}else{a.setElementName(a.getAt(a.Size()-1),b)}}this.attributeStack.push(d);if(d.isCollection()){this.collectionCountStack.push(0)}}else{var d=this.attributeStack.top();this.attributeStack.pop();if(d&&d.isCollection()){this.collectionCountStack.pop()}if(d){this.factory.finalize(b,d);this.registry.finalizeResource(d)}}};XMLParser.prototype.parseComplexAttribute=function(b,f){if(f){var a=this.attributeStack.top();if(!a){return}var e=a.getAttribute(b);if(!e){if(a.isCollection()){var d=this.collectionCountStack.top();d++;var c=a.Size();if(a.AppendParsedElements()){a.resize(c+1);d=c}else{if(c<=d){a.resize(d+1)}}e=a.getAt(d)}else{this.attributeStack.push(a);return}}this.attributeStack.push(e);if(e&&e.isContainer()){if(!resolveAttributeContainerReference(e,f.m_parser.m_atts,this.registry)){deserializeAttributeContainer(e,f.m_parser.m_atts)}if(e.isCollection()){this.collectionCountStack.push(0)}}else{if(e){if(!resolveComplexAttributeReference(e,f.m_parser.m_atts)){deserializeComplexAttribute(e,f.m_parser.m_atts)}}}}else{this.attributeStack.pop();if(a&&a.isCollection()){this.collectionCountStack.pop()}}};XMLParser.prototype.parsePrimitiveAttribute=function(){};XMLParser.prototype.parseTokenValue=function(c,d,b){var e=c.indexOf(d);if(e==-1){return undefined}e+=d.length;var a=c.indexOf(b,e);if(a==-1){return undefined}return c.substring(e,a)};var ePixelFormat={Unknown:-1,R8G8B8:0,B8G8R8:1,X8X8X8:2,R8G8B8A8:3,B8G8R8A8:4,A8R8G8B8:5,A8B8G8R8:6,X8X8X8X8:7,A8:8};var ePixelMap={Default:0,RGBToAlpha:1};function BytesPerPixel(a){switch(a){case ePixelFormat.R8G8B8:case ePixelFormat.B8G8R8:case ePixelFormat.X8X8X8:return 3;case ePixelFormat.R8G8B8A8:case ePixelFormat.B8G8R8A8:case ePixelFormat.A8R8G8B8:case ePixelFormat.A8B8G8R8:case ePixelFormat.X8X8X8X8:return 4;case ePixelFormat.A8:return 1;default:return 0}}function TPixel(h,f,d,e){var l=h||0;var j=f||0;var c=d||0;var k=e||0}var eImageFormat={Unknown:-1,RGB:0,RGBA:1,Alpha:2,Luminance:3,Luminance_Alpha:4};function ScaleImage(q,n,t,j,h,g,d,a,r){if(q!=ePixelFormat.R8G8B8A8){return false}var k=document.createElement("canvas");k.width=n;k.height=t;var c=k.getContext("2d");var p=c.createImageData(n,t);var o=0;for(var e=0;e<t;e++){for(var b=0;b<n;b++){for(var f=0;f<4;f++,o++){p.data[o]=h[o]}}}c.putImageData(p,0,0);var s=document.createElement("canvas");s.width=g;s.height=d;var l=s.getContext("2d");l.drawImage(k,0,0,k.width,k.height,0,0,s.width,s.height);var m=l.getImageData(0,0,g,d);o=0;for(var e=0;e<d;e++){for(var b=0;b<g;b++){for(var f=0;f<4;f++,o++){r[o]=m.data[o]}}}return true}var FRAME_FILTER_SCALE_FRAME_BIT=1;var FRAME_FILTER_INVERT_FRAME_BIT=2;var FRAME_FILTER_NEGATE_COLOR_BIT=4;var FRAME_FILTER_NEGATE_ALPHA_BIT=8;var FRAME_FILTER_ALPHA_ONOFF_BIT=16;function MediaPlayback(a,b){this.container=a;this.onload=b;this.url=null;this.video=false;this.ready=false;this.alphaPlayback=null;this.frameRetrieved=false;this.htmlImageElement=null;this.imageWidth=0;this.imageHeight=0;this.imagePitch=0;this.imagePixels=null}MediaPlayback.prototype.loadImage=function(a){this.ready=false;this.frameRetrieved=false;this.htmlImageElement=null;this.imageWidth=0;this.imageHeight=0;this.imagePitch=0;this.imagePixels=null;var b=getFileExtension(a);switch(b){case"avi":case"mpg":case"ogg":this.htmlImageElement=document.createElement("video");this.htmlImageElement.container=this;this.htmlImageElement.controls="controls";this.htmlImageElement.src="http://localhost/bwjs/BwContent/images/Bear.ogg";this.video=true;this.onVideoLoad();break;default:this.htmlImageElement=new Image();this.htmlImageElement.container=this;this.htmlImageElement.onload=MediaPlayback_OnImageLoad;this.htmlImageElement.src=a;break}this.url=a};MediaPlayback.prototype.onImageLoad=function(){var c=this.htmlImageElement;this.imageWidth=c.width;this.imageHeight=c.height;this.imagePitch=c.width*4;var b=document.createElement("canvas");var a=b.getContext("2d");b.width=c.width;b.height=c.height;a.drawImage(c,0,0);var d=a.getImageData(0,0,c.width,c.height);this.imagePixels=d.data;this.ready=true;if(this.onload){this.onload.call(this)}};MediaPlayback.prototype.onVideoLoad=function(){this.ready=true};MediaPlayback.prototype.getFrameDimensions=function(){return{width:this.imageWidth,height:this.imageHeight,pitch:this.imagePitch}};MediaPlayback.prototype.getPixelFormat=function(){return ePixelFormat.R8G8B8A8};MediaPlayback.prototype.getPixelByteAlignment=function(){return 4};MediaPlayback.prototype.getBytesPerPixel=function(){return BytesPerPixel(this.getPixelFormat())};MediaPlayback.prototype.getFramePixels=function(a,c){if(!this.ready||this.imageWidth==0||this.imageHeight==0||!this.imagePixels){return undefined}a.length=this.imagePixels.length;for(var b=0;b<this.imagePixels.length;b++){a[b]=this.imagePixels[b]}return -1};MediaPlayback.prototype.newFrameDataAvailable=function(){return this.ready&&!this.frameRetrieved};MediaPlayback.prototype.getFrameData=function(b,e,L,f,E,u,T,d){if(!this.ready||this.imageWidth==0||this.imageHeight==0||!this.imagePixels){return undefined}if(b==0||e==0||L<b||f==ePixelFormat.Unknown||!E){return undefined}var n=-1;var Q=u&FRAME_FILTER_SCALE_FRAME_BIT?true:false;var R=u&FRAME_FILTER_INVERT_FRAME_BIT?true:false;var r=u&FRAME_FILTER_NEGATE_COLOR_BIT?true:false;var G=u&FRAME_FILTER_NEGATE_ALPHA_BIT?true:false;var t=u&FRAME_FILTER_ALPHA_ONOFF_BIT?true:false;var h=this.getFrameDimensions();var V=h.width;var N=h.height;var K=h.pitch;var a=this.getPixelFormat();if(a!=ePixelFormat.R8G8B8A8){return undefined}var p=[];var y=this.getFramePixels(p,d);if(y==undefined){return undefined}if(Q&&(b!=V||e!=N)){var A=this.getBytesPerPixel();K=b*A;K+=(4-K%4)%4;var m=[];if(!ScaleImage(a,V,N,this.getPixelByteAlignment(),p,b,e,4,m)){return undefined}p=m;V=b;N=e}if(!this.alphaPlayback&&!r&&!R&&K==L&&N==e&&a==f){for(var S=0;S<E.length;S++){E[S]=p[S]}this.frameRetrieved=true;return n}var c=0;var z=0;var M=0;var q;var I=null;if(this.alphaChannel){h=this.alphaChannel.getFrameDimensions();c=h.width;z=h.height;M=h.pitch;q=this.alphaChannel.getPixelFormat();if(q!=ePixelFormat.R8G8B8A8){return undefined}var l=[];var O=this.alphaChannel.getFramePixels(l,y);if(O!=undefined){if(c!=V||z!=N){var s=this.alphaChannel.getBytesPerPixel();M=V*s;M+=(4-M%4)%4;var k=[];if(ScaleImage(q,c,z,this.alphaChannel.getPixelByteAlignment(),I,V,N,4,k)){I=k;c=V;z=N}}else{I=l}}}var x=Math.min(b,V);var B=Math.min(e,N);var g=0,J=0,F=0,j=0;switch(f){case ePixelFormat.R8G8B8:g=0;J=1;F=2;break;case ePixelFormat.B8G8R8:g=2;J=1;F=0;break;case ePixelFormat.R8G8B8A8:g=0;J=1;F=2;j=3;break;case ePixelFormat.B8G8R8A8:g=2;J=1;F=0;j=3;break;case ePixelFormat.A8R8G8B8:g=1;J=2;F=3;j=0;break;case ePixelFormat.A8B8G8R8:g=3;J=2;F=1;j=0;break}var P=0,H=0,U=0;if(R){P+=K*(B-1);if(I){H+=M*(B-1)}}var D=new TPixel(0,0,0,255);var C=new TPixel(0,0,0,255);for(var w=0;w<B;w++){for(var o=0;o<x;o++){D.red=p[P];D.green=p[P+1];D.blue=p[P+2];D.alpha=p[P+3];P+=4;if(r){D.red=255-D.red;D.green=255-D.green;D.blue=255-D.blue;D.alpha=255-D.alpha}if(I){C.red=I[H];C.green=I[H+1];C.blue=I[H+2];C.alpha=I[H+3];H+=4}if(G){C.red=255-C.red;C.green=255-C.green;C.blue=255-C.blue;C.alpha=255-C.alpha}switch(f){case ePixelFormat.R8G8B8:case ePixelFormat.B8G8R8:E[U+g]=D.red;E[U+J]=D.green;E[U+F]=D.blue;U+=3;break;case ePixelFormat.R8G8B8A8:case ePixelFormat.B8G8R8A8:case ePixelFormat.A8R8G8B8:case ePixelFormat.A8B8G8R8:switch(T){case ePixelMap.RGBToAlpha:E[U+g]=0;E[U+J]=255;E[U+F]=0;if(I){E[U+j]=((D.red+D.green+D.blue)/3)&((C.red+C.green+C.blue)/3)}else{E[U+j]=(D.red+D.green+D.blue)/3}if(t){E[U+j]=(E[U+j]<=127?0:255)}U+=4;break;case ePixelMap.Default:default:E[U+g]=D.red;E[U+J]=D.green;E[U+F]=D.blue;if(I){E[U+j]=(C.red+C.green+C.blue)/3}else{E[U+j]=D.alpha}if(t){E[U+j]=(E[U+j]<=127?0:255)}U+=4;break}break;case ePixelFormat.A8:if(I){E[U]=(C.red+C.green+C.blue)/3}else{E[U]=(D.red+D.green+D.blue)/3}if(t){E[U]=(E[U]<=127?0:255)}U+=1;break}}if(R){P-=(2*K)}if(I){if(R){H-=(2*M)}}}this.frameRetrieved=true;return n};MediaPlayback.prototype.setAlphaChannel=function(a){this.alphaPlayback=a};function MediaPlayback_OnImageLoad(){this.container.onImageLoad()}function TextureArray(b){this.textures=new Array(eTextureType.EnumCount);for(var a=0;a<this.textures.length;a++){if(b){this.textures[a]=b.textures[a].slice()}else{this.textures[a]=[]}}}StyleMgr.prototype=new AttributeContainer();StyleMgr.prototype.constructor=StyleMgr;function StyleMgr(){AttributeContainer.call(this);this.className="StyleMgr"}StyleMgr.prototype.eventPerformed=function(c,b){var a=b.stylesMap.getStyles(c.type);if(a.styles&&a.enabled){this.applyStyle(a.styles,a.target?a.target:b)}};StyleMgr.prototype.applyStyle=function(a,b){b.styles.updateStyle(a)};GraphMgr.prototype=new AttributeContainer();GraphMgr.prototype.constructor=GraphMgr;function GraphMgr(){AttributeContainer.call(this);this.className="GraphMgr";this.renderContext=null;this.renderState=null;this.lightIndex=0;this.material=null;this.dissolve=null;this.drawTextures=true;this.textureArrayStack=new Stack(new TextureArray());this.projectionTextureArrayStack=new Stack(new TextureArray());this.labelIndex=1;this.styleMgr=new StyleMgr();this.name=new StringAttr("GraphMgr");this.registerAttribute(this.name,"name")}GraphMgr.prototype.setRenderContext=function(a){this.renderContext=a;this.renderState=new RenderState(a)};GraphMgr.prototype.getAvailableLightIndex=function(){return this.lightIndex++};GraphMgr.prototype.getCurrentMaterial=function(){return this.material};GraphMgr.prototype.setCurrentMaterial=function(a){this.material=a};GraphMgr.prototype.getCurrentDissolve=function(){return this.dissolve};GraphMgr.prototype.setCurrentDissolve=function(a){this.dissolve=a};GraphMgr.prototype.getDrawTextures=function(){return this.drawTextures};GraphMgr.prototype.setDrawTextures=function(a){this.drawTextures=a};GraphMgr.prototype.getNextLabelIndex=function(){return this.labelIndex++};GraphMgr.prototype.reset=function(){this.lightIndex=0;this.labelIndex=1;this.setCurrentDissolve(null);this.setCurrentMaterial(null);this.setDrawTextures(true);for(var a=0;a<gl_MaxLights;a++){this.renderContext.enableLight(a,false)}};Node.prototype=new AttributeContainer();Node.prototype.constructor=Node;function Node(){AttributeContainer.call(this);this.className="Node";this.attrType=eAttrType.Node;this.children=[];this.parents=[];this.name=new StringAttr("");this.enabled=new BooleanAttr(true);this.orphan=new BooleanAttr(false);this.registerAttribute(this.name,"name");this.registerAttribute(this.enabled,"enabled");this.registerAttribute(this.orphan,"orphan")}Node.prototype.isNode=function(){return true};Node.prototype.addChild=function(a){this.children.push(a);a.addParent(this)};Node.prototype.insertChild=function(b,a){this.children.splice(a,0,b);b.addParent(this)};Node.prototype.removeChild=function(a){this.children.splice(this.children.indexOf(a),1);a.removeParent(this)};Node.prototype.replaceChild=function(a,b){this.children.splice(this.children.indexOf(a),1,b);a.removeParent(this);b.addParent(this)};Node.prototype.getChild=function(a){if(this.children.length>a){return this.children[a]}return null};Node.prototype.getNamedChild=function(a){for(var b=0;b<this.children.length;b++){if(this.children[b].name.getValueDirect().join("")==a){return this.children[b]}}return null};Node.prototype.getChildCount=function(){return this.children.length};Node.prototype.getParent=function(a){if(this.parents.length>a){return this.parents[a]}return null};Node.prototype.getParentCount=function(){return this.parents.length};Node.prototype.addParent=function(a){this.parents.push(a)};Node.prototype.removeParent=function(a){this.parents.splice(this.parents.indexOf(a),1)};Node.prototype.update=function(c,b){c.path.push(this);if(b){for(var a=0;a<this.children.length;a++){this.children[a].update(c,b)}}c.path.pop()};Node.prototype.updateNode=function(b,c,a){b.update(c,a)};Node.prototype.apply=function(e,d,c){var a=this.enabled.getValueDirect();if(!a){return}d.path.push(this);if(c){for(var b=0;b<this.children.length;b++){this.children[b].apply(e,d,c)}}d.path.pop()};Node.prototype.applyNode=function(b,d,c,a){b.apply(d,c,a)};SGNode.prototype=new Node();SGNode.prototype.constructor=SGNode;function SGNode(){Node.call(this);this.className="SGNode";this.graphMgr=null;this.modificationCount=0}SGNode.prototype.setGraphMgr=function(a){this.graphMgr=a};SGNode.prototype.update=function(b,a){Node.prototype.update.call(this,b,a)};SGNode.prototype.apply=function(c,b,a){Node.prototype.apply.call(this,c,b,a)};SGNode.prototype.incrementModificationCount=function(){this.modificationCount++};RenderableElement.prototype=new SGNode();RenderableElement.prototype.constructor=RenderableElement;function RenderableElement(){SGNode.call(this);this.className="RenderableElement";this.attrType=eAttrType.RenderableElement;this.bbox=new BBoxAttr();this.renderSequenceSlot=new NumberAttr(0);this.hasFocus=new TernaryAttr(0);this.selected=new TernaryAttr(0);this.styles=new StylesAttr();this.stylesMap=new StylesMapAttr();this.renderableElementStyle=new RenderableElementStyleAttr();this.registerAttribute(this.bbox,"bbox");this.registerAttribute(this.renderSequenceSlot,"renderSequenceSlot");this.registerAttribute(this.hasFocus,"hasFocus");this.registerAttribute(this.selected,"selected");this.registerAttribute(this.styles,"styles");this.registerAttribute(this.stylesMap,"stylesMap");this.registerAttribute(this.renderableElementStyle,"renderableElementStyle")}RenderableElement.prototype.setRegistry=function(a){this.stylesMap.setRegistry(a);SGNode.prototype.setRegistry.call(this,a)};RenderableElement.prototype.update=function(b,a){SGNode.prototype.update.call(this,b,a)};RenderableElement.prototype.apply=function(c,b,a){SGNode.prototype.apply.call(this,c,b,a)};ParentableMotionElement.prototype=new RenderableElement();ParentableMotionElement.prototype.constructor=ParentableMotionElement;function ParentableMotionElement(){RenderableElement.call(this);this.className="ParentableMotionElement";this.attrType=eAttrType.ParentableMotionElement;this.translationMatrix=new Matrix4x4();this.rotationQuat=new Quaternion();this.rotationMatrix=new Matrix4x4();this.scaleMatrix=new Matrix4x4();this.pivotMatrix=new Matrix4x4();this.sectorTranslationMatrix=new Matrix4x4();this.stackMatrix=new Matrix4x4();this.transformSimple=new Matrix4x4();this.transformCompound=new Matrix4x4();this.sectorTransformSimple=new Matrix4x4();this.sectorTransformCompound=new Matrix4x4();this.updatePosition=false;this.updateScale=false;this.updatePivot=false;this.updateSectorPosition=false;this.updateInheritance=false;this.inheritsPosition=true;this.inheritsRotation=true;this.inheritsScale=true;this.inheritsPivot=true;this.motionParent=null;this.position=new Vector3DAttr(0,0,0);this.rotation=new Vector3DAttr(0,0,0);this.scale=new Vector3DAttr(1,1,1);this.pivot=new Vector3DAttr(0,0,0);this.center=new Vector3DAttr(0,0,0);this.worldCenter=new Vector3DAttr(0,0,0);this.worldPosition=new Vector3DAttr(0,0,0);this.worldRotation=new Vector3DAttr(0,0,0);this.worldScale=new Vector3DAttr(1,1,1);this.screenPosition=new Vector3DAttr(0,0,0);this.sectorOrigin=new Vector3DAttr(0,0,0);this.sectorPosition=new Vector3DAttr(0,0,0);this.sectorWorldCenter=new Vector3DAttr(0,0,0);this.sectorWorldPosition=new Vector3DAttr(0,0,0);this.worldTransform=new Matrix4x4Attr(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);this.sectorWorldTransform=new Matrix4x4Attr(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);this.parent=new StringAttr("");this.inheritPosition_X=new BooleanAttr(true);this.inheritPosition_Y=new BooleanAttr(true);this.inheritPosition_Z=new BooleanAttr(true);this.inheritRotation_X=new BooleanAttr(true);this.inheritRotation_Y=new BooleanAttr(true);this.inheritRotation_Z=new BooleanAttr(true);this.inheritScale_X=new BooleanAttr(true);this.inheritScale_Y=new BooleanAttr(true);this.inheritScale_Z=new BooleanAttr(true);this.inheritPivot_X=new BooleanAttr(true);this.inheritPivot_Y=new BooleanAttr(true);this.inheritPivot_Z=new BooleanAttr(true);this.position.addModifiedCB(ParentableMotionElement_PositionModifiedCB,this);this.rotation.addModifiedCB(ParentableMotionElement_RotationModifiedCB,this);this.scale.addModifiedCB(ParentableMotionElement_ScaleModifiedCB,this);this.pivot.addModifiedCB(ParentableMotionElement_PivotModifiedCB,this);this.sectorOrigin.addModifiedCB(ParentableMotionElement_SectorOriginModifiedCB,this);this.sectorPosition.addModifiedCB(ParentableMotionElement_SectorPositionModifiedCB,this);this.parent.addModifiedCB(ParentableMotionElement_ParentModifiedCB,this);this.inheritPosition_X.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritPosition_Y.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritPosition_Z.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritRotation_X.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritRotation_Y.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritRotation_Z.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritScale_X.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritScale_Y.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritScale_Z.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritPivot_X.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritPivot_Y.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.inheritPivot_Z.addModifiedCB(ParentableMotionElement_InheritanceModifiedCB,this);this.registerAttribute(this.position,"position");this.registerAttribute(this.rotation,"rotation");this.registerAttribute(this.scale,"scale");this.registerAttribute(this.pivot,"pivot");this.registerAttribute(this.center,"center");this.registerAttribute(this.worldCenter,"worldCenter");this.registerAttribute(this.worldPosition,"worldPosition");this.registerAttribute(this.worldRotation,"worldRotation");this.registerAttribute(this.worldScale,"worldScale");this.registerAttribute(this.screenPosition,"screenPosition");this.registerAttribute(this.sectorOrigin,"sectorOrigin");this.registerAttribute(this.sectorPosition,"sectorPosition");this.registerAttribute(this.sectorWorldCenter,"sectorWorldCenter");this.registerAttribute(this.sectorWorldPosition,"sectorWorldPosition");this.registerAttribute(this.worldTransform,"worldTransform");this.registerAttribute(this.sectorWorldTransform,"sectorWorldTransform");this.registerAttribute(this.parent,"parent");this.registerAttribute(this.inheritPosition_X,"inheritPosition_X");this.registerAttribute(this.inheritPosition_Y,"inheritPosition_Y");this.registerAttribute(this.inheritPosition_Z,"inheritPosition_Z");this.registerAttribute(this.inheritRotation_X,"inheritRotation_X");this.registerAttribute(this.inheritRotation_Y,"inheritRotation_Y");this.registerAttribute(this.inheritRotation_Z,"inheritRotation_Z");this.registerAttribute(this.inheritScale_X,"inheritScale_X");this.registerAttribute(this.inheritScale_Y,"inheritScale_Y");this.registerAttribute(this.inheritScale_Z,"inheritScale_Z");this.registerAttribute(this.inheritPivot_X,"inheritPivot_X");this.registerAttribute(this.inheritPivot_X,"inheritPivot_Y");this.registerAttribute(this.inheritPivot_X,"inheritPivot_Z")}ParentableMotionElement.prototype.getTransform=function(){var a=new Matrix4x4();a.loadMatrix(this.transformCompound);return a};ParentableMotionElement.prototype.getSectorTransform=function(){var a=new Matrix4x4();a.loadMatrix(this.sectorTransformCompound);return a};ParentableMotionElement.prototype.update=function(b,a){if(this.updateInheritance){this.updateInheritance=false;this.inheritsPosition=this.inheritPosition_X.getValueDirect()&&this.inheritPosition_Y.getValueDirect()&&this.inheritPosition_Z.getValueDirect();this.inheritsRotation=this.inheritRotation_X.getValueDirect()&&this.inheritRotation_Y.getValueDirect()&&this.inheritRotation_Z.getValueDirect();this.inheritsScale=this.inheritScale_X.getValueDirect()&&this.inheritScale_Y.getValueDirect()&&this.inheritScale_Z.getValueDirect();this.inheritsPivot=this.inheritPivot_X.getValueDirect()&&this.inheritPivot_Y.getValueDirect()&&this.inheritPivot_Z.getValueDirect()}this.updateSimpleTransform();if(this.motionParent){this.motionParent.update(b,false)}this.updateCompoundTransform();this.updateWorldMotionInfo();RenderableElement.prototype.update.call(this,b,a)};ParentableMotionElement.prototype.apply=function(e,d,c){var b=this.enabled.getValueDirect();if(!b){RenderableElement.prototype.apply.call(this,e,d,c);return}switch(e){case"render":var a=toScreenSpace(this.sectorWorldPosition.getValueDirect(),d.viewMatrix,d.projMatrix,d.viewport);this.screenPosition.setValueDirect(a.x,a.y,a.z);break}RenderableElement.prototype.apply.call(this,e,d,c)};ParentableMotionElement.prototype.applyTransform=function(){this.graphMgr.renderContext.modelViewMatrixStack.leftMultiply(this.sectorTransformCompound);this.graphMgr.renderContext.applyModelViewTransform()};ParentableMotionElement.prototype.updateSimpleTransform=function(){var b=false;if(this.updatePosition||this.updateRotation||this.updateScale||this.updatePivot){var a;if(this.updatePosition){this.updatePosition=false;a=this.position.getValueDirect();this.translationMatrix.loadTranslation(a.x,a.y,a.z);b=true}if(this.updateRotation){this.updateRotation=false;a=this.rotation.getValueDirect();this.rotationQuat.loadXYZAxisRotation(a.x,a.y,a.z);this.rotationMatrix=this.rotationQuat.getMatrix();b=true}if(this.updateScale){this.updateScale=false;a=this.scale.getValueDirect();this.scaleMatrix.loadScale(a.x,a.y,a.z);b=true}if(this.updatePivot){this.updatePivot=false;a=this.pivot.getValueDirect();this.pivotMatrix.loadTranslation(-a.x,-a.y,-a.z);b=true}if(this.updateSectorPosition){this.updateSectorPosition=false;a=this.sectorPosition.getValueDirect();this.sectorTranslationMatrix.loadTranslation(a.x,a.y,a.z);b=true}if(b){var c=new Matrix4x4();c.loadMatrix(this.pivotMatrix.multiply(this.scaleMatrix.multiply(this.rotationMatrix)));this.transformSimple.loadMatrix(c.multiply(this.translationMatrix));this.sectorTransformSimple.loadMatrix(c.multiply(this.sectorTranslationMatrix))}}};ParentableMotionElement.prototype.updateCompoundTransform=function(){this.transformCompound.loadMatrix(this.transformSimple);this.sectorTransformCompound.loadMatrix(this.sectorTransformSimple);if(this.motionParent){if(this.inheritsPosition&&this.inheritsRotation&&this.inheritsScale&&this.inheritsPivot){this.transformCompound.loadMatrix(this.transformCompound.multiply(this.motionParent.transformCompound));this.sectorTransformCompound.loadMatrix(this.sectorTransformCompound.multiply(this.motionParent.sectorTransformCompound))}else{}}};ParentableMotionElement.prototype.updateWorldMotionInfo=function(){this.worldTransform.setValueDirect(this.transformCompound);this.sectorWorldTransform.setValueDirect(this.sectorTransformCompound);this.updateWorldCenter();this.updateWorldPosition();this.updateWorldRotation();this.updateWorldScale()};ParentableMotionElement.prototype.updateWorldCenter=function(){var a=this.center.getValueDirect();a=this.transformCompound.transform(a.x,a.y,a.z,1);this.worldCenter.setValueDirect(a.x,a.y,a.z);a=this.center.getValueDirect();a=this.sectorTransformCompound.transform(a.x,a.y,a.z,1);this.sectorWorldCenter.setValueDirect(a.x,a.y,a.z)};ParentableMotionElement.prototype.updateWorldPosition=function(){var a=this.transformCompound.transform(0,0,0,1);this.worldPosition.setValueDirect(a.x,a.y,a.z);a=this.sectorTransformCompound.transform(0,0,0,1);this.sectorWorldPosition.setValueDirect(a.x,a.y,a.z)};ParentableMotionElement.prototype.updateWorldRotation=function(){var a=this.transformCompound.getRotationAngles();this.worldRotation.setValueDirect(a.x,a.y,a.z)};ParentableMotionElement.prototype.updateWorldScale=function(){var a=this.transformCompound.getScalingFactors();this.worldScale.setValueDirect(a.x,a.y,a.z)};ParentableMotionElement.prototype.synchronizePosition=function(){var c=new Vector3D();if(this.motionParent){c.x=0;c.y=0;c.z=0}else{c=this.sectorOrigin.getValueDirect()}var b=this.sectorPosition.getValueDirect();var a=new Vector3D();a.x=c.x+b.x;a.y=c.y+b.y;a.z=c.z+b.z;this.position.removeModifiedCB(ParentableMotionElement_PositionModifiedCB,this);this.position.setValueDirect(a.x,a.y,a.z);this.position.addModifiedCB(ParentableMotionElement_PositionModifiedCB,this);this.updatePosition=true};ParentableMotionElement.prototype.synchronizeSectorPosition=function(){var c=new Vector3D;if(this.motionParent){c.x=0;c.y=0;c.z=0}else{c=this.sectorOrigin.getValueDirect()}var a=this.position.getValueDirect();var b=new Vector3D;b.x=a.x-c.x;b.y=a.y-c.y;b.z=a.z-c.z;this.sectorPosition.removeModifiedCB(ParentableMotionElement_SectorPositionModifiedCB,this);this.sectorPosition.setValueDirect(b.x,b.y,b.z);this.sectorPosition.addModifiedCB(ParentableMotionElement_SectorPositionModifiedCB,this);this.updateSectorPosition=true};ParentableMotionElement.prototype.getDirectionVectors=function(){var a=this.sectorTransformCompound.transform(0,1,0,0);var c=this.sectorTransformCompound.transform(1,0,0,0);var b=this.sectorTransformCompound.transform(0,0,1,0);return{up:a,right:c,forward:b}};ParentableMotionElement.prototype.setMotionParent=function(a){this.motionParent=a;this.synchronizeSectorPosition()};function ParentableMotionElement_PositionModifiedCB(b,a){a.updatePosition=true;a.synchronizeSectorPosition();a.incrementModificationCount()}function ParentableMotionElement_RotationModifiedCB(b,a){a.updateRotation=true;a.incrementModificationCount()}function ParentableMotionElement_ScaleModifiedCB(b,a){a.updateScale=true;a.incrementModificationCount()}function ParentableMotionElement_PivotModifiedCB(b,a){a.updatePivot=true;a.incrementModificationCount()}function ParentableMotionElement_SectorOriginModifiedCB(b,a){a.synchronizeSectorPosition();a.incrementModificationCount()}function ParentableMotionElement_SectorPositionModifiedCB(b,a){a.updateSectorPosition=true;a.synchronizePosition();a.incrementModificationCount()}function ParentableMotionElement_ParentModifiedCB(b,a){a.setMotionParent(a.registry.find(b.getValueDirect().join("")))}function ParentableMotionElement_InheritanceModifiedCB(b,a){a.updateInheritance=true;a.incrementModificationCount()}function DirectiveParams(){this.directive=null;this.path=new Stack();this.userData=null}Directive.prototype=new AttributeContainer();Directive.prototype.constructor=Directive;function Directive(){AttributeContainer.call(this);this.className="Directive";this.attrType=eAttrType.Directive;this.name=new StringAttr("");this.enabled=new BooleanAttr(true);this.rootNode=new ReferenceAttr(null);this.registerAttribute(this.name,"name");this.registerAttribute(this.enabled,"enabled");this.registerAttribute(this.rootNode,"rootNode")}SGDirective.prototype=new Directive();SGDirective.prototype.constructor=SGDirective;function SGDirective(){Directive.call(this);this.className="SGDirective";this.graphMgr=null}SGDirective.prototype.setGraphMgr=function(a){this.graphMgr=a};UpdateParams.prototype=new DirectiveParams();UpdateParams.prototype.constructor=UpdateParams();function UpdateParams(){DirectiveParams.call(this);this.pass=0;this.nextPass=[]}UpdateDirective.prototype=new SGDirective();UpdateDirective.prototype.constructor=UpdateDirective;function UpdateDirective(){SGDirective.call(this);this.className="UpdateDirective";this.attrType=eAttrType.UpdateDirective;this.name.setValueDirect("UpdateDirective")}UpdateDirective.prototype.execute=function(a){a=a||this.rootNode.getValueDirect();var d=new UpdateParams();d.directive=this;a.update(d,true);while(d.nextPass.length>0){d.pass++;var b=[];for(var c=0;c<d.nextPass.length;c++){b[c]=d.nextPass[c]}d.nextPass.length=0;for(var c=0;c<b.length;c++){b[c].update(d,false)}}};Camera.prototype=new ParentableMotionElement();Camera.prototype.constructor=Camera;function Camera(){ParentableMotionElement.call(this);this.className="Camera";this.attrType=eAttrType.Camera;this.projectionMatrix=new Matrix4x4();this.viewport=new Viewport();this.updateNearDistance=false;this.updateFarDistance=false;this.updateClipPlanes=true;this.near=0;this.far=0;this.nearDistance=new NumberAttr(0);this.farDistance=new NumberAttr(0);this.viewVolume=new ViewVolumeAttr();this.sectorOriginUpdatesEnabled=new BooleanAttr(false);this.nearDistance.addModifiedCB(Camera_NearDistanceModifiedCB,this);this.farDistance.addModifiedCB(Camera_FarDistanceModifiedCB,this);this.registerAttribute(this.nearDistance,"nearDistance");this.registerAttribute(this.farDistance,"farDistance");this.registerAttribute(this.viewVolume,"viewVolume")}Camera.prototype.update=function(b,a){if(this.updateNearDistance){this.updateNearDistance=false;this.near=this.nearDistance.getValueDirect();this.updateClipPlanes=true}if(this.updateFarDistance){this.updateFarDistance=false;this.far=this.farDistance.getValueDirect();this.updateClipPlanes=true}ParentableMotionElement.prototype.update.call(this,b,a)};Camera.prototype.apply=function(e,d,c){var b=this.enabled.getValueDirect();if(!b){ParentableMotionElement.prototype.apply.call(this,e,d,c);return}switch(e){case"render":this.applyTransform();d.projMatrix.loadMatrix(this.projectionMatrix);d.viewMatrix.loadMatrix(this.sectorTransformCompound);d.viewMatrix.invert();break;case"rayPick":if(!d.camera||d.camera==this){var a=this.getViewSpaceRay(d.viewport,d.clickPoint);d.rayOrigin=a.origin;d.rayDir=a.direction;d.currentCamera=this;d.nearDistance=this.nearDistance.getValueDirect();d.farDistance=this.farDistance.getValueDirect();d.viewMatrix.loadMatrix(this.sectorTransformCompound);d.viewMatrix.invert()}break;case"bbox":d.viewMatrix.loadMatrix(this.sectorTransformCompound);d.viewMatrix.invert();break}ParentableMotionElement.prototype.apply.call(this,e,d,c)};Camera.prototype.applyTransform=function(){var a=new Matrix4x4();a.loadMatrix(this.sectorTransformCompound);a.invert();this.graphMgr.renderContext.modelViewMatrixStack.loadMatrix(a);this.graphMgr.renderContext.applyModelViewTransform()};function Camera_NearDistanceModifiedCB(b,a){a.updateNearDistance=true;a.incrementModificationCount()}function Camera_FarDistanceModifiedCB(b,a){a.updateFarDistance=true;a.incrementModificationCount()}OrthographicCamera.prototype=new Camera();OrthographicCamera.prototype.constructor=OrthographicCamera;function OrthographicCamera(){Camera.call(this);this.className="OrthographicCamera";this.attrType=eAttrType.OrthographicCamera;this.updateWidth=false;this.width=new NumberAttr(2);this.width.addModifiedCB(OrthographicCamera_WidthModifiedCB,this);this.registerAttribute(this.width,"width")}OrthographicCamera.prototype.update=function(b,a){if(this.updateWidth){this.updateWidth=false;this.updateClipPlanes=true}Camera.prototype.update.call(this,b,a)};OrthographicCamera.prototype.apply=function(d,c,b){var a=this.enabled.getValueDirect();if(!a){Camera.prototype.apply.call(this,d,c,b);return}switch(d){case"render":if(!this.viewport.equals(c.viewport)){this.viewport=c.viewport;this.updateClipPlanes=true}if(this.updateClipPlanes){this.updateClipPlanes=false;this.setClipPlanes()}this.applyOrthographicTransform();break}Camera.prototype.apply.call(this,d,c,b)};OrthographicCamera.prototype.setClipPlanes=function(){var b=this.width.getValueDirect();var a=b*this.viewport.height/this.viewport.width;this.top=a/2;this.bottom=-this.top;this.right=b/2;this.left=-this.right;this.projectionMatrix.loadMatrix(this.graphMgr.renderContext.orthographicMatrixLH(this.left,this.right,this.top,this.bottom,this.near,this.far));var c=new ViewVolume();c.setOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far);this.viewVolume.setValueDirect(c.left,c.right,c.top,c.bottom,c.near,c.far)};OrthographicCamera.prototype.applyOrthographicTransform=function(){this.graphMgr.renderContext.projectionMatrixStack.top().loadMatrix(this.projectionMatrix);this.graphMgr.renderContext.applyProjectionTransform()};OrthographicCamera.prototype.getViewSpaceRay=function(b,e){var a=((e.x-b.x)/b.width*2-1);var h=-((e.y-b.y)/b.height*2-1);var f=(this.right-this.left)/2;var d=(this.top-this.bottom)/2;var c=new Vector3D(a*f,h*d,this.near);var g=new Vector3D(0,0,1);return{origin:c,direction:g}};function OrthographicCamera_WidthModifiedCB(b,a){a.updateWidth=true;a.incrementModificationCount()}PerspectiveCamera.prototype=new Camera();PerspectiveCamera.prototype.constructor=PerspectiveCamera;function PerspectiveCamera(){Camera.call(this);this.className="PerspectiveCamera";this.attrType=eAttrType.PerspectiveCamera;this.updateZoom=false;this.fovyRadians=0;this.left=0;this.right=0;this.top=0;this.bottom=0;this.zoom=new NumberAttr(0);this.zoom.addModifiedCB(PerspectiveCamera_ZoomModifiedCB,this);this.registerAttribute(this.zoom,"zoom")}PerspectiveCamera.prototype.update=function(b,a){if(this.updateZoom){this.updateZoom=false;this.fovyRadians=2*Math.atan2(1,this.zoom.getValueDirect());this.updateClipPlanes=true}Camera.prototype.update.call(this,b,a)};PerspectiveCamera.prototype.apply=function(d,c,b){var a=this.enabled.getValueDirect();if(!a){Camera.prototype.apply.call(this,d,c,b);return}switch(d){case"render":if(!this.viewport.equals(c.viewport)){this.viewport=c.viewport;this.updateClipPlanes=true}if(this.updateClipPlanes){this.updateClipPlanes=false;this.setClipPlanes()}this.applyPerspectiveTransform();break}Camera.prototype.apply.call(this,d,c,b)};PerspectiveCamera.prototype.setClipPlanes=function(){this.top=Math.tan(this.fovyRadians/2)*this.near;this.bottom=-this.top;this.right=this.top*(this.viewport.width/this.viewport.height);this.left=-this.right;this.projectionMatrix.loadMatrix(this.graphMgr.renderContext.perspectiveMatrixLH(this.left,this.right,this.top,this.bottom,this.near,this.far));var a=new ViewVolume();a.setPerspective(this.fovyRadians,this.viewport.width/this.viewport.height,this.near,this.far);this.viewVolume.setValueDirect(a.left,a.right,a.top,a.bottom,a.near,a.far)};PerspectiveCamera.prototype.applyPerspectiveTransform=function(){this.graphMgr.renderContext.projectionMatrixStack.top().loadMatrix(this.projectionMatrix);this.graphMgr.renderContext.applyProjectionTransform()};PerspectiveCamera.prototype.getViewSpaceRay=function(d,e){var b=((e.x-d.x)/d.width*2-1);var a=-((e.y-d.y)/d.height*2-1);var c=this.fovyRadians;var f=2*Math.atan(d.width/d.height*Math.tan(c/2));var k=Math.tan(f/2)*this.far;var j=Math.tan(c/2)*this.far;var h=new Vector3D(0,0,0);var g=new Vector3D(b*k,a*j,this.far);return{origin:h,direction:g}};function PerspectiveCamera_ZoomModifiedCB(b,a){a.updateZoom=true;a.incrementModificationCount()}Light.prototype=new ParentableMotionElement();Light.prototype.constructor=Light;function Light(){ParentableMotionElement.call(this);this.className="Light";this.attrType=eAttrType.Light;this.updateAmbient=true;this.updateDiffuse=true;this.updateSpecular=true;this.updateConstantAttenuation=true;this.updateLinearAttenuation=true;this.updateQuadraticAttenuation=true;this.lightDesc=new LightDesc();this.lightDesc.validMembersMask=0;this.lightIndex=0;this.setLightDesc=false;this.ambient=new ColorAttr(0,0,0,1);this.diffuse=new ColorAttr(1,1,1,1);this.specular=new ColorAttr(1,1,1,1);this.constantAttenuation=new NumberAttr(1);this.linearAttenuation=new NumberAttr(0);this.quadraticAttenuation=new NumberAttr(0);this.shadowCaster=new BooleanAttr(false);this.ambient.addModifiedCB(Light_AmbientModifiedCB,this);this.diffuse.addModifiedCB(Light_DiffuseModifiedCB,this);this.specular.addModifiedCB(Light_SpecularModifiedCB,this);this.constantAttenuation.addModifiedCB(Light_ConstantAttenuationModifiedCB,this);this.linearAttenuation.addModifiedCB(Light_LinearAttenuationModifiedCB,this);this.quadraticAttenuation.addModifiedCB(Light_QuadraticAttenuationModifiedCB,this);this.registerAttribute(this.ambient,"ambient");this.registerAttribute(this.diffuse,"diffuse");this.registerAttribute(this.specular,"specular");this.registerAttribute(this.constantAttenuation,"constantAttenuation");this.registerAttribute(this.linearAttenuation,"linearAttenuation");this.registerAttribute(this.quadraticAttenuation,"quadraticAttenuation");this.registerAttribute(this.shadowCaster,"shadowCaster")}Light.prototype.setGraphMgr=function(a){this.lightIndex=a.getAvailableLightIndex();ParentableMotionElement.prototype.setGraphMgr.call(this,a)};Light.prototype.update=function(b,a){if(this.updateAmbient){this.updateAmbient=false;this.lightDesc.ambient.copy(this.ambient.getValueDirect());this.lightDesc.validMembersMask|=LIGHTDESC_AMBIENT_BIT}if(this.updateDiffuse){this.updateDiffuse=false;this.lightDesc.diffuse.copy(this.diffuse.getValueDirect());this.lightDesc.validMembersMask|=LIGHTDESC_DIFFUSE_BIT}if(this.updateSpecular){this.updateSpecular=false;this.lightDesc.specular.copy(this.specular.getValueDirect());this.lightDesc.validMembersMask|=LIGHTDESC_SPECULAR_BIT}if(this.updateConstantAttenuation){this.updateConstantAttenuation=false;this.lightDesc.constantAttenuation=this.constantAttenuation.getValueDirect();this.lightDesc.validMembersMask|=LIGHTDESC_CONSTANT_ATT_BIT}if(this.updateLinearAttenuation){this.updateLinearAttenuation=false;this.lightDesc.linearAttenuation=this.linearAttenuation.getValueDirect();this.lightDesc.validMembersMask|=LIGHTDESC_LINEAR_ATT_BIT}if(this.updateQuadraticAttenuation){this.updateQuadraticAttenuation=false;this.lightDesc.quadraticAttenuation=this.quadraticAttenuation.getValueDirect();this.lightDesc.validMembersMask|=LIGHTDESC_QUADRATIC_ATT_BIT}if(this.lightDesc.validMembersMask){this.setLightDesc=true}ParentableMotionElement.prototype.update.call(this,b,a)};Light.prototype.apply=function(d,c,b){var a=this.enabled.getValueDirect();if(!a){switch(d){case"render":this.setLightEnabled();break}ParentableMotionElement.prototype.apply.call(this,d,c,b);return}switch(d){case"render":if(this.setLightDesc){this.setLightDesc=false;this.applyLightDesc()}this.setLightEnabled();break}ParentableMotionElement.prototype.apply.call(this,d,c,b)};Light.prototype.applyLightDesc=function(){this.graphMgr.renderContext.setLight(this.lightIndex,this.lightDesc)};Light.prototype.setLightEnabled=function(){this.graphMgr.renderContext.enableLight(this.lightIndex,this.enabled.getValueDirect()?1:0)};function Light_AmbientModifiedCB(b,a){a.updateAmbient=true;a.incrementModificationCount()}function Light_DiffuseModifiedCB(b,a){a.updateDiffuse=true;a.incrementModificationCount()}function Light_SpecularModifiedCB(b,a){a.updateSpecular=true;a.incrementModificationCount()}function Light_ConstantAttenuationModifiedCB(b,a){a.updateConstantAttenuation=true;a.incrementModificationCount()}function Light_LinearAttenuationModifiedCB(b,a){a.updateLinearAttenuation=true;a.incrementModificationCount()}function Light_QuadraticAttenuationModifiedCB(b,a){a.updateQuadraticAttenuation=true;a.incrementModificationCount()}DirectionalLight.prototype=new Light();DirectionalLight.prototype.constructor=DirectionalLight;function DirectionalLight(){Light.call(this);this.className="DirectionalLight";this.attrType=eAttrType.DirectionalLight;this.lightDesc.type="directional"}DirectionalLight.prototype.update=function(b,a){this.validMembersMask=0;Light.prototype.update.call(this,b,a)};DirectionalLight.prototype.apply=function(e,d,b){var a=this.enabled.getValueDirect();if(!a){Light.prototype.apply.call(this,e,d,b);return}switch(e){case"render":var c=this.sectorTransformCompound.transform(0,0,1,0);this.lightDesc.direction.copy(c);this.lightDesc.validMembersMask|=LIGHTDESC_DIRECTION_BIT;this.setLightDesc=true;break}Light.prototype.apply.call(this,e,d,b)};PointLight.prototype=new Light();PointLight.prototype.constructor=PointLight;function PointLight(){Light.call(this);this.className="PointLight";this.attrType=eAttrType.PointLight;this.lightDesc.type="point";this.updateRange=false;this.range=new NumberAttr();this.range.addModifiedCB(PointLight_RangeModifiedCB,this);this.registerAttribute(this.range,"range")}PointLight.prototype.update=function(b,a){this.validMembersMask=0;if(this.updateRange){this.updateRange=false;this.lightDesc.range=this.range.getValueDirect();this.lightDesc.validMembersMask|=LIGHTDESC_RANGE_BIT}Light.prototype.update.call(this,b,a)};PointLight.prototype.apply=function(e,d,c){var b=this.enabled.getValueDirect();if(!b){Light.prototype.apply.call(this,e,d,c);return}switch(e){case"render":var a=this.sectorTransformCompound.transform(0,0,0,1);this.lightDesc.position.copy(a);this.lightDesc.validMembersMask|=LIGHTDESC_POSITION_BIT;this.lightDesc.outerConeDegrees=180;this.lightDesc.validMembersMask|=LIGHTDESC_OUTER_CONE_DEG_BIT;this.setLightDesc=true;break}Light.prototype.apply.call(this,e,d,c)};function PointLight_RangeModifiedCB(b,a){a.updateRange=true;a.incrementModificationCount()}GlobalIllumination.prototype=new SGNode();GlobalIllumination.prototype.constructor=GlobalIllumination;function GlobalIllumination(){SGNode.call(this);this.className="GlobalIllumination";this.attrType=eAttrType.GlobalIllumination;this.updateAmbient=true;this.setGlobalIllumination=false;this.ambient=new ColorAttr(0,0,0,1);this.ambient.addModifiedCB(GlobalIllumination_AmbientModifiedCB,this);this.registerAttribute(this.ambient,"ambient")}GlobalIllumination.prototype.update=function(b,a){if(this.updateAmbient){this.updateAmbient=false;this.setGlobalIllumination=true}SGNode.prototype.update.call(this,b,a)};GlobalIllumination.prototype.apply=function(d,c,b){var a=this.enabled.getValueDirect();if(!a){ParentableMotionElement.prototype.apply.call(this,d,c,b);return}switch(d){case"render":if(this.setGlobalIllumination){this.setGlobalIllumination=false;this.applyGlobalIllumination()}break}SGNode.prototype.apply.call(this,d,c,b)};GlobalIllumination.prototype.applyGlobalIllumination=function(){this.graphMgr.renderContext.setGlobalIllumination(this.ambient.getValueDirect())};function GlobalIllumination_AmbientModifiedCB(b,a){a.updateAmbient=true;a.incrementModificationCount()}Group.prototype=new SGNode();Group.prototype.constructor=Group;function Group(){SGNode.call(this);this.className="Group";this.attrType=eAttrType.Group;this.proxyChildAttrs=new BooleanAttr(false);this.proxyChildAttrs.addModifiedCB(Group_ProxyChildAttrsModifiedCB,this);this.registerAttribute(this.proxyChildAttrs,"proxyChildAttrs")}Group.prototype.update=function(b,a){SGNode.prototype.update.call(this,b,a)};Group.prototype.apply=function(c,b,a){SGNode.prototype.apply.call(this,c,b,a)};Group.prototype.proxyChildAttrsModified=function(){};function Group_ProxyChildAttrsModifiedCB(b,a){a.proxyChildAttrsModified()}function Group_ProxiedAttrModifiedCB(a,b){b.group.proxiedAttrModified(b.proxiedNodeTypeString,a,b.proxiedAttrName)}Isolator.prototype=new Group();Isolator.prototype.constructor=Isolator;function Isolator(){Group.call(this);this.className="Isolator";this.attrType=eAttrType.Isolator;this.updateIsolateTransforms=true;this.updateIsolateLights=true;this.updateIsolateMaterials=true;this.updateIsolateTextures=true;this.updateIsolateFog=true;this.updateIsolateClipPlanes=true;this.isolateTransforms=new BooleanAttr(false);this.isolateLights=new BooleanAttr(false);this.isolateMaterials=new BooleanAttr(false);this.isolateTextures=new BooleanAttr(false);this.isolateDissolves=new BooleanAttr(false);this.isolateGlobalIlluminations=new BooleanAttr(false);this.isolateLightModels=new BooleanAttr(false);this.isolateFog=new BooleanAttr(false);this.isolateClipPlanes=new BooleanAttr(false);this.isolateRenderModes=new BooleanAttr(false);this.isolateTransforms.addModifiedCB(Isolator_IsolateTransformsModifiedCB,this);this.isolateLights.addModifiedCB(Isolator_IsolateLightsModifiedCB,this);this.isolateMaterials.addModifiedCB(Isolator_IsolateMaterialsModifiedCB,this);this.isolateTextures.addModifiedCB(Isolator_IsolateTexturesModifiedCB,this);this.isolateFog.addModifiedCB(Isolator_IsolateFogModifiedCB,this);this.isolateClipPlanes.addModifiedCB(Isolator_IsolateClipPlanesModifiedCB,this);this.registerAttribute(this.isolateTransforms,"isolateTransforms");this.registerAttribute(this.isolateLights,"isolateLights");this.registerAttribute(this.isolateMaterials,"isolateMaterials");this.registerAttribute(this.isolateTextures,"isolateTextures");this.registerAttribute(this.isolateDissolves,"isolateDissolves");this.registerAttribute(this.isolateGlobalIlluminations,"isolateGlobalIlluminations");this.registerAttribute(this.isolateLightModels,"isolateLightModels");this.registerAttribute(this.isolateFog,"isolateFog");this.registerAttribute(this.isolateClipPlanes,"isolateClipPlanes");this.registerAttribute(this.isolateRenderModes,"isolateRenderModes")}Isolator.prototype.update=function(b,a){Group.prototype.update.call(this,b,a)};Isolator.prototype.apply=function(k,d,e){var g=this.enabled.getValueDirect();if(!g){Group.prototype.apply.call(this,k,d,e);return}var j=this.isolateTransforms.getValueDirect();var h=this.isolateTextures.getValueDirect();var a=this.isolateDissolves.getValueDirect();var c=this.isolateClipPlanes.getValueDirect();var m=0;var l=null;var n=null;var f=null;var b=null;switch(k){case"render":this.pushIsolatedStates();if(j){n=d.projMatrix;f=d.viewMatrix;b=d.worldMatrix;this.graphMgr.renderContext.projectionMatrixStack.push();this.graphMgr.renderContext.modelViewMatrixStack.push()}if(h){this.graphMgr.textureArrayStack.push(new TextureArray(this.graphMgr.textureArrayStack.top()))}break;case"rayPick":if(a){m=d.dissolve;l=this.graphMgr.getCurrentDissolve()}if(j){}if(c){}break;case"bbox":if(j){}break}Group.prototype.apply.call(this,k,d,e);switch(k){case"render":this.popIsolatedStates();if(j){d.projMatrix=n;d.viewMatrix=f;d.worldMatrix=b;this.graphMgr.renderContext.projectionMatrixStack.pop();this.graphMgr.renderContext.applyProjectionTransform();this.graphMgr.renderContext.modelViewMatrixStack.pop();this.graphMgr.renderContext.applyModelViewTransform()}if(h){this.graphMgr.textureArrayStack.pop()}break;case"rayPick":if(a){d.dissolve=m;this.graphMgr.setCurrentDissolve(l)}if(j){}if(c){}break;case"bbox":if(j){}break}};Isolator.prototype.pushIsolatedStates=function(){};Isolator.prototype.popIsolatedStates=function(){};function Isolator_IsolateTransformsModifiedCB(b,a){a.updateIsolateTransforms=true;a.incrementModificationCount()}function Isolator_IsolateLightsModifiedCB(b,a){a.updateIsolateLights=true;a.incrementModificationCount()}function Isolator_IsolateMaterialsModifiedCB(b,a){a.updateIsolateMaterials=true;a.incrementModificationCount()}function Isolator_IsolateTexturesModifiedCB(b,a){a.updateIsolateTextures=true;a.incrementModificationCount()}function Isolator_IsolateFogModifiedCB(b,a){a.updateIsolateFog=true;a.incrementModificationCount()}function Isolator_IsolateClipPlanesModifiedCB(b,a){a.updateIsolateClipPlanes=true;a.incrementModificationCount()}Dissolve.prototype=new SGNode();Dissolve.prototype.constructor=Dissolve;function Dissolve(){SGNode.call(this);this.className="Dissolve";this.attrType=eAttrType.Dissolve;this.lastDissolve=0;this.dissolve=new NumberAttr(0);this.dissolve.addModifiedCB(Dissolve_DissolveModifiedCB,this);this.registerAttribute(this.dissolve,"dissolve")}Dissolve.prototype.update=function(b,a){SGNode.prototype.update.call(this,b,a)};Dissolve.prototype.apply=function(e,d,b){var a=this.enabled.getValueDirect();if(!a){Group.prototype.apply.call(this,e,d,b);return}switch(e){case"render":var c=this.dissolve.getValueDirect();this.lastDissolve=c;d.dissolve=c;break;case"rayPick":d.dissolve=this.lastDissolve;break}SGNode.prototype.apply.call(this,e,d,b)};function Dissolve_DissolveModifiedCB(b,a){a.incrementModificationCount()}RenderParams.prototype=new DirectiveParams();RenderParams.prototype.constructor=RenderParams();function RenderParams(){DirectiveParams.call(this);this.viewport=new Viewport();this.projMatrix=new Matrix4x4();this.viewMatrix=new Matrix4x4();this.worldMatrix=new Matrix4x4();this.dissolve=0;this.opacity=1;this.distanceSortAgent=null;this.drawTextures=true}RenderDirective.prototype=new SGDirective();RenderDirective.prototype.constructor=RenderDirective;function RenderDirective(){SGDirective.call(this);this.className="RenderDirective";this.attrType=eAttrType.RenderDirective;this.name.setValueDirect("RenderDirective");this.distanceSortAgent=new DistanceSortAgent();this.viewport=new ViewportAttr();this.backgroundImageFilename=new StringAttr("");this.foregroundImageFilename=new StringAttr("");this.foregroundAlphaFilename=new StringAttr("");this.foregroundFadeEnabled=new BooleanAttr(false);this.texturesEnabled=new BooleanAttr(true);this.viewport.addModifiedCB(RenderDirective_ViewportModifiedCB,this);this.backgroundImageFilename.addModifiedCB(RenderDirective_BackgroundImageFilenameModifiedCB,this);this.registerAttribute(this.viewport,"viewport");this.registerAttribute(this.backgroundImageFilename,"backgroundImageFilename");this.registerAttribute(this.foregroundImageFilename,"foregroundImageFilename");this.registerAttribute(this.foregroundAlphaFilename,"foregroundAlphaFilename");this.registerAttribute(this.foregroundFadeEnabled,"foregroundFadeEnabled");this.registerAttribute(this.texturesEnabled,"texturesEnabled");this.updateDirective=new UpdateDirective()}RenderDirective.prototype.setGraphMgr=function(a){this.distanceSortAgent.setGraphMgr(a);SGDirective.prototype.setGraphMgr.call(this,a)};RenderDirective.prototype.execute=function(a){a=a||this.rootNode.getValueDirect();this.updateDirective.execute(a);var b=new RenderParams();b.directive=this;b.viewport.loadViewport(this.viewport.getValueDirect());b.distanceSortAgent=this.distanceSortAgent;b.drawTextures=this.texturesEnabled.getValueDirect();a.apply("render",b,true);if(!this.distanceSortAgent.isEmpty()){this.distanceSortAgent.sort();this.distanceSortAgent.draw();this.distanceSortAgent.clear()}};function RenderDirective_ViewportModifiedCB(d,a){var b=a.viewport.getValueDirect();var c=a.backgroundImageFilename.getValueDirect().join("");a.graphMgr.renderContext.setBackgroundImage(c,b.width,b.height)}function RenderDirective_BackgroundImageFilenameModifiedCB(c,a){var b=a.viewport.getValueDirect();var d=formatPath(a.backgroundImageFilename.getValueDirect().join(""));a.backgroundImageFilename.removeModifiedCB(RenderDirective_BackgroundImageFilenameModifiedCB,a);a.backgroundImageFilename.setValueDirect(d[0]);a.backgroundImageFilename.addModifiedCB(RenderDirective_BackgroundImageFilenameModifiedCB,a);a.graphMgr.renderContext.setBackgroundImage(d[0],b.width,b.height)}RayPickParams.prototype=new DirectiveParams();RayPickParams.prototype.constructor=RayPickParams();function RayPickParams(){DirectiveParams.call(this);this.camera=null;this.currentCamera=null;this.viewport=new Viewport();this.clickPoint=new Vector2D();this.rayOrigin=new Vector3D();this.rayDir=new Vector3D();this.nearDistance=0;this.farDistance=0;this.viewMatrix=new Matrix4x4();this.worldMatrix=new Matrix4x4();this.sectorOrigin=new Vector3D();this.doubleSided=false;this.opacity=0;this.dissolve=0;this.clipPlanes=[]}function RayPickRecord(b,c,a){this.path=b.copy();this.intersectRecord=c;this.camera=a}RayPickDirective.prototype=new SGDirective();RayPickDirective.prototype.constructor=RayPickDirective;function RayPickDirective(){SGDirective.call(this);this.className="RayPickDirective";this.attrType=eAttrType.RayPickDirective;this.name.setValueDirect("RayPickDirective");this.picked=[];this.viewport=new ViewportAttr();this.camera=new ReferenceAttr(null);this.clickPoint=new Vector2DAttr();this.registerAttribute(this.viewport,"viewport");this.registerAttribute(this.camera,"camera");this.registerAttribute(this.clickPoint,"clickPoint")}RayPickDirective.prototype.execute=function(a){a=a||this.rootNode.getValueDirect();this.picked.length=0;var b=new RayPickParams();b.directive=this;b.camera=this.camera.getValueDirect();b.viewport.loadViewport(this.viewport.getValueDirect());b.clickPoint.copy(this.clickPoint.getValueDirect());a.apply("rayPick",b,true)};RayPickDirective.prototype.addPickRecord=function(a){for(var b=0;b<this.picked.length;b++){if(this.picked[b].intersectRecord.distance>a.intersectRecord.distance){break}}this.picked.splice(b,0,a)};BBoxParams.prototype=new DirectiveParams();BBoxParams.prototype.constructor=BBoxParams();function BBoxParams(){DirectiveParams.call(this);this.viewSpace=false;this.viewMatrix=new Matrix4x4();this.worldMatrix=new Matrix4x4();this.minPoint=new Vector3D();this.maxPoint=new Vector3D();this.minMaxSet=false}BBoxDirective.prototype=new SGDirective();BBoxDirective.prototype.constructor=BBoxDirective;function BBoxDirective(){SGDirective.call(this);this.className="BBoxDirective";this.attrType=eAttrType.BBoxDirective;this.min=new Vector3D();this.max=new Vector3D();this.name.setValueDirect("BBoxDirective");this.viewSpace=new BooleanAttr(false);this.viewTransform=new Matrix4x4Attr(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);this.registerAttribute(this.viewSpace,"viewSpace");this.registerAttribute(this.viewTransform,"viewTransform")}BBoxDirective.prototype.execute=function(a){a=a||this.rootNode.getValueDirect();var c=new BBoxParams();c.viewSpace=this.viewSpace.getValueDirect();var b=this.viewTransform.getValueDirect();c.viewMatrix.load(b._11,b._12,b._13,b._14,b._21,b._22,b._23,b._24,b._31,b._32,b._33,b._34,b._41,b._42,b._43,b._44);a.apply("bbox",c,true);this.min=c.minPoint;this.max=c.maxPoint};BBoxDirective.prototype.getBounds=function(){return{min:this.min,max:this.max}};Geometry.prototype=new RenderableElement();Geometry.prototype.constructor=Geometry;function Geometry(){RenderableElement.call(this);this.className="Geometry";this.attrType=eAttrType.Geometry;this.boundingTree=new Octree();this.updateBoundingTree=false;this.updateIntersectionModel=false;this.updateStationary=false;this.selectable=new BooleanAttr(true);this.cullable=new BooleanAttr(true);this.show=new BooleanAttr(true);this.approximationLevels=new NumberAttr(1);this.showApproximationLevel=new NumberAttr(-1);this.sortPolygons=new BooleanAttr(false);this.flipPolygons=new BooleanAttr(false);this.intersector=new BooleanAttr(true);this.intersectee=new BooleanAttr(true);this.stationary=new BooleanAttr(false);this.shadowCaster=new BooleanAttr(false);this.shadowTarget=new BooleanAttr(true);this.selectable.addModifiedCB(Geometry_SelectableModifiedCB,this);this.show.addModifiedCB(Geometry_ShowModifiedCB,this);this.approximationLevels.addModifiedCB(Geometry_ApproximationLevelsModifiedCB,this);this.showApproximationLevel.addModifiedCB(Geometry_ShowApproximationLevelModifiedCB,this);this.intersector.addModifiedCB(Geometry_IntersectorModifiedCB,this);this.intersectee.addModifiedCB(Geometry_IntersecteeModifiedCB,this);this.stationary.addModifiedCB(Geometry_StationaryModifiedCB,this);this.registerAttribute(this.selectable,"selectable");this.registerAttribute(this.cullable,"cullable");this.registerAttribute(this.show,"show");this.registerAttribute(this.approximationLevels,"approximationLevels");this.registerAttribute(this.showApproximationLevel,"showApproximationLevel");this.registerAttribute(this.sortPolygons,"sortPolygons");this.registerAttribute(this.flipPolygons,"flipPolygons");this.registerAttribute(this.intersector,"intersector");this.registerAttribute(this.intersectee,"intersectee");this.registerAttribute(this.stationary,"stationary");this.registerAttribute(this.shadowCaster,"shadowCaster");this.registerAttribute(this.shadowTarget,"shadowTarget")}Geometry.prototype.update=function(b,a){if(this.updateBoundingTree){this.updateBoundingTree=false;this.buildBoundingTree()}RenderableElement.prototype.update.call(this,b,a)};Geometry.prototype.apply=function(m,c,e){var k=this.enabled.getValueDirect();if(!k){RenderableElement.prototype.apply.call(this,m,c,e);return}switch(m){case"render":var o=true;var g=c.dissolve;var j=c.opacity;if(g==1){o=false}else{if(g>0||j<1||this.graphMgr.textureArrayStack.top().textures[eTextureType.Transparency].length>0||this.graphMgr.projectionTextureArrayStack.top().textures[eTextureType.Transparency].length>0){var a=this.getBBox();c.distanceSortAgent.addGeometry(this,a.min,a.max,g);o=false}}if(o){this.draw(g)}break;case"rayPick":if(this.selectable.getValueDirect()==true&&c.opacity>0&&c.dissolve<1){var h=c.worldMatrix.multiply(c.viewMatrix);var b=h.getScalingFactors();var f=rayPick(this.boundingTree,c.rayOrigin,c.rayDir,c.nearDistance,c.farDistance,c.worldMatrix,c.viewMatrix,max3(b.x,b.y,b.z),c.doubleSided,c.clipPlanes);if(f){c.directive.addPickRecord(new RayPickRecord(c.path,f,c.camera))}}break;case"bbox":var a=this.getBBox();var n=new Matrix4x4();n.loadMatrix(c.worldMatrix);if(c.viewSpace){n.loadMatrix(n.multiply(c.viewMatrix))}var d=n.transform(a.min.x,a.min.y,a.min.z,1);var l=n.transform(a.max.x,a.max.y,a.max.z,1);if(c.minMaxSet){c.minPoint.x=Math.min(c.minPoint.x,Math.min(d.x,l.x));c.minPoint.y=Math.min(c.minPoint.y,Math.min(d.y,l.y));c.minPoint.z=Math.min(c.minPoint.z,Math.min(d.z,l.z));c.maxPoint.x=Math.max(c.maxPoint.x,Math.max(d.x,l.x));c.maxPoint.y=Math.max(c.maxPoint.y,Math.max(d.y,l.y));c.maxPoint.z=Math.max(c.maxPoint.z,Math.max(d.z,l.z))}else{c.minPoint.x=Math.min(d.x,l.x);c.minPoint.y=Math.min(d.y,l.y);c.minPoint.z=Math.min(d.z,l.z);c.maxPoint.x=Math.max(d.x,l.x);c.maxPoint.y=Math.max(d.y,l.y);c.maxPoint.z=Math.max(d.z,l.z);c.minMaxSet=true}break}RenderableElement.prototype.apply.call(this,m,c,e)};Geometry.prototype.draw=function(a){};Geometry.prototype.getBBox=function(){return{min:this.bbox.min.getValueDirect(),max:this.bbox.max.getValueDirect()}};function Geometry_SelectableModifiedCB(b,a){}function Geometry_ShowModifiedCB(b,a){a.incrementModificationCount()}function Geometry_ApproximationLevelsModifiedCB(b,a){a.updateBoundingTree=true;a.incrementModificationCount()}function Geometry_ShowApproximationLevelModifiedCB(b,a){a.incrementModificationCount()}function Geometry_IntersectorModifiedCB(b,a){a.updateIntersectionModel=true}function Geometry_IntersecteeModifiedCB(b,a){a.updateIntersectionModel=true}function Geometry_StationaryModifiedCB(b,a){a.updateStationary=true}VertexGeometry.prototype=new Geometry();VertexGeometry.prototype.constructor=VertexGeometry;function VertexGeometry(){Geometry.call(this);this.className="VertexGeometry";this.attrType=eAttrType.VertexGeometry;this.updateVertices=false;this.updateUVCoords=[];this.uvCoords=[];this.vertexBuffer=null;this.vertices=new NumberArrayAttr();this.vertices.addModifiedCB(VertexGeometry_VerticesModifiedCB,this);this.registerAttribute(this.vertices,"vertices")}VertexGeometry.prototype.getUVCoords=function(b){for(var a=0;a<this.uvCoords.length;a++){if(this.uvCoords[a].first==b){return this.uvCoords[a].second}}var c=new NumberArrayAttr();c.addModifiedCB(VertexGeometry_UVCoordsModifiedCB,this);this.uvCoords.push(new Pair(b,c));return c};VertexGeometry.prototype.update=function(d,c){if(this.updateVertices){this.updateVertices=false;this.vertexBuffer.setVertices(this.vertices.getValueDirect());this.updateBoundingTree=true;this.calculateBBox()}if(this.updateUVCoords.length){for(var b=0;b<this.updateUVCoords.length;b++){for(var a=0;a<this.uvCoords.length;a++){if(this.uvCoords[a].second==this.updateUVCoords[b]){this.vertexBuffer.setUVCoords(this.uvCoords[a].first.textureObj,this.uvCoords[a].second.getValueDirect());break}}}this.updateUVCoords.length=0}Geometry.prototype.update.call(this,d,c)};VertexGeometry.prototype.apply=function(d,c,b){var a=this.enabled.getValueDirect();if(!a){Geometry.prototype.apply.call(this,d,c,b);return}switch(d){case"render":break}Geometry.prototype.apply.call(this,d,c,b)};VertexGeometry.prototype.drawTextured=function(h){var n=null;var m=null;this.graphMgr.renderContext.enable(eRenderMode.AlphaBlend);this.graphMgr.renderContext.setBlendFactor(RC_SRC_ALPHA,RC_ONE_MINUS_SRC_ALPHA);var b=this.graphMgr.renderContext.getMaxTextureStages();var p=this.graphMgr.textureArrayStack.top();var c=1;var d=1;var a=1;var k=1;var j=this.graphMgr.getCurrentMaterial();if(j){c=j.getAttribute("ambientLevel").getValueDirect();d=j.getAttribute("diffuseLevel").getValueDirect();a=j.getAttribute("specularLevel").getValueDirect();k=j.getAttribute("emissiveLevel").getValueDirect()}var f=this.graphMgr.renderContext.getFrontMaterial();this.graphMgr.renderState.push(RENDERSTATE_MATERIAL_BIT);if(h>0){f.ambient.a*=(1-h);f.diffuse.a*=(1-h);f.specular.a*=(1-h);f.emissive.a*=(1-h);this.graphMgr.renderContext.setFrontMaterial(f)}if(p.textures[eTextureType.Transparency].length){var l=p.textures[eTextureType.Transparency][0];var o=this.getUVCoords(l);if(o&&o.getLength()>0){this.setTextureStage(0,eTextureType.Transparency,l,l.transformCompound);n=l}if(b>1){this.graphMgr.renderContext.enableTextureStage(1,0);m=null}}if(p.textures[eTextureType.Color].length){this.setBlendingMaterial(p.textures[eTextureType.Color][0].getAttribute("opacity").getValueDirect(),c,d,a,k)}this.graphMgr.renderContext.setTextureBlendFactor(f.diffuse.a*(1-h));if(p.textures[eTextureType.Color].length==0||p.textures[eTextureType.Color][0].getAttribute("opacity").getValueDirect()<1){this.vertexBuffer.draw()}if(n){this.graphMgr.renderContext.enableTextureStage(0,0);n=null}if(m){this.graphMgr.renderContext.enableTextureStage(1,0);m=null}for(var e=0;e<p.textures[eTextureType.Color].length;e++){var l=p.textures[eTextureType.Color][e];var o=this.getUVCoords(l);if(o&&o.getLength()>0){this.setTextureStage(0,eTextureType.Color,l,l.transformCompound);n=l;this.setBlendingMaterial(l.getAttribute("opacity").getValueDirect(),c,d,a,k);this.graphMgr.renderContext.setTextureBlendFactor(f.diffuse.a*(1-h)*l.getAttribute("opacity").getValueDirect())}if(b>1){if(p.textures[eTextureType.Transparency].length){l=p.textures[eTextureType.Transparency][0];o=this.getUVCoords(l);if(o&&o.getLength()>0){this.setTextureStage(1,eTextureType.Transparency,l,l.transformCompound);m=l}}}this.vertexBuffer.draw();if(n){this.graphMgr.renderContext.enableTextureStage(0,0);n=null}if(m){this.graphMgr.renderContext.enableTextureStage(1,0);m=null}}var g=p.textures[eTextureType.Specularity].length;if(g==0&&a>0){this.setSpecularMaterial(f.specular,f.glossiness);this.graphMgr.renderContext.setBlendFactor(RC_ONE,RC_ONE);if(p.textures[eTextureType.Transparency].length){var l=p.textures[eTextureType.Transparency][0];var o=this.getUVCoords(l);if(o&&o.getLength()>0){this.setTextureStage(0,eTextureType.Transparency,l,l.transformCompound);n=l}if(b>1){this.graphMgr.renderContext.enableTextureStage(1,0);m=null}}this.vertexBuffer.draw();if(n){this.graphMgr.renderContext.enableTextureStage(0,0);n=null}}this.graphMgr.renderContext.enableTextureStage(0,0);this.graphMgr.renderContext.disable(eRenderMode.AlphaBlend);this.graphMgr.renderState.pop(RENDERSTATE_MATERIAL_BIT)};VertexGeometry.prototype.setTextureStage=function(f,h,g,e,a,c){e=e||new Matrix4x4();a=a||eTextureCoordSrc.VertexUVs;c=c||new Matrix4x4();this.graphMgr.renderContext.enableTextureStage(f,1);var k=g.getAttribute("widthWrap").getValueDirect();var j=g.getAttribute("heightWrap").getValueDirect();var b,l;switch(k){case eTextureWrap.Clamp:b=RC_CLAMP_TO_EDGE;break;case eTextureWrap.Repeat:default:b=RC_REPEAT;break}switch(j){case eTextureWrap.Clamp:l=RC_CLAMP_TO_EDGE;break;case eTextureWrap.Repeat:default:l=RC_REPEAT;break}this.vertexBuffer.setTextureStage(f,g.textureObj,b,l,a,c);var d;switch(h){case eTextureType.Color:d=RC_MODULATE;break;case eTextureType.Diffuse:case eTextureType.Luminosity:case eTextureType.Specularity:d=RC_REPLACE;break;case eTextureType.Transparency:d=RC_MODULATE;break;default:return}this.graphMgr.renderContext.setTextureBlendOp(d)};VertexGeometry.prototype.setBlendingMaterial=function(e,b,d,a,g){var j=this.graphMgr.renderContext.getFrontMaterial();var h=e*b;var k=e*d;var f=e*a;var c=e*g;j.ambient.r=h+j.ambient.r*(1-e);j.ambient.g=h+j.ambient.g*(1-e);j.ambient.b=h+j.ambient.b*(1-e);j.diffuse.r=k+j.diffuse.r*(1-e);j.diffuse.g=k+j.diffuse.g*(1-e);j.diffuse.b=k+j.diffuse.b*(1-e);j.specular.r=0;j.specular.g=0;j.specular.b=0;j.glossiness=1;j.emissive.r=c+j.emissive.r*(1-e);j.emissive.g=c+j.emissive.g*(1-e);j.emissive.b=c+j.emissive.b*(1-e);j.validMembersMask=MATERIALDESC_ALL_BITS;this.graphMgr.renderContext.setFrontMaterial(j)};VertexGeometry.prototype.setSpecularMaterial=function(c,b){var a=new MaterialDesc();a.validMembersMask=MATERIALDESC_ALL_BITS;a.specular=c;a.glossiness=b;this.graphMgr.renderContext.setFrontMaterial(a);this.graphMgr.renderContext.setBlendFactor(RC_ONE_MINUS_SRC_ALPHA,RC_ONE)};VertexGeometry.prototype.calculateBBox=function(){var b=this.vertices.getValueDirect();if(b.length<3){return}var d=new Vector3D(b[0],b[1],b[2]);var a=new Vector3D(b[0],b[1],b[2]);for(var c=3;c<b.length;c+=3){d.x=Math.min(d.x,b[c]);d.y=Math.min(d.y,b[c+1]);d.z=Math.min(d.z,b[c+2]);a.x=Math.max(a.x,b[c]);a.y=Math.max(a.y,b[c+1]);a.z=Math.max(a.z,b[c+2])}this.bbox.getAttribute("min").setValueDirect(d.x,d.y,d.z);this.bbox.getAttribute("max").setValueDirect(a.x,a.y,a.z)};function VertexGeometry_VerticesModifiedCB(b,a){a.updateVertices=true;a.incrementModificationCount()}function VertexGeometry_UVCoordsModifiedCB(b,a){a.updateUVCoords.push(b);a.incrementModificationCount()}TriList.prototype=new VertexGeometry();TriList.prototype.constructor=TriList;function TriList(){VertexGeometry.call(this);this.className="TriList";this.attrType=eAttrType.TriList;this.updateNormals=false;this.normals=new NumberArrayAttr();this.vertices.addModifiedCB(TriList_NormalsModifiedCB,this);this.registerAttribute(this.normals,"normals")}TriList.prototype.update=function(b,a){if(!this.vertexBuffer){this.vertexBuffer=this.graphMgr.renderContext.createVertexBuffer(3);this.vertexBuffer.setPrimitiveType(RC_TRIANGLES)}if(this.updateNormals){this.updateNormals=false;this.vertexBuffer.setNormals(this.normals.getValueDirect())}VertexGeometry.prototype.update.call(this,b,a)};TriList.prototype.apply=function(c,b,a){VertexGeometry.prototype.apply.call(this,c,b,a)};TriList.prototype.draw=function(a){this.drawTextured(a)};TriList.prototype.buildBoundingTree=function(){var b=this.vertices.getValueDirect();var e=[];for(var d=0,f=0;f+8<b.length;d++,f+=9){e.push(new Triangle(b[f],b[f+1],b[f+2],b[f+3],b[f+4],b[f+5],b[f+6],b[f+7],b[f+8]))}var c=this.bbox.getAttribute("min").getValueDirect();var a=this.bbox.getAttribute("max").getValueDirect();this.boundingTree.setTriangles(e,c,a);this.boundingTree.buildTree(this.approximationLevels.getValueDirect())};function TriList_NormalsModifiedCB(b,a){a.updateNormals=true;a.incrementModificationCount()}Material.prototype=new SGNode();Material.prototype.constructor=Material;function Material(){SGNode.call(this);this.className="Material";this.attrType=eAttrType.Material;this.updateColor=false;this.updateAmbientLevel=false;this.updateDiffuseLevel=false;this.updateSpecularLevel=false;this.updateEmissiveLevel=false;this.updateAmbient=true;this.updateDiffuse=true;this.updateSpecular=true;this.updateEmissive=true;this.updateGlossiness=true;this.updateOpacity=true;this.lastOpacity=0;this.lastDoubleSided=false;this.materialDesc=new MaterialDesc();this.materialDesc.validMembersMask=MATERIALDESC_ALL_BITS;this.color=new ColorAttr(1,1,1,1);this.ambientLevel=new NumberAttr(1);this.diffuseLevel=new NumberAttr(1);this.specularLevel=new NumberAttr(1);this.emissiveLevel=new NumberAttr(0);this.ambient=new ColorAttr(0.2,0.2,0.2,1);this.diffuse=new ColorAttr(0.8,0.8,0.8,1);this.specular=new ColorAttr(0,0,0,1);this.emissive=new ColorAttr(0,0,0,1);this.glossiness=new NumberAttr(0);this.opacity=new NumberAttr(1);this.doubleSided=new BooleanAttr(false);this.color.addModifiedCB(Material_ColorModifiedCB,this);this.ambientLevel.addModifiedCB(Material_AmbientLevelModifiedCB,this);this.diffuseLevel.addModifiedCB(Material_DiffuseLevelModifiedCB,this);this.specularLevel.addModifiedCB(Material_SpecularLevelModifiedCB,this);this.emissiveLevel.addModifiedCB(Material_EmissiveLevelModifiedCB,this);this.ambient.addModifiedCB(Material_AmbientModifiedCB,this);this.diffuse.addModifiedCB(Material_DiffuseModifiedCB,this);this.specular.addModifiedCB(Material_SpecularModifiedCB,this);this.emissive.addModifiedCB(Material_EmissiveModifiedCB,this);this.glossiness.addModifiedCB(Material_GlossinessModifiedCB,this);this.opacity.addModifiedCB(Material_OpacityModifiedCB,this);this.doubleSided.addModifiedCB(Material_DoubleSidedModifiedCB,this);this.registerAttribute(this.color,"color");this.registerAttribute(this.ambientLevel,"ambientLevel");this.registerAttribute(this.diffuseLevel,"diffuseLevel");this.registerAttribute(this.specularLevel,"specularLevel");this.registerAttribute(this.emissiveLevel,"emissiveLevel");this.registerAttribute(this.ambient,"ambient");this.registerAttribute(this.diffuse,"diffuse");this.registerAttribute(this.specular,"specular");this.registerAttribute(this.emissive,"emissive");this.registerAttribute(this.glossiness,"glossiness");this.registerAttribute(this.opacity,"opacity");this.registerAttribute(this.doubleSided,"doubleSided")}Material.prototype.update=function(e,d){if(this.updateColor){this.updateColor=false;this.updateAmbientLevel=true;this.updateDiffuseLevel=true;this.updateSpecularLevel=true;this.updateEmissiveLevel=true}if(this.updateAmbientLevel||this.updateDiffuseLevel||this.updateSpecularLevel||this.updateEmissiveLevel){var a=this.color.getValueDirect();if(this.updateAmbientLevel){this.updateAmbientLevel=false;var f=this.ambientLevel.getValueDirect();this.ambient.setValueDirect(a.r*f,a.g*f,a.b*f,a.a)}if(this.updateDiffuseLevel){this.updateDiffuseLevel=false;var f=this.diffuseLevel.getValueDirect();this.diffuse.setValueDirect(a.r*f,a.g*f,a.b*f,a.a)}if(this.updateSpecularLevel){this.updateSpecularLevel=false;var f=this.specularLevel.getValueDirect();this.specular.setValueDirect(a.r*f,a.g*f,a.b*f,a.a)}if(this.updateEmissiveLevel){this.updateEmissiveLevel=false;var f=this.emissiveLevel.getValueDirect();this.emissive.setValueDirect(a.r*f,a.g*f,a.b*f,a.a)}}var c=this.opacity.getValueDirect();var b=false;if(this.updateOpacity){this.updateOpacity=false;this.lastOpacity=c;b=true}if(this.updateAmbient||b){this.updateAmbient=false;this.materialDesc.ambient.copy(this.ambient.getValueDirect());this.materialDesc.ambient.a*=c}if(this.updateDiffuse||b){this.updateDiffuse=false;this.materialDesc.diffuse.copy(this.diffuse.getValueDirect());this.materialDesc.diffuse.a*=c}if(this.updateSpecular||b){this.updateSpecular=false;this.materialDesc.specular.copy(this.specular.getValueDirect());this.materialDesc.specular.a*=c}if(this.updateEmissive||b){this.updateEmissive=false;this.materialDesc.emissive.copy(this.emissive.getValueDirect());this.materialDesc.emissive.a*=c}if(this.updateGlossiness||b){this.updateGlossiness=false;this.materialDesc.glossiness=this.glossiness.getValueDirect()}SGNode.prototype.update.call(this,e,d)};Material.prototype.apply=function(d,c,b){var a=this.enabled.getValueDirect();if(!a){SGNode.prototype.apply.call(this,d,c,b);return}this.graphMgr.setCurrentMaterial(this);switch(d){case"render":c.opacity=this.lastOpacity;this.applyMaterialDesc();break;case"rayPick":c.doubleSided=this.lastDoubleSided;c.opacity=this.lastOpacity;break}SGNode.prototype.apply.call(this,d,c,b)};Material.prototype.applyMaterialDesc=function(){this.graphMgr.renderContext.setFrontMaterial(this.materialDesc);var a=this.doubleSided.getValueDirect();this.lastDoubleSided=a;if(a){this.graphMgr.renderContext.disable(eRenderMode.CullBackFace)}else{this.graphMgr.renderContext.enable(eRenderMode.CullBackFace)}};function Material_ColorModifiedCB(b,a){a.updateColor=true;a.incrementModificationCount()}function Material_AmbientLevelModifiedCB(b,a){a.updateAmbientLevel=true;a.incrementModificationCount()}function Material_DiffuseLevelModifiedCB(b,a){a.updateDiffuseLevel=true;a.incrementModificationCount()}function Material_SpecularLevelModifiedCB(b,a){a.updateSpecularLevel=true;a.incrementModificationCount()}function Material_EmissiveLevelModifiedCB(b,a){a.updateEmissiveLevel=true;a.incrementModificationCount()}function Material_AmbientModifiedCB(b,a){a.updateAmbient=true;a.incrementModificationCount()}function Material_DiffuseModifiedCB(b,a){a.updateDiffuse=true;a.incrementModificationCount()}function Material_SpecularModifiedCB(b,a){a.updateSpecular=true;a.incrementModificationCount()}function Material_EmissiveModifiedCB(b,a){a.updateEmissive=true;a.incrementModificationCount()}function Material_GlossinessModifiedCB(b,a){a.updateGlosiness=true;a.incrementModificationCount()}function Material_OpacityModifiedCB(b,a){a.updateOpacity=true;a.incrementModificationCount()}function Material_DoubleSidedModifiedCB(b,a){a.incrementModificationCount()}Surface.prototype=new Isolator();Surface.prototype.constructor=Surface;function Surface(){Isolator.call(this);this.className="Surface";this.attrType=eAttrType.Surface;this.color=new ColorAttr(1,1,1,1);this.ambientLevel=new NumberAttr(1);this.diffuseLevel=new NumberAttr(1);this.specularLevel=new NumberAttr(1);this.emissiveLevel=new NumberAttr(0);this.ambient=new ColorAttr(0.8,0.8,0.8,1);this.diffuse=new ColorAttr(0.2,0.2,0.2,1);this.specular=new ColorAttr(0,0,0,1);this.emissive=new ColorAttr(0,0,0,1);this.glossiness=new NumberAttr(0);this.opacity=new NumberAttr(1);this.doubleSided=new BooleanAttr(false);this.texturesEnabled=new BooleanAttr(true);this.colorTexturesPresent=new BooleanAttr(true);this.diffuseTexturesPresent=new BooleanAttr(true);this.luminosityTexturesPresent=new BooleanAttr(true);this.specularityTexturesPresent=new BooleanAttr(true);this.transparencyTexturesPresent=new BooleanAttr(true);this.numColorTextures=new NumberAttr(0);this.numDiffuseTextures=new NumberAttr(0);this.numLuminosityTextures=new NumberAttr(0);this.numSpecularityTextures=new NumberAttr(0);this.numTransparencyTextures=new NumberAttr(0);this.colorTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB,this);this.diffuseTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB,this);this.luminosityTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB,this);this.specularityTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB,this);this.transparencyTexturesPresent.addModifiedCB(Surface_TexturesPresentModifiedCB,this);this.registerAttribute(this.color,"color");this.registerAttribute(this.ambientLevel,"ambientLevel");this.registerAttribute(this.diffuseLevel,"diffuseLevel");this.registerAttribute(this.specularLevel,"specularLevel");this.registerAttribute(this.emissiveLevel,"emissiveLevel");this.registerAttribute(this.ambient,"ambient");this.registerAttribute(this.diffuse,"diffuse");this.registerAttribute(this.specular,"specular");this.registerAttribute(this.emissive,"emissive");this.registerAttribute(this.glossiness,"glossiness");this.registerAttribute(this.opacity,"opacity");this.registerAttribute(this.doubleSided,"doubleSided");this.registerAttribute(this.texturesEnabled,"texturesEnabled");this.registerAttribute(this.colorTexturesPresent,"colorTexturesPresent");this.registerAttribute(this.diffuseTexturesPresent,"diffuseTexturesPresent");this.registerAttribute(this.luminosityTexturesPresent,"luminosityTexturesPresent");this.registerAttribute(this.specularityTexturesPresent,"specularityTexturesPresent");this.registerAttribute(this.transparencyTexturesPresent,"transparencyTexturesPresent");this.registerAttribute(this.numColorTextures,"numColorTextures");this.registerAttribute(this.numDiffuseTextures,"numDiffuseTextures");this.registerAttribute(this.numLuminosityTextures,"numLuminosityTextures");this.registerAttribute(this.numSpecularityTextures,"numSpecularityTextures");this.registerAttribute(this.numTransparencyTextures,"numTransparencyTextures");this.isolateTextures.setValueDirect(true);this.materialNode=new Material();this.materialNode.getAttribute("name").setValueDirect("Material");this.addChild(this.materialNode);this.colorTexturesNode=new Group();this.colorTexturesNode.getAttribute("name").setValueDirect("Color Textures");this.addChild(this.colorTexturesNode);this.diffuseTexturesNode=new Group();this.diffuseTexturesNode.getAttribute("name").setValueDirect("Diffuse Textures");this.addChild(this.diffuseTexturesNode);this.luminosityTexturesNode=new Group();this.luminosityTexturesNode.getAttribute("name").setValueDirect("Luminosity Textures");this.addChild(this.luminosityTexturesNode);this.specularityTexturesNode=new Group();this.specularityTexturesNode.getAttribute("name").setValueDirect("Specularity Textures");this.addChild(this.specularityTexturesNode);this.transparencyTexturesNode=new Group();this.transparencyTexturesNode.getAttribute("name").setValueDirect("Transparency Textures");this.addChild(this.transparencyTexturesNode);this.connectMaterialAttributes(this.materialNode)}Surface.prototype.setGraphMgr=function(a){this.materialNode.setGraphMgr(a);this.colorTexturesNode.setGraphMgr(a);this.diffuseTexturesNode.setGraphMgr(a);this.luminosityTexturesNode.setGraphMgr(a);this.specularityTexturesNode.setGraphMgr(a);this.transparencyTexturesNode.setGraphMgr(a);Isolator.prototype.setGraphMgr.call(this,a)};Surface.prototype.update=function(b,a){Isolator.prototype.update.call(this,b,a)};Surface.prototype.apply=function(c,b,a){Isolator.prototype.apply.call(this,c,b,a)};Surface.prototype.connectMaterialAttributes=function(a){this.connectMaterialAttribute(a,this.color,"color");this.connectMaterialAttribute(a,this.ambientLevel,"ambientLevel");this.connectMaterialAttribute(a,this.diffuseLevel,"diffuseLevel");this.connectMaterialAttribute(a,this.specularLevel,"specularLevel");this.connectMaterialAttribute(a,this.emissiveLevel,"emissiveLevel");this.connectMaterialAttribute(a,this.ambient,"ambient");this.connectMaterialAttribute(a,this.diffuse,"diffuse");this.connectMaterialAttribute(a,this.specular,"specular");this.connectMaterialAttribute(a,this.emissive,"emissive");this.connectMaterialAttribute(a,this.glossiness,"glossiness");this.connectMaterialAttribute(a,this.opacity,"opacity");this.connectMaterialAttribute(a,this.doubleSided,"doubleSided")};Surface.prototype.connectMaterialAttribute=function(c,d,b){var a=this.getAttributeModificationCount(d)>0?true:false;d.addTarget(c.getAttribute(b),eAttrSetOp.Replace,null,a)};Surface.prototype.addTexture=function(a){this.colorTexturesNode.addChild(a)};function Surface_TexturesPresentModifiedCB(b,a){}Model.prototype=new ParentableMotionElement();Model.prototype.constructor=Model;function Model(){ParentableMotionElement.call(this);this.className="Model";this.attrType=eAttrType.Model;this.geometryBBoxesMap=[];this.url=new StringAttr("");this.layer=new NumberAttr(0);this.selectable=new BooleanAttr(true);this.moveable=new BooleanAttr(true);this.cullable=new BooleanAttr(true);this.show=new BooleanAttr(true);this.approximationLevels=new NumberAttr(1);this.showApproximationLevel=new NumberAttr(-1);this.sortPolygons=new BooleanAttr(false);this.flipPolygons=new BooleanAttr(false);this.intersector=new BooleanAttr(true);this.intersectee=new BooleanAttr(true);this.stationary=new BooleanAttr(false);this.shadowCaster=new BooleanAttr(false);this.shadowTarget=new BooleanAttr(true);this.indexedGeometry=new BooleanAttr(true);this.enableSharing=new BooleanAttr(true);this.vertices=new NumberArrayAttr();this.dissolve=new NumberAttr(0);this.color=new ColorAttr(1,1,1,1);this.ambientLevel=new NumberAttr(1);this.diffuseLevel=new NumberAttr(1);this.specularLevel=new NumberAttr(1);this.emissiveLevel=new NumberAttr(0);this.ambient=new ColorAttr(0.8,0.8,0.8,1);this.diffuse=new ColorAttr(0.2,0.2,0.2,1);this.specular=new ColorAttr(0,0,0,1);this.emissive=new ColorAttr(0,0,0,1);this.glossiness=new NumberAttr(0);this.opacity=new NumberAttr(1);this.textureOpacity=new NumberAttr(1);this.doubleSided=new BooleanAttr(false);this.texturesEnabled=new BooleanAttr(true);this.pivotAboutGeometricCenter=new BooleanAttr(true);this.screenScaleEnabled=new BooleanAttr(false);this.screenScalePixels=new Vector3DAttr(0,0,0);this.show.addTarget(this.enabled);this.selectable.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.cullable.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.show.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.approximationLevels.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.showApproximationLevel.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.sortPolygons.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.sortPolygons.addModifiedCB(Model_SortPolygonsModifiedCB,this);this.flipPolygons.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.intersector.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.intersectee.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.stationary.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.shadowCaster.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.shadowTarget.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.renderSequenceSlot.addModifiedCB(Model_GeometryAttrModifiedCB,this);this.renderSequenceSlot.addModifiedCB(Model_RenderSequenceSlotModifiedCB,this);this.dissolve.addModifiedCB(Model_DissolveModifiedCB,this);this.color.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.ambientLevel.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.diffuseLevel.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.specularLevel.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.emissiveLevel.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.ambient.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.diffuse.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.specular.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.emissive.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.glossiness.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.opacity.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.opacity.addModifiedCB(Model_OpacityModifiedCB,this);this.textureOpacity.addModifiedCB(Model_TextureOpacityModifiedCB,this);this.doubleSided.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.texturesEnabled.addModifiedCB(Model_SurfaceAttrModifiedCB,this);this.registerAttribute(this.url,"url");this.registerAttribute(this.layer,"layer");this.registerAttribute(this.selectable,"selectable");this.registerAttribute(this.moveable,"moveable");this.registerAttribute(this.cullable,"cullable");this.registerAttribute(this.show,"show");this.registerAttribute(this.approximationLevels,"approximationLevels");this.registerAttribute(this.showApproximationLevel,"showApproximationLevel");this.registerAttribute(this.sortPolygons,"sortPolygons");this.registerAttribute(this.flipPolygons,"flipPolygons");this.registerAttribute(this.intersector,"intersector");this.registerAttribute(this.intersectee,"intersectee");this.registerAttribute(this.stationary,"stationary");this.registerAttribute(this.shadowCaster,"shadowCaster");this.registerAttribute(this.shadowTarget,"shadowTarget");this.registerAttribute(this.indexedGeometry,"indexedGeometry");this.registerAttribute(this.enableSharing,"enableSharing");this.registerAttribute(this.vertices,"vertices");this.registerAttribute(this.dissolve,"dissolve");this.registerAttribute(this.color,"color");this.registerAttribute(this.ambientLevel,"ambientLevel");this.registerAttribute(this.diffuseLevel,"diffuseLevel");this.registerAttribute(this.specularLevel,"specularLevel");this.registerAttribute(this.emissiveLevel,"emissiveLevel");this.registerAttribute(this.ambient,"ambient");this.registerAttribute(this.diffuse,"diffuse");this.registerAttribute(this.specular,"specular");this.registerAttribute(this.emissive,"emissive");this.registerAttribute(this.glossiness,"glossiness");this.registerAttribute(this.opacity,"opacity");this.registerAttribute(this.textureOpacity,"textureOpacity");this.registerAttribute(this.doubleSided,"doubleSided");this.registerAttribute(this.texturesEnabled,"texturesEnabled");this.registerAttribute(this.pivotAboutGeometricCenter,"pivotAboutGeometricCenter");this.registerAttribute(this.screenScaleEnabled,"screenScaleEnabled");this.registerAttribute(this.screenScalePixels,"screenScalePixels");this.isolatorNode=new Isolator();this.isolatorNode.getAttribute("name").setValueDirect("Isolator");this.isolatorNode.getAttribute("isolateDissolves").setValueDirect(true);this.addChild(this.isolatorNode);this.dissolveNode=new Dissolve();this.dissolveNode.getAttribute("name").setValueDirect("Dissolve");this.addChild(this.dissolveNode);this.dissolve.addTarget(this.dissolveNode.getAttribute("dissolve"));this.surfacesNode=new Group();this.surfacesNode.getAttribute("name").setValueDirect("Surfaces");this.addChild(this.surfacesNode)}Model.prototype.setGraphMgr=function(a){this.isolatorNode.setGraphMgr(a);this.dissolveNode.setGraphMgr(a);this.surfacesNode.setGraphMgr(a);ParentableMotionElement.prototype.setGraphMgr.call(this,a)};Model.prototype.update=function(b,a){ParentableMotionElement.prototype.update.call(this,b,a)};Model.prototype.apply=function(g,f,d){var c=this.enabled.getValueDirect();if(!c){ParentableMotionElement.prototype.apply.call(this,g,f,d);return}switch(g){case"render":var b=this.show.getValueDirect();if(!b){ParentableMotionElement.prototype.apply.call(this,g,f,d);return}this.pushMatrix();this.applyTransform();ParentableMotionElement.prototype.apply.call(this,g,f,d);this.popMatrix();break;case"rayPick":var e=new Matrix4x4();e.loadMatrix(f.worldMatrix);var a=new Vector3D(f.sectorOrigin.x,f.sectorOrigin.y,f.sectorOrigin.z);f.worldMatrix=f.worldMatrix.multiply(this.sectorTransformCompound);f.sectorOrigin.load(this.sectorOrigin.getValueDirect());ParentableMotionElement.prototype.apply.call(this,g,f,d);f.worldMatrix.loadMatrix(e);f.sectorOrigin.copy(a);break;case"bbox":var e=new Matrix4x4();e.loadMatrix(f.worldMatrix);f.worldMatrix.loadMatrix(this.sectorTransformCompound.multiply(f.worldMatrix));ParentableMotionElement.prototype.apply.call(this,g,f,d);f.worldMatrix.loadMatrix(e);break;default:ParentableMotionElement.prototype.apply.call(this,g,f,d);break}};Model.prototype.pushMatrix=function(){this.graphMgr.renderContext.modelViewMatrixStack.push()};Model.prototype.popMatrix=function(){this.graphMgr.renderContext.modelViewMatrixStack.pop();this.graphMgr.renderContext.applyModelViewTransform()};Model.prototype.addSurface=function(a){this.surfacesNode.addChild(a);this.registerAttribute(a,a.getAttribute("name").getValueDirect().join(""));this.connectSurfaceAttributes(a)};Model.prototype.addGeometry=function(b,a){a.addChild(b);this.connectGeometryAttributes(b);this.addGeometryBBox(b)};Model.prototype.addIndexedGeometry=function(c,b,a){this.addGeometry(c,a)};Model.prototype.connectSurfaceAttributes=function(a){this.connectSurfaceAttribute(a,this.color,"color");this.connectSurfaceAttribute(a,this.ambientLevel,"ambientLevel");this.connectSurfaceAttribute(a,this.diffuseLevel,"diffuseLevel");this.connectSurfaceAttribute(a,this.specularLevel,"specularLevel");this.connectSurfaceAttribute(a,this.emissiveLevel,"emissiveLevel");this.connectSurfaceAttribute(a,this.ambient,"ambient");this.connectSurfaceAttribute(a,this.diffuse,"diffuse");this.connectSurfaceAttribute(a,this.specular,"specular");this.connectSurfaceAttribute(a,this.emissive,"emissive");this.connectSurfaceAttribute(a,this.glossiness,"glossiness");this.connectSurfaceAttribute(a,this.opacity,"opacity");this.connectSurfaceAttribute(a,this.doubleSided,"doubleSided");this.connectSurfaceAttribute(a,this.texturesEnabled,"texturesEnabled");this.connectSurfaceAttribute(a,this.enabled,"enabled")};Model.prototype.connectSurfaceAttribute=function(a,d,c){var b=this.getAttributeModificationCount(d)>0?true:false;d.addTarget(a.getAttribute(c),eAttrSetOp.Replace,null,b)};Model.prototype.connectGeometryAttributes=function(a){this.connectGeometryAttribute(a,this.selectable,"selectable");this.connectGeometryAttribute(a,this.cullable,"cullable");this.connectGeometryAttribute(a,this.show,"show");this.connectGeometryAttribute(a,this.approximationLevels,"approximationLevels");this.connectGeometryAttribute(a,this.showApproximationLevel,"showApproximationLevel");this.connectGeometryAttribute(a,this.sortPolygons,"sortPolygons");this.connectGeometryAttribute(a,this.flipPolygons,"flipPolygons");this.connectGeometryAttribute(a,this.intersector,"intersector");this.connectGeometryAttribute(a,this.intersectee,"intersectee");this.connectGeometryAttribute(a,this.stationary,"stationary");this.connectGeometryAttribute(a,this.shadowCaster,"shadowCaster");this.connectGeometryAttribute(a,this.shadowTarget,"shadowTarget");this.connectGeometryAttribute(a,this.renderSequenceSlot,"renderSequenceSlot")};Model.prototype.connectGeometryAttribute=function(d,c,b){var a=this.getAttributeModificationCount(c)>0?true:false;c.addTarget(d.getAttribute(b),eAttrSetOp.Replace,null,a)};Model.prototype.addGeometryBBox=function(a){if(a==null||a==undefined){return}a.bbox.min.addModifiedCB(Model_GeometryBBoxModifiedCB,this);a.bbox.max.addModifiedCB(Model_GeometryBBoxModifiedCB,this);this.updateGeometryBBox(a)};Model.prototype.updateGeometryBBox=function(c){if(c==null||c==undefined){return}var b=c.bbox.min.getValueDirect();var a=c.bbox.max.getValueDirect();this.geometryBBoxesMap[c]=new Pair(b,a);this.updateBBox()};Model.prototype.updateBBox=function(){var d=new Vector3D();var b=new Vector3D();var e=true;for(var c in this.geometryBBoxesMap){if(e){d.x=this.geometryBBoxesMap[c].first.x;d.y=this.geometryBBoxesMap[c].first.y;d.z=this.geometryBBoxesMap[c].first.z;b.x=this.geometryBBoxesMap[c].second.x;b.y=this.geometryBBoxesMap[c].second.y;b.z=this.geometryBBoxesMap[c].second.z;e=false;continue}d.x=Math.min(d.x,this.geometryBBoxesMap[c].first.x);d.y=Math.min(d.y,this.geometryBBoxesMap[c].first.y);d.z=Math.min(d.z,this.geometryBBoxesMap[c].first.z);b.x=Math.max(b.x,this.geometryBBoxesMap[c].second.x);b.y=Math.max(b.y,this.geometryBBoxesMap[c].second.y);b.z=Math.max(b.z,this.geometryBBoxesMap[c].second.z)}this.bbox.min.setValueDirect(d.x,d.y,d.z);this.bbox.max.setValueDirect(b.x,b.y,b.z);var a=new Vector3D((d.x+b.x)/2,(d.y+b.y)/2,(d.z+b.z)/2);this.center.setValueDirect(a.x,a.y,a.z)};function Model_SortPolygonsModifiedCB(b,a){}function Model_RenderSequenceSlotModifiedCB(b,a){}function Model_DissolveModifiedCB(b,a){}function Model_OpacityModifiedCB(b,a){}function Model_TextureOpacityModifiedCB(b,a){}function Model_Surface_NumTransparencyTexturesModifiedCB(b,a){}function Model_GeometryBBoxModifiedCB(b,a){a.updateGeometryBBox(b.getContainer().getContainer())}function Model_SurfaceAttrModifiedCB(b,a){}function Model_GeometryAttrModifiedCB(b,a){}Texture.prototype=new ParentableMotionElement();Texture.prototype.constructor=Texture;function Texture(){ParentableMotionElement.call(this);this.className="Texture";this.attrType=eAttrType.Texture;this.updateImage=false;this.updateTextureType=false;this.updateMipmappingEnabled=false;this.setImage=false;this.imageSet=false;this.textureObj=null;this.pitch=0;this.image=new ImageAttr();this.opacity=new NumberAttr(1);this.textureType=new NumberAttr(eTextureType.Color);this.widthWrap=new NumberAttr(eTextureWrap.None);this.heightWrap=new NumberAttr(eTextureWrap.None);this.mipmappingEnabled=new BooleanAttr(false);this.image.getAttribute("width").addModifiedCB(Texture_ImageModifiedCB,this);this.image.getAttribute("height").addModifiedCB(Texture_ImageModifiedCB,this);this.image.getAttribute("byteAlignment").addModifiedCB(Texture_ImageModifiedCB,this);this.image.getAttribute("pixelFormat").addModifiedCB(Texture_ImageModifiedCB,this);this.image.getAttribute("pixels").addModifiedCB(Texture_ImagePixelsModifiedCB,this);this.textureType.addModifiedCB(Texture_TextureTypeModifiedCB,this);this.opacity.addModifiedCB(Texture_OpacityModifiedCB,this);this.widthWrap.addModifiedCB(Texture_WrapModifiedCB,this);this.heightWrap.addModifiedCB(Texture_WrapModifiedCB,this);this.mipmappingEnabled.addModifiedCB(Texture_MipmappingEnabledModifiedCB,this);this.registerAttribute(this.image,"image");this.registerAttribute(this.opacity,"opacity");this.registerAttribute(this.textureType,"textureType");this.registerAttribute(this.widthWrap,"widthWrap");this.registerAttribute(this.heightWrap,"heightWrap");this.registerAttribute(this.mipmappingEnabled,"mipmappingEnabled")}Texture.prototype.setGraphMgr=function(a){this.textureObj=a.renderContext.createTextureObject();ParentableMotionElement.prototype.setGraphMgr.call(this,a)};Texture.prototype.update=function(b,a){if(this.updateImage){this.updateImage=false;this.setImage=true}if(this.updateMipmappingEnabled){if(this.imageSet){this.setImage=true;this.updateMipmappingEnabled=false}}if(this.setImage){this.setImage=!(this.SetImage())}if(this.updatePosition||this.updateRotation||this.updateScale){ParentableMotionElement.prototype.update.call(this,b,a)}else{SGNode.prototype.update.call(this,b,a)}};Texture.prototype.apply=function(f,e,d){var b=this.enabled.getValueDirect();if(!b){ParentableMotionElement.prototype.apply.call(this,f,e,d);return}switch(f){case"render":if(this.imageSet){var g=e.drawTextures&&this.graphMgr.getDrawTextures();if(g){var a=this.graphMgr.textureArrayStack.top().textures;var c=this.textureType.getValueDirect();if(a[c]){a[c].push(this)}}}break}ParentableMotionElement.prototype.apply.call(this,f,e,d)};Texture.prototype.SetImage=function(){var c=this.image.width.getValueDirect();var a=this.image.height.getValueDirect();var b=this.image.pixelFormat.getValueDirect();var e=this.image.pixels.getValueDirect();if(c==0||a==0||b==ePixelFormat.Unknown||e==null){return false}var d;switch(this.textureType.getValueDirect()){case eTextureType.Diffuse:case eTextureType.Luminosity:case eTextureType.Specularity:case eTextureType.Transparency:d=eImageFormat.Alpha;break;case eTextureType.Color:default:d=eImageFormat.RGBA;break}this.textureObj.setImageData(c,a,b,d,e);this.imageSet=true;return true};function Texture_ImageModifiedCB(b,a){a.updateImage=true;a.incrementModificationCount()}function Texture_ImagePixelsModifiedCB(b,a){a.updateImage=true;a.incrementModificationCount()}function Texture_OpacityModifiedCB(b,a){a.incrementModificationCount()}function Texture_TextureTypeModifiedCB(b,a){a.updateTextureType=true;a.incrementModificationCount()}function Texture_WrapModifiedCB(b,a){a.incrementModificationCount()}function Texture_MipmappingEnabledModifiedCB(b,a){a.updateMipmappingEnabled=true;a.incrementModificationCount()}MediaTexture.prototype=new Texture();MediaTexture.prototype.constructor=MediaTexture;function MediaTexture(){Texture.call(this);this.className="MediaTexture";this.attrType=eAttrType.MediaTexture;this.updateImageFilename=false;this.updateAlphaFilename=false;this.updateNegateImage=false;this.updateNegateAlpha=false;this.imagePlayback=null;this.alphaPlayback=null;this.pixelMap=ePixelMap.Default;this.forceImageUpdate=false;this.imageFilename=new StringAttr("");this.alphaFilename=new StringAttr("");this.negateImage=new BooleanAttr(false);this.negateAlpha=new BooleanAttr(false);this.frame=new NumberAttr(-1);this.frameRetrieved=new NumberAttr(-1);this.imageFilename.addModifiedCB(MediaTexture_ImageFilenameModifiedCB,this);this.alphaFilename.addModifiedCB(MediaTexture_AlphaFilenameModifiedCB,this);this.negateImage.addModifiedCB(MediaTexture_NegateImageModifiedCB,this);this.negateAlpha.addModifiedCB(MediaTexture_NegateAlphaModifiedCB,this);this.registerAttribute(this.imageFilename,"imageFilename");this.registerAttribute(this.alphaFilename,"alphaFilename");this.registerAttribute(this.negateImage,"negateImage");this.registerAttribute(this.negateAlpha,"negateAlpha");this.registerAttribute(this.frame,"frame");this.registerAttribute(this.frameRetrieved,"frameRetrieved")}MediaTexture.prototype.setGraphMgr=function(a){Texture.prototype.setGraphMgr.call(this,a)};MediaTexture.prototype.update=function(b,a){if(this.updateImageFilename||this.updateAlphaFilename){this.updateImageFilename=false;this.updateAlphaFilename=false;this.frame.setValueDirect(-1);this.loadMedia()}if(this.updateTextureType){this.updateTextureType=false;this.setImageSize();this.forceImageUpdate=true}if(this.updateNegateImage){this.updateNegateImage=false;this.forceImageUpdate=true}if(this.updateNegateAlpha){this.updateNegateAlpha=false;this.forceImageUpdate=true}if(this.enabled.getValueDirect()){this.updateMediaTextureImage()}Texture.prototype.update.call(this,b,a)};MediaTexture.prototype.apply=function(d,c,b){var a=this.enabled.getValueDirect();if(!a){Texture.prototype.apply.call(this,d,c,b);return}Texture.prototype.apply.call(this,d,c,b)};MediaTexture.prototype.loadMedia=function(){var a=this.imageFilename.getValueDirect().join("");if(a&&a!=""&&!this.imagePlayback||(this.imagePlayback&&this.imagePlayback.url!=a)){this.imagePlayback=new MediaPlayback(this,MediaTexture_OnImageLoad);this.imagePlayback.container=this;this.imagePlayback.loadImage(a)}else{if(a==""){}}var b=this.alphaFilename.getValueDirect().join("");if(b&&b!=""&&!this.alphaPlayback||(this.alphaPlayback&&this.alphaPlayback.url!=b)){this.alphaPlayback=new MediaPlayback(this,MediaTexture_OnAlphaLoad);this.alphaPlayback.container=this;this.alphaPlayback.loadImage(b);if(this.imagePlayback){this.imagePlayback.setAlphaChannel(this.alphaPlayback)}}else{if(b==""){}}};MediaTexture.prototype.setImageSize=function(){if(this.textureType.getValueDirect()==eTextureType.Color&&!this.alphaPlayback){return}if(!this.imagePlayback){return}var e=this.imagePlayback.getFrameDimensions();var c=nextHighestPowerOfTwo(e.width);var a=nextHighestPowerOfTwo(e.height);var b;switch(this.textureType.getValueDirect()){case eTextureType.Diffuse:case eTextureType.Luminosity:case eTextureType.Specularity:case eTextureType.Transparency:case eTextureType.Clip:b=ePixelFormat.A8;this.pixelMap=ePixelMap.RGBToAlpha;break;case eTextureType.Color:default:b=this.imagePlayback.getPixelFormat();this.pixelMap=ePixelMap.Default;break}if(this.alphaPlayback){switch(b){case ePixelFormat.R8G8B8:b=ePixelFormat.R8G8B8A8;break;case ePixelFormat.B8G8R8:b=ePixelFormat.B8G8R8A8;break}}var d=this.imagePlayback.getPixelByteAlignment();this.pitch=c*BytesPerPixel(b);this.pitch+=(d-this.pitch%d)%d;this.image.width.setValueDirect(c);this.image.height.setValueDirect(a);this.image.pixelFormat.setValueDirect(b);this.image.byteAlignment.setValueDirect(d);this.image.pixels.setLength(a*this.pitch)};MediaTexture.prototype.updateMediaTextureImage=function(){if(this.textureType.getValueDirect()==eTextureType.Color&&!this.alphaPlayback){return}if(this.imagePlayback&&this.imagePlayback.ready&&(this.imagePlayback.newFrameDataAvailable()||(this.alphaPlayback&&this.alphaPlayback.newFrameDataAvailable())||this.forceImageUpdate)){var e=this.image.width.getValueDirect();var a=this.image.height.getValueDirect();var b=this.image.pixelFormat.getValueDirect();var c=FRAME_FILTER_SCALE_FRAME_BIT;if(this.negateImage.getValueDirect()){c|=FRAME_FILTER_NEGATE_COLOR_BIT}if(this.negateAlpha.getValueDirect()){c|=FRAME_FILTER_NEGATE_ALPHA_BIT}var d=this.imagePlayback.getFrameData(e,a,this.pitch,b,this.image.pixels.values,c,this.pixelMap,this.frame.getValueDirect());this.frameRetrieved.setValueDirect(d);this.forceImageUpdate=false}};MediaTexture.prototype.onImageLoad=function(){if(this.textureType.getValueDirect()==eTextureType.Color&&!this.alphaPlayback){this.textureObj.setImage(this.imagePlayback.htmlImageElement,ePixelFormat.R8G8B8,eImageFormat.RGB);this.imageSet=true;return}this.setImageSize()};MediaTexture.prototype.onAlphaLoad=function(){};MediaTexture.prototype.onVideoLoad=function(){this.textureObj.setVideo(this.htmlImageElement);this.textureObj.negate=this.negateImage.getValueDirect();this.imageSet=true};function MediaTexture_OnImageLoad(){this.container.onImageLoad()}function MediaTexture_OnAlphaLoad(){this.container.onAlphaLoad()}function MediaTexture_OnVideoLoad(){alert("MediaTexture_OnVideoLoad");this.container.onVideoLoad()}function MediaTexture_ImageFilenameModifiedCB(b,a){a.updateImageFilename=true;a.incrementModificationCount()}function MediaTexture_AlphaFilenameModifiedCB(b,a){a.updateAlphaFilename=true;a.incrementModificationCount()}function MediaTexture_NegateImageModifiedCB(b,a){a.updateNegateImage=true;a.incrementModificationCount()}function MediaTexture_NegateAlphaModifiedCB(b,a){a.updateNegateAlpha=true;a.incrementModificationCount()}Evaluator.prototype=new Node();Evaluator.prototype.constructor=Evaluator;function Evaluator(){Node.call(this);this.className="Evaluator";this.attrType=eAttrType.Evaluator;this.expired=new BooleanAttr(false);this.registerAttribute(this.expired,"expired")}Evaluator.prototype.evaluate=function(){};Evaluator.prototype.update=function(d,b){var a=this.enabled.getValueDirect();var c=this.expired.getValueDirect();if(a&&!c){this.evaluate()}Node.prototype.update.call(this,d,b)};SceneInspector.prototype=new Evaluator();SceneInspector.prototype.constructor=SceneInspector;function SceneInspector(){Evaluator.call(this);this.className="SceneInspector";this.attrType=eAttrType.SceneInspector;this.viewPosition=new Vector3DAttr(0,0,0);this.viewRotation=new Vector3DAttr(0,0,0);this.translationDelta=new Vector3DAttr(0,0,0);this.panDelta=new Vector3DAttr(0,0,0);this.trackDelta=new Vector3DAttr(0,0,0);this.rotationDelta=new Vector3DAttr(0,0,0);this.viewRelativeXAxisRotation=new BooleanAttr(false);this.viewRelativeYAxisRotation=new BooleanAttr(false);this.viewRelativeZAxisRotation=new BooleanAttr(false);this.pivotDistance=new NumberAttr(0);this.pivotPointWorld=new Vector3DAttr(0,0,0);this.resultPosition=new Vector3DAttr(0,0,0);this.resultRotation=new Vector3DAttr(0,0,0);this.registerAttribute(this.viewPosition,"viewPosition");this.registerAttribute(this.viewRotation,"viewRotation");this.registerAttribute(this.translationDelta,"translationDelta");this.registerAttribute(this.panDelta,"panDelta");this.registerAttribute(this.trackDelta,"trackDelta");this.registerAttribute(this.rotationDelta,"rotationDelta");this.registerAttribute(this.viewRelativeXAxisRotation,"viewRelativeXAxisRotation");this.registerAttribute(this.viewRelativeYAxisRotation,"viewRelativeYAxisRotation");this.registerAttribute(this.viewRelativeZAxisRotation,"viewRelativeZAxisRotation");this.registerAttribute(this.pivotDistance,"pivotDistance");this.registerAttribute(this.pivotPointWorld,"pivotPointWorld");this.registerAttribute(this.resultPosition,"resultPosition");this.registerAttribute(this.resultRotation,"resultRotation")}SceneInspector.prototype.evaluate=function(){var p=this.enabled.getValueDirect();if(!p){return}var t=this.viewPosition.getValueDirect();var n=this.viewRotation.getValueDirect();var y=this.translationDelta.getValueDirect();var s=this.panDelta.getValueDirect();var m=this.trackDelta.getValueDirect();var G=this.rotationDelta.getValueDirect();var H=this.viewRelativeXAxisRotation.getValueDirect();var w=this.viewRelativeYAxisRotation.getValueDirect();var g=this.viewRelativeZAxisRotation.getValueDirect();var Q=this.pivotDistance.getValueDirect();var E=new Matrix4x4();E.loadTranslation(-t.x,-t.y,-t.z);var I=new Matrix4x4();I.loadXYZAxisRotation(-n.x,-n.y,-n.z);var b=E.multiply(I);var r=this.transformDirectionVector(0,1,0,b);var D=this.transformDirectionVector(1,0,0,b);var a=this.transformDirectionVector(0,0,1,b);var j=new Matrix4x4();var h=new Matrix4x4();var f=new Matrix4x4();if(H){j.loadRotation(D.x,D.y,D.z,-G.x)}else{j.loadXAxisRotation(-G.x)}if(w){h.loadRotation(r.x,r.y,r.z,-G.y)}else{h.loadYAxisRotation(-G.y)}if(g){f.loadRotation(a.x,a.y,a.z,-G.z)}else{f.loadXAxisRotation(-G.z)}var J=h.multiply(j.multiply(f));var K=new Matrix4x4();K.loadTranslation(y.x,-y.y,-y.z);if(s.x!=0||s.y!=0||s.z!=0||m.x!=0||m.y!=0||m.z!=0){var L=this.transformDirectionVector(r.x,r.y,r.z,J);var d=this.transformDirectionVector(D.x,D.y,D.z,J);var A=this.transformDirectionVector(a.x,a.y,a.z,J);var F=new Matrix4x4();F.loadTranslation(d.x*s.x+L.x*-s.y+A.x*-s.z,d.y*s.x+L.y*-s.y+A.y*-s.z,d.z*s.x+L.z*-s.y+A.z*-s.z);K=K.multiply(F);var z=new Matrix4x4();var o=new Matrix4x4();var l=false;var N=Math.abs(n.y);var O=Math.abs(n.x);var k=Math.abs(n.z);if(n.z>=90&&n.z<=270){l=true}else{if(n.z<=-90&&n.z>=-270){l=true}else{if(n.x<=-45||(n.x>=45&&n.x<=90)){l=true}}}var B=A;o.loadRotation(d.x,d.y,d.z,n.x);A=this.transformDirectionVector(A.x,A.y,A.z,o);var u=toDegrees(Math.acos(cosineAngleBetween(B,A)));o.loadRotation(d.x,d.y,d.z,90);L=this.transformDirectionVector(L.x,L.y,L.z,o);z.loadTranslation(d.x*m.x+L.x*-m.y+A.x*-m.z,d.y*m.x+L.y*-m.y+0,d.z*m.x+L.z*-m.y+A.z*-m.z);K=K.multiply(z)}var C=new Matrix4x4();C.loadMatrix(b);C.invert();var c=new Vector3D();c.load(C._41,C._42,C._43);var M=new Vector3D();M.load(c.x+a.x*Q,c.y+a.y*Q,c.z+a.z*Q);this.pivotPointWorld.setValueDirect(M.x,M.y,M.z);var x=new Matrix4x4();var R=new Matrix4x4();x.loadTranslation(-M.x,-M.y,-M.z);R.loadTranslation(M.x,M.y,M.z);var q=K.multiply(x.multiply(J.multiply(R.multiply(b))));var P=q.getRotationAngles();var e=new Vector3D();e.load(q._41,q._42,q._43);q.transpose();e=q.transform(e.x,e.y,e.z,0);this.resultPosition.setValueDirect(-e.x,-e.y,-e.z);this.resultRotation.setValueDirect(-P.x,-P.y,-P.z)};SceneInspector.prototype.transformDirectionVector=function(b,e,d,c){var a=new Matrix4x4();a.loadMatrix(c);a.transpose();return a.transform(b,e,d,0)};ArcballInspector.prototype=new Evaluator();ArcballInspector.prototype.constructor=ArcballInspector;function ArcballInspector(){Evaluator.call(this);this.className="ArcballInspector";this.attrType=eAttrType.ArcballInspector;this.sphereCenter=new Vector3DAttr(0,0,0);this.sphereRadius=new NumberAttr(0);this.mouseDown=new Vector2DAttr(0,0);this.mouseNow=new Vector2DAttr(0,0);this.quatAtMouseDown=new QuaternionAttr(1,0,0,0);this.viewport=new ViewportAttr(0,0,0,0);this.worldTransform=new Matrix4x4Attr();this.viewTransform=new Matrix4x4Attr();this.constrainToAxis=new BooleanAttr(false);this.constraintAxis=new Vector3DAttr(0,0,0);this.resultQuat=new QuaternionAttr(1,0,0,0);this.registerAttribute(this.sphereCenter,"sphereCenter");this.registerAttribute(this.sphereRadius,"sphereRadius");this.registerAttribute(this.mouseDown,"mouseDown");this.registerAttribute(this.mouseNow,"mouseNow");this.registerAttribute(this.quatAtMouseDown,"quatAtMouseDown");this.registerAttribute(this.viewport,"viewport");this.registerAttribute(this.worldTransform,"worldTransform");this.registerAttribute(this.viewTransform,"viewTransform");this.registerAttribute(this.constrainToAxis,"constrainToAxis");this.registerAttribute(this.constraintAxis,"constraintAxis");this.registerAttribute(this.resultQuat,"resultQuat")}ArcballInspector.prototype.evaluate=function(){if(!(this.enabled.getValueDirect())){return}var a=this.sphereCenter.getValueDirect();var l=this.sphereRadius.getValueDirect();var j=this.mouseDown.getValueDirect();var g=this.mouseNow.getValueDirect();var b=this.quatAtMouseDown.getValueDirect();var c=this.viewport;var k=this.worldTransform.getValueDirect();var o=this.viewTransform.getValueDirect();k.invert();o=o.multiply(k);var n=this.constrainToAxis.getValueDirect();a.x=2*(a.x-c.x)/c.width-1;a.y=2*(c.height-a.y-c.y)/c.height-1;j.x=2*(j.x-c.x)/c.width-1;j.y=2*(c.height-j.y-c.y)/c.height-1;g.x=2*(g.x-c.x)/c.width-1;g.y=2*(c.height-g.y-c.y)/c.height-1;var h,e;if(!n){h=this.getSpherePoint(j,a,l);e=this.getSpherePoint(g,a,l)}else{var f=this.constraintAxis.getValueDirect();h=this.getSpherePointAboutAxis(j,a,l,f);e=this.getSpherePointAboutAxis(g,a,l,f)}var d=o.transform(h.x,h.y,h.z,0);var p=o.transform(e.x,e.y,e.z,0);h.x=d.x;h.y=d.y;h.z=d.z;e.x=p.x;e.y=p.y;e.z=p.z;h.normalize();e.normalize();var m=this.getQuatFromSpherePoints(h,e);m=m.multiply(b);this.resultQuat.setValueDirect(m)};ArcballInspector.prototype.getSpherePoint=function(d,c,b){var a=new Vector3D();a.x=(d.x-c.x)/b;a.y=(d.y-c.y)/b;var e=a.x*a.x+a.y*a.y;if(e>1){var f=1/Math.sqrt(e);a.x*=f;a.y*=f;a.z=0}else{a.z=-(Math.sqrt(1-e))}return a};ArcballInspector.prototype.getSpherePointAboutAxis=function(d,b,a,h){point=this.getSpherePoint(d,b,a);var c=dotProduct(point,h);h.multiplyScalar(c);var g=new Vector3D(point.x,point.y,point.z);g.subtractVector(h);var e=magnitude(g.x,g.y,g.z);point=null;if(e>0){var f=1/Math.sqrt(e);if(g.z<0){g.x=-g.x;g.y=-g.y;g.z=-g.z}point=g.multiplyScalar(f)}else{if(h.z==1){point=new Vector3D(1,0,0)}else{point.normalize()}}};ArcballInspector.prototype.getQuatFromSpherePoints=function(c,b){var a=new Quaternion();a.x=c.y*b.z-c.z*b.y;a.y=c.z*b.x-c.x*b.z;a.z=c.x*b.y-c.y*b.x;a.w=c.x*b.x+c.y*b.y+c.z*b.z;return a};function ArcballInspector_ViewTransformModifiedCB(b,a){}KeyframeInterpolator.prototype=new Evaluator();KeyframeInterpolator.prototype.constructor=KeyframeInterpolator;function EndState(){this.initialized=false;this.startKeyIts=[];this.endKeyIts=[];this.startTime=-FLT_MAX;this.endTime=FLT_MAX}function KeyframeInterpolator(){Evaluator.call(this);this.className="KeyframeInterpolator";this.attrType=eAttrType.KeyframeInterpolator;this.lastTime=0;this.evaluated=false;this.endState=new EndState();this.time=new NumberAttr(0);this.channels=new AttributeVector();this.startKeys=new AttributeVector();this.endKeys=new AttributeVector();this.preBehaviors=new AttributeVector();this.postBehaviors=new AttributeVector();this.resultValues=new AttributeVector();this.time.addModifiedCB(KeyframeInterpolator_TimeModifiedCB,this);this.registerAttribute(this.time,"time");this.registerAttribute(this.channels,"channels");this.registerAttribute(this.startKeys,"startKeys");this.registerAttribute(this.endKeys,"endKeys");this.registerAttribute(this.preBehaviors,"preBehaviors");this.registerAttribute(this.postBehaviors,"postBehaviors");this.registerAttribute(this.resultValues,"resultValues")}KeyframeInterpolator.prototype.setNumChannels=function(b){this.channels.resize(0);this.startKeys.resize(0);this.endKeys.resize(0);this.preBehaviors.resize(0);this.postBehaviors.resize(0);this.resultValues.resize(0);for(var a=0;a<b;a++){this.channels.push_back(new KeyframesAttr());this.startKeys.push_back(new NumberAttr(-1));this.endKeys.push_back(new NumberAttr(-1));this.preBehaviors.push_back(new NumberAttr(eEndBehavior.Reset));this.postBehaviors.push_back(new NumberAttr(eEndBehavior.Reset));this.resultValues.push_back(new NumberAttr(0))}};KeyframeInterpolator.prototype.evaluate=function(){if(!this.endState.initialized){this.updateEndState();this.endState.initialized=true}var f=this.time.getValueDirect();var h,c;var e,b;for(var a=0;a<this.channels.vector.length;a++){var g=this.channels.getAt(a);if(g.vector.length==0){continue}h=this.endState.startKeyIts[a];c=this.endState.endKeyIts[a];e=this.preBehaviors.getAt(a).getValueDirect();b=this.postBehaviors.getAt(a).getValueDirect();var d=interpolate(f,g,h,c,e,b);this.resultValues.getAt(a).setValueDirect(d)}this.lastTime=f;this.evaluated=true};KeyframeInterpolator.prototype.timeModified=function(){this.updateExpired()};KeyframeInterpolator.prototype.updateExpired=function(){this.expired.setValueDirect(false);var e=false;var d=this.time.getValueDirect();var c=0;var f=null;var b=this.channels.vector.length;for(var a=0;a<b;a++){f=this.postBehaviors.getAt(a);if(f){c=f.getValueDirect()}if(c!=eEndBehavior.Constant){e=true;break}}if(!e&&(d<this.endState.startTime||d>this.endState.endTime)){this.expired.setValueDirect(true)}};KeyframeInterpolator.prototype.updateEndState=function(){var a=-1;var g=-1;var f=FLT_MAX;var c=-FLT_MAX;var h=-1,b=-1;var e=null;var j=this.channels.vector.length;this.startKeys.resize(j);this.endKeys.resize(j);for(var d=0;d<j;d++){e=this.channels.getAt(d);h=this.startKeys.vector.length>d?this.startKeys.getAt(d).getValueDirect():-1;b=this.endKeys.vector.length>d?this.endKeys.getAt(d).getValueDirect():-1;if(b<h){b=h}this.endState.startKeyIts[d]=e.getAt(0);this.endState.endKeyIts[d]=e.getAt(e.vector.length-1);if(h>=0&&h<e.vector.length){this.endState.startKeyIts[d]=e.getAt(h)}if(b>=0&&b<e.vector.length){this.endState.endKeyIts[d]=e.getAt(b)}a=this.endState.startKeyIts[d].getTime();g=this.endState.endKeyIts[d].getTime();f=a<f?a:f;c=g>=c?g:c}this.endState.startTime=f;this.endState.endTime=c};function KeyframeInterpolator_TimeModifiedCB(b,a){a.timeModified()}function KeyframeInterpolator_EndStateModifiedCB(b,a){a.updateEndState()}BBoxLocator.prototype=new Evaluator();BBoxLocator.prototype.constructor=BBoxLocator;function BBoxLocator(){Evaluator.call(this);this.className="BBoxLocator";this.attrType=eAttrType.BBoxLocator;this.viewPosition=new Vector3DAttr(0,0,0);this.viewTransform=new Matrix4x4Attr(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);this.viewVolume=new ViewVolumeAttr();this.viewport=new ViewportAttr(0,0,0,0);this.nearDistance=new NumberAttr(0);this.bbox=new BBoxAttr();this.bboxView=new BBoxAttr();this.closeness=new NumberAttr(0.5);this.resultPosition=new Vector3DAttr(0,0,0);this.resultWidth=new NumberAttr(0);this.resultFarDistance=new NumberAttr(0);this.resultPivotDistance=new NumberAttr(0);this.registerAttribute(this.viewPosition,"viewPosition");this.registerAttribute(this.viewTransform,"viewTransform");this.registerAttribute(this.viewVolume,"viewVolume");this.registerAttribute(this.viewport,"viewport");this.registerAttribute(this.nearDistance,"nearDistance");this.registerAttribute(this.bbox,"bbox");this.registerAttribute(this.bboxView,"bboxView");this.registerAttribute(this.closeness,"closeness");this.registerAttribute(this.resultPosition,"resultPosition");this.registerAttribute(this.resultWidth,"resultWidth");this.registerAttribute(this.resultFarDistance,"resultFarDistance");this.registerAttribute(this.resultPivotDistance,"resultPivotDistance")}BBoxLocator.prototype.evaluate=function(){var o=this.viewPosition.getValueDirect();var g=this.viewTransform.getValueDirect();var f=this.viewVolume.left.getValueDirect();var I=this.viewVolume.right.getValueDirect();var t=this.viewVolume.top.getValueDirect();var n=this.viewVolume.bottom.getValueDirect();var F=this.viewVolume.near.getValueDirect();var a=this.viewVolume.far.getValueDirect();var E=this.viewport.getValueDirect();var z=this.bbox.min.getValueDirect();var C=this.bbox.max.getValueDirect();var k=this.closeness.getValueDirect();if(k!=0){var b=C.x-z.x;var m=C.y-z.y;b+=b*k;m+=m*k;if(E.width/E.height<b/m){b=(b-(C.x-z.x))/2;z.x-=b;C.x+=b}else{m=(m-(C.y-z.y))/2;z.y-=m;C.y+=m}}var w=new Array(8);w[0]=new Vector3D(z.x,z.y,z.z);w[1]=new Vector3D(z.x,z.y,C.z);w[2]=new Vector3D(z.x,C.y,z.z);w[3]=new Vector3D(z.x,C.y,C.z);w[4]=new Vector3D(C.x,z.y,z.z);w[5]=new Vector3D(C.x,z.y,C.z);w[6]=new Vector3D(C.x,C.y,z.z);w[7]=new Vector3D(C.x,C.y,C.z);var K=new Vector3D((z.x+C.x)/2,(z.y+C.y)/2,(z.z+C.z)/2);var D=new Vector3D();D.copy(g.transform(0,0,1,0));D.normalize();var e=0;var y;var q=planesIntersect(f,I);if(q){var H=new Array(5);H[0]=this.getPlane(f.point,K,f.normal,g);H[1]=this.getPlane(I.point,K,I.normal,g);H[2]=this.getPlane(t.point,K,t.normal,g);H[3]=this.getPlane(n.point,K,n.normal,g);H[4]=this.getPlane(F.point,K,F.normal,g);for(var B=0;B<8;B++){for(var A=0;A<5;A++){if(pointOnPositiveSideOfPlane(w[B],H[A])){var G=this.distanceFromPlane(w[B],D,H[A]);if(G.intersection){e=Math.max(e,G.distance)}}}}y=new Vector3D(K.x,K.y,K.z);D.multiplyScalar(e);y.subtractVector(D)}else{y=new Vector3D(K.x,K.y,K.z);e=magnitude(o.x,o.y,o.z);D.multiplyScalar(e);y.subtractVector(D);var h=this.bboxView.min.getValueDirect();var l=this.bboxView.max.getValueDirect();var x=distanceBetweenPlanes(I,f);var u=distanceBetweenPlanes(t,n);var s=x/u;var J=Math.abs(l.x-h.x);var c=Math.abs(l.y-h.y);if(J>c){x=J;u=x/s;if(u<c){u=c;x=u*s}}else{u=c;x=u*s;if(x<J){x=J}}this.resultWidth.setValueDirect(x)}this.resultPosition.setValueDirect(y.x,y.y,y.z);e=0;for(var B=0;B<8;B++){var r=g.transform(w[B].x,w[B].y,w[B].z,1);e=Math.max(e,distanceBetween(w[B],y))}this.resultFarDistance.setValueDirect(this.nearDistance.getValueDirect()+e);e=distanceBetween(y,new Vector3D(K.x,K.y,K.z));this.resultPivotDistance.setValueDirect(e)};BBoxLocator.prototype.getPlane=function(a,g,f,d){var c=d.transformVector3D(a,0);c.x+=g.x;c.y+=g.y;c.z+=g.z;var e=d.transformVector3D(f,0);var b=new Plane(new Vector3D(c.x,c.y,c.z),new Vector3D(e.x,e.y,e.z));return b};BBoxLocator.prototype.distanceFromPlane=function(a,d,c){var b=new Line(a,d);var f;var e=lineIntersectsPlane(b,c);switch(e.result){case 0:f=FLT_MAX;break;case 1:f=distanceBetween(a,e.point);break;case 2:default:f=0;break}return{intersection:e.result,distance:f}};function worldUnitsPerPixelPersp(d,j,h){var c=2*Math.atan2(1,j);var e=2*Math.atan(d.width/d.height*Math.tan(c/2));var b=Math.tan(e/2)*h*2;var a=Math.tan(c/2)*h*2;var g=b/d.width;var f=a/d.height;return{x:g,y:f}}function worldUnitsPerPixelOrtho(c,d){var b=d*(c.height/c.width);var a=d/c.width;var e=b/c.height;return{x:a,y:e}}function toScreenSpace(e,b,d,a){var c=b.transformw(e.x,e.y,e.z,1);c=d.transformw(c.x,c.y,c.z,c.w);if(c.w==0){return{x:-Infinity,y:-Infinity,z:-Infinity}}c.x/=c.w;c.y/=c.w;c.x=a.x+a.width-((-c.x+1)*a.width/2);c.y=a.y+a.height-((c.y+1)*a.height/2);c.z=0;return{x:c.x,y:c.y,z:c.z}}RasterComponent.prototype=new ParentableMotionElement();RasterComponent.prototype.constructor=RasterComponent;function RasterComponent(){ParentableMotionElement.call(this);this.className="RasterComponent";this.attrType=eAttrType.RasterComponent;this.rcEventListener=null;this.opacity=new NumberAttr(1);this.anchor=new Vector2DAttr(0,0);this.origin=new StringAttr("bottomLeft");this.show=new BooleanAttr(true);this.selectable=new BooleanAttr(true);this.cullable=new BooleanAttr(true);this.clampToViewport=new BooleanAttr(false);this.rasterPosition=new Vector3DAttr();this.inspectionOffset=new Vector3DAttr();this.componentRect=new RectAttr();this.screenRect=new RectAttr();this.stylesMap.size.addModifiedCB(RasterComponent_StylesMapSizeModifiedCB,this);this.show.addModifiedCB(RasterComponent_ShowModifiedCB,this);this.registerAttribute(this.opacity,"opacity");this.registerAttribute(this.anchor,"anchor");this.registerAttribute(this.origin,"origin");this.registerAttribute(this.show,"show");this.registerAttribute(this.selectable,"selectable");this.registerAttribute(this.cullable,"cullable");this.registerAttribute(this.rasterPosition,"rasterPosition");this.registerAttribute(this.inspectionOffset,"inspectionOffset");this.registerAttribute(this.clampToViewport,"clampToViewport");this.registerAttribute(this.componentRect,"componentRect");this.registerAttribute(this.screenRect,"screenRect");this.renderSequenceSlot.setValueDirect(65535)}RasterComponent.prototype.setRegistry=function(a){var b=a.find("Bridgeworks");if(b){this.rcEventListener=b.rasterComponentEventListener;if(this.rcEventListener){this.rcEventListener.registerComponent(this);this.rcEventListener.Listen(this)}}ParentableMotionElement.prototype.setRegistry.call(this,a)};RasterComponent.prototype.isSelected=function(a,c){var b=this.show.getValueDirect();if(b){if(this.screenRect.containsPoint(a,c)){return true}}return false};RasterComponent.prototype.stylesMapSizeModified=function(){var b=this.stylesMap.Size();for(var a=0;a<b;a++){var c=this.stylesMap.getAt(a);if(c){c.event.removeModifiedCB(RasterComponent_StylesMapElementEventModifiedCB,this);c.event.addModifiedCB(RasterComponent_StylesMapElementEventModifiedCB,this);RasterComponent_StylesMapElementEventModifiedCB(c.event,this)}}};RasterComponent.prototype.stylesMapElementEventModified=function(a){this.rcEventListener.listenEvent(this,eEventNameMap[a])};RasterComponent.prototype.showModified=function(){};function RasterComponent_StylesMapSizeModifiedCB(b,a){a.stylesMapSizeModified()}function RasterComponent_StylesMapElementEventModifiedCB(b,a){a.stylesMapElementEventModified(b.getValueDirect().join(""))}function RasterComponent_ShowModifiedCB(b,a){a.showModified()}Label.prototype=new RasterComponent();Label.prototype.constructor=Label;function Label(){RasterComponent.call(this);this.className="Label";this.attrType=eAttrType.Label;this.iconRect=new Rect(0,0,0,0);this.labelRect=new Rect(0,0,0,0);this.text=new StringAttr("");this.description=new StringAttr("");this.depthShadingEnabled=new BooleanAttr(true);this.labelStyle=new LabelStyleAttr();this.iconStyle=new IconStyleAttr();this.balloonTipLabelStyle=new BalloonTipLabelStyleAttr();this.text.addModifiedCB(Label_TextModifiedCB,this);this.description.addModifiedCB(Label_DescriptionModifiedCB,this);this.labelStyle.backgroundColor.addModifiedCB(Label_LabelStyleBackgroundColorModifiedCB,this);this.labelStyle.backgroundOpacity.addModifiedCB(Label_LabelStyleBackgroundOpacityModifiedCB,this);this.labelStyle.fontStyle.borderColor.addModifiedCB(Label_LabelStyleFontBorderModifiedCB,this);this.labelStyle.fontStyle.borderWidth.addModifiedCB(Label_LabelStyleFontBorderModifiedCB,this);this.labelStyle.fontStyle.color.addModifiedCB(Label_LabelStyleFontStyleColorModifiedCB,this);this.labelStyle.fontStyle.font.addModifiedCB(Label_LabelStyleFontStyleFontModifiedCB,this);this.labelStyle.fontStyle.opacity.addModifiedCB(Label_LabelStyleFontStyleOpacityModifiedCB,this);this.labelStyle.fontStyle.size.addModifiedCB(Label_LabelStyleFontStyleSizeModifiedCB,this);this.labelStyle.fontStyle.style.addModifiedCB(Label_LabelStyleFontStyleStyleModifiedCB,this);this.labelStyle.format.addModifiedCB(Label_LabelStyleFormatModifiedCB,this);this.labelStyle.padding.addModifiedCB(Label_LabelStylePaddingModifiedCB,this);this.iconStyle.url.addModifiedCB(Label_IconStyleUrlModifiedCB,this);this.balloonTipLabelStyle.addModifiedCB(Label_BalloonTipLabelStyleModifiedCB,this);this.registerAttribute(this.text,"text");this.registerAttribute(this.description,"description");this.registerAttribute(this.depthShadingEnabled,"depthShadingEnabled");this.registerAttribute(this.labelStyle,"labelStyle");this.registerAttribute(this.iconStyle,"iconStyle");this.registerAttribute(this.balloonTipLabelStyle,"balloonTipLabelStyle");this.styles.registerStyle(this.iconStyle,"iconStyle");this.styles.registerStyle(this.labelStyle,"labelStyle");this.styles.registerStyle(this.balloonTipLabelStyle,"balloonTipLabelStyle")}Label.prototype.setGraphMgr=function(a){RasterComponent.prototype.setGraphMgr.call(this,a);this.id="Label"+this.graphMgr.getNextLabelIndex();this.labelId=this.id+"_label";this.iconId=this.id+"_icon";var b=CreateHTMLLabel(this.id,this.labelId,this.iconId);this.htmlLabel=b.label;this.htmlIconImg=b.iconImg;this.htmlIconDiv=b.iconDiv;this.htmlIconImg.baseWidth=0;this.htmlIconImg.baseHeight=0;Label_LabelStyleBackgroundColorModifiedCB(this.labelStyle.backgroundColor,this);Label_LabelStyleBackgroundOpacityModifiedCB(this.labelStyle.backgroundOpacity,this);Label_LabelStyleFontBorderModifiedCB(null,this);Label_LabelStyleFontStyleColorModifiedCB(this.labelStyle.fontStyle.color,this);Label_LabelStyleFontStyleFontModifiedCB(this.labelStyle.fontStyle.font,this);Label_LabelStyleFontStyleOpacityModifiedCB(this.labelStyle.fontStyle.opacity,this);Label_LabelStyleFontStyleSizeModifiedCB(this.labelStyle.fontStyle.size,this);Label_LabelStyleFontStyleStyleModifiedCB(this.labelStyle.fontStyle.style,this);Label_LabelStyleFormatModifiedCB(this.labelStyle.format,this);Label_LabelStylePaddingModifiedCB(this.labelStyle.padding,this);Label_IconStyleUrlModifiedCB(this.iconStyle.url,this)};Label.prototype.update=function(b,a){this.updateIconScale();RasterComponent.prototype.update.call(this,b,a)};Label.prototype.updateIconScale=function(){var a=this.iconStyle.scale.getValueDirect();if(this.htmlIconImg.baseWidth==0){this.htmlIconImg.baseWidth=this.htmlIconImg.offsetWidth;this.htmlIconImg.baseHeight=this.htmlIconImg.offsetHeight}if(this.htmlIconImg.baseWidth){this.htmlIconImg.width=this.htmlIconImg.baseWidth*a.x;this.htmlIconImg.height=this.htmlIconImg.baseHeight*a.y}};Label.prototype.apply=function(d,c,b){var a=this.enabled.getValueDirect();if(!a){RasterComponent.prototype.apply.call(this,d,c,b);return}switch(d){case"render":this.draw(c.viewport);break}RasterComponent.prototype.apply.call(this,d,c,b)};Label.prototype.draw=function(e){var a=this.registry.find("Bridgeworks");if(this.show.getValueDirect()==false){this.htmlLabel.style.visibility="hidden";this.htmlIconImg.style.visibility="hidden";return}this.htmlLabel.style.visibility="visible";this.htmlIconImg.style.visibility="visible";if(this.labelStyle.fontStyle.opacity.getValueDirect()==0){this.htmlLabel.style.visibility="hidden"}var h=this.iconStyle.color.getValueDirect();if(h.a==0||this.iconStyle.opacity.getValueDirect()==0){this.htmlIconImg.style.visibility="hidden"}var c=this.getRenderingPositions();var f=this.htmlLabel.offsetWidth;var b=this.htmlLabel.offsetHeight;var d=this.htmlIconImg.offsetWidth;var g=this.htmlIconImg.offsetHeight;if(c.labelX<0||c.labelY<0||c.labelX+f>a.canvas.width||c.labelY+b>a.canvas.height){this.htmlLabel.style.visibility="hidden"}if(c.iconX<0||c.iconY<0||c.iconX+d>a.canvas.width||c.iconY+g>a.canvas.height){this.htmlIconImg.style.visibility="hidden"}if(this.htmlLabel.style.visibility=="visible"){this.htmlLabel.style.left=a.canvas.offsetLeft+c.labelX;this.htmlLabel.style.top=a.canvas.offsetTop+c.labelY;this.labelRect.load(a.canvas.offsetLeft+c.labelX,a.canvas.offsetTop+c.labelY,this.labelRect.left+f,this.labelRect.top+b)}else{this.labelRect.load(0,0,0,0)}if(this.htmlIconImg.style.visibility=="visible"){this.htmlIconDiv.style.left=a.canvas.offsetLeft+c.iconX;this.htmlIconDiv.style.top=a.canvas.offsetTop+c.iconY;this.iconRect.load(a.canvas.offsetLeft+c.iconX,a.canvas.offsetTop+c.iconY,this.iconRect.left+d,this.iconRect.top+g)}else{this.iconRect.load(0,0,0,0)}var j=new Rect(0,0,0,0);if(this.htmlLabel.style.visibility=="visible"&&this.htmlIconImg.style.visibility=="visible"){j.left=Math.min(this.labelRect.left,this.iconRect.left);j.top=Math.min(this.labelRect.top,this.iconRect.top);j.right=Math.max(this.labelRect.right,this.iconRect.right);j.bottom=Math.max(this.labelRect.bottom,this.iconRect.bottom)}else{if(this.htmlLabel.style.visibility=="visible"){j.loadRect(this.labelRect)}else{if(this.htmlIconImg.style.visibility=="visible"){j.loadRect(this.iconRect)}}}this.screenRect.setValueDirect(j)};Label.prototype.getRenderingPositions=function(){var j=0;var g=0;var b=0;var a=0;var l=this.screenPosition.getValueDirect();var e=this.anchor.getValueDirect();var d=this.labelStyle.offset.getValueDirect();if(this.htmlIconImg.offsetWidth>0&&this.htmlLabel.offsetWidth>0){var h=this.htmlLabel.offsetWidth;var c=this.htmlLabel.offsetHeight;var f=this.htmlIconImg.offsetWidth;var k=this.htmlIconImg.offsetHeight;if(this.origin.getValueDirect().join("")=="bottomLeft"){e.y=k-e.y}b=l.x-e.x;a=l.y-e.y;j=b+d.x;g=a+d.y;switch(this.labelStyle.textAlign.getValueDirect().join("")){case"topLeft":j-=h;g-=c/2;break;case"middleLeft":j-=h;g+=k/2-c/2;break;case"bottomLeft":j-=h;g+=k-c/2;break;case"topCenter":j+=f/2-h/2;g-=c;break;case"middleCenter":j+=f/2-h/2;g+=k/2-c/2;break;case"bottomCenter":j+=f/2-h/2;g+=k;break;case"topRight":j+=f;g-=c/2;break;case"bottomRight":j+=f;g+=k-c/2;break;case"middleRight":default:j+=f;g+=k/2-c/2;break}}else{if(this.htmlLabel.offsetWidth>0){var h=this.htmlLabel.offsetWidth;var c=this.htmlLabel.offsetHeight;j=l.x+e.x+d.x;g=l.y-e.y+d.y;switch(this.labelStyle.textAlign.getValueDirect().join("")){case"topLeft":j-=h;g-=c;break;case"middleLeft":j-=h;g-=c/2;break;case"bottomLeft":j-=h;break;case"topCenter":j-=h/2;g-=c;break;case"middleCenter":j-=h/2;g-=c/2;break;case"bottomCenter":j-=h/2;break;case"topRight":g-=c;break;case"bottomRight":break;case"middleRight":default:g-=c/2;break}}else{var f=this.htmlIconImg.offsetWidth;var k=this.htmlIconImg.offsetHeight;e.y=k-e.y;b=l.x-e.x;a=l.y-e.y}}return{labelX:j,labelY:g,iconX:b,iconY:a}};Label.prototype.eventPerformed=function(b){if(!(this.show.getValueDirect())){return false}var a=this.isSelected(b.x,b.y);return a};Label.prototype.labelStyleFontBorderModified=function(){var a=this.labelStyle.fontStyle.borderColor.getValueDirect();a.a*=this.labelStyle.fontStyle.opacity.getValueDirect();var c=this.labelStyle.fontStyle.borderWidth.getValueDirect();var d="";for(var b=0;b<a.a;b+=0.2){if(b>0){d+=", "}d+="rgba("+a.r*255+","+a.g*255+","+a.b*255+","+a.a+") 0px 0px "+c*2+"px"}this.htmlLabel.style.textShadow=d};function CreateHTMLLabel(g,e,d){var c=null;var b=null;var a=null;var f=null;if(bridgeworks.rasterComponents){c=document.createElement("div");if(c){c.setAttribute("id",g);b=document.createElement("span");if(b){b.setAttribute("id",e);b.setAttribute("class","labelText");b.style.visibility="hidden";b.style.position="absolute";b.style.zIndex=3;b.onmousedown=function(){};b.onmouseup=function(){};b.onmousemove=function(){};b.onselectstart=new Function("return false");c.appendChild(b)}f=document.createElement("div");if(f){f.setAttribute("id",d);f.style.position="absolute";f.style.zIndex=3;a=document.createElement("img");if(a){a.setAttribute("class","labelIcon");a.style.visibility="hidden";a.src="BwContent/images/1x1.png";a.onmouseup=function(){};a.onmousemove=function(){};a.onmousedown=function(){return false};f.appendChild(a)}c.appendChild(f)}bridgeworks.rasterComponents.appendChild(c)}}return{div:c,label:b,iconDiv:f,iconImg:a}}function Label_TextModifiedCB(b,a){a.htmlLabel.innerHTML=b.getValueDirect().join("")}function Label_DescriptionModifiedCB(d,a){var g=d.getValueDirect().join("");if(g.length>0){var c=a.balloonTipLabelStyle.htmlLabelStyle.width.getValueDirect();var h=a.balloonTipLabelStyle.htmlLabelStyle.height.getValueDirect();if(c==0||h==0){var e=a.registry.find("ViewportMgr");if(c==0){c=e.getAttribute("width").getValueDirect()*0.5}if(h==0){h=e.getAttribute("height").getValueDirect()*0.5}}var b="#"+a.iconId;g="<div class='gmap' style='width:"+(c+12)+"px;height:12px;'><a href='javascript:void($(\""+b+"\").btOff());'><img src='libs/jquery/bt/close.gif' alt='close' width='12' height='12' class='gmap-close' /></a> </div><div style='width:"+(c+12)+"px;height:"+h+"px;overflow:auto;'>"+g+"</div>";var f=a.balloonTipLabelStyle.bgColor.getValueDirect();var j="rgba("+f.r*255+","+f.g*255+","+f.b*255+","+f.a*255+")";$(b).bt(g,{trigger:"click",width:c+12+"px",height:h+12+"px",shrinkToFit:((c==0&&h==0)?true:false),centerPointX:0.9,spikeLength:a.balloonTipLabelStyle.balloonOffset.getValueDirect(),spikeGirth:30,padding:15,cornerRadius:25,fill:j,strokeStyle:"#ABABAB",strokeWidth:1,shadow:true,shadowOffsetX:3,shadowOffsetY:3,shadowBlur:8,shadowColor:"rgba(0,0,0,.9)",shadowOverlap:false,noShadowOpts:{strokeStyle:"#999",strokeWidth:2}})}else{var b="#"+a.iconId;$(b).bt("",{trigger:"click"})}}function Label_LabelStyleBackgroundColorModifiedCB(c,a){var b=c.getValueDirect();b.a*=c.getContainer().getAttribute("backgroundOpacity").getValueDirect();a.htmlLabel.style.backgroundColor="rgba("+b.r*255+","+b.g*255+","+b.b*255+","+b.a+")"}function Label_LabelStyleBackgroundOpacityModifiedCB(b,a){Label_LabelStyleBackgroundColorModifiedCB(a.labelStyle.backgroundColor,a)}function Label_LabelStyleFontBorderModifiedCB(b,a){a.labelStyleFontBorderModified()}function Label_LabelStyleFontStyleColorModifiedCB(c,a){var b=c.getValueDirect();b.a*=c.getContainer().getAttribute("opacity").getValueDirect();a.htmlLabel.style.color="rgba("+b.r*255+","+b.g*255+","+b.b*255+","+b.a+")"}function Label_LabelStyleFontStyleFontModifiedCB(b,a){a.htmlLabel.style.fontFamily=b.getValueDirect().join("")}function Label_LabelStyleFontStyleOpacityModifiedCB(b,a){Label_LabelStyleFontStyleColorModifiedCB(a.labelStyle.fontStyle.color,a);Label_LabelStyleFontBorderModifiedCB(null,a)}function Label_LabelStyleFontStyleSizeModifiedCB(b,a){a.htmlLabel.style.fontSize=b.getValueDirect()+"pt"}function Label_LabelStyleFontStyleStyleModifiedCB(b,a){switch(b.getValueDirect().join("")){case"Bold":a.htmlLabel.style.fontWeight="bold";break;case"Heavy":a.htmlLabel.style.fontWeight="bolder";break;case"Normal":a.htmlLabel.style.fontWeight="normal";break;case"Thin":a.htmlLabel.style.fontWeight="lighter";break}}function Label_LabelStyleFormatModifiedCB(b,a){var c=b.getValueDirect().join("")}function Label_LabelStylePaddingModifiedCB(b,a){var c=b.getValueDirect()+"px";a.htmlLabel.style.paddingLeft=c;a.htmlLabel.style.paddingRight=c;a.htmlLabel.style.paddingTop=c;a.htmlLabel.style.paddingBottom=c}function Label_IconStyleUrlModifiedCB(c,a){var b=c.getValueDirect().join("");switch(b){case"":break;default:a.htmlIconImg.src=document.location.href+"/../BwContent/"+b;break}}function Label_BalloonTipLabelStyleModifiedCB(b,a){Label_DescriptionModifiedCB(a.description,a)}LineList.prototype=new VertexGeometry();LineList.prototype.constructor=LineList;function LineList(){VertexGeometry.call(this);this.className="LineList";this.attrType=eAttrType.LineList;this.width=1}LineList.prototype.update=function(b,a){if(!this.vertexBuffer){this.vertexBuffer=this.graphMgr.renderContext.createVertexBuffer(3);this.vertexBuffer.setPrimitiveType(RC_LINES)}VertexGeometry.prototype.update.call(this,b,a)};LineList.prototype.apply=function(c,b,a){VertexGeometry.prototype.apply.call(this,c,b,a)};LineList.prototype.draw=function(a){this.vertexBuffer.draw()};LineList.prototype.buildBoundingTree=function(){};PointList.prototype=new VertexGeometry();PointList.prototype.constructor=PointList;function PointList(){VertexGeometry.call(this);this.className="PointList";this.attrType=eAttrType.PointList;this.width=1}PointList.prototype.update=function(b,a){if(!this.vertexBuffer){this.vertexBuffer=this.graphMgr.renderContext.createVertexBuffer(3);this.vertexBuffer.setPrimitiveType(RC_POINTS)}VertexGeometry.prototype.update.call(this,b,a)};PointList.prototype.apply=function(c,b,a){VertexGeometry.prototype.apply.call(this,c,b,a)};PointList.prototype.draw=function(a){this.vertexBuffer.draw()};PointList.prototype.buildBoundingTree=function(){};function range(a,c,b){var e,d=b-c;if(d==0){return{value:c,i:0}}e=a-d*Math.floor((a-c)/d);return{value:e,i:-(Math.floor((e-a)/d+((e>a)?0.5:-0.5)))}}function hermite(f){var g,e;g=f*f;e=f*g;var c=3*g-e-e;var d=1-c;var a=e-g;var b=a-g+f;return{h1:d,h2:c,h3:b,h4:a}}function bezier(g,f,e,d,n){var m,l,k,j,h;j=n*n;h=j*n;k=3*(f-g);l=3*(e-f)-k;m=d-g-k-l;return m*h+l*j+k*n+g}function bez2_time(d,c,b,a,e,g,f){var h,j;j=g+(f-g)*0.5;h=bezier(d,c,b,a,j);if(Math.abs(e-h)>0.0001){if(h>e){f=j}else{g=j}return bez2_time(d,c,b,a,e,g,f)}else{return j}}function bez2(f,d,g){var a,h,b,e=0,c=1;if(f.getShape()==eKeyframeShape_Bezier2D){a=f.getTime()+f.getParams(2)}else{a=f.getTime()+(d.getTime()-f.getTime())/3}b=bez2_time(f.getTime(),a,d.getTime()+d.getParams(0),d.getTime(),g,e,c);if(f.getShape()==eKeyframeShape_Bezier2D){h=f.getValue()+f.getParams(3)}else{h=f.getValue()+f.getParams(1)/3}return bezier(f.getValue(),h,d.getParams(1)+d.getValue(),d.getValue(),b)}function outgoing(l,k,j,e){var h,g,f,m,c;switch(k.getShape()){case eKeyframeShape.TCB:h=(1-k.getParams(0))*(1+k.getParams(1))*(1+k.getParams(2));g=(1-k.getParams(0))*(1-k.getParams(1))*(1-k.getParams(2));f=j.getValue()-k.getValue();if(k!=e){m=(j.getTime()-k.getTime())/(j.getTime()-(l.prev(k)).getTime());c=m*(h*(k.getValue()-(l.prev(k)).getValue())+g*f)}else{c=g*f}break;case eKeyframeShape.Linear:f=j.getValue()-k.getValue();if(k!=e){m=(j.getTime()-k.getTime())/(j.getTime()-(l.prev(k)).getTime());c=m*(k.getValue()-(l.prev(k)).getValue()+f)}else{c=f}break;case eKeyframeShape.Bezier1D:c=k.getParams(1);if(k!=e){c*=(j.getTime()-k.getTime())/(j.getTime()-(l.prev(k)).getTime())}break;case eKeyframeShape.Bezier2D:c=k.getParams(3)*(j.getTime()-k.getTime());if(Math.abs(k.getParams(2))>0.00001){c/=k.getParams(2)}else{c*=100000}break;case eKeyframeShape.Stepped:default:c=0;break}return c}function incoming(l,j,h,k){var g,f,e,m,c;switch(h.getShape()){case eKeyframeShape.Linear:e=h.getValue()-j.getValue();if(h!=k){m=(h.getTime()-j.getTime())/((l.next(h)).getTime()-j.getTime());c=m*((l.next(h)).getValue()-h.getValue()+e)}else{c=e}break;case eKeyframeShape.TCB:g=(1-h.getParams(0))*(1-h.getParams(1))*(1+h.getParams(2));f=(1-h.getParams(0))*(1+h.getParams(1))*(1-h.getParams(2));e=h.getValue()-j.getValue();if(h!=k){m=(h.getTime()-j.getTime())/((l.next(h)).getTime()-j.getTime());c=m*(f*((l.next(h)).getValue()-h.getValue())+g*e)}else{c=g*e}break;case eKeyframeShape.Bezier1D:c=h.getParams(0);if(h!=k){c*=(h.getTime()-j.getTime())/((l.next(h)).getTime()-j.getTime())}break;return c;case eKeyframeShape.Bezier2D:c=h.getParams(1)*(h.getTime()-j.getTime());if(Math.abs(h.getParams(0))>0.00001){c/=h.getParams(0)}else{c*=100000}break;case eKeyframeShape.Stepped:default:c=0;break}return c}function interpolate(b,g,h,m,a,f){if(g.length==0){return 0}if(g.length==1){return h.getValue()}var j=0;var c=0;var e=0;var d=0;var o;if(b<h.getTime()){switch(a){case eEndBehavior.Reset:return 0;case eEndBehavior.Constant:return h.getValue();case eEndBehavior.Repeat:o=range(b,h.getTime(),m.getTime());b=o.value;break;case eEndBehavior.Oscillate:o=range(b,h.getTime(),m.getTime());b=o.value;j=o.i;if(j%2){b=m.getTime()-h.getTime()-b}break;case eEndBehavior.OffsetRepeat:o=range(b,h.getTime(),m.getTime());b=o.value;j=o.i;d=j*(m.getValue()-h.getValue());break;case eEndBehavior.Linear:e=outgoing(g,h,g.next(h),h)/((g.next(h)).getTime()-h.getTime());return e*(b-h.getTime())+h.getValue()}}else{if(b>m.getTime()){switch(f){case eEndBehavior.Reset:return 0;case eEndBehavior.Constant:return m.getValue();case eEndBehavior.Repeat:o=range(b,h.getTime(),m.getTime());b=o.value;break;case eEndBehavior.Oscillate:o=range(b,h.getTime(),m.getTime());b=o.value;j=o.i;if(j%2){b=m.getTime()-h.getTime()-b}break;case eEndBehavior.OffsetRepeat:o=range(b,h.getTime(),m.getTime());b=o.value;j=o.i;d=j*(m.getValue()-h.getValue());break;case eEndBehavior.Linear:c=incoming(g,g.prev(m),m,m)/(m.getTime()-(g.prev(m)).getTime());return c*(b-m.getTime())+m.getValue()}}}var l=h;while(g.next(l)&&b>(g.next(l)).getTime()){l=g.next(l)}var k=g.next(l);if(b==(l).getTime()){return(l).getValue()+d}else{if(b==(k).getTime()){return(k).getValue()+d}}var n=(b-(l).getTime())/((k).getTime()-(l).getTime());switch((k).getShape()){case eKeyframeShape.TCB:case eKeyframeShape.Bezier1D:e=outgoing(g,l,k,h);c=incoming(g,l,k,m);var o=hermite(n);return o.h1*(l).getValue()+o.h2*(k).getValue()+o.h3*e+o.h4*c+d;case eKeyframeShape.Bezier2D:return bez2(l,k,b)+d;case eKeyframeShape.Linear:return(l).getValue()+n*((k).getValue()-(l).getValue())+d;case eKeyframeShape.Stepped:return(l).getValue()+d;default:return 0}}function StateRec(){this.material=null;this.renderStateRec=null;this.cullBackFace=false;this.textures=null;this.projectionTextures=null;this.globalIllumination=new Color()}function GetCurrentState(a){var b=new StateRec();b.material=a.getCurrentMaterial();b.renderStateRec=a.renderState.getState(RENDERSTATE_ALL_BITS);b.cullBackFace=a.renderContext.enabled(eRenderMode.CullBackFace);b.textures=a.textureArrayStack.top();b.projectionTextures=a.projectionTextureArrayStack.top();b.globalIllumination.copy(a.renderContext.getGlobalIllumination());return b}function SetCurrentState(a,b){a.setCurrentMaterial(b.material);a.renderState.setState(RENDERSTATE_ALL_BITS,b.renderStateRec);if(b.cullBackFace){a.renderContext.enable(eRenderMode.CullBackFace)}else{a.renderContext.disable(eRenderMode.CullBackFace)}a.textureArrayStack.load(b.textures);a.projectionTextureArrayStack.load(b.projectionTextures);a.renderContext.setGlobalIllumination(b.globalIllumination)}function DistanceSortRec(c,b,a){this.distance=c||0;this.geometry=b||null;this.dissolve=a||0;this.stateRec=null}DistanceSortAgent.prototype=new Agent();DistanceSortAgent.prototype.constructor=DistanceSortAgent;function DistanceSortAgent(){Agent.call(this);this.className="DistanceSortAgent";this.graphMgr=null;this.sortRecs=[]}DistanceSortAgent.prototype.setGraphMgr=function(a){this.graphMgr=a};DistanceSortAgent.prototype.isEmpty=function(){return this.sortRecs.length==0};DistanceSortAgent.prototype.addGeometry=function(h,c,a,f){var g=new DistanceSortRec();g.geometry=h;g.dissolve=f;g.stateRec=GetCurrentState(this.graphMgr);var e=new Matrix4x4();e.loadMatrix(this.graphMgr.renderContext.modelViewMatrixStack.top());g.distance=FLT_MAX;var d;for(var b=0;b<8;b++){switch(b){case 0:d=new Vector3D(a.x,a.y,a.z);break;case 1:d=new Vector3D(a.x,a.y,c.z);break;case 2:d=new Vector3D(a.x,c.y,a.z);break;case 3:d=new Vector3D(a.x,c.y,c.z);break;case 4:d=new Vector3D(c.x,a.y,a.z);break;case 5:d=new Vector3D(c.x,a.y,c.z);break;case 6:d=new Vector3D(c.x,c.y,a.z);break;case 7:d=new Vector3D(c.x,c.y,c.z);break}d=e.transform(d.x,d.y,d.z,1);g.distance=Math.min(d.z,g.distance)}this.sortRecs.push(g)};DistanceSortAgent.prototype.clear=function(){this.sortRecs.length=0};DistanceSortAgent.prototype.sort=function(){this.sortRecs.sort(DistanceSortAgent_CompareSortRecs)};DistanceSortAgent.prototype.draw=function(){if(this.sortRecs.length==0){return}var a=GetCurrentState(this.graphMgr);for(var b=0;b<this.sortRecs.length;b++){SetCurrentState(this.graphMgr,this.sortRecs[b].stateRec);this.sortRecs[b].geometry.draw(this.sortRecs[b].dissolve);this.graphMgr.renderState.setState(RENDERSTATE_CLIP_PLANE_BIT,a.renderStateRec)}this.graphMgr.renderContext.enable(eRenderMode.DepthBufferWrite);SetCurrentState(this.graphMgr,a)};function DistanceSortAgent_CompareSortRecs(b,a){return a.distance-b.distance}var EARTH_RADIUS_KM_EQ=6378;var EARTH_RADIUS_KM_P=6377;var UTM_ZONE_WIDTH_KM=667.956;var EQ_ARC_WIDTH_KM=40075.16;var EQ_ARC_HEIGHT_KM=40008;var EQ_ARC_ONE_DEG_LAT_KM=EQ_ARC_HEIGHT_KM/360;var EQ_ARC_ONE_DEG_LON_KM=EQ_ARC_WIDTH_KM/360;var EQ_ARC_WIDTH_MI=24902;var EQ_ARC_HEIGHT_MI=24900;var EQ_ARC_ONE_DEG_LAT_MI=EQ_ARC_HEIGHT_MI/360;var EQ_ARC_ONE_DEG_LON_MI=EQ_ARC_WIDTH_MI/360;MapProjectionCalculator.prototype=new Evaluator();MapProjectionCalculator.prototype.constructor=MapProjectionCalculator;function MapProjectionCalculator(){Evaluator.call(this);this.className="MapProjectionCalculator";this.attrType=eAttrType.MapProjectionCalculator;this.unitsMultiplier=1;this.positionCalculators=[];this.geoPositionCalculators=[];this.mapProjection=new StringAttr("equalArc");this.elevationModel=new StringAttr();this.center2D=new Vector2DAttr(0,0);this.units=new StringAttr("kilometers");this.geoPosition=new Vector3DAttr(0,0,0);this.pointWorld=new Vector3DAttr();this.resultPosition=new Vector3DAttr();this.resultGeoPosition=new Vector3DAttr();this.units.addModifiedCB(MapProjectionCalculator_UnitsModifiedCB,this);this.pointWorld.addModifiedCB(MapProjectionCalculator_PointWorldModifiedCB,this);this.registerAttribute(this.mapProjection,"mapProjection");this.registerAttribute(this.elevationModel,"elevationModel");this.registerAttribute(this.center2D,"center2d");this.registerAttribute(this.units,"units");this.registerAttribute(this.geoPosition,"geoPosition");this.registerAttribute(this.geoPosition,"position");this.registerAttribute(this.pointWorld,"pointWorld");this.registerAttribute(this.resultPosition,"resultPosition");this.registerAttribute(this.resultGeoPosition,"resultGeoPosition");this.registerAttribute(this.resultGeoPosition,"resultGeoLocation");this.positionCalculators.equalArc=ComputeEqualArc3DPosition;this.geoPositionCalculators.equalArc=ComputeEqualArcGeoPosition;this.units.setValueDirect("meters")}MapProjectionCalculator.prototype.evaluate=function(){var c=this.geoPosition.getValueDirect();var a=this.computePosition(c.x,c.y,c.z);this.resultPosition.setValueDirect(a.x,a.y,a.z);var b=this.computeGeoPosition(a.x,a.y,a.z);this.resultGeoPosition.setValueDirect(b.x,b.y,b.z)};MapProjectionCalculator.prototype.computePosition=function(g,e,d){var a=undefined;var b=this.mapProjection.getValueDirect().join("");var c=this.positionCalculators[b];if(c){var f=this.center2D.getValueDirect();a=c(g,e,d,f.x,f.y,this.unitsMultiplier)}return a};MapProjectionCalculator.prototype.computeGeoPosition=function(a,g,f){var e=undefined;var b=this.mapProjection.getValueDirect().join("");var c=this.geoPositionCalculators[b];if(c){var d=this.center2D.getValueDirect();e=c(a,g,f,d.x,d.y,this.unitsMultiplier)}return e};function MapProjectionCalculator_UnitsModifiedCB(b,a){switch(b.getValueDirect().join("")){case"kilometers":a.unitsMultiplier=1;break;case"meters":a.unitsMultiplier=1000;break}}function MapProjectionCalculator_PointWorldModifiedCB(b,a){}function ComputeEqualArc3DPosition(a,c,g,d,b,e){if(g>90||g<-90||a>180||a<-180){return undefined}var j=(a-d)*EQ_ARC_ONE_DEG_LON_KM*e;var h=c;var f=(g-b)*EQ_ARC_ONE_DEG_LAT_KM*e;return{x:j,y:h,z:f}}function ComputeEqualArcGeoPosition(j,h,g,d,b,e){var a=(j/e/EQ_ARC_ONE_DEG_LON_KM)+d;var c=h;var f=(g/e/EQ_ARC_ONE_DEG_LAT_KM)+b;return{lon:a,alt:c,lat:f}}NullObject.prototype=new ParentableMotionElement();NullObject.prototype.constructor=NullObject;function NullObject(){ParentableMotionElement.call(this);this.className="NullObject";this.attrType=eAttrType.NullObject}Transform.prototype=new SGNode();Transform.prototype.constructor=Transform;function Transform(){SGNode.call(this);this.className="Transform";this.attrType=eAttrType.Transform;this.matrixTransform=null;this.matrix=new Matrix4x4Attr(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);this.updateMatrix=true;this.matrix.addModifiedCB(Transform_MatrixModifiedCB,this);this.registerAttribute(this.matrix,"matrix")}Transform.prototype.clone=function(a){this.matrix=a.matrix.clone();this.updateMatrix=a.updateMatrix};Transform.prototype.update=function(b,a){if(this.updateMatrix){this.updateMatrix=false;this.matrixTransform=this.matrix.getValueDirect()}SGNode.prototype.update.call(this,b,a)};Transform.prototype.apply=function(c,b,a){if(!this.enabled.getValueDirect()){SGNode.prototype.apply.call(this,c,b,a);return}if(b.worldMatrix){b.worldMatrix=b.worldMatrix.multiply(this.matrixTransform)}switch(c){case"render":this.applyTransform();break;default:break}SGNode.prototype.apply.call(this,c,b,a)};Transform.prototype.applyTransform=function(){this.graphMgr.renderContext.modelViewMatrixStack.leftMultiply(this.matrixTransform);this.graphMgr.renderContext.applyModelViewTransform()};function Transform_MatrixModifiedCB(b,a){a.updateMatrix=true;a.incrementModificationCount()}QuaternionRotate.prototype=new Transform();QuaternionRotate.prototype.constructor=QuaternionRotate;function QuaternionRotate(){Transform.call(this);this.className="QuaternionRotate";this.attrType=eAttrType.QuaternionRotate;this.rotationQuat=new QuaternionAttr(1,0,0,0);this.rotation=new Vector3DAttr(0,0,0);this.updateRotationQuat=true;this.rotationQuat.addModifiedCB(QuaternionRotate_RotationQuatModifiedCB,this);this.registerAttribute(this.rotationQuat,"rotationQuat");this.registerAttribute(this.rotation,"rotation")}QuaternionRotate.prototype.update=function(e,c){if(this.updateRotationQuat){this.updateRotationQuat=false;var d=this.rotationQuat.getValueDirect();var a=d.getMatrix();this.matrix.setValueDirect(a);var b=a.getRotationAngles();this.rotation.setValueDirect(b.x,b.y,b.z)}Transform.prototype.update.call(this,e,c)};QuaternionRotate.prototype.apply=function(c,b,a){if(!this.enabled.getValueDirect()){Transform.prototype.apply.call(this,c,b,a);return}Transform.prototype.apply.call(this,c,b,a)};function QuaternionRotate_RotationQuatModifiedCB(b,a){a.updateRotationQuat=true;a.incrementModificationCount()}Rotate.prototype=new Transform();Rotate.prototype.constructor=Rotate;function Rotate(){Transform.call(this);this.className="Rotate";this.attrType=eAttrType.Rotate;this.rotation=new Vector3DAttr(0,0,0);this.updateRotation=true;this.rotation.addModifiedCB(Rotate_RotationModifiedCB,this);this.registerAttribute(this.rotation,"rotation")}Rotate.prototype.update=function(d,b){if(this.updateRotation){this.updateRotation=false;var c=this.rotation.getValueDirect();var a=new Matrix4x4();a.loadXYZAxisRotation(c.x,c.y,c.z);this.matrix.setValueDirect(a)}Transform.prototype.update.call(this,d,b)};Rotate.prototype.apply=function(c,b,a){if(!this.enabled.getValueDirect()){Transform.prototype.apply.call(this,c,b,a);return}Transform.prototype.apply.call(this,c,b,a)};function Rotate_RotationModifiedCB(b,a){a.updateRotation=true;a.incrementModificationCount()}Scale.prototype=new Transform();Scale.prototype.constructor=Scale;function Scale(){Transform.call(this);this.className="Scale";this.attrType=eAttrType.Scale;this.scale=new Vector3DAttr(1,1,1);this.updateScale=true;this.scale.addModifiedCB(Scale_ScaleModifiedCB,this);this.registerAttribute(this.scale,"scale")}Scale.prototype.update=function(d,b){if(this.updateScale){this.updateScale=false;var c=this.scale.getValueDirect();var a=new Matrix4x4();a.loadScale(c.x,c.y,c.z);this.matrix.setValueDirect(a)}Transform.prototype.update.call(this,d,b)};Scale.prototype.apply=function(c,b,a){if(!this.enabled.getValueDirect()){Transform.prototype.apply.call(this,c,b,a);return}Transform.prototype.apply.call(this,c,b,a)};function Scale_ScaleModifiedCB(b,a){a.updateScale=true;a.incrementModificationCount()}Translate.prototype=new Transform();Translate.prototype.constructor=Translate;function Translate(){Transform.call(this);this.className="Translate";this.attrType=eAttrType.Translate;this.translation=new Vector3DAttr(0,0,0);this.updateTranslation=true;this.translation.addModifiedCB(Translate_TranslationModifiedCB,this);this.registerAttribute(this.translation,"translation")}Translate.prototype.update=function(d,c){if(this.updateTranslation){this.updateTranslation=false;var b=this.translation.getValueDirect();var a=new Matrix4x4();a.loadTranslation(b.x,b.y,b.z);this.matrix.setValueDirect(a)}Transform.prototype.update.call(this,d,c)};Translate.prototype.apply=function(c,b,a){if(!this.enabled.getValueDirect()){Transform.prototype.apply.call(this,c,b,a);return}Transform.prototype.apply.call(this,c,b,a)};function Translate_TranslationModifiedCB(b,a){a.updateTranslation=true;a.incrementModificationCount()}SerializeParams.prototype=new DirectiveParams();SerializeParams.prototype.constructor=SerializeParams();function SerializeParams(){DirectiveParams.call(this);this.serialized=""}SerializeDirective.prototype=new SGDirective();SerializeDirective.prototype.constructor=SerializeDirective;function SerializeDirective(){SGDirective.call(this);this.className="SerializeDirective";this.attrType=eAttrType.SerializeDirective}SerializeDirective.prototype.execute=function(a){if(!a){return}this.serialized="";var b=new SerializeParams();b.serialized=this.serialized;b.userData=this.userData.getValueDirect();a.apply(eAttrType.DirectiveSerialize,b,true);return};SerializeDirective.prototype.execute=function(b){if(!b){return}this.serialized="";var a=new SerializeParams();a.serialized=this.serialized;a.userData=this.userData.getValueDirect();if(b.getNodeCount()>0){b[0].apply(eAttrType.DirectiveSerialize,a,true)}return};var eEventType={Unknown:-1,Mouse_First:100,MouseMove:101,MouseDown:102,MouseLeftDown:103,MouseMiddleDown:104,MouseRightDown:105,MouseAllDown:106,MouseBothDown:107,MouseWheelDown:108,MouseUp:109,MouseLeftUp:110,MouseRightUp:111,MouseMiddleUp:112,MouseWheelUp:113,MouseLeftClick:114,MouseMiddleClick:115,MouseRightClick:116,MouseLeftDblClick:117,MouseMiddleDblClick:118,MouseRightDblClick:119,MouseDrag:120,MouseWheelForward:121,MouseWheelBackward:122,MouseHover:123,MouseLeave:124,MouseOver:125,MouseOut:126,Mouse_Last:199,Key_First:200,Key_Down:201,Key_Up:202,Key_Last:299,Element_First:700,ElementSelected:701,ElementUnselected:702,ElementFocus:703,ElementBlur:704,Element_Last:799,UserDefined:2000};var eEventNameMap={MButton1:eEventType.MouseLeftDown,"MButton1.Down":eEventType.MouseLeftDown,MButton2:eEventType.MouseMiddleDown,"MButton2.Down":eEventType.MouseMiddleDown,MButton3:eEventType.MouseRightDown,"MButton3.Down":eEventType.MouseRightDown,"MButton1+MButton2.Down":eEventType.MouseBothDown,"MButton2+MButton3.Down":eEventType.MouseBothDown,"MButton1+MButton3.Down":eEventType.MouseBothDown,"MButton1.Click":eEventType.MouseLeftClick,"MButton1.DoubleClick":eEventType.MouseLeftDblClick,"MButton1.Up":eEventType.MouseLeftUp,"MButton2.Click":eEventType.MouseMiddleClick,"MButton2.DoubleClick":eEventType.MouseMiddleDblClick,"MButton2.Up":eEventType.MouseMiddleUp,"MButton3.Click":eEventType.MouseRightClick,"MButton3.DoubleClick":eEventType.MouseRightDblClick,"MButton3.Up":eEventType.MouseRightUp,MWheel:eEventType.MouseWheelDown,"MWheel.Down":eEventType.MouseWheelDown,"MWheel.Click":eEventType.MouseWheelUp,"MWheel.Up":eEventType.MouseWheelUp,"Mouse.Move":eEventType.MouseMove,"Mouse.Hover":eEventType.MouseHover,"Mouse.Leave":eEventType.MouseLeave,"Mouse.Over":eEventType.MouseOver,"Mouse.Out":eEventType.MouseOut,"Element.Selected":eEventType.ElementSelected,"Element.Unselected":eEventType.ElementUnselected,"Element.Focus":eEventType.ElementFocus,"Element.Blur":eEventType.ElementBlur};function getEventTypeByName(a){var b=eEventNameMap[a];if(b==undefined){b=eEventType.Unknown}return b}Event.prototype=new AttributeContainer();Event.prototype.constructor=Event;function Event(b,c,a){AttributeContainer.call(this);this.className="Event";this.type=b||eEventType.Unknown;this.time=c||0;this.userData=a||null}Event.prototype.synchronize=function(a){this.type=a.type;this.time=a.time;this.userData=a.userData};InputEvent.prototype=new Event();InputEvent.prototype.constructor=InputEvent;function InputEvent(d,f,b,c,e,a){Event.call(this,d,f,a);this.className="InputEvent";this.inputId=b||0;this.modifiers=c||0;this.state=e||0}InputEvent.prototype.synchronize=function(a){this.inputId=a.inputId;this.modifiers=a.modifiers;this.state=a.state;Event.prototype.synchronize.call(this,a)};var MOUSEEVENT_LEFT_BUTTON=1;var MOUSEEVENT_MIDDLE_BUTTON=2;var MOUSEEVENT_RIGHT_BUTTON=4;MouseEvent.prototype=new InputEvent();MouseEvent.prototype.constructor=MouseEvent;function MouseEvent(e,g,d,c,f,b,h,a){InputEvent.call(this,e,g,d,c,f,a);this.className="MouseEvent";this.x=b||0;this.y=h||0}function MouseEventState(){this.leftButtonDown=false;this.middleButtonDown=false;this.rightButtonDown=false}EventAdapter.prototype=new AttributeContainer();EventAdapter.prototype.constructor=EventAdapter;function EventAdapter(){AttributeContainer.call(this);this.className="EventAdapter";this.mouseState=new MouseEventState();this.name=new StringAttr("EventAdapter");this.registerAttribute(this.name,"name")}EventAdapter.prototype.createKeyboardEvent=function(b){var a=null;return a};EventAdapter.prototype.createMouseEvent=function(c){var e=new Date();var g=eEventType.Unknown;var d=e.getTime();var f=0;var k=0;var b=0;var j=c.canvasX;var h=c.canvasY;switch(c.type){case"click":switch(c.button){case 0:g=eEventType.MouseLeftClick;break;case 1:g=eEventType.MouseMiddleDown;break;case 2:g=eEventType.MouseRightClick;break}break;case"dblclick":switch(c.button){case 0:g=eEventType.MouseLeftDblClick;break;case 1:g=eEventType.MouseMiddleDblClick;break;case 2:g=eEventType.MouseRightDblClick;break}break;case"mousedown":switch(c.button){case 0:if(this.mouseState.rightButtonDown){g=eEventType.MouseBothDown}else{g=eEventType.MouseLeftDown}this.mouseState.leftButtonDown=true;break;case 1:g=eEventType.MouseMiddleDown;this.mouseState.middleButtonDown=true;break;case 2:if(this.mouseState.leftButtonDown){g=eEventType.MouseBothDown}else{g=eEventType.MouseRightDown}this.mouseState.rightButtonDown=true;break}break;case"mouseup":switch(c.button){case 0:g=eEventType.MouseLeftUp;this.mouseState.leftButtonDown=false;break;case 1:g=eEventType.MouseMiddleUp;this.mouseState.middleButtonDown=false;break;case 2:g=eEventType.MouseRightUp;this.mouseState.rightButtonDown=false;break}break;case"mousemove":g=eEventType.MouseMove;break;default:g=eEventType.UserDefined;break}if(this.mouseState.leftButtonDown){f|=MOUSEEVENT_LEFT_BUTTON}if(this.mouseState.middleButtonDown){f|=MOUSEEVENT_MIDDLE_BUTTON}if(this.mouseState.rightButtonDown){f|=MOUSEEVENT_RIGHT_BUTTON}var a=new MouseEvent(g,d,f,k,b,j,h);return a};EventListener.prototype=new Agent();EventListener.prototype.constructor=EventListener;function EventListener(){Agent.call(this);this.className="EventListener";this.events=[];this.listen=new BooleanAttr(true);this.trigger=new StringAttr("");this.numResponses=new NumberAttr(1);this.event=new StringAttr("");this.event.addModifiedCB(EventListener_EventModifiedCB,this);this.registerAttribute(this.listen,"listen");this.registerAttribute(this.trigger,"trigger");this.registerAttribute(this.numResponses,"numResponses");this.registerAttribute(this.event,"event")}EventListener.prototype.addEventType=function(a){this.events.push(a)};EventListener.prototype.getEventTypes=function(){return this.events};EventListener.prototype.eventPerformed=function(b){var a=this.numResponses.getValueDirect();if(a>0){this.numResponses.setValueDirect(a-1)}};EventListener.prototype.getTrigger=function(){this.trigger};EventListener.prototype.setTrigger=function(a){if(a){this.trigger=a}};function EventListener_EventModifiedCB(c,a){var b=getEventTypeByName(c.getValueDirect().join(""));a.addEventType(b)}EventMgr.prototype=new AttributeContainer();EventMgr.prototype.constructor=EventMgr;function EventMgr(){AttributeContainer.call(this);this.className="EventMgr";this.listeners=[];this.name=new StringAttr("EventMgr");this.registerAttribute(this.name,"name")}EventMgr.prototype.addListener=function(a,b){if(this.listeners[a]==undefined){this.listeners[a]=[]}if(this.listeners[a].indexOf(b)==-1){this.listeners[a].push(b)}};EventMgr.prototype.removeListener=function(a,b){if(this.listeners[a]){this.listeners[a].splice(this.listeners[a].indexOf(b),1)}};EventMgr.prototype.processEvent=function(d){var c=d.type;var b=[];if(this.listeners[c]){for(var a=0;a<this.listeners[c].length;a++){this.listeners[c][a].eventPerformed(d);if(this.listeners[c][a].getAttribute("numResponses").getValueDirect()==0){b.push(this.listeners[c][a])}}}for(var a=0;a<b.length;a++){this.removeListener(c,b[a]);this.registry.unregister(b[a])}};EventMgr.prototype.clearEvents=function(){this.listeners.length=0};DeviceHandler.prototype=new EventListener();DeviceHandler.prototype.constructor=DeviceHandler;function DeviceHandler(){EventListener.call(this);this.className="DeviceHandler";this.inputMessage=new NumberAttr(0);this.inputId=new NumberAttr(0);this.inputModifier=new NumberAttr(0);this.inputState=new NumberAttr(0);this.prevInputState=new NumberAttr(0);this.output=new StringAttr("");this.registerAttribute(this.inputMessage,"inputMessage");this.registerAttribute(this.inputId,"inputId");this.registerAttribute(this.inputModifier,"inputModifier");this.registerAttribute(this.inputState,"inputState");this.registerAttribute(this.prevInputState,"prevInputState");this.registerAttribute(this.output,"output");this.numResponses.setValueDirect(-1)}DeviceHandler.prototype.eventPerformed=function(a){this.inputMessage.setValueDirect(a.type);this.inputId.setValueDirect(a.inputId);this.inputState.setValueDirect(a.state);this.inputModifier.setValueDirect(a.modifiers)};MouseHandler.prototype=new DeviceHandler();MouseHandler.prototype.constructor=MouseHandler;function MouseHandler(){DeviceHandler.call(this);this.className="MouseHandler";this.name.setValueDirect("MouseHandler");this.lastX=0;this.lastY=0;this.x=new NumberAttr(0);this.y=new NumberAttr(0);this.deltaX=new NumberAttr(0);this.deltaY=new NumberAttr(0);this.delta=new Vector2DAttr(0,0);this.registerAttribute(this.x,"deviceX");this.registerAttribute(this.y,"deviceY");this.registerAttribute(this.deltaX,"deltaX");this.registerAttribute(this.deltaY,"deltaY");this.registerAttribute(this.delta,"delta");this.addEventType(eEventType.MouseMove);this.addEventType(eEventType.MouseLeftDown)}MouseHandler.prototype.eventPerformed=function(b){var a=b.x;var c=b.y;switch(b.type){case eEventType.MouseMove:break;default:this.lastX=a;this.lastY=c;break}this.x.setValueDirect(a);this.y.setValueDirect(c);this.deltaX.setValueDirect(this.lastX-a);this.deltaY.setValueDirect(this.lastY-c);this.delta.setValueDirect(this.lastX-a,this.lastY-c);this.lastX=a;this.lastY=c;DeviceHandler.prototype.eventPerformed.call(this,b);this.deltaX.setValueDirect(0);this.deltaY.setValueDirect(0);this.delta.setValueDirect(0,0)};Command.prototype=new EventListener();Command.prototype.constructor=Command;function Command(){EventListener.call(this);this.className="Command";this.target=new StringAttr("");this.registerAttribute(this.target,"target")}Command.prototype.eventPerformed=function(a){if(this.listen.getValueDirect()==true){this.execute()}EventListener.prototype.eventPerformed.call(this,a)};SetCommand.prototype=new Command();SetCommand.prototype.constructor=SetCommand;function SetCommand(){Command.call(this);this.className="SetCommand";this.attributeValuePairs=[];this.target.addModifiedCB(SetCommand_TargetModifiedCB,this)}SetCommand.prototype.execute=function(){this.applyAttributeValues()};SetCommand.prototype.applyAttributeValues=function(){for(var a=0;a<this.attributeValuePairs.length;a++){setAttributeValue(this.attributeValuePairs[a].first,this.attributeValuePairs[a].second)}};SetCommand.prototype.registerTargetAttributes=function(h,e){var a;var d;var g=h.getAttributeCount();for(var c=0;c<g;c++){var f=h.getAttributeAt(c);var b=h.getAttributeNameAt(c);if((d=this.getAttribute(b))!=null){sName=e+"_";sName+=b}else{sName=b}this.registerAttribute(f,sName)}};function SetCommand_TargetModifiedCB(d,b){var f=d.getValueDirect().join("");var a=f.split(",");b.targets.length=0;for(var c=0;c<a.length;c++){var e=b.registry.find(a[c]);if(e){b.registerTargetAttributes(e,a[c])}}setAttributeBin(b.attributeValuePairs)}function ConnectionDesc(){this.sourceContainer=null;this.targetContainer=null;this.sourceAttribute=null;this.targetAttribute=null;this.sourceIndex=-1;this.targetIndex=-1}var gConnectionHelpers=[];function registerConnectionHelper(c,b,a){gConnectionHelpers[c]=new Pair(b,a)}ConnectAttributesCommand.prototype=new Command();ConnectAttributesCommand.prototype.constructor=ConnectAttributesCommand;function ConnectAttributesCommand(){Command.call(this);this.className="ConnectAttributesCommand";this.connections=new Stack(new ConnectionDesc());this.connectionHelper=new Pair(null,null);this.sourceContainer=new StringAttr("");this.targetContainer=new StringAttr("");this.sourceAttribute=new StringAttr("");this.targetAttribute=new StringAttr("");this.source=new StringAttr("");this.negate=new BooleanAttr(false);this.persist=new BooleanAttr(true);this.connectionType=new StringAttr("");this.source.addTarget(this.sourceAttribute);this.target.addTarget(this.targetAttribute);this.sourceContainer.addModifiedCB(ConnectAttributesCommand_SourceContainerModifiedCB,this);this.targetContainer.addModifiedCB(ConnectAttributesCommand_TargetContainerModifiedCB,this);this.sourceAttribute.addModifiedCB(ConnectAttributesCommand_SourceAttributeModifiedCB,this);this.targetAttribute.addModifiedCB(ConnectAttributesCommand_TargetAttributeModifiedCB,this);this.connectionType.addModifiedCB(ConnectAttributesCommand_ConnectionTypeModifiedCB,this);this.registerAttribute(this.sourceContainer,"sourceContainer");this.registerAttribute(this.sourceContainer,"sourceEvaluator");this.registerAttribute(this.targetContainer,"targetContainer");this.registerAttribute(this.sourceAttribute,"sourceAttribute");this.registerAttribute(this.sourceAttribute,"sourceOutput");this.registerAttribute(this.targetAttribute,"targetAttribute");this.registerAttribute(this.source,"source");this.registerAttribute(this.negate,"negate");this.registerAttribute(this.persist,"persist");this.registerAttribute(this.connectionType,"connectionType")}ConnectAttributesCommand.prototype.eventPerformed=function(a){Command.prototype.eventPerformed.call(this,a)};ConnectAttributesCommand.prototype.execute=function(){var c=this.connections.top();var b=this.persist.getValueDirect();var a=null;if(c.sourceContainer&&c.sourceContainer.attrType>=eAttrType.Evaluator&&c.sourceContainer.attrType<=eAttrType.Evaluator_End){a=c.sourceContainer}if(this.negate.getValueDirect()==false){if(this.connectionHelper.first){this.connectionHelper.first(c.sourceContainer,c.targetContainer);if(!b&&this.connectionHelper.second){if(a){a.evalute()}this.connectionHelper.second(c.sourceContainer,c.targetContainer)}}else{this.addOrRemoveTargets(true);if(!b){if(a){a.evalute()}this.addOrRemoveTargets(false)}}}else{if(this.connectionHelper.second){var c=this.connections.top();this.connectionHelper.second(c.sourceContainer,c.targetContainer);if(a){a.evalute()}}else{this.addOrRemoveTargets(false);if(a){a.evalute()}}}};ConnectAttributesCommand.prototype.addOrRemoveTargets=function(b){for(var a=0;a<this.connections.length();a++){var c=this.connections.getAt(a);if(c.sourceAttribute&&c.targetAttribute){c.sourceAttribute.removeElementTarget(c.targetAttribute,c.sourceIndex,c.targetIndex);if(b){c.sourceAttribute.addElementTarget(c.targetAttribute,c.sourceIndex,c.targetIndex)}}}};function ConnectAttributesCommand_SourceContainerModifiedCB(c,a){var b=a.connections.top();b.sourceContainer=a.registry.find(c.getValueDirect().join(""))}function ConnectAttributesCommand_TargetContainerModifiedCB(c,a){var b=a.connections.top();b.targetContainer=a.registry.find(c.getValueDirect().join(""))}function ConnectAttributesCommand_SourceAttributeModifiedCB(e,a){var f=null;var c=-1;var b=a.connections.top();if(b.sourceContainer){var d=e.getValueDirect().join("").split(":");f=b.sourceContainer.getAttribute(d[0]);if(d.length>1){c=d[1]}}else{f=a.registry.find(e.getValueDirect().join(""));if(f){b.sourceContainer=f.getContainer();if(!b.sourceContainer){b.sourceContainer=f}}}b.sourceAttribute=f;b.sourceIndex=c;if(b.sourceAttribute&&b.targetAttribute){a.connections.push(new ConnectionDesc());a.connections.top().sourceContainer=b.sourceContainer;a.connections.top().targetContainer=b.targetContainer}}function ConnectAttributesCommand_TargetAttributeModifiedCB(d,a){var f=null;var c=-1;var b=a.connections.top();if(b.targetContainer){var e=d.getValueDirect().join("").split(":");f=b.targetContainer.getAttribute(e[0]);if(e.length>1){c=e[1]}}else{f=a.registry.find(d.getValueDirect().join(""));if(f){b.targetContainer=f.getContainer();if(!b.targetContainer){b.targetContainer=f}}}b.targetAttribute=f;b.targetIndex=c;if(b.sourceAttribute&&b.targetAttribute){a.connections.push(new ConnectionDesc());a.connections.top().sourceContainer=b.sourceContainer;a.connections.top().targetContainer=b.targetContainer}}function ConnectAttributesCommand_ConnectionTypeModifiedCB(c,a){var b=gConnectionHelpers[c.getValueDirect().join("")];if(b){a.connectionHelper.first=b.first;a.connectionHelper.second=b.second}}AutoInterpolateCommand.prototype=new Command();AutoInterpolateCommand.prototype.constructor=AutoInterpolateCommand;function AutoInterpolateCommand(){Command.call(this);this.className="AutoInterpolateCommand";this.attributeValuePairs=[];this.attributeReferencePairs=[];this.kfi=null;this.numValueChannels=0;this.numReferenceChannels=0;this.numChannels=0;this.shape=new NumberAttr(eKeyframeShape.Linear);this.duration=new NumberAttr(1);this.preBehavior=new NumberAttr(eEndBehavior.Constant);this.postBehavior=new NumberAttr(eEndBehavior.Constant);this.renderAndRelease=new BooleanAttr(true);this.target.addModifiedCB(AutoInterpolateCommand_TargetModifiedCB,this);this.registerAttribute(this.shape,"shape");this.registerAttribute(this.duration,"duration");this.registerAttribute(this.preBehavior,"preBehavior");this.registerAttribute(this.postBehavior,"postBehavior");this.registerAttribute(this.renderAndRelease,"renderAndRelease")}AutoInterpolateCommand.prototype.execute=function(){this.buildMotion();if(this.kfi){this.kfi.getAttribute("time").setValueDirect(0);this.kfi.getAttribute("enabled").setValueDirect(true)}};AutoInterpolateCommand.prototype.buildMotion=function(){var a=this.registry.find("AttributeFactory");this.kfi=a.create("KeyframeInterpolator");if(!this.kfi){return}this.kfi.getAttribute("enabled").setValueDirect(false);this.kfi.getAttribute("renderAndRelease").copyValue(this.renderAndRelease);for(var c=0;c<this.attributeValuePairs.length;c++){this.numValueChannels+=this.attributeValuePairs[c].first.getLength()}for(var c=0;c<this.attributeReferencePairs.length;c++){this.numReferenceChannels+=this.attributeReferencePairs[c].first.getLength()}this.numChannels=this.numValueChannels+this.numReferenceChannels;this.kfi.setNumChannels(this.numChannels);var d=this.preBehavior.getValueDirect();var b=this.postBehavior.getValueDirect();for(var c=0;c<this.numChannels;c++){this.kfi.getAttribute("preBehaviors").getAt(c).setValueDirect(d);this.kfi.getAttribute("postBehaviors").getAt(c).setValueDirect(b)}this.applyAttributeValues();this.applyAttributeRefs()};AutoInterpolateCommand.prototype.applyAttributeValues=function(){var g,f,d;for(g=0,d=0;d<this.attributeValuePairs.length;d++){var m=this.attributeValuePairs[d].first;var n=this.attributeValuePairs[d].second;for(f=0;f<m.getLength();f++){var h=this.kfi.getAttribute("channels").getAt(g+f);var c=new KeyframeAttr();var e=new KeyframeAttr();c.getAttribute("time").setValueDirect(0);e.getAttribute("time").setValueDirect(this.duration.getValueDirect());c.getAttribute("shape").setValueDirect(this.shape.getValueDirect());e.getAttribute("shape").setValueDirect(this.shape.getValueDirect());var b=parseFloat(m.getElement(f));var l=parseFloat(m.getLength()>1?n[f]:n);if(this.isAttributeRotational(m)){var a=this.shortestPath(b,l);b=a.start;l=a.end}c.getAttribute("value").setValueDirect(b);e.getAttribute("value").setValueDirect(l);h.push_back(c);h.push_back(e);this.kfi.getAttribute("resultValues").getAt(g+f).addElementTarget(m,0,f)}g+=f}};AutoInterpolateCommand.prototype.applyAttributeRefs=function(){var h,g,e;for(h=0,e=0;e<this.attributeReferencePairs.length;e++){var d=this.attributeReferencePairs[e].first;var n=this.attributeReferencePairs[e].second;for(g=0;g<n.getLength();g++){var l=this.kfi.getAttribute("channels").getAt(h+g);var c=new KeyframeAttr();var f=new KeyframeAttr();c.getAttribute("time").setValueDirect(0);f.getAttribute("time").setValueDirect(this.duration.getValueDirect());c.getAttribute("shape").setValueDirect(this.shape.getValueDirect());f.getAttribute("shape").setValueDirect(this.shape.getValueDirect());var b=parseFloat(n.getElement(g));var m=parseFloat(d.getElement(g));if(this.isAttributeRotational(n)){var a=this.shortestPath(b,m);b=a.start;m=a.end}c.getAttribute("value").setValueDirect(b);f.getAttribute("value").setValueDirect(m);l.push_back(c);l.push_back(f);this.kfi.getAttribute("resultValues").getAt(h+g).addElementTarget(n,0,g)}h+=g}};AutoInterpolateCommand.prototype.registerTargetAttributes=function(h,e){var a;var d;var g=h.getAttributeCount();for(var c=0;c<g;c++){var f=h.getAttributeAt(c);var b=h.getAttributeNameAt(c);if((d=this.getAttribute(b))!=null){sName=e+"_";sName+=b}else{sName=b}this.registerAttribute(f,sName)}};AutoInterpolateCommand.prototype.isAttributeRotational=function(a){var b=a.getContainer();if(b){var c=b.getAttributeName(a);if(c){if(c=="rotation"||c=="angle"){return true}}}return false};AutoInterpolateCommand.prototype.shortestPath=function(f,c){var b=degreeNormalize(f);var a=degreeNormalize(c);var e=a-b;if(e<=180&&e>=-180){return{start:f,end:c}}var d=0;if(e>180){d=360-e}else{d=360+e}f=b;if(a>b){c=b-d}else{c=b+d}return{start:f,end:c}};function AutoInterpolateCommand_TargetModifiedCB(d,b){var f=d.getValueDirect().join("");var a=f.split(",");b.targets.length=0;for(var c=0;c<a.length;c++){var e=b.registry.find(a[c]);if(e){b.registerTargetAttributes(e,a[c])}}setAttributeBin(b.attributeValuePairs);setAttributePairs(b.attributeReferencePairs)}MotionInterpolateCommand.prototype=new AutoInterpolateCommand();MotionInterpolateCommand.prototype.constructor=MotionInterpolateCommand;function MotionInterpolateCommand(){AutoInterpolateCommand.call(this);this.className="MotionInterpolateCommand";this.startPosition=new Vector3DAttr();this.endPosition=new Vector3DAttr();this.resultPosition=new Vector3DAttr();this.positionControl=new Vector3DAttr();this.easeIn=new BooleanAttr(true);this.easeOut=new BooleanAttr(true);this.midPosition=new Vector3DAttr();this.registerAttribute(this.startPosition,"startPosition");this.registerAttribute(this.endPosition,"endPosition");this.registerAttribute(this.resultPosition,"resultPosition");this.registerAttribute(this.positionControl,"positionControl");this.registerAttribute(this.easeIn,"easeIn");this.registerAttribute(this.easeOut,"easeOut")}MotionInterpolateCommand.prototype.execute=function(){AutoInterpolateCommand.prototype.execute.call(this)};MotionInterpolateCommand.prototype.buildMotion=function(){var a=this.registry.find("AttributeFactory");this.kfi=a.create("KeyframeInterpolator");if(!this.kfi){return}this.kfi.getAttribute("enabled").setValueDirect(false);this.kfi.getAttribute("renderAndRelease").copyValue(this.renderAndRelease);this.numChannels=3;this.kfi.setNumChannels(this.numChannels);var d=this.preBehavior.getValueDirect();var c=this.postBehavior.getValueDirect();for(var b=0;b<this.numChannels;b++){this.kfi.getAttribute("preBehaviors").getAt(b).setValueDirect(d);this.kfi.getAttribute("postBehaviors").getAt(b).setValueDirect(c)}this.setKeyframes()};MotionInterpolateCommand.prototype.setKeyframes=function(){var g=this.startPosition.getValueDirect();var c=this.endPosition.getValueDirect();var n=distanceBetween(g,c);var o=new Vector3D();o.copy(this.positionControl.getValueDirect());o.normalize();var a=new Vector3D(((g.x+c.x)/2)+(o.x*(n/2)),((g.y+c.y)/2)+(o.y*(n/2)),((g.z+c.z)/2)+(o.z*(n/2)));this.midPosition.setValueDirect(a.x,a.y,a.z);var f=this.easeIn.getValueDirect();var l=this.easeOut.getValueDirect();var k=this.shape.getValueDirect();var e=this.duration.getValueDirect();for(var j=0;j<this.numChannels;j++){var h=this.kfi.getAttribute("channels").getAt(j);var b=new KeyframeAttr();var m=new KeyframeAttr();var d=new KeyframeAttr();b.getAttribute("time").setValueDirect(0);m.getAttribute("time").setValueDirect(e*0.5);d.getAttribute("time").setValueDirect(e);b.getAttribute("shape").setValueDirect(k);m.getAttribute("shape").setValueDirect(k);d.getAttribute("shape").setValueDirect(k);b.getAttribute("value").setValueDirect(this.startPosition.getElement(j));m.getAttribute("value").setValueDirect(this.midPosition.getElement(j));d.getAttribute("value").setValueDirect(this.endPosition.getElement(j));h.push_back(b);h.push_back(m);h.push_back(d);this.kfi.getAttribute("resultValues").getAt(j).addElementTarget(this.resultPosition,0,j)}};function MotionInterpolateCommand_ResultPositionModifiedCB(b,a){var c=b.getValueDirect();OutputDebugMsg("x: "+c.x+" y: "+c.y+" z: "+c.z+"\n")}LocateCommand.prototype=new Command();LocateCommand.prototype.constructor=LocateCommand;function LocateCommand(){Command.call(this);this.className="LocateCommand";this.targetNode=null;this.directive=new BBoxDirective();this.locator=new BBoxLocator();this.inspector=null;this.duration=new NumberAttr(1);this.transition=new BooleanAttr(true);this.updateClipPlanes=new BooleanAttr(false);this.shape=new NumberAttr(eKeyframeShape.TCB);this.easeIn=new BooleanAttr(true);this.easeOut=new BooleanAttr(true);this.resultPosition=new Vector3DAttr();this.resultFarDistance=new NumberAttr();this.resultWidth=new NumberAttr();this.target.addModifiedCB(LocateCommand_TargetModifiedCB,this);this.registerAttribute(this.duration,"duration");this.registerAttribute(this.transition,"transition");this.registerAttribute(this.updateClipPlanes,"updateClipPlanes");this.registerAttribute(this.shape,"shape");this.registerAttribute(this.easeIn,"easeIn");this.registerAttribute(this.easeOut,"easeOut");this.registerAttribute(this.resultPosition,"resultPosition");this.registerAttribute(this.resultFarDistance,"resultFarDistance");this.registerAttribute(this.resultWidth,"resultWidth");this.registerAttribute(this.locator.getAttribute("closeness"),"closeness");this.registerAttribute(this.locator.getAttribute("resultPivotDistance"),"resultPivotDistance")}LocateCommand.prototype.execute=function(){if(this.targetNode){this.locate()}};LocateCommand.prototype.locate=function(){var q=this.registry.find("Selector");var r=this.registry.find("ViewportMgr");var a=q.getAttribute("clickPoint").getValueDirect();var t=r.getViewportAtScreenXY(a.x,a.y);var s=t.camera;var w=t.viewport;this.directive.execute(this.targetNode);var d=this.directive.getBounds();this.locator.getAttribute("bbox").setValueDirect(d.min,d.max);var h=t.camera.getTransform();h.invert();this.directive.getAttribute("viewTransform").setValueDirect(h);this.directive.getAttribute("viewSpace").setValueDirect(true);this.directive.execute(this.targetNode);d=this.directive.getBounds();this.locator.getAttribute("bboxView").setValueDirect(d.min,d.max);this.locator.getAttribute("viewport").setValueDirect(w.x,w.y,w.width,w.height);var c=this.locator.getAttribute("nearDistance");var l=this.locator.getAttribute("viewVolume");var m=this.locator.getAttribute("viewPosition");var f=this.locator.getAttribute("viewTransform");var k=this.locator.getAttribute("resultPosition");var n=this.locator.getAttribute("resultWidth");var x=this.locator.getAttribute("resultFarDistance");var g=this.locator.getAttribute("resultPivotDistance");var p=null;var o=this.updateClipPlanes.getValueDirect();var u=this.transition.getValueDirect();if(this.inspector){p=this.inspector.getAttribute("pivotDistance")}if(g&&p){g.addTarget(p)}cameraNear=s.getAttribute("nearDistance");cameraFar=s.getAttribute("farDistance");cameraWidth=s.getAttribute("width");cameraVolume=s.getAttribute("viewVolume");cameraPosition=s.getAttribute("sectorPosition");cameraWorldPosition=s.getAttribute("sectorWorldPosition");cameraWorldTransform=s.getAttribute("sectorWorldTransform");cameraNear.addTarget(c);cameraVolume.addTarget(l);cameraWorldPosition.addTarget(m);cameraWorldTransform.addTarget(f);if(u==false){k.addTarget(cameraPosition);n.addTarget(cameraWidth);if(o){x.addTarget(cameraFar)}this.locator.evaluate();k.removeTarget(cameraPosition);n.removeTarget(cameraWidth);x.removeTarget(cameraFar)}else{k.addTarget(this.resultPosition);n.addTarget(this.resultWidth);if(o){x.addTarget(this.resultFarDistance)}this.locator.evaluate();k.removeTarget(this.resultPosition);n.removeTarget(this.resultWidth);x.removeTarget(this.resultFarDistance);switch(this.shape.getValueDirect()){case eKeyframeShape.Stepped:case eKeyframeShape.TCB:case eKeyframeShape.Bezier1D:case eKeyframeShape.Bezier2D:var b=this.registry.find("AttributeFactory");var j=b.create("MotionInterpolate");j.getAttribute("shape").copyValue(this.shape);j.getAttribute("easeIn").copyValue(this.easeIn);j.getAttribute("easeOut").copyValue(this.easeOut);j.getAttribute("startPosition").copyValue(cameraPosition);j.getAttribute("endPosition").copyValue(this.resultPosition);j.getAttribute("resultPosition").addTarget(cameraPosition,eAttrSetOp.Replace,null,false);var e=s.getDirectionVectors();j.getAttribute("positionControl").setValueDirect(-e.forward.x,-e.forward.y,-e.forward.z);break;case eKeyframeShape.Linear:default:var b=this.registry.find("AttributeFactory");var j=b.create("AutoInterpolate");j.attributeReferencePairs.push(new Pair(this.resultPosition,cameraPosition));break}if(o){if(cameraWidth){j.attributeReferencePairs.push(new Pair(this.resultWidth,cameraWidth))}if(cameraFar){j.attributeReferencePairs.push(new Pair(this.resultFarDistance,cameraFar))}}j.target=s;j.getAttribute("duration").copyValue(this.duration);j.execute();this.registry.unregister(j)}if(g&&p){g.removeTarget(p)}};function LocateCommand_TargetModifiedCB(b,a){var d=b.getValueDirect().join("");var c=a.registry.find(d);if(c){a.targetNode=c;a.inspector=a.registry.find("SceneInspector")}else{console.debug("TODO: "+arguments.callee.name)}}PlayCommand.prototype=new Command();PlayCommand.prototype.constructor=PlayCommand;function PlayCommand(){Command.call(this);this.className="PlayCommand";this.evaluators=[];this.negate=new BooleanAttr(false);this.registerAttribute(this.negate,"negate");this.target.addModifiedCB(PlayCommand_TargetModifiedCB,this)}PlayCommand.prototype.execute=function(){var b=this.registry.find("RenderAgent");if(b){if(this.evaluators.length<1){if(this.negate.getValueDirect()==false){b.setEvaluatorsPlayState(ePlayState.Play)}else{b.setEvaluatorsPlayState(ePlayState.Pause)}}else{for(var a=0;a<this.evaluators.length;a++){if(this.negate.getValueDirect()==false){b.setEvaluatorPlayState(evaluators[a],ePlayState.Play)}else{b.setEvaluatorPlayState(evaluators[a],ePlayState.Pause)}}}}};function PlayCommand_TargetModifiedCB(d,b){var e=d.getValueDirect().join("");var a=e.split(",");b.targets.length=0;for(var c=0;c<a.length;c++){var f=b.registry.find(a[c]);if(f){b.evaluators[c]=f}}}RemoveCommand.prototype=new Command();RemoveCommand.prototype.constructor=RemoveCommand;function RemoveCommand(){Command.call(this);this.className="RemoveCommand";this.targetAttribute=null;this.target.addModifiedCB(RemoveCommand_TargetModifiedCB,this)}RemoveCommand.prototype.execute=function(){if(this.targetAttribute){if(this.targetAttribute.isNode()){var a=0;var b=null;while((b=this.targetAttribute.getParent(a++))){b.removeChild(this.targetAttribute)}this.removeChildren(this.targetAttribute)}this.registry.unregister(this.targetAttribute);this.targetAttribute.destroy()}};RemoveCommand.prototype.removeChildren=function(a){var b=null;while((b=a.getChild(0))){this.removeChildren(b);this.registry.unregister(b);a.removeChild(b)}};function RemoveCommand_TargetModifiedCB(b,a){var c=b.getValueDirect().join("");a.targetAttribute=a.registry.find(c)}StopCommand.prototype=new Command();StopCommand.prototype.constructor=StopCommand;function StopCommand(){Command.call(this);this.className="StopCommand";this.evaluators=[];this.target.addModifiedCB(StopCommand_TargetModifiedCB,this)}StopCommand.prototype.execute=function(){var b=this.registry.find("RenderAgent");if(b){if(this.evaluators.length<1){b.setEvaluatorsPlayState(ePlayState.Stop)}else{for(var a=0;a<this.evaluators.length;a++){b.setEvaluatorPlayState(evaluators[a],ePlayState.Stop)}}}};function StopCommand_TargetModifiedCB(d,b){var e=d.getValueDirect().join("");var a=e.split(",");b.targets.length=0;for(var c=0;c<a.length;c++){var f=b.registry.find(a[c]);if(f){b.evaluators[c]=f}}}CommandSequence.prototype=new Command();CommandSequence.prototype.constructor=CommandSequence;function CommandSequence(){Command.call(this);this.className="CommandSequence";this.sequence=[]}CommandSequence.prototype.execute=function(){for(var a=0;a<this.sequence.length;a++){this.sequence[a].execute()}};CommandSequence.prototype.addCommand=function(a){this.sequence.push(a)};CommandMgr.prototype=new AttributeContainer();CommandMgr.prototype.constructor=CommandMgr;function CommandMgr(){AttributeContainer.call(this);this.className="CommandMgr";this.sequenceStack=new Stack();this.name=new StringAttr("CommandMgr");this.registerAttribute(this.name,"name")}CommandMgr.prototype.pushCommandSequence=function(a){this.sequenceStack.push(a)};CommandMgr.prototype.popCommandSequence=function(){this.sequenceStack.pop()};CommandMgr.prototype.clearCommandSequence=function(){this.sequenceStack.clear()};CommandMgr.prototype.addCommand=function(e){if(this.sequenceStack.length>0){this.sequenceStack.top().addCommand(e);return}var c=e.getEventTypes();var a=e.getAttribute("trigger");if(c.length>0){var d=this.registry.find("EventMgr");if(d){for(var b=0;b<c.length;b++){d.addListener(c[b],e)}}}else{if(a.getLength()>0){a.addModifiedCB(CommandMgr_CommandTriggerModifiedCB,this);this.createCommandTrigger(e,a)}else{e.execute();this.registry.unregister(e)}}setAttributeBin(null)};CommandMgr.prototype.createCommandTrigger=function(e,n){var f=0;var r=0;var u=0;var g=0;var a="";a=n.getValueDirect().join("");f=a.lastIndexOf("/");if(f!=-1){var j=a.substring(0,f);var b=bridgeworks.registry.find(j);if(b){var d=false;var q="";var c="";var m="";var s="";r=a.lastIndexOf("!");if(r>0){a.replace("!","");d=true}r=a.lastIndexOf("=");if(r>0){g=a.lastIndexOf("[");if(g>0){var h=a.lastIndexOf("]",g);c=a.substring(g+1,h-g-1)}var l=FLT_MAX;var u=a.lastIndexOf(",");if(u>0){var s=a.substring(u+1,n.length()-u-1);l=s.parseFloat()}u=u==-1?a.length:u;m=a.substring(r+1,r+(u-r))}else{g=a.lastIndexOf("[");if(g>0){var h=a.lastIndexOf("]",g);c=a.substring(g+1,h-g-1)}}r=g==-1?(r==-1?a.length():r):g;q=a.substring(f+1,r);var k=b.getAttribute(q);var p=this.createAttribute(k,m);if(p){var t=-1;if(c!=""){t=parseInt(c)}var w=e.numResponses;var o=new AttributeTrigger(k,p,e,t,d,w);e.setTrigger(o)}a=j+"/"+q;console.debug(n);console.debug("\n")}}};CommandMgr.prototype.createAttribute=function(d,e){var b=null;if(d){var c=d.attrType;var a=d.getLength();b=new NumberAttr();b.setValueDirect(parseFloat(e))}return b};function CommandMgr_CommandTriggerModifiedCB(b,a){this.createCommandTrigger(b,a)}AttributeTrigger.prototype=new Command();AttributeTrigger.prototype.constructor=AttributeTrigger;function AttributeTrigger(b,c,g,e,f,d){this.input=b;this.trigger=c;this.target=g;this.lastValues=[];this.input.getValue(this.lastValues);this.item=e;this.not=f;this.executionCount=d;this.input.addModifiedCB(AttributeTrigger_InputModifiedCB,this);var a=this.input.getLength();if(a==1){this.item=0}}AttributeTrigger.prototype.execute=function(){if(this.target){var d=this.trigger.attrType;switch(d){case eAttrType.StringAttr:var b=[];var h=[];this.input.getValue(b);this.trigger.getValue(h);var f=b[0]==h[0]?true:false;f=this.not?!f:f;if(f){var e=this.executionCount.getValueDirect()-1;this.executionCount.setValueDirect(e)}if(this.executionCount==0){this.target=null}break;default:var b=[];var h=[];this.input.getValue(b);this.trigger.getValue(h);if(this.item!=-1){var f=((b[this.item]==h[0])||(this.lastValues[this.item]>b[this.item]&&b[this.item]<h[0])||(this.lastValues[this.item]<b[this.item]&&b[this.item]>h[0]));f=this.not?!f:f;if(f){this.target.execute();var e=this.executionCount.getValueDirect()-1;this.executionCount.setValueDirect(e)}}else{var a=this.input.getLength();var g=0;for(var c=0;c<a;++c){var f=((b[c]==h[c])||(this.lastValues[c]>b[c]&&b[c]<h[c])||(this.lastValues[c]<b[c]&&b[c]>h[c]));f=this.not?!f:f;if(f){++g}}if(g=a){err=this.target.execute();this.executionCount.setValueDirect(--this.executionCount)}}if(this.executionCount.getValueDirect()==0){this.target=null;this.input.removeModifiedCB(AttributeTrigger_InputModifiedCB,this)}else{this.lastValues=b}break}}return};function AttributeTrigger_InputModifiedCB(b,a){a.execute()}BwRegistry.prototype=new AttributeRegistry();BwRegistry.prototype.constructor=BwRegistry;function BwRegistry(){AttributeRegistry.call(this);this.className="BwRegistry";this.attrType=eAttrType.AttributeRegistry;this.rootPtr=new ReferenceAttr(null);this.subtreePtr=new ReferenceAttr(null);this.sgPointer=new StringAttr("");this.maxAnimationTimeInSecs=new NumberAttr(0);this.rootPtr.addModifiedCB(BwRegistry_RootPtrModifiedCB,this);this.sgPointer.addModifiedCB(BwRegistry_SgPointerModifiedCB,this);this.registerAttribute(this.rootPtr,"rootPtr");this.registerAttribute(this.subtreePtr,"subtreePtr");this.registerAttribute(this.sgPointer,"sgPointer");this.registerAttribute(this.maxAnimationTimeInSecs,"maxAnimationTimeInSecs");this.registerByName(this,"NodeMgr");this.registerByName(this,"EvaluatorMgr")}BwRegistry.prototype.find=function(b){if(!b){return null}var e=[];var a=0;while((a=b.indexOf("/"))>-1){e.push(b.substring(0,a));b=b.substring(a+1,b.length)}e.push(b);var d=this.getByName(e[0]);if(d){d=d[0]}for(var c=1;c<e.length&&d;c++){d=d.getAttribute(e[c])}return d};BwRegistry.prototype.findContext=function(a,b){};BwRegistry.prototype.registerResource=function(a){if(a.isNode()&&a.getAttribute("orphan").getValueDirect()==false){this.updateTree(a)}};BwRegistry.prototype.finalizeResource=function(a){if(a.isNode()&&a.getParentCount()>0){this.subtreePtr.setValueDirect(a.getParent(0))}};BwRegistry.prototype.register=function(a){AttributeRegistry.prototype.register.call(this,a)};BwRegistry.prototype.unregister=function(a){AttributeRegistry.prototype.unregister.call(this,a)};BwRegistry.prototype.clear=function(){this.rootPtr.setValueDirect(null);this.subtreePtr.setValueDirect(null);this.sgPointer.setValueDirect(null);AttributeRegistry.prototype.clear.call(this)};BwRegistry.prototype.updateTree=function(b){var a=this.rootPtr.getValueDirect();var c=this.subtreePtr.getValueDirect();if(a==null){a=c=b}else{if(c){c.addChild(b)}else{a.addChild(b)}c=b}this.rootPtr.setValueDirect(a);this.subtreePtr.setValueDirect(c)};BwRegistry.prototype.updateMaxAnimationTime=function(){};BwRegistry.prototype.formatContext=function(b,a){};BwRegistry.prototype.sgPointerModified=function(){var a=this.find(this.sgPointer.getValueDirect().join(""));if(a){this.subtreePtr.setValueDirect(a)}};function BwRegistry_RootPtrModifiedCB(b,a){var c=b.getValueDirect()}function BwRegistry_SgPointerModifiedCB(b,a){a.sgPointerModified()}BwSceneInspector.prototype=new SceneInspector();BwSceneInspector.prototype.constructor=BwSceneInspector;function BwSceneInspector(){SceneInspector.call(this);this.className="BwSceneInspector";this.attrType=eAttrType.SceneInspector;this.camera=null;this.viewport=new Viewport();this.worldUnitsPerPixel=new Vector2D();this.clickPosWorld=new Vector3D();this.last_d3=0;this.translationSensitivity=new Vector3DAttr(1,1,1);this.panSensitivity=new Vector3DAttr(1,1,1);this.trackSensitivity=new Vector3DAttr(1,1,1);this.rotationSensitivity=new Vector3DAttr(1,1,1);this.zoomSensitivity=new NumberAttr(1);this.invertedTranslationDelta=new Vector3DAttr(0,0,0);this.invertedPanDelta=new Vector3DAttr(0,0,0);this.invertedTrackDelta=new Vector3DAttr(0,0,0);this.invertedRotationDelta=new Vector3DAttr(0,0,0);this.zoomDelta=new NumberAttr(0);this.invertedZoomDelta=new NumberAttr(0);this.selectionOccurred=new BooleanAttr(false);this.viewRelativeTranslationDelta=new Vector3DAttr(0,0,0);this.translationDelta.addModifiedCB(BwSceneInspector_TranslationDeltaModifiedCB,this);this.panDelta.addModifiedCB(BwSceneInspector_PanDeltaModifiedCB,this);this.trackDelta.addModifiedCB(BwSceneInspector_TrackDeltaModifiedCB,this);this.rotationDelta.addModifiedCB(BwSceneInspector_RotationDeltaModifiedCB,this);this.invertedTranslationDelta.addModifiedCB(BwSceneInspector_InvertedTranslationDeltaModifiedCB,this);this.invertedPanDelta.addModifiedCB(BwSceneInspector_InvertedPanDeltaModifiedCB,this);this.invertedTrackDelta.addModifiedCB(BwSceneInspector_InvertedTrackDeltaModifiedCB,this);this.invertedRotationDelta.addModifiedCB(BwSceneInspector_InvertedRotationDeltaModifiedCB,this);this.zoomDelta.addModifiedCB(BwSceneInspector_ZoomDeltaModifiedCB,this);this.invertedZoomDelta.addModifiedCB(BwSceneInspector_InvertedZoomDeltaModifiedCB,this);this.selectionOccurred.addModifiedCB(BwSceneInspector_SelectionOccurredCB,this);this.viewRelativeTranslationDelta.addModifiedCB(BwSceneInspector_TrackDeltaModifiedCB,this);this.registerAttribute(this.translationSensitivity,"translationSensitivity");this.registerAttribute(this.panSensitivity,"panSensitivity");this.registerAttribute(this.trackSensitivity,"trackSensitivity");this.registerAttribute(this.rotationSensitivity,"rotationSensitivity");this.registerAttribute(this.zoomSensitivity,"zoomSensitivity");this.registerAttribute(this.invertedTranslationDelta,"invertedTranslationDelta");this.registerAttribute(this.invertedPanDelta,"invertedPanDelta");this.registerAttribute(this.invertedTrackDelta,"invertedTrackDelta");this.registerAttribute(this.invertedRotationDelta,"invertedRotationDelta");this.registerAttribute(this.zoomDelta,"zoomDelta");this.registerAttribute(this.invertedZoomDelta,"invertedZoomDelta");this.registerAttribute(this.selectionOccurred,"selectionOccurred");this.registerAttribute(this.viewRelativeTranslationDelta,"viewRelativeTranslationDelta");this.orphan.setValueDirect(true)}BwSceneInspector.prototype.evaluate=function(){SceneInspector.prototype.evaluate.call(this)};BwSceneInspector.prototype.translate=function(e){if(e.x==0&&e.y==0&&e.z==0){return}var a=this.translationSensitivity.getValueDirect();e.x*=a.x;e.y*=a.y;e.z*=a.z;var b=[e.x,e.y,e.z];var d=new AttributeSetParams(-1,-1,0,true,false);this.translationDelta.setValue(b,d);this.evaluate();var c=[0,0,0];this.translationDelta.setValue(c,d);this.invertedTranslationDelta.setValue(c,d)};BwSceneInspector.prototype.pan=function(g){if(g.x==0&&g.y==0&&g.z==0){return}if(this.worldUnitsPerPixel.x==0&&this.worldUnitsPerPixel.y==0){var b=this.getWorldUnitsPerPixel(this.pivotDistance.getValueDirect());this.worldUnitsPerPixel.x=b.x;this.worldUnitsPerPixel.y=b.y}var a=this.panSensitivity.getValueDirect();g.x*=a.x*this.worldUnitsPerPixel.x;g.y*=a.y*this.worldUnitsPerPixel.y;g.z*=a.z*this.worldUnitsPerPixel.y;var c=[g.x,g.y,g.z];var f=new AttributeSetParams(-1,-1,0,true,false);this.panDelta.setValue(c,f);if(g.z!=0){var d=this.pivotDistance.getValueDirect();d-=g.z;this.pivotDistance.setValueDirect(d)}this.evaluate();var e=[0,0,0];this.panDelta.setValue(e,f);this.invertedPanDelta.setValue(e,f)};BwSceneInspector.prototype.track=function(D){if(D.x==0&&D.y==0&&D.z==0){return}if(this.camera==null||this.camera.attrType==eAttrType.OrthographicCamera){return}if(this.viewport.width<=0||this.viewport.height<=0){return}if(this.worldUnitsPerPixel.x==0&&this.worldUnitsPerPixel.y==0){var h=this.getWorldUnitsPerPixel(this.pivotDistance.getValueDirect());this.worldUnitsPerPixel.x=h.x;this.worldUnitsPerPixel.y=h.y}var G=this.trackSensitivity.getValueDirect();D.x*=G.x*this.worldUnitsPerPixel.x;D.y*=G.y*this.worldUnitsPerPixel.y;if(D.z!=0){var A=this.camera.getAttribute("position").getValueDirect();var B=this.camera.getAttribute("rotation").getValueDirect();var u=A.y-this.clickPosWorld.y;var H=distanceBetween(A,this.clickPosWorld);var o=Math.sqrt((H*H)-(u*u));var a=this.camera.getAttribute("zoom").getValueDirect();var j=2*Math.atan2(1,a);var E=j/this.viewport.height;var x=Math.acos(u/H);var l=x+(D.z*E);var n=Math.tan(l)*u;var F=n-o;if(x>=toRadians(88)&&x<=toRadians(92)){if(F<0){F=-(Math.abs(this.last_d3))}else{F=Math.abs(this.last_d3)}}var f=B;var q=Math.abs(B.z);var c=false;if(q>=90&&q<=270){if(B.x>-45&&B.x<45){c=true}}if(c){F=-F}this.last_d3=F;D.z=F*G.z*(u<0?-1:1);var s=this.camera.getDirectionVectors();v=new Vector3D(s.forward.x,s.forward.y,s.forward.z);v.y=0;v.normalize();var z=subtract3D(this.clickPosWorld,A);z.y=0;z.normalize();var p=cosineAngleBetween(z,v);var t=Math.acos(p);var k=2*Math.atan(this.viewport.width/this.viewport.height*Math.tan(j/2));var r=k/this.viewport.width;var b;var y=this.registry.find("Selector");if(y){b=y.getAttribute("clickPoint").getValueDirect()}var g=Math.abs(this.viewport.width/2-b.x)*r;t=g;var m=Math.tan(t)*F;var e=new Plane(A,s.right);if(pointOnNegativeSideOfPlane(this.clickPosWorld,e)){m*=-1}if(c){m*=-1}D.x+=-m}var d=[D.x,D.y,D.z];var C=new AttributeSetParams(-1,-1,0,true,false);this.trackDelta.setValue(d,C);this.evaluate();var w=[0,0,0];this.trackDelta.setValue(w,C);this.invertedTrackDelta.setValue(w,C)};BwSceneInspector.prototype.rotate=function(e){if(e.x==0&&e.y==0&&e.z==0){return}var a=this.rotationSensitivity.getValueDirect();e.x*=a.x;e.y*=a.y;e.z*=a.z;var b=[e.x,e.y,e.z];var d=new AttributeSetParams(-1,-1,0,true,false);this.rotationDelta.setValue(b,d);this.evaluate();var c=[0,0,0];this.rotationDelta.setValue(c,d);this.invertedRotationDelta.setValue(c,d)};BwSceneInspector.prototype.zoom=function(c){if(c==0){return}if(!this.camera){return}switch(this.camera.className){case"PerspectiveCamera":var b=this.camera.getAttribute("zoom").getValueDirect();b+=c*this.zoomSensitivity.getValueDirect();if(b<0){b=0.05}this.camera.getAttribute("zoom").setValueDirect(b);break;case"OrthographicCamera":var a=this.camera.getAttribute("width").getValueDirect();a+=c*this.zoomSensitivity.getValueDirect();if(a<0){a=0}this.camera.getAttribute("width").setValueDirect(a);break}};BwSceneInspector.prototype.setCamera=function(a){this.camera=a};BwSceneInspector.prototype.getCamera=function(){return this.camera};BwSceneInspector.prototype.getWorldUnitsPerPixel=function(g){var c=0;var h=0;var b=this.registry.find("Selector");if(b){var d=b.selections.viewports[b.selections.viewports.length-1];if(this.camera){switch(this.camera.attrType){case eAttrType.PerspectiveCamera:var f=this.camera.getAttribute("zoom").getValueDirect();var a=worldUnitsPerPixelPersp(d,f,g);c=a.x;h=a.y;break;case eAttrType.OrthographicCamera:var e=this.camera.getAttribute("width").getValueDirect();var a=worldUnitsPerPixelOrtho(d,e);c=a.x;h=a.y;break}}}return{x:c,y:h}};function BwSceneInspector_TranslationDeltaModifiedCB(c,a){var b=a.enabled.getValueDirect();if(b){a.translate(c.getValueDirect())}}function BwSceneInspector_PanDeltaModifiedCB(c,a){var b=a.enabled.getValueDirect();if(b){a.pan(c.getValueDirect())}}function BwSceneInspector_TrackDeltaModifiedCB(c,a){var b=a.enabled.getValueDirect();if(b){a.track(c.getValueDirect())}}function BwSceneInspector_RotationDeltaModifiedCB(c,a){var b=a.enabled.getValueDirect();if(b){a.rotate(c.getValueDirect())}}function BwSceneInspector_InvertedTranslationDeltaModifiedCB(c,a){var b=a.enabled.getValueDirect();if(b){var d=c.getValueDirect();d.x*=-1;d.y*=-1;d.z*=-1;a.translate(d);if(d.x!=0||d.y!=0||d.z!=0){alert("rotate")}}}function BwSceneInspector_InvertedPanDeltaModifiedCB(c,a){var b=a.enabled.getValueDirect();if(b){var d=c.getValueDirect();d.x*=-1;d.y*=-1;d.z*=-1;a.pan(d)}}function BwSceneInspector_InvertedTrackDeltaModifiedCB(c,a){var b=a.enabled.getValueDirect();if(b){var d=c.getValueDirect();d.x*=-1;d.y*=-1;d.z*=-1;a.track(d)}}function BwSceneInspector_InvertedRotationDeltaModifiedCB(c,a){var b=a.enabled.getValueDirect();if(b){var d=c.getValueDirect();d.x*=-1;d.y*=-1;d.z*=-1;a.rotate(d)}}function BwSceneInspector_ZoomDeltaModifiedCB(c,a){var b=a.enabled.getValueDirect();if(b){a.zoom(c.getValueDirect())}}function BwSceneInspector_InvertedZoomDeltaModifiedCB(c,a){var b=a.enabled.getValueDirect();if(b){a.zoom(c.getValueDirect()*-1)}}function BwSceneInspector_SelectionOccurredCB(d,c){var b=c.registry.find("Selector");if(b){if(b.selections.viewports.length>0){c.viewport.loadViewport(b.selections.viewports[0])}c.clickPosWorld.copy(b.getAttribute("pointWorld").getValueDirect());var a=b.getAttribute("pointView").getValueDirect();c.getWorldUnitsPerPixel(a.z)}}ObjectInspector.prototype=new ArcballInspector();ObjectInspector.prototype.constructor=ObjectInspector;function ObjectInspector(){ArcballInspector.call(this);this.className="ObjectInspector";this.attrType=eAttrType.ObjectInspector;this.camera=null;this.selectedObjects=[];this.pointView=new Vector3DAttr(1,1,1);this.translationDelta=new Vector3DAttr(0,0,0);this.rotationDelta=new Vector3DAttr(0,0,0);this.translationNow=new Vector3DAttr(0,0,0);this.rotationNow=new Vector3DAttr(0,0,0);this.selectionOccurred=new BooleanAttr(false);this.selectionCleared=new BooleanAttr(false);this.translationDelta.addModifiedCB(ObjectInspector_TranslationDeltaModifiedCB,this);this.rotationDelta.addModifiedCB(ObjectInspector_RotationDeltaModifiedCB,this);this.translationNow.addModifiedCB(ObjectInspector_TranslationNowModifiedCB,this);this.rotationNow.addModifiedCB(ObjectInspector_RotationNowModifiedCB,this);this.selectionOccurred.addModifiedCB(ObjectInspector_SelectionOccurredCB,this);this.selectionCleared.addModifiedCB(ObjectInspector_SelectionClearedCB,this);this.registerAttribute(this.pointView,"pointView");this.registerAttribute(this.translationDelta,"translationDelta");this.registerAttribute(this.rotationDelta,"rotationDelta");this.registerAttribute(this.translationNow,"translationNow");this.registerAttribute(this.rotationNow,"rotationNow");this.registerAttribute(this.selectionOccurred,"selectionOccurred");this.registerAttribute(this.selectionCleared,"selectionCleared");this.orphan.setValueDirect(true);this.enabled.addModifiedCB(ObjectInspector_EnableModifiedCB,this)}function ObjectInspector_EnableModifiedCB(b,a){console.debug("ObjectInspector.enable modified: "+a.enabled.getValueDirect().toString())}ObjectInspector.prototype.applyCameraRelativeRotation=function(d){var e;var h=null;var j=null;var g=null;var c=null;var f=null;var b=this.viewport;var a=this.camera;h=d.worldCenter.getValueDirect();g=a.getTransform();g.invert();projection=a.projectionMatrix;j=toScreenSpace(h,g,projection,b);this.sphereCenter.setValueDirect(j.x,j.y,0);this.sphereRadius.setValueDirect(0.75);f=d.getTransform();this.worldTransform.setValueDirect(f);g=a.getTransform();this.viewTransform.setValueDirect(g)};ObjectInspector.prototype.applyCameraRelativeTranslation=function(o){var l=this.camera;var x=this.translationDelta.getValueDirect();if(x.x==0&&x.y==0&&x.z==0){return}var d=l.getSectorTransform();d.invert();var f=o.sectorWorldCenter.getValueDirect();var r=l.sectorWorldPosition.getValueDirect();var t=new Vector3D(f.x-r.x,f.y-r.y,f.z-r.z);t.normalize();var s=this.viewport;var m=this.pointView.getValueDirect();var g=new Vector3D(m.x,m.y,m.z);var j=null;var e=new Vector3D(1,0,0);var h=new Vector3D(0,1,0);var w=new Vector3D(t.x,t.y,t.z);var p=new Vector3D(m.x,m.y,m.z);var k=o.motionParent;var u=null;if(k){u=k.getTransform();u.invert()}var c=-1;var n=-1;switch(l.attrType){case eAttrType.PerspectiveCamera:n=l.zoom.getValueDirect();c=worldUnitsPerPixelPersp(s,n,g.z);break;case eAttrType.OrthographicCamera:n=l.width.getValueDirect();c=worldUnitsPerPixelOrtho(s,n);break;default:break}e.multiplyScalar(c.x);e.multiplyScalar(-x.x);h.multiplyScalar(c.y);h.multiplyScalar(x.y);w.multiplyScalar(c.y);w.multiplyScalar(x.z);p.addVector(e);p.addVector(h);d.invert();if(u){d=d.multiply(u);w=u.transform(w.x,w.y,w.z,0)}g=d.transform(g.x,g.y,g.z,1);p=d.transform(p.x,p.y,p.z,1);j=new Vector3D(p.x,p.y,p.z);j.subtractVector(g);j.addVector(w);var a=new AttributeSetParams(-1,-1,eAttrSetOp.Add,true,true);var b=[j.x,j.y,j.z];o.sectorPosition.setValue(b,a);var q=o.sectorPosition.getValueDirect();console.debug("selected.sectorPosition: "+q.x+", "+q.y+", "+q.z)};ObjectInspector.prototype.translationDeltaModified=function(){var e=null;for(var a=0;a<this.selectedObjects.length;a++){e=this.selectedObjects[a];if(!e){continue}var c=e.getAttribute("moveable").getValueDirect();if(!c){continue}this.applyCameraRelativeTranslation(e)}var b=[0,0,0];var d=new AttributeSetParams(0,0,0,true,false);this.translationDelta.setValue(b,d)};ObjectInspector.prototype.rotationDeltaModified=function(){var e=null;for(var c=0;c<this.selectedObjects.length;c++){e=this.selectedObjects[c];if(!e){continue}var d=e.moveable.getValueDirect();if(!d){continue}this.applyCameraRelativeRotation(e);var a=this.mouseNow.getValueDirect();var b=this.rotationDelta.getValueDirect();a.x-=b.x;a.y-=b.y;this.mouseNow.setValueDirect(a.y,a.x);this.evaluate()}};ObjectInspector.prototype.rotationNowModified=function(){if(this.selectedObjects==null||this.selectedObjects==undefined){return}var d=null;for(var a=0;a<this.selectedObjects.length;a++){d=this.selectedObjects[a];var b=d.moveable.getValueDirect();if(b){this.applyCameraRelativeRotation(d);var c=this.rotationNow.getValueDirect();this.mouseNow.setValueDirect(c.y,c.x);this.evaluate()}}};ObjectInspector.prototype.runSelectionOccurred=function(){var x=this.registry.find("Selector");var u=this.registry.find("ViewportMgr");if(!x||!u){return}var a=x.getAttribute("clickPoint").getValueDirect();var o=u.getViewportAtScreenXY(a.x,a.y);this.viewport=o.viewport;this.camera=o.camera;this.selectedObjects=x.selections.models.slice();var c=this.resultQuat;var t=this.quatAtMouseDown;var h=this.mouseDown;var n=this.mouseNow;var p=null;var D=null;var E=null;var q=null;var m=null;var C=null;var d=null;var r=null;var k=null;var G=0;var B=0;for(var z=0;z<this.selectedObjects.length;z++){c.removeAllTargets();h.setValueDirect(a.x,a.y);n.setValueDirect(a.x,a.y);for(var w=0;w<this.selectedObjects.length;w++){p=this.selectedObjects[w];q=getInspectionGroup(p);if(q&&(m=q.getChild(2))){var b=[true];var F=new AttributeSetParams(-1,-1,eAttrSetOp.Replace,true,true);m.enabled.setValue(b,F);r=m.rotationQuat;c.addTarget(r);var f=r.getValueDirect();t.setValueDirect(f);var l=p.bbox;var s=l.min.getValueDirect();var y=l.max.getValueDirect();G=new Vector3D(s.x,s.y,s.z);G.addVector(y);G.multiplyScalar(0.5);var e=p.pivot.getValueDirect();if(p.pivotAboutGeometricCenter.getValueDirect()){e=G}var A=new Vector3D(e.x,e.y,e.z);A.multiplyScalar(-1);b=[e.x,e.y,e.z];q.getChild(0).translation.setValue(b,F);var H=p.worldScale.getValueDirect();var g=new Vector3D(1/H.x,1/H.y,1/H.z);b[0]=g.x;b[1]=g.y;b[2]=g.z;q.getChild(1).scale.setValue(b,F);b[0]=H.x;b[1]=H.y;b[2]=H.z;q.getChild(3).scale.setValue(b,F);b[0]=A.x;b[1]=A.y;b[2]=A.z;q.getChild(4).translation.setValue(b,F)}}}};ObjectInspector.prototype.runSelectionCleared=function(){this.selectedObjects=[]};function ObjectInspector_TranslationDeltaModifiedCB(c,a){var b=a.enabled.getValueDirect();if(b){a.translationDeltaModified()}}function ObjectInspector_RotationDeltaModifiedCB(c,a){var b=a.enabled.getValueDirect();if(b){a.rotationDeltaModified()}}function ObjectInspector_TranslationNowModifiedCB(b,a){}function ObjectInspector_RotationNowModifiedCB(c,a){var b=a.enabled.getValueDirect();if(b){a.rotationNowModified()}}function ObjectInspector_SelectionOccurredCB(c,a){var b=a.enabled.getValueDirect();if(b){a.runSelectionOccurred()}}function ObjectInspector_SelectionClearedCB(b,a){a.runSelectionCleared()}ConnectionMgr.prototype=new AttributeContainer();ConnectionMgr.prototype.constructor=ConnectionMgr;function ConnectionMgr(){AttributeContainer.call(this);this.className="ConnectionMgr";this.name=new StringAttr("ConnectionMgr");this.registerAttribute(this.name,"name");registerConnectionHelper("DisconnectAllTargets",null,ConnectionMgr.prototype.disconnectAllTargets);registerConnectionHelper("dissolve",ConnectionMgr.prototype.connectDissolve,ConnectionMgr.prototype.disconnectDissolve)}ConnectionMgr.prototype.connectSceneInspection=function(c,b){if(!c||!b){return}var a=c.getCamera();if(a==b){return}else{if(a){this.disconnectSceneInspection(c,a)}}b.getAttribute("sectorPosition").addTarget(c.getAttribute("viewPosition"),eAttrSetOp.Replace,null,true);b.getAttribute("rotation").addTarget(c.getAttribute("viewRotation"),eAttrSetOp.Replace,null,true);c.getAttribute("resultPosition").addTarget(b.getAttribute("sectorPosition"),eAttrSetOp.Replace,null,false);c.getAttribute("resultRotation").addTarget(b.getAttribute("rotation"),eAttrSetOp.Replace,null,false);c.setCamera(b)};ConnectionMgr.prototype.disconnectAllTargets=function(d,e){if(d){var c=d.getAttributeCount();for(var a=0;a<c;a++){var b=d.getAttributeAt(a);if(b){b.removeAllTargets()}}}};ConnectionMgr.prototype.disconnectSceneInspection=function(b,a){if(!b||!a){return}a.getAttribute("sectorPosition").removeTarget(b.getAttribute("viewPosition"));a.getAttribute("rotation").removeTarget(b.getAttribute("viewRotation"));b.getAttribute("resultPosition").removeTarget(a.getAttribute("sectorPosition"));b.getAttribute("resultRotation").removeTarget(a.getAttribute("rotation"));b.setCamera(null)};ConnectionMgr.prototype.connectMapProjectionCalculator=function(a,b){if(!a||!b){return}a.getAttribute("resultPosition").addTarget(b.getAttribute("position"));a.evaluate()};ConnectionMgr.prototype.disconnectMapProjectionCalculator=function(a,b){if(!a||!b){return}a.getAttribute("resultPosition").removeTarget(b.getAttribute("position"))};ConnectionMgr.prototype.connectDissolve=function(e,d){if(!e||!d){return}var c=d.getAttribute("dissolve");if(c){var b=e.getAttribute("resultValues");if(b){var a=b.getAt(0);if(a){a.addTarget(c)}}}};ConnectionMgr.prototype.disconnectDissolve=function(e,d){if(!e||!d){return}var c=d.getAttribute("dissolve");if(c){var b=e.getAttribute("resultValues");if(b){var a=b.getAt(0);if(a){a.removeTarget(c)}}}};RenderAgent.prototype=new Agent();RenderAgent.prototype.constructor=RenderAgent;var ePlayState={Unknown:-1,Play:0,Pause:1,Stop:2,};function RenderAgent(a){Agent.call(this);this.className="RenderAgent";this.bridgeworks=a;this.name.setValueDirect("RenderAgent");this.timer=new Timer();this.frameRate=new NumberAttr(0);this.desiredFrameRate=new NumberAttr(30);this.timeIncrement=new NumberAttr(0);this.globalTimeInSecs=new NumberAttr(0);this.elapsedTimeInSecs=new NumberAttr(0);this.desiredFrameRate.addModifiedCB(RenderAgent_DesiredFrameRateModified,this);this.globalTimeInSecs.addModifiedCB(RenderAgent_GlobalTimeInSecsModified,this);this.registerAttribute(this.frameRate,"frameRate");this.registerAttribute(this.desiredFrameRate,"desiredFrameRate");this.registerAttribute(this.timeIncrement,"timeIncrement");this.registerAttribute(this.globalTimeInSecs,"globalTimeInSecs");this.registerAttribute(this.elapsedTimeInSecs,"elapsedTimeInSecs")}RenderAgent.prototype.render=function(){this.timer.stop();var a=this.timer.getTime();this.timer.start();var b=this.elapsedTimeInSecs.getValueDirect()+a;this.elapsedTimeInSecs.setValueDirect(b);this.frameRate.setValueDirect(1/a);this.animateEvaluators(a);this.executeRenderDirectives()};RenderAgent.prototype.animateEvaluators=function(c){var a=this.registry.getByType(eAttrType.Evaluator);for(var b=0;b<a.length;b++){this.animateEvaluator(a[b],c)}};RenderAgent.prototype.animateEvaluator=function(f,d){var a=f.getAttribute("enabled").getValueDirect();var c=f.getAttribute("expired").getValueDirect();var b=f.getAttribute("orphan").getValueDirect();if(a&&!c){switch(f.className){case"KeyframeInterpolator":var e=new AttributeSetParams(-1,-1,eAttrSetOp.Add,true,true);f.getAttribute("time").setValue(d,e);break}if(!b){f.evaluate()}}if(c&&f.getAttribute("renderAndRelease").getValueDirect()){this.registry.unregister(f)}};RenderAgent.prototype.executeRenderDirectives=function(){var b=this.registry.getByType(eAttrType.RenderDirective);if(b){this.bridgeworks.viewportMgr.layoutDirectives(b);for(var a=0;a<b.length;a++){b[a].execute()}}};RenderAgent.prototype.globalTimeInSecsModified=function(){var a=this.globalTimeInSecs.getValueDirect();this.elapsedTimeInSecs.setValueDirect(a);if(this.registry){var b=this.registry.getByType(eAttrType.Evaluator);if(b){for(var c=0;c<b.length;c++){var g=b[c];if(g){var e=g.getAttribute("time");if(e){var d=g.getAttribute("globalTimeSyncEnabled");if((d&&d.getValueDirect())||!d){e.setValueDirect(a)}}g.evaluate()}}}var f=this.registry.getByType(eAttrType.Model);if(f){for(var c=0;c<f.length;c++){setInspectionGroupActivationState(f[c],false)}}}};RenderAgent.prototype.setEvaluatorPlayState=function(c,b){if(!c){return this.setEvaluatorPlayState(b)}var a=c.getAttribute("enabled");switch(b){case ePlayState.Play:a.setValueDirect(true);break;case ePlayState.Pause:a.setValueDirect(false);break;case ePlayState.Stop:a.setValueDirect(false);switch(c.className){case"KeyframeInterpolator":c.getAttribute("time").setValueDirect(0);c.evaluate()}break}clearObjectPositionMap()};RenderAgent.prototype.setEvaluatorsPlayState=function(d){if(this.registry){var a=this.registry.getByType(eAttrType.Evaluator);if(a){for(i=0;i<a.length;i++){var e=a[i];var c=e.attrType;var b=e.getAttribute("orphan").getValueDirect();if(!b){this.setEvaluatorPlayState(e,d)}}}}};RenderAgent.prototype.setDesiredFrameRate=function(a){this.desiredFrameRate.setValueDirect(a)};function RenderAgent_DesiredFrameRateModified(b,a){}function RenderAgent_GlobalTimeInSecsModified(c,a){var b=a.registry.find("RenderAgent");b.globalTimeInSecsModified()}var FRAME_RATE_DEFAULT=30;var FRAME_RATE_MAX=FRAME_RATE_DEFAULT*32;var FRAME_RATE_MIN=FRAME_RATE_DEFAULT*-32;RenderController.prototype=new AttributeContainer();RenderController.prototype.constructor=RenderController;function RenderController(a){AttributeContainer.call(this);this.className="RenderController";this.playState=ePlayState.Pause;this.renderAgent=a.renderAgent}RenderController.prototype.fastForward=function(){this.play();var a=this.renderAgent.frameRate.getValueDirect();if(a<0){this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_DEFAULT)}if(a<FRAME_RATE_MAX){this.renderAgent.desiredFrameRate.setValueDirect(Math.abs(this.renderAgent.frameRate)*2)}else{this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_MAX)}};RenderController.prototype.pause=function(){this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_DEFAULT);this.renderAgent.setEvaluatorsPlayState(ePlayState.Pause)};RenderController.prototype.play=function(){this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_DEFAULT);this.renderAgent.setEvaluatorsPlayState(ePlayState.Play)};RenderController.prototype.rewind=function(){this.play();var a=this.renderAgent.frameRate.getValueDirect();if(a>0){this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_DEFAULT)}if(a>FRAME_RATE_MIN){this.renderAgent.desiredFrameRate.setValueDirect(Math.abs(this.renderAgent.frameRate)*-2)}else{this.renderAgent.desiredFrameRate.setValueDirect(FRAME_RATE_MIN)}};RenderController.prototype.stop=function(){this.renderAgent.setEvaluatorsPlayState(ePlayState.Stop);this.renderAgent.desiredFrameRate.setValueDirect(1)};function Selections(){this.viewports=[];this.cameras=[];this.lights=[];this.models=[];this.surfaces=[];this.clear=function(){this.viewports.length=0;this.cameras.length=0;this.lights.length=0;this.models.length=0;this.surfaces.length=0}}SelectionListener.prototype=new EventListener();SelectionListener.prototype.constructor=SelectionListener;function SelectionListener(){EventListener.call(this);this.className="SelectionListener";this.rayPick=null;this.selections=new Selections();this.selected=null;this.name=new StringAttr("Selector");this.selectionOccurred=new PulseAttr();this.selectionCleared=new PulseAttr();this.pointView=new Vector3DAttr();this.pointWorld=new Vector3DAttr();this.pointObject=new Vector3DAttr();this.pointGeo=new Vector3DAttr();this.triIndex=new NumberAttr();this.distance=new NumberAttr();this.distanceFromScreenCenter=new NumberAttr();this.computePivotDistance=new BooleanAttr(true);this.selectedName=new StringAttr();this.selectedElement=new NumberAttr(-1);this.lastSelectedName=new StringAttr();this.pointWorld.addModifiedCB(SelectionListener_PointWorldModifiedCB,this);this.registerAttribute(this.selectionOccurred,"selectionOccurred");this.registerAttribute(this.selectionCleared,"selectionCleared");this.registerAttribute(this.pointView,"pointView");this.registerAttribute(this.pointWorld,"pointWorld");this.registerAttribute(this.pointObject,"pointObject");this.registerAttribute(this.pointGeo,"pointGeo");this.registerAttribute(this.triIndex,"triIndex");this.registerAttribute(this.distance,"distance");this.registerAttribute(this.distanceFromScreenCenter,"distanceFromScreenCenter");this.registerAttribute(this.computePivotDistance,"computePivotDistance");this.registerAttribute(this.selectedName,"selectedName");this.registerAttribute(this.lastSelectedName,"lastSelectedName");this.registerAttribute(this.name,"name");this.numResponses.setValueDirect(-1)}SelectionListener.prototype.setRayPick=function(b){this.rayPick=b;var a=this.rayPick.getAttribute("clickPoint");this.registerAttribute(a,"clickPoint");a.addModifiedCB(SelectionListener_ClickPointModifiedCB,this)};SelectionListener.prototype.eventPerformed=function(a){switch(a.type){case eEventType.MouseMove:if(a.inputId&MOUSEEVENT_LEFT_BUTTON||a.inputId&MOUSEEVENT_MIDDLE_BUTTON||a.inputId&MOUSEEVENT_RIGHT_BUTTON){return}break}this.clearSelections();this.getAttribute("clickPoint").setValueDirect(a.x,a.y)};SelectionListener.prototype.registerSelection=function(c,b){if(this.selected){return}this.selected=c;var d=this.selected.getContainer();this.registerAttribute(this.selected,"Selected");this.selected.setContainer(d);var a=c.getAttribute("name").getValueDirect().join("");this.selectedName.setValueDirect(a);if(b>=0){this.selectedElement.setValueDirect(b);this.selected.registerAttribute(this.selectedElement,"selectedElement")}};SelectionListener.prototype.clearSelections=function(){this.selections.clear();this.selectedElement.setValueDirect(-1);if(this.selected&&this.selected.getAttribute("selectedElement")){this.selected.unregisterAttribute(this.selectedElement)}this.selectedName.setValueDirect("");this.unregisterAttribute(this.selected);this.selected=null;this.selectionCleared.pulse()};SelectionListener.prototype.processPick=function(e){for(var d=0;d<e.path.length;d++){var f=e.path[d];var b=f.getAttribute("selectable");var a=f.getAttribute("show");var g=f.getAttribute("flipPolygons");if((b&&b.getValueDirect()==false)||(a&&a.getValueDirect()==false)||(g&&g.getValueDirect()==true)){continue}var c=-1;switch(f.attrType){case eAttrType.PerspectiveCamera:case eAttrType.OrthographicCamera:this.selections.cameras.push(f);break;case eAttrType.DirectionalLight:case eAttrType.PointLight:case eAttrType.SpotLight:this.selections.lights.push(f);break;case eAttrType.Model:this.selections.models.push(f);this.registerSelection(f,c);break;case eAttrType.Surface:this.selections.surfaces.push(f);break}}if(this.selected){this.pointObject.setValueDirect(e.intersectRecord.pointModel.x,e.intersectRecord.pointModel.y,e.intersectRecord.pointModel.z);this.pointWorld.setValueDirect(e.intersectRecord.pointWorld.x,e.intersectRecord.pointWorld.y,e.intersectRecord.pointWorld.z);this.pointView.setValueDirect(e.intersectRecord.pointView.x,e.intersectRecord.pointView.y,e.intersectRecord.pointView.z);this.triIndex.setValueDirect(e.intersectRecord.triIndex);this.distance.setValueDirect(e.intersectRecord.distance)}return(this.selected?true:false)};SelectionListener.prototype.processPicks=function(b){for(var a=0;a<b.length;a++){if(this.processPick(b[a])==true){return true}}return false};SelectionListener.prototype.clickPointModified=function(){var a=this.getAttribute("clickPoint").getValueDirect();var c=this.registry.find("ViewportMgr");var d=c.getViewportAtScreenXY(a.x,a.y);this.selections.viewports.push(d.viewport);this.rayPick.getAttribute("viewport").setValueDirect(d.viewport.x,d.viewport.y,d.viewport.width,d.viewport.height);this.rayPick.getAttribute("camera").setValueDirect(d.camera);var b=this.registry.getAttribute("rootPtr").getValueDirect();this.rayPick.execute(b);if(this.rayPick.picked.length>0){this.processPicks(this.rayPick.picked);this.selectionOccurred.pulse()}this.updateDistanceFromScreenCenter(b);this.updateSceneInspectionCamera(d.camera)};SelectionListener.prototype.updateDistanceFromScreenCenter=function(b){if(this.computePivotDistance.getValueDirect()==false){return}var d=this.registry.find("Bridgeworks");if(!d){return}var a=d.canvas.width/2;var h=d.canvas.height/2;var g=this.rayPick.getAttribute("clickPoint").getValueDirect();var f=new AttributeSetParams(-1,-1,0,false,false);this.rayPick.getAttribute("clickPoint").setValueDirect(a,h,f);this.rayPick.execute(b);var e=false;for(var c=0;c<this.rayPick.picked.length&&!e;c++){if(this.rayPick.picked[c].intersectRecord.distance!=0){this.distanceFromScreenCenter.setValueDirect(this.rayPick.picked[c].intersectRecord.distance);e=true;break}}this.rayPick.getAttribute("clickPoint").setValueDirect(g.x,g.y,f)};SelectionListener.prototype.updateSceneInspectionCamera=function(c){var b=this.registry.find("SceneInspector");if(b){if(b.getCamera()==c){return}var a=this.registry.find("ConnectionMgr");if(a){a.disconnectSceneInspection(b,b.getCamera());a.connectSceneInspection(b,c)}}};function SelectionListener_ClickPointModifiedCB(b,a){a.clickPointModified()}function SelectionListener_PointWorldModifiedCB(b,a){}ViewportLayout.prototype=new AttributeContainer();ViewportLayout.prototype.constructor=ViewportLayout;function ViewportLayout(){AttributeContainer.call(this);this.className="ViewportLayout";this.name=new StringAttr("ViewportLayout");this.width=new NumberAttr(0);this.height=new NumberAttr(0);this.registerAttribute(this.name,"name");this.registerAttribute(this.width,"width");this.registerAttribute(this.height,"height")}ViewportLayout.prototype.initialize=function(){};ViewportLayout.prototype.layoutDirectives=function(a){};GridLayout.prototype=new ViewportLayout();GridLayout.prototype.constructor=GridLayout;function GridLayout(){ViewportLayout.call(this);this.className="GridLayout";this.name.setValueDirect("GridLayout");this.rows=new NumberAttr(1);this.cols=new NumberAttr(1);this.registerAttribute(this.rows,"rows");this.registerAttribute(this.cols,"cols")}GridLayout.prototype.initialize=function(){this.rows.setValueDirect(1);this.cols.setValueDirect(1);ViewportLayout.prototype.initialize.call(this)};GridLayout.prototype.layoutDirectives=function(d){if(!d){return}var a=this.width.getValueDirect();var p=this.height.getValueDirect();var q=this.rows.getValueDirect();var k=this.cols.getValueDirect();if(a<=0||p<=0||q<=0||k<=0){return}var o=0;var l=0;var e=a/k;var h=p/q;var m=new Array(4);var b=d.length;for(var g=0,c=0;g<q&&c<b;g++){for(var f=0;f<k&&c<b;f++,c++){m[0]=o;m[1]=l;m[2]=e;m[3]=h;d[c].getAttribute("viewport").setValue(m);o+=e}o=0;l+=h}};ViewportMgr.prototype=new AttributeContainer();ViewportMgr.prototype.constructor=ViewportMgr;function ViewportMgr(){AttributeContainer.call(this);this.className="ViewportMgr";this.name=new StringAttr("ViewportMgr");this.cursor=new StringAttr("Arrow");this.width=new NumberAttr(0);this.height=new NumberAttr(0);this.layout=new ReferenceAttr(null);this.cursor.addModifiedCB(ViewportMgr_CursorModifiedCB,this);this.width.addModifiedCB(ViewportMgr_WidthModifiedCB,this);this.height.addModifiedCB(ViewportMgr_HeightModifiedCB,this);this.layout.addModifiedCB(ViewportMgr_LayoutModifiedCB,this);this.registerAttribute(this.name,"name");this.registerAttribute(this.cursor,"cursor");this.registerAttribute(this.width,"width");this.registerAttribute(this.height,"height");this.registerAttribute(this.layout,"layout")}ViewportMgr.prototype.initLayout=function(){var a=this.layout.getValueDirect();if(a){a.initialize()}};ViewportMgr.prototype.layoutDirectives=function(b){var a=this.layout.getValueDirect();if(a){a.layoutDirectives(b)}};ViewportMgr.prototype.getViewportAtScreenXY=function(h,f){var b=this.width.getValueDirect();var k=this.height.getValueDirect();h=clamp(h,0,b);f=clamp(f,0,k);var g=this.registry.getByType(eAttrType.Camera);var a=b;var j=k;var e,d;for(var c=0;c<g.length;c++){if(g[c].viewport.containsPoint(h,f)&&g[c].viewport.width<=a&&g[c].viewport.height<=j){e=g[c];d=g[c].viewport;a=g[c].viewport.width;j=g[c].viewport.height}}return{viewport:d,camera:e}};function ViewportMgr_CursorModifiedCB(b,a){}function ViewportMgr_WidthModifiedCB(c,a){var b=a.layout.getValueDirect();if(b){b.getAttribute("width").setValueDirect(c.getValueDirect())}}function ViewportMgr_HeightModifiedCB(c,a){var b=a.layout.getValueDirect();if(b){b.getAttribute("height").setValueDirect(c.getValueDirect())}}function ViewportMgr_LayoutModifiedCB(c,a){var b=c.getValueDirect();if(b){b.getAttribute("width").setValueDirect(a.width.getValueDirect());b.getAttribute("height").setValueDirect(a.height.getValueDirect())}}RasterComponentEventListener.prototype=new EventListener();RasterComponentEventListener.prototype.constructor=Command;function RasterComponentEventListener(){EventListener.call(this);this.className="RasterComponentEventListener";this.rcs=[];this.rcsSelectionState=[];this.rcListenMap=[];this.rcEventMap=[];this.styleMgr=null;this.selectionEvent=new InputEvent(eEventType.Unknown,0,4294967295,0,eEventType.Key_Up);this.name.setValueDirect("RasterComponentEventListener");this.numResponses.setValueDirect(-1)}RasterComponentEventListener.prototype.eventPerformed=function(f){var b=this.enabled.getValueDirect();if(!b){return}var a,e,d;for(var c=0;c<this.rcs.length;c++){if(!this.isListening(this.rcs[c])){continue}e=this.rcsSelectionState[c];a=this.rcs[c].eventPerformed(f);if(this.styleMgr){if(a){this.styleMgr.eventPerformed(f,this.rcs[c]);switch(f.type){case eEventType.MouseLeftClick:if(this.isListeningEvent(this.rcs[c],eEventType.ElementFocus)&&this.rcs[c].hasFocus.getValueDirect()<=0){this.selectionEvent.synchronize(f);this.selectionEvent.type=eEventType.ElementFocus;d=m_rcs[c].eventPerformed(this.selectionEvent);this.styleMgr.eventPerformed(this.selectionEvent,this.rcs[c]);this.rcs[c].hasFocus.setValueDirect(1)}break;case eEventType.MouseMove:if(this.isListeningEvent(this.rcs[c],eEventType.ElementSelected)&&this.rcs[c].selected.getValueDirect()<=0){this.selectionEvent.synchronize(f);this.selectionEvent.type=eEventType.ElementSelected;d=this.rcs[c].eventPerformed(this.selectionEvent);this.styleMgr.eventPerformed(this.selectionEvent,this.rcs[c]);this.rcs[c].selected.setValueDirect(1)}if(!e&&this.isListeningEvent(this.rcs[c],eEventType.MouseOver)){this.selectionEvent.synchronize(f);this.selectionEvent.type=eEventType.MouseOver;d=this.rcs[c].eventPerformed(this.selectionEvent);this.styleMgr.eventPerformed(this.selectionEvent,this.rcs[c])}break}}else{switch(f.type){case eEventType.MouseLeftDown:case eEventType.MouseLeftClick:case eEventType.MouseLeftDblClick:case eEventType.MouseMiddleDown:case eEventType.MouseMiddleClick:case eEventType.MouseMiddleDblClick:case eEventType.MouseRightDown:case eEventType.MouseRightClick:case eEventType.MouseRightDblClick:case eEventType.MouseWheelDown:case eEventType.MouseBothDown:if(this.isListeningEvent(this.rcs[c],eEventType.ElementBlur)&&this.rcs[c].hasFocus.getValueDirect()>0){this.selectionEvent.synchronize(f);this.selectionEvent.type=eEventType.ElementBlur;d=this.rcs[c].eventPerformed(this.selectionEvent);this.styleMgr.eventPerformed(this.selectionEvent,this.rcs[c]);this.rcs[c].hasFocus.setValueDirect(-1)}break;case eEventType.MouseMove:if(this.isListeningEvent(this.rcs[c],eEventType.ElementUnselected)&&this.rcs[c].selected.getValueDirect()>0){this.selectionEvent.synchronize(f);this.selectionEvent.type=eEventType.ElementUnselected;d=this.rcs[c].eventPerformed(this.selectionEvent);this.styleMgr.eventPerformed(this.selectionEvent,this.rcs[c]);this.rcs[c].selected.setValueDirect(-1)}if(e&&this.isListeningEvent(this.rcs[c],eEventType.MouseOut)){this.selectionEvent.synchronize(f);this.selectionEvent.type=eEventType.MouseOut;d=this.rcs[c].eventPerformed(this.selectionEvent);this.styleMgr.eventPerformed(this.selectionEvent,this.rcs[c])}break}}}this.rcsSelectionState[c]=a}};RasterComponentEventListener.prototype.registerComponent=function(c,b){if(c){if(b){var a=this.rcs.indexOf(b);if(a<0){a=this.rcs.length}this.rcs.splice(a,0,c);this.rcsSelectionState.splice(a,0,c)}else{this.rcs.push(c);this.rcsSelectionState.push(c)}}};RasterComponentEventListener.prototype.unregisterComponent=function(a){if(a){this.rcs.splice(this.rcs.indexOf(a),1)}};RasterComponentEventListener.prototype.Listen=function(a){if(a){this.rcListenMap[a]=true}};RasterComponentEventListener.prototype.Ignore=function(a){if(a){this.rcListenMap[a]=false}};RasterComponentEventListener.prototype.listenEvent=function(b,a){if(b){if(this.rcEventMap[b]==undefined){this.rcEventMap[b]=new Array()}this.rcEventMap[b].push(a)}};RasterComponentEventListener.prototype.ignoreEvent=function(b,a){if(b){if(this.rcEventMap[b]){this.rcEventMap[b].splice(this.rcEventMap[b].indexOf(a),1)}}};RasterComponentEventListener.prototype.setStyleMgr=function(a){this.styleMgr=a};RasterComponentEventListener.prototype.setSelectionState=function(b,a){this.rcsSelectionState[b]=a};RasterComponentEventListener.prototype.getComponent=function(a){if(a<this.rcs.length){return this.rcs[a]}return null};RasterComponentEventListener.prototype.isListening=function(a){if(a){if(this.rcListenMap[a]){return this.rcListenMap[a]}}return false};RasterComponentEventListener.prototype.isListeningEvent=function(b,a){if(b){if(this.rcEventMap[b]){if(this.rcEventMap[b].indexOf(a)>=0){return true}}}return false};var g_objPosMap={};function addInspectionGroup(b,d){var k=getInspectionGroup(b);if(k){return}var g=new Group();g.setGraphMgr(d.graphMgr);var e=new Translate();e.setGraphMgr(d.graphMgr);var j=new Scale();j.setGraphMgr(d.graphMgr);var h=new QuaternionRotate();h.setGraphMgr(d.graphMgr);var a=new Translate();a.setGraphMgr(d.graphMgr);var c=new Scale();c.setGraphMgr(d.graphMgr);h.addModifiedCB(Util_InspectionGroup_RotationQuatModifiedCB,null);g.name.setValueDirect("InspectionGroup");e.name.setValueDirect("Translate");j.name.setValueDirect("ScaleInverse");h.name.setValueDirect("Quaternion");a.name.setValueDirect("TranslateBack");c.name.setValueDirect("Scale");g.addChild(e);g.addChild(j);g.addChild(h);g.addChild(c);g.addChild(a);var f=b.getChild(0);if(f){f.insertChild(g,0)}b.registerAttribute(e.translation,"inspectionGroup_translate");b.registerAttribute(j.scale,"inspectionGroup_scaleInverse");b.registerAttribute(h.rotationQuat,"inspectionGroup_rotationQuat");b.registerAttribute(h.enabled,"inspectionGroup_rotationEnabled");b.registerAttribute(c.scale,"inspectionGroup_scale");b.registerAttribute(a.translation,"inspectionGroup_translateBack");e.translation.setContainer(b);j.scale.setContainer(b);h.rotationQuat.setContainer(b);h.enabled.setContainer(b);c.scale.setContainer(b);a.translation.setContainer(b);return}function deleteInspectionGroup(b){var a=getInspectionGroup(b);if(a){a.getChild(0).getAttribute("translation").setContainer(a.getChild(0));a.getChild(1).getAttribute("scale").setContainer(a.getChild(1));a.getChild(2).getAttribute("rotationQuat").setContainer(a.getChild(2));a.getChild(2).getAttribute("enabled").setContainer(a.getChild(2));a.getChild(3).getAttribute("scale").setContainer(a.getChild(3));a.getChild(4).getAttribute("translation").setContainer(a.getChild(4));b.unregisterAttribute(b.getAttribute("inspectionGroup_translate"));b.unregisterAttribute(b.getAttribute("inspectionGroup_scaleInverse"));b.unregisterAttribute(b.getAttribute("inspectionGroup_rotationQuat"));b.unregisterAttribute(b.getAttribute("inspectionGroup_rotationEnabled"));b.unregisterAttribute(b.getAttribute("inspectionGroup_scale"));b.unregisterAttribute(b.getAttribute("inspectionGroup_translateBack"));b.removeChild(a)}return}function getInspectionGroup(b){var c=null;var a=b.getChild(0);if(a){c=a.getNamedChild("InspectionGroup")}return c}function setInspectionGroupActivationState(e,b){var g=getInspectionGroup(e);if(g){var c=g.getChild(2);if(c){c.enabled.setValueDirect(b);if(!b){var f=new Quaternion();f.loadIdentity();var d=c.rotationQuat;d.setValueDirect(f)}}var a=e.getAttribute("position");if(b){if(!(e in g_objPosMap)){g_objPosMap[e]=a.getValueDirect()}}else{var h=g_objPosMap[e];a.setValueDirect(h)}}return}function setInspectionGroupContainer(a){var b=getInspectionGroup(a);if(b){a.unregisterAttribute(a.getAttribute("inspectionGroup_translate"));a.unregisterAttribute(a.getAttribute("inspectionGroup_scaleInverse"));a.unregisterAttribute(a.getAttribute("inspectionGroup_rotationQuat"));a.unregisterAttribute(a.getAttribute("inspectionGroup_rotationEnabled"));a.unregisterAttribute(a.getAttribute("inspectionGroup_scale"));a.unregisterAttribute(a.getAttribute("inspectionGroup_translateBack"));a.registerAttribute(b.getChild(0).getAttribute("translation"),"inspectionGroup_translate");a.registerAttribute(b.getChild(1).getAttribute("scale"),"inspectionGroup_scaleInverse");a.registerAttribute(b.getChild(2).getAttribute("rotationQuat"),"inspectionGroup_rotationQuat");a.registerAttribute(b.getChild(2).getAttribute("enabled"),"inspectionGroup_rotationEnabled");a.registerAttribute(b.getChild(3).getAttribute("scale"),"inspectionGroup_scale");a.registerAttribute(b.getChild(4).getAttribute("translation"),"inspectionGroup_translateBack");b.getChild(0).getAttribute("translation").setContainer(a);b.getChild(1).getAttribute("scale").setContainer(a);b.getChild(2).getAttribute("rotationQuat").setContainer(a);b.getChild(2).getAttribute("enabled").setContainer(a);b.getChild(3).getAttribute("scale").setContainer(a);b.getChild(4).getAttribute("translation").setContainer(a)}return}function zeroInspectionGroup(c){var e=getInspectionGroup(c);if(e){var a=e.getChild(2);if(a){var d=new Quaternion();d.loadIdentity();var b=a.rotationQuat;b.setValueDirect(d)}}return}function clearObjectPositionMap(){g_objPosMap={};return}function Util_InspectionGroup_RotationQuatModifiedCB(b,a){}SerializeCommand.prototype=new Command();SerializeCommand.prototype.constructor=SerializeCommand;function SerializeCommand(){Command.call(this);this.className="Serialize";this.targetAttribute=null;this.target.addModifiedCB(this.SerializeCommand_TargetModifiedCB,this);this.directive=null;this.serialized=""}SerializeCommand.prototype.execute=function(){if(this.directive){this.serializeScene()}};SerializeCommand.prototype.serializeScene=function(){var h;var b=null;var e=null;var c=new Context();var g;this.serialized="<Session broadcast='false'>";var k=bridgeworks.registry;if(k){var l=new XMLSerializer();var d=new Serializer();var j=k.getObjectCount();for(h=1;h<j;h++){b=k.getObject(h);if(b){c.attribute=b;var f="";d.serialize(c.attribute,c.item,c.attributeName,c.container,f);g=l.serializeToString(c.attribute);console.log(g);this.serialized+=f}}for(h=0;h<j;h++){if(e=k.getObject(h)&&!e.getParent(0)){this.directive.Execute(e);this.serialized+=this.directive.getSerialized()}}for(h=0;h<j;h++){b=k.getObject(h);if(!b){continue}if(!b&&!b&&!b){if(b.toString()=="SelectionListener"){var a=b.getAttribute("computePivotDistance").getValueDirect();this.serialized+='<Set target="Selector" computePivotDistance="';this.serialized+=(a?"true":"false");this.serialized+='"/>'}else{c.attribute=b;var f="";l.Serialize(c,f);this.serialized+=f}}}for(h=0;h<j;h++){b=k.getObject(h);if(!b){continue}if(b&&(b.toString()=="DisconnectAttributes")){c.attribute=b;var f="";l.Serialize(c,f);this.serialized+=f}}for(h=0;h<j;h++){b=k.getObject(h);if(!b){continue}if(b&&(b.toString()=="DisconnectAttributes")){c.attribute=b;var f="";l.Serialize(c,f);this.serialized+=f}}}this.serialized+="</Session>";return};SerializeCommand.prototype.Undo=function(){};SerializeCommand.prototype.setRegistry=function(b){var a=bridgeworks.registry.find("AttributeFactory");this.directive=a.create("SerializeDirective");Command.prototype.setRegistry(b)};SerializeCommand.prototype.getSerialized=function(){return this.serialized};SerializeCommand.prototype.SerializeCommand_TargetModifiedCB=function(a,b){var c=b.getValueDirect().join("");a.targetAttribute=a.registry.find(c)};var eLWObjectTokens={COLR:1129270354,DIFF:1145652806,LUMI:1280658761,SPEC:1397769539,TRAN:1414676814};function LWO2BlockData(){this.type="";this.ordinal="";this.channel=0;this.enable=1;this.opacityType=7;this.opacity=1;this.opacityEnvelope=0;this.negative=0;this.center=new Vector3D();this.size=new Vector3D();this.coordSys=0;this.projMode=0;this.axis=0;this.imageIndex=0;this.widthWrap=1;this.heightWrap=1;this.widthWrapAmt=0;this.heightWrapAmt=0;this.uvMapName=""}function LWO2SurfaceData(){this.name="";this.source="";this.color=new Vector3D();this.diffuseLevel=1;this.specularLevel=0;this.luminosityLevel=0;this.transparencyLevel=0;this.glossiness=0.4;this.doubleSided=false;this.smoothingAngle=0;this.blocks=[];this.addBlock=function(){this.blocks.push(new LWO2BlockData())};this.currentBlock=function(){return this.blocks.length>0?this.blocks[this.blocks.length-1]:null}}function LWO2ClipData(){this.type=0;this.negative=0;var a="";var b="";this.setPlatformNeutralFilename=function(c){b=c;a=c;if(a.indexOf(":")>=0){var d=new Array();d=a.split(":");a=d[0]+":/"+d[1]}};this.setFilename=function(c){a=c;b=c;var e=a.indexOf(":");if(e>=0){if(a.charAt(e+1)!="/"&&a.charAt(e+1)!="\\"){var d=new Array();d=a.split(":");a=d[0]+":/"+d[1]}}e=b.indexOf(":");if(e>=0){if(b.charAt(e+1)=="/"||b.charAt(e+1)=="\\"){var d=new Array();d=b.split(":");b=d[0]+":"+d[1].substr(1,d[1].length)}}this.getPlatformNeutralFilename=function(){return b};this.getFilename=function(){return a}}}function LWO2EnvelopeData(){this.userFormat=0;this.type=0;this.preBehavior=0;this.postBehavior=0;this.keyframes=[];this.currentKyframe=function(){return this.keyframes.length>0?this.keyframes[this.keyframes.length-1]:null}}function LWO2VMAPData(){this.vertex=0;this.u=0;this.v=0}function LWO2VMADData(){this.poly=0;this.vertex=0;this.u=0;this.v=0}function LWO2PTAGData(){this.poly=0;this.tag=0}function LWO2LayerData(){this.number=0;this.name="";this.pnts=[];this.pols=[];this.ptagsSURF=[];this.vmapsTXUV=[];this.vmadsTXUV=[];this.ptagsSURFMaxIndex=0;this.pivot=new Vector3D();this.getVmap=function(b,a){switch(b){case"TXUV":return this.vmapsTXUV[a];break;default:return null}};this.putVmap=function(b,a,c){switch(b){case"TXUV":if(this.vmapsTXUV[a]==undefined){this.vmapsTXUV[a]=[]}this.vmapsTXUV[a].push(c);break}};this.getVmad=function(b,a){switch(b){case"TXUV":return this.vmadsTXUV[a];break;default:return null}};this.putVmad=function(b,a,c){switch(b){case"TXUV":if(this.vmadsTXUV[a]==undefined){this.vmadsTXUV[a]=[]}this.vmadsTXUV[a].push(c);break}};this.putPtag=function(a){this.ptagsSURF.push(a)}}function LWO2Data(){this.name="";this.contentDir="";this.layers=[];this.tags=[];this.surfaces=[];this.clips=[];this.envelopes=[];this.subChunkContext="";this.evaluators=[];var c=null;var b=null;var a=null;this.addLayer=function(e){var d=new LWO2LayerData();d.number=e;if(this.layers.length<=e){this.layers.length=e+1}this.layers[e]=d;a=d};this.currentLayer=function(){return a};this.addSurface=function(e,f){var d=new LWO2SurfaceData();d.name=e;d.source=f;this.surfaces.push(d)};this.currentSurface=function(){return this.surfaces.length>0?this.surfaces[this.surfaces.length-1]:null};this.getSurface=function(d){for(var e=0;e<this.surfaces.length;e++){if(this.surfaces[e].name==d){return this.surfaces[e]}}return null};this.addClip=function(d){var e=new LWO2ClipData();if(this.clips.length<=d){this.clips.length=d+1}this.clips[d]=e;c=e};this.currentClip=function(){return c};this.addEnvelope=function(d){var e=new LWO2EnvelopeData();this.envelopes[d]=e;b=e};this.currentEnvelope=function(){return b}}LWObjectHandler.prototype=new ContentHandler();LWObjectHandler.prototype.constructor=LWObjectHandler;function LWObjectHandler(){ContentHandler.call(this);this.className="LWObjectHandler";this.lwo2DataHandlers=[];this.lwo2DataHandlersData=[]}LWObjectHandler.prototype.addObjectHandler=function(a,b){this.lwo2DataHandlers.push(a);this.lwo2DataHandlersData.push(b)};LWObjectHandler.prototype.parseFileStream=function(d){var c=formFullPath(d,this.contentDirectory.getValueDirect().join(""));var b=loadBinaryResource(c);if(b==null){return -2}var g=new BinaryParser(b,true);if(g.readUInt8()!=70||g.readUInt8()!=79||g.readUInt8()!=82||g.readUInt8()!=77){return -1}var a=g.readUInt32();if(g.readUInt8()!=76||g.readUInt8()!=87||g.readUInt8()!=79||g.readUInt8()!=50){return -1}a-=4;var f=new LWO2Data();f.contentDir=this.contentDirectory.getValueDirect().join("");while(a>0){a-=this.parseChunk(g,f)}for(var e=0;e<this.lwo2DataHandlers.length;e++){this.lwo2DataHandlers[e](f,this.lwo2DataHandlersData[e])}return 0};LWObjectHandler.prototype.parseChunk=function(d,G){var D=0;var H=d.readUInt32();var k=d.readUInt32();switch(H){case 1279351122:var a=d.readUInt16();D+=2;var g=d.readUInt16();D+=2;var o=d.readFloat32();D+=4;var n=d.readFloat32();D+=4;var l=d.readFloat32();D+=4;var I=this.readString(d);D+=I.bytesRead;if(k>D){var m=d.readUInt16();D+=2}G.addLayer(a);G.currentLayer().name=I.string;G.currentLayer().pivot.x=o;G.currentLayer().pivot.y=n;G.currentLayer().pivot.z=l;break;case 1347310675:var j=k/12;for(var C=0;C<j;C++){var o=d.readFloat32();D+=4;var n=d.readFloat32();D+=4;var l=d.readFloat32();D+=4;G.currentLayer().pnts[C]=new Vector3D();G.currentLayer().pnts[C].x=o;G.currentLayer().pnts[C].y=n;G.currentLayer().pnts[C].z=l}break;case 1347374163:var e=d.readUInt32();D+=4;var g,F;while(k>D){var f=[];g=d.readUInt16();D+=2;F=g&1023;for(var C=0;C<F;C++){var h=this.readVariableLengthIndex(d);D+=h.bytesRead;f.push(h.index)}G.currentLayer().pols.push(f)}break;case 1413564243:while(k>D){var s=this.readString(d);D+=s.bytesRead;G.tags.push(s.string)}break;case 1347699015:var e=d.readUInt32();D+=4;while(k>D){var A=new LWO2PTAGData();var h=this.readVariableLengthIndex(d);D+=h.bytesRead;A.poly=h.index;A.tag=d.readUInt16();D+=2;switch(e){case 1398100550:G.currentLayer().putPtag(A);G.currentLayer().ptagsSURFMaxIndex=Math.max(A.tag,G.currentLayer().ptagsSURFMaxIndex);break}}break;case 1447903568:var e=d.readUInt32();D+=4;var E=d.readUInt16();D+=2;var I=this.readString(d);D+=I.bytesRead;var q,p,w;while(k>D){var h=this.readVariableLengthIndex(d);D+=h.bytesRead;switch(e){case 1415075158:q=d.readFloat32();D+=4;p=d.readFloat32();D+=4;var r=new LWO2VMAPData();r.vertex=h.index;r.u=q;r.v=p;G.currentLayer().putVmap("TXUV",I.string,r);break;default:for(var C=0;C<E;C++){w=d.readFloat32();D+=4}break}}break;case 1447903556:var e=d.readUInt32();D+=4;var E=d.readUInt16();D+=2;var I=this.readString(d);D+=I.bytesRead;var q,p,w;while(k>D){var c=this.readVariableLengthIndex(d);D+=c.bytesRead;var B=this.readVariableLengthIndex(d);D+=B.bytesRead;switch(e){case 1415075158:q=d.readFloat32();D+=4;p=d.readFloat32();D+=4;var b=new LWO2VMADData();b.vertex=c.index;b.poly=B.index;b.u=q;b.v=p;G.currentLayer().putVmad("TXUV",I.string,b);break;default:for(var C=0;C<E;C++){w=d.readFloat32();D+=4}break}}break;case 1398100550:var I=this.readString(d);D+=I.bytesRead;var t=this.readString(d);D+=t.bytesRead;G.addSurface(I.string,t.string);while(k>D){D+=this.parseSubChunk(d,G)}break;case 1129072976:var h=d.readUInt32();D+=4;G.addClip(h);G.subChunkContext=H;while(k>D){D+=this.parseSubChunk(d,G)}break;case 1162761804:var h=this.readVariableLengthIndex(d);D+=h.bytesRead;G.addEnvelope(h.index);while(k>D){D+=this.parseSubChunk(d,G)}break;default:while(k>D){d.readUInt8();D++}break}if(k&1){d.readUInt8();D++}D+=8;return D};LWObjectHandler.prototype.parseSubChunk=function(c,h){var d=0;var o=c.readUInt32();d+=4;var n=c.readUInt16();d+=2;switch(o){case 1129270354:h.currentSurface().color.x=c.readFloat32();d+=4;h.currentSurface().color.y=c.readFloat32();d+=4;h.currentSurface().color.z=c.readFloat32();d+=4;if(n>(d-6)){var j=this.readVariableLengthIndex(c);d+=j.bytesRead}break;case 1145652806:h.currentSurface().diffuseLevel=c.readFloat32();d+=4;if(n>(d-6)){var j=this.readVariableLengthIndex(c);d+=j.bytesRead}break;case 1280658761:h.currentSurface().luminosityLevel=c.readFloat32();d+=4;if(n>(d-6)){var j=this.readVariableLengthIndex(c);d+=j.bytesRead}break;case 1397769539:h.currentSurface().specularLevel=c.readFloat32();d+=4;if(n>(d-6)){var j=this.readVariableLengthIndex(c);d+=j.bytesRead}break;case 1414676814:h.currentSurface().transparencyLevel=c.readFloat32();d+=4;if(n>(d-6)){var j=this.readVariableLengthIndex(c);d+=j.bytesRead}break;case 1196183379:h.currentSurface().glossiness=c.readFloat32();d+=4;if(n>(d-6)){var j=this.readVariableLengthIndex(c);d+=j.bytesRead}break;case 1397310533:h.currentSurface().doubleSided=(c.readUInt16()==3?true:false);d+=2;break;case 1397571918:h.currentSurface().smoothingAngle=c.readFloat32();d+=4;break;case 1398032716:case 1095649613:case 1230194001:var a=this.readString(c);d+=a.bytesRead;while(n>(d-6)){c.readUInt8();d+=1}h.currentClip().type=o;h.currentClip().setFilename(a.string);break;case 1313163073:var g=c.readUInt16();d+=2;if(h.subChunkContext=="IMAP"){h.currentSurface().currentBlock().negative=g}else{if(h.subChunkContext=="CLIP"){h.currentClip().negative=g}}break;case 1112297291:h.currentSurface().addBlock();break;case 1229799760:var l=this.readString(c);d+=l.bytesRead;h.currentSurface().currentBlock().type="IMAP";h.currentSurface().currentBlock().ordinal=l.string;h.subChunkContext="IMAP";break;case 1128808782:var k=c.readUInt32();d+=4;if(h.subChunkContext=="IMAP"){h.currentSurface().currentBlock().channel=k}break;case 1162756418:h.currentSurface().currentBlock().enable=c.readUInt16();d+=2;break;case 1330659651:h.currentSurface().currentBlock().opacityType=c.readUInt16();d+=2;h.currentSurface().currentBlock().opacity=c.readFloat32();d+=4;if(n>(d-6)){var m=this.readVariableLengthIndex(c);d+=m.bytesRead;h.currentSurface().currentBlock().opacityEnvelope=m.index}break;case 1414349136:break;case 1129206866:h.currentSurface().currentBlock().center.x=c.readFloat32();d+=4;h.currentSurface().currentBlock().center.y=c.readFloat32();d+=4;h.currentSurface().currentBlock().center.z=c.readFloat32();d+=4;while(n>(d-6)){var j=this.readVariableLengthIndex(c);d+=j.bytesRead}break;case 1397316165:h.currentSurface().currentBlock().size.x=c.readFloat32();d+=4;h.currentSurface().currentBlock().size.y=c.readFloat32();d+=4;h.currentSurface().currentBlock().size.z=c.readFloat32();d+=4;while(n>(d-6)){var j=this.readVariableLengthIndex(c);d+=j.bytesRead}break;case 1129535827:h.currentSurface().currentBlock().coordSys=c.readUInt16();d+=2;break;case 1347571530:h.currentSurface().currentBlock().projMode=c.readUInt16();d+=2;break;case 1096304979:var e=c.readUInt16();d+=2;if(h.subChunkContext=="IMAP"){h.currentSurface().currentBlock().axis=e}break;case 1229799751:var f=this.readVariableLengthIndex(c);d+=f.bytesRead;h.currentSurface().currentBlock().imageIndex=f.index;break;case 1465008464:h.currentSurface().currentBlock().widthWrap=c.readUInt16();d+=2;h.currentSurface().currentBlock().heightWrap=c.readUInt16();d+=2;break;case 1465012311:h.currentSurface().currentBlock().widthWrapAmt=c.readFloat32();d+=4;if(n>(d-6)){var j=this.readVariableLengthIndex(c);d+=j.bytesRead}break;case 1465012296:h.currentSurface().currentBlock().heightWrapAmt=c.readFloat32();d+=4;if(n>(d-6)){var j=this.readVariableLengthIndex(c);d+=j.bytesRead}break;case 1447903568:var b=this.readString(c);d+=b.bytesRead;h.currentSurface().currentBlock().uvMapName=b.string;break;case 1415139397:h.currentEnvelope().userFormat=c.readUInt8();d+=1;h.currentEnvelope().type=c.readUInt8();d+=1;break;case 1347568928:h.currentEnvelope().preBehavior=c.readUInt16();d+=2;break;break;break;case 1347375956:h.currentEnvelope().postBehavior=c.readUInt16();d+=2;break;default:while(n>(d-6)){c.readUInt8();d+=1}break}if(n&1){c.readUInt8();d+=1}return d};LWObjectHandler.prototype.readString=function(e){var a="";var d=0;var b=0;do{d=e.readUInt8();b++;a+=String.fromCharCode(d)}while(d);if(b&1){e.readUInt8();b++}return{string:a,bytesRead:b}};LWObjectHandler.prototype.readVariableLengthIndex=function(e){var a=0;var d=new Array(4);var b=0;d[0]=e.readUInt8();b++;d[1]=e.readUInt8();b++;if(d[0]<65280){a=d[0]<<8|d[1]}else{d[2]=e.readUInt8();b++;d[3]=e.readUInt8();b++;a=d[1]<<16|d[2]<<8|d[3]}return{index:a,bytesRead:b}};LWObjectHandler.prototype.matchesType=function(a){return(a=="lwo")};LWObjectBuilder.prototype=new ContentBuilder();LWObjectBuilder.prototype.constructor=LWObjectBuilder;function LWObjectBuilder(){ContentBuilder.call(this);this.className="LWObjectBuilder";this.graphMgr=null;this.indexGeometry=new BooleanAttr(true);this.registerAttribute(this.indexGeometry,"indexGeometry")}LWObjectBuilder.prototype.visitHandler=function(a){a.addObjectHandler(LWObjectBuilder_ObjectHandler,this)};LWObjectBuilder.prototype.finalize=function(){};LWObjectBuilder.prototype.matchesType=function(a){return(a=="lwo")};LWObjectBuilder.prototype.allocateModel=function(e){var b=null;var d=this.layer;if(d==0){for(var c=0;c<e.layers.length;c++){if(!this.models[0]){var a=this.registry.find("AttributeFactory");b=a.create("Model");this.models.push(b)}else{b=this.models[0]}this.describeModel(e,e.layers[c],b)}}else{if(d<=e.layers.length){if(!this.models[0]){var a=this.registry.find("AttributeFactory");b=a.create("Model");this.models.push(b)}else{b=this.models[0]}this.describeModel(e,e.layers[d-1],b)}}};LWObjectBuilder.prototype.describeModel=function(ac,d,c){var D=this.registry.find("AttributeFactory");var n=c.getAttribute("pivot");if(c.getAttributeModificationCount(n)==0){n.setValue(d.pivot.v())}var M=d.ptagsSURFMaxIndex+1;var a=new Array(M);var f=new Array(M);var p=new Array(M);for(var aa=0;aa<M;aa++){a[aa]=[];f[aa]=[];p[aa]=[]}var C,x;var X=d.ptagsSURF.length;for(var W=0;W<X;W++){C=d.ptagsSURF[W].poly;x=d.ptagsSURF[W].tag;switch(d.pols[C].length){case 3:a[x].push(C);break;case 2:f[x].push(C);break;case 1:p[x].push(C);break}}var t=new Array(M);for(var x=0;x<M;x++){t[x]=this.allocateSurface(ac,d,x);c.addSurface(t[x])}var Y=new Array(d.pnts.length*3);for(var ad=0;ad<d.pnts.length;ad++){Y[ad*3]=d.pnts[ad].x;Y[ad*3+1]=d.pnts[ad].y;Y[ad*3+2]=d.pnts[ad].z}c.getAttribute("vertices").setValue(Y);var N=[];var V=[];var U=[];var l=[];var G=[];var z=[];var I=[];var ab=[];N.length=d.pnts.length;for(var aa=0;aa<N.length;aa++){N[aa]=[]}V.length=M;U.length=M;l.length=M;G.length=M;z.length=M;I.length=M;ab.length=M;for(var x=0;x<t.length;x++){var b=[];var s=[];V[x]=[];U[x]=[];l[x]=new Pair();l[x].first=l[x].second=0;G[x]=[];ab[x]=[];var Q=a[x];var L=Q.length;var B=new Vector3D();var A=new Vector3D();for(var C=0;C<L;C++){var H=d.pols[Q[C]];for(var q=0;q<3;q++){var K=d.pnts[H[q]];b.push(K.x);b.push(K.y);b.push(K.z);U[x].push(H[q]);l[x].first=Math.min(H[q],l[x].first);l[x].second=Math.min(H[q],l[x].second);G[x].push(Q[C])}var ah=H[0];var ag=H[1];var af=H[2];var w=d.pnts[ah];var u=d.pnts[ag];var r=d.pnts[af];B.load(u.x-w.x,u.y-w.y,u.z-w.z);A.load(r.x-w.x,r.y-w.y,r.z-w.z);var e=crossProduct(B,A);e.normalize();s.push(e.x);s.push(e.y);s.push(e.z);s.push(e.x);s.push(e.y);s.push(e.z);s.push(e.x);s.push(e.y);s.push(e.z);V[x].push(new Pair(ah,e));V[x].push(new Pair(ag,e));V[x].push(new Pair(af,e));N[ah].push(e);N[ag].push(e);N[af].push(e);ab[x].push(e);ab[x].push(e);ab[x].push(e)}if(b.length){var O=D.create("TriList");c.addGeometry(O,t[x]);O.getAttribute("vertices").setValue(b);O.getAttribute("normals").setValue(s);z[x]=O;I[x]=b}b=[];Q=f[x];L=Q.length;for(var C=0;C<L;C++){var H=d.pols[C];if(H.length<2){continue}for(var q=0;q<2;q++){var K=d.pnts[H[q]];b.push(K.x);b.push(K.y);b.push(K.z)}}if(b.length){var g=D.create("LineList");c.addGeometry(g,t[x]);g.getAttribute("vertices").setValue(b)}b=[];Q=p[x];L=Q.length;for(var C=0;C<L;C++){var H=d.pols[C];var K=d.pnts[H[0]];b.push(K.x);b.push(K.y);b.push(K.z)}if(b.length){var ae=D.create("PointList");c.addGeometry(ae,t[x]);ae.getAttribute("vertices").setValue(b)}}var T=[];for(var x=0;x<t.length;x++){if(!z[x]){continue}var S=ac.getSurface(ac.tags[x]);if(!S){continue}var R=S.smoothingAngle;if(R<=0){continue}var y=Math.cos(R);T.length=V[x].length;for(var aa=0;aa<T.length;aa++){T[aa]=new Vector3D()}for(var m=0;m<V[x].length;m++){var P=V[x][m].first;var k=V[x][m].second;for(var J=0;J<N[P].length;J++){var F=N[P][J];var o=cosineAngleBetween(k,F);if(Math.acos(o)<=R){T[m].x+=F.x;T[m].y+=F.y;T[m].z+=F.z}}T[m].normalize()}var Z=[];for(var aa=0;aa<T.length;aa++){Z.push(T[aa].x);Z.push(T[aa].y);Z.push(T[aa].z)}T.length=0;z[x].getAttribute("normals").setValue(Z)}for(var x=0;x<t.length;x++){var E=ac.getSurface(t[x].getAttribute("name").getValueDirect().join(""));if(E){var j=this.loadTextures(ac,d,E,t[x]);for(var aa=0;aa<j.length;aa++){var h=this.calculateTextureCoords(ac,d,j[aa].second,I[x],ab[x],U[x],G[x]);if(h){z[x].getUVCoords(j[aa].first).setValueDirect(h)}}}}};LWObjectBuilder.prototype.allocateSurface=function(e,d,b){var a=this.registry.find("AttributeFactory");surface=a.create("Surface");var c=e.tags[b];surface.getAttribute("name").setValueDirect(c);this.describeSurface(e.getSurface(c),surface);return surface};LWObjectBuilder.prototype.describeSurface=function(c,a){if(!c){return}var b=[];b.push(c.color.x);b.push(c.color.y);b.push(c.color.z);b.push(1);a.getAttribute("color").setValue(b);a.getAttribute("ambientLevel").setValueDirect(c.diffuseLevel);a.getAttribute("diffuseLevel").setValueDirect(c.diffuseLevel);a.getAttribute("specularLevel").setValueDirect(c.specularLevel);a.getAttribute("emissiveLevel").setValueDirect(c.luminosityLevel);a.getAttribute("glossiness").setValueDirect(c.glossiness);a.getAttribute("opacity").setValueDirect(1-c.transparencyLevel);a.getAttribute("doubleSided").setValueDirect(c.doubleSided?true:false)};LWObjectBuilder.prototype.loadTextures=function(g,e,f,b){var a=[];var c=[];for(var d=0;d<f.blocks.length;d++){var h=f.blocks[d];if(h.type!="IMAP"){continue}if(!c[h.channel]){c[h.channel]=[]}c[h.channel].push(h)}if(c[eLWObjectTokens.COLR]){this.allocateTextures(eTextureType.Color,g,e,c[eLWObjectTokens.COLR],b,a)}if(c[eLWObjectTokens.DIFF]){this.allocateTextures(eTextureType.Diffuse,g,e,c[eLWObjectTokens.DIFF],b,a)}if(c[eLWObjectTokens.LUMI]){this.allocateTextures(eTextureType.Luminosity,g,e,c[eLWObjectTokens.LUMI],b,a)}if(c[eLWObjectTokens.SPEC]){this.allocateTextures(eTextureType.Specular,g,e,c[eLWObjectTokens.SPEC],b,a)}if(c[eLWObjectTokens.TRAN]){this.allocateTextures(eTextureType.Transparency,g,e,c[eLWObjectTokens.TRAN],b,a)}return a};LWObjectBuilder.prototype.allocateTextures=function(b,t,s,r,n,a){for(var p=0;p<r.length;p++){var h=r[p];if(h.opacityType!=0&&h.opacityType!=7){continue}var m=t.clips[h.imageIndex];if(!m){continue}var j=null;if(p+1<r.length){if(r[p+1].opacityType==5){j=t.clips[r[p+1].imageIndex]}}var e,g;switch(h.widthWrap){case 0:e=eTextureWrap.None;break;case 1:e=eTextureWrap.Repeat;break;case 2:e=eTextureWrap.Mirror;break;case 3:e=eTextureWrap.Clamp;break}switch(h.heightWrap){case 0:g=eTextureWrap.None;break;case 1:g=eTextureWrap.Repeat;break;case 2:g=eTextureWrap.Mirror;break;case 3:g=eTextureWrap.Clamp;break}var o=m.getFilename();var f=o.lastIndexOf("/");o=f===-1?o:o.substring(f+1);var q=t.contentDir+"images/"+o;var k=h.negative?true:false;if(this.invertAlpha&&(b==eTextureType.Transparency||b==eTextureType.Diffuse||b==eTextureType.Luminosity||b==eTextureType.Specularity)){k=!k}var c=false;if(j){c=r[p+1].negative?true:false;if(this.invertAlpha){c=!c}}var l=null;var d=this.registry.find("AttributeFactory");l=d.create("MediaTexture");l.getAttribute("name").setValueDirect("");l.getAttribute("textureType").setValueDirect(b);l.getAttribute("opacity").setValueDirect(h.opacity);l.getAttribute("widthWrap").setValueDirect(e);l.getAttribute("heightWrap").setValueDirect(g);l.getAttribute("mipmappingEnabled").setValueDirect(false);l.getAttribute("imageFilename").setValueDirect(q);l.getAttribute("negateImage").setValueDirect(k);l.getAttribute("negateAlpha").setValueDirect(c);if(j){l.getAttribute("alphaFilename").setValueDirect(t.contentDir+j.getFilename())}a.push(new Pair(l,h));n.addTexture(l)}};LWObjectBuilder.prototype.calculateTextureCoords=function(t,s,l,c,r,f,j){if(!t||!s||!l||!c||!r||!f||!j){return null}var h=[];var m=c.length/3;switch(l.projMode){case 0:case 1:case 2:var p,q,d;for(p=0,q=0,d=0;p<m;p++,q+=3,d+=2){d=this.mapXYZtoUV(c[q],c[q+1],c[q+2],l.center,l.size,l.projMode,l.axis,l.widthWrapAmt,l.heightWrapAmt);h.push(d.u);h.push(d.v)}break;case 3:var p,q,d;for(p=0,q=0,d=0;p<m;p++,q+=3,d+=2){polyNormal=r[p];if(Math.acos(cosineAngleBetween(polyNormal,new Vector3D(1,0,0)))<=QUARTERPI||Math.acos(cosineAngleBetween(polyNormal,new Vector3D(-1,0,0)))<=QUARTERPI){axis=0}else{if(Math.acos(cosineAngleBetween(polyNormal,new Vector3D(0,1,0)))<=QUARTERPI||Math.acos(cosineAngleBetween(polyNormal,new Vector3D(0,-1,0)))<=QUARTERPI){axis=1}else{axis=2}}d=this.mapXYZtoUV(c[q],c[q+1],c[q+2],l.center,l.size,0,axis,l.widthWrapAmt,l.heightWrapAmt);h.push(d.u);h.push(d.v)}break;case 5:var g=s.getVmap("TXUV",l.uvMapName);var n=s.getVmad("TXUV",l.uvMapName);var p,b,o,d,k;for(p=0,d=0;p<m;p++,d+=2){b=f[p];o=j[p];k=false;if(n&&n.length){for(var e=0;e<n.length;e++){if(n[e].poly>o){break}if(n[e].poly==o){if(n[e].vertex==b){h[d]=n[e].u;h[d+1]=n[e].v;k=true;break}}}if(k){continue}}if(g&&g.length){for(var a=0;a<g.length;a++){if(g[a].vertex>b){break}if(g[a].vertex==b){h[d]=g[a].u;h[d+1]=g[a].v;k=true;break}}}if(!k){h[d]=0;h[d+1]=0}}break;default:break}return h};LWObjectBuilder.prototype.mapXYZtoUV=function(l,k,j,p,c,g,f,d,b){var a,h;var e;var n=0;var m=0;switch(g){case 0:switch(f){case 0:n=(j-p.z)/c.z+0.5;m=(k-p.y)/c.y+0.5;break;case 1:n=(l-p.x)/c.x+0.5;m=(j-p.z)/c.z+0.5;break;case 2:default:n=(l-p.x)/c.x+0.5;m=(k-p.y)/c.y+0.5;break}break;case 1:l-=p.x;k-=p.y;j-=p.z;switch(f){case 0:a=XYZtoH(j,l,k);n=a/(TWOPI*d);m=l/c.x+0.5;break;case 1:a=XYZtoH(l,k,j);n=a/(TWOPI*d);m=k/c.y+0.5;break;case 2:default:a=XYZtoH(-l,j,-k);n=a/(TWOPI*d);m=-j/c.z+0.5;break}n=modf(n).fractionalPart;if(n<0){n+=1}break;case 2:l-=p.x;k-=p.y;j-=p.z;switch(f){case 0:var o=XYZtoHP(j,l,-k);a=o.heading;h=o.pitch;break;case 1:var o=XYZtoHP(-l,k,j);a=o.heading;h=o.pitch;break;case 2:default:var o=XYZtoHP(-l,j,-k);a=o.heading;h=o.pitch;break}n=modf(1-(a/TWOPI*d)).fractionalPart;m=1-modf(0.5-(h/Math.PI*b)).fractionalPart;break}return{u:n,v:m}};function LWObjectBuilder_ObjectHandler(b,a){a.allocateModel(b)}function LWObjectBuilder_CompareVmapEntries(b,a){if(b.vertex<a.vertex){return -1}if(b.vertex>a.vertex){return 1}return 0}function LWObjectBuilder_CompareVmadEntries(b,a){if(b.poly<a.poly){return -1}if(b.poly>a.poly){return 1}return 0}LWSceneHandler.prototype=new ContentHandler();LWSceneHandler.prototype.constructor=LWSceneHandler;function LWSceneHandler(){ContentHandler.call(this);this.className="LWSceneHandler";this.tokenHandlers=[];this.tokenHandlersData=[]}LWSceneHandler.prototype.addTokenHandler=function(a,b){this.tokenHandlers.push(a);this.tokenHandlersData.push(b)};LWSceneHandler.prototype.parseFileStream=function(c){var b=formFullPath(c,this.contentDirectory.getValueDirect().join(""));var a=loadTextResource(b);if(a==null){return -2}var f=new TextParser(a);var e;while(e=f.readLineTokens()){for(var d=0;d<this.tokenHandlers.length;d++){this.tokenHandlers[d](e,this.tokenHandlersData[d])}}};LWSceneBuilder.prototype=new ContentBuilder();LWSceneBuilder.prototype.constructor=LWSceneBuilder;function LWSceneBuilder(){ContentBuilder.call(this);this.className="LWSceneBuilder";this.graphMgr=null;this.currChannel=0;this.indexGeometry=new BooleanAttr(true);this.registerAttribute(this.indexGeometry,"indexGeometry")}LWSceneBuilder.prototype.visitHandler=function(a){a.addTokenHandler(LWSceneBuilder_TokenHandler,this)};LWSceneBuilder.prototype.finalize=function(){};LWSceneBuilder.prototype.matchesType=function(a){return(a=="lws"||a=="mot")};LWSceneBuilder.prototype.allocateSceneElement=function(tokens){switch(tokens[0]){case"LoadObjectLayer":break;case"NumChannels":var numChannels=parseInt(tokens[1],10);var eval=this.evaluators[this.evaluators.length-1];eval.setNumChannels(numChannels);switch(numChannels){case 1:this.attachDissolveInterpolator(this.evaluators[this.evaluators.length-1],this.registry.find(this.evaluators[this.evaluators.length-1].getAttribute("target").getValueDirect().join("")));break;default:this.attachKeyframeInterpolator(this.evaluators[this.evaluators.length-1],this.registry.find(this.evaluators[this.evaluators.length-1].getAttribute("target").getValueDirect().join("")));break}break;case"Channel":this.currChannel=parseInt(tokens[1],10);break;case"Key":if(this.evaluators.length<=0){break}var keyframes=this.evaluators[this.evaluators.length-1].getAttribute("channels").getAt(this.currChannel);if(!keyframes){break}var keyframe=new KeyframeAttr();for(var i=1;i<tokens.length;i++){switch(i){case 1:var f=parseFloat(tokens[i]);if(this.currChannel==3||this.currChannel==4||this.currChannel==5){f=toDegrees(f)}keyframe.getAttribute("value").setValueDirect(f);break;case 2:keyframe.getAttribute("time").setValueDirect(parseFloat(tokens[i]));break;case 3:var shape=parseInt(tokens[i]);switch(shape){case 0:keyframe.getAttribute("shape").setValueDirect(eKeyframeShape.TCB);break;case 1:break;case 2:keyframe.getAttribute("shape").setValueDirect(eKeyframeShape.Bezier1D);break;case 3:keyframe.getAttribute("shape").setValueDirect(eKeyframeShape.Linear);break;case 4:keyframe.getAttribute("shape").setValueDirect(eKeyframeShape.Stepped);break;case 5:keyframe.getAttribute("shape").setValueDirect(eKeyframeShape.Bezier2D);break;default:keyframe.getAttribute("shape").setValueDirect(eKeyframeShape.Linear);break}break;case 4:case 5:case 6:case 7:case 8:case 9:keyframe.getAttribute("params").getAt(i-3-1).setValueDirect(parseFloat(tokens[i]));break;default:break}}keyframes.push_back(keyframe);break;case"Behaviors":if(this.evaluators.length<=0){break}var preBehaviors=this.evaluators[this.evaluators.length-1].getAttribute("preBehaviors").getAt(this.currChannel);var postBehaviors=this.evaluators[this.evaluators.length-1].getAttribute("postBehaviors").getAt(this.currChannel);if(!preBehaviors||!postBehaviors){break}var pre=parseInt(tokens[1],10);var post=parseInt(tokens[2],10);preBehaviors.setValueDirect(pre);postBehaviors.setValueDirect(post);break}};LWSceneBuilder.prototype.attachKeyframeInterpolator=function(a,e){if(!a||!e){return}var c=a.getAttribute("channels").vector.length;for(var d=0;d<c;d++){var b=a.getAttribute("resultValues").getAt(d);switch(d){case 0:b.addElementTarget(e.getAttribute("position"),0,0);break;case 1:b.addElementTarget(e.getAttribute("position"),0,1);break;case 2:b.addElementTarget(e.getAttribute("position"),0,2);break;case 3:b.addElementTarget(e.getAttribute("rotation"),0,1);break;case 4:b.addElementTarget(e.getAttribute("rotation"),0,0);break;case 5:b.addElementTarget(e.getAttribute("rotation"),0,2);break;case 6:b.addElementTarget(e.getAttribute("scale"),0,0);break;case 7:b.addElementTarget(e.getAttribute("scale"),0,1);break;case 8:b.addElementTarget(e.getAttribute("scale"),0,2);break}}a.getAttribute("time").setValueDirect(0)};LWSceneBuilder.prototype.attachDissolveInterpolator=function(a,c){if(!a||!c){return}var b=a.getAttribute("resultValues").getAt(0);b.addElementTarget(c.getAttribute("dissolve"),0,0)};function LWSceneBuilder_TokenHandler(b,a){a.allocateSceneElement(b)}AttributeFactory.prototype=new AttributeContainer();AttributeFactory.prototype.constructor=AttributeFactory;function AttributeFactory(){AttributeContainer.call(this);this.className="AttributeFactory";this.attrType=eAttrType.AttributeFactory;this.newResourceProcs=[];this.configureProcs=[];this.finalizeProcs=[];this.registry=null;this.graphMgr=null;this.name=new StringAttr("AttributeFactory");this.registerAttribute(this.name,"name");this.initializeNewResourceMap();this.initializeConfigureMap();this.initializeFinalizeMap()}AttributeFactory.prototype.create=function(a){var c=null;var d=this.newResourceProcs[a];if(d){c=d(a,this)}if(!c){return null}var b=this.configureProcs[a];if(b){b(c,this)}if(c.isContainer()){if(!c.getAttribute("name")){c.registerAttribute(new StringAttr(""),"name")}if(!c.getAttribute("userData")){c.registerAttribute(new StringAttr(""),"userData")}}if(this.registry){this.registry.register(c);c.setRegistry(this.registry)}return c};AttributeFactory.prototype.finalize=function(a,c){var b=this.finalizeProcs[a];if(b){b(c,this)}};AttributeFactory.prototype.initializeNewResourceMap=function(){this.newResourceProcs.Styles=newAttribute;this.newResourceProcs.StyleMap=newAttribute;this.newResourceProcs.StylesMap=newAttribute;this.newResourceProcs.LabelStyle=newAttribute;this.newResourceProcs.IconStyle=newAttribute;this.newResourceProcs.FontStyle=newAttribute;this.newResourceProcs.HTMLLabelStyle=newAttribute;this.newResourceProcs.BalloonTipLabelStyle=newAttribute;this.newResourceProcs.RenderableElementStyle=newAttribute;this.newResourceProcs.DirectionalLight=newSGNode;this.newResourceProcs.GlobalIllumination=newSGNode;this.newResourceProcs.Group=newSGNode;this.newResourceProcs.Isolator=newSGNode;this.newResourceProcs.Label=newSGNode;this.newResourceProcs.HTMLLabel=newSGNode;this.newResourceProcs.BalloonTipLabel=newSGNode;this.newResourceProcs.LineList=newSGNode;this.newResourceProcs.MediaTexture=newSGNode;this.newResourceProcs.Model=newModel;this.newResourceProcs.OrthographicCamera=newSGNode;this.newResourceProcs.PerspectiveCamera=newSGNode;this.newResourceProcs.PointLight=newSGNode;this.newResourceProcs.PointList=newSGNode;this.newResourceProcs.QuaternionRotate=newSGNode;this.newResourceProcs.Rotate=newSGNode;this.newResourceProcs.Scale=newSGNode;this.newResourceProcs.Surface=newSGNode;this.newResourceProcs.Translate=newSGNode;this.newResourceProcs.TriList=newSGNode;this.newResourceProcs.NullObject=newSGNode;this.newResourceProcs.BBoxDirective=newSGDirective;this.newResourceProcs.RayPickDirective=newSGDirective;this.newResourceProcs.RenderDirective=newSGDirective;this.newResourceProcs.SerializeDirective=newSGDirective;this.newResourceProcs.UpdateDirective=newSGDirective;this.newResourceProcs.BBoxLocator=newBBoxLocator;this.newResourceProcs.KeyframeInterpolator=newKeyframeInterpolator;this.newResourceProcs.MapProjectionCalculator=newMapProjectionCalculator;this.newResourceProcs.ObjectInspector=newObjectInspector;this.newResourceProcs.SceneInspector=newSceneInspector;this.newResourceProcs.AppendNode=newCommand;this.newResourceProcs.AutoInterpolate=newCommand;this.newResourceProcs.CommandSequence=newCommand;this.newResourceProcs.ConnectAttributes=newCommand;this.newResourceProcs.ConnectOutputs=newCommand;this.newResourceProcs.DisconnectAttributes=newCommand;this.newResourceProcs.DisconnectOutputs=newCommand;this.newResourceProcs.Locate=newCommand;this.newResourceProcs.MotionInterpolate=newCommand;this.newResourceProcs.Pause=newCommand;this.newResourceProcs.Play=newCommand;this.newResourceProcs.Remove=newCommand;this.newResourceProcs.Serialize=newCommand;this.newResourceProcs.Set=newCommand;this.newResourceProcs.Stop=newCommand;this.newResourceProcs.MouseHandler=newDeviceHandler};AttributeFactory.prototype.initializeConfigureMap=function(){this.configureProcs.Model=configureModel;this.configureProcs.BBoxDirective=configureDirective;this.configureProcs.RayPickDirective=configureDirective;this.configureProcs.RenderDirective=configureDirective;this.configureProcs.SerializeDirective=configureDirective;this.configureProcs.UpdateDirective=configureDirective};AttributeFactory.prototype.initializeFinalizeMap=function(){this.finalizeProcs.Model=finalizeModel;this.finalizeProcs.BBoxDirective=finalizeDirective;this.finalizeProcs.RayPickDirective=finalizeDirective;this.finalizeProcs.RenderDirective=finalizeDirective;this.finalizeProcs.SerializeDirective=finalizeDirective;this.finalizeProcs.UpdateDirective=finalizeDirective;this.finalizeProcs.KeyframeInterpolator=finalizeEvaluator;this.finalizeProcs.AppendNode=finalizeCommand;this.finalizeProcs.AutoInterpolate=finalizeCommand;this.finalizeProcs.CommandSequence=finalizeCommand;this.finalizeProcs.ConnectAttributes=finalizeCommand;this.finalizeProcs.ConnectOutputs=finalizeCommand;this.finalizeProcs.DisconnectAttributes=finalizeCommand;this.finalizeProcs.DisconnectOutputs=finalizeCommand;this.finalizeProcs.Locate=finalizeCommand;this.finalizeProcs.MotionInterpolate=finalizeCommand;this.finalizeProcs.Pause=finalizeCommand;this.finalizeProcs.Play=finalizeCommand;this.finalizeProcs.Remove=finalizeCommand;this.finalizeProcs.Serialize=finalizeCommand;this.finalizeProcs.Set=finalizeCommand;this.finalizeProcs.Stop=finalizeCommand;this.finalizeProcs.MouseHandler=finalizeDeviceHandler};AttributeFactory.prototype.setRegistry=function(a){this.registry=a};AttributeFactory.prototype.setGraphMgr=function(a){this.graphMgr=a};function newAttribute(b,a){var c=null;switch(b){case"Styles":c=new StylesAttr();break;case"StyleMap":c=new StyleMapAttr();break;case"StylesMap":c=new StylesMapAttr();break;case"LabelStyle":c=new LabelStyleAttr();break;case"IconStyle":c=new IconStyleAttr();break;case"FontStyle":c=new FontStyleAttr();break;case"HTMLLabelStyle":c=new HTMLLabelStyleAttr();break;case"BalloonTipLabelStyle":c=new BalloonTipLabelStyleAttr();break;case"RenderableElementStyle":c=new RenderableElementStyleAttr();break}return c}function newSGNode(b,a){var c=null;switch(b){case"DirectionalLight":c=new DirectionalLight();registerParentableAttributes(c,a);break;case"GlobalIllumination":c=new GlobalIllumination();break;case"Group":c=new Group();break;case"Isolator":c=new Isolator();break;case"Label":c=new Label();break;case"HTMLLabel":c=new HTMLLabel();break;case"BalloonTipLabel":c=new BalloonTipLabel();break;case"LineList":c=new LineList();break;case"MediaTexture":c=new MediaTexture();break;case"OrthographicCamera":c=new OrthographicCamera();registerParentableAttributes(c,a);break;case"PerspectiveCamera":c=new PerspectiveCamera();registerParentableAttributes(c,a);break;case"PointLight":c=new PointLight();registerParentableAttributes(c,a);break;case"PointList":c=new PointList();break;case"QuaternionRotate":c=new QuaternionRotate();break;case"Rotate":c=new Rotate();break;case"Scale":c=new Scale();break;case"Surface":c=new Surface();break;case"Transform":c=new Transform();break;case"Translate":c=new Translate();break;case"TriList":c=new TriList();break;case"NullObject":c=new NullObject();registerParentableAttributes(c,a);break}if(c){c.setGraphMgr(a.graphMgr)}return c}function newSGDirective(b,a){var c=null;switch(b){case"BBoxDirective":c=new BBoxDirective();break;case"RayPickDirective":c=new RayPickDirective();break;case"RenderDirective":c=new RenderDirective();break;case"SerializeDirective":c=new SerializeDirective();break;case"UpdateDirective":c=new UpdateDirective();break}if(c){c.setGraphMgr(a.graphMgr)}return c}function newModel(b,a){var c=new Model();c.setGraphMgr(a.graphMgr);registerParentableAttributes(c,a);return c}function newBBoxLocator(b,a){var c=new BBoxLocator();registerEvaluatorAttributes(c,a);return c}function newKeyframeInterpolator(b,a){var c=new KeyframeInterpolator();registerEvaluatorAttributes(c,a);return c}function newMapProjectionCalculator(b,a){var c=new MapProjectionCalculator();registerEvaluatorAttributes(c,a);return c}function newObjectInspector(c,b){var d=new ObjectInspector();registerEvaluatorAttributes(d,b);var a=b.registry.find("Selector");if(a){a.getAttribute("selectionOccurred").addTarget(d.getAttribute("selectionOccurred"),eAttrSetOp.Replace,null,false);a.getAttribute("selectionCleared").addTarget(d.getAttribute("selectionCleared"),eAttrSetOp.Replace,null,false)}return d}function newSceneInspector(c,b){var d=new BwSceneInspector();registerEvaluatorAttributes(d,b);var a=b.registry.find("Selector");if(a){a.getAttribute("selectionOccurred").addTarget(d.getAttribute("selectionOccurred"),eAttrSetOp.Replace,null,false);a.getAttribute("distanceFromScreenCenter").addTarget(d.getAttribute("pivotDistance"),eAttrSetOp.Replace,null,false)}return d}function newCommand(c,b){var d=null;switch(c){case"AppendNode":d=new AppendNodeCommand();break;case"AutoInterpolate":d=new AutoInterpolateCommand();break;case"CommandSequence":d=new CommandSequence();break;case"ConnectAttributes":d=new ConnectAttributesCommand();break;case"ConnectOutputs":d=new ConnectAttributesCommand();break;case"DisconnectAttributes":d=new ConnectAttributesCommand();d.getAttribute("negate").setValueDirect(true);break;case"DisconnectOutputs":d=new ConnectAttributesCommand();d.getAttribute("negate").setValueDirect(true);break;case"Locate":d=new LocateCommand();break;case"MotionInterpolate":d=new MotionInterpolateCommand();break;case"Pause":d=new PlayCommand();d.getAttribute("negate").setValueDirect(true);break;case"Play":d=new PlayCommand();break;case"Remove":d=new RemoveCommand();break;case"Serialize":d=new SerializeCommand();break;case"Set":d=new SetCommand();break;case"Stop":d=new StopCommand();break}if(c=="CommandSequence"){var a=b.registry.find("CommandMgr");if(a){a.pushCommandSequence(d)}}return d}function newDeviceHandler(b,a){var c=null;switch(b){case"MouseHandler":c=new MouseHandler();break}return c}function configureModel(b,a){console.debug("TODO: "+arguments.callee.name)}function configureDirective(d,c){var a=new StringAttr("");a.addModifiedCB(AttributeFactory_DirectiveRootModifiedCB,c);d.registerAttribute(a,"root");var b=c.registry.getAttribute("rootPtr").getValueDirect();if(b){a.setValueDirect(b.getAttribute("name").getValueDirect().join(""))}}function finalizeModel(c,a){console.debug("TODO: remove LWO assumption");var b=c.getAttribute("url").getValueDirect();if(b){b=b.join("");var f=formatPath(b);console.debug("path: "+f[0]);console.debug("content dir: "+f[1]);var e=new LWObjectHandler();e.getAttribute("contentDirectory").setValueDirect(f[1]);var d=new LWObjectBuilder();d.setRegistry(a.registry);d.models.push(c);d.layer=c.getAttribute("layer").getValueDirect();d.visitHandler(e);e.parseFileStream(f[0])}addInspectionGroup(c,a)}function finalizeDirective(b,a){}function finalizeCommand(c,b){var a=b.registry.find("CommandMgr");if(a){if(c.className=="CommandSequence"){a.popCommandSequence()}a.addCommand(c)}}function finalizeDeviceHandler(d,a){var e=a.registry.find("EventMgr");if(e){var c=d.getEventTypes();for(var b=0;b<c.length;b++){e.addListener(c[b],d)}}}function finalizeEvaluator(f,a){console.debug("TODO: "+arguments.callee.name);switch(f.className){case"KeyframeInterpolator":var b=f.getAttribute("url").getValueDirect();if(b){b=b.join("");var e=formatPath(b);var d=new LWSceneHandler();d.getAttribute("contentDirectory").setValueDirect(e[1]);var c=new LWSceneBuilder();c.setRegistry(a.registry);c.evaluators.push(f);c.visitHandler(d);d.parseFileStream(e[0])}AttributeFactory_EvaluatorTargetConnectionTypeModifiedCB(f.getAttribute("targetConnectionType"),a);break}}function registerEvaluatorAttributes(f,b){var c=new StringAttr("");f.registerAttribute(c,"url");var e=new StringAttr("");f.registerAttribute(e,"target");var d=new BooleanAttr(false);f.registerAttribute(d,"renderAndRelease");var a=new StringAttr("transform");a.addModifiedCB(AttributeFactory_EvaluatorTargetConnectionTypeModifiedCB,b);f.registerAttribute(a,"targetConnectionType")}function registerParentableAttributes(f,b){var c=new StringAttr("");f.registerAttribute(c,"label");c.addModifiedCB(AttributeFactory_ParentableLabelModifiedCB,b);var e=new Vector3DAttr();f.registerAttribute(e,"geoPosition");e.addModifiedCB(AttributeFactory_ParentableGeoPositionModifiedCB,b);var a=new NumberAttr();f.registerAttribute(a,"altitude");var g=new NumberAttr();f.registerAttribute(g,"latitude");var d=new NumberAttr();f.registerAttribute(d,"longitude");f.getAttribute("worldCenter").addModifiedCB(AttributeFactory_ParentableWorldPositionModifiedCB,b)}function getSceneGraph(){return this.sceneGraph}function AttributeFactory_DirectiveRootModifiedCB(a,b){var d=a.getContainer();var c=b.registry.getByName(a.getValueDirect().join(""));if(c){d.getAttribute("rootNode").setValueDirect(c[0])}}function AttributeFactory_ParentableLabelModifiedCB(b,a){console.debug("TODO: "+arguments.callee.name)}function AttributeFactory_ParentableGeoPositionModifiedCB(e,c){var g=e.getContainer();if(g){var d=c.registry.getByName("ConnectionMgr");if(d&&d.length){var b=d[0];var a=c.registry.getByType(eAttrType.MapProjectionCalculator);if(a&&a.length){var f=a[0];f.getAttribute("geoPosition").copyValue(e);b.connectMapProjectionCalculator(f,g);b.disconnectMapProjectionCalculator(f,g)}}}}function AttributeFactory_ParentableWorldPositionModifiedCB(b,a){}function AttributeFactory_EvaluatorTargetConnectionTypeModifiedCB(c,a){var d=c.getContainer();if(d){var b=new ConnectAttributesCommand();b.setRegistry(a.registry);b.getAttribute("sourceContainer").copyValue(d.getAttribute("name"));b.getAttribute("targetContainer").copyValue(d.getAttribute("target"));b.getAttribute("connectionType").copyValue(c);b.execute()}}Bridgeworks.prototype=new AttributeContainer();Bridgeworks.prototype.constructor=Bridgeworks;function Bridgeworks(b,a,c){AttributeContainer.call(this);this.className="Bridgeworks";this.renderContext=newRenderContext("webgl",b,a);if(!this.renderContext){return}c=c==null?"BwContent":c;this.canvas=b;this.contentDir=c;this.graphMgr=new GraphMgr();this.graphMgr.setRenderContext(this.renderContext);this.styleMgr=new StyleMgr();this.registry=new BwRegistry();this.factory=new AttributeFactory();this.parser=new XMLParser(this.factory,this.registry,this.contentDir);this.eventAdapter=new EventAdapter();this.eventMgr=new EventMgr();this.commandMgr=new CommandMgr();this.connectionMgr=new ConnectionMgr();this.viewportMgr=new ViewportMgr();this.selector=new SelectionListener();this.rayPick=new RayPickDirective();this.renderAgent=new RenderAgent(this);this.renderController=new RenderController(this);this.layout=new GridLayout();this.mapProjectionCalculator=new MapProjectionCalculator();this.rasterComponentEventListener=new RasterComponentEventListener();this.graphMgr.setRegistry(this.registry);this.factory.setRegistry(this.registry);this.eventAdapter.setRegistry(this.registry);this.eventMgr.setRegistry(this.registry);this.commandMgr.setRegistry(this.registry);this.connectionMgr.setRegistry(this.registry);this.viewportMgr.setRegistry(this.registry);this.selector.setRegistry(this.registry);this.renderAgent.setRegistry(this.registry);this.layout.setRegistry(this.registry);this.factory.setGraphMgr(this.graphMgr);this.selector.setRayPick(this.rayPick);this.rasterComponentEventListener.setStyleMgr(this.styleMgr);this.rasterComponents=null;this.name=new StringAttr("Bridgeworks");this.onLoad=new StringAttr();this.onLoad.addModifiedCB(Bridgeworks_OnLoadModifiedCB,this);this.registerAttribute(this.name,"name");this.registerAttribute(this.onLoad,"onLoad");this.viewportMgr.getAttribute("width").setValueDirect(this.canvas.width);this.viewportMgr.getAttribute("height").setValueDirect(this.canvas.height);this.viewportMgr.getAttribute("layout").setValueDirect(this.layout);enumerateAttributeTypes();enumerateAttributeElementTypes();console.debug("TODO: "+arguments.callee.name);this.initRegistry();this.initEventListeners();this.viewportMgr.initLayout()}Bridgeworks.prototype.handleEvent=function(b){var c=null;switch(getObjectClassName(b)){case"MouseEvent":var a=getElementAbsolutePos(this.canvas);b.canvasX=b.clientX-a.x;b.canvasY=b.clientY-a.y;c=this.eventAdapter.createMouseEvent(b);break;case"KeyboardEvent":c=this.eventAdapter.createKeyboardEvent(b);break}if(c){this.eventMgr.processEvent(c)}};Bridgeworks.prototype.initRegistry=function(){this.registry.register(this);this.registry.register(this.graphMgr);this.registry.register(this.factory);this.registry.register(this.eventAdapter);this.registry.register(this.eventMgr);this.registry.register(this.commandMgr);this.registry.register(this.connectionMgr);this.registry.register(this.viewportMgr);this.registry.register(this.selector);this.registry.register(this.renderAgent);this.registry.register(this.layout);this.registry.register(this.mapProjectionCalculator);this.registry.registerByName(this.renderAgent,"AnimationAgent")};Bridgeworks.prototype.initEventListeners=function(){this.eventMgr.addListener(eEventType.MouseLeftDown,this.selector);this.eventMgr.addListener(eEventType.MouseMiddleDown,this.selector);this.eventMgr.addListener(eEventType.MouseRightDown,this.selector);this.eventMgr.addListener(eEventType.MouseBothDown,this.selector);this.eventMgr.addListener(eEventType.MouseHover,this.selector);this.eventMgr.addListener(eEventType.MouseLeftDown,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseLeftUp,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseLeftClick,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseLeftDblClick,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseMiddleDown,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseMiddleUp,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseMiddleClick,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseMiddleDblClick,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseRightDown,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseRightUp,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseRightClick,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseRightDblClick,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseWheelDown,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseWheelUp,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseBothDown,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseHover,this.rasterComponentEventListener);this.eventMgr.addListener(eEventType.MouseMove,this.rasterComponentEventListener)};Bridgeworks.prototype.onLoadModified=function(){this.renderAgent.stop();this.selector.stop();this.rasterComponentEventListener.stop();this.commandMgr.clearCommandSequence();this.eventMgr.clearEvents();this.selector.clearSelections();this.selector.getAttribute("lastSelectedName").setValueDirect("");this.viewportMgr.initLayout();this.registry.clear();this.initEventListeners();this.initRegistry();this.renderAgent.getAttribute("globalTimeInSecs").setValueDirect(0);this.graphMgr.reset();this.renderAgent.start();this.selector.start();this.rasterComponentEventListener.start();console.debug("TODO: "+arguments.callee.name)};Bridgeworks.prototype.resize=function(b,a){this.canvas.width=b;this.canvas.height=a;this.renderContext.setViewport(this.canvas.offsetLeft,this.canvas.offsetTop,b,a);this.viewportMgr.getAttribute("width").setValueDirect(b);this.viewportMgr.getAttribute("height").setValueDirect(a)};Bridgeworks.prototype.render=function(){this.renderContext.clear();this.renderAgent.render()};Bridgeworks.prototype.setRenderContext=function(a){this.renderContext=a;this.graphMgr.setRenderContext(a)};Bridgeworks.prototype.updateScene=function(a){var b=new String(a);var c=b.substr(b.length-3,3);if(c=="xml"){a=loadXMLResource(this.contentDir+"/"+a)}this.parser.parse(a)};function Bridgeworks_OnLoadModifiedCB(b,a){a.onLoadModified()}(function(){var W=this,ab,F=W.jQuery,S=W.$,T=W.jQuery=W.$=function(b,a){return new T.fn.init(b,a)},M=/^[^<]*(<(.|\s)+>)[^>]*$|^#([\w-]+)$/,ac=/^.[^:#\[\.,]*$/;T.fn=T.prototype={init:function(e,b){e=e||document;if(e.nodeType){this[0]=e;this.length=1;this.context=e;return this}if(typeof e==="string"){var c=M.exec(e);if(c&&(c[1]||!b)){if(c[1]){e=T.clean([c[1]],b)}else{var a=document.getElementById(c[3]);if(a&&a.id!=c[3]){return T().find(e)}var d=T(a||[]);d.context=document;d.selector=e;return d}}else{return T(b).find(e)}}else{if(T.isFunction(e)){return T(document).ready(e)}}if(e.selector&&e.context){this.selector=e.selector;this.context=e.context}return this.setArray(T.isArray(e)?e:T.makeArray(e))},selector:"",jquery:"1.3.2",size:function(){return this.length},get:function(a){return a===ab?Array.prototype.slice.call(this):this[a]},pushStack:function(c,a,d){var b=T(c);b.prevObject=this;b.context=this.context;if(a==="find"){b.selector=this.selector+(this.selector?" ":"")+d}else{if(a){b.selector=this.selector+"."+a+"("+d+")"}}return b},setArray:function(a){this.length=0;Array.prototype.push.apply(this,a);return this},each:function(a,b){return T.each(this,a,b)},index:function(a){return T.inArray(a&&a.jquery?a[0]:a,this)},attr:function(c,a,b){var d=c;if(typeof c==="string"){if(a===ab){return this[0]&&T[b||"attr"](this[0],c)}else{d={};d[c]=a}}return this.each(function(e){for(c in d){T.attr(b?this.style:this,c,T.prop(this,d[c],b,e,c))}})},css:function(b,a){if((b=="width"||b=="height")&&parseFloat(a)<0){a=ab}return this.attr(b,a,"curCSS")},text:function(a){if(typeof a!=="object"&&a!=null){return this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(a))}var b="";T.each(a||this,function(){T.each(this.childNodes,function(){if(this.nodeType!=8){b+=this.nodeType!=1?this.nodeValue:T.fn.text([this])}})});return b},wrapAll:function(b){if(this[0]){var a=T(b,this[0].ownerDocument).clone();if(this[0].parentNode){a.insertBefore(this[0])}a.map(function(){var c=this;while(c.firstChild){c=c.firstChild}return c}).append(this)}return this},wrapInner:function(a){return this.each(function(){T(this).contents().wrapAll(a)})},wrap:function(a){return this.each(function(){T(this).wrapAll(a)})},append:function(){return this.domManip(arguments,true,function(a){if(this.nodeType==1){this.appendChild(a)}})},prepend:function(){return this.domManip(arguments,true,function(a){if(this.nodeType==1){this.insertBefore(a,this.firstChild)}})},before:function(){return this.domManip(arguments,false,function(a){this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,false,function(a){this.parentNode.insertBefore(a,this.nextSibling)})},end:function(){return this.prevObject||T([])},push:[].push,sort:[].sort,splice:[].splice,find:function(b){if(this.length===1){var a=this.pushStack([],"find",b);a.length=0;T.find(b,this[0],a);return a}else{return this.pushStack(T.unique(T.map(this,function(c){return T.find(b,c)})),"find",b)}},clone:function(b){var d=this.map(function(){if(!T.support.noCloneEvent&&!T.isXMLDoc(this)){var f=this.outerHTML;if(!f){var e=this.ownerDocument.createElement("div");e.appendChild(this.cloneNode(true));f=e.innerHTML}return T.clean([f.replace(/ jQuery\d+="(?:\d+|null)"/g,"").replace(/^\s*/,"")])[0]}else{return this.cloneNode(true)}});if(b===true){var a=this.find("*").andSelf(),c=0;d.find("*").andSelf().each(function(){if(this.nodeName!==a[c].nodeName){return}var g=T.data(a[c],"events");for(var e in g){for(var f in g[e]){T.event.add(this,e,g[e][f],g[e][f].data)}}c++})}return d},filter:function(a){return this.pushStack(T.isFunction(a)&&T.grep(this,function(b,c){return a.call(b,c)})||T.multiFilter(a,T.grep(this,function(b){return b.nodeType===1})),"filter",a)},closest:function(c){var a=T.expr.match.POS.test(c)?T(c):null,b=0;return this.map(function(){var d=this;while(d&&d.ownerDocument){if(a?a.index(d)>-1:T(d).is(c)){T.data(d,"closest",b);return d}d=d.parentNode;b++}})},not:function(b){if(typeof b==="string"){if(ac.test(b)){return this.pushStack(T.multiFilter(b,this,true),"not",b)}else{b=T.multiFilter(b,this)}}var a=b.length&&b[b.length-1]!==ab&&!b.nodeType;return this.filter(function(){return a?T.inArray(this,b)<0:this!=b})},add:function(a){return this.pushStack(T.unique(T.merge(this.get(),typeof a==="string"?T(a):T.makeArray(a))))},is:function(a){return !!a&&T.multiFilter(a,this).length>0},hasClass:function(a){return !!a&&this.is("."+a)},val:function(c){if(c===ab){var j=this[0];if(j){if(T.nodeName(j,"option")){return(j.attributes.value||{}).specified?j.value:j.text}if(T.nodeName(j,"select")){var e=j.selectedIndex,b=[],a=j.options,f=j.type=="select-one";if(e<0){return null}for(var h=f?e:0,d=f?e+1:a.length;h<d;h++){var g=a[h];if(g.selected){c=T(g).val();if(f){return c}b.push(c)}}return b}return(j.value||"").replace(/\r/g,"")}return ab}if(typeof c==="number"){c+=""}return this.each(function(){if(this.nodeType!=1){return}if(T.isArray(c)&&/radio|checkbox/.test(this.type)){this.checked=(T.inArray(this.value,c)>=0||T.inArray(this.name,c)>=0)}else{if(T.nodeName(this,"select")){var k=T.makeArray(c);T("option",this).each(function(){this.selected=(T.inArray(this.value,k)>=0||T.inArray(this.text,k)>=0)});if(!k.length){this.selectedIndex=-1}}else{this.value=c}}})},html:function(a){return a===ab?(this[0]?this[0].innerHTML.replace(/ jQuery\d+="(?:\d+|null)"/g,""):null):this.empty().append(a)},replaceWith:function(a){return this.after(a).remove()},eq:function(a){return this.slice(a,+a+1)},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments),"slice",Array.prototype.slice.call(arguments).join(","))},map:function(a){return this.pushStack(T.map(this,function(b,c){return a.call(b,c,b)}))},andSelf:function(){return this.add(this.prevObject)},domManip:function(d,a,b){if(this[0]){var e=(this[0].ownerDocument||this[0]).createDocumentFragment(),h=T.clean(d,(this[0].ownerDocument||this[0]),e),f=e.firstChild;if(f){for(var g=0,j=this.length;g<j;g++){b.call(c(this[g],f),this.length>1||g>0?e.cloneNode(true):e)}}if(h){T.each(h,E)}}return this;function c(l,k){return a&&T.nodeName(l,"table")&&T.nodeName(k,"tr")?(l.getElementsByTagName("tbody")[0]||l.appendChild(l.ownerDocument.createElement("tbody"))):l}}};T.fn.init.prototype=T.fn;function E(b,a){if(a.src){T.ajax({url:a.src,async:false,dataType:"script"})}else{T.globalEval(a.text||a.textContent||a.innerHTML||"")}if(a.parentNode){a.parentNode.removeChild(a)}}function ad(){return +new Date}T.extend=T.fn.extend=function(){var c=arguments[0]||{},e=1,d=arguments.length,h=false,f;if(typeof c==="boolean"){h=c;c=arguments[1]||{};e=2}if(typeof c!=="object"&&!T.isFunction(c)){c={}}if(d==e){c=this;--e}for(;e<d;e++){if((f=arguments[e])!=null){for(var g in f){var b=c[g],a=f[g];if(c===a){continue}if(h&&a&&typeof a==="object"&&!a.nodeType){c[g]=T.extend(h,b||(a.length!=null?[]:{}),a)}else{if(a!==ab){c[g]=a}}}}}return c};var ag=/z-?index|font-?weight|opacity|zoom|line-?height/i,Q=document.defaultView||{},L=Object.prototype.toString;T.extend({noConflict:function(a){W.$=S;if(a){W.jQuery=F}return T},isFunction:function(a){return L.call(a)==="[object Function]"},isArray:function(a){return L.call(a)==="[object Array]"},isXMLDoc:function(a){return a.nodeType===9&&a.documentElement.nodeName!=="HTML"||!!a.ownerDocument&&T.isXMLDoc(a.ownerDocument)},globalEval:function(a){if(a&&/\S/.test(a)){var b=document.getElementsByTagName("head")[0]||document.documentElement,c=document.createElement("script");c.type="text/javascript";if(T.support.scriptEval){c.appendChild(document.createTextNode(a))}else{c.text=a}b.insertBefore(c,b.firstChild);b.removeChild(c)}},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()==b.toUpperCase()},each:function(e,a,f){var g,d=0,c=e.length;if(f){if(c===ab){for(g in e){if(a.apply(e[g],f)===false){break}}}else{for(;d<c;){if(a.apply(e[d++],f)===false){break}}}}else{if(c===ab){for(g in e){if(a.call(e[g],g,e[g])===false){break}}}else{for(var b=e[0];d<c&&a.call(b,d,b)!==false;b=e[++d]){}}}return e},prop:function(b,a,c,d,e){if(T.isFunction(a)){a=a.call(b,d)}return typeof a==="number"&&c=="curCSS"&&!ag.test(e)?a+"px":a},className:{add:function(b,a){T.each((a||"").split(/\s+/),function(d,c){if(b.nodeType==1&&!T.className.has(b.className,c)){b.className+=(b.className?" ":"")+c}})},remove:function(b,a){if(b.nodeType==1){b.className=a!==ab?T.grep(b.className.split(/\s+/),function(c){return !T.className.has(a,c)}).join(" "):""}},has:function(a,b){return a&&T.inArray(b,(a.className||a).toString().split(/\s+/))>-1}},swap:function(b,c,a){var e={};for(var d in c){e[d]=b.style[d];b.style[d]=c[d]}a.call(b);for(var d in c){b.style[d]=e[d]}},css:function(e,g,c,h){if(g=="width"||g=="height"){var a,f={position:"absolute",visibility:"hidden",display:"block"},b=g=="width"?["Left","Right"]:["Top","Bottom"];function d(){a=g=="width"?e.offsetWidth:e.offsetHeight;if(h==="border"){return}T.each(b,function(){if(!h){a-=parseFloat(T.curCSS(e,"padding"+this,true))||0}if(h==="margin"){a+=parseFloat(T.curCSS(e,"margin"+this,true))||0}else{a-=parseFloat(T.curCSS(e,"border"+this+"Width",true))||0}})}if(e.offsetWidth!==0){d()}else{T.swap(e,f,d)}return Math.max(0,Math.round(a))}return T.curCSS(e,g,c)},curCSS:function(e,h,g){var b,j=e.style;if(h=="opacity"&&!T.support.opacity){b=T.attr(j,"opacity");return b==""?"1":b}if(h.match(/float/i)){h=H}if(!g&&j&&j[h]){b=j[h]}else{if(Q.getComputedStyle){if(h.match(/float/i)){h="float"}h=h.replace(/([A-Z])/g,"-$1").toLowerCase();var a=Q.getComputedStyle(e,null);if(a){b=a.getPropertyValue(h)}if(h=="opacity"&&b==""){b="1"}}else{if(e.currentStyle){var d=h.replace(/\-(\w)/g,function(l,k){return k.toUpperCase()});b=e.currentStyle[h]||e.currentStyle[d];if(!/^\d+(px)?$/i.test(b)&&/^\d/.test(b)){var f=j.left,c=e.runtimeStyle.left;e.runtimeStyle.left=e.currentStyle.left;j.left=b||0;b=j.pixelLeft+"px";j.left=f;e.runtimeStyle.left=c}}}}return b},clean:function(g,b,d){b=b||document;if(typeof b.createElement==="undefined"){b=b.ownerDocument||b[0]&&b[0].ownerDocument||document}if(!d&&g.length===1&&typeof g[0]==="string"){var e=/^<(\w+)\s*\/?>$/.exec(g[0]);if(e){return[b.createElement(e[1])]}}var f=[],h=[],a=b.createElement("div");T.each(g,function(m,j){if(typeof j==="number"){j+=""}if(!j){return}if(typeof j==="string"){j=j.replace(/(<(\w+)[^>]*?)\/>/g,function(r,q,s){return s.match(/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i)?r:q+"></"+s+">"});var n=j.replace(/^\s+/,"").substring(0,10).toLowerCase();var l=!n.indexOf("<opt")&&[1,"<select multiple='multiple'>","</select>"]||!n.indexOf("<leg")&&[1,"<fieldset>","</fieldset>"]||n.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,"<table>","</table>"]||!n.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!n.indexOf("<td")||!n.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||!n.indexOf("<col")&&[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"]||!T.support.htmlSerialize&&[1,"div<div>","</div>"]||[0,"",""];a.innerHTML=l[1]+j+l[2];while(l[0]--){a=a.lastChild}if(!T.support.tbody){var k=/<tbody/i.test(j),o=!n.indexOf("<table")&&!k?a.firstChild&&a.firstChild.childNodes:l[1]=="<table>"&&!k?a.childNodes:[];for(var p=o.length-1;p>=0;--p){if(T.nodeName(o[p],"tbody")&&!o[p].childNodes.length){o[p].parentNode.removeChild(o[p])}}}if(!T.support.leadingWhitespace&&/^\s/.test(j)){a.insertBefore(b.createTextNode(j.match(/^\s*/)[0]),a.firstChild)}j=T.makeArray(a.childNodes)}if(j.nodeType){f.push(j)}else{f=T.merge(f,j)}});if(d){for(var c=0;f[c];c++){if(T.nodeName(f[c],"script")&&(!f[c].type||f[c].type.toLowerCase()==="text/javascript")){h.push(f[c].parentNode?f[c].parentNode.removeChild(f[c]):f[c])}else{if(f[c].nodeType===1){f.splice.apply(f,[c+1,0].concat(T.makeArray(f[c].getElementsByTagName("script"))))}d.appendChild(f[c])}}return h}return f},attr:function(c,f,b){if(!c||c.nodeType==3||c.nodeType==8){return ab}var e=!T.isXMLDoc(c),a=b!==ab;f=e&&T.props[f]||f;if(c.tagName){var g=/href|src|style/.test(f);if(f=="selected"&&c.parentNode){c.parentNode.selectedIndex}if(f in c&&e&&!g){if(a){if(f=="type"&&T.nodeName(c,"input")&&c.parentNode){throw"type property can't be changed"}c[f]=b}if(T.nodeName(c,"form")&&c.getAttributeNode(f)){return c.getAttributeNode(f).nodeValue}if(f=="tabIndex"){var d=c.getAttributeNode("tabIndex");return d&&d.specified?d.value:c.nodeName.match(/(button|input|object|select|textarea)/i)?0:c.nodeName.match(/^(a|area)$/i)&&c.href?0:ab}return c[f]}if(!T.support.style&&e&&f=="style"){return T.attr(c.style,"cssText",b)}if(a){c.setAttribute(f,""+b)}var h=!T.support.hrefNormalized&&e&&g?c.getAttribute(f,2):c.getAttribute(f);return h===null?ab:h}if(!T.support.opacity&&f=="opacity"){if(a){c.zoom=1;c.filter=(c.filter||"").replace(/alpha\([^)]*\)/,"")+(parseInt(b)+""=="NaN"?"":"alpha(opacity="+b*100+")")}return c.filter&&c.filter.indexOf("opacity=")>=0?(parseFloat(c.filter.match(/opacity=([^)]*)/)[1])/100)+"":""}f=f.replace(/-([a-z])/ig,function(k,j){return j.toUpperCase()});if(a){c[f]=b}return c[f]},trim:function(a){return(a||"").replace(/^\s+|\s+$/g,"")},makeArray:function(a){var c=[];if(a!=null){var b=a.length;if(b==null||typeof a==="string"||T.isFunction(a)||a.setInterval){c[0]=a}else{while(b){c[--b]=a[b]}}}return c},inArray:function(b,a){for(var d=0,c=a.length;d<c;d++){if(a[d]===b){return d}}return -1},merge:function(b,e){var d=0,c,a=b.length;if(!T.support.getAll){while((c=e[d++])!=null){if(c.nodeType!=8){b[a++]=c}}}else{while((c=e[d++])!=null){b[a++]=c}}return b},unique:function(a){var f=[],g={};try{for(var e=0,d=a.length;e<d;e++){var b=T.data(a[e]);if(!g[b]){g[b]=true;f.push(a[e])}}}catch(c){f=a}return f},grep:function(e,a,f){var d=[];for(var c=0,b=e.length;c<b;c++){if(!f!=!a(e[c],c)){d.push(e[c])}}return d},map:function(f,a){var e=[];for(var d=0,c=f.length;d<c;d++){var b=a(f[d],d);if(b!=null){e[e.length]=b}}return e.concat.apply([],e)}});var O=navigator.userAgent.toLowerCase();T.browser={version:(O.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:/webkit/.test(O),opera:/opera/.test(O),msie:/msie/.test(O)&&!/opera/.test(O),mozilla:/mozilla/.test(O)&&!/(compatible|webkit)/.test(O)};T.each({parent:function(a){return a.parentNode},parents:function(a){return T.dir(a,"parentNode")},next:function(a){return T.nth(a,2,"nextSibling")},prev:function(a){return T.nth(a,2,"previousSibling")},nextAll:function(a){return T.dir(a,"nextSibling")},prevAll:function(a){return T.dir(a,"previousSibling")},siblings:function(a){return T.sibling(a.parentNode.firstChild,a)},children:function(a){return T.sibling(a.firstChild)},contents:function(a){return T.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:T.makeArray(a.childNodes)}},function(b,a){T.fn[b]=function(d){var c=T.map(this,a);if(d&&typeof d=="string"){c=T.multiFilter(d,c)}return this.pushStack(T.unique(c),b,d)}});T.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(b,a){T.fn[b]=function(h){var e=[],c=T(h);for(var d=0,g=c.length;d<g;d++){var f=(d>0?this.clone(true):this).get();T.fn[a].apply(T(c[d]),f);e=e.concat(f)}return this.pushStack(e,b,h)}});T.each({removeAttr:function(a){T.attr(this,a,"");if(this.nodeType==1){this.removeAttribute(a)}},addClass:function(a){T.className.add(this,a)},removeClass:function(a){T.className.remove(this,a)},toggleClass:function(a,b){if(typeof b!=="boolean"){b=!T.className.has(this,a)}T.className[b?"add":"remove"](this,a)},remove:function(a){if(!a||T.filter(a,[this]).length){T("*",this).add([this]).each(function(){T.event.remove(this);T.removeData(this)});if(this.parentNode){this.parentNode.removeChild(this)}}},empty:function(){T(this).children().remove();while(this.firstChild){this.removeChild(this.firstChild)}}},function(b,a){T.fn[b]=function(){return this.each(a,arguments)}});function Y(b,a){return b[0]&&parseInt(T.curCSS(b[0],a,true),10)||0}var aa="jQuery"+ad(),I=0,R={};T.extend({cache:{},data:function(c,d,b){c=c==W?R:c;var a=c[aa];if(!a){a=c[aa]=++I}if(d&&!T.cache[a]){T.cache[a]={}}if(b!==ab){T.cache[a][d]=b}return d?T.cache[a][d]:a},removeData:function(c,d){c=c==W?R:c;var a=c[aa];if(d){if(T.cache[a]){delete T.cache[a][d];d="";for(d in T.cache[a]){break}if(!d){T.removeData(c)}}}else{try{delete c[aa]}catch(b){if(c.removeAttribute){c.removeAttribute(aa)}}delete T.cache[a]}},queue:function(c,d,a){if(c){d=(d||"fx")+"queue";var b=T.data(c,d);if(!b||T.isArray(a)){b=T.data(c,d,T.makeArray(a))}else{if(a){b.push(a)}}}return b},dequeue:function(a,b){var d=T.queue(a,b),c=d.shift();if(!b||b==="fx"){c=d[0]}if(c!==ab){c.call(a)}}});T.fn.extend({data:function(d,b){var a=d.split(".");a[1]=a[1]?"."+a[1]:"";if(b===ab){var c=this.triggerHandler("getData"+a[1]+"!",[a[0]]);if(c===ab&&this.length){c=T.data(this[0],d)}return c===ab&&a[1]?this.data(a[0]):c}else{return this.trigger("setData"+a[1]+"!",[a[0],b]).each(function(){T.data(this,d,b)})}},removeData:function(a){return this.each(function(){T.removeData(this,a)})},queue:function(b,a){if(typeof b!=="string"){a=b;b="fx"}if(a===ab){return T.queue(this[0],b)}return this.each(function(){var c=T.queue(this,b,a);if(b=="fx"&&c.length==1){c[0].call(this)}})},dequeue:function(a){return this.each(function(){T.dequeue(this,a)})}});(function(){var b=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?/g,h=0,m=Object.prototype.toString;var o=function(s,x,ak,aj){ak=ak||[];x=x||document;if(x.nodeType!==1&&x.nodeType!==9){return[]}if(!s||typeof s!=="string"){return ak}var r=[],u,C,z,y,ai,w,t=true;b.lastIndex=0;while((u=b.exec(s))!==null){r.push(u[1]);if(u[2]){w=RegExp.rightContext;break}}if(r.length>1&&g.exec(s)){if(r.length===2&&l.relative[r[0]]){C=k(r[0]+r[1],x)}else{C=l.relative[r[0]]?[x]:o(r.shift(),x);while(r.length){s=r.shift();if(l.relative[s]){s+=r.shift()}C=k(s,C)}}}else{var D=aj?{expr:r.pop(),set:p(aj)}:o.find(r.pop(),r.length===1&&x.parentNode?x.parentNode:x,c(x));C=o.filter(D.expr,D.set);if(r.length>0){z=p(C)}else{t=false}while(r.length){var A=r.pop(),B=A;if(!l.relative[A]){A=""}else{B=r.pop()}if(B==null){B=x}l.relative[A](z,B,c(x))}}if(!z){z=C}if(!z){throw"Syntax error, unrecognized expression: "+(A||s)}if(m.call(z)==="[object Array]"){if(!t){ak.push.apply(ak,z)}else{if(x.nodeType===1){for(var q=0;z[q]!=null;q++){if(z[q]&&(z[q]===true||z[q].nodeType===1&&j(x,z[q]))){ak.push(C[q])}}}else{for(var q=0;z[q]!=null;q++){if(z[q]&&z[q].nodeType===1){ak.push(C[q])}}}}}else{p(z,ak)}if(w){o(w,x,ak,aj);if(n){hasDuplicate=false;ak.sort(n);if(hasDuplicate){for(var q=1;q<ak.length;q++){if(ak[q]===ak[q-1]){ak.splice(q--,1)}}}}}return ak};o.matches=function(r,q){return o(r,null,null,q)};o.find=function(q,y,z){var r,t;if(!q){return[]}for(var u=0,w=l.order.length;u<w;u++){var s=l.order[u],t;if((t=l.match[s].exec(q))){var x=RegExp.leftContext;if(x.substr(x.length-1)!=="\\"){t[1]=(t[1]||"").replace(/\\/g,"");r=l.find[s](t,y,z);if(r!=null){q=q.replace(l.match[s],"");break}}}}if(!r){r=y.getElementsByTagName("*")}return{set:r,expr:q}};o.filter=function(ai,aj,B,u){var w=ai,z=[],q=aj,s,y,r=aj&&aj[0]&&c(aj[0]);while(ai&&aj.length){for(var ak in l.filter){if((s=l.match[ak].exec(ai))!=null){var x=l.filter[ak],A,C;y=false;if(q==z){z=[]}if(l.preFilter[ak]){s=l.preFilter[ak](s,q,B,z,u,r);if(!s){y=A=true}else{if(s===true){continue}}}if(s){for(var t=0;(C=q[t])!=null;t++){if(C){A=x(C,s,t,q);var D=u^!!A;if(B&&A!=null){if(D){y=true}else{q[t]=false}}else{if(D){z.push(C);y=true}}}}}if(A!==ab){if(!B){q=z}ai=ai.replace(l.match[ak],"");if(!y){return[]}break}}}if(ai==w){if(y==null){throw"Syntax error, unrecognized expression: "+ai}else{break}}w=ai}return q};var l=o.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF_-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF_-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*_-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF_-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(q){return q.getAttribute("href")}},relative:{"+":function(q,y,r){var t=typeof y==="string",z=t&&!/\W/.test(y),s=t&&!z;if(z&&!r){y=y.toUpperCase()}for(var u=0,w=q.length,x;u<w;u++){if((x=q[u])){while((x=x.previousSibling)&&x.nodeType!==1){}q[u]=s||x&&x.nodeName===y?x||false:x===y}}if(s){o.filter(y,q,true)}},">":function(w,s,u){var y=typeof s==="string";if(y&&!/\W/.test(s)){s=u?s:s.toUpperCase();for(var r=0,t=w.length;r<t;r++){var x=w[r];if(x){var q=x.parentNode;w[r]=q.nodeName===s?q:false}}}else{for(var r=0,t=w.length;r<t;r++){var x=w[r];if(x){w[r]=y?x.parentNode:x.parentNode===s}}if(y){o.filter(s,w,true)}}},"":function(q,s,u){var r=h++,t=a;if(!s.match(/\W/)){var w=s=u?s:s.toUpperCase();t=d}t("parentNode",s,r,q,w,u)},"~":function(q,s,u){var r=h++,t=a;if(typeof s==="string"&&!s.match(/\W/)){var w=s=u?s:s.toUpperCase();t=d}t("previousSibling",s,r,q,w,u)}},find:{ID:function(s,r,q){if(typeof r.getElementById!=="undefined"&&!q){var t=r.getElementById(s[1]);return t?[t]:[]}},NAME:function(r,w,u){if(typeof w.getElementsByName!=="undefined"){var s=[],x=w.getElementsByName(r[1]);for(var q=0,t=x.length;q<t;q++){if(x[q].getAttribute("name")===r[1]){s.push(x[q])}}return s.length===0?null:s}},TAG:function(r,q){return q.getElementsByTagName(r[1])}},preFilter:{CLASS:function(q,s,r,t,w,u){q=" "+q[1].replace(/\\/g,"")+" ";if(u){return q}for(var y=0,x;(x=s[y])!=null;y++){if(x){if(w^(x.className&&(" "+x.className+" ").indexOf(q)>=0)){if(!r){t.push(x)}}else{if(r){s[y]=false}}}}return false},ID:function(q){return q[1].replace(/\\/g,"")},TAG:function(r,s){for(var q=0;s[q]===false;q++){}return s[q]&&c(s[q])?r[1]:r[1].toUpperCase()},CHILD:function(r){if(r[1]=="nth"){var q=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(r[2]=="even"&&"2n"||r[2]=="odd"&&"2n+1"||!/\D/.test(r[2])&&"0n+"+r[2]||r[2]);r[2]=(q[1]+(q[2]||1))-0;r[3]=q[3]-0}r[0]=h++;return r},ATTR:function(x,s,r,t,w,u){var q=x[1].replace(/\\/g,"");if(!u&&l.attrMap[q]){x[1]=l.attrMap[q]}if(x[2]==="~="){x[4]=" "+x[4]+" "}return x},PSEUDO:function(w,s,r,t,u){if(w[1]==="not"){if(w[3].match(b).length>1||/^\w/.test(w[3])){w[3]=o(w[3],null,null,s)}else{var q=o.filter(w[3],s,r,true^u);if(!r){t.push.apply(t,q)}return false}}else{if(l.match.POS.test(w[0])||l.match.CHILD.test(w[0])){return true}}return w},POS:function(q){q.unshift(true);return q}},filters:{enabled:function(q){return q.disabled===false&&q.type!=="hidden"},disabled:function(q){return q.disabled===true},checked:function(q){return q.checked===true},selected:function(q){q.parentNode.selectedIndex;return q.selected===true},parent:function(q){return !!q.firstChild},empty:function(q){return !q.firstChild},has:function(q,r,s){return !!o(s[3],q).length},header:function(q){return/h\d/i.test(q.nodeName)},text:function(q){return"text"===q.type},radio:function(q){return"radio"===q.type},checkbox:function(q){return"checkbox"===q.type},file:function(q){return"file"===q.type},password:function(q){return"password"===q.type},submit:function(q){return"submit"===q.type},image:function(q){return"image"===q.type},reset:function(q){return"reset"===q.type},button:function(q){return"button"===q.type||q.nodeName.toUpperCase()==="BUTTON"},input:function(q){return/input|select|textarea|button/i.test(q.nodeName)}},setFilters:{first:function(q,r){return r===0},last:function(r,s,t,q){return s===q.length-1},even:function(q,r){return r%2===0},odd:function(q,r){return r%2===1},lt:function(q,r,s){return r<s[3]-0},gt:function(q,r,s){return r>s[3]-0},nth:function(q,r,s){return s[3]-0==r},eq:function(q,r,s){return s[3]-0==r}},filter:{PSEUDO:function(w,r,q,u){var s=r[1],y=l.filters[s];if(y){return y(w,q,r,u)}else{if(s==="contains"){return(w.textContent||w.innerText||"").indexOf(r[3])>=0}else{if(s==="not"){var x=r[3];for(var q=0,t=x.length;q<t;q++){if(x[q]===w){return false}}return true}}}},CHILD:function(y,u){var r=u[1],x=y;switch(r){case"only":case"first":while(x=x.previousSibling){if(x.nodeType===1){return false}}if(r=="first"){return true}x=y;case"last":while(x=x.nextSibling){if(x.nodeType===1){return false}}return true;case"nth":var w=u[2],z=u[3];if(w==1&&z==0){return true}var s=u[0],A=y.parentNode;if(A&&(A.sizcache!==s||!y.nodeIndex)){var t=0;for(x=A.firstChild;x;x=x.nextSibling){if(x.nodeType===1){x.nodeIndex=++t}}A.sizcache=s}var q=y.nodeIndex-z;if(w==0){return q==0}else{return(q%w==0&&q/w>=0)}}},ID:function(q,r){return q.nodeType===1&&q.getAttribute("id")===r},TAG:function(q,r){return(r==="*"&&q.nodeType===1)||q.nodeName===r},CLASS:function(q,r){return(" "+(q.className||q.getAttribute("class"))+" ").indexOf(r)>-1},ATTR:function(w,q){var r=q[1],t=l.attrHandle[r]?l.attrHandle[r](w):w[r]!=null?w[r]:w.getAttribute(r),u=t+"",x=q[2],s=q[4];return t==null?x==="!=":x==="="?u===s:x==="*="?u.indexOf(s)>=0:x==="~="?(" "+u+" ").indexOf(s)>=0:!s?u&&t!==false:x==="!="?u!=s:x==="^="?u.indexOf(s)===0:x==="$="?u.substr(u.length-s.length)===s:x==="|="?u===s||u.substr(0,s.length+1)===s+"-":false},POS:function(w,s,r,u){var t=s[2],q=l.setFilters[t];if(q){return q(w,r,s,u)}}}};var g=l.match.POS;for(var e in l.match){l.match[e]=RegExp(l.match[e].source+/(?![^\[]*\])(?![^\(]*\))/.source)}var p=function(q,r){q=Array.prototype.slice.call(q);if(r){r.push.apply(r,q);return r}return q};try{Array.prototype.slice.call(document.documentElement.childNodes)}catch(f){p=function(u,q){var s=q||[];if(m.call(u)==="[object Array]"){Array.prototype.push.apply(s,u)}else{if(typeof u.length==="number"){for(var r=0,t=u.length;r<t;r++){s.push(u[r])}}else{for(var r=0;u[r];r++){s.push(u[r])}}}return s}}var n;if(document.documentElement.compareDocumentPosition){n=function(r,s){var q=r.compareDocumentPosition(s)&4?-1:r===s?0:1;if(q===0){hasDuplicate=true}return q}}else{if("sourceIndex" in document.documentElement){n=function(r,s){var q=r.sourceIndex-s.sourceIndex;if(q===0){hasDuplicate=true}return q}}else{if(document.createRange){n=function(q,s){var r=q.ownerDocument.createRange(),t=s.ownerDocument.createRange();r.selectNode(q);r.collapse(true);t.selectNode(s);t.collapse(true);var u=r.compareBoundaryPoints(Range.START_TO_END,t);if(u===0){hasDuplicate=true}return u}}}}(function(){var r=document.createElement("form"),q="script"+(new Date).getTime();r.innerHTML="<input name='"+q+"'/>";var s=document.documentElement;s.insertBefore(r,s.firstChild);if(!!document.getElementById(q)){l.find.ID=function(x,w,u){if(typeof w.getElementById!=="undefined"&&!u){var t=w.getElementById(x[1]);return t?t.id===x[1]||typeof t.getAttributeNode!=="undefined"&&t.getAttributeNode("id").nodeValue===x[1]?[t]:ab:[]}};l.filter.ID=function(u,t){var w=typeof u.getAttributeNode!=="undefined"&&u.getAttributeNode("id");return u.nodeType===1&&w&&w.nodeValue===t}}s.removeChild(r)})();(function(){var q=document.createElement("div");q.appendChild(document.createComment(""));if(q.getElementsByTagName("*").length>0){l.find.TAG=function(t,u){var w=u.getElementsByTagName(t[1]);if(t[1]==="*"){var r=[];for(var s=0;w[s];s++){if(w[s].nodeType===1){r.push(w[s])}}w=r}return w}}q.innerHTML="<a href='#'></a>";if(q.firstChild&&typeof q.firstChild.getAttribute!=="undefined"&&q.firstChild.getAttribute("href")!=="#"){l.attrHandle.href=function(r){return r.getAttribute("href",2)}}})();if(document.querySelectorAll){(function(){var r=o,q=document.createElement("div");q.innerHTML="<p class='TEST'></p>";if(q.querySelectorAll&&q.querySelectorAll(".TEST").length===0){return}o=function(w,x,t,s){x=x||document;if(!s&&x.nodeType===9&&!c(x)){try{return p(x.querySelectorAll(w),t)}catch(u){}}return r(w,x,t,s)};o.find=r.find;o.filter=r.filter;o.selectors=r.selectors;o.matches=r.matches})()}if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var q=document.createElement("div");q.innerHTML="<div class='test e'></div><div class='test'></div>";if(q.getElementsByClassName("e").length===0){return}q.lastChild.className="e";if(q.getElementsByClassName("e").length===1){return}l.order.splice(1,0,"CLASS");l.find.CLASS=function(t,s,r){if(typeof s.getElementsByClassName!=="undefined"&&!r){return s.getElementsByClassName(t[1])}}})()}function d(x,r,s,z,q,A){var B=x=="previousSibling"&&!A;for(var u=0,w=z.length;u<w;u++){var y=z[u];if(y){if(B&&y.nodeType===1){y.sizcache=s;y.sizset=u}y=y[x];var t=false;while(y){if(y.sizcache===s){t=z[y.sizset];break}if(y.nodeType===1&&!A){y.sizcache=s;y.sizset=u}if(y.nodeName===r){t=y;break}y=y[x]}z[u]=t}}}function a(x,r,s,z,q,A){var B=x=="previousSibling"&&!A;for(var u=0,w=z.length;u<w;u++){var y=z[u];if(y){if(B&&y.nodeType===1){y.sizcache=s;y.sizset=u}y=y[x];var t=false;while(y){if(y.sizcache===s){t=z[y.sizset];break}if(y.nodeType===1){if(!A){y.sizcache=s;y.sizset=u}if(typeof r!=="string"){if(y===r){t=true;break}}else{if(o.filter(r,[y]).length>0){t=y;break}}}y=y[x]}z[u]=t}}}var j=document.compareDocumentPosition?function(q,r){return q.compareDocumentPosition(r)&16}:function(q,r){return q!==r&&(q.contains?q.contains(r):true)};var c=function(q){return q.nodeType===9&&q.documentElement.nodeName!=="HTML"||!!q.ownerDocument&&c(q.ownerDocument)};var k=function(t,w){var q=[],y="",x,r=w.nodeType?[w]:w;while((x=l.match.PSEUDO.exec(t))){y+=x[0];t=t.replace(l.match.PSEUDO,"")}t=l.relative[t]?t+"*":t;for(var u=0,s=r.length;u<s;u++){o(t,r[u],q)}return o.filter(y,q)};T.find=o;T.filter=o.filter;T.expr=o.selectors;T.expr[":"]=T.expr.filters;o.selectors.filters.hidden=function(q){return q.offsetWidth===0||q.offsetHeight===0};o.selectors.filters.visible=function(q){return q.offsetWidth>0||q.offsetHeight>0};o.selectors.filters.animated=function(q){return T.grep(T.timers,function(r){return q===r.elem}).length};T.multiFilter=function(q,s,r){if(r){q=":not("+q+")"}return o.matches(q,s)};T.dir=function(r,s){var t=[],q=r[s];while(q&&q!=document){if(q.nodeType==1){t.push(q)}q=q[s]}return t};T.nth=function(u,t,r,q){t=t||1;var s=0;for(;u;u=u[r]){if(u.nodeType==1&&++s==t){break}}return u};T.sibling=function(q,r){var s=[];for(;q;q=q.nextSibling){if(q.nodeType==1&&q!=r){s.push(q)}}return s};return;W.Sizzle=o})();T.event={add:function(c,f,d,a){if(c.nodeType==3||c.nodeType==8){return}if(c.setInterval&&c!=W){c=W}if(!d.guid){d.guid=this.guid++}if(a!==ab){var e=d;d=this.proxy(e);d.data=a}var g=T.data(c,"events")||T.data(c,"events",{}),b=T.data(c,"handle")||T.data(c,"handle",function(){return typeof T!=="undefined"&&!T.event.triggered?T.event.handle.apply(arguments.callee.elem,arguments):ab});b.elem=c;T.each(f.split(/\s+/),function(l,k){var j=k.split(".");k=j.shift();d.type=j.slice().sort().join(".");var h=g[k];if(T.event.specialAll[k]){T.event.specialAll[k].setup.call(c,a,j)}if(!h){h=g[k]={};if(!T.event.special[k]||T.event.special[k].setup.call(c,a,j)===false){if(c.addEventListener){c.addEventListener(k,b,false)}else{if(c.attachEvent){c.attachEvent("on"+k,b)}}}}h[d.guid]=d;T.event.global[k]=true});c=null},guid:1,global:{},remove:function(b,e,c){if(b.nodeType==3||b.nodeType==8){return}var f=T.data(b,"events"),g,h;if(f){if(e===ab||(typeof e==="string"&&e.charAt(0)==".")){for(var d in f){this.remove(b,d+(e||""))}}else{if(e.type){c=e.handler;e=e.type}T.each(e.split(/\s+/),function(n,l){var j=l.split(".");l=j.shift();var m=RegExp("(^|\\.)"+j.slice().sort().join(".*\\.")+"(\\.|$)");if(f[l]){if(c){delete f[l][c.guid]}else{for(var k in f[l]){if(m.test(f[l][k].type)){delete f[l][k]}}}if(T.event.specialAll[l]){T.event.specialAll[l].teardown.call(b,j)}for(g in f[l]){break}if(!g){if(!T.event.special[l]||T.event.special[l].teardown.call(b,j)===false){if(b.removeEventListener){b.removeEventListener(l,T.data(b,"handle"),false)}else{if(b.detachEvent){b.detachEvent("on"+l,T.data(b,"handle"))}}}g=null;delete f[l]}}})}for(g in f){break}if(!g){var a=T.data(b,"handle");if(a){a.elem=null}T.removeData(b,"events");T.removeData(b,"handle")}}},trigger:function(d,b,e,h){var f=d.type||d;if(!h){d=typeof d==="object"?d[aa]?d:T.extend(T.Event(f),d):T.Event(f);if(f.indexOf("!")>=0){d.type=f=f.slice(0,-1);d.exclusive=true}if(!e){d.stopPropagation();if(this.global[f]){T.each(T.cache,function(){if(this.events&&this.events[f]){T.event.trigger(d,b,this.handle.elem)}})}}if(!e||e.nodeType==3||e.nodeType==8){return ab}d.result=ab;d.target=e;b=T.makeArray(b);b.unshift(d)}d.currentTarget=e;var c=T.data(e,"handle");if(c){c.apply(e,b)}if((!e[f]||(T.nodeName(e,"a")&&f=="click"))&&e["on"+f]&&e["on"+f].apply(e,b)===false){d.result=false}if(!h&&e[f]&&!d.isDefaultPrevented()&&!(T.nodeName(e,"a")&&f=="click")){this.triggered=true;try{e[f]()}catch(a){}}this.triggered=false;if(!d.isPropagationStopped()){var g=e.parentNode||e.ownerDocument;if(g){T.event.trigger(d,b,g,true)}}},handle:function(b){var c,h;b=arguments[0]=T.event.fix(b||W.event);b.currentTarget=this;var a=b.type.split(".");b.type=a.shift();c=!a.length&&!b.exclusive;var d=RegExp("(^|\\.)"+a.slice().sort().join(".*\\.")+"(\\.|$)");h=(T.data(this,"events")||{})[b.type];for(var f in h){var e=h[f];if(c||d.test(e.type)){b.handler=e;b.data=e.data;var g=e.apply(this,arguments);if(g!==ab){b.result=g;if(g===false){b.preventDefault();b.stopPropagation()}}if(b.isImmediatePropagationStopped()){break}}}},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(c){if(c[aa]){return c}var e=c;c=T.Event(e);for(var d=this.props.length,a;d;){a=this.props[--d];c[a]=e[a]}if(!c.target){c.target=c.srcElement||document}if(c.target.nodeType==3){c.target=c.target.parentNode}if(!c.relatedTarget&&c.fromElement){c.relatedTarget=c.fromElement==c.target?c.toElement:c.fromElement}if(c.pageX==null&&c.clientX!=null){var b=document.documentElement,f=document.body;c.pageX=c.clientX+(b&&b.scrollLeft||f&&f.scrollLeft||0)-(b.clientLeft||0);c.pageY=c.clientY+(b&&b.scrollTop||f&&f.scrollTop||0)-(b.clientTop||0)}if(!c.which&&((c.charCode||c.charCode===0)?c.charCode:c.keyCode)){c.which=c.charCode||c.keyCode}if(!c.metaKey&&c.ctrlKey){c.metaKey=c.ctrlKey}if(!c.which&&c.button){c.which=(c.button&1?1:(c.button&2?3:(c.button&4?2:0)))}return c},proxy:function(a,b){b=b||function(){return a.apply(this,arguments)};b.guid=a.guid=a.guid||b.guid||this.guid++;return b},special:{ready:{setup:P,teardown:function(){}}},specialAll:{live:{setup:function(b,a){T.event.add(this,a[0],af)},teardown:function(a){if(a.length){var c=0,b=RegExp("(^|\\.)"+a[0]+"(\\.|$)");T.each((T.data(this,"events").live||{}),function(){if(b.test(this.type)){c++}});if(c<1){T.event.remove(this,a[0],af)}}}}}};T.Event=function(a){if(!this.preventDefault){return new T.Event(a)}if(a&&a.type){this.originalEvent=a;this.type=a.type}else{this.type=a}this.timeStamp=ad();this[aa]=true};function X(){return false}function J(){return true}T.Event.prototype={preventDefault:function(){this.isDefaultPrevented=J;var a=this.originalEvent;if(!a){return}if(a.preventDefault){a.preventDefault()}a.returnValue=false},stopPropagation:function(){this.isPropagationStopped=J;var a=this.originalEvent;if(!a){return}if(a.stopPropagation){a.stopPropagation()}a.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=J;this.stopPropagation()},isDefaultPrevented:X,isPropagationStopped:X,isImmediatePropagationStopped:X};var ah=function(b){var c=b.relatedTarget;while(c&&c!=this){try{c=c.parentNode}catch(a){c=this}}if(c!=this){b.type=b.data;T.event.handle.apply(this,arguments)}};T.each({mouseover:"mouseenter",mouseout:"mouseleave"},function(a,b){T.event.special[b]={setup:function(){T.event.add(this,a,ah,b)},teardown:function(){T.event.remove(this,a,ah)}}});T.fn.extend({bind:function(b,a,c){return b=="unload"?this.one(b,a,c):this.each(function(){T.event.add(this,b,c||a,c&&a)})},one:function(b,a,c){var d=T.event.proxy(c||a,function(e){T(this).unbind(e,d);return(c||a).apply(this,arguments)});return this.each(function(){T.event.add(this,b,d,c&&a)})},unbind:function(a,b){return this.each(function(){T.event.remove(this,a,b)})},trigger:function(b,a){return this.each(function(){T.event.trigger(b,a,this)})},triggerHandler:function(c,a){if(this[0]){var b=T.Event(c);b.preventDefault();b.stopPropagation();T.event.trigger(b,a,this[0]);return b.result}},toggle:function(a){var c=arguments,b=1;while(b<c.length){T.event.proxy(a,c[b++])}return this.click(T.event.proxy(a,function(d){this.lastToggle=(this.lastToggle||0)%b;d.preventDefault();return c[this.lastToggle++].apply(this,arguments)||false}))},hover:function(b,a){return this.mouseenter(b).mouseleave(a)},ready:function(a){P();if(T.isReady){a.call(document,T)}else{T.readyList.push(a)}return this},live:function(a,b){var c=T.event.proxy(b);c.guid+=this.selector+a;T(document).bind(Z(a,this.selector),this.selector,c);return this},die:function(a,b){T(document).unbind(Z(a,this.selector),b?{guid:b.guid+this.selector+a}:null);return this}});function af(a){var d=RegExp("(^|\\.)"+a.type+"(\\.|$)"),b=true,c=[];T.each(T.data(this,"events").live||[],function(g,f){if(d.test(f.type)){var e=T(a.target).closest(f.data)[0];if(e){c.push({elem:e,fn:f})}}});c.sort(function(e,f){return T.data(e.elem,"closest")-T.data(f.elem,"closest")});T.each(c,function(){if(this.fn.call(this.elem,a,this.fn.data)===false){return(b=false)}});return b}function Z(a,b){return["live",a,b.replace(/\./g,"`").replace(/ /g,"|")].join(".")}T.extend({isReady:false,readyList:[],ready:function(){if(!T.isReady){T.isReady=true;if(T.readyList){T.each(T.readyList,function(){this.call(document,T)});T.readyList=null}T(document).triggerHandler("ready")}}});var G=false;function P(){if(G){return}G=true;if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,false);T.ready()},false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",arguments.callee);T.ready()}});if(document.documentElement.doScroll&&W==W.top){(function(){if(T.isReady){return}try{document.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}T.ready()})()}}}T.event.add(W,"load",T.ready)}T.each(("blur,focus,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error").split(","),function(a,b){T.fn[b]=function(c){return c?this.bind(b,c):this.trigger(b)}});T(W).bind("unload",function(){for(var a in T.cache){if(a!=1&&T.cache[a].handle){T.event.remove(T.cache[a].handle.elem)}}});(function(){T.support={};var f=document.documentElement,e=document.createElement("script"),a=document.createElement("div"),b="script"+(new Date).getTime();a.style.display="none";a.innerHTML='   <link/><table></table><a href="/a" style="color:red;float:left;opacity:.5;">a</a><select><option>text</option></select><object><param/></object>';var d=a.getElementsByTagName("*"),g=a.getElementsByTagName("a")[0];if(!d||!d.length||!g){return}T.support={leadingWhitespace:a.firstChild.nodeType==3,tbody:!a.getElementsByTagName("tbody").length,objectAll:!!a.getElementsByTagName("object")[0].getElementsByTagName("*").length,htmlSerialize:!!a.getElementsByTagName("link").length,style:/red/.test(g.getAttribute("style")),hrefNormalized:g.getAttribute("href")==="/a",opacity:g.style.opacity==="0.5",cssFloat:!!g.style.cssFloat,scriptEval:false,noCloneEvent:true,boxModel:null};e.type="text/javascript";try{e.appendChild(document.createTextNode("window."+b+"=1;"))}catch(c){}f.insertBefore(e,f.firstChild);if(W[b]){T.support.scriptEval=true;delete W[b]}f.removeChild(e);if(a.attachEvent&&a.fireEvent){a.attachEvent("onclick",function(){T.support.noCloneEvent=false;a.detachEvent("onclick",arguments.callee)});a.cloneNode(true).fireEvent("onclick")}T(function(){var h=document.createElement("div");h.style.width=h.style.paddingLeft="1px";document.body.appendChild(h);T.boxModel=T.support.boxModel=h.offsetWidth===2;document.body.removeChild(h).style.display="none"})})();var H=T.support.cssFloat?"cssFloat":"styleFloat";T.props={"for":"htmlFor","class":"className","float":H,cssFloat:H,styleFloat:H,readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",tabindex:"tabIndex"};T.fn.extend({_load:T.fn.load,load:function(e,b,a){if(typeof e!=="string"){return this._load(e)}var c=e.indexOf(" ");if(c>=0){var g=e.slice(c,e.length);e=e.slice(0,c)}var d="GET";if(b){if(T.isFunction(b)){a=b;b=null}else{if(typeof b==="object"){b=T.param(b);d="POST"}}}var f=this;T.ajax({url:e,type:d,dataType:"html",data:b,complete:function(j,h){if(h=="success"||h=="notmodified"){f.html(g?T("<div/>").append(j.responseText.replace(/<script(.|\s)*?\/script>/g,"")).find(g):j.responseText)}if(a){f.each(a,[j.responseText,h,j])}}});return this},serialize:function(){return T.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?T.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/text|hidden|password|search/i.test(this.type))}).map(function(c,b){var a=T(this).val();return a==null?null:T.isArray(a)?T.map(a,function(d,e){return{name:b.name,value:d}}):{name:b.name,value:a}}).get()}});T.each("ajaxStart,ajaxStop,ajaxComplete,ajaxError,ajaxSuccess,ajaxSend".split(","),function(b,a){T.fn[a]=function(c){return this.bind(a,c)}});var N=ad();T.extend({get:function(d,b,a,c){if(T.isFunction(b)){a=b;b=null}return T.ajax({type:"GET",url:d,data:b,success:a,dataType:c})},getScript:function(b,a){return T.get(b,null,a,"script")},getJSON:function(c,b,a){return T.get(c,b,a,"json")},post:function(d,b,a,c){if(T.isFunction(b)){a=b;b={}}return T.ajax({type:"POST",url:d,data:b,success:a,dataType:c})},ajaxSetup:function(a){T.extend(T.ajaxSettings,a)},ajaxSettings:{url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:function(){return W.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest()},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},ajax:function(l){l=T.extend(true,l,T.extend(true,{},T.ajaxSettings,l));var a,s=/=\?(&|$)/g,f,b,r=l.type.toUpperCase();if(l.data&&l.processData&&typeof l.data!=="string"){l.data=T.param(l.data)}if(l.dataType=="jsonp"){if(r=="GET"){if(!l.url.match(s)){l.url+=(l.url.match(/\?/)?"&":"?")+(l.jsonp||"callback")+"=?"}}else{if(!l.data||!l.data.match(s)){l.data=(l.data?l.data+"&":"")+(l.jsonp||"callback")+"=?"}}l.dataType="json"}if(l.dataType=="json"&&(l.data&&l.data.match(s)||l.url.match(s))){a="jsonp"+N++;if(l.data){l.data=(l.data+"").replace(s,"="+a+"$1")}l.url=l.url.replace(s,"="+a+"$1");l.dataType="script";W[a]=function(w){b=w;p();m();W[a]=ab;try{delete W[a]}catch(u){}if(q){q.removeChild(d)}}}if(l.dataType=="script"&&l.cache==null){l.cache=false}if(l.cache===false&&r=="GET"){var t=ad();var c=l.url.replace(/(\?|&)_=.*?(&|$)/,"$1_="+t+"$2");l.url=c+((c==l.url)?(l.url.match(/\?/)?"&":"?")+"_="+t:"")}if(l.data&&r=="GET"){l.url+=(l.url.match(/\?/)?"&":"?")+l.data;l.data=null}if(l.global&&!T.active++){T.event.trigger("ajaxStart")}var g=/^(\w+:)?\/\/([^\/?#]+)/.exec(l.url);if(l.dataType=="script"&&r=="GET"&&g&&(g[1]&&g[1]!=location.protocol||g[2]!=location.host)){var q=document.getElementsByTagName("head")[0];var d=document.createElement("script");d.src=l.url;if(l.scriptCharset){d.charset=l.scriptCharset}if(!a){var j=false;d.onload=d.onreadystatechange=function(){if(!j&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){j=true;p();m();d.onload=d.onreadystatechange=null;q.removeChild(d)}}}q.appendChild(d);return ab}var n=false;var o=l.xhr();if(l.username){o.open(r,l.url,l.async,l.username,l.password)}else{o.open(r,l.url,l.async)}try{if(l.data){o.setRequestHeader("Content-Type",l.contentType)}if(l.ifModified){o.setRequestHeader("If-Modified-Since",T.lastModified[l.url]||"Thu, 01 Jan 1970 00:00:00 GMT")}o.setRequestHeader("X-Requested-With","XMLHttpRequest");o.setRequestHeader("Accept",l.dataType&&l.accepts[l.dataType]?l.accepts[l.dataType]+", */*":l.accepts._default)}catch(e){}if(l.beforeSend&&l.beforeSend(o,l)===false){if(l.global&&!--T.active){T.event.trigger("ajaxStop")}o.abort();return false}if(l.global){T.event.trigger("ajaxSend",[o,l])}var k=function(x){if(o.readyState==0){if(h){clearInterval(h);h=null;if(l.global&&!--T.active){T.event.trigger("ajaxStop")}}}else{if(!n&&o&&(o.readyState==4||x=="timeout")){n=true;if(h){clearInterval(h);h=null}f=x=="timeout"?"timeout":!T.httpSuccess(o)?"error":l.ifModified&&T.httpNotModified(o,l.url)?"notmodified":"success";if(f=="success"){try{b=T.httpData(o,l.dataType,l)}catch(u){f="parsererror"}}if(f=="success"){var w;try{w=o.getResponseHeader("Last-Modified")}catch(u){}if(l.ifModified&&w){T.lastModified[l.url]=w}if(!a){p()}}else{T.handleError(l,o,f)}m();if(x){o.abort()}if(l.async){o=null}}}};if(l.async){var h=setInterval(k,13);if(l.timeout>0){setTimeout(function(){if(o&&!n){k("timeout")}},l.timeout)}}try{o.send(l.data)}catch(e){T.handleError(l,o,null,e)}if(!l.async){k()}function p(){if(l.success){l.success(b,f)}if(l.global){T.event.trigger("ajaxSuccess",[o,l])}}function m(){if(l.complete){l.complete(o,f)}if(l.global){T.event.trigger("ajaxComplete",[o,l])}if(l.global&&!--T.active){T.event.trigger("ajaxStop")}}return o},handleError:function(c,a,d,b){if(c.error){c.error(a,d,b)}if(c.global){T.event.trigger("ajaxError",[a,c,b])}},active:0,httpSuccess:function(a){try{return !a.status&&location.protocol=="file:"||(a.status>=200&&a.status<300)||a.status==304||a.status==1223}catch(b){}return false},httpNotModified:function(b,d){try{var a=b.getResponseHeader("Last-Modified");return b.status==304||a==T.lastModified[d]}catch(c){}return false},httpData:function(a,c,d){var e=a.getResponseHeader("content-type"),f=c=="xml"||!c&&e&&e.indexOf("xml")>=0,b=f?a.responseXML:a.responseText;if(f&&b.documentElement.tagName=="parsererror"){throw"parsererror"}if(d&&d.dataFilter){b=d.dataFilter(b,c)}if(typeof b==="string"){if(c=="script"){T.globalEval(b)}if(c=="json"){b=W["eval"]("("+b+")")}}return b},param:function(d){var b=[];function a(f,e){b[b.length]=encodeURIComponent(f)+"="+encodeURIComponent(e)}if(T.isArray(d)||d.jquery){T.each(d,function(){a(this.name,this.value)})}else{for(var c in d){if(T.isArray(d[c])){T.each(d[c],function(){a(c,this)})}else{a(c,T.isFunction(d[c])?d[c]():d[c])}}}return b.join("&").replace(/%20/g,"+")}});var V={},U,ae=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];function K(b,c){var a={};T.each(ae.concat.apply([],ae.slice(0,c)),function(){a[this]=b});return a}T.fn.extend({show:function(c,a){if(c){return this.animate(K("show",3),c,a)}else{for(var e=0,g=this.length;e<g;e++){var h=T.data(this[e],"olddisplay");this[e].style.display=h||"";if(T.css(this[e],"display")==="none"){var f=this[e].tagName,b;if(V[f]){b=V[f]}else{var d=T("<"+f+" />").appendTo("body");b=d.css("display");if(b==="none"){b="block"}d.remove();V[f]=b}T.data(this[e],"olddisplay",b)}}for(var e=0,g=this.length;e<g;e++){this[e].style.display=T.data(this[e],"olddisplay")||""}return this}},hide:function(b,a){if(b){return this.animate(K("hide",3),b,a)}else{for(var c=0,d=this.length;c<d;c++){var e=T.data(this[c],"olddisplay");if(!e&&e!=="none"){T.data(this[c],"olddisplay",T.css(this[c],"display"))}}for(var c=0,d=this.length;c<d;c++){this[c].style.display="none"}return this}},_toggle:T.fn.toggle,toggle:function(a,b){var c=typeof a==="boolean";return T.isFunction(a)&&T.isFunction(b)?this._toggle.apply(this,arguments):a==null||c?this.each(function(){var d=c?a:T(this).is(":hidden");T(this)[d?"show":"hide"]()}):this.animate(K("toggle",3),a,b)},fadeTo:function(c,a,b){return this.animate({opacity:a},c,b)},animate:function(a,d,b,c){var e=T.speed(d,b,c);return this[e.queue===false?"each":"queue"](function(){var g=T.extend({},e),j,f=this.nodeType==1&&T(this).is(":hidden"),h=this;for(j in a){if(a[j]=="hide"&&f||a[j]=="show"&&!f){return g.complete.call(this)}if((j=="height"||j=="width")&&this.style){g.display=T.css(this,"display");g.overflow=this.style.overflow}}if(g.overflow!=null){this.style.overflow="hidden"}g.curAnim=T.extend({},a);T.each(a,function(p,l){var m=new T.fx(h,g,p);if(/toggle|show|hide/.test(l)){m[l=="toggle"?f?"show":"hide":l](a)}else{var n=l.toString().match(/^([+-]=)?([\d+-.]+)(.*)$/),k=m.cur(true)||0;if(n){var q=parseFloat(n[2]),o=n[3]||"px";if(o!="px"){h.style[p]=(q||1)+o;k=((q||1)/m.cur(true))*k;h.style[p]=k+o}if(n[1]){q=((n[1]=="-="?-1:1)*q)+k}m.custom(k,q,o)}else{m.custom(k,l,"")}}});return true})},stop:function(b,c){var a=T.timers;if(b){this.queue([])}this.each(function(){for(var d=a.length-1;d>=0;d--){if(a[d].elem==this){if(c){a[d](true)}a.splice(d,1)}}});if(!c){this.dequeue()}return this}});T.each({slideDown:K("show",1),slideUp:K("hide",1),slideToggle:K("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(b,a){T.fn[b]=function(d,c){return this.animate(a,d,c)}});T.extend({speed:function(b,a,c){var d=typeof b==="object"?b:{complete:c||!c&&a||T.isFunction(b)&&b,duration:b,easing:c&&a||a&&!T.isFunction(a)&&a};d.duration=T.fx.off?0:typeof d.duration==="number"?d.duration:T.fx.speeds[d.duration]||T.fx.speeds._default;d.old=d.complete;d.complete=function(){if(d.queue!==false){T(this).dequeue()}if(T.isFunction(d.old)){d.old.call(this)}};return d},easing:{linear:function(b,a,d,c){return d+c*b},swing:function(b,a,d,c){return((-Math.cos(b*Math.PI)/2)+0.5)*c+d}},timers:[],fx:function(b,c,a){this.options=c;this.elem=b;this.prop=a;if(!c.orig){c.orig={}}}});T.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this)}(T.fx.step[this.prop]||T.fx.step._default)(this);if((this.prop=="height"||this.prop=="width")&&this.elem.style){this.elem.style.display="block"}},cur:function(a){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var b=parseFloat(T.css(this.elem,this.prop,a));return b&&b>-10000?b:parseFloat(T.curCSS(this.elem,this.prop))||0},custom:function(a,b,c){this.startTime=ad();this.start=a;this.end=b;this.unit=c||this.unit||"px";this.now=this.start;this.pos=this.state=0;var e=this;function d(f){return e.step(f)}d.elem=this.elem;if(d()&&T.timers.push(d)&&!U){U=setInterval(function(){var f=T.timers;for(var g=0;g<f.length;g++){if(!f[g]()){f.splice(g--,1)}}if(!f.length){clearInterval(U);U=ab}},13)}},show:function(){this.options.orig[this.prop]=T.attr(this.elem.style,this.prop);this.options.show=true;this.custom(this.prop=="width"||this.prop=="height"?1:0,this.cur());T(this.elem).show()},hide:function(){this.options.orig[this.prop]=T.attr(this.elem.style,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(c){var d=ad();if(c||d>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;var f=true;for(var e in this.options.curAnim){if(this.options.curAnim[e]!==true){f=false}}if(f){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;this.elem.style.display=this.options.display;if(T.css(this.elem,"display")=="none"){this.elem.style.display="block"}}if(this.options.hide){T(this.elem).hide()}if(this.options.hide||this.options.show){for(var b in this.options.curAnim){T.attr(this.elem.style,b,this.options.orig[b])}}this.options.complete.call(this.elem)}return false}else{var a=d-this.startTime;this.state=a/this.options.duration;this.pos=T.easing[this.options.easing||(T.easing.swing?"swing":"linear")](this.state,a,0,1,this.options.duration);this.now=this.start+((this.end-this.start)*this.pos);this.update()}return true}};T.extend(T.fx,{speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){T.attr(a.elem.style,"opacity",a.now)},_default:function(a){if(a.elem.style&&a.elem.style[a.prop]!=null){a.elem.style[a.prop]=a.now+a.unit}else{a.elem[a.prop]=a.now}}}});if(document.documentElement.getBoundingClientRect){T.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return T.offset.bodyOffset(this[0])}var f=this[0].getBoundingClientRect(),c=this[0].ownerDocument,g=c.body,h=c.documentElement,a=h.clientTop||g.clientTop||0,b=h.clientLeft||g.clientLeft||0,d=f.top+(self.pageYOffset||T.boxModel&&h.scrollTop||g.scrollTop)-a,e=f.left+(self.pageXOffset||T.boxModel&&h.scrollLeft||g.scrollLeft)-b;return{top:d,left:e}}}else{T.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return T.offset.bodyOffset(this[0])}T.offset.initialized||T.offset.initialize();var f=this[0],j=f.offsetParent,k=f,a=f.ownerDocument,c,h=a.documentElement,e=a.body,d=a.defaultView,l=d.getComputedStyle(f,null),b=f.offsetTop,g=f.offsetLeft;while((f=f.parentNode)&&f!==e&&f!==h){c=d.getComputedStyle(f,null);b-=f.scrollTop,g-=f.scrollLeft;if(f===j){b+=f.offsetTop,g+=f.offsetLeft;if(T.offset.doesNotAddBorder&&!(T.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(f.tagName))){b+=parseInt(c.borderTopWidth,10)||0,g+=parseInt(c.borderLeftWidth,10)||0}k=j,j=f.offsetParent}if(T.offset.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"){b+=parseInt(c.borderTopWidth,10)||0,g+=parseInt(c.borderLeftWidth,10)||0}l=c}if(l.position==="relative"||l.position==="static"){b+=e.offsetTop,g+=e.offsetLeft}if(l.position==="fixed"){b+=Math.max(h.scrollTop,e.scrollTop),g+=Math.max(h.scrollLeft,e.scrollLeft)}return{top:b,left:g}}}T.offset={initialize:function(){if(this.initialized){return}var c=document.body,j=document.createElement("div"),g,h,a,f,b,k,e=c.style.marginTop,d='<div style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;"><div></div></div><table style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;" cellpadding="0" cellspacing="0"><tr><td></td></tr></table>';b={position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"};for(k in b){j.style[k]=b[k]}j.innerHTML=d;c.insertBefore(j,c.firstChild);g=j.firstChild,h=g.firstChild,f=g.nextSibling.firstChild.firstChild;this.doesNotAddBorder=(h.offsetTop!==5);this.doesAddBorderForTableAndCells=(f.offsetTop===5);g.style.overflow="hidden",g.style.position="relative";this.subtractsBorderForOverflowNotVisible=(h.offsetTop===-5);c.style.marginTop="1px";this.doesNotIncludeMarginInBodyOffset=(c.offsetTop===0);c.style.marginTop=e;c.removeChild(j);this.initialized=true},bodyOffset:function(c){T.offset.initialized||T.offset.initialize();var a=c.offsetTop,b=c.offsetLeft;if(T.offset.doesNotIncludeMarginInBodyOffset){a+=parseInt(T.curCSS(c,"marginTop",true),10)||0,b+=parseInt(T.curCSS(c,"marginLeft",true),10)||0}return{top:a,left:b}}};T.fn.extend({position:function(){var b=0,c=0,e;if(this[0]){var d=this.offsetParent(),a=this.offset(),f=/^body|html$/i.test(d[0].tagName)?{top:0,left:0}:d.offset();a.top-=Y(this,"marginTop");a.left-=Y(this,"marginLeft");f.top+=Y(d,"borderTopWidth");f.left+=Y(d,"borderLeftWidth");e={top:a.top-f.top,left:a.left-f.left}}return e},offsetParent:function(){var a=this[0].offsetParent||document.body;while(a&&(!/^body|html$/i.test(a.tagName)&&T.css(a,"position")=="static")){a=a.offsetParent}return T(a)}});T.each(["Left","Top"],function(b,c){var a="scroll"+c;T.fn[a]=function(d){if(!this[0]){return null}return d!==ab?this.each(function(){this==W||this==document?W.scrollTo(!b?d:T(W).scrollLeft(),b?d:T(W).scrollTop()):this[a]=d}):this[0]==W||this[0]==document?self[b?"pageYOffset":"pageXOffset"]||T.boxModel&&document.documentElement[a]||document.body[a]:this[0][a]}});T.each(["Height","Width"],function(b,d){var f=b?"Left":"Top",c=b?"Right":"Bottom",e=d.toLowerCase();T.fn["inner"+d]=function(){return this[0]?T.css(this[0],e,false,"padding"):null};T.fn["outer"+d]=function(g){return this[0]?T.css(this[0],e,false,g?"margin":"border"):null};var a=d.toLowerCase();T.fn[a]=function(g){return this[0]==W?document.compatMode=="CSS1Compat"&&document.documentElement["client"+d]||document.body["client"+d]:this[0]==document?Math.max(document.documentElement["client"+d],document.body["scroll"+d],document.documentElement["scroll"+d],document.body["offset"+d],document.documentElement["offset"+d]):g===ab?(this.length?T.css(this[0],a):null):this.css(a,typeof g==="string"?g:g+"px")}})})();(function(a){a.fn.hoverIntent=function(l,k){var m={sensitivity:7,interval:100,timeout:0};m=a.extend(m,k?{over:l,out:k}:l);var o,n,h,d;var e=function(f){o=f.pageX;n=f.pageY};var c=function(g,f){f.hoverIntent_t=clearTimeout(f.hoverIntent_t);if((Math.abs(h-o)+Math.abs(d-n))<m.sensitivity){a(f).unbind("mousemove",e);f.hoverIntent_s=1;return m.over.apply(f,[g])}else{h=o;d=n;f.hoverIntent_t=setTimeout(function(){c(g,f)},m.interval)}};var j=function(g,f){f.hoverIntent_t=clearTimeout(f.hoverIntent_t);f.hoverIntent_s=0;return m.out.apply(f,[g])};var b=function(r){var q=(r.type=="mouseover"?r.fromElement:r.toElement)||r.relatedTarget;while(q&&q!=this){try{q=q.parentNode}catch(r){q=this}}if(q==this){return false}var g=jQuery.extend({},r);var f=this;if(f.hoverIntent_t){f.hoverIntent_t=clearTimeout(f.hoverIntent_t)}if(r.type=="mouseover"){h=g.pageX;d=g.pageY;a(f).bind("mousemove",e);if(f.hoverIntent_s!=1){f.hoverIntent_t=setTimeout(function(){c(g,f)},m.interval)}}else{a(f).unbind("mousemove",e);if(f.hoverIntent_s==1){f.hoverIntent_t=setTimeout(function(){j(g,f)},m.timeout)}}};return this.mouseover(b).mouseout(b)}})(jQuery);(function(a){a.fn.bgIframe=a.fn.bgiframe=function(c){if(a.browser.msie&&/6.0/.test(navigator.userAgent)){c=a.extend({top:"auto",left:"auto",width:"auto",height:"auto",opacity:true,src:"javascript:false;"},c||{});var d=function(e){return e&&e.constructor==Number?e+"px":e},b='<iframe class="bgiframe"frameborder="0"tabindex="-1"src="'+c.src+'"style="display:block;position:absolute;z-index:-1;'+(c.opacity!==false?"filter:Alpha(Opacity='0');":"")+"top:"+(c.top=="auto"?"expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+'px')":d(c.top))+";left:"+(c.left=="auto"?"expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+'px')":d(c.left))+";width:"+(c.width=="auto"?"expression(this.parentNode.offsetWidth+'px')":d(c.width))+";height:"+(c.height=="auto"?"expression(this.parentNode.offsetHeight+'px')":d(c.height))+';"/>';return this.each(function(){if(a("> iframe.bgiframe",this).length==0){this.insertBefore(document.createElement(b),this.firstChild)}})}return this}})(jQuery);jQuery.bt={version:"0.9.5-rc1"};(function($){jQuery.fn.bt=function(content,options){if(typeof content!="string"){var contentSelect=true;options=content;content=false}else{var contentSelect=false}if(jQuery.fn.hoverIntent&&jQuery.bt.defaults.trigger=="hover"){jQuery.bt.defaults.trigger="hoverIntent"}return this.each(function(index){var opts=jQuery.extend(false,jQuery.bt.defaults,jQuery.bt.options,options);opts.spikeLength=numb(opts.spikeLength);opts.spikeGirth=numb(opts.spikeGirth);opts.overlap=numb(opts.overlap);var ajaxTimeout=false;if(opts.killTitle){$(this).find("[title]").andSelf().each(function(){if(!$(this).attr("bt-xTitle")){$(this).attr("bt-xTitle",$(this).attr("title")).attr("title","")}})}if(typeof opts.trigger=="string"){opts.trigger=[opts.trigger]}if(opts.trigger[0]=="hoverIntent"){var hoverOpts=jQuery.extend(opts.hoverIntentOpts,{over:function(){this.btOn()},out:function(){this.btOff()}});$(this).hoverIntent(hoverOpts)}else{if(opts.trigger[0]=="hover"){$(this).hover(function(){this.btOn()},function(){this.btOff()})}else{if(opts.trigger[0]=="now"){if($(this).hasClass("bt-active")){this.btOff()}else{this.btOn()}}else{if(opts.trigger[0]=="none"){}else{if(opts.trigger.length>1&&opts.trigger[0]!=opts.trigger[1]){$(this).bind(opts.trigger[0],function(){this.btOn()}).bind(opts.trigger[1],function(){this.btOff()})}else{$(this).bind(opts.trigger[0],function(){if($(this).hasClass("bt-active")){this.btOff()}else{this.btOn()}})}}}}}this.btOn=function(){if(typeof $(this).data("bt-box")=="object"){this.btOff()}opts.preBuild.apply(this);$(jQuery.bt.vars.closeWhenOpenStack).btOff();$(this).addClass("bt-active "+opts.activeClass);if(contentSelect&&opts.ajaxPath==null){if(opts.killTitle){$(this).attr("title",$(this).attr("bt-xTitle"))}content=$.isFunction(opts.contentSelector)?opts.contentSelector.apply(this):eval(opts.contentSelector);if(opts.killTitle){$(this).attr("title","")}}if(opts.ajaxPath!=null&&content==false){if(typeof opts.ajaxPath=="object"){var url=eval(opts.ajaxPath[0]);url+=opts.ajaxPath[1]?" "+opts.ajaxPath[1]:""}else{var url=opts.ajaxPath}var off=url.indexOf(" ");if(off>=0){var selector=url.slice(off,url.length);url=url.slice(0,off)}var cacheData=opts.ajaxCache?$(document.body).data("btCache-"+url.replace(/\./g,"")):null;if(typeof cacheData=="string"){content=selector?$("<div/>").append(cacheData.replace(/<script(.|\s)*?\/script>/g,"")).find(selector):cacheData}else{var target=this;var ajaxOpts=jQuery.extend(false,{type:opts.ajaxType,data:opts.ajaxData,cache:opts.ajaxCache,url:url,complete:function(XMLHttpRequest,textStatus){if(textStatus=="success"||textStatus=="notmodified"){if(opts.ajaxCache){$(document.body).data("btCache-"+url.replace(/\./g,""),XMLHttpRequest.responseText)}ajaxTimeout=false;content=selector?$("<div/>").append(XMLHttpRequest.responseText.replace(/<script(.|\s)*?\/script>/g,"")).find(selector):XMLHttpRequest.responseText}else{if(textStatus=="timeout"){ajaxTimeout=true}content=opts.ajaxError.replace(/%error/g,XMLHttpRequest.statusText)}if($(target).hasClass("bt-active")){target.btOn()}}},opts.ajaxOpts);jQuery.ajax(ajaxOpts);content=opts.ajaxLoading}}var shadowMarginX=0;var shadowMarginY=0;var shadowShiftX=0;var shadowShiftY=0;if(opts.shadow&&!shadowSupport()){opts.shadow=false;jQuery.extend(opts,opts.noShadowOpts)}if(opts.shadow){if(opts.shadowBlur>Math.abs(opts.shadowOffsetX)){shadowMarginX=opts.shadowBlur*2}else{shadowMarginX=opts.shadowBlur+Math.abs(opts.shadowOffsetX)}shadowShiftX=(opts.shadowBlur-opts.shadowOffsetX)>0?opts.shadowBlur-opts.shadowOffsetX:0;if(opts.shadowBlur>Math.abs(opts.shadowOffsetY)){shadowMarginY=opts.shadowBlur*2}else{shadowMarginY=opts.shadowBlur+Math.abs(opts.shadowOffsetY)}shadowShiftY=(opts.shadowBlur-opts.shadowOffsetY)>0?opts.shadowBlur-opts.shadowOffsetY:0}if(opts.offsetParent){var offsetParent=$(opts.offsetParent);var offsetParentPos=offsetParent.offset();var pos=$(this).offset();var top=numb(pos.top)-numb(offsetParentPos.top)+numb($(this).css("margin-top"))-shadowShiftY;var left=numb(pos.left)-numb(offsetParentPos.left)+numb($(this).css("margin-left"))-shadowShiftX}else{var offsetParent=($(this).css("position")=="absolute")?$(this).parents().eq(0).offsetParent():$(this).offsetParent();var pos=$(this).btPosition();var top=numb(pos.top)+numb($(this).css("margin-top"))-shadowShiftY;var left=numb(pos.left)+numb($(this).css("margin-left"))-shadowShiftX}var width=$(this).btOuterWidth();var height=$(this).outerHeight();if(typeof content=="object"){var original=content;var clone=$(original).clone(true).show();var origClones=$(original).data("bt-clones")||[];origClones.push(clone);$(original).data("bt-clones",origClones);$(clone).data("bt-orig",original);$(this).data("bt-content-orig",{original:original,clone:clone});content=clone}if(typeof content=="null"||content==""){return}var $text=$('<div class="bt-content"></div>').append(content).css({padding:opts.padding,position:"absolute",width:(opts.shrinkToFit?"auto":opts.width),zIndex:opts.textzIndex,left:shadowShiftX,top:shadowShiftY}).css(opts.cssStyles);var $box=$('<div class="bt-wrapper"></div>').append($text).addClass(opts.cssClass).css({position:"absolute",width:opts.width,zIndex:opts.wrapperzIndex,visibility:"hidden"}).appendTo(offsetParent);if(jQuery.fn.bgiframe){$text.bgiframe();$box.bgiframe()}$(this).data("bt-box",$box);var scrollTop=numb($(document).scrollTop());var scrollLeft=numb($(document).scrollLeft());var docWidth=numb($(window).width());var docHeight=numb($(window).height());var winRight=scrollLeft+docWidth;var winBottom=scrollTop+docHeight;var space=new Object();var thisOffset=$(this).offset();space.top=thisOffset.top-scrollTop;space.bottom=docHeight-((thisOffset+height)-scrollTop);space.left=thisOffset.left-scrollLeft;space.right=docWidth-((thisOffset.left+width)-scrollLeft);var textOutHeight=numb($text.outerHeight());var textOutWidth=numb($text.btOuterWidth());if(opts.positions.constructor==String){opts.positions=opts.positions.replace(/ /,"").split(",")}if(opts.positions[0]=="most"){var position="top";for(var pig in space){position=space[pig]>space[position]?pig:position}}else{for(var x in opts.positions){var position=opts.positions[x];if((position=="left"||position=="right")&&space[position]>textOutWidth+opts.spikeLength){break}else{if((position=="top"||position=="bottom")&&space[position]>textOutHeight+opts.spikeLength){break}}}}var horiz=left+((width-textOutWidth)*0.5);var vert=top+((height-textOutHeight)*0.5);var points=new Array();var textTop,textLeft,textRight,textBottom,textTopSpace,textBottomSpace,textLeftSpace,textRightSpace,crossPoint,textCenter,spikePoint;switch(position){case"top":$text.css("margin-bottom",opts.spikeLength+"px");$box.css({top:(top-$text.outerHeight(true))+opts.overlap,left:horiz});textRightSpace=(winRight-opts.windowMargin)-($text.offset().left+$text.btOuterWidth(true));var xShift=shadowShiftX;if(textRightSpace<0){$box.css("left",(numb($box.css("left"))+textRightSpace)+"px");xShift-=textRightSpace}textLeftSpace=($text.offset().left+numb($text.css("margin-left")))-(scrollLeft+opts.windowMargin);if(textLeftSpace<0){$box.css("left",(numb($box.css("left"))-textLeftSpace)+"px");xShift+=textLeftSpace}textTop=$text.btPosition().top+numb($text.css("margin-top"));textLeft=$text.btPosition().left+numb($text.css("margin-left"));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+($text.btOuterWidth()*opts.centerPointX),y:textTop+($text.outerHeight()*opts.centerPointY)};points[points.length]=spikePoint={y:textBottom+opts.spikeLength,x:((textRight-textLeft)*0.5)+xShift,type:"spike"};crossPoint=findIntersectX(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textBottom);crossPoint.x=crossPoint.x<textLeft+opts.spikeGirth/2+opts.cornerRadius?textLeft+opts.spikeGirth/2+opts.cornerRadius:crossPoint.x;crossPoint.x=crossPoint.x>(textRight-opts.spikeGirth/2)-opts.cornerRadius?(textRight-opts.spikeGirth/2)-opts.CornerRadius:crossPoint.x;points[points.length]={x:crossPoint.x-(opts.spikeGirth/2),y:textBottom,type:"join"};points[points.length]={x:textLeft,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textBottom,type:"corner"};points[points.length]={x:crossPoint.x+(opts.spikeGirth/2),y:textBottom,type:"join"};points[points.length]=spikePoint;break;case"left":$text.css("margin-right",opts.spikeLength+"px");$box.css({top:vert+"px",left:((left-$text.btOuterWidth(true))+opts.overlap)+"px"});textBottomSpace=(winBottom-opts.windowMargin)-($text.offset().top+$text.outerHeight(true));var yShift=shadowShiftY;if(textBottomSpace<0){$box.css("top",(numb($box.css("top"))+textBottomSpace)+"px");yShift-=textBottomSpace}textTopSpace=($text.offset().top+numb($text.css("margin-top")))-(scrollTop+opts.windowMargin);if(textTopSpace<0){$box.css("top",(numb($box.css("top"))-textTopSpace)+"px");yShift+=textTopSpace}textTop=$text.btPosition().top+numb($text.css("margin-top"));textLeft=$text.btPosition().left+numb($text.css("margin-left"));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+($text.btOuterWidth()*opts.centerPointX),y:textTop+($text.outerHeight()*opts.centerPointY)};points[points.length]=spikePoint={x:textRight+opts.spikeLength,y:((textBottom-textTop)*0.5)+yShift,type:"spike"};crossPoint=findIntersectY(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textRight);crossPoint.y=crossPoint.y<textTop+opts.spikeGirth/2+opts.cornerRadius?textTop+opts.spikeGirth/2+opts.cornerRadius:crossPoint.y;crossPoint.y=crossPoint.y>(textBottom-opts.spikeGirth/2)-opts.cornerRadius?(textBottom-opts.spikeGirth/2)-opts.cornerRadius:crossPoint.y;points[points.length]={x:textRight,y:crossPoint.y+opts.spikeGirth/2,type:"join"};points[points.length]={x:textRight,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textTop,type:"corner"};points[points.length]={x:textRight,y:crossPoint.y-opts.spikeGirth/2,type:"join"};points[points.length]=spikePoint;break;case"bottom":$text.css("margin-top",opts.spikeLength+"px");$box.css({top:(top+height)-opts.overlap,left:horiz});textRightSpace=(winRight-opts.windowMargin)-($text.offset().left+$text.btOuterWidth(true));var xShift=shadowShiftX;if(textRightSpace<0){$box.css("left",(numb($box.css("left"))+textRightSpace)+"px");xShift-=textRightSpace}textLeftSpace=($text.offset().left+numb($text.css("margin-left")))-(scrollLeft+opts.windowMargin);if(textLeftSpace<0){$box.css("left",(numb($box.css("left"))-textLeftSpace)+"px");xShift+=textLeftSpace}textTop=$text.btPosition().top+numb($text.css("margin-top"));textLeft=$text.btPosition().left+numb($text.css("margin-left"));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+($text.btOuterWidth()*opts.centerPointX),y:textTop+($text.outerHeight()*opts.centerPointY)};points[points.length]=spikePoint={x:((textRight-textLeft)*0.5)+xShift,y:shadowShiftY,type:"spike"};crossPoint=findIntersectX(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textTop);crossPoint.x=crossPoint.x<textLeft+opts.spikeGirth/2+opts.cornerRadius?textLeft+opts.spikeGirth/2+opts.cornerRadius:crossPoint.x;crossPoint.x=crossPoint.x>(textRight-opts.spikeGirth/2)-opts.cornerRadius?(textRight-opts.spikeGirth/2)-opts.cornerRadius:crossPoint.x;points[points.length]={x:crossPoint.x+opts.spikeGirth/2,y:textTop,type:"join"};points[points.length]={x:textRight,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textTop,type:"corner"};points[points.length]={x:crossPoint.x-(opts.spikeGirth/2),y:textTop,type:"join"};points[points.length]=spikePoint;break;case"right":$text.css("margin-left",(opts.spikeLength+"px"));$box.css({top:vert+"px",left:((left+width)-opts.overlap)+"px"});textBottomSpace=(winBottom-opts.windowMargin)-($text.offset().top+$text.outerHeight(true));var yShift=shadowShiftY;if(textBottomSpace<0){$box.css("top",(numb($box.css("top"))+textBottomSpace)+"px");yShift-=textBottomSpace}textTopSpace=($text.offset().top+numb($text.css("margin-top")))-(scrollTop+opts.windowMargin);if(textTopSpace<0){$box.css("top",(numb($box.css("top"))-textTopSpace)+"px");yShift+=textTopSpace}textTop=$text.btPosition().top+numb($text.css("margin-top"));textLeft=$text.btPosition().left+numb($text.css("margin-left"));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+($text.btOuterWidth()*opts.centerPointX),y:textTop+($text.outerHeight()*opts.centerPointY)};points[points.length]=spikePoint={x:shadowShiftX,y:((textBottom-textTop)*0.5)+yShift,type:"spike"};crossPoint=findIntersectY(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textLeft);crossPoint.y=crossPoint.y<textTop+opts.spikeGirth/2+opts.cornerRadius?textTop+opts.spikeGirth/2+opts.cornerRadius:crossPoint.y;crossPoint.y=crossPoint.y>(textBottom-opts.spikeGirth/2)-opts.cornerRadius?(textBottom-opts.spikeGirth/2)-opts.cornerRadius:crossPoint.y;points[points.length]={x:textLeft,y:crossPoint.y-opts.spikeGirth/2,type:"join"};points[points.length]={x:textLeft,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:crossPoint.y+opts.spikeGirth/2,type:"join"};points[points.length]=spikePoint;break}var canvas=document.createElement("canvas");$(canvas).attr("width",(numb($text.btOuterWidth(true))+opts.strokeWidth*2+shadowMarginX)).attr("height",(numb($text.outerHeight(true))+opts.strokeWidth*2+shadowMarginY)).appendTo($box).css({position:"absolute",zIndex:opts.boxzIndex});if(typeof G_vmlCanvasManager!="undefined"){canvas=G_vmlCanvasManager.initElement(canvas)}if(opts.cornerRadius>0){var newPoints=new Array();var newPoint;for(var i=0;i<points.length;i++){if(points[i].type=="corner"){newPoint=betweenPoint(points[i],points[(i-1)%points.length],opts.cornerRadius);newPoint.type="arcStart";newPoints[newPoints.length]=newPoint;newPoints[newPoints.length]=points[i];newPoint=betweenPoint(points[i],points[(i+1)%points.length],opts.cornerRadius);newPoint.type="arcEnd";newPoints[newPoints.length]=newPoint}else{newPoints[newPoints.length]=points[i]}}points=newPoints}var ctx=canvas.getContext("2d");if(opts.shadow&&opts.shadowOverlap!==true){var shadowOverlap=numb(opts.shadowOverlap);switch(position){case"top":if(opts.shadowOffsetX+opts.shadowBlur-shadowOverlap>0){$box.css("top",(numb($box.css("top"))-(opts.shadowOffsetX+opts.shadowBlur-shadowOverlap)))}break;case"right":if(shadowShiftX-shadowOverlap>0){$box.css("left",(numb($box.css("left"))+shadowShiftX-shadowOverlap))}break;case"bottom":if(shadowShiftY-shadowOverlap>0){$box.css("top",(numb($box.css("top"))+shadowShiftY-shadowOverlap))}break;case"left":if(opts.shadowOffsetY+opts.shadowBlur-shadowOverlap>0){$box.css("left",(numb($box.css("left"))-(opts.shadowOffsetY+opts.shadowBlur-shadowOverlap)))}break}}drawIt.apply(ctx,[points],opts.strokeWidth);ctx.fillStyle=opts.fill;if(opts.shadow){ctx.shadowOffsetX=opts.shadowOffsetX;ctx.shadowOffsetY=opts.shadowOffsetY;ctx.shadowBlur=opts.shadowBlur;ctx.shadowColor=opts.shadowColor}ctx.closePath();ctx.fill();if(opts.strokeWidth>0){ctx.shadowColor="rgba(0, 0, 0, 0)";ctx.lineWidth=opts.strokeWidth;ctx.strokeStyle=opts.strokeStyle;ctx.beginPath();drawIt.apply(ctx,[points],opts.strokeWidth);ctx.closePath();ctx.stroke()}opts.preShow.apply(this,[$box[0]]);$box.css({display:"none",visibility:"visible"});opts.showTip.apply(this,[$box[0]]);if(opts.overlay){var overlay=$('<div class="bt-overlay"></div>').css({position:"absolute",backgroundColor:"blue",top:top,left:left,width:width,height:height,opacity:".2"}).appendTo(offsetParent);$(this).data("overlay",overlay)}if((opts.ajaxPath!=null&&opts.ajaxCache==false)||ajaxTimeout){content=false}if(opts.clickAnywhereToClose){jQuery.bt.vars.clickAnywhereStack.push(this);$(document).click(jQuery.bt.docClick)}if(opts.closeWhenOthersOpen){jQuery.bt.vars.closeWhenOpenStack.push(this)}opts.postShow.apply(this,[$box[0]])};this.btOff=function(){var box=$(this).data("bt-box");opts.preHide.apply(this,[box]);var i=this;i.btCleanup=function(){var box=$(i).data("bt-box");var contentOrig=$(i).data("bt-content-orig");var overlay=$(i).data("bt-overlay");if(typeof box=="object"){$(box).remove();$(i).removeData("bt-box")}if(typeof contentOrig=="object"){var clones=$(contentOrig.original).data("bt-clones");$(contentOrig).data("bt-clones",arrayRemove(clones,contentOrig.clone))}if(typeof overlay=="object"){$(overlay).remove();$(i).removeData("bt-overlay")}jQuery.bt.vars.clickAnywhereStack=arrayRemove(jQuery.bt.vars.clickAnywhereStack,i);jQuery.bt.vars.closeWhenOpenStack=arrayRemove(jQuery.bt.vars.closeWhenOpenStack,i);$(i).removeClass("bt-active "+opts.activeClass);opts.postHide.apply(i)};opts.hideTip.apply(this,[box,i.btCleanup])};var refresh=this.btRefresh=function(){this.btOff();this.btOn()}});function drawIt(points,strokeWidth){this.moveTo(points[0].x,points[0].y);for(i=1;i<points.length;i++){if(points[i-1].type=="arcStart"){this.quadraticCurveTo(round5(points[i].x,strokeWidth),round5(points[i].y,strokeWidth),round5(points[(i+1)%points.length].x,strokeWidth),round5(points[(i+1)%points.length].y,strokeWidth));i++}else{this.lineTo(round5(points[i].x,strokeWidth),round5(points[i].y,strokeWidth))}}}function round5(num,strokeWidth){var ret;strokeWidth=numb(strokeWidth);if(strokeWidth%2){ret=num}else{ret=Math.round(num-0.5)+0.5}return ret}function numb(num){return parseInt(num)||0}function arrayRemove(arr,elem){var x,newArr=new Array();for(x in arr){if(arr[x]!=elem){newArr.push(arr[x])}}return newArr}function canvasSupport(){var canvas_compatible=false;try{canvas_compatible=!!(document.createElement("canvas").getContext("2d"))}catch(e){canvas_compatible=!!(document.createElement("canvas").getContext)}return canvas_compatible}function shadowSupport(){try{var userAgent=navigator.userAgent.toLowerCase();if(/webkit/.test(userAgent)){return true}else{if(/gecko|mozilla/.test(userAgent)&&parseFloat(userAgent.match(/firefox\/(\d+(?:\.\d+)+)/)[1])>=3.1){return true}}}catch(err){}return false}function betweenPoint(point1,point2,dist){var y,x;if(point1.x==point2.x){y=point1.y<point2.y?point1.y+dist:point1.y-dist;return{x:point1.x,y:y}}else{if(point1.y==point2.y){x=point1.x<point2.x?point1.x+dist:point1.x-dist;return{x:x,y:point1.y}}}}function centerPoint(arcStart,corner,arcEnd){var x=corner.x==arcStart.x?arcEnd.x:arcStart.x;var y=corner.y==arcStart.y?arcEnd.y:arcStart.y;var startAngle,endAngle;if(arcStart.x<arcEnd.x){if(arcStart.y>arcEnd.y){startAngle=(Math.PI/180)*180;endAngle=(Math.PI/180)*90}else{startAngle=(Math.PI/180)*90;endAngle=0}}else{if(arcStart.y>arcEnd.y){startAngle=(Math.PI/180)*270;endAngle=(Math.PI/180)*180}else{startAngle=0;endAngle=(Math.PI/180)*270}}return{x:x,y:y,type:"center",startAngle:startAngle,endAngle:endAngle}}function findIntersect(r1x1,r1y1,r1x2,r1y2,r2x1,r2y1,r2x2,r2y2){if(r2x1==r2x2){return findIntersectY(r1x1,r1y1,r1x2,r1y2,r2x1)}if(r2y1==r2y2){return findIntersectX(r1x1,r1y1,r1x2,r1y2,r2y1)}var r1m=(r1y1-r1y2)/(r1x1-r1x2);var r1b=r1y1-(r1m*r1x1);var r2m=(r2y1-r2y2)/(r2x1-r2x2);var r2b=r2y1-(r2m*r2x1);var x=(r2b-r1b)/(r1m-r2m);var y=r1m*x+r1b;return{x:x,y:y}}function findIntersectY(r1x1,r1y1,r1x2,r1y2,x){if(r1y1==r1y2){return{x:x,y:r1y1}}var r1m=(r1y1-r1y2)/(r1x1-r1x2);var r1b=r1y1-(r1m*r1x1);var y=r1m*x+r1b;return{x:x,y:y}}function findIntersectX(r1x1,r1y1,r1x2,r1y2,y){if(r1x1==r1x2){return{x:r1x1,y:y}}var r1m=(r1y1-r1y2)/(r1x1-r1x2);var r1b=r1y1-(r1m*r1x1);var x=(y-r1b)/r1m;return{x:x,y:y}}};jQuery.fn.btPosition=function(){function num(elem,prop){return elem[0]&&parseInt(jQuery.curCSS(elem[0],prop,true),10)||0}var left=0,top=0,results;if(this[0]){var offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=/^body|html$/i.test(offsetParent[0].tagName)?{top:0,left:0}:offsetParent.offset();offset.top-=num(this,"marginTop");offset.left-=num(this,"marginLeft");parentOffset.top+=num(offsetParent,"borderTopWidth");parentOffset.left+=num(offsetParent,"borderLeftWidth");results={top:offset.top-parentOffset.top,left:offset.left-parentOffset.left}}return results};jQuery.fn.btOuterWidth=function(margin){function num(elem,prop){return elem[0]&&parseInt(jQuery.curCSS(elem[0],prop,true),10)||0}return this["innerWidth"]()+num(this,"borderLeftWidth")+num(this,"borderRightWidth")+(margin?num(this,"marginLeft")+num(this,"marginRight"):0)};jQuery.fn.btOn=function(){return this.each(function(index){if(jQuery.isFunction(this.btOn)){this.btOn()}})};jQuery.fn.btOff=function(){return this.each(function(index){if(jQuery.isFunction(this.btOff)){this.btOff()}})};jQuery.bt.vars={clickAnywhereStack:[],closeWhenOpenStack:[]};jQuery.bt.docClick=function(e){if(!e){var e=window.event}if(!$(e.target).parents().andSelf().filter(".bt-wrapper, .bt-active").length&&jQuery.bt.vars.clickAnywhereStack.length){$(jQuery.bt.vars.clickAnywhereStack).btOff();$(document).unbind("click",jQuery.bt.docClick)}};jQuery.bt.defaults={trigger:"hover",clickAnywhereToClose:true,closeWhenOthersOpen:false,shrinkToFit:false,width:"200px",padding:"10px",spikeGirth:10,spikeLength:15,overlap:0,overlay:false,killTitle:true,textzIndex:9999,boxzIndex:9998,wrapperzIndex:9997,offsetParent:null,positions:["most"],fill:"rgb(255, 255, 102)",windowMargin:10,strokeWidth:1,strokeStyle:"#000",cornerRadius:5,centerPointX:0.5,centerPointY:0.5,shadow:false,shadowOffsetX:2,shadowOffsetY:2,shadowBlur:3,shadowColor:"#000",shadowOverlap:false,noShadowOpts:{strokeStyle:"#999"},cssClass:"",cssStyles:{},activeClass:"bt-active",contentSelector:"$(this).attr('title')",ajaxPath:null,ajaxError:"<strong>ERROR:</strong> <em>%error</em>",ajaxLoading:"<blink>Loading...</blink>",ajaxData:{},ajaxType:"GET",ajaxCache:true,ajaxOpts:{},preBuild:function(){},preShow:function(box){},showTip:function(box){$(box).show()},postShow:function(box){},preHide:function(box){},hideTip:function(box,callback){$(box).hide();callback()},postHide:function(){},hoverIntentOpts:{interval:300,timeout:500}};jQuery.bt.options={}})(jQuery);
